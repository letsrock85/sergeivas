# Сергеивас.com - Статус Проекта

## Текущий Stack (Февраль 2026)

```
- Next.js:        16.1.4      ✅ Обновлено
- React:          19.2.3      ✅ Обновлено
- TypeScript:     5.9.3       ✅ Обновлено
- Sanity CMS:     3.76.1      ✅ Работает
- next-sanity:    12.0.14     ✅ Обновлено
- TailwindCSS:    4.0.0       ✅ Обновлено
- styled-components: 6.1.8    ✅ Совместимо
```

---

## Sanity Webhook Revalidation

### Статус: ✅ НАСТРОЕНО (2026-02-09)

### Как работает
1. Публикуешь контент в Sanity Studio
2. Sanity отправляет webhook на `/api/revalidate-path`
3. Next.js инвалидирует кеш для нужных страниц
4. При следующем посещении страница обновляется с новым контентом

### Настройки в Sanity (manage.sanity.io → API → Webhooks)

**URL:**
```
https://www.sergeivas.com/api/revalidate-path
```

**Filter (GROQ):**
```groq
_type in ["Post", "project", "author", "page"]
```

**Projection (GROQ):**
```groq
{
  "_type": _type,
  "slug": slug,
  "path": select(
    _type == "Post" => "/blog/" + slug.current,
    _type == "project" => "/projects/" + slug.current,
    _type == "author" => "/",
    "/"
  )
}
```

**Другие настройки:**
- HTTP Method: POST
- Trigger on: Create ✅, Update ✅, Delete ✅
- Enable webhook: ✅
- Secret: `your-ass-1` (тот же что в Vercel `SANITY_HOOK_SECRET`)

### Vercel Environment Variables
```
SANITY_HOOK_SECRET=your-ass-1
```

### API Endpoint
Файл: `/app/api/revalidate-path/route.ts`
- Использует `@sanity/webhook` для проверки подписи
- Вызывает `revalidateTag()` и `revalidatePath()`

### Важные моменты

**Next.js 16 Breaking Changes:**
- `params` теперь асинхронный: `const { post } = await params`
- `revalidateTag(tag, 'default')` требует второй аргумент

**Sanity _type:**
- В базе документы имеют `_type: "Post"` (не "blogPost")
- Filter должен использовать `"Post"`, не `"blogPost"`

**Обработка отсутствующих данных:**
- `urlFor()` падает на `undefined` - добавлены проверки
- `post.author.twitterUrl` может быть undefined
- `post.coverImage` может быть undefined

---

## Файлы проекта

### API Routes
- `/app/api/revalidate-path/route.ts` - webhook endpoint для Sanity
- `/app/api/revalidate/route.ts` - резервный endpoint

### Динамические страницы
- `/app/blog/[post]/page.tsx` - страница блог поста
- `/app/projects/[project]/page.tsx` - страница проекта

### Sanity
- `/sanity.config.ts` - конфигурация Sanity Studio
- `/lib/sanity.client.ts` - Sanity client
- `/lib/sanity.query.ts` - GROQ запросы
- `/schemas/` - схемы документов

---

**Последнее обновление:** 2026-02-09
