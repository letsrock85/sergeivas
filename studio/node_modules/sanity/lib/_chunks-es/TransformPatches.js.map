{"version":3,"file":"TransformPatches.js","sources":["../../src/core/changeIndicators/ConnectorContext.ts","../../src/core/components/react-track-elements/createStore.ts","../../src/core/components/react-track-elements/createUseReporter.tsx","../../src/core/components/react-track-elements/createTrackerScope.tsx","../../src/core/changeIndicators/constants.ts","../../src/core/changeIndicators/tracker.tsx","../../src/core/util/useUnique.ts","../../src/core/util/createHookFromObservableFactory.ts","../../src/core/util/isNonNullable.ts","../../src/core/util/draftUtils.ts","../../src/core/util/empty.ts","../../src/core/util/globalScope.ts","../../src/core/util/isRecord.ts","../../src/core/util/isString.ts","../../src/core/util/resizeObserver.ts","../../src/core/util/searchUtils.ts","../../src/core/util/supportsTouch.ts","../../src/core/util/unicodeString.ts","../../src/core/util/useLoadable.ts","../../src/core/util/userHasRole.ts","../../src/core/i18n/debug.ts","../../src/core/i18n/hooks/useTranslation.ts","../../src/core/changeIndicators/ElementWithChangeBar.styled.tsx","../../src/core/changeIndicators/ElementWithChangeBar.tsx","../../src/core/changeIndicators/ChangeIndicator.tsx","../../src/core/changeIndicators/ChangeIndicatorContext.ts","../../src/core/components/scroll/scrollContext.ts","../../src/core/components/scroll/scrollContainer.tsx","../../src/core/changeIndicators/overlay/ClampedRect.tsx","../../src/core/changeIndicators/overlay/Connector.styled.tsx","../../src/core/changeIndicators/overlay/connectorPath.ts","../../src/core/changeIndicators/overlay/mapConnectorToLine.ts","../../src/core/changeIndicators/overlay/Connector.tsx","../../src/core/changeIndicators/overlay/ConnectorsOverlay.styled.tsx","../../src/core/form/components/formField/styles.ts","../../src/core/components/commandList/CommandList.tsx","../../src/core/components/contextMenuButton/ContextMenuButton.tsx","../../src/core/studio/workspaces/helpers.ts","../../src/core/studio/workspaces/WorkspacesContext.ts","../../src/core/studio/workspaces/useWorkspaces.ts","../../src/core/studio/workspaces/WorkspaceValidationError.ts","../../src/core/studio/workspaces/validateWorkspaces.ts","../../src/core/config/components/useMiddlewareComponents.ts","../../src/core/config/ConfigPropertyError.ts","../../src/core/config/ConfigResolutionError.ts","../../src/core/config/document/fieldActions/reducer.ts","../../src/core/config/document/fieldActions/index.ts","../../src/core/config/flattenConfig.ts","../../src/core/components/loadingBlock/LoadingBlock.tsx","../../src/core/i18n/helpers.ts","../../src/core/i18n/localeNamespaces.ts","../../src/core/i18n/bundles/studio.ts","../../src/core/i18n/bundles/validation.ts","../../src/core/i18n/locales.ts","../../src/core/util/supportsLocalStorage.ts","../../src/core/i18n/localeStore.ts","../../src/core/i18n/components/LocaleProvider.tsx","../../src/core/i18n/hooks/useGetI18nText.ts","../../src/core/i18n/hooks/useI18nText.ts","../../src/core/i18n/intlCache.ts","../../src/core/hooks/useListFormat.ts","../../src/core/i18n/simpleParser.ts","../../src/core/i18n/Translate.tsx","../../src/core/studioClient.ts","../../src/core/field/types/file/diff/helpers.ts","../../src/core/store/key-value/backends/server.ts","../../src/core/store/key-value/KeyValueStore.ts","../../src/core/store/_legacy/cors/CorsOriginError.ts","../../src/core/store/_legacy/authStore/storage.ts","../../src/core/store/_legacy/authStore/createBroadcastChannel.ts","../../src/core/store/_legacy/authStore/providerLogos.tsx","../../src/core/store/_legacy/authStore/createLoginComponent.tsx","../../src/core/store/_legacy/authStore/sessionId.ts","../../src/core/store/_legacy/authStore/utils/asserters.ts","../../src/core/store/_legacy/authStore/createAuthStore.ts","../../src/core/store/_legacy/authStore/providerTitle.ts","../../src/core/store/_legacy/connection-status/utils/catchWithCount.ts","../../src/core/store/_legacy/connection-status/connection-status-store.ts","../../src/core/form/inputs/PortableText/_helpers.ts","../../src/core/field/paths/helpers.ts","../../src/core/field/diff/annotations/helpers.ts","../../src/core/user-color/context.ts","../../src/core/user-color/hooks.ts","../../src/core/user-color/manager.ts","../../src/core/user-color/provider.tsx","../../src/core/field/diff/annotations/hooks.ts","../../src/core/field/diff/components/DiffTooltip.tsx","../../src/core/field/diff/components/DiffCard.tsx","../../src/core/field/diff/components/ChangeTitleSegment.tsx","../../src/core/field/diff/components/ChangeBreadcrumb.tsx","../../src/core/field/conditional-property/utils.tsx","../../src/core/field/conditional-property/useConditionalProperty.tsx","../../src/core/field/schema/helpers.ts","../../src/core/field/types/portableText/diff/symbols.ts","../../src/core/field/types/portableText/diff/helpers.ts","../../src/core/util/getPrintableType.ts","../../src/core/field/validation/index.ts","../../src/core/field/diff/helpers.ts","../../src/core/field/TODO.ts","../../src/core/field/types/boolean/preview/BooleanPreview.tsx","../../src/core/field/types/boolean/diff/BooleanFieldDiff.tsx","../../src/core/field/types/datetime/preview/DatetimePreview.tsx","../../src/core/field/types/datetime/diff/DatetimeFieldDiff.tsx","../../src/core/field/diff/contexts/DocumentChangeContext.tsx","../../src/core/field/diff/hooks/useDocumentChange.ts","../../src/core/field/diff/hooks/useRefValue.ts","../../src/core/field/types/file/diff/FileFieldDiff.tsx","../../src/core/field/types/image/diff/helpers.ts","../../src/core/field/types/image/diff/HotspotCropSVG.tsx","../../src/core/field/types/image/diff/ImagePreview.tsx","../../src/core/field/types/image/diff/ImageFieldDiff.tsx","../../src/core/field/types/number/preview/NumberPreview.tsx","../../src/core/field/types/number/diff/NumberFieldDiff.tsx","../../src/core/field/types/portableText/diff/components/styledComponents.tsx","../../src/core/field/types/portableText/diff/components/Annotation.tsx","../../src/core/field/types/portableText/diff/components/Blockquote.tsx","../../src/core/field/types/portableText/diff/components/Header.tsx","../../src/core/field/types/portableText/diff/components/Paragraph.tsx","../../src/core/field/types/portableText/diff/components/Block.tsx","../../src/core/field/types/portableText/diff/components/Decorator.tsx","../../src/core/field/types/portableText/diff/components/InlineObject.tsx","../../src/core/field/types/portableText/diff/components/Text.tsx","../../src/core/field/types/portableText/diff/components/PortableText.tsx","../../src/core/field/types/portableText/diff/PTDiff.tsx","../../src/core/field/types/reference/preview/ReferencePreview.tsx","../../src/core/field/types/reference/diff/ReferenceFieldDiff.tsx","../../src/core/field/types/string/preview/StringPreview.tsx","../../src/core/field/types/string/diff/StringFieldDiff.tsx","../../src/core/field/diff/resolve/defaultComponents.ts","../../src/core/field/diff/resolve/resolveDiffComponent.ts","../../src/core/field/diff/changes/buildChangeList.ts","../../src/core/field/diff/changes/helpers.ts","../../src/core/field/diff/changes/undoChange.ts","../../src/core/field/diff/contexts/DiffContext.tsx","../../src/core/field/diff/components/ChangeList.styled.tsx","../../src/core/environment/index.ts","../../src/core/field/diff/components/DiffErrorBoundary.tsx","../../src/core/field/diff/components/FromToArrow.tsx","../../src/core/field/diff/components/DiffInspectWrapper.tsx","../../src/core/field/diff/hooks/useChangeVerb.ts","../../src/core/field/diff/components/FromTo.tsx","../../src/core/field/diff/components/DiffFromTo.tsx","../../src/core/field/diff/components/FallbackDiff.tsx","../../src/core/field/diff/components/FieldChange.styled.tsx","../../src/core/field/diff/components/RevertChangesButton.tsx","../../src/core/field/diff/components/ValueError.tsx","../../src/core/field/diff/components/FieldChange.tsx","../../src/core/field/utils/useHover.ts","../../src/core/field/diff/components/GroupChange.styled.tsx","../../src/core/field/diff/components/GroupChange.tsx","../../src/core/field/diff/components/ChangeResolver.tsx","../../src/core/field/diff/components/NoChanges.tsx","../../src/core/field/diff/components/ChangeList.tsx","../../src/core/field/diff/components/DiffString.tsx","../../src/core/field/diff/components/MetaInfo.tsx","../../src/core/field/types/slug/preview/SlugPreview.tsx","../../src/core/form/store/utils/immutableReconcile.ts","../../src/core/form/studio/contexts/Presence.tsx","../../src/core/form/FormBuilderContext.ts","../../src/core/form/useFormBuilder.ts","../../src/core/form/inputs/PortableText/_legacyDefaultParts/Markers.tsx","../../src/core/form/studio/contexts/Validation.tsx","../../src/core/form/inputs/PortableText/hooks/useMemberValidation.tsx","../../src/core/form/inputs/PortableText/contexts/PortableTextMarkers.tsx","../../src/core/form/inputs/PortableText/hooks/usePortableTextMarkers.tsx","../../src/core/form/field/actions/FieldActionMenuGroup.tsx","../../src/core/form/field/actions/FieldActionMenuItem.tsx","../../src/core/form/field/actions/FieldActionMenuNode.tsx","../../src/core/form/field/actions/FieldActionMenu.tsx","../../src/core/form/field/HoveredFieldContext.ts","../../src/core/form/field/useHoveredField.ts","../../src/core/form/field/actions/FieldActionsContext.ts","../../src/core/form/field/actions/FieldActionsProvider.tsx","../../src/core/form/field/actions/helpers.ts","../../src/core/form/field/actions/FieldActionsResolver.tsx","../../src/core/form/field/actions/useFieldActions.ts","../../src/core/presence/context.tsx","../../src/core/presence/DocumentPreviewPresence.tsx","../../src/core/components/userAvatar/UserAvatar.tsx","../../src/core/presence/constants.ts","../../src/core/presence/FieldPresence.styled.tsx","../../src/core/presence/overlay/tracker.ts","../../src/core/presence/PresenceTooltip.tsx","../../src/core/presence/utils.ts","../../src/core/presence/FieldPresence.tsx","../../src/core/presence/overlay/intersectionObserver.ts","../../src/core/presence/overlay/WithIntersection.tsx","../../src/core/presence/overlay/RegionsWithIntersections.styled.tsx","../../src/core/presence/overlay/RegionsWithIntersections.tsx","../../src/core/presence/overlay/StickyOverlay.tsx","../../src/core/presence/overlay/PresenceOverlay.tsx","../../src/core/form/components/formField/FormFieldBaseHeader.tsx","../../src/core/form/members/common/createDescriptionId.ts","../../src/core/form/components/formField/FormFieldValidationStatus.tsx","../../src/core/form/components/formField/FormFieldHeaderText.tsx","../../src/core/form/components/formField/FormField.tsx","../../src/core/form/components/formField/FormFieldSetLegend.tsx","../../src/core/form/components/formField/FormFieldSet.tsx","../../src/core/form/components/formField/FormFieldStatus.tsx","../../src/core/form/hooks/usePrevious.ts","../../src/core/form/hooks/useDidUpdate.ts","../../src/core/form/patch/patch.ts","../../src/core/form/patch/PatchEvent.ts","../../src/core/form/store/utils/isEmptyItem.ts","../../src/core/form/studio/contexts/FormCallbacks.tsx","../../src/core/form/utils/createProtoValue.ts","../../src/core/form/utils/randomKey.ts","../../src/core/form/utils/ensureKey.ts","../../src/core/form/members/common/resolveInitialArrayValues.ts","../../src/core/form/members/array/items/ArrayOfObjectsItem.tsx","../../src/core/form/members/array/IncompatibleItemType.tsx","../../src/core/form/members/array/MemberItemError.tsx","../../src/core/form/inputs/arrays/ArrayOfPrimitivesInput/getEmptyValue.ts","../../src/core/form/members/common/resolveNativeNumberInputValue.ts","../../src/core/form/members/array/items/ArrayOfPrimitivesItem.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/createProtoArrayValue.ts","../../src/core/form/patch/arrayInsert.ts","../../src/core/form/patch/array.ts","../../src/core/form/patch/object.ts","../../src/core/form/patch/primitive.ts","../../src/core/form/patch/string.ts","../../src/core/form/patch/applyPatch.ts","../../src/core/form/studio/contexts/DocumentFieldActions.tsx","../../src/core/form/utils/is.ts","../../src/core/form/studio/uploads/accepts.ts","../../src/core/form/studio/utils/withMaxConcurrency.ts","../../src/core/form/studio/inputs/client-adapters/assets.ts","../../src/core/form/studio/uploads/constants.ts","../../src/core/form/studio/uploads/utils.ts","../../src/core/form/studio/uploads/uploadFile.ts","../../src/core/form/studio/uploads/image/orient.ts","../../src/core/form/studio/uploads/image/readExif.ts","../../src/core/form/studio/uploads/image/rotateImage.ts","../../src/core/form/studio/uploads/uploadImage.ts","../../src/core/form/studio/uploads/uploaders.ts","../../src/core/form/studio/uploads/resolveUploader.ts","../../src/core/form/members/object/fields/ArrayOfObjectsField.tsx","../../src/core/form/studio/uploads/file/readAsText.ts","../../src/core/form/members/object/fields/ArrayOfPrimitivesField.tsx","../../src/core/form/members/object/fields/asserters.ts","../../src/core/form/members/object/fields/ObjectField.tsx","../../src/core/form/members/object/fields/PrimitiveField.tsx","../../src/core/form/members/object/MemberField.tsx","../../src/core/form/components/Alert.tsx","../../src/core/form/components/Details.tsx","../../src/core/form/inputs/InvalidValueInput/converters.ts","../../src/core/form/inputs/InvalidValueInput/UntypedValueInput.tsx","../../src/core/form/inputs/InvalidValueInput/InvalidValueInput.tsx","../../src/core/form/members/object/errors/DuplicateKeysAlert.tsx","../../src/core/form/members/object/errors/MissingKeysAlert.tsx","../../src/core/form/members/object/errors/MixedArrayAlert.tsx","../../src/core/form/members/object/MemberFieldError.tsx","../../src/core/form/members/object/MemberFieldset.tsx","../../src/core/form/members/object/ObjectInputMember.tsx","../../src/core/form/members/object/ObjectInputMembers.tsx","../../src/core/form/utils/asserters.ts","../../src/core/form/components/FormInput.tsx","../../src/core/form/inputs/PortableText/contexts/PortableTextMembers.tsx","../../src/core/form/inputs/PortableText/hooks/usePortableTextMembers.tsx","../../src/core/form/inputs/PortableText/object/Annotation.styles.ts","../../src/core/form/inputs/PortableText/object/AnnotationToolbarPopover.tsx","../../src/core/form/inputs/PortableText/object/helpers.ts","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/List/useVirtualizerScrollInstance.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/List/VirtualizerScrollInstanceProvider.tsx","../../src/core/form/inputs/PortableText/object/modals/DialogModal.tsx","../../src/core/form/inputs/PortableText/object/modals/PopoverModal.styles.ts","../../src/core/form/inputs/PortableText/object/modals/PopoverModal.tsx","../../src/core/form/inputs/PortableText/object/modals/ObjectEditModal.tsx","../../src/core/form/inputs/PortableText/object/Annotation.tsx","../../src/core/form/studio/contexts/ReferenceInputOptions.tsx","../../src/core/form/studio/contexts/reviewChanges/ReviewChangesContext.ts","../../src/core/form/contexts/DocumentIdProvider.tsx","../../src/core/form/hooks/useScrollIntoViewOnFocusWithin.ts","../../src/core/components/documentStatusIndicator/DocumentStatusIndicator.tsx","../../src/core/form/inputs/ReferenceInput/ReferencePreview.tsx","../../src/core/form/inputs/ReferenceInput/PreviewReferenceValue.tsx","../../src/core/form/components/AlertStrip.tsx","../../src/core/form/inputs/ReferenceInput/ReferenceFinalizeAlertStrip.tsx","../../src/core/form/inputs/ReferenceInput/ReferenceLinkCard.tsx","../../src/core/form/inputs/ReferenceInput/ReferenceMetadataLoadFailure.tsx","../../src/core/form/inputs/ReferenceInput/ReferenceStrengthMismatchAlertStrip.tsx","../../src/core/form/inputs/ReferenceInput/useReferenceInfo.ts","../../src/core/form/contexts/FormValue.tsx","../../src/core/search/common/deriveSearchWeightsFromType.ts","../../src/core/search/common/getSearchableTypes.ts","../../src/core/search/text-search/createTextSearch.ts","../../src/core/search/weighted/applyWeights.ts","../../src/core/search/constants.ts","../../src/core/search/weighted/createSearchQuery.ts","../../src/core/search/weighted/createWeightedSearch.ts","../../src/core/search/search.ts","../../src/core/form/studio/inputs/client-adapters/reference.ts","../../src/core/form/inputs/ReferenceInput/useReferenceInput.tsx","../../src/core/form/inputs/ReferenceInput/ReferenceField.tsx","../../src/core/form/studio/inputResolver/helpers.ts","../../src/core/form/studio/inputResolver/fieldResolver.tsx","../../src/core/studio/workspace.tsx","../../src/core/studio/components/navbar/search/hooks/useSearchMaxFieldDepth.ts","../../src/core/form/hooks/useOnClickOutside.ts","../../src/core/form/inputs/ReferenceInput/AutocompleteContainer.tsx","../../src/core/form/inputs/ReferenceInput/CreateButton.tsx","../../src/core/form/inputs/ReferenceInput/OptionPreview.tsx","../../src/core/form/inputs/ReferenceInput/ReferenceAutocomplete.tsx","../../src/core/form/inputs/ReferenceInput/useReferenceItemRef.ts","../../src/core/form/inputs/ReferenceInput/ReferenceInput.tsx","../../src/core/form/studio/inputs/reference/StudioReferenceInput.tsx","../../src/core/form/types/asserters.ts","../../src/core/form/inputs/arrays/common/dndkit-modifier/restrictToParentElementWithMargins.ts","../../src/core/form/inputs/arrays/common/DragHandle.tsx","../../src/core/form/inputs/arrays/common/list.tsx","../../src/core/form/components/withFocusRing/helpers.ts","../../src/core/form/components/withFocusRing/withFocusRing.ts","../../src/core/form/inputs/common/fileTarget/utils/extractFiles.ts","../../src/core/form/inputs/common/fileTarget/utils/imageUrlToBlob.ts","../../src/core/form/inputs/common/fileTarget/fileTarget.tsx","../../src/core/form/inputs/files/common/DropMessage.tsx","../../src/core/form/inputs/arrays/common/uploadTarget/styles.ts","../../src/core/form/inputs/arrays/common/uploadTarget/uploadTarget.tsx","../../src/core/form/inputs/arrays/common/UploadTargetCard.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/ArrayOfObjectsFunctions.tsx","../../src/core/form/inputs/arrays/layouts/CellLayout.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/Grid/IncompatibleItemType.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/Grid/ErrorItem.tsx","../../src/core/validation/util/pathToString.ts","../../src/core/validation/util/convertToValidationMarker.ts","../../src/core/validation/util/escapeRegex.ts","../../src/core/validation/util/localizeMessage.ts","../../src/core/validation/util/deepEquals.ts","../../src/core/validation/util/typeString.ts","../../src/core/validation/validators/genericValidator.ts","../../src/core/validation/validators/arrayValidator.ts","../../src/core/validation/validators/booleanValidator.ts","../../src/core/validation/validators/dateValidator.ts","../../src/core/validation/validators/numberValidator.ts","../../src/core/validation/validators/objectValidator.ts","../../src/core/validation/validators/stringValidator.ts","../../src/core/validation/Rule.ts","../../src/core/validation/validators/slugValidator.ts","../../src/core/validation/util/normalizeValidationRules.ts","../../src/core/validation/inferFromSchemaType.ts","../../src/core/validation/inferFromSchema.ts","../../src/core/i18n/fallback.ts","../../src/core/validation/util/createBatchedGetDocumentExists.ts","../../src/core/validation/util/requestIdleCallback.ts","../../src/core/validation/validators/unknownFieldsValidator.ts","../../src/core/validation/validateDocument.ts","../../src/core/schema/types/assetSourceData.ts","../../src/core/schema/types/fileAsset.ts","../../src/core/schema/types/geopoint.ts","../../src/core/schema/types/imageAsset.ts","../../src/core/schema/types/imageCrop.ts","../../src/core/schema/types/imageDimensions.ts","../../src/core/schema/types/imageHotspot.ts","../../src/core/schema/types/imageMetadata.ts","../../src/core/schema/types/imagePalette.ts","../../src/core/schema/types/imagePaletteSwatch.ts","../../src/core/schema/types/slug.ts","../../src/core/schema/createSchema.ts","../../src/core/schema/helpers.ts","../../src/core/form/components/EditPortal.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/InsertMenu.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/Grid/GridItem.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/Grid/GridArrayInput.tsx","../../src/core/form/inputs/arrays/layouts/RowLayout.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/List/IncompatibleItemType.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/List/ErrorItem.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/List/useMemoCompare.ts","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/List/ListArrayInput.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/ArrayOfObjectsInput.tsx","../../src/core/form/inputs/arrays/ArrayOfOptionsInput/ArrayOfObjectOptionsInput.tsx","../../src/core/form/inputs/arrays/ArrayOfOptionsInput/ArrayOfPrimitiveOptionsInput.tsx","../../src/core/form/inputs/arrays/ArrayOfOptionsInput/ArrayOfOptionsInput.tsx","../../src/core/form/inputs/arrays/ArrayOfPrimitivesInput/ArrayOfPrimitivesFunctions.tsx","../../src/core/form/inputs/arrays/ArrayOfPrimitivesInput/ItemRow.tsx","../../src/core/form/inputs/arrays/ArrayOfPrimitivesInput/NoItemsPlaceholder.tsx","../../src/core/form/inputs/arrays/ArrayOfPrimitivesInput/utils/nearestIndex.ts","../../src/core/form/inputs/arrays/ArrayOfPrimitivesInput/ArrayOfPrimitivesInput.tsx","../../src/core/form/inputs/arrays/UniversalArrayInput.tsx","../../src/core/form/inputs/BooleanInput.tsx","../../src/core/form/inputs/DateInputs/base/DateTimeInput.tsx","../../src/core/form/inputs/DateInputs/CommonDateTimeInput.tsx","../../src/core/form/inputs/DateInputs/DateInput.tsx","../../src/core/form/inputs/DateInputs/DateTimeInput.tsx","../../src/core/form/inputs/EmailInput.tsx","../../src/core/form/utils/getValidationRule.ts","../../src/core/form/inputs/NumberInput.tsx","../../src/core/form/inputs/ObjectInput/fieldGroups/GroupTab.tsx","../../src/core/form/inputs/ObjectInput/fieldGroups/FieldGroupTabs.tsx","../../src/core/form/inputs/ObjectInput/ObjectInput.styled.tsx","../../src/core/form/inputs/ObjectInput/UnknownFields.tsx","../../src/core/form/inputs/ObjectInput/ObjectInput.tsx","../../src/core/form/contexts/GetFormValue.tsx","../../src/core/form/inputs/Slug/utils/slugify.ts","../../src/core/form/inputs/Slug/utils/useAsync.tsx","../../src/core/form/inputs/Slug/utils/useSlugContext.ts","../../src/core/form/inputs/Slug/SlugInput.tsx","../../src/core/form/inputs/StringInput.tsx","../../src/core/form/inputs/TextInput.tsx","../../src/core/form/inputs/UrlInput.tsx","../../src/core/form/inputs/CrossDatasetReferenceInput/DisabledFeatureWarning.tsx","../../src/core/form/inputs/CrossDatasetReferenceInput/CrossDatasetReferencePreview.styled.tsx","../../src/core/form/inputs/CrossDatasetReferenceInput/CrossDatasetReferencePreview.tsx","../../src/core/form/inputs/CrossDatasetReferenceInput/useReferenceInfo.ts","../../src/core/form/inputs/CrossDatasetReferenceInput/utils/useProjectId.ts","../../src/core/form/inputs/CrossDatasetReferenceInput/OptionPreview.tsx","../../src/core/form/inputs/CrossDatasetReferenceInput/PreviewReferenceValue.tsx","../../src/core/form/inputs/CrossDatasetReferenceInput/ReferenceAutocomplete.tsx","../../src/core/form/inputs/CrossDatasetReferenceInput/CrossDatasetReferenceInput.tsx","../../src/core/form/studio/inputs/crossDatasetReference/datastores/getReferenceInfo.ts","../../src/core/form/studio/inputs/crossDatasetReference/datastores/search.ts","../../src/core/form/studio/inputs/crossDatasetReference/StudioCrossDatasetReferenceInput.tsx","../../src/core/form/utils/WithReferencedAsset.tsx","../../src/core/form/inputs/files/common/FileInputMenuItem/FileInputMenuItem.styled.tsx","../../src/core/form/inputs/files/common/FileInputMenuItem/FileInputMenuItem.tsx","../../src/core/form/inputs/files/common/ActionsMenu.tsx","../../src/core/form/inputs/files/ImageInput/utils/image.ts","../../src/core/form/inputs/files/common/assetSource.ts","../../src/core/form/inputs/files/common/PlaceholderText.tsx","../../src/core/form/inputs/files/common/styles.ts","../../src/core/form/inputs/files/common/FileInputButton/styles.ts","../../src/core/form/inputs/files/common/FileInputButton/FileInputButton.tsx","../../src/core/form/inputs/files/common/UploadPlaceholder.tsx","../../src/core/form/inputs/files/constants.ts","../../src/core/form/inputs/files/common/UploadProgress.styled.tsx","../../src/core/form/inputs/files/common/UploadProgress.tsx","../../src/core/form/inputs/files/common/UploadWarning.tsx","../../src/core/form/inputs/common/helper.ts","../../src/core/form/inputs/files/FileInput/FileActionsMenu.tsx","../../src/core/form/inputs/files/FileInput/FileSkeleton.tsx","../../src/core/form/inputs/files/FileInput/InvalidFileWarning.tsx","../../src/core/form/inputs/files/FileInput/styles.ts","../../src/core/form/inputs/files/FileInput/FileInput.tsx","../../src/core/form/studio/inputs/StudioFileInput.tsx","../../src/core/form/inputs/files/common/RatioBox.tsx","../../src/core/form/inputs/files/ImageToolInput/imagetool/constants.ts","../../src/core/form/inputs/files/ImageToolInput/imagetool/calculateStyles.ts","../../src/core/form/inputs/files/ImageToolInput/imagetool/HotspotImage.styles.tsx","../../src/core/form/inputs/files/ImageToolInput/imagetool/HotspotImage.tsx","../../src/core/form/inputs/files/ImageToolInput/imagetool/ImageLoader.tsx","../../src/core/form/inputs/files/ImageToolInput/imagetool/Resize.tsx","../../src/core/form/inputs/files/ImageToolInput/imagetool/2d/shapes.ts","../../src/core/form/inputs/files/ImageToolInput/imagetool/2d/utils.ts","../../src/core/form/inputs/files/ImageToolInput/imagetool/cursors.ts","../../src/core/form/inputs/files/ImageToolInput/imagetool/getBackingStoreRatio.ts","../../src/core/form/inputs/files/ImageToolInput/imagetool/makeDragAware.tsx","../../src/core/form/inputs/files/ImageToolInput/imagetool/ToolCanvas.styles.tsx","../../src/core/form/inputs/files/ImageToolInput/imagetool/ToolCanvas.tsx","../../src/core/form/inputs/files/ImageToolInput/imagetool/ImageTool.tsx","../../src/core/form/inputs/files/ImageToolInput/useLoadImage.ts","../../src/core/form/inputs/files/ImageToolInput/ImageToolInput.tsx","../../src/core/form/inputs/files/ImageInput/ImageActionsMenu.tsx","../../src/core/form/inputs/files/ImageInput/ImagePreview.styled.tsx","../../src/core/form/inputs/files/ImageInput/ImagePreview.tsx","../../src/core/form/inputs/files/ImageInput/InvalidImageWarning.tsx","../../src/core/form/inputs/files/ImageInput/ImageInput.tsx","../../src/core/form/studio/inputs/StudioImageInput.tsx","../../src/core/form/studio/inputResolver/defaultInputs.ts","../../src/core/form/__telemetry__/form.telemetry.ts","../../src/core/form/components/ActivateOnFocus/ActivateOnFocus.styles.tsx","../../src/core/form/components/ActivateOnFocus/ActivateOnFocus.tsx","../../src/core/form/inputs/PortableText/Compositor.styles.tsx","../../src/core/form/inputs/PortableText/text/constants.ts","../../src/core/form/inputs/PortableText/text/Decorator.tsx","../../src/core/form/inputs/PortableText/text/helpers.ts","../../src/core/form/inputs/PortableText/_common/ReviewChangesHighlightBlock.tsx","../../src/core/form/inputs/PortableText/_common/StyledChangeIndicatorWithProvidedFullPath.tsx","../../src/core/form/inputs/PortableText/callbacks/insertCallback.ts","../../src/core/form/inputs/PortableText/callbacks/setCallback.ts","../../src/core/form/inputs/PortableText/callbacks/unsetCallback.ts","../../src/core/form/inputs/PortableText/BlockActions.tsx","../../src/core/form/inputs/PortableText/text/TextBlock.styles.ts","../../src/core/form/inputs/PortableText/text/textStyles.tsx","../../src/core/form/inputs/PortableText/text/TextBlock.tsx","../../src/core/form/inputs/PortableText/Editor.styles.tsx","../../src/core/form/inputs/PortableText/hooks/useScrollSelectionIntoView.tsx","../../src/core/form/inputs/PortableText/hooks/useSpellCheck.tsx","../../src/core/form/inputs/PortableText/text/ListItem.tsx","../../src/core/form/inputs/PortableText/text/Style.tsx","../../src/core/components/collapseMenu/CollapseMenuDivider.tsx","../../src/core/components/collapseMenu/CollapseOverflowMenu.tsx","../../src/core/components/collapseMenu/ObserveElement.tsx","../../src/core/components/collapseMenu/CollapseMenu.tsx","../../src/core/components/collapseMenu/CollapseMenuButton.tsx","../../src/core/form/inputs/PortableText/toolbar/CustomIcon.tsx","../../src/core/form/inputs/PortableText/toolbar/helpers.tsx","../../src/core/form/inputs/PortableText/toolbar/hooks.ts","../../src/core/form/inputs/PortableText/toolbar/ActionMenu.tsx","../../src/core/form/inputs/PortableText/toolbar/BlockStyleSelect.tsx","../../src/core/form/inputs/PortableText/toolbar/InsertMenu.tsx","../../src/core/form/inputs/PortableText/toolbar/Toolbar.tsx","../../src/core/form/inputs/PortableText/Editor.tsx","../../src/core/form/inputs/PortableText/hooks/useHotKeys.tsx","../../src/core/form/inputs/PortableText/hooks/useTrackFocusPath.tsx","../../src/core/form/inputs/PortableText/object/InlineObject.styles.ts","../../src/core/form/inputs/PortableText/object/InlineObjectToolbarPopover.tsx","../../src/core/form/inputs/PortableText/object/InlineObject.tsx","../../src/core/form/inputs/PortableText/Compositor.tsx","../../src/core/form/inputs/PortableText/InvalidValue.tsx","../../src/core/form/inputs/PortableText/usePatches.ts","../../src/core/form/inputs/PortableText/PortableTextInput.tsx","../../src/core/form/components/tagInput/styles.ts","../../src/core/form/components/tagInput/tagInput.tsx","../../src/core/form/inputs/TagsArrayInput.tsx","../../src/core/form/studio/inputResolver/resolveArrayInput.ts","../../src/core/form/inputs/SelectInput.tsx","../../src/core/form/studio/inputResolver/resolveNumberInput.ts","../../src/core/form/studio/inputResolver/resolveStringInput.ts","../../src/core/form/studio/inputResolver/inputResolver.tsx","../../src/core/form/inputs/arrays/ArrayOfObjectsInput/List/PreviewItem.tsx","../../src/core/form/inputs/ReferenceInput/ReferenceItemRefProvider.tsx","../../src/core/form/inputs/ReferenceInput/ReferenceItem.tsx","../../src/core/form/studio/inputResolver/itemResolver.tsx","../../src/core/preview/useValuePreview.ts","../../src/core/preview/streams/orientationChange.ts","../../src/core/preview/streams/resize.ts","../../src/core/preview/streams/scroll.ts","../../src/core/preview/streams/intersectionObservableFor.ts","../../src/core/preview/streams/visibilityChange.ts","../../src/core/preview/useVisibility.ts","../../src/core/preview/components/_constants.ts","../../src/core/preview/components/_extractUploadState.ts","../../src/core/preview/components/PreviewLoader.tsx","../../src/core/form/inputs/PortableText/object/BlockObject.styles.ts","../../src/core/form/inputs/PortableText/object/BlockObjectActionsMenu.tsx","../../src/core/form/inputs/PortableText/object/BlockObject.tsx","../../src/core/form/studio/inputResolver/blockResolver.tsx","../../src/core/form/form-components-hooks/components.ts","../../src/core/form/form-components-hooks/picks.ts","../../src/core/form/form-components-hooks/componentHooks.ts","../../src/core/preview/components/Preview.tsx","../../src/core/preview/components/_previewComponents.ts","../../src/core/preview/components/SanityDefaultPreview.tsx","../../src/core/preview/constants.tsx","../../src/core/preview/utils/debounceCollect.ts","../../src/core/preview/availability.ts","../../src/core/preview/utils/keysOf.ts","../../src/core/preview/utils/props.ts","../../src/core/preview/createPathObserver.ts","../../src/core/preview/utils/getPreviewPaths.ts","../../src/core/preview/utils/portableText.ts","../../src/core/preview/utils/prepareForPreview.ts","../../src/core/preview/createPreviewObserver.ts","../../src/core/preview/documentPair.ts","../../src/core/preview/utils/hasEqualFields.ts","../../src/core/preview/utils/isUniqueBy.ts","../../src/core/preview/utils/optimizeQuery.ts","../../src/core/preview/observeFields.ts","../../src/core/preview/documentPreviewStore.ts","../../src/core/preview/utils/getPreviewStateObservable.ts","../../src/core/preview/utils/getPreviewValueWithFallback.tsx","../../src/core/store/user/hooks.ts","../../src/core/store/_legacy/document/buffered-doc/createObservableBufferedDocument.ts","../../src/core/store/_legacy/document/buffered-doc/createBufferedDocument.ts","../../src/core/store/_legacy/document/getPairListener.ts","../../src/core/store/_legacy/document/document-pair/checkoutPair.ts","../../src/core/store/_legacy/document/utils/createMemoizer.ts","../../src/core/store/_legacy/document/document-pair/memoizeKeyGen.ts","../../src/core/store/_legacy/document/document-pair/memoizedPair.ts","../../src/core/store/_legacy/document/document-pair/snapshotPair.ts","../../src/core/store/_legacy/document/document-pair/utils/isLiveEditEnabled.ts","../../src/core/store/_legacy/document/document-pair/editState.ts","../../src/core/store/_legacy/document/document-pair/consistencyStatus.ts","../../src/core/store/_legacy/document/document-pair/operationArgs.ts","../../src/core/store/_legacy/document/document-pair/operations/commit.ts","../../src/core/store/_legacy/document/document-pair/operations/delete.ts","../../src/core/store/_legacy/document/document-pair/operations/discardChanges.ts","../../src/core/store/_legacy/document/document-pair/operations/duplicate.ts","../../src/core/store/_legacy/document/document-pair/operations/patch.ts","../../src/core/store/_legacy/document/document-pair/operations/publish.ts","../../src/core/store/_legacy/document/document-pair/operations/restore.ts","../../src/core/store/_legacy/document/document-pair/operations/unpublish.ts","../../src/core/store/_legacy/document/document-pair/operationEvents.ts","../../src/core/store/_legacy/document/document-pair/validation.ts","../../src/core/store/_legacy/document/document-pair/documentEvents.ts","../../src/core/store/_legacy/document/document-pair/operations/helpers.ts","../../src/core/store/_legacy/document/document-pair/editOperations.ts","../../src/core/templates/util/isRecord.ts","../../src/core/templates/util/deepAssign.ts","../../src/core/templates/validate.ts","../../src/core/templates/resolve.ts","../../src/core/store/_legacy/document/initialValue/initialValue.ts","../../src/core/store/_legacy/document/listenQuery.ts","../../src/core/store/_legacy/document/resolveTypeForDocument.ts","../../src/core/store/_legacy/document/document-store.ts","../../src/core/store/_legacy/document/hooks/useDocumentValues.ts","../../src/core/store/_legacy/document/useInitialValue.ts","../../src/core/store/_legacy/document/useResolveInitialValueForType.ts","../../src/core/store/_legacy/grants/documentPairPermissions.ts","../../src/core/store/_legacy/grants/documentValuePermissions.ts","../../src/core/store/_legacy/debugParams/debugParams.ts","../../src/core/store/_legacy/grants/debug/exampleGrants.ts","../../src/core/store/_legacy/grants/debug/roleGrants.ts","../../src/core/store/_legacy/grants/grantsStore.ts","../../src/core/store/_legacy/grants/templatePermissions.ts","../../src/core/store/_legacy/history/history/chunker.ts","../../src/core/store/_legacy/history/history/utils.ts","../../src/core/store/_legacy/history/history/diffValue.ts","../../src/core/store/_legacy/history/history/TwoEndedArray.ts","../../src/core/store/_legacy/history/history/Timeline.ts","../../src/core/store/_legacy/history/history/Aligner.ts","../../src/core/store/_legacy/history/history/Reconstruction.ts","../../src/core/store/_legacy/history/history/TimelineController.ts","../../src/core/store/_legacy/history/createHistoryStore.ts","../../src/core/store/_legacy/presence/message-transports/bifurTransport.ts","../../src/core/store/_legacy/presence/mock-events.ts","../../src/core/store/_legacy/presence/presence-store.ts","../../src/core/store/_legacy/project/projectStore.ts","../../src/core/store/_legacy/createMultiKeyWeakMap.ts","../../src/core/store/_legacy/ResourceCacheProvider.tsx","../../src/core/store/_legacy/user/userStore.ts","../../src/core/store/_legacy/datastores.ts","../../src/core/store/_legacy/presence/useDocumentPresence.tsx","../../src/core/store/_legacy/presence/useGlobalPresence.tsx","../../src/core/hooks/useReferringDocuments.ts","../../src/core/form/studio/assetSource/shared/AssetUsageList.tsx","../../src/core/form/studio/assetSource/shared/ConfirmMessage.tsx","../../src/core/form/studio/assetSource/shared/AssetDeleteDialog.tsx","../../src/core/form/studio/assetSource/shared/AssetMenu.tsx","../../src/core/form/studio/assetSource/shared/AssetUsageDialog.tsx","../../src/core/form/studio/assetSource/utils/mimeType.ts","../../src/core/form/studio/assetSource/file/AssetRow.tsx","../../src/core/form/studio/assetSource/file/FileListView.tsx","../../src/core/form/studio/assetSource/image/AssetThumb.tsx","../../src/core/form/studio/assetSource/image/ImageListView.tsx","../../src/core/form/studio/assetSource/shared/DefaultSource.tsx","../../src/core/form/studio/assetSource/FileAssetSource.ts","../../src/core/form/studio/assetSource/ImageAssetSource.tsx","../../src/core/config/configPropertyReducers.ts","../../src/core/config/resolveConfigProperty.ts","../../src/core/i18n/backend.ts","../../src/core/i18n/i18nConfig.ts","../../src/core/studio/components/navbar/search/definitions/filters.ts","../../src/core/studio/components/navbar/search/definitions/defaultFilters.ts","../../src/core/hooks/useDateTimeFormat.ts","../../src/core/hooks/useUnitFormatter.ts","../../src/core/studio/components/navbar/search/components/filters/common/ReferencePreviewTitle.tsx","../../src/core/studio/components/navbar/search/components/filters/common/ButtonValue.tsx","../../src/core/studio/components/navbar/search/contexts/search/SearchContext.ts","../../src/core/studio/components/navbar/search/contexts/search/useSearchState.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/number/Number.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/number/NumberRange.tsx","../../src/core/studio/components/navbar/search/utils/getSchemaField.ts","../../src/core/studio/components/navbar/search/components/searchResults/item/SearchResultItemPreview.tsx","../../src/core/studio/components/navbar/search/components/searchResults/item/SearchResultItem.tsx","../../src/core/studio/components/navbar/search/constants.ts","../../src/core/studio/components/navbar/search/utils/hasSearchableTerms.ts","../../src/core/studio/components/navbar/search/utils/selectors.ts","../../src/core/studio/components/navbar/search/hooks/useSearch.ts","../../src/core/studio/components/navbar/search/utils/documentTypesTruncated.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/reference/ReferenceAutocomplete.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/reference/Reference.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/string/StringList.tsx","../../src/core/studio/components/navbar/search/components/filters/icons/GteIcon.tsx","../../src/core/studio/components/navbar/search/components/filters/icons/GtIcon.tsx","../../src/core/studio/components/navbar/search/components/filters/icons/LteIcon.tsx","../../src/core/studio/components/navbar/search/components/filters/icons/LtIcon.tsx","../../src/core/studio/components/navbar/search/definitions/operators/operatorTypes.ts","../../src/core/studio/components/navbar/search/definitions/operators/operatorUtils.ts","../../src/core/studio/components/navbar/search/definitions/operators/arrayOperators.ts","../../src/core/studio/source.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/asset/AssetSourceError.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/asset/preview/FileReferencePreview.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/asset/preview/ImageReferencePreview.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/asset/preview/AssetPreview.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/asset/Asset.tsx","../../src/core/studio/components/navbar/search/definitions/operators/assetOperators.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/boolean/Boolean.tsx","../../src/core/studio/components/navbar/search/definitions/operators/booleanOperators.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/dateIncludeTimeFooter/DateIncludeTimeFooter.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/datePicker/calendar/contexts/CalendarContext.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/datePicker/calendar/contexts/useDatePicker.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/datePicker/calendar/CalendarHeader.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/datePicker/calendar/CalendarDay.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/datePicker/calendar/constants.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/datePicker/calendar/utils.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/datePicker/calendar/CalendarMonth.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/datePicker/calendar/Calendar.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/datePicker/DatePicker.tsx","../../src/core/studio/components/navbar/search/components/common/CustomTextInputBox.tsx","../../src/core/studio/components/navbar/search/components/common/CustomTextInput.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/utils/getDateISOString.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/ParsedDateTextInput.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/CommonDateDirection.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/DateAfter.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/DateBefore.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/CommonDateEqual.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/DateEqual.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/DateLast.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/CommonDateRange.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/DateRange.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/DateTimeAfter.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/DateTimeBefore.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/DateTimeEqual.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/date/DateTimeRange.tsx","../../src/core/studio/components/navbar/search/definitions/operators/dateOperators.ts","../../src/core/studio/components/navbar/search/definitions/operators/definedOperators.ts","../../src/core/studio/components/navbar/search/definitions/operators/numberOperators.ts","../../src/core/studio/components/navbar/search/components/filters/filter/inputs/string/String.tsx","../../src/core/studio/components/navbar/search/definitions/operators/portableTextOperators.ts","../../src/core/studio/components/navbar/search/definitions/operators/referenceOperators.ts","../../src/core/studio/components/navbar/search/definitions/operators/slugOperators.ts","../../src/core/studio/components/navbar/search/definitions/operators/stringOperators.ts","../../src/core/studio/components/navbar/search/definitions/operators/defaultOperators.ts","../../src/core/config/createDefaultIcon.tsx","../../src/core/config/resolveSchemaTypes.ts","../../src/core/config/SchemaError.ts","../../src/core/config/prepareConfig.ts","../../src/core/studio/workspaces/WorkspacesProvider.tsx","../../src/core/studio/router/RouterHistoryContext.tsx","../../src/core/studio/activeWorkspaceMatcher/ActiveWorkspaceMatcherContext.ts","../../src/core/studio/activeWorkspaceMatcher/ActiveWorkspaceMatcherProvider.tsx","../../src/core/studio/activeWorkspaceMatcher/createCommonBasePathRegex.ts","../../src/core/studio/activeWorkspaceMatcher/matchWorkspace.ts","../../src/core/studio/activeWorkspaceMatcher/useNormalizedWorkspaces.ts","../../src/core/studio/activeWorkspaceMatcher/useSyncPathnameWithWorkspace.ts","../../src/core/studio/activeWorkspaceMatcher/ActiveWorkspaceMatcher.tsx","../../src/core/studio/activeWorkspaceMatcher/useActiveWorkspace.ts","../../src/core/studio/addonDataset/AddonDatasetContext.ts","../../src/core/studio/colorScheme.tsx","../../src/core/studio/components/navbar/search/hooks/useSearchHotkeys.ts","../../src/core/studio/components/navbar/search/components/common/SearchWrapper.tsx","../../src/core/studio/components/navbar/search/definitions/operators/index.ts","../../src/core/studio/components/navbar/search/utils/filterUtils.ts","../../src/core/studio/components/navbar/search/components/filters/common/FilterPopoverWrapper.tsx","../../src/core/studio/components/navbar/search/components/filters/common/FilterPopoverContentHeader.tsx","../../src/core/studio/components/navbar/search/components/filters/addFilter/createFilterMenuItems.ts","../../src/core/studio/components/navbar/search/components/common/FilterTitle.tsx","../../src/core/studio/components/navbar/search/components/filters/common/FilterIcon.tsx","../../src/core/studio/components/navbar/search/components/filters/common/FilterDetails.tsx","../../src/core/studio/components/navbar/search/utils/sanitizeField.ts","../../src/core/studio/components/navbar/search/components/filters/addFilter/items/FilterTooltip.tsx","../../src/core/studio/components/navbar/search/components/filters/addFilter/items/MenuItemFilter.tsx","../../src/core/studio/components/navbar/search/components/filters/addFilter/items/MenuItemHeader.tsx","../../src/core/studio/components/navbar/search/components/filters/addFilter/AddFilterPopoverContent.tsx","../../src/core/studio/components/navbar/search/components/filters/addFilter/AddFilterButton.tsx","../../src/core/studio/components/navbar/search/components/filters/documentTypes/items/DocumentTypeFilterItem.tsx","../../src/core/studio/components/navbar/search/components/filters/documentTypes/DocumentTypesPopoverContent.tsx","../../src/core/studio/components/navbar/search/components/filters/documentTypes/DocumentTypesButton.tsx","../../src/core/studio/components/navbar/search/components/common/FilterLabel.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/FilterError.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/OperatorsMenuButton.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/FilterForm.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/FilterPopoverContent.tsx","../../src/core/studio/components/navbar/search/components/filters/filter/FilterButton.tsx","../../src/core/studio/components/navbar/search/components/filters/Filters.tsx","../../src/core/studio/components/navbar/search/definitions/fields.ts","../../src/core/studio/components/navbar/search/datastores/useStoredSearch.ts","../../src/core/studio/components/navbar/search/datastores/recentSearches.ts","../../src/core/studio/components/navbar/search/components/Instructions.tsx","../../src/core/studio/components/navbar/search/components/common/DocumentTypesPill.tsx","../../src/core/studio/components/navbar/search/components/common/FilterPill.tsx","../../src/core/studio/components/navbar/search/components/recentSearches/item/RecentSearchItem.tsx","../../src/core/studio/components/navbar/search/components/recentSearches/RecentSearches.tsx","../../src/core/studio/components/navbar/search/components/SearchHeader.tsx","../../src/core/studio/components/navbar/search/components/NoResults.tsx","../../src/core/components/textWithTone/TextWithTone.tsx","../../src/core/studio/components/navbar/search/components/SearchError.tsx","../../src/core/studio/components/navbar/search/definitions/orderings.ts","../../src/core/studio/components/navbar/search/components/SortMenu.tsx","../../src/core/studio/components/navbar/search/components/searchResults/item/DebugOverlay.tsx","../../src/core/studio/components/navbar/search/components/searchResults/SearchResults.tsx","../../src/core/studio/components/navbar/search/components/SearchPopover.tsx","../../src/core/studio/components/navbar/search/utils/isRecentSearchTerms.ts","../../src/core/studio/components/navbar/search/utils/debug.ts","../../src/core/studio/components/navbar/search/contexts/search/reducer.ts","../../src/core/studio/components/navbar/search/contexts/search/SearchProvider.tsx","../../src/core/studio/components/navbar/search/SearchButton.tsx","../../src/core/studio/components/navbar/search/SearchDialog.tsx","../../src/core/studio/components/navbar/StudioActiveToolLayout.tsx","../../src/core/studio/screens/NoToolsScreen.tsx","../../src/core/studio/screens/RedirectingScreen.tsx","../../src/core/studio/screens/ToolNotFoundScreen.tsx","../../src/core/studio/components/navbar/workspace/constants.ts","../../src/core/studio/components/navbar/workspace/hooks/useWorkspaceAuthStates.ts","../../src/core/studio/components/navbar/workspace/WorkspacePreview.tsx","../../src/core/studio/components/navbar/workspace/WorkspaceAuth/Layout.tsx","../../src/core/studio/components/navbar/workspace/WorkspaceAuth/WorkspaceAuth.tsx","../../src/core/studio/components/navbar/workspace/WorkspaceMenuButton.tsx","../../src/core/studio/screens/AuthenticateScreen.tsx","../../src/core/studio/screens/ConfigErrorsScreen.tsx","../../src/core/studio/screens/CorsOriginErrorScreen.tsx","../../src/core/studio/screens/NotAuthenticatedScreen.tsx","../../src/core/studio/screens/NotFoundScreen.tsx","../../src/core/studio/screens/schemaErrors/utils.ts","../../src/core/studio/screens/schemaErrors/reportWarnings.ts","../../src/core/studio/screens/schemaErrors/SchemaProblemGroups.tsx","../../src/core/studio/screens/schemaErrors/SchemaErrorsScreen.tsx","../../src/core/studio/StudioErrorBoundary.tsx","../../src/core/studio/StudioLayout.tsx","../../src/core/studio/studio-components-hooks/picks.ts","../../src/core/studio/studio-components-hooks/componentHooks.ts","../../src/core/studio/components/navbar/configIssues/ConfigIssuesButton.tsx","../../src/core/studio/components/navbar/free-trial/__telemetry__/trialDialogEvents.telemetry.ts","../../src/core/studio/upsell/__telemetry__/upsell.telemetry.ts","../../src/core/studio/upsell/upsellDescriptionSerializer/helpers.ts","../../src/core/studio/upsell/upsellDescriptionSerializer/UpsellDescriptionSerializer.tsx","../../src/core/studio/components/navbar/free-trial/DialogContent.tsx","../../src/core/studio/components/navbar/free-trial/FreeTrialButton.tsx","../../src/core/studio/components/navbar/free-trial/FreeTrialContext.tsx","../../src/core/studio/components/navbar/free-trial/PopoverContent.tsx","../../src/core/studio/components/navbar/free-trial/FreeTrial.tsx","../../src/core/version.ts","../../src/core/studio/components/navbar/free-trial/FreeTrialProvider.tsx","../../src/core/studio/components/navbar/SanityLogo.tsx","../../src/core/studio/components/navbar/home/HomeButton.tsx","../../src/core/studio/components/navbar/navDrawer/ApperanceMenu.tsx","../../src/core/studio/components/navbar/navDrawer/LocaleMenu.tsx","../../src/core/studio/components/navbar/navDrawer/ManageMenu.tsx","../../src/core/studio/components/navbar/navDrawer/NavDrawer.tsx","../../src/core/studio/components/navbar/new-document/filter.ts","../../src/core/studio/components/navbar/new-document/NewDocumentButton.style.ts","../../src/core/studio/components/navbar/new-document/NewDocumentListOption.tsx","../../src/core/studio/components/navbar/new-document/NewDocumentList.tsx","../../src/core/studio/components/navbar/new-document/NewDocumentButton.tsx","../../src/core/studio/components/navbar/new-document/useNewDocumentOptions.ts","../../src/core/studio/components/navbar/presence/PresenceMenuItem.tsx","../../src/core/studio/components/navbar/presence/PresenceMenu.tsx","../../src/core/studio/components/navbar/resources/helper-functions/helpResources.ts","../../src/core/studio/components/navbar/resources/helper-functions/hooks.ts","../../src/core/studio/components/navbar/resources/ResourcesMenuItems.tsx","../../src/core/studio/components/navbar/resources/ResourcesButton.tsx","../../src/core/studio/components/navbar/userMenu/LocaleMenu.tsx","../../src/core/studio/components/navbar/userMenu/ApperanceMenu.tsx","../../src/core/studio/components/navbar/userMenu/LoginProviderLogo.tsx","../../src/core/studio/components/navbar/userMenu/ManageMenu.tsx","../../src/core/studio/components/navbar/userMenu/UserMenu.tsx","../../src/core/studio/components/navbar/StudioNavbar.tsx","../../src/core/components/collapseTabList/CollapseTabList.tsx","../../src/core/studio/components/navbar/tools/ToolLink.tsx","../../src/core/studio/components/navbar/tools/ToolCollapseMenu.tsx","../../src/core/studio/components/navbar/tools/ToolVerticalMenu.tsx","../../src/core/studio/components/navbar/tools/StudioToolMenu.tsx","../../src/core/studio/GlobalStyle.tsx","../../src/core/error/ErrorLogger.tsx","../../src/core/studio/AuthBoundary.tsx","../../src/core/studio/constants.ts","../../src/core/studio/StudioTelemetryProvider.tsx","../../src/core/theme/index.ts","../../src/core/studio/StudioThemeProvider.tsx","../../src/core/studio/workspaceLoader/ErrorMessage.tsx","../../src/core/studio/router/router.ts","../../src/core/studio/router/util/getOrderedTools.ts","../../src/core/studio/router/helpers.ts","../../src/core/studio/workspaceLoader/WorkspaceRouterProvider.tsx","../../src/core/studio/workspaceLoader/WorkspaceLoader.tsx","../../src/core/studio/StudioProvider.tsx","../../src/core/hooks/useClient.ts","../../src/core/hooks/useDataset.ts","../../src/core/hooks/useDocumentOperation.ts","../../src/core/hooks/useFeatureEnabled.ts","../../src/core/hooks/useProjectId.ts","../../src/core/hooks/useRelativeTime.ts","../../src/core/hooks/useSchema.ts","../../src/core/hooks/useTemplates.ts","../../src/core/components/documentStatus/DocumentStatus.tsx","../../src/core/components/hookCollection/HookStateContainer.ts","../../src/core/components/InsufficientPermissionsMessage.tsx","../../src/core/components/popoverDialog/PopoverContainer.tsx","../../src/core/components/popoverDialog/PopoverDialog.tsx","../../src/core/components/previewCard/PreviewCard.tsx","../../src/core/components/previews/constants.ts","../../src/core/components/previews/_common/Media.styled.ts","../../src/core/components/previews/_common/Media.tsx","../../src/core/components/previews/helpers.tsx","../../src/core/components/previews/general/CompactPreview.tsx","../../src/core/components/previews/general/DefaultPreview.tsx","../../src/core/components/previews/general/DetailPreview.styled.ts","../../src/core/components/previews/general/DetailPreview.tsx","../../src/core/components/progress/CircularProgress.tsx","../../src/core/components/progress/LinearProgress.tsx","../../src/core/components/previews/general/MediaPreview.styled.ts","../../src/core/components/previews/general/MediaPreview.tsx","../../src/core/components/previews/portableText/BlockImagePreview.styled.tsx","../../src/core/components/previews/portableText/BlockImagePreview.tsx","../../src/core/components/previews/portableText/BlockPreview.tsx","../../src/core/components/previews/portableText/InlinePreview.styled.tsx","../../src/core/components/previews/portableText/InlinePreview.tsx","../../src/core/components/previews/template/TemplatePreview.tsx","../../src/core/components/rovingFocus/useRovingFocus.ts","../../src/core/components/StatusButton.tsx","../../src/core/components/TooltipOfDisabled.tsx","../../src/core/components/transitional/ImperativeToast.ts","../../src/core/components/zOffsets/defaults.ts","../../src/core/components/zOffsets/ZIndexContext.ts","../../src/core/components/zOffsets/useZIndex.ts","../../src/core/components/transitional/LegacyLayerProvider.tsx","../../src/core/form/utils/TransformPatches.tsx"],"sourcesContent":["import {type Path} from '@sanity/types'\nimport {createContext} from 'react'\n\n/** @internal */\nexport interface ConnectorContextValue {\n  isReviewChangesOpen: boolean\n  onOpenReviewChanges: () => void | undefined\n  onSetFocus: (nextPath: Path) => void | undefined\n}\n\n/** @internal */\nexport const ConnectorContext = createContext<ConnectorContextValue>({\n  isReviewChangesOpen: false,\n  onOpenReviewChanges: () => undefined,\n  onSetFocus: () => undefined,\n} as ConnectorContextValue)\n","import {debounce} from 'lodash'\nimport createPubsub from 'nano-pubsub'\n\nimport {type Reported} from './types'\n\nexport function createStore<Value>() {\n  const reportedValues = new Map<string, Value>()\n  const {publish, subscribe} = createPubsub<Reported<Value>[]>()\n\n  const debouncedPublish = debounce(publish, 10, {trailing: true})\n  const read = () => Array.from(reportedValues.entries())\n\n  function add(id: string, value: Value) {\n    if (reportedValues.has(id)) {\n      // eslint-disable-next-line no-console\n      // console.error(\n      //   new Error(\n      //     `Invalid call to useReporter(${id}): A component reporting on \"${id}\" is already mounted in the subtree. Make sure that all reporters within the same <Tracker> subtree have unique ids.`\n      //   )\n      // )\n    }\n    reportedValues.set(id, value)\n    debouncedPublish(read())\n  }\n\n  function update(id: string, value: Value) {\n    if (!reportedValues.has(id)) {\n      // throw new Error(`A reporter with id \"${id}\" is not known.`)\n    }\n    reportedValues.set(id, value)\n    debouncedPublish(read())\n  }\n\n  function remove(id: string) {\n    if (!reportedValues.has(id)) {\n      // throw new Error(`A reporter with id \"${id}\" is not known`)\n    }\n    reportedValues.delete(id)\n    debouncedPublish(read())\n  }\n\n  return {\n    add,\n    remove,\n    update,\n    read,\n    subscribe,\n  }\n}\n","import {type Context as ReactContext, useContext, useLayoutEffect, useRef} from 'react'\n\nimport {type TrackerContext} from './types'\n\n/** @internal */\nexport type ReporterHook<Payload> = (\n  id: string | null,\n  value: Payload | (() => Payload),\n  isEqual?: (a: Payload, b: Payload) => boolean,\n) => void\n\nfunction isFunc<T>(value: T | (() => T)): value is () => T {\n  return typeof value === 'function'\n}\n\nfunction read<T>(value: T | (() => T)): T {\n  return isFunc(value) ? value() : value\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nconst noop = () => undefined\n\n/** @internal */\nexport type IsEqualFunction<Value> = (a: Value, b: Value) => boolean\n\n/** @internal */\nexport function createUseReporter<Value>(\n  Context: ReactContext<TrackerContext<Value>>,\n): ReporterHook<Value> {\n  return function useReporter(\n    // No reporting will happen if id=null\n    id: string | null,\n    value: Value | (() => Value),\n    isEqual: IsEqualFunction<Value> = Object.is,\n  ) {\n    const {add, update, remove} = useContext(Context)\n    const previous = useRef<Value>()\n\n    useLayoutEffect(() => {\n      if (id === null) {\n        return noop\n      }\n      const current = read(value)\n      add(id, current)\n      previous.current = current\n      return () => {\n        remove(id)\n      }\n    }, [add, id, remove, value])\n\n    useLayoutEffect(() => {\n      const current = read(value)\n      if (\n        typeof previous.current !== 'undefined' &&\n        !isEqual(previous.current, current) &&\n        id !== null\n      ) {\n        update(id, current)\n      }\n      previous.current = current\n    })\n  }\n}\n","import {\n  createContext,\n  type ReactNode,\n  useContext,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\n\nimport {createStore} from './createStore'\nimport {createUseReporter, type IsEqualFunction} from './createUseReporter'\nimport {type Reported, type TrackerContext} from './types'\n\n// Todo: consider memozing individual functions or move the context assertion/guard to a separate step.\nlet didWarn = false\nconst useReporterGuard = (id: string): void => {\n  if (!didWarn) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      new Error(\n        `No context provided for reporter. Make sure that the component calling \"useReporter(${id}, ...)\", is wrapped in a <Tracker> element`,\n      ),\n    )\n  }\n  didWarn = true\n}\n\nfunction useReportedValueGuard(): Reported<unknown>[] {\n  if (!didWarn) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      new Error(\n        'No context provided for reporter. Make sure that the component calling \"useReportedValues()\", is wrapped inside a <Tracker> element',\n      ),\n    )\n  }\n  didWarn = true\n  return []\n}\n\nconst useSubscribeGuard = () => {\n  if (!didWarn) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      new Error(\n        'No context provided for reporter. Make sure that the component calling \"useReportedValues()\", is wrapped inside a <Tracker> element',\n      ),\n    )\n  }\n  didWarn = true\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  return () => {}\n}\n\nconst DEFAULT_CONTEXT: TrackerContext<unknown> = {\n  add: useReporterGuard,\n  update: useReporterGuard,\n  remove: useReporterGuard,\n  subscribe: useSubscribeGuard,\n  read: useReportedValueGuard,\n}\n\nlet id = 0\nconst getNextId = () => ++id\n\n/** @internal */\nexport function createTrackerScope<Value>() {\n  const Context = createContext(DEFAULT_CONTEXT as TrackerContext<Value>)\n\n  function useReportedValues() {\n    const context = useContext(Context)\n    const [values, setValues] = useState(context.read())\n    useLayoutEffect(() => {\n      setValues(context.read())\n      return context.subscribe(setValues)\n    }, [context])\n    return values\n  }\n\n  function Tracker(props: {children: ReactNode}) {\n    const store = useMemo(() => createStore<Value>(), [])\n    return <Context.Provider value={store}>{props.children}</Context.Provider>\n  }\n\n  const useReporter = createUseReporter(Context)\n\n  return {\n    Tracker,\n    useReportedValues,\n    useReporter,\n    useAutoIdReporter: (\n      value: Value | (() => Value),\n      isEqual: IsEqualFunction<Value> = Object.is,\n    ) => useReporter(`element-${useRef(getNextId()).current}`, value, isEqual),\n  }\n}\n","// Toggle tracking of change indicator DOM positions and connectors overlay rendering\nexport const ENABLED = true\n\nexport const CORNER_RADIUS = 4\n\nexport const INTERACTIVE_STROKE_WIDTH = 16\n\nexport const CONNECTOR_MARGIN = 8\nexport const ARROW_MARGIN_X = 8\nexport const ARROW_MARGIN_Y = 2\nexport const ARROW_SIZE = 4\nexport const ARROW_THRESHOLD = 12\nexport const STROKE_WIDTH = 1\n\nexport const DEBUG = false\nexport const DEBUG_LAYER_BOUNDS = DEBUG || false\n","import {type Path} from '@sanity/types'\n\nimport {createNoopTrackerScope, createTrackerScope} from '../components/react-track-elements'\nimport {ENABLED} from './constants'\n\n/** @internal */\nexport interface TrackedChange {\n  element: HTMLElement\n  path: Path\n  isChanged: boolean\n  hasFocus: boolean\n  hasHover: boolean\n  hasRevertHover: boolean\n  zIndex: number\n}\n\n/** @internal */\nexport interface TrackedArea {\n  element: HTMLElement\n}\n\nconst trackerScope = ENABLED\n  ? createTrackerScope<TrackedChange | TrackedArea>()\n  : createNoopTrackerScope<TrackedChange | TrackedArea>()\n\n/** @internal */\nexport const Tracker = trackerScope.Tracker\n\n/** @internal */\nexport const useReportedValues = trackerScope.useReportedValues\n\n/** @internal */\nexport const useReporter = trackerScope.useReporter\n","import {isEqual} from 'lodash'\nimport {useRef} from 'react'\n\n/**\n * This React hook should be considered an escape hatch  to make sure that a value is the same\n * on every render. SHOULD NOT BE USED IN MOST CASES.\n * @deprecated please use `useMemo` and `useCallback` strategies instead to make deps stable, this hook runs comparisons on every single render and while each comparison can be fast, it quickly adds up\n *\n * @internal\n */\nexport function useUnique<ValueType>(value: ValueType): ValueType {\n  const valueRef = useRef<ValueType>(value)\n\n  if (!isEqual(valueRef.current, value)) {\n    valueRef.current = value\n  }\n\n  return valueRef.current\n}\n","import {useMemoObservable} from 'react-rx'\nimport {concat, type Observable, of} from 'rxjs'\nimport {catchError, distinctUntilChanged, map, scan, switchMap} from 'rxjs/operators'\n\nimport {useUnique} from './useUnique'\n\n/** @internal */\nexport type LoadingTuple<T> = [T, boolean]\n\n/** @internal */\nexport type ReactHook<TArgs, TResult> = (args: TArgs) => TResult\n\n/** @internal */\n// overloads to handle types where an initial value is passed\nexport function createHookFromObservableFactory<T, TArg = void>(\n  observableFactory: (arg: TArg) => Observable<T>,\n  initialValue: T,\n): ReactHook<TArg, LoadingTuple<T>>\n/** @internal */\nexport function createHookFromObservableFactory<T, TArg = void>(\n  observableFactory: (arg: TArg) => Observable<T>,\n  initialValue?: T,\n): ReactHook<TArg, LoadingTuple<T | undefined>>\n\n/**\n * A function that will create a hook from a function that returns an\n * observable. The parameters of the hook will be the parameters of the function\n * and the return of the hook will be a loading tuple with the value of the\n * observable at the first index and a boolean with the loading state as the\n * second index.\n *\n * The loading state will become true as soon as new incoming args are given and\n * will flip to false when the observable from the function emits the next\n * value.\n *\n * @internal\n */\nexport function createHookFromObservableFactory<T, TArg = void>(\n  observableFactory: (arg: TArg) => Observable<T>,\n  initialValue?: T,\n): ReactHook<TArg, LoadingTuple<T | undefined>> {\n  const initialLoadingTuple: LoadingTuple<T | undefined> = [initialValue, true]\n  const initialResult = {type: 'tuple', tuple: initialLoadingTuple} as const\n\n  return function useLoadableFromCreateLoadable(_arg: TArg) {\n    // @todo refactor callsites to make use of useMemo so that this hook can be removed\n    const memoArg = useUnique(_arg)\n    const result = useMemoObservable(\n      () =>\n        of(memoArg).pipe(\n          switchMap((arg) =>\n            concat(\n              of({type: 'loading'} as const),\n              observableFactory(arg).pipe(map((value) => ({type: 'value', value}) as const)),\n            ),\n          ),\n          scan(([prevValue], next): LoadingTuple<T | undefined> => {\n            if (next.type === 'loading') return [prevValue, true]\n            return [next.value, false]\n          }, initialLoadingTuple),\n          distinctUntilChanged(([prevValue, prevIsLoading], [nextValue, nextIsLoading]) => {\n            if (prevValue !== nextValue) return false\n            if (prevIsLoading !== nextIsLoading) return false\n            return true\n          }),\n          map((tuple) => ({type: 'tuple', tuple}) as const),\n          catchError((error) => of({type: 'error', error} as const)),\n        ),\n      [memoArg],\n      initialResult,\n    )\n\n    if (result.type === 'error') throw result.error\n\n    return result.tuple\n  }\n}\n","/**\n * @internal\n */\nexport function isNonNullable<T>(value: T): value is NonNullable<T> {\n  return value !== null && value !== undefined\n}\n","import {type SanityDocument, type SanityDocumentLike} from '@sanity/types'\n\nimport {isNonNullable} from './isNonNullable'\n\n/** @internal */\n// nominal/opaque type hack\nexport type Opaque<T, K> = T & {__opaqueId__: K}\n\n/** @internal */\nexport type DraftId = Opaque<string, 'draftId'>\n\n/** @internal */\nexport type PublishedId = Opaque<string, 'publishedId'>\n\n/** @internal */\nexport const DRAFTS_FOLDER = 'drafts'\nconst DRAFTS_PREFIX = `${DRAFTS_FOLDER}.`\n\n/**\n *\n * Checks if the document ID `documentId` has the same ID as `equalsDocumentId`,\n * ignoring the draft prefix.\n *\n * @public\n *\n * @param documentId - The document ID to check\n * @param equalsDocumentId - The document ID to check against\n *\n * @example\n * Draft vs published document ID, but representing the same document:\n * ```\n * // Prints \"true\":\n * console.log(documentIdEquals('drafts.agot', 'agot'));\n * ```\n * @example\n * Different documents:\n * ```\n * // Prints \"false\":\n * console.log(documentIdEquals('hp-tcos', 'hp-hbp'));\n * ```\n *\n * @returns `true` if the document IDs are equal, `false` otherwise\n */\nexport function documentIdEquals(documentId: string, equalsDocumentId: string): boolean {\n  return getPublishedId(documentId) === getPublishedId(equalsDocumentId)\n}\n\n/** @internal */\nexport function isDraft(document: SanityDocumentLike): boolean {\n  return isDraftId(document._id)\n}\n\n/** @internal */\nexport function isDraftId(id: string): id is DraftId {\n  return id.startsWith(DRAFTS_PREFIX)\n}\n\n/** @internal */\nexport function getIdPair(id: string): {draftId: DraftId; publishedId: PublishedId} {\n  return {\n    draftId: getDraftId(id),\n    publishedId: getPublishedId(id),\n  }\n}\n\n/** @internal */\nexport function isPublishedId(id: string): id is PublishedId {\n  return !isDraftId(id)\n}\n\n/** @internal */\nexport function getDraftId(id: string): DraftId {\n  return isDraftId(id) ? id : ((DRAFTS_PREFIX + id) as DraftId)\n}\n\n/** @internal */\nexport function getPublishedId(id: string): PublishedId {\n  return (isDraftId(id) ? id.slice(DRAFTS_PREFIX.length) : id) as PublishedId\n}\n\n/** @internal */\nexport function createDraftFrom(document: SanityDocument): SanityDocument {\n  return {\n    ...document,\n    _id: getDraftId(document._id),\n  }\n}\n\n/** @internal */\nexport function newDraftFrom(document: SanityDocument): SanityDocument {\n  return {\n    ...document,\n    _id: DRAFTS_PREFIX,\n  }\n}\n\n/** @internal */\nexport function createPublishedFrom(document: SanityDocument): SanityDocument {\n  return {\n    ...document,\n    _id: getPublishedId(document._id),\n  }\n}\n\n/**\n * Takes a list of documents and collates draft/published pairs into single entries\n * `{id: <published id>, draft?: <draft document>, published?: <published document>}`\n *\n * Note: because Map is ordered by insertion key the resulting array will be ordered by whichever\n * version appeared first\n *\n * @internal\n */\nexport interface CollatedHit<T extends {_id: string} = {_id: string}> {\n  id: string\n  type: string\n  draft?: T\n  published?: T\n}\n\n/** @internal */\nexport function collate<T extends {_id: string; _type: string}>(documents: T[]): CollatedHit<T>[] {\n  const byId = documents.reduce((res, doc) => {\n    const publishedId = getPublishedId(doc._id)\n    let entry = res.get(publishedId)\n    if (!entry) {\n      entry = {id: publishedId, type: doc._type, published: undefined, draft: undefined}\n      res.set(publishedId, entry)\n    }\n\n    entry[publishedId === doc._id ? 'published' : 'draft'] = doc\n    return res\n  }, new Map())\n\n  return Array.from(byId.values())\n}\n\n/** @internal */\n// Removes published documents that also has a draft\nexport function removeDupes(documents: SanityDocumentLike[]): SanityDocumentLike[] {\n  return collate(documents)\n    .map((entry) => entry.draft || entry.published)\n    .filter(isNonNullable)\n}\n","/** @internal */\nexport const EMPTY_OBJECT: Record<string, unknown> = Object.freeze({})\n\n/** @internal */\nexport const EMPTY_ARRAY: never[] = Object.freeze([]) as never[]\n","import {type GlobalErrorChannel} from '../components/globalErrorHandler'\n\n/**\n * Gets the global scope instance in a given environment.\n *\n * The strategy is to return the most modern, and if not, the most common:\n * - The `globalThis` variable is the modern approach to accessing the global scope\n * - The `window` variable is the global scope in a web browser\n * - The `self` variable is the global scope in workers and others\n * - The `global` variable is the global scope in Node.js\n */\nfunction getGlobalScope(): typeof globalThis & {__sanityErrorChannel?: GlobalErrorChannel} {\n  if (typeof globalThis !== 'undefined') return globalThis\n  if (typeof window !== 'undefined') return window\n  if (typeof self !== 'undefined') return self\n  if (typeof global !== 'undefined') return global\n\n  throw new Error('@sanity/ui: could not locate global scope')\n}\n\n/** @internal */\nexport const globalScope = getGlobalScope()\n","/**\n * @internal\n */\nexport function isRecord(value: unknown): value is Record<string, unknown> {\n  return Boolean(value) && typeof value === 'object' && !Array.isArray(value)\n}\n","/** @internal */\nexport function isString(value: unknown): value is string {\n  return typeof value === 'string'\n}\n","import {ResizeObserver as Polyfill, type ResizeObserverEntry} from '@juggle/resize-observer'\nimport createPubSub, {type Subscriber} from 'nano-pubsub'\n\nconst ResizeObserver: typeof Polyfill =\n  typeof document === 'object' && typeof window === 'object' && window.ResizeObserver\n    ? window.ResizeObserver\n    : Polyfill\n\n/** @internal */\nexport interface SharedResizeObserver {\n  observe: (\n    element: Element,\n    observer: Subscriber<ResizeObserverEntry>,\n    options?: ResizeObserverOptions,\n  ) => () => void\n  unobserve: (element: Element) => void\n}\n\n/** @internal */\nexport const createSharedResizeObserver = (): SharedResizeObserver => {\n  const event = createPubSub<ResizeObserverEntry[]>()\n\n  const resizeObserver = new ResizeObserver((entries: ResizeObserverEntry[]) =>\n    event.publish(entries),\n  )\n\n  return {\n    observe: (\n      element: Element,\n      observer: Subscriber<ResizeObserverEntry>,\n      options?: ResizeObserverOptions,\n    ) => {\n      const unsubscribe = event.subscribe((entries) => {\n        const entry = entries.find((e) => e.target === element)\n        if (entry) {\n          observer(entry)\n        }\n      })\n\n      resizeObserver.observe(element, options)\n\n      return () => {\n        unsubscribe()\n        resizeObserver.unobserve(element)\n      }\n    },\n    unobserve: (element: Element) => resizeObserver.unobserve(element),\n  }\n}\n\n/** @internal */\nexport const resizeObserver = createSharedResizeObserver()\n","type SearchPathSegment = string | number | []\n\nconst GROQ_KEYWORDS = ['match', 'in', 'asc', 'desc', 'true', 'false', 'null']\nconst VALID_FIELD = /^[a-zA-Z_][a-zA-Z0-9_]*$/\n\n/** @internal */\nexport const fieldNeedsEscape = (fieldName: string): boolean =>\n  !VALID_FIELD.test(fieldName) || GROQ_KEYWORDS.includes(fieldName)\n\n/** @internal */\nexport const escapeField = (fieldName: string): string => `[\"${fieldName}\"]`\n\nconst escapeFirst = (fieldName: string): string => `@${escapeField(fieldName)}`\n\nconst isEmptyArray = (value: unknown): value is [] => Array.isArray(value) && value.length === 0\n\n/** @internal */\nexport const joinPath = (pathArray: SearchPathSegment[]): string => {\n  let path = ''\n  for (let i = 0; i < pathArray.length; i++) {\n    const pathSegment = pathArray[i]\n    if (isEmptyArray(pathSegment)) {\n      path += `[]`\n      continue\n    }\n\n    if (typeof pathSegment === 'number') {\n      path += `[${pathSegment}]`\n      continue\n    }\n\n    const isFirst = i === 0\n    const needsEscape = fieldNeedsEscape(pathSegment)\n\n    if (needsEscape) {\n      path = isFirst ? escapeFirst(pathSegment) : `${path}${escapeField(pathSegment)}`\n    } else {\n      path = isFirst ? pathSegment : `${path}.${pathSegment}`\n    }\n  }\n\n  return path\n}\n","/** @internal */\nexport const supportsTouch = isTouchDevice()\n\nfunction isTouchDevice() {\n  if (typeof window === 'undefined') return false\n\n  return (\n    'ontouchstart' in window ||\n    navigator.maxTouchPoints > 0 ||\n    (navigator as any).msMaxTouchPoints > 0\n  )\n}\n","const segmenter = typeof Intl === 'object' && 'Segmenter' in Intl ? new Intl.Segmenter() : undefined\n\n/**\n * Truncates a string to a given length, taking into account surrogate pairs and grapheme clusters\n * (using zero-width joiners). This means the resulting string may be longer in number of bytes,\n * but will be shorter in number of \"characters\". Should only be used for display purposes -\n * not for truncating strings for storage or similar.\n *\n * Examples of differences between `String.prototype.slice` and this function:\n *\n * - ''.slice(0, 1) === ''  vs sliceString('', 0, 1) === ''\n * - ''.slice(0, 2) === '' vs sliceString('', 0, 2) === ''\n *\n * @param str - String to slice\n * @param start - Start index\n * @param end - End index (exclusive)\n * @returns The sliced string\n * @internal\n */\nexport function sliceString(str: string, start: number, end: number): string {\n  if (end < start) {\n    throw new Error(\n      'End must be greater than start, use `String.prototype.slice()` for negative values',\n    )\n  }\n\n  if (!segmenter) {\n    return str.slice(start, end)\n  }\n\n  let i = 0\n  let sliced = ''\n  for (const value of segmenter.segment(str)) {\n    if (i === end) {\n      return sliced\n    }\n\n    sliced += value.segment\n    i++\n  }\n\n  return sliced\n}\n\n/**\n * Truncates a string to a given length, taking into account surrogate pairs and grapheme clusters\n * (using zero-width joiners). This means the resulting string may be longer in number of bytes,\n * but will be shorter in number of \"characters\". Should only be used for display purposes -\n * not for truncating strings for storage or similar.\n *\n * @param str - String to truncate\n * @param maxLength - Maximum length in \"characters\"\n * @returns The truncated string\n * @internal\n */\nexport function truncateString(str: string, maxLength: number): string {\n  const truncated = sliceString(str, 0, maxLength)\n  return truncated === str ? truncated : `${truncated}`\n}\n","import {useMemoObservable} from 'react-rx'\nimport {type Observable, of, type OperatorFunction} from 'rxjs'\nimport {catchError, map} from 'rxjs/operators'\n\n/** @internal */\nexport type LoadableState<T> = LoadingState | LoadedState<T> | ErrorState\n\n/** @internal */\nexport interface LoadingState {\n  value: undefined\n  error: null\n  isLoading: true\n}\n\n/** @internal */\nexport interface LoadedState<T> {\n  value: T\n  error: null\n  isLoading: false\n}\n\n/** @internal */\nexport interface ErrorState {\n  value: undefined\n  error: Error\n  isLoading: false\n}\n\nconst LOADING_STATE: LoadingState = {\n  isLoading: true,\n  value: undefined,\n  error: null,\n}\n\n/** @internal */\nexport function useLoadable<T>(value$: Observable<T>): LoadableState<T | undefined>\n/** @internal */\nexport function useLoadable<T>(value$: Observable<T>, initialValue: T): LoadableState<T>\n/** @internal */\nexport function useLoadable<T>(\n  value$: Observable<T>,\n  initialValue?: T,\n): LoadableState<T | undefined> {\n  const initial: LoadableState<T> =\n    typeof initialValue === 'undefined'\n      ? LOADING_STATE\n      : {isLoading: false, value: initialValue, error: null}\n\n  return useMemoObservable(() => value$.pipe(asLoadable()), [value$], initial)\n}\n\n/** @internal */\nexport function asLoadable<T>(): OperatorFunction<T, LoadableState<T>> {\n  return (value$: Observable<T>) =>\n    value$.pipe(\n      map((value) => ({isLoading: false, value, error: null}) as const),\n      catchError(\n        (error): Observable<ErrorState> => of({isLoading: false, value: undefined, error}),\n      ),\n    )\n}\n","import {type CurrentUser} from '@sanity/types'\n\n/**\n * Checks whether or not the given user has the role with the given ID\n *\n * @param user - The user to check (currently only the current user is supported)\n *   If `null` is passed, this function always returns `false`.\n * @param roleId - The ID of the role to check for\n *\n * @returns true if the user has the role, false otherwise\n *\n * @example\n * Fetch the current user and check if they have the role \"administrator\":\n * ```ts\n * import {userHasRole, useCurrentUser} from 'sanity'\n *\n * export function MyComponent() {\n *   const user = useCurrentUser()\n *   const hasAdminRole = userHasRole(user, 'administrator')\n *   return <div>Is administrator: {hasAdminRole ? 'Yes' : 'No'}</div>\n * }\n * ```\n * @public\n */\nexport function userHasRole(\n  user: (Omit<CurrentUser, 'role'> & {role?: string}) | null,\n  roleId: string,\n): boolean {\n  return user !== null && user.roles.some((role) => role.name === roleId)\n}\n","/* eslint-disable no-process-env */\nimport {type TFunction} from 'i18next'\n\n/**\n * Mode to use for debugging. `reverse`, `triangles` or `log`.\n */\nconst DEBUG_MODE = typeof process === 'undefined' ? false : process?.env?.SANITY_STUDIO_DEBUG_I18N\n\n/**\n * Whether or not the debug mode for i18n should be enabled\n *\n * @internal\n * @hidden\n */\nexport const DEBUG_I18N = Boolean(DEBUG_MODE)\n\n/**\n * Wrapper function use for debugging. The \"reverse\" approach is less disruptive to the layout, but\n * may be hard to use since it is hard to read labels. The \"triangles\" approach is easy to spot.\n */\nconst debugWrappers = {\n  reverse: (str: string) => `${str}`,\n  triangles: (str: string) => ` ${str} `,\n}\n\n/**\n * If in debug mode, wrap the given `t` function in a function that adds a prefix and suffix to the\n * translated string. If not, return the original `t` function as-is.\n *\n * @param t - The `t` function to wrap\n * @returns The wrapped `t` function, or the original `t` function if not in debug mode\n * @internal\n * @hidden\n */\nexport function maybeWrapT(t: TFunction): TFunction {\n  const wrapper =\n    DEBUG_MODE === 'reverse' || DEBUG_MODE === 'triangles' ? debugWrappers[DEBUG_MODE] : null\n\n  return wrapper ? (((...args: any) => wrapper(t(...args)) as any) as TFunction) : t\n}\n","import {type FlatNamespace, type KeyPrefix, type Namespace, type TFunction} from 'i18next'\nimport {type FallbackNs, useTranslation as useOriginalTranslation} from 'react-i18next'\nimport {type $Tuple} from 'react-i18next/helpers'\n\nimport {maybeWrapT} from '../debug'\n\n/**\n * Return value from the `useTranslate` hook\n *\n * @public\n */\nexport type UseTranslationResponse<Ns extends Namespace, KPrefix> = {\n  /**\n   * The translate function for the given namespace(s)\n   */\n  t: TFunction<Ns, KPrefix>\n}\n\n/**\n * Options for the `useTranslate` hook\n *\n * @public\n */\nexport interface UseTranslationOptions<KPrefix> {\n  /**\n   * @deprecated Avoid using this, it may be\n   */\n  keyPrefix?: KPrefix\n  lng?: string\n}\n\nconst translationOptionOverrides = {\n  // We're manually forcing a re-render with the locale key in the LocaleProvider,\n  // so we don't need to bind to the i18n instance for language change events.\n  bindI18n: false as const,\n}\n\n/**\n * Returns a `t` translator function for the given namespace.\n *\n * If the given namespace is not loaded, it will trigger a suspense, and the component will resume\n * rendering once the namespace is loaded.\n *\n * @public\n */\nexport function useTranslation<\n  Ns extends FlatNamespace | $Tuple<FlatNamespace> | undefined = undefined,\n  KPrefix extends KeyPrefix<FallbackNs<Ns>> = undefined,\n>(\n  ns?: Ns,\n  options?: UseTranslationOptions<KPrefix>,\n): UseTranslationResponse<FallbackNs<Ns>, KPrefix> {\n  const {t} = useOriginalTranslation(\n    ns,\n    options\n      ? {keyPrefix: options.keyPrefix, lng: options.lng, ...translationOptionOverrides}\n      : translationOptionOverrides,\n  )\n\n  return {t: maybeWrapT(t)}\n}\n","/* eslint-disable camelcase */\n\nimport {getTheme_v2} from '@sanity/ui/theme'\nimport styled, {css} from 'styled-components'\n\ninterface RootProps {\n  $changed?: boolean\n  $disabled?: boolean\n  $hasFocus?: boolean\n  $isReviewChangeOpen: boolean\n  $withHoverEffect?: boolean\n}\n\nconst animationSpeed = 250\n\nexport const ChangeBarWrapper = styled.div<RootProps>(\n  ({$changed, $disabled, $hasFocus, $isReviewChangeOpen}) => {\n    if ($disabled)\n      return css`\n        ${ChangeBarMarker}:after {\n          display: none;\n        }\n      `\n\n    return css`\n      --change-bar-offset: 4px;\n\n      display: flex;\n      position: relative;\n\n      ${ChangeBarMarker}:after {\n        opacity: 0.5;\n      }\n\n      @media (hover: hover) {\n        &:hover {\n          z-index: 10;\n          ${ChangeBarMarker}:after {\n            opacity: 1;\n          }\n        }\n      }\n\n      /* hide when field is not changed */\n      ${$hasFocus &&\n      css`\n        ${ChangeBarMarker}:after {\n          opacity: 1;\n        }\n      `}\n\n      /* hide when field is not changed */\n      ${!$changed &&\n      css`\n        ${ChangeBarMarker}:after {\n          opacity: 0;\n          pointer-events: none;\n        }\n      `}\n\n      /* hide hover effect when review changes is open */\n      ${$isReviewChangeOpen &&\n      css`\n        ${ChangeBarButton} {\n          opacity: 0;\n        }\n      `}\n    `\n  },\n)\n\nexport const FieldWrapper = styled.div`\n  flex-grow: 1;\n  min-width: 0;\n`\n\nexport const ChangeBar = styled.div<{$zIndex: number}>`\n  position: relative;\n  opacity: 1;\n  transition: opacity 100ms;\n  z-index: ${({$zIndex}) => $zIndex};\n`\n\nexport const ChangeBarMarker = styled.div((props) => {\n  const {media} = getTheme_v2(props.theme)\n\n  return css`\n    position: absolute;\n    top: -1px;\n    left: var(--change-bar-offset);\n    width: 1px;\n    bottom: -1px;\n    background-color: var(--card-bg-color);\n\n    @media (min-width: ${media[0]}px) {\n      display: unset;\n    }\n\n    &:after {\n      content: '';\n      display: block;\n      position: absolute;\n      top: 1px;\n      left: 0;\n      width: 1px;\n      bottom: 1px;\n      background-color: var(--card-badge-caution-dot-color);\n      border-radius: 0.5px;\n    }\n  `\n})\n\nexport const ChangeBarButton = styled.button<{$withHoverEffect?: boolean}>((props) => {\n  const {$withHoverEffect} = props\n\n  return css`\n    appearance: none;\n    border: 0;\n    outline: 0;\n    display: block;\n    padding: 0;\n    background: transparent;\n    opacity: 0;\n    position: absolute;\n    height: 100%;\n    cursor: pointer;\n    pointer-events: all;\n    left: calc(-0.25rem + var(--change-bar-offset));\n    width: calc(1rem - 1px);\n    transition: opacity ${animationSpeed}ms;\n\n    &:focus {\n      border: 0;\n      outline: 0;\n    }\n\n    &:focus {\n      border: 0;\n      outline: 0;\n    }\n\n    ${$withHoverEffect &&\n    css`\n      @media (hover: hover) {\n        &:hover {\n          opacity: 0.2;\n        }\n      }\n    `}\n  `\n})\n","import {useLayer} from '@sanity/ui'\nimport {type ReactNode, useContext, useMemo} from 'react'\n\nimport {Tooltip} from '../../ui-components'\nimport {useTranslation} from '../i18n/hooks/useTranslation'\nimport {ConnectorContext} from './ConnectorContext'\nimport {\n  ChangeBar,\n  ChangeBarButton,\n  ChangeBarMarker,\n  ChangeBarWrapper,\n  FieldWrapper,\n} from './ElementWithChangeBar.styled'\n\nexport function ElementWithChangeBar(props: {\n  children: ReactNode\n  disabled?: boolean\n  hasFocus?: boolean\n  isChanged?: boolean\n  withHoverEffect?: boolean\n}) {\n  const {children, disabled, hasFocus, isChanged, withHoverEffect = true} = props\n\n  const {onOpenReviewChanges, isReviewChangesOpen} = useContext(ConnectorContext)\n  const {zIndex} = useLayer()\n  const {t} = useTranslation()\n\n  const changeBar = useMemo(\n    () =>\n      disabled || !isChanged ? null : (\n        <ChangeBar data-testid=\"change-bar\" $zIndex={zIndex}>\n          <ChangeBarMarker data-testid=\"change-bar__marker\" />\n          <Tooltip content={t('changes.change-bar.aria-label')} portal>\n            <ChangeBarButton\n              aria-label={t('changes.change-bar.aria-label')}\n              data-testid=\"change-bar__button\"\n              onClick={isReviewChangesOpen ? undefined : onOpenReviewChanges}\n              tabIndex={-1}\n              type=\"button\"\n              $withHoverEffect={withHoverEffect}\n            />\n          </Tooltip>\n        </ChangeBar>\n      ),\n    [disabled, isChanged, isReviewChangesOpen, onOpenReviewChanges, t, withHoverEffect, zIndex],\n  )\n\n  return (\n    <ChangeBarWrapper\n      data-testid=\"change-bar-wrapper\"\n      $changed={isChanged}\n      $disabled={disabled}\n      $hasFocus={hasFocus}\n      $isReviewChangeOpen={isReviewChangesOpen}\n    >\n      <FieldWrapper data-testid=\"change-bar__field-wrapper\">{children}</FieldWrapper>\n      {changeBar}\n    </ChangeBarWrapper>\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {useLayer} from '@sanity/ui'\nimport * as PathUtils from '@sanity/util/paths'\nimport {\n  type ComponentProps,\n  type HTMLProps,\n  memo,\n  type MouseEvent,\n  useCallback,\n  useRef,\n  useState,\n} from 'react'\nimport deepCompare from 'react-fast-compare'\n\nimport {EMPTY_ARRAY} from '../util'\nimport {ElementWithChangeBar} from './ElementWithChangeBar'\nimport {useReporter} from './tracker'\n\nconst ChangeBarWrapper = memo(function ChangeBarWrapper(\n  props: Omit<ComponentProps<'div'>, 'onChange'> & {\n    disabled?: boolean\n    path: Path\n    hasFocus: boolean\n    isChanged?: boolean\n    withHoverEffect?: boolean\n  },\n) {\n  const {\n    children,\n    disabled,\n    hasFocus,\n    isChanged,\n    onMouseEnter: onMouseEnterProp,\n    onMouseLeave: onMouseLeaveProp,\n    path = EMPTY_ARRAY,\n    withHoverEffect,\n    ...restProps\n  } = props\n  const layer = useLayer()\n  const [hasHover, setHover] = useState(false)\n  const onMouseEnter = useCallback(\n    (event: MouseEvent<HTMLDivElement>) => {\n      onMouseEnterProp?.(event)\n      setHover(true)\n    },\n    [onMouseEnterProp],\n  )\n  const onMouseLeave = useCallback(\n    (event: MouseEvent<HTMLDivElement>) => {\n      onMouseLeaveProp?.(event)\n      setHover(false)\n    },\n    [onMouseLeaveProp],\n  )\n  const ref = useRef<HTMLDivElement | null>(null)\n  useReporter(\n    disabled ? null : `field-${PathUtils.toString(path)}`,\n    () => ({\n      element: ref.current!,\n      path: path,\n      isChanged: isChanged,\n      hasFocus: hasFocus,\n      hasHover: hasHover,\n      zIndex: layer.zIndex,\n    }),\n    deepCompare, // note: deepCompare should be ok here since we're not comparing deep values\n  )\n\n  return (\n    <div {...restProps} ref={ref} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave}>\n      <ElementWithChangeBar\n        hasFocus={hasFocus}\n        isChanged={isChanged}\n        disabled={disabled}\n        withHoverEffect={withHoverEffect}\n      >\n        {children}\n      </ElementWithChangeBar>\n    </div>\n  )\n})\n\n/** @internal */\nexport interface ChangeIndicatorProps {\n  path: Path\n  hasFocus: boolean\n  isChanged: boolean\n  withHoverEffect?: boolean\n}\n\n/** @internal */\nexport function ChangeIndicator(\n  props: ChangeIndicatorProps & Omit<HTMLProps<HTMLDivElement>, 'as'>,\n) {\n  const {children, hasFocus, isChanged, path, withHoverEffect, ...restProps} = props\n\n  return (\n    <ChangeBarWrapper\n      {...restProps}\n      path={path}\n      hasFocus={hasFocus}\n      isChanged={isChanged}\n      withHoverEffect={withHoverEffect}\n    >\n      {children}\n    </ChangeBarWrapper>\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {type Context, createContext} from 'react'\n\n/** @internal */\nexport interface ChangeIndicatorContextValue {\n  value?: unknown\n  focusPath: Path\n  path: Path\n  fullPath: Path\n  isChanged: boolean\n}\n\n/** @internal */\nexport const ChangeIndicatorContext: Context<ChangeIndicatorContextValue> = createContext({\n  path: [],\n  fullPath: [],\n  focusPath: [],\n  isChanged: false,\n} as ChangeIndicatorContextValue)\n","import {type PubSub} from 'nano-pubsub'\nimport {createContext} from 'react'\n\nexport const ScrollContext = createContext<null | PubSub<Event>>(null)\n","import {useForwardedRef} from '@sanity/ui'\nimport createPubSub from 'nano-pubsub'\nimport {\n  createElement,\n  type ElementType,\n  type ForwardedRef,\n  forwardRef,\n  type HTMLProps,\n  useContext,\n  useEffect,\n  useMemo,\n} from 'react'\n\nimport {ScrollContext} from './scrollContext'\n\n/** @internal */\nexport interface ScrollContainerProps<T extends ElementType>\n  extends Omit<HTMLProps<T>, 'as' | 'onScroll'> {\n  as?: ElementType | keyof JSX.IntrinsicElements\n  onScroll?: (event: Event) => () => void\n}\n\nconst noop = () => undefined\n\n/**\n * This provides a utility function for use within Sanity Studios to create scrollable containers\n * It also provides a way for components inside a scrollable container to track onScroll on their first parent scroll container\n * NOTE: this is used by different studio utilities to track positions of elements on screen\n * NOTE: It will call any given `onScroll` callback with a Native DOM Event, and not a React Synthetic event\n * NOTE: It will not make sure the element is actually scrollable, this still needs to be done with css as usual\n *\n * @internal\n */\nexport const ScrollContainer = forwardRef(function ScrollContainer<T extends ElementType = 'div'>(\n  props: ScrollContainerProps<T>,\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const {as = 'div', onScroll, ...rest} = props\n  const forwardedRef = useForwardedRef(ref)\n\n  // const selfRef = useRef<HTMLElement | null>(null)\n  const parentContext = useContext(ScrollContext)\n  const childContext = useMemo(() => createPubSub<Event>(), [])\n\n  useEffect(() => {\n    if (onScroll) {\n      // emit scroll events from children\n      return childContext.subscribe(onScroll)\n    }\n    return noop\n  }, [childContext, onScroll])\n\n  useEffect(() => {\n    // let events bubble up\n    if (parentContext) {\n      return childContext.subscribe(parentContext.publish)\n    }\n    return noop\n  }, [parentContext, childContext])\n\n  useEffect(() => {\n    const handleScroll = (event: Event) => {\n      childContext.publish(event)\n    }\n\n    const el = forwardedRef.current\n\n    if (!el) {\n      return undefined\n    }\n\n    el.addEventListener('scroll', handleScroll, {\n      passive: true,\n      capture: true,\n    })\n\n    return () => {\n      el.removeEventListener('scroll', handleScroll)\n    }\n  }, [childContext, forwardedRef])\n\n  return (\n    <ScrollContext.Provider value={childContext}>\n      {createElement(as, {ref: forwardedRef, 'data-testid': 'scroll-container', ...rest})}\n    </ScrollContext.Provider>\n  )\n})\n","import {type ComponentProps} from 'react'\n\nimport {type Rect} from './types'\n\nexport function ClampedRect(\n  props: {top: number; left: number; height: number; width: number; bounds: Rect} & Omit<\n    ComponentProps<'rect'>,\n    'top' | 'left' | 'height' | 'width'\n  >,\n) {\n  const {bounds, ...rest} = props\n  const x = Math.max(bounds.left, props.left)\n  const y = Math.max(props.top, bounds.top)\n  const height = Math.max(0, props.height - (y - props.top))\n  const width = Math.max(0, props.width - (x - props.left))\n\n  return <rect {...rest} x={x} y={y} height={height} width={width} />\n}\n","/* eslint-disable camelcase */\n\nimport styled from 'styled-components'\n\nimport {ClampedRect} from './ClampedRect'\n\nexport const DebugRect = styled.rect`\n  stroke: #ccc;\n  fill: none;\n  pointer-events: none;\n  stroke-linecap: round;\n`\n\nexport const ConnectorPath = styled.path`\n  fill: none;\n  pointer-events: none;\n  stroke-linejoin: round;\n  stroke: var(--card-badge-caution-dot-color);\n`\n\nexport const InteractivePath = styled.path`\n  fill: none;\n  pointer-events: stroke;\n  stroke: transparent;\n  cursor: pointer;\n  stroke-linecap: round;\n  stroke-linejoin: round;\n  opacity: 0;\n\n  &:hover {\n    opacity: 0.2;\n  }\n`\n\nexport const RightBarWrapper = styled(ClampedRect)`\n  stroke: none;\n  pointer-events: none;\n  fill: var(--card-badge-caution-dot-color);\n`\n","import {\n  ARROW_MARGIN_X,\n  ARROW_MARGIN_Y,\n  ARROW_SIZE,\n  ARROW_THRESHOLD,\n  CORNER_RADIUS,\n} from '../constants'\nimport {type ConnectorLine} from './types'\n\nexport function arrowPath(x: number, y: number, dir: number): string {\n  return [\n    `M ${x - ARROW_SIZE} ${y - ARROW_SIZE * dir} `,\n    `L ${x} ${y}`,\n    `L ${x + ARROW_SIZE} ${y - ARROW_SIZE * dir}`,\n  ].join('')\n}\n\nfunction moveTo(x: number, y: number) {\n  return `M${x} ${y}`\n}\n\nfunction lineTo(x: number, y: number) {\n  return `L${x} ${y}`\n}\n\nfunction join(strings: string[], delim = '') {\n  return strings.join(delim)\n}\n\nfunction quadCurve(x1: number, y1: number, x: number, y: number) {\n  return `Q${x1} ${y1} ${x} ${y}`\n}\n\nexport function generateConnectorPath(line: ConnectorLine): string {\n  const {from, to} = line\n  const {left: fromX, top: fromY} = from\n  const {left: toX, top: toY} = to\n\n  const cmds: string[] = []\n\n  // Calculate maximum corner radius\n  const r1 = Math.min(CORNER_RADIUS, Math.abs(fromY - toY) / 2)\n\n  // FROM\n  if (from.isAbove) {\n    cmds.push(\n      moveTo(fromX + ARROW_MARGIN_X, fromY - ARROW_THRESHOLD + ARROW_MARGIN_Y),\n      lineTo(fromX + ARROW_MARGIN_X, fromY - CORNER_RADIUS),\n      quadCurve(fromX + ARROW_MARGIN_X, fromY, fromX + ARROW_MARGIN_X + CORNER_RADIUS, fromY),\n    )\n  } else if (from.isBelow) {\n    cmds.push(\n      moveTo(fromX + ARROW_MARGIN_X, fromY + ARROW_THRESHOLD - ARROW_MARGIN_Y),\n      lineTo(fromX + ARROW_MARGIN_X, fromY + CORNER_RADIUS),\n      quadCurve(fromX + ARROW_MARGIN_X, fromY, fromX + ARROW_MARGIN_X + CORNER_RADIUS, fromY),\n    )\n  } else {\n    cmds.push(moveTo(fromX, fromY))\n  }\n\n  // TO\n  if (to.isAbove) {\n    if (fromY < to.bounds.top) {\n      cmds.push(\n        lineTo(to.bounds.left - 8 - r1, fromY),\n        quadCurve(to.bounds.left - 8, fromY, to.bounds.left - 8, fromY + r1),\n        lineTo(to.bounds.left - 8, toY - r1),\n        quadCurve(to.bounds.left - 8, toY, to.bounds.left - 8 + r1, toY),\n        lineTo(to.bounds.left + ARROW_MARGIN_X - CORNER_RADIUS, toY),\n        quadCurve(\n          to.bounds.left + ARROW_MARGIN_X,\n          toY,\n          to.bounds.left + ARROW_MARGIN_X,\n          toY - CORNER_RADIUS,\n        ),\n        lineTo(to.bounds.left + ARROW_MARGIN_X, toY - ARROW_THRESHOLD + ARROW_MARGIN_Y),\n      )\n    } else {\n      cmds.push(\n        lineTo(to.bounds.left + ARROW_MARGIN_X - CORNER_RADIUS, fromY),\n        quadCurve(\n          to.bounds.left + ARROW_MARGIN_X,\n          fromY,\n          to.bounds.left + ARROW_MARGIN_X,\n          fromY - CORNER_RADIUS,\n        ),\n        lineTo(to.bounds.left + ARROW_MARGIN_X, toY - ARROW_THRESHOLD + ARROW_MARGIN_Y),\n      )\n    }\n  } else if (to.isBelow) {\n    if (fromY > to.bounds.top + to.bounds.height) {\n      // curl around\n      cmds.push(\n        lineTo(to.bounds.left - ARROW_MARGIN_X - r1, fromY),\n        quadCurve(\n          to.bounds.left - ARROW_MARGIN_X,\n          fromY,\n          to.bounds.left - ARROW_MARGIN_X,\n          fromY - r1,\n        ),\n        lineTo(to.bounds.left - ARROW_MARGIN_X, toY + r1),\n        quadCurve(to.bounds.left - ARROW_MARGIN_X, toY, to.bounds.left - ARROW_MARGIN_X + r1, toY),\n        lineTo(to.bounds.left + ARROW_MARGIN_X - CORNER_RADIUS, toY),\n        quadCurve(\n          to.bounds.left + ARROW_MARGIN_X,\n          toY,\n          to.bounds.left + ARROW_MARGIN_X,\n          toY + CORNER_RADIUS,\n        ),\n        lineTo(to.bounds.left + ARROW_MARGIN_X, toY + ARROW_THRESHOLD - ARROW_MARGIN_Y),\n      )\n    } else {\n      cmds.push(\n        lineTo(to.bounds.left + ARROW_MARGIN_X - CORNER_RADIUS, fromY),\n        quadCurve(\n          to.bounds.left + ARROW_MARGIN_X,\n          fromY,\n          to.bounds.left + ARROW_MARGIN_X,\n          fromY + CORNER_RADIUS,\n        ),\n        lineTo(to.bounds.left + ARROW_MARGIN_X, toY + ARROW_THRESHOLD - ARROW_MARGIN_Y),\n      )\n    }\n  } else if (fromY < toY) {\n    cmds.push(\n      lineTo(to.bounds.left + ARROW_MARGIN_X - r1, fromY),\n      quadCurve(\n        to.bounds.left + ARROW_MARGIN_X,\n        fromY,\n        to.bounds.left + ARROW_MARGIN_X,\n        fromY + r1,\n      ),\n      lineTo(to.bounds.left + ARROW_MARGIN_X, toY - r1),\n      quadCurve(to.bounds.left + ARROW_MARGIN_X, toY, to.bounds.left + ARROW_MARGIN_X + r1, toY),\n      lineTo(toX, toY),\n    )\n  } else {\n    cmds.push(\n      lineTo(to.bounds.left + ARROW_MARGIN_X - r1, fromY),\n      quadCurve(\n        to.bounds.left + ARROW_MARGIN_X,\n        fromY,\n        to.bounds.left + ARROW_MARGIN_X,\n        fromY - r1,\n      ),\n      lineTo(to.bounds.left + ARROW_MARGIN_X, toY + r1),\n      quadCurve(to.bounds.left + ARROW_MARGIN_X, toY, to.bounds.left + ARROW_MARGIN_X + r1, toY),\n      lineTo(toX, toY),\n    )\n  }\n\n  return join(cmds)\n}\n","import {ARROW_MARGIN_Y, ARROW_THRESHOLD, CONNECTOR_MARGIN} from '../constants'\nimport {type ConnectorLinePoint, type Rect} from './types'\n\nfunction getConnectorLinePoint(rect: Rect, bounds: Rect): ConnectorLinePoint {\n  const centerY = rect.top + rect.height / 2\n  const isAbove = rect.top + rect.height < bounds.top + ARROW_MARGIN_Y\n  const isBelow = rect.top > bounds.top + bounds.height - ARROW_MARGIN_Y\n\n  return {\n    bounds: bounds,\n    left: rect.left,\n    top: centerY,\n    centerY,\n    startY: rect.top + CONNECTOR_MARGIN,\n    endY: rect.top + rect.height - CONNECTOR_MARGIN,\n    isAbove,\n    isBelow,\n    outOfBounds: isAbove || isBelow,\n  }\n}\n\ninterface Connector {\n  from: {rect: Rect; bounds: Rect}\n  to: {rect: Rect; bounds: Rect}\n}\n\nexport function mapConnectorToLine(connector: Connector): {\n  from: ConnectorLinePoint\n  to: ConnectorLinePoint\n} {\n  const fromBounds = {\n    top: connector.from.bounds.top + ARROW_THRESHOLD,\n    bottom: connector.from.bounds.top + connector.from.bounds.height - ARROW_THRESHOLD,\n    left: connector.from.bounds.left,\n    right: connector.from.bounds.left + connector.from.bounds.width,\n    width: connector.from.bounds.width,\n    height: connector.from.bounds.height - ARROW_THRESHOLD * 2,\n  }\n\n  const from = getConnectorLinePoint(connector.from.rect, fromBounds)\n  from.left = connector.from.rect.left + connector.from.rect.width + 1\n\n  const toBounds = {\n    top: connector.to.bounds.top + ARROW_THRESHOLD,\n    bottom: connector.to.bounds.top + connector.to.bounds.height - ARROW_THRESHOLD,\n    left: connector.to.bounds.left,\n    right: connector.to.bounds.left + connector.to.bounds.width,\n    width: connector.to.bounds.width,\n    height: connector.to.bounds.height - ARROW_THRESHOLD * 2,\n  }\n\n  const to = getConnectorLinePoint(connector.to.rect, toBounds)\n\n  const maxStartY = Math.max(to.startY, from.startY)\n\n  // Align from <-> to vertically\n  from.top = Math.min(maxStartY, from.endY)\n  if (from.top < toBounds.top) {\n    from.top = Math.min(toBounds.top, from.endY)\n  } else if (from.top > toBounds.bottom) {\n    from.top = Math.max(toBounds.bottom, from.startY)\n  }\n  to.top = Math.min(maxStartY, to.endY)\n  if (to.top < fromBounds.top) {\n    to.top = Math.min(fromBounds.top, to.endY)\n  } else if (to.top > fromBounds.bottom) {\n    to.top = Math.max(fromBounds.bottom, to.startY)\n  }\n\n  // Keep within bounds\n  from.top = Math.min(Math.max(from.top, fromBounds.top), fromBounds.bottom)\n  to.top = Math.min(Math.max(to.top, toBounds.top), toBounds.bottom)\n\n  return {from, to}\n}\n","import {memo} from 'react'\n\nimport {\n  ARROW_MARGIN_X,\n  ARROW_MARGIN_Y,\n  ARROW_THRESHOLD,\n  DEBUG,\n  INTERACTIVE_STROKE_WIDTH,\n  STROKE_WIDTH,\n} from '../constants'\nimport {ConnectorPath, DebugRect, InteractivePath, RightBarWrapper} from './Connector.styled'\nimport {arrowPath, generateConnectorPath} from './connectorPath'\nimport {mapConnectorToLine} from './mapConnectorToLine'\nimport {type Rect} from './types'\n\ninterface Props {\n  from: {rect: Rect; bounds: Rect}\n  to: {rect: Rect; bounds: Rect}\n}\n\nexport const Connector = memo(function Connector({from, to}: Props) {\n  const line = mapConnectorToLine({from, to})\n\n  // If both ends of the connector are out of bounds, then do not render\n  if (line.from.outOfBounds && line.to.outOfBounds) {\n    return null\n  }\n\n  const linePathDescription = generateConnectorPath(line)\n\n  return (\n    <>\n      <InteractivePath d={linePathDescription} strokeWidth={INTERACTIVE_STROKE_WIDTH} />\n\n      <ConnectorPath d={linePathDescription} strokeWidth={STROKE_WIDTH} />\n\n      <RightBarWrapper\n        top={to.rect.top}\n        left={to.rect.left - 0.5}\n        height={to.rect.height}\n        width={STROKE_WIDTH}\n        bounds={to.bounds}\n      />\n\n      {line.from.isAbove && (\n        <ConnectorPath\n          d={arrowPath(\n            line.from.left + ARROW_MARGIN_X,\n            line.from.bounds.top - ARROW_THRESHOLD + ARROW_MARGIN_Y,\n            -1,\n          )}\n          strokeWidth={STROKE_WIDTH}\n        />\n      )}\n\n      {line.from.isBelow && (\n        <ConnectorPath\n          d={arrowPath(\n            line.from.left + ARROW_MARGIN_X,\n            line.from.bounds.top + line.from.bounds.height + ARROW_THRESHOLD - ARROW_MARGIN_Y,\n            1,\n          )}\n          strokeWidth={STROKE_WIDTH}\n        />\n      )}\n\n      {line.to.isAbove && (\n        <ConnectorPath\n          d={arrowPath(\n            line.to.bounds.left + ARROW_MARGIN_X,\n            line.to.bounds.top - ARROW_THRESHOLD + ARROW_MARGIN_Y,\n            -1,\n          )}\n          strokeWidth={STROKE_WIDTH}\n        />\n      )}\n\n      {line.to.isBelow && (\n        <ConnectorPath\n          d={arrowPath(\n            line.to.bounds.left + ARROW_MARGIN_X,\n            line.to.bounds.top + line.to.bounds.height + ARROW_THRESHOLD - ARROW_MARGIN_Y,\n            1,\n          )}\n          strokeWidth={STROKE_WIDTH}\n        />\n      )}\n\n      {DEBUG && (\n        <>\n          <DebugRect\n            x={line.from.bounds.left}\n            y={line.from.bounds.top}\n            width={line.from.bounds.width}\n            height={line.from.bounds.height}\n            stroke=\"green\"\n          />\n\n          <DebugRect\n            x={line.to.bounds.left}\n            y={line.to.bounds.top}\n            width={line.to.bounds.width}\n            height={line.to.bounds.height}\n            stroke=\"yellow\"\n          />\n\n          {!line.from.outOfBounds && (\n            <g transform={`translate(${line.from.bounds.left} ${line.from.bounds.top})`}>\n              <DebugRect\n                width={line.from.bounds.width}\n                height={line.from.bounds.height}\n                strokeWidth={STROKE_WIDTH}\n                stroke=\"green\"\n              />\n            </g>\n          )}\n\n          {!line.to.outOfBounds && (\n            <g transform={`translate(${line.to.bounds.left} ${line.to.bounds.top})`}>\n              <DebugRect\n                width={line.to.bounds.width}\n                height={line.to.bounds.height}\n                strokeWidth={STROKE_WIDTH}\n                stroke=\"red\"\n              />\n            </g>\n          )}\n        </>\n      )}\n    </>\n  )\n})\n","import styled from 'styled-components'\n\nexport const SvgWrapper = styled.svg`\n  pointer-events: none;\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n`\n","import {Grid} from '@sanity/ui'\nimport styled from 'styled-components'\n\nfunction focusRingBorderStyle(border: {color: string; width: number}): string {\n  return `inset 0 0 0 ${border.width}px ${border.color}`\n}\n\nexport const AlignedBottomGrid = styled(Grid)`\n  align-items: flex-end;\n`\n\nexport function focusRingStyle(opts: {\n  base?: {bg: string}\n  border?: {color: string; width: number}\n  focusRing: {offset: number; width: number}\n}): string {\n  const {base, border, focusRing} = opts\n  const focusRingOutsetWidth = focusRing.offset + focusRing.width\n  const focusRingInsetWidth = 0 - focusRing.offset\n  const bgColor = base ? base.bg : 'var(--card-bg-color)'\n\n  return [\n    focusRingInsetWidth > 0 && `inset 0 0 0 ${focusRingInsetWidth}px var(--card-focus-ring-color)`,\n    border && focusRingBorderStyle(border),\n    focusRingInsetWidth < 0 && `0 0 0 ${0 - focusRingInsetWidth}px ${bgColor}`,\n    focusRingOutsetWidth > 0 && `0 0 0 ${focusRingOutsetWidth}px var(--card-focus-ring-color)`,\n  ]\n    .filter(Boolean)\n    .join(',')\n}\n","import {Box, rem, Stack} from '@sanity/ui'\nimport {type ScrollToOptions, useVirtualizer, type Virtualizer} from '@tanstack/react-virtual'\nimport throttle from 'lodash/throttle'\nimport {\n  cloneElement,\n  forwardRef,\n  type ReactElement,\n  useCallback,\n  useEffect,\n  useId,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {focusRingStyle} from '../../form/components/formField/styles'\nimport {type CommandListElementType, type CommandListHandle, type CommandListProps} from './types'\n\n// Data attribute to assign to the current active virtual list element\nconst LIST_ITEM_DATA_ATTR_ACTIVE = 'data-active'\n// Selector to find the first interactive element in the virtual list element\nconst LIST_ITEM_INTERACTIVE_SELECTOR = 'a,button'\n\n/**\n * Conditionally render a focus ring overlay over the command list, with adjustable offset\n */\nconst FocusOverlayDiv = styled.div<{offset: number}>(({theme, offset}) => {\n  return css`\n    bottom: ${-offset}px;\n    border-radius: ${rem(theme.sanity.radius[1])};\n    left: ${-offset}px;\n    pointer-events: none;\n    position: absolute;\n    right: ${-offset}px;\n    top: ${-offset}px;\n    z-index: 2;\n\n    ${VirtualListBox}:focus-visible & {\n      box-shadow: ${focusRingStyle({\n        base: theme.sanity.color.base,\n        focusRing: theme.sanity.focusRing,\n      })};\n    }\n  `\n})\n\n/*\n * Conditionally appears over command list items to cancel existing :hover states for all child elements.\n * It should only appear if hover capabilities are available (not on touch devices)\n */\nconst PointerOverlayDiv = styled.div`\n  bottom: 0;\n  display: none;\n  left: 0;\n  position: absolute;\n  right: 0;\n  top: 0;\n  z-index: 1;\n\n  @media (hover: hover) {\n    &[data-enabled='true'] {\n      display: block;\n    }\n  }\n`\n\nconst VirtualListBox = styled(Box)`\n  height: 100%;\n  outline: none;\n  overflow-x: hidden;\n  overflow-y: auto;\n  overscroll-behavior: contain;\n  width: 100%;\n`\n\ntype VirtualListChildBoxProps = {\n  $height: number\n}\nconst VirtualListChildBox = styled(Box) //\n  .attrs<VirtualListChildBoxProps>(({$height}) => ({\n    style: {height: `${$height}px`},\n  }))<VirtualListChildBoxProps>`\n  position: relative;\n  width: 100%;\n`\n\n/**\n * Renders a Command List with support for the following:\n *\n * - Keyboard navigation ( /  / ENTER) to children with a specified container (`childContainerRef`)\n * - Focus redirection when clicking child elements\n * - Pointer blocking when navigating with arrow keys (to ensure that only one active state is visible at any given time)\n * - ARIA attributes to define a `combobox` input that controls a separate `listbox`\n *\n * @internal\n */\nexport const CommandList = forwardRef<CommandListHandle, CommandListProps>(function CommandList(\n  {\n    activeItemDataAttr = LIST_ITEM_DATA_ATTR_ACTIVE,\n    ariaLabel,\n    ariaMultiselectable = false,\n    autoFocus,\n    canReceiveFocus,\n    fixedHeight,\n    focusRingOffset = 0,\n    getItemDisabled,\n    getItemKey,\n    getItemSelected,\n    initialIndex,\n    initialScrollAlign = 'start',\n    inputElement,\n    itemHeight,\n    items,\n    onEndReached,\n    onEndReachedIndexOffset = 0,\n    onlyShowSelectionWhenActive,\n    overscan,\n    renderItem,\n    wrapAround = true,\n    ...responsivePaddingProps\n  },\n  ref,\n) {\n  const isMountedRef = useRef(false)\n  const commandListId = useRef(useId())\n  const activeIndexRef = useRef(initialIndex ?? 0)\n\n  const [childContainerElement, setChildContainerElement] = useState<HTMLElement | null>(null)\n  const [hovered, setHovered] = useState(false)\n  const [pointerOverlayElement, setPointerOverlayElement] = useState<HTMLDivElement | null>(null)\n  const [virtualListElement, setVirtualListElement] = useState<HTMLElement | null>(null)\n\n  const handleChange = useCallback(\n    (v: Virtualizer<HTMLElement, Element>) => {\n      if (!onEndReached) return\n\n      const [lastItem] = [...v.getVirtualItems()].reverse()\n\n      if (!lastItem) return\n\n      const reachedEnd = lastItem.index >= items.length - onEndReachedIndexOffset - 1\n\n      // Make sure we only trigger `onEndReached` after initial mount\n      if (reachedEnd && isMountedRef.current) {\n        onEndReached()\n      }\n    },\n    [onEndReached, items.length, onEndReachedIndexOffset],\n  )\n\n  // This will trigger a re-render whenever its internal state changes\n  const virtualizer = useVirtualizer({\n    count: items.length,\n    getItemKey,\n    getScrollElement: () => virtualListElement,\n    estimateSize: () => itemHeight,\n    onChange: handleChange,\n    overscan,\n  })\n\n  /**\n   * Return an array of values with `activeIndex`, `disabled` and `selected` defined, applying custom\n   * mapping functions (`getItemDisabled`, `getItemSelected`) if provided. E.g.:\n   *\n   * ```\n   * [\n   *  { activeIndex: 0  disabled: false, selected: false },\n   *  { activeIndex: null, disabled: true, selected: false },\n   *  { activeIndex: 1, disabled: false, selected: true }\n   * ]\n   * ```\n   *\n   * Disabled virtual list items are ignored when creating aria attributes.\n   */\n  const itemIndices = useMemo(() => {\n    let i = -1\n    return items.reduce<\n      {\n        activeIndex: number | null\n        selected: boolean\n        disabled: boolean\n      }[]\n    >((acc, _, index) => {\n      const disabled = getItemDisabled?.(index) ?? false\n      const selected = getItemSelected?.(index) ?? false\n      if (!disabled) {\n        i += 1\n      }\n      acc[index] = {\n        activeIndex: disabled ? null : i,\n        disabled,\n        selected,\n      }\n      return acc\n    }, [])\n  }, [getItemDisabled, getItemSelected, items])\n\n  const activeItemCount = useMemo(\n    () => itemIndices.filter((v) => !v.disabled).length,\n    [itemIndices],\n  )\n\n  /**\n   * Toggle pointer overlay element which will kill existing hover states\n   */\n  const enableChildContainerPointerEvents = useCallback(\n    (enabled: boolean) =>\n      pointerOverlayElement?.setAttribute('data-enabled', (!enabled).toString()),\n    [pointerOverlayElement],\n  )\n\n  const getChildDescendantId = useCallback(\n    (index: number) => `${commandListId.current}-item-${index}`,\n    [],\n  )\n\n  const getCommandListChildrenId = useCallback(() => `${commandListId.current}-children`, [])\n\n  /**\n   * Iterate through all virtual list children and apply the active data-attribute on the selected index.\n   * Don't apply styles when `hideSelectionOnMouseLeave` is true and the command list is neither focused or hovered.\n   */\n  const showChildrenActiveState = useCallback(() => {\n    const hasFocus = [inputElement, virtualListElement].some((el) => document.activeElement === el)\n    if (onlyShowSelectionWhenActive && !hasFocus && !hovered) {\n      return\n    }\n\n    const childElements = Array.from(childContainerElement?.children || []) as HTMLElement[]\n    childElements?.forEach((child) => {\n      const virtualIndex = Number(child.dataset?.index)\n      const targetIndex = itemIndices[virtualIndex]?.activeIndex\n      child\n        .querySelector(LIST_ITEM_INTERACTIVE_SELECTOR)\n        ?.toggleAttribute(activeItemDataAttr, targetIndex === activeIndexRef.current)\n    })\n  }, [\n    activeItemDataAttr,\n    childContainerElement?.children,\n    hovered,\n    inputElement,\n    itemIndices,\n    onlyShowSelectionWhenActive,\n    virtualListElement,\n  ])\n\n  /**\n   * Iterate through all virtual list children and clear the active data-attribute.\n   */\n  const hideChildrenActiveState = useCallback(() => {\n    const childElements = Array.from(childContainerElement?.children || [])\n    childElements?.forEach((child) => {\n      child\n        .querySelector(LIST_ITEM_INTERACTIVE_SELECTOR)\n        ?.toggleAttribute(activeItemDataAttr, false)\n    })\n  }, [activeItemDataAttr, childContainerElement?.children])\n\n  /**\n   * Throttled version of `showChildrenActiveState`, used when DOM mutations are detected in virtual lists\n   */\n  const refreshChildrenActiveStateThrottled = useMemo(() => {\n    return throttle(showChildrenActiveState, 200)\n  }, [showChildrenActiveState])\n\n  /**\n   * Assign active descendant on input element (if present)\n   */\n  const handleUpdateActiveDescendant = useCallback(() => {\n    const activeIndex = activeIndexRef?.current\n    if (items.length > 0) {\n      inputElement?.setAttribute('aria-activedescendant', getChildDescendantId(activeIndex))\n      virtualListElement?.setAttribute('aria-activedescendant', getChildDescendantId(activeIndex))\n    } else {\n      inputElement?.removeAttribute('aria-activedescendant')\n      virtualListElement?.removeAttribute('aria-activedescendant')\n    }\n  }, [getChildDescendantId, inputElement, items.length, virtualListElement])\n\n  /**\n   * Obtain index of the top most visible element\n   */\n  const handleGetTopIndex = useCallback(() => {\n    const childContainerParentElement = childContainerElement?.parentElement\n    if (childContainerElement && childContainerParentElement) {\n      const offset =\n        childContainerParentElement.getBoundingClientRect().top -\n        childContainerElement.getBoundingClientRect().top\n      return virtualizer.getVirtualItemForOffset(offset)?.index ?? -1\n    }\n    return -1\n  }, [childContainerElement, virtualizer])\n\n  /**\n   * Mark an index as active, re-assign aria attrs on all children and optionally scroll into view\n   */\n  const setActiveIndex = useCallback(\n    ({\n      index,\n      scrollAlign,\n      scrollIntoView = true,\n    }: {\n      index: number\n      scrollAlign?: ScrollToOptions['align']\n      scrollIntoView?: boolean\n    }) => {\n      activeIndexRef.current = index\n      handleUpdateActiveDescendant()\n      showChildrenActiveState()\n\n      if (scrollIntoView) {\n        const virtualListIndex = itemIndices.findIndex((i) => i.activeIndex === index)\n        if (virtualListIndex > -1) {\n          virtualizer.scrollToIndex(virtualListIndex, scrollAlign ? {align: scrollAlign} : {})\n        }\n      }\n    },\n    [handleUpdateActiveDescendant, itemIndices, showChildrenActiveState, virtualizer],\n  )\n\n  /**\n   * Select adjacent virtual item index and scroll into view with `react-virtual`\n   */\n  const selectAdjacentItemIndex = useCallback(\n    (direction: 'previous' | 'next') => {\n      let nextIndex = -1\n      const lastIndex = activeItemCount - 1\n\n      if (direction === 'next') {\n        const wrapAroundIndex = wrapAround ? 0 : lastIndex\n        nextIndex =\n          activeIndexRef.current < activeItemCount - 1\n            ? activeIndexRef.current + 1\n            : wrapAroundIndex\n      }\n      if (direction === 'previous') {\n        const wrapAroundIndex = wrapAround ? lastIndex : 0\n        nextIndex = activeIndexRef.current > 0 ? activeIndexRef.current - 1 : wrapAroundIndex\n      }\n      setActiveIndex({index: nextIndex, scrollIntoView: true})\n      enableChildContainerPointerEvents(false)\n    },\n    [activeItemCount, enableChildContainerPointerEvents, setActiveIndex, wrapAround],\n  )\n\n  const focusElement = useCallback(\n    (type: CommandListElementType) => {\n      switch (type) {\n        case 'input':\n          inputElement?.focus()\n          break\n        case 'list':\n          virtualListElement?.focus()\n          break\n        default:\n          break\n      }\n    },\n    [inputElement, virtualListElement],\n  )\n\n  const focusInputElement = useCallback(() => {\n    inputElement?.focus()\n  }, [inputElement])\n\n  const focusListElement = useCallback(() => {\n    virtualListElement?.focus()\n  }, [virtualListElement])\n\n  /**\n   * Mark hovered child item as active\n   */\n  const handleChildMouseEnter = useCallback(\n    (index: number) => () => {\n      setActiveIndex({index, scrollIntoView: false})\n    },\n    [setActiveIndex],\n  )\n\n  const handleFocus = useCallback(() => {\n    showChildrenActiveState()\n  }, [showChildrenActiveState])\n\n  /**\n   * Handle keyboard events:\n   * - Up/down arrow: scroll to adjacent items\n   * - Enter: trigger click events on the current active element\n   */\n  const handleKeyDown = useCallback(\n    (type: CommandListElementType) => (event: KeyboardEvent) => {\n      const childElements = Array.from(childContainerElement?.children || []) as HTMLElement[]\n      if (!childElements.length) {\n        return\n      }\n\n      if (event.key === 'ArrowDown') {\n        event.preventDefault()\n        focusElement(type)\n        selectAdjacentItemIndex('next')\n      }\n      if (event.key === 'ArrowUp') {\n        event.preventDefault()\n        focusElement(type)\n        selectAdjacentItemIndex('previous')\n      }\n\n      if (event.key === 'Enter') {\n        event.preventDefault()\n        focusElement(type)\n        const currentElement = childElements.find(\n          (el) =>\n            Number(el.dataset.index) ===\n            itemIndices.findIndex((i) => i.activeIndex === activeIndexRef.current),\n        )\n\n        if (currentElement) {\n          const clickableElement = currentElement?.querySelector<HTMLElement>(\n            LIST_ITEM_INTERACTIVE_SELECTOR,\n          )\n          clickableElement?.click()\n        }\n      }\n    },\n    [childContainerElement?.children, focusElement, itemIndices, selectAdjacentItemIndex],\n  )\n  const handleKeyDownInput = useCallback(\n    (event: KeyboardEvent) => handleKeyDown('input')(event),\n    [handleKeyDown],\n  )\n  const handleKeyDownList = useCallback(\n    (event: KeyboardEvent) => handleKeyDown('list')(event),\n    [handleKeyDown],\n  )\n\n  const handleVirtualListMouseEnter = useCallback(() => {\n    if (onlyShowSelectionWhenActive) {\n      showChildrenActiveState()\n      setHovered(true)\n    }\n  }, [onlyShowSelectionWhenActive, showChildrenActiveState])\n  const handleVirtualListMouseLeave = useCallback(() => {\n    if (onlyShowSelectionWhenActive) {\n      hideChildrenActiveState()\n      setHovered(false)\n    }\n  }, [hideChildrenActiveState, onlyShowSelectionWhenActive])\n\n  useImperativeHandle(\n    ref,\n    () => {\n      return {\n        focusInputElement() {\n          focusInputElement()\n        },\n        focusListElement() {\n          focusListElement()\n        },\n        getTopIndex() {\n          return handleGetTopIndex()\n        },\n        scrollToIndex(index: number) {\n          setActiveIndex({index})\n          enableChildContainerPointerEvents(true)\n        },\n      }\n    },\n    [\n      enableChildContainerPointerEvents,\n      focusInputElement,\n      focusListElement,\n      handleGetTopIndex,\n      setActiveIndex,\n    ],\n  )\n\n  /**\n   * Optionally set active index (and align) on mount only\n   */\n  useEffect(() => {\n    if (typeof initialIndex !== 'undefined' && !isMountedRef.current) {\n      setActiveIndex({\n        index: initialIndex,\n        scrollAlign: initialScrollAlign,\n        scrollIntoView: true,\n      })\n    }\n    isMountedRef.current = true\n  }, [initialIndex, initialScrollAlign, onlyShowSelectionWhenActive, setActiveIndex])\n\n  /**\n   * Re-enable child pointer events on any mousemove / wheel event\n   */\n  useEffect(() => {\n    function handleMouseEvent() {\n      enableChildContainerPointerEvents(true)\n    }\n    virtualListElement?.addEventListener('mousemove', handleMouseEvent)\n    virtualListElement?.addEventListener('wheel', handleMouseEvent, {passive: true})\n    return () => {\n      virtualListElement?.removeEventListener('mousemove', handleMouseEvent)\n      virtualListElement?.removeEventListener('wheel', handleMouseEvent)\n    }\n  }, [enableChildContainerPointerEvents, virtualListElement])\n\n  /**\n   * Listen to keyboard / blur / focus events on both input element (if present) and the virtual list element.\n   */\n  useEffect(() => {\n    inputElement?.addEventListener('focus', handleFocus)\n    inputElement?.addEventListener('keydown', handleKeyDownInput)\n    virtualListElement?.addEventListener('focus', handleFocus)\n    virtualListElement?.addEventListener('keydown', handleKeyDownList)\n    return () => {\n      inputElement?.removeEventListener('focus', handleFocus)\n      inputElement?.removeEventListener('keydown', handleKeyDownInput)\n      virtualListElement?.removeEventListener('focus', handleFocus)\n      virtualListElement?.removeEventListener('keydown', handleKeyDownList)\n    }\n  }, [\n    canReceiveFocus,\n    handleFocus,\n    handleKeyDown,\n    handleKeyDownInput,\n    handleKeyDownList,\n    hideChildrenActiveState,\n    inputElement,\n    showChildrenActiveState,\n    virtualListElement,\n  ])\n\n  /**\n   * Refresh selected state when item values change (as a result of filtering).\n   * This is to ensure that we correctly clear aria-activedescendant attrs if the filtered array is empty.\n   */\n  useEffect(() => {\n    handleUpdateActiveDescendant()\n  }, [handleUpdateActiveDescendant, items])\n\n  /**\n   * On DOM mutations, re-assign active descendant on input element (if present) and update active state on all children.\n   *\n   * Useful since virtual lists will constantly mutate the DOM on scroll, and we want to ensure that\n   * new elements coming into view are rendered with the correct selected state.\n   *\n   * An alternative to using MutationObserver is hooking into the `onChange` callback that `react-virtual` provides, though\n   * this changes on _every_ internal state change.\n   */\n  useEffect(() => {\n    const mutationObserver = new MutationObserver(refreshChildrenActiveStateThrottled)\n\n    if (childContainerElement) {\n      mutationObserver.observe(childContainerElement, {\n        childList: true,\n        subtree: true,\n      })\n    }\n\n    return () => {\n      mutationObserver.disconnect()\n    }\n  }, [childContainerElement, refreshChildrenActiveStateThrottled])\n\n  /**\n   * Apply input aria attributes\n   */\n  useEffect(() => {\n    inputElement?.setAttribute('aria-autocomplete', 'list')\n    inputElement?.setAttribute('aria-expanded', 'true')\n    inputElement?.setAttribute('aria-controls', getCommandListChildrenId())\n    inputElement?.setAttribute('role', 'combobox')\n  }, [getCommandListChildrenId, inputElement])\n\n  /**\n   * Focus input / virtual list element on mount\n   */\n  useEffect(() => {\n    if (autoFocus) {\n      focusElement(autoFocus)\n    }\n  }, [autoFocus, canReceiveFocus, focusListElement, focusInputElement, focusElement])\n\n  const rootTabIndex = canReceiveFocus ? 0 : -1\n\n  return (\n    <VirtualListBox\n      id={getCommandListChildrenId()}\n      onMouseEnter={handleVirtualListMouseEnter}\n      onMouseLeave={handleVirtualListMouseLeave}\n      ref={setVirtualListElement}\n      sizing=\"border\"\n      tabIndex={rootTabIndex}\n      {...responsivePaddingProps}\n    >\n      {canReceiveFocus && <FocusOverlayDiv offset={focusRingOffset} />}\n      <PointerOverlayDiv aria-hidden=\"true\" data-enabled ref={setPointerOverlayElement} />\n      {virtualizer && (\n        <VirtualListChildBox\n          forwardedAs=\"ul\"\n          $height={virtualizer.getTotalSize()}\n          aria-label={ariaLabel}\n          aria-multiselectable={ariaMultiselectable}\n          flex={1}\n          ref={setChildContainerElement}\n          role=\"listbox\"\n        >\n          {virtualizer.getVirtualItems().map((virtualRow) => {\n            const virtualIndex = virtualRow.index // visible index in the DOM\n            const {activeIndex, disabled, selected} = itemIndices[virtualIndex]\n\n            const itemToRender = renderItem(items[virtualIndex], {\n              activeIndex,\n              disabled,\n              selected,\n              virtualIndex,\n            }) as ReactElement\n\n            const clonedItem = cloneElement(itemToRender, {\n              tabIndex: -1,\n            })\n\n            const activeAriaAttributes =\n              typeof activeIndex === 'number' && !disabled\n                ? {\n                    'aria-posinset': activeIndex + 1,\n                    ...(ariaMultiselectable ? {'aria-selected': selected.toString()} : {}),\n                    'aria-setsize': activeItemCount,\n                    id: getChildDescendantId(activeIndex),\n                    role: 'option',\n                    onMouseEnter: handleChildMouseEnter(activeIndex),\n                  }\n                : {}\n\n            return (\n              <Stack\n                as=\"li\"\n                data-index={virtualIndex}\n                key={virtualRow.key}\n                ref={fixedHeight ? undefined : virtualizer.measureElement}\n                style={{\n                  flex: 1,\n                  ...(fixedHeight ? {height: `${virtualRow.size}px`} : {}),\n                  left: 0,\n                  position: 'absolute',\n                  top: 0,\n                  transform: `translateY(${virtualRow.start}px)`,\n                  width: '100%',\n                }}\n                tabIndex={-1}\n                {...activeAriaAttributes}\n              >\n                {clonedItem}\n              </Stack>\n            )\n          })}\n        </VirtualListChildBox>\n      )}\n    </VirtualListBox>\n  )\n})\n","import {EllipsisHorizontalIcon} from '@sanity/icons'\nimport {type ForwardedRef, forwardRef, type HTMLProps} from 'react'\n\nimport {Button, type ButtonProps} from '../../../ui-components'\nimport {useTranslation} from '../..'\n\ntype ContextMenuButtonProps = Pick<\n  ButtonProps,\n  'mode' | 'paddingY' | 'size' | 'tone' | 'tooltipProps'\n>\n\n/**\n * Simple context menu button (with horizontal ellipsis icon) with shared localization.\n *\n * @internal\n */\nexport const ContextMenuButton = forwardRef(function ContextMenuButton(\n  props: ContextMenuButtonProps &\n    Pick<HTMLProps<HTMLButtonElement>, 'disabled' | 'hidden' | 'onClick'>,\n  ref: ForwardedRef<HTMLButtonElement>,\n) {\n  const {mode = 'bleed', tooltipProps, tone, ...rest} = props\n\n  const {t} = useTranslation()\n\n  return (\n    <Button\n      {...rest}\n      icon={EllipsisHorizontalIcon}\n      mode={mode}\n      ref={ref}\n      tone={tone}\n      tooltipProps={{\n        ...tooltipProps,\n        content: tooltipProps?.content || t('common.context-menu-button.tooltip'),\n      }}\n    />\n  )\n})\n","import {type WorkspaceLike} from './types'\n\n/**\n * Gets a printable identifer for the workspace - either the name, or the index\n * and any potential title set for it\n *\n * @param workspace - The workspace to get the indentifier for\n * @param index - The index at which the workspace appeared in the source array\n * @returns Printable string (eg `intranet`, or `at index 5 (titled \"Intranet\")`)\n * @internal\n */\nexport function getWorkspaceIdentifier({name, title}: WorkspaceLike, index: number): string {\n  if (typeof name === 'string' && name.trim().length > 0) {\n    return name\n  }\n\n  return getNamelessWorkspaceIdentifier(title, index)\n}\n\n/** @internal */\nexport function getNamelessWorkspaceIdentifier(title: string | undefined, index: number): string {\n  const withTitle =\n    typeof title === 'string' && title.trim().length > 0 ? ` (titled \"${title}\")` : ''\n  return `at index ${index}${withTitle}`\n}\n","import {createContext} from 'react'\n\nimport {type WorkspaceSummary} from '../../config'\n\n/** @internal */\nexport type WorkspacesContextValue = WorkspaceSummary[]\n\n/** @internal */\nexport const WorkspacesContext = createContext<WorkspacesContextValue | null>(null)\n","import {useContext} from 'react'\n\nimport {type WorkspaceSummary} from '../../config'\nimport {WorkspacesContext} from './WorkspacesContext'\n\n/** @internal */\nexport function useWorkspaces(): WorkspaceSummary[] {\n  const workspaces = useContext(WorkspacesContext)\n  if (!workspaces) throw new Error('Could not find `workspaces` context')\n  return workspaces\n}\n","import {getWorkspaceIdentifier} from './helpers'\nimport {type WorkspaceLike} from './types'\n\nexport interface WorkspaceValidationErrorOptions {\n  workspace: WorkspaceLike\n  index: number\n}\n\n/**\n * Thrown on workspace validation errors. Includes an identifier that is either the name of\n * the workspace, or in the case of a missing or invalid name, an index and a potential title\n */\nexport class WorkspaceValidationError extends Error {\n  index?: number\n  identifier?: string\n\n  constructor(message: string, options?: WorkspaceValidationErrorOptions) {\n    super(message)\n    this.index = options?.index\n    this.identifier = options?.workspace && getWorkspaceIdentifier(options.workspace, options.index)\n  }\n}\n","import {getNamelessWorkspaceIdentifier, getWorkspaceIdentifier} from './helpers'\nimport {type WorkspaceLike} from './types'\nimport {WorkspaceValidationError} from './WorkspaceValidationError'\n\n/** @internal */\nexport interface ValidateWorkspaceOptions {\n  workspaces: WorkspaceLike[]\n}\n\n/**\n * Validates workspace configuration, throwing if:\n *\n * - Workspaces do not all have base paths and names (if multiple given)\n * - Base paths or names are invalid\n * - Base paths or names are not unique\n *\n * @internal\n */\nexport function validateWorkspaces({workspaces}: ValidateWorkspaceOptions): void {\n  if (workspaces.length === 0) {\n    throw new WorkspaceValidationError('At least one workspace is required.')\n  }\n\n  validateNames(workspaces)\n  validateBasePaths(workspaces)\n}\n\n/**\n * Validates the workspace names of every workspace\n * Only exported for testing purposes\n *\n * @param workspaces - An array of workspaces\n * @internal\n */\nexport function validateNames(workspaces: WorkspaceLike[]): void {\n  const isSingleWorkspace = workspaces.length === 1\n  const names = new Map<string, {index: number; workspace: WorkspaceLike}>()\n  workspaces.forEach((workspace, index) => {\n    const {name: rawName, title} = workspace\n    const thisIdentifier = getNamelessWorkspaceIdentifier(title, index)\n\n    if (!rawName && !isSingleWorkspace) {\n      throw new WorkspaceValidationError(\n        'All workspaces must have a `name`, unless only a single workspace is defined. ' +\n          `Workspace ${thisIdentifier} did not define a \\`name\\`.`,\n        {workspace, index},\n      )\n    }\n\n    const name = isSingleWorkspace && typeof rawName === 'undefined' ? 'default' : rawName\n\n    if (typeof name !== 'string') {\n      throw new WorkspaceValidationError(\n        `Workspace at index ${index} defined an invalid \\`name\\` - must be a string.`,\n        {workspace, index},\n      )\n    }\n\n    const normalized = name.toLowerCase()\n    const existingWorkspace = names.get(normalized)\n\n    if (existingWorkspace) {\n      const prevIdentifier = getNamelessWorkspaceIdentifier(\n        existingWorkspace.workspace.title,\n        existingWorkspace.index,\n      )\n      throw new WorkspaceValidationError(\n        `\\`name\\`s must be unique. Workspace ${prevIdentifier} and ` +\n          `workspace ${thisIdentifier} both have the \\`name\\` \\`${name}\\``,\n        {workspace, index},\n      )\n    }\n\n    names.set(normalized, {index, workspace})\n\n    if (!/^[a-z0-9][a-z0-9_-]*$/i.test(name)) {\n      throw new WorkspaceValidationError(\n        `All workspace \\`name\\`s must consist of only a-z, 0-9, underscore and dashes, ` +\n          `and cannot begin with an underscore or dash. ` +\n          `Workspace ${thisIdentifier} has the invalid name \\`${name}\\``,\n        {workspace, index},\n      )\n    }\n  })\n}\n\n/**\n * Validates the base paths of every workspace\n * Only exported for testing purposes\n *\n * @param workspaces - An array of workspaces\n * @internal\n */\nexport function validateBasePaths(workspaces: WorkspaceLike[]): void {\n  // If we have more than a single workspace, every workspace needs a basepath\n  if (workspaces.length > 1) {\n    workspaces.every(hasBasePath) // Throws on missing basePath\n  }\n\n  workspaces.every(validateBasePath)\n\n  const [firstWorkspace, ...restOfWorkspaces] = workspaces\n  const firstWorkspaceSegmentCount = (firstWorkspace.basePath || '/')\n    // remove starting slash before splitting\n    .substring(1)\n    .split('/')\n    .filter(Boolean).length\n\n  restOfWorkspaces.forEach((workspace, index) => {\n    const workspaceSegmentCount = (workspace.basePath || '/')\n      // remove starting slash before splitting\n      .substring(1)\n      .split('/').length\n\n    if (firstWorkspaceSegmentCount !== workspaceSegmentCount) {\n      throw new WorkspaceValidationError(\n        `All workspace \\`basePath\\`s must have the same amount of segments. Workspace \\`${getWorkspaceIdentifier(\n          firstWorkspace,\n          index,\n        )}\\` had ${firstWorkspaceSegmentCount} segment${\n          firstWorkspaceSegmentCount === 1 ? '' : 's'\n        } \\`${firstWorkspace.basePath}\\` but workspace \\`${getWorkspaceIdentifier(\n          workspace,\n          index,\n        )}\\` had ${workspaceSegmentCount} segment${workspaceSegmentCount === 1 ? '' : 's'} \\`${\n          workspace.basePath\n        }\\``,\n        {workspace, index},\n      )\n    }\n  })\n\n  const basePaths = new Map<string, string>()\n  workspaces.forEach((workspace, index) => {\n    const basePath = (workspace.basePath || '').toLowerCase()\n\n    const existingWorkspace = basePaths.get(basePath)\n    if (existingWorkspace) {\n      throw new WorkspaceValidationError(\n        `\\`basePath\\`s must be unique. Workspaces \\`${existingWorkspace}\\` and ` +\n          `\\`${getWorkspaceIdentifier(\n            workspace,\n            index,\n          )}\\` both have the \\`basePath\\` \\`${basePath}\\``,\n        {workspace, index},\n      )\n    }\n\n    basePaths.set(basePath, getWorkspaceIdentifier(workspace, index))\n  })\n}\n\nfunction hasBasePath(workspace: WorkspaceLike, index: number) {\n  const {name, basePath} = workspace\n  if (basePath && typeof basePath === 'string') {\n    return true\n  }\n\n  if (typeof basePath === 'undefined') {\n    throw new WorkspaceValidationError(\n      `If more than one workspace is defined, every workspace must have a \\`basePath\\` defined. ` +\n        `Workspace \\`${name}\\` is missing a \\`basePath\\``,\n      {workspace, index},\n    )\n  }\n\n  throw new WorkspaceValidationError(\n    `If more than one workspace is defined, every workspace must have a \\`basePath\\` defined. ` +\n      `Workspace \\`${name}\\` has an invalid \\`basePath\\` (must be a non-empty string)`,\n    {workspace, index},\n  )\n}\n\nfunction validateBasePath(workspace: WorkspaceLike, index: number) {\n  const {name, basePath} = workspace\n\n  // Empty base paths are okay (we're validating uniqueness and presence on more\n  // than a single workspace in `validateBasePaths`)\n  if (!basePath || basePath === '/') {\n    return\n  }\n\n  if (!/^\\/[a-z0-9/_-]*[a-z0-9_-]+$/i.test(basePath)) {\n    throw new WorkspaceValidationError(\n      `All workspace \\`basePath\\`s must start with a leading \\`/\\`, ` +\n        `consist of only URL safe characters, ` +\n        `and cannot end with a trailing \\`/\\`. ` +\n        `Workspace \\`${name}\\`'s basePath is \\`${basePath}\\``,\n      {workspace, index},\n    )\n  }\n}\n","/* eslint-disable @typescript-eslint/ban-types */\nimport {type ComponentType, createElement, Fragment, useMemo} from 'react'\n\nimport {flattenConfig} from '../../config'\nimport {useSource} from '../../studio'\nimport {type PluginOptions} from '../types'\n\nconst emptyRender = () => createElement(Fragment)\n\nfunction _createMiddlewareComponent<T extends {}>(\n  defaultComponent: ComponentType<T>,\n  middlewareComponents: ComponentType<T>[],\n): ComponentType<T> {\n  return (outerProps: T) => {\n    // This is the inner \"layer\" of the middleware chain\n    // Here we render the _default_ component (typically Sanity's component)\n    let next = (props: T) => createElement(defaultComponent, props)\n\n    for (const middleware of middlewareComponents) {\n      // As we progress through the chain, the meaning of \"renderDefault\" changes.\n      // At a given layer in the chain, the _next_ layer is the \"default\".\n      const renderDefault = next\n\n      // Here we replace `next` so that the _previous_ layer may use this as its _next_.\n      next = (props) => createElement(middleware, {...props, renderDefault})\n    }\n\n    return next({\n      ...outerProps,\n      // NOTE: it's safe to pass the empty render function, since it'll be overwritten in the next step (above).\n      // NOTE: it's important that the default component does not use `renderDefault`, since it will\n      // get the `emptyRender` callback will be passed when the middleware stack is empty.\n      renderDefault: emptyRender,\n    })\n  }\n}\n\n/**\n * @internal\n * This hook returns a component based on the Components API middleware chain.\n *\n * - The `pick` function is used to select a component from the provided plugin options in the configuration.\n * - The `defaultComponent` is the default component that gets rendered with `renderDefault`.\n *   The `renderDefault` function is added to the props of the middleware components so that they can render the default\n *   component and continue the middleware chain.\n *\n * @example\n * Example usage of:\n *\n * ```ts\n *  const StudioLayout = useMiddlewareComponents({\n *   pick: (plugin) => plugin.studio?.components?.layout,\n *   defaultComponent: StudioLayout,\n *  })\n *\n * return <StudioLayout />\n *```\n */\nexport function useMiddlewareComponents<T extends {}>(props: {\n  pick: (plugin: PluginOptions) => ComponentType<T>\n  defaultComponent: ComponentType<T>\n}): ComponentType<T> {\n  const {options} = useSource().__internal\n  const {defaultComponent, pick} = props\n\n  return useMemo(() => {\n    // Flatten the config tree into a list of configs\n    const flattened = [...flattenConfig(options, [])]\n\n    // Since the middleware chain is executed backwards, we need to reverse the list of configs here.\n    // This is important because we want the order of the Components API to be consistent with the order of the other APIs.\n    flattened.reverse()\n\n    // Pick the middleware components from the configs\n    const pickedComponents = flattened.map(({config}) => pick(config))\n\n    // Since we try to pick the components in all configs, some results may be undefined.\n    // Therefore, we filter these values out before passing the result to the middleware creator.\n    const result = pickedComponents.filter(Boolean)\n\n    // Create the middleware component\n    return _createMiddlewareComponent(defaultComponent, result)\n  }, [defaultComponent, options, pick])\n}\n","import {isRecord} from '../util'\n\n/** @internal */\nexport interface ConfigPropertyErrorOptions {\n  propertyName: string\n  path: string[]\n  cause: unknown\n}\n\n/** @internal */\nexport class ConfigPropertyError extends Error {\n  propertyName: string\n  path: string[]\n  cause: unknown\n\n  constructor({propertyName, path, cause}: ConfigPropertyErrorOptions) {\n    const message =\n      isRecord(cause) && typeof cause?.message === 'string' ? `: ${cause.message}` : ''\n\n    super(\n      `An error occurred while resolving \\`${propertyName}\\` from ${path.join(' > ')}${message}`,\n    )\n\n    this.propertyName = propertyName\n    this.cause = cause\n    this.path = path\n  }\n}\n","import {isRecord} from '../util'\n\n/** @internal */\nexport interface ConfigResolutionErrorOptions {\n  name: string\n  type: string\n  causes: Array<ConfigResolutionError | Error | unknown>\n}\n\n/** @internal */\nexport class ConfigResolutionError extends Error {\n  name: string\n  type: string\n  causes: unknown[]\n\n  constructor({causes, name, type}: ConfigResolutionErrorOptions) {\n    const messages = causes\n      .filter(Boolean)\n      .map((cause) =>\n        isRecord(cause) && typeof cause?.message === 'string' ? cause.message : String(cause),\n      )\n\n    super(\n      `Could not resolve ${type}${name ? ` \\`${name}\\`` : ''}:\\n${messages\n        .map((message) => `\\t- ${message}`)\n        .join('\\n')}\\n\\n`,\n    )\n\n    this.name = name\n    this.causes = causes\n    this.type = type\n  }\n}\n","import {type ConfigPropertyReducer} from '../../types'\nimport {type DocumentFieldAction, type DocumentFieldActionsResolverContext} from './types'\n\n/** @internal */\nexport const documentFieldActionsReducer: ConfigPropertyReducer<\n  DocumentFieldAction[],\n  DocumentFieldActionsResolverContext\n> = (prev, {document}, context) => {\n  const documentFieldActions = document?.unstable_fieldActions\n  if (!documentFieldActions) return prev\n\n  if (typeof documentFieldActions === 'function') return documentFieldActions(prev, context)\n  if (Array.isArray(documentFieldActions)) return [...prev, ...documentFieldActions]\n\n  throw new Error(\n    `Expected \\`document.unstable_fieldActions\\` to be an array or a function, but received ${typeof documentFieldActions}`,\n  )\n}\n","import {type DocumentFieldAction} from './types'\n\nexport * from './define'\nexport * from './reducer'\nexport * from './types'\n\n/** @internal */\nexport const initialDocumentFieldActions: DocumentFieldAction[] = []\n","import {type PluginOptions} from './types'\n\n/**\n * @internal\n *\n * This function flattens the config tree into a list of configs in the order they should be applied.\n */\nexport const flattenConfig = (\n  {plugins = [], ...currentConfig}: PluginOptions,\n  path: string[],\n): Array<{config: PluginOptions; path: string[]}> => {\n  // The APIs used at the root config level\n  const rootConfig = {config: currentConfig, path: [...path, currentConfig.name]}\n\n  // An array with the APIs used in plugins\n  const allPlugins = plugins.flatMap((plugin) =>\n    flattenConfig(plugin, [...path, currentConfig.name]),\n  )\n\n  // We need to check if the task plugin was added, it could be inserted more than once, in that case we only want to add it once.\n  const tasksPlugin = allPlugins.find((plugin) => plugin.config.name === 'sanity/tasks')\n\n  const resolved = [\n    ...allPlugins.filter((plugin) => plugin.config.name !== 'sanity/tasks'),\n    rootConfig,\n  ]\n\n  if (tasksPlugin) {\n    resolved.push(tasksPlugin)\n  }\n  return resolved\n}\n","import {Card, Layer, Spinner, Text} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nimport {useTranslation} from '../..'\n\n// Enable to force debug background\nconst DEBUG_MODE = false\n\n// Duration to wait before initial spinner appears\nconst SPINNER_DELAY = 750 // ms\n\n// Duration to wait before text appears (if enabled)\nconst TEXT_DELAY = 2000 // ms\n\ninterface LoadingTestProps {\n  /** Absolutely positions this component when `true`. */\n  fill?: boolean\n  /** Optionally show loading title. If `true`, both text and spinner will appear and animate after an initial delay */\n  showText?: boolean\n  /**\n   * Text to display underneath the spinner.  If omitted, will default to `'Loading'`.\n   * If providing a value, avoid using trailing ellipses.\n   *\n   * @defaultValue `'Loading'`\n   */\n  title?: string | null\n}\n\nconst StyledCard = styled(Card)<{$fill?: boolean}>(({$fill}) => {\n  return css`\n    align-items: center;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n\n    ${$fill\n      ? css`\n          bottom: 0;\n          height: 100%;\n          left: 0;\n          position: absolute;\n          right: 0;\n          top: 0;\n          width: 100%;\n        `\n      : css`\n          min-height: 75px;\n          height: stretch;\n          height: -webkit-fill-available;\n          width: stretch;\n          width: -webkit-fill-available;\n        `}\n\n    ${DEBUG_MODE &&\n    css`\n      background: linear-gradient(#5555ca, #daf9f9);\n      border: 2px solid black;\n      > * {\n        mix-blend-mode: multiply;\n      }\n    `}\n\n    > * {\n      position: absolute;\n    }\n  `\n})\n\nconst StyledSpinner = styled(Spinner)<{$animatePosition: boolean}>(({$animatePosition = true}) => {\n  return css`\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n      }\n      to {\n        opacity: 1;\n      }\n    }\n    @keyframes slideUp {\n      from {\n        transform: translateY(0);\n      }\n      to {\n        transform: translateY(-15px);\n      }\n    }\n    animation: ${$animatePosition\n      ? `500ms ease-out ${SPINNER_DELAY}ms 1 normal both running fadeIn, 750ms ease-out ${TEXT_DELAY}ms 1 normal both running slideUp`\n      : `500ms ease-out ${SPINNER_DELAY}ms 1 normal both running fadeIn`};\n  `\n})\n\nconst StyledText = styled(Text)`\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n  @keyframes slideDown {\n    from {\n      transform: translateY(0);\n    }\n    to {\n      transform: translateY(15px);\n    }\n  }\n  animation:\n    1500ms ease-out ${TEXT_DELAY}ms 1 normal both running fadeIn,\n    750ms ease-out ${TEXT_DELAY}ms 1 normal both running slideDown;\n`\n\n/**\n * A generic loading container which displays a spinner and text.\n * The spinner won't initially be visible and fades in after a short delay.\n *\n * @internal\n */\nexport function LoadingBlock({fill, showText, title}: LoadingTestProps) {\n  return (\n    <StyledCard $fill={fill} as={fill ? Layer : 'div'}>\n      <StyledSpinner $animatePosition={!!showText} muted />\n      {showText && <LoadingText title={title} />}\n    </StyledCard>\n  )\n}\n\nfunction LoadingText({title}: {title?: string | null}) {\n  const {t} = useTranslation()\n\n  return (\n    <StyledText muted size={1}>\n      {title || t('common.loading')}\n    </StyledText>\n  )\n}\n","import {\n  type ImplicitLocaleResourceBundle,\n  type LocaleDefinition,\n  type LocaleResourceBundle,\n  type StaticLocaleResourceBundle,\n} from './types'\n\n/**\n * Defines a resource bundle for a given locale and namespace.\n *\n * @param bundle - The bundle of resources to define\n * @returns The bundle that was passed, as-is (this is an \"identity function\")\n * @public\n */\nexport function defineLocaleResourceBundle(bundle: LocaleResourceBundle): LocaleResourceBundle {\n  return bundle\n}\n\n/**\n * Defines a locale and makes it available for use in the studio.\n *\n * @param locale - The locale to define\n * @returns The locale that was passed, as-is (this is an \"identity function\")\n * @public\n */\nexport function defineLocale(locale: LocaleDefinition): LocaleDefinition {\n  return locale\n}\n\n/**\n * Checks whether or not the given resource bundle has static resources, eg is not lazy loaded.\n *\n * @param bundle - Bundle to check\n * @returns `true` if the bundle has static resources, `false` otherwise\n * @internal\n * @hidden\n */\nexport function isStaticResourceBundle(\n  bundle: LocaleResourceBundle | StaticLocaleResourceBundle | ImplicitLocaleResourceBundle,\n): bundle is StaticLocaleResourceBundle {\n  return !('then' in bundle.resources && typeof bundle.resources.then === 'function')\n}\n\n/**\n * Internal helper for definining resources for a given namespace.\n *\n * Used for automation (finding the officially defined namespaces and keys), and potentially in\n * the future for type safety/helpers.\n *\n * @param resources - Resources to define\n * @returns The resources that was passed, as-is (this is an \"identity function\")\n * @deprecated Sanity-internal helper, don't use in external code\n * @internal\n * @hidden\n */\nexport function defineLocalesResources<R extends Record<string, string>>(\n  namespace: string,\n  resources: R,\n): R {\n  return resources\n}\n\n/**\n * Removes any values that are undefined from the given object.\n *\n * This is used to remove any placeholders from the generated files, while being able to leave them\n * in place to ease spotting the missing translations.\n *\n * @param resources - The resources to remove undefined values from\n * @returns The resources without any undefined values\n * @public\n * @hidden\n */\nexport function removeUndefinedLocaleResources<T extends {[key: string]: string | undefined}>(\n  resources: T,\n): {[K in keyof T]: Exclude<T[K], undefined>} {\n  const result: Partial<T> = {}\n\n  for (const key in resources) {\n    if (typeof resources[key] !== 'undefined') {\n      result[key] = resources[key]\n    }\n  }\n\n  return result as {[K in keyof T]: Exclude<T[K], undefined>}\n}\n","/**\n * The locale namespace for the studio core.\n *\n * @internal\n * @hidden\n */\nexport const studioLocaleNamespace = 'studio' as const\n\n/**\n * The namespace for validation messages.\n *\n * @internal\n * @hidden\n */\nexport const validationLocaleNamespace = 'validation' as const\n","/* eslint sort-keys: \"error\" */\nimport {defineLocaleResourceBundle, defineLocalesResources} from '../helpers'\nimport {studioLocaleNamespace} from '../localeNamespaces'\n\n/**\n * The string resources for the studio core.\n *\n * @internal\n * @hidden\n */\nexport const studioLocaleStrings = defineLocalesResources('studio', {\n  /** Menu item for deleting the asset */\n  'asset-source.asset-list.menu.delete': 'Delete',\n  /** Menu item for showing where a particular asset is used */\n  'asset-source.asset-list.menu.show-usage': 'Show usage',\n  /** Header in usage dialog for file assets */\n  'asset-source.asset-usage-dialog.header_file': 'Documents using file',\n  /** Header in usage dialog for image assets */\n  'asset-source.asset-usage-dialog.header_image': 'Documents using image',\n  /** Text shown in usage dialog when loading documents using the selected asset */\n  'asset-source.asset-usage-dialog.loading': 'Loading',\n  /** Text for cancel action in delete-asset dialog */\n  'asset-source.delete-dialog.action.cancel': 'Cancel',\n  /** Text for \"confirm delete\" action in delete-asset dialog */\n  'asset-source.delete-dialog.action.delete': 'Delete',\n  /** Dialog header for delete-asset dialog when deleting a file */\n  'asset-source.delete-dialog.header_file': 'Delete file',\n  /** Dialog header for delete-asset dialog when deleting an image */\n  'asset-source.delete-dialog.header_image': 'Delete image',\n  /** Text shown in delete dialog when loading documents using the selected asset */\n  'asset-source.delete-dialog.loading': 'Loading',\n  /** Message confirming to delete *named* file */\n  'asset-source.delete-dialog.usage-list.confirm-delete-file_named':\n    'You are about to delete the file <strong>{{filename}}}</strong> and its metadata. Are you sure?',\n  /** Message confirming to delete *unnamed* file */\n  'asset-source.delete-dialog.usage-list.confirm-delete-file_unnamed':\n    'You are about to delete the file and its metadata. Are you sure?',\n  /** Message confirming to delete *named* image */\n  'asset-source.delete-dialog.usage-list.confirm-delete-image_named':\n    'You are about to delete the image <strong>{{filename}}</strong> and its metadata. Are you sure?',\n  /** Message confirming to delete *unnamed* image */\n  'asset-source.delete-dialog.usage-list.confirm-delete-image_unnamed':\n    'You are about to delete the image and its metadata. Are you sure?',\n  /** Alt text showing on image preview in delete asset dialog  */\n  'asset-source.delete-dialog.usage-list.image-preview-alt': 'Preview of image',\n  /** Warning message showing when *named* file can't be deleted because it is in use */\n  'asset-source.delete-dialog.usage-list.warning-file-is-in-use_named':\n    \"{{filename}} cannot be deleted because it's being used. In order to delete this file, you first need to remove all uses of it.\",\n  /** Warning message showing when *unnamed* file can't be deleted because it is in use */\n  'asset-source.delete-dialog.usage-list.warning-file-is-in-use_unnamed':\n    \"This file cannot be deleted because it's being used. In order to delete it, you first need to remove all uses of it.\",\n  /** Warning message showing when *named* image can't be deleted because it is in use */\n  'asset-source.delete-dialog.usage-list.warning-image-is-in-use_named':\n    \"{{filename}} cannot be deleted because it's being used. In order to delete this image, you first need to remove all uses of it.\",\n  /** Warning message showing when *unnamed* image can't be deleted because it is in use */\n  'asset-source.delete-dialog.usage-list.warning-image-is-in-use_unnamed':\n    \"This image cannot be deleted because it's being used. In order to delete it, you first need to remove all uses of it.\",\n  /** Text shown when the list of assets only include a specific set of types */\n  'asset-source.dialog.accept-message':\n    'Only showing assets of accepted types: <strong>{{acceptTypes}}</strong>',\n  /** Keys shared between both image asset source and file asset source */\n  /** Select asset dialog title for files */\n  'asset-source.dialog.default-title_file': 'Select file',\n  /** Select asset dialog title for images */\n  'asset-source.dialog.default-title_image': 'Select image',\n  /** Select asset dialog load more items */\n  'asset-source.dialog.load-more': 'Load more',\n  /** Text shown when selecting a file but there's no files to select from */\n  'asset-source.dialog.no-assets_file': 'No files',\n  /** Text shown when selecting an image but there's no images to select from */\n  'asset-source.dialog.no-assets_image': 'No images',\n  'asset-source.file.asset-list.action.delete.disabled-cannot-delete-current-file':\n    'Cannot delete currently selected file',\n  'asset-source.file.asset-list.action.delete.text': 'Delete',\n  'asset-source.file.asset-list.action.delete.title': 'Delete file',\n  'asset-source.file.asset-list.action.select-file.title': 'Select the file {{filename}}',\n  'asset-source.file.asset-list.action.show-usage.title': 'Show usage',\n  'asset-source.file.asset-list.delete-failed': 'File could not be deleted',\n  'asset-source.file.asset-list.delete-successful': 'File was deleted',\n  'asset-source.file.asset-list.header.date-added': 'Date added',\n  /** File asset source */\n  'asset-source.file.asset-list.header.filename': 'Filename',\n  'asset-source.file.asset-list.header.size': 'Size',\n  'asset-source.file.asset-list.header.type': 'Type',\n  /** Text displayed on button or menu invoking the file asset source */\n  'asset-source.file.title': 'Uploaded files',\n  'asset-source.image.asset-list.delete-failed': 'Image could not be deleted',\n  /** Image asset source */\n  'asset-source.image.asset-list.delete-successful': 'Image was deleted',\n  /** Text displayed on button or menu invoking the image asset source */\n  'asset-source.image.title': 'Uploaded images',\n  'asset-source.usage-list.documents-using-file_named_one':\n    'One document is using file <code>{{filename}}</code>',\n  'asset-source.usage-list.documents-using-file_named_other':\n    '{{count}} documents are using file <code>{{filename}}</code>',\n  /** Text shown in usage dialog for a file asset when there are zero, one or more documents using the *named* file **/\n  'asset-source.usage-list.documents-using-file_named_zero':\n    'No documents are using file <code>{{filename}}</code>',\n  'asset-source.usage-list.documents-using-file_unnamed_one': 'One document is using this file',\n  'asset-source.usage-list.documents-using-file_unnamed_other':\n    '{{count}} documents are using this file',\n  /** Text shown in usage dialog for a file asset when there are zero, one or more documents using the *unnamed* file **/\n  'asset-source.usage-list.documents-using-file_unnamed_zero': 'No documents are using this file',\n  'asset-source.usage-list.documents-using-image_named_one':\n    'One document is using image <code>{{filename}}</code>',\n  'asset-source.usage-list.documents-using-image_named_other':\n    '{{count}} documents are using image <code>{{filename}}</code>',\n  /** Text shown in usage dialog for an image asset when there are zero, one or more documents using the *named* image **/\n  'asset-source.usage-list.documents-using-image_named_zero':\n    'No documents are using image <code>{{filename}}</code>',\n  'asset-source.usage-list.documents-using-image_unnamed_one': 'One document is using this image',\n  'asset-source.usage-list.documents-using-image_unnamed_other':\n    '{{count}} documents are using this image',\n  /** Text shown in usage dialog for an image asset when there are zero, one or more documents using the *unnamed* image **/\n  'asset-source.usage-list.documents-using-image_unnamed_zero': 'No documents are using this image',\n\n  /** Action message for navigating to next month */\n  'calendar.action.go-to-next-month': 'Go to next month',\n  /** Action message for navigating to next year */\n  'calendar.action.go-to-next-year': 'Go to next year',\n  /** Action message for navigating to previous month */\n  'calendar.action.go-to-previous-month': 'Go to previous month',\n  /** Action message for navigating to previous year */\n  'calendar.action.go-to-previous-year': 'Go to previous year',\n  /* Label for navigating the calendar to \"today\", without _selecting_ today. Short form, eg `Today`, not `Go to today` */\n  'calendar.action.go-to-today': 'Today',\n  /* Accessibility label for navigating the calendar to \"today\", without _selecting_ today */\n  'calendar.action.go-to-today-aria-label': 'Go to today',\n  /* Label for navigating the calendar to \"tomorrow\", without _selecting_ tomorrow. Short form, eg `Tomorrow`, not `Go to tomorrow` */\n  'calendar.action.go-to-tomorrow': 'Tomorrow',\n  /* Label for navigating the calendar to \"yesterday\", without _selecting_ yesterday. Short form, eg `Yesterday`, not `Go to yesterday` */\n  'calendar.action.go-to-yesterday': 'Yesterday',\n  /** Label for switch that controls whether or not to include time in given timestamp */\n  'calendar.action.include-time-label': 'Include time',\n  /** Action message for selecting the hour */\n  'calendar.action.select-hour': 'Select hour',\n  /** Action message for selecting the minute */\n  'calendar.action.select-minute': 'Select minute',\n  /** Action message for setting to the current time */\n  'calendar.action.set-to-current-time': 'Set to current time',\n  /** Label for selecting an hour preset. Receives a `time` param as a string on hh:mm format and a `date` param as a Date instance denoting the preset date */\n  'calendar.action.set-to-time-preset': '{{time}} on {{date, datetime}}',\n  /** Error message displayed in calendar when entered date is not the correct format */\n  'calendar.error.must-be-in-format': 'Must be in the format: {{exampleDate}}',\n  /** Month name for April */\n  'calendar.month-names.april': 'April',\n  /** Month name for August */\n  'calendar.month-names.august': 'August',\n  /** Month name for December */\n  'calendar.month-names.december': 'December',\n  /** Month name for February */\n  'calendar.month-names.february': 'February',\n  /** Month name for January */\n  'calendar.month-names.january': 'January',\n  /** Month name for July */\n  'calendar.month-names.july': 'July',\n  /** Month name for June */\n  'calendar.month-names.june': 'June',\n  /** Month name for March */\n  'calendar.month-names.march': 'March',\n  /** Month name for May */\n  'calendar.month-names.may': 'May',\n  /** Month name for November */\n  'calendar.month-names.november': 'November',\n  /** Month name for October */\n  'calendar.month-names.october': 'October',\n  /** Month name for September */\n  'calendar.month-names.september': 'September',\n  /** Short weekday name for Friday */\n  'calendar.weekday-names.short.friday': 'Fri',\n  /** Short weekday name for Monday */\n  'calendar.weekday-names.short.monday': 'Mon',\n  /** Short weekday name for Saturdayday */\n  'calendar.weekday-names.short.saturday': 'Sat',\n  /** Short weekday name for Sunday */\n  'calendar.weekday-names.short.sunday': 'Sun',\n  /** Short weekday name for Thursday */\n  'calendar.weekday-names.short.thursday': 'Thu',\n  /** Short weekday name for Tuesday */\n  'calendar.weekday-names.short.tuesday': 'Tue',\n  /** Short weekday name for Wednesday */\n  'calendar.weekday-names.short.wednesday': 'Wed',\n\n  /** Label for the close button label in Review Changes pane */\n  'changes.action.close-label': 'Close review changes',\n  /** Cancel label for revert button prompt action */\n  'changes.action.revert-all-cancel': 'Cancel',\n  /** Revert all confirm label for revert button action - used on prompt button + review changes pane */\n  'changes.action.revert-all-confirm': 'Revert all',\n  /** Prompt for reverting all changes in document in Review Changes pane. Includes a count of changes. */\n  'changes.action.revert-all-description': 'Are you sure you want to revert all {{count}} changes?',\n  /** Prompt for confirming revert change (singular) label for field change action */\n  'changes.action.revert-changes-confirm-change_one': 'Revert change',\n  /** Revert for confirming revert (plural) label for field change action */\n  'changes.action.revert-changes-confirm-change_other': 'Revert changes',\n  /** Prompt for reverting changes for a field change */\n  'changes.action.revert-changes-description': 'Are you sure you want to revert the changes?',\n  /** Prompt for reverting changes for a group change, eg multiple changes */\n  'changes.action.revert-changes-description_one': 'Are you sure you want to revert the change?',\n  /** Label for when the action of the change was to set something that was previously empty, eg a field was given a value, an array item was added, an asset was selected or similar */\n  'changes.added-label': 'Added',\n  /** Array diff: An item was added in a given position (`{{position}}`) */\n  'changes.array.item-added-in-position': 'Added in position {{position}}',\n  'changes.array.item-moved_down_one': 'Moved {{count}} position down',\n  'changes.array.item-moved_down_other': 'Moved {{count}} positions down',\n  /**\n   * Array diff: An item was moved within the array.\n   * Receives `{{count}}` representing number of positions it moved.\n   * Context is the direction of the move, either `up` or `down`.\n   */\n  'changes.array.item-moved_up_one': 'Moved {{count}} position up',\n  'changes.array.item-moved_up_other': 'Moved {{count}} positions up',\n  /** Array diff: An item was removed from a given position (`{{position}}`) */\n  'changes.array.item-removed-from-position': 'Removed from position {{position}}',\n  /** Accessibility label for the \"change bar\" shown when there are edits on a field-level */\n  'changes.change-bar.aria-label': 'Review changes',\n  /** Label for when the action of the change was _not_ an add/remove, eg a text field changed value, an image was changed from one asset to another or similar */\n  'changes.changed-label': 'Changed',\n  /** Label and text for tooltip that indicates the authors of the changes */\n  'changes.changes-by-author': 'Changes by',\n  /** Additional text shown in development mode when a diff component crashes during rendering */\n  'changes.error-boundary.developer-info': 'Check the developer console for more information',\n  /** Text shown when a diff component crashes during rendering, triggering the error boundary */\n  'changes.error-boundary.title': 'Rendering the changes to this field caused an error',\n  /** Error message shown when the value of a field is not the expected one */\n  'changes.error.incorrect-type-message':\n    'Value error: Value is of type \"<code>{{actualType}}</code>\", expected \"<code>{{expectedType}}</code>\"',\n  /** File diff: Fallback title for the meta info section when there is no original filename to use  */\n  'changes.file.meta-info-fallback-title': 'Untitled',\n  /** Image diff: Text shown in tooltip when hovering hotspot that has changed in diff view */\n  'changes.image.crop-changed': 'Crop changed',\n  /** Image diff: Text shown if the previous image asset was deleted (shouldn't theoretically happen) */\n  'changes.image.deleted': 'Image deleted',\n  /** Image diff: Text shown if the image failed to be loaded when previewing it */\n  'changes.image.error-loading-image': 'Error loading image',\n  /** Image diff: Text shown in tooltip when hovering hotspot that has changed in diff view */\n  'changes.image.hotspot-changed': 'Hotspot changed',\n  /** Image diff: Fallback title for the meta info section when there is no original filename to use  */\n  'changes.image.meta-info-fallback-title': 'Untitled',\n  /** Image diff: Text shown if no asset has been set for the field (but has metadata changes) */\n  'changes.image.no-asset-set': 'Image not set',\n  /** Image diff: Text shown when the from/to state has/had no image */\n  'changes.image.no-image-placeholder': '(no image)',\n  /** Label for the \"from\" value in the change inspector */\n  'changes.inspector.from-label': 'From',\n  /** Label for the \"meta\" (field path, action etc) information in the change inspector */\n  'changes.inspector.meta-label': 'Meta',\n  /** Label for the \"to\" value in the change inspector */\n  'changes.inspector.to-label': 'To',\n  /** Loading author of change in the differences tooltip in the review changes pane */\n  'changes.loading-author': 'Loading',\n  /** Loading changes in Review Changes Pane */\n  'changes.loading-changes': 'Loading changes',\n  /** No Changes description in the Review Changes pane */\n  'changes.no-changes-description':\n    'Edit the document or select an older version in the timeline to see a list of changes appear in this panel.',\n  /** No Changes title in the Review Changes pane */\n  'changes.no-changes-title': 'There are no changes',\n  /** Portable Text diff: An annotation was added */\n  'changes.portable-text.annotation_added': 'Added annotation',\n  /** Portable Text diff: An annotation was changed */\n  'changes.portable-text.annotation_changed': 'Changed annotation',\n  /** Portable Text diff: An annotation was removed */\n  'changes.portable-text.annotation_removed': 'Removed annotation',\n  /** Portable Text diff: An annotation was left unchanged */\n  'changes.portable-text.annotation_unchanged': 'Unchanged annotation',\n  /** Portable Text diff: A block changed from one style to another (eg `normal` to `h1` or similar) */\n  'changes.portable-text.block-style-changed':\n    'Changed block style from \"{{fromStyle}}\" to \"{{toStyle}}\"',\n  /** Portable Text diff: Change formatting of text (setting/unsetting marks, eg bold/italic etc) */\n  'changes.portable-text.changed-formatting': 'Changed formatting',\n  /** Portable Text diff: An empty inline object is part of a change */\n  'changes.portable-text.empty-inline-object': 'Empty {{inlineObjectType}}',\n  /** Portable Text diff: An empty object is the result of adding/removing an annotation */\n  'changes.portable-text.empty-object-annotation': 'Empty {{annotationType}}',\n  /** Portable Text diff: Added a block containing no text (eg empty block) */\n  'changes.portable-text.empty-text_added': 'Added empty text',\n  /** Portable Text diff: Changed a block that contained no text (eg empty block) */\n  'changes.portable-text.empty-text_changed': 'Changed empty text',\n  /** Portable Text diff: Removed a block containing no text (eg empty block) */\n  'changes.portable-text.empty-text_removed': 'Removed empty text',\n  /** Portable Text diff: An inline object was added */\n  'changes.portable-text.inline-object_added': 'Added inline object',\n  /** Portable Text diff: An inline object was changed */\n  'changes.portable-text.inline-object_changed': 'Changed inline object',\n  /** Portable Text diff: An inline object was removed */\n  'changes.portable-text.inline-object_removed': 'Removed inline object',\n  /** Portable Text diff: An inline object was left unchanged */\n  'changes.portable-text.inline-object_unchanged': 'Unchanged inline object',\n  /** Portable Text diff: Added a chunk of text */\n  'changes.portable-text.text_added': 'Added text',\n  /** Portable Text diff: Removed a chunk of text */\n  'changes.portable-text.text_removed': 'Removed text',\n  /** Portable Text diff: Annotation has an unknown schema type */\n  'changes.portable-text.unknown-annotation-schema-type': 'Unknown schema type',\n  /** Portable Text diff: Inline object has an unknown schema type */\n  'changes.portable-text.unknown-inline-object-schema-type': 'Unknown schema type',\n  /** Label for when the action of the change was a removal, eg a field was cleared, an array item was removed, an asset was deselected or similar */\n  'changes.removed-label': 'Removed',\n  /** Title for the Review Changes pane */\n  'changes.title': 'Review changes',\n\n  /** --- Common components --- */\n  /** Tooltip text for context menu buttons */\n  'common.context-menu-button.tooltip': 'Show more',\n\n  /** Default text for dialog cancel button */\n  'common.dialog.cancel-button.text': 'Cancel',\n\n  /** Default text for dialog confirm button */\n  'common.dialog.confirm-button.text': 'Confirm',\n\n  /** Default text in shared loader text / spinner lockup */\n  'common.loading': 'Loading',\n\n  /** --- Configuration issues --- */\n\n  /** Tooltip displayed on configuration issues button */\n  'configuration-issues.button.tooltip': 'Found configuration issues',\n\n  /** The fallback title for an ordering menu item if no localized titles are provided. */\n  'default-menu-item.fallback-title': 'Sort by {{title}}',\n\n  /** Title for the default ordering/SortOrder if no orderings are provided and the caption field is found */\n  'default-orderings.caption': 'Sort by Caption',\n  /** Title for the default ordering/SortOrder if no orderings are provided and the description field is found */\n  'default-orderings.description': 'Sort by Description',\n  /** Title for the default ordering/SortOrder if no orderings are provided and the header field is found */\n  'default-orderings.header': 'Sort by Header',\n  /** Title for the default ordering/SortOrder if no orderings are provided and the heading field is found */\n  'default-orderings.heading': 'Sort by Heading',\n  /** Title for the default ordering/SortOrder if no orderings are provided and the label field is found */\n  'default-orderings.label': 'Sort by Label',\n  /** Title for the default ordering/SortOrder if no orderings are provided and the name field is found */\n  'default-orderings.name': 'Sort by Name',\n  /** Title for the default ordering/SortOrder if no orderings are provided and the title field is found */\n  'default-orderings.title': 'Sort by Title',\n\n  /** Label to show in the document footer indicating the last edited date of the document */\n  'document-status.edited': 'Edited {{date}}',\n  /** Label to show in the document footer indicating the document is not published*/\n  'document-status.not-published': 'Not published',\n  /** Label to show in the document footer indicating the published date of the document */\n  'document-status.published': 'Published {{date}}',\n\n  /** The value of the <code>_key</code> property must be a unique string. */\n  'form.error.duplicate-keys-alert.details.additional-description':\n    'The value of the <code>_key</code> property must be a unique string.',\n  /** This usually happens when items are created using an API client, and the <code>_key</code> property of each elements has been generated non-uniquely. */\n  'form.error.duplicate-keys-alert.details.description':\n    'This usually happens when items are created using an API client, and the <code>_key</code> property of each elements has been generated non-uniquely.',\n  /** Developer info */\n  'form.error.duplicate-keys-alert.details.title': 'Developer info',\n  /** Generate unique keys */\n  'form.error.duplicate-keys-alert.generate-button.text': 'Generate unique keys',\n  /** Several items in this list share the same identifier (key). Every item must have an unique identifier. */\n  'form.error.duplicate-keys-alert.summary':\n    'Several items in this list share the same identifier (key). Every item must have an unique identifier.',\n  /** Non-unique keys */\n  'form.error.duplicate-keys-alert.title': 'Non-unique keys',\n  /** Error text shown when a field with a given name cannot be found in the schema or is conditionally hidden but explicitly told to render  */\n  'form.error.field-not-found':\n    'Field \"{{fieldName}}\" not found among members  verify that it is defined in the schema and that it has not been conditionally hidden.',\n  /** Add missing keys */\n  'form.error.missing-keys-alert.add-button.text': 'Add missing keys',\n  /** The value of the <code>_key</code> property must be a unique string. */\n  'form.error.missing-keys-alert.details.additional-description':\n    'The value of the <code>_key</code> property must be a unique string.',\n  /** This usually happens when items are created using an API client, and the <code>_key</code> property has not been included. */\n  'form.error.missing-keys-alert.details.description':\n    'This usually happens when items are created using an API client, and the <code>_key</code> property has not been included.',\n  /** Developer info */\n  'form.error.missing-keys-alert.details.title': 'Developer info',\n  /** Some items in the list are missing their keys. This must be fixed in order to edit the list. */\n  'form.error.missing-keys-alert.summary':\n    'Some items in the list are missing their keys. This must be fixed in order to edit the list.',\n  /** Missing keys */\n  'form.error.missing-keys-alert.title': 'Missing keys',\n  /** This usually happens when items are created using an API client, or when a custom input component has added invalid data to the list. */\n  'form.error.mixed-array-alert.details.description':\n    'This usually happens when items are created using an API client, or when a custom input component has added invalid data to the list.',\n  /** Developer info */\n  'form.error.mixed-array-alert.details.title': 'Developer info',\n  /**  Remove non-object values */\n  'form.error.mixed-array-alert.remove-button.text': 'Remove non-object values',\n  /** Some items in this list are not objects. This must be fixed in order to edit the list. */\n  'form.error.mixed-array-alert.summary':\n    'Some items in this list are not objects. This must be fixed in order to edit the list.',\n  /** Invalid list values */\n  'form.error.mixed-array-alert.title': 'Invalid list values',\n  /** Error text shown when form is unable to find an array item at a given indexed path */\n  'form.error.no-array-item-at-index':\n    'No array item at index <code>{{index}}</code> found at path <code>{{path}}</code>',\n  /** Error text shown when form is unable to find an array item at a given keyed path */\n  'form.error.no-array-item-at-key':\n    'No array item with `_key` <code>\"{{key}}\"</code> found at path <code>{{path}}</code>',\n  /** Form field deprecated label */\n  'form.field.deprecated-label': 'deprecated',\n  /** Fallback title shown above field if it has no defined title */\n  'form.field.untitled-field-label': 'Untitled',\n  /** Fallback title shown above fieldset if it has no defined title */\n  'form.field.untitled-fieldset-label': 'Untitled',\n  /** Accessibility label for the icon that indicates the field has a validation error */\n  'form.validation.has-error-aria-label': 'Has error',\n  /** Accessibility label for the icon that indicates the field has validation information */\n  'form.validation.has-info-aria-label': 'Has information',\n  /** Accessibility label for the icon that indicates the field has a validation warning */\n  'form.validation.has-warning-aria-label': 'Has warning',\n  /** Text shown when summarizing validation information, when the field has one or more errors */\n  'form.validation.summary.errors-count_one': '{{count}} error',\n  'form.validation.summary.errors-count_other': '{{count}} errors',\n  /** Text shown when summarizing validation information, when the field has one or more warnings */\n  'form.validation.summary.warnings-count_one': '{{count}} warning',\n  'form.validation.summary.warnings-count_other': '{{count}} warnings',\n\n  /** Tooltip for free trial navbar button indicating remaining days */\n  'free-trial.tooltip.days-count_one': '{{count}} day left in trial',\n  'free-trial.tooltip.days-count_other': '{{count}} days left in trial',\n  /** Tooltip for free trial navbar button, once trial has ended */\n  'free-trial.tooltip.trial-finished': 'Upgrade your project',\n\n  /**\n   * Label for \"contact sales\" call to action\n   * These are titles for fallback links in the event the help & resources endpoint isn't able to be fetched\n   */\n  'help-resources.action.contact-sales': 'Contact sales',\n  /**\n   * Label for \"help and support\" call to action\n   * These are titles for fallback links in the event the help & resources endpoint isn't able to be fetched\n   */\n  'help-resources.action.help-and-support': 'Help and support',\n  /**\n   * Label for \"join our community\" call to action\n   * These are titles for fallback links in the event the help & resources endpoint isn't able to be fetched\n   */\n  'help-resources.action.join-our-community': 'Join our community',\n  /** Information for what the latest sanity version is */\n  'help-resources.latest-sanity-version': 'Latest version is {{latestVersion}}',\n  /** Information for what studio version the current studio is running */\n  'help-resources.studio-version': 'Sanity Studio version {{studioVersion}}',\n  /** Title for help and resources menus */\n  'help-resources.title': 'Help and resources',\n\n  /** Text for button to cancel an ongoing upload */\n  'input.files.common.cancel-upload': 'Cancel',\n  /** Text for file input button in upload placeholder */\n  'input.files.common.upload-placeholder.file-input-button.text': 'Upload',\n  /** Uploading <FileName/> */\n  'input.files.common.upload-progress': 'Uploading <FileName/>',\n  /** The referenced document cannot be opened, because the URL failed to be resolved */\n  'input.reference.document-cannot-be-opened.failed-to-resolve-url':\n    'This document cannot be opened (unable to resolve URL to Studio)',\n  /** Label for adding item after a specific array item */\n  'inputs.array.action.add-after': 'Add item after',\n  /** Label for adding item before a specific array item */\n  'inputs.array.action.add-before': 'Add item before',\n  /** Label for adding array item action when the schema allows for only one schema type */\n  'inputs.array.action.add-item': 'Add item',\n  /**\n   * Label for adding one array item action when the schema allows for multiple schema types,\n   * eg. will prompt the user to select a type once triggered\n   */\n  'inputs.array.action.add-item-select-type': 'Add item...',\n  /** Array drag handle button tooltip */\n  'inputs.array.action.drag.tooltip': 'Drag to re-order',\n  /** Label for duplicating an array item  */\n  'inputs.array.action.duplicate': 'Duplicate',\n  /** Label for editing the item of a specific type, eg \"Edit Person\" */\n  'inputs.array.action.edit': 'Edit {{itemTypeTitle}}',\n  /** Label for removing an array item action  */\n  'inputs.array.action.remove': 'Remove',\n  /** Label for removing action when an array item has an error  */\n  'inputs.array.action.remove-invalid-item': 'Remove',\n  /** Label for viewing the item of a specific type, eg \"View Person\" */\n  'inputs.array.action.view': 'View {{itemTypeTitle}}',\n  /** Error description for the array item tooltip that explains that the current item can still be moved or deleted but not edited since the schema definition is not found */\n  'inputs.array.error.can-delete-but-no-edit-description':\n    'You can still move or delete this item, but it cannot be edited since the schema definition for its type is nowhere to be found.',\n  /** Error label for toast when array could not resolve the initial value */\n  'inputs.array.error.cannot-resolve-initial-value-title':\n    'Unable to resolve initial value for type: {{schemaTypeTitle}}: {{errorMessage}}.',\n  /** Error label for toast when trying to upload one array item of a type that cannot be converted to array */\n  'inputs.array.error.cannot-upload-unable-to-convert_one':\n    \"The following item can't be uploaded because there's no known conversion from content type to array item:\",\n  /** Error label for toast when trying to upload multiple array items of a type that cannot be converted to array */\n  'inputs.array.error.cannot-upload-unable-to-convert_other':\n    \"The following items can't be uploaded because there's no known conversion from content types to array item:\",\n  /** Error description for the array item tooltip that explains that the current type item is not valid for the list  */\n  'inputs.array.error.current-schema-not-declare-description':\n    'The current schema does not declare items of type <code>{{typeName}}</code> as valid for this list. This could mean that the type has been removed as a valid item type, or that someone else has added it to their own local schema that is not yet deployed.',\n  /** Error description to show how the item is being represented in the json format */\n  'inputs.array.error.json-representation-description': 'JSON representation of this item:',\n  /** Error description for the array item tooltip that explains what the error means with more context */\n  'inputs.array.error.type-is-incompatible-prompt':\n    'Item of type <code>{{typeName}}</code> not valid for this list',\n  /** Error title for when an item type within an array input is incompatible, used in the tooltip */\n  'inputs.array.error.type-is-incompatible-title': 'Why is this happening?',\n  /** Error label for unexpected errors in the Array Input */\n  'inputs.array.error.unexpected-error': 'Unexpected Error: {{error}}',\n  /** Label for when the array input doesn't have any items */\n  'inputs.array.no-items-label': 'No items',\n  /** Label for read only array fields */\n  'inputs.array.read-only-label': 'This field is read-only',\n  /** Label for when the array input is resolving the initial value for the item */\n  'inputs.array.resolving-initial-value': 'Resolving initial value',\n  /** Placeholder value for datetime input */\n  'inputs.datetime.placeholder': 'e.g. {{example}}',\n  /** Acessibility label for button to open file options menu */\n  'inputs.file.actions-menu.file-options.aria-label': 'Open file options menu',\n  /** Browse */\n  'inputs.file.browse-button.text': 'Browse',\n  /** Select file */\n  'inputs.file.dialog.title': 'Select file',\n  /** Unknown member kind: `{{kind}}` */\n  'inputs.file.error.unknown-member-kind': 'Unknown member kind: {{kind}}',\n  /** The value of this field is not a valid file. Resetting this field will let you choose a new file. */\n  'inputs.file.invalid-file-warning.description':\n    'The value of this field is not a valid file. Resetting this field will let you choose a new file.',\n  /** Reset value */\n  'inputs.file.invalid-file-warning.reset-button.text': 'Reset value',\n  /** Invalid file value */\n  'inputs.file.invalid-file-warning.title': 'Invalid file value',\n  /** Select */\n  'inputs.file.multi-browse-button.text': 'Select',\n  /** The upload could not be completed at this time. */\n  'inputs.file.upload-failed.description': 'The upload could not be completed at this time.',\n  /** Upload failed */\n  'inputs.file.upload-failed.title': 'Upload failed',\n  /** Clear field */\n  'inputs.files.common.actions-menu.clear-field.label': 'Clear field',\n  /** Copy URL */\n  'inputs.files.common.actions-menu.copy-url.label': 'Copy URL',\n  /** Download */\n  'inputs.files.common.actions-menu.download.label': 'Download',\n  /** The URL is copied to the clipboard */\n  'inputs.files.common.actions-menu.notification.url-copied': 'The URL is copied to the clipboard',\n  /** Replace */\n  'inputs.files.common.actions-menu.replace.label': 'Replace',\n  /** Upload */\n  'inputs.files.common.actions-menu.upload.label': 'Upload',\n  /** Drop to upload */\n  'inputs.files.common.drop-message.drop-to-upload': 'Drop to upload',\n  /** Drop to upload `{{count}}` file */\n  'inputs.files.common.drop-message.drop-to-upload-multi_one': 'Drop to upload {{count}} file',\n  /** Drop to upload `{{count}}` files */\n  'inputs.files.common.drop-message.drop-to-upload-multi_other': 'Drop to upload {{count}} files',\n  /** Can't upload this file here */\n  'inputs.files.common.drop-message.drop-to-upload.no-accepted-file-message_one':\n    \"Can't upload this file here\",\n  /** Can't upload any of these files here */\n  'inputs.files.common.drop-message.drop-to-upload.no-accepted-file-message_other':\n    \"Can't upload any of these files here\",\n  /** `{{count}}` file can't be uploaded here */\n  'inputs.files.common.drop-message.drop-to-upload.rejected-file-message_one':\n    \"{{count}} file can't be uploaded here\",\n  /** `{{count}}` files can't be uploaded here */\n  'inputs.files.common.drop-message.drop-to-upload.rejected-file-message_other':\n    \"{{count}} files can't be uploaded here\",\n  /** Cannot upload `{{count}}` files */\n  'inputs.files.common.placeholder.cannot-upload-some-files_one': 'Cannot upload file',\n  'inputs.files.common.placeholder.cannot-upload-some-files_other': 'Cannot upload {{count}} files',\n  /** Drag or paste type here */\n  'inputs.files.common.placeholder.drag-or-paste-to-upload_file': 'Drag or paste file here',\n  /** Drag or paste image here */\n  'inputs.files.common.placeholder.drag-or-paste-to-upload_image': 'Drag or paste image here',\n  /** Drop to upload file */\n  'inputs.files.common.placeholder.drop-to-upload_file': 'Drop to upload file',\n  /** Drop to upload image */\n  'inputs.files.common.placeholder.drop-to-upload_image': 'Drop to upload image',\n  /** Read only */\n  'inputs.files.common.placeholder.read-only': 'Read only',\n  /** Can't upload files here */\n  'inputs.files.common.placeholder.upload-not-supported': \"Can't upload files here\",\n  /** Clear upload */\n  'inputs.files.common.stale-upload-warning.clear': 'Clear upload',\n  /** An upload has made no progress for at least `{{staleThresholdMinutes}}` minutes and likely got interrupted. You can safely clear the incomplete upload and try uploading again. */\n  'inputs.files.common.stale-upload-warning.description':\n    'An upload has made no progress for at least {{staleThresholdMinutes}} minutes and likely got interrupted. You can safely clear the incomplete upload and try uploading again.',\n  /** Incomplete upload */\n  'inputs.files.common.stale-upload-warning.title': 'Incomplete upload',\n  /** Tooltip text for action to crop image */\n  'inputs.image.actions-menu.crop-image-tooltip': 'Crop image',\n  /** Accessibility label for button to open image edit dialog */\n  'inputs.image.actions-menu.edit-details.aria-label': 'Open image edit dialog',\n  /** Accessibility label for button to open image options menu */\n  'inputs.image.actions-menu.options.aria-label': 'Open image options menu',\n  /** Select */\n  'inputs.image.browse-menu.text': 'Select',\n  /** Cannot upload this file here */\n  'inputs.image.drag-overlay.cannot-upload-here': 'Cannot upload this file here',\n  /** Drop image to upload */\n  'inputs.image.drag-overlay.drop-to-upload-image': 'Drop image to upload',\n  /** This field is read only */\n  'inputs.image.drag-overlay.this-field-is-read-only': 'This field is read only',\n  /** Unknown member kind: `{{kind}}` */\n  'inputs.image.error.unknown-member-kind': 'Unknown member kind: {{kind}}',\n  /** Edit hotspot and crop */\n  'inputs.image.hotspot-dialog.title': 'Edit hotspot and crop',\n  /** The value of this field is not a valid image. Resetting this field will let you choose a new image. */\n  'inputs.image.invalid-image-warning.description':\n    'The value of this field is not a valid image. Resetting this field will let you choose a new image.',\n  /** Reset value */\n  'inputs.image.invalid-image-warning.reset-button.text': 'Reset value',\n  /** Invalid image value */\n  'inputs.image.invalid-image-warning.title': 'Invalid image value',\n  /** Preview of uploaded image */\n  'inputs.image.preview-uploaded-image': 'Preview of uploaded image',\n  /** The upload could not be completed at this time. */\n  'inputs.image.upload-error.description': 'The upload could not be completed at this time.',\n  /** Upload failed */\n  'inputs.image.upload-error.title': 'Upload failed',\n  /** Adjust the rectangle to crop image. Adjust the circle to specify the area that should always be visible. */\n  'inputs.imagetool.description':\n    'Adjust the rectangle to crop image. Adjust the circle to specify the area that should always be visible.',\n  /** Error: `{{errorMessage}}` */\n  'inputs.imagetool.load-error': 'Error: {{errorMessage}}',\n  /** Hotspot & Crop */\n  'inputs.imagetool.title': 'Hotspot & Crop',\n  /** Convert to `{{targetType}}` */\n  'inputs.invalid-value.convert-button.text': 'Convert to {{targetType}}',\n  /** The current value (<code>`{{actualType}}`</code>) */\n  'inputs.invalid-value.current-type': 'The current value (<code>{{actualType}}</code>)',\n  /** The property value is stored as a value type that does not match the expected type. */\n  'inputs.invalid-value.description':\n    'The property value is stored as a value type that does not match the expected type.',\n  /** The value of this property must be of type <code>`{{validType}}`</code> according to the schema. */\n  'inputs.invalid-value.details.description':\n    'The value of this property must be of type <code>{{validType}}</code> according to the schema.',\n  /** Only the following types are valid here according to schema: */\n  'inputs.invalid-value.details.multi-type-description':\n    'Only the following types are valid here according to schema:',\n  /** Mismatching value types typically occur when the schema has recently been changed. */\n  'inputs.invalid-value.details.possible-reason':\n    'Mismatching value types typically occur when the schema has recently been changed.',\n  /** Developer info */\n  'inputs.invalid-value.details.title': 'Developer info',\n  /** -- Invalid Value Input -- */\n  /** Reset value */\n  'inputs.invalid-value.reset-button.text': 'Reset value',\n  /** Invalid property value */\n  'inputs.invalid-value.title': 'Invalid property value',\n  /** Field groups */\n  'inputs.object.field-group-tabs.aria-label': 'Field groups',\n  /** Read-only field description */\n  'inputs.object.unknown-fields.read-only.description':\n    'This field is <strong>read only</strong> according to the documents schema and cannot be unset. If you want to be able to unset this in Studio, make sure you remove the <code>readOnly</code> field from the enclosing type in the schema.',\n  /** Remove field */\n  'inputs.object.unknown-fields.remove-field-button.text': 'Remove field',\n  /** Encountered `{{count}}` fields that are not defined in the schema. */\n  'inputs.object.unknown-fields.warning.description_one':\n    'Encountered a field that is not defined in the schema.',\n  'inputs.object.unknown-fields.warning.description_other':\n    'Encountered {{count}} fields that are not defined in the schema.',\n  /** Detailed description of unknown field warning */\n  'inputs.object.unknown-fields.warning.details.description_one':\n    'This field is not defined in the schema, which could mean that the field definition has been removed or that someone else has added it to their own local project and have not deployed their changes yet.',\n  'inputs.object.unknown-fields.warning.details.description_other':\n    'These fields are not defined in the documents schema, which could mean that the field definitions have been removed or that someone else has added them to their own local project and have not deployed their changes yet.',\n  /** Developer info */\n  'inputs.object.unknown-fields.warning.details.title': 'Developer info',\n  /** Unknown field found */\n  'inputs.object.unknown-fields.warning.title_one': 'Unknown field found',\n  'inputs.object.unknown-fields.warning.title_other': 'Unknown fields found',\n  /** Collapse the editor to save screen space  */\n  'inputs.portable-text.action.collapse-editor': 'Collapse editor',\n  /** Aria label for action to edit an existing annotation */\n  'inputs.portable-text.action.edit-annotation-aria-label': 'Edit annotation',\n  /** Expand the editor to give more editing space */\n  'inputs.portable-text.action.expand-editor': 'Expand editor',\n  /** Label label for action to insert a block of a given type (`{{typeName}}`) */\n  'inputs.portable-text.action.insert-block': 'Insert {{typeName}}',\n  /** Accessibility label for action to insert a block of a given type (`{{typeName}}`) */\n  'inputs.portable-text.action.insert-block-aria-label': 'Insert {{typeName}} (block)',\n  /** Label for action to insert an inline object of a given type (`{{typeName}}`) */\n  'inputs.portable-text.action.insert-inline-object': 'Insert {{typeName}}',\n  /** Accessibility label for action to insert an inline object of a given type (`{{typeName}}`) */\n  'inputs.portable-text.action.insert-inline-object-aria-label': 'Insert {{typeName}} (inline)',\n  /** Aria label for action to remove an annotation */\n  'inputs.portable-text.action.remove-annotation-aria-label': 'Remove annotation',\n  /** Label for activate on focus with context of click and not focused */\n  'inputs.portable-text.activate-on-focus-message_click': 'Click to activate',\n  /** Label for activate on focus with context of click and focused */\n  'inputs.portable-text.activate-on-focus-message_click-focused':\n    'Click or press space to activate',\n  /** Label for activate on focus with context of tap and not focused */\n  'inputs.portable-text.activate-on-focus-message_tap': 'Tap to activate',\n  /**Aria label for the annotation object */\n  'inputs.portable-text.annotation-aria-label': 'Annotation object',\n  /** Title for dialog that allows editing an annotation */\n  'inputs.portable-text.annotation-editor.title': 'Edit {{schemaType}}',\n  /** Title of the default \"link\" annotation */\n  'inputs.portable-text.annotation.link': 'Link',\n  /**Aria label for the block object */\n  'inputs.portable-text.block.aria-label': 'Block object',\n  /** Label for action to edit a block item, in the case where it is editable */\n  'inputs.portable-text.block.edit': 'Edit',\n  /** Accessibility label for the button that opens the actions menu on blocks */\n  'inputs.portable-text.block.open-menu-aria-label': 'Open menu',\n  /** Label for action to open a reference, in the case of block-level reference types */\n  'inputs.portable-text.block.open-reference': 'Open reference',\n  /** Label for action to remove a block item */\n  'inputs.portable-text.block.remove': 'Remove',\n  /** Label for action to view a block item, in the case where it is read-only and thus cannot be edited */\n  'inputs.portable-text.block.view': 'View',\n  /** Title of the \"code\" decorator */\n  'inputs.portable-text.decorator.code': 'Code',\n  /** Title of the \"em\" (emphasis) decorator */\n  'inputs.portable-text.decorator.emphasis': 'Italic',\n  /** Title of the \"strike-through\" decorator */\n  'inputs.portable-text.decorator.strike-through': 'Strike',\n  /** Title of the \"strong\" decorator */\n  'inputs.portable-text.decorator.strong': 'Strong',\n  /** Title of the \"underline\" decorator */\n  'inputs.portable-text.decorator.underline': 'Underline',\n  /** Placeholder text for when the editor is empty */\n  'inputs.portable-text.empty-placeholder': 'Empty',\n  /**Aria label for the block object */\n  'inputs.portable-text.inline-block.aria-label': 'Inline object',\n  /** Label for action to edit an inline object item */\n  'inputs.portable-text.inline-object.edit': 'Edit object',\n  /** Aria label for icon for action to edit an inline object item */\n  'inputs.portable-text.inline-object.edit-aria-label': 'Edit object',\n  /** Label for action to remove an inline object item */\n  'inputs.portable-text.inline-object.remove': 'Remove object',\n  /** Aria label for icon for action to remove an inline object item */\n  'inputs.portable-text.inline-object.remove-aria-label': 'Remove object',\n  /** Disclaimer text shown on invalid Portable Text value, when an action is available to unblock the user, but it is not guaranteed to be safe */\n  'inputs.portable-text.invalid-value.action-disclaimer':\n    'NOTE: Its generally safe to perform the action above, but if you are in doubt, get in touch with those responsible for configuring your studio.',\n  /** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` has a child with key `{{childKey}}` of type `{{childType}}` which is not allowed by the schema definition */\n  'inputs.portable-text.invalid-value.disallowed-child-type.action': 'Remove the object',\n  /** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` has a child with key `{{childKey}}` of type `{{childType}}` which is not allowed by the schema definition */\n  'inputs.portable-text.invalid-value.disallowed-child-type.description':\n    'Child with key {{childKey}} of block with key <code>{{key}}</code> is of type <code>{{childType}}</code>, which is not allowed by the schema.',\n  /** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` has a type (`{{typeName}}`) that is not an allowed block type for this field */\n  'inputs.portable-text.invalid-value.disallowed-type.action': 'Remove the block',\n  /** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` has a type (`{{typeName}}`) that is not an allowed block type for this field */\n  'inputs.portable-text.invalid-value.disallowed-type.description':\n    'Block with key <code>{{key}}</code> is of type <code>{{typeName}}</code>, which is not allowed by the schema.',\n  /** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` contains no children */\n  'inputs.portable-text.invalid-value.empty-children.action': 'Insert empty text span',\n  /** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` contains no children */\n  'inputs.portable-text.invalid-value.empty-children.description':\n    'Text block with key <code>{{key}}</code> has no text spans.',\n  /** Label for the button to ignore invalid values in the Portable Text editor */\n  'inputs.portable-text.invalid-value.ignore-button.text': 'Ignore',\n  /** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` has a `_type` property that is set to `block`, but the block type defined in schema has a different name (`{{expectedTypeName}}`) */\n  'inputs.portable-text.invalid-value.incorrect-block-type.action':\n    'Use type <code>{{expectedTypeName}}</code>',\n  /** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` has a `_type` property that is set to `block`, but the block type defined in schema has a different name (`{{expectedTypeName}}`) */\n  'inputs.portable-text.invalid-value.incorrect-block-type.description':\n    'Block with key <code>{{key}}</code> has an invalid type name. According to the schema, it should be <code>{{expectedTypeName}}</code>.',\n  /** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` has a span with key `{{childKey}}` that has a missing or invalid `text` property */\n  'inputs.portable-text.invalid-value.invalid-span-text.action': 'Set empty text value',\n  /** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` has a span with key `{{childKey}}` that has a missing or invalid `text` property */\n  'inputs.portable-text.invalid-value.invalid-span-text.description':\n    'Span with key {{childKey}} of block with key <code>{{key}}</code> has a missing or invalid <code>text</code> property.',\n  /** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` is missing a `_type` property, but seems to be a block of type `{{expectedTypeName}}` */\n  'inputs.portable-text.invalid-value.missing-block-type.action':\n    'Use type <code>{{expectedTypeName}}</code>',\n  /** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` is missing a `_type` property, but seems to be a block of type `{{expectedTypeName}}` */\n  'inputs.portable-text.invalid-value.missing-block-type.description':\n    'Block with key <code>{{key}}</code> is missing a type name. According to the schema, it should be <code>{{expectedTypeName}}</code>.',\n  /** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` has a child at `{{index}}` which is missing `_key` property */\n  'inputs.portable-text.invalid-value.missing-child-key.action': 'Assign random key',\n  /** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` has a child at `{{index}}` which is missing `_key` property */\n  'inputs.portable-text.invalid-value.missing-child-key.description':\n    'Child at index <code>{{index}}</code> of block with key <code>{{key}}</code> is missing <code>_key</code> property.',\n  /** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` has a child with key `{{childKey}}` which is missing a `_type` property */\n  'inputs.portable-text.invalid-value.missing-child-type.action': 'Remove the object',\n  /** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` has a child with key `{{childKey}}` which is missing a `_type` property */\n  'inputs.portable-text.invalid-value.missing-child-type.description':\n    'Child with key {{childKey}} of block with key <code>{{key}}</code> is missing <code>_type</code> property.',\n  /** Action presented when the Portable Text field value is invalid, when child at `{{index}}` is missing the required `_key` property */\n  'inputs.portable-text.invalid-value.missing-key.action': 'Assign random key',\n  /** Text explaining that the Portable Text field value is invalid, when child at `{{index}}` is missing the required `_key` property */\n  'inputs.portable-text.invalid-value.missing-key.description':\n    'Block at index <code>{{index}}</code> is missing required <code>_key</code> property.',\n  /** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` has a missing or invalid `children` property */\n  'inputs.portable-text.invalid-value.missing-or-invalid-children.action': 'Remove the block',\n  /** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` has a missing or invalid `children` property */\n  'inputs.portable-text.invalid-value.missing-or-invalid-children.description':\n    'Text block with key <code>{{key}}</code> has an invalid or missing `children` property.',\n  /** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` has a missing or invalid `markDefs` property */\n  'inputs.portable-text.invalid-value.missing-or-invalid-markdefs.action': 'Add property',\n  /** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` has a missing or invalid `markDefs` property */\n  'inputs.portable-text.invalid-value.missing-or-invalid-markdefs.description':\n    'Text block with key <code>{{key}}</code> has an invalid or missing `markDefs` property.',\n  /** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` is missing a `_type` property  */\n  'inputs.portable-text.invalid-value.missing-type.action': 'Remove the block',\n  /** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` is missing a `_type` property  */\n  'inputs.portable-text.invalid-value.missing-type.description':\n    'Block with key <code>{{key}}</code> is missing a type name.',\n  /** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` contains a non-object child at index `{{index}}` */\n  'inputs.portable-text.invalid-value.non-object-child.action': 'Remove the item',\n  /** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` contains a non-object child at index `{{index}}` */\n  'inputs.portable-text.invalid-value.non-object-child.description':\n    'Child at index <code>{{index}}</code> of block with key <code>{{key}}</code> is not an object.',\n  /** Action presented when the Portable Text field value is invalid, when the Portable Text field is not an array, or the array is empty */\n  'inputs.portable-text.invalid-value.not-an-array.action': 'Unset the value',\n  /** Text explaining that the Portable Text field value is invalid, when the Portable Text field is not an array, or the array is empty */\n  'inputs.portable-text.invalid-value.not-an-array.description':\n    'Value must be an array of Portable Text blocks, or undefined.',\n  /** Action presented when the Portable Text field value is invalid, when child at `{{index}}` is not an object */\n  'inputs.portable-text.invalid-value.not-an-object.action': 'Remove item',\n  /** Text explaining that the Portable Text field value is invalid, when child at `{{index}}` is not an object */\n  'inputs.portable-text.invalid-value.not-an-object.description':\n    'Item at <code>{{index}}</code> is not an object,.',\n  /** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` contains marks (`{{orphanedMarks}}`) that are not supported by the current schema */\n  'inputs.portable-text.invalid-value.orphaned-marks.action': 'Remove disallowed marks',\n  /** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` contains marks (`{{orphanedMarks}}`) that are not supported by the current schema */\n  'inputs.portable-text.invalid-value.orphaned-marks.description':\n    'Text block with key <code>{{key}}</code> contains marks <code>({{orphanedMarks, list}})</code> that are not allowed by the schema.',\n  /** Title for the alert indicating that the Portable Text field has an invalid value */\n  'inputs.portable-text.invalid-value.title': 'Invalid Portable Text value',\n  /** Title of \"bulleted\" list type */\n  'inputs.portable-text.list-type.bullet': 'Bulleted list',\n  /** Title of numbered list type */\n  'inputs.portable-text.list-type.number': 'Numbered list',\n  /** Title of the \"h1\" block style */\n  'inputs.portable-text.style.h1': 'Heading 1',\n  /** Title of the \"h2\" block style */\n  'inputs.portable-text.style.h2': 'Heading 2',\n  /** Title of the \"h3\" block style */\n  'inputs.portable-text.style.h3': 'Heading 3',\n  /** Title of the \"h4\" block style */\n  'inputs.portable-text.style.h4': 'Heading 4',\n  /** Title of the \"h5\" block style */\n  'inputs.portable-text.style.h5': 'Heading 5',\n  /** Title of the \"h6\" block style */\n  'inputs.portable-text.style.h6': 'Heading 6',\n  /** Title shown when multiple blocks of varying styles is selected */\n  'inputs.portable-text.style.multiple': 'Multiple',\n  /** Title of fallback when no style is given for a block */\n  'inputs.portable-text.style.none': 'No style',\n  /** Title of the \"normal\" block style */\n  'inputs.portable-text.style.normal': 'Normal',\n  /** Title of the \"quote\" block style */\n  'inputs.portable-text.style.quote': 'Quote',\n  /** Label for action to clear the current value of the reference field */\n  'inputs.reference.action.clear': 'Clear',\n  /** Label for action to create a new document from the reference input */\n  'inputs.reference.action.create-new-document': 'Create',\n  /** Label for action to create a new document from the reference input, when there are multiple templates or document types to choose from */\n  'inputs.reference.action.create-new-document-select': 'Create',\n  /** Label for action to duplicate the current item to a new item (used within arrays) */\n  'inputs.reference.action.duplicate': 'Duplicate',\n  /** Label for action that opens the referenced document in a new tab */\n  'inputs.reference.action.open-in-new-tab': 'Open in new tab',\n  /** Label for action to remove the reference from an array */\n  'inputs.reference.action.remove': 'Remove',\n  /** Label for action to replace the current value of the field */\n  'inputs.reference.action.replace': 'Replace',\n  /** Label for action to cancel a previously initiated replace action  */\n  'inputs.reference.action.replace-cancel': 'Cancel replace',\n  /** The cross-dataset reference field currently has a reference, but the feature has been disabled since it was created. This explains what can/cannot be done in its current state. */\n  'inputs.reference.cross-dataset.feature-disabled-actions':\n    \"You can still clear this field's existing reference, but it cannot be changed to a different document as long as the feature is disabled.\",\n  /** A cross-dataset reference field exists but the feature has been disabled. A <DocumentationLink> component is available. */\n  'inputs.reference.cross-dataset.feature-disabled-description':\n    'This feature has been disabled. Read how to enable it in <DocumentationLink>the documentation</DocumentationLink>.',\n  /** Title for a warning telling the user that the current project does not have the \"cross dataset references\" feature */\n  'inputs.reference.cross-dataset.feature-unavailable-title':\n    'Unavailable feature: Cross dataset reference',\n  /** The cross-dataset reference points to a document with an invalid type  */\n  'inputs.reference.cross-dataset.invalid-type':\n    'The referenced document is of invalid type ({{typeName}}) <JsonValue/>',\n  /** The referenced document will open in a new tab (due to external studio) */\n  'inputs.reference.document-opens-in-new-tab': 'This document opens in a new tab',\n  /** Error title for when the document is unavailable (for any possible reason) */\n  'inputs.reference.error.document-unavailable-title': 'Document unavailable',\n  /** Error title for when the referenced document failed to be loaded */\n  'inputs.reference.error.failed-to-load-document-title': 'Failed to load referenced document',\n  /** Error title for when the reference search returned a document that is not an allowed type for the field */\n  'inputs.reference.error.invalid-search-result-type-title':\n    'Search returned a type that\\'s not valid for this reference: \"{{returnedType}}\"',\n  /** Error description for when the document referenced is not one of the types declared as allowed target types in schema */\n  'inputs.reference.error.invalid-type-description':\n    'Referenced document (<code>{{documentId}}</code>) is of type <code>{{actualType}}</code>. According to the schema, referenced documents can only be of type <AllowedTypes />.',\n  /** Error title for when the document referenced is not one of the types declared as allowed target types in schema */\n  'inputs.reference.error.invalid-type-title': 'Document of invalid type',\n  /** Error description for when the user does not have permissions to read the referenced document */\n  'inputs.reference.error.missing-read-permissions-description':\n    'The referenced document could not be accessed due to insufficient permissions',\n  /** Error title for when the user does not have permissions to read the referenced document */\n  'inputs.reference.error.missing-read-permissions-title': 'Insufficient permissions',\n  /** Error description for when the current reference value points to a document that does not exist (on weak references) */\n  'inputs.reference.error.nonexistent-document-description':\n    'The referenced document does not exist (ID: <code>{{documentId}}</code>). You can either remove the reference or replace it with another document.',\n  /** Error title for when the current reference value points to a document that does not exist (on weak references) */\n  'inputs.reference.error.nonexistent-document-title': 'Not found',\n  /** Label for button that clears the reference when it points to a document that does not exist (on weak references) */\n  'inputs.reference.error.nonexistent-document.clear-button-label': 'Clear',\n  /** Error title for when the search for a reference failed. Note that the message sent by the backend may not be localized. */\n  'inputs.reference.error.search-failed-title': 'Reference search failed',\n  /** Alternative text for the image shown in cross-dataset reference input */\n  'inputs.reference.image-preview-alt-text': 'Image preview of referenced document',\n  /** Description for alert shown when a reference in a live-edit document is marked as being weak, the referenced document exists, AND the reference is supposed to be have been strengthened on publish */\n  'inputs.reference.incomplete-reference.finalize-action-description':\n    '<strong>{{referencedDocument}}</strong> is published and this reference should now be finalized.',\n  /** Title for alert shown when a reference in a live-edit document is marked as being weak, the referenced document exists, AND the reference is supposed to be have been strengthened on publish */\n  'inputs.reference.incomplete-reference.finalize-action-title': 'Finalize reference',\n  /** Description for alert shown when a reference in a live-edit document points to a document that exists and has been published, but the reference is still marked as weak */\n  'inputs.reference.incomplete-reference.strengthen-action-description':\n    '<strong>{{referencedDocument}}</strong> is published and this reference should now be converted to a strong reference.',\n  /** Title for alert shown when a reference in a live-edit document points to a document that exists and has been published, but the reference is still marked as weak */\n  'inputs.reference.incomplete-reference.strengthen-action-title': 'Convert to strong reference',\n  /** Label for button that triggers the action that strengthen a reference */\n  'inputs.reference.incomplete-reference.strengthen-button-label': 'Convert to strong reference',\n  /** Label for button that triggers a retry attempt for reference metadata  */\n  'inputs.reference.metadata-error.retry-button-label': 'Retry',\n  /** Title for alert shown when reference metadata fails to be loaded */\n  'inputs.reference.metadata-error.title': 'Unable to load reference metadata',\n  /** Message shown when no documents were found that matched the given search string */\n  'inputs.reference.no-results-for-query': 'No results for <strong>{{searchTerm}}</strong>',\n  /** Text for tooltip showing when a document was edited, using relative time (eg \"how long ago was it edited?\") */\n  'inputs.reference.preview.edited-at-time': 'Edited <RelativeTime/>',\n  /** Accessibility label for icon indicating that document does _not_ have any unpublished changes */\n  'inputs.reference.preview.has-no-unpublished-changes-aria-label': 'No unpublished edits',\n  /** Accessibility label for icon indicating that document has unpublished changes */\n  'inputs.reference.preview.has-unpublished-changes-aria-label': 'Edited',\n  /** Accessibility label for icon indicating that document does _not_ have a published version */\n  'inputs.reference.preview.is-not-published-aria-label': 'Not published',\n  /** Accessibility label for icon indicating that document has a published version */\n  'inputs.reference.preview.is-published-aria-label': 'Published',\n  /** Text for tooltip indicating that a document has no unpublished edits */\n  'inputs.reference.preview.no-unpublished-edits': 'No unpublished edits',\n  /** Text for tooltip indicating that a document has not yet been published */\n  'inputs.reference.preview.not-published': 'Not published',\n  /** Text for tooltip showing when a document was published, using relative time (eg \"how long ago was it published?\") */\n  'inputs.reference.preview.published-at-time': 'Published <RelativeTime/>',\n  /** The referenced document no longer exist and might have been deleted (for weak references) */\n  'inputs.reference.referenced-document-does-not-exist':\n    'The referenced document no longer exist and might have been deleted (document ID: <code>{{documentId}}</code>).',\n  /** The referenced document could not be displayed to the user because of insufficient permissions */\n  'inputs.reference.referenced-document-insufficient-permissions':\n    'The referenced document could not be accessed due to insufficient permissions',\n  /** Label for when the reference input is resolving the initial value for an item */\n  'inputs.reference.resolving-initial-value': 'Resolving initial value',\n  /** Placeholder shown in a reference input with no current value */\n  'inputs.reference.search-placeholder': 'Type to search',\n  /** Explanation of the consequences of leaving the reference as strong instead of weak */\n  'inputs.reference.strength-mismatch.is-strong-consquences':\n    'It will not be possible to delete the reference document without first removing this reference or converting it to weak.',\n  /** Description for alert shown when a reference is supposed to be weak, but the actual value is strong */\n  'inputs.reference.strength-mismatch.is-strong-description':\n    'This reference is <em>strong</em>, but according to the current schema it should be <em>weak</em>.',\n  /** Explanation of the consequences of leaving the reference as weak instead of strong */\n  'inputs.reference.strength-mismatch.is-weak-consquences':\n    'This makes it possible to delete the referenced document without first deleting this reference, leaving this field referencing a nonexisting document.',\n  /** Description for alert shown when a reference is supposed to be strong, but the actual value is weak */\n  'inputs.reference.strength-mismatch.is-weak-description':\n    'This reference is <em>weak</em>, but according to the current schema it should be <em>strong</em>.',\n  /** Label for button that triggers the action that strengthens a reference on strength mismatch */\n  'inputs.reference.strength-mismatch.strengthen-button-label': 'Convert to strong reference',\n  /** Title for alert shown when a reference is supposed to be weak/strong, but the actual value is the opposite of what it is supposed to be */\n  'inputs.reference.strength-mismatch.title': 'Reference strength mismatch',\n  /** Label for button that triggers the action that weakens a reference on strength mismatch */\n  'inputs.reference.strength-mismatch.weaken-button-label': 'Convert to weak reference',\n  /** Action message for generating the slug */\n  'inputs.slug.action.generate': 'Generate',\n  /** Loading message for when the input is actively generating a slug */\n  'inputs.slug.action.generating': 'Generating',\n  /** Error message for when the source to generate a slug from is missing */\n  'inputs.slug.error.missing-source':\n    'Source is missing. Check source on type {{schemaType}} in schema',\n  /** Placeholder for an empty tag input */\n  'inputs.tags.placeholder': 'Enter tag and press ENTER',\n  /** Placeholder for an empty tag input on touch devices */\n  'inputs.tags.placeholder_touch': 'Enter tag',\n  /** Convert to `{{targetType}}` */\n  'inputs.untyped-value.convert-button.text': 'Convert to {{targetType}}',\n  /** Encountered an object value without a <code>_type</code> property. */\n  'inputs.untyped-value.description':\n    'Encountered an object value without a <code>_type</code> property.',\n  /** Either remove the <code>name</code> property of the object declaration, or set <code>_type</code> property on items. */\n  'inputs.untyped-value.details.description':\n    'Either remove the <code>name</code> property of the object declaration, or set <code>_type</code> property on items.',\n  /** Current value (<code>object</code>): */\n  'inputs.untyped-value.details.json-dump-prefix': 'Current value (<code>object</code>):',\n  /** The following types are valid here according to schema: */\n  'inputs.untyped-value.details.multi-type-description':\n    'The following types are valid here according to schema:',\n  /** Developer info */\n  'inputs.untyped-value.details.title': 'Developer info',\n  /** Property value missing <code>_type</code> */\n  'inputs.untyped-value.title': 'Property value missing <code>_type</code>',\n  /** Unset value */\n  'inputs.untyped-value.unset-item-button.text': 'Unset value',\n\n  /** The fallback explanation if no context is provided */\n  'insufficient-permissions-message.not-authorized-explanation':\n    'You do not have permission to access this feature.',\n  /** The explanation when unable to create any document at all */\n  'insufficient-permissions-message.not-authorized-explanation_create-any-document':\n    'You do not have permission to create a document.',\n  /** The explanation when unable to create a particular document */\n  'insufficient-permissions-message.not-authorized-explanation_create-document':\n    'You do not have permission to create this document.',\n  /** The explanation when unable to create a particular type of document */\n  'insufficient-permissions-message.not-authorized-explanation_create-document-type':\n    'You do not have permission to create this kind of document.',\n  /** The explanation when unable to create a new reference in a document */\n  'insufficient-permissions-message.not-authorized-explanation_create-new-reference':\n    'You do not have permission to create a new reference.',\n  /** The explanation when unable to delete a particular document */\n  'insufficient-permissions-message.not-authorized-explanation_delete-document':\n    'You do not have permission to delete this document.',\n  /** The explanation when unable to discard changes in a particular document */\n  'insufficient-permissions-message.not-authorized-explanation_discard-changes':\n    'You do not have permission to discard changes in this document.',\n  /** The explanation when unable to duplicate a particular document */\n  'insufficient-permissions-message.not-authorized-explanation_duplicate-document':\n    'You do not have permission to duplicate this document.',\n  /** The explanation when unable to publish a particular document */\n  'insufficient-permissions-message.not-authorized-explanation_publish-document':\n    'You do not have permission to publish this document.',\n  /** The explanation when unable to unpublish a particular document */\n  'insufficient-permissions-message.not-authorized-explanation_unpublish-document':\n    'You do not have permission to unpublish this document.',\n  /** Appears after the not-authorized message. Lists the current roles. */\n  'insufficient-permissions-message.roles': 'Your roles: <Roles/>',\n  /** The title for the insufficient permissions message component */\n  'insufficient-permissions-message.title': 'Insufficient permissions',\n\n  /** Unexpected error: `{{error}}` */\n  'member-field-error.unexpected-error': 'Unexpected error: {{error}}',\n\n  /** Button label for \"Create new document\" button */\n  'new-document.button': 'Create',\n  /**\n   * Tooltip message displayed when hovering/activating the \"Create new document\" action,\n   * when there are templates/types available for creation\n   */\n  'new-document.create-new-document-label': 'New document',\n  /** Placeholder for the \"filter\" input within the new document menu */\n  'new-document.filter-placeholder': 'Search document types',\n  /** Loading indicator text within the new document menu */\n  'new-document.loading': 'Loading',\n  /** Accessibility label for the list displaying options in the new document menu */\n  'new-document.new-document-aria-label': 'New document',\n  /** Message for when there are no document type options in the new document menu */\n  'new-document.no-document-types-found': 'No document types found',\n  /**\n   * Tooltip message displayed when hovering/activating the \"Create new document\" action,\n   * when there are no templates/types to create from\n   */\n  'new-document.no-document-types-label': 'No document types',\n  /** Message for when no results are found for a specific search query in the new document menu */\n  'new-document.no-results': 'No results for <strong>{{searchQuery}}</strong>',\n  /** Aria label for the button that opens the \"Create new document\" popover/dialog */\n  'new-document.open-dialog-aria-label': 'Create new document',\n  /** Title for \"Create new document\" dialog */\n  'new-document.title': 'Create new document',\n\n  /** Label for action to manage members of the current studio project */\n  'presence.action.manage-members': 'Manage members',\n  /** Accessibility label for presence menu button */\n  'presence.aria-label': 'Global presence',\n  /** Message description for when no one else is currently present */\n  'presence.no-one-else-description': 'Invite people to the project to see their online status.',\n  /** Message title for when no one else is currently present */\n  'presence.no-one-else-title': 'No one else is here',\n  /** Message for when a user is not in a document (displayed in the global presence menu) */\n  'presence.not-in-a-document': 'Not in a document',\n  /** Tooltip content text for presence menu button */\n  'presence.tooltip-content': 'Who is here',\n\n  /** Fallback title shown when a preview does not provide a title */\n  'preview.default.title-fallback': 'Untitled',\n  /** Fallback preview value for types that have \"no value\" (eg null, undefined) */\n  'preview.fallback.no-value': '(no value)',\n  /** Alternative text for image being shown while image is being uploaded, in previews */\n  'preview.image.file-is-being-uploaded.alt-text': 'The image currently being uploaded',\n\n  /* Relative time, just now */\n  'relative-time.just-now': 'just now',\n\n  /** Accessibility label to open search action when the search would go fullscreen (eg on narrower screens) */\n  'search.action-open-aria-label': 'Open search',\n  /** Action label for adding a search filter */\n  'search.action.add-filter': 'Add filter',\n  /** Action label for clearing search filters */\n  'search.action.clear-filters': 'Clear filters',\n  /** Label for action to clear recent searches */\n  'search.action.clear-recent-searches': 'Clear recent searches',\n  /** Accessibility label for action to clear all currently applied document type filters */\n  'search.action.clear-type-filters-aria-label': 'Clear checked filters',\n  /** Label for action to clear all currently applied document type filters */\n  'search.action.clear-type-filters-label': 'Clear',\n  /** Accessibility label for when the search is full screen (on narrow screens) and you want to close the search */\n  'search.action.close-search-aria-label': 'Close search',\n  /** Accessibility label for filtering by document type */\n  'search.action.filter-by-document-type-aria-label': 'Filter by document type',\n  /** Accessibility action label for removing an already applied search filter */\n  'search.action.remove-filter-aria-label': 'Remove filter',\n  /**\n   * Text displayed when either no document type(s) have been selected, or we need a fallback,\n   * eg \"Search for all types\".\n   */\n  'search.action.search-all-types': 'Search all documents',\n  /**\n   * Text displayed when we are able to determine one or more document types that will be used for\n   * searching, and can fit within the space assigned by the design.\n   */\n  'search.action.search-specific-types': 'Search for {{types, list}}',\n  /**\n   * Text displayed when we are able to determine one or more document types that will be used for\n   * searching, but cannot list them all within the space assigned by the design, so we need an\n   * additional \"and X more\" suffix. Allows using pluralization suffixes, eg `_one`, `_other` etc.\n   */\n  'search.action.search-specific-types-truncated': 'Search for {{types, list}} +{{count}} more',\n  /** Dialog title for action to select an asset of unknown type */\n  'search.action.select-asset': 'Select asset',\n  /** Dialog title for action to select a file asset */\n  'search.action.select-asset_file': 'Select file',\n  /** Dialog title for action to select an image asset */\n  'search.action.select-asset_image': 'Select image',\n  /** Accessibility label for when the search is full screen (on narrow screens) and you want to hide filters */\n  'search.action.toggle-filters-aria-label_hide': 'Hide filters',\n  /** Accessibility label for when the search is full screen (on narrow screens) and you want to show filters */\n  'search.action.toggle-filters-aria-label_show': 'Show filters',\n  /** Label for when the search is full screen (on narrow screens) and you want to hide filters */\n  'search.action.toggle-filters-label_hide': 'Hide filters',\n  /** Label for when the search is full screen (on narrow screens) and you want to show filters */\n  'search.action.toggle-filters-label_show': 'Show filters',\n\n  /** Tooltip text for the global search button */\n  'search.button.tooltip': 'Search',\n\n  /**\n   * A list of provided types (use `list` formatter preferably).\n   */\n  'search.document-type-list': '{{types, list}}',\n  /**\n   * In the context of a list of document types - no filtering selection has been done,\n   * thus the default is \"all types\".\n   */\n  'search.document-type-list-all-types': 'All types',\n  /**\n   * A list of provided types that has been truncated - more types are included but not displayed,\n   * thus we need to indicate that there are more. Allows using pluralization suffixes,\n   * eg `_one`, `_other` etc.\n   */\n  'search.document-type-list-truncated': '{{types, list}} +{{count}} more',\n  /** Accessibility label for list displaying the available document types */\n  'search.document-types-aria-label': 'Document types',\n  /** Label for when no document types matching the filter are found */\n  'search.document-types-no-matches-found': 'No matches for {{filter}}',\n  /** Description for error when a filter cannot be displayed, describes that you should check the schema */\n  'search.error.display-filter-description':\n    'This may indicate invalid options defined in your schema.',\n  /** Title for error when a filter cannot be displayed (mainly a developer-oriented error) */\n  'search.error.display-filter-title': 'An error occurred whilst displaying this filter.',\n  /** Description for error when no valid asset source is found, describes that you should check the the current studio config */\n  'search.error.no-valid-asset-source-check-config-description':\n    \"Please ensure it's enabled in your studio configuration file.\",\n  /** Description for error when no valid asset source is found, describes that only the default asset is supported */\n  'search.error.no-valid-asset-source-only-default-description':\n    'Currently, only the default asset source is supported.',\n  /** Title for error when no valid asset sources found */\n  'search.error.no-valid-asset-source-title': 'No valid asset sources found.',\n  /** Helpful description for when search returned an error that we are not able to describe in detail */\n  'search.error.unspecified-error-help-description': 'Please try again or check your connection',\n  /** Title label for when search returned an error that we are not able to describe in detail */\n  'search.error.unspecified-error-title': 'Something went wrong while searching',\n  /**\n   * Label for \"All fields\", a label that appears above the list of available fields when filtering.\n   * If one or more document type has been chosen as filter, this label is replaced with a group of\n   * fields per selected document type\n   */\n  'search.filter-all-fields-header': 'All fields',\n  /** Label for the action of changing from one file to a different file in asset search filter */\n  'search.filter-asset-change_file': 'Change file',\n  /** Label for the action of changing from one image to a different image in asset search filter */\n  'search.filter-asset-change_image': 'Change image',\n  /** Label for the action of clearing the currently selected asset in an image/file filter */\n  'search.filter-asset-clear': 'Clear',\n  /** Label for the action of selecting a file in asset search filter */\n  'search.filter-asset-select_file': 'Select file',\n  /** Label for the action of selecting an image in asset search filter */\n  'search.filter-asset-select_image': 'Select image',\n  /** Label for boolean filter - false */\n  'search.filter-boolean-false': 'False',\n  /** Label for boolean filter - true */\n  'search.filter-boolean-true': 'True',\n  /** Accessibility label for list that lets you filter fields by title, when adding a new filter in search */\n  'search.filter-by-title-aria-label': 'Filter by title',\n  /** Accessibility label for date filter input */\n  'search.filter-date-aria-label': 'Date',\n  /** Accessibility label for selecting end date on the date range search filter */\n  'search.filter-date-range-end-date-aria-label': 'End date',\n  /** Accessibility label for selecting start date on the date range search filter */\n  'search.filter-date-range-start-date-aria-label': 'Start date',\n  /** Accessibility label for selecting the unit (day/month/year) when adding \"X days ago\" search filter */\n  'search.filter-date-unit-aria-label': 'Select unit',\n  /**\n   * Label for \"Days\"/\"Months\"/\"Years\" when selecting it as unit in \"X days ago\" search filter.\n   * Capitalized, as it would be listed in a dropdown.\n   */\n  'search.filter-date-unit_days': 'Days',\n  'search.filter-date-unit_months': 'Months',\n  'search.filter-date-unit_years': 'Years',\n  /** Accessibility label for the input value (days/months/years) when adding \"X days ago\" search filter */\n  'search.filter-date-value-aria-label': 'Unit value',\n  /** Label for \"field description\" shown in tooltip when navigating list of possible fields to filter */\n  'search.filter-field-tooltip-description': 'Field description',\n  /** Label for \"field name\" shown in tooltip when navigating list of possible fields to filter */\n  'search.filter-field-tooltip-name': 'Field name',\n  /** Label for \"Used in document types\", a list of the document types a field appears in. Shown in tooltip when navigating list of possible fields to filter */\n  'search.filter-field-tooltip-used-in-document-types': 'Used in document types',\n  /** Label for when no fields/filters are found for the given term */\n  'search.filter-no-matches-found': 'No matches for {{filter}}',\n  /** Placeholder value for maximum numeric value filter */\n  'search.filter-number-max-value-placeholder': 'Max value',\n  /** Placeholder value for minimum numeric value filter */\n  'search.filter-number-min-value-placeholder': 'Min value',\n  /** Placeholder value for the number filter */\n  'search.filter-number-value-placeholder': 'Value',\n  /** Placeholder for the \"Filter\" input, when narrowing possible fields/filters */\n  'search.filter-placeholder': 'Filter',\n  /** Label for the action of clearing the currently selected document in a reference filter */\n  'search.filter-reference-clear': 'Clear',\n  /**\n   * Label for \"shared fields\", a label that appears above a list of fields that all filtered types\n   * have in common, when adding a new filter. For instance, if \"book\" and \"employee\" both have a\n   * \"title\" field, this field would be listed under \"shared fields\".\n   * */\n  'search.filter-shared-fields-header': 'Shared fields',\n  /** Placeholder value for the string filter */\n  'search.filter-string-value-placeholder': 'Value',\n  /** Label/placeholder prompting user to select one of the predefined, allowed values for a string field */\n  'search.filter-string-value-select-predefined-value': 'Select',\n  /** Accessibility label for the \"Filters\" list, that is shown when using \"Add filter\" in search (singular) */\n  'search.filters-aria-label_one': 'Filter',\n  /** Accessibility label for the \"Filters\" list, that is shown when using \"Add filter\" in search (plural) */\n  'search.filters-aria-label_other': 'Filters',\n  /** Label for instructions on how to use the search - displayed when no recent searches are available */\n  'search.instructions': 'Use <ControlsIcon/> to refine your search',\n  /** Helpful description for when no search results are found */\n  'search.no-results-help-description': 'Try another keyword or adjust your filters',\n  /** Title label for when no search results are found */\n  'search.no-results-title': 'No results found',\n  /**\n   * Individual search operators.\n   *\n   * The `name` variant is the form we use when the user is building a query, and selecting from a\n   * list of available operators for a field. Keep in mind that since the user knows what the field\n   * represents, we do not need to contextualize too much, and that the user may not be a developer\n   * eg prefer \"quantity is\" over \"array has length\". Additionally, (if applicable in language) use\n   * lowercased names.\n   *\n   * The `description` variant is the form shown once the filter has enough information to apply,\n   * and is shown in the list of applied filters. It is passed components that _should_ be used to\n   * compose the filter string, and to format them correctly:\n   *\n   * `<Field/>` - eg \"Bird species\", \"Category\", \"Date of birth\"\n   * `<Operator>operator text</Operator>` - eg \"has \", \"includes\", \"is\"\n   * `<Value>{{value}}</Value>` - eg \"Hawk\", \"Sparrow\", \"Eagle\"\n   *\n   * Where applicable, a `count` is passed, allowing you to pluralize where needed, by using\n   * suffixes such as `_zero`, `_one`, `_other` etc.\n   *\n   * Prefer (reasonable) brevity since many filters may be applied. For instance:\n   * `<Field/> has  <Value/>` may be better than\n   * `<Field/> has less than or equal to <Value/>`\n   **/\n  /* Array should have a count the given filter value */\n  'search.operator.array-count-equal.description_one':\n    '<Field/> <Operator>has</Operator> <Value>{{count}} item</Value>',\n  'search.operator.array-count-equal.description_other':\n    '<Field/> <Operator>has</Operator> <Value>{{count}} items</Value>',\n  'search.operator.array-count-equal.name': 'quantity is',\n  /* Array should have a count greater than given filter value */\n  'search.operator.array-count-gt.description_one':\n    '<Field/> <Operator>has ></Operator> <Value>{{count}} item</Value>',\n  'search.operator.array-count-gt.description_other':\n    '<Field/> <Operator>has ></Operator> <Value>{{count}} items</Value>',\n  'search.operator.array-count-gt.name': 'quantity greater than',\n  /* Array should have a count greater than or equal to the given filter value */\n  'search.operator.array-count-gte.description_one':\n    '<Field/> <Operator>has </Operator> <Value>{{count}} item</Value>',\n  'search.operator.array-count-gte.description_other':\n    '<Field/> <Operator>has </Operator> <Value>{{count}} items</Value>',\n  'search.operator.array-count-gte.name': 'quantity greater than or equal to',\n  /* Array should have a count less than given filter value */\n  'search.operator.array-count-lt.description_one':\n    '<Field/> <Operator>has <</Operator> <Value>{{count}} item</Value>',\n  'search.operator.array-count-lt.description_other':\n    '<Field/> <Operator>has <</Operator> <Value>{{count}} items</Value>',\n  'search.operator.array-count-lt.name': 'quantity less than',\n  /* Array should have a count less than or equal to the given filter value */\n  'search.operator.array-count-lte.description_one':\n    '<Field/> <Operator>has </Operator> <Value>{{count}} item</Value>',\n  'search.operator.array-count-lte.description_other':\n    '<Field/> <Operator>has </Operator> <Value>{{count}} items</Value>',\n  'search.operator.array-count-lte.name': 'quantity less than or equal to',\n  /* Array should have a count that is not equal to the given filter value */\n  'search.operator.array-count-not-equal.description_one':\n    '<Field/> <Operator>does not have</Operator> <Value>{{count}} item</Value>',\n  'search.operator.array-count-not-equal.description_other':\n    '<Field/> <Operator>does not have</Operator> <Value>{{count}} items</Value>',\n  'search.operator.array-count-not-equal.name': 'quantity is not',\n  /**\n   * Array should have a count within the range of given filter values.\n   * Gets passed `{{from}}` and `{{to}}` values.\n   **/\n  'search.operator.array-count-range.description':\n    '<Field/> <Operator>has between</Operator> <Value>{{from}}  {{to}} items</Value>',\n  'search.operator.array-count-range.name': 'quantity is between',\n  /* Array should include the given value */\n  'search.operator.array-list-includes.description':\n    '<Field/> <Operator>includes</Operator> <Value>{{value}}</Value>',\n  'search.operator.array-list-includes.name': 'includes',\n  /* Array should not include the given value */\n  'search.operator.array-list-not-includes.description':\n    '<Field/> <Operator>does not include</Operator> <Value>{{value}}</Value>',\n  'search.operator.array-list-not-includes.name': 'does not include',\n  /* Array should include the given reference */\n  'search.operator.array-reference-includes.description':\n    '<Field/> <Operator>includes</Operator> <Value>{{value}}</Value>',\n  'search.operator.array-reference-includes.name': 'includes',\n  /* Array should not include the given reference */\n  'search.operator.array-reference-not-includes.description':\n    '<Field/> <Operator>does not include</Operator> <Value>{{value}}</Value>',\n  'search.operator.array-reference-not-includes.name': 'does not include',\n  /* Asset (file) should be the selected asset */\n  'search.operator.asset-file-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.asset-file-equal.name': 'is',\n  /* Asset (file) should not be the selected asset */\n  'search.operator.asset-file-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.asset-file-not-equal.name': 'is not',\n  /* Asset (image) should be the selected asset */\n  'search.operator.asset-image-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.asset-image-equal.name': 'is',\n  /* Asset (image) should not be the selected asset */\n  'search.operator.asset-image-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.asset-image-not-equal.name': 'is not',\n  /**\n   * Boolean value should be the given filter value (true/false).\n   * Context passed is `true` and `false`, allowing for more specific translations:\n   * - `search.operator.boolean-equal.description_true`\n   * - `search.operator.boolean-equal.description_false`\n   */\n  'search.operator.boolean-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.boolean-equal.name': 'is',\n  /* Date should be after (later than) given filter value */\n  'search.operator.date-after.description':\n    '<Field/> <Operator>is after</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-after.name': 'after',\n  /* Date should be before (earlier than) given filter value */\n  'search.operator.date-before.description':\n    '<Field/> <Operator>is before</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-before.name': 'before',\n  /* Date should be the given filter value */\n  'search.operator.date-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-equal.name': 'is',\n  /* Date should be within the given filter value range (eg \"within the last X days\") */\n  'search.operator.date-last.description':\n    '<Field/> <Operator>is in the last</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-last.name': 'last',\n  /* Date should not be the given filter value */\n  'search.operator.date-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-not-equal.name': 'is not',\n  /* Date should be within the range of given filter values */\n  'search.operator.date-range.description': '<Field/> <Operator>is between</Operator> <Value/>',\n  'search.operator.date-range.name': 'is between',\n  /* Date and time should be after (later than) given filter value */\n  'search.operator.date-time-after.description':\n    '<Field/> <Operator>is after</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-time-after.name': 'after',\n  /* Date and time should be before (earlier than) given filter value */\n  'search.operator.date-time-before.description':\n    '<Field/> <Operator>is before</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-time-before.name': 'before',\n  /* Date and time should be the given filter value */\n  'search.operator.date-time-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-time-equal.name': 'is',\n  /* Date and time should be within the given filter value range (eg \"within the last X days\") */\n  'search.operator.date-time-last.description':\n    '<Field/> <Operator>is in the last</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-time-last.name': 'last',\n  /* Date and time should not be the given filter value */\n  'search.operator.date-time-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.date-time-not-equal.name': 'is not',\n  /* Date and time should be within the range of given filter values */\n  'search.operator.date-time-range.description':\n    '<Field/> <Operator>is between</Operator> <Value/>',\n  'search.operator.date-time-range.name': 'is between',\n  /* Value should be defined */\n  'search.operator.defined.description':\n    '<Field/> <Operator>is</Operator> <Value>not empty</Value>',\n  'search.operator.defined.name': 'not empty',\n  /* Value should not be defined */\n  'search.operator.not-defined.description':\n    '<Field/> <Operator>is</Operator> <Value>empty</Value>',\n  'search.operator.not-defined.name': 'empty',\n  /* Number should be the given filter value */\n  'search.operator.number-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.number-equal.name': 'is',\n  /* Number should be greater than given filter value */\n  'search.operator.number-gt.description':\n    '<Field/> <Operator>></Operator> <Value>{{value}}</Value>',\n  'search.operator.number-gt.name': 'greater than',\n  /* Number should be greater than or the given filter value */\n  'search.operator.number-gte.description':\n    '<Field/> <Operator></Operator> <Value>{{value}}</Value>',\n  'search.operator.number-gte.name': 'greater than or equal to',\n  /* Number should be less than given filter value */\n  'search.operator.number-lt.description':\n    '<Field/> <Operator><</Operator> <Value>{{value}}</Value>',\n  'search.operator.number-lt.name': 'less than',\n  /* Number should be less than or the given filter value */\n  'search.operator.number-lte.description':\n    '<Field/> <Operator></Operator> <Value>{{value}}</Value>',\n  'search.operator.number-lte.name': 'less than or equal to',\n  /* Number should not be the given filter value */\n  'search.operator.number-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.number-not-equal.name': 'is not',\n  /* Number should be within the range of given filter values */\n  'search.operator.number-range.description':\n    '<Field/> <Operator>is between</Operator> <Value>{{from}}  {{to}}</Value>',\n  'search.operator.number-range.name': 'is between',\n  /* Portable Text should contain the given filter value */\n  'search.operator.portable-text-contains.description':\n    '<Field/> <Operator>contains</Operator> <Value>{{value}}</Value>',\n  'search.operator.portable-text-contains.name': 'contains',\n  /* Portable Text should be the given filter value */\n  'search.operator.portable-text-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.portable-text-equal.name': 'is',\n  /* Portable Text should not contain the given filter value */\n  'search.operator.portable-text-not-contains.description':\n    '<Field/> <Operator>does not contain</Operator> <Value>{{value}}</Value>',\n  'search.operator.portable-text-not-contains.name': 'does not contain',\n  /* Portable Text should not be the given filter value */\n  'search.operator.portable-text-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.portable-text-not-equal.name': 'is not',\n  /* References the given asset (file) */\n  'search.operator.reference-asset-file.description':\n    '<Field/> <Operator></Operator> <Value>{{value}}</Value>',\n  'search.operator.reference-asset-file.name': 'file',\n  /* References the given asset (image) */\n  'search.operator.reference-asset-image.description':\n    '<Field/> <Operator></Operator> <Value>{{value}}</Value>',\n  'search.operator.reference-asset-image.name': 'image',\n  /* References the given document */\n  'search.operator.reference-document.description':\n    '<Field/> <Operator></Operator> <Value>{{value}}</Value>',\n  'search.operator.reference-document.name': 'document',\n  /* Reference should be the given document */\n  'search.operator.reference-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.reference-equal.name': 'is',\n  /* Reference should not be the given document */\n  'search.operator.reference-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.reference-not-equal.name': 'is not',\n  /* Slug contains the given value */\n  'search.operator.slug-contains.description':\n    '<Field/> <Operator>contains</Operator> <Value>{{value}}</Value>',\n  'search.operator.slug-contains.name': 'contains',\n  /* Slug equals the given filter value */\n  'search.operator.slug-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.slug-equal.name': 'is',\n  /* Slug does not contain the given value */\n  'search.operator.slug-not-contains.description':\n    '<Field/> <Operator>does not contain</Operator> <Value>{{value}}</Value>',\n  'search.operator.slug-not-contains.name': 'does not contain',\n  /* Slug does not equal the given filter value */\n  'search.operator.slug-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.slug-not-equal.name': 'is not',\n  /* String contains the given filter value */\n  'search.operator.string-contains.description':\n    '<Field/> <Operator>contains</Operator> <Value>{{value}}</Value>',\n  'search.operator.string-contains.name': 'contains',\n  /* String equals the given filter value */\n  'search.operator.string-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.string-equal.name': 'is',\n  /* String equals one of the predefined allowed values */\n  'search.operator.string-list-equal.description':\n    '<Field/> <Operator>is</Operator> <Value>{{value}}</Value>',\n  'search.operator.string-list-equal.name': 'is',\n  /* String does not equal one of the predefined allowed values */\n  'search.operator.string-list-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.string-list-not-equal.name': 'is not',\n  /* String does not contain the given filter value */\n  'search.operator.string-not-contains.description':\n    '<Field/> <Operator>does not contain</Operator> <Value>{{value}}</Value>',\n  'search.operator.string-not-contains.name': 'does not contain',\n  /* String does not equal the given filter value */\n  'search.operator.string-not-equal.description':\n    '<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>',\n  'search.operator.string-not-equal.name': 'is not',\n  /** Label for the \"Best match\" search ordering type */\n  'search.ordering.best-match-label': 'Best match',\n  /** Label for the \"Created: Oldest first\" search ordering type */\n  'search.ordering.created-ascending-label': 'Created: Oldest first',\n  /** Label for the \"Created: Newest first\" search ordering type */\n  'search.ordering.created-descending-label': 'Created: Newest first',\n  /** Label for the \"Updated: Oldest first\" search ordering type */\n  'search.ordering.updated-ascending-label': 'Updated: Oldest first',\n  /** Label for the \"Updated: Newest first\" search ordering type */\n  'search.ordering.updated-descending-label': 'Updated: Newest first',\n  /** Placeholder text for the global search input field */\n  'search.placeholder': 'Search',\n  /** Accessibility label for the recent searches section, shown when no valid search terms has been given */\n  'search.recent-searches-aria-label': 'Recent searches',\n  /** Label/heading shown for the recent searches section */\n  'search.recent-searches-label': 'Recent searches',\n  /** Accessibility label for the search results section, shown when the user has typed valid terms */\n  'search.search-results-aria-label': 'Search results',\n  /** Accessibility label for the navbar status button */\n  'status-button.aria-label': 'Configuration status',\n\n  /** Description for error when the timeline for the given document can't be loaded */\n  'timeline.error.load-document-changes-description':\n    'Document history transactions have not been affected.',\n  /** Title for error when the timeline for the given document can't be loaded */\n  'timeline.error.load-document-changes-title':\n    'An error occurred whilst retrieving document changes.',\n  /** Error description for when the document doesn't have history */\n  'timeline.error.no-document-history-description':\n    'When changing the content of the document, the document versions will appear in this menu.',\n  /** Error title for when the document doesn't have history */\n  'timeline.error.no-document-history-title': 'No document history',\n  /** Error prompt when revision cannot be loaded */\n  'timeline.error.unable-to-load-revision': 'Unable to load revision',\n  /** Label for when the timeline item is the latest in the history */\n  'timeline.latest': 'Latest',\n  /** Label for latest version for timeline menu dropdown */\n  'timeline.latest-version': 'Latest version',\n  /** The aria-label for the list of revisions in the timeline */\n  'timeline.list.aria-label': 'Document revisions',\n  /** Label for loading history */\n  'timeline.loading-history': 'Loading history',\n  /** Label shown in review changes timeline when a document has been created */\n  'timeline.operation.created': 'Created',\n  /** Label shown in review changes timeline when a document was initially created */\n  'timeline.operation.created-initial': 'Created',\n  /** Label shown in review changes timeline when a document was initially created, with a timestamp */\n  'timeline.operation.created-initial_timestamp': 'Created: {{timestamp, datetime}}',\n  /** Label shown in review changes timeline when a document has been created, with a timestamp */\n  'timeline.operation.created_timestamp': 'Created: {{timestamp, datetime}}',\n  /** Label shown in review changes timeline when a document has been deleted */\n  'timeline.operation.deleted': 'Deleted',\n  /** Label shown in review changes timeline when a document has been deleted, with a timestamp */\n  'timeline.operation.deleted_timestamp': 'Deleted: {{timestamp, datetime}}',\n  /** Label shown in review changes timeline when a draft has been discarded */\n  'timeline.operation.draft-discarded': 'Discarded draft',\n  /** Label shown in review changes timeline when a draft has been discarded, with a timestamp */\n  'timeline.operation.draft-discarded_timestamp': 'Discarded draft: {{timestamp, datetime}}',\n  /** Label shown in review changes timeline when a draft has been edited */\n  'timeline.operation.edited-draft': 'Edited',\n  /** Label shown in review changes timeline when a draft has been edited, with a timestamp */\n  'timeline.operation.edited-draft_timestamp': 'Edited: {{timestamp, datetime}}',\n  /** Label shown in review changes timeline when a document has been edited live */\n  'timeline.operation.edited-live': 'Live edited',\n  /** Label shown in review changes timeline when a document has been edited live, with a timestamp */\n  'timeline.operation.edited-live_timestamp': 'Live edited: {{timestamp, datetime}}',\n  /** Label shown in review changes timeline when a document was published */\n  'timeline.operation.published': 'Published',\n  /** Label shown in review changes timeline when a document was published, with a timestamp */\n  'timeline.operation.published_timestamp': 'Published: {{timestamp, datetime}}',\n  /** Label shown in review changes timeline when a document was unpublished */\n  'timeline.operation.unpublished': 'Unpublished',\n  /** Label shown in review changes timeline when a document was unpublished, with a timestamp */\n  'timeline.operation.unpublished_timestamp': 'Unpublished: {{timestamp, datetime}}',\n  /**\n   * Label for determining since which version the changes for timeline menu dropdown are showing.\n   * Receives the time label as a parameter (`timestamp`).\n   */\n  'timeline.since': 'Since: {{timestamp, datetime}}',\n  /** Label for missing change version for timeline menu dropdown are showing */\n  'timeline.since-version-missing': 'Since: unknown version',\n  /**Aria label for the action buttons in the PTE toolbar */\n  'toolbar.portable-text.action-button-aria-label': '{{action}}',\n  /** Label for the button showed after trial ended */\n  'user-menu.action.free-trial-finished': 'Upgrade from free',\n  /** Label for button showing the free trial days left */\n  'user-menu.action.free-trial_one': '{{count}} day left in trial',\n  'user-menu.action.free-trial_other': '{{count}} days left in trial',\n  /** Label for action to invite members to the current sanity project */\n  'user-menu.action.invite-members': 'Invite members',\n  /** Accessibility label for action to invite members to the current sanity project */\n  'user-menu.action.invite-members-aria-label': 'Invite members',\n  /** Label for action to manage the current sanity project */\n  'user-menu.action.manage-project': 'Manage project',\n  /** Accessibility label for the action to manage the current project */\n  'user-menu.action.manage-project-aria-label': 'Manage project',\n  /** Tooltip helper text when portable text annotation is disabled for empty block*/\n  'user-menu.action.portable-text.annotation-disabled_empty-block':\n    'Cannot apply {{name}} to empty block',\n  /** Tooltip helper text when portable text annotation is disabled for multiple blocks */\n  'user-menu.action.portable-text.annotation-disabled_multiple-blocks':\n    'Cannot apply {{name}} to multiple blocks',\n  /** Label for action to sign out of the current sanity project */\n  'user-menu.action.sign-out': 'Sign out',\n  /** Title for appearance section for the current studio (dark / light / system scheme) */\n  'user-menu.appearance-title': 'Appearance',\n  /** Label for close menu button for user menu */\n  'user-menu.close-menu': 'Close menu',\n  /** Description for using the \"dark theme\" in the appearance user menu */\n  'user-menu.color-scheme.dark-description': 'Use dark appearance',\n  /** Title for using the \"dark theme\" in the appearance user menu */\n  'user-menu.color-scheme.dark-title': 'Dark',\n  /** Description for using the \"light theme\" in the appearance user menu */\n  'user-menu.color-scheme.light-description': 'Use light appearance',\n  /** Title for using the \"light theme\" in the appearance user menu */\n  'user-menu.color-scheme.light-title': 'Light',\n  /** Description for using \"system apparence\" in the appearance user menu */\n  'user-menu.color-scheme.system-description': 'Use system appearance',\n  /** Title for using system apparence in the appearance user menu */\n  'user-menu.color-scheme.system-title': 'System',\n  /** Title for locale section for the current studio */\n  'user-menu.locale-title': 'Language',\n  /** Label for tooltip to show which provider the currently logged in user is using */\n  'user-menu.login-provider': 'Signed in with {{providerTitle}}',\n  /** Label for open menu button for user menu */\n  'user-menu.open-menu': 'Open menu',\n  /**\n   * Label for action to add a workspace (currently a developer-oriented action, as this will\n   * lead to the documentation on workspace configuration)\n   */\n  'workspaces.action.add-workspace': 'Add workspace',\n  /**\n   * Label for action to choose a different workspace, in the case where you are not logged in,\n   * have selected a workspace, and are faced with the authentication options for the selected\n   * workspace. In other words, label for the action shown when you have reconsidered which\n   * workspace to authenticate in.\n   */\n  'workspaces.action.choose-another-workspace': 'Choose another workspace',\n  /** Label for heading that indicates that you can choose your workspace */\n  'workspaces.choose-your-workspace-label': 'Choose your workspace',\n  /** Label for the workspace menu */\n  'workspaces.select-workspace-aria-label': 'Select workspace',\n  /** Button label for opening the workspace switcher */\n  'workspaces.select-workspace-label': 'Select workspace',\n  /** Tooltip for the workspace menu */\n  'workspaces.select-workspace-tooltip': 'Select workspace',\n  /** Title for Workplaces dropdown menu */\n  'workspaces.title': 'Workspaces',\n})\n\n/**\n * The i18n resource keys for the studio.\n *\n * @alpha\n * @hidden\n */\nexport type StudioLocaleResourceKeys = keyof typeof studioLocaleStrings\n\n/**\n * Locale resources for the core studio namespace, eg US English locale resources.\n *\n * @beta\n * @hidden\n */\nexport const studioDefaultLocaleResources = defineLocaleResourceBundle({\n  locale: 'en-US',\n  namespace: studioLocaleNamespace,\n  resources: studioLocaleStrings,\n})\n","/* eslint sort-keys: \"error\" */\nimport {defineLocaleResourceBundle, defineLocalesResources} from '../helpers'\nimport {validationLocaleNamespace} from '../localeNamespaces'\n\n/**\n * The string resources for validation.\n *\n * @internal\n * @hidden\n */\nconst validationLocaleStrings = defineLocalesResources('validation', {\n  /** Array must have exactly \"$wantedLength\" items, but has more/less */\n  'array.exact-length': 'Must have exactly {{wantedLength}} items',\n  /** Portable Text array must have exactly \"$wantedLength\" blocks, but has more/less */\n  'array.exact-length_blocks': 'Must have exactly {{wantedLength}} blocks',\n  /** Array item is a duplicate, but array wants only unique items */\n  'array.item-duplicate': \"Can't be a duplicate\",\n  /** Array has more than the maximum of \"$maxLength\" items */\n  'array.maximum-length': 'Must have at most {{maxLength}} items',\n  /** Portable Text array has more than the maximum of \"$maxLength\" items */\n  'array.maximum-length_blocks': 'Must have at most {{maxLength}} blocks',\n  /** Array has less than the minimum of \"$minLength\" items */\n  'array.minimum-length': 'Must have at least {{minLength}} items',\n  /** Portable Text array has less than the minimum of \"$minLength\" blocks */\n  'array.minimum-length_blocks': 'Must have at least {{minLength}} blocks',\n  /** Date is not valid or not in the correct format (ISO-8601) */\n  'date.invalid-format': 'Must be a valid ISO-8601 formatted date string',\n  /** Date is later than the given maximum date \"$maxDate\" */\n  'date.maximum': 'Must be at or before {{maxDate}}',\n  /** Date is earlier than the given minimum date \"$minDate\" */\n  'date.minimum': 'Must be at or after {{minDate}}',\n  /** A value of incorrect type is found, eg found `number` instead of `string` */\n  'generic.incorrect-type': 'Expected type \"{{expectedType}}\", got \"{{actualType}}\"',\n  /** Value is not one of the values specifically allowed */\n  'generic.not-allowed': 'Value did not match any allowed values',\n  /** Value \"$givenValue\" is not one of the values specifically allowed */\n  'generic.not-allowed_hint': 'Value \"{{hint}}\" did not match any allowed values',\n  /** A value is expected, but none is provided */\n  'generic.required': 'Required',\n  /** Number is less than the given minimum threshold value \"$threshold\" */\n  'number.greater-than': 'Must be greater than {{threshold}}',\n  /** Number is greater than the given maximum threshold value \"$threshold\" */\n  'number.less-than': 'Must be less than {{threshold}}',\n  /** Number is higher than the given maximum value \"$maxNumber\" */\n  'number.maximum': 'Must be lower than or equal to {{maxNumber}}',\n  /** Number has more precision (decimals) than the allowed \"$limit\" */\n  'number.maximum-precision': 'Max precision is {{limit}}',\n  /** Number is lower than the given minimum value \"$minNumber\" */\n  'number.minimum': 'Must be greater than or equal to {{minNumber}}',\n  /** Number is not an integer (\"whole number\") */\n  'number.non-integer': 'Must be an integer',\n  /** Object is missing a reference to an asset document in its `asset` field */\n  'object.asset-required': 'Asset is required',\n  /** Object is missing a reference to a file asset document in its `asset` field */\n  'object.asset-required_file': 'File is required',\n  /** Object is missing a reference to an image asset document in its `asset` field */\n  'object.asset-required_image': 'Image is required',\n  /** Object is not a reference to a document (eg `{_ref: 'documentId'}`) */\n  'object.not-reference': 'Must be a reference to a document',\n  /** Object references a document which is not published */\n  'object.reference-not-published': 'Referenced document must be published',\n  /** Accessibility label for closing the validation panel */\n  'panel.close-button-aria-label': 'Close validation',\n  /** Message shown when the validation panel is opened but there are no errors/warnings */\n  'panel.no-errors-message': 'No validation errors',\n  /** Title for the actual \"Validation\" panel/feature */\n  'panel.title': 'Validation',\n  /** Slug is an object, but is missing a `current` string property */\n  'slug.missing-current': 'Slug must have a value',\n  /** Slug is not an object (eg `{current: 'some-slug'}`) */\n  'slug.not-object': 'Slug must be an object',\n  /** Slug is already in use somewhere else, but needs to be unique */\n  'slug.not-unique': 'Slug is already in use',\n  /** String is not a valid email address */\n  'string.email': 'Must be a valid email address',\n  /** String has a different character length than the exact number \"$wantedLength\" */\n  'string.exact-length': 'Must be exactly {{wantedLength}} characters long',\n  /** String contains characters that are not in lowercase  */\n  'string.lowercase': 'Must be all lowercase characters',\n  /** String is longer than the limit of \"$maxLength\" characters */\n  'string.maximum-length': 'Must be at most {{maxLength}} characters long',\n  /** String is shorter than the limit of \"$minLength\" characters */\n  'string.minimum-length': 'Must be at least {{minLength}} characters long',\n  /** String does not match the given regular expression, but should */\n  'string.regex-does-not-match': 'Does not match \"{{name}}\"-pattern',\n  /** String matches the given regular expression, but should not */\n  'string.regex-match': 'Should not match \"{{name}}\"-pattern',\n  /** String contains characters that are not in uppercase */\n  'string.uppercase': 'Must be all uppercase characters',\n  /** String contains a protocol/scheme that is not allowed, eg (`ftp`, `mailto`) */\n  'string.url.disallowed-scheme': 'Does not match allowed protocols/schemes',\n  /** String contains a URL with a username or password specified before the host */\n  'string.url.includes-credentials': 'Username/password not allowed',\n  /** String is not a valid URL */\n  'string.url.invalid': 'Not a valid URL',\n  /** String is not an absolute URL (eg it is missing a protocol/host) */\n  'string.url.not-absolute': 'Relative URLs are not allowed',\n  /** String is not a relative URL (eg it contains a protocol/host) */\n  'string.url.not-relative': 'Only relative URLs are allowed',\n} as const)\n\n/**\n * The i18n resource keys for the validation.\n *\n * @alpha\n * @hidden\n */\nexport type ValidationLocaleResourceKeys = keyof typeof validationLocaleStrings\n\n/**\n * Locale resources for the validation namespace, eg US English locale resources.\n *\n * @beta\n * @hidden\n */\nexport const validationLocaleResources = defineLocaleResourceBundle({\n  locale: 'en-US',\n  namespace: validationLocaleNamespace,\n  resources: validationLocaleStrings,\n})\n","import {studioDefaultLocaleResources} from './bundles/studio'\nimport {validationLocaleResources} from './bundles/validation'\nimport {defineLocale} from './helpers'\n\n/**\n * The default US English locale for the studio.\n *\n * @internal\n * @hidden\n */\nexport const usEnglishLocale = defineLocale({\n  id: 'en-US',\n  title: 'English (US)',\n  bundles: [studioDefaultLocaleResources, validationLocaleResources],\n\n  weekInfo: {\n    firstDay: 7, // Sunday\n    weekend: [6, 7], // Saturday, Sunday\n    minimalDays: 1,\n  },\n})\n\n/**\n * The default locale for the studio.\n *\n * @internal\n * @hidden\n */\nexport const defaultLocale = usEnglishLocale\n","/**\n * Whether or not the current environment supports localStorage.\n * Checks that values can actually be set/removed, to trigger any privacy settings.\n *\n * @internal\n */\nexport const supportsLocalStorage = (() => {\n  const key = '__tmp_supports_local_storage'\n\n  try {\n    if (typeof localStorage === 'undefined') {\n      return false\n    }\n\n    localStorage.setItem(key, '---')\n    localStorage.removeItem(key)\n    return true\n  } catch (err) {\n    return false\n  }\n})()\n","import {supportsLocalStorage} from '../util/supportsLocalStorage'\n\n/**\n * @todo Rework to use settings store\n */\n\nconst LOCAL_STORAGE_PREFIX = 'sanity-locale'\n\n/**\n * Get the users' preferred locale, if any\n *\n * @param projectId - Project ID to segment on\n * @param sourceId - Source ID to segment on\n * @returns Locale identifier, or `undefined`\n * @internal\n * @hidden\n */\nexport function getPreferredLocale(projectId: string, sourceId: string): string | undefined {\n  if (!supportsLocalStorage) {\n    return undefined\n  }\n  const locale = localStorage.getItem(getItemKey(projectId, sourceId))\n  return locale ?? undefined\n}\n\n/**\n * Store the users' preferred locale\n *\n * @param projectId - Project ID to segment on\n * @param sourceId - Source ID to segment on\n * @param locale - Locale to store\n * @returns\n * @internal\n * @hidden\n */\nexport function storePreferredLocale(projectId: string, sourceId: string, locale: string): void {\n  if (!supportsLocalStorage) {\n    return\n  }\n  localStorage.setItem(getItemKey(projectId, sourceId), locale)\n}\n\n/**\n * Get the key used to store the setting in localStorage\n *\n * @param projectId - Project ID to segment on\n * @param sourceId - Source ID to segment on\n * @returns Storage key\n * @internal\n */\nfunction getItemKey(projectId: string, sourceId: string) {\n  return [LOCAL_STORAGE_PREFIX, projectId, sourceId].join(':')\n}\n","import {type i18n} from 'i18next'\nimport {type PropsWithChildren, Suspense, useCallback, useMemo, useSyncExternalStore} from 'react'\nimport {I18nextProvider} from 'react-i18next'\n\nimport {LoadingBlock} from '../../components/loadingBlock'\nimport {useSource} from '../../studio'\nimport {LocaleContext, type LocaleContextValue} from '../LocaleContext'\nimport {defaultLocale} from '../locales'\nimport {storePreferredLocale} from '../localeStore'\nimport {type Locale} from '../types'\n\n/**\n * @internal\n * @hidden\n */\nexport function LocaleProvider(props: PropsWithChildren) {\n  const {\n    projectId,\n    name: sourceId,\n\n    i18n: {locales},\n    __internal: {i18next},\n  } = useSource()\n\n  return (\n    <LocaleProviderBase\n      {...props}\n      projectId={projectId}\n      sourceId={sourceId}\n      locales={locales}\n      i18next={i18next}\n    />\n  )\n}\n\n/**\n * @internal\n * @hidden\n */\nexport function LocaleProviderBase({\n  projectId,\n  sourceId,\n  locales,\n  i18next,\n  children,\n}: PropsWithChildren<{\n  projectId: string\n  sourceId: string\n  locales: Locale[]\n  i18next: i18n\n}>) {\n  const subscribe = useCallback(\n    (callback: () => void) => {\n      i18next.on('languageChanged', callback)\n      return () => i18next.off('languageChanged', callback)\n    },\n    [i18next],\n  )\n  const currentLocale = useSyncExternalStore(\n    subscribe,\n    () => locales.find((candidate) => i18next.language === candidate.id) || defaultLocale,\n  )\n\n  const context = useMemo<LocaleContextValue>(\n    () => ({\n      locales,\n      currentLocale,\n      __internal: {i18next},\n      changeLocale: async (newLocale: string) => {\n        storePreferredLocale(projectId, sourceId, newLocale)\n        await i18next.changeLanguage(newLocale)\n      },\n    }),\n    [currentLocale, i18next, locales, projectId, sourceId],\n  )\n\n  return (\n    <Suspense fallback={<LoadingBlock />}>\n      <I18nextProvider i18n={i18next}>\n        {/* Use locale as key to force re-render, updating non-reactive parts */}\n        <LocaleContext.Provider value={context} key={currentLocale.id}>\n          {children}\n        </LocaleContext.Provider>\n      </I18nextProvider>\n    </Suspense>\n  )\n}\n","import {useCallback, useMemo} from 'react'\n\nimport {isNonNullable} from '../../util'\nimport {type I18nNode} from './useI18nText'\nimport {useTranslation} from './useTranslation'\n\n/**\n * Similar to `useI18nText` except returns a function that can be called\n * conditionally.\n * @internal\n */\nexport function useGetI18nText<TNode extends I18nNode<TNode>>(\n  input: TNode | undefined | Array<TNode | undefined>,\n): (node: TNode) => TNode {\n  const items = Array.isArray(input) ? input : [input]\n  const stableNamespaces = JSON.stringify(\n    items\n      .flatMap((item) => (item?.i18n ? Object.values(item.i18n).map(({ns}) => ns) : []))\n      .filter(isNonNullable)\n      .sort(),\n  )\n  const namespaces = useMemo(() => JSON.parse(stableNamespaces), [stableNamespaces])\n  const {t} = useTranslation(namespaces)\n\n  return useCallback(\n    function getI18nText(node: TNode) {\n      const {i18n} = node\n      if (!i18n) return node\n\n      return new Proxy(node, {\n        get: (target, property) => {\n          const defaultValue = target[property as keyof TNode]\n\n          if (typeof property === 'string' && property in i18n) {\n            const {key, ns} = i18n[property as keyof TNode['i18n']]\n            return t(key, {\n              ns,\n              // `defaultValue` is a special key in the i18next `t` API that\n              // allows us to provide a fallback value if no translation is found\n              // using the given key and namespace. if the value on the node\n              // is a string, then we'll use that as the fallback value\n              ...(typeof defaultValue === 'string' && {defaultValue}),\n            })\n          }\n\n          return defaultValue\n        },\n      })\n    },\n    [t],\n  )\n}\n","import {useMemo} from 'react'\n\nimport {useTranslation} from './useTranslation'\n\n/**\n * Enforces the shape of an object allowed to be passed into `useI18nText`.\n * @internal\n */\nexport type I18nNode<TNode extends {i18n?: {[TProp in string]: {key: string; ns: string}}}> = {\n  i18n?: {[K in keyof TNode['i18n']]: {key: string; ns: string}}\n} & {\n  [K in keyof TNode['i18n']]: string\n}\n\n/**\n * A React hook for localizing strings in a given object (`node`) using the\n * `useTranslation` hook.\n *\n * This hook expects an object (`node`) with top-level keys associated with\n * string values. If an `i18n` property is present within the object, it should\n * contain localization configurations for each top-level key. Each\n * configuration must include a `key` and `ns` (namespace) used for the\n * translation of the corresponding string value.\n *\n * The hook uses a proxy to intercept access to properties of the `node`. For\n * properties defined in the `i18n` object, it returns the translated string\n * using the `t` function. If no translation is found, the original string value\n * is used as a fallback. For properties not defined in the `i18n` object, their\n * original values are returned.\n *\n * @param node - The object containing strings to be localized along with\n *  optional i18n configurations.\n * @returns A proxy of the original `node` object where each property access\n *  returns localized strings.\n * @internal\n */\nexport function useI18nText<TNode extends I18nNode<TNode>>(node: TNode): TNode {\n  const namespaces = useMemo(() => {\n    if (!node.i18n) return []\n    return Array.from(new Set(Object.values(node.i18n).map(({ns}) => ns))).sort()\n  }, [node.i18n])\n\n  const {t} = useTranslation(namespaces)\n\n  return useMemo(() => {\n    const {i18n} = node\n    if (!i18n) return node\n\n    return new Proxy(node, {\n      get: (target, property) => {\n        const defaultValue = target[property as keyof TNode]\n\n        if (typeof property === 'string' && property in i18n) {\n          const {key, ns} = i18n[property as keyof TNode['i18n']]\n          return t(key, {\n            ns,\n            // `defaultValue` is a special key in the i18next `t` API that\n            // allows us to provide a fallback value if no translation is found\n            // using the given key and namespace. if the value on the node\n            // is a string, then we'll use that as the fallback value\n            ...(typeof defaultValue === 'string' && {defaultValue}),\n          })\n        }\n\n        return defaultValue\n      },\n    })\n  }, [node, t])\n}\n","type AnyIntlOptions = Intl.DateTimeFormat | Intl.ListFormatOptions | Intl.NumberFormatOptions\n\n/**\n * Cache of Intl.* instances. These can be costly to instantiate, but often needed,\n * thus this serves as an in-memory cache, and takes into account the options passed.\n *\n * @internal\n * @hidden\n */\nexport const intlCache = (() => {\n  const caches = {\n    dateTimeFormat: createCache<Intl.DateTimeFormat>(),\n    listFormat: createCache<Intl.ListFormat>(),\n    numberFormat: createCache<Intl.NumberFormat>(),\n    relativeTimeFormat: createCache<Intl.RelativeTimeFormat>(),\n  }\n\n  function dateTimeFormat(locale: string, options: Intl.DateTimeFormatOptions) {\n    const key = getCacheId(locale, options)\n    let instance = caches.dateTimeFormat[key]\n    if (instance) {\n      return instance\n    }\n\n    instance = new Intl.DateTimeFormat(locale, options)\n    caches.dateTimeFormat[key] = instance\n    return instance\n  }\n\n  function listFormat(locale: string, options: Intl.ListFormatOptions) {\n    const key = getCacheId(locale, options)\n    let instance = caches.listFormat[key]\n    if (instance) {\n      return instance\n    }\n\n    instance = new Intl.ListFormat(locale, options)\n    caches.listFormat[key] = instance\n    return instance\n  }\n\n  function numberFormat(locale: string, options: Intl.NumberFormatOptions) {\n    const key = getCacheId(locale, options)\n    let instance = caches.numberFormat[key]\n    if (instance) {\n      return instance\n    }\n\n    instance = new Intl.NumberFormat(locale, options)\n    caches.numberFormat[key] = instance\n    return instance\n  }\n\n  function relativeTimeFormat(locale: string, options: Intl.RelativeTimeFormatOptions) {\n    const key = getCacheId(locale, options)\n    let instance = caches.relativeTimeFormat[key]\n    if (instance) {\n      return instance\n    }\n\n    instance = new Intl.RelativeTimeFormat(locale, options)\n    caches.relativeTimeFormat[key] = instance\n    return instance\n  }\n\n  return {\n    dateTimeFormat,\n    listFormat,\n    numberFormat,\n    relativeTimeFormat,\n  }\n})()\n\nfunction createCache<T>(): Record<string, T | undefined> {\n  return Object.create(null)\n}\n\nfunction getCacheId(locale: string, options: AnyIntlOptions) {\n  return `${locale}-${JSON.stringify(orderedProps(options))}`\n}\n\nfunction orderedProps(obj: AnyIntlOptions) {\n  const segments: string[] = []\n  for (const [key, value] of Object.entries(obj)) {\n    segments.push(`${key}=${JSON.stringify(value)}`)\n  }\n  return segments.sort().join('\\n')\n}\n","import {useCurrentLocale} from '../i18n/hooks/useLocale'\nimport {intlCache} from '../i18n/intlCache'\n\n/**\n * Options for the `useListFormat` hook\n *\n * @public\n */\nexport interface UseListFormatOptions {\n  /**\n   * The format of output message.\n   * - `conjunction` (read: \"and\") - default\n   * - `disjunction` (read: \"or\")\n   * - `unit` (just a list)\n   */\n  type?: Intl.ListFormatType | undefined\n\n  /**\n   * The length of the internationalized message.\n   * This obviously varies based on language, but in US English this maps to:\n   * - `long`: \"a, b and c\" - default\n   * - `short`: \"a, b & c\"\n   * - `narrow`: `a, b, c`\n   */\n  style?: Intl.ListFormatStyle | undefined\n}\n\n/**\n * Returns an instance of `Intl.ListFormat` that uses the currently selected locale,\n * and enables language-sensitive list formatting.\n *\n * @param options - Optional options for the list formatter\n * @returns Instance of `Intl.ListFormat`\n * @public\n */\nexport function useListFormat(options: UseListFormatOptions = {}): Intl.ListFormat {\n  /*\n   * Certain components using this hook (such as the <Translate/> in toasts)\n   * may not have access to the LocaleProvider that lets us use useCurrentLocale.\n   * In that case, we fall back to a default, unobstrusive list format.\n   */\n  try {\n    const currentLocale = useCurrentLocale().id\n    return intlCache.listFormat(currentLocale, options)\n  } catch {\n    return intlCache.listFormat('en-US', {...options, style: 'narrow'})\n  }\n}\n","/**\n * @internal\n * @hidden\n */\nexport type OpenTagToken = {\n  type: 'tagOpen'\n  name: string\n  selfClosing?: boolean\n}\n\n/**\n * @internal\n * @hidden\n */\nexport type CloseTagToken = {\n  type: 'tagClose'\n  name: string\n}\n\n/**\n * @internal\n * @hidden\n */\nexport type TextToken = {\n  type: 'text'\n  text: string\n}\n\n/**\n * @internal\n * @hidden\n */\nexport type InterpolationToken = {\n  type: 'interpolation'\n  variable: string\n  formatters?: string[]\n}\n\n/**\n * @internal\n * @hidden\n */\nexport type Token = OpenTagToken | CloseTagToken | TextToken | InterpolationToken\n\nconst OPEN_TAG_RE = /^<(?<tag>[^\\s\\d<][^/?><]+)\\/?>/\nconst CLOSE_TAG_RE = /<\\/(?<tag>[^>]+)>/\nconst SELF_CLOSING_RE = /<[^>]+\\/>/\nconst VALID_COMPONENT_NAME_RE = /^[A-Z][A-Za-z0-9]+$/\nconst VALID_HTML_TAG_NAME_RE = /^[a-z]+$/\nconst TEMPLATE_RE = /{{\\s*?([^}]+)\\s*?}}/g\n\n/**\n * Parses a string for simple tags\n *\n * @param input - input string to parse\n * @returns An array of tokens\n * @internal\n * @hidden\n */\nexport function simpleParser(input: string): Token[] {\n  const tokens: Token[] = []\n  let text = ''\n  let openTag = ''\n  let remainder = input\n  while (remainder.length > 0) {\n    if (!openTag && remainder[0] === '<') {\n      const match = matchOpenTag(remainder)\n      if (match) {\n        const tagName = match.groups!.tag\n        validateTagName(tagName)\n        if (text) {\n          tokens.push(...textTokenWithInterpolation(text))\n          text = ''\n        }\n        if (isSelfClosing(match[0])) {\n          tokens.push({type: 'tagOpen', selfClosing: true, name: tagName})\n        } else {\n          tokens.push({type: 'tagOpen', name: tagName})\n          openTag = tagName\n        }\n        remainder = remainder.substring(match[0].length)\n      } else {\n        // move on to next char\n        text += remainder[0]\n        remainder = remainder.substring(1)\n      }\n    } else if (openTag && remainder[0] === '<' && remainder[1] !== '<') {\n      const match = matchCloseTag(remainder)\n      if (match) {\n        const tagName = match.groups!.tag\n        if (remainder[1] !== '/') {\n          throw new Error(\n            `Expected closing tag for <${openTag}>, but found new opening tag <${tagName}>. Nested tags is not supported.`,\n          )\n        }\n        if (tagName !== openTag) {\n          throw new Error(\n            `Expected closing tag for <${openTag}>, but found closing tag </${tagName}> instead. Make sure each opening tag has a matching closing tag.`,\n          )\n        }\n        if (text) {\n          tokens.push(...textTokenWithInterpolation(text))\n          text = ''\n        }\n        tokens.push({type: 'tagClose', name: tagName})\n        openTag = ''\n        remainder = remainder.substring(match[0].length)\n      } else {\n        // move on to next char\n        text += remainder[0]\n        remainder = remainder.substring(1)\n      }\n    } else {\n      // move on to next char\n      text += remainder[0]\n      remainder = remainder.substring(1)\n    }\n  }\n  if (openTag) {\n    throw new Error(\n      `No matching closing tag for <${openTag}> found. Either make it self closing (e.g. \"<${openTag}/>\") or close it (e.g \"<${openTag}>...</${openTag}>\").`,\n    )\n  }\n  if (text) {\n    tokens.push(...textTokenWithInterpolation(text))\n  }\n  return tokens\n}\n\nfunction textTokenWithInterpolation(text: string): Token[] {\n  const tokens: Token[] = []\n\n  const interpolations = text.matchAll(TEMPLATE_RE)\n  let lastIndex = 0\n  for (const match of interpolations) {\n    if (typeof match.index === 'undefined') {\n      continue\n    }\n\n    const pre = text.slice(lastIndex, match.index)\n    if (pre.length > 0) {\n      tokens.push({type: 'text', text: pre})\n    }\n\n    tokens.push(parseInterpolation(match[0]))\n\n    lastIndex += pre.length + match[0].length\n  }\n\n  if (lastIndex < text.length) {\n    tokens.push({type: 'text', text: text.slice(lastIndex)})\n  }\n\n  return tokens\n}\n\nfunction parseInterpolation(interpolation: string): InterpolationToken {\n  const [variable, ...formatters] = interpolation\n    .replace(/^\\{\\{|\\}\\}$/g, '')\n    .trim()\n    .split(/\\s*,\\s*/)\n\n  // To save us from reimplementing all of i18next's formatter logic, we only curently support the\n  // `list` formatter, and only without any arguments. This may change in the future, but deeming\n  // this good enough for now.\n  if (formatters.length === 1 && formatters[0] === 'list') {\n    return {type: 'interpolation', variable, formatters}\n  }\n\n  if (formatters.length > 0) {\n    throw new Error(\n      `Interpolations with formatters are not supported when using <Translate>. Found \"${interpolation}\". Utilize \"useTranslation\" instead, or format the values passed to <Translate> ahead of time.`,\n    )\n  }\n\n  return {type: 'interpolation', variable}\n}\n\nfunction isSelfClosing(tag: string) {\n  return SELF_CLOSING_RE.test(tag)\n}\nfunction matchOpenTag(input: string) {\n  return input.match(OPEN_TAG_RE)\n}\nfunction matchCloseTag(input: string) {\n  return input.match(CLOSE_TAG_RE)\n}\n\nfunction validateTagName(tagName: string) {\n  const isValidComponentName = VALID_COMPONENT_NAME_RE.test(tagName)\n  if (isValidComponentName) {\n    return\n  }\n\n  const isValidHtmlTagName = VALID_HTML_TAG_NAME_RE.test(tagName)\n  if (isValidHtmlTagName) {\n    return\n  }\n\n  throw new Error(\n    tagName.trim() === tagName\n      ? `Invalid tag \"<${tagName}>\". Tag names must be lowercase HTML tags or start with an uppercase letter and can only include letters and numbers.`\n      : `Invalid tag \"<${tagName}>\". No whitespace allowed in tags.`,\n  )\n}\n","import {type TFunction} from 'i18next'\nimport {type ComponentType, createElement, type ReactNode, useMemo} from 'react'\n\nimport {useListFormat} from '../hooks/useListFormat'\nimport {type CloseTagToken, simpleParser, type TextToken, type Token} from './simpleParser'\n\nconst COMPONENT_NAME_RE = /^[A-Z]/\nconst RECOGNIZED_HTML_TAGS = [\n  'abbr',\n  'address',\n  'cite',\n  'code',\n  'del',\n  'em',\n  'ins',\n  'kbd',\n  'q',\n  'samp',\n  'strong',\n  'sub',\n  'sup',\n]\n\ntype FormatterFns = {list: (value: Iterable<string>) => string}\n\n/**\n * A map of component names to React components. The component names are the names used within the\n * locale resources, eg a key of `SearchTerm` should be rendered as `<SearchTerm/>` or\n * `<SearchTerm>{{term}}</SearchTerm>` (no whitespace in tag, nor attributes).\n *\n * The components receives `children`, but no other props.\n *\n * @public\n */\nexport type TranslateComponentMap = Record<\n  string,\n  ComponentType<{children?: ReactNode}> | keyof JSX.IntrinsicElements\n>\n\n/**\n * Props for the `Translate` component.\n *\n * @public\n */\nexport interface TranslationProps {\n  /**\n   * The `t` function to use, from the `useTranslation` hook\n   */\n  t: TFunction\n\n  /**\n   * The i18n resource key to translate\n   */\n  i18nKey: string\n\n  /**\n   * A map of component names to React components, used to render more complex content\n   */\n  components?: TranslateComponentMap\n\n  /**\n   * A string representing the \"context\" of the resource key.\n   *\n   * For an i18nKey of `greeter.greet-entity`, passing `context: 'human'` will look for a key of\n   * `greeter.greet-entity_human` in the locale resources. If not found, it will fall back to the\n   * base key (`greeter.greet-entity`).\n   */\n  context?: string\n\n  /**\n   * A map of values to interpolate into the translated string. The resources should use the\n   * double curly bracket annotation to use them, eg `{{petName}}`. Will be escaped by React,\n   * so no need to escape HTML.\n   */\n  values?: Record<string, string | string[] | number | undefined>\n}\n\n/**\n * Component for translating i18n resources.\n *\n * Note that this component is more expensive to render than using the `t` function from\n * `useTranslate` directly, so prefer that if possible. Generally, the only valid use case\n * for this component is when the translation needs to render a React component as part of\n * the message.\n *\n * @public\n */\nexport function Translate(props: TranslationProps) {\n  /**\n   * The i18next API is kinda weird - the second parameter to `t` is a mixture of options and\n   * replacement values. All of the following properties are options for the `t` function, at\n   * the time of writing:\n   *\n   * 'defaultValue', 'ordinal', 'context', 'replace', 'lng', 'lngs', 'fallbackLng', 'ns',\n   * 'keySeparator', 'nsSeparator', 'returnObjects', 'returnDetails', 'joinArrays',\n   * 'postProcess', 'interpolation'.\n   *\n   * Because we are explicitly receiving the interpolation values we want through `values`,\n   * it is safer to explicitly pass these to the `replace` parameter, in order to avoid unexpected\n   * behavior with built-in options.\n   */\n  const translated = props.t(props.i18nKey, {\n    context: props.context,\n    skipInterpolation: true,\n    count:\n      props.values && 'count' in props.values && typeof props.values.count === 'number'\n        ? props.values.count\n        : undefined,\n  })\n\n  const tokens = useMemo(() => simpleParser(translated), [translated])\n  const listFormat = useListFormat()\n  const formatters: FormatterFns = {\n    list: (listValues) => listFormat.format(listValues),\n  }\n  return <>{render(tokens, props.values, props.components || {}, formatters)}</>\n}\n\nfunction render(\n  tokens: Token[],\n  values: TranslationProps['values'],\n  componentMap: TranslateComponentMap,\n  formatters: FormatterFns,\n): ReactNode {\n  const [head, ...tail] = tokens\n  if (!head) {\n    return null\n  }\n  if (head.type === 'interpolation') {\n    const value = values ? values[head.variable] : undefined\n    if (typeof value === 'undefined') {\n      return `{{${head.variable}}}`\n    }\n\n    const formattedValue = applyFormatters(value, head.formatters || [], formatters)\n\n    return (\n      <>\n        {formattedValue}\n        {render(tail, values, componentMap, formatters)}\n      </>\n    )\n  }\n  if (head.type === 'text') {\n    return (\n      <>\n        {head.text}\n        {render(tail, values, componentMap, formatters)}\n      </>\n    )\n  }\n  if (head.type === 'tagOpen' && head.selfClosing) {\n    const Component = componentMap[head.name]\n\n    if (!Component) {\n      throw new Error(`Component not found: ${head.name}`)\n    }\n    return (\n      <>\n        <Component />\n        {render(tail, values, componentMap, formatters)}\n      </>\n    )\n  }\n  if (head.type === 'tagOpen' && !head.selfClosing) {\n    const nextCloseIdx = tail.findIndex((token) => token.type === 'tagClose')\n    const nextClose = tail[nextCloseIdx]\n    if (nextClose) {\n      if (head.name !== (nextClose as CloseTagToken).name) {\n        throw new Error('Nested tags is not allowed')\n      }\n    }\n    const Component = componentMap[head.name]\n    if (!Component && COMPONENT_NAME_RE.test(head.name)) {\n      throw new Error(`Component not defined: ${head.name}`)\n    }\n\n    if (!Component && !RECOGNIZED_HTML_TAGS.includes(head.name)) {\n      throw new Error(`HTML tag \"${head.name}\" is not allowed`)\n    }\n\n    const children = tail.slice(0, nextCloseIdx) as TextToken[]\n    const remaining = tail.slice(nextCloseIdx + 1)\n\n    return Component ? (\n      <>\n        <Component>{render(children, values, componentMap, formatters)}</Component>\n        {render(remaining, values, componentMap, formatters)}\n      </>\n    ) : (\n      <>\n        {createElement(head.name, {}, render(children, values, componentMap, formatters))}\n        {render(remaining, values, componentMap, formatters)}\n      </>\n    )\n  }\n  return null\n}\n\nfunction applyFormatters(\n  value: Required<TranslationProps>['values'][string],\n  formatters: string[],\n  formatterFns: FormatterFns,\n): string {\n  let formattedValue = value\n  for (const formatter of formatters) {\n    if (formatter === 'list') {\n      if (Array.isArray(value)) {\n        formattedValue = formatterFns.list(value)\n      } else {\n        throw new Error('List formatter used on non-array value')\n      }\n    }\n  }\n  return `${formattedValue}`\n}\n","import {type SourceClientOptions} from './config'\n\n/**\n * Unless otherwise specified, this is the API version we use for controlled\n * requests on internal studio APIs. The user should always ask for a specific\n * API version when using the client - this way we can upgrade which version we\n * use internally without having the users code break unexpectedly. It also\n * means the user can easily upgrade to newer versions of GROQ when it arrives.\n *\n * @internal\n */\nexport const DEFAULT_STUDIO_CLIENT_OPTIONS: SourceClientOptions = {\n  apiVersion: '2024-03-12',\n}\n","import {type UnitFormatter} from '../../../../hooks'\n\n/**\n * Calculates the size difference between two numbers, in percent\n *\n * @param prev - Previous size\n * @param next - Next size\n * @returns The size difference in percent\n * @internal\n */\nexport function getSizeDiff(prev: number | undefined, next: number | undefined): number {\n  if (!prev || !next) {\n    return 0\n  }\n\n  const increase = next - prev\n  const pct = Math.round((increase / prev) * 100)\n\n  return pct\n}\n\n/**\n * Get a \"human friendly\" representation of a number of bytes, using base10 units\n *\n * @param bytes - Number of bytes\n * @param format - The unit formatter to use (from `useUnitFormatter`)\n * @returns A human friendly representation of the number of bytes\n * @internal\n */\nexport function getHumanFriendlyBytes(bytes: number, format: UnitFormatter): string {\n  if (bytes < 1000) {\n    return format(bytes, 'byte')\n  }\n\n  if (bytes < 1000 * 1000) {\n    return format(bytes / 1000, 'kilobyte')\n  }\n\n  if (bytes < 1000 * 1000 * 1000) {\n    return format(bytes / (1000 * 1000), 'megabyte')\n  }\n\n  if (bytes < 1000 * 1000 * 1000 * 1000) {\n    return format(bytes / (1000 * 1000 * 1000), 'gigabyte')\n  }\n\n  return format(bytes / (1000 * 1000 * 1000 * 1000), 'terabyte')\n}\n","import {type SanityClient} from '@sanity/client'\nimport DataLoader from 'dataloader'\nimport {catchError, from, map, of} from 'rxjs'\n\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../studioClient'\nimport {type KeyValueStoreValue} from '../types'\nimport {type Backend, type KeyValuePair} from './types'\n\n/** @internal */\nexport interface ServerBackendOptions {\n  client: SanityClient\n}\n\n/**\n * One of serveral possible backends for KeyValueStore. This backend uses the\n * Sanity client to store and retrieve key-value pairs from the /users/me/keyvalue endpoint.\n * @internal\n */\nexport function serverBackend({client: _client}: ServerBackendOptions): Backend {\n  const client = _client.withConfig(DEFAULT_STUDIO_CLIENT_OPTIONS)\n\n  const keyValueLoader = new DataLoader<string, KeyValueStoreValue | null>(async (keys) => {\n    const value = await client\n      .request<KeyValuePair[]>({\n        uri: `/users/me/keyvalue/${keys.join(',')}`,\n        withCredentials: true,\n      })\n      .catch((error) => {\n        console.error('Error fetching data:', error)\n        return Array(keys.length).fill(null)\n      })\n\n    const keyValuePairs = value.reduce(\n      (acc, next) => {\n        if (next?.key) {\n          acc[next.key] = next.value\n        }\n        return acc\n      },\n      {} as Record<string, KeyValueStoreValue | null>,\n    )\n\n    const result = keys.map((key) => keyValuePairs[key] || null)\n    return result\n  })\n\n  const getKeys = (keys: string[]) => {\n    return from(keyValueLoader.loadMany(keys))\n  }\n\n  const setKeys = (keyValuePairs: KeyValuePair[]) => {\n    return from(\n      client.request<KeyValuePair[]>({\n        method: 'PUT',\n        uri: `/users/me/keyvalue`,\n        body: keyValuePairs,\n        withCredentials: true,\n      }),\n    ).pipe(\n      map((response) => {\n        return response.map((pair) => {\n          keyValueLoader.clear(pair.key)\n          keyValueLoader.prime(pair.key, pair.value)\n\n          return pair.value\n        })\n      }),\n      catchError((error) => {\n        console.error('Error setting data:', error)\n        return of(Array(keyValuePairs.length).fill(null))\n      }),\n    )\n  }\n\n  const getKey = (key: string) => {\n    return getKeys([key]).pipe(map((values) => values[0]))\n  }\n\n  const setKey = (key: string, nextValue: unknown) => {\n    return setKeys([{key, value: nextValue as KeyValueStoreValue}]).pipe(map((values) => values[0]))\n  }\n\n  return {\n    getKey,\n    setKey,\n    getKeys,\n    setKeys,\n  }\n}\n","import {type SanityClient} from '@sanity/client'\nimport {merge, type Observable, Subject} from 'rxjs'\nimport {filter, map, shareReplay, switchMap, take} from 'rxjs/operators'\n\nimport {serverBackend} from './backends/server'\nimport {type KeyValueStore, type KeyValueStoreValue} from './types'\n\n/** @internal */\nexport function createKeyValueStore({client}: {client: SanityClient}): KeyValueStore {\n  const storageBackend = serverBackend({client})\n\n  const setKey$ = new Subject<{key: string; value: KeyValueStoreValue}>()\n\n  const updates$ = setKey$.pipe(\n    switchMap((event) => {\n      return storageBackend.setKey(event.key, event.value).pipe(\n        map((nextValue) => ({\n          key: event.key,\n          value: nextValue,\n        })),\n      )\n    }),\n    shareReplay(1),\n  )\n\n  const getKey = (key: string): Observable<KeyValueStoreValue> => {\n    return merge(\n      storageBackend.getKey(key),\n      updates$.pipe(\n        filter((update) => update.key === key),\n        map((update) => update.value),\n      ),\n    ) as Observable<KeyValueStoreValue>\n  }\n\n  const setKey = (key: string, value: KeyValueStoreValue): Observable<KeyValueStoreValue> => {\n    setKey$.next({key, value})\n\n    /*\n     * The backend returns the result of the set operation, so we can just pass that along.\n     * Most utils do not use it (they will take advantage of local state first) but it reflects the\n     * backend function and could be useful for debugging.\n     */\n    return updates$.pipe(\n      filter((update) => update.key === key),\n      map((update) => update.value as KeyValueStoreValue),\n      take(1),\n    )\n  }\n\n  return {getKey, setKey}\n}\n","/** @internal */\nexport interface CorsOriginErrorOptions {\n  projectId?: string\n}\n\n/** @internal */\nexport class CorsOriginError extends Error {\n  projectId?: string\n\n  constructor({projectId}: CorsOriginErrorOptions) {\n    super('CorsOriginError')\n    this.projectId = projectId\n  }\n}\n","import {supportsLocalStorage} from '../../../util/supportsLocalStorage'\n\nconst memStore: Record<string, string> = {}\n\nexport function setItem(key: string, value: string): void {\n  if (supportsLocalStorage) {\n    localStorage[key] = value\n  } else {\n    memStore[key] = value\n  }\n}\n\nexport function getItem(key: string): string | undefined {\n  return supportsLocalStorage ? localStorage[key] : memStore[key]\n}\n\nexport function removeItem(key: string): void {\n  if (supportsLocalStorage) {\n    localStorage.removeItem(key)\n  } else {\n    delete memStore[key]\n  }\n}\n","import {fromEvent, merge, type Observable, of, Subject} from 'rxjs'\nimport {filter, map, shareReplay} from 'rxjs/operators'\n\nimport {isNonNullable} from '../../../util'\nimport * as storage from './storage'\n\nexport interface BroadcastChannel<T> {\n  messages: Observable<T>\n  broadcast: (message: T) => void\n}\n\nexport function createBroadcastChannel<T>(namespace: string): BroadcastChannel<T> {\n  const storageEvents$ =\n    typeof window === 'undefined'\n      ? of<StorageEvent>() // No storage events in non-browser environments\n      : fromEvent<StorageEvent>(window, 'storage')\n\n  const storageKey = `__studio_local_storage_messaging_${namespace}`\n\n  // note: the the `storageEvents$` stream does not emit for the current\n  // window/tab. this subject is used to re-broadcast messages broadcast outward\n  // to itself\n  const broadcastedMessages$ = new Subject<T>()\n\n  const messages$ = merge(\n    broadcastedMessages$,\n    storageEvents$.pipe(\n      filter((event) => event.key === storageKey),\n      map((event) => event.newValue),\n      filter(isNonNullable),\n      map((newValue) => JSON.parse(newValue)),\n    ),\n  ).pipe(\n    // this is important to ensure all new subscribers get a message on subscribe\n    shareReplay(1),\n  )\n\n  function broadcast(message: T) {\n    try {\n      storage.setItem(storageKey, JSON.stringify(message))\n      // clear the value afterwards so that next message will still emit a\n      // new event even if it's identical to the previous one\n      storage.removeItem(storageKey)\n\n      broadcastedMessages$.next(message)\n    } catch (err) {\n      // intentional noop\n    }\n  }\n\n  return {messages: messages$, broadcast}\n}\n","import {type Theme} from '@sanity/ui'\nimport {type ComponentType} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {type AuthProvider} from '../../../config'\n\nconst GithubRootSvg = styled.svg(({theme}: {theme: Theme}) => {\n  const {fg} = theme.sanity.color.base\n\n  return css`\n    fill: ${fg};\n  `\n})\n\nconst CustomImage = styled.img`\n  height: 19px;\n  width: 19px;\n  object-fit: contain;\n`\n\nconst GithubLogo = () => (\n  <GithubRootSvg\n    // data-sanity-icon=\"google-logo\"\n    width=\"1em\"\n    height=\"1em\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    viewBox=\"0 0 438.55 438.55\"\n  >\n    <path d=\"M409.13 114.57a218.32 218.32 0 0 0-79.8-79.8Q278.94 5.36 219.27 5.36T109.21 34.77a218.29 218.29 0 0 0-79.8 79.8Q0 165 0 224.63q0 71.67 41.83 128.91t108.06 79.23q7.71 1.43 11.42-2a11.17 11.17 0 0 0 3.69-8.57q0-.86-.14-15.42t-.14-25.41l-6.57 1.14a83.77 83.77 0 0 1-15.85 1 120.73 120.73 0 0 1-19.84-2 44.34 44.34 0 0 1-19.11-8.51 36.23 36.23 0 0 1-12.56-17.6l-2.86-6.57a71.34 71.34 0 0 0-9-14.56q-6.14-8-12.42-10.85l-2-1.43a21 21 0 0 1-3.71-3.43 15.66 15.66 0 0 1-2.57-4q-.86-2 1.43-3.29C61.2 310.42 64 310 68 310l5.71.85q5.71 1.14 14.13 6.85a46.08 46.08 0 0 1 13.85 14.84q6.57 11.71 15.85 17.85t18.7 6.14a81.19 81.19 0 0 0 16.27-1.42 56.78 56.78 0 0 0 12.85-4.29q2.57-19.14 14-29.41a195.49 195.49 0 0 1-29.36-5.13 116.52 116.52 0 0 1-26.83-11.14 76.86 76.86 0 0 1-23-19.13q-9.14-11.42-15-30t-5.8-42.81q0-34.55 22.56-58.82-10.57-26 2-58.24 8.28-2.57 24.55 3.85t23.84 11q7.57 4.56 12.13 7.71a206.2 206.2 0 0 1 109.64 0l10.85-6.85a153.65 153.65 0 0 1 26.26-12.56q15.13-5.71 23.13-3.14 12.84 32.26 2.28 58.24 22.55 24.27 22.56 58.82 0 24.27-5.85 43t-15.12 30a79.82 79.82 0 0 1-23.13 19 116.74 116.74 0 0 1-26.84 11.14 195.29 195.29 0 0 1-29.23 5.07q14.8 12.84 14.81 40.58v60.2a11.37 11.37 0 0 0 3.57 8.56q3.57 3.42 11.28 2 66.24-22 108.07-79.23t41.83-128.91q-.03-59.62-29.43-110.05z\" />\n  </GithubRootSvg>\n)\n\nconst GoogleLogo = () => (\n  <svg\n    // data-sanity-icon=\"google-logo\"\n    width=\"1em\"\n    height=\"1em\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    viewBox=\"0 0 48 48\"\n  >\n    <path\n      d=\"M11 24a13 13 0 0 1 .66-4.08l-7.4-5.66a22.18 22.18 0 0 0 0 19.49l7.4-5.67A13 13 0 0 1 11 24z\"\n      fill=\"#fbbc05\"\n    />\n    <path\n      d=\"M24 11a12.72 12.72 0 0 1 8.1 2.9l6.4-6.4a22 22 0 0 0-34.24 6.75l7.4 5.66A13 13 0 0 1 24 11z\"\n      fill=\"#ea4335\"\n    />\n    <path\n      d=\"M24 37a13 13 0 0 1-12.34-8.92l-7.4 5.66A21.93 21.93 0 0 0 24 46a21 21 0 0 0 14.33-5.48l-7-5.44A13.59 13.59 0 0 1 24 37zm-12.35-8.93l-7.4 5.67 7.4-5.66z\"\n      fill=\"#34a853\"\n    />\n    <path\n      d=\"M44.5 20H24v8.5h11.8a9.91 9.91 0 0 1-4.49 6.58l7 5.44C42.37 36.76 45 31.17 45 24a18.25 18.25 0 0 0-.5-4z\"\n      fill=\"#4285f4\"\n    />\n  </svg>\n)\n\nexport function CustomLogo(props: {provider: AuthProvider}) {\n  const {provider} = props\n\n  return provider.logo ? (\n    <CustomImage src={provider.logo} alt={`Logo for ${provider.name}`} />\n  ) : undefined\n}\n\nexport const providerLogos: Record<string, ComponentType<{provider: AuthProvider}>> = {\n  google: GoogleLogo,\n  github: GithubLogo,\n  // sanity: () => <SanityMonogram data-sanity-icon=\"\" />,\n}\n","/* eslint-disable i18next/no-literal-string */\nimport {type AuthProvider, type AuthProviderResponse, type SanityClient} from '@sanity/client'\nimport {Heading, Stack} from '@sanity/ui'\nimport {useEffect, useState} from 'react'\nimport {type Observable} from 'rxjs'\n\nimport {Button} from '../../../../ui-components'\nimport {LoadingBlock} from '../../../components/loadingBlock'\nimport {type AuthConfig} from '../../../config'\nimport {createHookFromObservableFactory} from '../../../util'\nimport {CustomLogo, providerLogos} from './providerLogos'\nimport {type LoginComponentProps} from './types'\n\ninterface GetProvidersOptions extends AuthConfig {\n  client: SanityClient\n}\n\nasync function getProviders({\n  client,\n  mode,\n  providers: customProviders = [],\n}: GetProvidersOptions): Promise<AuthProvider[]> {\n  // Short-circuit if we're in replace mode without needing the default providers\n  if (mode === 'replace' && Array.isArray(customProviders)) {\n    return customProviders\n  }\n\n  const {providers} = await client.request<AuthProviderResponse>({\n    uri: '/auth/providers',\n  })\n\n  // If a custom reducer function is passed, allow it to modify the default list of providers\n  // any way it wants - eg replace, append, remove etc.\n  if (typeof customProviders === 'function') {\n    return customProviders(providers)\n  }\n\n  // If no providers are specified, use the default list\n  if (customProviders.length === 0) {\n    return providers\n  }\n\n  // -- Note: Deprecated flow below: we now prefer the reducer pattern above --\n  // Replace mode: use the provided list as-is\n  if (mode === 'replace') {\n    return customProviders\n  }\n\n  // Append mode (default):\n  // Append to the list of official providers, but replace any provider that has\n  // the same URL with the custom one (allows customizing the title, name)\n  return providers\n    .filter((official) => customProviders.some((provider) => provider.url !== official.url))\n    .concat(customProviders)\n}\n\ninterface CreateLoginComponentOptions extends AuthConfig {\n  getClient: () => Observable<SanityClient>\n}\n\ninterface CreateHrefForProviderOptions {\n  redirectPath: string\n  loginMethod: AuthConfig['loginMethod']\n  projectId: string\n  url: string\n}\n\nfunction createHrefForProvider({\n  loginMethod = 'dual',\n  projectId,\n  url,\n  redirectPath,\n}: CreateHrefForProviderOptions) {\n  const params = new URLSearchParams()\n  params.set('origin', `${window.location.origin}${redirectPath}`)\n  params.set('projectId', projectId)\n\n  // Setting `type=token` will return the sid as part of the _query_, which may end up in\n  // server access logs and similar. Instead, use `withSid=true` to return the sid as part\n  // of the _hash_ instead, which is only accessible to the client. Other auth types will\n  // use the `type` parameter - `dual` will automatically use the hash, so do not need the\n  // additional parameter.\n  if (loginMethod === 'token') {\n    params.set('withSid', 'true')\n  } else {\n    params.set('type', loginMethod)\n  }\n  return `${url}?${params}`\n}\n\nexport function createLoginComponent({\n  getClient,\n  loginMethod,\n  redirectOnSingle,\n  ...providerOptions\n}: CreateLoginComponentOptions) {\n  const useClient = createHookFromObservableFactory(getClient)\n\n  function LoginComponent({projectId, ...props}: LoginComponentProps) {\n    const redirectPath = props.redirectPath || props.basePath || '/'\n\n    const [providers, setProviders] = useState<AuthProvider[] | null>(null)\n    const [error, setError] = useState<unknown>(null)\n    if (error) throw error\n\n    const [client] = useClient()\n\n    useEffect(() => {\n      if (!client) return\n\n      getProviders({client, ...providerOptions})\n        .then(setProviders)\n        .catch(setError)\n    }, [client])\n\n    // only create a direct URL if `redirectOnSingle` is true and there is only\n    // one provider available\n    const redirectUrlForRedirectOnSingle =\n      redirectOnSingle &&\n      providers?.length === 1 &&\n      providers?.[0] &&\n      createHrefForProvider({\n        loginMethod,\n        projectId,\n        url: providers[0].url,\n        redirectPath,\n      })\n\n    const loading = !providers || redirectUrlForRedirectOnSingle\n\n    useEffect(() => {\n      if (redirectUrlForRedirectOnSingle) {\n        window.location.href = redirectUrlForRedirectOnSingle\n      }\n    }, [redirectUrlForRedirectOnSingle])\n\n    if (loading) {\n      return <LoadingBlock showText />\n    }\n\n    return (\n      <Stack space={4}>\n        <Heading align=\"center\" size={1}>\n          Choose login provider\n        </Heading>\n\n        <Stack space={2}>\n          {providers.map((provider, index) => (\n            <Button\n              // eslint-disable-next-line react/no-array-index-key\n              key={`${provider.url}_${index}`}\n              as=\"a\"\n              icon={providerLogos[provider.name] || <CustomLogo provider={provider} />}\n              href={createHrefForProvider({\n                loginMethod,\n                projectId,\n                url: provider.url,\n                redirectPath,\n              })}\n              mode=\"ghost\"\n              size=\"large\"\n              text={provider.title}\n            />\n          ))}\n        </Stack>\n      </Stack>\n    )\n  }\n\n  return LoginComponent\n}\n","// Trailing '&' included so we can replace `#sid=foo&bar=baz` with `#bar=baz`\nconst sidPattern = /sid=([^&]{20,})&?/\n\nfunction consumeSessionId(): string | null {\n  // Are we in a browser-like environment?\n  if (typeof window === 'undefined' || typeof window.location !== 'object') {\n    return null\n  }\n\n  // Does the hash contain a valid session ID?\n  const hash = window.location.hash\n\n  // The first element will be the entire match, including `sid=` - we only care about\n  // the first _group_, being the actual _value_ of the parameter, thus the leading comma\n  const [, sidParam] = hash.match(sidPattern) || []\n  if (!sidParam) {\n    return null\n  }\n\n  // Remove the parameter from the URL\n  const newHash = hash.replace(sidPattern, '')\n  const newUrl = new URL(window.location.href)\n  newUrl.hash = newHash.length > 1 ? newHash : ''\n  history.replaceState(null, '', newUrl)\n\n  return sidParam\n}\n\n// this module consumes the session ID as a side-effect as soon as its loaded\n// to remove the session ID from the history (vs waiting to remove the sid hash\n// until react mounts). Once it is consumed and loaded once, we don't want to\n// keep it in-memory here, so we clear it out.\nlet sessionId = consumeSessionId()\nexport const getSessionId = (): string | null => {\n  const id = sessionId\n  if (id) {\n    sessionId = null\n  }\n  return id\n}\n","import {type CookielessCompatibleLoginMethod, type LoginMethod} from '../../../../config'\nimport {isRecord} from '../../../../util'\nimport {type AuthStore} from '../types'\n\n/**\n * Duck-type check for whether or not this looks like an auth store\n *\n * @param maybeStore - Item to check if matches the AuthStore interface\n * @returns True if auth store, false otherwise\n * @internal\n */\nexport function isAuthStore(maybeStore: unknown): maybeStore is AuthStore {\n  return (\n    isRecord(maybeStore) &&\n    'state' in maybeStore &&\n    isRecord(maybeStore.state) &&\n    'subscribe' in maybeStore.state &&\n    typeof maybeStore.state.subscribe === 'function'\n  )\n}\n\n/**\n * Check whether the provided login method is compatible with cookieless auth, e.g. whether any\n * authentication token found in localStorage should be acknowledged.\n *\n * @internal\n */\nexport function isCookielessCompatibleLoginMethod(\n  loginMethod: LoginMethod,\n): loginMethod is CookielessCompatibleLoginMethod {\n  const cookielessCompatibleLoginMethods = ['dual', 'token']\n  return cookielessCompatibleLoginMethods.includes(loginMethod as CookielessCompatibleLoginMethod)\n}\n","import {\n  type ClientConfig as SanityClientConfig,\n  createClient as createSanityClient,\n  type SanityClient,\n} from '@sanity/client'\nimport {isEqual, memoize} from 'lodash'\nimport {defer} from 'rxjs'\nimport {distinctUntilChanged, map, shareReplay, startWith, switchMap} from 'rxjs/operators'\n\nimport {type AuthConfig} from '../../../config'\nimport {CorsOriginError} from '../cors'\nimport {createBroadcastChannel} from './createBroadcastChannel'\nimport {createLoginComponent} from './createLoginComponent'\nimport {getSessionId} from './sessionId'\nimport * as storage from './storage'\nimport {type AuthState, type AuthStore} from './types'\nimport {isCookielessCompatibleLoginMethod} from './utils/asserters'\n\n/** @internal */\nexport interface AuthStoreOptions extends AuthConfig {\n  clientFactory?: (options: SanityClientConfig) => SanityClient\n  projectId: string\n  dataset: string\n}\n\nconst getStorageKey = (projectId: string) => {\n  // Project ID is part of the localStorage key so that different projects can\n  // store their separate tokens, and it's easier to do book keeping.\n  if (!projectId) throw new Error('Invalid project id')\n  return `__studio_auth_token_${projectId}`\n}\n\nconst getToken = (projectId: string): string | null => {\n  try {\n    const item = storage.getItem(getStorageKey(projectId))\n    if (item) {\n      const {token} = JSON.parse(item) as {token: string}\n      if (token && typeof token === 'string') {\n        return token\n      }\n    }\n  } catch (err) {\n    console.error(err)\n  }\n  return null\n}\n\nconst clearToken = (projectId: string): void => {\n  try {\n    storage.removeItem(getStorageKey(projectId))\n  } catch (err) {\n    console.error(err)\n  }\n}\n\nconst saveToken = ({token, projectId}: {token: string; projectId: string}): void => {\n  try {\n    storage.setItem(\n      getStorageKey(projectId),\n      JSON.stringify({token, time: new Date().toISOString()}),\n    )\n  } catch (err) {\n    console.error(err)\n  }\n}\n\nconst getCurrentUser = async (\n  client: SanityClient,\n  broadcastToken: (token: string | null) => void,\n) => {\n  try {\n    const user = await client.request({\n      uri: '/users/me',\n      withCredentials: true,\n      tag: 'users.get-current',\n    })\n\n    // if the user came back with an id, assume it's a full CurrentUser\n    return typeof user?.id === 'string' ? user : null\n  } catch (err) {\n    // 401 means the user had some kind of credentials, but failed to authenticate,\n    // we should clear any local token in this case and treat it as if the used was\n    // logged out\n    if (err.statusCode === 401) {\n      clearToken(client.config().projectId || '')\n      broadcastToken(null)\n      return null\n    }\n\n    // Request failed for a non-auth reason, see if this was a CORS-error by\n    // checking the `/ping` endpoint, which allows all origins\n    const invalidCorsConfig = await client\n      .request({uri: '/ping', withCredentials: false, tag: 'cors-check'})\n      .then(\n        () => true, // Request succeeded, so likely the CORS origin is disallowed\n        () => false, // Request failed, so likely a network error of some kind\n      )\n\n    if (invalidCorsConfig) {\n      // Throw a specific error on CORS-errors, to allow us to show a customized dialog\n      throw new CorsOriginError({projectId: client.config()?.projectId})\n    }\n\n    // Some non-CORS error - is it one of those undefinable network errors?\n    if (err.isNetworkError && !err.message && err.request && err.request.url) {\n      const host = new URL(err.request.url).host\n      throw new Error(`Unknown network error attempting to reach ${host}`)\n    }\n\n    // Some other error, just throw it\n    throw err\n  }\n}\n\n/**\n * @internal\n */\nexport function _createAuthStore({\n  clientFactory: clientFactoryOption,\n  projectId,\n  dataset,\n  apiHost,\n  loginMethod = 'dual',\n  ...providerOptions\n}: AuthStoreOptions): AuthStore {\n  // this broadcast channel receives either a token as a `string` or `null`.\n  // a new client will be created from it, otherwise, it'll only trigger a retry\n  // for cookie-based auth\n  const {broadcast, messages} = createBroadcastChannel<string | null>(`dual_mode_auth_${projectId}`)\n\n  const clientFactory = clientFactoryOption ?? createSanityClient\n\n  // // TODO: there is currently a bug where the AuthBoundary flashes the\n  // // `NotAuthenticatedComponent` on the first load after a login with\n  // // cookieless mode. A potential solution to fix this bug is to delay\n  // // emitting `state$` until the session ID has been converted to a token\n  // const firstMessage = messages.pipe(first())\n\n  const token$ = messages.pipe(\n    startWith(isCookielessCompatibleLoginMethod(loginMethod) ? getToken(projectId) : null),\n  )\n\n  // Allow configuration of `apiHost` through source configuration\n  const hostOptions: {apiHost?: string} = {}\n  if (apiHost) {\n    hostOptions.apiHost = apiHost\n    // @ts-expect-error: __SANITY_STAGING__ is a global env variable set by the vite config\n  } else if (typeof __SANITY_STAGING__ !== 'undefined' && __SANITY_STAGING__ === true) {\n    /* __SANITY_STAGING__ is a global variable set by the vite config */\n    hostOptions.apiHost = 'https://api.sanity.work'\n  }\n\n  const state$ = token$.pipe(\n    // // see above\n    // debounce(() => firstMessage),\n    map((token) =>\n      clientFactory({\n        projectId,\n        dataset,\n        apiVersion: '2021-06-07',\n        useCdn: false,\n        ...(token && {token}),\n        withCredentials: true,\n        requestTagPrefix: 'sanity.studio',\n        ignoreBrowserTokenWarning: true,\n        allowReconfigure: false,\n        ...hostOptions,\n      }),\n    ),\n    switchMap((client) =>\n      defer(async (): Promise<AuthState> => {\n        const currentUser = await getCurrentUser(client, broadcast)\n\n        return {\n          currentUser,\n          client,\n          authenticated: !!currentUser,\n        }\n      }),\n    ),\n    distinctUntilChanged((prev, next) =>\n      // Only notify subscribers if the the currentUser object has changed.\n      // Using isEqual is OK since the currentUser object being a small data structure.\n      isEqual(prev.currentUser, next.currentUser),\n    ),\n    shareReplay(1),\n  )\n\n  async function handleCallbackUrl() {\n    const sessionId = getSessionId()\n\n    if (!sessionId) {\n      broadcast(loginMethod === 'cookie' ? null : getToken(projectId))\n      return\n    }\n\n    const requestClient = clientFactory({\n      projectId,\n      dataset,\n      useCdn: true,\n      withCredentials: true,\n      apiVersion: '2021-06-07',\n      requestTagPrefix: 'sanity.studio',\n      ...hostOptions,\n    })\n\n    let currentUser\n    if (loginMethod === 'dual' || loginMethod === 'cookie') {\n      // try to get the current user by using the cookie credentials\n      currentUser = await getCurrentUser(requestClient, broadcast)\n    }\n\n    // If we have a user, or token authentication is explicitly disallowed (`cookie` mode),\n    // then we don't need/want to fetch a token\n    if (currentUser || loginMethod === 'cookie') {\n      // if that worked, then we don't need to fetch a token\n      broadcast(null)\n      return\n    }\n\n    // If we allow using token authentication, we should try to trade the session ID\n    // for a token and store it locally for subsequent use\n    const token = await tradeSessionForToken(requestClient, sessionId)\n    broadcast(token ?? null)\n  }\n\n  async function tradeSessionForToken(client: SanityClient, sessionId: string): Promise<string> {\n    const {token} = await client.request<{token: string}>({\n      method: 'GET',\n      uri: `/auth/fetch`,\n      query: {sid: sessionId},\n      tag: 'auth.fetch-token',\n    })\n\n    saveToken({token, projectId})\n    return token\n  }\n\n  async function logout() {\n    const requestClient = clientFactory({\n      projectId,\n      dataset,\n      useCdn: true,\n      withCredentials: true,\n      token: getToken(projectId) ?? undefined,\n      apiVersion: '2021-06-07',\n      requestTagPrefix: 'sanity.studio',\n      ...hostOptions,\n    })\n\n    clearToken(projectId)\n    await requestClient.request<void>({uri: '/auth/logout', method: 'POST'})\n    broadcast(null)\n  }\n\n  const LoginComponent = createLoginComponent({\n    ...providerOptions,\n    getClient: () => state$.pipe(map((state) => state.client)),\n    loginMethod,\n  })\n\n  return {\n    handleCallbackUrl,\n    token: token$,\n    state: state$,\n    LoginComponent,\n    logout,\n  }\n}\n\nfunction hash(value: unknown): string {\n  if (typeof value !== 'object' || value === null) return `${value}`\n\n  // note: this code path works for arrays as well as objects\n  return JSON.stringify(\n    Object.fromEntries(\n      Object.entries(value)\n        .sort(([a], [b]) => a.localeCompare(b, 'en'))\n        .map(([k, v]) => [k, hash(v)]),\n    ),\n  )\n}\n\n/**\n * @internal\n */\nexport const createAuthStore = memoize(_createAuthStore, hash)\n","/** @internal */\nexport function getProviderTitle(provider?: string): string | undefined {\n  if (provider === 'google') {\n    return 'Google'\n  }\n\n  if (provider === 'github') {\n    return 'GitHub'\n  }\n\n  if (provider === 'sanity') {\n    return 'Sanity'\n  }\n\n  if (provider?.startsWith('saml-')) {\n    return 'SAML/SSO'\n  }\n\n  return undefined\n}\n","import {type Observable, type OperatorFunction} from 'rxjs'\nimport {catchError, tap} from 'rxjs/operators'\n\ntype Selector<T, K> = (error: any, attemptNo: number, caught: Observable<T>) => Observable<K>\n\nexport function catchWithCount<T, K = T>(selector: Selector<T, K>): OperatorFunction<T, K>\n\nexport function catchWithCount<T, K = T>(selector: Selector<T, K>) {\n  return (input$: Observable<T>) => {\n    let errors: any[] = []\n\n    const errorOp: OperatorFunction<any, any> = catchError((err, caught: Observable<T>) => {\n      errors.push(err)\n      return selector(err, errors.length, caught).pipe(errorOp)\n    })\n    return input$.pipe(\n      tap(() => {\n        errors = []\n      }),\n      errorOp,\n    )\n  }\n}\n","import {type BifurClient} from '@sanity/bifur-client'\nimport {observableCallback} from 'observable-callback'\nimport {concat, fromEvent, merge, NEVER, type Observable, of, throwError, timer} from 'rxjs'\nimport {map, mergeMapTo, startWith, take, takeUntil} from 'rxjs/operators'\n\nimport {catchWithCount} from './utils/catchWithCount'\n\n/** @internal */\nexport interface ConnectionStatusStore {\n  connectionStatus$: Observable<ConnectionStatus>\n}\n\nconst onOnline$ = typeof window === 'undefined' ? of({}) : fromEvent(window, 'online')\nconst onOffline$ = typeof window === 'undefined' ? of({}) : fromEvent(window, 'offline')\n\nconst expBackoff = (retryCount: number) => Math.pow(2, retryCount) * 100\n\n/** @internal */\nexport type ConnectingStatus = {\n  type: 'connecting'\n}\n\n/** @internal */\nexport type ErrorStatus = {\n  type: 'error'\n  error: Error\n  attemptNo: number\n  isOffline: boolean\n  retryAt: Date\n}\n\n/** @internal */\nexport type RetryingStatus = {\n  type: 'retrying'\n}\n\n/** @internal */\nexport type ConnectedStatus = {type: 'connected'; lastHeartbeat: Date}\n\n/** @internal */\nexport const CONNECTING: ConnectingStatus = {type: 'connecting'}\n\n/** @internal */\nexport type ConnectionStatus = ConnectingStatus | ErrorStatus | ConnectedStatus | RetryingStatus\n\nconst _callback = observableCallback()\n\nconst onRetry$ = _callback[0]\n\n/** @internal */\nexport const onRetry = _callback[1]\n\nconst createErrorStatus = ({\n  error,\n  isOffline,\n  attemptNo,\n  retryAt,\n}: {\n  error: Error\n  isOffline: boolean\n  attemptNo: number\n  retryAt: Date\n}): ErrorStatus => ({\n  type: 'error',\n  error,\n  attemptNo,\n  isOffline,\n  retryAt,\n})\n\n/** @internal */\nexport interface ConnectionStatusStoreOptions {\n  bifur: BifurClient\n}\n\n/**\n * This is the beginning of what should be the data store tracking connection status in the Sanity studio.\n *\n * @internal\n */\nexport function createConnectionStatusStore({\n  bifur,\n}: ConnectionStatusStoreOptions): ConnectionStatusStore {\n  const connectionStatus$: Observable<ConnectionStatus> = merge(\n    bifur.heartbeats,\n    onOffline$.pipe(mergeMapTo(throwError(new Error('The browser went offline')))),\n  ).pipe(\n    map((ts): ConnectionStatus => ({type: 'connected', lastHeartbeat: ts})),\n    catchWithCount((error, successiveErrorsCount, caught) => {\n      const timeUntilRetry = Math.min(1000 * 240, expBackoff(successiveErrorsCount))\n      const retryAt = new Date(new Date().getTime() + timeUntilRetry)\n      const expiry$ = timer(retryAt)\n      const isOffline = !navigator.onLine\n      const initialErrorStatus = createErrorStatus({\n        error,\n        retryAt,\n        isOffline,\n        attemptNo: successiveErrorsCount,\n      })\n\n      const triggerRetry$ = NEVER.pipe(\n        takeUntil(isOffline ? onOnline$ : merge(expiry$, onOnline$, onRetry$)),\n      )\n\n      return concat(of(initialErrorStatus), triggerRetry$.pipe(take(1)), caught)\n    }),\n    startWith(CONNECTING),\n  )\n\n  return {connectionStatus$}\n}\n","import {type SchemaType} from '@sanity/types'\n\nimport {type ArrayOfObjectsFormNode, type FieldMember, type ObjectMember} from '../../store'\n\n/**\n * @internal\n */\nexport function isBlockType(type: SchemaType): boolean {\n  if (type.type) {\n    return isBlockType(type.type)\n  }\n\n  return type.name === 'block'\n}\n\n/**\n * @internal\n */\nexport function isObjectFieldMember(\n  member: ObjectMember,\n): member is FieldMember<ArrayOfObjectsFormNode> {\n  return member.kind === 'field' && member.field.schemaType.jsonType === 'object'\n}\n\n/**\n * @internal\n */\nexport function isArrayOfObjectsFieldMember(\n  member: ObjectMember,\n): member is FieldMember<ArrayOfObjectsFormNode> {\n  return member.kind === 'field' && member.field.schemaType.jsonType === 'array'\n}\n","import {\n  type IndexTuple,\n  isIndexSegment,\n  isIndexTuple,\n  isKeyedObject,\n  isKeySegment,\n  type KeyedSegment,\n  type Path,\n  type PathSegment,\n} from '@sanity/types'\n\nimport {isRecord} from '../../util'\n\nconst rePropName =\n  /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g\nconst reKeySegment = /_key\\s*==\\s*['\"](.*)['\"]/\n\n/** @internal */\nexport function pathToString(path: Path): string {\n  if (!Array.isArray(path)) {\n    throw new Error('Path is not an array')\n  }\n\n  return path.reduce<string>((target, segment, i) => {\n    if (isIndexSegment(segment)) {\n      return `${target}[${segment}]`\n    }\n\n    if (isKeySegment(segment) && segment._key) {\n      return `${target}[_key==\"${segment._key}\"]`\n    }\n\n    if (isIndexTuple(segment)) {\n      const [from, to] = segment\n      return `${target}[${from}:${to}]`\n    }\n\n    if (typeof segment === 'string') {\n      const separator = i === 0 ? '' : '.'\n      return `${target}${separator}${segment}`\n    }\n\n    throw new Error(`Unsupported path segment \\`${JSON.stringify(segment)}\\``)\n  }, '')\n}\n\n/** @internal */\nexport function getValueAtPath(rootValue: unknown, path: Path): unknown {\n  const segment = path[0]\n  if (!segment) {\n    return rootValue\n  }\n\n  const tail = path.slice(1)\n  if (isIndexSegment(segment)) {\n    return getValueAtPath(Array.isArray(rootValue) ? rootValue[segment] : undefined, tail)\n  }\n\n  if (isKeySegment(segment)) {\n    return getValueAtPath(\n      Array.isArray(rootValue) ? rootValue.find((item) => item._key === segment._key) : undefined,\n      tail,\n    )\n  }\n\n  if (typeof segment === 'string') {\n    return getValueAtPath(isRecord(rootValue) ? rootValue[segment] : undefined, tail)\n  }\n\n  throw new Error(`Unknown segment type ${JSON.stringify(segment)}`)\n}\n\n/** @internal */\nexport function findIndex(array: unknown[], segment: PathSegment): number {\n  if (typeof segment !== 'number' && !isKeySegment(segment)) {\n    return -1\n  }\n\n  return typeof segment === 'number'\n    ? segment\n    : array.findIndex((item) => isKeyedObject(item) && item._key === segment._key)\n}\n\n/** @internal */\nexport function stringToPath(path: string): Path {\n  const segments = path.match(rePropName)\n  if (!segments) {\n    throw new Error('Invalid path string')\n  }\n\n  return segments.map(normalizePathSegment)\n}\n\n/** @internal */\nexport function normalizePathSegment(segment: string): PathSegment {\n  if (isIndexSegment(segment)) {\n    return normalizeIndexSegment(segment)\n  }\n\n  if (isKeySegment(segment)) {\n    return normalizeKeySegment(segment)\n  }\n\n  if (isIndexTuple(segment)) {\n    return normalizeIndexTupleSegment(segment)\n  }\n\n  return segment\n}\n\n/** @internal */\nexport function normalizeIndexSegment(segment: string): PathSegment {\n  return Number(segment.replace(/[^\\d]/g, ''))\n}\n\n/** @internal */\nexport function normalizeKeySegment(segment: string): KeyedSegment {\n  const segments = segment.match(reKeySegment)\n  if (!segments) {\n    throw new Error('Invalid key segment')\n  }\n\n  return {_key: segments[1]}\n}\n\n/** @internal */\nexport function normalizeIndexTupleSegment(segment: string): IndexTuple {\n  const [from, to] = segment.split(':').map((seg) => (seg === '' ? seg : Number(seg)))\n  return [from, to]\n}\n\n/** @internal */\nexport function pathsAreEqual(pathA: Path, pathB: Path): boolean {\n  if (pathA.length !== pathB.length) {\n    return false\n  }\n\n  return pathA.every((segmentA, index) => {\n    const segmentB = pathB[index]\n    if (isKeySegment(segmentA) && isKeySegment(segmentB)) {\n      return segmentA._key === segmentB._key\n    }\n\n    if (isIndexSegment(segmentA)) {\n      return Number(segmentA) === Number(segmentB)\n    }\n\n    if (isIndexTuple(segmentA) && isIndexTuple(segmentB)) {\n      return segmentA[0] === segmentB[0] && segmentA[1] === segmentB[1]\n    }\n\n    return segmentA === segmentB\n  })\n}\n\n/** @internal */\nexport function getItemKey(arrayItem: unknown): string | undefined {\n  return isKeyedObject(arrayItem) ? arrayItem._key : undefined\n}\n\n/** @internal */\nexport function getItemKeySegment(arrayItem: unknown): KeyedSegment | undefined {\n  const key = getItemKey(arrayItem)\n  return key ? {_key: key} : undefined\n}\n\n/** @internal */\nexport function isEmptyObject(item: unknown): boolean {\n  return typeof item === 'object' && item !== null && Object.keys(item).length <= 0\n}\n","import {\n  isIndexSegment,\n  isIndexTuple,\n  isKeySegment,\n  type KeyedSegment,\n  type Path,\n} from '@sanity/types'\n\nimport {type UserColor, type UserColorManager} from '../../../user-color'\nimport {pathToString, stringToPath} from '../../paths/helpers'\nimport {\n  type Annotation,\n  type ArrayDiff,\n  type Diff,\n  type ItemDiff,\n  type ObjectDiff,\n  type StringDiff,\n  type StringDiffSegment,\n} from '../../types'\n\n/** @internal */\nexport function getAnnotationColor(\n  colorManager: UserColorManager,\n  annotation?: Annotation | null,\n): UserColor {\n  return colorManager.get(annotation?.author || null)\n}\n\n/** @internal */\nexport function getAnnotationAtPath(diff: Diff, diffPath: string | Path): Annotation | undefined {\n  const path: Path = Array.isArray(diffPath) ? diffPath : stringToPath(diffPath)\n\n  return getAnnotationAt(diff, path)\n}\n\n/** @internal */\nexport function getDiffAtPath(diff: Diff, diffPath: string | Path): Diff | undefined {\n  const path: Path = Array.isArray(diffPath) ? diffPath : stringToPath(diffPath)\n  return getDiffAt(diff, path)\n}\n\nfunction getAnnotationAt(diff: Diff, path: Path): Annotation | undefined {\n  const diffAt = getDiffAt(diff, path)\n  if (!diffAt) {\n    return undefined\n  }\n\n  if (diffAt.action === 'unchanged') {\n    return undefined\n  }\n\n  return diffAt.annotation || undefined\n}\n\n// eslint-disable-next-line complexity\nfunction getDiffAt(diff: Diff, path: Path, parentPath: Path = []): Diff | undefined {\n  if (path.length === 0) {\n    return diff\n  }\n\n  const segment = path[0]\n  const tail = path.slice(1)\n\n  if (isIndexTuple(segment)) {\n    throw new Error('Index tuples are not supported in diff paths')\n  }\n\n  if (isIndexSegment(segment) || isKeySegment(segment)) {\n    const location = isIndexSegment(segment) ? `at index ${segment}` : `with key ${segment._key}`\n    if (diff.type !== 'array') {\n      warn(`Failed to get item ${location} at path ${pathToString(parentPath)} (not an array)`)\n      return undefined\n    }\n\n    const itemDiff = diff.items.find(\n      isIndexSegment(segment)\n        ? (item) => item.toIndex === segment\n        : (item) => itemMatchesKey(item, segment),\n    )\n\n    if (!itemDiff) {\n      warn(`Failed to get item ${location} at path ${pathToString(parentPath)} (item missing)`)\n      return undefined\n    }\n\n    return getDiffAt(itemDiff.diff, tail, parentPath.concat(segment))\n  }\n\n  if (diff.type !== 'object') {\n    warn(`Failed to get property ${segment} at path ${pathToString(parentPath)} (not an object)`)\n    return undefined\n  }\n\n  const fieldDiff = diff.fields[segment]\n  if (typeof fieldDiff === 'undefined') {\n    warn(\n      `Failed to get property ${segment} at path ${pathToString(parentPath)} (field did not exist)`,\n    )\n    return undefined\n  }\n\n  return getDiffAt(fieldDiff, tail, parentPath.concat(segment))\n}\n\n/* eslint-disable no-console, @typescript-eslint/no-unused-vars */\nfunction warn(msg: string) {\n  //console.warn(msg)\n}\n/* eslint-enable no-console, @typescript-eslint/no-unused-vars */\n\nfunction itemMatchesKey(item: ItemDiff, key: KeyedSegment) {\n  const itemDiff = item.diff\n  return itemDiff.type !== 'object' || !itemDiff.toValue ? false : itemDiff.toValue._key === key\n}\n\n/** @internal */\nexport type DiffVisitor = (diff: Diff | StringDiffSegment, path: Path) => boolean\n\n/**\n * Visit all diffs in tree, until visitor returns false\n *\n * @param diff - Diff to visit\n * @param visitor - Visitor function, return false to stop from going deeper\n *\n * @internal\n */\nexport function visitDiff(\n  diff: Diff | StringDiffSegment,\n  visitor: DiffVisitor,\n  path: Path = [],\n): void {\n  if (!visitor(diff, path)) {\n    return\n  }\n\n  if (diff.type === 'array') {\n    visitArrayDiff(diff, visitor, path)\n    return\n  }\n\n  if (diff.type === 'object') {\n    visitObjectDiff(diff, visitor, path)\n    return\n  }\n\n  if (diff.type === 'string') {\n    visitStringDiff(diff, visitor, path)\n  }\n}\n\nfunction visitArrayDiff(diff: ArrayDiff, visitor: DiffVisitor, path: Path) {\n  if (diff.action === 'unchanged') {\n    return\n  }\n\n  diff.items.forEach((itemDiff) => {\n    const _key = itemDiff.diff.type === 'object' && (itemDiff.diff.toValue?._key as string)\n    const segment = _key ? {_key} : getItemDiffIndex(itemDiff)\n    visitDiff(itemDiff.diff, visitor, path.concat(segment))\n  })\n}\n\nfunction visitObjectDiff(diff: ObjectDiff, visitor: DiffVisitor, path: Path) {\n  if (diff.action === 'unchanged') {\n    return\n  }\n\n  Object.keys(diff.fields).forEach((fieldName) => {\n    const fieldDiff = diff.fields[fieldName]\n    visitDiff(fieldDiff, visitor, path.concat(fieldName))\n  })\n}\n\nfunction visitStringDiff(diff: StringDiff, visitor: DiffVisitor, path: Path) {\n  if (diff.action === 'unchanged') {\n    return\n  }\n\n  diff.segments.forEach((segment) => {\n    visitDiff(segment, visitor, path)\n  })\n}\n\nfunction getItemDiffIndex(itemDiff: ItemDiff): number {\n  return typeof itemDiff.toIndex === 'undefined' ? itemDiff.fromIndex || 0 : itemDiff.toIndex\n}\n","import {createContext} from 'react'\n\nimport {type UserColorManager} from './types'\n\nexport const UserColorManagerContext = createContext<UserColorManager | null>(null)\n","import {useContext} from 'react'\nimport {useMemoObservable} from 'react-rx'\nimport {empty} from 'rxjs'\n\nimport {UserColorManagerContext} from './context'\nimport {type UserColor, type UserColorManager} from './types'\n\n/** @internal */\nexport function useUserColorManager(): UserColorManager {\n  const userColorManager = useContext(UserColorManagerContext)\n\n  if (!userColorManager) {\n    throw new Error('UserColorManager: missing context value')\n  }\n\n  return userColorManager\n}\n\n/** @internal */\nexport function useUserColor(userId: string | null): UserColor {\n  const manager = useUserColorManager()\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps -- no need to refactor to an inline function\n  return useMemoObservable(userId ? manager.listen(userId) : empty(), [userId], manager.get(null))\n}\n","import {COLOR_HUES, type ColorHueKey, type ColorTintKey, hues} from '@sanity/color'\nimport {type ThemeColorSchemeKey} from '@sanity/ui'\nimport {Observable} from 'rxjs'\nimport {shareReplay} from 'rxjs/operators'\n\nimport {type UserColor, type UserColorHue, type UserColorManager, type UserId} from './types'\n\n/** @internal */\nexport interface UserColorManagerOptions {\n  anonymousColor?: UserColor\n  userStore?: {me: Observable<{id: string} | null>}\n  colors?: Record<UserColorHue, UserColor>\n  currentUserColor?: UserColorHue\n  scheme: ThemeColorSchemeKey\n}\n\nconst DEFAULT_CURRENT_USER_HUE: ColorHueKey = 'purple'\n\n// Exclude green and red because they can be confused with \"add\" and \"remove\"\n// Exclude gray because it looks like \"color not found\"\nconst USER_COLOR_EXCLUDE_HUES = ['green', 'red', 'gray']\n\nconst defaultHues: ColorHueKey[] = COLOR_HUES.filter(\n  (hue) => !USER_COLOR_EXCLUDE_HUES.includes(hue),\n)\n\nconst getTints = (scheme: ThemeColorSchemeKey): Record<string, ColorTintKey> => {\n  const isDarkScheme = scheme === 'dark'\n\n  return {\n    background: isDarkScheme ? '900' : '100',\n    border: isDarkScheme ? '700' : '300',\n    text: isDarkScheme ? '200' : '700',\n  }\n}\n\nconst getDefaultColors = (scheme: ThemeColorSchemeKey): Record<string, UserColor> => {\n  const {background, border, text} = getTints(scheme)\n\n  return defaultHues.reduce(\n    (colors, hue) => {\n      colors[hue] = {\n        name: hue,\n        background: hues[hue][background].hex,\n        border: hues[hue][border].hex,\n        text: hues[hue][text].hex,\n        tints: hues[hue],\n      }\n      return colors\n    },\n    {} as Record<ColorHueKey, UserColor>,\n  )\n}\n\nconst getAnonymousColor = (scheme: ThemeColorSchemeKey): UserColor => {\n  const {background, border, text} = getTints(scheme)\n\n  return {\n    name: 'gray',\n    background: hues.gray[background].hex,\n    border: hues.gray[border].hex,\n    text: hues.gray[text].hex,\n    tints: hues.gray,\n  }\n}\n\n/** @internal */\nexport function createUserColorManager(options: UserColorManagerOptions): UserColorManager {\n  const {\n    anonymousColor: anonymousColorProp,\n    colors,\n    currentUserColor: currentUserColorProp,\n    scheme,\n  } = options\n\n  const userColors = colors || getDefaultColors(scheme)\n  const anonymousColor = anonymousColorProp || getAnonymousColor(scheme)\n  const currentUserColor = currentUserColorProp || DEFAULT_CURRENT_USER_HUE\n\n  if (!userColors.hasOwnProperty(currentUserColor)) {\n    throw new Error(`'colors' must contain 'currentUserColor' (${currentUserColor})`)\n  }\n\n  const userColorKeys: UserColorHue[] = Object.keys(userColors)\n  const subscriptions = new Map<UserId, Observable<UserColor>>()\n  const previouslyAssigned = new Map<UserId, UserColorHue>()\n  const assignedCounts: Record<UserColorHue, number> = userColorKeys.reduce(\n    (counts, color) => {\n      counts[color] = 0\n      return counts\n    },\n    {} as Record<UserColorHue, number>,\n  )\n\n  // This isn't really needed because we're reusing subscriptions,\n  // but is useful for debugging and poses a minimal overhead\n  const assigned = new Map<UserId, UserColorHue>()\n\n  let currentUserId: UserId | null\n\n  if (options?.userStore) {\n    options.userStore.me.subscribe((user) => setCurrentUser(user ? user.id : null))\n  }\n\n  return {get, listen}\n\n  function get(userId: UserId | null): UserColor {\n    if (!userId) {\n      return anonymousColor\n    }\n\n    return userColors[getUserHue(userId)]\n  }\n\n  function getUserHue(userId: UserId): UserColorHue {\n    if (userId === currentUserId) {\n      return currentUserColor\n    }\n\n    const assignedHue = assigned.get(userId)\n    if (assignedHue) {\n      return assignedHue\n    }\n\n    // Prefer to reuse the color previously assigned, BUT:\n    // ONLY if it's unused -or- there are no other unused colors\n    const prevHue = previouslyAssigned.get(userId)\n    if (prevHue && (assignedCounts[prevHue] === 0 || !hasUnusedColor())) {\n      return assignHue(userId, prevHue)\n    }\n\n    // Prefer \"static\" color based on user ID if unused\n    const preferredHue = getPreferredHue(userId)\n    if (assignedCounts[preferredHue] === 0) {\n      return assignHue(userId, preferredHue)\n    }\n\n    // Fall back to least used color, with a preference on the previous\n    // used color if there are ties for least used\n    return assignHue(userId, getLeastUsedHue(prevHue))\n  }\n\n  function listen(userId: string): Observable<UserColor> {\n    let subscription = subscriptions.get(userId)\n    if (subscription) {\n      return subscription\n    }\n\n    const hue = getUserHue(userId)\n    subscription = getObservableColor(userId, hue)\n    subscriptions.set(userId, subscription)\n    return subscription\n  }\n\n  function assignHue(userId: string, hue: UserColorHue): UserColorHue {\n    assigned.set(userId, hue)\n    previouslyAssigned.set(userId, hue)\n    assignedCounts[hue]++\n    return hue\n  }\n\n  function unassignHue(userId: string, hue: UserColorHue) {\n    assigned.delete(userId)\n    assignedCounts[hue]--\n  }\n\n  function getUnusedColor(): UserColorHue | undefined {\n    return userColorKeys.find((colorHue) => assignedCounts[colorHue] === 0)\n  }\n\n  function hasUnusedColor(): boolean {\n    return Boolean(getUnusedColor())\n  }\n\n  function getLeastUsedHue(tieBreakerPreference?: UserColorHue): UserColorHue {\n    let leastUses = +Infinity\n    let leastUsed: UserColorHue[] = []\n\n    userColorKeys.forEach((colorHue) => {\n      const uses = assignedCounts[colorHue]\n      if (uses === leastUses) {\n        leastUsed.push(colorHue)\n      } else if (uses < leastUses) {\n        leastUses = uses\n        leastUsed = [colorHue]\n      }\n    })\n\n    return tieBreakerPreference && leastUsed.includes(tieBreakerPreference)\n      ? tieBreakerPreference\n      : leastUsed[0]\n  }\n\n  function getObservableColor(userId: string, hue: UserColorHue): Observable<UserColor> {\n    return new Observable<UserColor>((subscriber) => {\n      const userColor = userColors[hue]\n      subscriber.next(userColor)\n      return () => {\n        subscriptions.delete(userId)\n        unassignHue(userId, hue)\n      }\n    }).pipe(shareReplay({refCount: true}))\n  }\n\n  function setCurrentUser(userId: string | null) {\n    currentUserId = userId\n    assignedCounts[currentUserColor] += userId ? 1 : -1\n  }\n\n  function getPreferredHue(userId: string): UserColorHue {\n    let hash = 0\n    for (let i = 0; i < userId.length; i++) {\n      // eslint-disable-next-line no-bitwise\n      hash = ((hash << 5) - hash + userId.charCodeAt(i)) | 0\n    }\n    return userColorKeys[Math.abs(hash) % userColorKeys.length]\n  }\n}\n","import {type ReactElement, type ReactNode, useMemo} from 'react'\n\nimport {useColorScheme} from '../studio'\nimport {UserColorManagerContext} from './context'\nimport {createUserColorManager} from './manager'\nimport {type UserColorManager} from './types'\n\n/** @internal */\nexport interface UserColorManagerProviderProps {\n  children: ReactNode\n  manager?: UserColorManager\n}\n\n/** @internal */\nexport function UserColorManagerProvider({\n  children,\n  manager: managerFromProps,\n}: UserColorManagerProviderProps): ReactElement {\n  const {scheme} = useColorScheme()\n\n  const manager = useMemo(() => {\n    return managerFromProps || createUserColorManager({scheme})\n  }, [managerFromProps, scheme])\n\n  return (\n    <UserColorManagerContext.Provider value={manager}>{children}</UserColorManagerContext.Provider>\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {useMemo} from 'react'\n\nimport {type UserColor, useUserColorManager} from '../../../user-color'\nimport {type Annotation, type Diff} from '../../types'\nimport {getAnnotationAtPath, getAnnotationColor} from './helpers'\n\n/** @internal */\nexport function useAnnotationColor(annotation?: Annotation | null): UserColor {\n  const userColorManager = useUserColorManager()\n\n  return getAnnotationColor(userColorManager, annotation)\n}\n\n/** @internal */\nexport function useDiffAnnotationColor(diff: Diff, path: string | Path = []): UserColor {\n  const userColorManager = useUserColorManager()\n  const annotation = useMemo(() => getAnnotationAtPath(diff, path), [diff, path])\n\n  return useMemo(\n    () => getAnnotationColor(userColorManager, annotation),\n    [annotation, userColorManager],\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {Flex, Inline, Stack, Text} from '@sanity/ui'\nimport {type ReactElement, type ReactNode} from 'react'\n\nimport {Tooltip, type TooltipProps} from '../../../../ui-components'\nimport {LegacyLayerProvider, UserAvatar} from '../../../components'\nimport {useRelativeTime} from '../../../hooks'\nimport {useTranslation} from '../../../i18n'\nimport {useUser} from '../../../store'\nimport {type AnnotationDetails, type Diff} from '../../types'\nimport {getAnnotationAtPath, useAnnotationColor} from '../annotations'\n\n/** @internal */\nexport interface DiffTooltipProps extends TooltipProps {\n  children: ReactElement\n  description?: ReactNode\n  diff: Diff\n  path?: Path | string\n}\n\n/** @internal */\nexport interface DiffTooltipWithAnnotationsProps extends TooltipProps {\n  annotations: AnnotationDetails[]\n  children: ReactElement\n  description?: ReactNode\n}\n\n/** @internal */\nexport function DiffTooltip(props: DiffTooltipProps | DiffTooltipWithAnnotationsProps) {\n  if (!('diff' in props)) {\n    return <DiffTooltipWithAnnotation {...props} />\n  }\n\n  const {diff, path = [], ...restProps} = props\n  const annotation = getAnnotationAtPath(diff, path)\n\n  return <DiffTooltipWithAnnotation {...restProps} annotations={annotation ? [annotation] : []} />\n}\n\nfunction DiffTooltipWithAnnotation(props: DiffTooltipWithAnnotationsProps) {\n  const {annotations, children, description, ...restProps} = props\n  const {t} = useTranslation()\n\n  if (!annotations) {\n    return children\n  }\n\n  const content = (\n    <Stack space={2}>\n      <Text muted size={1} weight=\"medium\">\n        {description || t('changes.changed-label')}\n      </Text>\n      <Stack space={2}>\n        {annotations.map((annotation, idx) => (\n          <AnnotationItem annotation={annotation} key={idx} />\n        ))}\n      </Stack>\n    </Stack>\n  )\n\n  return (\n    <LegacyLayerProvider zOffset=\"paneFooter\">\n      <Tooltip content={content} portal {...restProps}>\n        {children}\n      </Tooltip>\n    </LegacyLayerProvider>\n  )\n}\n\nfunction AnnotationItem({annotation}: {annotation: AnnotationDetails}) {\n  const {author, timestamp} = annotation\n  const [user] = useUser(author)\n  const color = useAnnotationColor(annotation)\n  const timeAgo = useRelativeTime(timestamp, {minimal: true})\n  const {t} = useTranslation()\n\n  return (\n    <Inline space={2}>\n      <Flex\n        align=\"center\"\n        paddingRight={3}\n        style={{\n          backgroundColor: color.background,\n          color: color.text,\n          borderRadius: 'calc(23px / 2)',\n        }}\n      >\n        <UserAvatar user={author} />\n        <Inline paddingLeft={2}>\n          <Text muted size={1} style={{color: color.text}}>\n            {user ? user.displayName : t('changes.loading-author')}\n          </Text>\n        </Inline>\n      </Flex>\n      <Text as=\"time\" muted size={1} dateTime={timestamp}>\n        {timeAgo}\n      </Text>\n    </Inline>\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {Card, rem} from '@sanity/ui'\nimport {type ElementType, forwardRef, type HTMLProps, type ReactNode, useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {type Annotation, type Diff} from '../../types'\nimport {getAnnotationAtPath, useAnnotationColor} from '../annotations'\nimport {DiffTooltip} from './DiffTooltip'\n\n/** @internal */\nexport interface DiffCardProps {\n  annotation?: Annotation\n  as?: ElementType | keyof JSX.IntrinsicElements\n  diff?: Diff\n  disableHoverEffect?: boolean\n  path?: Path | string\n  tooltip?: {description?: ReactNode} | boolean\n}\n\nconst StyledCard = styled(Card)`\n  --diff-card-radius: ${({theme}) => rem(theme.sanity.radius[2])};\n  --diff-card-bg-color: ${({theme}) => theme.sanity.color.card.enabled.bg};\n\n  max-width: 100%;\n  position: relative;\n  border-radius: var(--diff-card-radius);\n\n  &:not(del) {\n    text-decoration: none;\n  }\n\n  &[data-hover] {\n    &::after {\n      content: '';\n      display: block;\n      position: absolute;\n      left: 0;\n      right: 0;\n      bottom: 0;\n    }\n\n    &:hover {\n      border-bottom-left-radius: 0;\n      border-bottom-right-radius: 0;\n\n      &::after {\n        bottom: -3px;\n        border-top: 1px solid var(---diff-card-bg-color);\n        border-bottom: 2px solid currentColor;\n        border-bottom-left-radius: var(--diff-card-radius);\n        border-bottom-right-radius: var(--diff-card-radius);\n      }\n    }\n\n    [data-from-to-layout]:hover & {\n      border-bottom-left-radius: 0;\n      border-bottom-right-radius: 0;\n\n      &::after {\n        bottom: -3px;\n        border-top: 1px solid var(---diff-card-bg-color);\n        border-bottom: 2px solid currentColor;\n        border-bottom-left-radius: var(--diff-card-radius);\n        border-bottom-right-radius: var(--diff-card-radius);\n      }\n    }\n  }\n`\n\nconst EMPTY_PATH: Path = []\n\n/** @internal */\nexport const DiffCard = forwardRef(function DiffCard(\n  props: DiffCardProps & Omit<HTMLProps<HTMLElement>, 'as' | 'height'>,\n  ref,\n) {\n  const {\n    annotation: annotationProp,\n    as = 'div',\n    children,\n    className,\n    diff,\n    disableHoverEffect,\n    path = EMPTY_PATH,\n    style = {},\n    tooltip,\n    ...restProps\n  } = props\n\n  const annotation = useMemo(\n    () => annotationProp || getAnnotationAtPath(diff!, path),\n    [annotationProp, diff, path],\n  )\n\n  const color = useAnnotationColor(annotation)\n\n  const element = (\n    <StyledCard\n      {...restProps}\n      as={as}\n      className={className}\n      data-hover={disableHoverEffect || !annotation ? undefined : ''}\n      ref={ref}\n      radius={1}\n      style={{\n        ...style,\n        backgroundColor: color.background,\n        color: color.text,\n      }}\n    >\n      {children}\n    </StyledCard>\n  )\n\n  if (tooltip && annotation) {\n    return (\n      <DiffTooltip\n        annotations={[annotation]}\n        description={tooltip && typeof tooltip === 'object' && tooltip.description}\n      >\n        {element}\n      </DiffTooltip>\n    )\n  }\n\n  return element\n})\n","import {Box, rem, Text} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../i18n'\nimport {type Annotation, type FieldChangeNode, type FromToIndex} from '../../types'\nimport {getAnnotationAtPath} from '../annotations'\nimport {DiffCard} from './DiffCard'\n\nconst RoundedCard = styled.div`\n  border-radius: ${({theme}) => rem(theme.sanity.radius[2])};\n  padding: ${({theme}) => rem(theme.sanity.space[1])};\n`\n\nconst AnnotationText = styled(Text)`\n  &:not([hidden]) {\n    color: inherit;\n  }\n`\n\n/** @internal */\nexport function ChangeTitleSegment(props: {\n  change?: FieldChangeNode\n  segment: string | FromToIndex\n}) {\n  const {change, segment} = props\n\n  if (typeof segment === 'string') {\n    return (\n      <Box>\n        <Text title={segment} size={1} weight=\"medium\" textOverflow=\"ellipsis\">\n          {segment}\n        </Text>\n      </Box>\n    )\n  }\n\n  const {hasMoved, fromIndex, toIndex, annotation} = segment\n  const created = typeof fromIndex === 'undefined'\n  const deleted = typeof toIndex === 'undefined'\n  if (created) {\n    // Item was created\n    return <CreatedTitleSegment annotation={annotation} change={change} toIndex={toIndex} />\n  }\n\n  if (deleted) {\n    // Item was deleted\n    return <DeletedTitleSegment annotation={annotation} fromIndex={fromIndex} />\n  }\n\n  if (hasMoved && typeof toIndex !== 'undefined' && typeof fromIndex !== 'undefined') {\n    // Item was moved\n    return <MovedTitleSegment annotation={annotation} fromIndex={fromIndex} toIndex={toIndex} />\n  }\n\n  // Changed/unchanged\n  const readableIndex = (toIndex || 0) + 1\n  return (\n    <Box padding={1}>\n      <Text size={1} weight=\"medium\">\n        #{readableIndex}\n      </Text>\n    </Box>\n  )\n}\n\nfunction CreatedTitleSegment(props: {\n  annotation: Annotation | undefined\n  change?: FieldChangeNode\n  toIndex?: number\n}) {\n  const {annotation: annotationProp, change, toIndex = 0} = props\n  const {t} = useTranslation()\n  const readableIndex = toIndex + 1\n  const description = t('changes.array.item-added-in-position', {position: readableIndex})\n  const content = <>#{readableIndex}</>\n  const diffAnnotation = change?.diff ? getAnnotationAtPath(change.diff, []) : undefined\n  const annotation = diffAnnotation || annotationProp\n\n  if (annotation) {\n    return (\n      <DiffCard annotation={annotation} tooltip={{description}} as={RoundedCard}>\n        <AnnotationText size={1} weight=\"medium\" forwardedAs=\"ins\" style={{textDecoration: 'none'}}>\n          {content}\n        </AnnotationText>\n      </DiffCard>\n    )\n  }\n\n  return (\n    <Text size={1} weight=\"medium\">\n      {content}\n    </Text>\n  )\n}\n\nfunction DeletedTitleSegment(props: {annotation: Annotation | undefined; fromIndex?: number}) {\n  const {annotation, fromIndex = 0} = props\n  const {t} = useTranslation()\n  const readableIndex = fromIndex + 1\n  const description = t('changes.array.item-removed-from-position', {position: readableIndex})\n  return (\n    <DiffCard annotation={annotation || null} as={RoundedCard} tooltip={{description}}>\n      <AnnotationText size={1} weight=\"medium\" forwardedAs=\"del\">\n        #{readableIndex}\n      </AnnotationText>\n    </DiffCard>\n  )\n}\n\nfunction MovedTitleSegment(props: {\n  annotation: Annotation | undefined\n  fromIndex: number\n  toIndex: number\n}) {\n  const {annotation, fromIndex, toIndex} = props\n  const {t} = useTranslation()\n  const indexDiff = toIndex - fromIndex\n  const indexSymbol = indexDiff < 0 ? '' : ''\n  const positions = Math.abs(indexDiff)\n  const direction = indexDiff < 0 ? 'up' : 'down'\n  const description = t('changes.array.item-moved', {\n    count: positions,\n    context: direction,\n  })\n\n  return (\n    <>\n      <Box padding={1}>\n        <AnnotationText size={1} weight=\"medium\">\n          #{toIndex + 1}\n        </AnnotationText>\n      </Box>\n      <DiffCard annotation={annotation} as={RoundedCard} tooltip={{description}}>\n        <AnnotationText size={1} weight=\"medium\">\n          {indexSymbol}\n          {Math.abs(indexDiff)}\n        </AnnotationText>\n      </DiffCard>\n    </>\n  )\n}\n","import {ChevronRightIcon} from '@sanity/icons'\nimport {Breadcrumbs, Text} from '@sanity/ui'\n\nimport {type ChangeTitlePath, type FieldChangeNode} from '../../types'\nimport {ChangeTitleSegment} from './ChangeTitleSegment'\n\n/** @internal */\nexport function ChangeBreadcrumb(props: {change?: FieldChangeNode; titlePath: ChangeTitlePath}) {\n  const {change, titlePath} = props\n\n  return (\n    <Breadcrumbs\n      maxLength={4}\n      separator={\n        <Text muted size={1}>\n          <ChevronRightIcon />\n        </Text>\n      }\n    >\n      {titlePath.map((titleSegment, idx) => {\n        const showSegment = typeof titleSegment === 'string' || !change || change.showIndex\n\n        if (!showSegment) {\n          return null\n        }\n\n        return <ChangeTitleSegment change={change} key={idx} segment={titleSegment} />\n      })}\n    </Breadcrumbs>\n  )\n}\n","import {\n  type ConditionalProperty,\n  type ConditionalPropertyCallbackContext,\n  type CurrentUser,\n} from '@sanity/types'\nimport {omit} from 'lodash'\nimport {useMemo, useRef} from 'react'\n\nimport {isRecord} from '../../util'\n\nexport function isThenable(value: unknown): value is Promise<unknown> {\n  return isRecord(value) && typeof value?.then === 'function'\n}\n\nexport function omitDeprecatedRole(user: CurrentUser): Omit<CurrentUser, 'role'> {\n  return omit(user, 'role')\n}\n\nexport function useCheckCondition(\n  checkProperty: ConditionalProperty,\n  checkPropertyName: string,\n  context: ConditionalPropertyCallbackContext,\n): boolean {\n  const {currentUser, document, parent, value} = context\n\n  const didWarn = useRef(false)\n\n  return useMemo(() => {\n    let isTrueIsh = false\n\n    if (typeof checkProperty === 'boolean' || checkProperty === undefined) {\n      return checkProperty || false\n    }\n\n    try {\n      isTrueIsh = checkProperty({\n        document,\n        parent,\n        value,\n        currentUser,\n      })\n    } catch (err) {\n      console.error(\n        `An error occurred while running the callback from \\`${checkPropertyName}\\`: ${err.message}`,\n      )\n      return false\n    }\n\n    if (isThenable(isTrueIsh) && !didWarn.current) {\n      console.warn(\n        `The \\`${checkPropertyName}\\` option is either a promise or a promise returning function. Async callbacks for \\`${checkPropertyName}\\` option is not currently supported.`,\n      )\n      return false\n    }\n\n    if (typeof isTrueIsh === 'undefined') {\n      console.warn(\n        `The \\`${checkPropertyName}\\` option is or returned \\`undefined\\`. \\`${checkPropertyName}\\` should return a boolean.`,\n      )\n    }\n\n    return isTrueIsh\n  }, [checkProperty, document, parent, value, currentUser, checkPropertyName])\n}\n","import {type ConditionalProperty, type SanityDocument} from '@sanity/types'\n\nimport {useCurrentUser} from '../../store'\nimport {useUnique} from '../../util'\nimport {useCheckCondition} from './utils'\n\n/**\n * @internal Not yet a stable API\n */\nexport interface ConditionalPropertyProps {\n  parent?: unknown\n  value: unknown\n  document?: SanityDocument\n  checkProperty: ConditionalProperty\n  checkPropertyKey: string\n}\n\n/**\n * Resolve a callback function to a boolean using the passed arguments\n *\n * @internal Not yet a stable API\n */\nconst useConditionalProperty = (props: ConditionalPropertyProps): boolean => {\n  const {checkProperty = false, checkPropertyKey, document, parent, value: valueProp} = props\n  const value = useUnique(valueProp)\n  const currentUser = useCurrentUser()\n\n  const isPropertyTruthy = useCheckCondition(checkProperty, checkPropertyKey, {\n    currentUser,\n    document,\n    parent,\n    value,\n  })\n\n  return isPropertyTruthy\n}\n\nexport {useConditionalProperty as unstable_useConditionalProperty}\n","import {type ArraySchemaType, isTypedObject, type SchemaType} from '@sanity/types'\n\nimport {type Diff} from '../types'\n\nexport function resolveTypeName(value: unknown): string {\n  return isTypedObject(value) ? value._type : resolveJSType(value)\n}\n\nexport function getArrayDiffItemType(\n  diff: Diff,\n  schemaType: ArraySchemaType,\n): {fromType?: SchemaType; toType?: SchemaType} {\n  if (diff.action === 'added') {\n    return {\n      toType: resolveArrayMemberType(schemaType, diff.toValue),\n    }\n  }\n\n  if (diff.action === 'changed') {\n    return {\n      fromType: resolveArrayMemberType(schemaType, diff.fromValue),\n      toType: resolveArrayMemberType(schemaType, diff.toValue),\n    }\n  }\n\n  if (diff.action === 'removed') {\n    return {\n      fromType: resolveArrayMemberType(schemaType, diff.fromValue),\n    }\n  }\n\n  // unchanged\n  return {\n    toType: resolveArrayMemberType(schemaType, diff.toValue),\n  }\n}\n\nfunction resolveArrayMemberType(\n  schemaType: ArraySchemaType,\n  value: unknown,\n): SchemaType | undefined {\n  const typeName = resolveTypeName(value)\n  const declared = schemaType.of.find((candidate) => candidate.name === typeName)\n  if (declared) {\n    return declared as any\n  }\n\n  return (schemaType.of.length === 1 ? schemaType.of[0] : undefined) as any\n}\n\nfunction resolveJSType(val: unknown) {\n  if (Array.isArray(val)) {\n    return 'array'\n  }\n\n  if (val === null) {\n    return 'null'\n  }\n\n  return typeof val\n}\n","export const ANNOTATION_SYMBOLS = [\n  // [startTag, endTag]\n  ['\\uF050', '\\uF051'],\n  ['\\uF052', '\\uF053'],\n  ['\\uF054', '\\uF055'],\n  ['\\uF056', '\\uF057'],\n  ['\\uF058', '\\uF059'],\n  ['\\uF05A', '\\uF05B'],\n  ['\\uF05C', '\\uF05D'],\n  ['\\uF05F', '\\uF060'],\n  ['\\uF061', '\\uF062'],\n  ['\\uF063', '\\uF064'],\n  ['\\uF065', '\\uF066'],\n  ['\\uF067', '\\uF068'],\n  ['\\uF069', '\\uF06A'],\n  ['\\uF06B', '\\uF06C'],\n  ['\\uF06E', '\\uF06F'],\n  ['\\uF070', '\\uF071'],\n  ['\\uF072', '\\uF073'],\n  ['\\uF074', '\\uF075'],\n  ['\\uF076', '\\uF077'],\n  ['\\uF078', '\\uF079'],\n  ['\\uF07A', '\\uF07B'],\n  ['\\uF07C', '\\uF07D'],\n  ['\\uF07E', '\\uF07F'],\n  ['\\uF080', '\\uF081'],\n  ['\\uF082', '\\uF083'],\n  ['\\uF084', '\\uF085'],\n  ['\\uF086', '\\uF087'],\n  ['\\uF088', '\\uF089'],\n  ['\\uF08A', '\\uF08B'],\n  ['\\uF08C', '\\uF08D'],\n  ['\\uF08E', '\\uF08F'],\n]\n\nexport const CHILD_SYMBOL = '\\uF0D0'\n\nexport const DECORATOR_SYMBOLS = [\n  // [startTag, endTag]\n  ['\\uF000', '\\uF001'],\n  ['\\uF002', '\\uF003'],\n  ['\\uF004', '\\uF005'],\n  ['\\uF006', '\\uF007'],\n  ['\\uF008', '\\uF009'],\n  ['\\uF00A', '\\uF00B'],\n  ['\\uF00C', '\\uF00D'],\n  ['\\uF00F', '\\uF010'],\n  ['\\uF011', '\\uF012'],\n  ['\\uF013', '\\uF014'],\n  ['\\uF015', '\\uF016'],\n  ['\\uF017', '\\uF018'],\n  ['\\uF019', '\\uF01A'],\n  ['\\uF01B', '\\uF01C'],\n  ['\\uF01E', '\\uF01F'],\n  ['\\uF020', '\\uF021'],\n]\n\nexport const EMPTY_BLOCK_SYMBOL = '\\u21B2'\n\nexport const INLINE_SYMBOLS = [\n  '\\uF090',\n  '\\uF091',\n  '\\uF092',\n  '\\uF093',\n  '\\uF094',\n  '\\uF095',\n  '\\uF096',\n  '\\uF097',\n  '\\uF098',\n  '\\uF099',\n  '\\uF09A',\n  '\\uF09B',\n  '\\uF09C',\n  '\\uF09D',\n  '\\uF09E',\n  '\\uF09F',\n  '\\uF0A0',\n  '\\uF0A1',\n  '\\uF0A2',\n  '\\uF0A3',\n  '\\uF0A4',\n  '\\uF0A5',\n  '\\uF0A6',\n  '\\uF0A7',\n  '\\uF0A8',\n  '\\uF0A9',\n  '\\uF0AA',\n  '\\uF0AB',\n  '\\uF0AC',\n  '\\uF0AD',\n  '\\uF0AE',\n  '\\uF0AF',\n  '\\uF0B0',\n  '\\uF0B1',\n  '\\uF0B2',\n  '\\uF0B3',\n  '\\uF0B4',\n  '\\uF0B5',\n  '\\uF0B6',\n  '\\uF0B7',\n  '\\uF0B8',\n  '\\uF0B9',\n  '\\uF0BA',\n  '\\uF0BB',\n  '\\uF0BC',\n  '\\uF0BD',\n  '\\uF0BE',\n  '\\uF0BF',\n]\n\nexport const TRAILING_SPACE_SYMBOL = '\\u205F'\n\nexport const SEGMENT_START_SYMBOL = '\\u2060'\n","import {\n  cleanupEfficiency,\n  DIFF_DELETE,\n  DIFF_EQUAL,\n  DIFF_INSERT,\n  makeDiff,\n} from '@sanity/diff-match-patch'\nimport {\n  type ArraySchemaType,\n  isPortableTextSpan,\n  isPortableTextTextBlock,\n  type ObjectField,\n  type ObjectSchemaType,\n  type PortableTextBlock,\n  type PortableTextChild,\n  type PortableTextObject,\n  type PortableTextTextBlock,\n  type SchemaType,\n  type SpanSchemaType,\n} from '@sanity/types'\nimport {flatten, isEqual, orderBy} from 'lodash'\n\nimport {\n  type ArrayDiff,\n  type DiffComponent,\n  type DiffComponentOptions,\n  type ObjectDiff,\n  type StringDiffSegment,\n} from '../../../types'\nimport * as TextSymbols from './symbols'\nimport {type InlineSymbolMap, type MarkSymbolMap, type PortableTextDiff} from './types'\n\nexport const UNKNOWN_TYPE_NAME = '_UNKOWN_TYPE_'\n\nexport function hasPTMemberType(schemaType: ArraySchemaType): boolean {\n  return schemaType.of.some(isPTSchemaType)\n}\n\nconst startMarkSymbols = TextSymbols.DECORATOR_SYMBOLS.map((set) => set[0]).concat(\n  TextSymbols.ANNOTATION_SYMBOLS.map((set) => set[0]),\n)\nconst endMarkSymbols = TextSymbols.DECORATOR_SYMBOLS.map((set) => set[1]).concat(\n  TextSymbols.ANNOTATION_SYMBOLS.map((set) => set[1]),\n)\nconst allSymbols = startMarkSymbols\n  .concat(endMarkSymbols)\n  .concat(TextSymbols.INLINE_SYMBOLS)\n  .concat(TextSymbols.CHILD_SYMBOL)\n  .concat(TextSymbols.SEGMENT_START_SYMBOL)\nconst symbolRegex = new RegExp(`${allSymbols.join('|')}`, 'g')\nconst segmentRegex = new RegExp(`${allSymbols.join('|')}|\\n`, 'g')\n\ninterface BlockSchemaType extends ObjectSchemaType {\n  diffComponent:\n    | DiffComponent<ObjectDiff<PortableTextBlock>>\n    | DiffComponentOptions<ObjectDiff<PortableTextBlock>>\n}\n\nexport function isPTSchemaType(schemaType: SchemaType): schemaType is BlockSchemaType {\n  return schemaType.jsonType === 'object' && schemaType.name === 'block'\n}\n\nexport function isHeader(node: PortableTextBlock): boolean {\n  return (\n    isPortableTextTextBlock(node) &&\n    !!node.style &&\n    ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].includes(node.style)\n  )\n}\n\nexport function findChildDiff(diff: ObjectDiff, child: PortableTextChild): ObjectDiff {\n  const childrenDiff = diff.fields.children as ArrayDiff\n  return childrenDiff.items\n    .filter(\n      (item: any) =>\n        item.diff.isChanged && (item.diff.toValue === child || item.diff.fromValue === child),\n    )\n    .map((item: any) => item.diff)\n    .map((childDiff: any) => childDiff as ObjectDiff)[0]\n}\n\nexport function getChildSchemaType(\n  fields: ObjectField<SchemaType>[],\n  child: PortableTextChild,\n): ObjectSchemaType | undefined {\n  const childrenField = fields.find((f) => f.name === 'children')\n  const cSchemaType =\n    (childrenField &&\n      childrenField.type &&\n      childrenField.type.jsonType === 'array' &&\n      (childrenField.type.of.find((type) => type.name === child._type) as ObjectSchemaType)) ||\n    undefined\n  return cSchemaType\n}\n\nexport function getDecorators(spanSchemaType: SpanSchemaType): {title: string; value: string}[] {\n  if (spanSchemaType.decorators) {\n    return orderBy(spanSchemaType.decorators, ['value'], ['asc'])\n  }\n  return []\n}\n\nexport function getAnnotations(spanSchemaType: SpanSchemaType): ObjectSchemaType[] {\n  if (spanSchemaType.annotations) {\n    return orderBy(spanSchemaType.annotations, ['name'], ['asc'])\n  }\n  return []\n}\n\nexport function isDecorator(name: string, schemaType: SpanSchemaType): boolean {\n  return getDecorators(schemaType).some((dec) => dec.value === name)\n}\n\nexport function blockToSymbolizedText(\n  diff: ObjectDiff,\n  block: PortableTextTextBlock | undefined,\n  decoratorMap: MarkSymbolMap,\n  annotationMap: MarkSymbolMap,\n  inlineMap: InlineSymbolMap,\n): string {\n  if (!block) {\n    return ''\n  }\n  return block.children\n    .map((child) => {\n      let returned = isPortableTextSpan(child) ? child.text?.replace(symbolRegex, '') : '' // Make sure symbols aren't in the text already\n      if (isPortableTextSpan(child)) {\n        // Attatch stringdiff segments\n        const spanDiff = findSpanDiffFromChild(diff, child)\n        const textDiff = spanDiff?.fields.text\n        if (\n          textDiff &&\n          textDiff.toValue === child.text &&\n          textDiff.type === 'string' &&\n          textDiff.action !== 'unchanged'\n        ) {\n          returned = textDiff.segments\n            .filter((seg) => seg.action !== 'removed')\n            .map((seg) => seg.text.replace(symbolRegex, ''))\n            .join(TextSymbols.SEGMENT_START_SYMBOL)\n        }\n        if (child.marks) {\n          child.marks.forEach((mark) => {\n            const _isDecorator = !!decoratorMap[mark]\n            if (_isDecorator) {\n              returned = `${decoratorMap[mark][0]}${returned}${decoratorMap[mark][1]}`\n            } else if (annotationMap[mark]) {\n              returned = `${annotationMap[mark][0]}${returned}${annotationMap[mark][1]}`\n            }\n          })\n        }\n      } else {\n        returned = inlineMap[child._key]\n      }\n      return `${TextSymbols.CHILD_SYMBOL}${returned}`\n    })\n    .join('')\n}\n\nexport function createPortableTextDiff(\n  diff: ObjectDiff,\n  schemaType: ObjectSchemaType,\n): PortableTextDiff {\n  const displayValue =\n    diff.action === 'removed'\n      ? (diff.fromValue as PortableTextTextBlock)\n      : (diff.toValue as PortableTextTextBlock)\n  const _diff: PortableTextDiff = {\n    ...diff,\n    origin: diff,\n    displayValue,\n  }\n\n  if (displayValue) {\n    const annotationMap: MarkSymbolMap = {}\n    const decoratorMap: MarkSymbolMap = {}\n    const inlineMap: InlineSymbolMap = {}\n    const spanSchemaType = getChildSchemaType(schemaType.fields, {\n      _key: 'bogus',\n      _type: 'span',\n    }) as SpanSchemaType\n    if (spanSchemaType) {\n      getDecorators(spanSchemaType).forEach((dec, index) => {\n        decoratorMap[dec.value] = TextSymbols.DECORATOR_SYMBOLS[index]\n      })\n    }\n    const allMarkDefs = getAllMarkDefs(_diff.origin)\n    allMarkDefs.forEach((markDef, index) => {\n      annotationMap[markDef._key] = TextSymbols.ANNOTATION_SYMBOLS[index]\n    })\n    const inlines = getInlineObjects(_diff.origin)\n    inlines.forEach((inline, index) => {\n      inlineMap[inline._key] = TextSymbols.INLINE_SYMBOLS[index]\n    })\n    const fromText = blockToSymbolizedText(\n      _diff.origin,\n      _diff.fromValue as PortableTextTextBlock,\n      decoratorMap,\n      annotationMap,\n      inlineMap,\n    )\n    const toText = blockToSymbolizedText(\n      _diff.origin,\n      _diff.toValue as PortableTextTextBlock,\n      decoratorMap,\n      annotationMap,\n      inlineMap,\n    )\n    const toPseudoValue = {\n      ...displayValue,\n      children: [\n        {\n          _type: 'span',\n          _key: 'pseudoSpanKey',\n          text: toText,\n          marks: [],\n        },\n      ],\n    }\n    const fromPseudoValue = {\n      displayValue,\n      children: [\n        {\n          _type: 'span',\n          _key: 'pseudoSpanKey',\n          text: fromText,\n          marks: [],\n        },\n      ],\n    }\n    const pseudoDiff = {\n      origin: diff,\n      action: 'changed',\n      type: 'object',\n      displayValue: toPseudoValue,\n      fromValue: fromPseudoValue,\n      toValue: toPseudoValue,\n      isChanged: true,\n      fields: {\n        children: {\n          action: 'changed',\n          type: 'array',\n          isChanged: true,\n          items: [\n            {\n              diff: {\n                action: 'changed',\n                type: 'object',\n                isChanged: true,\n                fields: {\n                  text: {\n                    type: 'string',\n                    action: 'changed',\n                    isChanged: true,\n                    fromValue: fromText,\n                    toValue: toText,\n                    segments: buildSegments(fromText, toText).map((seg) => ({\n                      ...seg,\n                      ...(_diff.action !== 'unchanged' && _diff.annotation\n                        ? {annotation: _diff.annotation} // Fallback if we can't find a spesific original diff\n                        : {}),\n                    })),\n                  },\n                },\n                fromValue: fromPseudoValue.children[0],\n                toValue: toPseudoValue.children[0],\n              },\n              annotation: null,\n              fromIndex: 0,\n              toIndex: 0,\n              hasMoved: false,\n            },\n          ],\n          fromValue: fromPseudoValue.children,\n          toValue: toPseudoValue.children,\n        },\n      },\n    }\n    return pseudoDiff as PortableTextDiff\n  }\n  throw new Error('Can not display this diff')\n}\n\nfunction buildSegments(fromInput: string, toInput: string): StringDiffSegment[] {\n  const segments: StringDiffSegment[] = []\n  const dmpDiffs = cleanupEfficiency(makeDiff(fromInput, toInput))\n\n  let fromIdx = 0\n  let toIdx = 0\n  for (const [op, text] of dmpDiffs) {\n    switch (op) {\n      case DIFF_EQUAL:\n        segments.push({\n          type: 'stringSegment',\n          action: 'unchanged',\n          text,\n        })\n        fromIdx += text.length\n        toIdx += text.length\n        break\n      case DIFF_DELETE:\n        segments.push({\n          type: 'stringSegment',\n          action: 'removed',\n          text: fromInput.substring(fromIdx, fromIdx + text.length),\n          annotation: null,\n        })\n        fromIdx += text.length\n        break\n      case DIFF_INSERT:\n        segments.push({\n          type: 'stringSegment',\n          action: 'added',\n          text: toInput.substring(toIdx, toIdx + text.length),\n          annotation: null,\n        })\n        toIdx += text.length\n        break\n      default:\n      // Do nothing\n    }\n  }\n  // Clean up so that marks / symbols are treated as an own segment\n  return flatten(\n    segments.map((seg) => {\n      const newSegments: StringDiffSegment[] = []\n      if (seg.text.length > 1) {\n        const markMatches = [...seg.text.matchAll(segmentRegex)]\n        let lastIndex = -1\n        markMatches.forEach((match) => {\n          const index = match.index || 0\n          if (index > lastIndex) {\n            newSegments.push({...seg, text: seg.text.substring(lastIndex + 1, index)})\n            newSegments.push({...seg, text: match[0]})\n          }\n          if (match === markMatches[markMatches.length - 1]) {\n            newSegments.push({...seg, text: seg.text.substring(index + 1)})\n          }\n          lastIndex = index\n        })\n        if (markMatches.length === 0) {\n          newSegments.push(seg)\n        }\n      } else {\n        newSegments.push(seg)\n      }\n      return newSegments\n    }),\n  )\n}\n\nexport function getInlineObjects(diff: ObjectDiff): PortableTextObject[] {\n  const allChildren = [\n    ...(diff.toValue ? diff.toValue.children.filter((cld: any) => cld._type !== 'span') : []),\n  ]\n  const previousChildren = diff.fromValue\n    ? diff.fromValue.children.filter((cld: any) => cld._type !== 'span')\n    : []\n  previousChildren.forEach((oCld: any) => {\n    if (!allChildren.some((cld) => oCld._key === cld._key)) {\n      allChildren.push(oCld)\n    }\n  })\n  return orderBy(allChildren, ['_key'], ['asc']) as PortableTextObject[]\n}\n\nexport function findSpanDiffFromChild(\n  diff: ObjectDiff,\n  child: PortableTextChild,\n): ObjectDiff | undefined {\n  // Find span in original diff which has a string segment similar to the one from the input\n  const candidate =\n    diff.fields.children &&\n    diff.fields.children.action !== 'unchanged' &&\n    diff.fields.children.type === 'array' &&\n    diff.fields.children.items.find(\n      (item: any) =>\n        item.diff &&\n        item.diff.type === 'object' &&\n        (item.diff.action === 'removed'\n          ? item.diff.fromValue && item.diff.fromValue._key === child._key\n          : (item.diff.toValue && item.diff.toValue._key) === child._key),\n    )\n  if (candidate) {\n    return candidate.diff as ObjectDiff\n  }\n  return undefined\n}\n\nexport function findAnnotationDiff(diff: ObjectDiff, markDefKey: string): ObjectDiff | undefined {\n  return (\n    ((diff.fields.markDefs &&\n      diff.fields.markDefs.isChanged &&\n      diff.fields.markDefs.type === 'array' &&\n      diff.fields.markDefs.items.find(\n        (item: any) =>\n          item.diff &&\n          item.diff.type === 'object' &&\n          ((item.diff.toValue && item.diff.toValue._key && item.diff.toValue._key === markDefKey) ||\n            (item.diff.fromValue &&\n              item.diff.fromValue._key &&\n              item.diff.fromValue._key === markDefKey)),\n      )?.diff) as ObjectDiff) || undefined\n  )\n}\n\nexport function isEmptyObject(object: PortableTextChild): boolean {\n  return (object && isEqual(Object.keys(object), ['_key', '_type'])) || false\n}\n\nexport function escapeRegExp(text: string): string {\n  return text.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&')\n}\n\nexport function getAllMarkDefs(diff: ObjectDiff): PortableTextChild[] {\n  const allDefs: PortableTextChild[] = [\n    ...(diff.toValue && diff.toValue.markDefs ? diff.toValue.markDefs : []),\n  ]\n  const oldDefs: PortableTextChild[] =\n    diff.fromValue && diff.fromValue.markDefs ? diff.fromValue.markDefs : []\n  oldDefs.forEach((oDef) => {\n    if (!allDefs.some((def) => oDef._key === def._key)) {\n      allDefs.push(oDef)\n    }\n  })\n  return orderBy(allDefs, ['_key'], ['asc'])\n}\n","/**\n * Gets the human-friendly printable type name for the given value, for instance it will yield\n * `array` instead of `object`, as the native `typeof` operator would do. Can be extended to\n * account for other types, such as React components, fragments, elements etc, and should thus\n * not be counted as \"exhaustive\", as the list is both dynamic and will grow over time.\n *\n * @param value - The value to get the type name for\n * @returns A \"human friendly\" type name\n * @internal\n */\nexport function getPrintableType(value: unknown): string {\n  const nativeType = typeof value\n\n  if (nativeType === 'object') {\n    if (value === null) return 'null'\n    if (Array.isArray(value)) return 'array'\n    if (value instanceof Object && value.constructor.name !== 'Object') {\n      return value.constructor.name\n    }\n  }\n\n  return nativeType\n}\n","import {type ObjectSchemaType, type SchemaType} from '@sanity/types'\n\nimport {type StudioLocaleResourceKeys} from '../../i18n'\nimport {getPrintableType} from '../../util/getPrintableType'\n\n/** @internal */\nexport interface FieldValueError {\n  /**\n   * i18n key for the error message\n   */\n  messageKey: StudioLocaleResourceKeys\n\n  /**\n   * The expected type of the value\n   */\n  expectedType: string\n\n  /**\n   * The actual type of the value\n   */\n  actualType: string\n\n  /**\n   * The actual value of the field\n   */\n  value: unknown\n}\n\n/** @internal */\nexport function getValueError(value: unknown, schemaType: SchemaType): FieldValueError | undefined {\n  const {jsonType} = schemaType\n  const valueType = Array.isArray(value) ? 'array' : typeof value\n\n  if (value === null || valueType === 'undefined') {\n    return undefined\n  }\n\n  if (valueType !== jsonType) {\n    return {\n      messageKey: 'changes.error.incorrect-type-message',\n      value,\n      expectedType: jsonType,\n      actualType: getPrintableType(value),\n    }\n  }\n\n  if (isObjectType(schemaType) && isObjectValue(value)) {\n    for (const field of schemaType.fields) {\n      const fieldError = getValueError(value[field.name], field.type as SchemaType)\n      if (fieldError) {\n        return fieldError\n      }\n    }\n  }\n\n  return undefined\n}\n\nfunction isObjectType(schemaType: SchemaType): schemaType is ObjectSchemaType {\n  return schemaType.jsonType === 'object'\n}\n\nfunction isObjectValue(value: unknown): value is Record<string, unknown> {\n  return value !== null && !Array.isArray(value) && typeof value === 'object'\n}\n","import {\n  type ChangeNode,\n  type Diff,\n  type FieldChangeNode,\n  type GroupChangeNode,\n  type ItemDiff,\n} from '../types'\n\n/** @internal */\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nexport function noop(): void {}\n\n/** @internal */\nexport function isFieldChange(change: ChangeNode): change is FieldChangeNode {\n  return change.type === 'field'\n}\n\n/** @internal */\nexport function isGroupChange(change: ChangeNode): change is GroupChangeNode {\n  return change.type === 'group'\n}\n\n/** @internal */\nexport function isAddedItemDiff(\n  item: ItemDiff,\n): item is ItemDiff & {diff: Diff & {action: 'added'}} {\n  return item.diff.action === 'added'\n}\n\n/** @internal */\nexport function isRemovedItemDiff(\n  item: ItemDiff,\n): item is ItemDiff & {diff: Diff & {action: 'removed'}} {\n  return item.diff.action === 'removed'\n}\n\n/** @internal */\nexport function isUnchangedDiff(diff: Diff): diff is Diff & {action: 'unchanged'} {\n  return diff.action === 'unchanged'\n}\n","import {type DiffComponentResolver} from './types'\n\n// import diffResolvers from 'all:part:@sanity/base/diff-resolver'\nexport const diffResolvers: DiffComponentResolver[] = []\n","import {type UserColor} from '../../../../user-color'\nimport {type FieldPreviewComponent} from '../../../preview'\n\ntype BooleanProps = {\n  checked: boolean | undefined | null\n  color?: UserColor\n}\n\nexport const BooleanPreview: FieldPreviewComponent<boolean> = function BooleanPreview({\n  value,\n  schemaType,\n  color,\n}) {\n  const Preview = schemaType.options?.layout === 'checkbox' ? Checkbox : Switch\n  return <Preview checked={value} color={color} />\n}\n\nexport function Checkbox({checked, color}: BooleanProps) {\n  return (\n    <svg\n      width=\"17\"\n      height=\"17\"\n      viewBox=\"0 0 17 17\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill={color?.background}\n    >\n      <rect x=\"0\" y=\"0\" width=\"17\" height=\"17\" rx=\"2.5\" />\n      {typeof checked === 'undefined' && (\n        <path d=\"M4.07996 8.5H12.92\" stroke={color?.text} strokeWidth=\"2\" />\n      )}\n      {checked && <path d=\"M3.5 8L7 11.5L13.5 5\" stroke={color?.text} strokeWidth=\"2\" />}\n    </svg>\n  )\n}\n\nexport function Switch({checked, color}: BooleanProps) {\n  return (\n    <svg width=\"38\" height=\"22\" viewBox=\"0 0 38 22\" xmlns=\"http://www.w3.org/2000/svg\">\n      <rect width=\"38\" height=\"22\" rx=\"11\" fill={checked ? color?.border : color?.background} />\n      {typeof checked === 'undefined' && (\n        <rect x=\"11\" y=\"3\" width=\"16\" height=\"16\" rx=\"8\" fill=\"white\" />\n      )}\n      {checked && <rect x=\"18\" y=\"3\" width=\"16\" height=\"16\" rx=\"8\" fill=\"white\" />}\n      {typeof checked === 'boolean' && !checked && (\n        <rect x=\"4\" y=\"3\" width=\"16\" height=\"16\" rx=\"8\" fill=\"white\" />\n      )}\n    </svg>\n  )\n}\n","import {Box, Flex, Text} from '@sanity/ui'\n\nimport {DiffTooltip, FromToArrow, useDiffAnnotationColor} from '../../../diff'\nimport {type BooleanDiff, type DiffComponent} from '../../../types'\nimport {Checkbox, Switch} from '../preview'\n\nexport const BooleanFieldDiff: DiffComponent<BooleanDiff> = ({diff, schemaType}) => {\n  const {fromValue, toValue} = diff\n  const {title, options} = schemaType\n  const Preview = options?.layout === 'checkbox' ? Checkbox : Switch\n  const userColor = useDiffAnnotationColor(diff, [])\n\n  const showToValue = toValue !== undefined && toValue !== null\n\n  return (\n    <Flex align=\"center\">\n      <DiffTooltip diff={diff}>\n        <Flex align=\"center\">\n          <Preview checked={fromValue} color={userColor} />\n\n          {showToValue && (\n            <>\n              <Box marginX={2}>\n                <FromToArrow />\n              </Box>\n              <Preview checked={toValue} color={userColor} />\n            </>\n          )}\n        </Flex>\n      </DiffTooltip>\n\n      {showToValue && title && (\n        <Box marginLeft={2}>\n          <Text size={1} weight=\"medium\">\n            {title}\n          </Text>\n        </Box>\n      )}\n    </Flex>\n  )\n}\n","import {type StringSchemaType} from '@sanity/types'\nimport {Box} from '@sanity/ui'\nimport * as legacyDateFormat from '@sanity/util/legacyDateFormat'\nimport styled from 'styled-components'\n\nimport {type FieldPreviewComponent} from '../../../preview'\n\nconst DatetimeWrapper = styled.div`\n  display: inline-block;\n  word-wrap: break-word;\n`\n\nexport const DatetimePreview: FieldPreviewComponent<string> = function DatetimePreview({\n  value,\n  schemaType,\n}) {\n  return (\n    <Box as={DatetimeWrapper} paddingX={2} paddingY={1}>\n      {formatDateTime(value, schemaType)}\n    </Box>\n  )\n}\n\nfunction formatDateTime(value: string, schemaType: StringSchemaType): string {\n  const {options, name} = schemaType\n  const dateFormat = options?.dateFormat || legacyDateFormat.DEFAULT_DATE_FORMAT\n  const timeFormat = options?.timeFormat || legacyDateFormat.DEFAULT_TIME_FORMAT\n\n  return legacyDateFormat.format(\n    new Date(value),\n    name === 'date' ? dateFormat : `${dateFormat} ${timeFormat}`,\n  )\n}\n","import {DiffFromTo} from '../../../diff'\nimport {type DiffComponent, type StringDiff} from '../../../types'\nimport {DatetimePreview} from '../preview'\n\nexport const DatetimeFieldDiff: DiffComponent<StringDiff> = ({diff, schemaType}) => {\n  return (\n    <DiffFromTo\n      align=\"center\"\n      diff={diff}\n      layout=\"grid\"\n      previewComponent={DatetimePreview}\n      schemaType={schemaType}\n    />\n  )\n}\n","import {type Path, type SanityDocument, type SchemaType} from '@sanity/types'\nimport {type ComponentType, createContext, type ReactNode} from 'react'\n\nimport {type ObjectDiff} from '../../types'\n\n/** @internal */\nexport type DocumentChangeContextInstance = {\n  documentId: string\n  schemaType: SchemaType\n  rootDiff: ObjectDiff | null\n  isComparingCurrent: boolean\n  FieldWrapper: ComponentType<{path: Path; children: ReactNode; hasHover: boolean}>\n  value: Partial<SanityDocument>\n}\n\n/** @internal */\nexport const DocumentChangeContext = createContext<DocumentChangeContextInstance | null>(null)\n","import {useContext} from 'react'\n\nimport {\n  DocumentChangeContext,\n  type DocumentChangeContextInstance,\n} from '../contexts/DocumentChangeContext'\n\n/** @internal */\nexport function useDocumentChange(): DocumentChangeContextInstance {\n  const documentChange = useContext(DocumentChangeContext)\n\n  if (!documentChange) {\n    throw new Error('DocumentChange: missing context value')\n  }\n\n  return documentChange\n}\n","import {useEffect, useState} from 'react'\n\nimport {useClient} from '../../../hooks'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../studioClient'\n\nexport function useRefValue<T extends Record<string, any> = Record<string, any>>(\n  refId: string | undefined | null,\n): T | undefined {\n  const [value, setValue] = useState<T | undefined>(undefined)\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n\n  useEffect(() => {\n    if (!refId) {\n      return undefined\n    }\n\n    const subscription = client.observable.getDocument<T>(refId).subscribe(setValue)\n\n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [client, refId])\n\n  // Always return undefined in the case of a falsey ref to prevent bug\n  // when going from an ID to an undefined state\n  return refId ? value : undefined\n}\n","import {DocumentIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Text} from '@sanity/ui'\nimport {useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {useUnitFormatter} from '../../../../hooks'\nimport {useTranslation} from '../../../../i18n'\nimport {ChangeList, DiffCard, DiffTooltip, FromTo, MetaInfo} from '../../../diff'\nimport {useRefValue} from '../../../diff/hooks'\nimport {type DiffComponent, type ObjectDiff} from '../../../types'\nimport {getHumanFriendlyBytes, getSizeDiff} from './helpers'\nimport {type File, type FileAsset} from './types'\n\nconst SizeDiff = styled.div`\n  ${({theme}) => `\n    --size-diff-positive: ${theme.sanity.color.solid.positive.enabled.bg};\n    --size-diff-negative: ${theme.sanity.color.solid.critical.enabled.bg};\n  `}\n  &:not([hidden]) {\n    display: inline-block;\n  }\n\n  [data-number='positive'] {\n    color: var(--size-diff-positive);\n  }\n\n  [data-number='negative'] {\n    color: var(--size-diff-negative);\n  }\n`\n\nexport const FileFieldDiff: DiffComponent<ObjectDiff<File>> = ({diff, schemaType}) => {\n  const {fromValue, toValue, fields} = diff\n  const fromAsset = fromValue?.asset\n  const toAsset = toValue?.asset\n  const {t} = useTranslation()\n  const prev = useRefValue<FileAsset>(fromAsset?._ref)\n  const next = useRefValue<FileAsset>(toAsset?._ref)\n  const formatUnit = useUnitFormatter({unitDisplay: 'short', maximumFractionDigits: 2})\n\n  const changedFields = Object.entries(fields)\n    .filter(([name, field]) => field.isChanged && name !== '_type')\n    .map(([name]) => name)\n\n  const didAssetChange = changedFields.includes('asset')\n\n  const nestedFields = schemaType.fields\n    .filter((field) => field.name !== 'asset' && changedFields.includes(field.name))\n    .map((field) => field.name)\n\n  const pctDiff = getSizeDiff(prev?.size, next?.size)\n  const prevSize = prev?.size && getHumanFriendlyBytes(prev.size, formatUnit)\n  const nextSize = next?.size && getHumanFriendlyBytes(next.size, formatUnit)\n\n  const cardStyles = useMemo(() => ({display: 'block', flex: 1}), [])\n\n  const from = prev && (\n    <DiffCard as=\"del\" diff={diff} path=\"asset._ref\" style={cardStyles}>\n      <MetaInfo\n        title={prev.originalFilename || t('changes.file.meta-info-fallback-title')}\n        icon={DocumentIcon}\n      >\n        <Text size={0} style={{color: 'inherit'}}>\n          {prevSize}\n        </Text>\n      </MetaInfo>\n    </DiffCard>\n  )\n\n  const to = next && (\n    <DiffCard as=\"ins\" diff={diff} path=\"asset._ref\" style={cardStyles}>\n      <MetaInfo\n        title={next.originalFilename || t('changes.file.meta-info-fallback-title')}\n        icon={DocumentIcon}\n      >\n        <Flex align=\"center\">\n          <Text size={0} style={{color: 'inherit'}}>\n            {nextSize}\n          </Text>\n          {pctDiff !== 0 && (\n            <Card radius={2} padding={1} as={SizeDiff} marginLeft={2}>\n              <Text size={0} data-number={pctDiff > 0 ? 'positive' : 'negative'}>\n                {pctDiff > 0 ? '+' : '-'}\n                {pctDiff}%\n              </Text>\n            </Card>\n          )}\n        </Flex>\n      </MetaInfo>\n    </DiffCard>\n  )\n\n  const FileAssetChange = (\n    <>\n      {/* Removed only */}\n      {from && !to && (\n        <DiffTooltip diff={diff} path=\"asset._ref\" description={t('changes.removed-label')}>\n          {from}\n        </DiffTooltip>\n      )}\n\n      {/* Removed and added */}\n      {from && to && (\n        <DiffTooltip diff={diff} path=\"asset._ref\">\n          <FromTo from={from} layout=\"grid\" to={to} />\n        </DiffTooltip>\n      )}\n\n      {/* Added only */}\n      {!from && to && (\n        <DiffTooltip diff={diff} path=\"asset._ref\" description={t('changes.added-label')}>\n          {to}\n        </DiffTooltip>\n      )}\n    </>\n  )\n\n  return (\n    <>\n      {didAssetChange && FileAssetChange}\n      {nestedFields.length > 0 && (\n        <Box marginTop={didAssetChange ? 4 : 3}>\n          <ChangeList diff={diff} schemaType={schemaType} fields={nestedFields} />\n        </Box>\n      )}\n    </>\n  )\n}\n","// @todo: use `polished` for this?\nexport function hexToRgba(hex: string, opacity: number): string {\n  const rgba = (/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex) || ([] as string[]))\n    .slice(1)\n    .map((num) => parseInt(num, 16))\n    .concat(opacity)\n  return `rgba(${rgba.join(', ')})`\n}\n\n// @todo: replace this\nexport function simpleHash(str: string): string {\n  let hash = 0\n\n  if (str.length == 0) {\n    return hash.toString()\n  }\n\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i)\n\n    // eslint-disable-next-line no-bitwise\n    hash = (hash << 5) - hash + char\n\n    // eslint-disable-next-line no-bitwise\n    hash &= hash // Convert to 32bit integer\n  }\n\n  return hash.toString()\n}\n\nexport function getDeviceDpr(): number {\n  const base = Math.ceil(window.devicePixelRatio || 1)\n  return Math.min(3, Math.max(1, base))\n}\n","import {type Image, type ImageCrop, type ImageHotspot} from '@sanity/types'\nimport {type SVGProps} from 'react'\n\nimport {useTranslation} from '../../../../i18n'\nimport {DiffTooltip, useDiffAnnotationColor} from '../../../diff'\nimport {type ObjectDiff} from '../../../types'\nimport {hexToRgba} from './helpers'\n\ninterface HotspotCropSVGProps {\n  crop?: ImageCrop\n  diff: ObjectDiff<Image>\n  hash: string\n  hotspot?: ImageHotspot\n  width?: number\n  height?: number\n}\n\nexport function HotspotCropSVG(\n  props: HotspotCropSVGProps & Omit<SVGProps<SVGElement>, 'ref' | 'width' | 'height'>,\n) {\n  const {crop, diff, hash, hotspot, width = 100, height = 100, ...restProps} = props\n  const {t} = useTranslation()\n  const cropColor = useDiffAnnotationColor(diff, 'crop')\n  const hotspotColor = useDiffAnnotationColor(diff, 'hotspot')\n\n  return (\n    <svg\n      {...restProps}\n      fill=\"none\"\n      width={width}\n      height={height}\n      viewBox={`0 0 ${width} ${height}`}\n    >\n      <defs>\n        {crop && hotspot && (\n          <mask id={`mask-hotspot-${hash}`}>\n            <rect x={0} y={0} width={width} height={height} fill=\"#fff\" />\n            <HotspotSVG\n              hotspot={hotspot}\n              fill=\"#000\"\n              offset={1}\n              width={width}\n              height={height}\n              stroke=\"#000\"\n              strokeWidth={3}\n            />\n          </mask>\n        )}\n      </defs>\n\n      {crop && (\n        <DiffTooltip diff={diff} path=\"crop\" description={t('changes.image.crop-changed')}>\n          <g>\n            <CropSVG\n              crop={crop}\n              fill={hexToRgba(cropColor.border, 0.25)}\n              mask={hotspot ? `url(#mask-hotspot-${hash})` : undefined}\n              stroke={cropColor.border}\n              strokeWidth={1}\n              width={width}\n              height={height}\n            />\n          </g>\n        </DiffTooltip>\n      )}\n\n      {hotspot && (\n        <DiffTooltip diff={diff} path=\"hotspot\" description={t('changes.image.crop-changed')}>\n          <g>\n            <HotspotSVG\n              hotspot={hotspot}\n              fill={hexToRgba(hotspotColor.border, 0.25)}\n              stroke={hotspotColor.border}\n              strokeWidth={1}\n              width={width}\n              height={height}\n            />\n          </g>\n        </DiffTooltip>\n      )}\n    </svg>\n  )\n}\n\nfunction CropSVG({\n  crop,\n  width,\n  height,\n  ...restProps\n}: {crop: ImageCrop; width: number; height: number} & Omit<\n  SVGProps<SVGRectElement>,\n  'width' | 'height'\n>) {\n  const rectProps = {\n    x: crop.left * width,\n    y: crop.top * height,\n    width: (1 - crop.right - crop.left) * width,\n    height: (1 - crop.bottom - crop.top) * height,\n  }\n\n  return <rect {...restProps} {...rectProps} style={{vectorEffect: 'non-scaling-stroke'}} />\n}\n\nfunction HotspotSVG({\n  hotspot,\n  offset = 0,\n  width,\n  height,\n  ...restProps\n}: {hotspot: ImageHotspot; offset?: number; width: number; height: number} & Omit<\n  SVGProps<SVGEllipseElement>,\n  'width' | 'height'\n>) {\n  const ellipseProps = {\n    cx: hotspot.x * width,\n    cy: hotspot.y * height,\n    rx: (hotspot.width / 2) * width + offset,\n    ry: (hotspot.height / 2) * height + offset,\n  }\n\n  return <ellipse {...restProps} {...ellipseProps} style={{vectorEffect: 'non-scaling-stroke'}} />\n}\n","import {getImageDimensions, isDefaultCrop, isDefaultHotspot} from '@sanity/asset-utils'\nimport {hues} from '@sanity/color'\nimport {ImageIcon} from '@sanity/icons'\nimport imageUrlBuilder from '@sanity/image-url'\nimport {Box, Card, Flex, Text} from '@sanity/ui'\nimport {type ReactElement, type SyntheticEvent, useMemo, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {useClient} from '../../../../hooks'\nimport {useTranslation} from '../../../../i18n'\nimport {useDocumentValues} from '../../../../store'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../studioClient'\nimport {MetaInfo} from '../../../diff'\nimport {getDeviceDpr, simpleHash} from './helpers'\nimport {HotspotCropSVG} from './HotspotCropSVG'\nimport {type ImagePreviewProps, type MinimalAsset} from './types'\n\nconst ASSET_FIELDS = ['originalFilename']\n\n// To trigger error state, change `src` attribute to random string (\"foo\")\n// To trigger slow loading, use a throttling proxy (charles) or browser devtools\n\n// To trigger deleted state, set `id` to valid, non-existant image asset ID,\n// eg: 'image-1217bc35db5030739b7be571c79d3c401551911d-300x200-png'\n\nexport const NoImagePreview = () => {\n  const {t} = useTranslation()\n  return (\n    <Card flex={1} tone=\"transparent\" padding={4} radius={2} height=\"stretch\">\n      <Flex align=\"center\" justify=\"center\" height=\"fill\">\n        <Text size={1} muted>\n          {t('changes.image.no-image-placeholder')}\n        </Text>\n      </Flex>\n    </Card>\n  )\n}\n\nconst ImageWrapper = styled.div`\n  height: 100%;\n  max-height: 190px;\n  position: relative;\n\n  /* Ideally the checkerboard component currently in the form builder should be made available and used here */\n  background-color: ${hues.gray[100].hex};\n  background-image: linear-gradient(45deg, ${hues.gray[50].hex} 25%, transparent 25%),\n    linear-gradient(-45deg, ${hues.gray[50].hex} 25%, transparent 25%),\n    linear-gradient(45deg, transparent 75%, ${hues.gray[50].hex} 75%),\n    linear-gradient(-45deg, transparent 75%, ${hues.gray[50].hex} 75%);\n  background-size: 16px 16px;\n  background-position:\n    0 0,\n    0 8px,\n    8px -8px,\n    -8px 0;\n\n  &::after {\n    content: '';\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    box-shadow: inset 0 0 0 1px var(--card-border-color);\n    pointer-events: none;\n  }\n\n  &[data-changed] {\n    opacity: 0.45;\n  }\n`\n\nconst Image = styled.img`\n  display: block;\n  flex: 1;\n  min-height: 0;\n  object-fit: contain;\n  width: 100%;\n  height: 100%;\n\n  &[data-action='removed'] {\n    opacity: 0.45;\n  }\n`\n\nconst HotspotDiff = styled.div`\n  svg {\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n  }\n`\n\nexport function ImagePreview(props: ImagePreviewProps): ReactElement {\n  const {id, action, diff, hotspot, crop, is} = props\n  const {t} = useTranslation()\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const [imageError, setImageError] = useState<SyntheticEvent<HTMLImageElement, Event>>()\n  const {value: asset} = useDocumentValues<MinimalAsset>(id, ASSET_FIELDS)\n  const dimensions = getImageDimensions(id)\n  const imageBuilder = useMemo(() => imageUrlBuilder(client), [client])\n\n  // undefined = still loading, null = its gone\n  const assetIsDeleted = asset === null\n\n  const title = asset && asset.originalFilename\n  const imageSource = imageBuilder\n    .image(id)\n    .height(190) // Should match container max-height\n    .dpr(getDeviceDpr())\n    .fit('max')\n\n  const assetChanged = diff.fromValue?.asset?._ref !== diff.toValue?.asset?._ref\n\n  let printAction\n  if (action && action !== 'changed') {\n    printAction = t(action === 'added' ? 'changes.added-label' : 'changes.removed-label')\n  }\n\n  const metaAction = action === 'changed' ? undefined : action\n\n  return (\n    <Flex direction=\"column\" height=\"fill\" flex={1}>\n      <Box flex={1} padding={2} paddingBottom={0}>\n        <Flex\n          as={ImageWrapper}\n          direction=\"column\"\n          data-changed={is === 'from' && assetChanged ? '' : undefined}\n          data-error={imageError ? '' : undefined}\n        >\n          {!assetIsDeleted && !imageError && (\n            <Image\n              src={imageSource.toString() || ''}\n              alt={title}\n              data-action={metaAction}\n              onError={setImageError}\n              width={dimensions.width}\n              height={dimensions.height}\n            />\n          )}\n\n          {(assetIsDeleted || imageError) && (\n            <Box paddingY={5}>\n              <Text size={1} muted align=\"center\">\n                {t(assetIsDeleted ? 'changes.image.deleted' : 'changes.image.error-loading-image')}\n              </Text>\n            </Box>\n          )}\n\n          <HotspotDiff>\n            <HotspotCropSVG\n              crop={crop && !isDefaultCrop(crop) ? crop : undefined}\n              diff={diff}\n              hash={simpleHash(`${imageSource.toString() || ''}-${is}`)}\n              hotspot={hotspot && !isDefaultHotspot(hotspot) ? hotspot : undefined}\n              width={dimensions.width}\n              height={dimensions.height}\n            />\n          </HotspotDiff>\n        </Flex>\n      </Box>\n\n      <MetaInfo\n        title={title || t('changes.image.meta-info-fallback-title')}\n        icon={ImageIcon}\n        markRemoved={assetChanged && is === 'from'}\n      >\n        {printAction ? (\n          <div>{printAction}</div>\n        ) : (\n          <div>\n            {dimensions.width}  {dimensions.height}\n          </div>\n        )}\n      </MetaInfo>\n    </Flex>\n  )\n}\n","import {type Image} from '@sanity/types'\nimport {Box, Card, Text} from '@sanity/ui'\n\nimport {type TFunction, useTranslation} from '../../../../i18n'\nimport {ChangeList, DiffCard, DiffTooltip, getAnnotationAtPath} from '../../../diff'\nimport {FromTo} from '../../../diff/components'\nimport {type DiffComponent, type ObjectDiff} from '../../../types'\nimport {ImagePreview, NoImagePreview} from './ImagePreview'\n\nconst IMAGE_META_FIELDS = ['crop', 'hotspot']\nconst BASE_IMAGE_FIELDS = ['asset', ...IMAGE_META_FIELDS]\n\nconst CARD_STYLES = {\n  flex: 1,\n}\n\nexport const ImageFieldDiff: DiffComponent<ObjectDiff<Image>> = ({diff, schemaType}) => {\n  const {t} = useTranslation()\n\n  const {fromValue, toValue, fields, isChanged} = diff\n  const fromRef = fromValue?.asset?._ref\n  const toRef = toValue?.asset?._ref\n  const assetAnnotation = getAnnotationAtPath(diff, ['asset', '_ref'])\n\n  // Get all the changed fields within this image field\n  const changedFields = Object.keys(fields).filter(\n    (name) => fields[name].isChanged && name !== '_type',\n  )\n\n  const nestedFields = schemaType.fields\n    .filter(\n      (field) => !BASE_IMAGE_FIELDS.includes(field.name) && changedFields.includes(field.name),\n    )\n    .map((field) => field.name)\n\n  let assetAction: 'changed' | 'added' | 'removed' = 'changed'\n  if (!fromRef && toRef) {\n    assetAction = 'added'\n  } else if (!toRef && fromRef) {\n    assetAction = 'removed'\n  }\n\n  const didAssetChange = changedFields.includes('asset')\n  const didCropChange = changedFields.includes('crop')\n  const didHotspotChange = changedFields.includes('hotspot')\n  const didMetaChange = didCropChange || didHotspotChange\n  const showImageDiff = didAssetChange || didMetaChange\n  const showMetaChange = didMetaChange && !didAssetChange\n\n  const from =\n    fromValue && fromRef ? (\n      <DiffCard annotation={assetAnnotation} style={CARD_STYLES}>\n        <ImagePreview\n          is=\"from\"\n          id={fromRef}\n          diff={diff}\n          action={assetAction}\n          hotspot={showMetaChange && didHotspotChange ? fromValue.hotspot : undefined}\n          crop={showMetaChange && didCropChange ? fromValue.crop : undefined}\n        />\n      </DiffCard>\n    ) : (\n      <NoImagePreview />\n    )\n\n  const to =\n    toValue && toRef ? (\n      <DiffCard annotation={assetAnnotation} style={CARD_STYLES}>\n        <ImagePreview\n          is=\"to\"\n          id={toRef}\n          diff={diff}\n          hotspot={showMetaChange && didHotspotChange ? toValue.hotspot : undefined}\n          crop={showMetaChange && didCropChange ? toValue.crop : undefined}\n        />\n      </DiffCard>\n    ) : (\n      <NoImagePreview />\n    )\n\n  if (!from && !to) {\n    return (\n      <Card padding={4} radius={2} tone=\"transparent\">\n        <Text muted size={1} align=\"center\">\n          {t('changes.image.no-asset-set')}\n        </Text>\n      </Card>\n    )\n  }\n\n  if (!isChanged) {\n    return toRef ? (\n      <DiffCard annotation={assetAnnotation} style={CARD_STYLES}>\n        <ImagePreview id={toRef} is=\"to\" diff={diff} />\n      </DiffCard>\n    ) : null\n  }\n\n  const imageDiff = <FromTo align=\"center\" from={from} layout=\"grid\" to={to} />\n\n  return (\n    <>\n      {showImageDiff &&\n        (didAssetChange ? (\n          <DiffTooltip\n            annotations={assetAnnotation ? [assetAnnotation] : []}\n            description={getChangeDescription(assetAction, t)}\n          >\n            {imageDiff}\n          </DiffTooltip>\n        ) : (\n          imageDiff\n        ))}\n      {nestedFields.length > 0 && (\n        <Box marginTop={showImageDiff ? 4 : 3}>\n          <ChangeList diff={diff} schemaType={schemaType} fields={nestedFields} />\n        </Box>\n      )}\n    </>\n  )\n}\n\nfunction getChangeDescription(action: 'changed' | 'added' | 'removed', t: TFunction): string {\n  switch (action) {\n    case 'changed':\n      return t('changes.changed-label')\n    case 'added':\n      return t('changes.added-label')\n    case 'removed':\n      return t('changes.removed-label')\n    default:\n      // Should never happen, but for linters' sake\n      return 'Unknown change'\n  }\n}\n","import {Box} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {type FieldPreviewComponent} from '../../../preview'\n\nconst NumberWrapper = styled.div`\n  display: inline-block;\n  word-break: break-all;\n`\n\nexport const NumberPreview: FieldPreviewComponent<string> = (props) => {\n  const {value} = props\n\n  return (\n    <Box as={NumberWrapper} paddingX={2} paddingY={1}>\n      {value}\n    </Box>\n  )\n}\n","import {DiffFromTo} from '../../../diff'\nimport {type DiffComponent, type NumberDiff} from '../../../types'\nimport {NumberPreview} from '../preview/NumberPreview'\n\nexport const NumberFieldDiff: DiffComponent<NumberDiff> = ({diff, schemaType}) => {\n  return (\n    <DiffFromTo\n      diff={diff}\n      schemaType={schemaType}\n      previewComponent={NumberPreview}\n      layout=\"inline\"\n    />\n  )\n}\n","import {Box, Text} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const InlineBox = styled(Box)`\n  &:not([hidden]) {\n    display: inline;\n    align-items: center;\n\n    &[data-changed] {\n      cursor: pointer;\n    }\n  }\n`\n\nexport const InlineText = styled(Text)`\n  &:not([hidden]) {\n    display: inline;\n    color: inherit;\n  }\n`\n\nexport const PreviewContainer = styled(Box)`\n  &:not([hidden]) {\n    display: inline-flex;\n    align-items: center;\n\n    ${InlineBox} [data-ui=\"Text\"] {\n      opacity: 0.5;\n    }\n  }\n`\n\nexport const PopoverContainer = styled(Box)`\n  min-width: 160px;\n  max-height: 40vh;\n  overflow-y: auto;\n`\n","import {ChevronDownIcon} from '@sanity/icons'\nimport {isKeySegment, type ObjectSchemaType, type Path, type PortableTextChild} from '@sanity/types'\nimport {Flex, Text, useClickOutside} from '@sanity/ui'\nimport {toString} from '@sanity/util/paths'\nimport {\n  type MouseEvent,\n  type ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../../../ui-components'\nimport {ConnectorContext, useReportedValues} from '../../../../../changeIndicators'\nimport {useTranslation} from '../../../../../i18n'\nimport {ChangeList, DiffContext, DiffTooltip, useDiffAnnotationColor} from '../../../../diff'\nimport {type ObjectDiff} from '../../../../types'\nimport {isEmptyObject} from '../helpers'\nimport {InlineBox, InlineText, PopoverContainer, PreviewContainer} from './styledComponents'\n\ninterface AnnotationProps {\n  diff?: ObjectDiff\n  object: PortableTextChild\n  schemaType?: ObjectSchemaType\n  path: Path\n  children: ReactNode\n}\n\nconst AnnotationWrapper = styled.div`\n  text-decoration: none;\n  display: inline;\n  position: relative;\n  border: 0;\n  padding: 0;\n  border-bottom: 2px dotted currentColor;\n  box-shadow: inset 0 0 0 1px var(--card-border-color);\n  white-space: nowrap;\n  align-items: center;\n  background-color: color(var(--card-fg-color) a(10%));\n\n  &[data-changed] {\n    cursor: pointer;\n  }\n\n  &[data-removed] {\n    text-decoration: line-through;\n  }\n\n  &:hover ${PreviewContainer} {\n    opacity: 1;\n  }\n`\n\nexport function Annotation({\n  children,\n  diff,\n  object,\n  schemaType,\n  path,\n  ...restProps\n}: AnnotationProps) {\n  const {t} = useTranslation()\n  if (!schemaType) {\n    return (\n      <AnnotationWrapper {...restProps}>\n        {t('changes.portable-text.unknown-annotation-schema-type')}\n      </AnnotationWrapper>\n    )\n  }\n  if (diff && diff.action !== 'unchanged') {\n    return (\n      <AnnnotationWithDiff\n        {...restProps}\n        diff={diff}\n        object={object}\n        schemaType={schemaType}\n        path={path}\n      >\n        {children}\n      </AnnnotationWithDiff>\n    )\n  }\n  return <AnnotationWrapper>{children}</AnnotationWrapper>\n}\n\ninterface AnnnotationWithDiffProps {\n  diff: ObjectDiff\n  object: PortableTextChild\n  schemaType: ObjectSchemaType\n  path: Path\n  children?: ReactNode\n}\n\nfunction AnnnotationWithDiff({\n  diff,\n  children,\n  object,\n  schemaType,\n  path,\n  ...restProps\n}: AnnnotationWithDiffProps) {\n  const {onSetFocus} = useContext(ConnectorContext)\n  const {path: fullPath} = useContext(DiffContext)\n  const [popoverElement, setPopoverElement] = useState<HTMLDivElement | null>(null)\n  const {t} = useTranslation()\n  const color = useDiffAnnotationColor(diff, [])\n  const style = useMemo(\n    () => (color ? {background: color.background, color: color.text} : {}),\n    [color],\n  )\n  const isRemoved = diff.action === 'removed'\n  const [open, setOpen] = useState(false)\n  const emptyObject = object && isEmptyObject(object)\n  const markDefPath = useMemo(\n    () => [path[0]].concat(['markDefs', {_key: object._key}]),\n    [object._key, path],\n  )\n  const prefix = useMemo(\n    () =>\n      fullPath.slice(\n        0,\n        fullPath.findIndex((seg) => isKeySegment(seg) && seg._key === object._key),\n      ),\n    [fullPath, object._key],\n  )\n  const annotationPath = useMemo(() => prefix.concat(path), [path, prefix])\n  const myPath = useMemo(() => prefix.concat(markDefPath), [markDefPath, prefix])\n  const myValue = `field-${toString(myPath)}`\n  const values = useReportedValues()\n  const isEditing = useMemo(\n    () => values.filter(([p]) => p.startsWith(myValue)).length > 0,\n    [myValue, values],\n  )\n\n  useEffect(() => {\n    if (!open && isEditing) {\n      setOpen(true)\n      onSetFocus(myPath)\n    }\n  }, [isEditing, myPath, onSetFocus, open])\n\n  const handleOpenPopup = useCallback(\n    (event: MouseEvent<HTMLDivElement, globalThis.MouseEvent>) => {\n      event.stopPropagation()\n      setOpen(true)\n      if (!isRemoved) {\n        event.preventDefault()\n        onSetFocus(annotationPath) // Go to span first\n        setTimeout(() => onSetFocus(myPath), 10) // Open edit object interface\n      }\n    },\n    [annotationPath, isRemoved, myPath, onSetFocus],\n  )\n\n  const handleClickOutside = useCallback(() => {\n    if (!isEditing) {\n      setOpen(false)\n    }\n  }, [isEditing])\n\n  useClickOutside(handleClickOutside, [popoverElement])\n\n  const annotation = (diff.action !== 'unchanged' && diff.annotation) || null\n  const annotations = useMemo(() => (annotation ? [annotation] : []), [annotation])\n\n  const popoverContent = (\n    <DiffContext.Provider value={{path: myPath}}>\n      <PopoverContainer padding={3}>\n        <div>\n          {emptyObject && (\n            <Text muted size={1} weight=\"medium\">\n              {t('changes.portable-text.empty-object-annotation', {\n                annotationType: schemaType.title || schemaType.name,\n              })}\n            </Text>\n          )}\n          {!emptyObject && <ChangeList diff={diff} schemaType={schemaType} />}\n        </div>\n      </PopoverContainer>\n    </DiffContext.Provider>\n  )\n\n  return (\n    <AnnotationWrapper\n      {...restProps}\n      onClick={handleOpenPopup}\n      style={style}\n      data-changed=\"\"\n      data-removed={diff.action === 'removed' ? '' : undefined}\n    >\n      <Popover content={popoverContent} open={open} ref={setPopoverElement} portal>\n        <PreviewContainer paddingLeft={1}>\n          <DiffTooltip\n            annotations={annotations}\n            description={t('changes.portable-text.annotation', {context: diff.action})}\n          >\n            <InlineBox style={{display: 'inline-flex'}}>\n              <span>{children}</span>\n              <Flex align=\"center\" paddingX={1}>\n                <InlineText size={0}>\n                  <ChevronDownIcon />\n                </InlineText>\n              </Flex>\n            </InlineBox>\n          </DiffTooltip>\n        </PreviewContainer>\n      </Popover>\n    </AnnotationWrapper>\n  )\n}\n","import {type ReactNode} from 'react'\nimport styled from 'styled-components'\n\nconst Quote = styled.blockquote`\n  margin: 0;\n`\n\nexport function Blockquote({children}: {children: ReactNode}): JSX.Element {\n  return (\n    <div>\n      <Quote>{children}</Quote>\n    </div>\n  )\n}\n","import {Heading} from '@sanity/ui'\nimport {type ReactNode} from 'react'\nimport styled from 'styled-components'\n\nconst headingSizes: Record<string, number | undefined> = {\n  h1: 2,\n  h2: 1,\n  h3: 0,\n  h4: 0,\n  h5: 0,\n  h6: 0,\n}\n\nconst StyledHeading = styled(Heading)`\n  &:not([hidden]) {\n    display: inline;\n    text-transform: none;\n    margin: 0;\n\n    &::before,\n    &::after {\n      content: unset;\n    }\n  }\n`\n\nexport function Header({style, children}: {style: string; children: ReactNode}): JSX.Element {\n  return <StyledHeading size={headingSizes[style]}>{children}</StyledHeading>\n}\n","import {type ReactNode} from 'react'\nimport styled from 'styled-components'\n\n// This can contain nested <div> elements, so it's not rendered as a <p> element\nconst StyledParagraph = styled.div`\n  text-transform: none;\n  white-space: wrap;\n  overflow-wrap: break-word;\n  margin: 0;\n`\n\nexport function Paragraph({children}: {children: ReactNode}): JSX.Element {\n  return <StyledParagraph>{children}</StyledParagraph>\n}\n","import {type Path, type PortableTextTextBlock} from '@sanity/types'\nimport {Box, Card, Stack, Text} from '@sanity/ui'\nimport {type MouseEvent, useCallback, useContext} from 'react'\n\nimport {ConnectorContext} from '../../../../../changeIndicators'\nimport {useTranslation} from '../../../../../i18n'\nimport {DiffContext, DiffTooltip, useDiffAnnotationColor} from '../../../../diff'\nimport {isHeader} from '../helpers'\nimport {type PortableTextDiff} from '../types'\nimport {Blockquote} from './Blockquote'\nimport {Header} from './Header'\nimport {Paragraph} from './Paragraph'\n\nconst EMPTY_PATH: Path = []\n\nexport function Block(props: {\n  diff: PortableTextDiff\n  block: PortableTextTextBlock\n  children: JSX.Element\n}): JSX.Element {\n  const {diff, block, children} = props\n  const color = useDiffAnnotationColor(diff, EMPTY_PATH)\n  const {path: fullPath} = useContext(DiffContext)\n  const {onSetFocus} = useContext(ConnectorContext)\n  const {t} = useTranslation()\n  const isRemoved = diff.action === 'removed'\n  let returned = children\n\n  const handleClick = useCallback(\n    (event: MouseEvent<HTMLDivElement, globalThis.MouseEvent>) => {\n      event.stopPropagation()\n\n      if (!isRemoved) {\n        onSetFocus(fullPath)\n      }\n    },\n    [fullPath, isRemoved, onSetFocus],\n  )\n\n  if (block.style === 'blockquote') {\n    returned = <Blockquote>{returned}</Blockquote>\n  } else if (block.style && isHeader(block)) {\n    returned = <Header style={block.style}>{returned}</Header>\n  } else {\n    returned = <Paragraph>{returned}</Paragraph>\n  }\n\n  let fromStyle: string | undefined\n  // If style was changed, indicate that\n  if (\n    diff.origin.action === 'changed' &&\n    diff.origin.fields.style &&\n    diff.origin.fields.style.action === 'changed' &&\n    diff.origin.fields.style.annotation\n  ) {\n    fromStyle = diff?.origin?.fromValue?.style\n\n    const style = color ? {background: color.background, color: color.text} : {}\n\n    returned = (\n      <Card\n        padding={3}\n        border\n        radius={2}\n        style={{borderStyle: 'dotted'}}\n        diff-block-action={diff.action}\n        data-block-note={`changed_from_style_${fromStyle || 'undefined'}`}\n      >\n        <Stack space={2}>\n          <DiffTooltip\n            annotations={[diff.origin.fields.style?.annotation]}\n            diff={diff.origin.fields.style}\n          >\n            <Text size={0}>\n              {t('changes.portable-text.block-style-changed', {fromStyle, toStyle: block.style})}\n            </Text>\n          </DiffTooltip>\n          <Box style={style}>{returned}</Box>\n        </Stack>\n      </Card>\n    )\n  }\n\n  return (\n    <div\n      onClick={handleClick}\n      data-diff-block-action={diff.action}\n      data-block-note={`changed_from_style_${fromStyle || 'undefined'}`}\n    >\n      {returned}\n    </div>\n  )\n}\n","import styled from 'styled-components'\n\nconst DecoratorWrapper = styled.span<{decoration: string}>`\n  display: inline;\n  ${({theme, decoration}) => {\n    switch (decoration) {\n      case 'strong':\n        return 'font-weight: bold;'\n      case 'em':\n        return 'font-style: italic;'\n      case 'underline':\n        return 'text-decoration: underline;'\n      case 'overline':\n        return 'text-decoration: overline;'\n      case 'strike-through':\n        return 'text-decoration: line-through;'\n      case 'code':\n        return `\n          font-family: ${theme.sanity.fonts.code.family};\n          background: ${theme.sanity.color.muted.default.enabled.bg};\n        `\n      default:\n        return ''\n    }\n  }}\n`\n\nexport function Decorator({mark, children}: {mark: string; children: JSX.Element}) {\n  return <DecoratorWrapper decoration={mark}>{children}</DecoratorWrapper>\n}\n","import {ChevronDownIcon} from '@sanity/icons'\nimport {\n  isKeySegment,\n  type ObjectSchemaType,\n  type Path,\n  type PortableTextChild,\n  type PortableTextObject,\n} from '@sanity/types'\nimport {Card, Flex, Text, useClickOutside} from '@sanity/ui'\nimport {FOCUS_TERMINATOR, toString} from '@sanity/util/paths'\nimport {type MouseEvent, useCallback, useContext, useEffect, useMemo, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../../../ui-components'\nimport {ConnectorContext, useReportedValues} from '../../../../../changeIndicators'\nimport {useTranslation} from '../../../../../i18n'\nimport {Preview} from '../../../../../preview/components/Preview'\nimport {ChangeList, DiffContext, DiffTooltip, useDiffAnnotationColor} from '../../../../diff'\nimport {type ObjectDiff} from '../../../../types'\nimport {isEmptyObject} from '../helpers'\nimport {InlineBox, InlineText, PopoverContainer, PreviewContainer} from './styledComponents'\n\ninterface InlineObjectProps {\n  diff?: ObjectDiff\n  object: PortableTextObject\n  path: Path\n  schemaType?: ObjectSchemaType\n}\n\nconst InlineObjectWrapper = styled(Card)`\n  &:not([hidden]) {\n    display: inline;\n    cursor: pointer;\n    white-space: nowrap;\n    align-items: center;\n\n    &[data-removed] {\n      text-decoration: line-through;\n    }\n\n    ${InlineBox} {\n      display: inline-flex;\n    }\n  }\n`\n\nexport function InlineObject({diff, object, schemaType, ...restProps}: InlineObjectProps) {\n  const {t} = useTranslation()\n  if (!schemaType) {\n    return (\n      <InlineObjectWrapper {...restProps} border radius={1}>\n        {t('changes.portable-text.unknown-inline-object-schema-type', {schemaType: object._type})}\n      </InlineObjectWrapper>\n    )\n  }\n\n  if (diff) {\n    return (\n      <InlineObjectWithDiff {...restProps} diff={diff} object={object} schemaType={schemaType} />\n    )\n  }\n\n  return (\n    <InlineObjectWrapper>\n      <Preview schemaType={schemaType} value={object} layout=\"inline\" />\n    </InlineObjectWrapper>\n  )\n}\n\ninterface InlineObjectWithDiffProps {\n  diff: ObjectDiff\n  object: PortableTextChild\n  path: Path\n  schemaType: ObjectSchemaType\n}\n\nfunction InlineObjectWithDiff({\n  diff,\n  object,\n  path,\n  schemaType,\n  ...restProps\n}: InlineObjectWithDiffProps) {\n  const {path: fullPath} = useContext(DiffContext)\n  const {onSetFocus} = useContext(ConnectorContext)\n  const {t} = useTranslation()\n  const color = useDiffAnnotationColor(diff, [])\n  const style = useMemo(\n    () => (color ? {background: color.background, color: color.text} : {}),\n    [color],\n  )\n  const [open, setOpen] = useState(false)\n  const emptyObject = object && isEmptyObject(object)\n  const isRemoved = diff.action === 'removed'\n  const prefix = fullPath.slice(\n    0,\n    fullPath.findIndex((seg) => isKeySegment(seg) && seg._key === object._key),\n  )\n  const myPath = prefix.concat(path)\n  const myValue = `field-${toString(myPath)}`\n  const values = useReportedValues()\n  const isEditing = values.filter(([p]) => p.startsWith(myValue)).length > 0\n\n  const focusPath = fullPath.slice(0, -1).concat(path).concat([FOCUS_TERMINATOR])\n\n  useEffect(() => {\n    if (isEditing) {\n      setOpen(true)\n      onSetFocus(focusPath)\n    }\n  }, [focusPath, isEditing, onSetFocus])\n\n  const handleOpenPopup = useCallback(\n    (event: MouseEvent<HTMLDivElement, globalThis.MouseEvent>) => {\n      event.stopPropagation()\n      setOpen(true)\n      if (!isRemoved) {\n        onSetFocus(focusPath)\n        return\n      }\n      event.preventDefault()\n    },\n    [focusPath, isRemoved, onSetFocus],\n  )\n\n  const handleClose = useCallback(() => {\n    setOpen(false)\n  }, [])\n\n  const popoverContent = (\n    <DiffContext.Provider value={{path: myPath}}>\n      <PopoverContent\n        diff={diff}\n        emptyObject={emptyObject}\n        onClose={handleClose}\n        schemaType={schemaType}\n      />\n    </DiffContext.Provider>\n  )\n\n  const annotation = (diff.action !== 'unchanged' && diff.annotation) || null\n  const annotations = annotation ? [annotation] : []\n\n  return (\n    <InlineObjectWrapper\n      {...restProps}\n      onClick={handleOpenPopup}\n      style={style}\n      data-removed={diff.action === 'removed' ? '' : undefined}\n      border\n      radius={2}\n    >\n      <Popover content={popoverContent} open={open} portal>\n        <PreviewContainer>\n          <DiffTooltip\n            annotations={annotations}\n            description={t('changes.portable-text.inline-object', {context: diff.action})}\n          >\n            <InlineBox>\n              <Preview schemaType={schemaType} value={object} layout=\"inline\" />\n              <Flex align=\"center\" paddingX={1}>\n                <InlineText size={0}>\n                  <ChevronDownIcon />\n                </InlineText>\n              </Flex>\n            </InlineBox>\n          </DiffTooltip>\n        </PreviewContainer>\n      </Popover>\n    </InlineObjectWrapper>\n  )\n}\n\nfunction PopoverContent({\n  diff,\n  emptyObject,\n  onClose,\n  schemaType,\n}: {\n  diff: ObjectDiff\n  emptyObject: boolean\n  onClose: () => void\n  schemaType: ObjectSchemaType\n}) {\n  const {t} = useTranslation()\n  const [popoverElement, setPopoverElement] = useState<HTMLDivElement | null>(null)\n\n  useClickOutside(onClose, [popoverElement])\n\n  return (\n    <PopoverContainer ref={setPopoverElement} padding={3}>\n      {emptyObject && (\n        <Text muted size={1} weight=\"medium\">\n          {t('changes.portable-text.empty-inline-object', {\n            inlineObjectType: schemaType.title || schemaType.name,\n          })}\n        </Text>\n      )}\n      {!emptyObject && <ChangeList diff={diff} schemaType={schemaType} />}\n    </PopoverContainer>\n  )\n}\n","import {isKeySegment, type Path} from '@sanity/types'\nimport {type HTMLProps, type SyntheticEvent, useCallback, useContext, useMemo} from 'react'\n\nimport {ConnectorContext} from '../../../../../changeIndicators'\nimport {useTranslation} from '../../../../../i18n'\nimport {DiffCard, DiffContext} from '../../../../diff'\nimport {type ObjectDiff, type StringDiff, type StringDiffSegment} from '../../../../types'\nimport {InlineBox} from './styledComponents'\n\ninterface TextProps {\n  diff?: StringDiff\n  childDiff?: ObjectDiff\n  children: JSX.Element\n  path: Path\n  segment: StringDiffSegment\n}\n\nexport function Text({\n  diff,\n  childDiff,\n  children,\n  path,\n  segment,\n  ...restProps\n}: TextProps & Omit<HTMLProps<HTMLSpanElement>, 'onClick'>) {\n  const diffWithFallback = diff || childDiff\n  const hasChanged =\n    diffWithFallback && diffWithFallback.action !== 'unchanged' && segment.action !== 'unchanged'\n  if (hasChanged) {\n    return (\n      <TextWithDiff {...restProps} childDiff={childDiff} diff={diff} segment={segment} path={path}>\n        {children}\n      </TextWithDiff>\n    )\n  }\n  return <InlineBox>{children}</InlineBox>\n}\n\nexport function TextWithDiff({diff, childDiff, children, path, segment, ...restProps}: TextProps) {\n  const {onSetFocus} = useContext(ConnectorContext)\n  const {path: fullPath} = useContext(DiffContext)\n  const spanSegment = useMemo(() => path.slice(-2, 1)[0], [path])\n  const {t} = useTranslation()\n  const isRemoved = diff && diff.action === 'removed'\n  const prefix = fullPath.slice(\n    0,\n    fullPath.findIndex(\n      (seg) => isKeySegment(seg) && isKeySegment(spanSegment) && seg._key === spanSegment._key,\n    ),\n  )\n  const focusPath = prefix.concat(path)\n\n  const handleClick = useCallback(\n    (event: SyntheticEvent) => {\n      event.stopPropagation()\n      if (!isRemoved) {\n        event.preventDefault()\n        onSetFocus(focusPath)\n      }\n    },\n    [focusPath, isRemoved, onSetFocus],\n  )\n  const realSeg = diff && diff.segments.find((rSeg) => rSeg.text === segment.text)\n\n  const diffWithFallback = realSeg || diff || childDiff\n  const annotation =\n    (diffWithFallback && diffWithFallback.action !== 'unchanged' && diffWithFallback.annotation) ||\n    null\n\n  const diffCard =\n    annotation && segment.action !== 'unchanged' ? (\n      <DiffCard\n        annotation={annotation}\n        as={segment.action === 'removed' ? 'del' : 'ins'}\n        tooltip={{description: t('changes.portable-text.text', {context: segment.action})}}\n      >\n        {children}\n      </DiffCard>\n    ) : null\n\n  return (\n    <InlineBox {...restProps} onClick={handleClick} data-changed=\"\">\n      <span>\n        <>{diffCard || children}</>\n      </span>\n    </InlineBox>\n  )\n}\n","import {\n  isPortableTextSpan,\n  type ObjectSchemaType,\n  type PortableTextChild,\n  type PortableTextTextBlock,\n  type SpanSchemaType,\n} from '@sanity/types'\nimport {uniq, xor} from 'lodash'\nimport {createElement, type ReactElement, type ReactNode, useCallback, useMemo} from 'react'\n\nimport {type TFunction, useTranslation} from '../../../../../i18n'\nimport {DiffCard} from '../../../../diff'\nimport {\n  type ArrayDiff,\n  type ObjectDiff,\n  type StringDiff,\n  type StringDiffSegment,\n} from '../../../../types'\nimport {\n  escapeRegExp,\n  findAnnotationDiff,\n  findChildDiff,\n  findSpanDiffFromChild,\n  getAllMarkDefs,\n  getChildSchemaType,\n  getDecorators,\n  getInlineObjects,\n  isDecorator,\n} from '../helpers'\nimport * as TextSymbols from '../symbols'\nimport {type PortableTextDiff} from '../types'\nimport {Annotation} from './Annotation'\nimport {Block} from './Block'\nimport {Decorator} from './Decorator'\nimport {InlineObject} from './InlineObject'\nimport {Text} from './Text'\n\nconst decoratorSymbolsStart = TextSymbols.DECORATOR_SYMBOLS.map((set) => set[0])\nconst decoratorSymbolsEnd = TextSymbols.DECORATOR_SYMBOLS.map((set) => set[1])\nconst annotationSymbolsStart = TextSymbols.ANNOTATION_SYMBOLS.map((set) => set[0])\nconst annotationSymbolsEnd = TextSymbols.ANNOTATION_SYMBOLS.map((set) => set[1])\n\nconst allSymbolsStart = decoratorSymbolsStart.concat(annotationSymbolsStart)\nconst allSymbolsEnd = decoratorSymbolsEnd.concat(annotationSymbolsEnd)\n\nconst allDecoratorSymbols = decoratorSymbolsStart.concat(decoratorSymbolsEnd)\nconst markRegex = new RegExp(`${allDecoratorSymbols.concat(allSymbolsEnd).join('|')}`, 'g')\n\ntype Props = {\n  diff: PortableTextDiff\n  schemaType: ObjectSchemaType\n}\n\nexport function PortableText(props: Props): JSX.Element {\n  const {diff, schemaType} = props\n  const block = (diff.origin.toValue || diff.origin.fromValue) as PortableTextTextBlock\n  const {t} = useTranslation()\n\n  const inlineObjects = useMemo(\n    () => (diff.origin.toValue ? getInlineObjects(diff.origin) : []),\n    [diff.origin],\n  )\n\n  const renderChild = useCallback(\n    (ptDiffChild: PortableTextChild) => {\n      const spanSchemaType = getChildSchemaType(schemaType.fields, ptDiffChild) as SpanSchemaType\n      let decoratorTypes: {title: string; value: string}[] = []\n      if (spanSchemaType) {\n        decoratorTypes = getDecorators(spanSchemaType)\n        const childrenDiff = diff.fields.children as ArrayDiff\n        const segments =\n          (childrenDiff.items[0].diff &&\n            childrenDiff.items[0].diff.type === 'object' &&\n            childrenDiff.items[0].diff.fields.text.type === 'string' &&\n            childrenDiff.items[0].diff.fields.text.segments) ||\n          []\n        const returnedChildren: ReactNode[] = []\n        const annotationSegments: Record<string, ReactNode[]> = {}\n        // Special case for new empty PT-block (single span child with empty text)\n        if (\n          isEmptyTextChange(block, diff) &&\n          (diff.origin.action === 'added' || diff.origin.action === 'removed')\n        ) {\n          const textDiff = findChildDiff(diff.origin, block.children[0]) || diff.origin\n          if (textDiff && textDiff.action !== 'unchanged') {\n            return (\n              <DiffCard\n                annotation={textDiff.annotation}\n                as={textDiff.action === 'removed' ? 'del' : 'ins'}\n                key={`empty-block-${block._key}`}\n                tooltip={{\n                  description: t('changes.portable-text.empty-text', {context: textDiff.action}),\n                }}\n              >\n                <span>{TextSymbols.EMPTY_BLOCK_SYMBOL}</span>\n              </DiffCard>\n            )\n          }\n        }\n        // Run through all the segments from the PortableTextDiff\n        let childToIndex = -1\n        let segIndex = -1\n        const activeAnnotations: {mark: string; object: PortableTextChild; symbols: string[]}[] = []\n        let endedAnnotation:\n          | {mark: string; object: PortableTextChild; symbols: string[]}\n          | undefined\n        const allMarkDefs = getAllMarkDefs(diff.origin)\n        segments.forEach((seg) => {\n          segIndex++\n          const isInline = TextSymbols.INLINE_SYMBOLS.includes(seg.text)\n          const isMarkStart = allSymbolsStart.includes(seg.text)\n          const isMarkEnd = allSymbolsEnd.includes(seg.text)\n          const isChildStart = seg.text === TextSymbols.CHILD_SYMBOL\n          const isRemoved = seg.action === 'removed'\n          if (isChildStart) {\n            if (!isRemoved) {\n              childToIndex++\n            }\n            // No output\n          } else if (isMarkStart || isMarkEnd) {\n            if (isMarkStart && annotationSymbolsStart.includes(seg.text)) {\n              const object = allMarkDefs[annotationSymbolsStart.indexOf(seg.text)]\n              if (object) {\n                activeAnnotations.push({\n                  mark: object._key,\n                  symbols: [\n                    seg.text,\n                    annotationSymbolsEnd[annotationSymbolsStart.indexOf(seg.text)],\n                  ],\n                  object,\n                })\n              }\n            }\n            if (isMarkEnd && annotationSymbolsEnd.includes(seg.text)) {\n              endedAnnotation = activeAnnotations.pop()\n            }\n            // No output\n          } else if (isInline) {\n            // Render inline object\n            const indexOfSymbol = TextSymbols.INLINE_SYMBOLS.findIndex((sym) => sym === seg.text)\n            const key = inlineObjects[indexOfSymbol]?._key\n            const originChild = inlineObjects[indexOfSymbol]\n            if (key) {\n              const objectSchemaType = getChildSchemaType(schemaType.fields, originChild)\n              const objectDiff = findChildDiff(diff.origin, originChild)\n              returnedChildren.push(\n                <InlineObject\n                  key={`inline-object-${originChild._key}`}\n                  object={originChild}\n                  path={[{_key: block._key}, 'children', {_key: originChild._key}]}\n                  diff={objectDiff}\n                  schemaType={objectSchemaType}\n                />,\n              )\n            }\n          } else if (seg.text) {\n            // TODO: find a better way of getting a removed child\n            const getChildFromFromValue = () =>\n              diff.origin.fromValue?.children.find(\n                (cld: any) => cld.text && cld.text.match(escapeRegExp(seg.text)),\n              ) as PortableTextChild\n            const child = block.children[childToIndex] || getChildFromFromValue()\n            const childDiff = child && findSpanDiffFromChild(diff.origin, child)\n            if (!child) {\n              throw new Error('Could not find child')\n            }\n            const textDiff = childDiff?.fields?.text\n              ? (childDiff?.fields?.text as StringDiff)\n              : undefined\n            const text = (\n              <Text\n                diff={textDiff}\n                key={`text-${child._key}-${segIndex}`}\n                path={[{_key: block._key}, 'children', {_key: child._key}]}\n                childDiff={childDiff}\n                segment={seg}\n              >\n                {renderTextSegment({\n                  diff,\n                  child,\n                  decoratorTypes,\n                  seg,\n                  segIndex,\n                  spanSchemaType,\n                  t,\n                })}\n              </Text>\n            )\n\n            // Render annotations text changes within the annotation child\n            if (activeAnnotations.length > 0) {\n              activeAnnotations.forEach((active) => {\n                annotationSegments[active.mark] = annotationSegments[active.mark] || []\n                annotationSegments[active.mark].push(text)\n              })\n            }\n            if (endedAnnotation) {\n              const key = `annotation-${endedAnnotation.object._key}`\n              const lastChild = returnedChildren[returnedChildren.length - 1] as ReactElement\n              if (lastChild && lastChild.key !== key) {\n                const annotationDiff = findAnnotationDiff(diff.origin, endedAnnotation.mark)\n                const objectSchemaType =\n                  endedAnnotation &&\n                  spanSchemaType.annotations &&\n                  spanSchemaType.annotations.find(\n                    (type) =>\n                      endedAnnotation &&\n                      endedAnnotation.object &&\n                      type.name === endedAnnotation.object._type,\n                  )\n                returnedChildren.push(\n                  <Annotation\n                    object={endedAnnotation.object}\n                    diff={annotationDiff}\n                    path={[{_key: block._key}, 'children', {_key: child._key}]}\n                    schemaType={objectSchemaType}\n                    key={key}\n                  >\n                    <>{annotationSegments[endedAnnotation.mark]}</>\n                  </Annotation>,\n                )\n              }\n              // delete annotationSegments[endedAnnotation.mark]\n              endedAnnotation = undefined\n            }\n            if (activeAnnotations.length === 0) {\n              returnedChildren.push(text)\n            }\n          } // end if seg.text\n        })\n        return createElement('div', {key: block._key}, ...returnedChildren)\n      }\n      throw new Error(\"'span' schemaType not found\")\n    },\n    [block, diff, inlineObjects, schemaType, t],\n  )\n\n  return (\n    <Block block={diff.displayValue} diff={diff}>\n      {<>{(diff.displayValue.children || []).map((child) => renderChild(child))}</>}\n    </Block>\n  )\n}\n\nfunction renderTextSegment({\n  diff,\n  child,\n  decoratorTypes,\n  seg,\n  segIndex,\n  spanSchemaType,\n  t,\n}: {\n  diff: PortableTextDiff\n  child: PortableTextChild\n  decoratorTypes: {title: string; value: string}[]\n  seg: StringDiffSegment\n  segIndex: number\n  spanSchemaType: SpanSchemaType\n  t: TFunction\n}): JSX.Element {\n  // Newlines\n  if (seg.text === '\\n') {\n    return <br />\n  }\n  // Make sure we render trailing spaces correctly\n  let children = (\n    <span key={`text-${segIndex}`}>\n      {seg.text.replace(/ /g, TextSymbols.TRAILING_SPACE_SYMBOL)}\n    </span>\n  )\n  const spanDiff = child && findSpanDiffFromChild(diff.origin, child)\n  // Render decorator diff info\n  const activeMarks = isPortableTextSpan(child) ? child.marks || [] : []\n  if (spanDiff) {\n    children = renderDecorators({\n      activeMarks,\n      decoratorTypes,\n      diff,\n      children,\n      seg,\n      segIndex,\n      spanDiff,\n      spanSchemaType,\n      t,\n    })\n  }\n  // Render the segment with the active marks\n  if (activeMarks && activeMarks.length > 0) {\n    activeMarks.forEach((mark) => {\n      if (isDecorator(mark, spanSchemaType)) {\n        children = (\n          // eslint-disable-next-line react/no-array-index-key\n          <Decorator mark={mark} key={`decorator-${mark}-${child._key}-${segIndex}`}>\n            {children}\n          </Decorator>\n        )\n      }\n    })\n  }\n  return children\n}\n\nfunction renderDecorators({\n  activeMarks,\n  decoratorTypes,\n  diff,\n  children,\n  seg,\n  segIndex,\n  spanDiff,\n  spanSchemaType,\n  t,\n}: {\n  activeMarks: string[]\n  decoratorTypes: {title: string; value: string}[]\n  diff: PortableTextDiff\n  children: JSX.Element\n  seg: StringDiffSegment\n  segIndex: number\n  spanDiff: ObjectDiff\n  spanSchemaType: SpanSchemaType\n  t: TFunction\n}): JSX.Element {\n  let returned = <span key={`text-segment-${segIndex}`}>{children}</span>\n  const fromPtDiffText: string =\n    (diff.origin.fromValue && diff.fromValue && diff.fromValue.children[0].text) || '' // Always one child\n\n  // There are cases where we have changed marks, but it's an indirect change in the diff data.\n  // For example when '<>normal-text</><>bold-text</>' and 'bold' is unbolded. Then 'bold' is added to first span,\n  // and 'bold' is removed from the second span: '<>normal-text-bold</><>-text</>'. No marks are changed.\n  // We do however want to indicate to the user that someone removed bold from 'bold'\n  // In these cases, fallback to the diff annotation information in the span itself.\n  const indirectMarksAnnotation =\n    (spanDiff && spanDiff.action !== 'unchanged' && spanDiff.annotation) || undefined\n\n  const marksDiff = spanDiff?.fields?.marks as ArrayDiff\n  const marksAnnotation =\n    (marksDiff && marksDiff.action !== 'unchanged' && marksDiff.annotation) ||\n    indirectMarksAnnotation\n\n  let marksChanged: string[] = []\n  const ptDiffChildren = fromPtDiffText\n    .split(TextSymbols.CHILD_SYMBOL)\n    .filter((text) => !!text)\n    .join('')\n  const ptDiffMatchString = ptDiffChildren\n  const controlString = ptDiffMatchString.substring(\n    0,\n    ptDiffMatchString.indexOf(seg.text) + seg.text.length,\n  )\n  const toTest = controlString.substring(0, controlString.indexOf(seg.text))\n  const marks: string[] = []\n  const matches = [...toTest.matchAll(markRegex)]\n  matches.forEach((match) => {\n    const sym = match[0]\n    const set = TextSymbols.DECORATOR_SYMBOLS.concat(TextSymbols.ANNOTATION_SYMBOLS).find(\n      (aSet) => aSet.indexOf(sym) > -1,\n    )\n    if (set) {\n      const isMarkStart = sym === set[0]\n      const mark: string =\n        decoratorTypes[\n          isMarkStart ? decoratorSymbolsStart.indexOf(sym) : decoratorSymbolsEnd.indexOf(sym)\n        ]?.value || sym // Annotation marks are uniqe anyway\n      const notClosed = toTest.lastIndexOf(sym) > toTest.lastIndexOf(set[1])\n      if (notClosed) {\n        marks.push(mark)\n      }\n    }\n  })\n  marksChanged = xor(activeMarks, uniq(marks))\n  // Only for decorators, annotations are taken care of elsewhere\n  if (\n    marksAnnotation &&\n    marksChanged.length > 0 &&\n    marksChanged.some((m) => isDecorator(m, spanSchemaType))\n  ) {\n    returned = (\n      <DiffCard\n        annotation={marksAnnotation}\n        key={`diffcard-annotation-${segIndex}-${marksChanged.join('-')}`}\n        as={'ins'}\n        tooltip={{\n          description: t('changes.portable-text.changed-formatting'),\n        }}\n      >\n        {returned}\n      </DiffCard>\n    )\n  }\n  return returned\n}\n\nfunction isEmptyTextChange(block: PortableTextTextBlock, diff: PortableTextDiff) {\n  return (\n    block.children.length === 1 &&\n    block.children[0]._type === 'span' &&\n    typeof block.children[0].text === 'string' &&\n    block.children[0].text === '' &&\n    diff.origin.action !== 'unchanged'\n  )\n}\n","import {useMemo} from 'react'\n\nimport {type DiffComponent, type ObjectDiff} from '../../../types'\nimport {PortableText} from './components/PortableText'\nimport {createPortableTextDiff} from './helpers'\n\nexport const PTDiff: DiffComponent<ObjectDiff> = (props) => {\n  const {diff, schemaType} = props\n\n  const ptDiff = useMemo(() => createPortableTextDiff(diff, schemaType), [diff, schemaType])\n\n  return (\n    <div data-diff-action={diff.action}>\n      <PortableText diff={ptDiff} schemaType={schemaType} />\n    </div>\n  )\n}\n","import {type Reference} from '@sanity/types'\nimport {Box} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {Preview} from '../../../../preview/components/Preview'\nimport {type FieldPreviewComponent} from '../../../preview'\n\nconst ReferenceWrapper = styled.div`\n  word-wrap: break-word;\n`\n\nexport const ReferencePreview: FieldPreviewComponent<Reference> = ({value, schemaType}) => (\n  <Box as={ReferenceWrapper} padding={2}>\n    <Preview schemaType={schemaType} value={value} layout=\"default\" />\n  </Box>\n)\n","import {DiffFromTo} from '../../../diff'\nimport {type DiffComponent, type ReferenceDiff} from '../../../types'\nimport {ReferencePreview} from '../preview/ReferencePreview'\n\nexport const ReferenceFieldDiff: DiffComponent<ReferenceDiff> = ({diff, schemaType}) => {\n  return (\n    <DiffFromTo\n      align=\"center\"\n      diff={diff}\n      layout=\"grid\"\n      path=\"_ref\"\n      previewComponent={ReferencePreview}\n      schemaType={schemaType}\n    />\n  )\n}\n","import {Box} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {type FieldPreviewComponent} from '../../../preview'\n\nconst StringWrapper = styled.div`\n  display: inline-block;\n  word-break: break-all;\n  white-space: pre-wrap;\n`\n\nexport const StringPreview: FieldPreviewComponent<string> = (props) => {\n  const {value} = props\n\n  return (\n    <Box as={StringWrapper} paddingX={2} paddingY={1}>\n      {value}\n    </Box>\n  )\n}\n","import styled from 'styled-components'\n\nimport {DiffFromTo, DiffString} from '../../../diff'\nimport {type DiffComponent, type StringDiff} from '../../../types'\nimport {StringPreview} from '../preview/StringPreview'\n\nconst StringWrapper = styled.div`\n  white-space: pre-wrap;\n  word-wrap: break-word;\n`\n\nexport const StringFieldDiff: DiffComponent<StringDiff> = ({diff, schemaType}) => {\n  const {options} = schemaType\n\n  if (options?.list) {\n    // When the string is considered to be an \"enum\", don't show individual\n    // string segment changes, rather treat is as a \"from -> to\" diff\n    return <DiffFromTo diff={diff} previewComponent={StringPreview} schemaType={schemaType} />\n  }\n\n  return (\n    <StringWrapper>\n      <DiffString diff={diff} />\n    </StringWrapper>\n  )\n}\n","import {type DiffComponent, type DiffComponentOptions} from '../../types'\nimport {BooleanFieldDiff} from '../../types/boolean/diff'\nimport {DatetimeFieldDiff} from '../../types/datetime/diff'\nimport {FileFieldDiff} from '../../types/file/diff'\nimport {ImageFieldDiff} from '../../types/image/diff'\nimport {NumberFieldDiff} from '../../types/number/diff'\nimport {PTDiff} from '../../types/portableText/diff'\nimport {ReferenceFieldDiff} from '../../types/reference/diff'\nimport {StringFieldDiff} from '../../types/string/diff'\n\nexport const defaultComponents: Record<\n  string,\n  DiffComponent<any> | DiffComponentOptions<any> | undefined\n> = {\n  block: PTDiff,\n  boolean: {component: BooleanFieldDiff, showHeader: false},\n  date: DatetimeFieldDiff,\n  datetime: DatetimeFieldDiff,\n  file: FileFieldDiff,\n  image: ImageFieldDiff,\n  number: NumberFieldDiff,\n  reference: ReferenceFieldDiff,\n  string: StringFieldDiff,\n}\n","import {type ArraySchemaType, type ObjectSchemaType, type SchemaType} from '@sanity/types'\nimport {type ComponentType} from 'react'\n\nimport {diffResolvers} from '../../TODO'\nimport {type Diff, type DiffComponent, type DiffComponentOptions} from '../../types'\nimport {defaultComponents} from './defaultComponents'\n\n/** @internal */\nexport function resolveDiffComponent<D extends Diff = any>(\n  type: SchemaType,\n  parentSchemaType?: ArraySchemaType | ObjectSchemaType,\n): DiffComponent<D> | DiffComponentOptions | undefined {\n  let itType: SchemaType | undefined = type\n\n  while (itType) {\n    const resolved =\n      itType?.components?.diff ||\n      tryResolve(itType, parentSchemaType) ||\n      defaultComponents[itType.name]\n\n    if (resolved) {\n      return resolved as DiffComponent<any>\n    }\n\n    itType = itType.type\n  }\n\n  const isDateType = ['date', 'datetime'].includes(type.name)\n\n  // The date and datetime has the same jsonType as string, but we want to use\n  // a different default component for them. Therefore, we use the name of the\n  // type instead of the jsonType for these types.\n  const defaultComponentKey = isDateType ? type.name : type.jsonType\n\n  return defaultComponents[defaultComponentKey]\n}\n\nfunction tryResolve(\n  schemaType: SchemaType,\n  parentSchemaType?: ArraySchemaType | ObjectSchemaType,\n): DiffComponent<any> | DiffComponentOptions | undefined {\n  const resolvers = diffResolvers\n\n  let resolved: ComponentType | DiffComponentOptions | undefined\n\n  for (const resolver of resolvers) {\n    if (typeof resolver !== 'function') {\n      // eslint-disable-next-line no-console\n      console.error('Diff component resolver is not a function: ', resolver)\n      continue\n    }\n\n    resolved = resolver({schemaType, parentSchemaType})\n\n    if (resolved) {\n      return resolved as DiffComponent\n    }\n  }\n  return undefined\n}\n","import {\n  type ArraySchemaType,\n  type MultiFieldSet,\n  type ObjectField,\n  type ObjectSchemaType,\n  type Path,\n  type SchemaType,\n} from '@sanity/types'\n\nimport {getItemKeySegment, pathsAreEqual, pathToString} from '../../paths'\nimport {getArrayDiffItemType} from '../../schema/helpers'\nimport {\n  type ArrayDiff,\n  type ChangeNode,\n  type ChangeTitlePath,\n  type Diff,\n  type DiffComponent,\n  type FieldChangeNode,\n  type ItemDiff,\n  type ObjectDiff,\n} from '../../types'\nimport {hasPTMemberType} from '../../types/portableText/diff/helpers'\nimport {getValueError} from '../../validation'\nimport {isFieldChange} from '../helpers'\nimport {resolveDiffComponent} from '../resolve/resolveDiffComponent'\n\ninterface DiffContext {\n  itemDiff?: ItemDiff\n  parentDiff?: ArrayDiff | ObjectDiff\n  parentSchema?: ArraySchemaType | ObjectSchemaType\n  fieldFilter?: string[]\n}\n\nexport function buildChangeList(\n  schemaType: SchemaType,\n  diff: Diff,\n  path: Path = [],\n  titlePath: ChangeTitlePath = [],\n  context: DiffContext = {},\n): ChangeNode[] {\n  const diffComponent = resolveDiffComponent(schemaType, context.parentSchema)\n\n  if (!diffComponent) {\n    if (schemaType.jsonType === 'object' && diff.type === 'object') {\n      return buildObjectChangeList(schemaType as ObjectSchemaType, diff, path, titlePath, context)\n    }\n\n    if (schemaType.jsonType === 'array' && diff.type === 'array') {\n      return buildArrayChangeList(schemaType, diff, path, titlePath)\n    }\n  }\n\n  return getFieldChange(schemaType, diff, path, titlePath, context)\n}\n\nexport function buildObjectChangeList(\n  schemaType: ObjectSchemaType,\n  diff: ObjectDiff,\n  path: Path = [],\n  titlePath: ChangeTitlePath = [],\n  diffContext: DiffContext = {},\n): ChangeNode[] {\n  const changes: ChangeNode[] = []\n\n  const childContext: DiffContext = {...diffContext, parentSchema: schemaType}\n  const fieldSets =\n    schemaType.fieldsets || schemaType.fields.map((field) => ({single: true, field}))\n  for (const fieldSet of fieldSets) {\n    if (fieldSet.single) {\n      changes.push(...buildFieldChange(fieldSet.field, diff, path, titlePath, childContext))\n    } else {\n      changes.push(\n        ...buildFieldsetChangeList(fieldSet as MultiFieldSet, diff, path, titlePath, childContext),\n      )\n    }\n  }\n\n  if (changes.length < 2) {\n    return changes\n  }\n\n  return [\n    {\n      type: 'group',\n      key: pathToString(path) || 'root',\n      path,\n      titlePath,\n      changes: reduceTitlePaths(changes, titlePath.length),\n      schemaType,\n    },\n  ]\n}\n\nexport function buildFieldChange(\n  field: ObjectField,\n  diff: ObjectDiff,\n  path: Path,\n  titlePath: ChangeTitlePath,\n  diffContext: DiffContext & {fieldFilter?: string[]} = {},\n): ChangeNode[] {\n  const {fieldFilter, ...context} = diffContext\n  const fieldDiff = diff.fields[field.name]\n  if (!fieldDiff || !fieldDiff.isChanged || (fieldFilter && !fieldFilter.includes(field.name))) {\n    return []\n  }\n\n  const fieldPath = path.concat([field.name])\n  const fieldTitlePath = titlePath.concat([field.type.title || field.name])\n  return buildChangeList(field.type as any, fieldDiff, fieldPath, fieldTitlePath, context)\n}\n\nexport function buildFieldsetChangeList(\n  fieldSet: MultiFieldSet,\n  diff: ObjectDiff,\n  path: Path,\n  titlePath: ChangeTitlePath,\n  diffContext: DiffContext & {fieldFilter?: string[]} = {},\n): ChangeNode[] {\n  const {fields, name, title, readOnly, hidden} = fieldSet\n  const {fieldFilter, ...context} = diffContext\n\n  const fieldSetHidden = hidden\n  const fieldsetReadOnly = readOnly\n\n  const fieldSetTitlePath = titlePath.concat([title || name])\n  const changes: ChangeNode[] = []\n\n  for (const field of fields) {\n    const fieldDiff = diff.fields[field.name]\n    if (!fieldDiff || !fieldDiff.isChanged || (fieldFilter && !fieldFilter.includes(field.name))) {\n      continue\n    }\n\n    const fieldPath = path.concat([field.name])\n    const fieldTitlePath = fieldSetTitlePath.concat([field.type.title || field.name])\n    changes.push(\n      ...buildChangeList(\n        {\n          readOnly: fieldsetReadOnly,\n          hidden: fieldSetHidden,\n          ...field.type,\n        } as any,\n        fieldDiff,\n        fieldPath,\n        fieldTitlePath,\n        context,\n      ),\n    )\n  }\n\n  if (changes.length < 2) {\n    return changes\n  }\n\n  return [\n    {\n      type: 'group',\n      key: pathToString(path) || 'root',\n      fieldsetName: name,\n      path,\n      titlePath: fieldSetTitlePath,\n      changes: reduceTitlePaths(changes, fieldSetTitlePath.length),\n      readOnly: fieldsetReadOnly,\n      hidden: fieldSetHidden,\n    },\n  ]\n}\n\nexport function buildArrayChangeList(\n  schemaType: ArraySchemaType,\n  diff: ArrayDiff,\n  path: Path = [],\n  titlePath: ChangeTitlePath = [],\n): ChangeNode[] {\n  const changedOrMoved = diff.items.filter(\n    (item) =>\n      (item.hasMoved && item.fromIndex !== item.toIndex) || item.diff.action !== 'unchanged',\n  )\n\n  if (changedOrMoved.length === 0) {\n    return []\n  }\n\n  const isPortableText = hasPTMemberType(schemaType)\n  const list: ChangeNode[] = []\n  const changes = changedOrMoved.reduce((acc, itemDiff) => {\n    const memberTypes = getArrayDiffItemType(itemDiff.diff, schemaType)\n    const memberType = memberTypes.toType || memberTypes.fromType\n    if (!memberType) {\n      // eslint-disable-next-line no-console\n      console.warn('Could not determine schema type for item at %s', pathToString(path))\n      return acc\n    }\n\n    const segment =\n      getItemKeySegment(itemDiff.diff.fromValue) ||\n      getItemKeySegment(itemDiff.diff.toValue) ||\n      diff.items.indexOf(itemDiff)\n\n    const itemPath = path.concat(segment)\n    const itemContext: DiffContext = {itemDiff, parentDiff: diff, parentSchema: schemaType}\n    const itemTitlePath = titlePath.concat({\n      hasMoved: itemDiff.hasMoved,\n      toIndex: itemDiff.toIndex,\n      fromIndex: itemDiff.fromIndex,\n      annotation:\n        itemDiff.diff.action === 'unchanged' ? itemDiff.annotation : itemDiff.diff.annotation,\n    })\n\n    const attachItemDiff = (change: ChangeNode): ChangeNode => {\n      if (change.type === 'field' && pathsAreEqual(itemPath, change.path)) {\n        change.itemDiff = itemDiff\n      }\n\n      return change\n    }\n\n    const children = buildChangeList(\n      memberType,\n      itemDiff.diff,\n      itemPath,\n      itemTitlePath,\n      itemContext,\n    ).map(attachItemDiff)\n\n    if (isPortableText) {\n      children.filter(isFieldChange).forEach((field, index, siblings) => {\n        field.showHeader = siblings.length === 1\n        field.showIndex = itemDiff.fromIndex !== itemDiff.toIndex && itemDiff.hasMoved\n      })\n    }\n\n    if (children.length === 0) {\n      // This can happen when there are no changes to the actual element, it's just been moved\n      acc.push(...getFieldChange(memberType, itemDiff.diff, itemPath, itemTitlePath, itemContext))\n    } else {\n      acc.push(...children)\n    }\n\n    return acc\n  }, list)\n\n  if (changes.length > 1) {\n    return [\n      {\n        type: 'group',\n        key: pathToString(path) || 'root',\n        path,\n        titlePath,\n        changes: reduceTitlePaths(changes, titlePath.length),\n        schemaType,\n      },\n    ]\n  }\n\n  return changes\n}\n\nfunction getFieldChange(\n  schemaType: SchemaType,\n  diff: Diff,\n  path: Path,\n  titlePath: ChangeTitlePath,\n  {itemDiff, parentDiff, parentSchema}: DiffContext = {},\n): FieldChangeNode[] {\n  const {fromValue, toValue, type} = diff\n\n  // Treat undefined => [] as no change\n  if (type === 'array' && isEmpty(fromValue) && isEmpty(toValue)) {\n    return []\n  }\n\n  let error\n  if (typeof fromValue !== 'undefined') {\n    error = getValueError(fromValue, schemaType)\n  }\n\n  if (!error && typeof toValue !== 'undefined') {\n    error = getValueError(toValue, schemaType)\n  }\n\n  let showHeader = true\n  let component: DiffComponent | undefined\n\n  const diffComponent = resolveDiffComponent(schemaType, parentSchema)\n  if (diffComponent && typeof diffComponent === 'function') {\n    // Just a diff component with default options\n    component = diffComponent\n  } else if (diffComponent) {\n    // Diff component with options\n    component = (diffComponent as any).component\n    showHeader =\n      typeof (diffComponent as any).showHeader === 'undefined'\n        ? showHeader\n        : (diffComponent as any).showHeader\n  }\n\n  return [\n    {\n      type: 'field',\n      diff,\n      path,\n      error,\n      itemDiff,\n      parentDiff,\n      titlePath,\n      schemaType,\n      showHeader,\n      showIndex: true,\n      key: pathToString(path) || 'root',\n      diffComponent: error ? undefined : component,\n      parentSchema,\n    },\n  ]\n}\n\nfunction reduceTitlePaths(changes: ChangeNode[], byLength = 1): ChangeNode[] {\n  return changes.map((change) => {\n    change.titlePath = change.titlePath.slice(byLength)\n    return change\n  })\n}\n\nfunction isEmpty(item: unknown): boolean {\n  return (Array.isArray(item) && item.length === 0) || item === null || typeof item === 'undefined'\n}\n","import {type Path, type PathSegment} from '@sanity/types'\n\nimport {getItemKey} from '../../paths'\nimport {type ChangeNode, type FieldChangeNode} from '../../types'\n\nconst isAddedAction = (change: ChangeNode): boolean => {\n  return change.type === 'field' && change.diff.action === 'added'\n}\n\nconst flattenChangeNode = (changeNode: ChangeNode): FieldChangeNode[] => {\n  if (changeNode.type !== 'group') {\n    return [changeNode]\n  }\n\n  const newSubChanges: FieldChangeNode[] = []\n\n  changeNode.changes.forEach((cChange) => {\n    newSubChanges.push(...flattenChangeNode(cChange))\n  })\n\n  return newSubChanges\n}\n\n/**\n * Checks whether a path is under another path within the tree.\n */\nconst isSubpathOf = (subPath: Path, parentPath: Path): boolean => {\n  if (parentPath.length >= subPath.length) {\n    return false\n  }\n\n  for (let i = 0; i < parentPath.length; i++) {\n    if (parentPath[i] !== subPath[i]) {\n      return false\n    }\n  }\n\n  return true\n}\n\nconst pathSegmentOfCorrectType = (item: Record<string, unknown>, child: string): PathSegment => {\n  const nextItem = item[child]\n\n  const key = getItemKey(nextItem)\n\n  if (key) {\n    return {_key: key}\n  }\n\n  const isArray = Array.isArray(item)\n\n  if (isArray) {\n    return parseInt(child, 10)\n  }\n\n  return child\n}\n\nexport {flattenChangeNode, isAddedAction, isSubpathOf, pathSegmentOfCorrectType}\n","import {\n  isIndexSegment,\n  isKeyedObject,\n  isKeySegment,\n  isTypedObject,\n  type PatchOperations,\n  type Path,\n} from '@sanity/types'\nimport {\n  diffItem,\n  type DiffOptions,\n  type InsertAfterPatch,\n  type SetPatch,\n  type UnsetPatch,\n} from 'sanity-diff-patch'\n\nimport {isRecord} from '../../../util'\nimport {\n  findIndex,\n  getItemKeySegment,\n  getValueAtPath,\n  isEmptyObject,\n  pathToString,\n} from '../../paths'\nimport {\n  type ArrayDiff,\n  type ChangeNode,\n  type Diff,\n  type FieldOperationsAPI,\n  type ItemDiff,\n  type ObjectDiff,\n} from '../../types'\nimport {flattenChangeNode, isAddedAction, isSubpathOf, pathSegmentOfCorrectType} from './helpers'\n\nconst diffOptions: DiffOptions = {\n  diffMatchPatch: {enabled: false, lengthThresholdAbsolute: 30, lengthThresholdRelative: 1.2},\n}\n\nexport function undoChange(\n  change: ChangeNode,\n  rootDiff: ObjectDiff | null,\n  documentOperations: FieldOperationsAPI,\n): void {\n  if (!rootDiff) {\n    return\n  }\n\n  const patches: PatchOperations[] = []\n\n  if (change.type === 'group') {\n    const allChanges = flattenChangeNode(change)\n\n    const unsetChanges = allChanges.filter(isAddedAction)\n\n    allChanges\n      .filter((child) => !isAddedAction(child))\n      .forEach((child) => undoChange(child, rootDiff, documentOperations))\n\n    patches.push(\n      ...buildUnsetPatches(rootDiff, unsetChanges.map((unsetChange) => unsetChange.path).reverse()),\n    )\n  } else if (change.diff.action === 'added') {\n    // The reverse of an add operation is an unset -\n    // so we don't need to worry about moved items in this case\n    patches.push(...buildUnsetPatches(rootDiff, [change.path]))\n  } else if (\n    change.type === 'field' &&\n    change.itemDiff &&\n    change.parentDiff &&\n    change.parentDiff.type === 'array' &&\n    change.itemDiff.hasMoved\n  ) {\n    // If an array item has moved, we need to unset + insert it again\n    // (we lack a \"move\" patch currently)\n    patches.push(...buildMovePatches(change.itemDiff, change.parentDiff, change.path))\n  } else {\n    // For all other operations, try to find the most optimal case\n    patches.push(...buildUndoPatches(change.diff, rootDiff, change.path))\n  }\n\n  documentOperations.patch.execute(patches)\n}\n\nfunction buildUnsetPatch(rootDiff: ObjectDiff, path: Path, concurrentUnsetPaths: Path[]): Path {\n  const previousValue = rootDiff.toValue as Record<string, unknown>\n\n  return furthestEmptyAncestor(previousValue, path, concurrentUnsetPaths)\n}\n\nfunction buildUnsetPatches(rootDiff: ObjectDiff, paths: Path[]): PatchOperations[] {\n  const patches: Path[] = []\n\n  for (let i = 0; i < paths.length; i++) {\n    const unsetByEarlierPatch = patches.some((patch) => isSubpathOf(paths[i], patch))\n\n    if (unsetByEarlierPatch) {\n      continue\n    }\n\n    patches.push(buildUnsetPatch(rootDiff, paths[i], paths))\n  }\n\n  return [{unset: [...new Set(patches.map(pathToString))]}]\n}\n\n/**\n * Find the path to the furthest empty ancestor that's also a stub.\n *\n * Used for removing all stubs when unsetting a nested value.\n */\nfunction furthestEmptyAncestor(\n  /**\n   * The state of the tree before the change was made.\n   */\n  previousValue: Record<string, unknown>,\n  /**\n   * Path of the value to unset. Used for recursing.\n   */\n  currentPath: Path,\n  /**\n   * An optional list of path to forcefully mark as a stub regardless of what it actually is.\n   */\n  ignorePaths: Path[] = [],\n  /**\n   * Same as the first value of currentPath.\n   */\n  initialPath?: Path,\n): Path {\n  if (currentPath.length <= 0) {\n    /*\n     * This means we are at root and no ancestors are stubs. We\n     * can therefore safely unset only the actual value.\n     */\n    if (!initialPath) {\n      /*\n       * Will happen if the function is started with `currentPath = []`.\n       */\n      throw new Error('Root has no ancestor')\n    }\n\n    return initialPath\n  }\n\n  const ancestorPath = currentPath.slice(0, -1)\n  const ancestorValue = getValueAtPath(previousValue, ancestorPath)\n\n  /*\n   * If the ancestor also is a stub we can add it to the ignore-list\n   * so it'll be \"remembered\" as a stub without us having to scan\n   * the whole tree again.\n   */\n  const updatedIgnorePaths = [\n    ancestorPath,\n\n    /*\n     * We can filter out all the subpaths from under this ancestor\n     * because since we ignore it higher up in the tree it doesn't\n     * matter anymore what the values of subpaths are.\n     */\n    ...ignorePaths.filter((path) => !isSubpathOf(path, ancestorPath)),\n  ]\n\n  return isStub(ancestorValue, ancestorPath, ignorePaths)\n    ? furthestEmptyAncestor(previousValue, ancestorPath, updatedIgnorePaths, initialPath)\n    : currentPath\n}\n\nfunction buildMovePatches(\n  itemDiff: ItemDiff,\n  parentDiff: ArrayDiff,\n  path: Path,\n): PatchOperations[] {\n  const basePath = path.slice(0, -1)\n  const {parentValue, fromIndex, fromValue} = getFromItem(parentDiff, itemDiff)\n\n  let insertLocation\n  if (fromIndex === 0) {\n    // If it was moved from the beginning, we can use a simple prepend\n    insertLocation = {before: pathToString([...basePath, 0])}\n  } else {\n    // Try to use item key segments where possible, falling back to array indexes\n    const prevIndex = fromIndex - 1\n    const prevItemKey = getItemKeySegment(parentValue[prevIndex])\n    const prevSegment = prevItemKey || prevIndex\n    insertLocation = {after: pathToString([...basePath, prevSegment])}\n  }\n\n  return [\n    {\n      unset: [pathToString(path)],\n    },\n    {\n      insert: {...insertLocation, items: [fromValue]} as any,\n    },\n  ]\n}\n\nfunction buildUndoPatches(diff: Diff, rootDiff: ObjectDiff, path: Path): PatchOperations[] {\n  const patches = diffItem(diff.toValue, diff.fromValue, diffOptions, path)\n\n  const inserts = patches\n    .filter((patch): patch is InsertAfterPatch => patch.op === 'insert')\n    .map(({after, items}) => ({insert: {after: pathToString(after), items}}) as any)\n\n  const unsets = patches\n    .filter((patch): patch is UnsetPatch => patch.op === 'unset')\n    .reduce((acc, patch) => acc.concat(pathToString(patch.path)), [] as string[])\n\n  const stubbedPaths = new Set<string>()\n  const stubs: PatchOperations[] = []\n\n  let hasSets = false\n  const sets = patches\n    .filter((patch): patch is SetPatch => patch.op === 'set')\n    .reduce(\n      (acc, patch) => {\n        hasSets = true\n        stubs.push(...getParentStubs(patch.path, rootDiff, stubbedPaths))\n        acc[pathToString(patch.path)] = patch.value\n        return acc\n      },\n      {} as Record<string, unknown>,\n    )\n\n  return [\n    ...stubs,\n    ...inserts,\n    ...(unsets.length > 0 ? [{unset: unsets}] : []),\n    ...(hasSets ? [{set: sets}] : []),\n  ]\n}\n\nfunction getParentStubs(path: Path, rootDiff: ObjectDiff, stubbed: Set<string>): PatchOperations[] {\n  const value = rootDiff.fromValue as Record<string, unknown>\n  const nextValue = rootDiff.toValue as Record<string, unknown>\n  const stubs: PatchOperations[] = []\n\n  for (let i = 1; i <= path.length; i++) {\n    const subPath = path.slice(0, i)\n    const pathStr = pathToString(subPath)\n    if (stubbed.has(pathStr)) {\n      continue\n    }\n\n    const nextSegment = path[i]\n    const nextIsArrayElement = isKeySegment(nextSegment) || isIndexSegment(nextSegment)\n    const itemValue = getValueAtPath(value, subPath)\n    const stub = getStubValue(itemValue)\n\n    // If the next array element does not exist, we need to inject an insert stub here\n    if (\n      nextIsArrayElement &&\n      Array.isArray(itemValue) &&\n      !getValueAtPath(nextValue, path.slice(0, i + 1))\n    ) {\n      const indexAtPrev = findIndex(itemValue, nextSegment)\n      const prevItem = itemValue[indexAtPrev - 1]\n      const nextItem = getValueAtPath(value, subPath.concat(nextSegment))\n      const prevSeg = isKeyedObject(prevItem) ? {_key: prevItem._key} : indexAtPrev - 1\n      const after = pathToString(subPath.concat(indexAtPrev < 1 ? 0 : prevSeg))\n      stubs.push({setIfMissing: {[pathStr]: []}})\n      stubs.push({insert: {after, items: [getStubValue(nextItem)]} as any})\n\n      i++\n      continue\n    }\n\n    if (typeof stub === 'undefined') {\n      continue\n    }\n\n    stubbed.add(pathStr)\n    stubs.push({setIfMissing: {[pathStr]: stub as Record<string, unknown>}})\n  }\n  return stubs\n}\n\n/**\n * Check if all items in an object or an array are stubs.\n */\nfunction onlyContainsStubs(\n  /**\n   * The item to check whether is a stub.\n   */\n  item: unknown,\n  /**\n   * The path to the item we're checking.\n   */\n  path: Path,\n  /**\n   * An optional list of path to forcefully mark as a stub regardless of what it actually is.\n   */\n  ignorePaths?: Path[],\n): boolean {\n  /*\n   * If we're trying to check for stubs inside something which isn't an object\n   * or an array we're checking a string for example and it they cannot\n   * contain stubs.\n   */\n  if (!isRecord(item) || !Array.isArray(item)) {\n    return false\n  }\n\n  for (const child in item) {\n    if (!Object.prototype.hasOwnProperty.call(item, child)) {\n      continue\n    }\n\n    /*\n     * _type or _key field alone doesn't affect whether the field is a stub or\n     * not.\n     */\n    if (child === '_type' || child === '_key') {\n      continue\n    }\n\n    const nextPath = [...path, pathSegmentOfCorrectType(item as Record<string, unknown>, child)]\n\n    if (!isStub(item[child], nextPath, ignorePaths)) {\n      return false\n    }\n  }\n\n  return true\n}\n\nfunction isStub(item: unknown, path: Path, ignorePaths?: Path[]): boolean {\n  const isIgnoredPath = ignorePaths?.some(\n    (ignorePath) => pathToString(ignorePath) === pathToString(path),\n  )\n\n  const isEmptyArray = Array.isArray(item) && item.length <= 0\n\n  return (\n    isIgnoredPath ||\n    item === undefined ||\n    item === null ||\n    isEmptyArray ||\n    isEmptyObject(item) ||\n    onlyContainsStubs(item, path, ignorePaths)\n  )\n}\n\nfunction getStubValue(item: unknown): unknown {\n  if (Array.isArray(item)) {\n    return []\n  }\n\n  if (typeof item !== 'object' || item === null) {\n    return undefined\n  }\n\n  const props: Record<string, unknown> = {}\n\n  if (isKeyedObject(item)) {\n    props._key = item._key\n  }\n\n  if (isTypedObject(item)) {\n    props._type = item._type\n  }\n\n  return props\n}\n\nfunction getFromItem(parentDiff: ArrayDiff, itemDiff: ItemDiff) {\n  if (parentDiff.fromValue && typeof itemDiff.fromIndex === 'number') {\n    const fromValue = parentDiff.fromValue[itemDiff.fromIndex]\n    return {\n      parentValue: parentDiff.fromValue,\n      fromIndex: itemDiff.fromIndex,\n      fromValue,\n    }\n  }\n\n  // Shouldn't ever happen\n  throw new Error(`Failed to find item at index ${itemDiff.fromIndex}`)\n}\n","import {type Path} from '@sanity/types'\nimport {createContext} from 'react'\n\n/** @internal */\nexport const DiffContext = createContext<{path: Path}>({path: []})\n","import styled from 'styled-components'\n\nexport const ChangeListWrapper = styled.div`\n  display: grid;\n  grid-template-columns: minmax(0, 1fr);\n`\n","/** @internal */\n// eslint-disable-next-line no-process-env\nexport const isDev = process.env.NODE_ENV !== 'production'\n\n/** @internal */\nexport const isProd = !isDev\n","import {ErrorOutlineIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Text} from '@sanity/ui'\nimport {Component, type ReactNode} from 'react'\n\nimport {isDev} from '../../../environment'\nimport {type TFunction} from '../../../i18n'\n\n/** @internal */\nexport interface DiffErrorBoundaryProps {\n  children: ReactNode\n  t: TFunction\n}\n\n/** @internal */\nexport interface DiffErrorBoundaryState {\n  error?: Error\n}\n\n/** @internal */\nexport class DiffErrorBoundary extends Component<DiffErrorBoundaryProps, DiffErrorBoundaryState> {\n  static getDerivedStateFromError(error: Error) {\n    return {error}\n  }\n\n  state: DiffErrorBoundaryState = {}\n\n  // eslint-disable-next-line class-methods-use-this\n  componentDidCatch(error: Error) {\n    console.error('Error rendering diff component: ')\n    console.error(error)\n  }\n\n  render() {\n    const {t} = this.props\n    const {error} = this.state\n\n    if (!error) {\n      return this.props.children\n    }\n\n    return (\n      <Card padding={3} radius={2} tone=\"critical\">\n        <Flex>\n          <Text size={1}>\n            <ErrorOutlineIcon />\n          </Text>\n\n          <Box paddingLeft={3}>\n            <Text as=\"h3\" size={1} weight=\"medium\">\n              {t('changes.error-boundary.title')}\n            </Text>\n\n            {isDev && (\n              <Box marginTop={2}>\n                <Text as=\"p\" size={1}>\n                  {t('changes.error-boundary.developer-info')}\n                </Text>\n              </Box>\n            )}\n          </Box>\n        </Flex>\n      </Card>\n    )\n  }\n}\n","import {ArrowDownIcon, ArrowRightIcon} from '@sanity/icons'\nimport {Text, type TextProps} from '@sanity/ui'\nimport {createElement, type HTMLProps} from 'react'\n\n/** @internal */\nexport type FromToArrowDirection = 'down' | 'right'\n\nconst arrowComponents = {\n  down: ArrowDownIcon,\n  right: ArrowRightIcon,\n}\n\n/** @internal */\nexport function FromToArrow(\n  props: {direction?: FromToArrowDirection} & TextProps &\n    Omit<HTMLProps<HTMLDivElement>, 'children' | 'ref'>,\n) {\n  const {direction = 'right', ...restProps} = props\n  const arrowComponent = arrowComponents[direction]\n\n  return (\n    <Text muted size={1} {...restProps}>\n      {createElement(arrowComponent)}\n    </Text>\n  )\n}\n","import {Box, type BoxProps, Card, Code, Stack, Text} from '@sanity/ui'\nimport {type ReactElement, type ReactNode, useCallback, useEffect, useRef, useState} from 'react'\nimport styled, {type ExecutionProps} from 'styled-components'\n\nimport {useTranslation} from '../../../i18n'\nimport {pathToString} from '../../paths'\nimport {type FieldChangeNode} from '../../types'\nimport {FromToArrow} from './FromToArrow'\n\n/** @internal */\nexport interface DiffInspectWrapperProps {\n  children: ReactNode\n  change: FieldChangeNode\n  as?: ExecutionProps['as']\n}\n\nconst CodeWrapper = styled.pre`\n  overflow-x: auto;\n  position: relative;\n`\n\nconst Meta = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n`\n\n/** @internal */\nexport function DiffInspectWrapper(props: DiffInspectWrapperProps & BoxProps): ReactElement {\n  const {children, as, change, ...restProps} = props\n  const isHovering = useRef(false)\n  const [isInspecting, setIsInspecting] = useState(false)\n\n  const toggleInspect = useCallback(() => setIsInspecting((state) => !state), [setIsInspecting])\n  const handleMouseEnter = useCallback(() => (isHovering.current = true), [])\n  const handleMouseLeave = useCallback(() => (isHovering.current = false), [isHovering])\n\n  useEffect(() => {\n    function onKeyDown(evt: KeyboardEvent) {\n      const {metaKey, key} = evt\n      if (metaKey && key === 'i' && isHovering.current) {\n        toggleInspect()\n      }\n    }\n\n    window.addEventListener('keydown', onKeyDown, false)\n    return () => window.removeEventListener('keydown', onKeyDown, false)\n  }, [toggleInspect])\n\n  return (\n    <Box as={as} onMouseEnter={handleMouseEnter} onMouseLeave={handleMouseLeave} {...restProps}>\n      {isInspecting ? <DiffInspector change={change} /> : children}\n    </Box>\n  )\n}\n\nconst MetaLabel = ({title}: {title: string}) => (\n  <Box padding={3} display=\"inline-block\" as={Meta}>\n    <Text muted size={1} weight=\"medium\">\n      {title}\n    </Text>\n  </Box>\n)\n\nfunction DiffInspector({change}: {change: FieldChangeNode}): ReactElement | null {\n  const {t} = useTranslation()\n  return (\n    <Stack space={3}>\n      <Card padding={3} tone=\"transparent\" as={CodeWrapper} radius={1}>\n        <MetaLabel title={t('changes.inspector.meta-label')} />\n        <Code language=\"json\" size={1}>\n          {printMeta({\n            path: pathToString(change.path),\n            fromIndex: change.itemDiff?.fromIndex,\n            toIndex: change.itemDiff?.toIndex,\n            hasMoved: change.itemDiff?.hasMoved,\n            action: change.diff.action,\n            isChanged: change.diff.isChanged,\n          })}\n        </Code>\n      </Card>\n      <Card as={CodeWrapper} tone=\"critical\" padding={3} radius={1}>\n        <MetaLabel title={t('changes.inspector.from-label')} />\n        <Code language=\"json\" size={1}>\n          {jsonify(change.diff.fromValue)}\n        </Code>\n      </Card>\n      <Card>\n        <FromToArrow direction=\"down\" align=\"center\" />\n      </Card>\n      <Card as={CodeWrapper} tone=\"positive\" padding={3} radius={1}>\n        <MetaLabel title={t('changes.inspector.to-label')} />\n        <Code language=\"json\" size={1}>\n          {jsonify(change.diff.toValue)}\n        </Code>\n      </Card>\n    </Stack>\n  )\n}\n\nfunction jsonify(value: unknown) {\n  if (typeof value === 'undefined') {\n    return 'undefined'\n  }\n\n  return JSON.stringify(value, null, 2)\n}\n\nfunction printMeta(keys: Record<string, unknown>) {\n  const lines: string[] = []\n\n  Object.entries(keys).forEach(([key, value]) => {\n    if (typeof value !== 'undefined' && value !== null) {\n      lines.push(`${key}: ${value}`)\n    }\n  })\n\n  return lines.join('\\n')\n}\n","import {useTranslation} from '../../../i18n'\nimport {type Diff} from '../../types'\n\n/** @internal */\nexport function useChangeVerb(diff: Diff): string {\n  const {t} = useTranslation()\n  const hadPrevValue = hasValue(diff.fromValue)\n  const hasNextValue = hasValue(diff.toValue)\n  if (!hadPrevValue && hasNextValue) {\n    return t('changes.added-label')\n  }\n\n  if (!hasNextValue && hadPrevValue) {\n    return t('changes.removed-label')\n  }\n\n  return t('changes.changed-label')\n}\n\n/** @internal */\nfunction hasValue(value: unknown) {\n  return value !== null && typeof value !== 'undefined' && value !== ''\n}\n","import {Flex, Grid, rem, useTheme} from '@sanity/ui'\nimport {forwardRef, type HTMLProps, type ReactNode, useMemo} from 'react'\n\nimport {FromToArrow} from './FromToArrow'\n\n/** @internal */\nexport type FromToProps = {\n  align?: 'top' | 'center' | 'bottom'\n  layout?: 'grid' | 'inline'\n  from?: ReactNode\n  to?: ReactNode\n} & Omit<HTMLProps<HTMLDivElement>, 'children' | 'as' | 'height' | 'wrap'>\n\nconst INLINE_COLUMN_STYLES = {flexShrink: 0}\nconst BLOCK_COLUMN_STYLES = {alignItems: 'stretch'}\n\nconst FLEX_ALIGN: Record<string, 'flex-start' | 'center' | 'flex-end'> = {\n  top: 'flex-start',\n  center: 'center',\n  bottom: 'flex-end',\n  default: 'flex-start',\n}\n\n/** @internal */\nexport const FromTo = forwardRef<HTMLDivElement, FromToProps>(function FromTo(props, ref) {\n  const {align = 'top', layout = 'inline', from, to, style, ...restProps} = props\n  const theme = useTheme()\n\n  const Layout = layout === 'inline' ? Flex : Grid\n  const layoutStyles = useMemo(\n    () => ({\n      ...style,\n      ...(layout === 'inline'\n        ? {maxWidth: '100%', display: 'inline-flex'}\n        : {gridTemplateColumns: `minmax(0, 1fr) ${rem(theme.sanity.space[5])} minmax(0, 1fr)`}),\n    }),\n    [layout, style, theme],\n  )\n\n  const columnStyles = layout === 'inline' ? INLINE_COLUMN_STYLES : BLOCK_COLUMN_STYLES\n\n  return (\n    <Layout {...restProps} ref={ref} style={layoutStyles} data-from-to-layout>\n      {from && (\n        <>\n          <Flex align={FLEX_ALIGN[align]} style={columnStyles}>\n            {from}\n          </Flex>\n          <Flex align=\"center\" justify=\"center\" padding={2}>\n            <FromToArrow />\n          </Flex>\n        </>\n      )}\n      <Flex align={FLEX_ALIGN[align]} style={columnStyles}>\n        {to}\n      </Flex>\n    </Layout>\n  )\n})\n","import {type Path, type SchemaType} from '@sanity/types'\nimport {createElement, type CSSProperties} from 'react'\n\nimport {type FieldPreviewComponent} from '../../preview'\nimport {type Diff} from '../../types'\nimport {useChangeVerb} from '../hooks/useChangeVerb'\nimport {DiffCard} from './DiffCard'\nimport {DiffTooltip} from './DiffTooltip'\nimport {FromTo} from './FromTo'\n\n/** @internal */\nexport interface DiffFromToProps {\n  align?: 'top' | 'center' | 'bottom'\n  cardClassName?: string\n  diff: Diff\n  layout?: 'grid' | 'inline'\n  path?: Path | string\n  previewComponent: FieldPreviewComponent\n  schemaType: SchemaType\n}\n\nconst cardStyles: CSSProperties = {\n  flex: 1,\n  minWidth: 0,\n  display: 'block',\n  whiteSpace: 'break-spaces',\n}\n\n/** @internal */\nexport function DiffFromTo(props: DiffFromToProps) {\n  const {align, cardClassName, diff, layout, path, previewComponent, schemaType} = props\n  const {action} = diff\n  const changeVerb = useChangeVerb(diff)\n\n  if (action === 'unchanged') {\n    return (\n      <DiffCard className={cardClassName} style={cardStyles}>\n        {createElement(previewComponent, {schemaType, value: diff.toValue})}\n      </DiffCard>\n    )\n  }\n\n  const from = diff.fromValue !== undefined && diff.fromValue !== null && (\n    <DiffCard as=\"del\" className={cardClassName} diff={diff} path={path} style={cardStyles}>\n      {createElement(previewComponent, {schemaType, value: diff.fromValue})}\n    </DiffCard>\n  )\n\n  const to = diff.toValue !== undefined && diff.toValue !== null && (\n    <DiffCard as=\"ins\" className={cardClassName} diff={diff} path={path} style={cardStyles}>\n      {createElement(previewComponent, {schemaType, value: diff.toValue})}\n    </DiffCard>\n  )\n\n  if (from && !to) {\n    return (\n      <DiffTooltip description={changeVerb} diff={diff} path={path}>\n        {from}\n      </DiffTooltip>\n    )\n  }\n\n  if (!from && to) {\n    return (\n      <DiffTooltip description={changeVerb} diff={diff} path={path}>\n        {to}\n      </DiffTooltip>\n    )\n  }\n\n  return (\n    <DiffTooltip description={changeVerb} diff={diff} path={path}>\n      <FromTo align={align} from={from} layout={layout} to={to} />\n    </DiffTooltip>\n  )\n}\n","import {Box} from '@sanity/ui'\nimport {type ReactNode} from 'react'\n\nimport {Preview} from '../../../preview/components/Preview'\nimport {type FieldPreviewComponent} from '../../preview'\nimport {type Diff, type DiffComponent} from '../../types'\nimport {DiffFromTo} from './DiffFromTo'\n\nconst FallbackPreview: FieldPreviewComponent<ReactNode> = ({value, schemaType}) => {\n  return (\n    <Box padding={2}>\n      <Preview schemaType={schemaType} value={value as any} layout=\"default\" />\n    </Box>\n  )\n}\n\n/** @internal */\nexport const FallbackDiff: DiffComponent<Diff<unknown, Record<string, unknown>>> = (props) => {\n  const {diff, schemaType} = props\n\n  return (\n    <DiffFromTo\n      diff={diff}\n      schemaType={schemaType}\n      previewComponent={FallbackPreview}\n      layout=\"grid\"\n    />\n  )\n}\n","import {rem} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const FieldChangeContainer = styled.div`\n  --field-change-error: ${({theme}) => theme.sanity.color.solid.critical.enabled.bg};\n  &[data-revert-all-changes-hover] [data-revert-all-hover]::before {\n    border-left: 2px solid var(--field-change-error);\n  }\n`\n\nexport const DiffBorder = styled.div`\n  --field-change-error: ${({theme}) => theme.sanity.color.solid.critical.enabled.bg};\n  --diff-inspect-padding-xsmall: ${({theme}) => rem(theme.sanity.space[1])};\n  --diff-inspect-padding-small: ${({theme}) => rem(theme.sanity.space[2])};\n\n  position: relative;\n  padding: var(--diff-inspect-padding-xsmall) 0 var(--diff-inspect-padding-xsmall)\n    var(--diff-inspect-padding-small);\n\n  &::before {\n    content: '';\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    border-left: 1px solid var(--card-border-color);\n  }\n\n  &[data-error]:hover::before,\n  &[data-revert-field-hover]:hover::before {\n    border-left: 2px solid var(--field-change-error);\n  }\n`\n","import {RevertIcon} from '@sanity/icons'\nimport {type ForwardedRef, forwardRef, type HTMLProps, type ReactElement} from 'react'\nimport styled from 'styled-components'\n\nimport {Button, type ButtonProps} from '../../../../ui-components'\nimport {useTranslation} from '../../../i18n'\n\nconst Root = styled(Button)`\n  [data-ui='Text'] {\n    font-weight: normal;\n  }\n\n  div[data-ui='Box'] {\n    display: none;\n  }\n\n  &:not([data-disabled='true']):hover,\n  &:not([data-disabled='true']):focus {\n    --card-fg-color: ${({theme}) => theme.sanity.color.solid.critical.enabled.bg};\n    --card-bg-color: transparent;\n    --card-border-color: transparent;\n\n    div[data-ui='Box'] {\n      display: block;\n    }\n  }\n`\n\n/** @internal */\nexport const RevertChangesButton = forwardRef(function RevertChangesButton(\n  props: Omit<ButtonProps, 'tooltipProps'> &\n    Omit<HTMLProps<HTMLButtonElement>, 'ref'> & {changeCount: number},\n  ref: ForwardedRef<HTMLButtonElement>,\n): ReactElement {\n  const {selected, changeCount, ...restProps} = props\n  const {t} = useTranslation()\n\n  return (\n    <Root\n      icon={RevertIcon}\n      selected={selected}\n      text={t('changes.action.revert-changes-confirm-change', {count: changeCount})}\n      mode=\"bleed\"\n      ref={ref}\n      tooltipProps={null}\n      {...restProps}\n    />\n  )\n})\n","import {ErrorOutlineIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Text} from '@sanity/ui'\n\nimport {useTranslation} from '../../../i18n'\nimport {type FieldValueError} from '../../validation'\n\n/** @internal */\nexport function ValueError({error}: {error: FieldValueError}) {\n  const {t} = useTranslation()\n  return (\n    <Card tone=\"critical\" padding={3}>\n      <Flex align=\"flex-start\">\n        <Box>\n          <Text>\n            <ErrorOutlineIcon />\n          </Text>\n        </Box>\n        <Box flex={1} paddingLeft={3}>\n          <Text size={1} as=\"p\">\n            {t(error.messageKey, {\n              expectedType: error.expectedType,\n              actualType: error.actualType,\n            })}\n          </Text>\n        </Box>\n      </Flex>\n    </Card>\n  )\n}\n","import {type ObjectSchemaType} from '@sanity/types'\nimport {Box, Flex, Stack, Text, useClickOutside} from '@sanity/ui'\nimport {Fragment, type HTMLAttributes, useCallback, useMemo, useState} from 'react'\n\nimport {Button, Popover} from '../../../../ui-components'\nimport {useDocumentOperation} from '../../../hooks'\nimport {useTranslation} from '../../../i18n'\nimport {useDocumentPairPermissions} from '../../../store'\nimport {type FieldChangeNode, type FieldOperationsAPI} from '../../types'\nimport {undoChange} from '../changes/undoChange'\nimport {DiffContext} from '../contexts/DiffContext'\nimport {useDocumentChange} from '../hooks'\nimport {ChangeBreadcrumb} from './ChangeBreadcrumb'\nimport {DiffErrorBoundary} from './DiffErrorBoundary'\nimport {DiffInspectWrapper} from './DiffInspectWrapper'\nimport {FallbackDiff} from './FallbackDiff'\nimport {DiffBorder, FieldChangeContainer} from './FieldChange.styled'\nimport {RevertChangesButton} from './RevertChangesButton'\nimport {ValueError} from './ValueError'\n\n/** @internal */\nexport function FieldChange(\n  props: {\n    change: FieldChangeNode\n    readOnly?: boolean\n    hidden?: boolean\n  } & HTMLAttributes<HTMLDivElement>,\n) {\n  const {change, hidden, readOnly} = props\n  const DiffComponent = change.diffComponent || FallbackDiff\n  const {\n    documentId,\n    schemaType,\n    rootDiff,\n    isComparingCurrent,\n    FieldWrapper = Fragment,\n  } = useDocumentChange()\n  const ops = useDocumentOperation(documentId, schemaType.name) as FieldOperationsAPI\n  const [confirmRevertOpen, setConfirmRevertOpen] = useState(false)\n  const [revertHovered, setRevertHovered] = useState(false)\n  const [revertButtonElement, setRevertButtonElement] = useState<HTMLDivElement | null>(null)\n  const {t} = useTranslation()\n\n  const [permissions, isPermissionsLoading] = useDocumentPairPermissions({\n    id: documentId,\n    type: schemaType.name,\n    permission: 'update',\n  })\n\n  const handleRevertChanges = useCallback(() => {\n    undoChange(change, rootDiff, ops)\n  }, [change, rootDiff, ops])\n\n  const handleRevertChangesConfirm = useCallback(() => {\n    setConfirmRevertOpen(true)\n  }, [])\n\n  const closeRevertChangesConfirmDialog = useCallback(() => {\n    setConfirmRevertOpen(false)\n  }, [])\n\n  const handleRevertButtonMouseEnter = useCallback(() => {\n    setRevertHovered(true)\n  }, [])\n\n  const handleRevertButtonMouseLeave = useCallback(() => {\n    setRevertHovered(false)\n  }, [])\n\n  const handleClickOutside = useCallback(() => setConfirmRevertOpen(false), [])\n\n  useClickOutside(handleClickOutside, [revertButtonElement])\n\n  const isArray = change.parentSchema?.jsonType === 'array'\n\n  /* this condition is required in order to avoid situations where an array change has happened\n   * but not necessarily an array item change. E.g. when adding one new item to an array, the changes pane\n   * would be able to identify that a new item was addded but not what array it belonged to (because the change path\n   * is only related to the item itself, not the array)\n   */\n  const fieldPath = isArray ? change.path.slice(0, -1) : change.path\n\n  const content = useMemo(\n    () =>\n      hidden ? null : (\n        <Stack space={1} as={FieldChangeContainer}>\n          {change.showHeader && <ChangeBreadcrumb change={change} titlePath={change.titlePath} />}\n\n          <FieldWrapper path={fieldPath} hasHover={revertHovered}>\n            <DiffInspectWrapper\n              change={change}\n              as={DiffBorder}\n              data-revert-field-hover={revertHovered ? '' : undefined}\n              data-error={change.error ? '' : undefined}\n              data-revert-all-hover\n            >\n              {change.error ? (\n                <ValueError error={change.error} />\n              ) : (\n                <DiffErrorBoundary t={t}>\n                  <DiffContext.Provider value={{path: change.path}}>\n                    <DiffComponent\n                      diff={change.diff}\n                      schemaType={change.schemaType as ObjectSchemaType}\n                    />\n                  </DiffContext.Provider>\n                </DiffErrorBoundary>\n              )}\n\n              {isComparingCurrent && !isPermissionsLoading && permissions?.granted && (\n                <Popover\n                  content={\n                    <Stack space={3}>\n                      <Box paddingY={3}>\n                        <Text size={1}>\n                          {t('changes.action.revert-changes-description', {count: 1})}\n                        </Text>\n                      </Box>\n                      <Flex gap={3} justify=\"flex-end\">\n                        <Button\n                          mode=\"ghost\"\n                          onClick={closeRevertChangesConfirmDialog}\n                          text={t('changes.action.revert-all-cancel')}\n                        />\n                        <Button\n                          tone=\"critical\"\n                          onClick={handleRevertChanges}\n                          text={t('changes.action.revert-changes-confirm-change', {count: 1})}\n                        />\n                      </Flex>\n                    </Stack>\n                  }\n                  open={confirmRevertOpen}\n                  padding={3}\n                  portal\n                  placement=\"left\"\n                  ref={setRevertButtonElement}\n                >\n                  <RevertChangesButton\n                    changeCount={1}\n                    onClick={handleRevertChangesConfirm}\n                    onMouseEnter={handleRevertButtonMouseEnter}\n                    onMouseLeave={handleRevertButtonMouseLeave}\n                    selected={confirmRevertOpen}\n                    disabled={readOnly}\n                    data-testid={`single-change-revert-button-${change?.key}`}\n                  />\n                </Popover>\n              )}\n            </DiffInspectWrapper>\n          </FieldWrapper>\n        </Stack>\n      ),\n    [\n      change,\n      closeRevertChangesConfirmDialog,\n      confirmRevertOpen,\n      DiffComponent,\n      fieldPath,\n      FieldWrapper,\n      handleRevertButtonMouseEnter,\n      handleRevertButtonMouseLeave,\n      handleRevertChanges,\n      handleRevertChangesConfirm,\n      hidden,\n      isComparingCurrent,\n      isPermissionsLoading,\n      permissions?.granted,\n      readOnly,\n      revertHovered,\n      t,\n    ],\n  )\n\n  return content\n}\n","import {type MutableRefObject, useEffect, useRef, useState} from 'react'\n\nexport function useHover<T extends HTMLElement>(): [MutableRefObject<T | null>, boolean] {\n  const ref = useRef<T | null>(null)\n  const [value, setValue] = useState(false)\n\n  useEffect(() => {\n    const node = ref.current\n\n    if (!node) {\n      return () => undefined\n    }\n\n    const handleMouseOver = () => setValue(true)\n    const handleMouseOut = () => setValue(false)\n\n    node.addEventListener('mouseover', handleMouseOver)\n    node.addEventListener('mouseout', handleMouseOut)\n\n    return () => {\n      node.removeEventListener('mouseover', handleMouseOver)\n      node.removeEventListener('mouseout', handleMouseOut)\n    }\n  }, [])\n\n  return [ref, value]\n}\n","import {rem} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const ChangeListWrapper = styled.div`\n  display: grid;\n  grid-template-columns: minmax(0, 1fr);\n`\n\nexport const GroupChangeContainer = styled.div`\n  --field-change-error: ${({theme}) => theme.sanity.color.solid.critical.enabled.bg};\n  --diff-inspect-padding-xsmall: ${({theme}) => rem(theme.sanity.space[1])};\n  --diff-inspect-padding-small: ${({theme}) => rem(theme.sanity.space[2])};\n\n  position: relative;\n  padding: var(--diff-inspect-padding-xsmall) var(--diff-inspect-padding-small);\n\n  &::before {\n    content: '';\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    border-left: 1px solid var(--card-border-color);\n  }\n\n  &[data-error]:hover::before,\n  &[data-revert-group-hover]:hover::before,\n  &[data-revert-all-groups-hover]::before {\n    border-left: 2px solid var(--field-change-error);\n  }\n`\n","import {Box, Flex, Stack, Text, useClickOutside} from '@sanity/ui'\nimport {\n  type HTMLAttributes,\n  type ReactElement,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react'\n\nimport {Button, Popover} from '../../../../ui-components'\nimport {useDocumentOperation} from '../../../hooks'\nimport {useTranslation} from '../../../i18n'\nimport {useDocumentPairPermissions} from '../../../store'\nimport {pathsAreEqual} from '../../paths'\nimport {type FieldOperationsAPI, type GroupChangeNode} from '../../types'\nimport {isPTSchemaType} from '../../types/portableText/diff'\nimport {useHover} from '../../utils/useHover'\nimport {undoChange} from '../changes/undoChange'\nimport {DiffContext} from '../contexts/DiffContext'\nimport {isFieldChange} from '../helpers'\nimport {useDocumentChange} from '../hooks'\nimport {ChangeBreadcrumb} from './ChangeBreadcrumb'\nimport {ChangeResolver} from './ChangeResolver'\nimport {ChangeListWrapper, GroupChangeContainer} from './GroupChange.styled'\nimport {RevertChangesButton} from './RevertChangesButton'\n\n/** @internal */\nexport function GroupChange(\n  props: {\n    change: GroupChangeNode\n    readOnly?: boolean\n    hidden?: boolean\n  } & HTMLAttributes<HTMLDivElement>,\n): ReactElement | null {\n  const {change: group, readOnly, hidden, ...restProps} = props\n  const {titlePath, changes, path: groupPath} = group\n  const {path: diffPath} = useContext(DiffContext)\n  const {documentId, schemaType, FieldWrapper, rootDiff, isComparingCurrent} = useDocumentChange()\n  const {t} = useTranslation()\n\n  const isPortableText = changes.every(\n    (change) => isFieldChange(change) && isPTSchemaType(change.schemaType),\n  )\n\n  const isNestedInDiff = pathsAreEqual(diffPath, groupPath)\n  const [revertButtonRef, isRevertButtonHovered] = useHover<HTMLButtonElement>()\n\n  const docOperations = useDocumentOperation(documentId, schemaType.name) as FieldOperationsAPI\n  const [confirmRevertOpen, setConfirmRevertOpen] = useState(false)\n  const [revertPopoverElement, setRevertPopoverElement] = useState<HTMLDivElement | null>(null)\n\n  const [permissions, isPermissionsLoading] = useDocumentPairPermissions({\n    id: documentId,\n    type: schemaType.name,\n    permission: 'update',\n  })\n\n  const handleRevertChanges = useCallback(\n    () => undoChange(group, rootDiff, docOperations),\n    [group, rootDiff, docOperations],\n  )\n\n  const handleRevertChangesConfirm = useCallback(() => {\n    setConfirmRevertOpen(true)\n  }, [])\n\n  const closeRevertChangesConfirmDialog = useCallback(() => {\n    setConfirmRevertOpen(false)\n  }, [])\n\n  useClickOutside(() => setConfirmRevertOpen(false), [revertPopoverElement])\n\n  const content = useMemo(\n    () =>\n      hidden ? null : (\n        <Stack\n          space={1}\n          as={GroupChangeContainer}\n          data-revert-group-hover={isRevertButtonHovered ? '' : undefined}\n          data-portable-text={isPortableText ? '' : undefined}\n        >\n          <Stack as={ChangeListWrapper} space={5}>\n            {changes.map((change) => (\n              <ChangeResolver\n                key={change.key}\n                change={change}\n                readOnly={readOnly}\n                hidden={hidden}\n              />\n            ))}\n          </Stack>\n          {isComparingCurrent && !isPermissionsLoading && permissions?.granted && (\n            <Popover\n              content={\n                <Stack space={3}>\n                  <Box paddingY={3}>\n                    <Text size={1}>\n                      {t('changes.action.revert-changes-description', {count: changes.length})}\n                    </Text>\n                  </Box>\n                  <Flex gap={3} justify=\"flex-end\">\n                    <Button\n                      mode=\"ghost\"\n                      onClick={closeRevertChangesConfirmDialog}\n                      text={t('changes.action.revert-all-cancel')}\n                    />\n                    <Button\n                      tone=\"critical\"\n                      onClick={handleRevertChanges}\n                      text={t('changes.action.revert-changes-confirm-change', {count: 1})}\n                    />\n                  </Flex>\n                </Stack>\n              }\n              padding={3}\n              portal\n              placement=\"left\"\n              open={confirmRevertOpen}\n              ref={setRevertPopoverElement}\n            >\n              <Box>\n                <RevertChangesButton\n                  changeCount={changes.length}\n                  onClick={handleRevertChangesConfirm}\n                  ref={revertButtonRef}\n                  selected={confirmRevertOpen}\n                  disabled={readOnly}\n                  data-testid={`group-change-revert-button-${group.fieldsetName}`}\n                />\n              </Box>\n            </Popover>\n          )}\n        </Stack>\n      ),\n    [\n      changes,\n      closeRevertChangesConfirmDialog,\n      confirmRevertOpen,\n      group.fieldsetName,\n      handleRevertChanges,\n      handleRevertChangesConfirm,\n      hidden,\n      isComparingCurrent,\n      isPermissionsLoading,\n      isPortableText,\n      isRevertButtonHovered,\n      permissions?.granted,\n      readOnly,\n      revertButtonRef,\n      t,\n    ],\n  )\n\n  return hidden ? null : (\n    <Stack space={1} {...restProps}>\n      <ChangeBreadcrumb titlePath={titlePath} />\n      {isNestedInDiff || !FieldWrapper ? (\n        content\n      ) : (\n        <FieldWrapper hasHover={isRevertButtonHovered} path={group.path}>\n          {content}\n        </FieldWrapper>\n      )}\n    </Stack>\n  )\n}\n","import {type ConditionalProperty, type SanityDocument} from '@sanity/types'\nimport {Text} from '@sanity/ui'\n\nimport {unstable_useConditionalProperty as useConditionalProperty} from '../../conditional-property'\nimport {type ChangeNode} from '../../types'\nimport {useDocumentChange} from '../hooks'\nimport {FieldChange} from './FieldChange'\nimport {GroupChange} from './GroupChange'\n\n/** @internal */\nexport interface ChangeResolverProps {\n  change: ChangeNode\n  readOnly?: ConditionalProperty\n  hidden?: ConditionalProperty\n}\n\n/** @internal */\nexport function ChangeResolver(props: ChangeResolverProps) {\n  const {change, hidden, readOnly} = props\n  const {value} = useDocumentChange()\n\n  const isHidden = useConditionalProperty({\n    // @todo: is parent missing here?\n    document: value as SanityDocument,\n    checkProperty: hidden || change.schemaType?.hidden,\n    checkPropertyKey: 'hidden',\n    value: change.type === 'field' ? change.diff.toValue : undefined,\n  })\n\n  const isReadOnly = useConditionalProperty({\n    // @todo: is parent missing here?\n    document: value as SanityDocument,\n    checkProperty: readOnly || change.schemaType?.readOnly,\n    checkPropertyKey: 'readOnly',\n    value: change.type === 'field' ? change.diff.toValue : undefined,\n  })\n\n  if (isHidden) return null\n\n  if (change.type === 'field') {\n    return <FieldChange change={change} readOnly={isReadOnly} />\n  }\n\n  if (change.type === 'group') {\n    return (\n      <GroupChange\n        change={change}\n        data-testid={`group-change-${change.fieldsetName}`}\n        readOnly={isReadOnly}\n      />\n    )\n  }\n\n  return (\n    // eslint-disable-next-line i18next/no-literal-string\n    <Text>\n      Unknown change type: <code>{(change as any).type || 'undefined'}</code>\n    </Text>\n  )\n}\n","import {Stack, Text} from '@sanity/ui'\n\nimport {useTranslation} from '../../../i18n'\n\n/** @internal */\nexport function NoChanges() {\n  const {t} = useTranslation()\n  return (\n    <Stack space={3}>\n      <Text size={1} weight=\"medium\" as=\"h3\">\n        {t('changes.no-changes-title')}\n      </Text>\n      <Text as=\"p\" size={1} muted>\n        {t('changes.no-changes-description')}\n      </Text>\n    </Stack>\n  )\n}\n","import {type SanityDocument} from '@sanity/client'\nimport {RevertIcon} from '@sanity/icons'\nimport {type ObjectSchemaType} from '@sanity/types'\nimport {Box, Card, Flex, Stack, Text, useClickOutside} from '@sanity/ui'\nimport {type ReactElement, useCallback, useContext, useMemo, useState} from 'react'\n\nimport {Button, Popover} from '../../../../ui-components'\nimport {useDocumentOperation} from '../../../hooks'\nimport {useTranslation} from '../../../i18n'\nimport {useDocumentPairPermissions} from '../../../store'\nimport {unstable_useConditionalProperty as useConditionalProperty} from '../../conditional-property'\nimport {type ChangeNode, type FieldOperationsAPI, type ObjectDiff} from '../../types'\nimport {buildObjectChangeList} from '../changes/buildChangeList'\nimport {undoChange} from '../changes/undoChange'\nimport {DiffContext} from '../contexts/DiffContext'\nimport {useDocumentChange} from '../hooks/useDocumentChange'\nimport {ChangeListWrapper} from './ChangeList.styled'\nimport {ChangeResolver} from './ChangeResolver'\nimport {NoChanges} from './NoChanges'\n\n/** @internal */\nexport interface ChangeListProps {\n  schemaType: ObjectSchemaType\n  diff: ObjectDiff\n  fields?: string[]\n}\n\n/** @internal */\nexport function ChangeList({diff, fields, schemaType}: ChangeListProps): ReactElement | null {\n  const {documentId, isComparingCurrent, value} = useDocumentChange()\n  const docOperations = useDocumentOperation(documentId, schemaType.name) as FieldOperationsAPI\n  const {path} = useContext(DiffContext)\n  const isRoot = path.length === 0\n  const [confirmRevertAllOpen, setConfirmRevertAllOpen] = useState(false)\n  const [confirmRevertAllHover, setConfirmRevertAllHover] = useState(false)\n  const {t} = useTranslation()\n\n  const isReadOnly = useConditionalProperty({\n    document: value as SanityDocument,\n    value: undefined,\n    checkProperty: schemaType.readOnly,\n    checkPropertyKey: 'readOnly',\n  })\n\n  if (schemaType.jsonType !== 'object') {\n    throw new Error(`Only object schema types are allowed in ChangeList`)\n  }\n\n  const [permissions, isPermissionsLoading] = useDocumentPairPermissions({\n    id: documentId,\n    type: schemaType.name,\n    permission: 'update',\n  })\n\n  const allChanges = useMemo(\n    () => buildObjectChangeList(schemaType, diff, path, [], {fieldFilter: fields}),\n    [schemaType, fields, path, diff],\n  )\n\n  const changes = useMemo(\n    () => (fields && fields.length === 0 ? [] : maybeFlatten(allChanges)),\n    [allChanges, fields],\n  )\n\n  const rootChange = allChanges[0]\n\n  const revertAllChanges = useCallback(() => {\n    undoChange(rootChange, diff, docOperations)\n    setConfirmRevertAllOpen(false)\n  }, [rootChange, diff, docOperations])\n\n  const handleRevertAllChangesClick = useCallback(() => {\n    setConfirmRevertAllOpen(true)\n  }, [])\n\n  const handleRevertAllChangesMouseEnter = useCallback(() => {\n    setConfirmRevertAllHover(true)\n  }, [])\n\n  const handleRevertAllChangesMouseLeave = useCallback(() => {\n    setConfirmRevertAllHover(false)\n  }, [])\n\n  const closeRevertAllChangesConfirmDialog = useCallback(() => {\n    setConfirmRevertAllOpen(false)\n  }, [])\n\n  const [revertAllContainerElement, setRevertAllContainerElement] = useState<HTMLDivElement | null>(\n    null,\n  )\n\n  const handleClickOutside = useCallback(() => setConfirmRevertAllOpen(false), [])\n\n  useClickOutside(handleClickOutside, [revertAllContainerElement])\n\n  if (changes.length === 0) {\n    return isRoot ? <NoChanges /> : null\n  }\n\n  const showFooter = isRoot && changes.length > 1\n\n  return (\n    <Card>\n      <Stack space={5}>\n        <Stack as={ChangeListWrapper} space={5}>\n          {changes.map((change) => (\n            <div key={change.key}>\n              <ChangeResolver\n                change={change}\n                key={change.key}\n                data-revert-all-changes-hover={confirmRevertAllHover ? '' : undefined}\n                readOnly={isReadOnly || change?.readOnly}\n                hidden={change?.hidden}\n              />\n            </div>\n          ))}\n        </Stack>\n\n        {showFooter && isComparingCurrent && !isPermissionsLoading && permissions?.granted && (\n          <Popover\n            content={\n              <Stack space={3}>\n                <Box paddingY={3}>\n                  <Text size={1}>\n                    {t('changes.action.revert-all-description', {\n                      count: changes.length,\n                    })}\n                  </Text>\n                </Box>\n                <Flex gap={3} justify=\"flex-end\">\n                  <Button\n                    mode=\"ghost\"\n                    text={t('changes.action.revert-all-cancel')}\n                    onClick={closeRevertAllChangesConfirmDialog}\n                  />\n                  <Button\n                    tone=\"critical\"\n                    text={t('changes.action.revert-all-confirm')}\n                    onClick={revertAllChanges}\n                  />\n                </Flex>\n              </Stack>\n            }\n            open={confirmRevertAllOpen}\n            padding={3}\n            placement={'left'}\n            portal\n            ref={setRevertAllContainerElement}\n          >\n            <Stack>\n              <Button\n                tone=\"critical\"\n                mode=\"ghost\"\n                text={t('changes.action.revert-all-confirm')}\n                icon={RevertIcon}\n                onClick={handleRevertAllChangesClick}\n                onMouseEnter={handleRevertAllChangesMouseEnter}\n                onMouseLeave={handleRevertAllChangesMouseLeave}\n                disabled={isReadOnly}\n                size=\"large\"\n              />\n            </Stack>\n          </Popover>\n        )}\n      </Stack>\n    </Card>\n  )\n}\n\nfunction maybeFlatten(changes: ChangeNode[]) {\n  return changes.length === 1 && changes[0].type === 'group' && changes[0].path.length === 0\n    ? changes[0].changes\n    : changes\n}\n","import {Card, rem, Text} from '@sanity/ui'\nimport {type ReactElement} from 'react'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../i18n'\nimport {type StringDiff, type StringDiffSegment} from '../../types'\nimport {DiffCard} from './DiffCard'\n\nconst RoundedCard = styled.span`\n  border-radius: ${({theme}) => rem(theme.sanity.radius[1])};\n`\n\nconst ChangeSegment = styled(Text)`\n  &:not([hidden]) {\n    display: inline;\n    line-height: calc(1.25em + 2px);\n  }\n\n  &:hover {\n    background-color: none !important;\n    background-image: linear-gradient(\n      to bottom,\n      var(--card-bg-color) 0,\n      var(--card-bg-color) 33.333%,\n      currentColor 33.333%,\n      currentColor 100%\n    );\n    background-size: 1px 3px;\n    background-repeat: repeat-x;\n    background-position-y: bottom;\n    padding-bottom: 3px;\n    box-shadow: 0 0 0 1px var(--card-bg-color);\n    z-index: 1;\n  }\n`\n\n/** @internal */\nexport function DiffStringSegment(props: {segment: StringDiffSegment}): ReactElement {\n  const {segment} = props\n  const {text} = segment\n  const {t} = useTranslation()\n\n  if (segment.action === 'added') {\n    return (\n      <DiffCard\n        annotation={segment.annotation}\n        disableHoverEffect\n        tooltip={{description: t('changes.added-label')}}\n        as={RoundedCard}\n      >\n        <ChangeSegment as=\"ins\" style={{textDecoration: 'none'}}>\n          {text}\n        </ChangeSegment>\n      </DiffCard>\n    )\n  }\n\n  if (segment.action === 'removed') {\n    return (\n      <DiffCard\n        annotation={segment.annotation}\n        as={RoundedCard}\n        disableHoverEffect\n        tooltip={{description: t('changes.removed-label')}}\n      >\n        <ChangeSegment as=\"del\">{text}</ChangeSegment>\n      </DiffCard>\n    )\n  }\n\n  return (\n    <Card as=\"span\" radius={2} style={{display: 'inline'}}>\n      {text}\n    </Card>\n  )\n}\n\n/** @internal */\nexport function DiffString(props: {diff: StringDiff}) {\n  const {diff} = props\n\n  return (\n    <>\n      {(diff.segments || []).map((segment, segmentIndex) => (\n        <DiffStringSegment\n          // eslint-disable-next-line react/no-array-index-key\n          key={segmentIndex}\n          segment={segment}\n        />\n      ))}\n    </>\n  )\n}\n","import {Box, Flex, Stack, Text} from '@sanity/ui'\nimport {type ComponentType, createElement, type ReactNode} from 'react'\nimport styled from 'styled-components'\n\n/** @internal */\nexport interface MetaInfoProps {\n  title: string\n  action?: string\n  icon?: ComponentType\n  children?: ReactNode\n  markRemoved?: boolean\n}\n\nconst MetaText = styled(Text)`\n  color: inherit;\n`\n\n/** @internal */\nexport function MetaInfo(props: MetaInfoProps) {\n  const {title, action, icon, children, markRemoved} = props\n\n  return (\n    <Flex padding={2} align=\"center\">\n      {icon && (\n        <Box padding={2}>\n          <MetaText size={4} forwardedAs={markRemoved ? 'del' : 'div'}>\n            {createElement(icon)}\n          </MetaText>\n        </Box>\n      )}\n\n      <Stack space={2} paddingLeft={2}>\n        <MetaText\n          size={1}\n          weight=\"medium\"\n          forwardedAs={markRemoved ? 'del' : 'h3'}\n          textOverflow=\"ellipsis\"\n        >\n          {title}\n        </MetaText>\n\n        {action && <div>{action}</div>}\n\n        <MetaText size={0} textOverflow=\"ellipsis\">\n          {children}\n        </MetaText>\n      </Stack>\n    </Flex>\n  )\n}\n","import {type Slug} from '@sanity/types'\nimport {Box} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {type FieldPreviewComponent} from '../../../preview'\n\nconst SlugWrapper = styled.div`\n  display: inline-block;\n  word-break: break-all;\n  white-space: pre-wrap;\n`\n\nexport const SlugPreview: FieldPreviewComponent<Slug> = (props) => {\n  const {value} = props\n\n  return (\n    <Box as={SlugWrapper} paddingX={2} paddingY={1}>\n      {value.current}\n    </Box>\n  )\n}\n","/**\n * Reconciles two versions of a state tree by iterating over the next and deep comparing against the next towards the previous.\n * Wherever identical values are found, the previous value is kept, preserving object identities for arrays and objects where possible\n * @param previous - the previous value\n * @param next - the next/current value\n */\nexport function immutableReconcile<T>(previous: unknown, next: T): T {\n  return _immutableReconcile(previous, next, new WeakSet())\n}\n\nfunction _immutableReconcile<T>(\n  previous: unknown,\n  next: T,\n  /**\n   * Keep track of visited nodes to prevent infinite recursion in case of circular structures\n   */\n  parents: WeakSet<any>,\n): T {\n  if (previous === next) return previous as T\n\n  if (parents.has(next)) {\n    return next\n  }\n\n  // eslint-disable-next-line no-eq-null\n  if (previous == null || next == null) return next\n\n  const prevType = typeof previous\n  const nextType = typeof next\n\n  // Different types\n  if (prevType !== nextType) return next\n\n  if (Array.isArray(next)) {\n    parents.add(next)\n\n    assertType<unknown[]>(previous)\n    assertType<unknown[]>(next)\n\n    let allEqual = previous.length === next.length\n    const result = []\n    for (let index = 0; index < next.length; index++) {\n      const nextItem = _immutableReconcile(previous[index], next[index], parents)\n\n      if (nextItem !== previous[index]) {\n        allEqual = false\n      }\n      result[index] = nextItem\n    }\n    parents.delete(next)\n    return (allEqual ? previous : result) as any\n  }\n\n  if (typeof next === 'object') {\n    parents.add(next)\n    assertType<Record<string, unknown>>(previous)\n    assertType<Record<string, unknown>>(next)\n\n    const nextKeys = Object.keys(next)\n    let allEqual = Object.keys(previous).length === nextKeys.length\n    const result: Record<string, unknown> = {}\n    for (const key of nextKeys) {\n      const nextValue = _immutableReconcile(previous[key], next[key]!, parents)\n      if (nextValue !== previous[key]) {\n        allEqual = false\n      }\n      result[key] = nextValue\n    }\n    parents.delete(next)\n    return (allEqual ? previous : result) as T\n  }\n  return next\n}\n\n// just some typescript trickery get type assertion\n// eslint-disable-next-line @typescript-eslint/no-empty-function, no-empty-function\nfunction assertType<T>(value: unknown): asserts value is T {}\n","/* eslint-disable react/no-unused-prop-types */\n\nimport {type Path} from '@sanity/types'\nimport {isEqual, startsWith} from '@sanity/util/paths'\nimport {createContext, type ReactNode, useContext, useRef} from 'react'\n\nimport {type FormNodePresence} from '../../../presence'\nimport {immutableReconcile} from '../../store/utils/immutableReconcile'\n\nconst PresenceContext = createContext<FormNodePresence[]>([])\n\nexport function PresenceProvider(props: {presence: FormNodePresence[]; children: ReactNode}) {\n  return (\n    <PresenceContext.Provider value={props.presence}>{props.children}</PresenceContext.Provider>\n  )\n}\n\nexport function useFormFieldPresence(): FormNodePresence[] {\n  const ctx = useContext(PresenceContext)\n  if (!ctx) {\n    throw new Error('Form context not provided')\n  }\n  return ctx\n}\n\n/**\n * @alpha\n * @param path - the path to return child presence for\n * @param inclusive - whether to include presence for the current path (default false)\n */\nexport function useChildPresence(path: Path, inclusive?: boolean): FormNodePresence[] {\n  const presence = useFormFieldPresence()\n  const prev = useRef(presence)\n  const next = immutableReconcile(\n    prev.current,\n    presence.filter(\n      (item) => startsWith(path, item.path) && (inclusive || !isEqual(path, item.path)),\n    ),\n  )\n  prev.current = next\n  return next\n}\n","import {type AssetSource, type ObjectSchemaType, type Path} from '@sanity/types'\nimport {createContext} from 'react'\n\nimport {type PatchChannel} from './patch'\nimport {type FormFieldGroup, type StateTree} from './store'\nimport {\n  type FormBuilderCustomMarkersComponent,\n  type FormBuilderFilterFieldFn,\n  type FormBuilderMarkersComponent,\n  type RenderAnnotationCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderItemCallback,\n  type RenderPreviewCallback,\n} from './types'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport interface FormBuilderContextValue {\n  /**\n   * @deprecated INTERNAL USE ONLY\n   * @internal\n   */\n  __internal: {\n    components: {\n      CustomMarkers: FormBuilderCustomMarkersComponent\n      Markers: FormBuilderMarkersComponent\n    }\n    file: {\n      assetSources: AssetSource[]\n      directUploads: boolean\n    }\n    filterField: FormBuilderFilterFieldFn\n    image: {\n      assetSources: AssetSource[]\n      directUploads: boolean\n    }\n    patchChannel: PatchChannel\n  }\n\n  autoFocus?: boolean\n  changesOpen?: boolean\n  collapsedFieldSets: StateTree<boolean> | undefined\n  collapsedPaths: StateTree<boolean> | undefined\n  focusPath: Path\n  focused?: boolean\n  groups: FormFieldGroup[]\n  id: string\n  readOnly?: boolean\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderItemCallback\n  renderPreview: RenderPreviewCallback\n  schemaType: ObjectSchemaType\n}\n\n/**\n * @internal\n */\nexport const FormBuilderContext = createContext<FormBuilderContextValue | null>(null)\n","import {useContext} from 'react'\n\nimport {FormBuilderContext, type FormBuilderContextValue} from './FormBuilderContext'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function useFormBuilder(): FormBuilderContextValue {\n  const formBuilder = useContext(FormBuilderContext)\n\n  if (!formBuilder) {\n    throw new Error('FormBuilder: missing context value')\n  }\n\n  return formBuilder\n}\n","import {ErrorOutlineIcon, InfoOutlineIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {type FormNodeValidation} from '@sanity/types'\nimport {Box, Flex, Stack, Text, type Theme} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nimport {type PortableTextMarker, type RenderCustomMarkers} from '../../../types'\nimport {useFormBuilder} from '../../../useFormBuilder'\n\nexport interface MarkersProps {\n  markers: PortableTextMarker[]\n  validation: FormNodeValidation[]\n  renderCustomMarkers?: RenderCustomMarkers\n}\n\nconst getIcon = (level: 'error' | 'warning' | 'info') => {\n  if (level === 'error') {\n    return <ErrorOutlineIcon />\n  }\n\n  if (level === 'warning') {\n    return <WarningOutlineIcon />\n  }\n\n  return <InfoOutlineIcon />\n}\n\nconst IconText = styled(Text)(({theme}: {theme: Theme}) => {\n  return css`\n    &[data-info] {\n      color: ${theme.sanity.color.muted.primary.enabled.fg};\n    }\n\n    &[data-warning] {\n      color: ${theme.sanity.color.muted.caution.enabled.fg};\n    }\n\n    &[data-error] {\n      color: ${theme.sanity.color.muted.critical.enabled.fg};\n    }\n  `\n})\n\nexport function DefaultMarkers(props: MarkersProps) {\n  const {markers, validation, renderCustomMarkers} = props\n  const {CustomMarkers} = useFormBuilder().__internal.components\n\n  if (markers.length === 0 && validation.length === 0) {\n    return null\n  }\n\n  return (\n    <Stack space={1}>\n      {validation.length > 0 &&\n        validation.map(({message, level}, index) => (\n          // eslint-disable-next-line react/no-array-index-key\n          <Flex key={`validationItem-${index}`}>\n            <Box marginRight={2} marginBottom={index + 1 === validation.length ? 0 : 2}>\n              <IconText\n                size={1}\n                data-error={level === 'error' ? '' : undefined}\n                data-warning={level === 'warning' ? '' : undefined}\n                data-info={level === 'info' ? '' : undefined}\n              >\n                {getIcon(level)}\n              </IconText>\n            </Box>\n            <Box>\n              <Text size={1}>{message || 'Error'}</Text>\n            </Box>\n          </Flex>\n        ))}\n\n      {markers.length > 0 && (\n        <Box marginTop={validation.length > 0 ? 3 : 0}>\n          {renderCustomMarkers && renderCustomMarkers(markers)}\n          {!renderCustomMarkers && <CustomMarkers markers={markers} />}\n        </Box>\n      )}\n    </Stack>\n  )\n}\n","/* eslint-disable react/no-unused-prop-types */\n\nimport {type FormNodeValidation, type Path, type ValidationMarker} from '@sanity/types'\nimport {isEqual, startsWith} from '@sanity/util/paths'\nimport {createContext, type ReactNode, useContext, useMemo} from 'react'\n\nconst ValidationContext = createContext<ValidationMarker[]>([])\n\nexport function ValidationProvider(props: {validation: ValidationMarker[]; children: ReactNode}) {\n  return (\n    <ValidationContext.Provider value={props.validation}>\n      {props.children}\n    </ValidationContext.Provider>\n  )\n}\n\nexport function useValidationMarkers(): ValidationMarker[] {\n  const ctx = useContext(ValidationContext)\n  if (!ctx) {\n    throw new Error('Form context not provided')\n  }\n  return ctx\n}\n\n/**\n * @alpha\n * @param path - the path to return child validation for\n * @param inclusive - whether to include validation for the current path (default false)\n */\nexport function useChildValidation(path: Path, inclusive = false): FormNodeValidation[] {\n  const validation = useValidationMarkers()\n  return useMemo(\n    () =>\n      validation\n        .filter((item) => startsWith(path, item.path) && (inclusive || !isEqual(path, item.path)))\n        .map((marker) => ({\n          message: marker.message,\n          level: marker.level,\n          path: marker.path,\n        })) as FormNodeValidation[],\n    [inclusive, path, validation],\n  )\n}\n","import {type FormNodeValidation} from '@sanity/types'\nimport {useMemo, useRef} from 'react'\n\nimport {EMPTY_ARRAY} from '../../../../util'\nimport {type BaseFormNode} from '../../../store'\nimport {immutableReconcile} from '../../../store/utils/immutableReconcile'\nimport {useChildValidation} from '../../../studio/contexts/Validation'\nimport {isBlockType} from '../_helpers'\n\nconst NONEXISTENT_PATH = ['@@_NONEXISTENT_PATH_@@']\n\n/** @internal */\nexport function useMemberValidation(member: BaseFormNode | undefined) {\n  const prev = useRef<FormNodeValidation[] | null>(null)\n  const memberValidation =\n    member?.validation && member.validation.length > 0 ? member.validation : EMPTY_ARRAY\n  const childValidation = useChildValidation(member?.path || NONEXISTENT_PATH)\n\n  const validation = useMemo(\n    () =>\n      member?.schemaType && isBlockType(member?.schemaType)\n        ? memberValidation\n        : memberValidation.concat(childValidation),\n    [childValidation, member, memberValidation],\n  )\n\n  const [hasError, hasWarning, hasInfo] = useMemo(\n    () => [\n      validation.filter((v) => v.level === 'error').length > 0,\n      validation.filter((v) => v.level === 'warning').length > 0,\n      validation.filter((v) => v.level === 'info').length > 0,\n    ],\n    [validation],\n  )\n\n  const reconciled = immutableReconcile(prev.current, validation)\n  prev.current = reconciled\n\n  return useMemo(() => {\n    return {\n      validation: reconciled,\n      hasError,\n      hasWarning,\n      hasInfo,\n    }\n  }, [reconciled, hasError, hasWarning, hasInfo])\n}\n","import {createContext, type ReactNode} from 'react'\n\nimport {type PortableTextMarker} from '../../../types'\n\nexport const PortableTextMarkersContext = createContext<PortableTextMarker[]>([])\n\nexport function PortableTextMarkersProvider(props: {\n  markers: PortableTextMarker[]\n  children: ReactNode\n}) {\n  return (\n    <PortableTextMarkersContext.Provider value={props.markers}>\n      {props.children}\n    </PortableTextMarkersContext.Provider>\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {isEqual} from '@sanity/util/paths'\nimport {useContext, useMemo} from 'react'\n\nimport {type PortableTextMarker} from '../../../types'\nimport {PortableTextMarkersContext} from '../contexts/PortableTextMarkers'\n\nexport function usePortableTextMarkers(path: Path): PortableTextMarker[] {\n  const ctx = useContext(PortableTextMarkersContext)\n  if (!ctx) {\n    throw new Error('Form context not provided')\n  }\n  const markers = useMemo(() => ctx.filter((m) => isEqual(m.path, path)), [ctx, path])\n  return markers\n}\n","import {Box, Text} from '@sanity/ui'\n\nimport {MenuGroup, type MenuGroupProps} from '../../../../ui-components'\nimport {type DocumentFieldActionGroup} from '../../../config'\nimport {useI18nText} from '../../../i18n'\nimport {FieldActionMenuNode} from './FieldActionMenuNode'\n\nconst POPOVER_PROPS: MenuGroupProps['popover'] = {\n  placement: 'right',\n  fallbackPlacements: ['top', 'bottom'],\n}\n\nexport function FieldActionMenuGroup(props: {group: DocumentFieldActionGroup}) {\n  const {group} = props\n  const {title} = useI18nText(group)\n\n  if (group.expanded) {\n    return (\n      <>\n        <Box padding={2} paddingTop={3}>\n          <Text muted size={1} weight=\"medium\">\n            {title}\n          </Text>\n        </Box>\n\n        {group.children.map((item, idx) => (\n          <FieldActionMenuNode\n            action={item}\n            isFirst={idx === 0}\n            // eslint-disable-next-line react/no-array-index-key\n            key={idx}\n            prevIsGroup={group.children[idx - 1]?.type === 'group'}\n          />\n        ))}\n      </>\n    )\n  }\n\n  return (\n    <MenuGroup icon={group.icon} popover={POPOVER_PROPS} text={title} tone={group.tone}>\n      {group.children.map((item, idx) => (\n        <FieldActionMenuNode\n          action={item}\n          isFirst={idx === 0}\n          // eslint-disable-next-line react/no-array-index-key\n          key={idx}\n          prevIsGroup={group.children[idx - 1]?.type === 'group'}\n        />\n      ))}\n    </MenuGroup>\n  )\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {Text} from '@sanity/ui'\nimport {useCallback} from 'react'\n\nimport {MenuItem} from '../../../../ui-components'\nimport {TooltipOfDisabled} from '../../../components'\nimport {type DocumentFieldActionItem} from '../../../config'\nimport {useI18nText} from '../../../i18n'\n\nexport function FieldActionMenuItem(props: {action: DocumentFieldActionItem}) {\n  const {action} = props\n\n  const {title} = useI18nText(action)\n\n  const handleClick = useCallback(() => {\n    action.onAction()\n  }, [action])\n\n  const disabledTooltipContent = typeof action.disabled === 'object' && (\n    <Text size={1}>{action.disabled.reason}</Text>\n  )\n\n  return (\n    <TooltipOfDisabled content={disabledTooltipContent} placement=\"left\">\n      <MenuItem\n        disabled={Boolean(action.disabled)}\n        icon={action.icon}\n        iconRight={action.iconRight || (action.selected ? CheckmarkIcon : undefined)}\n        onClick={handleClick}\n        pressed={action.selected}\n        text={title}\n        tone={action.tone}\n      />\n    </TooltipOfDisabled>\n  )\n}\n","import {MenuDivider} from '@sanity/ui'\n\nimport {type DocumentFieldActionNode} from '../../../config'\nimport {FieldActionMenuGroup} from './FieldActionMenuGroup'\nimport {FieldActionMenuItem} from './FieldActionMenuItem'\n\ninterface FieldActionMenuNodeProps {\n  action: DocumentFieldActionNode\n  isFirst: boolean\n  prevIsGroup: boolean\n}\n\nexport function FieldActionMenuNode(props: FieldActionMenuNodeProps) {\n  const {action, isFirst, prevIsGroup} = props\n\n  if (action.type === 'divider') {\n    return <MenuDivider />\n  }\n\n  if (action.type === 'group') {\n    return (\n      <>\n        {!isFirst && <MenuDivider />}\n        <FieldActionMenuGroup group={action} />\n      </>\n    )\n  }\n\n  return (\n    <>\n      {prevIsGroup && <MenuDivider />}\n      <FieldActionMenuItem action={action} />\n    </>\n  )\n}\n","/* eslint-disable react/jsx-handler-names */\n\nimport {EllipsisHorizontalIcon} from '@sanity/icons'\nimport {Card, Menu} from '@sanity/ui'\nimport {memo, useCallback, useId, useMemo, useState} from 'react'\n\nimport {Button, type ButtonProps, MenuButton, type MenuButtonProps} from '../../../../ui-components'\nimport {type DocumentFieldActionGroup, type DocumentFieldActionNode} from '../../../config'\nimport {useI18nText} from '../../../i18n'\nimport {FieldActionMenuNode} from './FieldActionMenuNode'\n\n/** @internal */\nexport interface FieldActionMenuProps {\n  nodes: DocumentFieldActionNode[]\n  onMenuOpenChange: (open: boolean) => void\n}\n\nconst STATUS_BUTTON_TOOLTIP_PROPS: ButtonProps['tooltipProps'] = {\n  placement: 'top',\n}\n\nfunction renderAsButton(node: DocumentFieldActionNode) {\n  return 'renderAsButton' in node && node.renderAsButton\n}\n\n/** @internal */\nexport const FieldActionMenu = memo(function FieldActionMenu(props: FieldActionMenuProps) {\n  const {nodes, onMenuOpenChange} = props\n  const [open, setOpen] = useState(false)\n\n  const handleOpen = useCallback(() => {\n    onMenuOpenChange(true)\n    setOpen(true)\n  }, [onMenuOpenChange])\n  const handleClose = useCallback(() => {\n    onMenuOpenChange(false)\n    setOpen(false)\n  }, [onMenuOpenChange])\n\n  const buttonNodes = useMemo(() => nodes.filter(renderAsButton), [nodes])\n  const menuNodesProp = useMemo(() => nodes.filter((node) => !renderAsButton(node)), [nodes])\n\n  // If there is only one menu node, and it is a `group`, expand it by default\n  const menuNodes = useMemo(() => {\n    const len = menuNodesProp.length\n\n    if (len === 0 || len > 1) return menuNodesProp\n\n    const node = menuNodesProp[0]\n\n    if (node.type === 'group') {\n      return [{...node, expanded: true}]\n    }\n\n    return menuNodesProp\n  }, [menuNodesProp])\n\n  const rootNodes: DocumentFieldActionNode[] = useMemo(\n    () => [\n      ...(menuNodes.length\n        ? ([\n            {\n              type: 'group',\n              children: menuNodes,\n              icon: EllipsisHorizontalIcon,\n              title: 'Field actions',\n            },\n          ] satisfies DocumentFieldActionNode[])\n        : []),\n      ...buttonNodes,\n    ],\n    [buttonNodes, menuNodes],\n  )\n\n  return (\n    <>\n      {rootNodes.map((node, idx) => (\n        <RootFieldActionMenuNode\n          // eslint-disable-next-line react/no-array-index-key\n          key={idx}\n          node={node}\n          onOpen={handleOpen}\n          onClose={handleClose}\n          open={open}\n        />\n      ))}\n    </>\n  )\n})\n\nconst RootFieldActionMenuNode = memo(function RootFieldActionMenuNode(props: {\n  node: DocumentFieldActionNode\n  onOpen: () => void\n  onClose: () => void\n  open: boolean\n}) {\n  const {node, onOpen, onClose, open} = props\n\n  if (node.type === 'divider') {\n    return <Card borderLeft flex=\"none\" />\n  }\n\n  if (node.type === 'action') {\n    return (\n      <Button\n        icon={node.icon}\n        mode=\"bleed\"\n        onClick={node.onAction}\n        tooltipProps={{\n          ...STATUS_BUTTON_TOOLTIP_PROPS,\n          content: node.title,\n        }}\n      />\n    )\n  }\n\n  return <RootFieldActionMenuGroup node={node} onOpen={onOpen} onClose={onClose} open={open} />\n})\n\nconst ROOT_MENU_BUTTON_POPOVER_PROPS: MenuButtonProps['popover'] = {\n  constrainSize: true,\n  placement: 'right',\n  portal: true,\n  fallbackPlacements: ['top', 'bottom'],\n}\n\nfunction RootFieldActionMenuGroup(props: {\n  node: DocumentFieldActionGroup\n  onOpen: () => void\n  onClose: () => void\n  open: boolean\n}) {\n  const {node, onOpen, onClose, open} = props\n  const {title} = useI18nText(node)\n\n  return (\n    <MenuButton\n      button={\n        <Button\n          icon={node.icon}\n          label={open ? undefined : title}\n          mode=\"bleed\"\n          tooltipProps={{\n            ...STATUS_BUTTON_TOOLTIP_PROPS,\n            content: node.title,\n          }}\n        />\n      }\n      id={useId()}\n      menu={\n        <Menu>\n          {node.children.map((action, idx) => {\n            return (\n              <FieldActionMenuNode\n                action={action}\n                isFirst={idx === 0}\n                // eslint-disable-next-line react/no-array-index-key\n                key={idx}\n                prevIsGroup={node.children[idx - 1]?.type === 'group'}\n              />\n            )\n          })}\n        </Menu>\n      }\n      onOpen={onOpen}\n      onClose={onClose}\n      popover={ROOT_MENU_BUTTON_POPOVER_PROPS}\n    />\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {createContext} from 'react'\n\n/** @internal */\nexport interface HoveredFieldContextValue {\n  hoveredStack: string[]\n  onMouseEnter: (path: Path) => void\n  onMouseLeave: (path: Path) => void\n}\n\n/** @internal */\nexport const HoveredFieldContext = createContext<HoveredFieldContextValue>({\n  hoveredStack: [],\n  onMouseEnter: () => undefined,\n  onMouseLeave: () => undefined,\n})\n","import {useContext} from 'react'\n\nimport {HoveredFieldContext, type HoveredFieldContextValue} from './HoveredFieldContext'\n\n/** @internal */\nexport function useHoveredField(): HoveredFieldContextValue {\n  return useContext(HoveredFieldContext)\n}\n","import {createContext} from 'react'\n\nimport {type DocumentFieldActionNode} from '../../../config'\n\n/** @internal */\nexport interface FieldActionsContextValue {\n  actions: DocumentFieldActionNode[]\n  focused?: boolean\n  hovered: boolean\n  onMouseEnter: () => void\n  onMouseLeave: () => void\n}\n\n/** @internal */\nexport const FieldActionsContext = createContext<FieldActionsContextValue>({\n  actions: [],\n  focused: false,\n  hovered: false,\n  onMouseEnter: () => undefined,\n  onMouseLeave: () => undefined,\n})\n","import {type Path} from '@sanity/types'\nimport {type PropsWithChildren, useCallback, useMemo} from 'react'\n\nimport {type DocumentFieldActionNode} from '../../../config'\nimport {pathToString} from '../../../field'\nimport {supportsTouch} from '../../../util'\nimport {useHoveredField} from '../useHoveredField'\nimport {FieldActionsContext, type FieldActionsContextValue} from './FieldActionsContext'\n\ntype FieldActionsProviderProps = PropsWithChildren<{\n  actions: DocumentFieldActionNode[]\n  focused?: boolean\n  path: Path\n}>\n\n/** @internal */\nexport function FieldActionsProvider(props: FieldActionsProviderProps) {\n  const {actions, children, path, focused} = props\n  const {onMouseEnter: onFieldMouseEnter, onMouseLeave: onFieldMouseLeave} = useHoveredField()\n\n  const hoveredPath = useHoveredField().hoveredStack[0]\n  const hovered = supportsTouch || (hoveredPath ? pathToString(path) === hoveredPath : false)\n\n  const handleMouseEnter = useCallback(() => {\n    onFieldMouseEnter(path)\n  }, [onFieldMouseEnter, path])\n\n  const handleMouseLeave = useCallback(() => {\n    onFieldMouseLeave(path)\n  }, [onFieldMouseLeave, path])\n\n  const context: FieldActionsContextValue = useMemo(\n    () => ({\n      actions,\n      focused,\n      hovered,\n      onMouseEnter: handleMouseEnter,\n      onMouseLeave: handleMouseLeave,\n    }),\n    [actions, focused, handleMouseEnter, handleMouseLeave, hovered],\n  )\n\n  return <FieldActionsContext.Provider value={context}>{children}</FieldActionsContext.Provider>\n}\n","import {type DocumentFieldActionNode} from '../../../config'\n\nexport function filterActions(actions: DocumentFieldActionNode[]): DocumentFieldActionNode[] {\n  return actions\n    .filter(Boolean)\n    .filter((node) => {\n      if ('hidden' in node) return node.hidden !== true\n      return true\n    })\n    .map((node) => {\n      if (node.type === 'group') {\n        return {\n          ...node,\n          children: filterActions(node.children),\n        }\n      }\n\n      return node\n    })\n}\n","import {type Path, type SchemaType} from '@sanity/types'\nimport {memo, useCallback, useEffect, useRef, useState} from 'react'\n\nimport {type DocumentFieldAction, type DocumentFieldActionNode} from '../../../config'\nimport {useUnique} from '../../../util'\nimport {filterActions} from './helpers'\n\n/** @internal */\nexport interface FieldActionsProps {\n  actions: DocumentFieldAction[]\n  documentId: string\n  documentType: string\n  onActions: (actions: DocumentFieldActionNode[]) => void\n  path: Path\n  schemaType: SchemaType\n}\n\n/**\n *\n * The `FieldActionsResolver` component is responsible for resolving the actions for a given field.\n *\n * Since each field action is a React hook, they need to be rendered in a component that returns\n * `null` to allow for the hook's return value to be resolved.\n *\n * The way this works:\n *\n * - The parent component (`FieldProvider`) renders the `FieldActionsResolver` component.\n * - The `FieldActionsResolver` component renders each field action as a child component.\n * - Each field action is a React hook that returns a node, and calls `setFieldAction` with its\n *   index and value.\n * - The `FieldActionsResolver` keeps a state with the array of hook values, making sure the array\n *   has the same length as the number of actions.\n * - The `FieldActionsResolver` calls `onActions` with the array of hook values.\n *\n * @internal\n */\nexport const FieldActionsResolver = memo(function FieldActions(props: FieldActionsProps) {\n  const {actions, documentId, documentType, onActions, path, schemaType} = props\n\n  const len = actions.length\n  const lenRef = useRef(len)\n\n  const [fieldActions, setFieldActions] = useState<DocumentFieldActionNode[]>(() =>\n    Array.from(new Array(len)),\n  )\n\n  const fieldActionsRef = useRef(fieldActions)\n\n  const setFieldAction = useCallback((index: number, node: DocumentFieldActionNode) => {\n    setFieldActions((prev) => {\n      const next = [...prev]\n      next[index] = node\n      return next\n    })\n  }, [])\n\n  useEffect(() => {\n    if (fieldActionsRef.current !== fieldActions) {\n      fieldActionsRef.current = fieldActions\n      onActions(filterActions(fieldActions))\n    }\n  }, [fieldActions, onActions])\n\n  useEffect(() => {\n    if (lenRef.current !== len) {\n      const newFieldActions = Array.from(new Array(len))\n\n      for (let i = 0; i < len; i++) {\n        newFieldActions[i] = fieldActionsRef.current[i]\n      }\n\n      lenRef.current = len\n\n      setFieldActions(newFieldActions)\n      fieldActionsRef.current = newFieldActions\n    }\n  }, [len])\n\n  return (\n    <>\n      {actions.map((a, aIdx) => (\n        <FieldAction\n          action={a}\n          index={aIdx}\n          // eslint-disable-next-line react/no-array-index-key\n          key={aIdx}\n          documentId={documentId}\n          documentType={documentType}\n          path={path}\n          schemaType={schemaType}\n          setFieldAction={setFieldAction}\n        />\n      ))}\n    </>\n  )\n})\n\ninterface FieldActionProps {\n  action: DocumentFieldAction\n  documentId: string\n  documentType: string\n  index: number\n  path: Path\n  schemaType: SchemaType\n  setFieldAction: (index: number, node: DocumentFieldActionNode) => void\n}\n\nconst FieldAction = memo(function FieldAction(props: FieldActionProps) {\n  const {action, documentId, documentType, index, path, schemaType, setFieldAction} = props\n\n  const node = useUnique(\n    action.useAction({\n      documentId,\n      documentType,\n      path,\n      schemaType,\n    }),\n  )\n\n  useEffect(() => {\n    setFieldAction(index, node)\n  }, [index, node, setFieldAction])\n\n  return null\n})\n","import {useContext} from 'react'\n\nimport {FieldActionsContext, type FieldActionsContextValue} from './FieldActionsContext'\n\n/** @internal */\nexport function useFieldActions(): FieldActionsContextValue {\n  return useContext(FieldActionsContext)\n}\n","import {createContext} from 'react'\n\nimport {type FormNodePresence} from './types'\n\n/** @internal */\nexport const FormFieldPresenceContext = createContext<FormNodePresence[]>([])\n","/* eslint-disable camelcase */\n\nimport {AvatarStack} from '@sanity/ui'\nimport {getTheme_v2} from '@sanity/ui/theme'\nimport {useMemo} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {Tooltip, type TooltipProps} from '../../ui-components'\nimport {UserAvatar} from '../components'\nimport {type DocumentPresence} from '../store'\nimport {isNonNullable} from '../util'\n\n/** @internal */\nexport interface DocumentPreviewPresenceProps {\n  presence: Omit<DocumentPresence, 'path'>[]\n}\n\nconst PRESENCE_MENU_POPOVER_PROPS: TooltipProps = {\n  portal: true,\n}\n\nconst AvatarStackBox = styled.div((props) => {\n  const {space} = getTheme_v2(props.theme)\n\n  return css`\n    margin: ${0 - space[1]}px;\n  `\n})\n\nconst getTooltipText = (presence: Omit<DocumentPresence, 'path'>[]) => {\n  if (presence.length === 1) {\n    return `${presence[0].user.displayName} is editing this document`\n  }\n\n  if (presence.length > 1) {\n    return `${presence.length} people are editing this document right now`\n  }\n\n  return undefined\n}\n\n/** @internal */\nexport function DocumentPreviewPresence(props: DocumentPreviewPresenceProps) {\n  const {presence} = props\n\n  const uniqueUsers = useMemo(\n    () =>\n      Array.from(new Set(presence.map((a) => a.user.id)))\n        .map((id) => {\n          return presence.find((a) => a.user.id === id)\n        })\n        .filter(isNonNullable),\n    [presence],\n  )\n\n  const tooltipContent = useMemo(() => getTooltipText(uniqueUsers), [uniqueUsers])\n\n  return (\n    <Tooltip content={tooltipContent} {...PRESENCE_MENU_POPOVER_PROPS}>\n      <AvatarStackBox>\n        <AvatarStack maxLength={2} aria-label={getTooltipText(uniqueUsers)} size={0}>\n          {uniqueUsers.map((item) => (\n            <UserAvatar key={item.user.id} size={0} user={item.user} />\n          ))}\n        </AvatarStack>\n      </AvatarStackBox>\n    </Tooltip>\n  )\n}\n","import {type User} from '@sanity/types'\nimport {\n  Avatar,\n  type AvatarPosition,\n  type AvatarProps,\n  type AvatarSize,\n  type AvatarStatus,\n} from '@sanity/ui'\nimport {type ForwardedRef, forwardRef, useState} from 'react'\n\nimport {Tooltip} from '../../../ui-components'\nimport {useUser} from '../../store'\nimport {useUserColor} from '../../user-color'\nimport {isRecord} from '../../util'\n\n/**\n * @hidden\n * @beta */\nexport interface UserAvatarProps {\n  __unstable_hideInnerStroke?: AvatarProps['__unstable_hideInnerStroke']\n  animateArrowFrom?: AvatarPosition\n  position?: AvatarPosition\n  size?: AvatarSize\n  status?: AvatarStatus\n  tone?: 'navbar'\n  user: User | string\n  withTooltip?: boolean\n}\n\nconst symbols = /[^\\p{Alpha}\\p{White_Space}]/gu\nconst whitespace = /\\p{White_Space}+/u\n\nconst LEGACY_TO_UI_AVATAR_SIZES: {[key: string]: AvatarSize | undefined} = {\n  small: 0,\n  medium: 1,\n  large: 2,\n}\n\nfunction nameToInitials(fullName: string) {\n  const namesArray = fullName.replace(symbols, '').split(whitespace)\n\n  if (namesArray.length === 1) {\n    return `${namesArray[0].charAt(0)}`.toUpperCase()\n  }\n\n  return `${namesArray[0].charAt(0)}${namesArray[namesArray.length - 1].charAt(0)}`\n}\n\n/**\n * @hidden\n * @beta */\nexport function UserAvatar(props: UserAvatarProps) {\n  const {user, ...restProps} = props\n\n  if (isRecord(user)) {\n    if (restProps.withTooltip) {\n      return <TooltipUserAvatar {...restProps} user={user as User} />\n    }\n\n    return <StaticUserAvatar {...restProps} user={user as User} />\n  }\n\n  return <UserAvatarLoader {...props} user={user as string} />\n}\n\nfunction TooltipUserAvatar(props: Omit<UserAvatarProps, 'user'> & {user: User}) {\n  const {\n    user: {displayName},\n  } = props\n\n  return (\n    <Tooltip content={displayName} placement=\"top\" portal>\n      <div style={{display: 'inline-block'}}>\n        <StaticUserAvatar {...props} />\n      </div>\n    </Tooltip>\n  )\n}\n\nconst StaticUserAvatar = forwardRef(function StaticUserAvatar(\n  props: Omit<UserAvatarProps, 'user'> & {user: User},\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const {user, animateArrowFrom, position, size, status, tone, ...restProps} = props\n  const [imageLoadError, setImageLoadError] = useState<null | Error>(null)\n  const userColor = useUserColor(user.id)\n  const imageUrl = imageLoadError ? undefined : user?.imageUrl\n\n  return (\n    <Avatar\n      __unstable_hideInnerStroke\n      animateArrowFrom={animateArrowFrom}\n      arrowPosition={position}\n      color={userColor.name}\n      data-legacy-tone={tone}\n      initials={user?.displayName && nameToInitials(user.displayName)}\n      src={imageUrl}\n      onImageLoadError={setImageLoadError}\n      ref={ref}\n      size={typeof size === 'string' ? LEGACY_TO_UI_AVATAR_SIZES[size] : size}\n      status={status}\n      title={user?.displayName}\n      {...restProps}\n    />\n  )\n})\n\nfunction UserAvatarLoader({user, ...loadedProps}: Omit<UserAvatarProps, 'user'> & {user: string}) {\n  const [value] = useUser(user)\n\n  if (!value) {\n    // @todo How do we handle this?\n    return null\n  }\n\n  return <UserAvatar {...loadedProps} user={value} />\n}\n","// disable overlay rendering entirely and only display presence in fields\nexport const DISABLE_OVERLAY = false\n\n// number of avatars to display on each fields (will be stacked and have a counter if more than 3 users in a field)\nexport const MAX_AVATARS_DOCK = 3\nexport const MAX_AVATARS_GLOBAL = 3\nexport const DEFAULT_MAX_AVATARS_FIELDS = 3\n\n// distance between avatars in pixels (negative number means overlap)\nexport const AVATAR_DISTANCE = -4\n\n// height/width of the avatars in pixels\nexport const AVATAR_SIZE = 25\n\nexport const AVATAR_ARROW_HEIGHT = 4\n\n// these are the thresholds in which the intersection observers will notify about regions going in/out of viewport\n// these will affect the thresholds below, so make sure to coordinate edits\nexport const INTERSECTION_THRESHOLDS = [0, 0.25, 0.75, 1]\n\n// The elements that reports intersection changes are padded top+bottom in order to detect when entering leaving\nexport const INTERSECTION_ELEMENT_PADDING = 23\n\n// Make the avatars snap to the top dock when they are closer than this from the top\nexport const SNAP_TO_DOCK_DISTANCE_TOP = 8\n\n// Make the avatars snap to the bottom dock when they are closer than this from the bottom\nexport const SNAP_TO_DOCK_DISTANCE_BOTTOM = 8\n\n// The avatar will move to the right when this close (in pixels) to the top\nexport const SLIDE_RIGHT_THRESHOLD_TOP = 20\n\n// The avatar will move to the right when this close (in pixels) to the bottom\nexport const SLIDE_RIGHT_THRESHOLD_BOTTOM = 20\n\n// Switch on debug mode (will display regions)\nexport const DEBUG = false\n","import {Flex} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {AVATAR_SIZE} from './constants'\n\nexport const FlexWrapper = styled(Flex)`\n  & > div:first-child {\n    flex: 1;\n    min-width: 0;\n  }\n`\n\nexport const InnerBox = styled(Flex)`\n  height: ${AVATAR_SIZE}px;\n  min-width: 23px;\n  vertical-align: top;\n`\n","import {createTrackerScope, type Reported} from '../../components/react-track-elements'\nimport {type FieldPresenceData} from '../types'\n\nexport type ReportedPresenceData = Reported<FieldPresenceData>\n\nconst {Tracker, useReporter, useReportedValues} = createTrackerScope<FieldPresenceData>()\n\nexport {Tracker, useReportedValues, useReporter}\n","import {Flex, Stack, Text} from '@sanity/ui'\nimport {type ReactElement, useMemo} from 'react'\n\nimport {Tooltip} from '../../ui-components'\nimport {UserAvatar} from '../components/userAvatar'\nimport {type FormNodePresence} from './types'\n\ninterface PresenceTooltipProps {\n  children?: ReactElement\n  items: FormNodePresence[]\n}\n\n/**\n * The \"documentScrollElement\" is being passed to the PortalProvider in DocumentPanel.\n * The default portal element provided by the PortalProvider causes some layout issues with the Tooltip.\n * Therefore, another portal element (i.e. the \"documentScrollElement\") is being used to solve this.\n */\n\nexport function PresenceTooltip(props: PresenceTooltipProps) {\n  const {children, items} = props\n\n  const content = useMemo(\n    () => (\n      <Stack sizing=\"border\">\n        {items.map((item) => (\n          <Flex align=\"center\" gap={2} key={item.user.id}>\n            <div>\n              <UserAvatar user={item.user} status=\"online\" />\n            </div>\n\n            <Text size={1}>{item.user.displayName}</Text>\n          </Flex>\n        ))}\n      </Stack>\n    ),\n    [items],\n  )\n\n  return (\n    <Tooltip content={content} placement=\"top\" portal=\"documentScrollElement\">\n      {children}\n    </Tooltip>\n  )\n}\n","import {AVATAR_DISTANCE, AVATAR_SIZE} from './constants'\n\nexport const splitRight = <T>(array: T[], max: number): [T[], T[]] => {\n  const indexFromMax = array.length > max ? max - 1 : max\n  const idx = Math.max(0, array.length - indexFromMax)\n  return [array.slice(0, idx), array.slice(idx)]\n}\n\n// export const splitRight = <T>(array: T[], index: number): [T[], T[]] => {\n//   const idx = Math.max(0, array.length - index)\n//   return [array.slice(0, idx), array.slice(idx)]\n// }\n//\nexport const split = <T>(array: T[], index: number): [T[], T[]] => {\n  const idx = Math.max(0, index)\n  return [array.slice(0, idx), array.slice(idx)]\n}\n\n/** @internal */\nexport function calcAvatarStackWidth(len: number): number {\n  return -AVATAR_DISTANCE + (AVATAR_SIZE + AVATAR_DISTANCE) * len\n}\n","import {AvatarCounter, type AvatarPosition} from '@sanity/ui'\nimport {sortBy, uniqBy} from 'lodash'\nimport {memo, useContext, useId, useMemo, useRef} from 'react'\n\nimport {UserAvatar} from '../components/userAvatar'\nimport {\n  AVATAR_DISTANCE,\n  AVATAR_SIZE,\n  DEFAULT_MAX_AVATARS_FIELDS,\n  DISABLE_OVERLAY,\n} from './constants'\nimport {FormFieldPresenceContext} from './context'\nimport {FlexWrapper, InnerBox} from './FieldPresence.styled'\nimport {useReporter} from './overlay/tracker'\nimport {PresenceTooltip} from './PresenceTooltip'\nimport {type FormNodePresence} from './types'\nimport {splitRight} from './utils'\n\n/** @internal */\nexport interface FieldPresenceInnerProps {\n  maxAvatars?: number\n  presence: FormNodePresence[]\n  stack?: boolean\n  position?: AvatarPosition\n  animateArrowFrom?: AvatarPosition\n}\n\n/** @internal */\nexport const FieldPresenceInner = memo(function FieldPresenceInner({\n  presence,\n  position = 'inside',\n  animateArrowFrom = 'inside',\n  maxAvatars = DEFAULT_MAX_AVATARS_FIELDS,\n  stack = true,\n}: FieldPresenceInnerProps) {\n  const uniquePresence = uniqBy(presence || [], (item) => item.user.id)\n  const sorted = sortBy(uniquePresence, (_presence) => _presence.lastActiveAt)\n  const [hidden, visible] = stack ? splitRight(sorted, maxAvatars) : [[], sorted]\n\n  const avatars = [\n    ...visible.reverse().map((_visible) => ({\n      key: _visible.user.id,\n      element: (\n        <UserAvatar\n          animateArrowFrom={animateArrowFrom}\n          position={position}\n          status=\"online\"\n          user={_visible.user}\n        />\n      ),\n    })),\n    hidden.length >= 2\n      ? {\n          key: 'counter',\n          element: <AvatarCounter count={hidden.length} />,\n        }\n      : null,\n  ].filter(Boolean)\n\n  return (\n    <FlexWrapper>\n      <div />\n\n      <InnerBox direction=\"row-reverse\">\n        {avatars.map(\n          (av, i) =>\n            av && (\n              <div\n                key={av.key}\n                style={{\n                  position: 'absolute',\n                  transform: `translate3d(${-i * (AVATAR_SIZE + AVATAR_DISTANCE)}px, 0px, 0px)`,\n                  transitionProperty: 'transform',\n                  transitionDuration: '200ms',\n                  transitionTimingFunction: 'cubic-bezier(0.85, 0, 0.15, 1)',\n                  zIndex: 100 - i,\n                }}\n              >\n                {av.element}\n              </div>\n            ),\n        )}\n      </InnerBox>\n    </FlexWrapper>\n  )\n})\n\n/** @internal */\nexport interface FieldPresenceProps {\n  presence: FormNodePresence[]\n  maxAvatars: number\n}\n\n/** @internal */\nexport function FieldPresenceWithOverlay(props: FieldPresenceProps) {\n  const contextPresence = useContext(FormFieldPresenceContext)\n  const {presence = contextPresence, maxAvatars = DEFAULT_MAX_AVATARS_FIELDS} = props\n  const ref = useRef(null)\n\n  useReporter(useId(), () => ({presence, element: ref.current!, maxAvatars: maxAvatars}))\n\n  const uniquePresence = useMemo(() => uniqBy(presence || [], (item) => item.user.id), [presence])\n\n  return (\n    <PresenceTooltip items={uniquePresence}>\n      <FlexWrapper ref={ref} style={{minHeight: AVATAR_SIZE, minWidth: AVATAR_SIZE}} />\n    </PresenceTooltip>\n  )\n}\n\n/** @internal */\nexport function FieldPresenceWithoutOverlay(props: FieldPresenceProps) {\n  const contextPresence = useContext(FormFieldPresenceContext)\n  const {presence = contextPresence, maxAvatars = DEFAULT_MAX_AVATARS_FIELDS} = props\n\n  if (!presence.length) {\n    return null\n  }\n\n  return <FieldPresenceInner presence={presence} maxAvatars={maxAvatars} />\n}\n\n/** @internal */\nexport const FieldPresence = DISABLE_OVERLAY\n  ? FieldPresenceWithoutOverlay\n  : FieldPresenceWithOverlay\n","import {Observable, Subject} from 'rxjs'\nimport {filter} from 'rxjs/operators'\n\nexport interface ObservableIntersectionObserver {\n  observe: (element: Element) => Observable<IntersectionObserverEntry>\n}\n\nexport const createIntersectionObserver = (\n  options?: IntersectionObserverInit,\n): ObservableIntersectionObserver => {\n  const entries$ = new Subject<IntersectionObserverEntry>()\n  const intersectionObserver = new IntersectionObserver((entries) => {\n    entries.forEach((entry) => {\n      entries$.next(entry)\n    })\n  }, options)\n  return {\n    observe: (element: Element) => {\n      return new Observable<IntersectionObserverEntry>((subscriber) => {\n        const subscription = entries$\n          .pipe(filter((entry) => entry.target === element))\n          .subscribe(subscriber)\n        intersectionObserver.observe(element)\n        return () => {\n          subscription.unsubscribe()\n          intersectionObserver.unobserve(element)\n        }\n      })\n    },\n  }\n}\n","import {type HTMLProps, useEffect, useRef} from 'react'\nimport {tap} from 'rxjs/operators'\n\nimport {type ObservableIntersectionObserver} from './intersectionObserver'\n\nexport interface WithIntersectionProps {\n  onIntersection: (id: string, entry: IntersectionObserverEntry) => void\n  io: ObservableIntersectionObserver\n  id: string\n}\n\nexport const WithIntersection = (props: WithIntersectionProps & HTMLProps<HTMLDivElement>) => {\n  const {onIntersection, io, id, ...rest} = props\n  const element = useRef<HTMLDivElement | null>(null)\n  useEffect(() => {\n    const el = element.current\n    if (!el) return undefined\n    const subscription = io\n      .observe(el)\n      .pipe(tap((entry) => onIntersection(id, entry)))\n      .subscribe()\n    return () => subscription.unsubscribe()\n  }, [io, id, onIntersection])\n  return <div ref={element} {...rest} />\n}\n","import styled, {css} from 'styled-components'\n\nimport {WithIntersection} from './WithIntersection'\n\ninterface StyleProps {\n  $debug: boolean\n  margins?: [number, number, number, number]\n}\n\nexport const RootWrapper = styled.div`\n  position: relative;\n`\n\nexport const OverlayWrapper = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  pointer-events: none;\n  z-index: 13;\n`\n\nexport const RegionWrapper = css`\n  overflow: hidden;\n  overflow: clip;\n  pointer-events: none;\n  position: absolute;\n`\n\nexport const TopRegionWrapper = styled(WithIntersection)<StyleProps>(({$debug, margins}) => {\n  return css`\n    ${RegionWrapper}\n\n    z-index: 100;\n    position: sticky;\n    height: 1px;\n    top: ${margins ? `${margins[0] - 1}px` : undefined};\n    background-color: ${$debug ? 'red' : 'none'};\n  `\n})\n\nexport const MiddleRegionWrapper = styled(WithIntersection)<StyleProps>(({$debug}) => {\n  return css`\n    ${RegionWrapper}\n\n    visibility: none;\n\n    ${$debug &&\n    css`\n      background: rgba(255, 0, 0, 0.25);\n      outline: 1px solid #00b;\n      visibility: visible;\n    `}\n  `\n})\n\nexport const BottomRegionWrapper = styled(WithIntersection)<StyleProps>(({$debug}) => {\n  return css`\n    ${RegionWrapper}\n\n    position: sticky;\n    bottom: -1px;\n    height: 1px;\n    background-color: ${$debug ? 'blue' : 'transparent'};\n  `\n})\n","import {\n  type ForwardedRef,\n  forwardRef,\n  type ReactNode,\n  useCallback,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\n\nimport {\n  DEBUG,\n  INTERSECTION_ELEMENT_PADDING,\n  INTERSECTION_THRESHOLDS,\n  SNAP_TO_DOCK_DISTANCE_BOTTOM,\n  SNAP_TO_DOCK_DISTANCE_TOP,\n} from '../constants'\nimport {\n  type FieldPresenceData,\n  type RegionWithIntersectionDetails,\n  type ReportedRegionWithRect,\n} from '../types'\nimport {createIntersectionObserver} from './intersectionObserver'\nimport {\n  BottomRegionWrapper,\n  MiddleRegionWrapper,\n  OverlayWrapper,\n  RootWrapper,\n  TopRegionWrapper,\n} from './RegionsWithIntersections.styled'\n\ninterface RegionsWithIntersectionsProps {\n  regions: ReportedRegionWithRect<FieldPresenceData>[]\n  render: (\n    regionsWithIntersectionDetails: RegionWithIntersectionDetails[],\n    containerWidth: number,\n  ) => ReactNode | null\n  children: ReactNode\n  margins: [number, number, number, number]\n}\n\nconst toPx = (num: number) => `${num}px`\nconst negate = (num: number) => 0 - num\n\nexport const RegionsWithIntersections = forwardRef(function RegionsWithIntersections(\n  props: RegionsWithIntersectionsProps,\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const {regions, render, children, margins: marginsProp} = props\n\n  const overlayRef = useRef<HTMLDivElement | null>(null)\n\n  // Make sure `margins` is memoized\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const margins = useMemo(() => marginsProp, [JSON.stringify(marginsProp)])\n\n  const io = useMemo(\n    () =>\n      createIntersectionObserver({\n        rootMargin: margins.map(negate).map(toPx).join(' '),\n        threshold: INTERSECTION_THRESHOLDS,\n      }),\n    [margins],\n  )\n\n  const [intersections, setIntersections] = useState<\n    Record<\n      string,\n      | {\n          boundingClientRect: {top: number; bottom: number}\n          isIntersecting: boolean\n          intersectionRect: {top: number; bottom: number}\n        }\n      | undefined\n    >\n  >({})\n\n  const onIntersection = useCallback((id: any, entry: any) => {\n    setIntersections((current) => ({...current, [id]: entry}))\n  }, [])\n\n  const top = intersections['::top']\n  const bottom = intersections['::bottom']\n  const regionsWithIntersectionDetails: RegionWithIntersectionDetails[] = useMemo(\n    () =>\n      (top && bottom\n        ? regions\n            .filter((region) => region.presence?.length > 0)\n            .map((region): RegionWithIntersectionDetails | null => {\n              const intersection = intersections[region.id]\n\n              if (!intersection) {\n                return null\n              }\n\n              const {bottom: boundsBottom, top: boundsTop} = intersection.boundingClientRect\n\n              const aboveTop = intersection.boundingClientRect.top < top.boundingClientRect.bottom\n              const belowBottom =\n                intersection.boundingClientRect.top < bottom.boundingClientRect.top\n\n              // eslint-disable-next-line no-nested-ternary\n              const distanceTop = intersection.isIntersecting\n                ? boundsTop - (intersection.intersectionRect.top - INTERSECTION_ELEMENT_PADDING)\n                : aboveTop\n                  ? -top.boundingClientRect.bottom\n                  : bottom.boundingClientRect.top\n\n              // eslint-disable-next-line no-nested-ternary\n              const distanceBottom = intersection.isIntersecting\n                ? -(\n                    boundsBottom -\n                    (intersection.intersectionRect.bottom + INTERSECTION_ELEMENT_PADDING)\n                  )\n                : belowBottom\n                  ? bottom.boundingClientRect.top\n                  : -top.boundingClientRect.bottom\n\n              const position =\n                // eslint-disable-next-line no-nested-ternary\n                distanceTop <= SNAP_TO_DOCK_DISTANCE_TOP\n                  ? 'top'\n                  : distanceBottom <= SNAP_TO_DOCK_DISTANCE_BOTTOM\n                    ? 'bottom'\n                    : 'inside'\n\n              return {\n                distanceTop,\n                distanceBottom,\n                region,\n                position,\n              }\n            })\n            .filter(Boolean)\n        : []) as RegionWithIntersectionDetails[],\n    [bottom, intersections, regions, top],\n  )\n\n  return (\n    <RootWrapper ref={ref}>\n      <TopRegionWrapper\n        $debug={DEBUG}\n        io={io}\n        id=\"::top\"\n        onIntersection={onIntersection}\n        margins={margins}\n      />\n      <div>{children}</div>\n      <OverlayWrapper ref={overlayRef}>\n        {overlayRef.current &&\n          render(regionsWithIntersectionDetails, overlayRef.current.offsetWidth)}\n      </OverlayWrapper>\n      {regions.map((region) => {\n        const forceWidth = region.rect.width === 0\n        return (\n          <MiddleRegionWrapper\n            $debug={DEBUG}\n            io={io}\n            onIntersection={onIntersection}\n            key={region.id}\n            id={region.id}\n            style={{\n              width: forceWidth ? 1 : region.rect.width,\n              left: region.rect.left - (forceWidth ? 1 : 0),\n              top: region.rect.top - INTERSECTION_ELEMENT_PADDING,\n              height: region.rect.height + INTERSECTION_ELEMENT_PADDING * 2,\n            }}\n          />\n        )\n      })}\n      <BottomRegionWrapper $debug={DEBUG} id=\"::bottom\" io={io} onIntersection={onIntersection} />\n    </RootWrapper>\n  )\n})\n","/* eslint-disable @typescript-eslint/no-use-before-define */\n\nimport {flatten, groupBy, orderBy, sortBy} from 'lodash'\nimport {\n  type CSSProperties,\n  Fragment,\n  memo,\n  type ReactElement,\n  type ReactNode,\n  useCallback,\n  useMemo,\n  useRef,\n} from 'react'\n\nimport {\n  AVATAR_ARROW_HEIGHT,\n  AVATAR_DISTANCE,\n  AVATAR_SIZE,\n  DEBUG,\n  MAX_AVATARS_DOCK,\n  SLIDE_RIGHT_THRESHOLD_BOTTOM,\n  SLIDE_RIGHT_THRESHOLD_TOP,\n} from '../constants'\nimport {FieldPresenceInner} from '../FieldPresence'\nimport {\n  type FieldPresenceData,\n  type Rect,\n  type RegionWithIntersectionDetails,\n  type ReportedRegionWithRect,\n} from '../types'\nimport {RegionsWithIntersections} from './RegionsWithIntersections'\nimport {type ReportedPresenceData, useReportedValues} from './tracker'\n\nconst ITEM_TRANSITION: CSSProperties = {\n  transitionProperty: 'transform',\n  transitionDuration: '200ms',\n  transitionTimingFunction: 'cubic-bezier(0.85, 0, 0.15, 1)',\n}\n\nconst bottom = (rect: {top: number; height: number}) => rect.top + rect.height\n\ntype RegionWithSpacerHeight = RegionWithIntersectionDetails & {\n  spacerHeight: number\n}\n\nfunction withSpacerHeight(\n  regionsWithIntersectionDetails: RegionWithIntersectionDetails[],\n): RegionWithSpacerHeight[] {\n  return regionsWithIntersectionDetails.map(\n    (withIntersection, idx, _regionsWithIntersectionDetails) => {\n      const prevRect = _regionsWithIntersectionDetails[idx - 1]?.region.rect\n      const prevBottom = prevRect ? bottom(prevRect) : 0\n      return {...withIntersection, spacerHeight: withIntersection.region.rect.top - prevBottom}\n    },\n  )\n}\n\nconst orderByTop = (regionsWithIntersectionDetails: RegionWithIntersectionDetails[]) =>\n  orderBy(regionsWithIntersectionDetails, (withIntersection) => withIntersection.region.rect.top)\n\nconst plus = (a: number, b: number) => a + b\nconst sum = (array: number[]) => array.reduce(plus, 0)\n\ntype Margins = [number, number, number, number]\ntype RegionWithSpacerHeightAndIndent = RegionWithSpacerHeight & {indent: number}\n\nfunction group(regionsWithIntersectionDetails: RegionWithIntersectionDetails[]): {\n  top: RegionWithSpacerHeightAndIndent[]\n  inside: RegionWithSpacerHeightAndIndent[]\n  bottom: RegionWithSpacerHeightAndIndent[]\n} {\n  const regionsWithSpacerHeight = withSpacerHeight(orderByTop(regionsWithIntersectionDetails))\n  const grouped: {\n    top: RegionWithSpacerHeight[]\n    inside: RegionWithSpacerHeight[]\n    bottom: RegionWithSpacerHeight[]\n  } = {\n    top: [],\n    inside: [],\n    bottom: [],\n    ...groupBy(regionsWithSpacerHeight, (_withSpacerHeight) => _withSpacerHeight.position),\n  }\n\n  return {\n    top: orderByTop(grouped.top).map(\n      (withIntersection, i, grp): RegionWithSpacerHeightAndIndent => ({\n        ...(withIntersection as RegionWithSpacerHeight),\n        indent: grp\n          .slice(i + 1)\n          .reduce((w, _withIntersection) => w + _withIntersection.region.rect.width, 0),\n      }),\n    ),\n    inside: orderByTop(grouped.inside).map(\n      (withIntersection): RegionWithSpacerHeightAndIndent => ({\n        ...(withIntersection as RegionWithSpacerHeight),\n        indent: 0,\n      }),\n    ),\n    bottom: orderByTop(grouped.bottom).map(\n      (withIntersection, i, grp): RegionWithSpacerHeightAndIndent => ({\n        ...(withIntersection as RegionWithSpacerHeight),\n        indent: grp\n          .slice(0, i)\n          .reduce((w, _withIntersection) => w + _withIntersection.region.rect.width, 0),\n      }),\n    ),\n  }\n}\n\nconst Spacer = ({height, ...rest}: {height: number; style?: CSSProperties}) => (\n  <div style={{height: Math.max(0, height), ...rest?.style}} />\n)\n\nconst DEFAULT_MARGINS: Margins = [0, 0, 0, 0]\n\nconst getOffsetsTo = (source: HTMLElement, target: HTMLElement) => {\n  let el: HTMLElement | null = source\n  let top = -el.scrollTop\n  let left = 0\n  while (el && el !== target) {\n    top += el.offsetTop - el.scrollTop\n    left += el.offsetLeft\n    el = el.offsetParent instanceof HTMLElement ? el.offsetParent : null\n  }\n  return {top, left}\n}\n\nfunction getRelativeRect(element: HTMLElement, parent: HTMLElement): Rect {\n  return {\n    ...getOffsetsTo(element, parent),\n    width: element.offsetWidth,\n    height: element.offsetHeight,\n  }\n}\n\nfunction regionsWithComputedRects(\n  regions: ReportedPresenceData[],\n  parent: HTMLElement,\n): ReportedRegionWithRect<FieldPresenceData>[] {\n  return regions.map(([id, region]) => ({\n    ...region,\n    id,\n    rect: getRelativeRect(region.element, parent),\n  }))\n}\n\ntype Props = {margins: Margins; children: ReactNode}\nexport function StickyOverlay(props: Props) {\n  const {children, margins = DEFAULT_MARGINS} = props\n  const reportedValues = useReportedValues()\n  const ref = useRef<HTMLDivElement | null>(null)\n  const regions = useMemo(\n    () => (ref.current ? regionsWithComputedRects(reportedValues, ref.current) : EMPTY_ARRAY),\n    [reportedValues],\n  )\n\n  const renderCallback = useCallback(\n    (regionsWithIntersectionDetails: RegionWithIntersectionDetails[], containerWidth: any) => {\n      const grouped = group(\n        regionsWithIntersectionDetails.filter((item) => item.region.presence.length > 0),\n      )\n      const topSpacing = sum(grouped.top.map((n) => n.region.rect.height + n.spacerHeight))\n      const bottomSpacing = sum(\n        [...grouped.inside, ...grouped.bottom].map((n) => n.region.rect.height + n.spacerHeight),\n      )\n\n      // todo: this needs cleaning up, should process all the needed layout data in one go\n      const counts = grouped.inside.reduce(\n        (_counts, withIntersection) => {\n          const {distanceTop, distanceBottom} = withIntersection\n\n          const nearTop = distanceTop <= SLIDE_RIGHT_THRESHOLD_TOP\n          const nearBottom = distanceBottom <= SLIDE_RIGHT_THRESHOLD_BOTTOM\n          return {\n            nearTop: _counts.nearTop + (nearTop ? withIntersection.region.presence.length : 0),\n            nearBottom:\n              _counts.nearBottom + (nearBottom ? withIntersection.region.presence.length : 0),\n          }\n        },\n        {nearTop: 0, nearBottom: 0},\n      )\n\n      return (\n        <>\n          <PresenceDock\n            closeCount={counts.nearTop}\n            margins={margins}\n            position=\"top\"\n            regionsWithIntersectionDetails={grouped.top}\n          />\n          <Spacer height={topSpacing} />\n          <PresenceInside\n            containerWidth={containerWidth}\n            regionsWithIntersectionDetails={grouped.inside}\n          />\n          <Spacer height={bottomSpacing} />\n          <PresenceDock\n            closeCount={counts.nearBottom}\n            margins={margins}\n            position=\"bottom\"\n            regionsWithIntersectionDetails={grouped.bottom}\n          />\n        </>\n      )\n    },\n    [margins],\n  )\n\n  return (\n    <RegionsWithIntersections ref={ref} margins={margins} regions={regions} render={renderCallback}>\n      {children}\n    </RegionsWithIntersections>\n  )\n}\n\nconst EMPTY_ARRAY: never[] = []\n\nconst PresenceDock = memo(function PresenceDock(props: {\n  closeCount: number\n  margins: Margins\n  position: 'top' | 'bottom'\n  regionsWithIntersectionDetails: RegionWithIntersectionDetails[]\n}) {\n  const {closeCount, margins, position, regionsWithIntersectionDetails} = props\n  const dir = position === 'top' ? 1 : -1\n  const allPresenceItems = useMemo(() => {\n    if (!regionsWithIntersectionDetails.length) {\n      return EMPTY_ARRAY\n    }\n\n    return flatten(\n      sortBy(regionsWithIntersectionDetails, (r) => r.region.rect.top * dir).map(\n        (withIntersection) => withIntersection.region.presence || EMPTY_ARRAY,\n      ),\n    )\n  }, [dir, regionsWithIntersectionDetails])\n  const [topMargin, rightMargin, bottomMargin, leftMargin] = margins\n  const leftOffset =\n    (leftMargin || 0) +\n    (allPresenceItems.length > 0 ? -closeCount * (AVATAR_SIZE + AVATAR_DISTANCE) : 0) -\n    rightMargin\n\n  const margin = position === 'top' ? topMargin : bottomMargin\n\n  const style: CSSProperties = useMemo(\n    () => ({\n      zIndex: 2,\n      position: 'sticky',\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'flex-end',\n      ...ITEM_TRANSITION,\n      transform: `translate3d(${leftOffset}px, 0px, 0px)`,\n      top: AVATAR_ARROW_HEIGHT + 1 + margin,\n      bottom: AVATAR_ARROW_HEIGHT + 1 + margin,\n    }),\n    [leftOffset, margin],\n  )\n\n  return (\n    <div data-dock={position} key={`sticky-${position}`} style={style}>\n      <FieldPresenceInner\n        position={position}\n        maxAvatars={MAX_AVATARS_DOCK}\n        presence={allPresenceItems}\n      />\n    </div>\n  )\n})\n\nfunction PresenceInside(props: {\n  containerWidth: number\n  regionsWithIntersectionDetails: RegionWithSpacerHeight[]\n}) {\n  const {regionsWithIntersectionDetails, containerWidth} = props\n\n  return (\n    <>\n      {regionsWithIntersectionDetails.map((withIntersection) => {\n        const originalLeft = withIntersection.region.rect.left\n        const {distanceTop, distanceBottom} = withIntersection\n\n        const nearTop = distanceTop <= SLIDE_RIGHT_THRESHOLD_TOP\n        const nearBottom = distanceBottom <= SLIDE_RIGHT_THRESHOLD_BOTTOM\n\n        const diffRight = containerWidth - originalLeft - withIntersection.region.rect.width\n\n        const {presence, maxAvatars} = withIntersection.region\n        return (\n          <Fragment key={withIntersection.region.id}>\n            <div\n              style={{\n                zIndex: 2,\n                position: 'absolute',\n                ...ITEM_TRANSITION,\n                left: originalLeft,\n                transform: `translate3d(${nearTop || nearBottom ? diffRight : 0}px, 0px, 0px)`,\n                height: withIntersection.region.rect.height,\n                top: withIntersection.region.rect.top,\n              }}\n            >\n              <DebugValue value={() => `${distanceTop} | ${distanceBottom}`}>\n                <FieldPresenceInner\n                  stack={!nearTop && !nearBottom}\n                  // eslint-disable-next-line no-nested-ternary\n                  position={nearTop ? 'top' : nearBottom ? 'bottom' : 'inside'}\n                  maxAvatars={maxAvatars}\n                  presence={presence}\n                />\n              </DebugValue>\n            </div>\n          </Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nconst PassThrough = (props: {children: ReactElement; [prop: string]: any}) => props.children\n\nconst DebugValue = DEBUG\n  ? function DebugValue(props: any) {\n      return (\n        <div style={{position: 'absolute'}}>\n          {props.children}\n          <span\n            style={{\n              top: 0,\n              left: -15,\n              fontSize: 11,\n              right: -15,\n              textAlign: 'center',\n              height: AVATAR_SIZE,\n              color: 'white',\n              backgroundColor: 'rgba(0, 0, 0, 0.8)',\n              position: 'absolute',\n              zIndex: 1000,\n            }}\n          >\n            {props.value()}\n          </span>\n        </div>\n      )\n    }\n  : PassThrough\n","import {type ReactNode} from 'react'\n\nimport {DISABLE_OVERLAY} from '../constants'\nimport {StickyOverlay} from './StickyOverlay'\nimport {Tracker} from './tracker'\n\n/** @internal */\nexport interface PresenceOverlayProps {\n  children: ReactNode\n  margins?: [number, number, number, number]\n}\n\nconst DEFAULT_MARGINS: [number, number, number, number] = [0, 0, 0, 0]\n\nfunction OverlayEnabled({children, margins}: PresenceOverlayProps) {\n  return (\n    <Tracker>\n      <StickyOverlay margins={margins || DEFAULT_MARGINS}>{children}</StickyOverlay>\n    </Tracker>\n  )\n}\n\n/** @internal */\nexport function OverlayDisabled(props: PresenceOverlayProps) {\n  return props.children as JSX.Element\n}\n\n/** @internal */\nexport const PresenceOverlay = DISABLE_OVERLAY ? OverlayDisabled : OverlayEnabled\n","import {Box, Card, Flex} from '@sanity/ui'\nimport {type ReactNode, useCallback, useEffect, useMemo, useState} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {TooltipDelayGroupProvider} from '../../../../ui-components'\nimport {type DocumentFieldActionNode} from '../../../config'\nimport {FieldPresence, type FormNodePresence} from '../../../presence'\nimport {calcAvatarStackWidth} from '../../../presence/utils'\nimport {FieldActionMenu} from '../../field'\nimport {type FieldCommentsProps} from '../../types'\n\nconst Root = styled(Flex)<{\n  $floatingCardWidth: number\n  $slotWidth: number\n  $floatingCardVisible: boolean\n}>(({theme, $floatingCardWidth, $slotWidth, $floatingCardVisible}) => {\n  const {space} = theme.sanity\n  return css`\n    /* Prevent buttons from taking up extra vertical space */\n    line-height: 1;\n    width: 100%;\n    /* For floating actions menu */\n    position: relative;\n\n    [data-ui='PresenceBox'] {\n      position: absolute;\n      bottom: 0;\n      right: ${$slotWidth + $floatingCardWidth + space[1]}px;\n    }\n    @media (hover: hover) {\n      // If hover is supported, we hide the floating card by default, so only add space for it when it's visible.\n      [data-ui='PresenceBox'] {\n        position: absolute;\n        bottom: 0;\n        right: ${$slotWidth + ($floatingCardVisible ? $floatingCardWidth : 0) + space[1]}px;\n      }\n    }\n  `\n})\n\nconst ContentBox = styled(Box)<{\n  $presenceMaxWidth: number\n}>(({theme, $presenceMaxWidth}) => {\n  const {space} = theme.sanity\n  return css`\n    max-width: calc(100% - ${$presenceMaxWidth + space[1]}px);\n    min-width: 75%;\n  `\n})\n\nconst SlotBox = styled(Box)<{\n  $right: number\n  $fieldActionsVisible: boolean\n}>(({theme, $right, $fieldActionsVisible}) => {\n  const {space} = theme.sanity\n  const right = $fieldActionsVisible ? $right + space[1] : $right\n  return css`\n    position: absolute;\n    bottom: 0;\n    right: ${right}px;\n  `\n})\n\nconst FieldActionsFloatingCard = styled(Card)`\n  align-items: center;\n  bottom: 0;\n  position: absolute;\n  right: 0;\n  transition: opacity 150ms ease;\n  line-height: 1;\n\n  @media (hover: hover) {\n    // If hover is supported, we hide the floating card by default\n    // and only show it when it has focus within or when the field is hovered or focused.\n    opacity: 0;\n    pointer-events: none;\n\n    [data-ui='FieldActionsFlex'] {\n      opacity: 0;\n    }\n\n    &[data-actions-visible='false']:not(:focus-within) {\n      // Remove the shadow when the field actions are not visible\n      box-shadow: none;\n\n      // Since the field actions always will be present in the DOM (to make them focusable) \n      // they will always affect the width of the floating card, even when they are not visible.\n      // Therefore, we remove the background of the floating card when the field actions are not visible.\n      background: transparent;\n    }\n\n    // Remove the shadow when the field has comments but no actions\n    &[data-has-comments='true']:not([data-has-actions='true']) {\n      box-shadow: none;\n    }\n\n    // Show the floating card when it has focus within (ie when field actions are focused).\n    &:focus-within {\n      opacity: 1;\n      pointer-events: auto;\n      width: max-content;\n\n      [data-ui='FieldActionsFlex'] {\n        opacity: 1;\n        pointer-events: auto;\n        width: max-content;\n      }\n    }\n  }\n\n  &[data-visible='true'] {\n    opacity: 1;\n    pointer-events: auto;\n    width: max-content;\n  }\n\n  &[data-actions-visible='true'] {\n    [data-ui='FieldActionsFlex'] {\n      opacity: 1;\n      pointer-events: auto;\n      width: max-content;\n    }\n  }\n`\n\nconst FieldActionsFlex = styled(Flex)`\n  gap: inherit;\n  transition: opacity 150ms ease;\n`\n\nconst MAX_AVATARS = 4\n\ninterface FormFieldBaseHeaderProps {\n  __internal_comments?: FieldCommentsProps // DO NOT USE\n  __internal_slot?: ReactNode // ONLY USED BY AI ASSIST PLUGIN\n  actions?: DocumentFieldActionNode[]\n  content: ReactNode\n  fieldFocused: boolean\n  fieldHovered: boolean\n  presence?: FormNodePresence[]\n}\n\nexport function FormFieldBaseHeader(props: FormFieldBaseHeaderProps) {\n  const {\n    __internal_comments: comments,\n    __internal_slot: slot,\n    actions,\n    content,\n    fieldFocused,\n    fieldHovered,\n    presence,\n  } = props\n  const [focused, setFocused] = useState<boolean>(false)\n  // State for if an actions menu is open\n  const [menuOpen, setMenuOpen] = useState<boolean>(false)\n\n  // States for floating card element and its width\n  const [floatingCardElement, setFloatingCardElement] = useState<HTMLDivElement | null>(null)\n  const [floatingCardWidth, setFloatingCardWidth] = useState<number>(0)\n\n  // States for slot element and its width\n  const [slotElement, setSlotElement] = useState<HTMLDivElement | null>(null)\n  const [slotWidth, setSlotWidth] = useState<number>(0)\n\n  // Extract comment related data with default values\n  const {\n    hasComments = false,\n    button: commentButton = null,\n    isAddingComment = false,\n  } = comments || {}\n  // Determine if actions exist and if field actions should be shown\n  const hasActions = actions && actions.length > 0\n  const showFieldActions = fieldFocused || fieldHovered || menuOpen || isAddingComment\n\n  // Determine if there's a comment button or actions to show.\n  // We check for `comments.button` since that's the visual element that should be\n  // used for comments. If no button is provided, we don't have anything to show for comments.\n  const hasCommentsButtonOrActions = comments?.button || hasActions\n\n  // Determine if floating card with actions should be shown\n  const shouldShowFloatingCard = focused || showFieldActions || hasComments\n\n  const handleSetFloatingCardElementWidth = useCallback(() => {\n    if (floatingCardElement) {\n      const {width} = floatingCardElement.getBoundingClientRect()\n      setFloatingCardWidth(width || 0)\n    }\n  }, [floatingCardElement])\n\n  // When a focus or blur event occurs on the floating card, we need to recalculate its width.\n  // This is because presence should be positioned relative to the floating card.\n  // We need this because we don't conditionally render the floating card and rely on CSS to\n  // show/hide it, and therefore the width calculation won't be triggered when the card is shown or hidden.\n  const handleFocusCapture = useCallback(() => {\n    handleSetFloatingCardElementWidth()\n    setFocused(true)\n  }, [handleSetFloatingCardElementWidth])\n\n  const handleBlurCapture = useCallback(() => {\n    handleSetFloatingCardElementWidth()\n    setFocused(false)\n  }, [handleSetFloatingCardElementWidth])\n\n  // Calculate floating card's width\n  useEffect(() => {\n    handleSetFloatingCardElementWidth()\n  }, [handleSetFloatingCardElementWidth, showFieldActions])\n\n  // Calculate slot element's width\n  useEffect(() => {\n    if (slotElement) {\n      const {width} = slotElement.getBoundingClientRect()\n      setSlotWidth(width || 0)\n    }\n  }, [slotElement])\n\n  // Construct the slot element if slot is provided\n  const slotEl = useMemo(() => {\n    if (!slot) return null\n\n    return (\n      <SlotBox\n        $fieldActionsVisible={Boolean(showFieldActions)}\n        $right={floatingCardWidth}\n        ref={setSlotElement}\n      >\n        {slot}\n      </SlotBox>\n    )\n  }, [floatingCardWidth, showFieldActions, slot])\n\n  return (\n    <Root\n      align=\"flex-end\"\n      justify=\"space-between\"\n      $floatingCardVisible={shouldShowFloatingCard}\n      $floatingCardWidth={floatingCardWidth}\n      $slotWidth={slotWidth}\n    >\n      <ContentBox\n        data-ui=\"fieldHeaderContentBox\"\n        flex={1}\n        paddingY={2}\n        $presenceMaxWidth={calcAvatarStackWidth(MAX_AVATARS)}\n      >\n        {content}\n      </ContentBox>\n\n      {presence && presence.length > 0 && (\n        <Box data-ui=\"PresenceBox\" flex=\"none\">\n          <FieldPresence maxAvatars={MAX_AVATARS} presence={presence} />\n        </Box>\n      )}\n\n      {slotEl}\n\n      {(hasCommentsButtonOrActions || hasComments) && (\n        <TooltipDelayGroupProvider>\n          <FieldActionsFloatingCard\n            data-actions-visible={showFieldActions ? 'true' : 'false'}\n            data-has-actions={hasActions ? 'true' : 'false'}\n            data-has-comments={hasComments ? 'true' : 'false'}\n            data-visible={shouldShowFloatingCard ? 'true' : 'false'}\n            display=\"flex\"\n            onBlurCapture={handleBlurCapture}\n            onFocusCapture={handleFocusCapture}\n            ref={setFloatingCardElement}\n            sizing=\"border\"\n          >\n            {hasActions && (\n              <FieldActionsFlex align=\"center\" data-ui=\"FieldActionsFlex\">\n                <FieldActionMenu nodes={actions} onMenuOpenChange={setMenuOpen} />\n              </FieldActionsFlex>\n            )}\n\n            {commentButton}\n          </FieldActionsFloatingCard>\n        </TooltipDelayGroupProvider>\n      )}\n    </Root>\n  )\n}\n","import {type ReactNode} from 'react'\n\n/**\n * Creates a description id from a field id, for use with aria-describedby in the field,\n * and added to the descriptive element id.\n * @internal\n */\nexport function createDescriptionId(\n  id: string | undefined,\n  description: ReactNode | undefined,\n): string | undefined {\n  if (!description || !id) return undefined\n  return `desc_${id}`\n}\n","import {ErrorOutlineIcon, InfoOutlineIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {type FormNodeValidation} from '@sanity/types'\nimport {Box, Flex, type Placement, Stack, Text} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {Tooltip} from '../../../../ui-components'\nimport {useListFormat} from '../../../hooks'\nimport {useTranslation} from '../../../i18n'\n\n/** @internal */\nexport interface FormFieldValidationStatusProps {\n  /**\n   *\n   * @hidden\n   * @beta\n   */\n  validation?: FormNodeValidation[]\n  /**\n   *\n   * @hidden\n   * @beta\n   */\n  __unstable_showSummary?: boolean\n  fontSize?: number | number\n  placement?: Placement\n}\n\nconst EMPTY_ARRAY: never[] = []\n\nconst VALIDATION_ICONS = {\n  error: ValidationErrorIcon,\n  warning: ValidationWarningIcon,\n  info: ValidationInfoIcon,\n}\n\nconst StyledStack = styled(Stack)`\n  max-width: 200px;\n`\n\nconst StatusText = styled(Text)<{$status: 'error' | 'warning' | 'info'}>(({$status}) => {\n  if ($status === 'error') {\n    return {'--card-icon-color': 'var(--card-badge-critical-icon-color)'}\n  }\n\n  if ($status === 'warning') {\n    return {'--card-icon-color': 'var(--card-badge-caution-icon-color)'}\n  }\n\n  if ($status === 'info') {\n    return {'--card-icon-color': 'var(--card-badge-primary-icon-color)'}\n  }\n\n  return {}\n})\n\n/** @internal */\nexport function FormFieldValidationStatus(props: FormFieldValidationStatusProps) {\n  const {validation = EMPTY_ARRAY, __unstable_showSummary: showSummary, fontSize, placement} = props\n\n  const hasErrors = validation.some((v) => v.level === 'error')\n  const hasWarnings = validation.some((v) => v.level === 'warning')\n\n  // eslint-disable-next-line no-nested-ternary\n  const status = hasErrors ? 'error' : hasWarnings ? 'warning' : 'info'\n  const StatusIcon = VALIDATION_ICONS[status]\n\n  return (\n    <Tooltip\n      content={\n        <StyledStack space={3}>\n          {showSummary && <FormFieldValidationSummary validation={validation} />}\n\n          {!showSummary && (\n            <>\n              {validation.map((item, itemIndex) => (\n                // eslint-disable-next-line react/no-array-index-key\n                <FormFieldValidationStatusItem validation={item} key={itemIndex} />\n              ))}\n            </>\n          )}\n        </StyledStack>\n      }\n      portal\n      placement={placement}\n      fallbackPlacements={['bottom', 'right', 'left']}\n    >\n      <div>\n        <StatusText $status={status} size={fontSize} weight=\"medium\">\n          {StatusIcon && <StatusIcon />}\n        </StatusText>\n      </div>\n    </Tooltip>\n  )\n}\n\nfunction FormFieldValidationStatusItem(props: {validation: FormNodeValidation}) {\n  const {validation} = props\n\n  const StatusIcon = VALIDATION_ICONS[validation.level]\n\n  return (\n    <Flex>\n      <Box marginRight={2}>\n        <StatusText $status={validation.level} size={1}>\n          {StatusIcon && <StatusIcon />}\n        </StatusText>\n      </Box>\n      <Box flex={1}>\n        <Text size={1}>{validation.message}</Text>\n      </Box>\n    </Flex>\n  )\n}\n\nfunction FormFieldValidationSummary({validation}: {validation: FormNodeValidation[]}) {\n  const {t} = useTranslation()\n  const listFormatter = useListFormat()\n\n  const errorCount = validation.reduce(\n    (count, item) => (item.level === 'error' ? count + 1 : count),\n    0,\n  )\n  const warningCount = validation.reduce(\n    (count, item) => (item.level === 'warning' ? count + 1 : count),\n    0,\n  )\n\n  const hasErrors = errorCount > 0\n  const hasWarnings = warningCount > 0\n\n  if (!hasErrors && !hasWarnings) {\n    return null\n  }\n\n  const errorText = hasErrors && t('form.validation.summary.errors-count', {count: errorCount})\n  const warningText =\n    hasWarnings && t('form.validation.summary.warnings-count', {count: warningCount})\n\n  return errorText && warningText ? (\n    <Text size={1}>{listFormatter.format([errorText, warningText])}</Text>\n  ) : (\n    <Text size={1}>{errorText || warningText}</Text>\n  )\n}\n\nfunction ValidationErrorIcon() {\n  const {t} = useTranslation()\n  return (\n    <ErrorOutlineIcon\n      data-testid=\"input-validation-icon-error\"\n      aria-label={t('form.validation.has-error-aria-label')}\n      aria-hidden\n      role=\"presentation\"\n    />\n  )\n}\n\nfunction ValidationWarningIcon() {\n  const {t} = useTranslation()\n  return (\n    <WarningOutlineIcon\n      data-testid=\"input-validation-icon-warning\"\n      aria-label={t('form.validation.has-warning-aria-label')}\n      aria-hidden\n      role=\"presentation\"\n    />\n  )\n}\n\nfunction ValidationInfoIcon() {\n  const {t} = useTranslation()\n  return (\n    <InfoOutlineIcon\n      data-testid=\"input-validation-icon-info\"\n      aria-label={t('form.validation.has-info-aria-label')}\n      aria-hidden\n      role=\"presentation\"\n    />\n  )\n}\n","import {type DeprecatedProperty, type FormNodeValidation} from '@sanity/types'\nimport {Badge, Box, Flex, Stack, Text} from '@sanity/ui'\nimport {memo, type ReactNode} from 'react'\nimport styled from 'styled-components'\n\nimport {TextWithTone} from '../../../components'\nimport {useTranslation} from '../../../i18n'\nimport {createDescriptionId} from '../../members/common/createDescriptionId'\nimport {FormFieldValidationStatus} from './FormFieldValidationStatus'\n\nconst LabelSuffix = styled(Flex)`\n  /*\n   * Prevent the block size of appended elements (such as the deprecated field badge) affecting\n   * the intrinsic block size of the label.\n   */\n  contain: size;\n`\n\n/** @internal */\nexport interface FormFieldHeaderTextProps {\n  /**\n   *\n   * @hidden\n   * @beta\n   */\n  validation?: FormNodeValidation[]\n  description?: ReactNode\n  /**\n   * The unique ID used to target the actual input element\n   */\n  inputId?: string\n  title?: ReactNode\n  deprecated?: DeprecatedProperty\n}\n\nconst EMPTY_ARRAY: never[] = []\n\n/** @internal */\nexport const FormFieldHeaderText = memo(function FormFieldHeaderText(\n  props: FormFieldHeaderTextProps,\n) {\n  const {description, inputId, title, deprecated, validation = EMPTY_ARRAY} = props\n  const {t} = useTranslation()\n  const hasValidations = validation.length > 0\n  const hasLabelSuffix = deprecated || hasValidations\n\n  return (\n    <Stack space={3}>\n      <Flex align=\"center\" paddingY={1}>\n        <Text as=\"label\" htmlFor={inputId} weight=\"medium\" size={1}>\n          {title || (\n            <span style={{color: 'var(--card-muted-fg-color)'}}>\n              {t('form.field.untitled-field-label')}\n            </span>\n          )}\n        </Text>\n\n        {hasLabelSuffix && (\n          <LabelSuffix align=\"center\" flex={1}>\n            {deprecated && (\n              <Box marginLeft={2}>\n                <Badge data-testid={`deprecated-badge-${title}`} tone=\"caution\">\n                  {t('form.field.deprecated-label')}\n                </Badge>\n              </Box>\n            )}\n\n            {hasValidations && (\n              <Box marginLeft={2}>\n                <FormFieldValidationStatus fontSize={1} placement=\"top\" validation={validation} />\n              </Box>\n            )}\n          </LabelSuffix>\n        )}\n      </Flex>\n\n      {deprecated && (\n        <TextWithTone data-testid={`deprecated-message-${title}`} tone=\"caution\" size={1}>\n          {deprecated.reason}\n        </TextWithTone>\n      )}\n\n      {description && (\n        <Text muted size={1} id={createDescriptionId(inputId, description)}>\n          {description}\n        </Text>\n      )}\n    </Stack>\n  )\n})\n","import {type DeprecatedProperty, type FormNodeValidation} from '@sanity/types'\nimport {Stack} from '@sanity/ui'\nimport {type HTMLProps, memo, type ReactNode} from 'react'\n\nimport {type DocumentFieldActionNode} from '../../../config'\nimport {type FormNodePresence} from '../../../presence'\nimport {useFieldActions} from '../../field'\nimport {type FieldCommentsProps} from '../../types'\nimport {FormFieldBaseHeader} from './FormFieldBaseHeader'\nimport {FormFieldHeaderText} from './FormFieldHeaderText'\n\nconst EMPTY_ARRAY: never[] = []\n\n/** @internal */\nexport interface FormFieldProps {\n  /**\n   * @hidden\n   * @beta\n   */\n  __unstable_headerActions?: DocumentFieldActionNode[]\n  /**\n   * @hidden\n   * @beta\n   */\n  __unstable_presence?: FormNodePresence[]\n  /** @internal @deprecated DO NOT USE */\n  __internal_comments?: FieldCommentsProps\n  /** @internal @deprecated ONLY USED BY AI ASSIST PLUGIN */\n  __internal_slot?: ReactNode\n  children: ReactNode\n  description?: ReactNode\n  /**\n   * The unique ID used to target the actual input element\n   */\n  inputId?: string\n  /**\n   * The nesting level of the form field\n   */\n  level?: number\n  title?: ReactNode\n  /**\n   * @beta\n   */\n  validation?: FormNodeValidation[]\n  deprecated?: DeprecatedProperty\n}\n\n/** @internal */\nexport const FormField = memo(function FormField(\n  props: FormFieldProps & Omit<HTMLProps<HTMLDivElement>, 'as' | 'height' | 'ref'>,\n) {\n  const {\n    __unstable_headerActions: actions = EMPTY_ARRAY,\n    __unstable_presence: presence = EMPTY_ARRAY,\n    __internal_slot: slot = null,\n    __internal_comments: comments,\n    children,\n    description,\n    inputId,\n    level,\n    title,\n    validation,\n    deprecated,\n    ...restProps\n  } = props\n  const {focused, hovered, onMouseEnter, onMouseLeave} = useFieldActions()\n\n  return (\n    <Stack\n      {...restProps}\n      data-level={level}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      space={2}\n    >\n      {/*\n        NOTE: Its not ideal to hide validation, presence and description when there's no `title`.\n        So we might want to separate the concerns of input vs formfield components later on.\n      */}\n      {title && (\n        <FormFieldBaseHeader\n          __internal_comments={comments}\n          __internal_slot={slot}\n          actions={actions}\n          fieldFocused={Boolean(focused)}\n          fieldHovered={hovered}\n          presence={presence}\n          content={\n            <FormFieldHeaderText\n              description={description}\n              inputId={inputId}\n              title={title}\n              validation={validation}\n              deprecated={deprecated}\n            />\n          }\n        />\n      )}\n      <div>{children}</div>\n    </Stack>\n  )\n})\n","import {ToggleArrowRightIcon} from '@sanity/icons'\nimport {Box, Flex, rem, Text, type Theme} from '@sanity/ui'\nimport {memo, type ReactNode} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {useTranslation} from '../../../i18n'\nimport {focusRingStyle} from './styles'\n\nexport interface FormFieldSetLegendProps {\n  collapsed: boolean\n  collapsible?: boolean\n  onClick?: () => void\n  title: ReactNode\n}\n\nconst Root = styled.legend`\n  /* See: https://thatemil.com/blog/2015/01/03/reset-your-fieldset/ */\n  padding: 0;\n  display: table;\n`\n\nconst ToggleButton = styled(Flex).attrs({forwardedAs: 'button'})((props: {theme: Theme}) => {\n  const {theme} = props\n  const {focusRing, radius} = theme.sanity\n  const {base} = theme.sanity.color\n\n  return css`\n    appearance: none;\n    border: 0;\n    background: none;\n    color: inherit;\n    -webkit-font-smoothing: inherit;\n    font: inherit;\n    outline: none;\n    border-radius: ${rem(radius[2])};\n    position: relative;\n\n    &:not([hidden]) {\n      display: flex;\n    }\n\n    &:focus {\n      box-shadow: ${focusRingStyle({base, focusRing})};\n    }\n\n    &:focus:not(:focus-visible) {\n      box-shadow: none;\n    }\n\n    /* Added to increase the hit area of the collapsible fieldset */\n    &::after {\n      content: '';\n      position: absolute;\n      top: -10px;\n      right: -10px;\n      bottom: -10px;\n      left: -10px;\n    }\n  `\n})\n\nconst ToggleIconBox = styled(Box)`\n  width: 9px;\n  height: 9px;\n  margin-right: 3px;\n\n  & svg {\n    transition: transform 100ms;\n  }\n`\n\nexport const FormFieldSetLegend = memo(function FormFieldSetLegend(props: FormFieldSetLegendProps) {\n  const {collapsed, collapsible, onClick, title} = props\n  const {t} = useTranslation()\n\n  const text = (\n    <Text weight=\"medium\" size={1}>\n      {title || (\n        <span style={{color: 'var(--card-muted-fg-color)'}}>\n          {t('form.field.untitled-fieldset-label')}\n        </span>\n      )}\n    </Text>\n  )\n\n  if (!collapsible) {\n    return <Root>{text}</Root>\n  }\n\n  return (\n    <Root>\n      <ToggleButton type=\"button\" onClick={onClick}>\n        <ToggleIconBox>\n          <Text muted size={1}>\n            <ToggleArrowRightIcon\n              style={{\n                transform: `rotate(${collapsed ? '0' : '90deg'}) translate3d(0, 0, 0)`,\n              }}\n            />\n          </Text>\n        </ToggleIconBox>\n\n        {text}\n      </ToggleButton>\n    </Root>\n  )\n})\n","/* eslint-disable camelcase */\nimport {type DeprecatedProperty, type FormNodeValidation} from '@sanity/types'\nimport {Badge, Box, Flex, Stack, Text, type Theme, useForwardedRef} from '@sanity/ui'\nimport {\n  type FocusEvent,\n  type ForwardedRef,\n  forwardRef,\n  type HTMLProps,\n  type ReactNode,\n  useCallback,\n  useMemo,\n} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {TextWithTone} from '../../../components'\nimport {type DocumentFieldActionNode} from '../../../config'\nimport {useTranslation} from '../../../i18n'\nimport {type FormNodePresence} from '../../../presence'\nimport {useFieldActions} from '../../field'\nimport {createDescriptionId} from '../../members/common/createDescriptionId'\nimport {type FieldCommentsProps} from '../../types'\nimport {FormFieldBaseHeader} from './FormFieldBaseHeader'\nimport {FormFieldSetLegend} from './FormFieldSetLegend'\nimport {FormFieldValidationStatus} from './FormFieldValidationStatus'\nimport {AlignedBottomGrid, focusRingStyle} from './styles'\n\n/** @internal */\nexport interface FormFieldSetProps {\n  /**\n   *\n   * @hidden\n   * @beta\n   */\n  __unstable_headerActions?: DocumentFieldActionNode[]\n  /**\n   * @beta\n   */\n  __unstable_presence?: FormNodePresence[]\n  /** @internal @deprecated DO NOT USE */\n  __internal_comments?: FieldCommentsProps\n  /** @internal @deprecated ONLY USED BY AI ASSIST PLUGIN */\n  __internal_slot?: ReactNode\n  children: ReactNode | (() => ReactNode)\n  collapsed?: boolean\n  collapsible?: boolean\n  columns?: number | number[]\n  description?: ReactNode\n  /**\n   * The nesting level of the form field set\n   */\n  level?: number\n  onCollapse?: () => void\n  onExpand?: () => void\n  title?: ReactNode\n  /**\n   *\n   * @hidden\n   * @beta\n   */\n  validation?: FormNodeValidation[]\n  inputId: string\n  deprecated?: DeprecatedProperty\n}\n\nfunction getChildren(children: ReactNode | (() => ReactNode)): ReactNode {\n  return typeof children === 'function' ? children() : children\n}\n\nconst Root = styled(Stack).attrs({forwardedAs: 'fieldset'})`\n  border: none;\n\n  /* See: https://thatemil.com/blog/2015/01/03/reset-your-fieldset/ */\n  body:not(:-moz-handler-blocked) & {\n    display: table-cell;\n  }\n`\n\nconst Content = styled(Box)<{\n  /*\n   * @note: The dollar sign ($) prefix is a `styled-components` convention for\n   * denoting transient props. See:\n   * https://styled-components.com/docs/api#transient-props\n   */\n  $borderLeft: boolean\n  theme: Theme\n}>((props) => {\n  const {$borderLeft, theme} = props\n  const {focusRing} = theme.sanity\n  const {base} = theme.sanity.color\n\n  return css`\n    outline: none;\n    border-left: ${$borderLeft ? '1px solid var(--card-border-color)' : undefined};\n\n    &:focus {\n      box-shadow: ${focusRingStyle({base, focusRing: {...focusRing, offset: 2}})};\n    }\n\n    &:focus:not(:focus-visible) {\n      box-shadow: none;\n    }\n  `\n})\n\nconst EMPTY_ARRAY: never[] = []\n\n/** @internal */\nexport const FormFieldSet = forwardRef(function FormFieldSet(\n  props: FormFieldSetProps & Omit<HTMLProps<HTMLDivElement>, 'as' | 'height' | 'ref'>,\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const {\n    __internal_comments: comments,\n    __internal_slot: slot = null,\n    __unstable_headerActions: actions = EMPTY_ARRAY,\n    __unstable_presence: presence = EMPTY_ARRAY,\n    children,\n    collapsed,\n    collapsible,\n    columns,\n    description,\n    level = 0,\n    onCollapse,\n    onExpand,\n    onFocus,\n    tabIndex,\n    title,\n    validation = EMPTY_ARRAY,\n    inputId,\n    deprecated,\n    ...restProps\n  } = props\n\n  const {focused, hovered, onMouseEnter, onMouseLeave} = useFieldActions()\n\n  const hasValidationMarkers = validation.length > 0\n  const forwardedRef = useForwardedRef(ref)\n  const {t} = useTranslation()\n\n  const handleFocus = useCallback(\n    (event: FocusEvent<HTMLDivElement>) => {\n      const element = forwardedRef.current\n\n      if (element === event.target) {\n        if (onFocus) onFocus(event)\n      }\n    },\n    [forwardedRef, onFocus],\n  )\n\n  const handleToggle = useCallback(\n    () => (collapsed ? onExpand?.() : onCollapse?.()),\n    [collapsed, onCollapse, onExpand],\n  )\n\n  const content = useMemo(() => {\n    if (collapsed) {\n      return null\n    }\n    return (\n      <AlignedBottomGrid columns={columns} gapX={4} gapY={5}>\n        {getChildren(children)}\n      </AlignedBottomGrid>\n    )\n  }, [children, collapsed, columns])\n\n  return (\n    <Root\n      data-level={level}\n      {...restProps}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      space={2}\n    >\n      <FormFieldBaseHeader\n        __internal_comments={comments}\n        __internal_slot={slot}\n        actions={actions}\n        fieldFocused={Boolean(focused)}\n        fieldHovered={hovered}\n        presence={presence}\n        content={\n          <Stack space={3}>\n            <Flex align=\"center\">\n              <FormFieldSetLegend\n                collapsed={Boolean(collapsed)}\n                collapsible={collapsible}\n                onClick={collapsible ? handleToggle : undefined}\n                title={title}\n              />\n              {deprecated && (\n                <Box marginLeft={2}>\n                  <Badge data-testid={`deprecated-badge-${title}`} tone=\"caution\">\n                    {t('form.field.deprecated-label')}\n                  </Badge>\n                </Box>\n              )}\n              {hasValidationMarkers && (\n                <Box marginLeft={2}>\n                  <FormFieldValidationStatus fontSize={1} placement=\"top\" validation={validation} />\n                </Box>\n              )}\n            </Flex>\n\n            {deprecated && (\n              <TextWithTone data-testid={`deprecated-message-${title}`} tone=\"caution\" size={1}>\n                {deprecated.reason}\n              </TextWithTone>\n            )}\n\n            {description && (\n              <Text muted size={1} id={createDescriptionId(inputId, description)}>\n                {description}\n              </Text>\n            )}\n          </Stack>\n        }\n      />\n\n      <Content\n        $borderLeft={level > 0}\n        hidden={collapsed}\n        paddingLeft={level === 0 ? 0 : 3}\n        onFocus={typeof tabIndex === 'number' && tabIndex > -1 ? handleFocus : undefined}\n        ref={forwardedRef}\n        tabIndex={tabIndex}\n      >\n        {!collapsed && content}\n      </Content>\n    </Root>\n  )\n})\n","import {type ReactNode} from 'react'\nimport styled from 'styled-components'\n\n/** @internal */\nexport interface FieldStatusProps {\n  children?: ReactNode\n  maxAvatars?: number\n  position?: 'top' | 'bottom'\n}\n\nconst Root = styled.div`\n  display: flex;\n  justify-content: flex-end;\n  box-sizing: border-box;\n  min-height: var(--avatar-height);\n  width: 77px;\n  margin-left: var(--small-padding);\n\n  &[data-max-avatars='1'] {\n    max-width: 23px;\n  }\n\n  &[data-position='top'] {\n    align-self: flex-start;\n  }\n\n  &[data-position='bottom'] {\n    align-self: flex-end;\n  }\n`\n\n/** @internal */\nexport function FormFieldStatus({children, maxAvatars, position = 'bottom'}: FieldStatusProps) {\n  return (\n    <Root data-max-avatars={maxAvatars} data-position={position}>\n      {children}\n    </Root>\n  )\n}\n","import {useEffect, useRef} from 'react'\n\n/**\n * A hook that returns the previous value of a component variable\n * This might be provided by React in the future (https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state)\n */\nexport function usePrevious<T>(\n  /** The value to track. Will return undefined for first render*/\n  value: T,\n): T | undefined\nexport function usePrevious<T>(\n  /** The value to track. Will return undefined for first render */\n  value: T,\n  initial: T,\n): T\nexport function usePrevious<T>(value: T, initial?: T): T | null {\n  const ref = useRef<T | null>(initial || null)\n  useEffect(() => {\n    ref.current = value\n  }, [value])\n  return ref.current\n}\n","import {useEffect} from 'react'\nimport shallowEquals from 'shallow-equals'\n\nimport {usePrevious} from './usePrevious'\n\n/**\n * A hook for doing side effects as a response to a change in a hook value between renders\n *\n * @example\n * ```ts\n * useDidUpdate(hasFocus, (hadFocus, hasFocus) => {\n *  if (hasFocus) {\n *    scrollIntoView(elementRef.current)\n *   }\n * })\n * ```\n *\n * @beta\n * @hidden\n */\nexport function useDidUpdate<T>(\n  /** The value you want to respond to changes in. */\n  current: T,\n  /** Callback to run when the value changes. */\n  didUpdate: (previous: T | undefined, current: T) => void,\n  compare?: (previous: T | undefined, current: T) => boolean,\n): void\nexport function useDidUpdate<T>(\n  current: T,\n  didUpdate: (previous: T | undefined, current: T | undefined) => void,\n  compare: (previous: T | undefined, current: T) => boolean = shallowEquals,\n): void {\n  const previous = usePrevious<T | undefined>(current)\n  useEffect(() => {\n    if (!compare(previous, current)) {\n      didUpdate(previous, current)\n    }\n  }, [didUpdate, current, previous, compare])\n}\n","import {type Path, type PathSegment} from '@sanity/types'\n\nimport {\n  type FormDecPatch,\n  type FormDiffMatchPatch,\n  type FormIncPatch,\n  type FormInsertPatch,\n  type FormInsertPatchPosition,\n  type FormSetIfMissingPatch,\n  type FormSetPatch,\n  type FormUnsetPatch,\n} from './types'\n\n/** @internal */\nexport const SANITY_PATCH_TYPE = Symbol.for('sanity.patch')\n\n/**\n * @hidden\n * @beta */\nexport function setIfMissing(value: any, path: Path = []): FormSetIfMissingPatch {\n  return {\n    patchType: SANITY_PATCH_TYPE,\n    type: 'setIfMissing',\n    path,\n    value,\n  }\n}\n\n/**\n * @hidden\n * @beta */\nexport function insert(\n  items: any[],\n  position: FormInsertPatchPosition,\n  path: Path = [],\n): FormInsertPatch {\n  return {\n    patchType: SANITY_PATCH_TYPE,\n    type: 'insert',\n    path,\n    position,\n    items,\n  }\n}\n\n/**\n * @hidden\n * @beta */\nexport function set(value: any, path: Path = []): FormSetPatch {\n  return {patchType: SANITY_PATCH_TYPE, type: 'set', path, value}\n}\n\n/**\n * @hidden\n * @beta */\nexport function unset(path: Path = []): FormUnsetPatch {\n  return {patchType: SANITY_PATCH_TYPE, type: 'unset', path}\n}\n\n/**\n * @hidden\n * @beta */\nexport function diffMatchPatch(value: string, path: Path = []): FormDiffMatchPatch {\n  return {patchType: SANITY_PATCH_TYPE, type: 'diffMatchPatch', path, value}\n}\n\n/**\n * @hidden\n * @beta */\nexport function inc(amount = 1, path: Path = []): FormIncPatch {\n  return {patchType: SANITY_PATCH_TYPE, type: 'inc', path, value: amount}\n}\n\n/**\n * @hidden\n * @beta */\nexport function dec(amount = 1, path: Path = []): FormDecPatch {\n  return {patchType: SANITY_PATCH_TYPE, type: 'dec', path, value: amount}\n}\n\n/** @internal */\nexport function prefixPath<T extends {path: Path}>(patch: T, segment: PathSegment): T {\n  return {\n    ...patch,\n    path: [segment, ...patch.path],\n  }\n}\n","import {type PathSegment} from '@sanity/types'\nimport {flatten} from 'lodash'\n\nimport {prefixPath} from './patch'\nimport {type FormPatch, type PatchArg} from './types'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport class PatchEvent {\n  static from(input: PatchArg | PatchEvent): PatchEvent {\n    if (input instanceof PatchEvent) {\n      return input\n    }\n    return new PatchEvent(Array.isArray(input) ? flatten(input) : [input])\n  }\n\n  patches: Array<FormPatch>\n\n  constructor(patches: Array<FormPatch>) {\n    this.patches = patches\n  }\n\n  prepend(...patches: PatchArg[]): PatchEvent {\n    return PatchEvent.from([...flatten(patches), ...this.patches])\n  }\n\n  append(...patches: PatchArg[]): PatchEvent {\n    return PatchEvent.from([...this.patches, ...flatten(patches)])\n  }\n\n  prefixAll(segment: PathSegment): PatchEvent {\n    return PatchEvent.from(this.patches.map((patch) => prefixPath(patch, segment)))\n  }\n}\n","const IGNORE_KEYS = ['_key', '_type', '_weak']\n\nexport function isEmptyItem(value: Record<string, unknown>): value is Record<never, never> {\n  return Object.keys(value).every((key) => IGNORE_KEYS.includes(key))\n}\n","/* eslint-disable react/no-unused-prop-types */\nimport {type Path} from '@sanity/types'\nimport {createContext, memo, type ReactNode, useCallback, useContext, useMemo, useRef} from 'react'\n\nimport {type FormPatch, type PatchEvent} from '../../patch'\n\n/** @internal */\nexport interface FormCallbacksValue {\n  transformPatches?: (patches: FormPatch[]) => FormPatch[]\n  onChange: (patchEvent: PatchEvent) => void\n  onPathFocus: (path: Path) => void\n  onPathBlur: (path: Path) => void\n  onPathOpen: (path: Path) => void\n  onSetPathCollapsed: (path: Path, collapsed: boolean) => void\n  onSetFieldSetCollapsed: (path: Path, collapsed: boolean) => void\n  onFieldGroupSelect: (path: Path, fieldGroupName: string) => void\n}\n\n/**\n * @internal\n */\nexport const FormCallbacksContext = createContext<FormCallbacksValue | null>(null)\n\n/** @internal */\nexport const FormCallbacksProvider = memo(function FormCallbacksProvider(\n  props: FormCallbacksValue & {children: ReactNode},\n) {\n  const ref = useRef<FormCallbacksValue>(props)\n  ref.current = props\n\n  const transformPatches = useCallback(\n    (patches: FormPatch[]) => {\n      return ref.current?.transformPatches?.(patches) ?? []\n    },\n    [ref],\n  )\n\n  const onChange = useCallback((patchEvent: PatchEvent) => {\n    ref.current.onChange(patchEvent)\n  }, [])\n\n  const onPathFocus = useCallback((path: Path) => {\n    ref.current.onPathFocus(path)\n  }, [])\n  const onPathBlur = useCallback((path: Path) => {\n    ref.current.onPathBlur(path)\n  }, [])\n  const onPathOpen = useCallback((path: Path) => {\n    ref.current.onPathOpen(path)\n  }, [])\n  const onSetPathCollapsed = useCallback((path: Path, collapsed: boolean) => {\n    ref.current.onSetPathCollapsed(path, collapsed)\n  }, [])\n  const onSetFieldSetCollapsed = useCallback((path: Path, collapsed: boolean) => {\n    ref.current.onSetFieldSetCollapsed(path, collapsed)\n  }, [])\n  const onFieldGroupSelect = useCallback((path: Path, fieldGroupName: string) => {\n    ref.current.onFieldGroupSelect(path, fieldGroupName)\n  }, [])\n\n  const contextValue: FormCallbacksValue = useMemo(\n    () => ({\n      transformPatches,\n      onChange,\n      onPathFocus,\n      onPathBlur,\n      onPathOpen,\n      onSetPathCollapsed,\n      onSetFieldSetCollapsed,\n      onFieldGroupSelect,\n    }),\n    [\n      onChange,\n      onFieldGroupSelect,\n      onPathBlur,\n      onPathFocus,\n      onPathOpen,\n      onSetFieldSetCollapsed,\n      onSetPathCollapsed,\n      transformPatches,\n    ],\n  )\n\n  return (\n    <FormCallbacksContext.Provider value={contextValue}>\n      {props.children}\n    </FormCallbacksContext.Provider>\n  )\n})\n\n/** @internal */\nexport function useFormCallbacks(): FormCallbacksValue {\n  const ctx = useContext(FormCallbacksContext)\n  if (!ctx) {\n    throw new Error('Form context not provided')\n  }\n  return ctx\n}\n","import {isArraySchemaType, isObjectSchemaType, type SchemaType} from '@sanity/types'\n\nexport function createProtoValue(type: SchemaType): any {\n  if (isObjectSchemaType(type)) {\n    return type.name === 'object' ? {} : {_type: type.name}\n  }\n  if (isArraySchemaType(type)) {\n    return []\n  }\n  if (type.jsonType === 'string') {\n    return ''\n  }\n  if (type.jsonType === 'number') {\n    return 0\n  }\n  if (type.jsonType === 'boolean') {\n    return false\n  }\n  return undefined\n}\n","import getRandomValues from 'get-random-values-esm'\n\n// WHATWG crypto RNG - https://w3c.github.io/webcrypto/Overview.html\nfunction whatwgRNG(length = 16) {\n  const rnds8 = new Uint8Array(length)\n  getRandomValues(rnds8)\n  return rnds8\n}\n\nconst getByteHexTable = (() => {\n  let table: string[]\n  return () => {\n    if (table) {\n      return table\n    }\n    table = []\n    for (let i = 0; i < 256; ++i) {\n      table[i] = (i + 0x100).toString(16).substring(1)\n    }\n    return table\n  }\n})()\n\nexport function randomKey(length?: number) {\n  const table = getByteHexTable()\n  return whatwgRNG(length)\n    .reduce((str, n) => str + table[n], '')\n    .slice(0, length)\n}\n","import {randomKey} from './randomKey'\n\nfunction hasKey<T extends {_key?: string}>(item: T): item is T & {_key: string} {\n  return item._key !== undefined\n}\n\nexport function ensureKey<T extends {_key?: string}>(item: T): T & {_key: string} {\n  return hasKey(item) ? item : {...item, _key: randomKey(12)}\n}\n","import {type ArraySchemaType, type Path, type SchemaType} from '@sanity/types'\nimport {resolveTypeName} from '@sanity/util/content'\nimport {concat, defer, EMPTY, from, type Observable, of} from 'rxjs'\nimport {catchError, filter, map, mergeMap} from 'rxjs/operators'\n\nimport {isNonNullable} from '../../../util'\nimport {type FormPatch, set, unset} from '../../patch'\nimport {isEmptyItem} from '../../store/utils/isEmptyItem'\nimport {type ObjectItem} from '../../types'\n\nconst getMemberTypeOfItem = (schemaType: ArraySchemaType, item: any): SchemaType | undefined => {\n  const itemTypeName = resolveTypeName(item)\n  return schemaType.of.find((memberType) => memberType.name === itemTypeName)\n}\n\n/**\n * Create patches that shallow merges keys from the given value\n * Used by initial value resolver to retain any properties already added on the item when initial value is done resolving\n * */\nfunction assign(values: Record<string, unknown>, path: Path) {\n  return Object.entries(values).map(([key, value]) => set(value, [...path, key]))\n}\n\nexport function resolveInitialArrayValues<T extends ObjectItem>(\n  items: T[],\n  schemaType: ArraySchemaType,\n  resolver: (type: SchemaType, params: Record<string, unknown>) => Promise<T>,\n): Observable<\n  | {type: 'patch'; patches: FormPatch[]}\n  | {type: 'error'; error: Error; item: T; schemaType: SchemaType}\n> {\n  return from(items).pipe(\n    mergeMap((item) => {\n      const itemPathSegment = {_key: item._key}\n      return of(getMemberTypeOfItem(schemaType, item)).pipe(\n        mergeMap((memberType) => (memberType ? of(memberType) : EMPTY)),\n        mergeMap((memberType) => {\n          if (!isEmptyItem(item) || !resolver) {\n            return EMPTY\n          }\n          return concat(\n            of({\n              type: 'patch' as const,\n              patches: [set(true, [itemPathSegment, '_resolvingInitialValue'])],\n            }),\n            defer(() => resolver(memberType, item)).pipe(\n              filter(isNonNullable),\n              map((initial) => ({\n                type: 'patch' as const,\n                patches: assign(initial, [itemPathSegment]),\n              })),\n              catchError((error) =>\n                of({type: 'error' as const, error, item, schemaType: memberType}),\n              ),\n            ),\n            of({\n              type: 'patch' as const,\n              patches: [unset([itemPathSegment, '_resolvingInitialValue'])],\n            }),\n          )\n        }),\n      )\n    }),\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {useToast} from '@sanity/ui'\nimport {useCallback, useMemo, useRef} from 'react'\nimport {tap} from 'rxjs/operators'\n\nimport {useTranslation} from '../../../../i18n'\nimport {useResolveInitialValueForType} from '../../../../store'\nimport {useDidUpdate} from '../../../hooks/useDidUpdate'\nimport {insert, type PatchArg, PatchEvent, setIfMissing, unset} from '../../../patch'\nimport {type ArrayOfObjectsItemMember} from '../../../store'\nimport {isEmptyItem} from '../../../store/utils/isEmptyItem'\nimport {FormCallbacksProvider, useFormCallbacks} from '../../../studio/contexts/FormCallbacks'\nimport {\n  type ArrayInputInsertEvent,\n  type ObjectInputProps,\n  type ObjectItem,\n  type ObjectItemProps,\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../../types'\nimport {createProtoValue} from '../../../utils/createProtoValue'\nimport {ensureKey} from '../../../utils/ensureKey'\nimport {createDescriptionId} from '../../common/createDescriptionId'\nimport {resolveInitialArrayValues} from '../../common/resolveInitialArrayValues'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport interface MemberItemProps {\n  member: ArrayOfObjectsItemMember\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderField: RenderFieldCallback\n  renderInput: RenderInputCallback\n  renderPreview: RenderPreviewCallback\n}\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function ArrayOfObjectsItem(props: MemberItemProps) {\n  const focusRef = useRef<{focus: () => void}>()\n  const {\n    member,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n  } = props\n  const {t} = useTranslation()\n\n  const {\n    onPathBlur,\n    onPathFocus,\n    onChange,\n    onPathOpen,\n    onSetPathCollapsed,\n    onSetFieldSetCollapsed,\n    onFieldGroupSelect,\n  } = useFormCallbacks()\n  const resolveInitialValue = useResolveInitialValueForType()\n\n  useDidUpdate(member.item.focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus) {\n      focusRef.current?.focus()\n    }\n  })\n\n  const onRemove = useCallback(() => {\n    onChange(PatchEvent.from([unset([{_key: member.key}])]))\n  }, [member.key, onChange])\n\n  const handleOpenItem = useCallback(\n    (path: Path) => {\n      onPathOpen(path)\n      onSetPathCollapsed(path, false)\n    },\n    [onPathOpen, onSetPathCollapsed],\n  )\n  const toast = useToast()\n\n  // Note: this handles inserting *siblings*\n  const handleInsert = useCallback(\n    (event: Omit<ArrayInputInsertEvent<ObjectItem>, 'referenceItem'>) => {\n      if (event.items.length === 0) {\n        throw new Error('Insert event should include at least one item')\n      }\n      const itemsWithKeys = event.items.map((item) => ensureKey(item))\n\n      onChange(PatchEvent.from([insert(itemsWithKeys, event.position, [{_key: member.key}])]))\n\n      const focusItemKey = itemsWithKeys[0]._key\n      const parentPath = member.item.path.slice(0, -1)\n      const itemPath = [...parentPath, {_key: focusItemKey}]\n\n      // Set focus at the first item (todo: verify that this is the expected/better behavior when adding multiple items)\n      onPathFocus(itemPath)\n\n      const shouldOpen = event.open !== false\n      if (event.skipInitialValue) {\n        if (shouldOpen) {\n          handleOpenItem(itemPath)\n        }\n      } else {\n        resolveInitialArrayValues(itemsWithKeys, member.parentSchemaType, resolveInitialValue)\n          .pipe(\n            tap((result) => {\n              if (result.type === 'patch') {\n                onChange(PatchEvent.from(result.patches))\n              } else {\n                toast.push({\n                  title: t('inputs.array.error.cannot-resolve-initial-value-title'),\n                  description: t('inputs.array.error.cannot-resolve-initial-value-description', {\n                    schemaTypeTitle: result.schemaType.title,\n                    errorMessage: result.error.message,\n                  }),\n                  status: 'error',\n                })\n              }\n            }),\n          )\n          .subscribe({\n            complete: () => {\n              if (shouldOpen) {\n                handleOpenItem(itemPath)\n              }\n            },\n          })\n      }\n    },\n    [\n      handleOpenItem,\n      member.item.path,\n      member.key,\n      member.parentSchemaType,\n      onChange,\n      onPathFocus,\n      resolveInitialValue,\n      toast,\n      t,\n    ],\n  )\n\n  const handleBlur = useCallback(() => {\n    onPathBlur(member.item.path)\n  }, [member.item.path, onPathBlur])\n\n  const handleFocus = useCallback(() => {\n    onPathFocus(member.item.path)\n  }, [member.item.path, onPathFocus])\n\n  const handleFocusChildPath = useCallback(\n    (path: Path) => {\n      onPathFocus(member.item.path.concat(path))\n    },\n    [member.item.path, onPathFocus],\n  )\n\n  const handleChange = useCallback(\n    (event: PatchEvent | PatchArg) => {\n      onChange(\n        PatchEvent.from(event)\n          .prepend(setIfMissing(createProtoValue(member.item.schemaType)))\n          .prefixAll({_key: member.key}),\n      )\n    },\n    [onChange, member.item.schemaType, member.key],\n  )\n  const handleCollapse = useCallback(() => {\n    onSetPathCollapsed(member.item.path, true)\n  }, [onSetPathCollapsed, member.item.path])\n\n  const handleExpand = useCallback(() => {\n    onSetPathCollapsed(member.item.path, false)\n  }, [onSetPathCollapsed, member.item.path])\n\n  const handleCollapseField = useCallback(\n    (fieldName: string) => {\n      onSetPathCollapsed(member.item.path.concat(fieldName), true)\n    },\n    [onSetPathCollapsed, member.item.path],\n  )\n  const handleExpandField = useCallback(\n    (fieldName: string) => {\n      onSetPathCollapsed(member.item.path.concat(fieldName), false)\n    },\n    [onSetPathCollapsed, member.item.path],\n  )\n  const handleCloseField = useCallback(() => {\n    onPathOpen(member.item.path)\n  }, [onPathOpen, member.item.path])\n  const handleOpenField = useCallback(\n    (fieldName: string) => {\n      onPathOpen(member.item.path.concat(fieldName))\n    },\n    [onPathOpen, member.item.path],\n  )\n  const handleExpandFieldSet = useCallback(\n    (fieldsetName: string) => {\n      onSetFieldSetCollapsed(member.item.path.concat(fieldsetName), false)\n    },\n    [onSetFieldSetCollapsed, member.item.path],\n  )\n  const handleCollapseFieldSet = useCallback(\n    (fieldsetName: string) => {\n      onSetFieldSetCollapsed(member.item.path.concat(fieldsetName), true)\n    },\n    [onSetFieldSetCollapsed, member.item.path],\n  )\n\n  const handleOpen = useCallback(() => {\n    onPathOpen(member.item.path)\n  }, [onPathOpen, member.item.path])\n\n  const isEmptyValue = !member.item.value || isEmptyItem(member.item.value)\n  const handleClose = useCallback(() => {\n    if (isEmptyValue) {\n      onRemove()\n    }\n\n    const parentPath = member.item.path.slice(0, -1)\n    onPathOpen(parentPath)\n    // @todo fix issue where the focus is on the item and not the parent\n    onPathFocus(parentPath)\n  }, [isEmptyValue, onPathOpen, member.item.path, onPathFocus, onRemove])\n\n  const handleSelectFieldGroup = useCallback(\n    (groupName: string) => {\n      onFieldGroupSelect(member.item.path, groupName)\n    },\n    [onFieldGroupSelect, member.item.path],\n  )\n\n  const elementProps = useMemo(\n    (): ObjectInputProps['elementProps'] => ({\n      onBlur: handleBlur,\n      onFocus: handleFocus,\n      id: member.item.id,\n      ref: focusRef,\n      'aria-describedby': createDescriptionId(member.item.id, member.item.schemaType.description),\n    }),\n    [handleBlur, handleFocus, member.item.id, member.item.schemaType.description],\n  )\n\n  const inputProps = useMemo((): Omit<ObjectInputProps, 'renderDefault'> => {\n    return {\n      changed: member.item.changed,\n      focusPath: member.item.focusPath,\n      focused: member.item.focused,\n      groups: member.item.groups,\n      id: member.item.id,\n      level: member.item.level,\n      members: member.item.members,\n      onChange: handleChange,\n      onFieldClose: handleCloseField,\n      onFieldCollapse: handleCollapseField,\n      onFieldSetCollapse: handleCollapseFieldSet,\n      onFieldExpand: handleExpandField,\n      onFieldSetExpand: handleExpandFieldSet,\n      onFieldGroupSelect: handleSelectFieldGroup,\n      onPathFocus: handleFocusChildPath,\n      onFieldOpen: handleOpenField,\n      path: member.item.path,\n      presence: member.item.presence,\n      readOnly: member.item.readOnly,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n      schemaType: member.item.schemaType,\n      validation: member.item.validation,\n      value: member.item.value,\n      elementProps: elementProps,\n    }\n  }, [\n    elementProps,\n    handleChange,\n    handleCloseField,\n    handleCollapseField,\n    handleCollapseFieldSet,\n    handleExpandField,\n    handleExpandFieldSet,\n    handleFocusChildPath,\n    handleOpenField,\n    handleSelectFieldGroup,\n    member.item.changed,\n    member.item.focusPath,\n    member.item.focused,\n    member.item.groups,\n    member.item.id,\n    member.item.level,\n    member.item.members,\n    member.item.path,\n    member.item.presence,\n    member.item.readOnly,\n    member.item.schemaType,\n    member.item.validation,\n    member.item.value,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n  ])\n\n  const renderedInput = useMemo(() => renderInput(inputProps), [inputProps, renderInput])\n\n  const itemProps = useMemo((): Omit<ObjectItemProps, 'renderDefault'> => {\n    return {\n      key: member.key,\n      index: member.index,\n      level: member.item.level,\n      value: member.item.value,\n      title: member.item.schemaType.title,\n      description: member.item.schemaType.description,\n      collapsible: member.collapsible,\n      collapsed: member.collapsed,\n      schemaType: member.item.schemaType,\n      parentSchemaType: member.parentSchemaType,\n      onInsert: handleInsert,\n      onRemove,\n      presence: member.item.presence,\n      validation: member.item.validation,\n      open: member.open,\n      onOpen: handleOpen,\n      onClose: handleClose,\n      onExpand: handleExpand,\n      onCollapse: handleCollapse,\n      readOnly: member.item.readOnly,\n      focused: member.item.focused,\n      onFocus: handleFocus,\n      onBlur: handleBlur,\n      inputId: member.item.id,\n      path: member.item.path,\n      children: renderedInput,\n      changed: member.item.changed,\n      inputProps,\n    }\n  }, [\n    member.key,\n    member.index,\n    member.item.level,\n    member.item.value,\n    member.item.schemaType,\n    member.parentSchemaType,\n    member.item.presence,\n    member.item.validation,\n    member.item.readOnly,\n    member.item.focused,\n    member.item.id,\n    member.item.path,\n    member.item.changed,\n    member.collapsible,\n    member.collapsed,\n    member.open,\n    handleInsert,\n    onRemove,\n    handleOpen,\n    handleClose,\n    handleExpand,\n    handleCollapse,\n    handleFocus,\n    handleBlur,\n    renderedInput,\n    inputProps,\n  ])\n\n  return (\n    <FormCallbacksProvider\n      onFieldGroupSelect={onFieldGroupSelect}\n      onChange={handleChange}\n      onPathOpen={onPathOpen}\n      onSetFieldSetCollapsed={onSetFieldSetCollapsed}\n      onSetPathCollapsed={onSetPathCollapsed}\n      onPathBlur={onPathBlur}\n      onPathFocus={onPathFocus}\n    >\n      {useMemo(() => renderItem(itemProps), [itemProps, renderItem])}\n    </FormCallbacksProvider>\n  )\n}\n","import {BulbOutlineIcon, UnknownIcon} from '@sanity/icons'\nimport {Box, Card, Code, Flex, Stack, Text, type Theme, useClickOutside} from '@sanity/ui'\nimport {resolveTypeName} from '@sanity/util/content'\nimport {type FocusEvent, useCallback, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../ui-components'\nimport {Translate, useTranslation} from '../../../i18n'\n\nconst PopoverCard = styled(Card)`\n  max-width: ${({theme}: {theme: Theme}) => theme.sanity.container[1]}px;\n`\n\ninterface Props {\n  value: unknown\n  onFocus?: (event: FocusEvent) => void\n  vertical?: boolean\n}\n\nexport function IncompatibleItemType(props: Props) {\n  const {value, onFocus, vertical, ...rest} = props\n  const [showDetails, setShowDetails] = useState(false)\n  const [popoverRef, setPopoverRef] = useState<HTMLElement | null>(null)\n\n  const {t} = useTranslation()\n\n  useClickOutside(() => setShowDetails(false), [popoverRef])\n\n  const handleKeyDown = useCallback((e: any) => {\n    if (e.key === 'Escape' || e.key === 'Tab') {\n      setShowDetails(false)\n    }\n  }, [])\n\n  const handleShowDetails = useCallback(() => {\n    setShowDetails((v) => !v)\n  }, [])\n\n  const typeName = resolveTypeName(value)\n  return (\n    <Popover\n      open={showDetails}\n      ref={setPopoverRef}\n      onKeyDown={handleKeyDown}\n      portal\n      constrainSize\n      tone=\"default\"\n      content={\n        <PopoverCard margin={1} padding={3} onKeyDown={handleKeyDown} tabIndex={0} overflow=\"auto\">\n          <Stack space={4}>\n            <Text weight=\"medium\">\n              <Translate\n                t={t}\n                i18nKey=\"inputs.array.error.type-is-incompatible-prompt\"\n                values={{typeName}}\n              />\n            </Text>\n            <Text size={1} weight=\"medium\">\n              {t('inputs.array.error.type-is-incompatible-title')}\n            </Text>\n            <Text size={1}>\n              <Translate\n                t={t}\n                i18nKey=\"inputs.array.error.current-schema-not-declare-description\"\n                values={{typeName}}\n              />\n            </Text>\n            <Box>\n              <Text size={1}>\n                <BulbOutlineIcon /> {t('inputs.array.error.can-delete-but-no-edit-description')}\n              </Text>\n            </Box>\n            <Stack space={2}>\n              <Text size={1} weight=\"medium\">\n                {t('inputs.array.error.json-representation-description')}\n              </Text>\n              <Card padding={2} overflow=\"auto\" border>\n                <Code size={1} as=\"pre\" language=\"json\">\n                  {JSON.stringify(value, null, 2)}\n                </Code>\n              </Card>\n            </Stack>\n          </Stack>\n        </PopoverCard>\n      }\n    >\n      <Card\n        as=\"button\"\n        type=\"button\"\n        radius={2}\n        tone=\"inherit\"\n        paddingX={2}\n        paddingY={3}\n        flex={1}\n        onFocus={onFocus}\n        onClick={handleShowDetails}\n        onKeyDown={handleKeyDown}\n        __unstable_focusRing\n        {...rest}\n      >\n        <Flex align=\"center\">\n          <Box marginRight={3}>\n            <Text>\n              <UnknownIcon />\n            </Text>\n          </Box>\n\n          <Box flex={1}>\n            <Text size={1} textOverflow=\"ellipsis\">\n              <Translate\n                t={t}\n                i18nKey=\"inputs.array.error.type-is-incompatible-prompt\"\n                values={{typeName: typeName}}\n              />\n            </Text>\n          </Box>\n        </Flex>\n      </Card>\n    </Popover>\n  )\n}\n","import {useTranslation} from '../../../i18n'\nimport {type ArrayItemError} from '../../store/types/memberErrors'\nimport {IncompatibleItemType} from './IncompatibleItemType'\n\n/** @internal */\nexport function MemberItemError(props: {member: ArrayItemError}) {\n  const {member} = props\n  const {t} = useTranslation()\n\n  if (member.error.type === 'INVALID_ITEM_TYPE') {\n    return <IncompatibleItemType value={member.error.value} />\n  }\n  return <div>{t('inputs.array.error.unexpected-error', {error: member.error.type})}</div>\n}\n","import {type SchemaType} from '@sanity/types'\n\nexport function getEmptyValue(type: SchemaType): number | string | boolean {\n  switch (type.jsonType) {\n    case 'string': {\n      return ''\n    }\n    case 'number': {\n      return -0\n    }\n    case 'boolean': {\n      return false\n    }\n    default:\n      throw new Error(`Unable to create value from type \"${type.jsonType}\"`)\n  }\n}\n","import {isNumberSchemaType, type SchemaType} from '@sanity/types'\n\nexport function resolveNativeNumberInputValue(\n  schemaType: SchemaType,\n  value: unknown,\n  localValue: string | undefined,\n): string {\n  if (\n    isNumberSchemaType(schemaType) &&\n    typeof localValue === 'string' &&\n    Number(localValue) === value\n  ) {\n    return localValue\n  }\n  return String(value ?? '')\n}\n","import {isBooleanSchemaType, isNumberSchemaType, type SchemaType} from '@sanity/types'\nimport {type ChangeEvent, type FocusEvent, useCallback, useMemo, useRef, useState} from 'react'\n\nimport {type FIXME} from '../../../../FIXME'\nimport {useDidUpdate} from '../../../hooks/useDidUpdate'\nimport {getEmptyValue} from '../../../inputs/arrays/ArrayOfPrimitivesInput/getEmptyValue'\nimport {insert, type PatchArg, PatchEvent, set, unset} from '../../../patch'\nimport {type ArrayOfPrimitivesItemMember} from '../../../store'\nimport {useFormCallbacks} from '../../../studio/contexts/FormCallbacks'\nimport {\n  type PrimitiveInputProps,\n  type PrimitiveItemProps,\n  type RenderArrayOfPrimitivesItemCallback,\n  type RenderInputCallback,\n} from '../../../types'\nimport {createDescriptionId} from '../../common/createDescriptionId'\nimport {resolveNativeNumberInputValue} from '../../common/resolveNativeNumberInputValue'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport interface PrimitiveMemberItemProps {\n  member: ArrayOfPrimitivesItemMember\n  renderItem: RenderArrayOfPrimitivesItemCallback\n  renderInput: RenderInputCallback\n}\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function ArrayOfPrimitivesItem(props: PrimitiveMemberItemProps) {\n  const focusRef = useRef<{focus: () => void}>()\n  const {member, renderItem, renderInput} = props\n\n  const [localValue, setLocalValue] = useState<undefined | string>()\n\n  const {onPathBlur, onPathFocus, onChange} = useFormCallbacks()\n\n  useDidUpdate(member.item.focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus) {\n      focusRef.current?.focus()\n    }\n  })\n\n  const handleBlur = useCallback(\n    (event: FocusEvent) => {\n      onPathBlur(member.item.path)\n    },\n    [member.item.path, onPathBlur],\n  )\n\n  const handleFocus = useCallback(\n    (event: FocusEvent) => {\n      onPathFocus(member.item.path)\n    },\n    [member.item.path, onPathFocus],\n  )\n\n  const handleChange = useCallback(\n    (event: PatchEvent | PatchArg) => {\n      onChange(PatchEvent.from(event).prefixAll(member.index))\n    },\n    [onChange, member.index],\n  )\n  const handleNativeChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      let inputValue: number | string | boolean = event.currentTarget.value\n      if (isNumberSchemaType(member.item.schemaType)) {\n        inputValue = event.currentTarget.valueAsNumber\n        if (inputValue > Number.MAX_SAFE_INTEGER || inputValue < Number.MIN_SAFE_INTEGER) {\n          return\n        }\n      } else if (isBooleanSchemaType(member.item.schemaType)) {\n        inputValue = event.currentTarget.checked\n      }\n\n      // `valueAsNumber` returns `NaN` on empty input\n      const hasEmptyValue =\n        inputValue === '' || (typeof inputValue === 'number' && isNaN(inputValue))\n\n      if (isNumberSchemaType(member.item.schemaType)) {\n        // Store the local value for number inputs in order to support intermediate values\n        // that includes more information than the numeric value\n        // E.g. if typing `0.0` the numeric value will be 0, but we still want to show `0.0` in the input to allow typing\n        // more digits\n        setLocalValue(hasEmptyValue ? undefined : event.currentTarget.value)\n      }\n\n      handleChange(\n        set(\n          hasEmptyValue\n            ? // Map direct unset patches to empty value instead in order to not *remove* elements as the user clears out the value\n              // note: this creates the rather curious case where the input renders 0 when you try to clear it.\n              getEmptyValue(member.item.schemaType)\n            : inputValue,\n        ),\n      )\n    },\n    [handleChange, member.item.schemaType],\n  )\n\n  const elementProps = useMemo(\n    (): PrimitiveInputProps['elementProps'] => ({\n      onBlur: handleBlur,\n      onFocus: handleFocus,\n      id: member.item.id,\n      ref: focusRef,\n      onChange: handleNativeChange,\n      value: resolveNativeInputValue(member.item.schemaType, member.item.value, localValue),\n      readOnly: Boolean(member.item.readOnly),\n      placeholder: member.item.schemaType.placeholder,\n      'aria-describedby': createDescriptionId(member.item.id, member.item.schemaType.description),\n    }),\n    [\n      handleBlur,\n      handleFocus,\n      handleNativeChange,\n      member.item.id,\n      member.item.readOnly,\n      member.item.schemaType,\n      member.item.value,\n      localValue,\n    ],\n  )\n  const inputProps = useMemo((): Omit<PrimitiveInputProps, 'renderDefault'> => {\n    return {\n      changed: member.item.changed,\n      level: member.item.level,\n      value: member.item.value as FIXME,\n      readOnly: member.item.readOnly,\n      schemaType: member.item.schemaType as FIXME,\n      id: member.item.id,\n      path: member.item.path,\n      focused: member.item.focused,\n      onChange: handleChange,\n      validation: member.item.validation,\n      presence: member.item.presence,\n      elementProps,\n    }\n  }, [\n    member.item.changed,\n    member.item.level,\n    member.item.value,\n    member.item.readOnly,\n    member.item.schemaType,\n    member.item.id,\n    member.item.path,\n    member.item.focused,\n    member.item.validation,\n    member.item.presence,\n    handleChange,\n    elementProps,\n  ])\n\n  const renderedInput = useMemo(() => renderInput(inputProps), [inputProps, renderInput])\n\n  const onRemove = useCallback(() => {\n    onChange(PatchEvent.from([unset([member.index])]))\n  }, [member.index, onChange])\n\n  const onInsert = useCallback(\n    (event: {items: unknown[]; position: 'before' | 'after'}) => {\n      onChange(PatchEvent.from([insert(event.items, event.position, [member.index])]))\n    },\n    [member.index, onChange],\n  )\n\n  const itemProps = useMemo((): Omit<PrimitiveItemProps, 'renderDefault'> => {\n    return {\n      key: member.key,\n      index: member.index,\n      level: member.item.level,\n      value: member.item.value as FIXME,\n      title: member.item.schemaType.title,\n      description: member.item.schemaType.description,\n      schemaType: member.item.schemaType as FIXME,\n      parentSchemaType: member.parentSchemaType,\n      onInsert,\n      onRemove,\n      presence: member.item.presence,\n      validation: member.item.validation,\n      readOnly: member.item.readOnly,\n      focused: member.item.focused,\n      onFocus: handleFocus,\n      onBlur: handleBlur,\n      inputId: member.item.id,\n      path: member.item.path,\n      children: renderedInput,\n    }\n  }, [\n    member.key,\n    member.index,\n    member.item.level,\n    member.item.value,\n    member.item.schemaType,\n    member.item.presence,\n    member.item.validation,\n    member.item.readOnly,\n    member.item.focused,\n    member.item.id,\n    member.item.path,\n    member.parentSchemaType,\n    onInsert,\n    onRemove,\n    handleFocus,\n    handleBlur,\n    renderedInput,\n  ])\n\n  return <>{useMemo(() => renderItem(itemProps as PrimitiveItemProps), [itemProps, renderItem])}</>\n}\n\nfunction resolveNativeInputValue(\n  schemaType: SchemaType,\n  value: unknown,\n  localValue: string | undefined,\n): string {\n  // this is a trick to retain type information while displaying an \"empty\" input\n  // if this input is used to edit items in an array of numbers, the value can't really be set to empty without\n  // either removing the item or losing type information (i.e. it can't be an empty string, because that's a string)\n  // so the array of numbers then use the special value `-0` to represent an empty value\n  if (Object.is(value, -0)) {\n    return ''\n  }\n  return resolveNativeNumberInputValue(schemaType, value, localValue)\n}\n","import {isObjectSchemaType, type SchemaType} from '@sanity/types'\nimport {randomKey} from '@sanity/util/content'\n\nimport {type ObjectItem} from '../../../types'\nimport {createProtoValue} from '../../../utils/createProtoValue'\n\nexport function createProtoArrayValue<Item extends ObjectItem>(type: SchemaType): Item {\n  if (!isObjectSchemaType(type)) {\n    throw new Error(\n      `Invalid item type: \"${type.type}\". Default array input can only contain objects (for now)`,\n    )\n  }\n\n  return {...createProtoValue(type), _key: randomKey(12)} as Item\n}\n","export const BEFORE = 'before'\nexport const AFTER = 'after'\n\nexport function arrayInsert(\n  array: unknown[],\n  position: 'after' | 'before',\n  index: number,\n  ...args: unknown[][]\n) {\n  if (position !== BEFORE && position !== AFTER) {\n    throw new Error(`Invalid position \"${position}\", must be either ${BEFORE} or ${AFTER}`)\n  }\n\n  const items = flatten(...args)\n\n  if (array.length === 0) {\n    return items\n  }\n\n  const len = array.length\n  const idx = Math.abs((len + index) % len) % len\n\n  const normalizedIdx = position === 'after' ? idx + 1 : idx\n\n  const copy = array.slice()\n  copy.splice(normalizedIdx, 0, ...flatten(items))\n  return copy\n}\n\nfunction flatten(...values: unknown[][]) {\n  return values.reduce((prev, item) => prev.concat(item), [])\n}\n","import {findIndex} from 'lodash'\n\nimport {type FIXME} from '../../FIXME'\nimport {applyPatch} from './applyPatch'\nimport {arrayInsert} from './arrayInsert'\n\nconst hasOwn = (obj: Record<string, unknown>, property: string) =>\n  Object.prototype.hasOwnProperty.call(obj, property)\n\nfunction move(arr: unknown[], from: number, to: number) {\n  const nextValue = arr.slice()\n  const val = nextValue[from]\n  nextValue.splice(from, 1)\n  nextValue.splice(to, 0, val)\n  return nextValue\n}\n\nfunction findTargetIndex(array: unknown[], pathSegment: FIXME) {\n  if (typeof pathSegment === 'number') {\n    return pathSegment\n  }\n  const index = findIndex(array, pathSegment)\n  return index === -1 ? false : index\n}\n\nexport function _arrayApply(value: FIXME, patch: FIXME) {\n  const nextValue = value.slice() // make a copy for internal mutation\n\n  if (patch.path.length === 0) {\n    // its directed to me\n    if (patch.type === 'setIfMissing') {\n      if (!Array.isArray(patch.value)) {\n        // eslint-disable-line max-depth\n        throw new Error('Cannot set value of an array to a non-array')\n      }\n      return value === undefined ? patch.value : value\n    } else if (patch.type === 'set') {\n      if (!Array.isArray(patch.value)) {\n        // eslint-disable-line max-depth\n        throw new Error('Cannot set value of an array to a non-array')\n      }\n      return patch.value\n    } else if (patch.type === 'unset') {\n      return undefined\n    } else if (patch.type === 'move') {\n      if (!patch.value || !hasOwn(patch.value, 'from') || !hasOwn(patch.value, 'to')) {\n        // eslint-disable-line max-depth\n        throw new Error(\n          `Invalid value of 'move' patch. Expected a value with \"from\" and \"to\" indexes, instead got: ${JSON.stringify(\n            patch.value,\n          )}`,\n        )\n      }\n      return move(nextValue, patch.value.from, patch.value.to)\n    }\n    throw new Error(`Invalid array operation: ${patch.type}`)\n  }\n\n  const [head, ...tail] = patch.path\n\n  const index = findTargetIndex(value, head)\n\n  // If the given selector could not be found, return as-is\n  if (index === false) {\n    return nextValue\n  }\n\n  if (tail.length === 0) {\n    if (patch.type === 'insert') {\n      const {position, items} = patch\n      return arrayInsert(value, position, index, items)\n    } else if (patch.type === 'unset') {\n      if (typeof index !== 'number') {\n        throw new Error(`Expected array index to be a number, instead got \"${index}\"`)\n      }\n      nextValue.splice(index, 1)\n      return nextValue\n    }\n  }\n\n  // The patch is not directed to me\n  nextValue[index] = applyPatch(nextValue[index], {\n    ...patch,\n    path: tail,\n  })\n  return nextValue\n}\n","import {clone, isObject, omit} from 'lodash'\n\nimport {type FIXME} from '../../FIXME'\nimport {applyPatch} from './applyPatch'\n\nexport function _objectApply(value: FIXME, patch: FIXME) {\n  const nextValue = clone(value)\n  if (patch.path.length === 0) {\n    // its directed to me\n    if (patch.type === 'set') {\n      if (!isObject(patch.value)) {\n        // eslint-disable-line max-depth\n        throw new Error('Cannot set value of an object to a non-object')\n      }\n      return patch.value\n    } else if (patch.type === 'unset') {\n      return undefined\n    } else if (patch.type === 'setIfMissing') {\n      // console.log('IS IT missing?', value)\n      return value === undefined ? patch.value : value\n    }\n    throw new Error(`Invalid object operation: ${patch.type}`)\n  }\n\n  // The patch is not directed to me\n  const [head, ...tail] = patch.path\n  if (typeof head !== 'string') {\n    throw new Error(`Expected field name to be a string, instad got: ${head}`)\n  }\n\n  if (tail.length === 0 && patch.type === 'unset') {\n    return omit(nextValue, head)\n  }\n\n  nextValue[head] = applyPatch(nextValue[head], {\n    ...patch,\n    path: tail,\n  })\n  return nextValue\n}\n","import {type FIXME} from '../../FIXME'\n\nconst OPERATIONS = {\n  replace(currentValue: FIXME, nextValue: FIXME) {\n    return nextValue\n  },\n  set(currentValue: FIXME, nextValue: FIXME) {\n    return nextValue\n  },\n  setIfMissing(currentValue: FIXME, nextValue: FIXME) {\n    return currentValue === undefined ? nextValue : currentValue\n  },\n  unset(currentValue: FIXME, nextValue: FIXME) {\n    return undefined\n  },\n  inc(currentValue: FIXME, nextValue: FIXME) {\n    return currentValue + nextValue\n  },\n  dec(currentValue: FIXME, nextValue: FIXME) {\n    return currentValue - nextValue\n  },\n}\n\nconst SUPPORTED_PATCH_TYPES = Object.keys(OPERATIONS)\n\nexport function _primitiveApply(value: FIXME, patch: FIXME) {\n  if (!SUPPORTED_PATCH_TYPES.includes(patch.type)) {\n    throw new Error(\n      `Received patch of unsupported type \"${patch.type}\" for primitives. This is most likely a bug.`,\n    )\n  }\n\n  if (patch.path.length > 0) {\n    throw new Error(\n      `Cannot apply deep operations on primitive values. Received patch with type \"${\n        patch.type\n      }\" and path \"${patch.path\n        .map((path: FIXME) => JSON.stringify(path))\n        .join('.')} that targeted the value \"${JSON.stringify(value)}\"`,\n    )\n  }\n\n  return (OPERATIONS as FIXME)[patch.type](value, patch.value)\n}\n","import {applyPatches, parsePatch} from '@sanity/diff-match-patch'\n\nimport {type FIXME} from '../../FIXME'\nimport {type FormPatch} from '../patch'\n\nconst OPERATIONS = {\n  replace(currentValue: unknown, nextValue: unknown) {\n    return nextValue\n  },\n  set(currentValue: unknown, nextValue: unknown) {\n    return nextValue\n  },\n  setIfMissing(currentValue: unknown, nextValue: unknown) {\n    return currentValue === undefined ? nextValue : currentValue\n  },\n  unset(currentValue: unknown, nextValue: unknown) {\n    return undefined\n  },\n  diffMatchPatch(currentValue: string, dmpPatch: string) {\n    const [result] = applyPatches(parsePatch(dmpPatch), currentValue, {allowExceedingIndices: true})\n    return result\n  },\n}\n\nconst SUPPORTED_PATCH_TYPES = Object.keys(OPERATIONS)\n\nexport function _stringApply(value: unknown, patch: FormPatch) {\n  if (!SUPPORTED_PATCH_TYPES.includes(patch.type)) {\n    throw new Error(\n      `Received patch of unsupported type: \"${JSON.stringify(\n        patch.type,\n      )}\" for string. This is most likely a bug.`,\n    )\n  }\n\n  if (patch.path.length > 0) {\n    throw new Error(\n      `Cannot apply deep operations on string values. Received patch with type \"${\n        patch.type\n      }\" and path \"${patch.path.join('.')} that targeted the value \"${JSON.stringify(value)}\"`,\n    )\n  }\n\n  return (OPERATIONS as FIXME)[patch.type](value, (patch as FIXME).value)\n}\n","import {isObject, isString} from 'lodash'\n\nimport {type FIXME} from '../../FIXME'\nimport {_arrayApply} from './array'\nimport {_objectApply} from './object'\nimport {_primitiveApply} from './primitive'\nimport {_stringApply} from './string'\nimport {type PatchArg} from './types'\n\nexport function applyAll(value: FIXME, patches: PatchArg[]) {\n  return patches.reduce(applyPatch, value)\n}\n\nfunction _applyPatch(value: FIXME, patch: FIXME) {\n  if (Array.isArray(value)) {\n    return _arrayApply(value, patch)\n  }\n  if (isString(value)) {\n    return _stringApply(value, patch)\n  }\n  if (isObject(value)) {\n    return _objectApply(value, patch)\n  }\n  return _primitiveApply(value, patch)\n}\n\nexport function applyPatch(value: FIXME, patch: FIXME) {\n  const res = _applyPatch(value, patch)\n  // console.log('applyPatch(%o, %o) : %o (noop? %o)', value, patch, res, value === res)\n  return res\n}\n","import {createContext, type ReactNode, useContext, useMemo} from 'react'\n\nimport {type DocumentFieldAction} from '../../../config'\nimport {EMPTY_ARRAY} from '../../../util'\n\nexport interface DocumentFieldActionsContextValue {\n  actions: DocumentFieldAction[]\n}\n\nconst DocumentFieldActionsContext = createContext<DocumentFieldActionsContextValue | null>(null)\n\nexport function DocumentFieldActionsProvider(props: {\n  actions: DocumentFieldAction[] | undefined\n  children: ReactNode\n}) {\n  const value = useMemo(() => ({actions: props.actions || EMPTY_ARRAY}), [props.actions])\n  return (\n    <DocumentFieldActionsContext.Provider value={value}>\n      {props.children}\n    </DocumentFieldActionsContext.Provider>\n  )\n}\n\nexport function useDocumentFieldActions() {\n  const context = useContext(DocumentFieldActionsContext)\n  if (!context) {\n    throw new Error('useDocumentFieldActions must be used within a DocumentFieldActionsProvider')\n  }\n  return context.actions\n}\n","import {type SchemaType} from '@sanity/types'\n\nconst PRIMITIVES = ['string', 'number', 'boolean']\n\nexport function is(typeName: string, type: SchemaType): boolean {\n  return type.name === typeName || Boolean(type.type && is(typeName, type.type))\n}\n\nexport {is as type}\n\nexport function primitive(type: SchemaType) {\n  return PRIMITIVES.some((typeName) => is(typeName, type))\n}\n","import {type FileLike} from './types'\n\n/**\n * Check if the provided file type should be accepted by the input with accept attribute.\n * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Input#attr-accept\n *\n * Inspired by https://github.com/enyo/dropzone (MIT) (c) 2021 Matias Meno\n * Based on https://github.com/react-dropzone/attr-accept (MIT) (c) 2015 Andrey Okonetchnikov\n *\n * @param file - https://developer.mozilla.org/en-US/docs/Web/API/File\n * @param acceptedFiles - List of accepted mime types (comma-separated string or array)\n * @returns True if file is accepted, false otherwise\n */\nexport function accepts(file: FileLike, acceptedFiles: string | string[]): boolean {\n  if (!file || !acceptedFiles) {\n    return true\n  }\n\n  const acceptedFilesArray = Array.isArray(acceptedFiles)\n    ? acceptedFiles // eg `['image/png', 'image/jpeg']`\n    : acceptedFiles.split(',') // eg `image/png,image/jpeg`\n\n  const fileName = file.name || ''\n  const mimeType = (file.type || '').toLowerCase()\n  const baseMimeType = mimeType.replace(/\\/.*$/, '')\n\n  return acceptedFilesArray.some((type) => {\n    const validType = type.trim().toLowerCase()\n\n    if (validType.charAt(0) === '.') {\n      if (fileName) {\n        return fileName.toLowerCase().endsWith(validType)\n      }\n      // If we do not have a valid fileName and validType is an extension, we\n      // should fail open. This happens because when hovering a file, the browser\n      // does not pass the name of the file but it will pass the file name when the\n      // file is dropped on the file upload input\n      return true\n    }\n\n    if (validType.endsWith('/*')) {\n      // This is something like a image/* mime type\n      return baseMimeType === validType.replace(/\\/.*$/, '')\n    }\n\n    return mimeType === validType\n  })\n}\n","// Takes a observable-returning function and returns a new function that limits on the number of\n// concurrent observables.\nimport {from as observableFrom, Observable, Subject, type Subscription} from 'rxjs'\nimport {first, mergeMap} from 'rxjs/operators'\n\nimport {type FIXME} from '../../../FIXME'\n\nconst DEFAULT_CONCURRENCY = 4\n\nfunction remove<T>(array: Array<T>, item: T): Array<T> {\n  const index = array.indexOf(item)\n  if (index > -1) {\n    array.splice(index, 1)\n  }\n  return array\n}\n\nexport function withMaxConcurrency<Args extends any[], Ret>(\n  func: (...args: Args) => Observable<Ret>,\n  concurrency: number = DEFAULT_CONCURRENCY,\n) {\n  const throttler = createThrottler(concurrency)\n  return (...args: Args) => observableFrom(throttler(func(...args))) as Observable<Ret>\n}\n\nexport function createThrottler(concurrency: number = DEFAULT_CONCURRENCY) {\n  const currentSubscriptions: Array<Subscription> = []\n  const pendingObservables: Array<Observable<any>> = []\n  const ready$ = new Subject()\n\n  return request\n\n  function request(observable: Observable<unknown>): Observable<unknown> {\n    return new Observable((observer) => {\n      if (currentSubscriptions.length >= concurrency) {\n        return scheduleAndWait(observable)\n          .pipe(mergeMap(request) as FIXME)\n          .subscribe(observer)\n      }\n      const subscription = observable.subscribe(observer)\n      currentSubscriptions.push(subscription)\n      return () => {\n        remove(currentSubscriptions, subscription)\n        remove(pendingObservables, observable)\n        subscription.unsubscribe()\n        check()\n      }\n    })\n  }\n\n  function scheduleAndWait(observable: Observable<unknown>) {\n    pendingObservables.push(observable)\n    return ready$.asObservable().pipe(first((obs) => obs === observable))\n  }\n\n  function check() {\n    while (pendingObservables.length > 0 && currentSubscriptions.length < concurrency) {\n      ready$.next(pendingObservables.shift())\n    }\n  }\n}\n","import {type ProgressEvent, type SanityAssetDocument, type SanityClient} from '@sanity/client'\nimport {type FileAsset, type ImageAsset} from '@sanity/types'\nimport {Observable, of as observableOf} from 'rxjs'\nimport {catchError, map, mergeMap} from 'rxjs/operators'\n\nimport {type DocumentPreviewStore} from '../../../../preview'\nimport {type UploadOptions} from '../../uploads/types'\nimport {withMaxConcurrency} from '../../utils'\n\nconst MAX_CONCURRENT_UPLOADS = 4\n\ntype UploadEvent = ProgressEvent | {type: 'complete'; id: string; asset: SanityAssetDocument}\n\nfunction uploadSanityAsset(\n  client: SanityClient,\n  assetType: 'file' | 'image',\n  file: File | Blob,\n  options: UploadOptions = {},\n): Observable<UploadEvent> {\n  const extract = options.metadata\n  const preserveFilename = options.storeOriginalFilename\n  const {label, title, description, creditLine, source} = options\n  return hashFile(file).pipe(\n    catchError(() =>\n      // ignore if hashing fails for some reason\n      observableOf(null),\n    ),\n\n    mergeMap((hash) =>\n      // note: the sanity api will still dedupe unique files, but this saves us from uploading the asset file entirely\n      hash ? fetchExisting(client, `sanity.${assetType}Asset`, hash) : observableOf(null),\n    ),\n\n    mergeMap((existing: SanityAssetDocument | null) => {\n      if (existing) {\n        return observableOf({\n          // complete with the existing asset document\n          type: 'complete' as const,\n          id: existing._id,\n          asset: existing,\n        })\n      }\n      return client.observable.assets\n        .upload(assetType, file, {\n          tag: 'asset.upload',\n          extract,\n          preserveFilename,\n          label,\n          title,\n          description,\n          creditLine,\n          source,\n        })\n        .pipe(\n          map((event) =>\n            event.type === 'response'\n              ? {\n                  // rewrite to a 'complete' event\n                  type: 'complete' as const,\n                  id: event.body.document._id,\n                  asset: event.body.document,\n                }\n              : event,\n          ),\n        )\n    }),\n  )\n}\n\nconst uploadAsset = withMaxConcurrency(uploadSanityAsset, MAX_CONCURRENT_UPLOADS)\n\nexport const uploadImageAsset = (\n  client: SanityClient,\n  file: File | Blob,\n  options?: UploadOptions,\n) => uploadAsset(client, 'image', file, options)\n\nexport const uploadFileAsset = (client: SanityClient, file: File | Blob, options?: UploadOptions) =>\n  uploadAsset(client, 'file', file, options)\n\n// note: there's currently 100% overlap between the ImageAsset document and the FileAsset documents as per interface required by the image and file input\nfunction observeAssetDoc(documentPreviewStore: DocumentPreviewStore, id: string) {\n  return documentPreviewStore.observePaths({_type: 'reference', _ref: id}, [\n    'originalFilename',\n    'url',\n    'metadata',\n    'label',\n    'title',\n    'description',\n    'creditLine',\n    'source',\n    'size',\n  ])\n}\n\nexport function observeImageAsset(documentPreviewStore: DocumentPreviewStore, id: string) {\n  return observeAssetDoc(documentPreviewStore, id) as Observable<ImageAsset>\n}\n\nexport function observeFileAsset(documentPreviewStore: DocumentPreviewStore, id: string) {\n  return observeAssetDoc(documentPreviewStore, id) as Observable<FileAsset>\n}\n\nfunction fetchExisting(\n  client: SanityClient,\n  type: string,\n  hash: string,\n): Observable<ImageAsset | FileAsset | null> {\n  return client.observable.fetch(\n    '*[_type == $documentType && sha1hash == $hash][0]',\n    {documentType: type, hash},\n    {tag: 'asset.find-duplicate'},\n  )\n}\n\nfunction readFile(file: Blob | File): Observable<ArrayBuffer> {\n  return new Observable((subscriber) => {\n    const reader = new FileReader()\n    reader.onload = () => {\n      subscriber.next(reader.result as ArrayBuffer)\n      subscriber.complete()\n    }\n    reader.onerror = (err) => {\n      subscriber.error(err)\n    }\n    reader.readAsArrayBuffer(file)\n    return () => {\n      reader.abort()\n    }\n  })\n}\n\nfunction hashFile(file: File | Blob): Observable<string | null> {\n  if (!window.crypto || !window.crypto.subtle || !window.FileReader) {\n    return observableOf(null)\n  }\n  return readFile(file).pipe(\n    mergeMap((arrayBuffer) => crypto.subtle.digest('SHA-1', arrayBuffer)),\n    map(hexFromBuffer),\n  )\n}\n\nfunction hexFromBuffer(buffer: ArrayBuffer): string {\n  return Array.prototype.map\n    .call(new Uint8Array(buffer), (x) => `00${x.toString(16)}`.slice(-2))\n    .join('')\n}\n","export const UPLOAD_STATUS_KEY = '_upload'\n","import {type FormPatch, set, unset} from '../../patch'\nimport {UPLOAD_STATUS_KEY} from './constants'\nimport {type UploadProgressEvent} from './types'\n\nconst UNSET_UPLOAD_PATCH = unset([UPLOAD_STATUS_KEY])\n\nexport function createUploadEvent(patches: FormPatch[] = []): UploadProgressEvent {\n  return {\n    type: 'uploadProgress',\n    patches,\n  }\n}\n\nexport const CLEANUP_EVENT = createUploadEvent([UNSET_UPLOAD_PATCH])\n\nexport function createInitialUploadEvent(file: File) {\n  const now = new Date().toISOString()\n  const value = {\n    progress: 2,\n    createdAt: now,\n    updatedAt: now,\n    file: {name: file.name, type: file.type},\n  }\n\n  return createUploadEvent([set(value, [UPLOAD_STATUS_KEY])])\n}\n","import {type SanityClient} from '@sanity/client'\nimport {concat, type Observable, of} from 'rxjs'\nimport {map} from 'rxjs/operators'\n\nimport {set} from '../../patch'\nimport {uploadFileAsset} from '../inputs/client-adapters/assets'\nimport {UPLOAD_STATUS_KEY} from './constants'\nimport {type UploadOptions, type UploadProgressEvent} from './types'\nimport {CLEANUP_EVENT, createInitialUploadEvent, createUploadEvent} from './utils'\n\nexport function uploadFile(\n  client: SanityClient,\n  file: File,\n  options?: UploadOptions,\n): Observable<UploadProgressEvent> {\n  const upload$ = uploadFileAsset(client, file, options).pipe(\n    map((event) => {\n      if (event.type === 'complete') {\n        return createUploadEvent([\n          set({_type: 'reference', _ref: event.asset._id}, ['asset']),\n          set(100, [UPLOAD_STATUS_KEY, 'progress']),\n          set(new Date().toISOString(), [UPLOAD_STATUS_KEY, 'updated']),\n        ])\n      }\n      return createUploadEvent([\n        set(event.percent, [UPLOAD_STATUS_KEY, 'progress']),\n        set(new Date().toISOString(), [UPLOAD_STATUS_KEY, 'updated']),\n      ])\n    }),\n  )\n\n  return concat(of(createInitialUploadEvent(file)), upload$, of(CLEANUP_EVENT))\n}\n","import {Observable} from 'rxjs'\n\n/* eslint-disable */\n\n/**\n * Check if we need to change dims.\n */\nfunction rotated(n: number) {\n  return [5, 6, 7, 8].indexOf(n) > -1\n}\n\ntype RotateOpts = {\n  degrees?: number\n  x: number\n  y: number\n}\n\n// Based on github.com/component/rotate\nfunction rotate(ctx: CanvasRenderingContext2D | null, options: RotateOpts) {\n  const x = options.x\n  const y = options.y\n\n  const radians = (options.degrees || 0) * (Math.PI / 180)\n\n  ctx?.translate(x, y)\n  ctx?.rotate(radians)\n  ctx?.translate(-x, -y)\n}\n\n// Based on github.com/component/flip\nfunction flip(canvas: HTMLCanvasElement, x: boolean, y: boolean) {\n  const ctx = canvas.getContext('2d')\n  ctx?.translate(x ? canvas.width : 0, y ? canvas.height : 0)\n  ctx?.scale(x ? -1 : 1, y ? -1 : 1)\n}\n\nconst ORIENTATION_OPS = [\n  {op: 'none', degrees: 0},\n  {op: 'flip-x', degrees: 0},\n  {\n    op: 'none',\n    degrees: 180,\n  },\n  {op: 'flip-y', degrees: 0},\n  {op: 'flip-x', degrees: 90},\n  {op: 'none', degrees: 90},\n  {\n    op: 'flip-x',\n    degrees: -90,\n  },\n  {op: 'none', degrees: -90},\n]\n\nexport type Orientation =\n  | 'top-left'\n  | 'top-right'\n  | 'bottom-right'\n  | 'bottom-left'\n  | 'left-top'\n  | 'right-top'\n  | 'right-bottom'\n  | 'left-bottom'\n\nconst ORIENTATIONS: Array<Orientation> = [\n  'top-left',\n  'top-right',\n  'bottom-right',\n  'bottom-left',\n  'left-top',\n  'right-top',\n  'right-bottom',\n  'left-bottom',\n]\n\nexport const DEFAULT_ORIENTATION: Orientation = 'top-left'\n\nconst THUMB_SIZE = 120\n\n// Based on github.com/component/exif-rotate\nfunction _orient(img: HTMLImageElement, orientationNumber: number): HTMLCanvasElement {\n  const orientation = ORIENTATION_OPS[orientationNumber - 1]\n\n  const ratio = img.height / img.width\n  img.width = THUMB_SIZE / ratio\n  img.height = img.width * ratio\n\n  // canvas\n  const canvas = document.createElement('canvas')\n  const ctx = canvas.getContext('2d')\n\n  // dims\n  if (rotated(orientationNumber)) {\n    canvas.height = img.width\n    canvas.width = img.height\n  } else {\n    canvas.width = img.width\n    canvas.height = img.height\n  }\n\n  // flip\n  if (orientation.op === 'flip-x') {\n    flip(canvas, true, false)\n  }\n  if (orientation.op === 'flip-y') {\n    flip(canvas, false, true)\n  }\n\n  // rotate\n  if (orientation.degrees) {\n    rotate(ctx, {\n      degrees: orientation.degrees,\n      x: canvas.width / 2,\n      y: canvas.height / 2,\n    })\n\n    if (rotated(orientationNumber)) {\n      const d = canvas.width - canvas.height\n      ctx?.translate(d / 2, -d / 2)\n    }\n  }\n\n  ctx?.drawImage(img, 0, 0, img.width, img.height)\n  return canvas\n}\n\n/* eslint-enable */\nexport function orient(image: HTMLImageElement, orientationId: Orientation) {\n  return new Observable((observer) => {\n    // console.time('canvas to blob')\n    const orientation = ORIENTATIONS.indexOf(orientationId) + 1\n    const canvas = _orient(image, orientation)\n    observer.next(canvas.toDataURL('image/jpeg', 0.1))\n    observer.complete()\n  })\n}\n","import exif from 'exif-component'\nimport {from as observableFrom, Observable, of as observableOf} from 'rxjs'\nimport {catchError, map} from 'rxjs/operators'\n\nfunction readFileAsArrayBuffer(\n  file: File,\n  length: number,\n): Observable<string | ArrayBuffer | null> {\n  return new Observable((observer) => {\n    const reader = new window.FileReader()\n    reader.onerror = (err) => observer.error(err)\n    reader.onload = () => {\n      observer.next(reader.result)\n      observer.complete()\n    }\n    reader.readAsArrayBuffer(length === undefined ? file : file.slice(0, length))\n    return () => reader.abort()\n  })\n}\n\nconst SKIP_EXIF_ERROR_RE = /(invalid image format)|(No exif data)/i\n\n// 128k should be enough for exif data according to https://github.com/mattiasw/ExifReader#tips\nconst EXIF_BUFFER_LENGTH = 128000\n\nexport function readExif(file: File) {\n  return observableFrom(readFileAsArrayBuffer(file, EXIF_BUFFER_LENGTH)).pipe(\n    map((buf) => exif(buf)),\n    catchError((error) => {\n      if (!SKIP_EXIF_ERROR_RE.test(error.message)) {\n        // Exif read failed, we do not want to fail hard\n        console.warn(`Exif read failed, continuing anyway: ${error.message}`) // eslint-disable-line no-console\n      }\n      return observableOf({})\n    }),\n  )\n}\n","import {Observable} from 'rxjs'\nimport {mergeMap} from 'rxjs/operators'\n\nimport {orient, type Orientation} from './orient'\n\nfunction loadImage(url: string): Observable<HTMLImageElement> {\n  return new Observable((observer) => {\n    const image = new window.Image()\n    //console.time(\"read image\");\n    image.onerror = () => {\n      observer.error(\n        new Error(`Could not load image from url \"${url}\". Image may be of an unsupported format`),\n      )\n    }\n    image.onload = () => {\n      //console.timeEnd(\"read image\");\n      observer.next(image)\n      observer.complete()\n    }\n    image.src = url\n    return () => {\n      // todo: cancel loading (if possible?)\n    }\n  })\n}\n\nexport function rotateImage(file: File, orientation: Orientation) {\n  return loadImage(window.URL.createObjectURL(file)).pipe(\n    mergeMap((image) => orient(image, orientation)),\n  )\n}\n","import {type SanityClient} from '@sanity/client'\nimport {concat, merge, type Observable, of} from 'rxjs'\nimport {catchError, filter, map, mergeMap} from 'rxjs/operators'\n\nimport {set} from '../../patch'\nimport {uploadImageAsset} from '../inputs/client-adapters/assets'\nimport {UPLOAD_STATUS_KEY} from './constants'\nimport {DEFAULT_ORIENTATION, type Orientation} from './image/orient'\nimport {readExif} from './image/readExif'\nimport {rotateImage} from './image/rotateImage'\nimport {type UploadOptions, type UploadProgressEvent} from './types'\nimport {CLEANUP_EVENT, createInitialUploadEvent, createUploadEvent} from './utils'\n\ntype Exif = {\n  orientation: Orientation\n}\n\nexport function uploadImage(\n  client: SanityClient,\n  file: File,\n  options?: UploadOptions,\n): Observable<UploadProgressEvent> {\n  const upload$ = uploadImageAsset(client, file, options).pipe(\n    filter((event: any) => event.stage !== 'download'),\n    map((event) => ({\n      ...event,\n      progress: 2 + (event.percent / 100) * 98,\n    })),\n\n    map((event) => {\n      if (event.type === 'complete') {\n        return createUploadEvent([\n          set({_type: 'reference', _ref: event.asset._id}, ['asset']),\n          set(100, [UPLOAD_STATUS_KEY, 'progress']),\n          set(new Date().toISOString(), [UPLOAD_STATUS_KEY, 'updatedAt']),\n        ])\n      }\n      return createUploadEvent([\n        set(event.percent, [UPLOAD_STATUS_KEY, 'progress']),\n        set(new Date().toISOString(), [UPLOAD_STATUS_KEY, 'updatedAt']),\n      ])\n    }),\n  )\n\n  const setPreviewUrl$ = readExif(file).pipe(\n    mergeMap((exifData: unknown) =>\n      rotateImage(file, (exifData as Exif).orientation || DEFAULT_ORIENTATION),\n    ),\n    catchError((error) => {\n      // eslint-disable-next-line no-console\n      console.warn(\n        'Image preprocessing failed for \"%s\" with the error: %s',\n        file.name,\n        error.message,\n      )\n\n      // something went wrong, but continue still\n      return of(null)\n    }),\n    filter(Boolean),\n    map((imageUrl) => createUploadEvent([set(imageUrl, [UPLOAD_STATUS_KEY, 'previewImage'])])),\n  )\n\n  return concat(\n    of(createInitialUploadEvent(file)),\n    merge(upload$, setPreviewUrl$),\n    of(CLEANUP_EVENT),\n  )\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type SchemaType} from '@sanity/types'\nimport {map} from 'rxjs/operators'\n\nimport {set} from '../../patch'\nimport {type Uploader, type UploaderDef, type UploadOptions} from './types'\nimport {uploadFile} from './uploadFile'\nimport {uploadImage} from './uploadImage'\n\nconst UPLOAD_IMAGE: UploaderDef = {\n  type: 'image',\n  accepts: 'image/*',\n  upload: (client: SanityClient, file: File, type?: SchemaType, options?: UploadOptions) =>\n    uploadImage(client, file, options),\n}\n\nconst UPLOAD_FILE: UploaderDef = {\n  type: 'file',\n  accepts: '',\n  upload: (client: SanityClient, file: File, type: SchemaType, options?: UploadOptions) =>\n    uploadFile(client, file, options),\n}\n\nconst UPLOAD_TEXT: UploaderDef = {\n  type: 'string',\n  accepts: 'text/*',\n  upload: (client: SanityClient, file: File, type: SchemaType, options?: UploadOptions) =>\n    uploadFile(client, file, options).pipe(\n      map((content) => ({\n        type: 'uploadProgress',\n        patches: [set(content)],\n      })),\n    ),\n\n  // Todo: promote this to a \"first-class\" form-builder abstraction\n  // and make it possible to register custom uploaders\n}\n\nexport const uploaders: Array<Uploader> = [UPLOAD_IMAGE, UPLOAD_TEXT, UPLOAD_FILE].map(\n  (uploader, i) => ({\n    ...uploader,\n    priority: i,\n  }),\n)\n","import {type SchemaType} from '@sanity/types'\n\nimport {type FIXME} from '../../../FIXME'\nimport * as is from '../../utils/is'\nimport {accepts} from './accepts'\nimport {type FileLike, type Uploader} from './types'\nimport {uploaders} from './uploaders'\n\nexport function resolveUploader(type: SchemaType, file: FileLike): Uploader | null {\n  return (\n    uploaders.find((uploader) => {\n      return (\n        is.type(uploader.type, type) &&\n        accepts(file, uploader.accepts) &&\n        accepts(file, (type.options as FIXME)?.accept || '')\n      )\n    }) || null\n  )\n}\n","import {type Path, type SchemaType} from '@sanity/types'\nimport {useToast} from '@sanity/ui'\nimport {type FocusEvent, useCallback, useEffect, useMemo, useRef} from 'react'\nimport {type Subscription} from 'rxjs'\nimport {map, tap} from 'rxjs/operators'\n\nimport {useClient} from '../../../../hooks'\nimport {useResolveInitialValueForType} from '../../../../store'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../studioClient'\nimport {useDidUpdate} from '../../../hooks/useDidUpdate'\nimport {createProtoArrayValue} from '../../../inputs/arrays/ArrayOfObjectsInput/createProtoArrayValue'\nimport {insert, type PatchArg, PatchEvent, setIfMissing, unset} from '../../../patch'\nimport {applyAll} from '../../../patch/applyPatch'\nimport {type ArrayOfObjectsFormNode, type FieldMember} from '../../../store'\nimport {useDocumentFieldActions} from '../../../studio/contexts/DocumentFieldActions'\nimport {FormCallbacksProvider, useFormCallbacks} from '../../../studio/contexts/FormCallbacks'\nimport {resolveUploader as defaultResolveUploader} from '../../../studio/uploads/resolveUploader'\nimport {type FileLike, type UploadProgressEvent} from '../../../studio/uploads/types'\nimport {\n  type ArrayFieldProps,\n  type ArrayInputInsertEvent,\n  type ArrayInputMoveItemEvent,\n  type ArrayOfObjectsInputProps,\n  type ObjectItem,\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n  type UploadEvent,\n} from '../../../types'\nimport {useFormBuilder} from '../../../useFormBuilder'\nimport {ensureKey} from '../../../utils/ensureKey'\nimport * as is from '../../../utils/is'\nimport {createDescriptionId} from '../../common/createDescriptionId'\nimport {resolveInitialArrayValues} from '../../common/resolveInitialArrayValues'\n\n/**\n * Responsible for creating inputProps and fieldProps to pass to renderInput and renderField for an array input\n * Note: \"ArrayField\" in this context means an object field of an array type\n * @param props - Component props\n */\nexport function ArrayOfObjectsField(props: {\n  member: FieldMember<ArrayOfObjectsFormNode>\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n}) {\n  const {\n    onPathBlur,\n    onPathFocus,\n    onChange,\n    onSetPathCollapsed,\n    onSetFieldSetCollapsed,\n    onPathOpen,\n    onFieldGroupSelect,\n  } = useFormCallbacks()\n\n  const {\n    member,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n  } = props\n\n  const fieldActions = useDocumentFieldActions()\n\n  const focusRef = useRef<Element & {focus: () => void}>()\n  const uploadSubscriptions = useRef<Record<string, Subscription>>({})\n\n  useDidUpdate(member.field.focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus) {\n      focusRef.current?.focus()\n    }\n  })\n\n  const handleFocus = useCallback(\n    (event: FocusEvent) => {\n      // We want to handle focus when the array input *itself* element receives\n      // focus, not when a child element receives focus, but React has decided\n      // to let focus bubble, so this workaround is needed\n      // Background: https://github.com/facebook/react/issues/6410#issuecomment-671915381\n      if (event.currentTarget === event.target && event.currentTarget === focusRef.current) {\n        onPathFocus(member.field.path)\n      }\n    },\n    [member.field.path, onPathFocus],\n  )\n\n  const handleBlur = useCallback(\n    (event: FocusEvent) => {\n      // We want to handle blur when the array input *itself* element receives\n      // blur, not when a child element receives blur, but React has decided\n      // to let focus events bubble, so this workaround is needed\n      // Background: https://github.com/facebook/react/issues/6410#issuecomment-671915381\n      if (\n        event.currentTarget === event.target &&\n        (event.currentTarget === focusRef.current ||\n          // PortableTextInput forwarded ref is a custom handle, i.e. not an HTMLElement\n          !(focusRef.current instanceof HTMLElement))\n      ) {\n        onPathBlur(member.field.path)\n      }\n    },\n    [member.field.path, onPathBlur],\n  )\n\n  const valueRef = useRef(member.field.value)\n  useEffect(() => {\n    valueRef.current = member.field.value\n  }, [member.field.value])\n\n  const handleChange = useCallback(\n    (event: PatchEvent | PatchArg) => {\n      const patches = PatchEvent.from(event).patches\n      // if the patch is an unset patch that targets an item in the array (as opposed to unsetting a field somewhere deeper)\n      const isRemovingLastItem = patches.some(\n        (patch) => patch.type === 'unset' && patch.path.length === 1,\n      )\n\n      if (isRemovingLastItem) {\n        // apply the patch to the current value\n        valueRef.current = applyAll(valueRef.current || [], patches)\n\n        // if the result is an empty array\n        if (Array.isArray(valueRef.current) && !valueRef.current.length) {\n          // then unset the array field\n          onChange(PatchEvent.from(unset([member.name])))\n          return\n        }\n      }\n      // otherwise apply the patch\n      onChange(PatchEvent.from(event).prepend(setIfMissing([])).prefixAll(member.name))\n    },\n    [onChange, member.name, valueRef],\n  )\n  const resolveInitialValue = useResolveInitialValueForType()\n\n  const toast = useToast()\n\n  const handleCollapse = useCallback(() => {\n    onSetPathCollapsed(member.field.path, true)\n  }, [onSetPathCollapsed, member.field.path])\n\n  const handleExpand = useCallback(() => {\n    onSetPathCollapsed(member.field.path, false)\n  }, [onSetPathCollapsed, member.field.path])\n\n  const handleCollapseItem = useCallback(\n    (itemKey: string) => {\n      onSetPathCollapsed(member.field.path.concat({_key: itemKey}), true)\n    },\n    [onSetPathCollapsed, member.field.path],\n  )\n\n  const handleExpandItem = useCallback(\n    (itemKey: string) => {\n      onSetPathCollapsed(member.field.path.concat({_key: itemKey}), false)\n    },\n    [onSetPathCollapsed, member.field.path],\n  )\n\n  const handleOpenItem = useCallback(\n    (path: Path) => {\n      onPathOpen(path)\n      onSetPathCollapsed(path, false)\n    },\n    [onPathOpen, onSetPathCollapsed],\n  )\n\n  const handleCloseItem = useCallback(() => {\n    onPathOpen(member.field.path)\n    onSetPathCollapsed(member.field.path, true)\n  }, [onPathOpen, member.field.path, onSetPathCollapsed])\n\n  const handleInsert = useCallback(\n    (event: ArrayInputInsertEvent<ObjectItem>) => {\n      if (event.items.length === 0) {\n        throw new Error('Insert event should include at least one item')\n      }\n      const itemsWithKeys = event.items.map((item) => ensureKey(item))\n\n      handleChange(PatchEvent.from([insert(itemsWithKeys, event.position, [event.referenceItem])]))\n\n      const focusItemKey = itemsWithKeys[0]._key\n      const itemPath = [...member.field.path, {_key: focusItemKey}]\n      // Set focus at the first item (todo: verify that this is the expected/better behavior when adding multiple items)\n      onPathFocus(itemPath)\n\n      const shouldOpen = event.open !== false\n\n      if (event.skipInitialValue) {\n        if (shouldOpen) {\n          handleOpenItem(itemPath)\n        }\n      } else {\n        resolveInitialArrayValues(itemsWithKeys, member.field.schemaType, resolveInitialValue)\n          .pipe(\n            tap((result) => {\n              if (result.type === 'patch') {\n                handleChange(result.patches)\n              } else {\n                toast.push({\n                  title: `Could not resolve initial value`,\n                  description: `Unable to resolve initial value for type: ${result.schemaType.title}: ${result.error.message}.`,\n                  status: 'error',\n                })\n              }\n            }),\n          )\n          .subscribe({\n            complete: () => {\n              if (shouldOpen) {\n                handleOpenItem(itemPath)\n              }\n            },\n          })\n      }\n    },\n    [\n      handleChange,\n      handleOpenItem,\n      member.field.path,\n      member.field.schemaType,\n      onPathFocus,\n      resolveInitialValue,\n      toast,\n    ],\n  )\n\n  const handleMoveItem = useCallback(\n    (event: ArrayInputMoveItemEvent) => {\n      const value = member.field.value\n      const item = value?.[event.fromIndex] as any\n      const refItem = value?.[event.toIndex] as any\n      if (event.fromIndex === event.toIndex) {\n        return\n      }\n\n      if (!(item as any)?._key || !(refItem as any)?._key) {\n        // eslint-disable-next-line no-console\n        console.error(\n          'Neither the item you are moving nor the item you are moving to have a key. Cannot continue.',\n        )\n\n        return\n      }\n\n      handleChange([\n        unset([{_key: item._key}]),\n        insert([item], event.fromIndex > event.toIndex ? 'before' : 'after', [\n          {_key: refItem._key},\n        ]),\n      ])\n    },\n    [handleChange, member.field.value],\n  )\n\n  const handlePrependItem = useCallback(\n    (item: any) => {\n      handleChange([setIfMissing([]), insert([ensureKey(item)], 'before', [0])])\n    },\n    [handleChange],\n  )\n  const handleAppendItem = useCallback(\n    (item: any) => {\n      handleChange([setIfMissing([]), insert([ensureKey(item)], 'after', [-1])])\n    },\n    [handleChange],\n  )\n\n  const handleRemoveItem = useCallback(\n    (itemKey: string) => {\n      if (uploadSubscriptions.current[itemKey]) {\n        uploadSubscriptions.current[itemKey].unsubscribe()\n        delete uploadSubscriptions.current[itemKey]\n      }\n      handleChange([unset([{_key: itemKey}])])\n    },\n    [handleChange],\n  )\n\n  const handleFocusChildPath = useCallback(\n    (path: Path) => {\n      onPathFocus(member.field.path.concat(path))\n    },\n    [member.field.path, onPathFocus],\n  )\n\n  const elementProps = useMemo(\n    (): ArrayOfObjectsInputProps['elementProps'] => ({\n      onBlur: handleBlur,\n      onFocus: handleFocus,\n      id: member.field.id,\n      ref: focusRef,\n      'aria-describedby': createDescriptionId(member.field.id, member.field.schemaType.description),\n    }),\n    [handleBlur, handleFocus, member.field.id, member.field.schemaType.description],\n  )\n\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const formBuilder = useFormBuilder()\n\n  const supportsImageUploads = formBuilder.__internal.image.directUploads\n  const supportsFileUploads = formBuilder.__internal.file.directUploads\n\n  const resolveUploader = useCallback(\n    (type: SchemaType, file: FileLike) => {\n      if (is.type('image', type) && !supportsImageUploads) {\n        return null\n      }\n      if (is.type('file', type) && !supportsFileUploads) {\n        return null\n      }\n\n      return defaultResolveUploader(type, file)\n    },\n    [supportsFileUploads, supportsImageUploads],\n  )\n\n  const handleUpload = useCallback(\n    ({file, schemaType, uploader}: UploadEvent) => {\n      const item = createProtoArrayValue(schemaType)\n      const key = item._key\n\n      handleInsert({\n        items: [item],\n        position: 'after',\n        referenceItem: -1,\n        open: false,\n      })\n\n      const events$ = uploader.upload(client, file, schemaType).pipe(\n        map((uploadProgressEvent: UploadProgressEvent) =>\n          PatchEvent.from(uploadProgressEvent.patches || []).prefixAll({_key: key}),\n        ),\n        tap((event) => handleChange(event.patches)),\n      )\n\n      uploadSubscriptions.current = {\n        ...uploadSubscriptions.current,\n        [key]: events$.subscribe(),\n      }\n    },\n    [client, handleChange, handleInsert],\n  )\n\n  const inputProps = useMemo((): Omit<ArrayOfObjectsInputProps, 'renderDefault'> => {\n    return {\n      level: member.field.level,\n      members: member.field.members,\n      value: member.field.value as any,\n      readOnly: member.field.readOnly,\n      schemaType: member.field.schemaType,\n      changed: member.field.changed,\n      id: member.field.id,\n      onItemExpand: handleExpandItem,\n      onItemCollapse: handleCollapseItem,\n      onItemClose: handleCloseItem,\n      onItemOpen: handleOpenItem,\n\n      focusPath: member.field.focusPath,\n      focused: member.field.focused,\n\n      path: member.field.path,\n\n      onChange: handleChange,\n      onInsert: handleInsert,\n      onItemMove: handleMoveItem,\n      onItemRemove: handleRemoveItem,\n      onItemAppend: handleAppendItem,\n      onItemPrepend: handlePrependItem,\n      onPathFocus: handleFocusChildPath,\n      resolveInitialValue,\n      onUpload: handleUpload,\n      resolveUploader: resolveUploader,\n      validation: member.field.validation,\n      presence: member.field.presence,\n      renderAnnotation,\n      renderBlock,\n      renderInlineBlock,\n      renderInput,\n      renderField,\n      renderItem,\n      renderPreview,\n      elementProps,\n    }\n  }, [\n    member.field.level,\n    member.field.members,\n    member.field.value,\n    member.field.readOnly,\n    member.field.schemaType,\n    member.field.changed,\n    member.field.id,\n    member.field.focusPath,\n    member.field.focused,\n    member.field.path,\n    member.field.validation,\n    member.field.presence,\n    handleExpandItem,\n    handleCollapseItem,\n    handleCloseItem,\n    handleOpenItem,\n    handleChange,\n    handleInsert,\n    handleMoveItem,\n    handleRemoveItem,\n    handleAppendItem,\n    handlePrependItem,\n    handleFocusChildPath,\n    resolveInitialValue,\n    handleUpload,\n    resolveUploader,\n    renderAnnotation,\n    renderBlock,\n    renderInlineBlock,\n    renderInput,\n    renderField,\n    renderItem,\n    renderPreview,\n    elementProps,\n  ])\n\n  const renderedInput = useMemo(() => renderInput(inputProps), [inputProps, renderInput])\n\n  const fieldProps = useMemo((): Omit<ArrayFieldProps, 'renderDefault'> => {\n    return {\n      actions: fieldActions,\n      name: member.name,\n      index: member.index,\n      level: member.field.level,\n      value: member.field.value,\n      title: member.field.schemaType.title,\n      description: member.field.schemaType.description,\n      collapsible: member.collapsible,\n      collapsed: member.collapsed,\n      changed: member.field.changed,\n      onCollapse: handleCollapse,\n      onExpand: handleExpand,\n      schemaType: member.field.schemaType,\n      inputId: member.field.id,\n      path: member.field.path,\n      presence: member.field.presence,\n      validation: member.field.validation,\n      children: renderedInput,\n      inputProps: inputProps as ArrayOfObjectsInputProps,\n    }\n  }, [\n    fieldActions,\n    member.name,\n    member.index,\n    member.field.level,\n    member.field.value,\n    member.field.schemaType,\n    member.field.changed,\n    member.field.id,\n    member.field.path,\n    member.field.presence,\n    member.field.validation,\n    member.collapsible,\n    member.collapsed,\n    handleCollapse,\n    handleExpand,\n    renderedInput,\n    inputProps,\n  ])\n\n  return (\n    <FormCallbacksProvider\n      onFieldGroupSelect={onFieldGroupSelect}\n      onChange={handleChange}\n      onSetFieldSetCollapsed={onSetFieldSetCollapsed}\n      onSetPathCollapsed={onSetPathCollapsed}\n      onPathOpen={onPathOpen}\n      onPathBlur={onPathBlur}\n      onPathFocus={onPathFocus}\n    >\n      {useMemo(() => renderField(fieldProps), [fieldProps, renderField])}\n    </FormCallbacksProvider>\n  )\n}\n","import {Observable} from 'rxjs'\n\nexport function readAsText(file: File, encoding?: string) {\n  return new Observable<string | null>((observer) => {\n    const reader = new FileReader()\n    reader.onerror = (error) => observer.error(error)\n    reader.onload = () => {\n      observer.next(reader.result as string | null)\n      observer.complete()\n    }\n    reader.readAsText(file, encoding)\n    return () => {\n      reader.abort()\n    }\n  })\n}\n","import {\n  type BooleanSchemaType,\n  isBooleanSchemaType,\n  isNumberSchemaType,\n  isStringSchemaType,\n  type NumberSchemaType,\n  type SchemaType,\n  type StringSchemaType,\n} from '@sanity/types'\nimport {type FocusEvent, useCallback, useMemo, useRef} from 'react'\nimport {type Subscription} from 'rxjs'\nimport {filter, map, tap} from 'rxjs/operators'\n\nimport {type FIXME} from '../../../../FIXME'\nimport {useClient} from '../../../../hooks'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../studioClient'\nimport {useDidUpdate} from '../../../hooks/useDidUpdate'\nimport {type PrimitiveValue} from '../../../inputs/arrays/ArrayOfPrimitivesInput/types'\nimport {insert, type PatchArg, PatchEvent, set, setIfMissing, unset} from '../../../patch'\nimport {applyAll} from '../../../patch/applyPatch'\nimport {type ArrayOfPrimitivesFormNode, type FieldMember} from '../../../store'\nimport {type Uploader, type UploaderResolver, type UploadProgressEvent} from '../../../studio'\nimport {useDocumentFieldActions} from '../../../studio/contexts/DocumentFieldActions'\nimport {FormCallbacksProvider, useFormCallbacks} from '../../../studio/contexts/FormCallbacks'\nimport {accepts} from '../../../studio/uploads/accepts'\nimport {readAsText} from '../../../studio/uploads/file/readAsText'\nimport {\n  type ArrayInputMoveItemEvent,\n  type ArrayOfObjectsInputProps,\n  type ArrayOfPrimitivesFieldProps,\n  type ArrayOfPrimitivesInputProps,\n  type RenderAnnotationCallback,\n  type RenderArrayOfPrimitivesItemCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n  type UploadEvent,\n} from '../../../types'\nimport {createDescriptionId} from '../../common/createDescriptionId'\n\nfunction move<T>(arr: T[], from: number, to: number): T[] {\n  const copy = arr.slice()\n  const val = copy[from]\n  copy.splice(from, 1)\n  copy.splice(to, 0, val)\n  return copy\n}\n\n/**\n * @example\n * Inserts \"hello\" at the beginning\n * ```ts\n * insertAfter(-1, [\"one\", \"two\"], \"hello\")\n * // => [\"hello\", \"one\", \"two\"]\n * ```\n */\nfunction insertAfter<T>(\n  /**\n   * index to insert item after. An index of -1 will prepend the item\n   */\n  index: number,\n  /**\n   * the array to insert the item into\n   */\n  arr: T[],\n  /**\n   * the item to insert\n   */\n  items: T[],\n): T[] {\n  const copy = arr.slice()\n  copy.splice(index + 1, 0, ...items)\n  return copy\n}\nfunction isStringNumeric(input: string) {\n  return /^\\d+$/.test(input)\n}\n\ntype PrimitiveSchemaType = NumberSchemaType | BooleanSchemaType | StringSchemaType\n\nfunction convertToSchemaType(line: string, candidates: SchemaType[]) {\n  let acceptsBooleans = false\n  let acceptsNumbers = false\n  let acceptsStrings = false\n  candidates.forEach((candidate) => {\n    if (isBooleanSchemaType(candidate)) {\n      acceptsBooleans = true\n    }\n    if (isStringSchemaType(candidate)) {\n      acceptsStrings = true\n    }\n    if (isNumberSchemaType(candidate)) {\n      acceptsNumbers = true\n    }\n  })\n\n  if (acceptsBooleans && (line === 'true' || line === 'false')) return line === 'true'\n  if (acceptsNumbers && isStringNumeric(line)) return Number(line)\n  return acceptsStrings ? line : undefined\n}\n\nfunction createPlainTextUploader(itemTypes: PrimitiveSchemaType[]): Uploader<PrimitiveSchemaType> {\n  return {\n    priority: 0,\n    accepts: 'text/*',\n    type: 'string',\n    upload(client, file) {\n      return readAsText(file, 'utf-8').pipe(\n        map((textContent) =>\n          textContent\n            ?.split(/[\\n\\r]/)\n            .map((value) => convertToSchemaType(value, itemTypes))\n            .filter((v) => v !== undefined),\n        ),\n        filter((v: unknown[] | undefined): v is unknown[] => Array.isArray(v)),\n        map((lines: unknown[]) => ({\n          type: 'uploadProgress',\n          patches: [insert(lines, 'after', [-1])],\n        })),\n      )\n    },\n  }\n}\n\n/**\n * Responsible for creating inputProps and fieldProps to pass to renderInput and renderField for an array input\n * Note: \"ArrayField\" in this context means an object field of an array type\n * @param props - Component props\n */\nexport function ArrayOfPrimitivesField(props: {\n  member: FieldMember<ArrayOfPrimitivesFormNode>\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfPrimitivesItemCallback\n  renderPreview: RenderPreviewCallback\n}) {\n  const {\n    onPathBlur,\n    onPathFocus,\n    onChange,\n    onPathOpen,\n    onSetPathCollapsed,\n    onSetFieldSetCollapsed,\n    onFieldGroupSelect,\n  } = useFormCallbacks()\n  const {\n    member,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n  } = props\n  const fieldActions = useDocumentFieldActions()\n\n  const focusRef = useRef<Element & {focus: () => void}>()\n  const uploadSubscriptions = useRef<Subscription>()\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n\n  useDidUpdate(member.field.focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus) {\n      focusRef.current?.focus()\n    }\n  })\n\n  const handleFocus = useCallback(\n    (event: FocusEvent) => {\n      // We want to handle focus when the array input *itself* element receives\n      // focus, not when a child element receives focus, but React has decided\n      // to let focus bubble, so this workaround is needed\n      // Background: https://github.com/facebook/react/issues/6410#issuecomment-671915381\n      if (event.currentTarget === event.target && event.currentTarget === focusRef.current) {\n        onPathFocus(member.field.path)\n      }\n    },\n    [member.field.path, onPathFocus],\n  )\n\n  const handleBlur = useCallback(\n    (event: FocusEvent) => {\n      // We want to handle blur when the array input *itself* element receives\n      // blur, not when a child element receives blur, but React has decided\n      // to let focus events bubble, so this workaround is needed\n      // Background: https://github.com/facebook/react/issues/6410#issuecomment-671915381\n      if (event.currentTarget === event.target && event.currentTarget === focusRef.current) {\n        onPathBlur(member.field.path)\n      }\n    },\n    [member.field.path, onPathBlur],\n  )\n\n  const handleChange = useCallback(\n    (event: PatchEvent | PatchArg) => {\n      const patches = PatchEvent.from(event).patches\n      // if the patch is an unset patch that targets an item in the array (as opposed to unsetting a field somewhere deeper)\n      const isRemovingLastItem = patches.some(\n        (patch) => patch.type === 'unset' && patch.path.length === 1,\n      )\n\n      if (isRemovingLastItem) {\n        // apply the patch to the current value\n        const result = applyAll(member.field.value || [], patches)\n\n        // if the result is an empty array\n        if (Array.isArray(result) && !result.length) {\n          // then unset the array field\n          onChange(PatchEvent.from(unset([member.name])))\n          return\n        }\n      }\n      // otherwise apply the patch\n      onChange(PatchEvent.from(event).prepend(setIfMissing([])).prefixAll(member.name))\n    },\n    [onChange, member.name, member.field.value],\n  )\n\n  const handleSetCollapsed = useCallback(\n    (collapsed: boolean) => {\n      onSetPathCollapsed(member.field.path, collapsed)\n    },\n    [onSetPathCollapsed, member.field.path],\n  )\n\n  const handleCollapse = useCallback(() => {\n    onSetPathCollapsed(member.field.path, true)\n  }, [onSetPathCollapsed, member.field.path])\n  const handleExpand = useCallback(() => {\n    onSetPathCollapsed(member.field.path, false)\n  }, [onSetPathCollapsed, member.field.path])\n\n  const setValue = useCallback(\n    (nextValue: PrimitiveValue[]) => {\n      handleChange(nextValue.length === 0 ? unset() : set(nextValue))\n    },\n    [handleChange],\n  )\n\n  const handleMoveItem = useCallback(\n    (event: ArrayInputMoveItemEvent) => {\n      const {value = []} = member.field\n      if (event.fromIndex === event.toIndex) {\n        return\n      }\n\n      setValue(move(value, event.fromIndex, event.toIndex))\n    },\n    [member.field, setValue],\n  )\n\n  const handleAppend = useCallback(\n    (itemValue: PrimitiveValue) => {\n      const {value = []} = member.field\n      setValue(value.concat(itemValue))\n    },\n    [member.field, setValue],\n  )\n\n  const handlePrepend = useCallback(\n    (itemValue: PrimitiveValue) => {\n      const {value = []} = member.field\n      setValue([itemValue].concat(value || []))\n    },\n    [member.field, setValue],\n  )\n\n  const handleInsert = useCallback(\n    (event: {items: PrimitiveValue[]; position: 'before' | 'after'; referenceIndex: number}) => {\n      const {value = []} = member.field\n\n      const insertIndex = event.referenceIndex + (event.position === 'before' ? -1 : 0)\n      setValue(insertAfter(insertIndex, value, event.items))\n    },\n    [member.field, setValue],\n  )\n\n  const handleRemoveItem = useCallback(\n    (index: number) => {\n      handleChange(unset([index]))\n    },\n    [handleChange],\n  )\n\n  const handleFocusIndex = useCallback(\n    (index: number) => {\n      onPathFocus(member.field.path.concat([index]))\n    },\n    [member.field.path, onPathFocus],\n  )\n\n  const elementProps = useMemo(\n    (): ArrayOfObjectsInputProps['elementProps'] => ({\n      onBlur: handleBlur,\n      onFocus: handleFocus,\n      id: member.field.id,\n      ref: focusRef,\n      'aria-describedby': createDescriptionId(member.field.id, member.field.schemaType.description),\n    }),\n    [handleBlur, handleFocus, member.field.id, member.field.schemaType.description],\n  )\n\n  const plainTextUploader = useMemo(\n    () => createPlainTextUploader(member.field.schemaType.of as PrimitiveSchemaType[]),\n    [member.field.schemaType.of],\n  )\n\n  const resolveUploader: UploaderResolver<PrimitiveSchemaType> = useCallback(\n    (schemaType, file) => (accepts(file, 'text/*') ? plainTextUploader : null),\n    [plainTextUploader],\n  )\n\n  const handleUpload = useCallback(\n    ({file, schemaType, uploader}: UploadEvent) => {\n      const events$ = uploader.upload(client, file, schemaType).pipe(\n        map((uploadProgressEvent: UploadProgressEvent) =>\n          PatchEvent.from(uploadProgressEvent.patches || []),\n        ),\n        tap((event) => handleChange(event.patches)),\n      )\n\n      if (uploadSubscriptions.current) {\n        uploadSubscriptions.current.unsubscribe()\n      }\n      uploadSubscriptions.current = events$.subscribe()\n    },\n    [client, handleChange],\n  )\n\n  const inputProps = useMemo((): Omit<ArrayOfPrimitivesInputProps, 'renderDefault'> => {\n    return {\n      level: member.field.level,\n      members: member.field.members,\n      value: member.field.value as any,\n      readOnly: member.field.readOnly,\n      onSetCollapsed: handleSetCollapsed,\n      schemaType: member.field.schemaType,\n      changed: member.field.changed,\n      id: member.field.id,\n      elementProps,\n      path: member.field.path,\n      focusPath: member.field.focusPath,\n      focused: member.field.focused,\n      onChange: handleChange,\n      onInsert: handleInsert,\n      onMoveItem: handleMoveItem,\n      onItemRemove: handleRemoveItem,\n      onItemAppend: handleAppend,\n      onItemPrepend: handlePrepend,\n      validation: member.field.validation,\n      presence: member.field.presence,\n      resolveUploader,\n      onUpload: handleUpload,\n      renderAnnotation,\n      renderBlock,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      onIndexFocus: handleFocusIndex,\n      renderPreview,\n    }\n  }, [\n    member.field.level,\n    member.field.members,\n    member.field.value,\n    member.field.readOnly,\n    member.field.schemaType,\n    member.field.changed,\n    member.field.id,\n    member.field.path,\n    member.field.focusPath,\n    member.field.focused,\n    member.field.validation,\n    member.field.presence,\n    handleSetCollapsed,\n    elementProps,\n    handleChange,\n    handleInsert,\n    handleMoveItem,\n    handleRemoveItem,\n    handleAppend,\n    handlePrepend,\n    resolveUploader,\n    handleUpload,\n    renderAnnotation,\n    renderBlock,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    handleFocusIndex,\n    renderPreview,\n  ])\n\n  const renderedInput = useMemo(() => renderInput(inputProps), [inputProps, renderInput])\n\n  const fieldProps: Omit<ArrayOfPrimitivesFieldProps, 'renderDefault'> = useMemo(() => {\n    return {\n      actions: fieldActions,\n      name: member.name,\n      index: member.index,\n      level: member.field.level,\n      value: member.field.value,\n      title: member.field.schemaType.title,\n      description: member.field.schemaType.description,\n      collapsible: member.collapsible,\n      collapsed: member.collapsed,\n      onExpand: handleExpand,\n      changed: member.field.changed,\n      onCollapse: handleCollapse,\n      schemaType: member.field.schemaType,\n      inputId: member.field.id,\n      path: member.field.path,\n      presence: member.field.presence,\n      validation: member.field.validation,\n      children: renderedInput,\n      inputProps: inputProps as ArrayOfPrimitivesInputProps,\n    }\n  }, [\n    fieldActions,\n    member.name,\n    member.index,\n    member.field.level,\n    member.field.value,\n    member.field.schemaType,\n    member.field.changed,\n    member.field.id,\n    member.field.path,\n    member.field.presence,\n    member.field.validation,\n    member.collapsible,\n    member.collapsed,\n    handleExpand,\n    handleCollapse,\n    renderedInput,\n    inputProps,\n  ])\n\n  return (\n    <FormCallbacksProvider\n      onFieldGroupSelect={onFieldGroupSelect}\n      onChange={handleChange}\n      onPathOpen={onPathOpen}\n      onSetFieldSetCollapsed={onSetFieldSetCollapsed}\n      onSetPathCollapsed={onSetPathCollapsed}\n      onPathBlur={onPathBlur}\n      onPathFocus={onPathFocus}\n    >\n      {useMemo(() => renderField(fieldProps as FIXME), [fieldProps, renderField])}\n    </FormCallbacksProvider>\n  )\n}\n","import {isArraySchemaType, isObjectSchemaType, isPrimitiveSchemaType} from '@sanity/types'\n\nimport {\n  type ArrayOfObjectsFormNode,\n  type ArrayOfPrimitivesFormNode,\n  type FieldMember,\n  type ObjectFormNode,\n} from '../../../store'\n\nexport function isMemberObject(member: FieldMember): member is FieldMember<ObjectFormNode> {\n  return isObjectSchemaType(member.field.schemaType)\n}\n\nexport function isMemberArrayOfPrimitives(\n  member: FieldMember,\n): member is FieldMember<ArrayOfPrimitivesFormNode> {\n  return (\n    isArraySchemaType(member.field.schemaType) &&\n    member.field.schemaType.of.every((ofType) => isPrimitiveSchemaType(ofType))\n  )\n}\n\nexport function isMemberArrayOfObjects(\n  member: FieldMember,\n): member is FieldMember<ArrayOfObjectsFormNode> {\n  return (\n    isArraySchemaType(member.field.schemaType) &&\n    member.field.schemaType.of.every((ofType) => isObjectSchemaType(ofType))\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {isShallowEmptyObject} from '@sanity/util/content'\nimport {useCallback, useEffect, useMemo, useRef} from 'react'\n\nimport {useDidUpdate} from '../../../hooks/useDidUpdate'\nimport {type PatchArg, PatchEvent, setIfMissing, unset} from '../../../patch'\nimport {applyAll} from '../../../patch/applyPatch'\nimport {type FieldMember, type ObjectFormNode} from '../../../store'\nimport {useDocumentFieldActions} from '../../../studio/contexts/DocumentFieldActions'\nimport {FormCallbacksProvider, useFormCallbacks} from '../../../studio/contexts/FormCallbacks'\nimport {\n  type ArrayOfObjectsInputProps,\n  type ObjectFieldProps,\n  type ObjectInputProps,\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../../types'\nimport {createProtoValue} from '../../../utils/createProtoValue'\nimport {createDescriptionId} from '../../common/createDescriptionId'\n\n/**\n * Responsible for creating inputProps and fieldProps to pass to renderInput and renderField for an object input\n * Note: \"ObjectField\" in this context means an object field of an object type (not \"a field of an object\")\n * @param props - Component props\n */\nexport const ObjectField = function ObjectField(props: {\n  member: FieldMember<ObjectFormNode>\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n}) {\n  const {\n    onPathBlur,\n    onPathFocus,\n    onChange,\n    onPathOpen,\n    onSetPathCollapsed,\n    onSetFieldSetCollapsed,\n    onFieldGroupSelect,\n  } = useFormCallbacks()\n\n  const {\n    member,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n  } = props\n  const fieldActions = useDocumentFieldActions()\n  const focusRef = useRef<{focus: () => void}>()\n  // Keep a local reference to the most recent value. See comment in `handleChange` below for more details\n  const pendingValue = useRef(member.field.value)\n\n  useEffect(() => {\n    // if the props value has changed, then we should update the pending value\n    pendingValue.current = member.field.value\n  }, [member.field.value])\n\n  useDidUpdate(member.field.focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus) {\n      focusRef.current?.focus()\n    }\n  })\n\n  const handleBlur = useCallback(() => {\n    onPathBlur(member.field.path)\n  }, [member.field.path, onPathBlur])\n\n  const handleFocus = useCallback(() => {\n    onPathFocus(member.field.path)\n  }, [member.field.path, onPathFocus])\n\n  const handleFocusChildPath = useCallback(\n    (path: Path) => {\n      onPathFocus(member.field.path.concat(path))\n    },\n    [member.field.path, onPathFocus],\n  )\n\n  const handleChange = useCallback(\n    (event: PatchEvent | PatchArg) => {\n      const isRoot = member.field.path.length === 0\n\n      // this handle touches on more than just object fields, documents included\n      // if we're at a \"document\" level, then we want to have a way to skip the following logic\n      if (!isRoot) {\n        const patches = PatchEvent.from(event).patches\n        // Apply the patch to a local cache of the last received field value from props.\n        // We might receive several calls to `handleChange` synchronously within the same update cycle before React\n        // passes the updated value back through props member.field.value, so we want to check if it's become empty, we can't do that by looking at the stale `props.member.field.value`\n        // Instead we keep updating the local ref/value as we receive the patches\n        pendingValue.current = applyAll(pendingValue.current || {}, patches)\n\n        // if the result after applying the patches is empty, then we should unset the field\n        if (pendingValue.current && isShallowEmptyObject(pendingValue.current)) {\n          onChange(PatchEvent.from(unset([member.name])))\n          return\n        }\n      }\n      // otherwise apply the patch\n      onChange(\n        PatchEvent.from(event)\n          .prepend(setIfMissing(createProtoValue(member.field.schemaType)))\n          .prefixAll(member.name),\n      )\n    },\n    [onChange, member, pendingValue],\n  )\n\n  const handleCollapse = useCallback(() => {\n    onSetPathCollapsed(member.field.path, true)\n  }, [onSetPathCollapsed, member.field.path])\n\n  const handleExpand = useCallback(() => {\n    onSetPathCollapsed(member.field.path, false)\n  }, [onSetPathCollapsed, member.field.path])\n\n  const handleCollapseField = useCallback(\n    (fieldName: string) => {\n      onSetPathCollapsed(member.field.path.concat(fieldName), true)\n    },\n    [onSetPathCollapsed, member.field.path],\n  )\n  const handleExpandField = useCallback(\n    (fieldName: string) => {\n      onSetPathCollapsed(member.field.path.concat(fieldName), false)\n    },\n    [onSetPathCollapsed, member.field.path],\n  )\n  const handleOpenField = useCallback(\n    (fieldName: string) => {\n      onPathOpen(member.field.path.concat(fieldName))\n    },\n    [onPathOpen, member.field.path],\n  )\n  const handleCloseField = useCallback(() => {\n    onPathOpen(member.field.path)\n  }, [onPathOpen, member.field.path])\n  const handleExpandFieldSet = useCallback(\n    (fieldsetName: string) => {\n      onSetFieldSetCollapsed(member.field.path.concat(fieldsetName), false)\n    },\n    [onSetFieldSetCollapsed, member.field.path],\n  )\n  const handleCollapseFieldSet = useCallback(\n    (fieldsetName: string) => {\n      onSetFieldSetCollapsed(member.field.path.concat(fieldsetName), true)\n    },\n    [onSetFieldSetCollapsed, member.field.path],\n  )\n\n  const handleOpen = useCallback(() => {\n    onPathOpen(member.field.path)\n  }, [onPathOpen, member.field.path])\n\n  const handleClose = useCallback(() => {\n    onPathOpen(member.field.path.slice(0, -1))\n  }, [onPathOpen, member.field.path])\n\n  const handleSelectFieldGroup = useCallback(\n    (groupName: string) => {\n      onFieldGroupSelect(member.field.path, groupName)\n    },\n    [onFieldGroupSelect, member.field.path],\n  )\n\n  const elementProps = useMemo(\n    (): ArrayOfObjectsInputProps['elementProps'] => ({\n      onBlur: handleBlur,\n      onFocus: handleFocus,\n      id: member.field.id,\n      ref: focusRef,\n      'aria-describedby': createDescriptionId(member.field.id, member.field.schemaType.description),\n    }),\n    [handleBlur, handleFocus, member.field.id, member.field.schemaType.description],\n  )\n\n  const inputProps = useMemo((): Omit<ObjectInputProps, 'renderDefault'> => {\n    return {\n      elementProps,\n      level: member.field.level,\n      members: member.field.members,\n      value: member.field.value,\n      readOnly: member.field.readOnly,\n      validation: member.field.validation,\n      presence: member.field.presence,\n      schemaType: member.field.schemaType,\n      changed: member.field.changed,\n      id: member.field.id,\n      onFieldGroupSelect: handleSelectFieldGroup,\n      onFieldOpen: handleOpenField,\n      onFieldClose: handleCloseField,\n      onFieldCollapse: handleCollapseField,\n      onFieldExpand: handleExpandField,\n      onFieldSetExpand: handleExpandFieldSet,\n      onFieldSetCollapse: handleCollapseFieldSet,\n      onPathFocus: handleFocusChildPath,\n      path: member.field.path,\n      focusPath: member.field.focusPath,\n      focused: member.field.focused,\n      groups: member.field.groups,\n      onChange: handleChange,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n    }\n  }, [\n    elementProps,\n    member.field.level,\n    member.field.members,\n    member.field.value,\n    member.field.readOnly,\n    member.field.validation,\n    member.field.presence,\n    member.field.schemaType,\n    member.field.changed,\n    member.field.id,\n    member.field.path,\n    member.field.focusPath,\n    member.field.focused,\n    member.field.groups,\n    handleSelectFieldGroup,\n    handleOpenField,\n    handleCloseField,\n    handleCollapseField,\n    handleExpandField,\n    handleExpandFieldSet,\n    handleCollapseFieldSet,\n    handleFocusChildPath,\n    handleChange,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n  ])\n\n  const renderedInput = useMemo(() => renderInput(inputProps), [inputProps, renderInput])\n\n  const fieldProps = useMemo((): Omit<ObjectFieldProps, 'renderDefault'> => {\n    return {\n      actions: fieldActions,\n      name: member.name,\n      index: member.index,\n      level: member.field.level,\n      value: member.field.value,\n      validation: member.field.validation,\n      presence: member.field.presence,\n      title: member.field.schemaType.title,\n      description: member.field.schemaType.description,\n\n      collapsible: member.collapsible,\n      collapsed: member.collapsed,\n      onCollapse: handleCollapse,\n      onExpand: handleExpand,\n\n      open: member.open,\n      changed: member.field.changed,\n\n      onOpen: handleOpen,\n      onClose: handleClose,\n\n      schemaType: member.field.schemaType,\n      inputId: member.field.id,\n      path: member.field.path,\n      children: renderedInput,\n      inputProps: inputProps as ObjectInputProps,\n    }\n  }, [\n    fieldActions,\n    member.name,\n    member.index,\n    member.field.level,\n    member.field.value,\n    member.field.validation,\n    member.field.presence,\n    member.field.schemaType,\n    member.field.changed,\n    member.field.id,\n    member.field.path,\n    member.collapsible,\n    member.collapsed,\n    member.open,\n    handleCollapse,\n    handleExpand,\n    handleOpen,\n    handleClose,\n    renderedInput,\n    inputProps,\n  ])\n\n  return (\n    <FormCallbacksProvider\n      onFieldGroupSelect={onFieldGroupSelect}\n      onChange={handleChange}\n      onSetFieldSetCollapsed={onSetFieldSetCollapsed}\n      onPathOpen={onPathOpen}\n      onSetPathCollapsed={onSetPathCollapsed}\n      onPathBlur={onPathBlur}\n      onPathFocus={onPathFocus}\n    >\n      {useMemo(() => renderField(fieldProps), [fieldProps, renderField])}\n    </FormCallbacksProvider>\n  )\n}\n","import {isBooleanSchemaType, isNumberSchemaType} from '@sanity/types'\nimport {type ChangeEvent, useCallback, useEffect, useMemo, useRef, useState} from 'react'\n\nimport {type FormPatch, PatchEvent, set, unset} from '../../../patch'\nimport {type FieldMember} from '../../../store'\nimport {useDocumentFieldActions} from '../../../studio/contexts/DocumentFieldActions'\nimport {useFormCallbacks} from '../../../studio/contexts/FormCallbacks'\nimport {\n  type PrimitiveFieldProps,\n  type PrimitiveInputProps,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n} from '../../../types'\nimport {createDescriptionId} from '../../common/createDescriptionId'\nimport {resolveNativeNumberInputValue} from '../../common/resolveNativeNumberInputValue'\n\n/**\n * Responsible for creating inputProps and fieldProps to pass to renderInput and renderField for a primitive field/input\n * @param props - Component props\n *\n * @internal\n */\nexport function PrimitiveField(props: {\n  member: FieldMember\n  renderInput: RenderInputCallback<PrimitiveInputProps>\n  renderField: RenderFieldCallback<PrimitiveFieldProps>\n}) {\n  const {member, renderInput, renderField} = props\n\n  const fieldActions = useDocumentFieldActions()\n\n  const focusRef = useRef<{focus: () => void}>()\n\n  const [localValue, setLocalValue] = useState<string | undefined>()\n\n  const {onPathBlur, onPathFocus, onChange} = useFormCallbacks()\n\n  useEffect(() => {\n    if (member.field.focused) {\n      focusRef.current?.focus()\n    }\n  }, [member.field.focused])\n\n  const handleBlur = useCallback(() => {\n    onPathBlur(member.field.path)\n  }, [member.field.path, onPathBlur])\n\n  const handleFocus = useCallback(() => {\n    onPathFocus(member.field.path)\n  }, [member.field.path, onPathFocus])\n\n  const handleChange = useCallback(\n    (event: FormPatch | FormPatch[] | PatchEvent) => {\n      onChange(PatchEvent.from(event).prefixAll(member.name))\n    },\n    [onChange, member.name],\n  )\n\n  const handleNativeChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      let inputValue: number | string | boolean = event.currentTarget.value\n      if (isNumberSchemaType(member.field.schemaType)) {\n        inputValue = event.currentTarget.valueAsNumber\n        if (inputValue > Number.MAX_SAFE_INTEGER || inputValue < Number.MIN_SAFE_INTEGER) {\n          return\n        }\n      } else if (isBooleanSchemaType(member.field.schemaType)) {\n        inputValue = event.currentTarget.checked\n      }\n\n      // `valueAsNumber` returns `NaN` on empty input\n      const hasEmptyValue =\n        inputValue === '' || (typeof inputValue === 'number' && isNaN(inputValue))\n\n      if (isNumberSchemaType(member.field.schemaType)) {\n        // Store the local value for number inputs in order to support intermediate values\n        // that includes more information than the numeric value\n        // E.g. if typing `0.0` the numeric value will be 0, but we still want to show `0.0` in the input to allow typing\n        // more digits\n        setLocalValue(hasEmptyValue ? undefined : event.currentTarget.value)\n      }\n\n      onChange(PatchEvent.from(hasEmptyValue ? unset() : set(inputValue)).prefixAll(member.name))\n    },\n    [member.name, member.field.schemaType, onChange],\n  )\n\n  const validationError =\n    useMemo(\n      () =>\n        member.field.validation\n          .filter((item) => item.level === 'error')\n          .map((item) => item.message)\n          .join('\\n'),\n      [member.field.validation],\n    ) || undefined\n\n  const elementProps = useMemo(\n    (): PrimitiveInputProps['elementProps'] => ({\n      onBlur: handleBlur,\n      onFocus: handleFocus,\n      id: member.field.id,\n      ref: focusRef,\n      onChange: handleNativeChange,\n      value: resolveNativeNumberInputValue(member.field.schemaType, member.field.value, localValue),\n      readOnly: Boolean(member.field.readOnly),\n      placeholder: member.field.schemaType.placeholder,\n      'aria-describedby': createDescriptionId(member.field.id, member.field.schemaType.description),\n    }),\n    [\n      handleBlur,\n      handleFocus,\n      handleNativeChange,\n      member.field.id,\n      member.field.readOnly,\n      member.field.schemaType,\n      member.field.value,\n      localValue,\n    ],\n  )\n\n  const inputProps = useMemo((): Omit<PrimitiveInputProps, 'renderDefault'> => {\n    return {\n      value: member.field.value as any,\n      readOnly: member.field.readOnly,\n      schemaType: member.field.schemaType as any,\n      changed: member.field.changed,\n      id: member.field.id,\n      path: member.field.path,\n      focused: member.field.focused,\n      level: member.field.level,\n      onChange: handleChange,\n      validation: member.field.validation,\n      presence: member.field.presence,\n      validationError,\n      elementProps,\n    }\n  }, [\n    member.field.value,\n    member.field.readOnly,\n    member.field.schemaType,\n    member.field.changed,\n    member.field.id,\n    member.field.path,\n    member.field.focused,\n    member.field.level,\n    member.field.validation,\n    member.field.presence,\n    handleChange,\n    validationError,\n    elementProps,\n  ])\n\n  const renderedInput = useMemo(() => renderInput(inputProps), [inputProps, renderInput])\n\n  const fieldProps = useMemo((): Omit<PrimitiveFieldProps, 'renderDefault'> => {\n    return {\n      actions: fieldActions,\n      changed: member.field.changed,\n      children: renderedInput,\n      description: member.field.schemaType.description,\n      index: member.index,\n      inputId: member.field.id,\n      inputProps: inputProps as any,\n      level: member.field.level,\n      name: member.name,\n      path: member.field.path,\n      presence: member.field.presence,\n      schemaType: member.field.schemaType as any,\n      title: member.field.schemaType.title,\n      validation: member.field.validation,\n      value: member.field.value as any,\n    }\n  }, [\n    fieldActions,\n    member.field.level,\n    member.field.value,\n    member.field.schemaType,\n    member.field.id,\n    member.field.path,\n    member.field.validation,\n    member.field.presence,\n    member.field.changed,\n    member.name,\n    member.index,\n    renderedInput,\n    inputProps,\n  ])\n\n  return <>{renderField(fieldProps)}</>\n}\n","import {memo} from 'react'\n\nimport {type FIXME} from '../../../FIXME'\nimport {type FieldMember} from '../../store'\nimport {\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../types'\nimport {ArrayOfObjectsField} from './fields/ArrayOfObjectsField'\nimport {ArrayOfPrimitivesField} from './fields/ArrayOfPrimitivesField'\nimport {isMemberArrayOfObjects, isMemberArrayOfPrimitives, isMemberObject} from './fields/asserters'\nimport {ObjectField} from './fields/ObjectField'\nimport {PrimitiveField} from './fields/PrimitiveField'\n\n/** @internal */\nexport interface MemberFieldProps {\n  member: FieldMember\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n}\n\n/** @internal */\nexport const MemberField = memo(function MemberField(props: MemberFieldProps) {\n  const {\n    member,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n  } = props\n\n  if (isMemberObject(member)) {\n    // this field is of an object type\n    return (\n      <ObjectField\n        member={member}\n        renderAnnotation={renderAnnotation}\n        renderBlock={renderBlock}\n        renderField={renderField}\n        renderInlineBlock={renderInlineBlock}\n        renderInput={renderInput}\n        renderItem={renderItem}\n        renderPreview={renderPreview}\n      />\n    )\n  }\n\n  if (isMemberArrayOfPrimitives(member)) {\n    return (\n      <ArrayOfPrimitivesField\n        member={member}\n        renderAnnotation={renderAnnotation}\n        renderBlock={renderBlock}\n        renderField={renderField}\n        renderInput={renderInput}\n        renderInlineBlock={renderInlineBlock}\n        // todo: these have different signatures, so renderItem for a primitive input should not be the same as renderItem in array of object inputs\n        renderItem={renderItem as FIXME}\n        renderPreview={renderPreview}\n      />\n    )\n  }\n\n  if (isMemberArrayOfObjects(member)) {\n    return (\n      <ArrayOfObjectsField\n        member={member}\n        renderAnnotation={renderAnnotation}\n        renderBlock={renderBlock}\n        renderField={renderField}\n        renderInlineBlock={renderInlineBlock}\n        renderInput={renderInput}\n        renderItem={renderItem}\n        renderPreview={renderPreview}\n      />\n    )\n  }\n\n  return <PrimitiveField member={member} renderField={renderField} renderInput={renderInput} />\n})\n","import {ErrorOutlineIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Text} from '@sanity/ui'\nimport {type ComponentProps, type ReactNode} from 'react'\nimport styled from 'styled-components'\n\ninterface AlertProps extends Omit<ComponentProps<typeof Card>, 'title'> {\n  title: ReactNode\n  status?: 'warning' | 'error'\n  suffix?: ReactNode\n}\n\nconst STATUS_TONES = {\n  warning: 'caution',\n  error: 'critical',\n} as const\n\nconst SuffixBox = styled(Box)`\n  border-top: 1px solid var(--card-border-color);\n`\n\nexport function Alert(props: AlertProps) {\n  const {children, status = 'warning', suffix, title, ...rest} = props\n\n  return (\n    <Card radius={2} tone={STATUS_TONES[status]} {...rest} data-ui=\"Alert\">\n      <Flex padding={4}>\n        <Box>\n          <Text size={1}>\n            {status === 'warning' && <WarningOutlineIcon />}\n            {status === 'error' && <ErrorOutlineIcon />}\n          </Text>\n        </Box>\n\n        <Box flex={1} marginLeft={3}>\n          <Text size={1} weight=\"medium\">\n            {title}\n          </Text>\n\n          {children && <Box marginTop={3}>{children}</Box>}\n        </Box>\n      </Flex>\n\n      {suffix && <SuffixBox>{suffix}</SuffixBox>}\n    </Card>\n  )\n}\n","import {ToggleArrowRightIcon} from '@sanity/icons'\nimport {Box, Flex, Inline, Text} from '@sanity/ui'\nimport {type ReactNode, useCallback, useEffect, useState} from 'react'\nimport styled from 'styled-components'\n\ninterface DetailsProps {\n  children?: ReactNode\n  margin?: number | number[]\n  marginX?: number | number[]\n  marginY?: number | number[]\n  marginTop?: number | number[]\n  marginRight?: number | number[]\n  marginBottom?: number | number[]\n  marginLeft?: number | number[]\n  open?: boolean\n  icon?: ReactNode\n  title?: ReactNode\n}\n\nconst HeaderButton = styled.button`\n  display: block;\n  -webkit-font-smoothing: inherit;\n  appearance: none;\n  font: inherit;\n  background: none;\n  width: 100%;\n  text-align: left;\n  border: 0;\n  margin: 0;\n  padding: 0;\n  outline: none;\n`\n\nconst ToggleArrow = styled(ToggleArrowRightIcon)<{open: boolean}>`\n  transform: ${(props) => (props.open ? 'rotate(90deg)' : '')};\n`\n\nconst Header = styled(Flex)`\n  cursor: default;\n`\n\nconst IconBox = styled(Box)`\n  & > div > svg {\n    transform: rotate(0);\n    transition: transform 100ms;\n  }\n\n  &[data-open] > div > svg {\n    transform: rotate(90deg);\n  }\n`\n\nexport function Details(props: DetailsProps) {\n  const {children, open: openProp, icon, title = 'Details', ...restProps} = props\n  const [open, setOpen] = useState(openProp || false)\n\n  const handleToggle = useCallback(() => setOpen((v) => !v), [])\n\n  useEffect(() => setOpen(openProp || false), [openProp])\n\n  return (\n    <Box {...restProps}>\n      <HeaderButton type=\"button\" onClick={handleToggle}>\n        <Header align=\"center\">\n          <Inline>\n            <IconBox data-open={open ? '' : undefined}>\n              <Text size={1}>\n                <ToggleArrow open={open} />\n              </Text>\n            </IconBox>\n            {icon && <Box marginLeft={1}>{icon}</Box>}\n            <Box flex={1} marginLeft={1}>\n              <Text size={1} weight=\"medium\">\n                {title}\n              </Text>\n            </Box>\n          </Inline>\n        </Header>\n      </HeaderButton>\n\n      <Box hidden={!open} marginTop={3}>\n        {children}\n      </Box>\n    </Box>\n  )\n}\n","import isValidDate from 'date-fns/isValid'\n\nconst TRUTHY_STRINGS = ['yes', 'true', '1']\nconst FALSEY_STRINGS = ['false', 'no', 'false', '0', 'null']\nconst BOOL_STRINGS = TRUTHY_STRINGS.concat(FALSEY_STRINGS)\n\nconst TRUE = (): true => true\n\nconst has = (prop: string) => (val?: Record<string, any>) => val && val[prop]\nconst is = (typeName: string) => (val?: Record<string, any>) => (val && val._type) === typeName\n\nfunction toLocalDate(input: Date) {\n  const newDate = new Date(input.getTime() + input.getTimezoneOffset() * 60 * 1000)\n  const offset = input.getTimezoneOffset() / 60\n  const hours = input.getHours()\n  newDate.setHours(hours - offset)\n  return newDate\n}\n\nfunction getTZName() {\n  try {\n    return Intl.DateTimeFormat().resolvedOptions().timeZone\n  } catch (e) {} // eslint-disable-line no-empty\n  return null\n}\n\nexport interface ValueConverter {\n  test: NumberConstructor | ((value: any) => boolean)\n  convert:\n    | NumberConstructor\n    | StringConstructor\n    | ((value: any) => boolean | Record<string, any> | string)\n}\n\nexport const converters: {[fromType: string]: {[toType: string]: ValueConverter}} = {\n  string: {\n    number: {\n      test: Number,\n      convert: Number,\n    },\n    boolean: {\n      test: (value: any) => BOOL_STRINGS.includes(value.toLowerCase()),\n      convert: (value: any) =>\n        TRUTHY_STRINGS.includes(value.toLowerCase()) ||\n        !FALSEY_STRINGS.includes(value.toLowerCase()),\n    },\n    richDate: {\n      test: (value: any) => isValidDate(value),\n      convert: (value: any): Record<string, any> => {\n        return {\n          _type: 'richDate',\n          local: toLocalDate(new Date(value)).toJSON(),\n          utc: new Date(value).toJSON(),\n          timezone: getTZName(),\n          offset: new Date().getTimezoneOffset(),\n        }\n      },\n    },\n  },\n  date: {\n    richDate: {\n      test: is('date'),\n      convert: (value: any) => Object.assign({}, value, {_type: 'richDate'}),\n    },\n  },\n  richDate: {\n    datetime: {\n      test: has('utc'),\n      convert: (value: any) => value.utc,\n    },\n  },\n  number: {\n    string: {\n      test: TRUE,\n      convert: String,\n    },\n    boolean: {\n      test: TRUE,\n      convert: Number,\n    },\n  },\n  boolean: {\n    string: {\n      test: TRUE,\n      convert: (value: any) => (value ? 'Yes' : 'No'),\n    },\n    number: {\n      test: TRUE,\n      convert: Number,\n    },\n  },\n}\n","import {Card, Code, Grid, Stack, Text} from '@sanity/ui'\nimport {useCallback, useMemo} from 'react'\n\nimport {Button} from '../../../../ui-components'\nimport {isDev} from '../../../environment'\nimport {useSchema} from '../../../hooks'\nimport {Translate, useTranslation} from '../../../i18n'\nimport {Alert} from '../../components/Alert'\nimport {Details} from '../../components/Details'\nimport {PatchEvent, setIfMissing, unset} from '../../patch'\n\ninterface UntypedValueInputProps {\n  validTypes: string[]\n  value: Record<string, unknown>\n  onChange: (event: PatchEvent, value?: Record<string, unknown>) => void\n}\n\nfunction SetMissingTypeButton({\n  value,\n  targetType,\n  onChange,\n}: {\n  value: Record<string, unknown>\n  targetType: string\n  onChange: UntypedValueInputProps['onChange']\n}) {\n  const itemValue = useMemo(() => ({...value, _type: targetType}), [targetType, value])\n\n  const handleClick = useCallback(\n    () => onChange(PatchEvent.from(setIfMissing(targetType, ['_type'])), itemValue),\n    [itemValue, onChange, targetType],\n  )\n\n  const {t} = useTranslation()\n\n  return (\n    <Button\n      onClick={handleClick}\n      text={t('inputs.untyped-value.convert-button.text', {\n        targetType: targetType,\n      })}\n    />\n  )\n}\n\nfunction UnsetItemButton({\n  value,\n  onChange,\n  validTypes,\n}: {\n  value: Record<string, unknown>\n  validTypes: string[]\n  onChange: UntypedValueInputProps['onChange']\n}) {\n  // Doesn't matter which `_type` we use as long as it's allowed by the array\n  const itemValue = useMemo(() => ({...value, _type: validTypes[0]}), [validTypes, value])\n\n  const handleClick = useCallback(\n    () => onChange(PatchEvent.from(unset()), itemValue),\n    [itemValue, onChange],\n  )\n\n  const {t} = useTranslation()\n\n  return (\n    <Button\n      onClick={handleClick}\n      tone=\"critical\"\n      text={t('inputs.untyped-value.unset-item-button.text')}\n    />\n  )\n}\n\n/**\n * When the value does not have an `_type` property,\n * but the schema has a named type\n */\nexport function UntypedValueInput({validTypes, value, onChange}: UntypedValueInputProps) {\n  const schema = useSchema()\n  const isSingleValidType = validTypes.length === 1\n  const isHoistedType = schema.has(validTypes[0])\n\n  const {t} = useTranslation()\n\n  return (\n    <Alert\n      status=\"warning\"\n      title={\n        <>\n          <Translate t={t} i18nKey=\"inputs.untyped-value.title\" />\n        </>\n      }\n    >\n      <Details open={isDev} title={t('inputs.untyped-value.details.title')}>\n        <Stack space={3}>\n          <Text as=\"p\" muted size={1}>\n            <Translate t={t} i18nKey=\"inputs.untyped-value.description\" />\n          </Text>\n\n          {isSingleValidType && !isHoistedType && (\n            <Text as=\"p\" muted size={1}>\n              <Translate t={t} i18nKey=\"inputs.untyped-value.details.description\" />\n            </Text>\n          )}\n\n          {!isSingleValidType && (\n            <Text as=\"p\" muted size={1}>\n              {t('inputs.untyped-value.details.multi-type-description')}\n            </Text>\n          )}\n\n          {!isSingleValidType && (\n            <Stack as=\"ul\" space={2}>\n              {validTypes.map((validType) => (\n                <Text as=\"li\" key={validType} muted size={1}>\n                  <code>{validType}</code>\n                </Text>\n              ))}\n            </Stack>\n          )}\n\n          <Stack space={2}>\n            <Text as=\"h4\" weight=\"medium\" size={1}>\n              {t('inputs.untyped-value.details.json-dump-prefix')}\n            </Text>\n\n            <Card border overflow=\"auto\" padding={2} radius={2} tone=\"inherit\">\n              <Code language=\"json\">{JSON.stringify(value, null, 2)}</Code>\n            </Card>\n          </Stack>\n\n          <Grid columns={[1, 2, 2]} gap={1}>\n            {isSingleValidType && (\n              <SetMissingTypeButton onChange={onChange} targetType={validTypes[0]} value={value} />\n            )}\n\n            <UnsetItemButton onChange={onChange} validTypes={validTypes} value={value} />\n          </Grid>\n        </Stack>\n      </Details>\n    </Alert>\n  )\n}\n","import {Card, Code, Stack, Text} from '@sanity/ui'\nimport {isPlainObject} from 'lodash'\nimport {forwardRef, type Ref, useCallback, useImperativeHandle, useMemo} from 'react'\n\nimport {Button} from '../../../../ui-components'\nimport {isDev} from '../../../environment'\nimport {Translate, useTranslation} from '../../../i18n'\nimport {Alert} from '../../components/Alert'\nimport {Details} from '../../components/Details'\nimport {PatchEvent, set, unset} from '../../patch'\nimport {converters as CONVERTERS, type ValueConverter} from './converters'\nimport {UntypedValueInput} from './UntypedValueInput'\n\ninterface Converter extends ValueConverter {\n  from: string\n  to: string\n}\n\nfunction getConverters(value: unknown, actualType: string, validTypes: string[]): Converter[] {\n  if (!(actualType in CONVERTERS)) {\n    return []\n  }\n\n  return Object.keys(CONVERTERS[actualType])\n    .filter((targetType) => validTypes.includes(targetType))\n    .map((targetType) => ({\n      from: actualType,\n      to: targetType,\n      ...CONVERTERS[actualType][targetType],\n    }))\n    .filter((converter) => converter.test(value))\n}\n\ninterface InvalidValueProps {\n  actualType: string\n  validTypes: string[]\n  value?: unknown\n  onChange: (event: PatchEvent) => void\n}\n\nexport const InvalidValueInput = forwardRef(\n  (props: InvalidValueProps, ref: Ref<{focus: () => void}>) => {\n    const {value, actualType, validTypes, onChange} = props\n\n    useImperativeHandle(ref, () => ({\n      // @todo\n      focus: () => undefined,\n    }))\n\n    const handleClearClick = useCallback(() => {\n      onChange(PatchEvent.from(unset()))\n    }, [onChange])\n\n    const handleConvertTo = useCallback(\n      (converted: any) => {\n        onChange(PatchEvent.from(set(converted)))\n      },\n      [onChange],\n    )\n\n    const converters = useMemo(\n      () => getConverters(value, actualType, validTypes),\n      [value, actualType, validTypes],\n    )\n\n    const {t} = useTranslation()\n\n    if (isPlainObject(value) && !('_type' in (value as object))) {\n      return (\n        <UntypedValueInput\n          value={value as Record<string, unknown>}\n          validTypes={validTypes}\n          onChange={onChange}\n        />\n      )\n    }\n\n    const suffix = (\n      <Stack padding={2}>\n        <Button\n          onClick={handleClearClick}\n          tone=\"critical\"\n          text={t('inputs.invalid-value.reset-button.text')}\n        />\n      </Stack>\n    )\n\n    return (\n      <Alert status=\"error\" suffix={suffix} title={t('inputs.invalid-value.title')}>\n        <Text as=\"p\" muted size={1}>\n          {t('inputs.invalid-value.description')}\n        </Text>\n\n        <Details marginTop={4} open={isDev} title={t('inputs.invalid-value.details.title')}>\n          <Stack space={3}>\n            {validTypes.length === 1 && (\n              <Text as=\"p\" muted size={1}>\n                <Translate\n                  t={t}\n                  i18nKey=\"inputs.invalid-value.details.description\"\n                  values={{\n                    validType: validTypes[0],\n                  }}\n                />\n              </Text>\n            )}\n\n            {validTypes.length === 1 && (\n              <Text as=\"p\" muted size={1}>\n                {t('inputs.invalid-value.details.possible-reason')}\n              </Text>\n            )}\n\n            {validTypes.length !== 1 && (\n              <Text as=\"p\" muted size={1}>\n                {t('inputs.invalid-value.details.multi-type-description')}\n              </Text>\n            )}\n\n            {validTypes.length !== 1 && (\n              <Stack as=\"ul\" space={2}>\n                {validTypes.map((validType) => (\n                  <Text as=\"li\" key={validType}>\n                    <code>{validType}</code>\n                  </Text>\n                ))}\n              </Stack>\n            )}\n\n            <Stack marginTop={2} space={2}>\n              <Text size={1} weight=\"medium\">\n                <Translate\n                  t={t}\n                  i18nKey=\"inputs.invalid-value.current-type\"\n                  values={{\n                    actualType: actualType,\n                  }}\n                />\n              </Text>\n\n              <Card border padding={2} radius={2} tone=\"inherit\">\n                <Code language=\"json\" size={1}>\n                  {JSON.stringify(value, null, 2)}\n                </Code>\n              </Card>\n            </Stack>\n\n            {converters.length > 0 && (\n              <Stack space={1}>\n                {converters.map((converter) => (\n                  <ConvertButton\n                    converter={converter}\n                    key={`${converter.from}-${converter.to}`}\n                    onConvert={handleConvertTo}\n                    value={value}\n                  />\n                ))}\n              </Stack>\n            )}\n          </Stack>\n        </Details>\n      </Alert>\n    )\n  },\n)\n\nInvalidValueInput.displayName = 'InvalidValueInput'\n\nfunction ConvertButton({\n  converter,\n  onConvert,\n  value,\n}: {\n  converter: Converter\n  onConvert: (v: string | number | boolean | Record<string, unknown>) => void\n  value: unknown\n}) {\n  const handleClick = useCallback(\n    () => onConvert(converter.convert(value)),\n    [converter, onConvert, value],\n  )\n\n  const {t} = useTranslation()\n\n  return (\n    <Button\n      onClick={handleClick}\n      text={t('inputs.invalid-value.convert-button.text', {targetType: converter.to})}\n    />\n  )\n}\n","import {Stack, Text} from '@sanity/ui'\nimport {useCallback} from 'react'\n\nimport {Button} from '../../../../../ui-components'\nimport {isDev} from '../../../../environment'\nimport {Translate, useTranslation} from '../../../../i18n'\nimport {Alert} from '../../../components/Alert'\nimport {Details} from '../../../components/Details'\nimport {FormField} from '../../../components/formField'\nimport {PatchEvent, set} from '../../../patch'\nimport {type DuplicateKeysError} from '../../../store/types/memberErrors'\n\ninterface Props {\n  error: DuplicateKeysError\n  onChange: (patchEvent: PatchEvent) => void\n}\n\nexport function DuplicateKeysAlert(props: Props) {\n  const {error, onChange} = props\n\n  const handleFixDuplicateKeys = useCallback(() => {\n    onChange(\n      PatchEvent.from(\n        (error.duplicates || []).map(([index, key]) =>\n          set(`${key}_deduped_${index}`, [index, '_key']),\n        ),\n      ),\n    )\n  }, [error.duplicates, onChange])\n\n  const {t} = useTranslation()\n\n  return (\n    <FormField title={error.schemaType.title} description={error.schemaType.description}>\n      <Alert\n        status=\"warning\"\n        suffix={\n          <Stack padding={2}>\n            <Button\n              onClick={handleFixDuplicateKeys}\n              text={t('form.error.duplicate-keys-alert.generate-button.text')}\n              tone=\"caution\"\n            />\n          </Stack>\n        }\n        title={t('form.error.duplicate-keys-alert.title')}\n      >\n        <Text as=\"p\" muted size={1}>\n          {t('form.error.duplicate-keys-alert.summary')}\n        </Text>\n\n        <Details\n          marginTop={4}\n          open={isDev}\n          title={t('form.error.duplicate-keys-alert.details.title')}\n        >\n          <Stack space={3}>\n            <Text as=\"p\" muted size={1}>\n              <Translate t={t} i18nKey=\"form.error.duplicate-keys-alert.details.description\" />\n            </Text>\n\n            <Text as=\"p\" muted size={1}>\n              <Translate\n                t={t}\n                i18nKey=\"form.error.duplicate-keys-alert.details.additional-description\"\n              />\n            </Text>\n          </Stack>\n          {/* TODO: render array items and highlight the items with duplicate keys (sc-26255) */}\n        </Details>\n      </Alert>\n    </FormField>\n  )\n}\n","import {Stack, Text} from '@sanity/ui'\nimport {randomKey} from '@sanity/util/content'\nimport {useCallback} from 'react'\n\nimport {Button} from '../../../../../ui-components'\nimport {isDev} from '../../../../environment'\nimport {Translate, useTranslation} from '../../../../i18n'\nimport {Alert} from '../../../components/Alert'\nimport {Details} from '../../../components/Details'\nimport {FormField} from '../../../components/formField'\nimport {PatchEvent, setIfMissing} from '../../../patch'\nimport {type MissingKeysError} from '../../../store/types/memberErrors'\n\ninterface Props {\n  error: MissingKeysError\n  onChange: (patchEvent: PatchEvent) => void\n}\n\nexport function MissingKeysAlert(props: Props) {\n  const {error, onChange} = props\n  const handleFixMissingKeys = useCallback(() => {\n    onChange(\n      PatchEvent.from((error.value || []).map((val, i) => setIfMissing(randomKey(), [i, '_key']))),\n    )\n  }, [error.value, onChange])\n\n  const {t} = useTranslation()\n\n  return (\n    <FormField title={error.schemaType.title} description={error.schemaType.description}>\n      <Alert\n        status=\"warning\"\n        suffix={\n          <Stack padding={2}>\n            <Button\n              onClick={handleFixMissingKeys}\n              text={t('form.error.missing-keys-alert.add-button.text')}\n              tone=\"caution\"\n            />\n          </Stack>\n        }\n        title={t('form.error.missing-keys-alert.title')}\n      >\n        <Text as=\"p\" muted size={1}>\n          {t('form.error.missing-keys-alert.summary')}\n        </Text>\n\n        <Details\n          marginTop={4}\n          open={isDev}\n          title={t('form.error.missing-keys-alert.details.title')}\n        >\n          <Stack space={3}>\n            <Text as=\"p\" muted size={1}>\n              <Translate t={t} i18nKey=\"form.error.missing-keys-alert.details.description\" />\n            </Text>\n\n            <Text as=\"p\" muted size={1}>\n              <Translate\n                t={t}\n                i18nKey=\"form.error.missing-keys-alert.details.additional-description\"\n              />\n            </Text>\n          </Stack>\n        </Details>\n        {/* TODO: render array items and highlight the items with missing key */}\n      </Alert>\n    </FormField>\n  )\n}\n","import {Stack, Text} from '@sanity/ui'\nimport {isPlainObject} from 'lodash'\n\nimport {Button} from '../../../../../ui-components'\nimport {isDev} from '../../../../environment'\nimport {useTranslation} from '../../../../i18n'\nimport {Alert} from '../../../components/Alert'\nimport {Details} from '../../../components/Details'\nimport {FormField} from '../../../components/formField'\nimport {PatchEvent, unset} from '../../../patch'\nimport {type MixedArrayError} from '../../../store'\n\ninterface Props {\n  error: MixedArrayError\n  onChange: (patchEvent: PatchEvent) => void\n}\nexport function MixedArrayAlert(props: Props) {\n  const {error, onChange} = props\n\n  const handleRemoveNonObjectValues = () => {\n    const nonObjectIndices = (error.value || [])\n      .flatMap((item, index) => (isPlainObject(item) ? [] : [index]))\n      .reverse()\n\n    const patches = nonObjectIndices.map((index) => unset([index]))\n\n    onChange(PatchEvent.from(patches))\n  }\n\n  const {t} = useTranslation()\n\n  return (\n    <FormField title={error.schemaType.title} description={error.schemaType.description}>\n      <Alert\n        status=\"error\"\n        suffix={\n          <Stack padding={2}>\n            <Button\n              onClick={handleRemoveNonObjectValues}\n              text={t('form.error.mixed-array-alert.remove-button.text')}\n              tone=\"critical\"\n            />\n          </Stack>\n        }\n        title={t('form.error.mixed-array-alert.title')}\n      >\n        <Text as=\"p\" muted size={1}>\n          {t('form.error.mixed-array-alert.summary')}\n        </Text>\n\n        <Details marginTop={4} open={isDev} title={t('form.error.mixed-array-alert.details.title')}>\n          <Stack space={3}>\n            <Text as=\"p\" muted size={1}>\n              {t('form.error.mixed-array-alert.details.description')}\n            </Text>\n          </Stack>\n          {/* TODO: render array items and highlight the wrong items (sc-26255) */}\n        </Details>\n      </Alert>\n    </FormField>\n  )\n}\n","import {Box} from '@sanity/ui'\nimport {useCallback} from 'react'\n\nimport {useTranslation} from '../../../i18n'\nimport {InvalidValueInput} from '../../inputs/InvalidValueInput'\nimport {PatchEvent} from '../../patch'\nimport {type FieldError} from '../../store/types/memberErrors'\nimport {useFormCallbacks} from '../../studio/contexts/FormCallbacks'\nimport {DuplicateKeysAlert} from './errors/DuplicateKeysAlert'\nimport {MissingKeysAlert} from './errors/MissingKeysAlert'\nimport {MixedArrayAlert} from './errors/MixedArrayAlert'\n\n/** @internal */\nexport function MemberFieldError(props: {member: FieldError}) {\n  const {member} = props\n  const {onChange} = useFormCallbacks()\n\n  const handleChange = useCallback(\n    (event: PatchEvent) => {\n      onChange(PatchEvent.from(event).prefixAll(member.fieldName))\n    },\n    [onChange, member.fieldName],\n  )\n\n  const {t} = useTranslation()\n\n  if (member.error.type === 'INCOMPATIBLE_TYPE') {\n    return (\n      <InvalidValueInput\n        value={member.error.value}\n        onChange={handleChange}\n        actualType={member.error.resolvedValueType}\n        validTypes={[member.error.expectedSchemaType.name]}\n      />\n    )\n  }\n  if (member.error.type === 'MISSING_KEYS') {\n    return <MissingKeysAlert error={member.error} onChange={handleChange} />\n  }\n  if (member.error.type === 'DUPLICATE_KEYS') {\n    return <DuplicateKeysAlert error={member.error} onChange={handleChange} />\n  }\n  if (member.error.type === 'MIXED_ARRAY') {\n    return <MixedArrayAlert onChange={handleChange} error={member.error} />\n  }\n  return <Box>{t('member-field-error.unexpected-error', {error: props.member.error.type})}</Box>\n}\n","import {capitalize} from 'lodash'\nimport {memo, useCallback} from 'react'\n\nimport {FormFieldSet} from '../../components/formField'\nimport {type FieldSetMember} from '../../store'\nimport {useFormCallbacks} from '../../studio/contexts/FormCallbacks'\nimport {\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../types'\nimport {MemberField} from './MemberField'\nimport {MemberFieldError} from './MemberFieldError'\n\n/** @internal */\nexport const MemberFieldSet = memo(function MemberFieldSet(props: {\n  member: FieldSetMember\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n}) {\n  const {\n    member,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n  } = props\n\n  const {onSetFieldSetCollapsed} = useFormCallbacks()\n\n  const handleCollapse = useCallback(() => {\n    onSetFieldSetCollapsed(member.fieldSet.path, true)\n  }, [member.fieldSet.path, onSetFieldSetCollapsed])\n\n  const handleExpand = useCallback(() => {\n    onSetFieldSetCollapsed(member.fieldSet.path, false)\n  }, [member.fieldSet.path, onSetFieldSetCollapsed])\n\n  return (\n    <FormFieldSet\n      title={member.fieldSet.title || capitalize(member.fieldSet.name)}\n      description={member.fieldSet.description}\n      level={member.fieldSet.level}\n      collapsible={member.fieldSet.collapsible}\n      collapsed={member.fieldSet.collapsed}\n      onCollapse={handleCollapse}\n      onExpand={handleExpand}\n      columns={member?.fieldSet?.columns}\n      data-testid={`fieldset-${member.fieldSet.name}`}\n      inputId={member.fieldSet.name}\n    >\n      {member.fieldSet.members.map((fieldsetMember) => {\n        if (fieldsetMember.kind === 'error') {\n          return <MemberFieldError key={member.key} member={fieldsetMember} />\n        }\n        return (\n          <MemberField\n            member={fieldsetMember}\n            renderAnnotation={renderAnnotation}\n            renderBlock={renderBlock}\n            renderField={renderField}\n            renderInlineBlock={renderInlineBlock}\n            renderInput={renderInput}\n            renderItem={renderItem}\n            renderPreview={renderPreview}\n            key={fieldsetMember.key}\n          />\n        )\n      })}\n    </FormFieldSet>\n  )\n})\n","import {memo} from 'react'\n\nimport {type ObjectMember} from '../../store'\nimport {\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../types'\nimport {MemberField} from './MemberField'\nimport {MemberFieldError} from './MemberFieldError'\nimport {MemberFieldSet} from './MemberFieldset'\n\n/** @internal */\nexport interface ObjectInputMemberProps {\n  member: ObjectMember\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n}\n\n/** @internal */\nexport const ObjectInputMember = memo(function ObjectInputMember(props: ObjectInputMemberProps) {\n  const {\n    member,\n    renderAnnotation,\n    renderBlock,\n    renderInput,\n    renderInlineBlock,\n    renderField,\n    renderItem,\n    renderPreview,\n  } = props\n\n  if (member.kind === 'field') {\n    return (\n      <MemberField\n        key={member.key}\n        member={member}\n        renderAnnotation={renderAnnotation}\n        renderBlock={renderBlock}\n        renderInlineBlock={renderInlineBlock}\n        renderInput={renderInput}\n        renderField={renderField}\n        renderItem={renderItem}\n        renderPreview={renderPreview}\n      />\n    )\n  }\n  if (member.kind === 'error') {\n    return <MemberFieldError key={member.key} member={member} />\n  }\n  if (member.kind === 'fieldSet') {\n    return (\n      <MemberFieldSet\n        key={member.key}\n        member={member}\n        renderAnnotation={renderAnnotation}\n        renderBlock={renderBlock}\n        renderInlineBlock={renderInlineBlock}\n        renderInput={renderInput}\n        renderField={renderField}\n        renderItem={renderItem}\n        renderPreview={renderPreview}\n      />\n    )\n  }\n  //@ts-expect-error The branching above should cover all possible cases\n  console.warn(new Error(`Unhandled member kind ${member.kind}`))\n  return null\n})\n","import {useMemo} from 'react'\n\nimport {type ObjectMember} from '../../store'\nimport {\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../types'\nimport {ObjectInputMember} from './ObjectInputMember'\n\n/** @internal */\nexport interface ObjectMembersProps {\n  members: ObjectMember[]\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderField: RenderFieldCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n}\n\n/**\n * Convenience component for wrapping an object input\n * @internal\n */\nexport function ObjectInputMembers(props: ObjectMembersProps) {\n  const {\n    members,\n    renderAnnotation,\n    renderBlock,\n    renderInput,\n    renderInlineBlock,\n    renderField,\n    renderItem,\n    renderPreview,\n  } = props\n\n  const renderMembers = useMemo(\n    () =>\n      members.map((member) => (\n        <ObjectInputMember\n          key={member.key}\n          member={member}\n          renderAnnotation={renderAnnotation}\n          renderBlock={renderBlock}\n          renderField={renderField}\n          renderInlineBlock={renderInlineBlock}\n          renderInput={renderInput}\n          renderItem={renderItem}\n          renderPreview={renderPreview}\n        />\n      )),\n    [\n      members,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n    ],\n  )\n\n  return <>{renderMembers}</>\n}\n\n/**\n * @deprecated Use ObjectInputMembers instead\n * @internal\n */\nexport const ObjectMembers = ObjectInputMembers\n","// eslint-disable-next-line no-empty-function,@typescript-eslint/no-empty-function\n\nimport {isArraySchemaType, isBooleanSchemaType, isObjectSchemaType} from '@sanity/types'\n\nimport {type ArrayOfObjectsInputProps, type InputProps, type ObjectInputProps} from '../types'\nimport {\n  type BooleanFieldProps,\n  type FieldProps,\n  type ObjectFieldProps,\n  type PrimitiveFieldProps,\n} from '../types/fieldProps'\n\nexport function assertType<T>(v: unknown): asserts v is T {\n  // intentionally empty\n}\n\nexport function isObjectInputProps(\n  inputProps: InputProps | Omit<InputProps, 'renderDefault'>,\n): inputProps is ObjectInputProps {\n  return isObjectSchemaType(inputProps.schemaType)\n}\n\nexport function isArrayInputProps(\n  inputProps: InputProps | Omit<InputProps, 'renderDefault'>,\n): inputProps is ArrayOfObjectsInputProps {\n  return isArraySchemaType(inputProps.schemaType)\n}\n\nexport function isPrimitiveField(\n  fieldProps: FieldProps | Omit<FieldProps, 'renderDefault'>,\n): fieldProps is PrimitiveFieldProps {\n  return !isObjectSchemaType(fieldProps.schemaType) && !isArraySchemaType(fieldProps.schemaType)\n}\n\nexport function isBooleanField(\n  fieldProps: FieldProps | Omit<FieldProps, 'renderDefault'>,\n): fieldProps is BooleanFieldProps {\n  return isBooleanSchemaType(fieldProps.schemaType)\n}\n\nexport function isObjectField(\n  fieldProps: FieldProps | Omit<FieldProps, 'renderDefault'>,\n): fieldProps is ObjectFieldProps {\n  return isObjectSchemaType(fieldProps.schemaType)\n}\n","import {isIndexSegment, isKeySegment, type Path} from '@sanity/types'\nimport {isEqual, startsWith, trimLeft} from '@sanity/util/paths'\nimport {memo, type ReactNode, useCallback, useMemo} from 'react'\n\nimport {pathToString} from '../../field'\nimport {Translate, useTranslation} from '../../i18n'\nimport {ArrayOfObjectsItem, MemberField, MemberItemError} from '../members'\nimport {type FieldMember} from '../store'\nimport {\n  type ArrayOfObjectsInputProps,\n  type ObjectInputProps,\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../types'\nimport {isArrayInputProps, isObjectInputProps} from '../utils/asserters'\n\nconst pass = ({children}: {children: ReactNode}) => children\n\n/** @internal */\nexport type FormInputAbsolutePathArg = {absolutePath: Path}\n\n/** @internal */\nexport type FormInputRelativePathArg = {relativePath: Path}\n\nfunction hasAbsolutePath(\n  a: FormInputAbsolutePathArg | FormInputRelativePathArg,\n): a is FormInputAbsolutePathArg {\n  return 'absolutePath' in a\n}\n\n/** @internal */\nexport const FormInput = memo(function FormInput(\n  props: (ArrayOfObjectsInputProps | ObjectInputProps) &\n    (FormInputRelativePathArg | FormInputAbsolutePathArg) & {\n      /**\n       * Whether to include the field around the input. Defaults to false\n       */\n      includeField?: boolean\n    },\n) {\n  const absolutePath = useMemo(() => {\n    return hasAbsolutePath(props) ? props.absolutePath : props.path.concat(props.relativePath)\n  }, [props])\n\n  // TODO: Refactor this at some point in Studio v4\n  //\n  // renderBlock, renderInlineBlock and renderAnnotation\n  // was introduced as optional InputProps after the initial\n  // release of v3, in order to not introduce breaking changes.\n  // They are still required in this inner internal component.\n  // Ignoring string literal because it is a developer error\n  // eslint-disable-next-line i18next/no-literal-string\n  const nullRender = useCallback(() => <>Missing destination render function</>, [])\n\n  return (\n    <FormInputInner\n      {...props}\n      absolutePath={absolutePath}\n      destinationRenderAnnotation={props.renderAnnotation || nullRender}\n      destinationRenderBlock={props.renderBlock || nullRender}\n      destinationRenderField={props.renderField}\n      destinationRenderInlineBlock={props.renderInlineBlock || nullRender}\n      destinationRenderInput={props.renderInput}\n      destinationRenderItem={props.renderItem}\n      destinationRenderPreview={props.renderPreview}\n    />\n  )\n})\n\n/**\n * An input that takes input props for object or array and renders an input for a given sub-path\n */\nconst FormInputInner = memo(function FormInputInner(\n  props: (ArrayOfObjectsInputProps | ObjectInputProps) & {\n    absolutePath: Path\n    includeField?: boolean\n    includeItem?: boolean\n    destinationRenderAnnotation: RenderAnnotationCallback\n    destinationRenderBlock: RenderBlockCallback\n    destinationRenderField: RenderFieldCallback\n    destinationRenderInlineBlock: RenderBlockCallback\n    destinationRenderInput: RenderInputCallback\n    destinationRenderItem: RenderArrayOfObjectsItemCallback\n    destinationRenderPreview: RenderPreviewCallback\n  },\n) {\n  const {\n    absolutePath,\n    destinationRenderAnnotation,\n    destinationRenderBlock,\n    destinationRenderField,\n    destinationRenderInlineBlock,\n    destinationRenderInput,\n    destinationRenderItem,\n    destinationRenderPreview,\n  } = props\n\n  const {t} = useTranslation()\n\n  const renderInput: RenderInputCallback = useCallback(\n    (inputProps) => {\n      const isDestinationReached =\n        isEqual(inputProps.path, absolutePath) || startsWith(absolutePath, inputProps.path)\n      if (isDestinationReached) {\n        // we have reached the destination node and can now render with the passed renderInput\n        return destinationRenderInput(inputProps)\n      }\n      if (!isObjectInputProps(inputProps) && !isArrayInputProps(inputProps)) {\n        throw new Error(\n          `Expected either object input props or array input props for: ${JSON.stringify(\n            inputProps.path,\n          )}`,\n        )\n      }\n      // we have not yet reached the destination path, so we'll continue recurse until we get there\n      return (\n        <FormInputInner\n          {...inputProps}\n          absolutePath={absolutePath}\n          destinationRenderAnnotation={destinationRenderAnnotation}\n          destinationRenderBlock={destinationRenderBlock}\n          destinationRenderInput={destinationRenderInput}\n          destinationRenderItem={destinationRenderItem}\n          destinationRenderField={destinationRenderField}\n          destinationRenderInlineBlock={destinationRenderInlineBlock}\n          destinationRenderPreview={destinationRenderPreview}\n        />\n      )\n    },\n    [\n      absolutePath,\n      destinationRenderAnnotation,\n      destinationRenderBlock,\n      destinationRenderField,\n      destinationRenderInlineBlock,\n      destinationRenderInput,\n      destinationRenderItem,\n      destinationRenderPreview,\n    ],\n  )\n\n  const renderField: RenderFieldCallback = useCallback(\n    (fieldProps) => {\n      // we want to render the field around the input if either of these are true:\n      // 1. we have reached the destination path and the `includeField`-prop is passed as true\n      // 2. we are currently at a node somewhere below/inside the destination path\n      const shouldRenderField =\n        startsWith(absolutePath, fieldProps.path) &&\n        (props.includeField || !isEqual(absolutePath, fieldProps.path))\n      return shouldRenderField ? destinationRenderField(fieldProps) : pass(fieldProps)\n    },\n    [absolutePath, destinationRenderField, props.includeField],\n  )\n\n  const renderItem: RenderArrayOfObjectsItemCallback = useCallback(\n    (itemProps) => {\n      // we want to render the item around the input if either of these are true:\n      // 1. we have reached the destination path and the `includeItem`-prop is passed as true\n      // 2. we are currently at a node somewhere below/inside the destination path\n      const shouldRenderField =\n        startsWith(absolutePath, itemProps.path) &&\n        (props.includeItem || !isEqual(absolutePath, itemProps.path))\n      return shouldRenderField ? destinationRenderItem(itemProps) : pass(itemProps)\n    },\n    [absolutePath, destinationRenderItem, props.includeItem],\n  )\n\n  const renderBlock: RenderBlockCallback = useCallback(\n    (blockProps) => {\n      const shouldRenderBlock =\n        startsWith(absolutePath, blockProps.path) &&\n        (props.includeItem || !isEqual(absolutePath, blockProps.path))\n      return shouldRenderBlock ? destinationRenderBlock(blockProps) : pass(blockProps)\n    },\n    [absolutePath, destinationRenderBlock, props.includeItem],\n  )\n\n  const renderInlineBlock: RenderBlockCallback = useCallback(\n    (blockProps) => {\n      const shouldRenderInlineBlock =\n        startsWith(absolutePath, blockProps.path) &&\n        (props.includeItem || !isEqual(absolutePath, blockProps.path))\n      return shouldRenderInlineBlock ? destinationRenderInlineBlock(blockProps) : pass(blockProps)\n    },\n    [absolutePath, destinationRenderInlineBlock, props.includeItem],\n  )\n\n  const renderAnnotation: RenderAnnotationCallback = useCallback(\n    (annotationProps) => {\n      const shouldRenderAnnotation =\n        startsWith(absolutePath, annotationProps.path) &&\n        (props.includeItem || !isEqual(absolutePath, annotationProps.path))\n      return shouldRenderAnnotation\n        ? destinationRenderAnnotation(annotationProps)\n        : pass(annotationProps)\n    },\n    [absolutePath, destinationRenderAnnotation, props.includeItem],\n  )\n\n  if (isArrayInputProps(props)) {\n    const childPath = trimLeft(props.path, absolutePath)\n\n    const itemMember = props.members.find(\n      (member) =>\n        member.kind == 'item' && isKeySegment(childPath[0]) && member.key === childPath[0]._key,\n    )\n\n    if (!itemMember) {\n      const path = pathToString(props.path)\n      const relativePath = trimLeft(props.path, absolutePath)\n      if (isKeySegment(relativePath[0])) {\n        const key = relativePath[0]._key\n        return (\n          <div>\n            <Translate t={t} i18nKey=\"form.error.no-array-item-at-key\" values={{key, path}} />\n          </div>\n        )\n      }\n\n      const index = isIndexSegment(relativePath[0]) ? relativePath[0] : relativePath[0][0]\n      return (\n        <div>\n          <Translate t={t} i18nKey=\"form.error.no-array-item-at-index\" values={{index, path}} />\n        </div>\n      )\n    }\n\n    if (itemMember.kind === 'error') {\n      return <MemberItemError member={itemMember} />\n    }\n\n    return (\n      <ArrayOfObjectsItem\n        member={itemMember}\n        renderAnnotation={renderAnnotation}\n        renderBlock={renderBlock}\n        renderInput={renderInput}\n        renderField={renderField}\n        renderInlineBlock={renderInlineBlock}\n        renderItem={renderItem}\n        renderPreview={destinationRenderPreview}\n      />\n    )\n  }\n\n  if (isObjectInputProps(props)) {\n    const childPath = trimLeft(props.path, absolutePath)\n    const fieldMember = props.members.find(\n      (member): member is FieldMember => member.kind == 'field' && childPath[0] === member.name,\n    )\n\n    if (!fieldMember) {\n      const fieldName =\n        typeof childPath[0] === 'string' ? childPath[0] : JSON.stringify(childPath[0])\n\n      return <div>{t('form.error.field-not-found', {fieldName})}</div>\n    }\n\n    return (\n      <MemberField\n        member={fieldMember}\n        renderAnnotation={renderAnnotation}\n        renderBlock={renderBlock}\n        renderInput={renderInput}\n        renderInlineBlock={renderInlineBlock}\n        renderField={renderField}\n        renderItem={renderItem}\n        renderPreview={destinationRenderPreview}\n      />\n    )\n  }\n\n  throw new Error('FormInput can only be used with arrays or objects')\n})\n","import {createContext, type ReactNode} from 'react'\n\nimport {type PortableTextMemberItem} from '../PortableTextInput'\n\nexport const PortableTextMemberItemsContext = createContext<PortableTextMemberItem[]>([])\n\nexport function PortableTextMemberItemsProvider(props: {\n  memberItems: PortableTextMemberItem[]\n  children: ReactNode\n}) {\n  return (\n    <PortableTextMemberItemsContext.Provider value={props.memberItems}>\n      {props.children}\n    </PortableTextMemberItemsContext.Provider>\n  )\n}\n","import {pathFor} from '@sanity/util/paths'\nimport {createRef, type MutableRefObject, type ReactNode, useContext, useRef} from 'react'\n\nimport {pathToString} from '../../../../field'\nimport {type FIXME} from '../../../../FIXME'\nimport {FormInput} from '../../../components'\nimport {isMemberArrayOfObjects} from '../../../members/object/fields/asserters'\nimport {type ArrayOfObjectsItemMember, type ObjectFormNode} from '../../../store'\nimport {type PortableTextInputProps} from '../../../types'\nimport {isArrayOfObjectsFieldMember, isBlockType} from '../_helpers'\nimport {type PortableTextEditorElement} from '../Compositor'\nimport {PortableTextMemberItemsContext} from '../contexts/PortableTextMembers'\nimport {type PortableTextMemberItem} from '../PortableTextInput'\n\nexport function usePortableTextMemberItem(key: string): PortableTextMemberItem | undefined {\n  const ctx = useContext(PortableTextMemberItemsContext)\n  if (!ctx) {\n    throw new Error('Form context not provided')\n  }\n  return ctx.find((m) => m.key === key)\n}\n\nexport function usePortableTextMemberItems(): PortableTextMemberItem[] {\n  const ctx = useContext(PortableTextMemberItemsContext)\n  if (!ctx) {\n    throw new Error('Form context not provided')\n  }\n  return ctx\n}\n\n/**\n * Returns a flat structure of all the form member items\n * included in this Portable Text Input.\n *\n * @internal\n */\nexport function usePortableTextMemberItemsFromProps(\n  props: PortableTextInputProps,\n): PortableTextMemberItem[] {\n  const portableTextMemberItemsRef: MutableRefObject<PortableTextMemberItem[]> = useRef([])\n  reconcilePortableTextMembers({props, ref: portableTextMemberItemsRef})\n  return portableTextMemberItemsRef.current\n}\n\nconst reconcilePortableTextMembers = ({\n  props,\n  ref,\n}: {\n  props: PortableTextInputProps\n  ref: MutableRefObject<PortableTextMemberItem[]>\n}) => {\n  const result: {\n    kind: PortableTextMemberItem['kind']\n    member: ArrayOfObjectsItemMember\n    node: ObjectFormNode\n  }[] = []\n  const {\n    members,\n    path,\n    schemaType,\n    renderAnnotation,\n    renderField,\n    renderBlock,\n    renderInput,\n    renderItem,\n    renderInlineBlock,\n    renderPreview,\n  } = props\n  for (const member of members) {\n    if (member.kind === 'item') {\n      const isObjectBlock = !isBlockType(member.item.schemaType)\n      if (isObjectBlock) {\n        result.push({kind: 'objectBlock', member, node: member.item})\n      } else {\n        // Also include regular text blocks with validation, presence, changes or that are open or focused.\n        // This is a performance optimization to avoid accounting for blocks that\n        // doesn't need to be re-rendered (which usually is most of the blocks).\n        if (\n          member.item.validation.length > 0 ||\n          member.item.changed ||\n          member.item.presence?.length ||\n          member.open ||\n          member.item.focusPath.length\n        ) {\n          result.push({kind: 'textBlock', member, node: member.item})\n        }\n        // Inline objects\n        const childrenField = member.item.members.find(\n          (f) => f.kind === 'field' && f.name === 'children',\n        )\n        if (\n          childrenField &&\n          childrenField.kind === 'field' &&\n          isMemberArrayOfObjects(childrenField)\n        ) {\n          // eslint-disable-next-line max-depth\n          for (const child of childrenField.field.members) {\n            // eslint-disable-next-line max-depth\n            if (child.kind === 'item' && child.item.schemaType.name !== 'span') {\n              result.push({kind: 'inlineObject', member: child, node: child.item})\n            }\n          }\n        }\n        // Markdefs\n        const markDefArrayMember = member.item.members\n          .filter(isArrayOfObjectsFieldMember)\n          .find((f) => f.name === 'markDefs')\n        if (markDefArrayMember) {\n          // eslint-disable-next-line max-depth\n          for (const child of markDefArrayMember.field.members) {\n            // eslint-disable-next-line max-depth\n            if (child.kind === 'item' && child.item.schemaType.jsonType === 'object') {\n              result.push({\n                kind: 'annotation',\n                member: child,\n                node: child.item,\n              })\n            }\n          }\n        }\n      }\n    }\n  }\n\n  const items: PortableTextMemberItem[] = result.map((item) => {\n    const key = pathToString(item.node.path)\n    const existingItem = ref.current.find((refItem) => refItem.key === key)\n    const isObject = item.kind !== 'textBlock'\n    let input: ReactNode = null\n\n    if ((isObject && item.member !== existingItem?.member) || item.node !== existingItem?.node) {\n      const inputProps = {\n        absolutePath: pathFor(item.node.path),\n        includeField: false,\n        members,\n        path: pathFor(path),\n        renderAnnotation,\n        renderBlock,\n        renderField,\n        renderInlineBlock,\n        renderInput,\n        renderItem,\n        renderPreview,\n        schemaType,\n      }\n      input = <FormInput {...(inputProps as FIXME)} />\n    }\n\n    // Update existing item\n    if (existingItem) {\n      existingItem.member = item.member\n      existingItem.node = item.node\n      existingItem.input = input || existingItem.input\n      return existingItem\n    }\n\n    return {\n      kind: item.kind,\n      key,\n      member: item.member,\n      node: item.node,\n      elementRef: createRef<PortableTextEditorElement | null>(),\n      input,\n    }\n  })\n\n  ref.current = items\n\n  return items\n}\n","import {hues} from '@sanity/color'\nimport {Box, type Theme, type ThemeColorToneKey} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nexport const Root = styled.span<{$toneKey?: Exclude<ThemeColorToneKey, 'transparent'>}>(\n  (props: {$toneKey?: Exclude<ThemeColorToneKey, 'transparent'>; theme: Theme}) => {\n    const {$toneKey = 'default', theme} = props\n\n    return css`\n      text-decoration: none;\n      display: inline;\n      background-color: ${theme.sanity.color.selectable?.[$toneKey].enabled.bg};\n      border-bottom: 1px dashed ${theme.sanity.color.selectable?.[$toneKey].enabled.fg};\n      color: ${theme.sanity.color.selectable?.[$toneKey].enabled.fg};\n\n      &[data-link] {\n        border-bottom: 1px solid ${theme.sanity.color.selectable?.[$toneKey].enabled.fg};\n      }\n\n      &[data-custom-markers] {\n        background-color: ${theme.sanity.color.dark ? hues.purple[950].hex : hues.purple[50].hex};\n      }\n\n      &[data-warning] {\n        background-color: ${theme.sanity.color.muted.caution.hovered.bg};\n      }\n\n      &[data-error] {\n        background-color: ${theme.sanity.color.muted.critical.hovered.bg};\n      }\n    `\n  },\n)\n\nexport const TooltipBox = styled(Box).attrs({forwardedAs: 'span'})`\n  max-width: 250px;\n`\n","import {EditIcon, TrashIcon} from '@sanity/icons'\nimport {Box, Flex, Text, useGlobalKeyDown, useTheme} from '@sanity/ui'\nimport {startTransition, useCallback, useEffect, useMemo, useRef, useState} from 'react'\n\nimport {Button, Popover, type PopoverProps} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\n\nconst POPOVER_FALLBACK_PLACEMENTS: PopoverProps['fallbackPlacements'] = ['top', 'bottom']\n\ninterface AnnotationToolbarPopoverProps {\n  annotationOpen: boolean\n  floatingBoundary: HTMLElement | null\n  onOpen: () => void\n  onRemove: () => void\n  referenceBoundary: HTMLElement | null\n  referenceElement: HTMLElement | null\n  selected: boolean\n  title: string\n}\n\nexport function AnnotationToolbarPopover(props: AnnotationToolbarPopoverProps) {\n  const {\n    annotationOpen,\n    floatingBoundary,\n    onOpen,\n    onRemove,\n    referenceBoundary,\n    referenceElement,\n    selected,\n    title,\n  } = props\n  const [renderPopover, setRenderPopover] = useState<boolean>(false)\n  const [popoverOpen, setPopoverOpen] = useState<boolean>(false)\n  const [cursorRect, setCursorRect] = useState<DOMRect | null>(null)\n  const rangeRef = useRef<Range | null>(null)\n  const {sanity} = useTheme()\n  const {t} = useTranslation()\n  const popoverRef = useRef<HTMLDivElement | null>(null)\n  const popoverScheme = sanity.color.dark ? 'light' : 'dark'\n\n  //Add separate handler for popover state\n  //to prevent the popover from jumping when opening\n  const handleOpenPopover = useCallback((open: boolean) => {\n    setRenderPopover(open)\n    if (open) {\n      startTransition(() => {\n        setPopoverOpen(open)\n      })\n    } else {\n      setPopoverOpen(open)\n    }\n  }, [])\n\n  // This is a \"virtual element\" (supported by Popper.js)\n  const cursorElement = useMemo(() => {\n    if (!cursorRect) {\n      return null\n    }\n    return {\n      getBoundingClientRect: () => {\n        return cursorRect\n      },\n    }\n  }, [cursorRect]) as HTMLElement\n\n  // Close floating toolbar on Escape\n  useGlobalKeyDown(\n    useCallback(\n      (event) => {\n        if (!popoverOpen) {\n          return\n        }\n        if (event.key === 'Escape') {\n          handleOpenPopover(false)\n        }\n      },\n      [handleOpenPopover, popoverOpen],\n    ),\n  )\n\n  // Open popover when selection is within the annotation text\n  const handleSelectionChange = useCallback(() => {\n    if (annotationOpen) {\n      handleOpenPopover(false)\n      setCursorRect(null)\n      return\n    }\n\n    const sel = window.getSelection()\n\n    if (!sel || sel.rangeCount === 0) return\n\n    const range = sel.getRangeAt(0)\n    const isWithinRoot = referenceElement?.contains(range.commonAncestorContainer)\n\n    if (!isWithinRoot) {\n      handleOpenPopover(false)\n      setCursorRect(null)\n      return\n    }\n    const rect = range?.getBoundingClientRect()\n    if (rect) {\n      setCursorRect(rect)\n      handleOpenPopover(true)\n    }\n  }, [annotationOpen, referenceElement, handleOpenPopover])\n\n  // Detect selection changes\n  useEffect(() => {\n    document.addEventListener('selectionchange', handleSelectionChange, {passive: true})\n    return () => {\n      document.removeEventListener('selectionchange', handleSelectionChange)\n    }\n  }, [handleSelectionChange])\n\n  const handleEditButtonClicked = useCallback(() => {\n    handleOpenPopover(false)\n    onOpen()\n  }, [onOpen, handleOpenPopover])\n\n  // Open the popover when closing the annotation dialog\n  useEffect(() => {\n    if (!annotationOpen && selected && cursorRect) {\n      handleOpenPopover(true)\n    }\n    if (annotationOpen) {\n      handleOpenPopover(false)\n    }\n  }, [annotationOpen, selected, cursorRect, handleOpenPopover])\n\n  const handleRemoveButtonClicked = useCallback(() => {\n    handleOpenPopover(false)\n    onRemove()\n  }, [onRemove, handleOpenPopover])\n\n  const handleScroll = useCallback(() => {\n    if (rangeRef.current) {\n      setCursorRect(rangeRef.current.getBoundingClientRect())\n    }\n  }, [])\n\n  useEffect(() => {\n    const sel = window.getSelection()\n    if (sel && sel.rangeCount > 0) {\n      rangeRef.current = sel.getRangeAt(0)\n    }\n  }, [popoverOpen])\n\n  useEffect(() => {\n    //Attach and detach scroll event listener for popover to follow the current reference boundary\n    if (popoverOpen && referenceBoundary) {\n      referenceBoundary.addEventListener('scroll', handleScroll)\n      return () => referenceBoundary.removeEventListener('scroll', handleScroll)\n    }\n\n    if (!popoverOpen) {\n      return undefined\n    }\n\n    referenceBoundary?.addEventListener('scroll', handleScroll)\n\n    return () => {\n      referenceBoundary?.removeEventListener('scroll', handleScroll)\n    }\n  }, [popoverOpen, referenceBoundary, handleScroll])\n\n  if (!renderPopover) {\n    return null\n  }\n\n  return (\n    <Popover\n      open={popoverOpen}\n      floatingBoundary={floatingBoundary}\n      constrainSize\n      content={\n        <Box padding={1} data-testid=\"annotation-toolbar-popover\">\n          <Flex gap={1}>\n            <Box padding={2}>\n              <Text weight=\"medium\" size={1}>\n                {title}\n              </Text>\n            </Box>\n            <Button\n              aria-label={t('inputs.portable-text.action.edit-annotation-aria-label')}\n              icon={EditIcon}\n              mode=\"bleed\"\n              onClick={handleEditButtonClicked}\n              tabIndex={0}\n              tooltipProps={null}\n            />\n            <Button\n              aria-label={t('inputs.portable-text.action.remove-annotation-aria-label')}\n              icon={TrashIcon}\n              mode=\"bleed\"\n              onClick={handleRemoveButtonClicked}\n              tabIndex={0}\n              tone=\"critical\"\n              tooltipProps={null}\n            />\n          </Flex>\n        </Box>\n      }\n      fallbackPlacements={POPOVER_FALLBACK_PLACEMENTS}\n      placement=\"top\"\n      portal\n      preventOverflow\n      ref={popoverRef}\n      referenceBoundary={referenceBoundary}\n      referenceElement={cursorElement}\n      scheme={popoverScheme}\n    />\n  )\n}\n","import {type ObjectSchemaType} from '@sanity/types'\n\nconst parseResponsiveWidth = (value: unknown): (number | 'auto')[] => {\n  if (Array.isArray(value)) {\n    return value.flatMap(parseResponsiveWidth)\n  }\n  if (typeof value === 'number') {\n    return [value]\n  }\n  return value === 'auto' ? ['auto'] : []\n}\nconst parseModalType = (value: unknown): 'popover' | 'dialog' | undefined => {\n  return value === 'dialog' || value === 'popover' ? value : undefined\n}\n\nexport function _getModalOption(\n  schemaType: ObjectSchemaType,\n): {type?: 'dialog' | 'popover'; width: (number | 'auto')[]} | undefined {\n  const raw = schemaType.options?.modal\n  return typeof raw === 'object' && raw !== null\n    ? {\n        type: parseModalType(raw.type),\n        width: parseResponsiveWidth(raw.width),\n      }\n    : undefined\n}\n","import {createContext, type MutableRefObject, useContext} from 'react'\n\n/**\n * @internal\n */\nexport interface VirtualizerScrollInstance {\n  /**\n   * The parent that has the overflow scroll\n   */\n  scrollElement: HTMLElement | null\n  /**\n   * The container that wraps the array items\n   */\n  containerElement: MutableRefObject<HTMLElement | null>\n}\n\n/**\n * This is used to store the reference to the scroll element for virtualizer\n * @internal\n */\nexport const VirtualizerScrollInstanceContext = createContext<VirtualizerScrollInstance | null>(\n  null,\n)\n\n/**\n * @internal\n */\nexport function useVirtualizerScrollInstance(): VirtualizerScrollInstance {\n  const ref = useContext(VirtualizerScrollInstanceContext)\n  if (!ref) {\n    throw new Error('VirtualizerScrollInstance: missing context value')\n  }\n  return ref\n}\n","import {type ReactNode} from 'react'\n\nimport {\n  type VirtualizerScrollInstance,\n  VirtualizerScrollInstanceContext,\n} from './useVirtualizerScrollInstance'\n\n/**\n * @internal\n */\ninterface VirtualizerScrollInstanceProviderProps extends VirtualizerScrollInstance {\n  children: ReactNode\n}\n\n/**\n *\n * @internal\n */\nexport function VirtualizerScrollInstanceProvider(props: VirtualizerScrollInstanceProviderProps) {\n  const {scrollElement, containerElement} = props\n\n  return (\n    <VirtualizerScrollInstanceContext.Provider\n      value={{scrollElement, containerElement: containerElement}}\n    >\n      {props.children}\n    </VirtualizerScrollInstanceContext.Provider>\n  )\n}\n","import {Box} from '@sanity/ui'\nimport {type ReactNode, useId, useRef, useState} from 'react'\n\nimport {Dialog} from '../../../../../../ui-components'\nimport {PresenceOverlay} from '../../../../../presence'\nimport {VirtualizerScrollInstanceProvider} from '../../../arrays/ArrayOfObjectsInput/List/VirtualizerScrollInstanceProvider'\nimport {type ModalWidth} from './types'\n\ninterface DefaultEditDialogProps {\n  children: ReactNode\n  onClose: () => void\n  title: string | ReactNode\n  width?: ModalWidth\n  autoFocus?: boolean\n}\n\nexport function DefaultEditDialog(props: DefaultEditDialogProps) {\n  const {onClose, children, title, width = 1, autoFocus} = props\n  const dialogId = useId()\n  // This seems to work with regular refs as well, but it might be safer to use state.\n  const [contentElement, setContentElement] = useState<HTMLDivElement | null>(null)\n  const containerElement = useRef<HTMLDivElement | null>(null)\n\n  return (\n    <Dialog\n      header={title}\n      id={dialogId}\n      onClickOutside={onClose}\n      onClose={onClose}\n      portal=\"default\"\n      width={width}\n      contentRef={setContentElement}\n      data-testid=\"default-edit-object-dialog\"\n      __unstable_autoFocus={autoFocus}\n    >\n      <PresenceOverlay margins={[0, 0, 1, 0]}>\n        <VirtualizerScrollInstanceProvider\n          scrollElement={contentElement}\n          containerElement={containerElement}\n        >\n          <Box ref={containerElement}>{children}</Box>\n        </VirtualizerScrollInstanceProvider>\n      </PresenceOverlay>\n    </Dialog>\n  )\n}\n","import {Box} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../../../ui-components'\n\nexport const RootPopover = styled(Popover)`\n  & > div {\n    overflow: hidden;\n    overflow: clip;\n  }\n`\n\nexport const ContentScrollerBox = styled(Box)`\n  /* Prevent overflow caused by change indicator */\n  overflow-x: hidden;\n  overflow-y: auto;\n`\n\nexport const ContentHeaderBox = styled(Box)`\n  box-shadow: 0 1px 0 var(--card-shadow-outline-color);\n  position: relative;\n  z-index: 10;\n  min-height: auto;\n`\n","/* eslint-disable react/no-unused-prop-types */\n\nimport {CloseIcon} from '@sanity/icons'\nimport {Box, Flex, Text, useClickOutside, useGlobalKeyDown} from '@sanity/ui'\nimport {type ReactNode, useCallback, useEffect, useRef, useState} from 'react'\n\nimport {Button, type PopoverProps} from '../../../../../../ui-components'\nimport {PresenceOverlay} from '../../../../../presence'\nimport {VirtualizerScrollInstanceProvider} from '../../../arrays/ArrayOfObjectsInput/List/VirtualizerScrollInstanceProvider'\nimport {type PortableTextEditorElement} from '../../Compositor'\nimport {ContentHeaderBox, ContentScrollerBox, RootPopover} from './PopoverModal.styles'\nimport {type ModalWidth} from './types'\n\ninterface PopoverEditDialogProps {\n  autoFocus?: boolean\n  children: ReactNode\n  floatingBoundary: HTMLElement | null\n  onClose: () => void\n  referenceBoundary: HTMLElement | null\n  referenceElement: PortableTextEditorElement | null\n  title: string | ReactNode\n  width?: ModalWidth\n}\n\nconst POPOVER_FALLBACK_PLACEMENTS: PopoverProps['fallbackPlacements'] = ['top', 'bottom']\n\nexport function PopoverEditDialog(props: PopoverEditDialogProps) {\n  const {floatingBoundary, referenceBoundary, referenceElement, width = 1} = props\n  const [open, setOpen] = useState(false)\n\n  // This hook is here to set open after the initial render.\n  // If rendered immediately, the popover will for a split second be\n  // visible in the top left of the boundaryElement before correctly\n  // placed pointing at the reference element.\n  useEffect(() => {\n    setOpen(true)\n  }, [])\n\n  return (\n    <RootPopover\n      content={<Content {...props} />}\n      constrainSize\n      data-testid=\"popover-edit-dialog\"\n      data-ui=\"PopoverEditDialog\"\n      fallbackPlacements={POPOVER_FALLBACK_PLACEMENTS}\n      floatingBoundary={floatingBoundary}\n      open={open}\n      overflow=\"auto\"\n      placement=\"bottom\"\n      portal=\"default\"\n      preventOverflow\n      referenceBoundary={referenceBoundary}\n      referenceElement={referenceElement}\n      width={width}\n    />\n  )\n}\n\nfunction Content(props: PopoverEditDialogProps) {\n  const {onClose, referenceBoundary, referenceElement, title, autoFocus} = props\n\n  useGlobalKeyDown(\n    useCallback(\n      (event: KeyboardEvent) => {\n        if (event.key === 'Escape') {\n          onClose()\n        }\n      },\n      [onClose],\n    ),\n  )\n\n  useClickOutside(onClose, referenceElement ? [referenceElement] : [], referenceBoundary)\n\n  // This seems to work with regular refs as well, but it might be safer to use state.\n  const [contentElement, setContentElement] = useState<HTMLDivElement | null>(null)\n  const containerElement = useRef<HTMLDivElement | null>(null)\n\n  return (\n    <VirtualizerScrollInstanceProvider\n      scrollElement={contentElement}\n      containerElement={containerElement}\n    >\n      <Flex ref={containerElement} direction=\"column\" height=\"fill\">\n        <ContentHeaderBox flex=\"none\" padding={1}>\n          <Flex align=\"center\">\n            <Box flex={1} padding={2}>\n              <Text weight=\"medium\">{title}</Text>\n            </Box>\n\n            <Button\n              autoFocus={Boolean(autoFocus)}\n              icon={CloseIcon}\n              mode=\"bleed\"\n              onClick={onClose}\n              tooltipProps={{content: 'Close'}}\n            />\n          </Flex>\n        </ContentHeaderBox>\n        <ContentScrollerBox flex={1}>\n          <PresenceOverlay margins={[0, 0, 1, 0]}>\n            <Box padding={3} ref={setContentElement}>\n              {props.children}\n            </Box>\n          </PresenceOverlay>\n        </ContentScrollerBox>\n      </Flex>\n    </VirtualizerScrollInstanceProvider>\n  )\n}\n","import {type ObjectSchemaType} from '@sanity/types'\nimport {type ReactNode, useCallback, useMemo} from 'react'\n\nimport {useTranslation} from '../../../../../i18n'\nimport {_getModalOption} from '../helpers'\nimport {DefaultEditDialog} from './DialogModal'\nimport {PopoverEditDialog} from './PopoverModal'\n\nexport function ObjectEditModal(props: {\n  autoFocus?: boolean\n  children: ReactNode\n  defaultType: 'dialog' | 'popover'\n  floatingBoundary: HTMLElement | null\n  onClose: () => void\n  referenceBoundary: HTMLElement | null\n  referenceElement: HTMLElement | null\n  schemaType: ObjectSchemaType & {i18nTitleKey?: string}\n}) {\n  const {\n    autoFocus,\n    defaultType,\n    floatingBoundary,\n    onClose,\n    referenceBoundary,\n    referenceElement,\n    schemaType,\n  } = props\n\n  const {t} = useTranslation()\n  const schemaModalOption = useMemo(() => _getModalOption(schemaType), [schemaType])\n  const modalType = schemaModalOption?.type || defaultType\n\n  const schemaTypeTitle = schemaType.i18nTitleKey\n    ? t(schemaType.i18nTitleKey)\n    : schemaType.title || schemaType.name\n\n  const modalTitle = t('inputs.portable-text.annotation-editor.title', {\n    schemaType: schemaTypeTitle,\n  })\n\n  const handleClose = useCallback(() => {\n    onClose()\n  }, [onClose])\n\n  const modalWidth = schemaModalOption?.width\n\n  if (modalType === 'popover') {\n    return (\n      <PopoverEditDialog\n        autoFocus={autoFocus}\n        floatingBoundary={floatingBoundary}\n        onClose={handleClose}\n        referenceBoundary={referenceBoundary}\n        referenceElement={referenceElement}\n        title={<>{modalTitle}</>}\n        width={modalWidth}\n      >\n        {props.children}\n      </PopoverEditDialog>\n    )\n  }\n\n  return (\n    <DefaultEditDialog\n      onClose={handleClose}\n      title={modalTitle}\n      width={modalWidth}\n      autoFocus={autoFocus}\n    >\n      {props.children}\n    </DefaultEditDialog>\n  )\n}\n","import {PortableTextEditor, usePortableTextEditor} from '@sanity/portable-text-editor'\nimport {type ObjectSchemaType, type Path, type PortableTextObject} from '@sanity/types'\nimport {isEqual} from '@sanity/util/paths'\nimport {type ComponentType, type ReactElement, useCallback, useMemo, useState} from 'react'\n\nimport {Tooltip} from '../../../../../ui-components'\nimport {pathToString} from '../../../../field'\nimport {useTranslation} from '../../../../i18n'\nimport {EMPTY_ARRAY} from '../../../../util'\nimport {useChildPresence} from '../../../studio/contexts/Presence'\nimport {\n  type BlockAnnotationProps,\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderCustomMarkers,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../../types'\nimport {useFormBuilder} from '../../../useFormBuilder'\nimport {DefaultMarkers} from '../_legacyDefaultParts/Markers'\nimport {debugRender} from '../debugRender'\nimport {useMemberValidation} from '../hooks/useMemberValidation'\nimport {usePortableTextMarkers} from '../hooks/usePortableTextMarkers'\nimport {usePortableTextMemberItem} from '../hooks/usePortableTextMembers'\nimport {Root, TooltipBox} from './Annotation.styles'\nimport {AnnotationToolbarPopover} from './AnnotationToolbarPopover'\nimport {ObjectEditModal} from './modals/ObjectEditModal'\n\ninterface AnnotationProps {\n  children: ReactElement\n  editorNodeFocused: boolean\n  floatingBoundary: HTMLElement | null\n  focused: boolean\n  onItemClose: () => void\n  onItemOpen: (path: Path) => void\n  onPathFocus: (path: Path) => void\n  path: Path\n  readOnly?: boolean\n  referenceBoundary: HTMLElement | null\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderCustomMarkers?: RenderCustomMarkers\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n  selected: boolean\n  schemaType: ObjectSchemaType\n  value: PortableTextObject\n}\n\nexport function Annotation(props: AnnotationProps) {\n  const {\n    children,\n    editorNodeFocused,\n    floatingBoundary,\n    focused,\n    onItemClose,\n    onItemOpen,\n    onPathFocus,\n    path,\n    readOnly,\n    referenceBoundary,\n    renderAnnotation,\n    renderBlock,\n    renderCustomMarkers,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n    schemaType,\n    selected,\n    value,\n  } = props\n  const {Markers = DefaultMarkers} = useFormBuilder().__internal.components\n  const editor = usePortableTextEditor()\n  const markDefPath: Path = useMemo(\n    () => path.slice(0, path.length - 2).concat(['markDefs', {_key: value._key}]),\n    [path, value._key],\n  )\n  const [spanElement, setSpanElement] = useState<HTMLSpanElement | null>(null)\n  const spanPath: Path = useMemo(() => path.slice(path.length - 3, path.length), [path])\n  const memberItem = usePortableTextMemberItem(pathToString(markDefPath))\n  const {validation} = useMemberValidation(memberItem?.node)\n  const markers = usePortableTextMarkers(path)\n\n  const text = useMemo(() => <span data-annotation=\"\">{children}</span>, [children])\n\n  const onOpen = useCallback(() => {\n    if (memberItem) {\n      // Take focus away from the editor so that it doesn't propagate a new focusPath and interfere here.\n      PortableTextEditor.blur(editor)\n      onPathFocus(memberItem.node.focusPath) // Set the focus path to be the markDef here as we currently have focus on the text node\n      onItemOpen(memberItem.node.path)\n    }\n  }, [editor, memberItem, onItemOpen, onPathFocus])\n\n  const onClose = useCallback(() => {\n    onItemClose()\n    // Keep track of any previous offsets on the spanNode before we select it.\n    const sel = PortableTextEditor.getSelection(editor)\n    const focusOffset = sel?.focus.path && isEqual(sel.focus.path, spanPath) && sel.focus.offset\n    const anchorOffset = sel?.anchor.path && isEqual(sel.anchor.path, spanPath) && sel.anchor.offset\n    PortableTextEditor.select(editor, {\n      anchor: {path: spanPath, offset: anchorOffset || 0},\n      focus: {path: spanPath, offset: focusOffset || 0},\n    })\n    PortableTextEditor.focus(editor)\n  }, [editor, spanPath, onItemClose])\n\n  const onRemove = useCallback(() => {\n    PortableTextEditor.removeAnnotation(editor, schemaType)\n    PortableTextEditor.focus(editor)\n  }, [editor, schemaType])\n\n  const markersToolTip = useMemo(\n    () =>\n      validation.length > 0 || markers.length > 0 ? (\n        <Tooltip\n          placement=\"bottom\"\n          portal=\"default\"\n          content={\n            <TooltipBox>\n              <Markers\n                markers={markers}\n                renderCustomMarkers={renderCustomMarkers}\n                validation={validation}\n              />\n            </TooltipBox>\n          }\n        >\n          {text}\n        </Tooltip>\n      ) : undefined,\n    [Markers, markers, renderCustomMarkers, text, validation],\n  )\n\n  const presence = useChildPresence(path, true)\n  const rootPresence = useMemo(\n    () => presence.filter((p) => isEqual(p.path, path)),\n    [path, presence],\n  )\n\n  const isOpen = Boolean(memberItem?.member.open)\n  const input = memberItem?.input\n  const nodePath = memberItem?.node.path || EMPTY_ARRAY\n  const referenceElement = spanElement\n\n  const componentProps = useMemo(\n    (): BlockAnnotationProps => ({\n      __unstable_floatingBoundary: floatingBoundary,\n      __unstable_referenceBoundary: referenceBoundary,\n      __unstable_referenceElement: referenceElement,\n      __unstable_textElementFocus: editorNodeFocused, // Is there focus on the related text element for this object?\n      children: input,\n      focused,\n      markers,\n      onClose,\n      onOpen,\n      onPathFocus,\n      onRemove,\n      open: isOpen,\n      parentSchemaType: editor.schemaTypes.block,\n      path: nodePath,\n      presence: rootPresence,\n      readOnly: Boolean(readOnly),\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderPreview,\n      renderItem,\n      renderDefault: DefaultAnnotationComponent,\n      schemaType,\n      selected,\n      textElement: markersToolTip || text,\n      validation,\n      value,\n    }),\n    [\n      editor.schemaTypes.block,\n      editorNodeFocused,\n      floatingBoundary,\n      focused,\n      input,\n      isOpen,\n      markers,\n      markersToolTip,\n      nodePath,\n      onClose,\n      onOpen,\n      onPathFocus,\n      onRemove,\n      readOnly,\n      referenceBoundary,\n      referenceElement,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n      rootPresence,\n      schemaType,\n      selected,\n      text,\n      validation,\n      value,\n    ],\n  )\n\n  const CustomComponent = schemaType.components?.annotation as\n    | ComponentType<BlockAnnotationProps>\n    | undefined\n\n  const setRef = useCallback(\n    (elm: HTMLSpanElement) => {\n      if (memberItem?.elementRef) {\n        memberItem.elementRef.current = elm\n      }\n      setSpanElement(elm) // update state here so the reference element is available on first render\n    },\n    [memberItem],\n  )\n\n  return useMemo(\n    () => (\n      <span ref={setRef} style={debugRender()}>\n        {CustomComponent ? (\n          <CustomComponent {...componentProps} />\n        ) : (\n          <DefaultAnnotationComponent {...componentProps} />\n        )}\n      </span>\n    ),\n    [CustomComponent, componentProps, setRef],\n  )\n}\n\nexport const DefaultAnnotationComponent = (props: BlockAnnotationProps) => {\n  const {\n    __unstable_floatingBoundary: floatingBoundary,\n    __unstable_referenceBoundary: referenceBoundary,\n    __unstable_referenceElement: referenceElement,\n    children,\n    focused,\n    markers,\n    onClose,\n    onOpen,\n    onRemove,\n    open,\n    readOnly,\n    selected,\n    schemaType,\n    textElement,\n    validation,\n  } = props\n  const isLink = schemaType.name === 'link'\n  const hasError = validation.some((v) => v.level === 'error')\n  const hasWarning = validation.some((v) => v.level === 'warning')\n  const hasMarkers = markers.length > 0\n\n  const {t} = useTranslation()\n  const toneKey = useMemo(() => {\n    if (hasError) {\n      return 'critical'\n    }\n\n    if (hasWarning) {\n      return 'caution'\n    }\n\n    if (isLink) {\n      return 'primary'\n    }\n    return 'default'\n  }, [isLink, hasError, hasWarning])\n\n  return (\n    <Root\n      $toneKey={toneKey}\n      aria-label={t('inputs.portable-text.annotation-aria-label')}\n      data-link={isLink ? '' : undefined}\n      data-error={hasError ? '' : undefined}\n      data-warning={hasWarning ? '' : undefined}\n      data-markers={hasMarkers || undefined}\n      onClick={readOnly ? onOpen : undefined}\n    >\n      {textElement}\n      <AnnotationToolbarPopover\n        annotationOpen={open}\n        floatingBoundary={floatingBoundary}\n        onOpen={onOpen}\n        onRemove={onRemove}\n        referenceBoundary={referenceBoundary}\n        referenceElement={referenceElement}\n        selected={selected}\n        title={\n          schemaType.i18nTitleKey ? t(schemaType.i18nTitleKey) : schemaType.title || schemaType.name\n        }\n      />\n      {open && (\n        <ObjectEditModal\n          defaultType=\"popover\"\n          floatingBoundary={floatingBoundary}\n          onClose={onClose}\n          autoFocus={focused}\n          referenceBoundary={referenceBoundary}\n          referenceElement={referenceElement}\n          schemaType={schemaType}\n        >\n          {children}\n        </ObjectEditModal>\n      )}\n    </Root>\n  )\n}\n","import {type Path} from '@sanity/types'\nimport {\n  type ComponentType,\n  createContext,\n  type HTMLProps,\n  type ReactNode,\n  useContext,\n  useMemo,\n} from 'react'\n\nimport {type TemplatePermissionsResult} from '../../../store'\n\nconst Context = createContext<ReferenceInputOptions>({})\n\n/** @internal */\nexport interface TemplateOption {\n  id: string\n  params?: Record<string, string | number | boolean>\n}\n\n/**\n * @internal\n */\nexport interface EditReferenceOptions {\n  id: string\n  type: string\n  parentRefPath: Path\n  template: TemplateOption\n}\n\n/** @internal */\nexport interface EditReferenceLinkComponentProps {\n  documentId: string\n  documentType: string\n  parentRefPath: Path\n  template?: TemplateOption\n  children: ReactNode\n}\n\n/**\n * @internal\n */\nexport interface ReferenceInputOptions {\n  /**\n   * Represents the highlighted path if ths current document has a related open\n   * child (e.g. reference in place).\n   */\n  activePath?: {path: Path; state: 'selected' | 'pressed' | 'none'}\n  /**\n   * A specialized `EditReferenceLinkComponent` component that takes in the needed props to open a\n   * referenced document to the right\n   */\n  EditReferenceLinkComponent?: ComponentType<\n    Omit<HTMLProps<'a'>, 'children'> & EditReferenceLinkComponentProps\n  >\n\n  initialValueTemplateItems?: TemplatePermissionsResult[]\n\n  /**\n   * Similar to `EditReferenceChildLink` expect without the wrapping component\n   */\n  onEditReference?: (options: EditReferenceOptions) => void\n}\n\n/**\n * @internal\n */\nexport function useReferenceInputOptions() {\n  return useContext(Context)\n}\n\n/**\n * @internal\n */\nexport function ReferenceInputOptionsProvider(\n  props: ReferenceInputOptions & {children: ReactNode},\n) {\n  const {\n    children,\n    activePath,\n    EditReferenceLinkComponent,\n    onEditReference,\n    initialValueTemplateItems,\n  } = props\n\n  const contextValue = useMemo(\n    () => ({\n      activePath,\n      EditReferenceLinkComponent,\n      onEditReference,\n      initialValueTemplateItems,\n    }),\n    [activePath, EditReferenceLinkComponent, onEditReference, initialValueTemplateItems],\n  )\n\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>\n}\n","import {createContext} from 'react'\n\nimport {type ReviewChangesContextValue} from './types'\n\n/**\n * @internal\n */\nexport const ReviewChangesContext = createContext<ReviewChangesContextValue | null>(null)\n","import {createContext, type ReactNode, useContext, useMemo} from 'react'\n\nimport {getDraftId, getPublishedId} from '../../util'\n\nexport interface DocumentIdContextValue {\n  id: string\n}\n\nconst DocumentIdContext = createContext<DocumentIdContextValue | null>(null)\n\nexport function DocumentIdProvider(props: {id: string; children: ReactNode}) {\n  const value = useMemo(() => ({id: props.id}), [props.id])\n  return <DocumentIdContext.Provider value={value}>{props.children}</DocumentIdContext.Provider>\n}\n\nfunction useGivenDocumentId(): string {\n  const ctx = useContext(DocumentIdContext)\n  if (!ctx) {\n    throw new Error('useDocumentId must be used within a DocumentIdProvider')\n  }\n  return ctx.id\n}\n\n/**\n * @internal\n */\nexport function useDocumentIds() {\n  return {draft: useDraftId(), published: usePublishedId()}\n}\n\n/**\n * @deprecated Use `usePublishedId` instead\n */\nexport function useFormPublishedId(): string | undefined {\n  return usePublishedId()\n}\n\n/**\n * @internal\n */\nexport function usePublishedId(): string | undefined {\n  return getPublishedId(useGivenDocumentId())\n}\n\n/**\n * @internal\n */\nexport function useDraftId(): string | undefined {\n  return getDraftId(useGivenDocumentId())\n}\n","import {useCallback} from 'react'\nimport scrollIntoView from 'scroll-into-view-if-needed'\n\nimport {useDidUpdate} from './useDidUpdate'\n\n/**\n * A hook to help make sure the parent element of a value edited in a dialog (or \"out of band\") stays\n visible in the background\n * @param elementRef - The element to scroll into view when the proivided focusWithin changes from true to false\n * @param hasFocusWithin - A boolean indicating whether we have has focus within the currently edited value\n */\nexport function useScrollIntoViewOnFocusWithin(\n  elementRef: {current: HTMLElement | null},\n  hasFocusWithin: boolean,\n): void {\n  return useDidUpdate(\n    hasFocusWithin,\n    useCallback(\n      (hadFocus, hasFocus) => {\n        if (elementRef.current && !hadFocus && hasFocus) {\n          scrollIntoView(elementRef.current, {scrollMode: 'always'})\n        }\n      },\n      [elementRef],\n    ),\n  )\n}\n","import {DotIcon} from '@sanity/icons'\nimport {type PreviewValue, type SanityDocument} from '@sanity/types'\nimport {Text} from '@sanity/ui'\nimport {useMemo} from 'react'\nimport styled from 'styled-components'\n\ninterface DocumentStatusProps {\n  draft?: PreviewValue | Partial<SanityDocument> | null\n  published?: PreviewValue | Partial<SanityDocument> | null\n}\n\nconst Root = styled(Text)`\n  &[data-status='edited'] {\n    --card-icon-color: var(--card-badge-caution-dot-color);\n  }\n  &[data-status='unpublished'] {\n    --card-icon-color: var(--card-badge-default-dot-color);\n    opacity: 0.5 !important;\n  }\n`\n\n/**\n * Renders a dot indicating the current document status.\n *\n * - Yellow (caution) for published documents with edits\n * - Gray (default) for unpublished documents (with or without edits)\n *\n * No dot will be displayed for published documents without edits.\n *\n * @internal\n */\nexport function DocumentStatusIndicator({draft, published}: DocumentStatusProps) {\n  const $draft = !!draft\n  const $published = !!published\n\n  const status = useMemo(() => {\n    if ($draft && !$published) return 'unpublished'\n    return 'edited'\n  }, [$draft, $published])\n\n  // Return null if the document is:\n  // - Published without edits\n  // - Neither published or without edits (this shouldn't be possible)\n  if ((!$draft && !$published) || (!$draft && $published)) {\n    return null\n  }\n\n  return (\n    <Root data-status={status} size={1}>\n      <DotIcon />\n    </Root>\n  )\n}\n","import {type ObjectSchemaType} from '@sanity/types'\nimport {Badge, Box, Inline} from '@sanity/ui'\nimport {useMemo} from 'react'\n\nimport {type PreviewLayoutKey} from '../../../components'\nimport {DocumentStatus} from '../../../components/documentStatus'\nimport {DocumentStatusIndicator} from '../../../components/documentStatusIndicator'\nimport {DocumentPreviewPresence} from '../../../presence'\nimport {useDocumentPresence} from '../../../store'\nimport {type RenderPreviewCallback} from '../../types'\nimport {type ReferenceInfo} from './types'\n\n/**\n * Used to preview a referenced type\n * Takes the reference type as props\n */\nexport function ReferencePreview(props: {\n  id: string\n  preview: ReferenceInfo['preview']\n  refType: ObjectSchemaType\n  layout: PreviewLayoutKey\n  renderPreview: RenderPreviewCallback\n  showTypeLabel?: boolean\n}) {\n  const {id, layout, preview, refType, renderPreview, showTypeLabel} = props\n\n  const documentPresence = useDocumentPresence(id)\n\n  const previewId =\n    preview.draft?._id ||\n    preview.published?._id ||\n    // note: during publish of the referenced document we might have both a missing draft and a missing published version\n    // this happens because the preview system tries to optimistically re-fetch as soon as it sees a mutation, but\n    // when publishing, the draft is deleted, and therefore both the draft and the published may be missing for a brief\n    // moment before the published version appears. In this case, it's safe to fallback to the given id, which is always\n    // the published id\n    id\n\n  // Note: we can't pass the preview values as-is to the Preview-component here since it's a \"prepared\" value and the\n  // Preview component expects the \"raw\"/unprepared value. By passing only _id and _type we make sure the Preview-component\n  // resolve the preview value it needs (this is cached in the runtime, so not likely to cause any fetch overhead)\n  const previewStub = useMemo(\n    () => ({_id: previewId, _type: refType.name}),\n    [previewId, refType.name],\n  )\n\n  const {draft, published} = preview\n\n  const previewProps = useMemo(\n    () => ({\n      children: (\n        <Box paddingLeft={3}>\n          <Inline space={3}>\n            {showTypeLabel && <Badge mode=\"outline\">{refType.title}</Badge>}\n\n            {documentPresence && documentPresence.length > 0 && (\n              <DocumentPreviewPresence presence={documentPresence} />\n            )}\n\n            <DocumentStatusIndicator draft={preview.draft} published={preview.published} />\n          </Inline>\n        </Box>\n      ),\n      layout,\n      schemaType: refType,\n      tooltip: <DocumentStatus draft={draft} published={published} />,\n      value: previewStub,\n    }),\n    [\n      documentPresence,\n      draft,\n      layout,\n      preview.draft,\n      preview.published,\n      previewStub,\n      published,\n      refType,\n      showTypeLabel,\n    ],\n  )\n\n  return renderPreview(previewProps)\n}\n","import {AccessDeniedIcon, HelpCircleIcon} from '@sanity/icons'\nimport {type Reference, type ReferenceSchemaType} from '@sanity/types'\nimport {Badge, Box, Flex, Inline, Stack, Text} from '@sanity/ui'\nimport {type ComponentType, Fragment, type ReactNode} from 'react'\n\nimport {Tooltip} from '../../../../ui-components'\nimport {type PreviewLayoutKey, TextWithTone} from '../../../components'\nimport {useListFormat} from '../../../hooks'\nimport {Translate, useTranslation} from '../../../i18n'\nimport {SanityDefaultPreview} from '../../../preview'\nimport {type RenderPreviewCallback} from '../../types'\nimport {ReferencePreview} from './ReferencePreview'\nimport {type ReferenceInfo} from './types'\nimport {type Loadable} from './useReferenceInfo'\n\nexport function PreviewReferenceValue(props: {\n  layout?: PreviewLayoutKey\n  referenceInfo: Loadable<ReferenceInfo>\n  renderPreview: RenderPreviewCallback\n  type: ReferenceSchemaType\n  value: Reference\n  showTypeLabel?: boolean\n}) {\n  const {layout = 'default', referenceInfo, renderPreview, type, value, showTypeLabel} = props\n  const {t} = useTranslation()\n\n  if (referenceInfo.isLoading || referenceInfo.error) {\n    return <SanityDefaultPreview isPlaceholder layout={layout} />\n  }\n\n  // Special handling for \"create refs in place\"\n  // When a reference is created in place, the newly created document may not yet exist (or may have been deleted)\n  // This is a completely valid case, and we handle it by showing the preview for the referenced type\n  if (referenceInfo.result?.availability.reason === 'NOT_FOUND' && value._strengthenOnPublish) {\n    const refType = type.to.find((toType) => toType.name === value?._strengthenOnPublish?.type)\n    if (!refType) {\n      // This means that the reference document type (specified by _strengthenOnPublish.type)\n      // is not valid according to schema\n      return (\n        <InvalidType\n          documentId={value._ref}\n          actualType={value._strengthenOnPublish?.type}\n          declaredTypes={type.to.map((toType) => toType.name)}\n        />\n      )\n    }\n\n    // todo: figure out whether this check is necessary (can value._strengthenOnPublish.type ever be missing)\n    const stub = value._strengthenOnPublish?.type\n      ? {\n          _id: value._ref,\n          _type: value._strengthenOnPublish?.type,\n        }\n      : value\n\n    return (\n      <Flex align=\"center\">\n        <Box flex={1}>\n          {renderPreview({\n            layout,\n            schemaType: refType,\n            value: stub,\n            skipVisibilityCheck: true,\n          })}\n        </Box>\n        <Box>\n          <Inline space={4}>\n            {showTypeLabel && <Badge mode=\"outline\">{refType.title}</Badge>}\n          </Inline>\n        </Box>\n      </Flex>\n    )\n  }\n\n  const availability = referenceInfo.result.availability\n\n  const notFound = availability.reason === 'NOT_FOUND'\n  const insufficientPermissions = availability.reason === 'PERMISSION_DENIED'\n  if (insufficientPermissions || notFound) {\n    return (\n      <Inline space={2}>\n        <Box padding={1}>\n          <Flex align=\"center\">\n            <Box flex={1} paddingY={2}>\n              <Text muted>{t('inputs.reference.error.document-unavailable-title')}</Text>\n            </Box>\n          </Flex>\n        </Box>\n        {insufficientPermissions || notFound ? (\n          <Box>\n            <Tooltip\n              portal\n              content={\n                notFound ? (\n                  <UnavailableMessage\n                    title={t('inputs.reference.error.nonexistent-document-title')}\n                    icon={HelpCircleIcon}\n                  >\n                    <Translate\n                      i18nKey=\"inputs.reference.error.nonexistent-document-description\"\n                      t={t}\n                      values={{documentId: value._ref}}\n                    />\n                  </UnavailableMessage>\n                ) : (\n                  <UnavailableMessage\n                    title={t('inputs.reference.error.missing-read-permissions-title')}\n                    icon={AccessDeniedIcon}\n                  >\n                    {t('inputs.reference.error.missing-read-permissions-description')}\n                  </UnavailableMessage>\n                )\n              }\n            >\n              <TextWithTone tone=\"default\">\n                <HelpCircleIcon />\n              </TextWithTone>\n            </Tooltip>\n          </Box>\n        ) : null}\n      </Inline>\n    )\n  }\n\n  const refTypeName = referenceInfo.result?.type\n  const refType = type.to.find((toType) => toType.name === refTypeName)\n\n  if (!refType) {\n    return (\n      <InvalidType\n        documentId={value._ref}\n        // note: a missing refTypeName here means the document is either loading, doesn't exist or is unreadable by current role.\n        // These states should already have been covered by earlier checks\n        // eslint-disable-next-line @sanity/i18n/no-attribute-string-literals\n        actualType={refTypeName || '<unknown>'}\n        declaredTypes={type.to.map((toType) => toType.name)}\n      />\n    )\n  }\n\n  return (\n    <ReferencePreview\n      id={value._ref}\n      layout={layout}\n      preview={referenceInfo.result?.preview}\n      refType={refType}\n      renderPreview={renderPreview}\n      showTypeLabel={showTypeLabel}\n    />\n  )\n}\n\nfunction UnavailableMessage(props: {icon: ComponentType; children: ReactNode; title: ReactNode}) {\n  const Icon = props.icon\n  return (\n    <Flex>\n      <Text size={1}>\n        <Icon />\n      </Text>\n      <Box flex={1} marginLeft={3}>\n        <Text size={1} weight=\"medium\">\n          {props.title}\n        </Text>\n\n        <Box marginTop={3}>\n          <Text as=\"p\" muted size={1}>\n            {props.children}\n          </Text>\n        </Box>\n      </Box>\n    </Flex>\n  )\n}\n\nfunction InvalidType({\n  declaredTypes,\n  documentId,\n  actualType,\n}: {\n  documentId: string\n  actualType: string\n  declaredTypes: string[]\n}) {\n  const {t} = useTranslation()\n\n  return (\n    <Flex align=\"center\" justify=\"flex-start\">\n      <Box padding={1}>\n        <Flex align=\"center\">\n          <Box flex={1} paddingY={2}>\n            <Text muted>{t('inputs.reference.error.invalid-type-title')}</Text>\n          </Box>\n        </Flex>\n      </Box>\n      <Box>\n        <Tooltip\n          portal\n          content={\n            <Stack space={3}>\n              <Text size={1}>\n                <Translate\n                  t={t}\n                  i18nKey=\"inputs.reference.error.invalid-type-description\"\n                  values={{documentId, actualType}}\n                  components={{\n                    AllowedTypes: () => <HumanizedList values={declaredTypes} />,\n                  }}\n                />\n              </Text>\n            </Stack>\n          }\n        >\n          <Box padding={2}>\n            <TextWithTone tone=\"default\">\n              <HelpCircleIcon />\n            </TextWithTone>\n          </Box>\n        </Tooltip>\n      </Box>\n    </Flex>\n  )\n}\n\nfunction HumanizedList(props: {values: string[]}) {\n  const listFormat = useListFormat({type: 'disjunction'})\n  const parts = listFormat.formatToParts(props.values)\n  return (\n    <Fragment>\n      {parts.map((segment) =>\n        segment.type === 'element' ? (\n          <code key={segment.value}>{segment.value}</code>\n        ) : (\n          segment.value\n        ),\n      )}\n    </Fragment>\n  )\n}\n","import {ErrorOutlineIcon, InfoOutlineIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Card, type CardProps, Flex} from '@sanity/ui'\nimport {type HTMLProps, type ReactNode} from 'react'\n\nimport {Details} from './Details'\n\ninterface AlertProps extends Omit<CardProps, 'title'> {\n  title: ReactNode\n  status?: 'warning' | 'error' | 'info'\n}\n\nconst STATUS_TONES = {\n  warning: 'caution',\n  error: 'critical',\n  info: 'positive',\n} as const\n\nconst STATUS_ICONS = {\n  warning: <WarningOutlineIcon />,\n  error: <ErrorOutlineIcon />,\n  info: <InfoOutlineIcon />,\n}\n\nexport function AlertStrip(props: AlertProps & Omit<HTMLProps<HTMLDivElement>, 'ref'>) {\n  const {children, status = 'warning', title, ...rest} = props\n\n  return (\n    <Card radius={2} tone={STATUS_TONES[status]} {...rest} data-ui=\"Alert\">\n      <Flex padding={1}>\n        {children && (\n          <Box flex={1}>\n            <Details icon={STATUS_ICONS[status]} title={title}>\n              <Box marginLeft={3} marginTop={3}>\n                {children}\n              </Box>\n            </Details>\n          </Box>\n        )}\n      </Flex>\n    </Card>\n  )\n}\n","import {type ReferenceSchemaType} from '@sanity/types'\nimport {Stack, Text} from '@sanity/ui'\n\nimport {Button} from '../../../../ui-components'\nimport {Translate, useTranslation} from '../../../i18n'\nimport {AlertStrip} from '../../components/AlertStrip'\n\n/**\n * Alert strip that shows an explanation and action prompting the user to finalize a reference,\n * in the case where a `strengthen on publish` flag is set and the remote document exists.\n *\n * @internal\n */\nexport function ReferenceFinalizeAlertStrip({\n  schemaType,\n  handleRemoveStrengthenOnPublish,\n}: {\n  schemaType: ReferenceSchemaType\n  handleRemoveStrengthenOnPublish: () => void\n}) {\n  const {t} = useTranslation()\n  return (\n    <AlertStrip\n      padding={1}\n      title={t(\n        schemaType.weak\n          ? 'inputs.reference.incomplete-reference.finalize-action-title'\n          : 'inputs.reference.incomplete-reference.strengthen-action-title',\n      )}\n      status=\"info\"\n      data-testid=\"alert-reference-published\"\n    >\n      <Stack space={3}>\n        <Text as=\"p\" muted size={1}>\n          <Translate\n            t={t}\n            i18nKey={\n              schemaType.weak\n                ? 'inputs.reference.incomplete-reference.finalize-action-description'\n                : 'inputs.reference.incomplete-reference.strengthen-action-description'\n            }\n          />\n        </Text>\n        <Button\n          mode=\"ghost\"\n          onClick={handleRemoveStrengthenOnPublish}\n          size=\"large\"\n          text={t('inputs.reference.incomplete-reference.strengthen-button-label')}\n          tone=\"positive\"\n        />\n      </Stack>\n    </AlertStrip>\n  )\n}\n","import {Card, type CardProps} from '@sanity/ui'\nimport {type ForwardedRef, forwardRef, type HTMLProps} from 'react'\nimport styled from 'styled-components'\n\nexport const StyledCard = styled(Card)`\n  /* this is a hack to avoid layout jumps while previews are loading\n     there's probably better ways of solving this */\n  min-height: 33px;\n  position: relative;\n\n  /* TextWithTone uses its own logic to set color, and we therefore need */\n  /* to override this logic in order to set the correct color in different states */\n  &[data-selected],\n  &[data-pressed],\n  &:active {\n    [data-ui='TextWithTone'] {\n      color: inherit;\n    }\n  }\n`\n\ninterface ReferenceLinkCardProps extends CardProps {\n  as: any\n  documentId: string\n  documentType: string | undefined\n}\n\nexport const ReferenceLinkCard = forwardRef(function ReferenceLinkCard(\n  props: ReferenceLinkCardProps & HTMLProps<HTMLElement>,\n  ref: ForwardedRef<HTMLElement>,\n) {\n  const {as, documentId, documentType, ...cardProps} = props\n\n  // If the child link is clicked without a document type, an error will be thrown.\n  // This usually happens when the link is clicked before the document type has been resolved.\n  // In this case, we don't want to pass the `as`/`forwardedAs` props to the Card component, as it will throw an error.\n  const linkProps = documentId &&\n    documentType && {\n      // this will make @sanity/ui style it as a link\n      'data-as': 'a',\n      // this determines the actual tag inserted into the DOM (either a HTML element or a component)\n      forwardedAs: as,\n      documentId: documentId,\n      documentType: documentType,\n    }\n\n  return (\n    <StyledCard\n      {...cardProps}\n      {...linkProps}\n      data-ui=\"ReferenceLinkCard\"\n      ref={ref as unknown as ForwardedRef<HTMLDivElement>}\n    />\n  )\n})\n","import {Stack, Text} from '@sanity/ui'\n\nimport {Button} from '../../../../ui-components'\nimport {useTranslation} from '../../../i18n'\nimport {AlertStrip} from '../../components/AlertStrip'\n\n/**\n * Alert strip that shows error encountered while fetching reference metadata, and allowing user\n * to retry the operation.\n *\n * @internal\n */\nexport function ReferenceMetadataLoadErrorAlertStrip({\n  errorMessage,\n  onHandleRetry,\n}: {\n  errorMessage: string\n  onHandleRetry: () => void\n}) {\n  const {t} = useTranslation()\n  return (\n    <AlertStrip\n      padding={1}\n      title={t('inputs.reference.metadata-error.title')}\n      status=\"warning\"\n      data-testid=\"alert-reference-info-failed\"\n    >\n      <Stack space={3}>\n        <Text as=\"p\" muted size={1}>\n          {errorMessage}\n        </Text>\n        <Button\n          mode=\"ghost\"\n          onClick={onHandleRetry}\n          size=\"large\"\n          text={t('inputs.reference.metadata-error.retry-button-label')}\n          tone=\"primary\"\n        />\n      </Stack>\n    </AlertStrip>\n  )\n}\n","import {Stack, Text} from '@sanity/ui'\n\nimport {Button} from '../../../../ui-components'\nimport {Translate, useTranslation} from '../../../i18n'\nimport {AlertStrip} from '../../components/AlertStrip'\n\n/**\n * Alert strip that shows an explanation and action prompting the user to fix a mismatch in\n * reference strength, eg when the schema declares it should be weak, but the reference is actually\n * strong, or wise versa.\n *\n * @internal\n */\nexport function ReferenceStrengthMismatchAlertStrip({\n  actualStrength,\n  handleFixStrengthMismatch,\n}: {\n  actualStrength: 'weak' | 'strong'\n  handleFixStrengthMismatch: () => void\n}) {\n  const shouldBe = actualStrength === 'weak' ? 'strong' : 'weak'\n  const {t} = useTranslation()\n  return (\n    <AlertStrip\n      padding={1}\n      title={t('inputs.reference.strength-mismatch.title')}\n      status=\"warning\"\n      data-testid=\"alert-reference-strength-mismatch\"\n    >\n      <Stack space={3}>\n        <Text as=\"p\" muted size={1}>\n          <Translate\n            t={t}\n            i18nKey={\n              actualStrength === 'weak'\n                ? 'inputs.reference.strength-mismatch.is-weak-description'\n                : 'inputs.reference.strength-mismatch.is-strong-description'\n            }\n          />\n        </Text>\n\n        <Text as=\"p\" muted size={1}>\n          {t(\n            shouldBe === 'weak'\n              ? 'inputs.reference.strength-mismatch.is-strong-consquences'\n              : 'inputs.reference.strength-mismatch.is-weak-consquences',\n          )}\n        </Text>\n        <Button\n          mode=\"ghost\"\n          onClick={handleFixStrengthMismatch}\n          size=\"large\"\n          text={t(\n            shouldBe === 'weak'\n              ? 'inputs.reference.strength-mismatch.weaken-button-label'\n              : 'inputs.reference.strength-mismatch.strengthen-button-label',\n          )}\n          tone=\"caution\"\n        />\n      </Stack>\n    </AlertStrip>\n  )\n}\n","import {useCallback, useMemo} from 'react'\nimport {useMemoObservable} from 'react-rx'\nimport {concat, type Observable, of, Subject} from 'rxjs'\nimport {catchError, concatMap, map, startWith} from 'rxjs/operators'\n\nimport {usePrevious} from '../../hooks/usePrevious'\nimport {type ReferenceInfo} from './types'\n\nconst noop = () => undefined\n\nconst INITIAL_LOADING_STATE: Loadable<ReferenceInfo> = {\n  isLoading: true,\n  result: undefined,\n  error: undefined,\n  retry: noop,\n}\n\nconst EMPTY_STATE: Loadable<any> = {\n  isLoading: false,\n  result: undefined,\n  error: undefined,\n  retry: noop,\n}\n\nexport type Loadable<T> =\n  | {isLoading: true; result: undefined; error: undefined; retry: () => void}\n  | {isLoading: false; result: T; error: undefined; retry: () => void}\n  | {isLoading: false; result: undefined; error: Error; retry: () => void}\n\ntype GetReferenceInfo = (id: string) => Observable<ReferenceInfo>\n\nexport function useReferenceInfo(\n  id: string | undefined,\n  getReferenceInfo: GetReferenceInfo,\n): Loadable<ReferenceInfo> {\n  // NOTE: this is a small message queue to handle retries\n  const msgSubject = useMemo(() => new Subject<{type: 'retry'}>(), [])\n  const msg$ = useMemo(() => msgSubject.asObservable(), [msgSubject])\n\n  const retry = useCallback(() => {\n    msgSubject.next({type: 'retry'})\n  }, [msgSubject])\n\n  const referenceInfo = useMemoObservable(\n    () =>\n      concat(of(null), msg$).pipe(\n        map(() => id),\n        concatMap((refId: string | undefined) =>\n          refId\n            ? getReferenceInfo(refId).pipe(\n                map((result) => {\n                  return {\n                    isLoading: false,\n                    result,\n                    error: undefined,\n                    retry,\n                  } as const\n                }),\n                startWith(INITIAL_LOADING_STATE),\n                catchError((err: Error) => {\n                  console.error(err)\n                  return of({isLoading: false, result: undefined, error: err, retry} as const)\n                }),\n              )\n            : of(EMPTY_STATE),\n        ),\n      ),\n    [getReferenceInfo, id, msg$, retry],\n    INITIAL_LOADING_STATE,\n  )\n\n  // @todo test and see if this were fixed in `react-rx@2.1.x`\n  // workaround for a \"bug\" with useMemoObservable that doesn't\n  // return the initial value upon resubscription\n  const previousId = usePrevious(id, id)\n  if (id && previousId !== id) {\n    return INITIAL_LOADING_STATE\n  }\n  return referenceInfo\n}\n","import {type Path} from '@sanity/types'\nimport {pathFor} from '@sanity/util/paths'\nimport {createContext, type ReactNode, useContext, useMemo} from 'react'\n\nimport {getValueAtPath} from '../../field'\nimport {type FormDocumentValue} from '../types'\n\n/**\n * @internal\n * @hidden\n */\nexport interface FormValueContextValue {\n  value: FormDocumentValue | undefined\n}\n\nconst FormValueContext = createContext<FormValueContextValue | null>(null)\n\n/**\n *\n * @internal\n * @hidden\n */\nexport function FormValueProvider(props: {\n  value: FormDocumentValue | undefined\n  children: ReactNode\n}) {\n  const value = useMemo(() => ({value: props.value}), [props.value])\n  return <FormValueContext.Provider value={value}>{props.children}</FormValueContext.Provider>\n}\n\n/**\n * React hook that returns the value of the field specified by a path.\n * @public\n *\n * @param path - An array notation with segments that are either strings representing field names, index integers for arrays with simple values, or objects with a _key for arrays containing objects\n *\n * @returns The value of the field specified by the path\n *\n * @example Using the `useFormValue` hook\n * ```ts\n * function MyComponent() {\n *    // get value of field 'name' in object 'author'\n *    const authorName = useFormValue(['author', 'name'])\n *    // get value of the second item in array 'tags' of type 'string'\n *    const secondTag = useFormValue(['tags', 1])\n *    // get value of the reference with the matching key in an array of references\n *    const specificBook = useFormValue([ 'bibliography', {_key: '<key>'} ])\n *   // ... do something with the form values ...\n * }\n * ```\n */\n\nexport function useFormValue(path: Path): unknown {\n  const uniquePath = pathFor(path)\n  const ctx = useContext(FormValueContext)\n  if (!ctx) {\n    throw new Error('useFormValue must be used within a FormValueProvider')\n  }\n\n  return getValueAtPath(ctx?.value, uniquePath)\n}\n","import {type CrossDatasetType, type SchemaType, type SearchConfiguration} from '@sanity/types'\nimport {toString as pathToString} from '@sanity/util/paths'\n\nimport {isRecord} from '../../util'\nimport {type SearchPath, type SearchSpec} from './types'\n\ninterface SearchWeightEntry {\n  path: string\n  weight: number\n  type: 'string' | 'pt'\n}\n\nconst CACHE = new WeakMap<SchemaType | CrossDatasetType, SearchSpec>()\nconst PREVIEW_FIELD_WEIGHT_MAP = {\n  title: 10,\n  subtitle: 5,\n  description: 1.5,\n}\nconst BASE_WEIGHTS: Record<string, Omit<SearchWeightEntry, 'path'>> = {\n  _id: {weight: 1, type: 'string'},\n  _type: {weight: 1, type: 'string'},\n}\nconst builtInObjectTypes = ['reference', 'crossDatasetReference']\n\nconst getTypeChain = (type: SchemaType | undefined): SchemaType[] =>\n  type ? [type, ...getTypeChain(type.type)] : []\n\nconst isPtField = (type: SchemaType | undefined) =>\n  type?.jsonType === 'array' &&\n  type.of.some((arrType) => getTypeChain(arrType).some(({name}) => name === 'block'))\n\nconst isStringField = (schemaType: SchemaType | undefined) =>\n  getTypeChain(schemaType).some((type) => type.name === 'string')\n\nconst isSearchConfiguration = (options: unknown): options is SearchConfiguration =>\n  isRecord(options) && 'search' in options && isRecord(options.search)\n\nfunction isSchemaType(input: SchemaType | CrossDatasetType | undefined): input is SchemaType {\n  return typeof input !== 'undefined' && 'name' in input\n}\n\nfunction getLeafWeights(\n  schemaType: SchemaType | CrossDatasetType | undefined,\n  maxDepth: number,\n  getWeight: (schemaType: SchemaType, path: string) => number | null,\n): Record<string, SearchWeightEntry> {\n  function traverse(\n    type: SchemaType | undefined,\n    path: string,\n    depth: number,\n  ): SearchWeightEntry[] {\n    if (!type) return []\n    if (depth > maxDepth) return []\n\n    const typeChain = getTypeChain(type)\n\n    if (isStringField(type) || isPtField(type)) {\n      const weight = getWeight(type, path)\n\n      if (typeof weight !== 'number') return []\n      return [{path, weight, type: isPtField(type) ? 'pt' : 'string'}]\n    }\n\n    const results: SearchWeightEntry[] = []\n    const objectTypes = typeChain.filter(\n      (t): t is Extract<SchemaType, {jsonType: 'object'}> =>\n        t.jsonType === 'object' && !!t.fields?.length && !builtInObjectTypes.includes(t.name),\n    )\n    for (const objectType of objectTypes) {\n      for (const field of objectType.fields) {\n        const nextPath = pathToString([path, field.name].filter(Boolean))\n        results.push(...traverse(field.type, nextPath, depth + 1))\n      }\n    }\n\n    const arrayTypes = typeChain.filter(\n      (t): t is Extract<SchemaType, {jsonType: 'array'}> =>\n        t.jsonType === 'array' && !!t.of?.length,\n    )\n    for (const arrayType of arrayTypes) {\n      for (const arrayItemType of arrayType.of) {\n        const nextPath = `${path}[]`\n        results.push(...traverse(arrayItemType, nextPath, depth + 1))\n      }\n    }\n\n    return results\n  }\n\n  // Cross Dataset Reference are not part of the schema, so we should not attempt to reconcile them.\n  if (!isSchemaType(schemaType)) {\n    return {}\n  }\n\n  return traverse(schemaType, '', 0).reduce<Record<string, SearchWeightEntry>>(\n    (acc, {path, weight, type}) => {\n      acc[path] = {weight, type, path}\n      return acc\n    },\n    {},\n  )\n}\n\nconst getUserSetWeight = (schemaType: SchemaType) => {\n  const searchOptions = getTypeChain(schemaType)\n    .map((type) => type.options)\n    .find(isSearchConfiguration)\n\n  return typeof searchOptions?.search?.weight === 'number' ? searchOptions.search.weight : null\n}\n\nconst getHiddenWeight = (schemaType: SchemaType) => {\n  const hidden = getTypeChain(schemaType).some((type) => type.hidden)\n  return hidden ? 0 : null\n}\n\nconst getDefaultWeights = (schemaType: SchemaType) => {\n  // if there is no user set weight or a `0` weight due to be hidden,\n  // then we can return the default weight of `1`\n  const result = getUserSetWeight(schemaType) ?? getHiddenWeight(schemaType)\n  return typeof result === 'number' ? null : 1\n}\n\nconst getPreviewWeights = (\n  schemaType: SchemaType | CrossDatasetType | undefined,\n  maxDepth: number,\n  isCrossDataset?: boolean,\n): Record<string, SearchWeightEntry> | null => {\n  const select = schemaType?.preview?.select\n  if (!select) return null\n\n  const selectionKeysBySelectionPath = Object.fromEntries(\n    Object.entries(select).map(([selectionKey, selectionPath]) => [\n      // replace indexed paths with `[]`\n      // e.g. `arrayOfObjects.0.myField` becomes `arrayOfObjects[].myField`\n      selectionPath.replace(/\\.\\d+/g, '[]'),\n      selectionKey,\n    ]),\n  )\n\n  const defaultWeights = getLeafWeights(schemaType, maxDepth, getDefaultWeights)\n  const nestedWeightsBySelectionPath = Object.fromEntries(\n    Object.entries(defaultWeights)\n      .map(([path, {type}]) => ({path, type}))\n      .filter(({path}) => selectionKeysBySelectionPath[path])\n      .map(({path, type}) => [\n        path,\n        {\n          type,\n          weight:\n            PREVIEW_FIELD_WEIGHT_MAP[\n              selectionKeysBySelectionPath[path] as keyof typeof PREVIEW_FIELD_WEIGHT_MAP\n            ],\n        },\n      ]),\n  )\n\n  if (isCrossDataset) {\n    return Object.fromEntries(\n      Object.values(selectionKeysBySelectionPath).map((path) => {\n        return [\n          path,\n          {\n            path,\n            type: 'string',\n            weight: PREVIEW_FIELD_WEIGHT_MAP[path as keyof typeof PREVIEW_FIELD_WEIGHT_MAP],\n          },\n        ]\n      }),\n    )\n  }\n\n  return getLeafWeights(schemaType, maxDepth, (_, path) => {\n    const nested = nestedWeightsBySelectionPath[path]\n    return nested ? nested.weight : null\n  })\n}\n\nexport interface DeriveSearchWeightsFromTypeOptions {\n  schemaType: SchemaType | CrossDatasetType\n  maxDepth: number\n  isCrossDataset?: boolean\n  processPaths?: (paths: SearchPath[]) => SearchPath[]\n}\n\nexport function deriveSearchWeightsFromType({\n  schemaType,\n  maxDepth,\n  isCrossDataset,\n  processPaths = (paths) => paths,\n}: DeriveSearchWeightsFromTypeOptions): SearchSpec {\n  const cached = CACHE.get(schemaType)\n  if (cached) return cached\n\n  const userSetWeights = getLeafWeights(schemaType, maxDepth, getUserSetWeight)\n  const hiddenWeights = getLeafWeights(schemaType, maxDepth, getHiddenWeight)\n  const defaultWeights = getLeafWeights(schemaType, maxDepth, getDefaultWeights)\n  const previewWeights = getPreviewWeights(schemaType, maxDepth, isCrossDataset)\n\n  const weights: Record<string, Omit<SearchWeightEntry, 'path'>> = {\n    ...BASE_WEIGHTS,\n    ...defaultWeights,\n    ...hiddenWeights,\n    ...previewWeights,\n    ...userSetWeights,\n  }\n\n  const result = {\n    typeName: isSchemaType(schemaType) ? schemaType.name : schemaType.type,\n    paths: processPaths(\n      Object.entries(weights).map(([path, {type, weight}]) => ({\n        path,\n        weight,\n        ...(type === 'pt' && {mapWith: 'pt::text'}),\n      })),\n    ),\n  }\n\n  CACHE.set(schemaType, result)\n  return result\n}\n","import {type ObjectSchemaType, type Schema, type SchemaType} from '@sanity/types'\n\nimport {isNonNullable} from '../../util/isNonNullable'\n\nconst isDocumentType = (type: SchemaType): type is ObjectSchemaType =>\n  Boolean(type.type && type.type.name === 'document')\n\nconst isIgnoredType = (type: SchemaType): boolean =>\n  type.name.startsWith('sanity.') && type.name !== 'sanity.previewUrlSecret'\n\n/**\n * @internal\n */\nexport const getSearchableTypes = (schema: Schema): ObjectSchemaType[] =>\n  schema\n    .getTypeNames()\n    .map((typeName) => schema.get(typeName))\n    .filter(isNonNullable)\n    .filter(isDocumentType)\n    .filter((type) => !isIgnoredType(type))\n","import {DEFAULT_MAX_FIELD_DEPTH} from '@sanity/schema/_internal'\nimport {type CrossDatasetType, type SanityDocumentLike, type SchemaType} from '@sanity/types'\nimport {map} from 'rxjs/operators'\n\nimport {removeDupes} from '../../util/draftUtils'\nimport {\n  deriveSearchWeightsFromType,\n  type SearchOptions,\n  type SearchPath,\n  type SearchSort,\n  type SearchStrategyFactory,\n  type SearchTerms,\n  type TextSearchDocumentTypeConfiguration,\n  type TextSearchOrder,\n  type TextSearchParams,\n  type TextSearchResponse,\n  type TextSearchResults,\n} from '../common'\n\nconst DEFAULT_LIMIT = 1000\n\nfunction normalizeSearchTerms(\n  searchParams: string | SearchTerms,\n  fallbackTypes: (SchemaType | CrossDatasetType)[],\n) {\n  if (typeof searchParams === 'string') {\n    return {\n      query: searchParams,\n      types: fallbackTypes,\n    }\n  }\n\n  return {\n    ...searchParams,\n    types: searchParams.types.length ? searchParams.types : fallbackTypes,\n  }\n}\n\nfunction optimizeSearchWeights(paths: SearchPath[]): SearchPath[] {\n  return paths.filter((path) => path.weight !== 1)\n}\n\nexport function getDocumentTypeConfiguration(\n  searchOptions: SearchOptions,\n  searchTerms: ReturnType<typeof normalizeSearchTerms>,\n): Record<string, TextSearchDocumentTypeConfiguration> {\n  const specs = searchTerms.types\n    .map((schemaType) =>\n      deriveSearchWeightsFromType({\n        schemaType,\n        maxDepth: searchOptions.maxDepth || DEFAULT_MAX_FIELD_DEPTH,\n        processPaths: optimizeSearchWeights,\n      }),\n    )\n    .filter(({paths}) => paths.length)\n\n  return specs.reduce<Record<string, TextSearchDocumentTypeConfiguration>>((nextTypes, spec) => {\n    return {\n      ...nextTypes,\n      [spec.typeName]: spec.paths.reduce<TextSearchDocumentTypeConfiguration>(\n        (nextType, {path, weight}) => {\n          return {\n            ...nextType,\n            weights: {\n              ...nextType.weights,\n              [path]: weight,\n            },\n          }\n        },\n        {},\n      ),\n    }\n  }, {})\n}\n\nexport function getOrder(sort: SearchSort[] = []): TextSearchOrder[] {\n  return sort.map<TextSearchOrder>(\n    ({field, direction}) => ({\n      attribute: field,\n      direction,\n    }),\n    {},\n  )\n}\n\n/**\n * @internal\n */\nexport const createTextSearch: SearchStrategyFactory<TextSearchResults> = (\n  typesFromFactory,\n  client,\n  factoryOptions,\n) => {\n  // Search currently supports both strings (reference + cross dataset reference inputs)\n  // or a SearchTerms object (omnisearch).\n  return function search(searchParams, searchOptions = {}) {\n    const searchTerms = normalizeSearchTerms(searchParams, typesFromFactory)\n\n    // Construct search filters used in this GROQ query\n    const filters = [\n      '_type in $__types',\n      searchOptions.includeDrafts === false && \"!(_id in path('drafts.**'))\",\n      factoryOptions.filter ? `(${factoryOptions.filter})` : false,\n      searchTerms.filter ? `(${searchTerms.filter})` : false,\n    ].filter((baseFilter): baseFilter is string => Boolean(baseFilter))\n\n    const textSearchParams: TextSearchParams = {\n      query: {string: searchTerms.query},\n      filter: filters.join(' && '),\n      params: {\n        __types: searchTerms.types.map((type) => ('name' in type ? type.name : type.type)),\n        ...factoryOptions.params,\n        ...searchTerms.params,\n      },\n      types: getDocumentTypeConfiguration(searchOptions, searchTerms),\n      order: getOrder(searchOptions.sort),\n      includeAttributes: ['_id', '_type'],\n      fromCursor: searchOptions.cursor,\n      limit: searchOptions.limit ?? DEFAULT_LIMIT,\n    }\n\n    return client.observable\n      .request<TextSearchResponse<SanityDocumentLike>>({\n        uri: `/data/textsearch/${client.config().dataset}`,\n        method: 'POST',\n        json: true,\n        body: textSearchParams,\n        tag: factoryOptions.tag,\n      })\n      .pipe(\n        map((response) => {\n          let documents = response.hits.map((hit) => hit.attributes)\n          if (factoryOptions.unique) {\n            documents = removeDupes(documents)\n          }\n\n          return {\n            type: 'text',\n            hits: documents.map((hit) => ({hit})),\n            nextCursor: response.nextCursor,\n          }\n        }),\n      )\n  }\n}\n","import {type SanityDocumentLike} from '@sanity/types'\nimport {compact, intersection, keyBy, partition, toLower, union, uniq, words} from 'lodash'\n\nimport {type SearchSpec, type WeightedHit} from '../common'\n\ntype SearchScore = [number, string]\n\n/**\n * Takes a set of terms and a value and returns a [score, story] pair where score is a value between 0, 1 and story is the explanation.\n *\n * @internal\n */\nexport const calculateScore = (searchTerms: string[], value: string): SearchScore => {\n  // Separate search terms by phrases (wrapped with quotes) and words.\n  const {phrases: uniqueSearchPhrases, words: uniqueSearchWords} =\n    partitionAndSanitizeSearchTerms(searchTerms)\n\n  // Calculate an aggregated score of both phrase and word matches.\n  const [phraseScore, phraseWhy] = calculatePhraseScore(uniqueSearchPhrases, value)\n  const [wordScore, wordWhy] = calculateWordScore(uniqueSearchWords, value)\n  return [phraseScore + wordScore, [wordWhy, phraseWhy].join(', ')]\n}\n\nconst stringify = (value: unknown): string =>\n  typeof value === 'string' ? value : JSON.stringify(value)\n\n/**\n * @internal\n */\nexport function applyWeights(\n  searchSpec: SearchSpec[],\n  hits: SanityDocumentLike[],\n  terms: string[] = [],\n): WeightedHit[] {\n  const specByType = keyBy(searchSpec, (spec) => spec.typeName)\n  return hits.map((hit, index) => {\n    const typeSpec = specByType[hit._type]\n    const stories = (typeSpec.paths || [])?.map((pathSpec, idx) => {\n      const value = stringify(hit[`w${idx}`])\n      if (!value) {\n        return {path: pathSpec.path, score: 0, why: 'No match'}\n      }\n      const [score, why] = calculateScore(terms, value)\n      return {\n        path: pathSpec.path,\n        score: score * pathSpec.weight,\n        why: `${why} (*${pathSpec.weight})`,\n      }\n    })\n\n    const totalScore = stories.reduce((acc, rank) => acc + rank.score, 0)\n\n    return {hit, resultIndex: hits.length - index, score: totalScore, stories: stories}\n  })\n}\n/**\n * For phrases: score on the total number of matching characters.\n * E.g. given the phrases [\"the fox\", \"of london\"] for the target value \"the wily fox of london\"\n *\n * - \"the fox\" isn't included in the target value (score: 0)\n * - \"of london\" is included in the target value, and 9 out of 22 characters match (score: 9/22 = ~0.408)\n * - non-exact matches have their score divided in half (final score: ~0.204)\n *\n * @internal\n */\nexport function calculatePhraseScore(uniqueSearchPhrases: string[], value: string): SearchScore {\n  const sanitizedValue = value.toLowerCase().trim()\n\n  let fieldScore = 0\n  let matchCount = 0\n  uniqueSearchPhrases.forEach((term) => {\n    if (sanitizedValue.includes(term)) {\n      fieldScore += term.length / sanitizedValue.length\n      matchCount += term.length\n    }\n  })\n\n  return fieldScore === 1\n    ? [1, '[Phrase] Exact match']\n    : [fieldScore / 2, `[Phrase] Matched ${matchCount} of ${sanitizedValue.length} characters`]\n}\n\n/**\n * For words: score on the total number of matching words.\n * E.g. given the words [\"the\", \"fox\", \"of\", \"london\"] for the target value \"the wily fox of london\"\n *\n * - 4 out of 5 words match (score: 4/5 = 0.8)\n * - non-exact matches have their score divided in half (final score: 0.4)\n *\n * @internal\n */\nexport function calculateWordScore(uniqueSearchTerms: string[], value: string): SearchScore {\n  const uniqueValueTerms = uniq(compact(words(toLower(value))))\n\n  const matches = intersection(uniqueSearchTerms, uniqueValueTerms)\n  const all = union(uniqueValueTerms, uniqueSearchTerms)\n  const fieldScore = matches.length / all.length\n  return fieldScore === 1\n    ? [1, '[Word] Exact match']\n    : [\n        fieldScore / 2,\n        `[Word] Matched ${matches.length} of ${all.length} terms: [${matches.join(', ')}]`,\n      ]\n}\n\n/**\n * @internal\n */\nexport function partitionAndSanitizeSearchTerms(searchTerms: string[]): {\n  phrases: string[]\n  words: string[]\n} {\n  const uniqueSearchTerms = uniq(searchTerms.map(toLower))\n\n  const [searchPhrases, searchWords] = partition(uniqueSearchTerms, (term) => /^\".*\"$/.test(term))\n  return {\n    phrases: uniq(searchPhrases).map(toLower).map(stripWrappingQuotes), //\n    words: uniq(searchWords.map(toLower)),\n  }\n}\n\nfunction stripWrappingQuotes(str: string) {\n  return str.replace(/^\"(.*)\"$/, '$1')\n}\n","// Findability version, prepended to every search query for future measurement\nexport const FINDABILITY_MVI = 4\n","import {DEFAULT_MAX_FIELD_DEPTH} from '@sanity/schema/_internal'\nimport {type CrossDatasetType, type SchemaType} from '@sanity/types'\nimport {compact, flatten, flow, toLower, trim, union, uniq, words} from 'lodash'\n\nimport {\n  deriveSearchWeightsFromType,\n  type SearchFactoryOptions,\n  type SearchOptions,\n  type SearchPath,\n  type SearchSort,\n  type SearchSpec,\n  type SearchTerms,\n} from '../common'\nimport {FINDABILITY_MVI} from '../constants'\n\nexport interface SearchParams {\n  __types: string[]\n  __limit: number\n  [key: string]: unknown\n}\n\nexport interface SearchQuery {\n  query: string\n  params: SearchParams\n  options: Record<string, unknown>\n  searchSpec: SearchSpec[]\n  terms: string[]\n}\n\nexport const DEFAULT_LIMIT = 1000\n\nconst combinePaths: (paths: string[][]) => string[] = flow([flatten, union, compact])\n\nconst pathWithMapper = ({mapWith, path}: SearchPath): string =>\n  mapWith ? `${mapWith}(${path})` : path\n\n/**\n * Create GROQ constraints, given search terms and the full spec of available document types and fields.\n * Essentially a large list of all possible fields (joined by logical OR) to match our search terms against.\n */\nfunction createConstraints(terms: string[], specs: SearchSpec[]) {\n  const combinedSearchPaths = combinePaths(\n    specs.map((configForType) => (configForType.paths || []).map((opt) => pathWithMapper(opt))),\n  )\n\n  const constraints = terms\n    .map((_term, i) => combinedSearchPaths.map((joinedPath) => `${joinedPath} match $t${i}`))\n    .filter((constraint) => constraint.length > 0)\n\n  return constraints.map((constraint) => `(${constraint.join(' || ')})`)\n}\n\nconst SPECIAL_CHARS = /([^!@#$%^&*(),\\\\/?\";:{}|[\\]+<>\\s-])+/g\nconst STRIP_EDGE_CHARS = /(^[.]+)|([.]+$)/\n\nexport function tokenize(string: string): string[] {\n  return (string.match(SPECIAL_CHARS) || []).map((token) => token.replace(STRIP_EDGE_CHARS, ''))\n}\n\n/**\n * Convert a string into an array of tokenized terms.\n *\n * Any (multi word) text wrapped in double quotes will be treated as \"phrases\", or separate tokens that\n * will not have its special characters removed.\n * E.g.`\"the\" \"fantastic mr\" fox fox book` =\\> [\"the\", `\"fantastic mr\"`, \"fox\", \"book\"]\n *\n * Phrases wrapped in quotes are assigned relevance scoring differently from regular words.\n *\n * @internal\n */\nexport function extractTermsFromQuery(query: string): string[] {\n  const quotedQueries = [] as string[]\n  const unquotedQuery = query.replace(/(\"[^\"]*\")/g, (match) => {\n    if (words(match).length > 1) {\n      quotedQueries.push(match)\n      return ''\n    }\n    return match\n  })\n\n  // Lowercase and trim quoted queries\n  const quotedTerms = quotedQueries.map((str) => trim(toLower(str)))\n\n  /**\n   * Convert (remaining) search query into an array of deduped, sanitized tokens.\n   * All white space and special characters are removed.\n   * e.g. \"The saint of Saint-Germain-des-Prs\" =\\> ['the', 'saint', 'of', 'germain', 'des', 'pres']\n   */\n  const remainingTerms = uniq(compact(tokenize(toLower(unquotedQuery))))\n\n  return [...quotedTerms, ...remainingTerms]\n}\n\nfunction toOrderClause(orderBy: SearchSort[]): string {\n  function wrapFieldWithFn(ordering: SearchSort): string {\n    return ordering.mapWith ? `${ordering.mapWith}(${ordering.field})` : ordering.field\n  }\n\n  return (orderBy || [])\n    .map((ordering) =>\n      [wrapFieldWithFn(ordering), (ordering.direction || '').toLowerCase()]\n        .map((str) => str.trim())\n        .filter(Boolean)\n        .join(' '),\n    )\n    .join(',')\n}\n\n/**\n * @internal\n */\nexport function createSearchQuery(\n  searchTerms: SearchTerms<SchemaType | CrossDatasetType>,\n  searchOpts: SearchOptions & SearchFactoryOptions = {},\n): SearchQuery {\n  const {filter, params, tag} = searchOpts\n\n  const specs = searchTerms.types\n    .map((schemaType) =>\n      deriveSearchWeightsFromType({\n        schemaType,\n        maxDepth: searchOpts.maxDepth || DEFAULT_MAX_FIELD_DEPTH,\n        isCrossDataset: searchOpts.isCrossDataset,\n      }),\n    )\n    .filter(({paths}) => paths.length)\n\n  // Extract search terms from string query, factoring in phrases wrapped in quotes\n  const terms = extractTermsFromQuery(searchTerms.query)\n\n  // Construct search filters used in this GROQ query\n  const filters = [\n    '_type in $__types',\n    searchOpts.includeDrafts === false && `!(_id in path('drafts.**'))`,\n    ...createConstraints(terms, specs),\n    filter ? `(${filter})` : '',\n    searchTerms.filter ? `(${searchTerms.filter})` : '',\n  ].filter(Boolean)\n\n  const selections = specs.map((spec) => {\n    const constraint = `_type == \"${spec.typeName}\" => `\n    const selection = `{ ${spec.paths.map((cfg, i) => `\"w${i}\": ${pathWithMapper(cfg)}`)} }`\n    return `${constraint}${selection}`\n  })\n\n  // Default to `_id asc` (GROQ default) if no search sort is provided\n  const sortOrder = toOrderClause(searchOpts?.sort || [{field: '_id', direction: 'asc'}])\n\n  const projectionFields = ['_type', '_id']\n  const selection = selections.length > 0 ? `...select(${selections.join(',\\n')})` : ''\n  const finalProjection = projectionFields.join(', ') + (selection ? `, ${selection}` : '')\n\n  let query =\n    `*[${filters.join(' && ')}]` +\n    `| order(${sortOrder})` +\n    `[0...$__limit]` +\n    `{${finalProjection}}`\n\n  // Optionally prepend our query with an 'extended' projection.\n  // Required if we want to sort on nested object or reference fields.\n  // In future, creating the extended projection should be handled internally by `createSearchQuery`.\n  if (searchOpts?.__unstable_extendedProjection) {\n    const extendedProjection = searchOpts?.__unstable_extendedProjection\n    const firstProjection = projectionFields.concat(extendedProjection).join(', ')\n\n    query = [\n      `*[${filters.join(' && ')}]{${firstProjection}}`,\n      `order(${sortOrder})[0...$__limit]{${finalProjection}}`,\n    ].join('|')\n  }\n\n  // Prepend GROQ comments\n  const groqComments = [`findability-mvi:${FINDABILITY_MVI}`]\n    .concat(searchOpts?.comments || [])\n    .map((s) => `// ${s}`)\n    .join('\\n')\n  const updatedQuery = groqComments ? `${groqComments}\\n${query}` : query\n\n  const limit = searchOpts?.limit ?? DEFAULT_LIMIT\n\n  return {\n    query: updatedQuery,\n    params: {\n      ...toGroqParams(terms),\n      __types: specs.map((spec) => spec.typeName),\n      __limit: limit,\n      ...(params || {}),\n    },\n    options: {tag},\n    searchSpec: specs,\n    terms,\n  }\n}\n\nconst toGroqParams = (terms: string[]): Record<string, string> => {\n  const params: Record<string, string> = {}\n  return terms.reduce((acc, term, i) => {\n    acc[`t${i}`] = `${term}*` // \"t\" is short for term\n    return acc\n  }, params)\n}\n","import {type CrossDatasetType, type SanityDocumentLike, type SchemaType} from '@sanity/types'\nimport {sortBy} from 'lodash'\nimport {map, tap} from 'rxjs/operators'\n\nimport {removeDupes} from '../../util/draftUtils'\nimport {type SearchStrategyFactory, type SearchTerms, type WeightedSearchResults} from '../common'\nimport {applyWeights} from './applyWeights'\nimport {createSearchQuery} from './createSearchQuery'\n\nfunction getSearchTerms(\n  searchParams: string | SearchTerms,\n  types: (SchemaType | CrossDatasetType)[],\n) {\n  if (typeof searchParams === 'string') {\n    return {\n      query: searchParams,\n      types: types,\n    }\n  }\n  return searchParams.types.length ? searchParams : {...searchParams, types}\n}\n\n/**\n * @internal\n */\nexport const createWeightedSearch: SearchStrategyFactory<WeightedSearchResults> = (\n  types,\n  client,\n  factoryOptions,\n) => {\n  // Search currently supports both strings (reference + cross dataset reference inputs)\n  // or a SearchTerms object (omnisearch).\n  return function search(searchParams, searchOptions = {}) {\n    const searchTerms = getSearchTerms(searchParams, types)\n\n    const {query, params, options, searchSpec, terms} = createSearchQuery(searchTerms, {\n      ...factoryOptions,\n      ...searchOptions,\n    })\n\n    return client.observable.fetch<SanityDocumentLike[]>(query, params, options).pipe(\n      factoryOptions.unique ? map(removeDupes) : tap(),\n      // Assign weighting and scores based on current search terms.\n      // No scores will be assigned when terms are empty.\n      map((hits) => applyWeights(searchSpec, hits, terms)),\n      // Optionally skip client-side score sorting.\n      // This can be relevant when ordering results by specific fields, especially dates.\n      searchOptions?.skipSortByScore ? tap() : map((hits) => sortBy(hits, (hit) => -hit.score)),\n      map((hits) => ({type: 'weighted', hits})),\n    )\n  }\n}\n","import {\n  type SearchStrategyFactory,\n  type TextSearchResults,\n  type WeightedSearchResults,\n} from './common'\nimport {createTextSearch} from './text-search'\nimport {createWeightedSearch} from './weighted'\n\n/** @internal */\nexport const createSearch: SearchStrategyFactory<TextSearchResults | WeightedSearchResults> = (\n  searchableTypes,\n  client,\n  options,\n) => {\n  const factory = options.unstable_enableNewSearch ? createTextSearch : createWeightedSearch\n  return factory(searchableTypes, client, options)\n}\n","import {type SanityClient} from '@sanity/client'\nimport {DEFAULT_MAX_FIELD_DEPTH} from '@sanity/schema/_internal'\nimport {type ReferenceFilterSearchOptions, type ReferenceSchemaType} from '@sanity/types'\nimport {combineLatest, type Observable, of} from 'rxjs'\nimport {map, mergeMap, startWith, switchMap} from 'rxjs/operators'\n\nimport {type DocumentPreviewStore, getPreviewPaths, prepareForPreview} from '../../../../preview'\nimport {createSearch} from '../../../../search'\nimport {collate, type CollatedHit, getDraftId, getIdPair, isRecord} from '../../../../util'\nimport {type ReferenceInfo, type ReferenceSearchHit} from '../../../inputs/ReferenceInput/types'\n\nconst READABLE = {\n  available: true,\n  reason: 'READABLE',\n} as const\n\nconst PERMISSION_DENIED = {\n  available: false,\n  reason: 'PERMISSION_DENIED',\n} as const\n\nconst NOT_FOUND = {\n  available: false,\n  reason: 'NOT_FOUND',\n} as const\n\n/**\n * Takes an id and a reference schema type, returns metadata about it\n */\nexport function getReferenceInfo(\n  documentPreviewStore: DocumentPreviewStore,\n  id: string,\n  referenceType: ReferenceSchemaType,\n): Observable<ReferenceInfo> {\n  const {publishedId, draftId} = getIdPair(id)\n\n  const pairAvailability$ = documentPreviewStore.unstable_observeDocumentPairAvailability(id)\n\n  return pairAvailability$.pipe(\n    switchMap((pairAvailability) => {\n      if (!pairAvailability.draft.available && !pairAvailability.published.available) {\n        // combine availability of draft + published\n        const availability =\n          pairAvailability.draft.reason === 'PERMISSION_DENIED' ||\n          pairAvailability.published.reason === 'PERMISSION_DENIED'\n            ? PERMISSION_DENIED\n            : NOT_FOUND\n\n        // short circuit, neither draft nor published is available so no point in trying to get preview\n        return of({\n          id,\n          type: undefined,\n          availability,\n          preview: {\n            draft: undefined,\n            published: undefined,\n          },\n        } as const)\n      }\n\n      const draftRef = {_type: 'reference', _ref: draftId}\n      const publishedRef = {_type: 'reference', _ref: publishedId}\n\n      const typeName$ = combineLatest([\n        documentPreviewStore.observeDocumentTypeFromId(draftId),\n        documentPreviewStore.observeDocumentTypeFromId(publishedId),\n      ]).pipe(\n        // assume draft + published are always same type\n        map(([draftTypeName, publishedTypeName]) => draftTypeName || publishedTypeName),\n      )\n\n      return typeName$.pipe(\n        switchMap((typeName) => {\n          if (!typeName) {\n            // we have already asserted that either the draft or the published document is readable, so\n            // if we get here we can't read the _type, so we're likely to be in an inconsistent state\n            // waiting for an update to reach the client. Since we're in the context of a reactive stream based on\n            // the _type we'll get it eventually\n            return of({\n              id,\n              type: undefined,\n              availability: {available: true, reason: 'READABLE'},\n              preview: {\n                draft: undefined,\n                published: undefined,\n              },\n            } as const)\n          }\n\n          // get schema type for the referenced document\n          const refSchemaType = referenceType.to.find((memberType) => memberType.name === typeName)!\n\n          if (!refSchemaType) {\n            return of({\n              id,\n              type: typeName,\n              availability: {available: true, reason: 'READABLE'},\n              preview: {\n                draft: undefined,\n                published: undefined,\n              },\n            } as const)\n          }\n\n          const previewPaths = getPreviewPaths(refSchemaType?.preview) || []\n\n          const draftPreview$ = documentPreviewStore.observePaths(draftRef, previewPaths).pipe(\n            map((result) =>\n              result\n                ? {\n                    _id: draftId,\n                    ...prepareForPreview(result, refSchemaType),\n                  }\n                : undefined,\n            ),\n            startWith(undefined),\n          )\n\n          const publishedPreview$ = documentPreviewStore\n            .observePaths(publishedRef, previewPaths)\n            .pipe(\n              map((result) =>\n                result\n                  ? {\n                      _id: publishedId,\n                      ...prepareForPreview(result, refSchemaType),\n                    }\n                  : undefined,\n              ),\n              startWith(undefined),\n            )\n\n          const value$ = combineLatest([draftPreview$, publishedPreview$]).pipe(\n            map(([draft, published]) => ({draft, published})),\n          )\n\n          return value$.pipe(\n            map((value): ReferenceInfo => {\n              const availability =\n                // eslint-disable-next-line no-nested-ternary\n                pairAvailability.draft.available || pairAvailability.published.available\n                  ? READABLE\n                  : pairAvailability.draft.reason === 'PERMISSION_DENIED' ||\n                      pairAvailability.published.reason === 'PERMISSION_DENIED'\n                    ? PERMISSION_DENIED\n                    : NOT_FOUND\n\n              return {\n                type: typeName,\n                id: publishedId,\n                availability,\n                preview: {\n                  draft: isRecord(value.draft) ? value.draft : undefined,\n                  published: isRecord(value.published) ? value.published : undefined,\n                },\n              }\n            }),\n          )\n        }),\n      )\n    }),\n  )\n}\n\n/**\n * when we get a search result it may not include all [draft, published] id pairs for documents matching the\n * query. For example: searching for \"potato\" may yield a hit in the draft, but not the published (or vice versa)\n *\n * This method takes a list of collated search hits and returns an array of the missing \"counterpart\" ids\n */\nfunction getCounterpartIds(collatedHits: CollatedHit[]): string[] {\n  return collatedHits\n    .filter(\n      (collatedHit) =>\n        // we're interested in hits where either draft or published is missing\n        !collatedHit.draft || !collatedHit.published,\n    )\n    .map((collatedHit) =>\n      // if we have the draft, return the published id or vice versa\n      collatedHit.draft ? collatedHit.id : getDraftId(collatedHit.id),\n    )\n}\n\nfunction getExistingCounterparts(client: SanityClient, ids: string[]) {\n  return ids.length === 0\n    ? of([])\n    : client.observable.fetch(`*[_id in $ids]._id`, {ids}, {tag: 'get-counterpart-ids'})\n}\n\nexport function referenceSearch(\n  client: SanityClient,\n  textTerm: string,\n  type: ReferenceSchemaType,\n  options: ReferenceFilterSearchOptions,\n  unstable_enableNewSearch: boolean,\n): Observable<ReferenceSearchHit[]> {\n  const search = createSearch(type.to, client, {\n    ...options,\n    unstable_enableNewSearch,\n    maxDepth: options.maxFieldDepth || DEFAULT_MAX_FIELD_DEPTH,\n  })\n  return search(textTerm, {includeDrafts: true}).pipe(\n    map(({hits}) => hits.map(({hit}) => hit)),\n    map(collate),\n    // pick the 100 best matches\n    map((collated) => collated.slice(0, 100)),\n    mergeMap((collated) => {\n      // Note: It might seem like this step is redundant, but it's here for a reason:\n      // The list of search hits returned from here will be passed as options to the reference input's autocomplete. When\n      // one of them gets selected by the user, it will then be passed as the argument to the `onChange` handler in the\n      // Reference Input. This handler will then look at the passed value to determine whether to make a link to a\n      // draft (using _strengthenOnPublish) or a published document.\n      //\n      // Without this step, in a case where both a draft and a published version exist but only the draft matches\n      // the search term, we'd end up making a reference with `_strengthenOnPublish: true`, when we instead should be\n      // making a normal reference to the published id\n      return getExistingCounterparts(client, getCounterpartIds(collated)).pipe(\n        map((existingCounterpartIds) => {\n          return collated.map((entry) => {\n            const draftId = getDraftId(entry.id)\n            return {\n              id: entry.id,\n              type: entry.type,\n              draft:\n                entry.draft || existingCounterpartIds.includes(draftId)\n                  ? {_id: draftId, _type: entry.type}\n                  : undefined,\n              published:\n                entry.published || existingCounterpartIds.includes(entry.id)\n                  ? {_id: entry.id, _type: entry.type}\n                  : undefined,\n            }\n          })\n        }),\n      )\n    }),\n  )\n}\n","import {type Path, type Reference, type ReferenceSchemaType} from '@sanity/types'\nimport * as PathUtils from '@sanity/util/paths'\nimport {\n  type ComponentProps,\n  type ForwardedRef,\n  forwardRef,\n  useCallback,\n  useMemo,\n  useRef,\n} from 'react'\n\nimport {type FIXME} from '../../../FIXME'\nimport {useSchema} from '../../../hooks'\nimport {useDocumentPreviewStore} from '../../../store'\nimport {isNonNullable} from '../../../util'\nimport {useFormValue} from '../../contexts/FormValue'\nimport {useReferenceInputOptions} from '../../studio'\nimport * as adapter from '../../studio/inputs/client-adapters/reference'\nimport {type EditReferenceEvent} from './types'\n\nfunction useValueRef<T>(value: T): {current: T} {\n  const ref = useRef(value)\n  ref.current = value\n  return ref\n}\n\ninterface Options {\n  path: Path\n  schemaType: ReferenceSchemaType\n  value?: Reference\n}\n\nexport function useReferenceInput(options: Options) {\n  const {path, schemaType} = options\n  const schema = useSchema()\n  const documentPreviewStore = useDocumentPreviewStore()\n  const {EditReferenceLinkComponent, onEditReference, activePath, initialValueTemplateItems} =\n    useReferenceInputOptions()\n\n  const documentValue = useFormValue([]) as FIXME\n  const documentRef = useValueRef(documentValue)\n\n  const documentTypeName = documentRef.current?._type\n\n  const isCurrentDocumentLiveEdit = useMemo(() => {\n    return schema.get(documentTypeName)?.liveEdit\n  }, [documentTypeName, schema])\n\n  const disableNew = schemaType.options?.disableNew === true\n\n  const template = options.value?._strengthenOnPublish?.template\n  const EditReferenceLink = useMemo(\n    () =>\n      forwardRef(function EditReferenceLink_(\n        _props: ComponentProps<NonNullable<typeof EditReferenceLinkComponent>>,\n        forwardedRef: ForwardedRef<'a'>,\n      ) {\n        return EditReferenceLinkComponent ? (\n          <EditReferenceLinkComponent\n            {..._props}\n            ref={forwardedRef}\n            parentRefPath={path}\n            template={template}\n          />\n        ) : null\n      }),\n    [EditReferenceLinkComponent, path, template],\n  )\n\n  const handleEditReference = useCallback(\n    (event: EditReferenceEvent) => {\n      onEditReference?.({\n        parentRefPath: path,\n        id: event.id,\n        type: event.type,\n        template: event.template,\n      })\n    },\n    [onEditReference, path],\n  )\n\n  const selectedState = PathUtils.startsWith(path, activePath?.path || [])\n    ? activePath?.state\n    : 'none'\n\n  const createOptions = useMemo(() => {\n    if (disableNew) {\n      return []\n    }\n    return (\n      (initialValueTemplateItems || [])\n        // eslint-disable-next-line max-nested-callbacks\n        .filter((i) => schemaType.to.some((refType) => refType.name === i.template?.schemaType))\n        .map((item) =>\n          item.template?.schemaType\n            ? {\n                id: item.id,\n                title:\n                  item.title || `${item.template.schemaType} from template ${item.template.id}`,\n                type: item.template.schemaType,\n                icon: item.icon,\n                template: {\n                  id: item.template.id,\n                  params: item.parameters,\n                },\n\n                permission: {granted: item.granted, reason: item.reason},\n              }\n            : undefined,\n        )\n        .filter(isNonNullable)\n    )\n  }, [disableNew, initialValueTemplateItems, schemaType.to])\n\n  const getReferenceInfo = useCallback(\n    (id: string) => adapter.getReferenceInfo(documentPreviewStore, id, schemaType),\n    [documentPreviewStore, schemaType],\n  )\n\n  return {\n    selectedState,\n    isCurrentDocumentLiveEdit,\n    handleEditReference,\n    EditReferenceLink,\n    createOptions,\n    getReferenceInfo,\n  }\n}\n","import {LaunchIcon as OpenInNewTabIcon, SyncIcon as ReplaceIcon, TrashIcon} from '@sanity/icons'\nimport {type Reference, type ReferenceSchemaType} from '@sanity/types'\nimport {Box, Card, type CardTone, Flex, Menu, MenuDivider, Stack} from '@sanity/ui'\nimport {\n  type ComponentProps,\n  type ForwardedRef,\n  forwardRef,\n  useCallback,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport {IntentLink} from 'sanity/router'\n\nimport {MenuButton, MenuItem, TooltipDelayGroupProvider} from '../../../../ui-components'\nimport {ContextMenuButton} from '../../../components/contextMenuButton'\nimport {type DocumentFieldActionNode} from '../../../config'\nimport {useTranslation} from '../../../i18n'\nimport {FormField} from '../../components'\nimport {usePublishedId} from '../../contexts/DocumentIdProvider'\nimport {FieldActionsProvider, FieldActionsResolver} from '../../field'\nimport {useDidUpdate} from '../../hooks/useDidUpdate'\nimport {useScrollIntoViewOnFocusWithin} from '../../hooks/useScrollIntoViewOnFocusWithin'\nimport {set, unset} from '../../patch'\nimport {type ObjectFieldProps, type RenderPreviewCallback} from '../../types'\nimport {PreviewReferenceValue} from './PreviewReferenceValue'\nimport {ReferenceFinalizeAlertStrip} from './ReferenceFinalizeAlertStrip'\nimport {ReferenceLinkCard} from './ReferenceLinkCard'\nimport {ReferenceMetadataLoadErrorAlertStrip} from './ReferenceMetadataLoadFailure'\nimport {ReferenceStrengthMismatchAlertStrip} from './ReferenceStrengthMismatchAlertStrip'\nimport {useReferenceInfo} from './useReferenceInfo'\nimport {useReferenceInput} from './useReferenceInput'\n\ninterface ReferenceFieldProps extends Omit<ObjectFieldProps, 'renderDefault'> {\n  schemaType: ReferenceSchemaType\n  renderPreview: RenderPreviewCallback\n}\n\nfunction getTone({\n  readOnly,\n  hasErrors,\n  hasWarnings,\n}: {\n  readOnly: boolean | undefined\n  hasErrors: boolean\n  hasWarnings: boolean\n}): CardTone {\n  if (readOnly) {\n    return 'transparent'\n  }\n  if (hasErrors) {\n    return 'critical'\n  }\n  return hasWarnings ? 'caution' : 'default'\n}\nconst MENU_POPOVER_PROPS = {portal: true, tone: 'default'} as const\n\nexport function ReferenceField(props: ReferenceFieldProps) {\n  const elementRef = useRef<HTMLDivElement | null>(null)\n  const {schemaType, path, open, inputId, children, inputProps} = props\n  const {readOnly, focused, renderPreview, onChange} = props.inputProps\n\n  const [fieldActionsNodes, setFieldActionNodes] = useState<DocumentFieldActionNode[]>([])\n  const documentId = usePublishedId()\n\n  const handleClear = useCallback(() => inputProps.onChange(unset()), [inputProps])\n  const value: Reference | undefined = props.value as any\n\n  const {EditReferenceLink, getReferenceInfo, selectedState, isCurrentDocumentLiveEdit} =\n    useReferenceInput({\n      path,\n      schemaType,\n      value,\n    })\n\n  // this is here to make sure the item is visible if it's being edited behind a modal\n  useScrollIntoViewOnFocusWithin(elementRef, open)\n\n  useDidUpdate(focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus && elementRef.current) {\n      // Note: if editing an inline item, focus is handled by the item input itself and no ref is being set\n      elementRef.current.focus()\n    }\n  })\n\n  const hasErrors = props.validation.some((v) => v.level === 'error')\n  const hasWarnings = props.validation.some((v) => v.level === 'warning')\n\n  const loadableReferenceInfo = useReferenceInfo(value?._ref, getReferenceInfo)\n\n  const refTypeName = loadableReferenceInfo.result?.type || value?._strengthenOnPublish?.type\n\n  const refType = refTypeName\n    ? schemaType.to.find((toType) => toType.name === refTypeName)\n    : undefined\n  const pressed = selectedState === 'pressed'\n  const selected = selectedState === 'selected'\n\n  const hasRef = value?._ref\n  const publishedReferenceExists = hasRef && loadableReferenceInfo.result?.preview?.published?._id\n\n  const handleRemoveStrengthenOnPublish = useCallback(() => {\n    onChange([\n      schemaType.weak === true ? set(true, ['_weak']) : unset(['_weak']),\n      unset(['_strengthenOnPublish']),\n    ])\n  }, [onChange, schemaType.weak])\n\n  const handleFixStrengthMismatch = useCallback(() => {\n    onChange(schemaType.weak === true ? set(true, ['_weak']) : unset(['_weak']))\n  }, [onChange, schemaType])\n\n  const handleReplace = useCallback(() => {\n    inputProps.onPathFocus(['_ref'])\n  }, [inputProps])\n\n  const actualStrength = value?._weak ? 'weak' : 'strong'\n  const weakShouldBe = schemaType.weak === true ? 'weak' : 'strong'\n\n  // If the reference value is marked with _strengthenOnPublish,\n  // we allow weak references if the reference points to a document that has a draft but not a published\n  // In all other cases we should display a \"weak mismatch\" warning\n  const weakWarningOverride =\n    hasRef && !loadableReferenceInfo.isLoading && value?._strengthenOnPublish\n\n  const showWeakRefMismatch =\n    !loadableReferenceInfo.isLoading &&\n    loadableReferenceInfo.result?.availability.available &&\n    hasRef &&\n    actualStrength !== weakShouldBe &&\n    !weakWarningOverride\n\n  const tone = getTone({readOnly, hasErrors, hasWarnings})\n  const isEditing = !value?._ref || inputProps.focusPath[0] === '_ref'\n\n  const {t} = useTranslation()\n\n  const footer = (\n    <>\n      {isCurrentDocumentLiveEdit && publishedReferenceExists && value._strengthenOnPublish && (\n        <ReferenceFinalizeAlertStrip\n          schemaType={schemaType}\n          handleRemoveStrengthenOnPublish={handleRemoveStrengthenOnPublish}\n        />\n      )}\n      {showWeakRefMismatch && (\n        <ReferenceStrengthMismatchAlertStrip\n          actualStrength={actualStrength}\n          handleFixStrengthMismatch={handleFixStrengthMismatch}\n        />\n      )}\n      {loadableReferenceInfo.error && (\n        <ReferenceMetadataLoadErrorAlertStrip\n          errorMessage={loadableReferenceInfo.error.message}\n          onHandleRetry={loadableReferenceInfo.retry!}\n        />\n      )}\n    </>\n  )\n\n  const OpenLink = useMemo(\n    () =>\n      // eslint-disable-next-line @typescript-eslint/no-shadow\n      forwardRef(function OpenLink(\n        restProps: ComponentProps<typeof IntentLink>,\n        _ref: ForwardedRef<HTMLAnchorElement>,\n      ) {\n        return (\n          <IntentLink\n            {...restProps}\n            intent=\"edit\"\n            params={{id: value?._ref, type: refType?.name}}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            ref={_ref}\n          />\n        )\n      }),\n    [refType?.name, value?._ref],\n  )\n\n  const menu = useMemo(\n    () =>\n      readOnly ? null : (\n        <Box flex=\"none\">\n          <MenuButton\n            button={<ContextMenuButton paddingY={3} />}\n            id={`${inputId}-menuButton`}\n            menu={\n              <Menu>\n                {!readOnly && (\n                  <>\n                    <MenuItem\n                      text={t('inputs.reference.action.clear')}\n                      tone=\"critical\"\n                      icon={TrashIcon}\n                      onClick={handleClear}\n                    />\n                    <MenuItem\n                      text={t('inputs.reference.action.replace')}\n                      icon={ReplaceIcon}\n                      onClick={handleReplace}\n                    />\n                  </>\n                )}\n\n                {!readOnly && value?._ref && <MenuDivider />}\n                {value?._ref && (\n                  <MenuItem\n                    as={OpenLink}\n                    data-as=\"a\"\n                    text={t('inputs.reference.action.open-in-new-tab')}\n                    icon={OpenInNewTabIcon}\n                  />\n                )}\n              </Menu>\n            }\n            popover={MENU_POPOVER_PROPS}\n          />\n        </Box>\n      ),\n    [handleClear, handleReplace, inputId, OpenLink, readOnly, t, value?._ref],\n  )\n\n  return (\n    <>\n      {documentId && props.actions && props.actions.length > 0 && (\n        <FieldActionsResolver\n          actions={props.actions}\n          documentId={documentId}\n          documentType={schemaType.name}\n          onActions={setFieldActionNodes}\n          path={path}\n          schemaType={schemaType}\n        />\n      )}\n\n      <FieldActionsProvider\n        actions={fieldActionsNodes}\n        focused={Boolean(props.inputProps.focused)}\n        path={path}\n      >\n        <FormField\n          __internal_comments={props.__internal_comments}\n          __internal_slot={props.__internal_slot}\n          __unstable_headerActions={fieldActionsNodes}\n          __unstable_presence={props.presence}\n          description={props.description}\n          level={props.level}\n          title={props.title}\n          validation={props.validation}\n          deprecated={props.schemaType.deprecated}\n        >\n          {isEditing ? (\n            <Box>{children}</Box>\n          ) : (\n            <Card border radius={2} padding={1} tone={tone}>\n              <Stack space={1}>\n                <Flex gap={1} align=\"center\" style={{lineHeight: 0}}>\n                  <TooltipDelayGroupProvider>\n                    <ReferenceLinkCard\n                      __unstable_focusRing\n                      as={EditReferenceLink}\n                      data-pressed={pressed ? true : undefined}\n                      data-selected={selected ? true : undefined}\n                      documentId={value?._ref}\n                      documentType={refType?.name}\n                      flex={1}\n                      pressed={pressed}\n                      radius={2}\n                      ref={elementRef}\n                      selected={selected}\n                      tone=\"inherit\"\n                    >\n                      <PreviewReferenceValue\n                        value={value}\n                        referenceInfo={loadableReferenceInfo}\n                        renderPreview={renderPreview}\n                        type={schemaType}\n                      />\n                    </ReferenceLinkCard>\n                    <Box>{menu}</Box>\n                  </TooltipDelayGroupProvider>\n                </Flex>\n                {footer}\n              </Stack>\n            </Card>\n          )}\n        </FormField>\n      </FieldActionsProvider>\n    </>\n  )\n}\n","import {isArraySchemaType, type SchemaType} from '@sanity/types'\nimport {get} from 'lodash'\n\nexport function getOption(type: SchemaType, optionName: string) {\n  return get(type.options, optionName)\n}\n\nconst PSEUDO_OBJECTS = ['array', 'file', 'image', 'reference', 'slug']\nconst HIDDEN_FIELDS = ['asset', 'crop', 'hotspot', '_ref', '_weak']\nconst NO_LEVEL_LAYOUTS = ['tags']\nconst NO_LEVEL_TYPES = ['slug']\n\nexport function getTypeChain(type: SchemaType | undefined, visited: Set<SchemaType>): SchemaType[] {\n  if (!type) return []\n  if (visited.has(type)) return []\n\n  visited.add(type)\n\n  const next = type.type ? getTypeChain(type.type, visited) : []\n  return [type, ...next]\n}\n\nexport function getFieldLevel(schemaType: SchemaType, currentLevel: number) {\n  return isArraySchemaType(schemaType)\n    ? getArrayFieldLevel(schemaType, currentLevel)\n    : getObjectFieldLevel(schemaType, currentLevel)\n}\n\nfunction getObjectFieldLevel(schemaType: SchemaType, currentLevel: number): number {\n  const {type, options} = schemaType\n  const typeIfRelevant = asType(type, PSEUDO_OBJECTS)\n  const fields = schemaType?.jsonType === 'object' ? schemaType.fields : undefined\n\n  const typeName = typeIfRelevant?.name || ''\n\n  if (NO_LEVEL_TYPES.includes(typeName)) {\n    return 0\n  }\n\n  const isPseudoObject = PSEUDO_OBJECTS.includes(typeName)\n  const hasVisibleFields = (fields?.filter((f) => !HIDDEN_FIELDS.includes(f.name)).length ?? 0) > 0\n  const hasListOptions = (options?.list?.length ?? 0) > 0\n\n  if (hasVisibleFields || hasListOptions || !isPseudoObject) {\n    return currentLevel\n  }\n\n  return 0\n}\n\nfunction getArrayFieldLevel(schemaType: SchemaType, currentLevel: number): number {\n  const {options} = schemaType\n\n  const hasListOptions = (options?.list || [])?.length > 0\n  const isNoLevelLayout = NO_LEVEL_LAYOUTS.includes(options?.layout || '')\n\n  if (hasListOptions && !isNoLevelLayout) {\n    return currentLevel\n  }\n\n  return 0\n}\n\nfunction asType(\n  schemaType: SchemaType | undefined,\n  asOneOfTypes: string[],\n): SchemaType | undefined {\n  if (schemaType?.name && asOneOfTypes.includes(schemaType?.name)) {\n    return schemaType\n  }\n  if (!schemaType) {\n    return undefined\n  }\n  return asType(schemaType.type, asOneOfTypes)\n}\n","/* eslint-disable react/jsx-handler-names */\nimport {\n  isBooleanSchemaType,\n  isCrossDatasetReferenceSchemaType,\n  isReferenceSchemaType,\n  type SchemaType,\n} from '@sanity/types'\nimport {type ComponentType, useState} from 'react'\n\nimport {ChangeIndicator} from '../../../changeIndicators'\nimport {type DocumentFieldActionNode} from '../../../config'\nimport {FormField, FormFieldSet} from '../../components'\nimport {usePublishedId} from '../../contexts/DocumentIdProvider'\nimport {FieldActionsProvider, FieldActionsResolver} from '../../field'\nimport {ReferenceField} from '../../inputs/ReferenceInput/ReferenceField'\nimport {type FieldMember} from '../../store'\nimport {type ArrayFieldProps, type FieldProps, type ObjectFieldProps} from '../../types'\nimport {getTypeChain} from './helpers'\n\nconst EMPTY_ARRAY: never[] = []\n\nfunction BooleanField(field: FieldProps) {\n  return (\n    <ChangeIndicator\n      hasFocus={Boolean(field.inputProps.focused)}\n      isChanged={field.inputProps.changed}\n      path={field.path}\n    >\n      {field.children}\n    </ChangeIndicator>\n  )\n}\n\nfunction PrimitiveField(field: FieldProps) {\n  const [fieldActionsNodes, setFieldActionNodes] = useState<DocumentFieldActionNode[]>(EMPTY_ARRAY)\n  const documentId = usePublishedId()\n  const focused = Boolean(field.inputProps.focused)\n\n  return (\n    <>\n      {documentId && field.actions && field.actions.length > 0 && (\n        <FieldActionsResolver\n          actions={field.actions}\n          documentId={documentId}\n          documentType={field.schemaType.name}\n          onActions={setFieldActionNodes}\n          path={field.path}\n          schemaType={field.schemaType}\n        />\n      )}\n\n      <FieldActionsProvider actions={fieldActionsNodes} focused={focused} path={field.path}>\n        <FormField\n          __internal_slot={field.__internal_slot}\n          __internal_comments={field.__internal_comments}\n          __unstable_headerActions={fieldActionsNodes}\n          __unstable_presence={field.presence}\n          data-testid={`field-${field.inputId}`}\n          description={field.description}\n          inputId={field.inputId}\n          level={field.level}\n          title={field.title}\n          validation={field.validation}\n          deprecated={field.schemaType.deprecated}\n        >\n          <ChangeIndicator\n            hasFocus={focused}\n            isChanged={field.inputProps.changed}\n            path={field.path}\n          >\n            {field.children}\n          </ChangeIndicator>\n        </FormField>\n      </FieldActionsProvider>\n    </>\n  )\n}\n\nfunction ObjectOrArrayField(field: ObjectFieldProps | ArrayFieldProps) {\n  const [fieldActionsNodes, setFieldActionNodes] = useState<DocumentFieldActionNode[]>(EMPTY_ARRAY)\n  const documentId = usePublishedId()\n  const focused = Boolean(field.inputProps.focused)\n\n  return (\n    <>\n      {documentId && field.actions && field.actions.length > 0 && (\n        <FieldActionsResolver\n          actions={field.actions}\n          documentId={documentId}\n          documentType={field.schemaType.name}\n          onActions={setFieldActionNodes}\n          path={field.path}\n          schemaType={field.schemaType}\n        />\n      )}\n\n      <FieldActionsProvider actions={fieldActionsNodes} focused={focused} path={field.path}>\n        <FormFieldSet\n          __internal_comments={field.__internal_comments}\n          __internal_slot={field.__internal_slot}\n          __unstable_headerActions={fieldActionsNodes}\n          __unstable_presence={field.presence}\n          collapsed={field.collapsed}\n          collapsible={field.collapsible}\n          data-testid={`field-${field.inputId}`}\n          description={field.description}\n          level={field.level}\n          onCollapse={field.onCollapse}\n          onExpand={field.onExpand}\n          title={field.title}\n          validation={field.validation}\n          inputId={field.inputId}\n          deprecated={field.schemaType.deprecated}\n        >\n          {field.children}\n        </FormFieldSet>\n      </FieldActionsProvider>\n    </>\n  )\n}\n\nfunction ImageOrFileField(field: ObjectFieldProps) {\n  const [fieldActionsNodes, setFieldActionNodes] = useState<DocumentFieldActionNode[]>(EMPTY_ARRAY)\n  const documentId = usePublishedId()\n  const focused = Boolean(field.inputProps.focused)\n\n  // unless the hotspot tool dialog is open we want to show whoever is in there as the field presence\n  const hotspotField = field.inputProps.members.find(\n    (member): member is FieldMember => member.kind === 'field' && member.name === 'hotspot',\n  )\n  const presence = hotspotField?.open\n    ? field.presence\n    : field.presence.concat(hotspotField?.field.presence || EMPTY_ARRAY)\n\n  return (\n    <>\n      {documentId && field.actions && field.actions.length > 0 && (\n        <FieldActionsResolver\n          actions={field.actions}\n          documentId={documentId}\n          documentType={field.schemaType.name}\n          onActions={setFieldActionNodes}\n          path={field.path}\n          schemaType={field.schemaType}\n        />\n      )}\n\n      <FieldActionsProvider actions={fieldActionsNodes} focused={focused} path={field.path}>\n        <FormFieldSet\n          __internal_comments={field.__internal_comments}\n          __internal_slot={field.__internal_slot}\n          __unstable_headerActions={fieldActionsNodes}\n          __unstable_presence={presence}\n          collapsed={field.collapsed}\n          collapsible={field.collapsible}\n          description={field.description}\n          level={field.level}\n          onCollapse={field.onCollapse}\n          onExpand={field.onExpand}\n          title={field.title}\n          validation={field.validation}\n          inputId={field.inputId}\n          deprecated={field.schemaType.deprecated}\n        >\n          {field.children}\n        </FormFieldSet>\n      </FieldActionsProvider>\n    </>\n  )\n}\n\nexport function defaultResolveFieldComponent(\n  schemaType: SchemaType,\n): ComponentType<Omit<FieldProps, 'renderDefault'>> {\n  if (schemaType.components?.field) return schemaType.components.field\n\n  if (isBooleanSchemaType(schemaType)) {\n    return BooleanField as ComponentType<Omit<FieldProps, 'renderDefault'>>\n  }\n\n  const typeChain = getTypeChain(schemaType, new Set())\n\n  if (typeChain.some((t) => t.name === 'image' || t.name === 'file')) {\n    return ImageOrFileField as ComponentType<Omit<FieldProps, 'renderDefault'>>\n  }\n\n  if (typeChain.some((t) => isCrossDatasetReferenceSchemaType(t))) {\n    return PrimitiveField as ComponentType<Omit<FieldProps, 'renderDefault'>>\n  }\n\n  if (typeChain.some((t) => t.name === 'slug')) {\n    return PrimitiveField as ComponentType<Omit<FieldProps, 'renderDefault'>>\n  }\n\n  if (typeChain.some((t) => isReferenceSchemaType(t))) {\n    return ReferenceField as ComponentType<Omit<FieldProps, 'renderDefault'>>\n  }\n\n  if (schemaType.jsonType !== 'object' && schemaType.jsonType !== 'array') {\n    return PrimitiveField as ComponentType<Omit<FieldProps, 'renderDefault'>>\n  }\n\n  return ObjectOrArrayField as ComponentType<Omit<FieldProps, 'renderDefault'>>\n}\n","import {createContext, type ReactChild, useContext} from 'react'\n\nimport {type Workspace} from '../config'\n\n/** @internal */\nexport interface WorkspaceProviderProps {\n  workspace: Workspace\n  children?: ReactChild\n}\nconst WorkspaceContext = createContext<Workspace | null>(null)\n\n/** @internal */\nexport function WorkspaceProvider({children, workspace}: WorkspaceProviderProps) {\n  return <WorkspaceContext.Provider value={workspace}>{children}</WorkspaceContext.Provider>\n}\n\n/**\n * @hidden\n * @beta */\nexport function useWorkspace(): Workspace {\n  const workspace = useContext(WorkspaceContext)\n\n  if (!workspace) throw new Error('Workspace: missing context value')\n\n  return workspace\n}\n","import {type SanityClient} from '@sanity/client'\nimport {DEFAULT_MAX_FIELD_DEPTH} from '@sanity/schema/_internal'\nimport {isFinite} from 'lodash'\nimport {useMemo} from 'react'\nimport {useMemoObservable} from 'react-rx'\nimport {type Observable, of} from 'rxjs'\nimport {catchError, map, shareReplay, startWith} from 'rxjs/operators'\n\nimport {useClient} from '../../../../../hooks'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../../studioClient'\nimport {useWorkspace} from '../../../../workspace'\n\n/** By default the API will return 0 = all fields */\nconst DEFAULT_API_FIELD_DEPTH = 0\n\nexport interface PartialIndexSettings {\n  partialIndexSettings: {\n    maxFieldDepth: number\n  }\n}\n\ninterface Settings {\n  isLoading: boolean\n  settings: PartialIndexSettings\n}\n\nconst INITIAL_LOADING_STATE: Settings = {\n  isLoading: true,\n  settings: {\n    partialIndexSettings: {\n      maxFieldDepth: DEFAULT_API_FIELD_DEPTH,\n    },\n  },\n}\n\n/**\n * Fetches the index settings for the current dataset, if any\n */\nfunction fetchMaxDepth({client}: {client: SanityClient}): Observable<PartialIndexSettings> {\n  const {projectId, dataset} = client.config()\n  return client.observable.request<PartialIndexSettings>({\n    uri: `/projects/${projectId}/datasets/${dataset}/settings/indexing`,\n    tag: 'search.getPartialIndexSettings',\n  })\n}\n\nconst cachedSettings: Map<string, Observable<PartialIndexSettings>> = new Map()\n\n/** @internal */\nexport function useSearchMaxFieldDepth(overrideClient?: SanityClient): number {\n  const isEnabled = useWorkspace().search?.unstable_partialIndexing?.enabled\n  const workspaceClient = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const client = useMemo(() => overrideClient || workspaceClient, [overrideClient, workspaceClient])\n  const dataset = useMemo(() => client.config().dataset, [client])!\n\n  if (!isEnabled) {\n    cachedSettings.set(dataset, of(INITIAL_LOADING_STATE.settings))\n  }\n\n  if (!cachedSettings.has(dataset)) {\n    cachedSettings.set(dataset, fetchMaxDepth({client}).pipe(shareReplay()))\n  }\n\n  const indexSettings = useMemoObservable(\n    () =>\n      cachedSettings.get(dataset)!.pipe(\n        map((settings) => ({\n          isLoading: false,\n          settings,\n        })),\n        startWith(INITIAL_LOADING_STATE),\n        catchError((err: Error) => {\n          console.error(err)\n          return of({\n            isLoading: false,\n            enabled: true,\n            settings: {partialIndexSettings: {maxFieldDepth: DEFAULT_API_FIELD_DEPTH}},\n          })\n        }),\n      ),\n    [dataset],\n    INITIAL_LOADING_STATE,\n  )\n\n  const maxFieldDepth = indexSettings?.settings?.partialIndexSettings?.maxFieldDepth\n\n  if (!isFinite(maxFieldDepth)) {\n    return DEFAULT_MAX_FIELD_DEPTH\n  }\n\n  return Math.min(maxFieldDepth, DEFAULT_MAX_FIELD_DEPTH)\n}\n","import {type RefObject, useEffect} from 'react'\n\n// This is a modified version of https://usehooks.com/useOnClickOutside that can take multiple element refs\n// There is currently a bug in the `useClickOutside` hook from @sanity/ui that requires the refs to be passed as\n// actual HTML elements instead of mutable refs. This requires the consumer to store elements in component state\n// which adds quite a bit of cruft and isn't always feasible\nexport function useOnClickOutside(\n  refs: RefObject<HTMLElement>[],\n  handler: (event: Event) => void,\n): void {\n  useEffect(() => {\n    const listener = (event: Event) => {\n      const target = event.target\n      if (target instanceof HTMLElement) {\n        if (refs.some((ref) => ref.current?.contains(target))) {\n          return\n        }\n        handler(event)\n      }\n    }\n    document.addEventListener('mousedown', listener)\n    document.addEventListener('touchstart', listener)\n    return () => {\n      document.removeEventListener('mousedown', listener)\n      document.removeEventListener('touchstart', listener)\n    }\n  }, [refs, handler])\n}\n","import {Grid, useElementRect} from '@sanity/ui'\nimport {type ForwardedRef, forwardRef, type ReactNode, useCallback, useState} from 'react'\nimport styled, {css} from 'styled-components'\n\nconst NARROW_LAYOUT = css`\n  grid-template-columns: minmax(0px, 1fr);\n`\n\nconst WIDE_LAYOUT = css`\n  grid-template-columns: 1fr min-content;\n`\n\nconst Root = styled(Grid)<{$narrow: boolean}>((props: {$narrow: boolean}) =>\n  props.$narrow ? NARROW_LAYOUT : WIDE_LAYOUT,\n)\n\nexport const AutocompleteContainer = forwardRef(function AutocompleteContainer(\n  props: {\n    children: ReactNode\n  },\n  forwardedRef: ForwardedRef<HTMLDivElement>,\n) {\n  const [rootElement, setRootElement] = useState<HTMLDivElement | null>(null)\n\n  const handleNewRef = useCallback(\n    (element: HTMLDivElement) => {\n      // there's a bit of \"double bookkeeping\" here. since useElementRect needs to re-run whenever the ref updates,\n      // and thus we need to keep it in the state\n      setForwardedRef(forwardedRef, element)\n      setRootElement(element)\n    },\n    [forwardedRef],\n  )\n\n  const inputWrapperRect = useElementRect(rootElement)\n\n  return (\n    <Root ref={handleNewRef} gap={1} $narrow={(inputWrapperRect?.width || 0) < 480}>\n      {props.children}\n    </Root>\n  )\n})\n\nfunction setForwardedRef<T>(ref: ForwardedRef<T>, instance: T) {\n  if (typeof ref === 'function') {\n    ref(instance)\n  } else if (ref) {\n    ref.current = instance\n  }\n}\n","import {AddIcon} from '@sanity/icons'\nimport {Menu} from '@sanity/ui'\nimport {type HTMLProps, type RefObject} from 'react'\n\nimport {\n  Button,\n  MenuButton,\n  type MenuButtonProps,\n  MenuItem,\n  Tooltip,\n} from '../../../../ui-components'\nimport {InsufficientPermissionsMessage} from '../../../components'\nimport {useGetI18nText, useTranslation} from '../../../i18n'\nimport {useCurrentUser} from '../../../store'\nimport {type CreateReferenceOption} from './types'\n\ninterface Props\n  extends Omit<HTMLProps<HTMLButtonElement>, 'as' | 'size' | 'width' | 'type' | 'ref'> {\n  id: string\n  createOptions: CreateReferenceOption[]\n  menuRef?: RefObject<HTMLDivElement>\n  onCreate: (option: CreateReferenceOption) => void\n  readOnly?: boolean\n}\n\nconst INLINE_BLOCK_STYLE = {display: 'inline-flex'}\nconst FULL_WIDTH = {width: '100%'}\n\nconst POPOVER_PROPS: MenuButtonProps['popover'] = {\n  portal: true,\n  tone: 'default',\n  constrainSize: true,\n  fallbackPlacements: ['bottom', 'left', 'top'],\n  placement: 'right',\n  preventOverflow: true,\n}\n\nexport function CreateButton(props: Props) {\n  const {createOptions, onCreate, id, menuRef, ...rest} = props\n  const currentUser = useCurrentUser()\n\n  const {t} = useTranslation()\n  const getI18nText = useGetI18nText(createOptions)\n\n  const canCreateAny = createOptions.some((option) => option.permission.granted)\n  if (!canCreateAny) {\n    return (\n      <Tooltip\n        content={\n          <InsufficientPermissionsMessage\n            currentUser={currentUser}\n            context=\"create-new-reference\"\n          />\n        }\n      >\n        {/* this wrapper div is needed because disabled button doesn't trigger mouse events */}\n        <div style={INLINE_BLOCK_STYLE}>\n          <Button\n            text={t('inputs.reference.action.create-new-document')}\n            mode=\"ghost\"\n            disabled\n            icon={AddIcon}\n            style={FULL_WIDTH}\n          />\n        </div>\n      </Tooltip>\n    )\n  }\n\n  return createOptions.length > 1 ? (\n    <MenuButton\n      button={\n        <Button\n          {...rest}\n          disabled={props.readOnly}\n          text={t('inputs.reference.action.create-new-document-select')}\n          mode=\"ghost\"\n          icon={AddIcon}\n          size=\"large\"\n        />\n      }\n      id={id}\n      menu={\n        <Menu ref={menuRef}>\n          {createOptions.map((createOption) => (\n            <Tooltip\n              disabled={createOption.permission.granted}\n              key={createOption.id}\n              content={\n                <InsufficientPermissionsMessage\n                  currentUser={currentUser}\n                  context=\"create-document-type\"\n                />\n              }\n              portal\n            >\n              {/* this wrapper div is needed because disabled button doesn't trigger mouse events */}\n              <div>\n                <MenuItem\n                  disabled={!createOption.permission.granted}\n                  icon={createOption.icon}\n                  text={getI18nText(createOption).title}\n                  // eslint-disable-next-line react/jsx-no-bind\n                  onClick={() => onCreate(createOption)}\n                />\n              </div>\n            </Tooltip>\n          ))}\n        </Menu>\n      }\n      popover={POPOVER_PROPS}\n    />\n  ) : (\n    <Button\n      {...rest}\n      text={t('inputs.reference.action.create-new-document-select')}\n      mode=\"ghost\"\n      disabled={!createOptions[0].permission.granted || props.readOnly}\n      // eslint-disable-next-line react/jsx-no-bind\n      onClick={() => onCreate(createOptions[0])}\n      icon={AddIcon}\n      size=\"large\"\n    />\n  )\n}\n","import {type ReferenceSchemaType} from '@sanity/types'\nimport {Stack, Text, TextSkeleton} from '@sanity/ui'\nimport {type Observable} from 'rxjs'\n\nimport {useTranslation} from '../../../i18n'\nimport {Alert} from '../../components/Alert'\nimport {type RenderPreviewCallback} from '../../types'\nimport {ReferencePreview} from './ReferencePreview'\nimport {type ReferenceInfo} from './types'\nimport {useReferenceInfo} from './useReferenceInfo'\n\n/**\n * Used to preview a referenced type\n * Takes the reference type as props\n *\n * @internal\n */\nexport function OptionPreview(props: {\n  id: string\n  type: ReferenceSchemaType\n  getReferenceInfo: (id: string) => Observable<ReferenceInfo>\n  renderPreview: RenderPreviewCallback\n}) {\n  const {getReferenceInfo, id: documentId, renderPreview} = props\n  const {isLoading, result: referenceInfo, error} = useReferenceInfo(documentId, getReferenceInfo)\n  const {t} = useTranslation()\n\n  if (isLoading) {\n    return (\n      <Stack space={2} padding={1}>\n        <TextSkeleton style={{maxWidth: 320}} radius={1} animated />\n        <TextSkeleton style={{maxWidth: 200}} radius={1} size={1} animated />\n      </Stack>\n    )\n  }\n\n  if (error) {\n    return (\n      <Stack space={2} padding={1}>\n        <Alert title={t('inputs.reference.error.failed-to-load-document-title')}>\n          <Text muted size={1}>\n            {error.message}\n          </Text>\n        </Alert>\n      </Stack>\n    )\n  }\n\n  if (!referenceInfo) {\n    return null\n  }\n\n  if (referenceInfo.availability.reason === 'PERMISSION_DENIED') {\n    return (\n      <Stack space={2} padding={1}>\n        {t('inputs.reference.error.missing-read-permissions-description')}\n      </Stack>\n    )\n  }\n\n  const refType = props.type.to.find((toType) => toType.name === referenceInfo.type)\n\n  if (!refType) {\n    return (\n      <Stack space={2} padding={1}>\n        {t('inputs.reference.error.invalid-search-result-type-title', {\n          returnedType: referenceInfo.type,\n        })}\n      </Stack>\n    )\n  }\n\n  return (\n    referenceInfo &&\n    refType && (\n      <ReferencePreview\n        id={referenceInfo.id}\n        layout=\"default\"\n        preview={referenceInfo.preview}\n        refType={refType}\n        renderPreview={renderPreview}\n        showTypeLabel={props.type.to.length > 1}\n      />\n    )\n  )\n}\n","import {Autocomplete, Box, Flex, type Placement, Text} from '@sanity/ui'\nimport {\n  type ComponentProps,\n  type ForwardedRef,\n  forwardRef,\n  type ReactElement,\n  type Ref,\n  type RefObject,\n  useCallback,\n} from 'react'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../ui-components'\nimport {Translate, useTranslation} from '../../../i18n'\n\nconst StyledPopover = styled(Popover)`\n  & > div {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n  }\n`\n\nconst StyledText = styled(Text)`\n  word-break: break-word;\n`\n\nconst FALLBACK_PLACEMENTS: Placement[] = ['top-start', 'bottom-start']\n\nexport const ReferenceAutocomplete = forwardRef(function ReferenceAutocomplete(\n  props: ComponentProps<typeof Autocomplete> & {\n    referenceElement: HTMLDivElement | null\n    searchString?: string\n    portalRef?: RefObject<HTMLDivElement>\n  },\n  ref: ForwardedRef<HTMLInputElement>,\n) {\n  const {searchString, loading, portalRef, referenceElement, ...restProps} = props\n  const {t} = useTranslation()\n  const hasResults = props.options && props.options.length > 0\n  const renderPopover = useCallback(\n    (\n      {\n        content,\n        hidden,\n        inputElement,\n        onMouseEnter,\n        onMouseLeave,\n      }: {\n        content: ReactElement | null\n        hidden: boolean\n        inputElement: HTMLInputElement | null\n        onMouseEnter: () => void\n        onMouseLeave: () => void\n      },\n      contentRef: Ref<HTMLDivElement>,\n    ) => (\n      <StyledPopover\n        placement=\"bottom-start\"\n        fallbackPlacements={FALLBACK_PLACEMENTS}\n        arrow={false}\n        constrainSize\n        onMouseEnter={onMouseEnter}\n        onMouseLeave={onMouseLeave}\n        content={\n          <div ref={contentRef}>\n            {hasResults ? (\n              content\n            ) : (\n              <Box padding={4}>\n                <Flex align=\"center\" height=\"fill\" justify=\"center\">\n                  <StyledText align=\"center\" muted>\n                    <Translate\n                      t={t}\n                      i18nKey=\"inputs.reference.no-results-for-query\"\n                      values={{searchTerm: searchString || ''}}\n                    />\n                  </StyledText>\n                </Flex>\n              </Box>\n            )}\n          </div>\n        }\n        open={!loading && !hidden}\n        ref={portalRef}\n        portal\n        referenceElement={referenceElement || inputElement}\n        matchReferenceWidth\n      />\n    ),\n    [hasResults, t, searchString, loading, portalRef, referenceElement],\n  )\n  return <Autocomplete {...restProps} loading={loading} ref={ref} renderPopover={renderPopover} />\n})\n","import {createContext, type MutableRefObject, useContext} from 'react'\n\n/**\n * @internal\n */\nexport interface ReferenceItemRef {\n  menuRef: MutableRefObject<HTMLDivElement | null>\n  containerRef: MutableRefObject<HTMLDivElement | null>\n}\n\n/**\n * This is a way to store ref of the menu as well as the container of the ReferenceItem\n * so it can be used down the tree for clickOutside handling\n * @internal\n */\nexport const ReferenceItemRefContext = createContext<ReferenceItemRef | null>(null)\n\n/**\n * @internal\n */\nexport function useReferenceItemRef(): ReferenceItemRef {\n  const ref = useContext(ReferenceItemRefContext)\n  if (!ref) {\n    // The input may not always be wrapped in a reference item.\n    // For example in the case of a singular reference input.\n    // To prevent the function from crashing, default values are returned in such cases.\n    return {menuRef: {current: null}, containerRef: {current: null}}\n  }\n  return ref\n}\n","import {Stack, Text, useToast} from '@sanity/ui'\nimport {uuid} from '@sanity/uuid'\nimport {\n  type FocusEvent,\n  forwardRef,\n  type KeyboardEvent,\n  useCallback,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport {useObservableCallback} from 'react-rx'\nimport {concat, type Observable, of} from 'rxjs'\nimport {catchError, filter, map, scan, switchMap, tap} from 'rxjs/operators'\nimport styled from 'styled-components'\n\nimport {Button} from '../../../../ui-components'\nimport {PreviewCard} from '../../../components'\nimport {Translate, useTranslation} from '../../../i18n'\nimport {getPublishedId, isNonNullable} from '../../../util'\nimport {Alert} from '../../components/Alert'\nimport {useDidUpdate} from '../../hooks/useDidUpdate'\nimport {useOnClickOutside} from '../../hooks/useOnClickOutside'\nimport {set, setIfMissing, unset} from '../../patch'\nimport {AutocompleteContainer} from './AutocompleteContainer'\nimport {CreateButton} from './CreateButton'\nimport {OptionPreview} from './OptionPreview'\nimport {ReferenceAutocomplete} from './ReferenceAutocomplete'\nimport {\n  type CreateReferenceOption,\n  type ReferenceInputProps,\n  type ReferenceSearchHit,\n  type ReferenceSearchState,\n} from './types'\nimport {useReferenceInfo} from './useReferenceInfo'\nimport {useReferenceInput} from './useReferenceInput'\nimport {useReferenceItemRef} from './useReferenceItemRef'\n\n// This is a workaround for a circular import issue.\n// Calling `styled(PreviewCard)` at program load time triggered a build error with the commonjs bundle because it tried\n// to access the PreviewCard variable/symbol before it was initialized.\n// The workaround is to defer creating StyledPreviewCard until react render time\nlet StyledPreviewCardImpl: undefined | typeof PreviewCard\nconst StyledPreviewCard: typeof PreviewCard = forwardRef(function StyledPreviewCard(props, ref) {\n  if (!StyledPreviewCardImpl) {\n    StyledPreviewCardImpl = styled(PreviewCard)`\n      /* this is a hack to avoid layout jumps while previews are loading\n      there's probably better ways of solving this */\n      min-height: 36px;\n    `\n  }\n  return <StyledPreviewCardImpl ref={ref} {...props} />\n})\n\nconst INITIAL_SEARCH_STATE: ReferenceSearchState = {\n  hits: [],\n  isLoading: false,\n}\n\nconst NO_FILTER = () => true\n\nfunction nonNullable<T>(v: T): v is NonNullable<T> {\n  return v !== null\n}\n\ninterface AutocompleteOption {\n  hit: ReferenceSearchHit\n  value: string\n}\nexport function ReferenceInput(props: ReferenceInputProps) {\n  const {\n    createOptions,\n    onChange,\n    onEditReference,\n    onSearch,\n    schemaType,\n    readOnly,\n    id,\n    onPathFocus,\n    value,\n    renderPreview,\n    path,\n    elementProps,\n    focusPath,\n  } = props\n\n  const {getReferenceInfo} = useReferenceInput({\n    path,\n    schemaType,\n    value,\n  })\n\n  const [searchState, setSearchState] = useState<ReferenceSearchState>(INITIAL_SEARCH_STATE)\n\n  const handleCreateNew = useCallback(\n    (option: CreateReferenceOption) => {\n      const newDocumentId = uuid()\n\n      const patches = [\n        setIfMissing({}),\n        set(schemaType.name, ['_type']),\n        set(newDocumentId, ['_ref']),\n        set(true, ['_weak']),\n        set({type: option.type, weak: schemaType.weak, template: option.template}, [\n          '_strengthenOnPublish',\n        ]),\n      ].filter(isNonNullable)\n\n      onChange(patches)\n\n      onEditReference({id: newDocumentId, type: option.type, template: option.template})\n      onPathFocus([])\n    },\n    [onChange, onEditReference, onPathFocus, schemaType],\n  )\n\n  const handleChange = useCallback(\n    (nextId: string) => {\n      if (!nextId) {\n        onChange(unset())\n        onPathFocus([])\n        return\n      }\n\n      const hit = searchState.hits.find((h) => h.id === nextId)\n\n      if (!hit) {\n        throw new Error('Selected an item that wasnt part of the result set')\n      }\n      // if there's no published version of this document, set the reference to weak\n\n      const patches = [\n        setIfMissing({}),\n        set(schemaType.name, ['_type']),\n        set(getPublishedId(nextId), ['_ref']),\n        hit.published && !schemaType.weak ? unset(['_weak']) : set(true, ['_weak']),\n        hit.published\n          ? unset(['_strengthenOnPublish'])\n          : set({type: hit?.type, weak: schemaType.weak}, ['_strengthenOnPublish']),\n      ].filter(isNonNullable)\n\n      onChange(patches)\n      // Move focus away from _ref and one level up\n      onPathFocus([])\n    },\n    [onChange, onPathFocus, schemaType.name, schemaType.weak, searchState.hits],\n  )\n\n  const handleClear = useCallback(() => {\n    onChange(unset())\n  }, [onChange])\n\n  const handleCancelEdit = useCallback(() => {\n    if (!value?._ref) {\n      handleClear()\n    }\n  }, [handleClear, value?._ref])\n\n  const handleAutocompleteKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onPathFocus([])\n      }\n    },\n    [onPathFocus],\n  )\n\n  const loadableReferenceInfo = useReferenceInfo(value?._ref, getReferenceInfo)\n\n  const autocompletePopoverReferenceElementRef = useRef<HTMLDivElement | null>(null)\n\n  const {push} = useToast()\n  const {t} = useTranslation()\n\n  const handleQueryChange = useObservableCallback(\n    (inputValue$: Observable<string | null>) => {\n      return inputValue$.pipe(\n        filter(nonNullable),\n        switchMap((searchString) =>\n          concat(\n            of({isLoading: true}),\n            onSearch(searchString).pipe(\n              map((hits) => ({hits, searchString, isLoading: false})),\n              catchError((error) => {\n                push({\n                  title: t('inputs.reference.error.search-failed-title'),\n                  description: error.message,\n                  status: 'error',\n                  id: `reference-search-fail-${id}`,\n                })\n\n                console.error(error)\n                return of({hits: []})\n              }),\n            ),\n          ),\n        ),\n\n        scan(\n          (prevState, nextState): ReferenceSearchState => ({...prevState, ...nextState}),\n          INITIAL_SEARCH_STATE,\n        ),\n\n        tap(setSearchState),\n      )\n    },\n    [id, onSearch, push, t],\n  )\n\n  const handleAutocompleteOpenButtonClick = useCallback(() => {\n    handleQueryChange('')\n  }, [handleQueryChange])\n\n  const handleCreateButtonKeyDown = useCallback(\n    (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onPathFocus([])\n      }\n    },\n    [onPathFocus],\n  )\n\n  const renderOption = useCallback(\n    (option: AutocompleteOption) => {\n      const documentId = option.hit.draft?._id || option.hit.published?._id || option.value\n\n      return (\n        <StyledPreviewCard forwardedAs=\"button\" type=\"button\" radius={2} tone=\"inherit\">\n          <OptionPreview\n            getReferenceInfo={getReferenceInfo}\n            id={documentId}\n            renderPreview={renderPreview}\n            type={schemaType}\n          />\n        </StyledPreviewCard>\n      )\n    },\n    [schemaType, getReferenceInfo, renderPreview],\n  )\n\n  const renderValue = useCallback(() => {\n    return (\n      loadableReferenceInfo.result?.preview.draft?.title ||\n      loadableReferenceInfo.result?.preview.published?.title ||\n      ''\n    )\n  }, [\n    loadableReferenceInfo.result?.preview.draft?.title,\n    loadableReferenceInfo.result?.preview.published?.title,\n  ])\n\n  const handleFocus = useCallback(() => onPathFocus(['_ref']), [onPathFocus])\n  const handleBlur = useCallback(\n    (event: FocusEvent) => {\n      if (!autocompletePopoverReferenceElementRef.current?.contains(event.relatedTarget)) {\n        props.elementProps.onBlur(event)\n      }\n    },\n    [props.elementProps],\n  )\n\n  const isWeakRefToNonexistent =\n    loadableReferenceInfo?.result?.availability?.reason === 'NOT_FOUND' &&\n    !value?._strengthenOnPublish &&\n    value?._weak\n\n  useDidUpdate(focusPath?.[0] === '_ref', (hadFocusAtRef, hasFocusAtRef) => {\n    if (!hadFocusAtRef && hasFocusAtRef) {\n      elementProps.ref.current?.focus()\n    }\n  })\n  const hits: AutocompleteOption[] = useMemo(\n    () =>\n      searchState.hits.map((hit) => ({\n        value: hit.id,\n        hit: hit,\n      })),\n    [searchState.hits],\n  )\n\n  const isEditing = focusPath.length === 1 && focusPath[0] === '_ref'\n\n  // --- click outside handling\n  const {menuRef, containerRef} = useReferenceItemRef()\n  const clickOutsideBoundaryRef = useRef<HTMLDivElement>(null)\n  const autoCompletePortalRef = useRef<HTMLDivElement>(null)\n  const createButtonMenuPortalRef = useRef<HTMLDivElement>(null)\n  useOnClickOutside(\n    [\n      containerRef,\n      clickOutsideBoundaryRef,\n      autoCompletePortalRef,\n      createButtonMenuPortalRef,\n      menuRef,\n    ],\n    () => {\n      if (isEditing) {\n        handleCancelEdit()\n      }\n    },\n  )\n\n  return (\n    <Stack space={1} data-testid=\"reference-input\" ref={clickOutsideBoundaryRef}>\n      <Stack space={2}>\n        {isWeakRefToNonexistent ? (\n          <Alert\n            data-testid=\"alert-nonexistent-document\"\n            title={t('inputs.reference.error.nonexistent-document-title')}\n            suffix={\n              <Stack padding={2}>\n                <Button\n                  text={t('inputs.reference.error.nonexistent-document.clear-button-label')}\n                  onClick={handleClear}\n                />\n              </Stack>\n            }\n          >\n            <Text size={1}>\n              <Translate\n                i18nKey=\"inputs.reference.error.nonexistent-document-description\"\n                t={t}\n                values={{documentId: value._ref}}\n              />\n            </Text>\n          </Alert>\n        ) : null}\n        <AutocompleteContainer ref={autocompletePopoverReferenceElementRef}>\n          <ReferenceAutocomplete\n            {...elementProps}\n            onFocus={handleFocus}\n            onBlur={handleBlur}\n            data-testid=\"autocomplete\"\n            loading={searchState.isLoading}\n            referenceElement={autocompletePopoverReferenceElementRef.current}\n            options={hits}\n            radius={2}\n            placeholder={t('inputs.reference.search-placeholder')}\n            onKeyDown={handleAutocompleteKeyDown}\n            readOnly={loadableReferenceInfo.isLoading || readOnly}\n            onQueryChange={handleQueryChange}\n            searchString={searchState.searchString}\n            onChange={handleChange}\n            filterOption={NO_FILTER}\n            renderOption={renderOption as any}\n            renderValue={renderValue}\n            openButton={{onClick: handleAutocompleteOpenButtonClick}}\n            portalRef={autoCompletePortalRef}\n            value={value?._ref}\n          />\n\n          {createOptions.length > 0 && (\n            <CreateButton\n              id={`${id}-selectTypeMenuButton`}\n              readOnly={readOnly}\n              createOptions={createOptions}\n              onCreate={handleCreateNew}\n              onKeyDown={handleCreateButtonKeyDown}\n              menuRef={createButtonMenuPortalRef}\n            />\n          )}\n        </AutocompleteContainer>\n      </Stack>\n    </Stack>\n  )\n}\n","import {\n  type Path,\n  type Reference,\n  type ReferenceFilterSearchOptions,\n  type ReferenceOptions,\n  type ReferenceSchemaType,\n  type SanityDocument,\n} from '@sanity/types'\nimport * as PathUtils from '@sanity/util/paths'\nimport {get} from '@sanity/util/paths'\nimport {\n  type ComponentProps,\n  type ForwardedRef,\n  forwardRef,\n  useCallback,\n  useMemo,\n  useRef,\n} from 'react'\nimport {from, throwError} from 'rxjs'\nimport {catchError, mergeMap} from 'rxjs/operators'\n\nimport {type Source} from '../../../../config'\nimport {type FIXME} from '../../../../FIXME'\nimport {useSchema} from '../../../../hooks'\nimport {useDocumentPreviewStore} from '../../../../store'\nimport {useSource} from '../../../../studio'\nimport {useSearchMaxFieldDepth} from '../../../../studio/components/navbar/search/hooks/useSearchMaxFieldDepth'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../studioClient'\nimport {isNonNullable} from '../../../../util'\nimport {useFormValue} from '../../../contexts/FormValue'\nimport {ReferenceInput} from '../../../inputs/ReferenceInput/ReferenceInput'\nimport {\n  type CreateReferenceOption,\n  type EditReferenceEvent,\n} from '../../../inputs/ReferenceInput/types'\nimport {type ObjectInputProps} from '../../../types'\nimport {useReferenceInputOptions} from '../../contexts'\nimport * as adapter from '../client-adapters/reference'\n\nasync function resolveUserDefinedFilter(\n  options: ReferenceOptions | undefined,\n  document: SanityDocument,\n  valuePath: Path,\n  getClient: Source['getClient'],\n): Promise<ReferenceFilterSearchOptions> {\n  if (!options) {\n    return {}\n  }\n\n  if (typeof options.filter === 'function') {\n    const parentPath = valuePath.slice(0, -1)\n    const parent = get(document, parentPath) as Record<string, unknown>\n    const resolvedFilter = await options.filter({document, parentPath, parent, getClient})\n    return resolvedFilter\n  }\n\n  return {\n    filter: options.filter,\n    params: 'filterParams' in options ? options.filterParams : undefined,\n  }\n}\n\n/**\n *\n * @hidden\n * @beta\n */\nexport type StudioReferenceInputProps = ObjectInputProps<Reference, ReferenceSchemaType>\n\nfunction useValueRef<T>(value: T): {current: T} {\n  const ref = useRef(value)\n  ref.current = value\n  return ref\n}\n\ntype SearchError = {\n  message: string\n  details?: {\n    type: string\n    description: string\n  }\n}\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function StudioReferenceInput(props: StudioReferenceInputProps) {\n  const source = useSource()\n  const searchClient = source.getClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const schema = useSchema()\n  const maxFieldDepth = useSearchMaxFieldDepth()\n  const documentPreviewStore = useDocumentPreviewStore()\n  const {path, schemaType} = props\n  const {EditReferenceLinkComponent, onEditReference, activePath, initialValueTemplateItems} =\n    useReferenceInputOptions()\n  const {unstable_enableNewSearch = false} = source.search\n\n  const documentValue = useFormValue([]) as FIXME\n  const documentRef = useValueRef(documentValue)\n  const documentTypeName = documentRef.current?._type\n  const refType = schema.get(documentTypeName)\n\n  const isDocumentLiveEdit = useMemo(() => refType?.liveEdit, [refType])\n\n  const disableNew = schemaType.options?.disableNew === true\n  const getClient = source.getClient\n\n  const handleSearch = useCallback(\n    (searchString: string) =>\n      from(resolveUserDefinedFilter(schemaType.options, documentRef.current, path, getClient)).pipe(\n        mergeMap(({filter, params}) =>\n          adapter.referenceSearch(\n            searchClient,\n            searchString,\n            schemaType,\n            {\n              ...schemaType.options,\n              filter,\n              params,\n              tag: 'search.reference',\n              maxFieldDepth,\n            },\n            unstable_enableNewSearch,\n          ),\n        ),\n\n        catchError((err: SearchError) => {\n          const isQueryError = err.details && err.details.type === 'queryParseError'\n          if (schemaType.options?.filter && isQueryError) {\n            err.message = `Invalid reference filter, please check the custom \"filter\" option`\n          }\n          return throwError(err)\n        }),\n      ),\n\n    [\n      schemaType,\n      documentRef,\n      path,\n      getClient,\n      searchClient,\n      maxFieldDepth,\n      unstable_enableNewSearch,\n    ],\n  )\n\n  const template = props.value?._strengthenOnPublish?.template\n  const EditReferenceLink = useMemo(\n    () =>\n      forwardRef(function EditReferenceLink_(\n        _props: ComponentProps<NonNullable<typeof EditReferenceLinkComponent>>,\n        forwardedRef: ForwardedRef<'a'>,\n      ) {\n        return EditReferenceLinkComponent ? (\n          <EditReferenceLinkComponent\n            {..._props}\n            ref={forwardedRef}\n            parentRefPath={path}\n            template={template}\n          />\n        ) : null\n      }),\n    [EditReferenceLinkComponent, path, template],\n  )\n\n  const handleEditReference = useCallback(\n    (event: EditReferenceEvent) => {\n      onEditReference?.({\n        parentRefPath: path,\n        id: event.id,\n        type: event.type,\n        template: event.template,\n      })\n    },\n    [onEditReference, path],\n  )\n\n  const selectedState = PathUtils.startsWith(path, activePath?.path || [])\n    ? activePath?.state\n    : 'none'\n\n  const createOptions = useMemo(() => {\n    if (disableNew) {\n      return []\n    }\n    return (\n      (initialValueTemplateItems || [])\n        // eslint-disable-next-line max-nested-callbacks\n        .filter((i) => {\n          return schemaType.to.some((_refType) => {\n            return _refType.name === i.template?.schemaType\n          })\n        })\n        .map((item): CreateReferenceOption | undefined =>\n          item.template?.schemaType\n            ? {\n                id: item.id,\n                title:\n                  item.title || `${item.template.schemaType} from template ${item.template?.id}`,\n                i18n: item.i18n,\n                type: item.template.schemaType,\n                icon: item.icon,\n                template: {\n                  id: item.template?.id,\n                  params: item.parameters,\n                },\n\n                permission: {granted: item.granted, reason: item.reason},\n              }\n            : undefined,\n        )\n        .filter(isNonNullable)\n    )\n  }, [disableNew, initialValueTemplateItems, schemaType.to])\n\n  const getReferenceInfo = useCallback(\n    (id: string, _type: ReferenceSchemaType) =>\n      adapter.getReferenceInfo(documentPreviewStore, id, _type),\n    [documentPreviewStore],\n  )\n\n  return (\n    <ReferenceInput\n      {...props}\n      onSearch={handleSearch}\n      liveEdit={isDocumentLiveEdit}\n      getReferenceInfo={getReferenceInfo}\n      selectedState={selectedState}\n      editReferenceLinkComponent={EditReferenceLink}\n      createOptions={createOptions}\n      onEditReference={handleEditReference}\n    />\n  )\n}\n","import {\n  isArrayOfBlocksSchemaType,\n  isArrayOfObjectsSchemaType,\n  isArrayOfPrimitivesSchemaType,\n  isBooleanSchemaType,\n  isNumberSchemaType,\n  isObjectSchemaType,\n  isStringSchemaType,\n} from '@sanity/types'\n\nimport {\n  type ArrayOfObjectsInputProps,\n  type ArrayOfPrimitivesInputProps,\n  type BooleanInputProps,\n  type InputProps,\n  type NumberInputProps,\n  type ObjectInputProps,\n  type StringInputProps,\n} from './inputProps'\nimport {type ItemProps, type ObjectItemProps} from './itemProps'\n\n/**\n * @hidden\n * @beta */\nexport function isObjectItemProps(\n  item: ItemProps | Omit<ItemProps, 'renderDefault'>,\n): item is ObjectItemProps {\n  return isObjectSchemaType(item.schemaType)\n}\n\n/**\n * @hidden\n * @beta */\nexport function isObjectInputProps(\n  inputProps: InputProps | Omit<InputProps, 'renderDefault'>,\n): inputProps is ObjectInputProps {\n  return isObjectSchemaType(inputProps.schemaType)\n}\n\n/**\n * @hidden\n * @beta */\nexport function isStringInputProps(\n  inputProps: InputProps | Omit<InputProps, 'renderDefault'>,\n): inputProps is StringInputProps {\n  return isStringSchemaType(inputProps.schemaType)\n}\n\n/**\n * @hidden\n * @beta */\nexport function isNumberInputProps(\n  inputProps: InputProps | Omit<InputProps, 'renderDefault'>,\n): inputProps is NumberInputProps {\n  return isNumberSchemaType(inputProps.schemaType)\n}\n\n/**\n * @hidden\n * @beta */\nexport function isBooleanInputProps(\n  inputProps: InputProps | Omit<InputProps, 'renderDefault'>,\n): inputProps is BooleanInputProps {\n  return isBooleanSchemaType(inputProps.schemaType)\n}\n\n/**\n * @hidden\n * @beta */\nexport function isArrayOfObjectsInputProps(\n  inputProps: InputProps | Omit<InputProps, 'renderDefault'>,\n): inputProps is ArrayOfObjectsInputProps {\n  return isArrayOfObjectsSchemaType(inputProps.schemaType)\n}\n\n/**\n * @hidden\n * @beta */\nexport function isArrayOfBlocksInputProps(\n  inputProps: InputProps | Omit<InputProps, 'renderDefault'>,\n): inputProps is ArrayOfObjectsInputProps {\n  return isArrayOfBlocksSchemaType(inputProps.schemaType)\n}\n\n/**\n * @hidden\n * @beta */\nexport function isArrayOfPrimitivesInputProps(\n  inputProps: InputProps | Omit<InputProps, 'renderDefault'>,\n): inputProps is ArrayOfPrimitivesInputProps {\n  return isArrayOfPrimitivesSchemaType(inputProps.schemaType)\n}\n","import {type ClientRect, type Modifier} from '@dnd-kit/core'\nimport {type Transform} from '@dnd-kit/utilities'\n\nfunction restrictToBoundingRect(\n  transform: Transform,\n  rect: ClientRect,\n  boundingRect: ClientRect,\n  margins: Margins,\n): Transform {\n  const value = {\n    ...transform,\n  }\n\n  const marginY = margins.y || 0\n  const marginX = margins.x || 0\n\n  if (rect.top + value.y <= boundingRect.top + marginY) {\n    value.y = boundingRect.top - rect.top + marginY\n  } else if (rect.bottom + value.y >= boundingRect.top + boundingRect.height - marginY) {\n    value.y = boundingRect.top + boundingRect.height - rect.bottom - marginY\n  }\n\n  if (rect.left + value.x <= boundingRect.left - marginX) {\n    value.x = boundingRect.left - rect.left + marginX\n  } else if (rect.right + value.x >= boundingRect.left + boundingRect.width + marginX) {\n    value.x = boundingRect.left + boundingRect.width - rect.right + marginX\n  }\n\n  return value\n}\n\ninterface Margins {\n  x?: number\n  y?: number\n}\n\nexport const restrictToParentElementWithMargins: (margins: Margins) => Modifier =\n  (margins: Margins) =>\n  ({containerNodeRect, draggingNodeRect, transform}) => {\n    if (!draggingNodeRect || !containerNodeRect) {\n      return transform\n    }\n\n    return restrictToBoundingRect(transform, draggingNodeRect, containerNodeRect, margins)\n  }\n","import {useSortable} from '@dnd-kit/sortable'\nimport {DragHandleIcon} from '@sanity/icons'\nimport {createContext, useContext} from 'react'\nimport styled from 'styled-components'\n\nimport {Button, type ButtonProps} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\n\nconst DragHandleButton = styled(Button)<{$grid?: boolean}>`\n  cursor: ${(props) => (props.$grid ? 'move' : 'ns-resize')};\n`\n\nexport const SortableItemIdContext = createContext<string | null>(null)\n\ninterface DragHandleProps {\n  $grid?: boolean\n  size?: ButtonProps['size']\n  mode?: ButtonProps['mode']\n  paddingY?: ButtonProps['paddingY']\n}\n\nexport const DragHandle = function DragHandle(props: DragHandleProps) {\n  const id = useContext(SortableItemIdContext)!\n  const {listeners, attributes} = useSortable({id})\n  const {t} = useTranslation()\n  const {mode = 'bleed', ...rest} = props\n\n  return (\n    <DragHandleButton\n      icon={DragHandleIcon}\n      tooltipProps={{\n        content: t('inputs.array.action.drag.tooltip'),\n        delay: {open: 1000},\n      }}\n      mode={mode}\n      data-ui=\"DragHandleButton\"\n      {...attributes}\n      {...rest}\n      {...listeners}\n    />\n  )\n}\n","import {\n  type AutoScrollOptions,\n  closestCenter,\n  DndContext,\n  type DragEndEvent,\n  type DragStartEvent,\n  KeyboardSensor,\n  PointerSensor,\n  type SensorOptions,\n  useSensor,\n  useSensors,\n} from '@dnd-kit/core'\nimport {restrictToHorizontalAxis, restrictToVerticalAxis} from '@dnd-kit/modifiers'\nimport {\n  horizontalListSortingStrategy,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  useSortable,\n  verticalListSortingStrategy,\n} from '@dnd-kit/sortable'\nimport {CSS} from '@dnd-kit/utilities'\nimport {Box, type Card, Grid} from '@sanity/ui'\nimport {\n  type ComponentProps,\n  type ForwardedRef,\n  forwardRef,\n  memo,\n  type ReactNode,\n  useCallback,\n  useMemo,\n} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {restrictToParentElementWithMargins} from './dndkit-modifier/restrictToParentElementWithMargins'\nimport {SortableItemIdContext} from './DragHandle'\n\nexport const MOVING_ITEM_CLASS_NAME = 'moving'\n\nconst ListItem = styled(Box)<ComponentProps<typeof Box> & {$moving?: boolean}>`\n  ${(props) =>\n    props.$moving &&\n    css`\n      z-index: 10000;\n      /* prevents hover-effects etc on the dragged element  */\n      pointer-events: none;\n    `}\n`\n\nconst AUTO_SCROLL_OPTIONS: AutoScrollOptions = {\n  threshold: {\n    x: 0,\n    y: 0.02,\n  },\n}\nconst SENSOR_OPTIONS: SensorOptions = {\n  coordinateGetter: sortableKeyboardCoordinates,\n}\n\nconst TRANSITION = {\n  duration: 200,\n  easing: 'ease',\n}\n\ntype Axis = 'x' | 'y'\n\nfunction restrictToAxis(axis: Axis) {\n  return axis === 'x' ? restrictToHorizontalAxis : restrictToVerticalAxis\n}\nfunction sortingStrategy(axis: Axis) {\n  return axis === 'x' ? horizontalListSortingStrategy : verticalListSortingStrategy\n}\n\nconst SortableList = memo(function SortableList(props: ListProps) {\n  const {items, axis, onItemMove, onItemMoveStart, onItemMoveEnd, children, ...rest} = props\n\n  const sensors = useSensors(useSensor(PointerSensor), useSensor(KeyboardSensor, SENSOR_OPTIONS))\n\n  const handleDragEnd = useCallback(\n    (event: DragEndEvent) => {\n      const {active, over} = event\n\n      if (active.id !== over?.id) {\n        onItemMove?.({\n          fromIndex: active.data.current?.sortable?.index,\n          toIndex: over?.data.current?.sortable?.index,\n        })\n      }\n\n      onItemMoveEnd?.()\n    },\n    [onItemMove, onItemMoveEnd],\n  )\n  const modifiers = useMemo(\n    () => [restrictToParentElementWithMargins({y: 4}), ...(axis ? [restrictToAxis(axis)] : [])],\n    [axis],\n  )\n\n  return (\n    <DndContext\n      sensors={sensors}\n      autoScroll={AUTO_SCROLL_OPTIONS}\n      modifiers={modifiers}\n      collisionDetection={closestCenter}\n      onDragEnd={handleDragEnd}\n      onDragStart={onItemMoveStart}\n    >\n      <SortableContext items={items} strategy={axis ? sortingStrategy(axis) : undefined}>\n        <Grid {...rest}>{children}</Grid>\n      </SortableContext>\n    </DndContext>\n  )\n})\n\nconst SortableListItem = forwardRef<HTMLDivElement, ItemProps>(\n  function SortableListItem(props, ref) {\n    const {id, children, disableTransition} = props\n    const {setNodeRef, transform, transition, active} = useSortable({\n      id,\n      transition: disableTransition ? null : TRANSITION,\n    })\n\n    const isActive = id === active?.id\n\n    const style = useMemo(\n      () =>\n        ({\n          transform: CSS.Translate.toString(transform),\n          transition,\n          pointerEvents: active ? 'none' : undefined,\n        }) as const,\n      [transform, transition, active],\n    )\n\n    // This sets the ref on the component for both sorting and for virtualizer\n    const setRef = useCallback(\n      (node: HTMLDivElement | null) => {\n        setNodeRef(node)\n        if (typeof ref === 'function') {\n          ref(node)\n        } else if (ref) {\n          ref.current = node\n        }\n      },\n      [ref, setNodeRef],\n    )\n\n    return (\n      <ListItem\n        ref={setRef}\n        style={style}\n        $moving={isActive}\n        className={isActive ? MOVING_ITEM_CLASS_NAME : ''}\n        data-index={props['data-index']}\n      >\n        {children}\n      </ListItem>\n    )\n  },\n)\n\ninterface ListProps extends ComponentProps<typeof Grid> {\n  sortable?: boolean\n  axis?: Axis\n  items: string[]\n  onItemMove?: (event: {fromIndex: number; toIndex: number}) => void\n  onItemMoveStart?: (event: DragStartEvent) => void\n  onItemMoveEnd?: () => void\n  children?: ReactNode\n}\n\nexport function List(props: ListProps) {\n  const {onItemMove, onItemMoveEnd, onItemMoveStart, sortable, ...rest} = props\n\n  // Note: this is here to make SortableList API compatible with onItemMove\n  const handleSortEnd = useCallback(\n    (event: {fromIndex: number; toIndex: number}) => {\n      onItemMove?.(event)\n    },\n    [onItemMove],\n  )\n\n  return sortable ? (\n    <SortableList\n      onItemMove={handleSortEnd}\n      onItemMoveStart={onItemMoveStart}\n      onItemMoveEnd={onItemMoveEnd}\n      {...rest}\n    />\n  ) : (\n    <Grid {...rest} />\n  )\n}\n\ninterface ItemProps {\n  id: string\n\n  // false positive:\n  // eslint-disable-next-line react/no-unused-prop-types\n  sortable?: boolean\n  disableTransition?: boolean\n  children?: ReactNode\n  'data-index'?: number\n}\n\nexport const Item = forwardRef(function Item(\n  props: ItemProps & ComponentProps<typeof Card>,\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const {sortable, ...rest} = props\n  return (\n    <SortableItemIdContext.Provider value={props.id}>\n      {sortable ? <SortableListItem ref={ref} {...rest} /> : <ListItem ref={ref} {...rest} />}\n    </SortableItemIdContext.Provider>\n  )\n})\n","// todo: get these utils from @sanity/ui instead\nexport function focusRingBorderStyle(border: {color: string; width: number}): string {\n  return `inset 0 0 0 ${border.width}px ${border.color}`\n}\n\nexport function focusRingStyle(opts: {\n  base?: {bg: string}\n  border?: {color: string; width: number}\n  focusRing: {offset: number; width: number}\n}): string {\n  const {base, border, focusRing} = opts\n  const focusRingOutsetWidth = focusRing.offset + focusRing.width\n  const focusRingInsetWidth = 0 - focusRing.offset\n  const bgColor = base ? base.bg : 'var(--card-bg-color)'\n\n  return [\n    focusRingInsetWidth > 0 && `inset 0 0 0 ${focusRingInsetWidth}px var(--card-focus-ring-color)`,\n    border && focusRingBorderStyle(border),\n    focusRingInsetWidth < 0 && `0 0 0 ${0 - focusRingInsetWidth}px ${bgColor}`,\n    focusRingOutsetWidth > 0 && `0 0 0 ${focusRingOutsetWidth}px var(--card-focus-ring-color)`,\n  ]\n    .filter(Boolean)\n    .join(',')\n}\n","/* eslint-disable camelcase */\n\nimport {rem, type Theme} from '@sanity/ui'\nimport {getTheme_v2} from '@sanity/ui/theme'\nimport {type ComponentType} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {focusRingBorderStyle, focusRingStyle} from './helpers'\n\nexport function withFocusRing<Props>(component: ComponentType<Props>) {\n  return styled(component)<Props & {$border?: boolean; $radius?: number}>(\n    (props: {theme: Theme; $border?: boolean; $radius?: number}) => {\n      const {$border, $radius} = props\n      const {card, color, radius} = getTheme_v2(props.theme)\n\n      const border = {width: $border ? 1 : 0, color: 'var(--card-border-color)'}\n\n      return css`\n        --card-focus-box-shadow: ${focusRingBorderStyle(border)};\n\n        border-radius: ${rem(radius[$radius ?? 1])};\n        outline: none;\n        box-shadow: var(--card-focus-box-shadow);\n\n        &:focus {\n          --card-focus-box-shadow: ${focusRingStyle({\n            border,\n            base: color,\n            focusRing: {\n              ...card.focusRing,\n              // An offset of 0 is needed to avoid the focus ring overlap the border of the inner items, the theme has an offset of -1\n              // Detected in empty array items.\n              offset: 0,\n            },\n          })};\n        }\n      `\n    },\n  )\n}\n","/**\n * Utilities for extracting files from dataTransfer in a predictable cross-browser fashion.\n * Also recursively extracts files from a directory\n * Inspired by https://github.com/component/normalized-upload\n */\n\nimport {flatten} from 'lodash'\n\nimport {type FIXME} from '../../../../../FIXME'\n\nexport function extractPastedFiles(dataTransfer: DataTransfer): Promise<File[]> {\n  if (dataTransfer.files && dataTransfer.files.length > 0) {\n    return Promise.resolve(Array.from(dataTransfer.files || []))\n  }\n  return normalizeItems(Array.from(dataTransfer.items || [])).then(flatten)\n}\n\nexport function extractDroppedFiles(dataTransfer: DataTransfer) {\n  const files: File[] = Array.from(dataTransfer.files || [])\n  const items: DataTransferItem[] = Array.from(dataTransfer.items || [])\n  if (files && files.length > 0) {\n    return Promise.resolve(files)\n  }\n  return normalizeItems(items).then(flatten)\n}\n\nfunction toArray<T>(v: T | null): T[] {\n  return v === null ? [] : [v]\n}\n\nfunction normalizeItems(items: DataTransferItem[]) {\n  return Promise.all(\n    items.map((item) => {\n      // directory\n      if (item.kind === 'file' && item.webkitGetAsEntry) {\n        let entry\n        // Edge throws\n        try {\n          entry = item.webkitGetAsEntry()\n        } catch (err) {\n          return toArray(item.getAsFile())\n        }\n        if (!entry) {\n          return []\n        }\n        return entry.isDirectory ? walk(entry as FIXME) : toArray(item.getAsFile())\n      }\n\n      if (item.kind === 'file') {\n        const file = item.getAsFile()\n        return Promise.resolve(file ? [file] : [])\n      }\n\n      if (item.kind === 'string') {\n        // We previously had support for reading datatransfer of strings here but decided to remove it since we don't handle it in higher up in the stack yet.\n        // If one day we want to support data transfer from a string value (e.g. copy+paste from a field to another), an earlier\n        // version of this file includes an implementation that uses DataTransferItem.getAsString to read the string value into a File\n        console.warn('DataTransfer with kind=\"string\" is currently not supported')\n        return Promise.resolve([])\n      }\n\n      console.warn('Unknown DataTransferItem.kind: %s', item.kind)\n      return Promise.resolve([])\n    }),\n  )\n}\n\n// Warning: experimental API: https://wicg.github.io/entries-api\ntype WebKitFileEntry = {\n  isFile: true\n  isDirectory: false\n  name: string\n  fullPath: string\n  file: (fileCallback: (file: File) => void, errorCallback?: (error: Error) => void) => void\n}\n\ntype WebKitDirectoryEntry = {\n  isFile: false\n  isDirectory: true\n  name: string\n  fullPath: string\n  createReader: () => DirectoryReader\n}\n\ntype Entry = WebKitFileEntry | WebKitDirectoryEntry\n\ntype DirectoryReader = {\n  readEntries: (\n    successCallback: (entries: Entry[]) => void,\n    errorCallback?: (error: Error) => void,\n  ) => void\n}\n\nfunction walk(entry: Entry): Promise<File[]> {\n  if (entry.isFile) {\n    return new Promise<File>((resolve, reject) => entry.file(resolve, reject)).then(\n      (file: File) => [file],\n    )\n  }\n\n  if (entry.isDirectory) {\n    const dir = entry.createReader()\n    return new Promise<Entry[]>((resolve, reject) => dir.readEntries(resolve, reject))\n      .then((entries) => entries.filter((entr) => !entr.name.startsWith('.')))\n      .then((entries) => Promise.all(entries.map(walk)).then(flatten))\n  }\n  return Promise.resolve([])\n}\n","export function imageUrlToBlob(\n  imageUrl: string,\n  format = 'image/jpeg',\n  quality = 1,\n): Promise<Blob | null> {\n  if (imageUrl.match(/^webkit-fake-url:\\/\\//)) {\n    return Promise.reject(new Error('Cannot read image contents from webkit fake url'))\n  }\n  return new Promise((resolve, reject) => {\n    const loader = new Image()\n    loader.crossOrigin = 'anonymous'\n    loader.referrerPolicy = 'strict-origin-when-cross-origin'\n    loader.onload = () => {\n      const canvas = document.createElement('canvas')\n      canvas.width = loader.width\n      canvas.height = loader.height\n      const ctx = canvas.getContext('2d')\n      ctx?.drawImage(loader, 0, 0, canvas.width, canvas.height)\n      try {\n        canvas.toBlob(resolve, format, quality)\n      } catch (error) {\n        reject(error)\n      }\n    }\n    loader.src = imageUrl\n  })\n}\n","import {useForwardedRef} from '@sanity/ui'\nimport {\n  type ClipboardEvent,\n  type ComponentType,\n  type DragEvent,\n  type ForwardedRef,\n  forwardRef,\n  type KeyboardEvent,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react'\n\nimport {extractDroppedFiles, extractPastedFiles} from './utils/extractFiles'\nimport {imageUrlToBlob} from './utils/imageUrlToBlob'\n\nexport type FileInfo = {\n  kind: DataTransferItem['kind'] // 'file' or 'string'\n  type: DataTransferItem['type'] // mime type of file or string\n}\n\ntype Props = {\n  // Triggered when the target component receives one or more files, either originating from a drop event or a paste event\n  onFiles?: (files: File[]) => void\n\n  // Triggered by the user dragging files over the target component\n  // Note: We can potentially also support reading from clipboard events here: https://developer.mozilla.org/en-US/docs/Web/API/Clipboard\n  onFilesOver?: (files: FileInfo[]) => void\n\n  // Triggered by the user dragging files out of the target component\n  onFilesOut?: () => void\n\n  disabled?: boolean\n}\n\n// These are managed and can't be passed to the composed component\ntype ManagedProps =\n  | 'onDrop'\n  | 'onDragOver'\n  | 'onPaste'\n  | 'onDragEnter'\n  | 'onDragLeave'\n  | 'onKeyDown'\n\nconst PASTE_INPUT_STYLE = {opacity: 0, position: 'absolute'} as const\n\n/**\n * Higher order component that creates a file target from a given component.\n * Returns a component that acts both as a drop target and a paste target, emitting a list of Files upon drop or paste\n */\nexport function fileTarget<ComponentProps>(Component: ComponentType<ComponentProps>) {\n  return forwardRef(function FileTarget(\n    props: Omit<ComponentProps, ManagedProps> & Props,\n    ref: ForwardedRef<HTMLElement>,\n  ) {\n    const {onFiles, onFilesOver, onFilesOut, disabled, ...rest} = props\n\n    const [showPasteInput, setShowPasteInput] = useState(false)\n\n    const pasteInput = useRef<HTMLDivElement | null>(null)\n    const forwardedRef = useForwardedRef(ref)\n\n    const enteredElements = useRef<Element[]>([])\n\n    const emitFiles = useCallback(\n      (files: File[]) => {\n        onFiles?.(files)\n      },\n      [onFiles],\n    )\n\n    const handleKeyDown = useCallback(\n      (event: KeyboardEvent) => {\n        if (\n          event.target === forwardedRef.current &&\n          (event.ctrlKey || event.metaKey) &&\n          event.key === 'v'\n        ) {\n          setShowPasteInput(true)\n        }\n      },\n      [forwardedRef],\n    )\n    const handlePaste = useCallback(\n      (event: ClipboardEvent) => {\n        extractPastedFiles(event.clipboardData)\n          .then((files) => {\n            if (!pasteInput.current) {\n              return []\n            }\n            return files.length > 0\n              ? files\n              : // Invoke Safari hack if we didn't get any files\n                convertImagesToFilesAndClearContentEditable(pasteInput.current, 'image/jpeg')\n          })\n          .then((files) => {\n            emitFiles(files)\n            setShowPasteInput(false)\n            forwardedRef.current?.focus()\n          })\n      },\n      [emitFiles, forwardedRef],\n    )\n    const handleDrop = useCallback(\n      (event: DragEvent) => {\n        enteredElements.current = []\n        event.preventDefault()\n        event.stopPropagation()\n        const dataTransfer = event.nativeEvent.dataTransfer\n        if (onFiles && dataTransfer) {\n          extractDroppedFiles(dataTransfer).then((files) => {\n            if (files) {\n              emitFiles(files)\n            }\n          })\n        }\n        onFilesOut?.()\n      },\n      [emitFiles, onFiles, onFilesOut],\n    )\n\n    const handleDragOver = useCallback(\n      (event: DragEvent) => {\n        if (onFiles) {\n          event.preventDefault()\n          event.stopPropagation()\n        }\n      },\n      [onFiles],\n    )\n\n    const handleDragEnter = useCallback(\n      (event: DragEvent) => {\n        event.stopPropagation()\n\n        if (onFilesOver && forwardedRef.current === event.currentTarget) {\n          /* this is a (hackish) work around to have the drag and drop work when the file is hovered back and forth over it\n          as part of the refactor and adding more components to the \"hover\" state, it didn't recognise that it just kept adding the same\n          element over and over, so when it tried to remove them on the handleDragLeave, it only removed the last instance.\n        */\n          enteredElements.current = [...new Set(enteredElements.current), event.currentTarget]\n\n          const fileTypes = Array.from(event.dataTransfer.items).map((item) => ({\n            type: item.type,\n            kind: item.kind,\n          }))\n          onFilesOver(fileTypes)\n        }\n      },\n      [onFilesOver, forwardedRef],\n    )\n\n    const handleDragLeave = useCallback(\n      (event: DragEvent) => {\n        event.stopPropagation()\n        const idx = enteredElements.current.indexOf(event.currentTarget)\n        if (idx > -1) {\n          enteredElements.current.splice(idx, 1)\n        }\n        if (enteredElements.current.length === 0) {\n          onFilesOut?.()\n        }\n      },\n      [onFilesOut],\n    )\n\n    const prevShowPasteInput = useRef(false)\n    useEffect(() => {\n      if (!prevShowPasteInput.current && showPasteInput && pasteInput.current) {\n        pasteInput.current.focus()\n        select(pasteInput.current) // Needed by Edge\n      } else if (prevShowPasteInput.current && !showPasteInput) {\n        pasteInput.current?.focus()\n      }\n      prevShowPasteInput.current = showPasteInput\n    }, [showPasteInput])\n\n    return (\n      <>\n        <Component\n          {...(rest as ComponentProps)}\n          ref={forwardedRef}\n          onKeyDown={disabled ? undefined : handleKeyDown}\n          onDragOver={disabled ? undefined : handleDragOver}\n          onDragEnter={disabled ? undefined : handleDragEnter}\n          onDragLeave={disabled ? undefined : handleDragLeave}\n          onDrop={disabled ? undefined : handleDrop}\n        />\n        {!disabled && showPasteInput && (\n          <div contentEditable onPaste={handlePaste} ref={pasteInput} style={PASTE_INPUT_STYLE} />\n        )}\n      </>\n    )\n  })\n}\n\n// this is a hack for Safari that reads pasted image(s) from an ContentEditable div instead of the onpaste event\nfunction convertImagesToFilesAndClearContentEditable(\n  element: HTMLElement,\n  targetFormat = 'image/jpeg',\n): Promise<File[]> {\n  if (!element.isContentEditable) {\n    return Promise.reject(\n      new Error(\n        `Expected element to be contentEditable=\"true\". Instead found a non contenteditable ${element.tagName}`,\n      ),\n    )\n  }\n  return new Promise((resolve) => setTimeout(resolve, 10)) // add a delay so the paste event can finish\n    .then(() => Array.from(element.querySelectorAll('img')))\n    .then((imageElements) => {\n      element.innerHTML = '' // clear\n      return imageElements\n    })\n    .then((images) => Promise.all(images.map((img) => imageUrlToBlob(img.src))))\n    .then((imageBlobs) =>\n      imageBlobs.map((blob) => new File([blob!], 'pasted-image.jpg', {type: targetFormat})),\n    )\n}\n\n// needed by Edge\nfunction select(el: Element) {\n  const range = document.createRange()\n  range.selectNodeContents(el)\n  const sel = window.getSelection()\n  sel?.removeAllRanges()\n  sel?.addRange(range)\n}\n","import {AccessDeniedIcon, UploadIcon} from '@sanity/icons'\nimport {type SchemaType} from '@sanity/types'\nimport {Box, Inline, Text} from '@sanity/ui'\n\nimport {useTranslation} from '../../../../i18n'\nimport {type FileLike, type UploaderResolver} from '../../../studio/uploads/types'\n\ninterface Props {\n  hoveringFiles: FileLike[]\n  types: SchemaType[]\n  resolveUploader: UploaderResolver\n}\n\nexport function DropMessage(props: Props) {\n  const {hoveringFiles, types, resolveUploader} = props\n  const acceptedFiles = hoveringFiles.filter((file) =>\n    types.some((type) => resolveUploader(type, file)),\n  )\n  const rejectedFilesCount = hoveringFiles.length - acceptedFiles.length\n  const multiple = types.length > 1\n  const {t} = useTranslation()\n  return (\n    <>\n      {acceptedFiles.length > 0 ? (\n        <>\n          <Inline space={2}>\n            <Text>\n              <UploadIcon />\n            </Text>\n            {multiple\n              ? t('inputs.files.common.drop-message.drop-to-upload-multi', {\n                  count: acceptedFiles.length,\n                })\n              : t('inputs.files.common.drop-message.drop-to-upload')}\n            <Text />\n          </Inline>\n          {rejectedFilesCount > 0 && (\n            <Box marginTop={4}>\n              <Inline space={2}>\n                <Text muted size={1}>\n                  <AccessDeniedIcon />\n                </Text>\n                <Text muted size={1}>\n                  {t('inputs.files.common.drop-message.drop-to-upload.rejected-file-message', {\n                    count: rejectedFilesCount,\n                  })}\n                </Text>\n              </Inline>\n            </Box>\n          )}\n        </>\n      ) : (\n        <Inline space={2}>\n          <Text>\n            <AccessDeniedIcon />\n          </Text>\n          <Text>\n            {t('inputs.files.common.drop-message.drop-to-upload.no-accepted-file-message', {\n              count: hoveringFiles.length,\n            })}\n          </Text>\n        </Inline>\n      )}\n    </>\n  )\n}\n","import {Layer} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const Overlay = styled(Layer)`\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  top: -2px;\n  left: -2px;\n  right: -2px;\n  bottom: -2px;\n  background-color: var(--card-bg-color);\n  opacity: 0.8;\n`\n","import {type SchemaType} from '@sanity/types'\nimport {Box, Flex, Text, useToast} from '@sanity/ui'\nimport {sortBy} from 'lodash'\nimport {\n  type ComponentType,\n  type ForwardedRef,\n  forwardRef,\n  type ReactNode,\n  useCallback,\n  useState,\n} from 'react'\nimport styled from 'styled-components'\n\nimport {type FIXME} from '../../../../../FIXME'\nimport {useTranslation} from '../../../../../i18n'\nimport {\n  type FileLike,\n  type ResolvedUploader,\n  type UploaderResolver,\n} from '../../../../studio/uploads/types'\nimport {type UploadEvent} from '../../../../types'\nimport {type FileInfo, fileTarget} from '../../../common/fileTarget'\nimport {DropMessage} from '../../../files/common/DropMessage'\nimport {Overlay} from './styles'\n\nexport interface UploadTargetProps {\n  types: SchemaType[]\n  resolveUploader?: UploaderResolver<FIXME>\n  onUpload?: (event: UploadEvent) => void\n  children?: ReactNode\n}\n\n// todo: define and export this as a core interface in this package\ninterface UploadTask {\n  file: File\n  uploaderCandidates: ResolvedUploader[]\n}\n\nconst Root = styled.div`\n  position: relative;\n`\n\nfunction getUploadCandidates(\n  types: SchemaType[],\n  resolveUploader: UploaderResolver,\n  file: FileLike,\n) {\n  return types\n    .map((memberType) => ({\n      type: memberType,\n      uploader: resolveUploader(memberType, file),\n    }))\n    .filter((member) => member.uploader) as ResolvedUploader[]\n}\nexport function uploadTarget<Props>(Component: ComponentType<Props>) {\n  const FileTarget = fileTarget<FIXME>(Component)\n\n  return forwardRef(function UploadTarget(\n    props: UploadTargetProps & Props,\n    forwardedRef: ForwardedRef<HTMLElement>,\n  ) {\n    const {children, resolveUploader, onUpload, types, ...rest} = props\n    const {push: pushToast} = useToast()\n    const {t} = useTranslation()\n\n    const uploadFile = useCallback(\n      (file: File, resolvedUploader: ResolvedUploader) => {\n        const {type, uploader} = resolvedUploader\n        onUpload?.({file, schemaType: type, uploader})\n      },\n      [onUpload],\n    )\n\n    const handleFiles = useCallback(\n      (files: File[]) => {\n        if (!resolveUploader) {\n          return\n        }\n        const tasks: UploadTask[] = files.map((file) => ({\n          file,\n          uploaderCandidates: getUploadCandidates(types, resolveUploader, file),\n        }))\n        const ready = tasks.filter((task) => task.uploaderCandidates.length > 0)\n        const rejected: UploadTask[] = tasks.filter((task) => task.uploaderCandidates.length === 0)\n\n        if (rejected.length > 0) {\n          pushToast({\n            closable: true,\n            status: 'warning',\n            title: t('inputs.array.error.cannot-upload-unable-to-convert', {\n              count: rejected.length,\n            }),\n            description: rejected.map((task, i) => (\n              <Flex key={i} gap={2} padding={2}>\n                <Box>\n                  <Text weight=\"medium\">{task.file.name}</Text>\n                </Box>\n                <Box>\n                  <Text size={1}>({task.file.type})</Text>\n                </Box>\n              </Flex>\n            )),\n          })\n        }\n\n        // todo: consider if we should to ask the user here\n        // the list of candidates is sorted by their priority and the first one is selected\n        // const ambiguous = tasks\n        //   .filter(task => task.uploaderCandidates.length > 1)\n        ready.forEach((task) => {\n          uploadFile(\n            task.file,\n            // eslint-disable-next-line max-nested-callbacks\n            sortBy(task.uploaderCandidates, (candidate) => candidate.uploader.priority)[0],\n          )\n        })\n      },\n      [pushToast, resolveUploader, types, uploadFile, t],\n    )\n\n    const [hoveringFiles, setHoveringFiles] = useState<FileInfo[]>([])\n    const handleFilesOut = useCallback(() => setHoveringFiles([]), [])\n\n    return (\n      <Root>\n        <FileTarget\n          {...rest}\n          ref={forwardedRef}\n          onFiles={handleFiles}\n          onFilesOver={setHoveringFiles}\n          onFilesOut={handleFilesOut}\n        >\n          {resolveUploader && hoveringFiles.length > 0 && (\n            <Overlay zOffset={10}>\n              <DropMessage\n                hoveringFiles={hoveringFiles}\n                types={types}\n                resolveUploader={resolveUploader}\n              />\n            </Overlay>\n          )}\n          {children}\n        </FileTarget>\n      </Root>\n    )\n  })\n}\n","import {Card} from '@sanity/ui'\n\nimport {withFocusRing} from '../../../components/withFocusRing'\nimport {uploadTarget} from './uploadTarget/uploadTarget'\n\nexport const UploadTargetCard = withFocusRing(uploadTarget(Card))\n","import {AddIcon} from '@sanity/icons'\nimport {type ArraySchemaType, isReferenceSchemaType} from '@sanity/types'\nimport {Grid, Menu} from '@sanity/ui'\nimport {useCallback, useId} from 'react'\n\nimport {\n  Button,\n  MenuButton,\n  type MenuButtonProps,\n  MenuItem,\n  Tooltip,\n} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {type ArrayInputFunctionsProps, type ObjectItem} from '../../../types'\n\nconst POPOVER_PROPS: MenuButtonProps['popover'] = {\n  constrainSize: true,\n  portal: true,\n  fallbackPlacements: ['top', 'bottom'],\n}\n\n/**\n * @hidden\n * @beta */\nexport function ArrayOfObjectsFunctions<\n  Item extends ObjectItem,\n  SchemaType extends ArraySchemaType,\n>(props: ArrayInputFunctionsProps<Item, SchemaType>) {\n  const {schemaType, readOnly, children, onValueCreate, onItemAppend} = props\n  const menuButtonId = useId()\n  const {t} = useTranslation()\n\n  const insertItem = useCallback(\n    (itemType: any) => {\n      const item = onValueCreate(itemType)\n\n      onItemAppend(item)\n    },\n    [onValueCreate, onItemAppend],\n  )\n\n  const handleAddBtnClick = useCallback(() => {\n    insertItem(schemaType.of[0])\n  }, [schemaType, insertItem])\n\n  // If we have more than a single type candidate, we render a menu, so the button might show\n  // \"Add item...\" instead of simply \"Add item\", to indicate that further choices are available.\n  const addItemI18nKey =\n    schemaType.of.length > 1\n      ? 'inputs.array.action.add-item-select-type'\n      : 'inputs.array.action.add-item'\n\n  if (readOnly) {\n    return (\n      <Tooltip portal content={t('inputs.array.read-only-label')}>\n        <Grid>\n          <Button icon={AddIcon} mode=\"ghost\" disabled size=\"large\" text={t(addItemI18nKey)} />\n        </Grid>\n      </Tooltip>\n    )\n  }\n\n  return (\n    <Grid gap={1} style={{gridTemplateColumns: 'repeat(auto-fit, minmax(100px, 1fr))'}}>\n      {schemaType.of.length === 1 ? (\n        <Button\n          icon={AddIcon}\n          mode=\"ghost\"\n          onClick={handleAddBtnClick}\n          size=\"large\"\n          text={t(addItemI18nKey)}\n        />\n      ) : (\n        <MenuButton\n          button={<Button icon={AddIcon} mode=\"ghost\" size=\"large\" text={t(addItemI18nKey)} />}\n          id={menuButtonId || ''}\n          menu={\n            <Menu>\n              {schemaType.of.map((memberDef, i) => {\n                // Use reference icon if reference is to one schemaType only\n                const referenceIcon =\n                  isReferenceSchemaType(memberDef) &&\n                  (memberDef.to || []).length === 1 &&\n                  memberDef.to[0].icon\n\n                const icon = memberDef.icon || memberDef.type?.icon || referenceIcon\n                return (\n                  <MenuItem\n                    key={i}\n                    text={memberDef.title || memberDef.type?.name}\n                    onClick={() => insertItem(memberDef)}\n                    icon={icon}\n                  />\n                )\n              })}\n            </Menu>\n          }\n          popover={POPOVER_PROPS}\n        />\n      )}\n\n      {children}\n    </Grid>\n  )\n}\n","import {Box, Card, type CardTone, Flex} from '@sanity/ui'\nimport {type ComponentProps, type ReactNode} from 'react'\nimport styled from 'styled-components'\n\nimport {DragHandle} from '../common/DragHandle'\nimport {MOVING_ITEM_CLASS_NAME} from '../common/list'\n\ninterface RowLayoutProps {\n  tone?: CardTone\n  dragHandle?: boolean\n  presence?: ReactNode\n  validation?: ReactNode\n  menu?: ReactNode\n  footer?: ReactNode\n  selected?: boolean\n  children?: ReactNode\n}\n\nconst FooterFlex = styled(Flex)`\n  min-height: 33px;\n`\nconst PresenceFlex = styled(Flex)`\n  position: absolute;\n  top: 0;\n  right: 0;\n  height: 33px;\n`\n\nconst DragHandleCard = styled(Card)`\n  position: absolute;\n  top: 0;\n  left: 0;\n`\nconst Root = styled(Card)`\n  transition: border-color 250ms;\n  box-sizing: border-box;\n  position: relative;\n\n  @media (hover: hover) {\n    ${DragHandleCard} {\n      opacity: 0;\n    }\n\n    &:hover,\n    &:focus-within {\n      ${DragHandleCard} {\n        opacity: 1;\n      }\n    }\n  }\n\n  .${MOVING_ITEM_CLASS_NAME} & {\n    box-shadow:\n      0 0 0 0,\n      0 8px 17px 2px var(--card-shadow-umbra-color),\n      0 3px 14px 2px var(--card-shadow-penumbra-color),\n      0 5px 5px -3px var(--card-shadow-ambient-color);\n  }\n\n  &[aria-selected='true'] {\n    box-shadow: 0 0 0 2px var(--card-focus-ring-color);\n  }\n`\n\n/**\n * Use this to get the layout for grid items\n */\nexport function CellLayout(props: RowLayoutProps & ComponentProps<typeof Root>) {\n  const {validation, selected, tone, presence, children, dragHandle, menu, footer, ...rest} = props\n\n  return (\n    <Root\n      forwardedAs={Flex}\n      direction=\"column\"\n      border\n      selected={selected}\n      aria-selected={selected}\n      radius={1}\n      tone={tone}\n      {...rest}\n    >\n      {children}\n\n      {dragHandle && (\n        <DragHandleCard\n          margin={1}\n          radius={2}\n          display=\"flex\"\n          tone=\"inherit\"\n          data-ui=\"DragHandleCard\"\n        >\n          <DragHandle $grid mode=\"ghost\" />\n        </DragHandleCard>\n      )}\n\n      {presence && (\n        <PresenceFlex align=\"center\" marginX={1}>\n          {presence}\n        </PresenceFlex>\n      )}\n\n      <FooterFlex align=\"center\" paddingX={1} sizing=\"border\" justify=\"space-between\">\n        <Flex>{validation}</Flex>\n        <Box>{footer}</Box>\n        {menu}\n      </FooterFlex>\n    </Root>\n  )\n}\n","import {BulbOutlineIcon, UnknownIcon} from '@sanity/icons'\nimport {Box, Card, Code, Stack, Text, type Theme, useClickOutside} from '@sanity/ui'\nimport {resolveTypeName} from '@sanity/util/content'\nimport {type FocusEvent, useCallback, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../../../ui-components'\nimport {Translate, useTranslation} from '../../../../../i18n'\n\nconst PopoverCard = styled(Card)`\n  max-width: ${({theme}: {theme: Theme}) => theme.sanity.container[1]}px;\n`\n\ninterface Props {\n  value: unknown\n  onFocus?: (event: FocusEvent) => void\n  vertical?: boolean\n}\n\nexport function IncompatibleItemType(props: Props) {\n  const {value, onFocus, vertical, ...rest} = props\n  const [showDetails, setShowDetails] = useState(false)\n  const [popoverRef, setPopoverRef] = useState<HTMLElement | null>(null)\n\n  const {t} = useTranslation()\n\n  useClickOutside(() => setShowDetails(false), [popoverRef])\n\n  const handleKeyDown = useCallback((e: any) => {\n    if (e.key === 'Escape' || e.key === 'Tab') {\n      setShowDetails(false)\n    }\n  }, [])\n\n  const handleShowDetails = useCallback(() => {\n    setShowDetails((v) => !v)\n  }, [])\n\n  const typeName = resolveTypeName(value)\n  return (\n    <Popover\n      open={showDetails}\n      ref={setPopoverRef}\n      onKeyDown={handleKeyDown}\n      portal\n      constrainSize\n      tone=\"default\"\n      content={\n        <PopoverCard margin={1} padding={3} onKeyDown={handleKeyDown} tabIndex={0} overflow=\"auto\">\n          <Stack space={4}>\n            <Box>\n              <Text weight=\"medium\">{t('inputs.array.error.type-is-incompatible-title')}</Text>\n            </Box>\n            <Text size={1}>\n              <Translate\n                t={t}\n                i18nKey=\"inputs.array.error.current-schema-not-declare-description\"\n                values={{typeName}}\n              />\n            </Text>\n            <Box>\n              <Text size={1}>\n                <BulbOutlineIcon /> {t('inputs.array.error.can-delete-but-no-edit-description')}\n              </Text>\n            </Box>\n            <Stack space={2}>\n              <Text size={1} weight=\"medium\">\n                {t('inputs.array.error.json-representation-description')}\n              </Text>\n              <Card padding={2} overflow=\"auto\" border>\n                <Code size={1} as=\"pre\" language=\"json\">\n                  {JSON.stringify(value, null, 2)}\n                </Code>\n              </Card>\n            </Stack>\n          </Stack>\n        </PopoverCard>\n      }\n    >\n      <Card\n        as=\"button\"\n        type=\"button\"\n        radius={2}\n        tone=\"inherit\"\n        paddingX={2}\n        paddingY={3}\n        style={{height: '100%'}}\n        onFocus={onFocus}\n        onClick={handleShowDetails}\n        onKeyDown={handleKeyDown}\n        __unstable_focusRing\n        {...rest}\n      >\n        <Stack space={4} marginTop={2}>\n          <Box margin={1}>\n            <Text align=\"center\" size={4}>\n              <UnknownIcon />\n            </Text>\n          </Box>\n          <Text align=\"center\" size={1}>\n            <Translate\n              t={t}\n              i18nKey=\"inputs.array.error.type-is-incompatible-prompt\"\n              values={{typeName}}\n            />\n          </Text>\n        </Stack>\n      </Card>\n    </Popover>\n  )\n}\n","import {TrashIcon} from '@sanity/icons'\nimport {Menu} from '@sanity/ui'\nimport {useCallback, useId} from 'react'\n\nimport {MenuButton, MenuItem} from '../../../../../../ui-components'\nimport {ContextMenuButton} from '../../../../../components/contextMenuButton'\nimport {useTranslation} from '../../../../../i18n'\nimport {PatchEvent, unset} from '../../../../patch'\nimport {type ArrayItemError} from '../../../../store'\nimport {useFormCallbacks} from '../../../../studio/contexts/FormCallbacks'\nimport {CellLayout} from '../../layouts/CellLayout'\nimport {IncompatibleItemType} from './IncompatibleItemType'\n\nconst MENU_POPOVER_PROPS = {portal: true, tone: 'default'} as const\n\nexport function ErrorItem(props: {member: ArrayItemError; sortable?: boolean}) {\n  const {member, sortable} = props\n  const id = useId()\n  const {onChange} = useFormCallbacks()\n  const {t} = useTranslation()\n\n  const handleRemove = useCallback(() => {\n    onChange(PatchEvent.from([unset([{_key: member.key}])]))\n  }, [onChange, member.key])\n\n  return (\n    <CellLayout\n      dragHandle={sortable}\n      tone=\"caution\"\n      style={{height: '100%'}}\n      menu={\n        <MenuButton\n          button={<ContextMenuButton paddingY={3} />}\n          id={`${id}-menuButton`}\n          menu={\n            <Menu>\n              <MenuItem\n                text={t('inputs.array.action.remove-invalid-item')}\n                tone=\"critical\"\n                icon={TrashIcon}\n                onClick={handleRemove}\n              />\n            </Menu>\n          }\n          popover={MENU_POPOVER_PROPS}\n        />\n      }\n    >\n      {member.error.type === 'INVALID_ITEM_TYPE' ? (\n        <IncompatibleItemType value={member.error.value} vertical />\n      ) : (\n        <div>{t('inputs.array.error.unexpected-error', {error: member.error.type})}</div>\n      )}\n    </CellLayout>\n  )\n}\n","import {isKeyedObject, type Path} from '@sanity/types'\n\nexport function pathToString(path: Path | undefined = []): string {\n  return path.reduce<string>((target, segment, i) => {\n    const segmentType = typeof segment\n    if (segmentType === 'number') {\n      return `${target}[${segment}]`\n    }\n\n    if (segmentType === 'string') {\n      const separator = i === 0 ? '' : '.'\n      return `${target}${separator}${segment}`\n    }\n\n    if (isKeyedObject(segment)) {\n      return `${target}[_key==\"${segment._key}\"]`\n    }\n\n    throw new Error(`Unsupported path segment \"${segment}\"`)\n  }, '')\n}\n","import {type Path, type ValidationError, type ValidationMarker} from '@sanity/types'\n\nimport {type ValidationContext} from '../types'\nimport {pathToString} from '../util/pathToString'\n\nexport function isNonNullable<T>(t: T): t is NonNullable<T> {\n  return t !== null || t !== undefined\n}\n\nexport function convertToValidationMarker(\n  validatorResult: true | true[] | string | string[] | ValidationError | ValidationError[],\n  level: 'error' | 'warning' | 'info' | undefined,\n  context: ValidationContext,\n): ValidationMarker[] {\n  if (!context) {\n    throw new Error('missing context')\n  }\n\n  if (validatorResult === true) return []\n\n  if (Array.isArray(validatorResult)) {\n    return validatorResult\n      .flatMap((child) => convertToValidationMarker(child, level, context))\n      .filter(isNonNullable)\n  }\n\n  if (typeof validatorResult === 'string') {\n    return convertToValidationMarker({message: validatorResult}, level, context)\n  }\n\n  if (typeof validatorResult.message !== 'string') {\n    // in order to accept the `ValidationError`, it at least needs to have a\n    // `message` in the object\n    throw new Error(\n      `${pathToString(\n        context.path,\n      )}: Validator must return 'true' if valid or an error message as a string on errors`,\n    )\n  }\n\n  const {message} = validatorResult\n\n  const normalizedPaths: Path[] = []\n  if (validatorResult.path) {\n    normalizedPaths.push(validatorResult.path)\n  }\n\n  // legacy support for `paths`\n  for (const path of validatorResult.paths || []) {\n    normalizedPaths.push(path)\n  }\n\n  // the validator result does not include any item-level relative paths,\n  // then just return the top-level path with the validation result\n  if (!normalizedPaths.length) {\n    return [\n      {\n        level: level || 'error',\n        item: {message},\n        message,\n        path: context.path || [],\n      },\n    ]\n  }\n\n  // if the validator result did include item-level relative paths, then for\n  // each item-level relative path, create a validation marker that concatenates\n  // the relative path with the path from the validation context\n  return normalizedPaths.map((path) => ({\n    path: (context.path || []).concat(path),\n    level: level || 'error',\n    item: {message},\n    message,\n  }))\n}\n","/* eslint-disable no-useless-escape */\nexport function escapeRegex(string: string): string {\n  // Escape ^$.*+-?=!:|\\/()[]{},\n  return string.replace(/[\\^\\$\\.\\*\\+\\-\\?\\=\\!\\:\\|\\\\\\/\\(\\)\\[\\]\\{\\}\\,]/g, '\\\\$&')\n}\n","import {type CustomValidatorResult, type LocalizedValidationMessages} from '@sanity/types'\nimport {isPlainObject} from 'lodash'\n\nimport {type LocaleSource} from '../../i18n'\n\n/**\n * Extracts the correct localized validation message based on given locale source\n *\n * @param message - Localized messages to extract string from\n * @param i18n - Locale source, holding the current locale\n * @returns The localized string, or a fallback \"Unknown error\" if not found\n * @internal\n */\nexport function localizeMessage(message: LocalizedValidationMessages, i18n: LocaleSource): string {\n  const {currentLocale} = i18n\n  const locale = currentLocale.id\n\n  // Obviously, try direct match first (`no-NB`)\n  if (message[locale]) {\n    return message[locale]\n  }\n\n  // In the case of composed languages (`en-US`, `no-NB` etc), fall back to base language (`en`)\n  if (locale.includes('-')) {\n    const language = locale.split('-', 1)[0]\n    if (message[language]) {\n      return message[language]\n    }\n  }\n\n  // Try english as last resort\n  return (\n    message['en-US'] || message['en-GB'] || message.en || 'Unknown validation error (not localized)'\n  )\n}\n\n/**\n * Check if passed message/result is a localized message object\n *\n * @param message - Message to check\n * @returns True if message is a localized message object, false otherwise\n * @internal\n */\nexport function isLocalizedMessages(\n  message: CustomValidatorResult | undefined,\n): message is LocalizedValidationMessages {\n  return (\n    message !== true &&\n    typeof message !== 'undefined' &&\n    typeof message !== 'string' &&\n    isPlainObject(message) &&\n    !('message' in message)\n  )\n}\n","/**\n * Modified version of fast-deep-equal (https://github.com/epoberezkin/fast-deep-equal)\n * MIT-licensed, copyright (c) 2017 Evgeny Poberezkin\n **/\n\n// NOTE: when converting to typescript, some of the checks were inlined (vs\n// having them in a variable) because the type predicate type narrowing only\n// works when type predicate is called inline in the condition that starts the\n// control flow branch.\n// see here: https://www.typescriptlang.org/docs/handbook/2/narrowing.html\nexport function deepEquals(a: unknown, b: unknown): boolean {\n  if (a === b) {\n    return true\n  }\n\n  if (Array.isArray(a) && Array.isArray(b)) {\n    if (a.length != b.length) return false\n    for (let i = 0; i < a.length; i++) {\n      if (!deepEquals(a[i], b[i])) {\n        return false\n      }\n    }\n    return true\n  }\n\n  if (Array.isArray(a) != Array.isArray(b)) {\n    return false\n  }\n\n  if (a && b && typeof a === 'object' && typeof b === 'object') {\n    const keys = Object.keys(a)\n    if (keys.length !== Object.keys(b).length) {\n      return false\n    }\n\n    if (a instanceof Date && b instanceof Date) {\n      return a.getTime() === b.getTime()\n    }\n\n    if (a instanceof Date != b instanceof Date) {\n      return false\n    }\n\n    if (a instanceof RegExp && b instanceof RegExp) {\n      return a.toString() == b.toString()\n    }\n\n    if (a instanceof RegExp != b instanceof RegExp) {\n      return false\n    }\n\n    for (let i = 0; i < keys.length; i++) {\n      if (keys[i] === '_key') {\n        continue\n      }\n\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) {\n        return false\n      }\n    }\n\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i] as keyof typeof a\n      if (key === '_key') {\n        continue\n      }\n\n      if (!deepEquals(a[key], b[key])) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  return false\n}\n","// this file was adapted from a previous dependency `type-of-is`\n// https://github.com/stephenhandley/type-of-is/blob/7138a7e79f5af7c286bf8123f60843a91aaebf38/index.js\nconst _toString = {}.toString\n\nconst builtIns = [Object, Function, Array, String, Boolean, Number, Date, RegExp, Error]\n\nfunction isBuiltIn(_constructor: unknown) {\n  for (let i = 0; i < builtIns.length; i++) {\n    if (builtIns[i] === _constructor) return true\n  }\n  return false\n}\n\nexport function typeString(obj: unknown): string {\n  // [object Blah] -> Blah\n  const stringType = _toString.call(obj).slice(8, -1)\n  if (obj === null || obj === undefined) return stringType.toLowerCase()\n\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  const constructorType = (obj as object).constructor\n  if (constructorType && !isBuiltIn(constructorType)) return constructorType.name\n  return stringType\n}\n","import {type ValidationMarker, type Validators} from '@sanity/types'\n\nimport {type LocaleSource} from '../../i18n'\nimport {deepEquals} from '../util/deepEquals'\nimport {isLocalizedMessages, localizeMessage} from '../util/localizeMessage'\nimport {pathToString} from '../util/pathToString'\nimport {typeString} from '../util/typeString'\n\nconst SLOW_VALIDATOR_TIMEOUT = 5000\n\nconst formatValidationErrors = (options: {\n  message: string | undefined\n  results: ValidationMarker[]\n  operation: 'conjunction' | 'disjunction'\n  i18n: LocaleSource\n}) => {\n  if (options.message) return options.message\n  if (options.results.length === 1) return options.results[0]?.message\n\n  // Intentionally hard-coded to use locale conjunction/disjunctions\n  return options.i18n.t('{{messages, list}}', {\n    messages: options.results.map((err) => err.message || err.item?.message),\n    formatParams: {messages: {style: 'long', type: options.operation}},\n  })\n}\n\nexport const genericValidators: Validators = {\n  type: (expectedType, value, message, {i18n}) => {\n    const actualType = typeString(value)\n    if (actualType !== expectedType && actualType !== 'undefined') {\n      return message || i18n.t('validation:generic.incorrect-type', {actualType, expectedType})\n    }\n\n    return true\n  },\n\n  presence: (expected, value, message, {i18n}) => {\n    if (value === undefined && expected === 'required') {\n      return message || i18n.t('validation:generic.required')\n    }\n\n    return true\n  },\n\n  all: async (children, value, message, context) => {\n    const resolved = await Promise.all(children.map((child) => child.validate(value, context)))\n    const results = resolved.flat()\n\n    if (results.length === 0) {\n      return true\n    }\n\n    return formatValidationErrors({\n      message,\n      results,\n      operation: 'conjunction',\n      i18n: context.i18n,\n    })\n  },\n\n  either: async (children, value, message, context) => {\n    const resolved = await Promise.all(children.map((child) => child.validate(value, context)))\n    const results = resolved.flat()\n\n    // if one of the results is an empty array then at least one rule match\n    if (resolved.find((result) => !result.length)) {\n      return true\n    }\n\n    return formatValidationErrors({\n      message,\n      results,\n      operation: 'disjunction',\n      i18n: context.i18n,\n    })\n  },\n\n  valid: (allowedValues, actual, message, {i18n}) => {\n    const valueType = typeof actual\n    if (valueType === 'undefined') {\n      return true\n    }\n\n    const value = (valueType === 'number' || valueType === 'string') && `${actual}`\n    const strValue = value && value.length > 30 ? `${value.slice(0, 30)}` : value\n\n    return allowedValues.some((expected) => deepEquals(expected, actual))\n      ? true\n      : message ||\n          i18n.t(\n            'validation:generic.not-allowed',\n            value ? {context: 'hint', replace: {hint: strValue}} : {},\n          )\n  },\n\n  custom: async (fn, value, message, context) => {\n    const slowTimer = setTimeout(() => {\n      // only show this warning in the studio\n      if (context.environment !== 'studio') return\n\n      // eslint-disable-next-line no-console\n      console.warn(\n        `Custom validator at ${pathToString(\n          context.path,\n        )} has taken more than ${SLOW_VALIDATOR_TIMEOUT}ms to respond`,\n      )\n    }, SLOW_VALIDATOR_TIMEOUT)\n\n    let result\n    try {\n      result = await fn(value, context)\n    } finally {\n      clearTimeout(slowTimer)\n    }\n\n    if (isLocalizedMessages(result)) {\n      return localizeMessage(result, context.i18n)\n    }\n\n    if (typeof result === 'string') {\n      return message || result\n    }\n\n    return result\n  },\n}\n","import {\n  isArrayOfBlocksSchemaType,\n  type Path,\n  type PathSegment,\n  type Validators,\n} from '@sanity/types'\n\nimport {deepEquals} from '../util/deepEquals'\nimport {genericValidators} from './genericValidator'\n\nexport const arrayValidators: Validators = {\n  ...genericValidators,\n\n  min: (minLength, value, message, {i18n, type}) => {\n    if (!value || value.length >= minLength) {\n      return true\n    }\n\n    const context = isArrayOfBlocksSchemaType(type) ? 'blocks' : undefined\n    return message || i18n.t('validation:array.minimum-length', {minLength, context})\n  },\n\n  max: (maxLength, value, message, {i18n, type}) => {\n    if (!value || value.length <= maxLength) {\n      return true\n    }\n\n    const context = isArrayOfBlocksSchemaType(type) ? 'blocks' : undefined\n    return message || i18n.t('validation:array.maximum-length', {maxLength, context})\n  },\n\n  length: (wantedLength, value, message, {i18n, type}) => {\n    if (!value || value.length === wantedLength) {\n      return true\n    }\n\n    const context = isArrayOfBlocksSchemaType(type) ? 'blocks' : undefined\n    return message || i18n.t('validation:array.exact-length', {wantedLength, context})\n  },\n\n  presence: (flag, value, message, {i18n}) => {\n    if (flag === 'required' && !value) {\n      return message || i18n.t('validation:generic.required', {context: 'array'})\n    }\n\n    return true\n  },\n\n  valid: (allowedValues, values, message, {i18n}) => {\n    const valueType = typeof values\n    if (valueType === 'undefined') {\n      return true\n    }\n\n    const paths: Path[] = []\n    for (let i = 0; i < values.length; i++) {\n      const value = values[i]\n      if (allowedValues.some((expected) => deepEquals(expected, value))) {\n        continue\n      }\n\n      const pathSegment: PathSegment = value && value._key ? {_key: value._key} : i\n      paths.push([pathSegment])\n    }\n\n    // we emit the same message for each path we find in this array\n    const sharedMessage = message || i18n.t('validation:generic.not-allowed')\n\n    return paths.map((path) => ({message: sharedMessage, path}))\n  },\n\n  unique: (_unused, value, message, {i18n}) => {\n    const dupeIndices = []\n    if (!value) {\n      return true\n    }\n\n    for (let x = 0; x < value.length; x++) {\n      for (let y = x + 1; y < value.length; y++) {\n        const itemA = value[x]\n        const itemB = value[y]\n\n        if (!deepEquals(itemA, itemB)) {\n          continue\n        }\n\n        if (dupeIndices.indexOf(x) === -1) {\n          dupeIndices.push(x)\n        }\n\n        if (dupeIndices.indexOf(y) === -1) {\n          dupeIndices.push(y)\n        }\n      }\n    }\n\n    const paths = dupeIndices.map((idx) => {\n      const item = value[idx]\n      const pathSegment = item && item._key ? {_key: item._key} : idx\n      return [pathSegment]\n    })\n\n    // we emit the same message for each path we find in this array\n    const sharedMessage = message || i18n.t('validation:array.item-duplicate')\n\n    return paths.map((path) => ({message: sharedMessage, path}))\n  },\n}\n","import {type Validators} from '@sanity/types'\n\nimport {genericValidators} from './genericValidator'\n\nexport const booleanValidators: Validators = {\n  ...genericValidators,\n\n  presence: (flag, value, message, {i18n}) => {\n    if (flag === 'required' && typeof value !== 'boolean') {\n      return message || i18n.t('validation:generic.required', {context: 'boolean'})\n    }\n\n    return true\n  },\n}\n","import {type Validators} from '@sanity/types'\nimport * as legacyDateFormat from '@sanity/util/legacyDateFormat'\n\nimport {genericValidators} from './genericValidator'\n\nfunction isRecord(obj: unknown): obj is Record<string, unknown> {\n  return typeof obj === 'object' && obj !== null && !Array.isArray(obj)\n}\n\nconst isoDate =\n  /^(?:[-+]\\d{2})?(?:\\d{4}(?!\\d{2}\\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\\1(?:[12]\\d|0[1-9]|3[01]))?|W(?:[0-4]\\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\\d|[12]\\d{2}|3(?:[0-5]\\d|6[1-6])))(?![T]$|[T][\\d]+Z$)(?:[T\\s](?:(?:(?:[01]\\d|2[0-3])(?:(:?)[0-5]\\d)?|24:?00)(?:[.,]\\d+(?!:))?)(?:\\2[0-5]\\d(?:[.,]\\d+)?)?(?:[Z]|(?:[+-])(?:[01]\\d|2[0-3])(?::?[0-5]\\d)?)?)?)?$/\n\n// eslint-disable-next-line no-warning-comments\n// TODO (eventually): move these to schema type package\ninterface DateTimeOptions {\n  // @todo accept object representing `Intl.DateTimeFormatOptions`? how do we localize?\n  dateFormat?: string\n  timeFormat?: string\n}\n\nconst getFormattedDate = (type = '', value: Date, options?: DateTimeOptions) => {\n  const dateFormat = options?.dateFormat || legacyDateFormat.DEFAULT_DATE_FORMAT\n  const timeFormat = options?.timeFormat || legacyDateFormat.DEFAULT_TIME_FORMAT\n\n  // adding the time information in the date only case causes timezone information to be kept\n  // instead of it being assumed to be UTC. This was a problem because midnight UTC is the previous\n  // day in many other timezones resulting in the date displayed to be the previous day.\n  return legacyDateFormat.format(\n    value,\n    type === 'date' ? dateFormat : `${dateFormat} ${timeFormat}`,\n    type === 'date',\n  )\n}\n\nfunction parseDate(date: unknown): Date | null\nfunction parseDate(date: unknown, throwOnError: true): Date\nfunction parseDate(date: unknown, throwOnError = false): Date | null {\n  if (!date) return null\n  if (date === 'now') return new Date()\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const parsed = new Date(date as any)\n  const isInvalid = isNaN(parsed.getTime())\n  if (isInvalid && throwOnError) {\n    throw new Error(`Unable to parse \"${date}\" to a date`)\n  }\n\n  return isInvalid ? null : parsed\n}\n\nexport const dateValidators: Validators = {\n  ...genericValidators,\n\n  type: (_unused, value, message, {i18n}) => {\n    if (typeof value === 'undefined' || isoDate.test(`${value}`)) {\n      return true\n    }\n\n    return message || i18n.t('validation:date.invalid-format')\n  },\n\n  min: (minDate, value, message, {type, i18n}) => {\n    const dateVal = parseDate(value)\n    const minDateVal = parseDate(minDate, true)\n\n    if (!dateVal) {\n      return true // `type()` should catch parse errors\n    }\n\n    if (!value || dateVal >= minDateVal) {\n      return true\n    }\n\n    if (!type) {\n      throw new Error(`\\`type\\` was not provided in validation context.`)\n    }\n\n    const dateTimeOptions: DateTimeOptions = isRecord(type.options)\n      ? (type.options as DateTimeOptions)\n      : {}\n\n    return (\n      message ||\n      // Note that the `minDate` passed here is _formatted_, while the raw value provided to the\n      // validator is available as `providedMinDate`. This because the formatted date is likely\n      // what the developer wants to present to the user\n      i18n.t('validation:date.minimum', {\n        minDate: getFormattedDate(type.name, minDateVal, dateTimeOptions),\n        providedMinDate: minDate,\n      })\n    )\n  },\n\n  max: (maxDate, value, message, {type, i18n}) => {\n    const dateVal = parseDate(value)\n    const maxDateVal = parseDate(maxDate, true)\n\n    if (!dateVal) {\n      return true // `type()` should catch parse errors\n    }\n\n    if (!value || dateVal <= maxDateVal) {\n      return true\n    }\n\n    if (!type) {\n      throw new Error(`\\`type\\` was not provided in validation context.`)\n    }\n\n    const dateTimeOptions: DateTimeOptions = isRecord(type.options)\n      ? (type.options as DateTimeOptions)\n      : {}\n\n    return (\n      message ||\n      // Note that the `maxDate` passed here is _formatted_, while the raw value provided to the\n      // validator is available as `providedMaxDate`. This because the formatted date is likely\n      // what the developer wants to present to the user\n      i18n.t('validation:date.maximum', {\n        maxDate: getFormattedDate(type.name, maxDateVal, dateTimeOptions),\n        providedMaxDate: maxDate,\n      })\n    )\n  },\n}\n","import {type Validators} from '@sanity/types'\n\nimport {genericValidators} from './genericValidator'\n\nconst precisionRx = /(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/\n\nexport const numberValidators: Validators = {\n  ...genericValidators,\n\n  integer: (_unused, value, message, {i18n}) => {\n    if (!Number.isInteger(value)) {\n      return message || i18n.t('validation:number.non-integer')\n    }\n\n    return true\n  },\n\n  precision: (limit, value, message, {i18n}) => {\n    if (value === undefined) return true\n\n    const places = value.toString().match(precisionRx)\n    const decimals = Math.max(\n      (places[1] ? places[1].length : 0) - (places[2] ? parseInt(places[2], 10) : 0),\n      0,\n    )\n\n    if (decimals > limit) {\n      return message || i18n.t('validation:number.maximum-precision', {limit})\n    }\n\n    return true\n  },\n\n  min: (minNumber, value, message, {i18n}) => {\n    if (value >= minNumber) {\n      return true\n    }\n\n    return message || i18n.t('validation:number.minimum', {minNumber})\n  },\n\n  max: (maxNumber, value, message, {i18n}) => {\n    if (value <= maxNumber) {\n      return true\n    }\n\n    return message || i18n.t('validation:number.maximum', {maxNumber})\n  },\n\n  greaterThan: (threshold, value, message, {i18n}) => {\n    if (value > threshold) {\n      return true\n    }\n\n    return message || i18n.t('validation:number.greater-than', {threshold})\n  },\n\n  lessThan: (threshold, value, message, {i18n}) => {\n    if (value < threshold) {\n      return true\n    }\n\n    return message || i18n.t('validation:number.less-than', {threshold})\n  },\n}\n","import {isReference, type Validators} from '@sanity/types'\n\nimport {genericValidators} from './genericValidator'\n\nconst metaKeys = ['_key', '_type', '_weak']\n\nexport const objectValidators: Validators = {\n  ...genericValidators,\n\n  presence: (expected, value, message, {i18n}) => {\n    if (expected !== 'required') {\n      return true\n    }\n\n    const keys = value && Object.keys(value).filter((key) => !metaKeys.includes(key))\n\n    if (value === undefined || (keys && keys.length === 0)) {\n      return message || i18n.t('validation:generic.required', {context: 'object'})\n    }\n\n    return true\n  },\n\n  reference: async (_unused, value: unknown, message, context) => {\n    if (!value) {\n      return true\n    }\n\n    const {type, getDocumentExists, i18n} = context\n\n    if (!isReference(value)) {\n      return message || i18n.t('validation:object.not-reference')\n    }\n\n    if (!type) {\n      throw new Error(`\\`type\\` was not provided in validation context`)\n    }\n\n    if ('weak' in type && type.weak) {\n      return true\n    }\n\n    if (!getDocumentExists) {\n      throw new Error(`\\`getDocumentExists\\` was not provided in validation context`)\n    }\n\n    const exists = await getDocumentExists({id: value._ref})\n    if (!exists) {\n      return i18n.t('validation:object.reference-not-published', {documentId: value._ref})\n    }\n\n    return true\n  },\n\n  assetRequired: (flag, value, message, {i18n}) => {\n    if (!value || !value.asset || !value.asset._ref) {\n      return message || i18n.t('validation:object.asset-required', {context: flag.assetType || ''})\n    }\n\n    return true\n  },\n}\n","import {type Validators} from '@sanity/types'\n\nimport {genericValidators} from './genericValidator'\n\nconst DUMMY_ORIGIN = 'http://sanity'\nconst isRelativeUrl = (url: string) => /^\\.*\\//.test(url)\nconst emailRegex =\n  /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/\n\nexport const stringValidators: Validators = {\n  ...genericValidators,\n\n  min: (minLength, value, message, {i18n}) => {\n    if (!value || value.length >= minLength) {\n      return true\n    }\n\n    return message || i18n.t('validation:string.minimum-length', {minLength})\n  },\n\n  max: (maxLength, value, message, {i18n}) => {\n    if (!value || value.length <= maxLength) {\n      return true\n    }\n\n    return message || i18n.t('validation:string.maximum-length', {maxLength})\n  },\n\n  length: (wantedLength, value, message, {i18n}) => {\n    const strValue = value || ''\n    if (strValue.length === wantedLength) {\n      return true\n    }\n\n    return message || i18n.t('validation:string.exact-length', {wantedLength})\n  },\n\n  uri: (constraints, value, message, {i18n}) => {\n    const strValue = value || ''\n    if (!strValue) {\n      return true // `presence()` should catch empty values\n    }\n\n    const {options} = constraints\n    const {allowCredentials, relativeOnly} = options\n    const allowRelative = options.allowRelative || relativeOnly\n\n    let url\n    try {\n      // WARNING: Safari checks for a given `base` param by looking at the length of arguments passed\n      // to new URL(str, base), and will fail if invoked with new URL(strValue, undefined)\n      url = allowRelative ? new URL(strValue, DUMMY_ORIGIN) : new URL(strValue)\n    } catch (err) {\n      return message || i18n.t('validation:string.url.invalid')\n    }\n\n    if (relativeOnly && url.origin !== DUMMY_ORIGIN) {\n      return message || i18n.t('validation:string.url.not-relative')\n    }\n\n    if (!allowRelative && url.origin === DUMMY_ORIGIN && isRelativeUrl(strValue)) {\n      return message || i18n.t('validation:string.url.not-absolute')\n    }\n\n    if (!allowCredentials && (url.username || url.password)) {\n      return message || i18n.t('validation:string.url.includes-credentials')\n    }\n\n    const urlScheme = url.protocol.replace(/:$/, '')\n    const matchesAllowedScheme = options.scheme.some((scheme) => scheme.test(urlScheme))\n    if (!matchesAllowedScheme) {\n      return message || i18n.t('validation:string.url.disallowed-scheme', {scheme: urlScheme})\n    }\n\n    return true\n  },\n\n  stringCasing: (casing, value, message, {i18n}) => {\n    const strValue = value || ''\n    if (casing === 'uppercase' && strValue !== strValue.toLocaleUpperCase()) {\n      return message || i18n.t('validation:string.uppercase')\n    }\n\n    if (casing === 'lowercase' && strValue !== strValue.toLocaleLowerCase()) {\n      return message || i18n.t('validation:string.lowercase')\n    }\n\n    return true\n  },\n\n  presence: (flag, value, message, {i18n}) => {\n    if (flag === 'required' && !value) {\n      return message || i18n.t('validation:generic.required', {context: 'string'})\n    }\n\n    return true\n  },\n\n  regex: (options, value, message, {i18n}) => {\n    const {pattern, name, invert} = options\n    const regName = name || `${pattern.toString()}`\n    const strValue = value || ''\n    // Regexes with global or sticky flags are stateful (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/lastIndex).\n    // This resets the state stored from the previous check\n    pattern.lastIndex = 0\n    const matches = pattern.test(strValue)\n    if ((!invert && !matches) || (invert && matches)) {\n      if (message) {\n        return message\n      }\n\n      return invert\n        ? i18n.t('validation:string.regex-match', {name: regName})\n        : i18n.t('validation:string.regex-does-not-match', {name: regName})\n    }\n\n    return true\n  },\n\n  email: (_unused, value, message, {i18n}) => {\n    const strValue = `${value || ''}`.trim()\n    if (!strValue || emailRegex.test(strValue)) {\n      return true\n    }\n\n    return message || i18n.t('validation:string.email')\n  },\n}\n","import {\n  type CustomValidator,\n  type FieldRules,\n  type LocalizedValidationMessages,\n  type Rule as IRule,\n  type RuleClass,\n  type RuleSpec,\n  type RuleSpecConstraint,\n  type RuleTypeConstraint,\n  type SchemaType,\n  type ValidationMarker,\n  type Validator,\n} from '@sanity/types'\nimport {cloneDeep, get} from 'lodash'\n\nimport {convertToValidationMarker} from './util/convertToValidationMarker'\nimport {escapeRegex} from './util/escapeRegex'\nimport {isLocalizedMessages, localizeMessage} from './util/localizeMessage'\nimport {pathToString} from './util/pathToString'\nimport {arrayValidators} from './validators/arrayValidator'\nimport {booleanValidators} from './validators/booleanValidator'\nimport {dateValidators} from './validators/dateValidator'\nimport {genericValidators} from './validators/genericValidator'\nimport {numberValidators} from './validators/numberValidator'\nimport {objectValidators} from './validators/objectValidator'\nimport {stringValidators} from './validators/stringValidator'\n\nconst typeValidators = {\n  Boolean: booleanValidators,\n  Number: numberValidators,\n  String: stringValidators,\n  Array: arrayValidators,\n  Object: objectValidators,\n  Date: dateValidators,\n}\n\nconst getBaseType = (type: SchemaType | undefined): SchemaType | undefined => {\n  return type && type.type ? getBaseType(type.type) : type\n}\n\nconst isFieldRef = (constraint: unknown): constraint is {type: symbol; path: string | string[]} => {\n  if (typeof constraint !== 'object' || !constraint) return false\n  return (constraint as Record<string, unknown>).type === Rule.FIELD_REF\n}\n\nconst EMPTY_ARRAY: unknown[] = []\nconst FIELD_REF = Symbol('FIELD_REF')\nconst ruleConstraintTypes: RuleTypeConstraint[] = [\n  'Array',\n  'Boolean',\n  'Date',\n  'Number',\n  'Object',\n  'String',\n]\n\n// Note: `RuleClass` and `Rule` are split to fit the current `@sanity/types`\n// setup. Classes are a bit weird in the `@sanity/types` package because classes\n// create an actual javascript class while simultaneously creating a type\n// definition.\n//\n// This implicitly creates two types:\n// 1. the instance type  `Rule` and\n// 2. the static/class type - `RuleClass`\n//\n// The `RuleClass` type contains the static methods and the `Rule` instance\n// contains the instance methods.\n//\n// This package exports the RuleClass as a value without implicitly exporting\n// an instance definition. This should help reminder downstream users to import\n// from the `@sanity/types` package.\nexport const Rule: RuleClass = class Rule implements IRule {\n  static readonly FIELD_REF = FIELD_REF\n  static array = (def?: SchemaType): Rule => new Rule(def).type('Array')\n  static object = (def?: SchemaType): Rule => new Rule(def).type('Object')\n  static string = (def?: SchemaType): Rule => new Rule(def).type('String')\n  static number = (def?: SchemaType): Rule => new Rule(def).type('Number')\n  static boolean = (def?: SchemaType): Rule => new Rule(def).type('Boolean')\n  static dateTime = (def?: SchemaType): Rule => new Rule(def).type('Date')\n  static valueOfField = (path: string | string[]): {type: symbol; path: string | string[]} => ({\n    type: FIELD_REF,\n    path,\n  })\n\n  _type: RuleTypeConstraint | undefined = undefined\n  _level: 'error' | 'warning' | 'info' | undefined = undefined\n  _required: 'required' | 'optional' | undefined = undefined\n  _typeDef: SchemaType | undefined = undefined\n  _message: string | LocalizedValidationMessages | undefined = undefined\n  _rules: RuleSpec[] = []\n  _fieldRules: FieldRules | undefined = undefined\n\n  constructor(typeDef?: SchemaType) {\n    this._typeDef = typeDef\n    this.reset()\n  }\n\n  private _mergeRequired(next: Rule) {\n    if (this._required === 'required' || next._required === 'required') return 'required'\n    if (this._required === 'optional' || next._required === 'optional') return 'optional'\n    return undefined\n  }\n\n  // Alias to static method, since we often have access to an _instance_ of a rule but not the actual Rule class\n  valueOfField = Rule.valueOfField.bind(Rule)\n\n  error(message?: string | LocalizedValidationMessages): Rule {\n    const rule = this.clone()\n    rule._level = 'error'\n    rule._message = message || undefined\n    return rule\n  }\n\n  warning(message?: string | LocalizedValidationMessages): Rule {\n    const rule = this.clone()\n    rule._level = 'warning'\n    rule._message = message || undefined\n    return rule\n  }\n\n  info(message?: string | LocalizedValidationMessages): Rule {\n    const rule = this.clone()\n    rule._level = 'info'\n    rule._message = message || undefined\n    return rule\n  }\n\n  reset(): this {\n    this._type = this._type || undefined\n    this._rules = (this._rules || []).filter((rule) => rule.flag === 'type')\n    this._message = undefined\n    this._required = undefined\n    this._level = 'error'\n    this._fieldRules = undefined\n    return this\n  }\n\n  isRequired(): boolean {\n    return this._required === 'required'\n  }\n\n  clone(): Rule {\n    const rule = new Rule()\n    rule._type = this._type\n    rule._message = this._message\n    rule._required = this._required\n    rule._rules = cloneDeep(this._rules)\n    rule._level = this._level\n    rule._fieldRules = this._fieldRules\n    rule._typeDef = this._typeDef\n    return rule\n  }\n\n  cloneWithRules(rules: RuleSpec[]): Rule {\n    const rule = this.clone()\n    const newRules = new Set()\n    rules.forEach((curr) => {\n      if (curr.flag === 'type') {\n        rule._type = curr.constraint\n      }\n\n      newRules.add(curr.flag)\n    })\n\n    rule._rules = rule._rules\n      .filter((curr) => {\n        const disallowDuplicate = ['type', 'uri', 'email'].includes(curr.flag)\n        const isDuplicate = newRules.has(curr.flag)\n        return !(disallowDuplicate && isDuplicate)\n      })\n      .concat(rules)\n\n    return rule\n  }\n\n  merge(rule: Rule): Rule {\n    if (this._type && rule._type && this._type !== rule._type) {\n      throw new Error('merge() failed: conflicting types')\n    }\n\n    const newRule = this.cloneWithRules(rule._rules)\n    newRule._type = this._type || rule._type\n    newRule._message = this._message || rule._message\n    newRule._required = this._mergeRequired(rule)\n    newRule._level = this._level === 'error' ? rule._level : this._level\n    return newRule\n  }\n\n  // Validation flag setters\n  type(targetType: RuleTypeConstraint | Lowercase<RuleTypeConstraint>): Rule {\n    const type = `${targetType.slice(0, 1).toUpperCase()}${targetType.slice(1)}` as Capitalize<\n      typeof targetType\n    >\n\n    if (!ruleConstraintTypes.includes(type)) {\n      throw new Error(`Unknown type \"${targetType}\"`)\n    }\n\n    const rule = this.cloneWithRules([{flag: 'type', constraint: type}])\n    rule._type = type\n    return rule\n  }\n\n  all(children: Rule[]): Rule {\n    return this.cloneWithRules([{flag: 'all', constraint: children}])\n  }\n\n  either(children: Rule[]): Rule {\n    return this.cloneWithRules([{flag: 'either', constraint: children}])\n  }\n\n  // Shared rules\n  optional(): Rule {\n    const rule = this.cloneWithRules([{flag: 'presence', constraint: 'optional'}])\n    rule._required = 'optional'\n    return rule\n  }\n\n  required(): Rule {\n    const rule = this.cloneWithRules([{flag: 'presence', constraint: 'required'}])\n    rule._required = 'required'\n    return rule\n  }\n\n  custom<T = unknown>(\n    fn: CustomValidator<T>,\n    options: {bypassConcurrencyLimit?: boolean} = {},\n  ): Rule {\n    if (options.bypassConcurrencyLimit) {\n      Object.assign(fn, {bypassConcurrencyLimit: true})\n    }\n    return this.cloneWithRules([{flag: 'custom', constraint: fn as CustomValidator}])\n  }\n\n  min(len: number | string): Rule {\n    return this.cloneWithRules([{flag: 'min', constraint: len}])\n  }\n\n  max(len: number | string): Rule {\n    return this.cloneWithRules([{flag: 'max', constraint: len}])\n  }\n\n  length(len: number): Rule {\n    return this.cloneWithRules([{flag: 'length', constraint: len}])\n  }\n\n  valid(value: unknown | unknown[]): Rule {\n    const values = Array.isArray(value) ? value : [value]\n    return this.cloneWithRules([{flag: 'valid', constraint: values}])\n  }\n\n  // Numbers only\n  integer(): Rule {\n    return this.cloneWithRules([{flag: 'integer'}])\n  }\n\n  precision(limit: number): Rule {\n    return this.cloneWithRules([{flag: 'precision', constraint: limit}])\n  }\n\n  positive(): Rule {\n    return this.cloneWithRules([{flag: 'min', constraint: 0}])\n  }\n\n  negative(): Rule {\n    return this.cloneWithRules([{flag: 'lessThan', constraint: 0}])\n  }\n\n  greaterThan(num: number): Rule {\n    return this.cloneWithRules([{flag: 'greaterThan', constraint: num}])\n  }\n\n  lessThan(num: number): Rule {\n    return this.cloneWithRules([{flag: 'lessThan', constraint: num}])\n  }\n\n  // String only\n  uppercase(): Rule {\n    return this.cloneWithRules([{flag: 'stringCasing', constraint: 'uppercase'}])\n  }\n\n  lowercase(): Rule {\n    return this.cloneWithRules([{flag: 'stringCasing', constraint: 'lowercase'}])\n  }\n\n  regex(pattern: RegExp, name: string, options: {name?: string; invert?: boolean}): Rule\n  regex(pattern: RegExp, options: {name?: string; invert?: boolean}): Rule\n  regex(pattern: RegExp, name: string): Rule\n  regex(pattern: RegExp): Rule\n  regex(\n    pattern: RegExp,\n    a?: string | {name?: string; invert?: boolean},\n    b?: {name?: string; invert?: boolean},\n  ): Rule {\n    const name = typeof a === 'string' ? a : a?.name ?? b?.name\n    const invert = typeof a === 'string' ? false : a?.invert ?? b?.invert\n\n    const constraint: RuleSpecConstraint<'regex'> = {\n      pattern,\n      name,\n      invert: invert || false,\n    }\n\n    return this.cloneWithRules([{flag: 'regex', constraint}])\n  }\n\n  email(): Rule {\n    return this.cloneWithRules([{flag: 'email'}])\n  }\n\n  uri(opts?: {\n    scheme?: (string | RegExp) | Array<string | RegExp>\n    allowRelative?: boolean\n    relativeOnly?: boolean\n    allowCredentials?: boolean\n  }): Rule {\n    const optsScheme = opts?.scheme || ['http', 'https']\n    const schemes = Array.isArray(optsScheme) ? optsScheme : [optsScheme]\n\n    if (!schemes.length) {\n      throw new Error('scheme must have at least 1 scheme specified')\n    }\n\n    const constraint: RuleSpecConstraint<'uri'> = {\n      options: {\n        scheme: schemes.map((scheme) => {\n          if (!(scheme instanceof RegExp) && typeof scheme !== 'string') {\n            throw new Error('scheme must be a RegExp or a String')\n          }\n\n          return typeof scheme === 'string' ? new RegExp(`^${escapeRegex(scheme)}$`) : scheme\n        }),\n        allowRelative: opts?.allowRelative || false,\n        relativeOnly: opts?.relativeOnly || false,\n        allowCredentials: opts?.allowCredentials || false,\n      },\n    }\n\n    return this.cloneWithRules([{flag: 'uri', constraint}])\n  }\n\n  // Array only\n  unique(): Rule {\n    return this.cloneWithRules([{flag: 'unique'}])\n  }\n\n  // Objects only\n  reference(): Rule {\n    return this.cloneWithRules([{flag: 'reference'}])\n  }\n\n  fields(rules: FieldRules): Rule {\n    if (this._type !== 'Object') {\n      throw new Error('fields() can only be called on an object type')\n    }\n\n    const rule = this.cloneWithRules([])\n    rule._fieldRules = rules\n    return rule\n  }\n\n  assetRequired(): Rule {\n    const base = getBaseType(this._typeDef)\n    let assetType: 'asset' | 'image' | 'file'\n    if (base && ['image', 'file'].includes(base.name)) {\n      assetType = base.name === 'image' ? 'image' : 'file'\n    } else {\n      assetType = 'asset'\n    }\n\n    return this.cloneWithRules([{flag: 'assetRequired', constraint: {assetType}}])\n  }\n\n  async validate(\n    value: unknown,\n    {__internal = {}, ...context}: Parameters<IRule['validate']>[1],\n  ): Promise<ValidationMarker[]> {\n    const {customValidationConcurrencyLimiter} = __internal\n\n    const valueIsEmpty = value === null || value === undefined\n\n    // Short-circuit on optional, empty fields\n    if (valueIsEmpty && this._required === 'optional') {\n      return EMPTY_ARRAY as ValidationMarker[]\n    }\n\n    const rules =\n      // Run only the _custom_ functions if the rule is not set to required or optional\n      this._required === undefined && valueIsEmpty\n        ? this._rules.filter((curr) => curr.flag === 'custom')\n        : this._rules\n\n    const validators = (this._type && typeValidators[this._type]) || genericValidators\n\n    const results = await Promise.all(\n      rules.map(async (curr) => {\n        if (curr.flag === undefined) {\n          throw new Error('Invalid rule, did not contain \"flag\"-property')\n        }\n\n        const validator: Validator | undefined = validators[curr.flag]\n        if (!validator) {\n          const forType = this._type ? `type \"${this._type}\"` : 'rule without declared type'\n          throw new Error(`Validator for flag \"${curr.flag}\" not found for ${forType}`)\n        }\n\n        let specConstraint = 'constraint' in curr ? curr.constraint : null\n        if (isFieldRef(specConstraint)) {\n          specConstraint = get(context.parent, specConstraint.path)\n        }\n\n        if (\n          curr.flag === 'custom' &&\n          customValidationConcurrencyLimiter &&\n          !(specConstraint as CustomValidator)?.bypassConcurrencyLimit\n        ) {\n          const customValidator = specConstraint as CustomValidator\n          specConstraint = async (...args: Parameters<CustomValidator>) => {\n            await customValidationConcurrencyLimiter.ready()\n            try {\n              return await customValidator(...args)\n            } finally {\n              customValidationConcurrencyLimiter.release()\n            }\n          }\n        }\n\n        const message = isLocalizedMessages(this._message)\n          ? localizeMessage(this._message, context.i18n)\n          : this._message\n\n        try {\n          const result = await validator(specConstraint, value, message, context)\n          return convertToValidationMarker(result, this._level, context)\n        } catch (err) {\n          const errorMessage = `${pathToString(\n            context.path,\n          )}: Exception occurred while validating value: ${err.message}`\n\n          return convertToValidationMarker({message: errorMessage}, 'error', context)\n        }\n      }),\n    )\n\n    return results.flat()\n  }\n}\n","import {\n  type CustomValidator,\n  isKeyedObject,\n  isSlug,\n  type Path,\n  type SlugIsUniqueValidator,\n  type SlugParent,\n  type SlugSchemaType,\n  type SlugValidationContext,\n} from '@sanity/types'\nimport {memoize} from 'lodash'\n\nconst memoizedWarnOnArraySlug = memoize(warnOnArraySlug)\n\nfunction getDocumentIds(id: string) {\n  const isDraft = id.indexOf('drafts.') === 0\n  return {\n    published: isDraft ? id.slice('drafts.'.length) : id,\n    draft: isDraft ? id : `drafts.${id}`,\n  }\n}\n\nfunction serializePath(path: Path): string {\n  return path.reduce<string>((target, part, i) => {\n    const isIndex = typeof part === 'number'\n    const isKey = isKeyedObject(part)\n    const separator = i === 0 ? '' : '.'\n    const add = isIndex || isKey ? '[]' : `${separator}${part}`\n    return `${target}${add}`\n  }, '')\n}\n\nconst defaultIsUnique: SlugIsUniqueValidator = (slug, context) => {\n  const {getClient, document, path, type} = context\n  const schemaOptions = type?.options as {disableArrayWarning?: boolean} | undefined\n\n  if (!document) {\n    throw new Error(`\\`document\\` was not provided in validation context.`)\n  }\n  if (!path) {\n    throw new Error(`\\`path\\` was not provided in validation context.`)\n  }\n\n  const disableArrayWarning = schemaOptions?.disableArrayWarning || false\n  const {published, draft} = getDocumentIds(document._id)\n  const docType = document._type\n  const atPath = serializePath(path.concat('current'))\n\n  if (!disableArrayWarning && atPath.includes('[]') && context.environment === 'studio') {\n    memoizedWarnOnArraySlug(serializePath(path))\n  }\n\n  const constraints = [\n    '_type == $docType',\n    `!(_id in [$draft, $published])`,\n    `${atPath} == $slug`,\n  ].join(' && ')\n\n  return getClient({apiVersion: '2023-11-13'}).fetch<boolean>(\n    `!defined(*[${constraints}][0]._id)`,\n    {\n      docType,\n      draft,\n      published,\n      slug,\n    },\n    {tag: 'validation.slug-is-unique'},\n  )\n}\n\nfunction warnOnArraySlug(serializedPath: string) {\n  /* eslint-disable no-console */\n  console.warn(\n    [\n      `Slug field at path ${serializedPath} is within an array and cannot be automatically checked for uniqueness`,\n      `If you need to check for uniqueness, provide your own \"isUnique\" method`,\n      `To disable this message, set \\`disableArrayWarning: true\\` on the slug \\`options\\` field`,\n    ].join('\\n'),\n  )\n  /* eslint-enable no-console */\n}\n\n/**\n * Validates slugs values by querying for uniqueness from the client.\n *\n * This is a custom rule implementation (e.g. `Rule.custom(slugValidator)`)\n * that's populated in `inferFromSchemaType` when the type name is `slug`\n */\nexport const slugValidator: CustomValidator = async (value, context) => {\n  if (!value) {\n    return true\n  }\n\n  const {i18n} = context\n\n  if (typeof value !== 'object' || Array.isArray(value)) {\n    return i18n.t('validation:slug.not-object')\n  }\n\n  if (!isSlug(value) || value.current.trim().length === 0) {\n    return i18n.t('validation:slug.missing-current')\n  }\n\n  const options = context?.type?.options as {isUnique?: SlugIsUniqueValidator} | undefined\n  const isUnique = options?.isUnique || defaultIsUnique\n\n  const slugContext: SlugValidationContext = {\n    ...context,\n    parent: context.parent as SlugParent,\n    type: context.type as SlugSchemaType,\n    defaultIsUnique,\n  }\n\n  const wasUnique = await isUnique(value.current, slugContext)\n  if (wasUnique) {\n    return true\n  }\n\n  return i18n.t('validation:slug.not-unique', {slug: value.current})\n}\n","import {type Rule, type RuleTypeConstraint, type SchemaType} from '@sanity/types'\n\nimport {Rule as RuleClass} from '../Rule'\nimport {slugValidator} from '../validators/slugValidator'\n\nconst ruleConstraintTypes: {[P in Lowercase<RuleTypeConstraint>]: true} = {\n  array: true,\n  boolean: true,\n  date: true,\n  number: true,\n  object: true,\n  string: true,\n}\n\nconst isRuleConstraint = (typeString: string): typeString is Lowercase<RuleTypeConstraint> =>\n  typeString in ruleConstraintTypes\n\nexport function getTypeChain(\n  type: SchemaType | undefined,\n  visited: Set<SchemaType> = new Set(),\n): SchemaType[] {\n  if (!type) return []\n  if (visited.has(type)) return []\n\n  visited.add(type)\n\n  const next = type.type ? getTypeChain(type.type, visited) : []\n  return [...next, type]\n}\n\nfunction baseRuleReducer(inputRule: Rule, type: SchemaType) {\n  let baseRule = inputRule\n\n  if (isRuleConstraint(type.jsonType)) {\n    baseRule = baseRule.type(type.jsonType)\n  }\n\n  const typeOptionsList =\n    // if type.options is truthy\n    type?.options &&\n    // and type.options is an object (non-null from the previous)\n    typeof type.options === 'object' &&\n    // and if `list` is in options\n    'list' in type.options &&\n    // then finally access the list\n    type.options.list\n\n  if (Array.isArray(typeOptionsList)) {\n    baseRule = baseRule.valid(\n      typeOptionsList.map((option) => extractValueFromListOption(option, type)),\n    )\n  }\n\n  if (type.name === 'datetime') return baseRule.type('Date')\n  if (type.name === 'date') return baseRule.type('Date')\n  if (type.name === 'url') return baseRule.uri()\n  if (type.name === 'slug') return baseRule.custom(slugValidator, {bypassConcurrencyLimit: true})\n  if (type.name === 'reference') return baseRule.reference()\n  if (type.name === 'email') return baseRule.email()\n  return baseRule\n}\n\nfunction hasValueField(typeDef: SchemaType | undefined): boolean {\n  if (!typeDef) return false\n  if (!('fields' in typeDef) && typeDef.type) return hasValueField(typeDef.type)\n  if (!('fields' in typeDef)) return false\n  if (!Array.isArray(typeDef.fields)) return false\n  return typeDef.fields.some((field) => field.name === 'value')\n}\n\nfunction extractValueFromListOption(option: unknown, typeDef: SchemaType): unknown {\n  // If you define a `list` option with object items, where the item has a `value` field,\n  // we don't want to treat that as the value but rather the surrounding object\n  // This differs from the case where you have a title/value pair setup for a string/number, for instance\n  if (typeDef.jsonType === 'object' && hasValueField(typeDef)) return option\n\n  return (option as Record<string, unknown>).value === undefined\n    ? option\n    : (option as Record<string, unknown>).value\n}\n\n/**\n * Takes in `SchemaValidationValue` and returns an array of `Rule` instances.\n */\nexport function normalizeValidationRules(typeDef: SchemaType | undefined): Rule[] {\n  if (!typeDef) {\n    return []\n  }\n\n  const validation = typeDef.validation\n\n  if (Array.isArray(validation)) {\n    return validation.flatMap((i) =>\n      normalizeValidationRules({\n        ...typeDef,\n        validation: i,\n      }),\n    )\n  }\n\n  if (validation && typeof validation === 'object') {\n    return [validation]\n  }\n\n  const baseRule =\n    // using an object + Object.values to de-dupe the type chain by type name\n    Object.values(\n      getTypeChain(typeDef).reduce<Record<string, SchemaType>>((acc, type) => {\n        acc[type.name] = type\n        return acc\n      }, {}),\n    ).reduce(baseRuleReducer, new RuleClass(typeDef))\n\n  if (!validation) {\n    return [baseRule]\n  }\n\n  return normalizeValidationRules({\n    ...typeDef,\n    validation: validation(baseRule),\n  })\n}\n","import {type Schema, type SchemaType} from '@sanity/types'\n\nimport {normalizeValidationRules} from './util/normalizeValidationRules'\n\n// NOTE: this overload is for TS API compatibility with a previous implementation\nexport function inferFromSchemaType(\n  typeDef: SchemaType,\n  // these are intentionally unused\n  _schema: Schema,\n  _visited?: Set<SchemaType>,\n): SchemaType\n// note: this seemingly redundant overload is required\nexport function inferFromSchemaType(typeDef: SchemaType): SchemaType\nexport function inferFromSchemaType(typeDef: SchemaType): SchemaType {\n  traverse(typeDef, new Set())\n  return typeDef\n}\n\nfunction traverse(typeDef: SchemaType, visited: Set<SchemaType>) {\n  if (visited.has(typeDef)) {\n    return\n  }\n\n  visited.add(typeDef)\n\n  typeDef.validation = normalizeValidationRules(typeDef)\n\n  if ('fields' in typeDef) {\n    for (const field of typeDef.fields) {\n      traverse(field.type, visited)\n    }\n  }\n\n  if ('of' in typeDef) {\n    for (const candidate of typeDef.of) {\n      traverse(candidate, visited)\n    }\n  }\n\n  // eslint-disable-next-line no-warning-comments\n  // @ts-expect-error TODO (eventually): `annotations` does not exist on the SchemaType yet\n  if (typeDef.annotations) {\n    // eslint-disable-next-line no-warning-comments\n    // @ts-expect-error TODO (eventually): `annotations` does not exist on the SchemaType yet\n    for (const annotation of typeDef.annotations) {\n      traverse(annotation, visited)\n    }\n  }\n}\n","import {type Schema} from '@sanity/types'\n\nimport {inferFromSchemaType} from './inferFromSchemaType'\n\n// Note: Mutates schema. Refactor when @sanity/schema supports middlewares\nexport function inferFromSchema(schema: Schema): Schema {\n  const typeNames = schema.getTypeNames()\n\n  typeNames.forEach((typeName) => {\n    const schemaType = schema.get(typeName)\n\n    if (schemaType) {\n      inferFromSchemaType(schemaType)\n    }\n  })\n\n  return schema\n}\n","import {createInstance, type Resource} from 'i18next'\nimport {memoize} from 'lodash'\n\nimport {isStaticResourceBundle} from './helpers'\nimport {studioLocaleNamespace} from './localeNamespaces'\nimport {defaultLocale, usEnglishLocale} from './locales'\nimport {type LocaleSource} from './types'\n\nconst shouldEscape = typeof window === 'undefined' || typeof document === 'undefined'\nconst fallbackLocales: LocaleSource['locales'] = [defaultLocale]\n\n/**\n * Returns a fallback source for internationalization that can be used in cases where you need\n * access to the \"framework\" of translation, but do not have access to an actual source.\n *\n * Memoized - only initializes the i18n instance once, and maintains the identity of the source.\n *\n *  NOTE: This will only have the base studio strings defined - no custom bundles or plugins.\n *\n * @returns The fallback source\n * @internal\n * @hidden\n */\nexport const getFallbackLocaleSource: () => LocaleSource = memoize(\n  function getFallbackLocaleSource(): LocaleSource {\n    const i18n = getFallbackI18nInstance()\n    i18n.init()\n    return {\n      currentLocale: defaultLocale,\n      locales: fallbackLocales,\n      loadNamespaces: i18n.loadNamespaces,\n      t: i18n.t,\n    }\n  },\n)\n\nfunction getFallbackI18nInstance() {\n  // Find all core locale resource bundles we can load synchronously\n  const staticResources: Resource = {[defaultLocale.id]: {}}\n  const staticBundles = usEnglishLocale.bundles?.filter(isStaticResourceBundle) || []\n  const namespaces = new Set<string>()\n  for (const bundle of staticBundles) {\n    staticResources[defaultLocale.id][bundle.namespace] = bundle.resources\n    namespaces.add(bundle.namespace)\n  }\n\n  return createInstance({\n    ns: Array.from(namespaces),\n    defaultNS: studioLocaleNamespace,\n    initImmediate: true,\n    partialBundledLanguages: true,\n    fallbackLng: defaultLocale.id,\n    lng: defaultLocale.id,\n    supportedLngs: [defaultLocale.id],\n    debug: false,\n    load: 'currentOnly',\n    resources: staticResources,\n    interpolation: {\n      // If we're in a browser, assume this is running inside of the studio, eg a React app,\n      // and that values returned will be escaped by the framework (eg React) automatically.\n      escapeValue: shouldEscape,\n    },\n  })\n}\n","import {type SanityClient} from '@sanity/client'\nimport {ConcurrencyLimiter} from '@sanity/util/concurrency-limiter'\nimport {\n  bufferTime,\n  filter,\n  finalize,\n  firstValueFrom,\n  from,\n  map,\n  mergeMap,\n  share,\n  Subject,\n  switchMap,\n} from 'rxjs'\n\nimport {type AvailabilityResponse} from '../../preview'\n\n/**\n * The amount of time reserved for waiting for new IDs.\n */\nconst BUFFER_TIME = 250\n/**\n * The upper limit for IDs sent to the `doc` endpoint at once. From some manual\n * testing, 100 seems to be a safe amount.\n */\nexport const MAX_BUFFER_SIZE = 100\n/**\n * The max amount of inflight requests to the `doc` endpoint to check for\n * availability. Currently set to 1 because the endpoint is expensive\n *\n * From: https://www.sanity.io/docs/http-doc\n *\n * \"it is less scalable/performant than the other query-mechanisms, so should\n * be used sparingly*\n */\nexport const MAX_REQUEST_CONCURRENCY = 1\n\nexport function createBatchedGetDocumentExists(\n  client: SanityClient,\n): (options: {id: string}) => Promise<boolean> {\n  const id$ = new Subject<string>()\n  const limiter = new ConcurrencyLimiter(MAX_REQUEST_CONCURRENCY)\n\n  const existence$ = id$.pipe(\n    bufferTime(BUFFER_TIME, null, MAX_BUFFER_SIZE),\n    map((ids) => Array.from(new Set(ids))),\n    mergeMap((ids) =>\n      from(limiter.ready()).pipe(\n        switchMap(() =>\n          client.observable\n            .request<AvailabilityResponse>({\n              uri: client.getDataUrl('doc', ids.join(',')),\n              json: true,\n              query: {excludeContent: 'true'},\n              tag: 'documents-availability',\n            })\n            .pipe(map((availability) => ({availability, ids}))),\n        ),\n        finalize(limiter.release),\n      ),\n    ),\n    mergeMap(({availability, ids}) =>\n      ids.map((id) => {\n        const omittedIds = availability.omitted.reduce<Record<string, 'existence' | 'permission'>>(\n          (acc, next) => {\n            acc[next.id] = next.reason\n            return acc\n          },\n          {},\n        )\n\n        // if not in the `omitted`, then it exists\n        if (!omittedIds[id]) return {id, exists: true}\n        // if in the `omitted` due to existence, then it does not exist\n        if (omittedIds[id] === 'existence') return {id, exists: false}\n        // otherwise, it must exist\n        return {id, exists: true}\n      }),\n    ),\n    share(),\n  )\n\n  return async function getDocumentExists(options) {\n    // set up a promise/listener that waits for the result\n    const result = firstValueFrom(existence$.pipe(filter(({id}) => id === options.id)))\n    // send off the request to the stream for batching\n    id$.next(options.id)\n\n    const {exists} = await result\n    return exists\n  }\n}\n","/**\n * Simple requestIdleCallback polyfill\n * Can be removed when all browsers support requestIdleCallback: https://caniuse.com/requestidlecallback\n * @param callback -\n * @param options -\n */\nconst requestIdleCallbackShim: typeof window.requestIdleCallback = function requestIdleCallbackShim(\n  callback,\n  options?,\n): number {\n  const start = Date.now()\n  return window.setTimeout(() => {\n    callback({\n      didTimeout: false,\n      timeRemaining() {\n        return Math.max(0, Date.now() - start)\n      },\n    })\n  }, 0)\n}\n\nconst cancelIdleCallbackShim: typeof window.cancelIdleCallback = function cancelIdleCallbackShim(\n  handle: number,\n): void {\n  return window.clearTimeout(handle)\n}\n\nconst win = typeof window === 'undefined' ? undefined : window\n\nexport const requestIdleCallback = win?.requestIdleCallback || requestIdleCallbackShim\nexport const cancelIdleCallback = win?.cancelIdleCallback || cancelIdleCallbackShim\n","import {type CustomValidator, type ObjectSchemaType} from '@sanity/types'\n\n/**\n * Given a schema type, returns a custom validator used to warn users of unknown\n * fields found in an object.\n */\nexport const unknownFieldsValidator =\n  (type: ObjectSchemaType): CustomValidator =>\n  (value) => {\n    if (typeof value !== 'object') return true\n    if (!value) return true\n\n    const fieldNames = new Set(type.fields?.map((field) => field.name))\n\n    const unknownFields = Object.keys(value)\n      .filter((key) => !key.startsWith('_'))\n      .filter((key) => !fieldNames.has(key))\n\n    return unknownFields.map((unknownField) => ({\n      message: `Field '${unknownField}' does not exist on type '${type.name}'`,\n      path: [unknownField],\n    }))\n  }\n","import {type SanityClient} from '@sanity/client'\nimport {\n  isKeyedObject,\n  isTypedObject,\n  type Rule,\n  type SanityDocument,\n  type Schema,\n  type SchemaType,\n  type ValidationMarker,\n} from '@sanity/types'\nimport {createClientConcurrencyLimiter} from '@sanity/util/client'\nimport {ConcurrencyLimiter} from '@sanity/util/concurrency-limiter'\nimport {flatten, uniqBy} from 'lodash'\nimport {concat, defer, from, lastValueFrom, merge, Observable, of} from 'rxjs'\nimport {catchError, map, mergeAll, mergeMap, switchMap, toArray} from 'rxjs/operators'\n\nimport {type SourceClientOptions, type Workspace} from '../config'\nimport {getFallbackLocaleSource} from '../i18n/fallback'\nimport {type ValidationContext} from './types'\nimport {createBatchedGetDocumentExists} from './util/createBatchedGetDocumentExists'\nimport {getTypeChain, normalizeValidationRules} from './util/normalizeValidationRules'\nimport {cancelIdleCallback, requestIdleCallback} from './util/requestIdleCallback'\nimport {typeString} from './util/typeString'\nimport {unknownFieldsValidator} from './validators/unknownFieldsValidator'\n\n// this is the number of requests allowed inflight at once. this is done to prevent\n// the validation library from overwhelming our backend\nconst MAX_FETCH_CONCURRENCY = 10\n\nconst limitConcurrency = createClientConcurrencyLimiter(MAX_FETCH_CONCURRENCY)\n\nconst isRecord = (maybeRecord: unknown): maybeRecord is Record<string, unknown> =>\n  typeof maybeRecord === 'object' && maybeRecord !== null && !Array.isArray(maybeRecord)\n\nconst isNonNullable = <T>(value: T): value is NonNullable<T> =>\n  value !== null && value !== undefined\n\n/**\n * @internal\n */\nexport function resolveTypeForArrayItem(\n  item: unknown,\n  candidates: SchemaType[],\n): SchemaType | undefined {\n  // if there is only one type available, assume that it's the correct one\n  if (candidates.length === 1) return candidates[0]\n\n  const itemType = isTypedObject(item) && item._type\n  const primitive =\n    item === undefined || item === null || (!itemType && typeString(item).toLowerCase())\n\n  if (primitive && primitive !== 'object') {\n    return candidates.find((candidate) => candidate.jsonType === primitive)\n  }\n\n  return (\n    candidates.find((candidate) => candidate.type?.name === itemType) ||\n    candidates.find((candidate) => candidate.name === itemType) ||\n    candidates.find((candidate) => candidate.name === 'object' && primitive === 'object')\n  )\n}\n\n/**\n * @beta\n */\nexport interface ValidateDocumentOptions {\n  /**\n   * The document to be validated\n   */\n  document: SanityDocument\n  /**\n   * The workspace instance (and associated schema) used to validate the given\n   * document against.\n   */\n  workspace: Workspace\n\n  /**\n   * Function used to check if referenced documents exists (and is published).\n   *\n   * If you're validating many documents in bulk, you may want to query for all\n   * document IDs first and provide your own implementation using those.\n   *\n   * If no function is provided a default one will be provided that will batch\n   * call the `doc` endpoint to check for document existence.\n   */\n  getDocumentExists?: (options: {id: string}) => Promise<boolean>\n\n  /**\n   * The factory function used to get a sanity client used in custom validators.\n   * If not provided, the one from the workspace will be used (preferred).\n   *\n   * @deprecated For internal use only\n   */\n  getClient?: (clientOptions: SourceClientOptions) => SanityClient\n\n  /**\n   * Specify the environment name. This will be passed down to the\n   * `ValidationContext` and made available to custom validators.\n   */\n  environment?: 'cli' | 'studio'\n\n  /**\n   * The maximum amount of custom validation functions to be running\n   * concurrently at once. This helps prevent custom validators from\n   * overwhelming backend services (e.g. called via fetch) used in async,\n   * user-defined validation functions. (i.e. `rule.custom(async() => {})`)\n   */\n  maxCustomValidationConcurrency?: number\n}\n\n/**\n * Validates a document against the schema in the given workspace. Returns an\n * array of validation markers with a path, message, and validation level.\n *\n * @beta\n */\nexport function validateDocument({\n  document,\n  workspace,\n  environment = 'studio',\n  ...options\n}: ValidateDocumentOptions): Promise<ValidationMarker[]> {\n  const getClient = options.getClient || workspace.getClient\n  const getConcurrencyLimitedClient = (clientOptions: SourceClientOptions) =>\n    limitConcurrency(getClient(clientOptions))\n\n  return lastValueFrom(\n    validateDocumentObservable({\n      document,\n      getClient: getConcurrencyLimitedClient,\n      i18n: workspace.i18n,\n      schema: workspace.schema,\n      getDocumentExists:\n        options.getDocumentExists ||\n        createBatchedGetDocumentExists(getClient({apiVersion: 'v2021-03-25'})),\n      environment,\n    }),\n  )\n}\n\n/**\n * @internal\n */\nexport interface ValidateDocumentObservableOptions\n  extends Pick<ValidationContext, 'getDocumentExists' | 'i18n'> {\n  getClient: (options: {apiVersion: string}) => SanityClient\n  document: SanityDocument\n  schema: Schema\n  environment: 'cli' | 'studio'\n  maxCustomValidationConcurrency?: number\n}\n\nconst customValidationConcurrencyLimiters = new WeakMap<Schema, ConcurrencyLimiter>()\n\n/**\n * Validates a document against the given schema, returning an Observable\n * @internal\n */\nexport function validateDocumentObservable({\n  document,\n  getClient,\n  i18n = getFallbackLocaleSource(),\n  schema,\n  getDocumentExists,\n  environment,\n  maxCustomValidationConcurrency,\n}: ValidateDocumentObservableOptions): Observable<ValidationMarker[]> {\n  if (typeof document?._type !== 'string') {\n    throw new Error(`Tried to validated a value without a '_type'`)\n  }\n\n  const documentType = schema.get(document._type)\n\n  if (!documentType) {\n    if (environment === 'studio') {\n      console.warn(\n        'Schema type for object type \"%s\" not found, skipping validation',\n        document._type,\n      )\n      return of([])\n    }\n\n    return of([\n      {\n        level: 'warning',\n        message: `Could not find schema type for type '${document._type}', skipping validation`,\n        path: [],\n      },\n    ])\n  }\n\n  let customValidationConcurrencyLimiter = customValidationConcurrencyLimiters.get(schema)\n  if (!customValidationConcurrencyLimiter && maxCustomValidationConcurrency) {\n    customValidationConcurrencyLimiter = new ConcurrencyLimiter(maxCustomValidationConcurrency)\n    customValidationConcurrencyLimiters.set(schema, customValidationConcurrencyLimiter)\n  }\n\n  const validationOptions: ValidateItemOptions = {\n    getClient,\n    schema,\n    parent: undefined,\n    value: document,\n    path: [],\n    document: document,\n    type: documentType,\n    i18n,\n    getDocumentExists,\n    environment,\n    customValidationConcurrencyLimiter,\n  }\n\n  return from(i18n.loadNamespaces(['validation'])).pipe(\n    switchMap(() => validateItemObservable(validationOptions)),\n    catchError((err) => {\n      console.error(err)\n\n      const message = err?.message || 'Unknown error'\n      const errorMarker: ValidationMarker = {\n        level: 'error',\n        message,\n        item: {message},\n        path: [],\n      }\n\n      return of([errorMarker])\n    }),\n  )\n}\n\n/**\n * this is used make optional properties required by replacing optionals with\n * `T[P] | undefined`. this is used to prevent errors in `validateItem` where\n * an option from a previous invocation would be incorrectly passed down.\n *\n * https://medium.com/terria/typescript-transforming-optional-properties-to-required-properties-that-may-be-undefined-7482cb4e1585\n */\ntype ExplicitUndefined<T> = {\n  [P in keyof Required<T>]: Pick<T, P> extends Required<Pick<T, P>> ? T[P] : T[P] | undefined\n}\n\ntype ValidateItemOptions = {\n  value: unknown\n  customValidationConcurrencyLimiter?: ConcurrencyLimiter\n} & ExplicitUndefined<ValidationContext>\n\nexport function validateItem(opts: ValidateItemOptions): Promise<ValidationMarker[]> {\n  return lastValueFrom(validateItemObservable(opts))\n}\n\nfunction validateItemObservable({\n  value,\n  type,\n  path = [],\n  parent,\n  customValidationConcurrencyLimiter,\n  environment,\n  ...restOfContext\n}: ValidateItemOptions): Observable<ValidationMarker[]> {\n  // Note: this validator is added here because it's conditional based on the\n  // environment.\n  const addUnknownFieldsValidator = (rule: Rule) => {\n    if (\n      // if the schema type is an object type\n      type?.jsonType === 'object' &&\n      // and if somewhere in it's type chain, it inherits from object or document\n      getTypeChain(type).find((t) => ['object', 'document', 'file', 'image'].includes(t.name)) &&\n      // and the environment is not the studio\n      environment !== 'studio'\n    ) {\n      // then add the validator for unknown fields\n      return rule.custom(unknownFieldsValidator(type), {bypassConcurrencyLimit: true}).warning()\n    }\n\n    // otherwise, leave it unchanged\n    return rule\n  }\n\n  const rules = normalizeValidationRules(type)\n  // run validation for the current value\n  const selfChecks = rules.map(addUnknownFieldsValidator).map((rule) =>\n    defer(() =>\n      rule.validate(value, {\n        ...restOfContext,\n        environment,\n        parent,\n        path,\n        type,\n        __internal: {customValidationConcurrencyLimiter},\n      }),\n    ),\n  )\n\n  // run validation for nested values (conditionally)\n  let nestedChecks: Array<Observable<ValidationMarker[]>> = []\n\n  const selfIsRequired = rules.some((rule) => rule.isRequired())\n  const shouldRunNestedObjectValidation =\n    // run nested validation for objects\n    type?.jsonType === 'object' &&\n    // if the value is truthy\n    (!!value || // or\n      // (the value is null or undefined) and the top-level value is required\n      ((value === null || value === undefined) && selfIsRequired))\n\n  if (shouldRunNestedObjectValidation) {\n    const fieldTypes = type.fields.reduce<Record<string, SchemaType>>((acc, field) => {\n      acc[field.name] = field.type\n      return acc\n    }, {})\n\n    // Validation for rules set at the object level with `Rule.fields({/* ... */})`\n    nestedChecks = nestedChecks.concat(\n      rules\n        .map((rule) => rule._fieldRules)\n        .filter(isNonNullable)\n        .flatMap((fieldResults) => Object.entries(fieldResults))\n        .flatMap(([name, validation]) => {\n          const fieldType = fieldTypes[name]\n          return normalizeValidationRules({...fieldType, validation})\n            .map(addUnknownFieldsValidator)\n            .map((subRule) => {\n              const nestedValue = isRecord(value) ? value[name] : undefined\n              return defer(() =>\n                subRule.validate(nestedValue, {\n                  ...restOfContext,\n                  parent: value,\n                  path: path.concat(name),\n                  type: fieldType,\n                  environment,\n                  __internal: {customValidationConcurrencyLimiter},\n                }),\n              )\n            })\n        }),\n    )\n\n    // Validation from each field's schema `validation: Rule => {/* ... */}` function\n    nestedChecks = nestedChecks.concat(\n      type.fields.map((field) =>\n        validateItemObservable({\n          ...restOfContext,\n          parent: value,\n          value: isRecord(value) ? value[field.name] : undefined,\n          path: path.concat(field.name),\n          type: field.type,\n          environment,\n          customValidationConcurrencyLimiter,\n        }),\n      ),\n    )\n  }\n\n  // note: unlike objects, arrays should not run nested validation for undefined\n  // values because we won't have a valid path to put a marker (i.e. missing the\n  // key or index in the path) and the downstream form builder won't have a\n  // valid target component\n  const shouldRunNestedValidationForArrays = type?.jsonType === 'array' && Array.isArray(value)\n\n  if (shouldRunNestedValidationForArrays) {\n    nestedChecks = nestedChecks.concat(\n      value.map((item, index) =>\n        validateItemObservable({\n          ...restOfContext,\n          parent: value,\n          value: item,\n          path: path.concat(isKeyedObject(item) ? {_key: item._key} : index),\n          type: resolveTypeForArrayItem(item, type.of),\n          environment,\n          customValidationConcurrencyLimiter,\n        }),\n      ),\n    )\n  }\n\n  return defer(() => merge([...selfChecks, ...nestedChecks])).pipe(\n    mergeMap((validateNode) => concat(idle(), validateNode), 40),\n    mergeAll(),\n    toArray(),\n    map(flatten),\n    map((results) => {\n      // run `uniqBy` if `_fieldRules` are present because they can\n      // cause repeat markers\n      if (rules.some((rule) => rule._fieldRules)) {\n        return uniqBy(results, (rule) => JSON.stringify(rule))\n      }\n      return results\n    }),\n  )\n}\n\nfunction idle(timeout?: number): Observable<never> {\n  return new Observable<never>((observer) => {\n    const handle = requestIdleCallback(\n      () => {\n        observer.complete()\n      },\n      timeout ? {timeout} : undefined,\n    )\n\n    return () => cancelIdleCallback(handle)\n  })\n}\n","export default {\n  name: 'sanity.assetSourceData',\n  title: 'Asset Source Data',\n  type: 'object',\n  fields: [\n    {\n      name: 'name',\n      title: 'Source name',\n      description: 'A canonical name for the source this asset is originating from',\n      type: 'string',\n    },\n    {\n      name: 'id',\n      title: 'Asset Source ID',\n      description:\n        'The unique ID for the asset within the originating source so you can programatically find back to it',\n      type: 'string',\n    },\n    {\n      name: 'url',\n      title: 'Asset information URL',\n      description: 'A URL to find more information about this asset in the originating source',\n      type: 'string',\n    },\n  ],\n}\n","import {type SanityDocument} from '@sanity/client'\n\nexport default {\n  name: 'sanity.fileAsset',\n  title: 'File',\n  type: 'document',\n  fieldsets: [\n    {\n      name: 'system',\n      title: 'System fields',\n      description: 'These fields are managed by the system and not editable',\n    },\n  ],\n  fields: [\n    {\n      name: 'originalFilename',\n      type: 'string',\n      title: 'Original file name',\n      readOnly: true,\n    },\n    {\n      name: 'label',\n      type: 'string',\n      title: 'Label',\n    },\n    {\n      name: 'title',\n      type: 'string',\n      title: 'Title',\n    },\n    {\n      name: 'description',\n      type: 'string',\n      title: 'Description',\n    },\n    {\n      name: 'altText',\n      type: 'string',\n      title: 'Alternative text',\n    },\n    {\n      name: 'sha1hash',\n      type: 'string',\n      title: 'SHA1 hash',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'extension',\n      type: 'string',\n      title: 'File extension',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'mimeType',\n      type: 'string',\n      title: 'Mime type',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'size',\n      type: 'number',\n      title: 'File size in bytes',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'assetId',\n      type: 'string',\n      title: 'Asset ID',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'uploadId',\n      type: 'string',\n      readOnly: true,\n      hidden: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'path',\n      type: 'string',\n      title: 'Path',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'url',\n      type: 'string',\n      title: 'Url',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'source',\n      type: 'sanity.assetSourceData',\n      title: 'Source',\n      readOnly: true,\n      fieldset: 'system',\n    },\n  ],\n  preview: {\n    select: {\n      title: 'originalFilename',\n      path: 'path',\n      mimeType: 'mimeType',\n      size: 'size',\n    },\n    prepare(doc: Partial<SanityDocument>) {\n      return {\n        title: doc.title || doc.path.split('/').slice(-1)[0],\n        subtitle: `${doc.mimeType} (${(doc.size / 1024 / 1024).toFixed(2)} MB)`,\n      }\n    },\n  },\n  orderings: [\n    {\n      title: 'File size',\n      name: 'fileSizeDesc',\n      by: [{field: 'size', direction: 'desc'}],\n    },\n  ],\n}\n","export default {\n  title: 'Geographical Point',\n  name: 'geopoint',\n  type: 'object',\n  fields: [\n    {\n      name: 'lat',\n      type: 'number',\n      title: 'Latitude',\n    },\n    {\n      name: 'lng',\n      type: 'number',\n      title: 'Longitude',\n    },\n    {\n      name: 'alt',\n      type: 'number',\n      title: 'Altitude',\n    },\n  ],\n}\n","import {type SanityDocument} from '@sanity/types'\n\nexport default {\n  name: 'sanity.imageAsset',\n  title: 'Image',\n  type: 'document',\n  fieldsets: [\n    {\n      name: 'system',\n      title: 'System fields',\n      description: 'These fields are managed by the system and not editable',\n    },\n  ],\n  fields: [\n    {\n      name: 'originalFilename',\n      type: 'string',\n      title: 'Original file name',\n      readOnly: true,\n    },\n    {\n      name: 'label',\n      type: 'string',\n      title: 'Label',\n    },\n    {\n      name: 'title',\n      type: 'string',\n      title: 'Title',\n    },\n    {\n      name: 'description',\n      type: 'string',\n      title: 'Description',\n    },\n    {\n      name: 'altText',\n      type: 'string',\n      title: 'Alternative text',\n    },\n    {\n      name: 'sha1hash',\n      type: 'string',\n      title: 'SHA1 hash',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'extension',\n      type: 'string',\n      readOnly: true,\n      title: 'File extension',\n      fieldset: 'system',\n    },\n    {\n      name: 'mimeType',\n      type: 'string',\n      readOnly: true,\n      title: 'Mime type',\n      fieldset: 'system',\n    },\n    {\n      name: 'size',\n      type: 'number',\n      title: 'File size in bytes',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'assetId',\n      type: 'string',\n      title: 'Asset ID',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'uploadId',\n      type: 'string',\n      readOnly: true,\n      hidden: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'path',\n      type: 'string',\n      title: 'Path',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'url',\n      type: 'string',\n      title: 'Url',\n      readOnly: true,\n      fieldset: 'system',\n    },\n    {\n      name: 'metadata',\n      type: 'sanity.imageMetadata',\n      title: 'Metadata',\n    },\n    {\n      name: 'source',\n      type: 'sanity.assetSourceData',\n      title: 'Source',\n      readOnly: true,\n      fieldset: 'system',\n    },\n  ],\n  preview: {\n    select: {\n      id: '_id',\n      title: 'originalFilename',\n      mimeType: 'mimeType',\n      size: 'size',\n    },\n    prepare(doc: Partial<SanityDocument>) {\n      return {\n        title: doc.title || (typeof doc.path === 'string' && doc.path.split('/').slice(-1)[0]),\n        media: {asset: {_ref: doc.id}},\n        subtitle: `${doc.mimeType} (${(Number(doc.size) / 1024 / 1024).toFixed(2)} MB)`,\n      }\n    },\n  },\n  orderings: [\n    {\n      title: 'File size',\n      name: 'fileSizeDesc',\n      by: [{field: 'size', direction: 'desc'}],\n    },\n  ],\n}\n","export default {\n  name: 'sanity.imageCrop',\n  title: 'Image crop',\n  type: 'object',\n  fields: [\n    {\n      name: 'top',\n      type: 'number',\n    },\n    {\n      name: 'bottom',\n      type: 'number',\n    },\n    {\n      name: 'left',\n      type: 'number',\n    },\n    {\n      name: 'right',\n      type: 'number',\n    },\n  ],\n}\n","export default {\n  name: 'sanity.imageDimensions',\n  type: 'object',\n  title: 'Image dimensions',\n  fields: [\n    {name: 'height', type: 'number', title: 'Height', readOnly: true},\n    {name: 'width', type: 'number', title: 'Width', readOnly: true},\n    {name: 'aspectRatio', type: 'number', title: 'Aspect ratio', readOnly: true},\n  ],\n}\n","export default {\n  name: 'sanity.imageHotspot',\n  title: 'Image hotspot',\n  type: 'object',\n  fields: [\n    {\n      name: 'x',\n      type: 'number',\n    },\n    {\n      name: 'y',\n      type: 'number',\n    },\n    {\n      name: 'height',\n      type: 'number',\n    },\n    {\n      name: 'width',\n      type: 'number',\n    },\n  ],\n}\n","export default {\n  name: 'sanity.imageMetadata',\n  title: 'Image metadata',\n  type: 'object',\n  fieldsets: [\n    {\n      name: 'extra',\n      title: 'Extra metadata',\n      options: {\n        collapsable: true,\n      },\n    },\n  ],\n  fields: [\n    {\n      name: 'location',\n      type: 'geopoint',\n    },\n    {\n      name: 'dimensions',\n      title: 'Dimensions',\n      type: 'sanity.imageDimensions',\n      fieldset: 'extra',\n    },\n    {\n      name: 'palette',\n      type: 'sanity.imagePalette',\n      title: 'Palette',\n      fieldset: 'extra',\n    },\n    {\n      name: 'lqip',\n      title: 'LQIP (Low-Quality Image Placeholder)',\n      type: 'string',\n      readOnly: true,\n    },\n    {\n      name: 'blurHash',\n      title: 'BlurHash',\n      type: 'string',\n      readOnly: true,\n    },\n    {\n      name: 'hasAlpha',\n      title: 'Has alpha channel',\n      type: 'boolean',\n      readOnly: true,\n    },\n    {\n      name: 'isOpaque',\n      title: 'Is opaque',\n      type: 'boolean',\n      readOnly: true,\n    },\n  ],\n}\n","export default {\n  name: 'sanity.imagePalette',\n  title: 'Image palette',\n  type: 'object',\n  fields: [\n    {name: 'darkMuted', type: 'sanity.imagePaletteSwatch', title: 'Dark Muted'},\n    {name: 'lightVibrant', type: 'sanity.imagePaletteSwatch', title: 'Light Vibrant'},\n    {name: 'darkVibrant', type: 'sanity.imagePaletteSwatch', title: 'Dark Vibrant'},\n    {name: 'vibrant', type: 'sanity.imagePaletteSwatch', title: 'Vibrant'},\n    {name: 'dominant', type: 'sanity.imagePaletteSwatch', title: 'Dominant'},\n    {name: 'lightMuted', type: 'sanity.imagePaletteSwatch', title: 'Light Muted'},\n    {name: 'muted', type: 'sanity.imagePaletteSwatch', title: 'Muted'},\n  ],\n}\n","export default {\n  name: 'sanity.imagePaletteSwatch',\n  title: 'Image palette swatch',\n  type: 'object',\n  fields: [\n    {name: 'background', type: 'string', title: 'Background', readOnly: true},\n    {name: 'foreground', type: 'string', title: 'Foreground', readOnly: true},\n    {name: 'population', type: 'number', title: 'Population', readOnly: true},\n    {name: 'title', type: 'string', title: 'String', readOnly: true},\n  ],\n}\n","export default {\n  title: 'Slug',\n  name: 'slug',\n  type: 'object',\n  fields: [\n    {\n      name: 'current',\n      title: 'Current slug',\n      type: 'string',\n    },\n    {\n      // The source field is deprecated/unused, but leaving it included and hidden\n      // to prevent rendering \"Unknown field\" warnings on legacy data\n      name: 'source',\n      title: 'Source field',\n      type: 'string',\n      hidden: true,\n    },\n  ],\n}\n","import {Schema as SchemaBuilder, type SchemaValidationResult} from '@sanity/schema'\nimport {groupProblems, validateSchema} from '@sanity/schema/_internal'\nimport {type Schema} from '@sanity/types'\n\nimport {inferFromSchema as inferValidation} from '../validation'\nimport assetSourceData from './types/assetSourceData'\nimport fileAsset from './types/fileAsset'\nimport geopoint from './types/geopoint'\nimport imageAsset from './types/imageAsset'\nimport imageCrop from './types/imageCrop'\nimport imageDimensions from './types/imageDimensions'\nimport imageHotspot from './types/imageHotspot'\nimport imageMetadata from './types/imageMetadata'\nimport imagePalette from './types/imagePalette'\nimport imagePaletteSwatch from './types/imagePaletteSwatch'\nimport slug from './types/slug'\n\nconst isError = (problem: SchemaValidationResult) => problem.severity === 'error'\n\nconst builtinTypes = [\n  assetSourceData,\n  slug,\n  geopoint,\n  // legacyRichDate,\n  imageAsset,\n  fileAsset,\n  imageCrop,\n  imageHotspot,\n  imageMetadata,\n  imageDimensions,\n  imagePalette,\n  imagePaletteSwatch,\n]\n\n/**\n * @hidden\n * @beta */\nexport function createSchema(schemaDef: {name: string; types: any[]}): Schema {\n  const validated = validateSchema(schemaDef.types).getTypes()\n  const validation = groupProblems(validated)\n  const hasErrors = validation.some((group) => group.problems.some(isError))\n\n  const compiled = SchemaBuilder.compile({\n    name: schemaDef.name,\n    types: hasErrors ? [] : [...schemaDef.types, ...builtinTypes].filter(Boolean),\n  })\n\n  // ;(compiled as any)._source = schemaDef\n  ;(compiled as any)._validation = validation\n\n  return inferValidation(compiled as Schema)\n}\n","import {type SchemaType} from '@sanity/types'\n\n/**\n * Get the most specific defined title of a schema type\n * If not set directly on the given type, it will traverse up the tree until it\n * finds one, falling back to the _name_ of the type.\n *\n * @param type - The schema type to get the title of\n * @returns A title, alternatively the schema type _name_\n * @internal\n */\nexport function getSchemaTypeTitle(type: SchemaType): string {\n  if (typeof type.title === 'string') {\n    return type.title\n  }\n\n  if (type.type) {\n    return getSchemaTypeTitle(type.type)\n  }\n\n  return type.name || type.jsonType\n}\n","import {Box, type ResponsiveWidthProps} from '@sanity/ui'\nimport {type DragEvent, type ReactElement, type ReactNode, useRef, useState} from 'react'\n\nimport {Dialog} from '../../../ui-components'\nimport {PopoverDialog} from '../../components'\nimport {PresenceOverlay} from '../../presence'\nimport {VirtualizerScrollInstanceProvider} from '../inputs/arrays/ArrayOfObjectsInput/List/VirtualizerScrollInstanceProvider'\n\nconst PRESENCE_MARGINS: [number, number, number, number] = [0, 0, 1, 0]\n\ninterface Props {\n  type: 'popover' | 'dialog'\n  width: ResponsiveWidthProps['width']\n  header: string\n  id?: string\n  onClose: () => void\n  children?: ReactNode\n  // eslint-disable-next-line camelcase\n  legacy_referenceElement: HTMLElement | null\n  autofocus?: boolean\n}\n\nfunction onDragEnter(event: DragEvent<HTMLDivElement>) {\n  return event.stopPropagation()\n}\n\nfunction onDrop(event: DragEvent<HTMLDivElement>) {\n  return event.stopPropagation()\n}\n\nexport function EditPortal(props: Props): ReactElement {\n  const {\n    children,\n    header,\n    id,\n    legacy_referenceElement: referenceElement,\n    onClose,\n    type,\n    width,\n    autofocus,\n  } = props\n  const [documentScrollElement, setDocumentScrollElement] = useState<HTMLDivElement | null>(null)\n  const containerElement = useRef<HTMLDivElement | null>(null)\n\n  const contents = (\n    <PresenceOverlay margins={PRESENCE_MARGINS}>\n      <Box ref={containerElement}>{children}</Box>\n    </PresenceOverlay>\n  )\n\n  if (type === 'dialog') {\n    return (\n      <VirtualizerScrollInstanceProvider\n        scrollElement={documentScrollElement}\n        containerElement={containerElement}\n      >\n        <Dialog\n          header={header}\n          id={id || ''}\n          onClickOutside={onClose}\n          onClose={onClose}\n          onDragEnter={onDragEnter}\n          onDrop={onDrop}\n          width={width}\n          contentRef={setDocumentScrollElement}\n          __unstable_autoFocus={autofocus}\n        >\n          {contents}\n        </Dialog>\n      </VirtualizerScrollInstanceProvider>\n    )\n  }\n\n  return (\n    <PopoverDialog\n      header={header}\n      onClose={onClose}\n      referenceElement={referenceElement}\n      width={width}\n      containerRef={setDocumentScrollElement}\n    >\n      <VirtualizerScrollInstanceProvider\n        scrollElement={documentScrollElement}\n        containerElement={containerElement}\n      >\n        {contents}\n      </VirtualizerScrollInstanceProvider>\n    </PopoverDialog>\n  )\n}\n","/* eslint-disable react/jsx-no-bind */\nimport {InsertAboveIcon, InsertBelowIcon} from '@sanity/icons'\nimport {type SchemaType} from '@sanity/types'\nimport {type ComponentProps, memo} from 'react'\n\nimport {MenuGroup, MenuItem, type PopoverProps} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\n\ninterface Props {\n  types?: SchemaType[]\n  onInsert: (pos: 'before' | 'after', type: SchemaType) => void\n}\n\nconst MENU_POPOVER_PROPS: PopoverProps = {\n  portal: true,\n  tone: 'default',\n  placement: 'left',\n  constrainSize: true,\n} as const\n\nexport const InsertMenu = memo(function InsertMenu(props: Props) {\n  const {types, onInsert} = props\n  const {t} = useTranslation()\n  return (\n    <>\n      <InsertMenuGroup\n        pos=\"before\"\n        types={types}\n        onInsert={onInsert}\n        text={t('inputs.array.action.add-before')}\n        icon={InsertAboveIcon}\n      />\n      <InsertMenuGroup\n        pos=\"after\"\n        types={types}\n        onInsert={onInsert}\n        text={t('inputs.array.action.add-after')}\n        icon={InsertBelowIcon}\n      />\n    </>\n  )\n})\n\nfunction InsertMenuGroup(\n  props: Props & {\n    pos: 'before' | 'after'\n    text: ComponentProps<typeof MenuItem>['text']\n    icon: ComponentProps<typeof MenuItem>['icon']\n  },\n) {\n  const {types, onInsert, pos, text, icon} = props\n\n  if (types?.length === 1) {\n    return <MenuItem key={pos} text={text} icon={icon} onClick={() => onInsert(pos, types[0])} />\n  }\n  return (\n    <MenuGroup text={text} key={pos} popover={MENU_POPOVER_PROPS}>\n      {types?.map((insertableType) => (\n        <MenuItem\n          key={insertableType.name}\n          icon={insertableType.icon}\n          text={insertableType.title}\n          onClick={() => onInsert(pos, insertableType)}\n        />\n      ))}\n    </MenuGroup>\n  )\n}\n","import {CopyIcon as DuplicateIcon, TrashIcon} from '@sanity/icons'\nimport {type SchemaType} from '@sanity/types'\nimport {Box, Card, type CardTone, Menu} from '@sanity/ui'\nimport {useCallback, useMemo, useRef} from 'react'\nimport styled from 'styled-components'\n\nimport {MenuButton, MenuItem} from '../../../../../../ui-components'\nimport {ChangeIndicator} from '../../../../../changeIndicators'\nimport {ContextMenuButton} from '../../../../../components/contextMenuButton'\nimport {LoadingBlock} from '../../../../../components/loadingBlock'\nimport {type FIXME} from '../../../../../FIXME'\nimport {useTranslation} from '../../../../../i18n'\nimport {FieldPresence} from '../../../../../presence'\nimport {getSchemaTypeTitle} from '../../../../../schema'\nimport {FormFieldValidationStatus} from '../../../../components'\nimport {EditPortal} from '../../../../components/EditPortal'\nimport {useDidUpdate} from '../../../../hooks/useDidUpdate'\nimport {useScrollIntoViewOnFocusWithin} from '../../../../hooks/useScrollIntoViewOnFocusWithin'\nimport {useChildPresence} from '../../../../studio/contexts/Presence'\nimport {useChildValidation} from '../../../../studio/contexts/Validation'\nimport {type ObjectItem, type ObjectItemProps} from '../../../../types'\nimport {randomKey} from '../../../../utils/randomKey'\nimport {CellLayout} from '../../layouts/CellLayout'\nimport {createProtoArrayValue} from '../createProtoArrayValue'\nimport {InsertMenu} from '../InsertMenu'\n\ntype GridItemProps<Item extends ObjectItem> = Omit<ObjectItemProps<Item>, 'renderDefault'>\n\nconst PreviewCard = styled(Card)`\n  border-top-right-radius: inherit;\n  border-top-left-radius: inherit;\n  height: 100%;\n  position: relative;\n\n  @media (hover: hover) {\n    &:hover {\n      filter: brightness(95%);\n    }\n  }\n\n  &:focus:focus-visible {\n    box-shadow: 0 0 0 2px var(--card-focus-ring-color);\n  }\n`\n\nfunction getTone({\n  readOnly,\n  hasErrors,\n  hasWarnings,\n}: {\n  readOnly: boolean | undefined\n  hasErrors: boolean\n  hasWarnings: boolean\n}): CardTone {\n  if (readOnly) {\n    return 'transparent'\n  }\n  if (hasErrors) {\n    return 'critical'\n  }\n  return hasWarnings ? 'caution' : 'default'\n}\nconst MENU_POPOVER_PROPS = {portal: true, tone: 'default'} as const\n\nexport function GridItem<Item extends ObjectItem = ObjectItem>(props: GridItemProps<Item>) {\n  const {\n    schemaType,\n    parentSchemaType,\n    path,\n    readOnly,\n    onRemove,\n    value,\n    open,\n    onInsert,\n    onFocus,\n    onOpen,\n    onClose,\n    changed,\n    focused,\n    children,\n    inputProps: {renderPreview},\n  } = props\n  const {t} = useTranslation()\n\n  const sortable = !readOnly && parentSchemaType.options?.sortable !== false\n  const insertableTypes = parentSchemaType.of\n\n  const previewCardRef = useRef<FIXME | null>(null)\n\n  // this is here to make sure the item is visible if it's being edited behind a modal\n  useScrollIntoViewOnFocusWithin(previewCardRef, open)\n\n  useDidUpdate(focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus && previewCardRef.current) {\n      // Note: if editing an inline item, focus is handled by the item input itself and no ref is being set\n      previewCardRef.current?.focus()\n    }\n  })\n\n  const resolvingInitialValue = (value as any)._resolvingInitialValue\n\n  const handleDuplicate = useCallback(() => {\n    onInsert({\n      items: [{...value, _key: randomKey()}],\n      position: 'after',\n    })\n  }, [onInsert, value])\n\n  const handleInsert = useCallback(\n    (pos: 'before' | 'after', insertType: SchemaType) => {\n      onInsert({\n        items: [createProtoArrayValue(insertType)],\n        position: pos,\n      })\n    },\n    [onInsert],\n  )\n\n  const childPresence = useChildPresence(path, true)\n  const presence = useMemo(() => {\n    return childPresence.length === 0 ? null : (\n      <FieldPresence presence={childPresence} maxAvatars={1} />\n    )\n  }, [childPresence])\n\n  const childValidation = useChildValidation(path, true)\n  const validation = useMemo(() => {\n    return childValidation.length === 0 ? null : (\n      <Box paddingX={1} paddingY={3}>\n        <FormFieldValidationStatus validation={childValidation} __unstable_showSummary />\n      </Box>\n    )\n  }, [childValidation])\n\n  const hasErrors = childValidation.some((v) => v.level === 'error')\n  const hasWarnings = childValidation.some((v) => v.level === 'warning')\n\n  const menu = useMemo(\n    () =>\n      readOnly ? null : (\n        <MenuButton\n          button={<ContextMenuButton paddingY={3} />}\n          id={`${props.inputId}-menuButton`}\n          menu={\n            <Menu>\n              <MenuItem\n                text={t('inputs.array.action.remove')}\n                tone=\"critical\"\n                icon={TrashIcon}\n                onClick={onRemove}\n              />\n              <MenuItem\n                text={t('inputs.array.action.duplicate')}\n                icon={DuplicateIcon}\n                onClick={handleDuplicate}\n              />\n              <InsertMenu types={insertableTypes} onInsert={handleInsert} />\n            </Menu>\n          }\n          popover={MENU_POPOVER_PROPS}\n        />\n      ),\n    [handleDuplicate, handleInsert, onRemove, insertableTypes, props.inputId, readOnly, t],\n  )\n\n  const tone = getTone({readOnly, hasErrors, hasWarnings})\n\n  const item = (\n    <CellLayout\n      menu={menu}\n      presence={presence}\n      validation={validation}\n      tone={tone}\n      radius={2}\n      border\n      dragHandle={sortable}\n      selected={open}\n    >\n      <PreviewCard\n        tone=\"inherit\"\n        overflow=\"auto\"\n        forwardedAs=\"button\"\n        data-ui=\"PreviewCard\"\n        data-as=\"button\"\n        type=\"button\"\n        flex={1}\n        tabIndex={0}\n        disabled={resolvingInitialValue}\n        onClick={onOpen}\n        ref={previewCardRef}\n        onFocus={onFocus}\n        __unstable_focusRing\n      >\n        {renderPreview({\n          schemaType,\n          value,\n          layout: 'media',\n          withBorder: false,\n          withShadow: false,\n        })}\n\n        {resolvingInitialValue && <LoadingBlock fill />}\n      </PreviewCard>\n    </CellLayout>\n  )\n\n  const itemTypeTitle = getSchemaTypeTitle(schemaType)\n  return (\n    <>\n      <ChangeIndicator path={path} isChanged={changed} hasFocus={Boolean(focused)}>\n        {item}\n      </ChangeIndicator>\n      {open && (\n        <EditPortal\n          header={\n            readOnly\n              ? t('inputs.array.action.view', {itemTypeTitle})\n              : t('inputs.array.action.edit', {itemTypeTitle})\n          }\n          type={parentSchemaType?.options?.modal?.type || 'dialog'}\n          width={parentSchemaType?.options?.modal?.width ?? 1}\n          id={value._key}\n          onClose={onClose}\n          autofocus={focused}\n          legacy_referenceElement={previewCardRef.current}\n        >\n          {children}\n        </EditPortal>\n      )}\n    </>\n  )\n}\n","/* eslint-disable react/jsx-handler-names */\nimport {Card, Stack, Text} from '@sanity/ui'\nimport {useCallback, useMemo} from 'react'\n\nimport {useTranslation} from '../../../../../i18n'\nimport {ArrayOfObjectsItem} from '../../../../members'\nimport {\n  type ArrayOfObjectsInputProps,\n  type ObjectItem,\n  type ObjectItemProps,\n} from '../../../../types'\nimport {Item, List} from '../../common/list'\nimport {UploadTargetCard} from '../../common/UploadTargetCard'\nimport {ArrayOfObjectsFunctions} from '../ArrayOfObjectsFunctions'\nimport {createProtoArrayValue} from '../createProtoArrayValue'\nimport {ErrorItem} from './ErrorItem'\nimport {GridItem} from './GridItem'\n\nconst EMPTY: [] = []\n\nexport function GridArrayInput<Item extends ObjectItem>(props: ArrayOfObjectsInputProps<Item>) {\n  const {\n    arrayFunctions: ArrayFunctions = ArrayOfObjectsFunctions,\n    elementProps,\n    members,\n    onChange,\n    onInsert,\n    onItemMove,\n    onUpload,\n    readOnly,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderPreview,\n    resolveUploader,\n    schemaType,\n    value = EMPTY,\n  } = props\n  const {t} = useTranslation()\n\n  const handlePrepend = useCallback(\n    (item: Item) => {\n      onInsert({items: [item], position: 'before', referenceItem: 0})\n    },\n    [onInsert],\n  )\n\n  const handleAppend = useCallback(\n    (item: Item) => {\n      onInsert({items: [item], position: 'after', referenceItem: -1})\n    },\n    [onInsert],\n  )\n\n  const sortable = schemaType.options?.sortable !== false\n\n  const renderItem = useCallback((itemProps: Omit<ObjectItemProps, 'renderDefault'>) => {\n    // todo: consider using a different item component for references\n    return <GridItem {...itemProps} />\n  }, [])\n\n  const memberKeys = useMemo(() => members.map((member) => member.key), [members])\n\n  return (\n    <Stack space={2}>\n      <UploadTargetCard\n        types={schemaType.of}\n        resolveUploader={resolveUploader}\n        onUpload={onUpload}\n        {...elementProps}\n        tabIndex={0}\n      >\n        <Stack data-ui=\"ArrayInput__content\" space={2}>\n          {members?.length === 0 && (\n            <Card padding={3} border radius={2}>\n              <Text align=\"center\" muted size={1}>\n                {schemaType.placeholder || <>{t('inputs.array.no-items-label')}</>}\n              </Text>\n            </Card>\n          )}\n          {members?.length > 0 && (\n            <Card border radius={1}>\n              <List\n                columns={[2, 3, 4]}\n                gap={3}\n                padding={1}\n                margin={1}\n                items={memberKeys}\n                onItemMove={onItemMove}\n                sortable={sortable}\n              >\n                {members.map((member) => (\n                  <Item key={member.key} sortable={sortable} id={member.key} flex={1}>\n                    {member.kind === 'item' && (\n                      <ArrayOfObjectsItem\n                        member={member}\n                        renderAnnotation={renderAnnotation}\n                        renderBlock={renderBlock}\n                        renderInlineBlock={renderInlineBlock}\n                        renderItem={renderItem}\n                        renderField={renderField}\n                        renderInput={renderInput}\n                        renderPreview={renderPreview}\n                      />\n                    )}\n                    {member.kind === 'error' && <ErrorItem sortable={sortable} member={member} />}\n                  </Item>\n                ))}\n              </List>\n            </Card>\n          )}\n        </Stack>\n      </UploadTargetCard>\n\n      <ArrayFunctions\n        onChange={onChange}\n        onItemAppend={handleAppend}\n        onItemPrepend={handlePrepend}\n        onValueCreate={createProtoArrayValue}\n        readOnly={readOnly}\n        schemaType={schemaType}\n        value={value}\n      />\n    </Stack>\n  )\n}\n","import {Box, Card, type CardTone, Flex, Stack} from '@sanity/ui'\nimport {type ReactNode, useRef} from 'react'\nimport styled from 'styled-components'\n\nimport {useDidUpdate} from '../../../hooks/useDidUpdate'\nimport {DragHandle} from '../common/DragHandle'\nimport {MOVING_ITEM_CLASS_NAME} from '../common/list'\n\ninterface RowLayoutProps {\n  tone?: CardTone\n  dragHandle?: boolean\n  focused?: boolean\n  presence?: ReactNode\n  validation?: ReactNode\n  menu?: ReactNode\n  footer?: ReactNode\n  selected?: boolean\n  children?: ReactNode\n}\n\nconst Root = styled(Card)`\n  position: relative;\n  border: 1px solid transparent;\n  transition: border-color 250ms;\n\n  .${MOVING_ITEM_CLASS_NAME} & {\n    border-color: var(--card-shadow-umbra-color);\n    box-shadow:\n      0 0 0 0,\n      0 8px 17px 2px var(--card-shadow-umbra-color),\n      0 3px 14px 2px var(--card-shadow-penumbra-color),\n      0 5px 5px -3px var(--card-shadow-ambient-color);\n  }\n\n  &:hover {\n    border-color: var(--card-shadow-umbra-color);\n  }\n\n  &[aria-selected='true'] {\n    border-color: var(--card-focus-ring-color);\n  }\n`\n\nexport function RowLayout(props: RowLayoutProps) {\n  const {validation, selected, tone, presence, focused, children, dragHandle, menu, footer} = props\n\n  const elementRef = useRef<HTMLDivElement | null>(null)\n\n  useDidUpdate(focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus) {\n      elementRef.current?.focus()\n    }\n  })\n\n  return (\n    <Root\n      ref={elementRef}\n      selected={selected}\n      aria-selected={selected}\n      radius={1}\n      padding={1}\n      tone={tone}\n    >\n      <Stack space={1}>\n        <Flex align=\"center\" gap={1}>\n          {dragHandle && <DragHandle paddingY={3} />}\n\n          <Box flex={1}>{children}</Box>\n\n          {(presence || validation || menu) && (\n            <Flex align=\"center\" flex=\"none\" gap={2} style={{lineHeight: 0}}>\n              {presence && <Box flex=\"none\">{presence}</Box>}\n              {validation && <Box flex=\"none\">{validation}</Box>}\n              {menu}\n            </Flex>\n          )}\n        </Flex>\n        {footer}\n      </Stack>\n    </Root>\n  )\n}\n","import {BulbOutlineIcon, UnknownIcon} from '@sanity/icons'\nimport {Box, Card, Code, Flex, Stack, Text, type Theme, useClickOutside} from '@sanity/ui'\nimport {resolveTypeName} from '@sanity/util/content'\nimport {type FocusEvent, useCallback, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../../../ui-components'\nimport {Translate, useTranslation} from '../../../../../i18n'\n\nconst PopoverCard = styled(Card)`\n  max-width: ${({theme}: {theme: Theme}) => theme.sanity.container[1]}px;\n`\n\ninterface Props {\n  value: unknown\n  onFocus?: (event: FocusEvent) => void\n  vertical?: boolean\n}\n\nexport function IncompatibleItemType(props: Props) {\n  const {value, onFocus, vertical, ...rest} = props\n  const [showDetails, setShowDetails] = useState(false)\n  const [popoverRef, setPopoverRef] = useState<HTMLElement | null>(null)\n\n  const {t} = useTranslation()\n\n  useClickOutside(() => setShowDetails(false), [popoverRef])\n\n  const handleKeyDown = useCallback((e: any) => {\n    if (e.key === 'Escape' || e.key === 'Tab') {\n      setShowDetails(false)\n    }\n  }, [])\n\n  const handleShowDetails = useCallback(() => {\n    setShowDetails((v) => !v)\n  }, [])\n\n  const typeName = resolveTypeName(value)\n  return (\n    <Popover\n      open={showDetails}\n      ref={setPopoverRef}\n      onKeyDown={handleKeyDown}\n      portal\n      constrainSize\n      tone=\"default\"\n      content={\n        <PopoverCard margin={1} padding={3} onKeyDown={handleKeyDown} tabIndex={0} overflow=\"auto\">\n          <Stack space={4}>\n            <Box>\n              <Text weight=\"medium\">{t('inputs.array.error.type-is-incompatible-title')}</Text>\n            </Box>\n            <Text size={1}>\n              <Translate\n                t={t}\n                i18nKey=\"inputs.array.error.current-schema-not-declare-description\"\n                values={{typeName}}\n              />\n            </Text>\n            <Box>\n              <Text size={1}>\n                <BulbOutlineIcon /> {t('inputs.array.error.can-delete-but-no-edit-description')}\n              </Text>\n            </Box>\n            <Stack space={2}>\n              <Text size={1} weight=\"medium\">\n                {t('inputs.array.error.json-representation-description')}\n              </Text>\n              <Card padding={2} overflow=\"auto\" border>\n                <Code size={1} as=\"pre\" language=\"json\">\n                  {JSON.stringify(value, null, 2)}\n                </Code>\n              </Card>\n            </Stack>\n          </Stack>\n        </PopoverCard>\n      }\n    >\n      <Card\n        as=\"button\"\n        type=\"button\"\n        radius={2}\n        tone=\"inherit\"\n        paddingX={2}\n        paddingY={3}\n        flex={1}\n        onFocus={onFocus}\n        onClick={handleShowDetails}\n        onKeyDown={handleKeyDown}\n        __unstable_focusRing\n        {...rest}\n      >\n        <Flex align=\"center\">\n          <Box marginRight={3}>\n            <Text>\n              <UnknownIcon />\n            </Text>\n          </Box>\n\n          <Box flex={1}>\n            <Text size={1} textOverflow=\"ellipsis\">\n              <Translate\n                t={t}\n                i18nKey=\"inputs.array.error.type-is-incompatible-prompt\"\n                values={{typeName}}\n              />\n            </Text>\n          </Box>\n        </Flex>\n      </Card>\n    </Popover>\n  )\n}\n","import {TrashIcon} from '@sanity/icons'\nimport {Box, Menu} from '@sanity/ui'\nimport {useId} from 'react'\n\nimport {MenuButton, MenuItem} from '../../../../../../ui-components'\nimport {ContextMenuButton} from '../../../../../components/contextMenuButton'\nimport {useTranslation} from '../../../../../i18n'\nimport {type ArrayItemError} from '../../../../store'\nimport {RowLayout} from '../../layouts/RowLayout'\nimport {IncompatibleItemType} from './IncompatibleItemType'\n\nconst MENU_POPOVER_PROPS = {portal: true, tone: 'default'} as const\n\nexport function ErrorItem(props: {\n  member: ArrayItemError\n  sortable?: boolean\n  onRemove: () => void\n}) {\n  const {member, sortable, onRemove} = props\n  const id = useId()\n\n  const {t} = useTranslation()\n\n  return (\n    <Box paddingX={1}>\n      <RowLayout\n        dragHandle={sortable}\n        tone=\"caution\"\n        menu={\n          <MenuButton\n            button={<ContextMenuButton paddingY={3} />}\n            id={`${id}-menuButton`}\n            menu={\n              <Menu>\n                <MenuItem\n                  text={t('inputs.array.action.remove-invalid-item')}\n                  tone=\"critical\"\n                  icon={TrashIcon}\n                  onClick={onRemove}\n                />\n              </Menu>\n            }\n            popover={MENU_POPOVER_PROPS}\n          />\n        }\n      >\n        {member.error.type === 'INVALID_ITEM_TYPE' ? (\n          <IncompatibleItemType value={member.error.value} />\n        ) : (\n          <div>{t('inputs.array.error.unexpected-error', {error: member.error.type})}</div>\n        )}\n      </RowLayout>\n    </Box>\n  )\n}\n","import {useEffect, useRef} from 'react'\n\nexport function useMemoCompare<T>(next: T, compare: (prev: T, next: T) => boolean): T {\n  // Ref for storing previous value\n  const previousRef = useRef<T>(next)\n  const previous = previousRef.current\n  // Pass previous and next value to compare function\n  // to determine whether to consider them equal.\n  const isEqual = compare(previous, next)\n  // If not equal update previousRef to next value.\n  // We only update if not equal so that this hook continues to return\n  // the same old value if compare keeps returning true.\n  useEffect(() => {\n    if (!isEqual) {\n      previousRef.current = next\n    }\n  })\n  // Finally, if equal then return the previous value\n  return isEqual ? previous : next\n}\n","import {type DragStartEvent} from '@dnd-kit/core'\nimport {isKeySegment} from '@sanity/types'\nimport {Card, Stack, Text, useTheme} from '@sanity/ui'\nimport {\n  defaultRangeExtractor,\n  elementScroll,\n  type Range,\n  useVirtualizer,\n  type VirtualizerOptions,\n} from '@tanstack/react-virtual'\nimport {useCallback, useMemo, useRef, useState} from 'react'\nimport shallowEquals from 'shallow-equals'\n\nimport {useTranslation} from '../../../../../i18n'\nimport {ArrayOfObjectsItem} from '../../../../members'\nimport {type ArrayOfObjectsInputProps, type ObjectItem} from '../../../../types'\nimport {Item, List} from '../../common/list'\nimport {UploadTargetCard} from '../../common/UploadTargetCard'\nimport {ArrayOfObjectsFunctions} from '../ArrayOfObjectsFunctions'\nimport {createProtoArrayValue} from '../createProtoArrayValue'\nimport {ErrorItem} from './ErrorItem'\nimport {useMemoCompare} from './useMemoCompare'\nimport {useVirtualizerScrollInstance} from './useVirtualizerScrollInstance'\n\nconst EMPTY: [] = []\n\nexport function ListArrayInput<Item extends ObjectItem>(props: ArrayOfObjectsInputProps<Item>) {\n  const {\n    arrayFunctions: ArrayFunctions = ArrayOfObjectsFunctions,\n    elementProps,\n    members,\n    onChange,\n    onInsert,\n    onItemMove,\n    onUpload,\n    focusPath,\n    readOnly,\n    renderAnnotation,\n    renderBlock,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n    resolveUploader,\n    schemaType,\n    value = EMPTY,\n  } = props\n  const {t} = useTranslation()\n\n  // Stores the index of the item being dragged\n  const [activeDragItemIndex, setActiveDragItemIndex] = useState<number | null>(null)\n  const {space} = useTheme().sanity\n\n  const handlePrepend = useCallback(\n    (item: Item) => {\n      onInsert({items: [item], position: 'before', referenceItem: 0})\n    },\n    [onInsert],\n  )\n\n  const handleAppend = useCallback(\n    (item: Item) => {\n      onInsert({items: [item], position: 'after', referenceItem: -1})\n    },\n    [onInsert],\n  )\n\n  const memberKeys = useMemoCompare(\n    useMemo(() => members.map((member) => member.key), [members]),\n    shallowEquals,\n  )\n\n  const {scrollElement, containerElement} = useVirtualizerScrollInstance()\n  const parentRef = useRef<HTMLDivElement>(null)\n\n  const focusPathKey = useMemo(() => {\n    return isKeySegment(focusPath[0]) ? focusPath[0]._key : focusPath[0]\n  }, [focusPath])\n\n  /**\n   * This is a custom range extractor that adds the activeDragItemIndex and focusedItem to the range\n   * so that the item is always rendered and it can perform it's own actions\n   * Note: When adding an index make sure the range includes all index or the scroll will jump\n   */\n  const rangeExtractor = useCallback(\n    (range: Range) => {\n      const newRange = {...range}\n\n      // Update start and end indexes based on activeDragItemIndex\n      if (activeDragItemIndex !== null) {\n        newRange.startIndex = Math.min(range.startIndex, activeDragItemIndex)\n        newRange.endIndex = Math.max(range.endIndex, activeDragItemIndex)\n      }\n\n      // Update start and end indexes based on focusPathKey\n      if (focusPathKey) {\n        const index = memberKeys.findIndex((key) => key === focusPathKey)\n        if (index !== -1) {\n          newRange.startIndex = Math.min(newRange.startIndex, index)\n          newRange.endIndex = Math.max(newRange.endIndex, index)\n        }\n      }\n\n      return defaultRangeExtractor(newRange)\n    },\n    [activeDragItemIndex, focusPathKey, memberKeys],\n  )\n\n  /**\n   * It observes the scroll element and calls the callback function with the difference between the\n   * scroll's scrollTop and the offsetTop of the parent element of the observed element.\n   * it return an unsubscribe function that removes the event listener when called.\n   */\n  const observeElementOffset = useCallback<\n    VirtualizerOptions<HTMLElement, Element>['observeElementOffset']\n  >(\n    (instance, callback) => {\n      if (!instance.scrollElement) {\n        return undefined\n      }\n\n      const scroll = instance.scrollElement\n\n      const handleScroll = () => {\n        const containerElementTop = containerElement.current?.getBoundingClientRect().top ?? 0\n        const parentElementTop = parentRef.current?.getBoundingClientRect().top ?? 0\n\n        // This is used to calculate the offsetTop of the parent element\n        // Instead of using the `offsetTop` which will use the nearest parent with `position: relative`\n        // We pass a component that we have more control over to avoid issues when wrapped in custom component\n        const itemOffset = Math.floor(parentElementTop - containerElementTop)\n\n        callback(scroll.scrollTop - itemOffset)\n      }\n\n      handleScroll()\n\n      instance.scrollElement.addEventListener('scroll', handleScroll, {\n        capture: false,\n        passive: true,\n      })\n\n      return () => {\n        scroll.removeEventListener('scroll', handleScroll)\n      }\n    },\n    [containerElement],\n  )\n\n  // This is the estimated size of an item in the list. The reason this is an estimate is because\n  // custom components can have different dimensions and the library recalculate the size of the element\n  const estimateSize = useCallback(() => 53, [])\n\n  const virtualizer = useVirtualizer({\n    count: members.length,\n    estimateSize,\n    getScrollElement: useCallback(() => scrollElement, [scrollElement]),\n    observeElementOffset,\n    rangeExtractor,\n    getItemKey: useCallback((index: number) => memberKeys[index], [memberKeys]),\n    scrollToFn: (offset, options, instance) => {\n      // If the offset is the same as the current scroll offset, don't scroll\n      // Offset gets set to 0 here https://github.com/TanStack/virtual/blob/beta/packages/virtual-core/src/index.ts#L211\n      // which causes the scroll to top\n      if (offset === instance.scrollOffset) {\n        return\n      }\n      elementScroll(offset, options, instance)\n    },\n  })\n\n  const items = virtualizer.getVirtualItems()\n\n  const handleItemMoveStart = useCallback((event: DragStartEvent) => {\n    const {active} = event\n    setActiveDragItemIndex(active.data.current?.sortable?.index)\n  }, [])\n\n  const handleItemMoveEnd = useCallback(() => {\n    setActiveDragItemIndex(null)\n  }, [])\n\n  const sortable = schemaType.options?.sortable !== false\n\n  const listGridGap = 1\n  const paddingY = 1\n  const radius = 2\n\n  return (\n    <Stack space={2} ref={parentRef}>\n      <UploadTargetCard\n        $radius={radius}\n        types={schemaType.of}\n        resolveUploader={resolveUploader}\n        onUpload={onUpload}\n        {...elementProps}\n        tabIndex={0}\n      >\n        <Stack data-ui=\"ArrayInput__content\" space={2}>\n          {members.length === 0 ? (\n            <Card padding={3} border radius={2}>\n              <Text align=\"center\" muted size={1}>\n                {schemaType.placeholder || <>{t('inputs.array.no-items-label')}</>}\n              </Text>\n            </Card>\n          ) : (\n            <Card\n              border\n              radius={radius}\n              style={{\n                // This is not memoized since it changes on scroll so it will change anyways making memo useless\n                // Account for grid gap\n                boxSizing: 'border-box',\n                height: `${\n                  virtualizer.getTotalSize() + items.length * space[listGridGap] + space[paddingY]\n                }px`,\n                width: '100%',\n                position: 'relative',\n              }}\n            >\n              <List\n                axis=\"y\"\n                gap={listGridGap}\n                paddingY={paddingY}\n                items={memberKeys}\n                onItemMove={onItemMove}\n                onItemMoveStart={handleItemMoveStart}\n                onItemMoveEnd={handleItemMoveEnd}\n                sortable={sortable}\n                style={{\n                  // This is not memoized since it changes on scroll so it will change anyways making memo useless\n                  position: 'absolute',\n                  top: 0,\n                  left: 0,\n                  width: '100%',\n                  transform: `translateY(${items[0].start}px)`,\n                }}\n              >\n                {items.map((virtualRow) => {\n                  const member = members[virtualRow.index]\n                  return (\n                    <Item\n                      ref={virtualizer.measureElement}\n                      key={virtualRow.key}\n                      sortable={sortable}\n                      data-index={virtualRow.index}\n                      id={member.key}\n                    >\n                      {member.kind === 'item' && (\n                        <ArrayOfObjectsItem\n                          member={member}\n                          renderAnnotation={renderAnnotation}\n                          renderBlock={renderBlock}\n                          renderField={renderField}\n                          renderInlineBlock={renderInlineBlock}\n                          renderInput={renderInput}\n                          renderItem={renderItem}\n                          renderPreview={renderPreview}\n                        />\n                      )}\n                      {member.kind === 'error' && (\n                        <ErrorItem\n                          sortable={sortable}\n                          member={member}\n                          onRemove={() => props.onItemRemove(member.key)}\n                        />\n                      )}\n                    </Item>\n                  )\n                })}\n              </List>\n            </Card>\n          )}\n        </Stack>\n      </UploadTargetCard>\n      <ArrayFunctions\n        onChange={onChange}\n        onItemAppend={handleAppend}\n        onItemPrepend={handlePrepend}\n        onValueCreate={createProtoArrayValue}\n        readOnly={readOnly}\n        schemaType={schemaType}\n        value={value}\n      />\n    </Stack>\n  )\n}\n","import {type ArrayOfObjectsInputProps} from '../../../types'\nimport {GridArrayInput} from './Grid/GridArrayInput'\nimport {ListArrayInput} from './List/ListArrayInput'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function ArrayOfObjectsInput(props: ArrayOfObjectsInputProps) {\n  const isGrid = props.schemaType.options?.layout === 'grid'\n  return isGrid ? <GridArrayInput {...props} /> : <ListArrayInput {...props} />\n}\n","import {type ArraySchemaType, isKeyedObject} from '@sanity/types'\nimport {Box, Card, Checkbox, Flex, Grid} from '@sanity/ui'\nimport {resolveTypeName} from '@sanity/util/content'\nimport {useCallback, useMemo} from 'react'\n\nimport {ChangeIndicator} from '../../../../changeIndicators'\nimport {IncompatibleItemType} from '../../../members/array/IncompatibleItemType'\nimport {set, unset} from '../../../patch'\nimport {type ArrayOfObjectsInputProps} from '../../../types'\n\nfunction isEqual(item: any, otherItem: any): boolean {\n  if (item === otherItem) {\n    return true\n  }\n  if (typeof item !== typeof otherItem) {\n    return false\n  }\n  if (typeof item !== 'object' && !Array.isArray(item)) {\n    return item === otherItem\n  }\n  if (item._key && item._key === otherItem._key) {\n    return true\n  }\n  if (Array.isArray(item)) {\n    if (!item.length !== otherItem.length) {\n      return false\n    }\n    return item.every((it, i) => isEqual(item[i], otherItem[i]))\n  }\n  const keys = Object.keys(item)\n  const otherKeys = Object.keys(item)\n  if (keys.length !== otherKeys.length) {\n    return false\n  }\n  return keys.every((keyName) => isEqual(item[keyName], otherItem[keyName]))\n}\n\nfunction inArray(array: unknown[], candidate: unknown) {\n  return array ? array.some((item) => isEqual(item, candidate)) : false\n}\n\nfunction getMemberTypeOfItem(schemaType: ArraySchemaType, item: unknown) {\n  return schemaType.of.find((memberType) => memberType.name === resolveTypeName(item))\n}\n\nconst EMPTY_ARRAY: unknown[] = []\n\ninterface ObjectOption {\n  _key?: string\n}\n\n/**\n * @hidden\n * Array of predefined object options input\n * Note: this input can handle only object values\n *\n *\n * @hidden\n * @beta\n */\nexport function ArrayOfObjectOptionsInput(props: ArrayOfObjectsInputProps) {\n  const {\n    renderPreview,\n    schemaType,\n    onChange,\n    onPathFocus,\n    value = [],\n    readOnly,\n    elementProps,\n    path,\n    changed,\n  } = props\n\n  const options = useMemo(\n    () =>\n      ((schemaType.options?.list || EMPTY_ARRAY) as ObjectOption[]).map((option, index) =>\n        isKeyedObject(option) ? option : {...option, _key: `auto-generated-${index}`},\n      ),\n    [schemaType.options?.list],\n  )\n\n  const handleChange = useCallback(\n    (isChecked: boolean, changedOption: ObjectOption) => {\n      if (!isChecked && isKeyedObject(changedOption)) {\n        // This is an optimization that only works if list items are _keyed\n        onChange(unset([{_key: changedOption._key}]))\n        return\n      }\n\n      const nextValue = options.filter((option) =>\n        isEqual(changedOption, option) ? isChecked : inArray(value, option),\n      )\n\n      onChange(nextValue.length > 0 ? set(nextValue) : unset())\n    },\n    [onChange, options, value],\n  )\n\n  const handleItemFocus = useCallback(\n    (index: number) => {\n      onPathFocus([index])\n    },\n    [onPathFocus],\n  )\n\n  const isGrid = schemaType.options?.layout === 'grid'\n\n  return (\n    <ChangeIndicator path={path} isChanged={changed} hasFocus={false}>\n      <Grid\n        gap={2}\n        columns={isGrid ? Math.min(options.length, 4) : 1}\n        tabIndex={0}\n        {...elementProps}\n      >\n        {options.map((option, index) => {\n          const optionType = getMemberTypeOfItem(schemaType, option)\n          const checked = inArray(value, option)\n          const disabled = !optionType\n\n          return (\n            <Flex key={index} align=\"center\" as=\"label\" muted={disabled}>\n              <Checkbox\n                disabled={disabled}\n                checked={checked}\n                onChange={(e) => handleChange(e.currentTarget.checked, option)}\n                onFocus={() => handleItemFocus(index)}\n                readOnly={readOnly}\n              />\n              <Box flex={1} marginLeft={2}>\n                {optionType ? (\n                  renderPreview({\n                    layout: 'default',\n                    schemaType: optionType,\n                    value: option,\n                  })\n                ) : (\n                  <Card tone=\"caution\" radius={2}>\n                    <IncompatibleItemType value={option} onFocus={() => handleItemFocus(index)} />\n                  </Card>\n                )}\n              </Box>\n            </Flex>\n          )\n        })}\n      </Grid>\n    </ChangeIndicator>\n  )\n}\n","import {type ArraySchemaType} from '@sanity/types'\nimport {Box, Checkbox, Flex, Grid, Text} from '@sanity/ui'\nimport {resolveTypeName} from '@sanity/util/content'\nimport {startCase} from 'lodash'\nimport {useMemo} from 'react'\n\nimport {ChangeIndicator} from '../../../../changeIndicators'\nimport {set, unset} from '../../../patch'\nimport {type ArrayOfPrimitivesInputProps} from '../../../types'\nimport {IncompatibleItemType} from '../ArrayOfObjectsInput/List/IncompatibleItemType'\n\nfunction isPrimitiveOption(option: unknown): option is NormalizedPrimitiveOption {\n  return Boolean(option && typeof option === 'object' && 'title' in option && 'value' in option)\n}\n\nfunction normalizeOptions(options: unknown[]) {\n  return options.map((option) => {\n    if (isPrimitiveOption(option)) {\n      return {\n        title: option.title || startCase(String(option.value)),\n        value: option.value,\n      }\n    }\n    return {\n      title: startCase(String(option)),\n      value: option as string | number | boolean,\n    }\n  })\n}\n\ninterface NormalizedPrimitiveOption {\n  title: string\n  value: string | boolean | number\n}\n\nfunction getMemberTypeOfItem(schemaType: ArraySchemaType, option: NormalizedPrimitiveOption) {\n  return schemaType.of.find((memberType) => memberType.name === resolveTypeName(option.value))\n}\n\n/**\n * Array of predefined primitive options input\n * Note: this input can only handle primitive values\n *\n *\n * @hidden\n * @beta\n */\nexport function ArrayOfPrimitiveOptionsInput(props: ArrayOfPrimitivesInputProps) {\n  const {\n    schemaType,\n    onChange,\n    value = [],\n    readOnly,\n    path,\n    changed,\n    onIndexFocus,\n    elementProps,\n  } = props\n\n  const options = useMemo(\n    () => normalizeOptions(schemaType.options?.list || []),\n    [schemaType.options?.list],\n  )\n\n  const handleChange = (isChecked: boolean, changedValue: string | boolean | number) => {\n    const nextValue = options\n      .map((option) => option.value)\n      .filter((optionValue) =>\n        // note: sparse arrays are not supported here, so multiple options with same value will all be checked\n        optionValue === changedValue ? isChecked : value.includes(optionValue),\n      )\n\n    onChange(nextValue.length > 0 ? set(nextValue) : unset())\n  }\n\n  const isGrid = schemaType.options?.layout === 'grid'\n\n  return (\n    <ChangeIndicator path={path} isChanged={changed} hasFocus={false}>\n      <Grid gap={2} columns={isGrid ? Math.min(options.length, 4) : 1} {...elementProps}>\n        {options.map((option, index) => {\n          const optionType = getMemberTypeOfItem(schemaType, option)\n          const checked = value.includes(option.value)\n\n          const disabled = !optionType\n\n          return (\n            <Flex key={index} align=\"center\" as=\"label\" muted={disabled}>\n              <Checkbox\n                disabled={disabled}\n                checked={checked}\n                onChange={(e) => handleChange(e.currentTarget.checked, option.value)}\n                onFocus={() => onIndexFocus(index)}\n                readOnly={readOnly}\n              />\n\n              <Box padding={2}>\n                <Text>{option.title}</Text>\n              </Box>\n\n              {!optionType && (\n                <IncompatibleItemType value={option} onFocus={() => onIndexFocus(index)} />\n              )}\n            </Flex>\n          )\n        })}\n      </Grid>\n    </ChangeIndicator>\n  )\n}\n","import {\n  type ArrayOfObjectsInputProps,\n  type ArrayOfPrimitivesInputProps,\n  isArrayOfObjectsInputProps,\n} from '../../../types'\nimport {ArrayOfObjectOptionsInput} from './ArrayOfObjectOptionsInput'\nimport {ArrayOfPrimitiveOptionsInput} from './ArrayOfPrimitiveOptionsInput'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function ArrayOfOptionsInput(props: ArrayOfObjectsInputProps | ArrayOfPrimitivesInputProps) {\n  return isArrayOfObjectsInputProps(props) ? (\n    <ArrayOfObjectOptionsInput {...props} />\n  ) : (\n    <ArrayOfPrimitiveOptionsInput {...props} />\n  )\n}\n","/* eslint-disable react/no-unused-prop-types */\nimport {AddIcon} from '@sanity/icons'\nimport {type ArraySchemaType, isReferenceSchemaType} from '@sanity/types'\nimport {Grid, Menu} from '@sanity/ui'\nimport {useCallback, useId, useMemo} from 'react'\n\nimport {Button, MenuButton, MenuItem, Tooltip} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {type ArrayInputFunctionsProps} from '../../../types'\n\n/**\n * @hidden\n * @beta */\nexport function ArrayOfPrimitivesFunctions<\n  MemberType extends string | boolean | number,\n  SchemaType extends ArraySchemaType,\n>(props: ArrayInputFunctionsProps<MemberType, SchemaType>) {\n  const {schemaType, readOnly, children, onValueCreate, onItemAppend} = props\n  const menuButtonId = useId()\n  const {t} = useTranslation()\n\n  const insertItem = useCallback(\n    (itemType: any) => {\n      onItemAppend(onValueCreate(itemType))\n    },\n    [onValueCreate, onItemAppend],\n  )\n\n  const handleAddBtnClick = useCallback(() => {\n    insertItem(schemaType.of[0])\n  }, [schemaType, insertItem])\n\n  const popoverProps = useMemo(() => ({constrainSize: true, portal: true}), [])\n\n  // If we have more than a single type candidate, we render a menu, so the button might show\n  // \"Add item...\" instead of simply \"Add item\", to indicate that further choices are available.\n  const addItemI18nKey =\n    schemaType.of.length > 1\n      ? 'inputs.array.action.add-item-select-type'\n      : 'inputs.array.action.add-item'\n\n  if (readOnly) {\n    return (\n      <Tooltip portal content={t('inputs.array.read-only-label')}>\n        <Grid>\n          <Button icon={AddIcon} mode=\"ghost\" disabled size=\"large\" text={t(addItemI18nKey)} />\n        </Grid>\n      </Tooltip>\n    )\n  }\n\n  return (\n    <Grid gap={1} style={{gridTemplateColumns: 'repeat(auto-fit, minmax(100px, 1fr))'}}>\n      {schemaType.of.length === 1 ? (\n        <Button\n          icon={AddIcon}\n          mode=\"ghost\"\n          onClick={handleAddBtnClick}\n          size=\"large\"\n          text={t(addItemI18nKey)}\n        />\n      ) : (\n        <MenuButton\n          button={<Button icon={AddIcon} mode=\"ghost\" size=\"large\" text={t(addItemI18nKey)} />}\n          id={menuButtonId || ''}\n          menu={\n            <Menu>\n              {schemaType.of.map((memberDef, i) => {\n                // Use reference icon if reference is to one schemaType only\n                const referenceIcon =\n                  isReferenceSchemaType(memberDef) &&\n                  (memberDef.to || []).length === 1 &&\n                  memberDef.to[0].icon\n\n                const icon = memberDef.icon || memberDef.type?.icon || referenceIcon\n                return (\n                  <MenuItem\n                    key={i}\n                    text={memberDef.title || memberDef.type?.name}\n                    onClick={() => insertItem(memberDef)}\n                    icon={icon}\n                  />\n                )\n              })}\n            </Menu>\n          }\n          popover={popoverProps}\n        />\n      )}\n\n      {children}\n    </Grid>\n  )\n}\n","import {CopyIcon as DuplicateIcon, TrashIcon} from '@sanity/icons'\nimport {type SchemaType} from '@sanity/types'\nimport {Box, Flex, Menu} from '@sanity/ui'\nimport {type ForwardedRef, forwardRef, useCallback, useMemo} from 'react'\n\nimport {MenuButton, MenuItem} from '../../../../../ui-components'\nimport {ContextMenuButton} from '../../../../components/contextMenuButton'\nimport {useTranslation} from '../../../../i18n'\nimport {FieldPresence} from '../../../../presence'\nimport {FormFieldValidationStatus} from '../../../components/formField'\nimport {type PrimitiveItemProps} from '../../../types/itemProps'\nimport {InsertMenu} from '../ArrayOfObjectsInput/InsertMenu'\nimport {RowLayout} from '../layouts/RowLayout'\nimport {getEmptyValue} from './getEmptyValue'\n\nexport type DefaultItemProps = Omit<PrimitiveItemProps, 'renderDefault'> & {\n  insertableTypes: SchemaType[]\n  sortable: boolean\n}\n\nconst MENU_BUTTON_POPOVER_PROPS = {portal: true, tone: 'default'} as const\n\nexport const ItemRow = forwardRef(function ItemRow(\n  props: DefaultItemProps,\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const {\n    sortable,\n    value,\n    insertableTypes,\n    onInsert,\n    onRemove,\n    readOnly,\n    inputId,\n    validation,\n    children,\n    presence,\n    schemaType,\n  } = props\n\n  const hasError = validation.filter((item) => item.level === 'error').length > 0\n  const hasWarning = validation.filter((item) => item.level === 'warning').length > 0\n\n  const handleInsert = useCallback(\n    (pos: 'before' | 'after', insertType: SchemaType) => {\n      onInsert({position: pos, items: [getEmptyValue(insertType)]})\n    },\n    [onInsert],\n  )\n\n  const handleDuplicate = useCallback(() => {\n    if (value) onInsert({position: 'after', items: [value]})\n  }, [onInsert, value])\n\n  const tone = useMemo(() => {\n    if (hasError) {\n      return 'critical'\n    }\n    if (hasWarning) {\n      return 'caution'\n    }\n\n    return undefined\n  }, [hasError, hasWarning])\n\n  const {t} = useTranslation()\n\n  const menu = (\n    <MenuButton\n      button={<ContextMenuButton paddingY={3} />}\n      id={`${inputId}-menuButton`}\n      popover={MENU_BUTTON_POPOVER_PROPS}\n      menu={\n        <Menu>\n          <MenuItem\n            text={t('inputs.array.action.remove')}\n            tone=\"critical\"\n            icon={TrashIcon}\n            onClick={onRemove}\n          />\n          <MenuItem\n            text={t('inputs.array.action.duplicate')}\n            icon={DuplicateIcon}\n            onClick={handleDuplicate}\n          />\n          <InsertMenu types={insertableTypes} onInsert={handleInsert} />\n        </Menu>\n      }\n    />\n  )\n\n  return (\n    <RowLayout\n      tone={tone}\n      menu={!readOnly && menu}\n      dragHandle={!readOnly && sortable}\n      presence={presence.length === 0 ? null : <FieldPresence presence={presence} maxAvatars={1} />}\n      validation={\n        validation.length > 0 ? (\n          <Box paddingX={1} paddingY={3}>\n            <FormFieldValidationStatus validation={validation} />\n          </Box>\n        ) : null\n      }\n    >\n      <Flex align={schemaType ? 'flex-end' : 'center'} ref={ref}>\n        <Flex align=\"flex-end\" flex={1}>\n          <Box flex={1} marginRight={2}>\n            {children}\n          </Box>\n        </Flex>\n      </Flex>\n    </RowLayout>\n  )\n})\n","import {type ArraySchemaType} from '@sanity/types'\nimport {Card, Text} from '@sanity/ui'\n\nimport {useTranslation} from '../../../../i18n'\n\n/**\n * Shows a placeholder for an empty array of primitives.\n *\n * @internal\n */\nexport function NoItemsPlaceholder({schemaType}: {schemaType: ArraySchemaType}) {\n  const {t} = useTranslation()\n  return (\n    <Card padding={3} border radius={2}>\n      <Text align=\"center\" muted size={1}>\n        {schemaType.placeholder || t('inputs.array.no-items-label')}\n      </Text>\n    </Card>\n  )\n}\n","/**\n * Find the index of the nearest element with the same value. Starts at given index and looks incrementally in either direction for the searchElement\n * It's *NOT* inclusive: If the element matches the element at the startIdx, startIdx will be returned\n * It prefers matches in the first half. If there's a tie it will pick the first element that comes before\n */\nexport function nearestIndexOf<T>(array: T[], startIdx: number, searchElement: T) {\n  return nearestIndex(array, startIdx, (element) => element === searchElement)\n}\n\n/**\n * Find the index of the nearest element matching the predicate. Starts at given index and looks incrementally in either direction\n * It's *NOT* inclusive: If the predicate matches the element at the startIdx, startIdx will be returned\n * It prefers matches in the first half. If there's a tie it will pick the first element that comes before\n */\nexport function nearestIndex<T>(\n  array: T[],\n  startIdx: number,\n  predicate: (element: T, index: number) => boolean,\n) {\n  let lowerIdx = startIdx - 1\n  let upperIdx = startIdx\n  const len = array.length\n  while (lowerIdx > -1 || upperIdx < len) {\n    const upper = array[upperIdx]\n    if (upperIdx < len && predicate(upper, upperIdx)) {\n      return upperIdx\n    }\n    const lower = array[lowerIdx]\n    if (lowerIdx > -1 && predicate(lower, lowerIdx)) {\n      return lowerIdx\n    }\n    lowerIdx--\n    upperIdx++\n  }\n  return -1\n}\n","import {Card, Stack} from '@sanity/ui'\nimport {get} from 'lodash'\nimport {PureComponent} from 'react'\n\nimport {ChangeIndicator} from '../../../../changeIndicators'\nimport {ArrayOfPrimitivesItem} from '../../../members'\nimport {type ArrayOfPrimitivesInputProps} from '../../../types'\nimport {type PrimitiveItemProps} from '../../../types/itemProps'\nimport {ErrorItem} from '../ArrayOfObjectsInput/List/ErrorItem'\nimport {Item, List} from '../common/list'\nimport {UploadTargetCard} from '../common/UploadTargetCard'\nimport {ArrayOfPrimitivesFunctions} from './ArrayOfPrimitivesFunctions'\nimport {getEmptyValue} from './getEmptyValue'\nimport {ItemRow} from './ItemRow'\nimport {NoItemsPlaceholder} from './NoItemsPlaceholder'\nimport {type PrimitiveValue} from './types'\nimport {nearestIndexOf} from './utils/nearestIndex'\n\ninterface State {\n  disableTransition: boolean\n}\n\n/**\n * Note: this should be a class component until React provides support for a hook version of getSnapshotBeforeUpdate\n *\n * @hidden\n * @beta\n */\nexport class ArrayOfPrimitivesInput extends PureComponent<ArrayOfPrimitivesInputProps, State> {\n  _element: HTMLElement | null = null\n\n  constructor(props: ArrayOfPrimitivesInputProps) {\n    super(props)\n\n    this.state = {\n      disableTransition: false,\n    }\n  }\n\n  handleAppend = (itemValue: PrimitiveValue) => {\n    const {value = [], onIndexFocus, onItemAppend} = this.props\n    onItemAppend(itemValue)\n    onIndexFocus(value.length)\n  }\n\n  handlePrepend = (itemValue: PrimitiveValue) => {\n    const {onIndexFocus, value = [], onItemPrepend} = this.props\n    onItemPrepend(itemValue)\n    onIndexFocus(value.length)\n  }\n\n  handleSortEnd = (event: {fromIndex: number; toIndex: number}) => {\n    const {onIndexFocus, onMoveItem, value} = this.props\n\n    if (value) onMoveItem(event)\n    onIndexFocus(event.toIndex)\n  }\n\n  // Enable transition when the user starts dragging an item\n  handleItemMoveStart = () => {\n    this.setState({disableTransition: false})\n  }\n\n  // Disable transition when the user stops dragging an item.\n  // Note: there's an issue with the transition of items when the sorting is completed, so we disable the\n  // transition effect when the user stops dragging.\n  handleItemMoveEnd = () => {\n    this.setState({disableTransition: true})\n  }\n\n  focus() {\n    if (this._element) {\n      this._element.focus()\n    }\n  }\n\n  getSnapshotBeforeUpdate(prevProps: ArrayOfPrimitivesInputProps) {\n    const {focusPath: prevFocusPath = [], value: prevValue = []} = prevProps\n    const {focusPath = [], value = []} = this.props\n    if (prevFocusPath[0] === focusPath[0] && prevValue.length !== value.length) {\n      // the length of the array has changed, but the focus path has not, which may happen if someone inserts or removes a new item above the one currently in focus\n      const focusIndex = focusPath[0]\n\n      const selection = window.getSelection()\n      if (!(selection?.focusNode instanceof HTMLElement)) {\n        return null\n      }\n\n      const input = selection.focusNode?.querySelector('input,textarea')\n\n      return input instanceof HTMLInputElement\n        ? {\n            prevFocusedIndex: focusIndex,\n            restoreSelection: {\n              text: selection.toString(),\n              start: input.selectionStart,\n              end: input.selectionEnd,\n              value: input.value,\n            },\n          }\n        : {}\n    }\n\n    return null\n  }\n\n  componentDidUpdate(\n    prevProps: ArrayOfPrimitivesInputProps,\n    prevState: Record<string, unknown>,\n    snapshot?: {restoreSelection: {start: number; end: number}; prevFocusedIndex: number},\n  ) {\n    const {onIndexFocus} = this.props\n    if (snapshot?.restoreSelection && prevProps.value) {\n      const prevFocusedValue = prevProps.value[snapshot.prevFocusedIndex]\n\n      const nearestIndex = nearestIndexOf(\n        this.props.value || [],\n        snapshot.prevFocusedIndex,\n        prevFocusedValue,\n      )\n\n      if (nearestIndex === -1) {\n        return\n      }\n      const newInput = this._element?.querySelector(\n        `[data-item-index='${nearestIndex}'] input,textarea`,\n      )\n\n      if (newInput instanceof HTMLInputElement) {\n        newInput.focus()\n        try {\n          newInput.setSelectionRange(snapshot.restoreSelection.start, snapshot.restoreSelection.end)\n        } catch {\n          // not all inputs supports selection (e.g. <input type=\"number\" />)\n        }\n      }\n      onIndexFocus(nearestIndex)\n    }\n  }\n\n  renderArrayItem = (props: Omit<PrimitiveItemProps, 'renderDefault'>) => {\n    const {schemaType} = this.props\n    const sortable = schemaType.options?.sortable !== false\n    return <ItemRow {...props} sortable={sortable} insertableTypes={schemaType.of} />\n  }\n\n  render() {\n    const {\n      schemaType,\n      members,\n      readOnly,\n      renderInput,\n      onUpload,\n      onItemRemove,\n      resolveUploader,\n      elementProps,\n      arrayFunctions: ArrayFunctions = ArrayOfPrimitivesFunctions,\n      changed,\n    } = this.props\n\n    const isSortable = !readOnly && get(schemaType, 'options.sortable') !== false\n\n    // Note: we need this in order to generate new id's when items are moved around in the list\n    // without it, dndkit will restore focus on the original index of the dragged item\n    const membersWithSortIds = members.map((member) => ({\n      id: `${member.key}-${member.kind === 'item' ? member.item.value : 'error'}`,\n      member: member,\n    }))\n\n    return (\n      <Stack space={2} data-testid=\"array-primitives-input\">\n        <UploadTargetCard\n          types={schemaType.of}\n          resolveUploader={resolveUploader}\n          onUpload={onUpload}\n          {...elementProps}\n          tabIndex={0}\n        >\n          <Stack space={1}>\n            {membersWithSortIds.length === 0 ? (\n              <NoItemsPlaceholder schemaType={schemaType} />\n            ) : (\n              <Card padding={1} border>\n                <List\n                  onItemMove={this.handleSortEnd}\n                  onItemMoveStart={this.handleItemMoveStart}\n                  onItemMoveEnd={this.handleItemMoveEnd}\n                  items={membersWithSortIds.map((m) => m.id)}\n                  sortable={isSortable}\n                  gap={1}\n                >\n                  {membersWithSortIds.map(({member, id}, index) => {\n                    return (\n                      <Item\n                        key={member.key}\n                        id={id}\n                        sortable={isSortable}\n                        disableTransition={this.state.disableTransition}\n                      >\n                        {member.kind === 'item' && (\n                          <ChangeIndicator\n                            path={member.item.path}\n                            isChanged={changed}\n                            hasFocus={false}\n                          >\n                            <ArrayOfPrimitivesItem\n                              member={member}\n                              renderItem={this.renderArrayItem}\n                              renderInput={renderInput}\n                            />\n                          </ChangeIndicator>\n                        )}\n                        {member.kind === 'error' && (\n                          <ErrorItem\n                            sortable={isSortable}\n                            member={member}\n                            onRemove={() => onItemRemove(index)}\n                          />\n                        )}\n                      </Item>\n                    )\n                  })}\n                </List>\n              </Card>\n            )}\n          </Stack>\n        </UploadTargetCard>\n\n        <ArrayFunctions\n          onChange={this.props.onChange}\n          onItemAppend={this.handleAppend}\n          onItemPrepend={this.handlePrepend}\n          onValueCreate={getEmptyValue}\n          readOnly={this.props.readOnly}\n          schemaType={this.props.schemaType}\n          value={this.props.value}\n        />\n      </Stack>\n    )\n  }\n}\n","import {useMemo} from 'react'\n\nimport {\n  type ArrayOfObjectsInputProps,\n  type ArrayOfPrimitivesInputProps,\n  isArrayOfPrimitivesInputProps,\n} from '../../types'\nimport {ArrayOfObjectsInput} from './ArrayOfObjectsInput'\nimport {ArrayOfOptionsInput} from './ArrayOfOptionsInput'\nimport {ArrayOfPrimitivesInput} from './ArrayOfPrimitivesInput'\n\n/**\n * Universal array input that will introspect its schemaType and delegate to the right implementation\n * Useful as a fallback/last resort input for an array type\n *\n *\n * @hidden\n * @beta\n */\nexport function UniversalArrayInput(props: ArrayOfObjectsInputProps | ArrayOfPrimitivesInputProps) {\n  const isArrayOfOptionsInput = useMemo(\n    () => Array.isArray(props.schemaType.options?.list),\n    [props.schemaType],\n  )\n\n  if (isArrayOfOptionsInput) {\n    return <ArrayOfOptionsInput {...props} />\n  }\n\n  return isArrayOfPrimitivesInputProps(props) ? (\n    <ArrayOfPrimitivesInput {...props} />\n  ) : (\n    <ArrayOfObjectsInput {...props} />\n  )\n}\n","import {Box, Card, type CardTone, Checkbox, Flex, Switch} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {FormFieldHeaderText} from '../components/formField/FormFieldHeaderText'\nimport {FormFieldStatus} from '../components/formField/FormFieldStatus'\nimport {type BooleanInputProps} from '../types'\n\nconst Root = styled(Card)`\n  line-height: 1;\n`\n\nconst CenterAlignedBox = styled(Box)`\n  align-self: center;\n`\n\nconst ZeroLineHeightBox = styled(Box)`\n  line-height: 0;\n`\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function BooleanInput(props: BooleanInputProps) {\n  const {id, value, schemaType, readOnly, elementProps, validation} = props\n  const layout = schemaType.options?.layout || 'switch'\n\n  const indeterminate = typeof value !== 'boolean'\n  const checked = value || false\n\n  const LayoutSpecificInput = layout === 'checkbox' ? Checkbox : Switch\n\n  const tone: CardTone | undefined = readOnly ? 'transparent' : undefined\n\n  return (\n    <Root border data-testid=\"boolean-input\" radius={2} tone={tone}>\n      <Flex>\n        <ZeroLineHeightBox padding={3}>\n          <LayoutSpecificInput\n            label={schemaType.title}\n            {...elementProps}\n            checked={checked}\n            disabled={readOnly}\n            indeterminate={indeterminate}\n            style={{margin: -4}}\n          />\n        </ZeroLineHeightBox>\n        <Box flex={1} paddingY={2}>\n          <FormFieldHeaderText\n            deprecated={schemaType.deprecated}\n            description={schemaType.description}\n            inputId={id}\n            validation={validation}\n            title={schemaType.title}\n          />\n        </Box>\n        <CenterAlignedBox paddingX={3} paddingY={1}>\n          <FormFieldStatus maxAvatars={1} position=\"top\">\n            {/*<FieldPresence maxAvatars={1} presence={presence} />*/}\n          </FormFieldStatus>\n        </CenterAlignedBox>\n      </Flex>\n    </Root>\n  )\n}\n","import {CalendarIcon} from '@sanity/icons'\nimport {Box, Flex, LayerProvider, useClickOutside, useForwardedRef} from '@sanity/ui'\nimport {\n  type FocusEvent,\n  type ForwardedRef,\n  forwardRef,\n  type KeyboardEvent,\n  useCallback,\n  useRef,\n  useState,\n} from 'react'\nimport FocusLock from 'react-focus-lock'\n\nimport {Button, Popover} from '../../../../../ui-components'\nimport {type CalendarLabels} from './calendar/types'\nimport {DatePicker} from './DatePicker'\nimport {LazyTextInput} from './LazyTextInput'\n\nexport interface DateTimeInputProps {\n  customValidity?: string\n  id?: string\n  inputValue?: string\n  onChange: (date: Date | null) => void\n  onInputChange?: (event: FocusEvent<HTMLInputElement>) => void\n  placeholder?: string\n  readOnly?: boolean\n  selectTime?: boolean\n  timeStep?: number\n  value?: Date\n  calendarLabels: CalendarLabels\n}\n\nexport const DateTimeInput = forwardRef(function DateTimeInput(\n  props: DateTimeInputProps,\n  ref: ForwardedRef<HTMLInputElement>,\n) {\n  const {\n    value,\n    inputValue,\n    onInputChange,\n    onChange,\n    selectTime,\n    timeStep,\n    calendarLabels,\n    ...rest\n  } = props\n  const [popoverRef, setPopoverRef] = useState<HTMLElement | null>(null)\n  const forwardedRef = useForwardedRef(ref)\n  const buttonRef = useRef(null)\n\n  const [isPickerOpen, setPickerOpen] = useState(false)\n\n  useClickOutside(() => setPickerOpen(false), [popoverRef])\n\n  const handleDeactivation = useCallback(() => {\n    forwardedRef.current?.focus()\n    forwardedRef.current?.select()\n  }, [forwardedRef])\n\n  const handleKeyUp = useCallback((e: KeyboardEvent<HTMLDivElement>) => {\n    if (e.key === 'Escape') {\n      setPickerOpen(false)\n    }\n  }, [])\n\n  const handleClick = useCallback(() => setPickerOpen(true), [])\n\n  const suffix = (\n    <Flex style={{padding: '5px'}}>\n      <Button\n        ref={buttonRef}\n        icon={CalendarIcon}\n        mode=\"bleed\"\n        onClick={handleClick}\n        style={{display: 'block'}}\n        data-testid=\"select-date-button\"\n        tooltipProps={{content: 'Select date'}}\n      />\n    </Flex>\n  )\n\n  return (\n    <LazyTextInput\n      ref={forwardedRef}\n      {...rest}\n      value={inputValue}\n      onChange={onInputChange}\n      suffix={\n        isPickerOpen ? (\n          // Note: we're conditionally inserting the popover here due to an\n          // issue with popovers rendering incorrectly on subsequent renders\n          // see https://github.com/sanity-io/design/issues/519\n          <LayerProvider zOffset={1000}>\n            <Popover\n              constrainSize\n              data-testid=\"date-input-dialog\"\n              portal\n              content={\n                <Box overflow=\"auto\">\n                  <FocusLock onDeactivation={handleDeactivation}>\n                    <DatePicker\n                      calendarLabels={calendarLabels}\n                      selectTime={selectTime}\n                      timeStep={timeStep}\n                      onKeyUp={handleKeyUp}\n                      value={value}\n                      onChange={onChange}\n                    />\n                  </FocusLock>\n                </Box>\n              }\n              open\n              placement=\"bottom\"\n              ref={setPopoverRef}\n            >\n              {suffix}\n            </Popover>\n          </LayerProvider>\n        ) : (\n          suffix\n        )\n      }\n    />\n  )\n})\n","/* eslint-disable no-nested-ternary */\n\nimport {TextInput, useForwardedRef} from '@sanity/ui'\nimport {\n  type FocusEvent,\n  type ForwardedRef,\n  forwardRef,\n  useCallback,\n  useEffect,\n  useState,\n} from 'react'\n\nimport {useTranslation} from '../../../i18n/hooks/useTranslation'\nimport {type CalendarLabels} from './base/calendar/types'\nimport {DateTimeInput} from './base/DateTimeInput'\nimport {type ParseResult} from './types'\n\nexport interface CommonDateTimeInputProps {\n  id: string\n  deserialize: (value: string) => ParseResult\n  formatInputValue: (date: Date) => string\n  onChange: (nextDate: string | null) => void\n  parseInputValue: (inputValue: string) => ParseResult\n  placeholder?: string\n  readOnly: boolean | undefined\n  selectTime?: boolean\n  serialize: (date: Date) => string\n  timeStep?: number\n  value: string | undefined\n  calendarLabels: CalendarLabels\n}\n\nconst DEFAULT_PLACEHOLDER_TIME = new Date()\n\nexport const CommonDateTimeInput = forwardRef(function CommonDateTimeInput(\n  props: CommonDateTimeInputProps,\n  ref: ForwardedRef<HTMLInputElement>,\n) {\n  const {\n    id,\n    deserialize,\n    formatInputValue,\n    onChange,\n    parseInputValue,\n    placeholder,\n    readOnly,\n    selectTime,\n    serialize,\n    timeStep,\n    value,\n    ...restProps\n  } = props\n\n  const [localValue, setLocalValue] = useState<string | null>(null)\n\n  const {t} = useTranslation()\n\n  useEffect(() => {\n    setLocalValue(null)\n  }, [value])\n\n  const handleDatePickerInputChange = useCallback(\n    (event: FocusEvent<HTMLInputElement>) => {\n      const nextInputValue = event.currentTarget.value\n      const result = nextInputValue === '' ? null : parseInputValue(nextInputValue)\n\n      if (result === null) {\n        onChange(null)\n\n        // If the field value is undefined and we are clearing the invalid value\n        // the above useEffect won't trigger, so we do some extra clean up here\n        if (typeof value === 'undefined' && localValue) {\n          setLocalValue(null)\n        }\n      } else if (result.isValid) {\n        onChange(serialize(result.date))\n      } else {\n        setLocalValue(nextInputValue)\n      }\n    },\n    [parseInputValue, onChange, value, localValue, serialize],\n  )\n\n  const handleDatePickerChange = useCallback(\n    (nextDate: Date | null) => {\n      onChange(nextDate ? serialize(nextDate) : null)\n    },\n    [serialize, onChange],\n  )\n\n  const forwardedRef = useForwardedRef(ref)\n\n  const parseResult = localValue ? parseInputValue(localValue) : value ? deserialize(value) : null\n\n  const inputValue = localValue\n    ? localValue\n    : parseResult?.isValid\n      ? formatInputValue(parseResult.date)\n      : value\n\n  return readOnly ? (\n    <TextInput value={inputValue} readOnly />\n  ) : (\n    <DateTimeInput\n      {...restProps}\n      calendarLabels={props.calendarLabels}\n      id={id}\n      selectTime={selectTime}\n      timeStep={timeStep}\n      placeholder={\n        placeholder ||\n        t('inputs.datetime.placeholder', {\n          example: formatInputValue(DEFAULT_PLACEHOLDER_TIME),\n        })\n      }\n      ref={forwardedRef}\n      value={parseResult?.date}\n      inputValue={inputValue || ''}\n      readOnly={Boolean(readOnly)}\n      onInputChange={handleDatePickerInputChange}\n      onChange={handleDatePickerChange}\n      customValidity={parseResult?.error}\n    />\n  )\n})\n","import {DEFAULT_DATE_FORMAT, format, parse} from '@sanity/util/legacyDateFormat'\nimport {useCallback, useMemo} from 'react'\n\nimport {useTranslation} from '../../../i18n'\nimport {set, unset} from '../../patch'\nimport {type StringInputProps} from '../../types'\nimport {type CalendarLabels} from './base/calendar/types'\nimport {CommonDateTimeInput} from './CommonDateTimeInput'\nimport {getCalendarLabels} from './utils'\n\n/**\n * @hidden\n * @beta */\nexport type DateInputProps = StringInputProps\n\nconst deserialize = (value: string) => parse(value, DEFAULT_DATE_FORMAT)\nconst serialize = (date: Date) => format(date, DEFAULT_DATE_FORMAT)\n\n/**\n * @hidden\n * @beta */\nexport function DateInput(props: DateInputProps) {\n  const {readOnly, onChange, schemaType, elementProps, value} = props\n  const dateFormat = schemaType.options?.dateFormat || DEFAULT_DATE_FORMAT\n  const {t} = useTranslation()\n\n  const handleChange = useCallback(\n    (nextDate: string | null) => {\n      onChange(nextDate === null ? unset() : set(nextDate))\n    },\n    [onChange],\n  )\n\n  const formatInputValue = useCallback((date: Date) => format(date, dateFormat), [dateFormat])\n\n  const parseInputValue = useCallback(\n    (inputValue: string) => parse(inputValue, dateFormat),\n    [dateFormat],\n  )\n\n  const calendarLabels: CalendarLabels = useMemo(() => getCalendarLabels(t), [t])\n  return (\n    <CommonDateTimeInput\n      {...elementProps}\n      deserialize={deserialize}\n      formatInputValue={formatInputValue}\n      onChange={handleChange}\n      parseInputValue={parseInputValue}\n      placeholder={schemaType.placeholder}\n      calendarLabels={calendarLabels}\n      readOnly={readOnly}\n      selectTime={false}\n      serialize={serialize}\n      value={value}\n    />\n  )\n}\n","import {\n  DEFAULT_DATE_FORMAT,\n  DEFAULT_TIME_FORMAT,\n  format,\n  parse,\n} from '@sanity/util/legacyDateFormat'\nimport {getMinutes, parseISO, setMinutes} from 'date-fns'\nimport {useCallback, useMemo} from 'react'\n\nimport {useTranslation} from '../../../i18n'\nimport {set, unset} from '../../patch'\nimport {type StringInputProps} from '../../types'\nimport {type CalendarLabels} from './base/calendar/types'\nimport {CommonDateTimeInput} from './CommonDateTimeInput'\nimport {type ParseResult} from './types'\nimport {getCalendarLabels, isValidDate} from './utils'\n\ninterface ParsedOptions {\n  dateFormat: string\n  timeFormat: string\n  timeStep: number\n}\n\ninterface SchemaOptions {\n  dateFormat?: string\n  timeFormat?: string\n  timeStep?: number\n}\n\n/**\n * @hidden\n * @beta */\nexport type DateTimeInputProps = StringInputProps\n\nfunction parseOptions(options: SchemaOptions = {}): ParsedOptions {\n  return {\n    dateFormat: options.dateFormat || DEFAULT_DATE_FORMAT,\n    timeFormat: options.timeFormat || DEFAULT_TIME_FORMAT,\n    timeStep: ('timeStep' in options && Number(options.timeStep)) || 1,\n  }\n}\n\nfunction serialize(date: Date) {\n  return date.toISOString()\n}\nfunction deserialize(isoString: string): ParseResult {\n  const deserialized = new Date(isoString)\n  if (isValidDate(deserialized)) {\n    return {isValid: true, date: deserialized}\n  }\n  return {isValid: false, error: `Invalid date value: \"${isoString}\"`}\n}\n\n// enforceTimeStep takes a dateString and datetime schema options and enforces the time\n// to be within the configured timeStep\nfunction enforceTimeStep(dateString: string, timeStep: number) {\n  if (!timeStep || timeStep === 1) {\n    return dateString\n  }\n\n  const date = parseISO(dateString)\n  const minutes = getMinutes(date)\n  const leftOver = minutes % timeStep\n  if (leftOver !== 0) {\n    return serialize(setMinutes(date, minutes - leftOver))\n  }\n\n  return serialize(date)\n}\n\n/**\n * @hidden\n * @beta */\nexport function DateTimeInput(props: DateTimeInputProps) {\n  const {onChange, schemaType, value, elementProps} = props\n\n  const {dateFormat, timeFormat, timeStep} = parseOptions(schemaType.options)\n  const {t} = useTranslation()\n\n  const handleChange = useCallback(\n    (nextDate: string | null) => {\n      let date = nextDate\n      if (date !== null && timeStep > 1) {\n        date = enforceTimeStep(date, timeStep)\n      }\n\n      onChange(date === null ? unset() : set(date))\n    },\n    [onChange, timeStep],\n  )\n\n  const formatInputValue = useCallback(\n    (date: Date) => format(date, `${dateFormat} ${timeFormat}`),\n    [dateFormat, timeFormat],\n  )\n\n  const parseInputValue = useCallback(\n    (inputValue: string) => parse(inputValue, `${dateFormat} ${timeFormat}`),\n    [dateFormat, timeFormat],\n  )\n  const calendarLabels: CalendarLabels = useMemo(() => getCalendarLabels(t), [t])\n  return (\n    <CommonDateTimeInput\n      {...elementProps}\n      calendarLabels={calendarLabels}\n      onChange={handleChange}\n      deserialize={deserialize}\n      formatInputValue={formatInputValue}\n      parseInputValue={parseInputValue}\n      placeholder={schemaType.placeholder}\n      selectTime\n      serialize={serialize}\n      timeStep={timeStep}\n      value={value}\n    />\n  )\n}\n","import {TextInput} from '@sanity/ui'\n\nimport {type StringInputProps} from '../types'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport type EmailInputProps = StringInputProps\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function EmailInput(props: EmailInputProps) {\n  const {validationError, elementProps} = props\n  return (\n    <TextInput {...elementProps} type=\"email\" inputMode=\"email\" customValidity={validationError} />\n  )\n}\n","import {type Rule, type RuleSpec, type SchemaType, type SchemaValidationValue} from '@sanity/types'\n\nconst normalizeRules = (\n  validation: SchemaValidationValue | undefined,\n  type?: SchemaType,\n): Rule[] => {\n  if (typeof validation === 'function') {\n    throw new Error(\n      `Schema type \"${\n        type?.name || '<not-found>'\n      }\"'s \\`validation\\` was not run though \\`inferFromSchema\\``,\n    )\n  }\n  if (!validation) return []\n  if (Array.isArray(validation)) return validation as Rule[]\n  return [validation]\n}\n\n/**\n * Finds the first matching validation rule spec from a Rule class instance.\n *\n * @internal\n * Note: This accesses private fields of the rule.\n */\nexport function getValidationRule<RuleFlag extends RuleSpec['flag']>(\n  type: SchemaType | undefined,\n  ruleName: RuleFlag,\n): Extract<RuleSpec, {flag: RuleFlag}> | null {\n  for (const rule of normalizeRules(type?.validation, type)) {\n    for (const ruleSpec of rule._rules) {\n      if (ruleSpec.flag === ruleName) {\n        return ruleSpec as Extract<RuleSpec, {flag: RuleFlag}>\n      }\n    }\n  }\n\n  return null\n}\n","import {TextInput} from '@sanity/ui'\n\nimport {type NumberInputProps} from '../types'\nimport {getValidationRule} from '../utils/getValidationRule'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function NumberInput(props: NumberInputProps) {\n  const {schemaType, validationError, elementProps} = props\n\n  // Show numpad on mobile if only positive numbers is preferred\n  const minRule = getValidationRule(schemaType, 'min')\n  const integerRule = getValidationRule(schemaType, 'integer')\n  const precisionRule = getValidationRule(schemaType, 'precision')\n  const onlyPositiveNumber = typeof minRule?.constraint === 'number' && minRule?.constraint >= 0\n  const onlyIntegers = integerRule || precisionRule?.constraint === 0\n\n  // eslint-disable-next-line no-nested-ternary\n  const inputMode = onlyPositiveNumber ? (onlyIntegers ? 'numeric' : 'decimal') : 'text'\n\n  return (\n    <TextInput\n      {...elementProps}\n      type=\"number\"\n      step=\"any\"\n      inputMode={inputMode}\n      customValidity={validationError}\n      placeholder={schemaType.placeholder}\n      pattern={onlyPositiveNumber ? '[d]*' : undefined}\n      max={Number.MAX_SAFE_INTEGER}\n      min={Number.MIN_SAFE_INTEGER}\n      data-testid=\"number-input\"\n    />\n  )\n}\n","import {type ComponentType, forwardRef, type Ref, useCallback} from 'react'\n\nimport {Tab} from '../../../../../ui-components'\n\ninterface GroupType {\n  'aria-controls': string\n  autoFocus?: boolean\n  disabled?: boolean\n  icon?: ComponentType\n  name: string\n  onClick?: (value: string) => void\n  selected: boolean\n  title: string\n}\n\nexport const GroupTab = forwardRef(function GroupTab(\n  props: GroupType,\n  ref: Ref<HTMLButtonElement>,\n) {\n  // Separate props for resolving conditional hidden groups\n  const {onClick} = props\n\n  // Here goes the content of our component\n  const handleClick = useCallback(() => {\n    onClick?.(props.name)\n  }, [props.name, onClick])\n\n  return (\n    <Tab\n      data-testid={`group-tab-${props.name}`}\n      id={`${props.name}-tab`}\n      label={props.title}\n      ref={ref}\n      {...props}\n      onClick={handleClick}\n    />\n  )\n})\n\nexport const GroupOption = (props: Omit<GroupType, 'onClick' | 'autoFocus'>) => {\n  const {name, title, ...rest} = props\n  const {selected} = props\n\n  return (\n    <option\n      title={title}\n      value={name}\n      id={`${name}-tab`}\n      aria-controls={rest['aria-controls']}\n      data-testid={`group-select-${name}`}\n      aria-selected={selected ? 'true' : 'false'}\n    >\n      {title || name}\n    </option>\n  )\n}\n","import {ElementQuery, Select, TabList} from '@sanity/ui'\nimport {type ChangeEvent, memo, useCallback} from 'react'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../../i18n'\nimport {type FormFieldGroup} from '../../../store'\nimport {GroupOption, GroupTab} from './GroupTab'\n\ninterface FieldGroupTabsProps {\n  disabled?: boolean\n  groups: FormFieldGroup[]\n  inputId?: string\n  onClick?: (name: string) => void\n  shouldAutoFocus?: boolean\n}\n\nconst Root = styled(ElementQuery)`\n  /* Hide on small screens */\n  &[data-eq-max~='0'] [data-ui='TabList'] {\n    display: none;\n  }\n\n  /* Hide on medium to large screens */\n  [data-ui='Select'] {\n    display: none;\n  }\n\n  /* Show on small screens */\n  &[data-eq-max~='0'] [data-ui='Select'] {\n    display: block;\n  }\n`\n\n/* For medium to large screens, use TabList and Tab from Sanity UI  */\nconst GroupTabs = ({\n  inputId,\n  groups,\n  onClick,\n  shouldAutoFocus = true,\n  disabled,\n}: FieldGroupTabsProps) => (\n  <TabList space={2} data-testid=\"field-group-tabs\">\n    {groups.map((group) => {\n      return (\n        <GroupTab\n          aria-controls={`${inputId}-field-group-fields`}\n          autoFocus={shouldAutoFocus && group.selected}\n          disabled={disabled || group.disabled}\n          icon={group?.icon}\n          key={`${inputId}-${group.name}-tab`}\n          name={group.name}\n          onClick={onClick}\n          selected={Boolean(group.selected)}\n          title={group.title || group.name}\n        />\n      )\n    })}\n  </TabList>\n)\n\n/* For small screens, use Select from Sanity UI  */\nconst GroupSelect = ({\n  disabled,\n  groups,\n  inputId,\n  onSelect,\n  shouldAutoFocus = true,\n}: Omit<FieldGroupTabsProps, 'onClick'> & {onSelect: (name: string) => void}) => {\n  const handleSelect = useCallback(\n    (event: ChangeEvent<HTMLSelectElement>) => {\n      onSelect(event.currentTarget.value)\n    },\n    [onSelect],\n  )\n\n  const {t} = useTranslation()\n\n  return (\n    <Select\n      aria-label={t('inputs.object.field-group-tabs.aria-label')}\n      autoFocus={shouldAutoFocus}\n      data-testid=\"field-group-select\"\n      disabled={disabled}\n      fontSize={2}\n      muted\n      onChange={handleSelect}\n      value={groups.find((g) => g.selected)?.name}\n    >\n      {groups.map((group) => {\n        // Separate hidden in order to resolve it to a boolean type\n        return (\n          <GroupOption\n            aria-controls={`${inputId}-field-group-fields`}\n            disabled={group.disabled}\n            key={`${inputId}-${group.name}-tab`}\n            name={group.name}\n            selected={Boolean(group.selected)}\n            title={group.title || group.name}\n          />\n        )\n      })}\n    </Select>\n  )\n}\n\nexport const FieldGroupTabs = memo(function FieldGroupTabs({\n  disabled = false,\n  onClick,\n  ...props\n}: FieldGroupTabsProps) {\n  const handleClick = useCallback(\n    (groupName: any) => {\n      onClick?.(groupName)\n    },\n    [onClick],\n  )\n\n  return (\n    <Root data-testid=\"field-group-root\">\n      <GroupTabs {...props} disabled={disabled} onClick={handleClick} />\n      <GroupSelect {...props} disabled={disabled} onSelect={handleClick} />\n    </Root>\n  )\n})\n","import {Card, Grid} from '@sanity/ui'\nimport styled from 'styled-components'\n\n// The negative margins here removes the extra space between the tabs and the fields when inside of a grid\nexport const FieldGroupTabsWrapper = styled(Card)<{$level?: number}>`\n  margin-bottom: ${({$level, theme}) => ($level === 0 ? 0 : theme.sanity.space[5] * -1)}px;\n  padding-bottom: ${({$level, theme}) =>\n    $level === 0 ? theme.sanity.space[4] : theme.sanity.space[4]}px;\n`\nexport const AlignedBottomGrid = styled(Grid)`\n  align-items: flex-end;\n`\n","import {TrashIcon} from '@sanity/icons'\nimport {Box, Card, Code, Stack, Text} from '@sanity/ui'\nimport {useCallback} from 'react'\n\nimport {Button} from '../../../../ui-components'\nimport {isDev} from '../../../environment'\nimport {Translate, useTranslation} from '../../../i18n'\nimport {Alert} from '../../components/Alert'\nimport {Details} from '../../components/Details'\nimport {type FormPatch, type PatchEvent, unset} from '../../patch'\n\ntype Props = {\n  fieldNames: string[]\n  value?: Record<string, unknown>\n  onChange(patch: FormPatch): void\n  onChange(patch: FormPatch[]): void\n  onChange(patch: PatchEvent): void\n  readOnly?: boolean\n}\n\nexport function UnknownFields(props: Props) {\n  const {fieldNames, onChange, readOnly, value} = props\n  const fieldsLen = fieldNames.length\n\n  const handleUnsetClick = useCallback(\n    (fieldName: any) => {\n      onChange(unset([fieldName]))\n    },\n    [onChange],\n  )\n\n  const {t} = useTranslation()\n\n  return (\n    <Alert\n      status=\"warning\"\n      title={<>{t('inputs.object.unknown-fields.warning.title', {count: fieldsLen})}</>}\n    >\n      <Text as=\"p\" muted size={1}>\n        <>{t('inputs.object.unknown-fields.warning.description', {count: fieldsLen})}</>\n      </Text>\n\n      <Details\n        marginTop={4}\n        open={isDev}\n        title={t('inputs.object.unknown-fields.warning.details.title')}\n      >\n        <Box marginBottom={3}>\n          <Text as=\"p\" muted size={1}>\n            <>{t('inputs.object.unknown-fields.warning.details.description', {count: fieldsLen})}</>\n          </Text>\n        </Box>\n\n        <Stack as=\"ul\" space={3}>\n          {fieldNames.map((fieldName) => {\n            return (\n              <UnknownField\n                key={fieldName}\n                fieldName={fieldName}\n                onUnsetClick={handleUnsetClick}\n                readOnly={readOnly}\n                value={value?.[fieldName]}\n              />\n            )\n          })}\n        </Stack>\n      </Details>\n    </Alert>\n  )\n}\n\nfunction UnknownField({\n  fieldName,\n  onUnsetClick,\n  readOnly,\n  value,\n}: {\n  fieldName: string\n  onUnsetClick: (fieldName: string) => void\n  readOnly?: boolean\n  value: unknown\n}) {\n  const handleUnsetClick = useCallback(() => {\n    onUnsetClick(fieldName)\n  }, [fieldName, onUnsetClick])\n\n  const {t} = useTranslation()\n\n  return (\n    <Card as=\"li\" overflow=\"hidden\" radius={2} shadow={1} tone=\"caution\">\n      <Card padding={3} shadow={1} tone=\"inherit\">\n        <Code size={1}>{fieldName}</Code>\n      </Card>\n\n      <Box overflow=\"auto\" padding={3}>\n        <Code language=\"json\" size={1}>\n          {JSON.stringify(value, null, 2)}\n        </Code>\n      </Box>\n\n      {readOnly && (\n        <Box padding={3}>\n          <Text as=\"p\" muted size={1}>\n            <Translate t={t} i18nKey=\"inputs.object.unknown-fields.read-only.description\" />\n          </Text>\n        </Box>\n      )}\n\n      {!readOnly && (\n        <Card padding={3} shadow={1} tone=\"inherit\">\n          <Button\n            icon={TrashIcon}\n            mode=\"ghost\"\n            onClick={handleUnsetClick}\n            size=\"large\"\n            tone=\"critical\"\n            text={t('inputs.object.unknown-fields.remove-field-button.text')}\n          />\n        </Card>\n      )}\n    </Card>\n  )\n}\n","import {Stack} from '@sanity/ui'\nimport {Fragment, memo, useCallback, useMemo} from 'react'\n\nimport {ObjectInputMembers} from '../../members'\nimport {type ObjectInputProps} from '../../types'\nimport {FieldGroupTabs} from './fieldGroups/FieldGroupTabs'\nimport {AlignedBottomGrid, FieldGroupTabsWrapper} from './ObjectInput.styled'\nimport {UnknownFields} from './UnknownFields'\n\n/**\n * @hidden\n * @beta */\nexport const ObjectInput = memo(function ObjectInput(props: ObjectInputProps) {\n  const {\n    schemaType,\n    groups,\n    members,\n    onChange,\n    renderAnnotation,\n    renderBlock,\n    renderInlineBlock,\n    renderInput,\n    renderField,\n    renderItem,\n    renderPreview,\n    level,\n    value,\n    id,\n    onFieldGroupSelect,\n  } = props\n\n  const {columns} = schemaType.options || {}\n\n  const renderedUnknownFields = useMemo(() => {\n    if (!schemaType.fields) {\n      return null\n    }\n\n    const knownFieldNames = schemaType.fields.map((field) => field.name)\n    const unknownFields = Object.keys(value || {}).filter(\n      (key) => !key.startsWith('_') && !knownFieldNames.includes(key),\n    )\n\n    if (unknownFields.length === 0) {\n      return null\n    }\n\n    return <UnknownFields fieldNames={unknownFields} value={value} onChange={onChange} />\n  }, [onChange, schemaType.fields, value])\n\n  const selectedGroup = useMemo(() => groups.find(({selected}) => selected), [groups])\n\n  const renderObjectMembers = useCallback(\n    () => (\n      <ObjectInputMembers\n        members={members}\n        renderAnnotation={renderAnnotation}\n        renderBlock={renderBlock}\n        renderField={renderField}\n        renderInlineBlock={renderInlineBlock}\n        renderInput={renderInput}\n        renderItem={renderItem}\n        renderPreview={renderPreview}\n      />\n    ),\n    [\n      members,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n    ],\n  )\n\n  if (members.length === 0) {\n    return null\n  }\n  return (\n    <Stack space={6}>\n      {groups.length > 0 ? (\n        <FieldGroupTabsWrapper $level={level} data-testid=\"field-groups\">\n          <FieldGroupTabs\n            groups={groups}\n            inputId={id}\n            onClick={onFieldGroupSelect}\n            // autofocus is taken care of either by focusPath or focusFirstDescendant in the parent component\n            shouldAutoFocus={false}\n          />\n        </FieldGroupTabsWrapper>\n      ) : null}\n\n      <Fragment\n        // A key is used here to create a unique element for each selected group. This ensures\n        // virtualized descendants are recalculated when the selected group changes.\n        key={selectedGroup?.name}\n      >\n        {columns ? (\n          <AlignedBottomGrid columns={columns} gap={4} marginTop={1}>\n            {renderObjectMembers()}\n          </AlignedBottomGrid>\n        ) : (\n          renderObjectMembers()\n        )}\n      </Fragment>\n\n      {renderedUnknownFields}\n    </Stack>\n  )\n})\n","import {type Path} from '@sanity/types'\nimport {createContext, type ReactNode, useCallback, useContext, useRef} from 'react'\n\nimport {getValueAtPath} from '../../field'\nimport {type FormDocumentValue} from '../types'\n\n/**\n * @internal\n * @hidden\n */\nexport type GetFormValueContextValue = (path: Path) => unknown\n\nconst GetFormValueContext = createContext<GetFormValueContextValue | null>(null)\n\n/**\n *\n * @internal\n * @hidden\n */\nexport function GetFormValueProvider(props: {\n  value: FormDocumentValue | undefined\n  children: ReactNode\n}) {\n  const valueRef = useRef(props.value)\n  valueRef.current = props.value\n\n  const getValue = useCallback((path: Path) => getValueAtPath(valueRef.current, path), [valueRef])\n  return (\n    <GetFormValueContext.Provider value={getValue}>{props.children}</GetFormValueContext.Provider>\n  )\n}\n\n/**\n * React hook that returns a function that can be called to look up the value from the current document at the given path.\n * The returned function is stable and never changes identity.\n * NOTE: This hook will *not* trigger a re-render when the value of the document changes, which makes it less suitable for use in render functions.\n * The main use case for using this is to look up values at the current document during an event handler\n * @public\n *\n * @returns A function that can be called to look up the value from the current document at the given path.\n *\n * @example Using the `useGetFormValue` hook\n * ```ts\n * function MyComponent() {\n *    // get value of field 'name' in object 'author'\n *    const getFormValue = useGetFormValue()\n *\n *    const handleClick = useCallback(() => {\n *      console.log(getFormValue(['author', 'name']))\n *    }, [getFormValue])\n * }\n * ```\n */\n\nexport function useGetFormValue() {\n  const ctx = useContext(GetFormValueContext)\n  if (!ctx) {\n    throw new Error('useFormValue must be used within a FormValueProvider')\n  }\n  return ctx\n}\n","import {type SlugSchemaType, type SlugSourceContext} from '@sanity/types'\nimport speakingurl from 'speakingurl'\n\nimport {type FIXME} from '../../../../FIXME'\n\n// Fallback slugify function if not defined in field options\nconst defaultSlugify = (value: FIXME, type: SlugSchemaType): string => {\n  const maxLength = type.options?.maxLength\n  const slugifyOpts = {truncate: typeof maxLength === 'number' ? maxLength : 200, symbols: true}\n  return value ? speakingurl(value, slugifyOpts) : ''\n}\n\n// eslint-disable-next-line require-await\nexport async function slugify(\n  sourceValue: FIXME,\n  type: SlugSchemaType,\n  context: SlugSourceContext,\n): Promise<string> {\n  if (!sourceValue) {\n    return sourceValue\n  }\n\n  const slugifier = type.options?.slugify || defaultSlugify\n  return slugifier(sourceValue, type, context)\n}\n","import {type DependencyList, useCallback, useRef, useState} from 'react'\n\nexport type AsyncCompleteState<T> = {\n  status: 'complete'\n  result: T\n}\nexport type AsyncPendingState = {\n  status: 'pending'\n}\nexport type AsyncErrorState = {\n  status: 'error'\n  error: Error\n}\n\nexport type AsyncState<T> = AsyncPendingState | AsyncCompleteState<T> | AsyncErrorState\n\n/**\n * Takes an async function and returns a [AsyncState<value>, callback] pair.\n * Whenever the callback is invoked, a new AsyncState is returned.\n * If the returned callback is called again before the previous callback has settled, the resolution of the previous one will be ignored, thus preventing race conditions.\n * @param fn - an async function that returns a value\n * @param dependencies - list of dependencies that will return a new [value, callback] pair\n */\nexport function useAsync<T, U>(\n  fn: (arg: U) => Promise<T>,\n  dependencies: DependencyList,\n): [null | AsyncState<T>, (arg: U) => void] {\n  const [state, setState] = useState<AsyncState<T> | null>(null)\n\n  const lastId = useRef(0)\n\n  const wrappedCallback = useCallback(\n    (arg: U) => {\n      const asyncId = ++lastId.current\n      setState({status: 'pending'})\n\n      Promise.resolve()\n        .then(() => fn(arg))\n        .then(\n          (res) => {\n            if (asyncId === lastId.current) {\n              setState({status: 'complete', result: res})\n            }\n          },\n          (err) => {\n            if (asyncId === lastId.current) {\n              setState({status: 'error', error: err})\n            }\n          },\n        )\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- this is under control, and enforced by our linter setup\n    [fn, ...dependencies],\n  )\n\n  return [state, wrappedCallback]\n}\n","import {type SlugSourceContext} from '@sanity/types'\nimport {useMemo} from 'react'\n\nimport {useCurrentUser, useDataset, useProjectId, useSchema, useSource} from '../../../../../core'\n\n/**\n * @internal\n */\nexport type SlugContext = Omit<SlugSourceContext, 'parent' | 'parentPath'>\n\n/**\n * @internal\n */\nexport function useSlugContext(): SlugContext {\n  const {getClient} = useSource()\n  const schema = useSchema()\n  const currentUser = useCurrentUser()\n  const projectId = useProjectId()\n  const dataset = useDataset()\n\n  return useMemo(() => {\n    return {\n      projectId,\n      dataset,\n      getClient,\n      schema,\n      currentUser,\n    }\n  }, [getClient, schema, currentUser, projectId, dataset])\n}\n","import {\n  type Path,\n  type SanityDocument,\n  type SlugParent,\n  type SlugSchemaType,\n  type SlugSourceContext,\n  type SlugSourceFn,\n  type SlugValue,\n} from '@sanity/types'\nimport {Box, Card, Flex, Stack, TextInput} from '@sanity/ui'\nimport * as PathUtils from '@sanity/util/paths'\nimport {type FormEvent, useCallback, useMemo} from 'react'\n\nimport {Button} from '../../../../ui-components'\nimport {useTranslation} from '../../../i18n'\nimport {useGetFormValue} from '../../contexts/GetFormValue'\nimport {PatchEvent, set, setIfMissing, unset} from '../../patch'\nimport {type ObjectInputProps} from '../../types'\nimport {slugify} from './utils/slugify'\nimport {useAsync} from './utils/useAsync'\nimport {type SlugContext, useSlugContext} from './utils/useSlugContext'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport type SlugInputProps = ObjectInputProps<SlugValue, SlugSchemaType>\n\nfunction getSlugSourceContext(\n  valuePath: Path,\n  document: SanityDocument,\n  context: SlugContext,\n): SlugSourceContext {\n  const parentPath = valuePath.slice(0, -1)\n  const parent = PathUtils.get(document, parentPath) as SlugParent\n  return {parentPath, parent, ...context}\n}\n\n// eslint-disable-next-line require-await\nasync function getNewFromSource(\n  source: string | Path | SlugSourceFn,\n  document: SanityDocument,\n  context: SlugSourceContext,\n): Promise<string | undefined> {\n  return typeof source === 'function'\n    ? source(document, context)\n    : (PathUtils.get(document, source) as string | undefined)\n}\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function SlugInput(props: SlugInputProps) {\n  const getFormValue = useGetFormValue()\n  const {path, value, schemaType, validation, onChange, readOnly, elementProps} = props\n  const sourceField = schemaType.options?.source\n  const errors = useMemo(() => validation.filter((item) => item.level === 'error'), [validation])\n\n  const slugContext = useSlugContext()\n\n  const {t} = useTranslation()\n\n  const updateSlug = useCallback(\n    (nextSlug: string) => {\n      if (!nextSlug) {\n        onChange(PatchEvent.from(unset([])))\n        return\n      }\n\n      onChange(\n        PatchEvent.from([setIfMissing({_type: schemaType.name}), set(nextSlug, ['current'])]),\n      )\n    },\n    [onChange, schemaType.name],\n  )\n\n  const [generateState, handleGenerateSlug] = useAsync(() => {\n    if (!sourceField) {\n      return Promise.reject(\n        new Error(t('inputs.slug.error.missing-source', {schemaType: schemaType.name})),\n      )\n    }\n\n    const doc = (getFormValue([]) as SanityDocument) || ({_type: schemaType.name} as SanityDocument)\n    const sourceContext = getSlugSourceContext(path, doc, slugContext)\n    return getNewFromSource(sourceField, doc, sourceContext)\n      .then((newFromSource) => slugify(newFromSource || '', schemaType, sourceContext))\n      .then((newSlug) => updateSlug(newSlug))\n  }, [sourceField, getFormValue, schemaType, path, slugContext, updateSlug, t])\n\n  const isUpdating = generateState?.status === 'pending'\n\n  const handleChange = useCallback(\n    (event: FormEvent<HTMLInputElement>) => updateSlug(event.currentTarget.value),\n    [updateSlug],\n  )\n\n  return (\n    <Stack space={3}>\n      <Flex gap={1}>\n        <Box flex={1}>\n          <TextInput\n            customValidity={errors.length > 0 ? errors[0].message : ''}\n            disabled={isUpdating}\n            onChange={handleChange}\n            value={value?.current || ''}\n            readOnly={readOnly}\n            {...elementProps}\n          />\n\n          {generateState?.status === 'error' && (\n            <Card padding={2} tone=\"critical\">\n              {generateState.error.message}\n            </Card>\n          )}\n        </Box>\n        {sourceField && (\n          <Button\n            mode=\"ghost\"\n            type=\"button\"\n            disabled={readOnly || isUpdating}\n            onClick={handleGenerateSlug}\n            size=\"large\"\n            text={\n              generateState?.status === 'pending'\n                ? t('inputs.slug.action.generating')\n                : t('inputs.slug.action.generate')\n            }\n          />\n        )}\n      </Flex>\n    </Stack>\n  )\n}\n","import {TextInput} from '@sanity/ui'\n\nimport {type StringInputProps} from '../types'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function StringInput(props: StringInputProps) {\n  const {validationError, elementProps} = props\n  return <TextInput {...elementProps} customValidity={validationError} data-testid=\"string-input\" />\n}\n","import {type TextSchemaType} from '@sanity/types'\nimport {TextArea} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {type StringInputProps} from '../types'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport type TextInputProps = StringInputProps<TextSchemaType>\n\nconst StyledTextArea = styled(TextArea)`\n  &[data-as='textarea'] {\n    resize: vertical;\n  }\n`\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function TextInput(props: TextInputProps) {\n  const {schemaType, validationError, value, elementProps} = props\n\n  return (\n    <StyledTextArea\n      customValidity={validationError}\n      value={value || ''}\n      placeholder={schemaType.placeholder}\n      rows={typeof schemaType.rows === 'number' ? schemaType.rows : 10}\n      {...elementProps}\n    />\n  )\n}\n","import {TextInput} from '@sanity/ui'\n\nimport {type StringInputProps} from '../types'\nimport {getValidationRule} from '../utils/getValidationRule'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport type UrlInputProps = StringInputProps\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function UrlInput(props: UrlInputProps) {\n  const {schemaType, validationError, elementProps} = props\n\n  const uriRule = getValidationRule(schemaType, 'uri')\n  const inputType = uriRule?.constraint?.options?.allowRelative ? 'text' : 'url'\n  return (\n    <TextInput\n      type={inputType}\n      inputMode=\"url\"\n      customValidity={validationError}\n      {...elementProps}\n    />\n  )\n}\n","import {ResetIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {type CrossDatasetReferenceValue} from '@sanity/types'\nimport {Box, Card, Flex, Stack, Text} from '@sanity/ui'\nimport {useMemo} from 'react'\n\nimport {Button} from '../../../../ui-components'\nimport {Translate, useTranslation} from '../../../i18n'\n\ntype Props = {\n  value?: CrossDatasetReferenceValue\n  onClearValue?: () => void\n}\n\nexport function DisabledFeatureWarning({value, onClearValue}: Props) {\n  const hasRef = useMemo(() => Boolean(value?._ref), [value?._ref])\n  const {t} = useTranslation()\n\n  const description = (\n    <Translate\n      t={t}\n      i18nKey=\"inputs.reference.cross-dataset.feature-disabled-description\"\n      components={{\n        DocumentationLink: ({children}) => (\n          <a\n            href=\"https://www.sanity.io/docs/cross-dataset-references\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            {children}\n          </a>\n        ),\n      }}\n    />\n  )\n\n  return (\n    <Card\n      tone=\"caution\"\n      padding={4}\n      border\n      radius={2}\n      data-testid=\"alert-cross-dataset-reference-feature-disabled\"\n    >\n      <Flex gap={4} marginBottom={hasRef ? 4 : undefined}>\n        <Box>\n          <Text size={1}>\n            <WarningOutlineIcon />\n          </Text>\n        </Box>\n        <Stack space={3}>\n          <Text as=\"h2\" size={1} weight=\"medium\">\n            {t('inputs.reference.cross-dataset.feature-unavailable-title')}\n          </Text>\n          {hasRef && (\n            <Stack space={3}>\n              <Text as=\"p\" size={1}>\n                {description}\n              </Text>\n              <Text as=\"p\" size={1}>\n                {t('inputs.reference.cross-dataset.feature-disabled-actions')}\n              </Text>\n            </Stack>\n          )}\n          {!hasRef && (\n            <Text as=\"p\" size={1}>\n              {description}\n            </Text>\n          )}\n        </Stack>\n      </Flex>\n      {onClearValue && hasRef && (\n        <Button\n          icon={ResetIcon}\n          mode=\"ghost\"\n          onClick={onClearValue}\n          text={t('inputs.reference.action.clear')}\n          width=\"fill\"\n        />\n      )}\n    </Card>\n  )\n}\n","import {Flex} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const StyledPreviewFlex = styled(Flex)`\n  /* this is a hack to avoid layout jumps while previews are loading\n  or the message is not tall enough to fill the card\n  there's probably better ways of solving this */\n  min-height: 36px;\n`\n","import {isImageSource} from '@sanity/asset-utils'\nimport {AccessDeniedIcon, HelpCircleIcon, LaunchIcon} from '@sanity/icons'\nimport imageUrlBuilder from '@sanity/image-url'\nimport {type CrossDatasetType, type PreviewValue} from '@sanity/types'\nimport {Badge, Box, Flex, Inline, Text} from '@sanity/ui'\nimport {createElement, isValidElement as ReactIsValidElement, useMemo} from 'react'\n\nimport {Tooltip} from '../../../../ui-components'\nimport {DefaultPreview, type PreviewMediaDimensions, TextWithTone} from '../../../components'\nimport {type FIXME} from '../../../FIXME'\nimport {useTranslation} from '../../../i18n'\nimport {type DocumentAvailability} from '../../../preview'\nimport {StyledPreviewFlex} from './CrossDatasetReferencePreview.styled'\n\n/**\n * Used to preview a referenced type\n * Takes the reference type as props\n *\n * @internal\n */\nexport function CrossDatasetReferencePreview(props: {\n  availability: DocumentAvailability | null\n  id: string\n  hasStudioUrl?: boolean\n  showStudioUrlIcon?: boolean\n  preview: {published: PreviewValue | undefined}\n  dataset: string\n  projectId: string\n  refType?: CrossDatasetType\n  showTypeLabel: boolean\n}) {\n  const {\n    refType,\n    showStudioUrlIcon,\n    hasStudioUrl,\n    showTypeLabel,\n    availability,\n    preview,\n    id,\n    dataset,\n    projectId,\n  } = props\n  const notFound = availability?.reason === 'NOT_FOUND'\n  const insufficientPermissions = availability?.reason === 'PERMISSION_DENIED'\n\n  const previewMedia = preview.published?.media\n  const {t} = useTranslation()\n\n  const media = useMemo(() => {\n    if (previewMedia) {\n      const isValidImageAsset =\n        typeof (previewMedia as FIXME)?.asset !== 'undefined' && isImageSource(previewMedia)\n      const isValidElement = ReactIsValidElement(previewMedia)\n\n      if (!isValidImageAsset && !isValidElement) {\n        return null\n      }\n\n      return function MediaPreview({dimensions}: {dimensions: PreviewMediaDimensions}) {\n        return isValidElement ? (\n          previewMedia\n        ) : (\n          <img\n            src={imageUrlBuilder({dataset, projectId})\n              .image(previewMedia as FIXME)\n              .withOptions(dimensions)\n              .url()}\n            alt={t('inputs.reference.image-preview-alt-text')}\n            referrerPolicy=\"strict-origin-when-cross-origin\"\n          />\n        )\n      }\n    }\n    return refType?.icon ? createElement(refType.icon) : null\n  }, [previewMedia, dataset, projectId, refType?.icon, t])\n\n  return (\n    <StyledPreviewFlex align=\"center\" justify=\"center\" flex={1} data-testid=\"preview\">\n      {availability?.available ? (\n        <Box flex={1}>\n          <DefaultPreview\n            title={preview.published?.title}\n            subtitle={preview.published?.subtitle}\n            media={media || false}\n          />\n        </Box>\n      ) : (\n        <Box flex={1}>\n          <Flex align=\"center\">\n            <Box flex={1} paddingY={2}>\n              <Text muted>{t('inputs.reference.error.document-unavailable-title')}</Text>\n            </Box>\n          </Flex>\n        </Box>\n      )}\n\n      <Box paddingLeft={3}>\n        <Inline space={4}>\n          {refType && showTypeLabel && (\n            <Badge mode=\"outline\">{refType.title || refType.type}</Badge>\n          )}\n\n          {(insufficientPermissions || notFound) && (\n            <Box>\n              <Tooltip\n                portal\n                content={t(\n                  notFound\n                    ? 'inputs.reference.referenced-document-does-not-exist'\n                    : 'inputs.reference.referenced-document-insufficient-permissions',\n                  {documentId: id},\n                )}\n              >\n                <TextWithTone tone=\"default\">\n                  {insufficientPermissions ? <AccessDeniedIcon /> : <HelpCircleIcon />}\n                </TextWithTone>\n              </Tooltip>\n            </Box>\n          )}\n\n          {!(notFound || insufficientPermissions) && showStudioUrlIcon && (\n            <Box>\n              <Tooltip\n                portal\n                content={t(\n                  hasStudioUrl\n                    ? 'inputs.reference.document-opens-in-new-tab'\n                    : 'input.reference.document-cannot-be-opened.failed-to-resolve-url',\n                )}\n              >\n                <TextWithTone size={1} tone=\"default\" muted={!hasStudioUrl}>\n                  <LaunchIcon />\n                </TextWithTone>\n              </Tooltip>\n            </Box>\n          )}\n        </Inline>\n      </Box>\n    </StyledPreviewFlex>\n  )\n}\n","import {useCallback, useMemo, useState} from 'react'\nimport {useMemoObservable} from 'react-rx'\nimport {type Observable, of} from 'rxjs'\nimport {catchError, map, startWith} from 'rxjs/operators'\n\nimport {usePrevious} from '../../hooks/usePrevious'\nimport {type CrossDatasetReferenceInfo} from './types'\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nconst noop = () => {}\n\nconst INITIAL_LOADING_STATE: Loadable<CrossDatasetReferenceInfo> = {\n  isLoading: true,\n  result: undefined,\n  error: undefined,\n  retry: noop,\n}\n\nconst EMPTY_STATE: Loadable<any> = {\n  isLoading: false,\n  result: undefined,\n  error: undefined,\n  retry: noop,\n}\n\nexport type Loadable<T> =\n  | {isLoading: true; result: undefined; error: undefined; retry: () => void}\n  | {isLoading: false; result: T; error: undefined; retry: () => void}\n  | {isLoading: false; result: undefined; error: Error; retry: () => void}\n\nexport type GetReferenceInfoFn = (doc: {\n  _id: string\n  _type?: string\n}) => Observable<CrossDatasetReferenceInfo>\n\nexport function useReferenceInfo(\n  doc: {_id: string; _type?: string},\n  getReferenceInfo: GetReferenceInfoFn,\n): Loadable<CrossDatasetReferenceInfo> {\n  const [retryAttempt, setRetryAttempt] = useState<number>(0)\n\n  const retry = useCallback(() => {\n    setRetryAttempt((current) => current + 1)\n  }, [])\n\n  const docInfo = useMemo(() => ({_id: doc._id, _type: doc._type}), [doc._id, doc._type])\n  const referenceInfo = useMemoObservable(\n    () =>\n      docInfo._id\n        ? getReferenceInfo(docInfo).pipe(\n            map(\n              (result) =>\n                ({\n                  isLoading: false,\n                  result,\n                  error: undefined,\n                  retry,\n                  retryAttempt,\n                }) as const,\n            ),\n            startWith(INITIAL_LOADING_STATE),\n            catchError((err: Error) => {\n              console.error(err)\n              return of({\n                isLoading: false,\n                result: undefined,\n                error: err,\n                retry,\n                retryAttempt,\n              } as const)\n            }),\n          )\n        : of(EMPTY_STATE),\n    [docInfo, getReferenceInfo, retry, retryAttempt],\n    INITIAL_LOADING_STATE,\n  )\n\n  // workaround for a \"bug\" with useMemoObservable that doesn't\n  // return the initial value upon resubscription\n  const previousId = usePrevious(doc._id, doc._id)\n  if (doc._id && previousId !== doc._id) {\n    return INITIAL_LOADING_STATE\n  }\n  return referenceInfo\n}\n","import {useClient} from '../../../../hooks'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../studioClient'\n\nexport function useProjectId(): string {\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n\n  return client.config().projectId as string\n}\n","import {type CrossDatasetReferenceSchemaType} from '@sanity/types'\nimport {Stack, Text, TextSkeleton} from '@sanity/ui'\nimport {type Observable} from 'rxjs'\n\nimport {useTranslation} from '../../../i18n'\nimport {Alert} from '../../components/Alert'\nimport {CrossDatasetReferencePreview} from './CrossDatasetReferencePreview'\nimport {type CrossDatasetReferenceInfo} from './types'\nimport {useReferenceInfo} from './useReferenceInfo'\nimport {useProjectId} from './utils/useProjectId'\n\n/**\n * Used to preview a referenced type\n * Takes as props the referenced document, the reference type and a hook to subscribe to\n * in order to listen for the reference info\n *\n * @internal\n */\nexport function OptionPreview(props: {\n  document: {_id: string; _type: string}\n  referenceType: CrossDatasetReferenceSchemaType\n  getReferenceInfo: (doc: {_id: string; _type?: string}) => Observable<CrossDatasetReferenceInfo>\n}) {\n  const {\n    isLoading,\n    result: referenceInfo,\n    error,\n  } = useReferenceInfo(props.document, props.getReferenceInfo)\n  const {t} = useTranslation()\n  const projectId = useProjectId()\n\n  if (isLoading) {\n    return (\n      <Stack space={2} padding={1}>\n        <TextSkeleton style={{maxWidth: 320}} radius={1} animated />\n        <TextSkeleton style={{maxWidth: 200}} radius={1} size={1} animated />\n      </Stack>\n    )\n  }\n\n  if (error) {\n    return (\n      <Stack space={2} padding={1}>\n        <Alert title={t('inputs.reference.error.failed-to-load-document-title')}>\n          <Text muted size={1}>\n            {error.message}\n          </Text>\n        </Alert>\n      </Stack>\n    )\n  }\n\n  if (!referenceInfo) {\n    return null\n  }\n\n  if (referenceInfo.availability?.reason === 'PERMISSION_DENIED') {\n    return (\n      <Stack space={2} padding={1}>\n        {t('inputs.reference.error.missing-read-permissions-description')}\n      </Stack>\n    )\n  }\n\n  const refType = props.referenceType.to.find((toEntry) => toEntry.type === referenceInfo.type)\n  if (!refType) {\n    return (\n      <Stack space={2} padding={1}>\n        {t('inputs.reference.error.invalid-search-result-type-title', {\n          returnedType: referenceInfo.type,\n        })}\n      </Stack>\n    )\n  }\n  return (\n    referenceInfo &&\n    refType && (\n      <CrossDatasetReferencePreview\n        id={referenceInfo.id}\n        availability={referenceInfo.availability}\n        preview={referenceInfo.preview}\n        refType={refType}\n        dataset={props.referenceType.dataset}\n        projectId={projectId}\n        showTypeLabel={props.referenceType.to.length > 1}\n      />\n    )\n  )\n}\n","import {type CrossDatasetReferenceSchemaType, type CrossDatasetReferenceValue} from '@sanity/types'\nimport {Stack, Text, TextSkeleton} from '@sanity/ui'\n\nimport {Translate, useTranslation} from '../../../i18n'\nimport {CrossDatasetReferencePreview} from './CrossDatasetReferencePreview'\nimport {type CrossDatasetReferenceInfo} from './types'\nimport {type Loadable} from './useReferenceInfo'\nimport {useProjectId} from './utils/useProjectId'\n\nexport function PreviewReferenceValue(props: {\n  value: CrossDatasetReferenceValue\n  showStudioUrlIcon?: boolean\n  hasStudioUrl?: boolean\n  type: CrossDatasetReferenceSchemaType\n  referenceInfo: Loadable<CrossDatasetReferenceInfo>\n}) {\n  const {value, type, showStudioUrlIcon, hasStudioUrl, referenceInfo} = props\n  const {t} = useTranslation()\n  const projectId = useProjectId()\n\n  if (referenceInfo.isLoading || referenceInfo.error) {\n    return (\n      <Stack space={2} padding={1}>\n        <TextSkeleton style={{maxWidth: 320}} radius={1} animated={!referenceInfo.error} />\n        <TextSkeleton style={{maxWidth: 200}} radius={1} size={1} animated={!referenceInfo.error} />\n      </Stack>\n    )\n  }\n  const showTypeLabel = type.to.length > 1\n\n  const refTypeName = referenceInfo.result?.type\n  const refType = type.to.find((toType) => toType.type === refTypeName)\n\n  if (referenceInfo.result.availability?.available && !refType) {\n    return (\n      <Stack space={2} padding={2}>\n        <Text as=\"p\">\n          <Translate\n            t={t}\n            i18nKey=\"inputs.reference.cross-dataset.invalid-type\"\n            values={{typeName: refTypeName || 'unknown'}}\n            components={{JsonValue: () => <pre>{JSON.stringify(value, null, 2)}</pre>}}\n          />\n        </Text>\n      </Stack>\n    )\n  }\n\n  return (\n    <CrossDatasetReferencePreview\n      availability={referenceInfo.result.availability}\n      hasStudioUrl={hasStudioUrl}\n      showStudioUrlIcon={showStudioUrlIcon}\n      preview={referenceInfo.result.preview}\n      refType={refType}\n      projectId={projectId}\n      dataset={type.dataset}\n      id={value._ref}\n      showTypeLabel={showTypeLabel}\n    />\n  )\n}\n","import {Autocomplete, Box, Flex, type Placement, Text} from '@sanity/ui'\nimport {\n  type ComponentProps,\n  type ForwardedRef,\n  forwardRef,\n  type ReactElement,\n  type Ref,\n  type RefObject,\n  useCallback,\n} from 'react'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../ui-components'\nimport {Translate, useTranslation} from '../../../i18n'\n\nconst StyledPopover = styled(Popover)`\n  & > div {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n  }\n`\n\nconst StyledText = styled(Text)`\n  word-break: break-word;\n`\n\nconst FALLBACK_PLACEMENTS: Placement[] = ['top-start', 'bottom-start']\n\nexport const ReferenceAutocomplete = forwardRef(function ReferenceAutocomplete(\n  props: ComponentProps<typeof Autocomplete> & {\n    referenceElement: HTMLDivElement | null\n    searchString?: string\n    portalRef?: RefObject<HTMLDivElement>\n  },\n  ref: ForwardedRef<HTMLInputElement>,\n) {\n  const {searchString, loading, portalRef, referenceElement, ...restProps} = props\n  const {t} = useTranslation()\n  const hasResults = props.options && props.options.length > 0\n  const renderPopover = useCallback(\n    (\n      {\n        content,\n        hidden,\n        inputElement,\n        onMouseEnter,\n        onMouseLeave,\n      }: {\n        content: ReactElement | null\n        hidden: boolean\n        inputElement: HTMLInputElement | null\n        onMouseEnter: () => void\n        onMouseLeave: () => void\n      },\n      contentRef: Ref<HTMLDivElement>,\n    ) => (\n      <StyledPopover\n        data-testid=\"autocomplete-popover\"\n        placement=\"bottom-start\"\n        fallbackPlacements={FALLBACK_PLACEMENTS}\n        arrow={false}\n        constrainSize\n        onMouseEnter={onMouseEnter}\n        onMouseLeave={onMouseLeave}\n        content={\n          <div ref={contentRef}>\n            {hasResults ? (\n              content\n            ) : (\n              <Box padding={4}>\n                <Flex align=\"center\" height=\"fill\" justify=\"center\">\n                  <StyledText align=\"center\" muted>\n                    <Translate\n                      t={t}\n                      i18nKey=\"inputs.reference.no-results-for-query\"\n                      values={{searchTerm: searchString || ''}}\n                    />\n                  </StyledText>\n                </Flex>\n              </Box>\n            )}\n          </div>\n        }\n        open={!loading && !hidden}\n        ref={portalRef}\n        portal\n        referenceElement={referenceElement || inputElement}\n        matchReferenceWidth\n      />\n    ),\n    [hasResults, t, searchString, loading, portalRef, referenceElement],\n  )\n  return <Autocomplete {...restProps} ref={ref} renderPopover={renderPopover} />\n})\n","/* eslint-disable complexity, max-nested-callbacks, no-nested-ternary */\nimport {ResetIcon as ClearIcon, SyncIcon as ReplaceIcon} from '@sanity/icons'\nimport {type CrossDatasetReferenceSchemaType, type CrossDatasetReferenceValue} from '@sanity/types'\nimport {Box, Card, Flex, Inline, Menu, Stack, useToast} from '@sanity/ui'\nimport {FOCUS_TERMINATOR} from '@sanity/util/paths'\nimport {\n  type FocusEvent,\n  type KeyboardEvent,\n  useCallback,\n  useId,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport {useObservableCallback} from 'react-rx'\nimport {concat, type Observable, of} from 'rxjs'\nimport {catchError, distinctUntilChanged, filter, map, scan, switchMap, tap} from 'rxjs/operators'\n\nimport {MenuButton, MenuItem} from '../../../../ui-components'\nimport {ChangeIndicator} from '../../../changeIndicators'\nimport {PreviewCard} from '../../../components'\nimport {ContextMenuButton} from '../../../components/contextMenuButton'\nimport {type FIXME} from '../../../FIXME'\nimport {useFeatureEnabled} from '../../../hooks'\nimport {useTranslation} from '../../../i18n'\nimport {getPublishedId, isNonNullable} from '../../../util'\nimport {useDidUpdate} from '../../hooks/useDidUpdate'\nimport {useOnClickOutside} from '../../hooks/useOnClickOutside'\nimport {set, unset} from '../../patch'\nimport {type ObjectInputProps} from '../../types'\nimport {ReferenceMetadataLoadErrorAlertStrip} from '../ReferenceInput/ReferenceMetadataLoadFailure'\nimport {ReferenceStrengthMismatchAlertStrip} from '../ReferenceInput/ReferenceStrengthMismatchAlertStrip'\nimport {DisabledFeatureWarning} from './DisabledFeatureWarning'\nimport {OptionPreview} from './OptionPreview'\nimport {PreviewReferenceValue} from './PreviewReferenceValue'\nimport {ReferenceAutocomplete} from './ReferenceAutocomplete'\nimport {type CrossDatasetReferenceInfo, type CrossDatasetSearchHit, type SearchState} from './types'\nimport {type GetReferenceInfoFn, useReferenceInfo} from './useReferenceInfo'\nimport {useProjectId} from './utils/useProjectId'\n\nconst INITIAL_SEARCH_STATE: SearchState = {\n  hits: [],\n  isLoading: false,\n}\n\n/** @internal */\nexport interface CrossDatasetReferenceInputProps\n  extends ObjectInputProps<CrossDatasetReferenceValue, CrossDatasetReferenceSchemaType> {\n  getReferenceInfo: (\n    doc: {_id: string; _type?: string},\n    type: CrossDatasetReferenceSchemaType,\n  ) => Observable<CrossDatasetReferenceInfo>\n  onSearch: (query: string) => Observable<CrossDatasetSearchHit[]>\n}\n\nconst NO_FILTER = () => true\n\nconst REF_PATH = ['_ref']\nconst CROSS_DATASET_FEATUREKEY = 'crossDatasetReferences'\n\n/** @internal */\nexport function CrossDatasetReferenceInput(props: CrossDatasetReferenceInputProps) {\n  const {\n    changed,\n    focused,\n    focusPath,\n    getReferenceInfo,\n    onChange,\n    onPathFocus,\n    onSearch,\n    path,\n    readOnly,\n    schemaType,\n    validation,\n    value,\n    elementProps,\n  } = props\n\n  const {t} = useTranslation()\n  const projectId = useProjectId()\n\n  const [searchState, setSearchState] = useState<SearchState>(INITIAL_SEARCH_STATE)\n\n  const handleChange = useCallback(\n    (id: string) => {\n      if (!id) {\n        onChange(unset())\n        onPathFocus([])\n        return\n      }\n\n      const hit = searchState.hits.find((h) => h.id === id)\n\n      if (!hit) {\n        throw new Error('Selected an item that wasnt part of the result set')\n      }\n\n      onChange(\n        set({\n          _type: schemaType.name,\n          _ref: getPublishedId(id),\n          _projectId: projectId,\n          _dataset: schemaType.dataset,\n          _weak: schemaType.weak,\n          // persist _key between mutations if the value is in an array\n          _key: value?._key,\n        }),\n      )\n\n      onPathFocus([])\n    },\n    [\n      value?._key,\n      searchState.hits,\n      schemaType.name,\n      schemaType.dataset,\n      schemaType.weak,\n      projectId,\n      onChange,\n      onPathFocus,\n    ],\n  )\n\n  const handleClear = useCallback(() => {\n    onChange(unset())\n  }, [onChange])\n\n  const handleAutocompleteKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLInputElement>) => {\n      if (event.key === 'Escape') {\n        onPathFocus?.([])\n      }\n    },\n    [onPathFocus],\n  )\n\n  const getReferenceInfoMemo: GetReferenceInfoFn = useCallback(\n    (doc) => getReferenceInfo(doc, schemaType),\n    [getReferenceInfo, schemaType],\n  )\n\n  const refDoc = useMemo(() => ({_id: value?._ref}), [value?._ref])\n\n  const loadableReferenceInfo = useReferenceInfo(refDoc as FIXME, getReferenceInfoMemo)\n  const featureInfo = useFeatureEnabled(CROSS_DATASET_FEATUREKEY)\n\n  const autocompletePopoverReferenceElementRef = useRef<HTMLDivElement | null>(null)\n\n  const hasFocusAtRef = focusPath.length === 1 && focusPath[0] === '_ref'\n\n  // --- focus handling\n  const focusElementRef = elementProps.ref\n  useDidUpdate({hasFocusAt: hasFocusAtRef, ref: value?._ref}, (prev, current) => {\n    const refUpdated = prev?.ref !== current.ref\n    const focusAtUpdated = prev?.hasFocusAt !== current.hasFocusAt\n\n    if ((focusAtUpdated || refUpdated) && current.hasFocusAt) {\n      // if search mode changed and we're having focus always ensure the\n      // ref element gets focus\n      focusElementRef.current?.focus()\n    }\n  })\n\n  const actualStrength = value?._weak ? 'weak' : 'strong'\n  const weakShouldBe = schemaType.weak === true ? 'weak' : 'strong'\n\n  const hasRef = Boolean(value?._ref)\n\n  const handleFixStrengthMismatch = useCallback(() => {\n    onChange(schemaType.weak === true ? set(true, ['_weak']) : unset(['_weak']))\n  }, [onChange, schemaType])\n\n  const {push} = useToast()\n\n  const errors = useMemo(() => validation.filter((item) => item.level === 'error'), [validation])\n\n  const handleFocus = useCallback(\n    (event: FocusEvent<HTMLDivElement>) => {\n      if (event.currentTarget === elementProps.ref.current) {\n        onPathFocus?.([FOCUS_TERMINATOR])\n      }\n    },\n    [elementProps.ref, onPathFocus],\n  )\n\n  const handleAutocompleteFocus = useCallback(\n    (event: FocusEvent<HTMLInputElement>) => {\n      if (event.currentTarget === elementProps.ref.current) {\n        onPathFocus?.(REF_PATH)\n      }\n    },\n    [elementProps.ref, onPathFocus],\n  )\n  const handleReplace = useCallback(() => {\n    onPathFocus?.(REF_PATH)\n  }, [onPathFocus])\n\n  const inputId = useId()\n\n  const handleQueryChange = useObservableCallback(\n    (inputValue$: Observable<string | null>) => {\n      return inputValue$.pipe(\n        filter(isNonNullable),\n        distinctUntilChanged(),\n        switchMap((searchString) =>\n          concat(\n            of({isLoading: true}),\n            onSearch(searchString).pipe(\n              map((hits) => ({hits, searchString, isLoading: false})),\n              catchError((error) => {\n                push({\n                  title: 'Reference search failed',\n                  description: error.message,\n                  status: 'error',\n                  id: `reference-search-fail-${inputId}`,\n                })\n\n                console.error(error)\n                return of({hits: []})\n              }),\n            ),\n          ),\n        ),\n\n        scan(\n          (prevState, nextState): SearchState => ({...prevState, ...nextState}),\n          INITIAL_SEARCH_STATE,\n        ),\n\n        tap(setSearchState),\n      )\n    },\n    [inputId, onSearch, push],\n  )\n\n  const handleAutocompleteOpenButtonClick = useCallback(() => {\n    handleQueryChange('')\n  }, [handleQueryChange])\n\n  const showWeakRefMismatch =\n    !loadableReferenceInfo.isLoading && hasRef && actualStrength !== weakShouldBe\n\n  const studioUrl =\n    (value?._ref &&\n      schemaType.studioUrl?.({\n        id: value?._ref,\n        type: loadableReferenceInfo?.result?.type,\n      })) ||\n    null\n\n  const renderOption = useCallback(\n    (option: FIXME) => {\n      return (\n        <PreviewCard as=\"button\" type=\"button\" radius={2}>\n          <Box paddingX={3} paddingY={1}>\n            <OptionPreview\n              referenceType={schemaType}\n              document={option.hit.published}\n              getReferenceInfo={getReferenceInfoMemo}\n            />\n          </Box>\n        </PreviewCard>\n      )\n    },\n    [schemaType, getReferenceInfoMemo],\n  )\n\n  const isEditing = hasFocusAtRef || !value?._ref\n\n  // --- click outside handling\n  const clickOutsideBoundaryRef = useRef<HTMLDivElement | null>(null)\n  const autocompletePortalRef = useRef<HTMLDivElement | null>(null)\n  const createButtonMenuPortalRef = useRef<HTMLDivElement | null>(null)\n  useOnClickOutside(\n    [clickOutsideBoundaryRef, autocompletePortalRef, createButtonMenuPortalRef],\n    () => {\n      if (hasFocusAtRef) {\n        onPathFocus([])\n      }\n    },\n  )\n\n  return (\n    <>\n      {!featureInfo.isLoading && !featureInfo.enabled && (\n        <DisabledFeatureWarning value={value} onClearValue={handleClear} />\n      )}\n      {(featureInfo.isLoading || featureInfo.enabled) && (\n        <Stack space={1}>\n          {isEditing ? (\n            <Stack space={2} ref={clickOutsideBoundaryRef}>\n              <ChangeIndicator path={path} isChanged={changed} hasFocus={!!focused}>\n                <div ref={autocompletePopoverReferenceElementRef}>\n                  <ReferenceAutocomplete\n                    {...elementProps}\n                    data-testid=\"autocomplete\"\n                    loading={searchState.isLoading}\n                    referenceElement={autocompletePopoverReferenceElementRef.current}\n                    portalRef={autocompletePortalRef}\n                    id={inputId || ''}\n                    options={searchState.hits.map((hit) => ({\n                      value: hit.id,\n                      hit: hit,\n                    }))}\n                    onFocus={handleAutocompleteFocus}\n                    radius={2}\n                    placeholder={t('inputs.reference.search-placeholder')}\n                    onKeyDown={handleAutocompleteKeyDown}\n                    readOnly={readOnly}\n                    disabled={loadableReferenceInfo.isLoading}\n                    onQueryChange={handleQueryChange}\n                    searchString={searchState.searchString}\n                    onChange={handleChange}\n                    filterOption={NO_FILTER}\n                    renderOption={renderOption}\n                    openButton={{onClick: handleAutocompleteOpenButtonClick}}\n                  />\n                </div>\n              </ChangeIndicator>\n            </Stack>\n          ) : (\n            <ChangeIndicator path={path} isChanged={changed} hasFocus={!!focused}>\n              <Card\n                padding={0}\n                border\n                flex={1}\n                radius={1}\n                tone={\n                  readOnly\n                    ? 'transparent'\n                    : loadableReferenceInfo.error || errors.length > 0\n                      ? 'critical'\n                      : 'default'\n                }\n              >\n                <Flex align=\"center\" padding={1}>\n                  {studioUrl ? (\n                    <PreviewCard\n                      as=\"a\"\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      href={studioUrl}\n                      data-as=\"a\"\n                      flex={1}\n                      padding={1}\n                      paddingRight={3}\n                      radius={2}\n                      tone=\"inherit\"\n                      __unstable_focusRing\n                      tabIndex={0}\n                      onFocus={handleFocus}\n                      ref={elementProps.ref}\n                    >\n                      <PreviewReferenceValue\n                        value={value}\n                        referenceInfo={loadableReferenceInfo}\n                        showStudioUrlIcon\n                        hasStudioUrl={!!studioUrl}\n                        type={schemaType}\n                      />\n                    </PreviewCard>\n                  ) : (\n                    <PreviewCard\n                      flex={1}\n                      padding={1}\n                      paddingRight={3}\n                      radius={2}\n                      tone=\"inherit\"\n                      __unstable_focusRing\n                      tabIndex={0}\n                      onFocus={handleFocus}\n                      ref={elementProps.ref}\n                    >\n                      <PreviewReferenceValue\n                        value={value}\n                        referenceInfo={loadableReferenceInfo}\n                        showStudioUrlIcon\n                        type={schemaType}\n                      />\n                    </PreviewCard>\n                  )}\n\n                  <Inline paddingX={1}>\n                    <MenuButton\n                      button={<ContextMenuButton data-testid=\"menu-button\" />}\n                      id={`${inputId}-menuButton`}\n                      menu={\n                        <Menu>\n                          {!readOnly && (\n                            <>\n                              <MenuItem\n                                text={t('inputs.reference.action.clear')}\n                                tone=\"critical\"\n                                icon={ClearIcon}\n                                data-testid=\"menu-item-clear\"\n                                onClick={handleClear}\n                              />\n\n                              <MenuItem\n                                text={t('inputs.reference.action.replace')}\n                                icon={ReplaceIcon}\n                                data-testid=\"menu-item-replace\"\n                                onClick={handleReplace}\n                              />\n                            </>\n                          )}\n                        </Menu>\n                      }\n                      placement=\"right\"\n                      popover={{portal: true, tone: 'default'}}\n                    />\n                  </Inline>\n                </Flex>\n                {showWeakRefMismatch && (\n                  <ReferenceStrengthMismatchAlertStrip\n                    actualStrength={actualStrength}\n                    handleFixStrengthMismatch={handleFixStrengthMismatch}\n                  />\n                )}\n\n                {loadableReferenceInfo.error && (\n                  <ReferenceMetadataLoadErrorAlertStrip\n                    errorMessage={loadableReferenceInfo.error.message}\n                    onHandleRetry={loadableReferenceInfo.retry!}\n                  />\n                )}\n              </Card>\n            </ChangeIndicator>\n          )}\n        </Stack>\n      )}\n    </>\n  )\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type CrossDatasetReferenceSchemaType} from '@sanity/types'\nimport {keyBy} from 'lodash'\nimport {combineLatest, type Observable, of} from 'rxjs'\nimport {map, switchMap} from 'rxjs/operators'\n\nimport {type FIXME} from '../../../../../FIXME'\nimport {\n  type DocumentAvailability,\n  type DocumentPreviewStore,\n  getPreviewPaths,\n  prepareForPreview,\n  type Previewable,\n} from '../../../../../preview'\nimport {isRecord} from '../../../../../util'\nimport {type CrossDatasetReferenceInfo} from '../../../../inputs/CrossDatasetReferenceInput/types'\n\nconst REQUEST_TAG_BASE = 'cross-dataset-refs'\n\nconst AVAILABILITY_READABLE = {\n  available: true,\n  reason: 'READABLE',\n} as const\n\nconst AVAILABILITY_PERMISSION_DENIED = {\n  available: false,\n  reason: 'PERMISSION_DENIED',\n} as const\n\nconst AVAILABILITY_NOT_FOUND = {\n  available: false,\n  reason: 'NOT_FOUND',\n} as const\n\n/**\n * Takes a client instance and returns a function that can be called to retrieve reference information\n */\nexport function createGetReferenceInfo(context: {\n  client: SanityClient\n  documentPreviewStore: DocumentPreviewStore\n}) {\n  const {client, documentPreviewStore} = context\n  const {dataset, projectId} = client.config()\n  const apiConfig = dataset && projectId ? {dataset, projectId} : undefined\n\n  /**\n   * Takes an id and a reference schema type, returns metadata about it\n   * Assumption: _id is always published id\n   */\n  return function getReferenceInfo(\n    doc: {_id: string; _type?: string}, // pass {_id, _type} instead and we can skip the `fetchType`\n    referenceType: CrossDatasetReferenceSchemaType,\n  ): Observable<CrossDatasetReferenceInfo> {\n    return (\n      doc._type\n        ? of(doc)\n        : documentPreviewStore\n            .observeDocumentTypeFromId(doc._id, apiConfig)\n            .pipe(map((docType): {_id: string; _type?: string} => ({_id: doc._id, _type: docType})))\n    ).pipe(\n      switchMap((resolvedDoc) => {\n        if (!resolvedDoc._type) {\n          // we still can't read the type of the referenced document. This may be due to either 1) lack of access 2) lack of existence\n          // we want to display a reason to the end user, so we're fetching metadata about it\n          return fetchDocumentAvailability(client, doc._id).pipe(\n            map((availability) => ({\n              id: doc._id,\n              type: undefined,\n              availability,\n              preview: {published: undefined},\n            })),\n          )\n        }\n        const refSchemaType = referenceType.to.find(\n          (candidate) => candidate.type === resolvedDoc._type,\n        )\n\n        const previewPaths = getPreviewPaths(refSchemaType?.preview) || []\n\n        const publishedPreview$ = documentPreviewStore\n          .observePaths(doc as Previewable, previewPaths, apiConfig)\n          .pipe(\n            map((result) => (result ? prepareForPreview(result, refSchemaType as FIXME) : result)),\n          )\n\n        return combineLatest([publishedPreview$]).pipe(\n          map(([publishedPreview]) => {\n            return {\n              type: resolvedDoc._type,\n              id: doc._id,\n              availability: AVAILABILITY_READABLE,\n              preview: {\n                published: isRecord(publishedPreview) ? publishedPreview : undefined,\n              },\n            }\n          }),\n        )\n      }),\n    )\n  }\n}\n\nfunction fetchDocumentAvailability(\n  client: SanityClient,\n  id: string,\n): Observable<DocumentAvailability | null> {\n  const requestOptions = {\n    uri: client.getDataUrl('doc', id),\n    json: true,\n    query: {excludeContent: 'true'},\n    tag: `${REQUEST_TAG_BASE}.availability`,\n  }\n\n  return client.observable.request(requestOptions).pipe(\n    map((response) => {\n      const omitted = keyBy(response.omitted || [], (entry) => entry.id)\n      const omittedEntry = omitted[id]\n      if (!omittedEntry) {\n        // it's not omitted, so it exists and is readable\n        return AVAILABILITY_READABLE\n      }\n      // omitted because it doesn't exist\n      if (omittedEntry.reason === 'existence') {\n        return AVAILABILITY_NOT_FOUND\n      }\n      if (omittedEntry.reason === 'permission') {\n        // omitted because it's not readable\n        return AVAILABILITY_PERMISSION_DENIED\n      }\n      return null\n    }),\n  )\n}\n","import {type SanityClient} from '@sanity/client'\nimport {\n  type CrossDatasetReferenceSchemaType,\n  type ReferenceFilterSearchOptions,\n} from '@sanity/types'\nimport {type Observable} from 'rxjs'\nimport {map} from 'rxjs/operators'\n\nimport {createSearch} from '../../../../../search'\nimport {collate} from '../../../../../util'\n\ninterface SearchHit {\n  id: string\n  type: string\n  published: undefined | {_id: string; _type: string}\n}\n\nexport function search(\n  client: SanityClient,\n  textTerm: string,\n  type: CrossDatasetReferenceSchemaType,\n  options: ReferenceFilterSearchOptions,\n): Observable<SearchHit[]> {\n  const searchStrategy = createSearch(type.to, client, {\n    ...options,\n    maxDepth: options.maxFieldDepth,\n  })\n\n  return searchStrategy(textTerm, {\n    includeDrafts: false,\n    isCrossDataset: true,\n  }).pipe(\n    map(({hits}) => hits.map(({hit}) => hit)),\n    map(collate),\n    map((collated) =>\n      collated.map((entry) => ({\n        id: entry.id,\n        type: entry.type,\n        published: entry.published,\n      })),\n    ),\n  )\n}\n","import {\n  type CrossDatasetReferenceSchemaType,\n  type CrossDatasetReferenceValue,\n  type Path,\n  type ReferenceFilterOptions,\n  type ReferenceFilterSearchOptions,\n  type SanityDocument,\n} from '@sanity/types'\nimport {get} from '@sanity/util/paths'\nimport {useCallback, useMemo, useRef} from 'react'\nimport {from, throwError} from 'rxjs'\nimport {catchError, mergeMap} from 'rxjs/operators'\n\nimport {type Source} from '../../../../config'\nimport {type FIXME} from '../../../../FIXME'\nimport {useDocumentPreviewStore} from '../../../../store'\nimport {useSource} from '../../../../studio'\nimport {useSearchMaxFieldDepth} from '../../../../studio/components/navbar/search/hooks/useSearchMaxFieldDepth'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../studioClient'\nimport {useFormValue} from '../../../contexts/FormValue'\nimport {CrossDatasetReferenceInput} from '../../../inputs/CrossDatasetReferenceInput'\nimport {type ObjectInputProps} from '../../../types'\nimport {createGetReferenceInfo} from './datastores/getReferenceInfo'\nimport {search} from './datastores/search'\n\nasync function resolveUserDefinedFilter(\n  options: ReferenceFilterOptions | undefined,\n  document: SanityDocument,\n  valuePath: Path,\n  getClient: Source['getClient'],\n): Promise<ReferenceFilterSearchOptions> {\n  if (!options) {\n    return {}\n  }\n\n  if (typeof options.filter === 'function') {\n    const parentPath = valuePath.slice(0, -1)\n    const parent = get(document, parentPath) as Record<string, unknown>\n    const resolvedFilter = await options.filter({document, parentPath, parent, getClient})\n    return resolvedFilter\n  }\n\n  return {\n    filter: options.filter,\n    params: 'filterParams' in options ? options.filterParams : undefined,\n  }\n}\n\n/**\n *\n * @hidden\n * @beta\n */\nexport type StudioCrossDatasetReferenceInputProps = ObjectInputProps<\n  CrossDatasetReferenceValue,\n  CrossDatasetReferenceSchemaType\n>\n\nfunction useValueRef<T>(value: T): {current: T} {\n  const ref = useRef(value)\n  ref.current = value\n  return ref\n}\n\ntype SearchError = {\n  message: string\n  details?: {\n    type: string\n    description: string\n  }\n}\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function StudioCrossDatasetReferenceInput(props: StudioCrossDatasetReferenceInputProps) {\n  const {path, schemaType} = props\n  const source = useSource()\n  const client = source.getClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const documentPreviewStore = useDocumentPreviewStore()\n  const getClient = source.getClient\n  const {unstable_enableNewSearch = false} = source.search\n\n  const crossDatasetClient = useMemo(() => {\n    return (\n      client\n        .withConfig({\n          dataset: schemaType.dataset,\n          apiVersion: '2023-11-13',\n          ignoreBrowserTokenWarning: true,\n        })\n\n        // seems like this is required to prevent this client from sometimes magically get mutated with a new projectId and dataset\n        .clone()\n    )\n  }, [client, schemaType.dataset])\n  const maxFieldDepth = useSearchMaxFieldDepth(crossDatasetClient)\n  const documentValue = useFormValue([]) as FIXME\n  const documentRef = useValueRef(documentValue)\n\n  const handleSearch = useCallback(\n    (searchString: string) =>\n      from(resolveUserDefinedFilter(schemaType.options, documentRef.current, path, getClient)).pipe(\n        mergeMap(({filter, params}) =>\n          search(crossDatasetClient, searchString, schemaType, {\n            ...schemaType.options,\n            filter,\n            params,\n            tag: 'search.cross-dataset-reference',\n            maxFieldDepth,\n            unstable_enableNewSearch,\n          }),\n        ),\n\n        catchError((err: SearchError) => {\n          const isQueryError = err.details && err.details.type === 'queryParseError'\n          if (schemaType.options?.filter && isQueryError) {\n            err.message = `Invalid reference filter, please check the custom \"filter\" option`\n          }\n          return throwError(err)\n        }),\n      ),\n\n    [\n      schemaType,\n      documentRef,\n      path,\n      getClient,\n      crossDatasetClient,\n      maxFieldDepth,\n      unstable_enableNewSearch,\n    ],\n  )\n\n  const getReferenceInfo = useMemo(\n    () => createGetReferenceInfo({client: crossDatasetClient, documentPreviewStore}),\n    [crossDatasetClient, documentPreviewStore],\n  )\n\n  return (\n    <CrossDatasetReferenceInput\n      {...props}\n      getReferenceInfo={getReferenceInfo}\n      onSearch={handleSearch}\n    />\n  )\n}\n","import {type Reference} from '@sanity/types'\nimport {type ReactNode} from 'react'\nimport {useMemoObservable} from 'react-rx'\nimport {type Observable} from 'rxjs'\n\ninterface Props<AssetDoc> {\n  reference: Reference\n  observeAsset: (assetId: string) => Observable<AssetDoc>\n  children: (assetDocument: AssetDoc) => ReactNode\n  waitPlaceholder?: ReactNode\n}\n\nexport function WithReferencedAsset<Asset>(props: Props<Asset>) {\n  const {reference, children, observeAsset, waitPlaceholder} = props\n  const documentId = reference?._ref\n  const asset = useMemoObservable(() => observeAsset(documentId), [documentId, observeAsset])\n  return <>{documentId && asset ? children(asset) : waitPlaceholder}</>\n}\n","import styled from 'styled-components'\n\nimport {MenuItem} from '../../../../../../ui-components'\n\nexport const FileMenuItem = styled(MenuItem)`\n  position: relative;\n\n  & input {\n    overflow: hidden;\n    overflow: clip;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    min-width: 0;\n    display: block;\n    appearance: none;\n    padding: 0;\n    margin: 0;\n    border: 0;\n    opacity: 0;\n  }\n`\n","import {\n  type ChangeEvent,\n  type ForwardedRef,\n  forwardRef,\n  type HTMLProps,\n  useCallback,\n  useId,\n} from 'react'\n\nimport {type MenuItemProps} from '../../../../../../ui-components'\nimport {FileMenuItem} from './FileInputMenuItem.styled'\n\nexport interface FileInputMenuItemProps extends Omit<MenuItemProps, 'onSelect'> {\n  accept?: string\n  capture?: 'user' | 'environment'\n  multiple?: boolean\n  onSelect?: (files: File[]) => void\n  disabled?: boolean\n}\n\nexport const FileInputMenuItem = forwardRef(function FileInputMenuItem(\n  props: FileInputMenuItemProps &\n    Omit<HTMLProps<HTMLButtonElement>, 'as' | 'ref' | 'type' | 'value' | 'onSelect'>,\n  forwardedRef: ForwardedRef<HTMLInputElement>,\n) {\n  const {icon, id: idProp, accept, capture, multiple, onSelect, text, disabled, ...rest} = props\n  const id = `${idProp || ''}-${useId()}`\n\n  const handleChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      if (onSelect && event.target.files) {\n        onSelect(Array.from(event.target.files))\n      }\n    },\n    [onSelect],\n  )\n\n  const renderMenuItem = useCallback(\n    (item: JSX.Element) => (\n      <div>\n        {item}\n        {/* Visibly hidden input */}\n        <input\n          data-testid=\"file-menuitem-input\"\n          accept={accept}\n          capture={capture}\n          id={id}\n          multiple={multiple}\n          onChange={handleChange}\n          type=\"file\"\n          value=\"\"\n          disabled={disabled}\n        />\n      </div>\n    ),\n    [accept, capture, disabled, handleChange, id, multiple],\n  )\n  return (\n    <FileMenuItem\n      {...rest}\n      htmlFor={id}\n      disabled={disabled}\n      ref={forwardedRef}\n      icon={icon}\n      text={text}\n      renderMenuItem={renderMenuItem}\n    />\n  )\n})\n","import {CopyIcon, DownloadIcon, ResetIcon, UploadIcon} from '@sanity/icons'\nimport {MenuDivider, useToast} from '@sanity/ui'\nimport {type MouseEventHandler, type ReactNode, useCallback} from 'react'\n\nimport {MenuItem} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {FileInputMenuItem} from './FileInputMenuItem/FileInputMenuItem'\n\ninterface Props {\n  onUpload: (files: File[]) => void\n  browse: ReactNode\n  readOnly?: boolean\n  onReset: MouseEventHandler<HTMLDivElement>\n  accept: string\n  directUploads?: boolean\n  downloadUrl?: string\n  copyUrl?: string\n}\n\nexport function ActionsMenu(props: Props) {\n  const {onUpload, onReset, readOnly, accept, directUploads, browse, downloadUrl, copyUrl} = props\n\n  const {push: pushToast} = useToast()\n  const {t} = useTranslation()\n\n  const handleCopyURL = useCallback(() => {\n    navigator.clipboard.writeText(copyUrl || '')\n    pushToast({\n      closable: true,\n      status: 'success',\n      title: t('inputs.files.common.actions-menu.notification.url-copied'),\n    })\n  }, [copyUrl, pushToast, t])\n\n  return (\n    <>\n      <FileInputMenuItem\n        icon={UploadIcon}\n        onSelect={onUpload}\n        accept={accept}\n        text={t('inputs.files.common.actions-menu.upload.label')}\n        data-testid=\"file-input-upload-button\"\n        disabled={readOnly || !directUploads}\n      />\n      {browse}\n\n      {(downloadUrl || copyUrl) && <MenuDivider />}\n      {downloadUrl && (\n        <MenuItem\n          as=\"a\"\n          icon={DownloadIcon}\n          text={t('inputs.files.common.actions-menu.download.label')}\n          href={downloadUrl}\n        />\n      )}\n      {copyUrl && (\n        <MenuItem\n          icon={CopyIcon}\n          text={t('inputs.files.common.actions-menu.copy-url.label')}\n          onClick={handleCopyURL}\n        />\n      )}\n\n      <MenuDivider />\n      <MenuItem\n        tone=\"critical\"\n        icon={ResetIcon}\n        text={t('inputs.files.common.actions-menu.clear-field.label')}\n        onClick={onReset}\n        disabled={readOnly}\n        data-testid=\"file-input-clear\"\n      />\n    </>\n  )\n}\n","import {uuid} from '@sanity/uuid'\n\nimport {type FIXME} from '../../../../../FIXME'\n\nexport function urlToFile(url: string, filename?: string): Promise<File> {\n  return new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest()\n    xhr.onload = () => {\n      const reader = new FileReader()\n      reader.onloadend = () => {\n        const string = reader.result?.toString()\n        const ext = string?.substring('data:image/'.length, string.indexOf(';base64'))\n        if (!ext && !filename) {\n          reject(new Error('Could not find mime type for image'))\n          return\n        }\n        resolve(dataURLtoFile(reader.result as FIXME, filename || `${uuid()}.${ext}`))\n      }\n      reader.readAsDataURL(xhr.response)\n    }\n    xhr.onerror = (error) => {\n      reject(error)\n    }\n    xhr.open('GET', url)\n    xhr.responseType = 'blob'\n    xhr.send()\n  })\n}\n\nexport function base64ToFile(base64Data: string | ArrayBuffer, filename?: string): Promise<File> {\n  return new Promise((resolve, reject) => {\n    const string = base64Data.toString()\n    const ext = string.substring('data:image/'.length, string.indexOf(';base64'))\n    if (!ext && !filename) {\n      reject(new Error('Could not find mime type for image'))\n      return\n    }\n    resolve(dataURLtoFile(base64Data as FIXME, filename || `${uuid()}.${ext}`))\n  })\n}\n\nfunction dataURLtoFile(dataurl: string, filename: string) {\n  const arr = dataurl.split(',')\n  const mime = arr[0].match(/:(.*?);/)?.[1]\n  const bstr = atob(arr[1])\n  let n = bstr.length\n  const u8arr = new Uint8Array(n)\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n)\n  }\n  return new File([u8arr], filename, {type: mime})\n}\n","import {type AssetFromSource, type FileSchemaType} from '@sanity/types'\n\nimport {type FIXME} from '../../../../FIXME'\nimport {type FormPatch, type PatchEvent, set, setIfMissing, unset} from '../../../patch'\nimport {\n  type Uploader,\n  type UploaderResolver,\n  type UploadOptions,\n} from '../../../studio/uploads/types'\nimport {base64ToFile, urlToFile} from '../ImageInput/utils/image'\n\n// We alias DOM File type here to distinguish it from the type of the File value\ntype DOMFile = globalThis.File\n\ninterface Props {\n  assetFromSource: AssetFromSource[]\n  onChange: (patch: FormPatch | FormPatch[] | PatchEvent) => void\n  type: FileSchemaType\n  resolveUploader: UploaderResolver\n  uploadWith: (uploader: Uploader, file: DOMFile, assetDocumentProps?: UploadOptions) => void\n  isImage?: boolean\n}\n\nexport function handleSelectAssetFromSource({\n  assetFromSource,\n  onChange,\n  type,\n  resolveUploader,\n  uploadWith,\n  isImage,\n}: Props): void {\n  // const {onChange, type, resolveUploader} = this.props\n  if (!assetFromSource) {\n    throw new Error('No asset given')\n  }\n  if (!Array.isArray(assetFromSource) || assetFromSource.length === 0) {\n    throw new Error('Returned value must be an array with at least one item (asset)')\n  }\n  const firstAsset = assetFromSource[0]\n  const assetProps = firstAsset.assetDocumentProps\n  const originalFilename = assetProps?.originalFilename\n  const label = assetProps?.label\n  const title = assetProps?.title\n  const description = assetProps?.description\n  const creditLine = assetProps?.creditLine\n  const source = assetProps?.source\n  const imagePatches = isImage ? [unset(['hotspot']), unset(['crop'])] : []\n  switch (firstAsset.kind) {\n    case 'assetDocumentId':\n      onChange([\n        setIfMissing({\n          _type: type.name,\n        }),\n        ...imagePatches,\n        set(\n          {\n            _type: 'reference',\n            _ref: firstAsset.value,\n          },\n\n          ['asset'],\n        ),\n      ])\n\n      break\n    case 'file': {\n      const uploader = resolveUploader(type, firstAsset.value as FIXME)\n      if (uploader) {\n        uploadWith(uploader, firstAsset.value as FIXME, {\n          label,\n          title,\n          description,\n          creditLine,\n          source,\n        })\n      }\n      break\n    }\n    case 'base64':\n      base64ToFile(firstAsset.value as FIXME, originalFilename).then((file) => {\n        const uploader = resolveUploader(type, file)\n        if (uploader) {\n          uploadWith(uploader, file, {label, title, description, creditLine, source})\n        }\n      })\n      break\n    case 'url':\n      urlToFile(firstAsset.value as FIXME, originalFilename).then((file) => {\n        const uploader = resolveUploader(type, file)\n        if (uploader) {\n          uploadWith(uploader, file, {label, title, description, creditLine, source})\n        }\n      })\n      break\n    default: {\n      throw new Error('Invalid value returned from asset source plugin')\n    }\n  }\n}\n","import {AccessDeniedIcon, BinaryDocumentIcon, ImageIcon, ReadOnlyIcon} from '@sanity/icons'\nimport {Flex, Text} from '@sanity/ui'\nimport {useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../../i18n'\nimport {type FileLike} from '../../../studio/uploads/types'\n\ninterface Props {\n  readOnly?: boolean\n  hoveringFiles: FileLike[]\n  type: string\n  acceptedFiles: FileLike[]\n  rejectedFilesCount: number\n  directUploads?: boolean\n}\n\nconst RootFlex = styled(Flex)`\n  pointer-events: none;\n`\n\nexport function PlaceholderText(props: Props) {\n  const {hoveringFiles, type, readOnly, acceptedFiles, rejectedFilesCount, directUploads} = props\n  const isFileType = type === 'file'\n\n  const {t} = useTranslation()\n\n  const messageIcon = useMemo(() => {\n    if (readOnly) {\n      return <ReadOnlyIcon />\n    }\n\n    if ((hoveringFiles && rejectedFilesCount > 0) || !directUploads) {\n      return <AccessDeniedIcon />\n    }\n\n    return isFileType ? <BinaryDocumentIcon /> : <ImageIcon />\n  }, [directUploads, hoveringFiles, isFileType, readOnly, rejectedFilesCount])\n\n  const messageText = useMemo(() => {\n    if (!directUploads) {\n      return t('inputs.files.common.placeholder.upload-not-supported')\n    }\n\n    if (readOnly) {\n      return t('inputs.files.common.placeholder.read-only')\n    }\n\n    if (hoveringFiles && directUploads && !readOnly) {\n      if (acceptedFiles.length > 0) {\n        return t('inputs.files.common.placeholder.drop-to-upload', {context: type})\n      }\n      if (rejectedFilesCount > 0) {\n        return t('inputs.files.common.placeholder.cannot-upload-some-files', {\n          count: rejectedFilesCount,\n        })\n      }\n    }\n\n    return t('inputs.files.common.placeholder.drag-or-paste-to-upload', {context: type})\n  }, [acceptedFiles.length, directUploads, hoveringFiles, readOnly, rejectedFilesCount, t, type])\n\n  return (\n    <RootFlex align=\"center\" gap={3} justify=\"center\" paddingLeft={1}>\n      <Text muted size={1}>\n        {messageIcon}\n      </Text>\n\n      <Text size={1} muted>\n        {messageText}\n      </Text>\n    </RootFlex>\n  )\n}\n","/* eslint-disable import/named */\n\nimport {Card} from '@sanity/ui'\n\nimport {withFocusRing} from '../../../components/withFocusRing'\nimport {fileTarget} from '../../common/fileTarget'\n\nexport type {FileInfo} from '../../common/fileTarget'\n\n// Note: FileTarget needs its own focusRing because we need show it on click, not only when :focus-visible\nexport const FileTarget = withFocusRing(fileTarget(Card))\n","import {type Theme} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nimport {Button} from '../../../../../../ui-components'\nimport {focusRingStyle} from '../../../../components/withFocusRing/helpers'\n\nexport const FileButton = styled(Button).attrs({forwardedAs: 'label'})(\n  ({theme}: {theme: Theme}) => {\n    const {focusRing} = theme.sanity\n    const base = theme.sanity.color.base\n    const border = {width: 1, color: 'var(--card-border-color)'}\n\n    return css`\n      &:not([data-disabled='true']) {\n        &:focus-within {\n          box-shadow: ${focusRingStyle({base, border, focusRing})};\n        }\n      }\n\n      // The underlying file input is rendered as children within a Sanity UI <Button> component.\n      // The below visibly hides it by targeting the input's parent <span> element, which is\n      // added by the <Button> component.\n      // TODO: refactor, avoid nth-child selector usage\n      & > span:nth-child(2) {\n        overflow: hidden;\n        overflow: clip;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        position: absolute;\n        min-width: 0;\n        display: block;\n        appearance: none;\n        padding: 0;\n        margin: 0;\n        border: 0;\n        opacity: 0;\n      }\n    `\n  },\n)\n","import {\n  type ChangeEvent,\n  type ForwardedRef,\n  forwardRef,\n  type HTMLProps,\n  useCallback,\n  useId,\n} from 'react'\n\nimport {type ButtonProps} from '../../../../../../ui-components'\nimport {FileButton} from './styles'\n\nexport type FileInputButtonProps = ButtonProps & {\n  accept?: string\n  capture?: 'user' | 'environment'\n  multiple?: boolean\n  onSelect?: (files: File[]) => void\n  disabled?: boolean\n}\n\nexport const FileInputButton = forwardRef(function FileInputButton(\n  props: FileInputButtonProps &\n    Omit<HTMLProps<HTMLButtonElement>, 'as' | 'ref' | 'type' | 'value' | 'onSelect'>,\n  forwardedRef: ForwardedRef<HTMLInputElement>,\n) {\n  const {icon, id: idProp, accept, capture, multiple, onSelect, text, disabled, ...rest} = props\n  const id = `${idProp || ''}-${useId()}`\n\n  const handleChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      if (onSelect && event.target.files) {\n        onSelect(Array.from(event.target.files))\n      }\n    },\n    [onSelect],\n  )\n\n  return (\n    <FileButton {...rest} icon={icon} text={text} htmlFor={id} disabled={disabled}>\n      {/* Visibly hidden input */}\n      <input\n        data-testid=\"file-button-input\"\n        accept={accept}\n        capture={capture}\n        id={id}\n        multiple={multiple}\n        onChange={handleChange}\n        ref={forwardedRef}\n        type=\"file\"\n        value=\"\"\n        disabled={disabled}\n      />\n    </FileButton>\n  )\n})\n","import {UploadIcon} from '@sanity/icons'\nimport {Flex, useElementSize} from '@sanity/ui'\nimport {memo, type ReactNode, useState} from 'react'\n\nimport {useTranslation} from '../../../../i18n'\nimport {type FileLike} from '../../../studio/uploads/types'\nimport {FileInputButton} from './FileInputButton/FileInputButton'\nimport {PlaceholderText} from './PlaceholderText'\n\ninterface UploadPlaceholderProps {\n  accept: string\n  acceptedFiles: FileLike[]\n  browse?: ReactNode\n  directUploads?: boolean\n  hoveringFiles: FileLike[]\n  onUpload?: (files: File[]) => void\n  readOnly?: boolean\n  rejectedFilesCount: number\n  type: string\n}\n\nfunction UploadPlaceholderComponent(props: UploadPlaceholderProps) {\n  const {\n    accept,\n    acceptedFiles,\n    browse,\n    directUploads,\n    hoveringFiles,\n    onUpload,\n    readOnly,\n    rejectedFilesCount,\n    type,\n  } = props\n\n  const [rootElement, setRootElement] = useState<HTMLDivElement | null>(null)\n  const rect = useElementSize(rootElement)\n\n  // Adjust the layout in narrow containers\n  const collapsed = rect?.border && rect.border.width < 440\n  const {t} = useTranslation()\n\n  return (\n    <Flex\n      align={collapsed ? undefined : 'center'}\n      direction={collapsed ? 'column' : 'row'}\n      gap={4}\n      justify=\"space-between\"\n      paddingY={collapsed ? 1 : undefined}\n      ref={setRootElement}\n    >\n      <Flex flex={1}>\n        <PlaceholderText\n          acceptedFiles={acceptedFiles}\n          directUploads={directUploads}\n          hoveringFiles={hoveringFiles}\n          readOnly={readOnly}\n          rejectedFilesCount={rejectedFilesCount}\n          type={type}\n        />\n      </Flex>\n\n      <Flex align=\"center\" gap={1} justify=\"center\" wrap=\"wrap\">\n        <FileInputButton\n          accept={accept}\n          data-testid=\"file-input-upload-button\"\n          disabled={readOnly || !directUploads}\n          icon={UploadIcon}\n          mode=\"bleed\"\n          onSelect={onUpload}\n          text={t('input.files.common.upload-placeholder.file-input-button.text')}\n        />\n\n        {browse}\n      </Flex>\n    </Flex>\n  )\n}\n\nexport const UploadPlaceholder = memo(UploadPlaceholderComponent)\n","/**\n * How long, in milliseconds, an upload has to be inactive for in order to consider it stale.\n * E.g. if it's more than this amount of milliseconds since last time upload state was reported,\n * the upload will be marked as stale/interrupted.\n */\nexport const STALE_UPLOAD_MS = 1000 * 60 * 2\n","import {Card, Code, Flex, Stack} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const CardWrapper = styled(Card)`\n  min-height: 82px;\n  box-sizing: border-box;\n`\n\nexport const FlexWrapper = styled(Flex)`\n  text-overflow: ellipsis;\n  overflow: hidden;\n  overflow: clip;\n`\n\nexport const LeftSection = styled(Stack)`\n  position: relative;\n  width: 60%;\n`\n\nexport const CodeWrapper = styled(Code)`\n  position: relative;\n  width: 100%;\n\n  code {\n    overflow: hidden;\n    overflow: clip;\n    text-overflow: ellipsis;\n    position: relative;\n    max-width: 200px;\n  }\n`\n","import {type UploadState} from '@sanity/types'\nimport {Card, Flex, Inline, Text} from '@sanity/ui'\nimport {useEffect} from 'react'\n\nimport {Button} from '../../../../../ui-components'\nimport {LinearProgress} from '../../../../components'\nimport {Translate, useTranslation} from '../../../../i18n'\nimport {STALE_UPLOAD_MS} from '../constants'\nimport {CardWrapper, CodeWrapper, FlexWrapper, LeftSection} from './UploadProgress.styled'\n\ntype Props = {\n  uploadState: UploadState\n  onCancel?: () => void\n  onStale?: () => void\n  height?: number\n}\nconst elapsedMs = (date: string): number => new Date().getTime() - new Date(date).getTime()\n\nexport function UploadProgress({uploadState, onCancel, onStale, height}: Props) {\n  const filename = uploadState.file.name\n\n  useEffect(() => {\n    if (elapsedMs(uploadState.updatedAt) > STALE_UPLOAD_MS) {\n      onStale?.()\n    }\n  }, [uploadState.updatedAt, onStale])\n\n  const {t} = useTranslation()\n  return (\n    <CardWrapper tone=\"primary\" padding={4} border style={{height: `${height}px`}}>\n      <FlexWrapper align=\"center\" justify=\"space-between\" height=\"fill\" direction=\"row\" gap={2}>\n        <LeftSection>\n          <Flex justify=\"center\" gap={[3, 3, 2, 2]} direction={['column', 'column', 'row']}>\n            <Text size={1}>\n              <Inline space={2}>\n                <Translate\n                  t={t}\n                  i18nKey=\"input.files.common.upload-progress\"\n                  components={{\n                    FileName: () => <CodeWrapper size={1}>{filename ? filename : ''}</CodeWrapper>,\n                  }}\n                />\n              </Inline>\n            </Text>\n          </Flex>\n\n          <Card border marginTop={3} radius={5}>\n            <LinearProgress value={uploadState.progress} />\n          </Card>\n        </LeftSection>\n\n        {onCancel ? (\n          <Button\n            mode=\"ghost\"\n            onClick={onCancel}\n            text={t('input.files.common.cancel-upload')}\n            tone=\"critical\"\n          />\n        ) : null}\n      </FlexWrapper>\n    </CardWrapper>\n  )\n}\n","import {ResetIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Stack, Text} from '@sanity/ui'\n\nimport {Button} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {STALE_UPLOAD_MS} from '../constants'\n\ntype Props = {\n  onClearStale?: () => void\n}\n\nexport function UploadWarning({onClearStale}: Props) {\n  const {t} = useTranslation()\n\n  return (\n    <Card tone=\"caution\" padding={4} border radius={2}>\n      <Flex gap={4} marginBottom={4}>\n        <Box>\n          <Text size={1}>\n            <WarningOutlineIcon />\n          </Text>\n        </Box>\n        <Stack space={3}>\n          <Text size={1} weight=\"medium\">\n            {t('inputs.files.common.stale-upload-warning.title')}\n          </Text>\n          <Text size={1}>\n            {t('inputs.files.common.stale-upload-warning.description', {\n              staleThresholdMinutes: Math.ceil(STALE_UPLOAD_MS / 1000 / 60),\n            })}\n          </Text>\n        </Stack>\n      </Flex>\n      <Button\n        icon={ResetIcon}\n        mode=\"ghost\"\n        onClick={onClearStale}\n        text={t('inputs.files.common.stale-upload-warning.clear')}\n        width=\"fill\"\n      />\n    </Card>\n  )\n}\n","/* method which returns a file size in a readable format */\nexport function formatBytes(bytes: number, decimals = 2) {\n  if (bytes === 0) return '0 Bytes'\n\n  const k = 1024\n  const dm = decimals < 0 ? 0 : decimals\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`\n}\n","import {BinaryDocumentIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Menu, Stack, Text, useClickOutside, useGlobalKeyDown} from '@sanity/ui'\nimport {type ReactNode, useCallback, useEffect, useState} from 'react'\n\nimport {Popover} from '../../../../../ui-components'\nimport {ContextMenuButton} from '../../../../components/contextMenuButton'\nimport {useTranslation} from '../../../../i18n'\nimport {formatBytes} from '../../common/helper'\n\ntype Props = {\n  children: ReactNode\n  size: number\n  originalFilename: string\n  onClick?: () => void\n  muted?: boolean\n  disabled?: boolean\n  isMenuOpen: boolean\n  onMenuOpen: (flag: boolean) => void\n  setMenuButtonElement: (element: HTMLButtonElement | null) => void\n}\n\nexport function FileActionsMenu(props: Props) {\n  const {\n    originalFilename,\n    size,\n    children,\n    muted,\n    disabled,\n    onClick,\n    isMenuOpen,\n    onMenuOpen,\n    setMenuButtonElement,\n  } = props\n  const [menuElement, setMenuElement] = useState<HTMLDivElement | null>(null)\n  const [buttonElement, setButtonElement] = useState<HTMLButtonElement | null>(null)\n\n  const handleClick = useCallback(() => onMenuOpen(true), [onMenuOpen])\n\n  useGlobalKeyDown(\n    useCallback(\n      (event) => {\n        if (isMenuOpen && (event.key === 'Escape' || event.key === 'Tab')) {\n          onMenuOpen(false)\n          buttonElement?.focus()\n        }\n      },\n      [isMenuOpen, onMenuOpen, buttonElement],\n    ),\n  )\n\n  // Close menu when clicking outside of it\n  // Not when clicking on the button\n  useClickOutside(\n    useCallback(\n      (event) => {\n        if (!buttonElement?.contains(event.target as Node)) {\n          onMenuOpen(false)\n        }\n      },\n      [buttonElement, onMenuOpen],\n    ),\n    [menuElement],\n  )\n\n  const setOptionsButtonRef = useCallback(\n    (el: HTMLButtonElement | null) => {\n      // Pass the button element to the parent component so that it can focus it when e.g. closing dialogs\n      setMenuButtonElement(el)\n\n      // Set focus back on the button when closing the menu\n      setButtonElement(el)\n    },\n    [setMenuButtonElement],\n  )\n\n  // When the popover is open, focus the menu to enable keyboard navigation\n  useEffect(() => {\n    if (isMenuOpen) {\n      menuElement?.focus()\n    }\n  }, [isMenuOpen, menuElement])\n\n  const {t} = useTranslation()\n\n  return (\n    <Flex wrap=\"nowrap\" justify=\"space-between\" align=\"center\">\n      <Card\n        as={muted || disabled ? undefined : 'button'}\n        radius={2}\n        padding={2}\n        tone=\"inherit\"\n        onClick={onClick}\n        flex={1}\n      >\n        {/* todo: consider replacing with <SanityDefaultPreview> */}\n        <Flex wrap=\"nowrap\" align=\"center\">\n          <Card padding={3} tone=\"transparent\" shadow={1} radius={1}>\n            <Text muted={muted}>\n              <BinaryDocumentIcon />\n            </Text>\n          </Card>\n          <Stack flex={1} space={2} marginLeft={3}>\n            <Text\n              size={1}\n              textOverflow=\"ellipsis\"\n              muted={muted}\n              data-testid=\"file-name\"\n              weight=\"medium\"\n            >\n              {originalFilename}\n            </Text>\n            <Text size={1} muted data-testid=\"file-size\">\n              {formatBytes(size)}\n            </Text>\n          </Stack>\n        </Flex>\n      </Card>\n\n      <Box padding={2}>\n        <Flex justify=\"center\">\n          {/* Using a customized Popover instead of MenuButton because a MenuButton will close on click\n     and break replacing an uploaded file. */}\n          <Popover\n            content={<Menu ref={setMenuElement}>{children}</Menu>}\n            id=\"file-actions-menu\"\n            portal\n            open={isMenuOpen}\n            constrainSize\n          >\n            <ContextMenuButton\n              aria-label={t('inputs.file.actions-menu.file-options.aria-label')}\n              data-testid=\"options-menu-button\"\n              onClick={handleClick}\n              paddingY={3}\n              ref={setOptionsButtonRef}\n            />\n          </Popover>\n        </Flex>\n      </Box>\n    </Flex>\n  )\n}\n","import {Flex, Skeleton, Stack, TextSkeleton} from '@sanity/ui'\n\nexport function FileSkeleton() {\n  return (\n    <Flex align=\"center\" justify=\"flex-start\" padding={2}>\n      <Skeleton padding={3} radius={1} animated />\n      <Stack flex={1} space={2} marginLeft={3}>\n        <TextSkeleton style={{width: '100%'}} radius={1} animated />\n        <TextSkeleton style={{width: '100%'}} radius={1} animated />\n      </Stack>\n    </Flex>\n  )\n}\n","import {ResetIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Stack, Text} from '@sanity/ui'\n\nimport {Button} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\n\ntype Props = {\n  onClearValue?: () => void\n}\n\nexport function InvalidFileWarning({onClearValue}: Props) {\n  const {t} = useTranslation()\n  return (\n    <Card tone=\"caution\" padding={4} border radius={2}>\n      <Flex gap={4} marginBottom={4}>\n        <Box>\n          <Text size={1}>\n            <WarningOutlineIcon />\n          </Text>\n        </Box>\n        <Stack space={3}>\n          <Text size={1} weight=\"medium\">\n            {t('inputs.file.invalid-file-warning.title')}\n          </Text>\n          <Text size={1}>{t('inputs.file.invalid-file-warning.description')}</Text>\n        </Stack>\n      </Flex>\n      <Button\n        icon={ResetIcon}\n        mode=\"ghost\"\n        onClick={onClearValue}\n        text={t('inputs.file.invalid-file-warning.reset-button.text')}\n        width=\"fill\"\n      />\n    </Card>\n  )\n}\n","import {Card, Flex} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const CardOverlay = styled(Card)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n`\n\nexport const FlexContainer = styled(Flex)`\n  height: 100%;\n`\n","/* eslint-disable import/no-unresolved,react/jsx-handler-names, react/display-name, react/no-this-in-sfc */\n\nimport {isFileSource} from '@sanity/asset-utils'\nimport {type SanityClient} from '@sanity/client'\nimport {ImageIcon, SearchIcon} from '@sanity/icons'\nimport {\n  type AssetFromSource,\n  type AssetSource,\n  type File as BaseFile,\n  type FileAsset,\n  type FileSchemaType,\n  type Path,\n  type UploadState,\n} from '@sanity/types'\nimport {Box, Card, Menu, type ThemeColorToneKey, type ToastParams} from '@sanity/ui'\nimport {get, startCase} from 'lodash'\nimport {PureComponent, type ReactNode} from 'react'\nimport {type Observable, type Subscription} from 'rxjs'\n\nimport {Button, MenuButton, MenuItem} from '../../../../../ui-components'\nimport {ChangeIndicator} from '../../../../changeIndicators'\nimport {ImperativeToast} from '../../../../components'\nimport {MemberField, MemberFieldError, MemberFieldSet} from '../../../members'\nimport {PatchEvent, setIfMissing, unset} from '../../../patch'\nimport {\n  type Uploader,\n  type UploaderResolver,\n  type UploadOptions,\n} from '../../../studio/uploads/types'\nimport {type InputProps, type ObjectInputProps} from '../../../types'\nimport {WithReferencedAsset} from '../../../utils/WithReferencedAsset'\nimport {ActionsMenu} from '../common/ActionsMenu'\nimport {handleSelectAssetFromSource} from '../common/assetSource'\nimport {PlaceholderText} from '../common/PlaceholderText'\nimport {type FileInfo, FileTarget} from '../common/styles'\nimport {UploadPlaceholder} from '../common/UploadPlaceholder'\nimport {UploadProgress} from '../common/UploadProgress'\nimport {UploadWarning} from '../common/UploadWarning'\nimport {FileActionsMenu} from './FileActionsMenu'\nimport {FileSkeleton} from './FileSkeleton'\nimport {InvalidFileWarning} from './InvalidFileWarning'\nimport {CardOverlay, FlexContainer} from './styles'\n\n/**\n * @hidden\n * @beta */\nexport interface BaseFileInputValue extends Partial<BaseFile> {\n  _upload?: UploadState\n}\n\nfunction passThrough({children}: {children?: React.ReactNode}) {\n  return children\n}\n\n/**\n * @hidden\n * @beta */\nexport interface BaseFileInputProps extends ObjectInputProps<BaseFileInputValue, FileSchemaType> {\n  assetSources: AssetSource[]\n  directUploads?: boolean\n  observeAsset: (documentId: string) => Observable<FileAsset>\n  resolveUploader: UploaderResolver\n  client: SanityClient\n  t: (key: string, values?: Record<string, string>) => string\n}\n\n/** @internal */\nexport interface BaseFileInputState {\n  isUploading: boolean\n  selectedAssetSource: AssetSource | null\n  hoveringFiles: FileInfo[]\n  isStale: boolean\n  isMenuOpen: boolean\n}\n\nconst ASSET_FIELD_PATH = ['asset']\n\n/** @internal */\nexport class BaseFileInput extends PureComponent<BaseFileInputProps, BaseFileInputState> {\n  _assetFieldPath: Path\n  uploadSubscription: Subscription | null = null\n  browseButtonElement: HTMLButtonElement | null = null\n\n  state: BaseFileInputState = {\n    isUploading: false,\n    selectedAssetSource: null,\n    hoveringFiles: [],\n    isStale: false,\n    isMenuOpen: false,\n  }\n\n  constructor(props: BaseFileInputProps) {\n    super(props)\n    this._assetFieldPath = props.path.concat(ASSET_FIELD_PATH)\n  }\n\n  toast: {push: (params: ToastParams) => void} | null = null\n\n  handleRemoveButtonClick = () => {\n    const {path, value} = this.props\n    const parentPathSegment = path.slice(-1)[0]\n\n    // String path segment mean an object path, while a number or a\n    // keyed segment means we're a direct child of an array\n    const isArrayElement = typeof parentPathSegment !== 'string'\n\n    // When removing the file, _type and _key are \"meta\"-properties and\n    // are not significant unless other properties are present. Thus, we\n    // want to remove the entire \"container\" object if these are the only\n    // properties present, BUT only if we're not an array element, as\n    // removing the array element will close the selection dialog. Instead,\n    // when closing the dialog, the array logic will check for an \"empty\"\n    // value and remove it for us\n    const allKeys = Object.keys(value || {})\n    const remainingKeys = allKeys.filter(\n      (key) => !['_type', '_key', '_upload', 'asset'].includes(key),\n    )\n\n    const isEmpty = remainingKeys.length === 0\n    const removeKeys = ['asset']\n      .concat(allKeys.filter((key) => ['_upload'].includes(key)))\n      .map((key) => unset([key]))\n\n    this.props.onChange(PatchEvent.from(isEmpty && !isArrayElement ? unset() : removeKeys))\n  }\n\n  clearUploadStatus() {\n    // todo: this is kind of hackish\n    if (this.props.value?._upload) {\n      this.props.onChange(PatchEvent.from([unset(['_upload'])]))\n    }\n  }\n\n  cancelUpload() {\n    if (this.uploadSubscription) {\n      this.uploadSubscription.unsubscribe()\n      this.clearUploadStatus()\n    }\n  }\n\n  handleCancelUpload = () => {\n    this.cancelUpload()\n  }\n\n  handleClearUploadState = () => {\n    this.setState({isStale: false})\n    this.clearUploadStatus()\n  }\n\n  handleStaleUpload = () => {\n    this.setState({isStale: true})\n  }\n\n  handleClearField = () => {\n    this.props.onChange(unset(['asset']))\n  }\n\n  handleSelectFiles = (files: globalThis.File[]) => {\n    const {directUploads, readOnly} = this.props\n    const {hoveringFiles} = this.state\n    if (directUploads && !readOnly) {\n      this.uploadFirstAccepted(files)\n    } else if (hoveringFiles.length > 0) {\n      this.handleFilesOut()\n    }\n  }\n\n  handleSelectFileFromAssetSource = (source: AssetSource) => {\n    this.setState({selectedAssetSource: source})\n  }\n\n  handleAssetSourceClosed = () => {\n    this.setState({selectedAssetSource: null})\n\n    // Restore focus to browse button when closing the dialog\n    this.browseButtonElement?.focus()\n  }\n\n  setBrowseButtonElement = (el: HTMLButtonElement | null) => {\n    this.browseButtonElement = el\n  }\n\n  uploadFirstAccepted(files: globalThis.File[]) {\n    const {schemaType} = this.props\n\n    const match = files\n      .map((file) => ({file, uploader: this.props.resolveUploader?.(schemaType, file)}))\n      .find((result) => result.uploader)\n\n    if (match) {\n      this.uploadWith(match.uploader!, match.file)\n    }\n\n    this.setState({isMenuOpen: false})\n  }\n\n  uploadWith = (\n    uploader: Uploader,\n    file: globalThis.File,\n    assetDocumentProps: UploadOptions = {},\n  ) => {\n    const {schemaType, onChange, client, t} = this.props\n    const {source} = assetDocumentProps\n    const options = {\n      metadata: get(schemaType, 'options.metadata'),\n      storeOriginalFilename: get(schemaType, 'options.storeOriginalFilename'),\n      source,\n    }\n    this.cancelUpload()\n    this.setState({isUploading: true})\n    onChange(PatchEvent.from([setIfMissing({_type: schemaType.name})]))\n    this.uploadSubscription = uploader.upload(client, file, schemaType, options).subscribe({\n      next: (uploadEvent) => {\n        if (uploadEvent.patches) {\n          onChange(PatchEvent.from(uploadEvent.patches))\n        }\n      },\n      error: (err) => {\n        // eslint-disable-next-line no-console\n        console.error(err)\n        this.toast?.push({\n          status: 'error',\n          description: t('inputs.file.upload-failed.description'),\n          title: t('inputs.file.upload-failed.title'),\n        })\n        this.clearUploadStatus()\n      },\n      complete: () => {\n        this.setState({isUploading: false})\n      },\n    })\n  }\n\n  renderUploadState(uploadState: UploadState) {\n    const {isUploading} = this.state\n\n    return (\n      <UploadProgress\n        uploadState={uploadState}\n        onCancel={isUploading ? this.handleCancelUpload : undefined}\n        onStale={this.handleStaleUpload}\n      />\n    )\n  }\n\n  renderAssetSource() {\n    const {selectedAssetSource} = this.state\n    const {value, schemaType, observeAsset, t} = this.props\n    if (!selectedAssetSource) {\n      return null\n    }\n    const accept = get(schemaType, 'options.accept', '')\n\n    const Component = selectedAssetSource.component\n    if (value && value.asset) {\n      return (\n        <WithReferencedAsset\n          observeAsset={observeAsset}\n          reference={value.asset}\n          waitPlaceholder={<FileSkeleton />}\n        >\n          {(fileAsset) => (\n            <Component\n              selectedAssets={[fileAsset]}\n              selectionType=\"single\"\n              assetType=\"file\"\n              accept={accept}\n              dialogHeaderTitle={t('inputs.file.dialog.title')}\n              onClose={this.handleAssetSourceClosed}\n              onSelect={this.handleSelectAssetFromSource}\n            />\n          )}\n        </WithReferencedAsset>\n      )\n    }\n    return (\n      <Component\n        selectedAssets={[]}\n        selectionType=\"single\"\n        assetType=\"file\"\n        accept={accept}\n        dialogHeaderTitle={t('inputs.file.dialog.title')}\n        onClose={this.handleAssetSourceClosed}\n        onSelect={this.handleSelectAssetFromSource}\n      />\n    )\n  }\n\n  handleSelectAssetFromSource = (assetFromSource: AssetFromSource[]) => {\n    const {onChange, schemaType, resolveUploader} = this.props\n    handleSelectAssetFromSource({\n      assetFromSource,\n      onChange,\n      type: schemaType,\n      resolveUploader,\n      uploadWith: this.uploadWith,\n    })\n    this.setState({selectedAssetSource: null})\n  }\n\n  handleFileTargetFocus = (event: React.FocusEvent) => {\n    // We want to handle focus when the file target element *itself* receives\n    // focus, not when an interactive child element receives focus. Since React has decided\n    // to let focus bubble, so this workaround is needed\n    // Background: https://github.com/facebook/react/issues/6410#issuecomment-671915381\n    if (\n      event.currentTarget === event.target &&\n      event.currentTarget === this.props.elementProps.ref?.current\n    ) {\n      this.props.elementProps.onFocus(event)\n    }\n  }\n\n  handleFilesOver = (fileInfo: FileInfo[]) => {\n    this.setState({\n      hoveringFiles: fileInfo,\n    })\n  }\n  handleFilesOut = () => {\n    this.setState({\n      hoveringFiles: [],\n    })\n  }\n\n  renderAsset() {\n    const {value, changed, readOnly, elementProps} = this.props\n    const {hoveringFiles, isStale} = this.state\n    const hasValueOrUpload = Boolean(value?._upload || value?.asset)\n\n    if (value && typeof value.asset !== 'undefined' && !value?._upload && !isFileSource(value)) {\n      return () => <InvalidFileWarning onClearValue={this.handleClearField} />\n    }\n\n    // todo: convert this to a functional component and use this with useCallback\n    //  it currently has to return a new function on every render in order to pick up state from this component\n    return (inputProps: Omit<InputProps, 'renderDefault'>) => (\n      <>\n        {isStale && (\n          <Box marginBottom={2}>\n            <UploadWarning onClearStale={this.handleClearUploadState} />\n          </Box>\n        )}\n        <ChangeIndicator\n          path={this._assetFieldPath}\n          hasFocus={!!inputProps.focused}\n          isChanged={changed}\n        >\n          {/* not uploading */}\n          {value?._upload ? (\n            this.renderUploadState(value._upload)\n          ) : (\n            <FileTarget\n              {...elementProps}\n              onFocus={this.handleFileTargetFocus}\n              tabIndex={0}\n              disabled={Boolean(readOnly)}\n              onFiles={this.handleSelectFiles}\n              onFilesOver={this.handleFilesOver}\n              onFilesOut={this.handleFilesOut}\n              tone={this.getFileTone()}\n              $border={hasValueOrUpload || hoveringFiles.length > 0}\n              style={{padding: 1}}\n              sizing=\"border\"\n              radius={2}\n            >\n              <div style={{position: 'relative'}}>\n                {!value?.asset && this.renderUploadPlaceholder()}\n                {value?.asset && hoveringFiles.length > 0\n                  ? this.renderAssetMenu(this.getFileTone())\n                  : null}\n                {!value?._upload && value?.asset && this.renderPreview()}\n              </div>\n            </FileTarget>\n          )}\n        </ChangeIndicator>\n      </>\n    )\n  }\n\n  renderPreview() {\n    const {value, readOnly, assetSources, schemaType, directUploads, observeAsset, t} = this.props\n    const {isMenuOpen} = this.state\n    const asset = value?.asset\n    if (!asset) {\n      return null\n    }\n\n    const accept = get(schemaType, 'options.accept', '')\n\n    let browseMenuItem: ReactNode =\n      assetSources && assetSources?.length === 0 ? null : (\n        <MenuItem\n          icon={SearchIcon}\n          text={t('inputs.file.browse-button.text')}\n          onClick={() => {\n            this.setState({isMenuOpen: false})\n            this.handleSelectFileFromAssetSource(assetSources[0])\n          }}\n          disabled={readOnly}\n          data-testid=\"file-input-browse-button\"\n        />\n      )\n\n    if (assetSources.length > 1) {\n      browseMenuItem = assetSources.map((assetSource) => {\n        return (\n          <MenuItem\n            key={assetSource.name}\n            text={\n              (assetSource.i18nKey ? t(assetSource.i18nKey) : assetSource.title) ||\n              startCase(assetSource.name)\n            }\n            onClick={() => {\n              this.setState({isMenuOpen: false})\n              this.handleSelectFileFromAssetSource(assetSource)\n            }}\n            icon={assetSource.icon || ImageIcon}\n            disabled={readOnly}\n            data-testid={`file-input-browse-button-${assetSource.name}`}\n          />\n        )\n      })\n    }\n\n    return (\n      <WithReferencedAsset\n        reference={asset}\n        observeAsset={observeAsset}\n        waitPlaceholder={<FileSkeleton />}\n      >\n        {({originalFilename, extension, url, size}) => {\n          const filename = originalFilename || `download.${extension}`\n          let copyUrl: string | undefined\n          let downloadUrl: string | undefined\n\n          if (isFileSource(value)) {\n            downloadUrl = `${url}?dl`\n            copyUrl = url\n          }\n\n          return (\n            <FileActionsMenu\n              size={size}\n              originalFilename={filename}\n              muted={!readOnly}\n              onMenuOpen={(isOpen) => this.setState({isMenuOpen: isOpen})}\n              isMenuOpen={isMenuOpen}\n              setMenuButtonElement={this.setBrowseButtonElement}\n            >\n              <ActionsMenu\n                onUpload={this.handleSelectFiles}\n                browse={browseMenuItem}\n                onReset={this.handleRemoveButtonClick}\n                downloadUrl={downloadUrl}\n                copyUrl={copyUrl}\n                readOnly={readOnly}\n                accept={accept}\n                directUploads={directUploads}\n              />\n            </FileActionsMenu>\n          )\n        }}\n      </WithReferencedAsset>\n    )\n  }\n\n  renderAssetMenu(tone: ThemeColorToneKey) {\n    const {schemaType, readOnly, directUploads, resolveUploader} = this.props\n    const {hoveringFiles} = this.state\n\n    const acceptedFiles = hoveringFiles.filter((file) => resolveUploader?.(schemaType, file))\n    const rejectedFilesCount = hoveringFiles.length - acceptedFiles.length\n\n    return (\n      <CardOverlay radius={2} tone={tone}>\n        <FlexContainer align=\"center\" justify=\"center\" gap={2} flex={1}>\n          <PlaceholderText\n            readOnly={readOnly}\n            hoveringFiles={hoveringFiles}\n            acceptedFiles={acceptedFiles}\n            rejectedFilesCount={rejectedFilesCount}\n            directUploads={directUploads}\n            type=\"file\"\n          />\n        </FlexContainer>\n      </CardOverlay>\n    )\n  }\n\n  renderBrowser() {\n    const {assetSources, readOnly, directUploads, id, t} = this.props\n\n    if (assetSources.length === 0) return null\n\n    if (assetSources.length > 1 && !readOnly && directUploads) {\n      return (\n        <MenuButton\n          id={`${id}_assetFileButton`}\n          ref={this.setBrowseButtonElement}\n          button={\n            <Button\n              mode=\"bleed\"\n              text={t('inputs.file.multi-browse-button.text')}\n              data-testid=\"file-input-multi-browse-button\"\n              icon={SearchIcon}\n            />\n          }\n          data-testid=\"input-select-button\"\n          menu={\n            <Menu>\n              {assetSources.map((assetSource) => {\n                return (\n                  <MenuItem\n                    key={assetSource.name}\n                    text={assetSource.title}\n                    onClick={() => {\n                      this.setState({isMenuOpen: false})\n                      this.handleSelectFileFromAssetSource(assetSource)\n                    }}\n                    icon={assetSource.icon || ImageIcon}\n                    disabled={readOnly}\n                    data-testid={`file-input-browse-button-${assetSource.name}`}\n                  />\n                )\n              })}\n            </Menu>\n          }\n        />\n      )\n    }\n\n    return (\n      <Button\n        text={t('inputs.file.browse-button.text')}\n        icon={SearchIcon}\n        mode=\"bleed\"\n        onClick={() => {\n          this.setState({isMenuOpen: false})\n          this.handleSelectFileFromAssetSource(assetSources[0])\n        }}\n        data-testid=\"file-input-browse-button\"\n        disabled={readOnly}\n        ref={this.setBrowseButtonElement}\n      />\n    )\n  }\n\n  renderUploadPlaceholder() {\n    const {readOnly, schemaType, directUploads, resolveUploader} = this.props\n    const {hoveringFiles} = this.state\n\n    const acceptedFiles = hoveringFiles.filter((file) => resolveUploader?.(schemaType, file))\n    const rejectedFilesCount = hoveringFiles.length - acceptedFiles.length\n\n    const accept = get(schemaType, 'options.accept', '')\n\n    return (\n      <>\n        <Card\n          tone={readOnly ? 'transparent' : 'inherit'}\n          border\n          paddingX={3}\n          paddingY={2}\n          radius={2}\n          style={\n            hoveringFiles.length === 0\n              ? {borderStyle: 'dashed'}\n              : {borderStyle: 'dashed', borderColor: 'transparent'}\n          }\n        >\n          <UploadPlaceholder\n            browse={this.renderBrowser()}\n            onUpload={this.handleSelectFiles}\n            readOnly={readOnly}\n            hoveringFiles={hoveringFiles}\n            acceptedFiles={acceptedFiles}\n            rejectedFilesCount={rejectedFilesCount}\n            type=\"file\"\n            accept={accept}\n            directUploads={directUploads}\n          />\n        </Card>\n      </>\n    )\n  }\n\n  handleUpload = ({file, uploader}: {file: globalThis.File; uploader: Uploader}) => {\n    this.uploadWith(uploader, file)\n  }\n\n  setToast = (toast: {push: (params: ToastParams) => void}) => {\n    this.toast = toast\n  }\n  getFileTone() {\n    const {directUploads, schemaType, value, readOnly, resolveUploader} = this.props\n    const {hoveringFiles} = this.state\n\n    const acceptedFiles = hoveringFiles.filter((file) => resolveUploader?.(schemaType, file))\n    const rejectedFilesCount = hoveringFiles.length - acceptedFiles.length\n\n    if (hoveringFiles.length > 0) {\n      if (rejectedFilesCount > 0 || !directUploads) {\n        return 'critical'\n      }\n    }\n\n    if (!value?._upload && !readOnly && hoveringFiles.length > 0) {\n      return 'primary'\n    }\n    return value?._upload && value?.asset && readOnly ? 'transparent' : 'default'\n  }\n\n  render() {\n    const {\n      members,\n      renderAnnotation,\n      renderBlock,\n      renderInlineBlock,\n      renderItem,\n      renderInput,\n      renderField,\n      renderPreview,\n      t,\n    } = this.props\n    const {selectedAssetSource} = this.state\n\n    return (\n      <>\n        <ImperativeToast ref={this.setToast} />\n\n        {members.map((member) => {\n          if (member.kind === 'field' && (member.name === 'crop' || member.name === 'hotspot')) {\n            // we're rendering these separately\n            return null\n          }\n\n          if (member.kind === 'field') {\n            return (\n              <MemberField\n                key={member.key}\n                member={member}\n                renderAnnotation={renderAnnotation}\n                renderInlineBlock={renderInlineBlock}\n                renderBlock={renderBlock}\n                renderInput={member.name === 'asset' ? this.renderAsset() : renderInput}\n                renderField={member.name === 'asset' ? passThrough : renderField}\n                renderItem={renderItem}\n                renderPreview={renderPreview}\n              />\n            )\n          }\n          if (member.kind === 'fieldSet') {\n            return (\n              <MemberFieldSet\n                key={member.key}\n                member={member}\n                renderAnnotation={renderAnnotation}\n                renderBlock={renderBlock}\n                renderField={renderField}\n                renderInlineBlock={renderInlineBlock}\n                renderInput={renderInput}\n                renderItem={renderItem}\n                renderPreview={renderPreview}\n              />\n            )\n          }\n          if (member.kind === 'error') {\n            return <MemberFieldError key={member.key} member={member} />\n          }\n          //@ts-expect-error all possible cases should be covered\n          return <>{t('inputs.file.error.unknown-member-kind', {kind: member.kind})}</>\n        })}\n        {selectedAssetSource && this.renderAssetSource()}\n      </>\n    )\n  }\n}\n","import {type SchemaType} from '@sanity/types'\nimport {useCallback, useMemo} from 'react'\n\nimport {useClient} from '../../../hooks'\nimport {useTranslation} from '../../../i18n'\nimport {useDocumentPreviewStore} from '../../../store'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../studioClient'\nimport {BaseFileInput, type BaseFileInputProps} from '../../inputs/files/FileInput'\nimport {useFormBuilder} from '../../useFormBuilder'\nimport {resolveUploader as defaultResolveUploader} from '../uploads/resolveUploader'\nimport {type FileLike} from '../uploads/types'\nimport {observeFileAsset} from './client-adapters/assets'\n\n/**\n * @hidden\n * @beta */\nexport type FileInputProps = Omit<\n  BaseFileInputProps,\n  'assetSources' | 'directUploads' | 'observeAsset' | 'resolveUploader' | 'client' | 't'\n>\n\n/**\n * @hidden\n * @beta */\nexport function StudioFileInput(props: FileInputProps) {\n  const sourcesFromSchema = props.schemaType.options?.sources\n  const documentPreviewStore = useDocumentPreviewStore()\n  const {file: fileConfig} = useFormBuilder().__internal\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const {t} = useTranslation()\n\n  const resolveUploader = useCallback(\n    (type: SchemaType, file: FileLike) => {\n      if (!fileConfig.directUploads) {\n        return null\n      }\n      return defaultResolveUploader(type, file)\n    },\n    [fileConfig.directUploads],\n  )\n  // NOTE: type.options.sources may be an empty array and in that case we're\n  // disabling selecting images from asset source  (it's a feature, not a bug)\n  const assetSources = useMemo(\n    () => sourcesFromSchema || fileConfig.assetSources,\n    [fileConfig, sourcesFromSchema],\n  )\n\n  const observeAsset = useCallback(\n    (id: string) => observeFileAsset(documentPreviewStore, id),\n    [documentPreviewStore],\n  )\n\n  return (\n    <BaseFileInput\n      {...props}\n      t={t}\n      client={client}\n      assetSources={assetSources}\n      directUploads={fileConfig.directUploads}\n      observeAsset={observeAsset}\n      resolveUploader={resolveUploader}\n    />\n  )\n}\n","import {Box} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const RatioBox = styled(Box)<{ratio?: number}>`\n  position: relative;\n  padding-bottom: calc(${({ratio = 3 / 2}) => 1 / ratio} * 100%);\n\n  & > div {\n    position: absolute;\n    top: ${({padding = 0}) => padding}px;\n    left: ${({padding = 0}) => padding}px;\n    right: ${({padding = 0}) => padding}px;\n    bottom: ${({padding = 0}) => padding}px;\n  }\n`\n","import {type Crop, type Hotspot} from './types'\n\nexport const DEFAULT_HOTSPOT: Hotspot = {\n  x: 0.5,\n  y: 0.5,\n  height: 1,\n  width: 1,\n}\n\nexport const DEFAULT_CROP: Crop = {\n  top: 0,\n  left: 0,\n  right: 0,\n  bottom: 0,\n}\n","import {type CSSProperties} from 'react'\n\nimport {DEFAULT_CROP, DEFAULT_HOTSPOT} from './constants'\nimport {type Crop, type CropAndHotspot, type CropMethod, type Hotspot} from './types'\n\ninterface Options {\n  image?: {aspectRatio: number} | {height: number; width: number}\n  container?: {aspectRatio: number} | {height: number; width: number}\n  hotspot?: Hotspot\n  crop?: Crop\n  align?: CropAlignment\n}\n\ninterface CSSBox {\n  width: number\n  height: number\n  left: number\n  top: number\n}\n\ninterface CropAlignment {\n  x: 'left' | 'right' | 'center'\n  y: 'top' | 'bottom' | 'center'\n}\n\ninterface HotspotCropStyleResult {\n  crop: CSSBox\n  image: CSSBox\n  method: CropMethod\n}\n\nexport interface CalculatedStyles {\n  container: CSSProperties\n  padding: CSSProperties\n  crop: CSSProperties\n  image: CSSProperties\n  debug: {\n    result: HotspotCropStyleResult\n  }\n}\n\nexport function calculateStyles(options: Options = {}): CalculatedStyles {\n  const imageAspect = readAspectRatio(options.image) || 1\n\n  const hotspot = options.hotspot || DEFAULT_HOTSPOT\n  const crop = options.crop || DEFAULT_CROP\n  const containerAspect = readAspectRatio(options.container) || imageAspect * readCropAspect(crop)\n\n  const align = options.align || {x: 'center', y: 'center'}\n\n  const result = calculateHotSpotCrop(\n    imageAspect,\n    {hotspot, crop},\n    {aspect: containerAspect, align},\n  )\n\n  const containerHeight = styleFormat(round(100 / containerAspect))\n\n  return {\n    debug: {\n      result,\n    },\n    container: {\n      //outline: '1px solid cyan',\n      overflow: 'hidden',\n      position: 'relative',\n      width: '100%',\n      height: containerHeight,\n    },\n    padding: {\n      marginTop: containerHeight,\n    },\n    crop: {\n      position: 'absolute',\n      overflow: 'hidden',\n      height: toStylePercentage(result.crop.height),\n      width: toStylePercentage(result.crop.width),\n      top: toStylePercentage(result.crop.top),\n      left: toStylePercentage(result.crop.left),\n    },\n    image: {\n      position: 'absolute',\n      height: toStylePercentage(result.image.height),\n      width: toStylePercentage(result.image.width),\n      top: toStylePercentage(result.image.top),\n      left: toStylePercentage(result.image.left),\n    },\n  }\n}\n\nfunction readAspectRatio(opts: Options['image']): number | null {\n  if (!opts) {\n    return null\n  }\n\n  if ('aspectRatio' in opts) {\n    return opts.aspectRatio\n  }\n\n  if ('height' in opts || 'width' in opts) {\n    if (typeof opts.height !== 'number' && typeof opts.width !== 'number') {\n      throw new Error(`Height and width must be numbers, got ${JSON.stringify(opts)}`)\n    }\n\n    return opts.width / opts.height\n  }\n\n  return null\n}\n\nfunction round(num: number, decimals = 2): number {\n  const multiplier = Math.pow(10, decimals)\n  return Math.round(num * multiplier) / multiplier\n}\n\nfunction calculateHotSpotCrop(\n  sourceAspect: number,\n  descriptor: CropAndHotspot,\n  spec: {aspect: number; align: CropAlignment},\n): HotspotCropStyleResult {\n  const crop = descriptor.crop\n  const viewportAspect = spec.aspect\n  const alignment = spec.align\n\n  // The rational aspect of the cropped image\n  const netWidth = 1.0 - crop.left - crop.right\n  const netHeight = 1.0 - crop.top - crop.bottom\n\n  // Places the image inside the crop box\n  const outImg = {\n    top: -crop.top / netHeight,\n    left: -crop.left / netWidth,\n    width: 1 / netWidth,\n    height: 1 / netHeight,\n  }\n\n  // The rational aspect is the aspect ration of the crop in ratios of the image size meaning the image\n  // is always considered having the size 1.0*1.0\n  const cropRationalAspect = netWidth / netHeight\n\n  // cropAspect is the real aspect ratio of the crop box in pixel-space\n  const cropAspect = cropRationalAspect * sourceAspect\n\n  // Now we transform the hotspot to be expressed in ratios of the cropped area, not the\n  // full image:\n  const hotspot = {\n    x: (descriptor.hotspot.x - crop.left) / netWidth,\n    y: (descriptor.hotspot.y - crop.top) / netHeight,\n    height: descriptor.hotspot.height / netHeight,\n    width: descriptor.hotspot.width / netWidth,\n  }\n\n  // Lets calculate the maximum scale the image may be presented at without cropping the hotspot. A scale of\n  // 1.0 means the cropped image exactly fill the width of the viewport.\n\n  // The scale at which the hotspot would fill the viewport exactly in the X direction\n  const maxHotspotXScale = 1.0 / hotspot.width\n  // The scale at which the hotspot would fill the veiwport exactly in the Y direction\n  const maxHotspotYScale = ((1.0 / hotspot.height) * cropAspect) / viewportAspect\n  // This is the largest scale the image can have while still not cropping the hotspot:\n  const maxScale = Math.min(maxHotspotXScale, maxHotspotYScale)\n\n  // Now lets find the minimum scale we can have while maintaining full bleed (no letterboxing)\n  let minFullBleedScale\n  const cropIsTaller = cropAspect <= viewportAspect\n  if (cropIsTaller) {\n    // Crop is taller than viewport\n    minFullBleedScale = 1.0 // By definition 1.0 fills the width of the viewport exactly with the viewport cutting away from the height of the cropbox\n  } else {\n    // Image is wider than viewport\n    minFullBleedScale = cropAspect / viewportAspect // At this scale the viewport is filled exactly in the height while cutting away from the sides\n  }\n\n  let method: CropMethod\n  let outCrop: CSSBox\n\n  // Do we have to letterbox this image in order to leave the hotspot area uncropped?\n  if (minFullBleedScale > maxScale) {\n    // Yes :-( There is no way to protect the hot spot and still have full bleed, so we are letterboxing it\n    method = 'letterbox'\n    let letterboxScale\n    const diff = minFullBleedScale - maxScale\n\n    // Determine a scale where the image fills one dimension of the container\n    if (cropIsTaller) {\n      letterboxScale = 1.0 - diff\n    } else {\n      letterboxScale = maxScale\n    }\n\n    outCrop = {\n      width: letterboxScale,\n      height: (letterboxScale / cropAspect) * viewportAspect,\n\n      // Gets overwritten further down\n      left: 0,\n      top: 0,\n    }\n\n    const hotspotLeft = hotspot.x * outCrop.width - (hotspot.width * outCrop.width) / 2\n    switch (alignment.x) {\n      case 'left':\n        outCrop.left = cropIsTaller ? 0 : -hotspotLeft\n        break\n      case 'right':\n        // todo: broken atm\n        outCrop.left = cropIsTaller ? 1 - outCrop.width : hotspotLeft\n        break\n      case 'center':\n        outCrop.left = cropIsTaller ? (1 - outCrop.width) / 2 : -hotspotLeft\n        break\n      default:\n        throw new Error(\n          `Invalid x alignment: '${alignment.x}'. Must be either 'left', 'right' or 'center'`,\n        )\n    }\n    const hotspotTop = hotspot.y * outCrop.height - (hotspot.height * outCrop.height) / 2\n    switch (alignment.y) {\n      case 'top':\n        outCrop.top = cropIsTaller ? -hotspotTop : 0\n        break\n      case 'bottom':\n        // todo: broken atm\n        outCrop.top = hotspotTop\n        break\n      case 'center':\n        outCrop.top = cropIsTaller ? -hotspotTop : (1 - outCrop.height) / 2\n        break\n      default:\n        throw new Error(\n          `Invalid y alignment: '${alignment.y}'. Must be either 'top', 'bottom' or 'center'`,\n        )\n    }\n  } else if (cropIsTaller) {\n    // TODO: Clamp hotspot offset to avoid moving image off canvas\n    method = 'full_width'\n\n    let top = (-hotspot.y / cropAspect) * viewportAspect + 0.5\n    const height = (minFullBleedScale / cropAspect) * viewportAspect\n    // Clamp top so that we will not move the image off of the viewport\n    if (top > 0) {\n      top = 0\n    } else if (-top > height - 1.0) {\n      top = -(height - 1.0)\n    }\n\n    outCrop = {\n      width: minFullBleedScale,\n      height,\n      left: 0,\n      // Place the Y center of the hotspot near the center of the viewport\n      top,\n    }\n  } else {\n    // crop is wider\n    method = 'full_height'\n\n    const width = minFullBleedScale\n    let left = 0.5 - hotspot.x * minFullBleedScale\n    if (left > 0) {\n      left = 0\n    } else if (-left > width - 1.0) {\n      left = -(width - 1.0)\n    }\n    // Clamp left so that we will not move the image off of the viewport.\n    outCrop = {\n      width,\n      height: (minFullBleedScale / cropAspect) * viewportAspect,\n      top: 0,\n      // Place the X center of the hotspot at the center of the viewport\n      left,\n    }\n  }\n\n  return {\n    method,\n    crop: outCrop,\n    image: outImg,\n  }\n}\n\nfunction readCropAspect(crop: Crop) {\n  const height = 1 - crop.top - crop.bottom\n  const width = 1 - crop.left - crop.right\n  return width / height\n}\n\nfunction styleFormat(num: number) {\n  return num === 0 ? 0 : `${num}%`\n}\n\nfunction toStylePercentage(num: number) {\n  return styleFormat(round(num * 100))\n}\n","import styled from 'styled-components'\n\nexport const HotspotImageContainer = styled.div`\n  position: relative;\n  width: 100%;\n`\n","import Debug from 'debug'\nimport {\n  type CSSProperties,\n  memo,\n  startTransition,\n  type SyntheticEvent,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\n\nimport {calculateStyles} from './calculateStyles'\nimport {DEFAULT_CROP, DEFAULT_HOTSPOT} from './constants'\nimport {HotspotImageContainer} from './HotspotImage.styles'\nimport {type Crop, type Hotspot} from './types'\n\nconst debug = Debug('sanity-imagetool')\n\nfunction getCropAspect(crop: Crop, srcAspect: number) {\n  const origHeight = 1 / srcAspect\n  const origWidth = srcAspect * origHeight\n  const cropWidth = origWidth - (crop.left + crop.right) * origWidth\n  const cropHeight = origHeight - (crop.top + crop.bottom) * origHeight\n  return cropWidth / cropHeight\n}\n\nexport interface HotspotImageProps {\n  src: string\n  srcAspectRatio: number\n  srcSet?: string\n  hotspot?: Hotspot\n  crop?: Crop\n  aspectRatio?: number | 'auto' | 'none'\n  alignX?: 'left' | 'center' | 'right'\n  alignY?: 'top' | 'center' | 'bottom'\n  className?: string\n  style?: CSSProperties\n  alt?: string\n  onError?: (event: SyntheticEvent<HTMLImageElement, Event>) => void\n  onLoad?: () => void\n}\n\nexport const HotspotImage = memo(function HotspotImage(props: HotspotImageProps) {\n  const {\n    alignX = 'center',\n    alignY = 'center',\n    alt,\n    aspectRatio = 'none',\n    className = '',\n    crop = DEFAULT_CROP,\n    hotspot = DEFAULT_HOTSPOT,\n    onError,\n    onLoad,\n    src,\n    srcAspectRatio,\n    srcSet,\n    style,\n  } = props\n  const [containerAspect, setContainerAspect] = useState<number | null>(null)\n  const containerElementRef = useRef<HTMLDivElement | null>(null)\n  const imageElementRef = useRef<HTMLImageElement | null>(null)\n\n  const updateContainerAspect = useCallback(() => {\n    if (!containerElementRef.current) return\n    if (aspectRatio === 'auto') {\n      const parentNode = containerElementRef.current.parentNode as HTMLElement\n      startTransition(() => setContainerAspect(parentNode.offsetWidth / parentNode.offsetHeight))\n    } else {\n      setContainerAspect(null)\n    }\n  }, [aspectRatio])\n\n  useEffect(() => {\n    const imageElement = imageElementRef.current\n\n    // Fixes issues that may happen if the component is rendered on server and mounted after the image has finished loading\n    // In these situations, neither the onLoad or the onError events will be called.\n    // Derived from http://imagesloaded.desandro.com/\n    const alreadyLoaded =\n      imageElement &&\n      imageElement.src &&\n      imageElement.complete &&\n      imageElement.naturalWidth !== undefined\n\n    if (alreadyLoaded) {\n      debug(\"Image '%s' already loaded, refreshing (from cache) to trigger onLoad / onError\", src)\n      // eslint-disable-next-line no-self-assign\n      imageElement.src = imageElement.src\n    }\n\n    updateContainerAspect()\n\n    window.addEventListener('resize', updateContainerAspect)\n\n    return () => {\n      window.removeEventListener('resize', updateContainerAspect)\n    }\n  }, [src, updateContainerAspect])\n\n  const targetAspect = useMemo(() => {\n    if (aspectRatio === 'none') {\n      return crop ? getCropAspect(crop, srcAspectRatio) : srcAspectRatio\n    }\n\n    if (aspectRatio === 'auto') {\n      return containerAspect\n    }\n\n    return aspectRatio || null\n  }, [aspectRatio, containerAspect, crop, srcAspectRatio])\n\n  const targetStyles = useMemo(\n    () =>\n      calculateStyles({\n        container: {aspectRatio: targetAspect || srcAspectRatio},\n        image: {aspectRatio: srcAspectRatio},\n        hotspot,\n        crop,\n        align: {\n          x: alignX,\n          y: alignY,\n        },\n      }),\n    [alignX, alignY, crop, hotspot, srcAspectRatio, targetAspect],\n  )\n\n  return (\n    <HotspotImageContainer className={`${className}`} style={style} ref={containerElementRef}>\n      <div style={targetStyles.container}>\n        <div style={targetStyles.padding} />\n        <div style={targetStyles.crop}>\n          <img\n            ref={imageElementRef}\n            src={src}\n            alt={alt}\n            srcSet={srcSet}\n            onLoad={onLoad}\n            onError={onError}\n            style={targetStyles.image}\n          />\n        </div>\n      </div>\n    </HotspotImageContainer>\n  )\n})\n","/* eslint-disable @typescript-eslint/no-shadow */\nimport {type ReactElement, useEffect, useState} from 'react'\n\ninterface ImageLoaderProps {\n  src: string\n  children: (props: {\n    isLoading: boolean\n    image: HTMLImageElement | null\n    error: Error | null\n  }) => ReactElement | null\n}\n\nexport function ImageLoader(props: ImageLoaderProps) {\n  const {src, children} = props\n  const [isLoading, setIsLoading] = useState(true)\n  const [image, setImage] = useState<HTMLImageElement | null>(null)\n  const [error, setError] = useState<Error | null>(null)\n\n  useEffect(() => {\n    setImage(null)\n    setError(null)\n    setIsLoading(true)\n\n    const image = new Image()\n\n    image.onload = () => {\n      setImage(image)\n      setError(null)\n      setIsLoading(false)\n    }\n\n    image.onerror = () => {\n      setError(new Error(`Could not load image from ${JSON.stringify(src)}`))\n      setIsLoading(false)\n    }\n\n    image.referrerPolicy = 'strict-origin-when-cross-origin'\n    image.src = src\n  }, [src])\n\n  return children({image, error, isLoading})\n}\n","/* eslint-disable @typescript-eslint/no-shadow */\nimport {type ReactNode, useCallback, useEffect, useState} from 'react'\n\nexport interface ResizeProps {\n  image: HTMLImageElement\n  maxHeight: number\n  maxWidth: number\n  children: (canvas: HTMLCanvasElement) => ReactNode\n}\n\nexport function Resize(props: ResizeProps): any {\n  const {image, maxHeight, maxWidth, children} = props\n\n  const [canvas] = useState<HTMLCanvasElement>(() => {\n    const canvasElement = document.createElement('canvas')\n    canvasElement.style.display = 'none'\n    return canvasElement\n  })\n  useEffect(() => {\n    document.body.appendChild(canvas)\n    return () => {\n      document.body.removeChild(canvas)\n    }\n  }, [canvas])\n\n  const resize = useCallback(\n    (image: HTMLImageElement, maxHeight: number, maxWidth: number) => {\n      const ratio = image.width / image.height\n      const width = Math.min(image.width, maxWidth)\n      const height = Math.min(image.height, maxHeight)\n\n      const landscape = image.width > image.height\n      const targetWidth = landscape ? width : height * ratio\n      const targetHeight = landscape ? width / ratio : height\n\n      canvas.width = targetWidth\n      canvas.height = targetHeight\n\n      const ctx = canvas.getContext('2d')\n      if (ctx) {\n        ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, targetWidth, targetHeight)\n      }\n\n      return canvas\n    },\n    [canvas],\n  )\n\n  return children(resize(image, maxHeight, maxWidth))\n}\n","import {type Crop} from '../types'\n\nexport class Size {\n  height: number\n  width: number\n  constructor(height: number, width: number) {\n    this.height = height\n    this.width = width\n  }\n}\nexport class Point {\n  x: number\n  y: number\n  constructor(x: number, y: number) {\n    this.x = x\n    this.y = y\n  }\n}\n\nclass HLine {\n  y: number\n  _left: number\n  _right: number\n  constructor(y: number, left: number, right: number) {\n    this.y = y\n    this._left = left\n    this._right = right\n  }\n\n  get right() {\n    return new Point(this._right, this.y)\n  }\n\n  get left() {\n    return new Point(this._left, this.y)\n  }\n\n  get length() {\n    return this._right - this._left\n  }\n}\n\nclass Corners {\n  rect: Rect\n  constructor(rect: Rect) {\n    this.rect = rect\n  }\n\n  get top() {\n    return new HLine(this.rect.top, this.rect.left, this.rect.right)\n  }\n\n  get bottom() {\n    return new HLine(this.rect.bottom, this.rect.left, this.rect.right)\n  }\n}\n\nexport class Rect {\n  left: number\n  top: number\n  width: number\n  height: number\n  // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n  static fromEdges({left, right, top, bottom}: Crop) {\n    return new Rect(left, top, 1 - left - right, 1 - top - bottom)\n  }\n\n  constructor(left = 0, top = 0, width = 0, height = 0) {\n    this.left = left\n    this.top = top\n    this.width = width\n    this.height = height\n  }\n\n  setTopLeft(left: number | undefined, top: number | undefined): Rect {\n    return new Rect(left, top, this.width || 0, this.height || 0)\n  }\n\n  setSize(width: number | undefined, height: number | undefined): Rect {\n    return new Rect(this.left || 0, this.top || 0, width, height)\n  }\n\n  setCenter(x: number, y: number): Rect {\n    const width = this.width || 0\n    const height = this.height || 0\n    return new Rect(x - width / 2, y - height / 2, width || 0, height || 0)\n  }\n\n  get center(): Point {\n    return new Point(this.left + this.width / 2, this.top + this.height / 2)\n  }\n\n  get corners(): Corners {\n    return new Corners(this)\n  }\n\n  get right(): number {\n    return this.left + this.width\n  }\n\n  get bottom(): number {\n    return this.top + this.height\n  }\n\n  multiply(rect: Rect): Rect {\n    return new Rect(\n      (this.left || 0) + this.width * rect.left,\n      (this.top || 0) + this.height * rect.top,\n      this.width * rect.width,\n      this.height * rect.height,\n    )\n  }\n\n  grow(delta: number): Rect {\n    return new Rect(\n      this.left - delta,\n      this.top - delta,\n      this.width + delta * 2,\n      this.height + delta * 2,\n    )\n  }\n\n  shrink(delta: number): Rect {\n    return this.grow(-delta)\n  }\n\n  cropRelative(crop: Rect): Rect {\n    const top = this.top + crop.top * this.height\n    const left = this.left + crop.left * this.width\n    const height = this.height * crop.height\n    const width = this.width * crop.width\n    return new Rect(left, top, width, height)\n  }\n\n  clamp(bounds: Rect): Rect {\n    // always try to fit the whole rect inside given bounds\n    // adjust top, left if we can, resize if we must\n    let {left, top, width, height} = this\n    if (bounds.width < width) {\n      width = bounds.width\n      left = bounds.left\n    }\n    if (bounds.height < height) {\n      height = bounds.height\n      top = bounds.top\n    }\n\n    if (left + width > bounds.left + bounds.width) {\n      left = bounds.right - width\n    }\n\n    if (top + height > bounds.top + bounds.height) {\n      top = bounds.bottom - height\n    }\n\n    return new Rect(Math.max(left, bounds.left), Math.max(top, bounds.top), width, height)\n  }\n}\n","import {type Coordinate} from '../types'\nimport {type Rect} from './shapes'\n\nexport function isPointInEllipse(point: Coordinate, ellipse: Rect): boolean {\n  const center = {x: ellipse.center.x, y: ellipse.center.y}\n  const xradius = ellipse.width / 2\n  const yradius = ellipse.height / 2\n\n  if (xradius <= 0 || yradius <= 0) {\n    return false\n  }\n\n  const normalized = {x: point.x - center.x, y: point.y - center.y}\n\n  return (\n    Math.pow(normalized.x, 2) / Math.pow(xradius, 2) +\n      Math.pow(normalized.y, 2) / Math.pow(yradius, 2) <=\n    1\n  )\n}\n\nexport function isPointInCircle(\n  {x, y}: Coordinate,\n  circle: Coordinate & {radius: number},\n): boolean {\n  return Math.pow(x - circle.x, 2) + Math.pow(y - circle.y, 2) < Math.pow(circle.radius, 2)\n}\n\nexport function isPointInRect(point: Coordinate, rect: Rect): boolean {\n  return (\n    point.x >= rect.left &&\n    point.x <= rect.left + rect.width &&\n    point.y >= rect.top &&\n    point.y <= rect.top + rect.height\n  )\n}\n\nexport function getPointAtCircumference(radians: number, ellipse: Rect): Coordinate {\n  return {\n    x: ellipse.center.x - (ellipse.width / 2) * Math.cos(radians),\n    y: ellipse.center.y - (ellipse.height / 2) * Math.sin(radians),\n  }\n}\n","/* eslint-disable max-len */\n\nexport const OPEN_HAND =\n  'data:image/png;base64,AAACAAEAICACAAcABQAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAA//AAAd/wAAGf+AAAH9gAADbYAAA2yAAAZsAAAGbAAAAGAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//4AB//8AAf//AAD//5AA///gAP//4AD//8AF///AB///5A////5///8='\n\nexport const CLOSE_HAND =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAABdSURBVEjH7ZA7DsAwCEMN6v2vTCdESpLKQRl5gxfzMQDNRQyWlEK83QAIRh3cH/QbIhQwMDl8gORl7A16WD/xxAdq6N6SgycKUblf41+wbFBT44RiCi11NU3TLHgBxRUUD4ITqnIAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMDEtMjFUMDA6MTM6NDMrMDE6MDC74T7AAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDEyLTA0LTAyVDA0OjEzOjM3KzAyOjAwQJ35wQAAAABJRU5ErkJggg=='\n","const testProperties = ['', 'webkit', 'moz', 'ms', 'o'].map(\n  (prefix) => `${prefix}backingStoreRatio`,\n)\nlet foundProperty: number | string | undefined = -1\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function getBackingStoreRatio(context: CanvasRenderingContext2D) {\n  if (foundProperty === -1) {\n    foundProperty = testProperties.find((testProperty) => testProperty in context)\n  }\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  //@ts-ignore\n  return foundProperty && context[foundProperty]\n}\n","import Debug from 'debug'\nimport {type PointerEvent, PureComponent} from 'react'\n\nimport {type Coordinate} from './types'\n\nconst debug = Debug('sanity-imagetool')\n\ntype PositionableEvent = globalThis.PointerEvent | PointerEvent<HTMLElement>\n\n// Returns a component that emits `onDragStart, `onDrag` and `onDragEnd` events.\n// Pointer events are used which handles mouse/touch events the same way.\n// - `onDragStart` is called with the {x, y} positions relative from the dom node (e.g. where the pointerdown event happened)\n// - `onDrag` and `onDragEnd` are both called with the {x, y} difference from the previous position\nexport interface DragAwareProps {\n  onDragStart: (pos: {x: number; y: number}) => void\n  onDrag: (pos: {x: number; y: number}) => void\n  onDragEnd: (pos: {x: number; y: number}) => void\n  readOnly?: boolean\n  [key: string]: unknown | undefined\n}\n\nexport function makeDragAware(Component: 'canvas') {\n  return class DragAware extends PureComponent<DragAwareProps> {\n    domNode: HTMLCanvasElement | null = null\n    currentPos: Coordinate | null = null\n    isDragging = false\n\n    componentDidMount() {\n      document.body.addEventListener('pointermove', this.handleDrag)\n      document.body.addEventListener('pointerup', this.handleDragEnd)\n      document.body.addEventListener('pointerleave', this.handleDragCancel)\n      document.body.addEventListener('pointercancel', this.handleDragCancel)\n    }\n\n    componentWillUnmount() {\n      document.body.removeEventListener('pointermove', this.handleDrag)\n      document.body.removeEventListener('pointerup', this.handleDragEnd)\n      document.body.removeEventListener('pointerleave', this.handleDragCancel)\n      document.body.removeEventListener('pointercancel', this.handleDragCancel)\n    }\n\n    handleDragStart = (event: PositionableEvent) => {\n      const {onDragStart, readOnly} = this.props\n\n      if (readOnly || !this.domNode) {\n        return\n      }\n\n      if (this.isDragging) {\n        debug('Start cancelled, already a drag in progress')\n        return\n      }\n\n      this.isDragging = true\n      const nextPos = getPos(event)\n      debug('Drag started %o', nextPos)\n      onDragStart(\n        getPositionRelativeToRect(nextPos.x, nextPos.y, this.domNode.getBoundingClientRect()),\n      )\n\n      this.currentPos = nextPos\n    }\n\n    handleDrag = (event: PositionableEvent) => {\n      if (!this.isDragging || this.props.readOnly || !this.currentPos) {\n        return\n      }\n\n      const {onDrag} = this.props\n      const nextPos = getPos(event)\n      const diff = diffPos(nextPos, this.currentPos)\n      onDrag(diff)\n      debug('moving by %o', diff)\n      this.currentPos = nextPos\n    }\n\n    handleDragEnd = (event: PositionableEvent) => {\n      const {onDragEnd, readOnly} = this.props\n      if (!this.isDragging || readOnly || !this.domNode) {\n        return\n      }\n      const nextPos = getPos(event)\n      onDragEnd(\n        getPositionRelativeToRect(nextPos.x, nextPos.y, this.domNode.getBoundingClientRect()),\n      )\n      this.isDragging = false\n      this.currentPos = null\n      debug('Done moving %o', nextPos)\n    }\n\n    handleDragCancel = () => {\n      if (!this.isDragging || this.props.readOnly || !this.currentPos || !this.domNode) {\n        return\n      }\n\n      const {onDragEnd} = this.props\n      this.isDragging = false\n      onDragEnd(\n        getPositionRelativeToRect(\n          this.currentPos.x,\n          this.currentPos.y,\n          this.domNode.getBoundingClientRect(),\n        ),\n      )\n\n      this.currentPos = null\n    }\n\n    setDomNode = (node: HTMLCanvasElement) => {\n      this.domNode = node\n    }\n\n    render() {\n      const {readOnly, onDragStart, onDragEnd, onDrag, ...rest} = this.props\n      return (\n        <Component\n          ref={this.setDomNode}\n          onPointerDown={readOnly ? undefined : this.handleDragStart}\n          onPointerMove={readOnly ? undefined : this.handleDrag}\n          {...rest}\n        />\n      )\n    }\n  }\n}\n\nfunction getPositionRelativeToRect(x: number, y: number, rect: {left: number; top: number}) {\n  return {\n    x: x - rect.left,\n    y: y - rect.top,\n  }\n}\n\nfunction getPos(event: PositionableEvent): Coordinate {\n  return {\n    x: event.clientX,\n    y: event.clientY,\n  }\n}\n\nfunction diffPos(pos: Coordinate, otherPos: Coordinate): Coordinate {\n  return {\n    x: pos.x - otherPos.x,\n    y: pos.y - otherPos.y,\n  }\n}\n","import styled from 'styled-components'\n\nimport {makeDragAware} from './makeDragAware'\n\nexport const DragAwareCanvas = makeDragAware('canvas')\n\nexport const RootContainer = styled.div`\n  width: 100%;\n  height: 100%;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`\n\nexport const CanvasContainer = styled(DragAwareCanvas)`\n  display: block;\n  position: relative;\n  max-width: calc(100% - 0.5em); /* to prevent overlap with change bar */\n  max-height: calc(100% + 1em);\n  user-select: none;\n  // Enable only multi-finger panning and zooming within this element.\n  // This prevents single finger panning when manipulating drag handles,\n  // which can cause unwanted scrolling in the underlying document body.\n  touch-action: pinch-zoom;\n`\n","import {memoize} from 'lodash'\nimport {type PointerEvent, PureComponent} from 'react'\n\nimport {Rect} from './2d/shapes'\nimport * as utils2d from './2d/utils'\nimport {DEFAULT_CROP, DEFAULT_HOTSPOT} from './constants'\nimport * as cursors from './cursors'\nimport {getBackingStoreRatio} from './getBackingStoreRatio'\nimport {CanvasContainer, RootContainer} from './ToolCanvas.styles'\nimport {\n  type Coordinate,\n  type Crop,\n  type CropAndHotspot,\n  type CropHandles,\n  type Dimensions,\n  type Hotspot,\n  type Offsets,\n  type ToolCanvasProps,\n  type ToolCanvasState,\n} from './types'\n\n// The margin available in all directions for drawing the crop tool\nconst MARGIN_PX = 8\nconst CROP_HANDLE_SIZE = 12\nconst HOTSPOT_HANDLE_SIZE = 10\n\nfunction normalizeRect(rect: Rect) {\n  const flippedY = rect.top > rect.bottom\n  const flippedX = rect.left > rect.right\n  return {\n    top: flippedY ? rect.bottom : rect.top,\n    bottom: flippedY ? rect.top : rect.bottom,\n    left: flippedX ? rect.right : rect.left,\n    right: flippedX ? rect.left : rect.right,\n  }\n}\n\nfunction checkCropBoundaries(value: Partial<CropAndHotspot>, delta: Offsets) {\n  // Make the experience a little better. Still offsets when dragging back from outside\n  if (\n    !value ||\n    !value.crop ||\n    value.crop.top + delta.top < 0 ||\n    value.crop.left + delta.left < 0 ||\n    value.crop.right + delta.right < 0 ||\n    value.crop.bottom + delta.bottom < 0\n  ) {\n    return false\n  }\n  return true\n}\n\nfunction limitToBoundaries(value: Partial<CropAndHotspot>, delta: Offsets) {\n  const {top, right, bottom, left} = value.crop || DEFAULT_CROP\n\n  const newValue = {\n    hotspot: value.hotspot,\n    crop: {\n      top: top + (delta.top || 0) > 0 ? top : 0,\n      right: right + (delta.right || 0) > 0 ? right : 0,\n      bottom: bottom + (delta.bottom || 0) > 0 ? bottom : 0,\n      left: left + (delta.left || 0) > 0 ? left : 0,\n    },\n  }\n\n  const newDelta = {\n    top: top + (delta.top || 0) > 0 ? delta.top || 0 : 0,\n    right: right + (delta.right || 0) > 0 ? delta.right || 0 : 0,\n    bottom: bottom + (delta.bottom || 0) > 0 ? delta.bottom || 0 : 0,\n    left: left + (delta.left || 0) > 0 ? delta.left || 0 : 0,\n  }\n\n  return {value: newValue, delta: newDelta}\n}\n\nfunction getCropCursorForHandle(handle: keyof CropHandles | boolean) {\n  switch (handle) {\n    case 'left':\n    case 'right':\n      return 'col-resize'\n\n    case 'top':\n    case 'bottom':\n      return 'row-resize'\n\n    case 'topRight':\n    case 'bottomLeft':\n      return 'nesw-resize'\n\n    case 'topLeft':\n    case 'bottomRight':\n      return 'nwse-resize'\n    default:\n      return null\n  }\n}\n\nconst getDevicePixelRatio = memoize(() => {\n  const devicePixelRatio = window.devicePixelRatio || 1\n  const ctx = document.createElement('canvas').getContext('2d')\n  const backingStoreRatio = (ctx && getBackingStoreRatio(ctx)) || 1\n  return devicePixelRatio / backingStoreRatio\n})\n\nconst cropHandleKeys: (keyof CropHandles)[] = [\n  'left',\n  'right',\n  'top',\n  'topLeft',\n  'topRight',\n  'bottom',\n  'bottomLeft',\n  'bottomRight',\n]\n\nexport class ToolCanvas extends PureComponent<ToolCanvasProps, ToolCanvasState> {\n  state: ToolCanvasState = {\n    cropping: false,\n    cropMoving: false,\n    moving: false,\n    resizing: false,\n    pointerPosition: null,\n  }\n\n  canvas?: {domNode: HTMLCanvasElement}\n\n  getHotspotRect() {\n    const {value, image} = this.props\n\n    const hotspot: Hotspot = value.hotspot || DEFAULT_HOTSPOT\n    const hotspotRect = new Rect()\n      .setSize(hotspot.width, hotspot.height)\n      .setCenter(hotspot.x, hotspot.y)\n\n    return new Rect()\n      .setSize(image.width, image.height)\n      .shrink(MARGIN_PX * this.getScale())\n      .multiply(hotspotRect)\n  }\n\n  getCropRect() {\n    const {value, image} = this.props\n\n    return new Rect()\n      .setSize(image.width, image.height)\n      .shrink(MARGIN_PX * this.getScale())\n      .cropRelative(Rect.fromEdges(value.crop || DEFAULT_CROP).clamp(new Rect(0, 0, 1, 1)))\n  }\n\n  getCropHandles(): CropHandles {\n    const inner = this.getCropRect()\n\n    const handleSize = CROP_HANDLE_SIZE * this.getScale()\n\n    const halfCropHandleSize = handleSize / 2\n\n    const cropHandle = new Rect(0, 0, handleSize, handleSize)\n    return {\n      left: cropHandle.setTopLeft(\n        inner.left - halfCropHandleSize,\n        inner.center.y - halfCropHandleSize,\n      ),\n      right: cropHandle.setTopLeft(\n        inner.right - halfCropHandleSize,\n        inner.center.y - halfCropHandleSize,\n      ),\n\n      top: cropHandle.setTopLeft(\n        inner.center.x - halfCropHandleSize,\n        inner.top - halfCropHandleSize,\n      ),\n      topLeft: cropHandle.setTopLeft(\n        inner.left - halfCropHandleSize,\n        inner.top - halfCropHandleSize,\n      ),\n      topRight: cropHandle.setTopLeft(\n        inner.right - halfCropHandleSize,\n        inner.top - halfCropHandleSize,\n      ),\n\n      bottom: cropHandle.setTopLeft(\n        inner.center.x - halfCropHandleSize,\n        inner.bottom - halfCropHandleSize,\n      ),\n      bottomLeft: cropHandle.setTopLeft(\n        inner.left - halfCropHandleSize,\n        inner.bottom - halfCropHandleSize,\n      ),\n      bottomRight: cropHandle.setTopLeft(\n        inner.right - halfCropHandleSize,\n        inner.bottom - halfCropHandleSize,\n      ),\n    }\n  }\n\n  getActiveCropHandleFor({x, y}: Coordinate) {\n    const cropHandles = this.getCropHandles()\n    for (const position of cropHandleKeys) {\n      if (utils2d.isPointInRect({x, y}, cropHandles[position])) {\n        return position\n      }\n    }\n    return false\n  }\n\n  emitMove(pos: Coordinate) {\n    const {image, value, onChange} = this.props\n    const scale = this.getScale()\n    const delta = {\n      x: (pos.x * scale) / image.width,\n      y: (pos.y * scale) / image.height,\n    }\n\n    onChange(applyHotspotMoveBy(value, delta))\n  }\n\n  emitCropMove(pos: Coordinate) {\n    const {image, onChange, value} = this.props\n    const scale = this.getScale()\n    const left = (pos.x * scale) / image.width\n    const right = (-pos.x * scale) / image.width\n    const top = (pos.y * scale) / image.height\n    const bottom = (-pos.y * scale) / image.height\n    const delta = {left, right, top, bottom}\n\n    if (checkCropBoundaries(value, delta)) {\n      onChange(applyCropMoveBy(value, delta))\n    }\n  }\n\n  emitCrop(side: string | boolean, pos: Coordinate) {\n    const {image, onChange, value} = this.props\n    const scale = this.getScale()\n    let left = 0\n    let right = 0\n    let top = 0\n    let bottom = 0\n\n    if (side == 'left' || side === 'topLeft' || side === 'bottomLeft') {\n      left = (pos.x * scale) / image.width\n    } else if (side == 'right' || side === 'topRight' || side === 'bottomRight') {\n      right = (-pos.x * scale) / image.width\n    }\n\n    if (side == 'top' || side === 'topLeft' || side === 'topRight') {\n      top = (pos.y * scale) / image.height\n    } else if (side == 'bottom' || side === 'bottomLeft' || side === 'bottomRight') {\n      bottom = (-pos.y * scale) / image.height\n    }\n\n    const delta = {left, right, top, bottom}\n    const newValue = limitToBoundaries(value, delta).value\n    const newDelta = limitToBoundaries(value, delta).delta\n\n    onChange(applyCropMoveBy(newValue, newDelta))\n  }\n\n  emitResize(pos: Coordinate) {\n    const {image, onChange, value} = this.props\n    const scale = this.getScale()\n\n    const delta = {\n      x: (pos.x * scale * 2) / image.width,\n      y: (pos.y * scale * 2) / image.height,\n    }\n    onChange(applyHotspotResizeBy(value, {height: delta.y, width: delta.x}))\n  }\n\n  getClampedValue() {\n    const value = this.props.value\n\n    const crop = Rect.fromEdges(value.crop || DEFAULT_CROP).clamp(new Rect(0, 0, 1, 1))\n\n    const hotspot = value.hotspot || DEFAULT_HOTSPOT\n    const hotspotRect = new Rect(0, 0, 1, 1)\n      .setSize(hotspot.width, hotspot.height)\n      .setCenter(hotspot.x, hotspot.y)\n      .clamp(crop)\n\n    return {crop: crop, hotspot: hotspotRect}\n  }\n\n  paintHotspot(context: CanvasRenderingContext2D, opacity: number) {\n    const {image, readOnly} = this.props\n\n    const imageRect = new Rect().setSize(image.width, image.height)\n\n    const {hotspot, crop} = this.getClampedValue()\n\n    const scale = this.getScale()\n    const margin = MARGIN_PX * scale\n\n    context.save()\n    drawBackdrop()\n    drawEllipse()\n    context.clip()\n    drawHole()\n    context.restore()\n    if (!readOnly) {\n      drawDragHandle(Math.PI * 1.25)\n    }\n\n    function drawEllipse() {\n      context.save()\n\n      const dest = imageRect.shrink(margin).multiply(hotspot)\n\n      const scaleY = dest.height / dest.width\n\n      context.scale(1, scaleY)\n      context.beginPath()\n      context.globalAlpha = opacity\n      context.arc(\n        dest.center.x,\n        dest.center.y / scaleY,\n        Math.abs(dest.width / 2),\n        0,\n        2 * Math.PI,\n        false,\n      )\n      context.strokeStyle = 'white'\n      context.lineWidth = 1.5 * scale\n      context.stroke()\n      context.closePath()\n\n      context.restore()\n    }\n\n    // eslint-disable-next-line max-params\n    function drawImage(\n      srcLeft: number,\n      srcTop: number,\n      srcWidth: number,\n      srcHeight: number,\n      destLeft: number,\n      destTop: number,\n      destWidth: number,\n      destHeight: number,\n    ) {\n      context.save()\n      context.drawImage(\n        image,\n        srcLeft,\n        srcTop,\n        srcWidth,\n        srcHeight,\n        destLeft,\n        destTop,\n        destWidth,\n        destHeight,\n      )\n      context.restore()\n    }\n\n    function drawHole() {\n      const src = imageRect.multiply(hotspot)\n\n      const dest = imageRect.shrink(margin).multiply(hotspot)\n\n      drawImage(\n        src.left,\n        src.top,\n        src.width,\n        src.height,\n        dest.left,\n        dest.top,\n        dest.width,\n        dest.height,\n      )\n    }\n\n    function drawBackdrop() {\n      const src = imageRect.cropRelative(crop)\n\n      const dest = imageRect.shrink(margin).cropRelative(crop)\n\n      context.save()\n      drawImage(\n        src.left,\n        src.top,\n        src.width,\n        src.height,\n        dest.left,\n        dest.top,\n        dest.width,\n        dest.height,\n      )\n      context.globalAlpha = 0.5\n      context.fillStyle = 'black'\n      context.fillRect(dest.left, dest.top, dest.width, dest.height)\n      context.restore()\n    }\n\n    function drawDragHandle(radians: number) {\n      context.save()\n\n      const radius = HOTSPOT_HANDLE_SIZE * scale\n      const dest = imageRect.shrink(margin).multiply(hotspot)\n\n      const point = utils2d.getPointAtCircumference(radians, dest)\n\n      context.beginPath()\n      context.arc(point.x, point.y, radius, 0, 2 * Math.PI, false)\n      context.fillStyle = 'rgb(255,255,255)'\n      context.fill()\n      context.closePath()\n      context.restore()\n\n      context.beginPath()\n      context.arc(point.x, point.y, radius, 0, 2 * Math.PI, false)\n      context.strokeStyle = 'rgb(0, 0, 0)'\n      context.lineWidth = 0.5 * scale\n      context.stroke()\n      context.closePath()\n    }\n  }\n\n  getActualSize() {\n    const node = this.canvas?.domNode\n    return node ? {height: node.clientHeight, width: node.clientWidth} : {height: 0, width: 0}\n  }\n\n  getDragHandleCoords() {\n    const bbox = this.getHotspotRect()\n    const point = utils2d.getPointAtCircumference(Math.PI * 1.25, bbox)\n    return {\n      x: point.x,\n      y: point.y,\n      radius: 8 * this.getScale(),\n    }\n  }\n\n  debug(context: CanvasRenderingContext2D) {\n    context.save()\n\n    const {image} = this.props\n\n    const bbox = this.getHotspotRect()\n    const scale = this.getScale()\n    const margin = MARGIN_PX * scale\n\n    // IE 10 doesn't support context.setLineDash\n    if (context.setLineDash) {\n      context.setLineDash([2 * scale, 2 * scale])\n    }\n    context.lineWidth = 0.5 * scale\n\n    context.strokeStyle = 'rgba(200, 200, 200, 0.5)'\n\n    // --- center line x\n    vline(bbox.center.x)\n    // --- center line y\n    hline(bbox.center.y)\n\n    context.strokeStyle = 'rgba(150, 150, 150, 0.5)'\n    // --- line top\n    hline(bbox.top)\n\n    // --- line bottom\n    hline(bbox.bottom)\n\n    // --- line left\n    vline(bbox.left)\n    // --- line right\n    vline(bbox.right)\n\n    context.restore()\n\n    function vline(x: number) {\n      line(x, margin, x, image.height - margin)\n    }\n\n    function hline(y: number) {\n      line(margin, y, image.width - margin, y)\n    }\n\n    function line(x1: number, y1: number, x2: number, y2: number) {\n      context.beginPath()\n      context.moveTo(x1, y1)\n      context.lineTo(x2, y2)\n      context.stroke()\n      context.closePath()\n    }\n  }\n\n  paintBackground(context: CanvasRenderingContext2D) {\n    const {image} = this.props\n    const inner = new Rect().setSize(image.width, image.height).shrink(MARGIN_PX * this.getScale())\n\n    context.save()\n    context.fillStyle = 'white'\n    context.clearRect(0, 0, image.width, image.height)\n\n    context.globalAlpha = 0.3\n    //context.globalCompositeOperation = 'lighten';\n\n    context.drawImage(image, inner.left, inner.top, inner.width, inner.height)\n    context.restore()\n  }\n\n  paint(context: CanvasRenderingContext2D) {\n    const {readOnly} = this.props\n    context.save()\n\n    const pxratio = getDevicePixelRatio()\n    context.scale(pxratio, pxratio)\n\n    const opacity = !readOnly && this.state.pointerPosition ? 0.8 : 0.2\n\n    this.paintBackground(context)\n    //return context.restore();\n    this.paintHotspot(context, opacity)\n    //this.paintDragHandle(context);\n    this.debug(context)\n    this.paintCropBorder(context)\n\n    if (!readOnly) {\n      this.highlightCropHandles(context, opacity)\n    }\n\n    if (this.state.pointerPosition) {\n      // this.paintPointerPosition(context)\n    }\n\n    context.restore()\n  }\n\n  paintPointerPosition(context: CanvasRenderingContext2D) {\n    if (!this.state.pointerPosition) {\n      return\n    }\n\n    const {x, y} = this.state.pointerPosition\n    context.beginPath()\n    context.arc(x, y, 14 * this.getScale(), 0, 2 * Math.PI, false)\n    context.fillStyle = 'lightblue'\n    context.fill()\n    context.restore()\n  }\n\n  paintCropBorder(context: CanvasRenderingContext2D) {\n    const cropRect = this.getCropRect()\n    context.save()\n    context.beginPath()\n    context.fillStyle = 'rgba(66, 66, 66, 0.9)'\n    context.lineWidth = 1\n    context.rect(cropRect.left, cropRect.top, cropRect.width, cropRect.height)\n    context.stroke()\n    context.closePath()\n    context.restore()\n  }\n\n  highlightCropHandles(context: CanvasRenderingContext2D, opacity: number) {\n    context.save()\n    const cropHandles = this.getCropHandles()\n\n    //context.globalCompositeOperation = \"difference\";\n\n    cropHandleKeys.forEach((handle) => {\n      context.fillStyle =\n        this.state.cropping === handle\n          ? `rgba(202, 54, 53, ${opacity})`\n          : `rgba(230, 230, 230, ${opacity + 0.4})`\n      const {left, top, height, width} = cropHandles[handle]\n      context.fillRect(left, top, width, height)\n      context.beginPath()\n      context.fillStyle = `rgba(66, 66, 66, ${opacity})`\n      context.rect(left, top, width, height)\n      context.closePath()\n      context.stroke()\n    })\n    context.restore()\n  }\n\n  getScale() {\n    const actualSize = this.getActualSize()\n    return this.props.image.width / actualSize.width\n  }\n\n  getCursor() {\n    const {pointerPosition} = this.state\n    const {readOnly} = this.props\n    if (!pointerPosition || readOnly) {\n      return 'auto'\n    }\n\n    const activeCropArea = this.state.cropping || this.getActiveCropHandleFor(pointerPosition)\n    if (activeCropArea) {\n      return getCropCursorForHandle(activeCropArea) || 'auto'\n    }\n\n    const pointerOverDragHandle = utils2d.isPointInCircle(\n      pointerPosition,\n      this.getDragHandleCoords(),\n    )\n\n    if (this.state.resizing || pointerOverDragHandle) {\n      return 'move'\n    }\n\n    if (this.state.moving || this.state.cropMoving) {\n      return `url(${cursors.CLOSE_HAND}), move`\n    }\n\n    const pointerOverHotspot = utils2d.isPointInEllipse(pointerPosition, this.getHotspotRect())\n    const pointerOverCropRect = utils2d.isPointInRect(pointerPosition, this.getCropRect())\n    if (pointerOverHotspot || pointerOverCropRect) {\n      return `url(${cursors.OPEN_HAND}), move`\n    }\n\n    return 'auto'\n  }\n\n  componentDidMount() {\n    this.draw()\n  }\n\n  componentDidUpdate() {\n    this.draw()\n  }\n\n  draw() {\n    if (!this.canvas) {\n      return\n    }\n\n    const domNode = this.canvas.domNode\n    const context = domNode.getContext('2d')\n    if (!context) {\n      return\n    }\n\n    this.paint(context)\n    const currentCursor = domNode.style.cursor\n    const newCursor = this.getCursor()\n    if (currentCursor !== newCursor) {\n      domNode.style.cursor = newCursor\n    }\n  }\n\n  handleDragStart = ({x, y}: Coordinate) => {\n    const pointerPosition = {x: x * this.getScale(), y: y * this.getScale()}\n\n    const inHotspot = utils2d.isPointInEllipse(pointerPosition, this.getHotspotRect())\n\n    const inDragHandle = utils2d.isPointInCircle(pointerPosition, this.getDragHandleCoords())\n\n    const activeCropHandle = this.getActiveCropHandleFor(pointerPosition)\n\n    const inCropRect = utils2d.isPointInRect(pointerPosition, this.getCropRect())\n\n    if (activeCropHandle) {\n      this.setState({cropping: activeCropHandle})\n    } else if (inDragHandle) {\n      this.setState({resizing: true})\n    } else if (inHotspot) {\n      this.setState({moving: true})\n    } else if (inCropRect) {\n      this.setState({cropMoving: true})\n    }\n  }\n\n  handleDrag = (pos: Coordinate) => {\n    if (this.state.cropping) {\n      this.emitCrop(this.state.cropping, pos)\n    } else if (this.state.cropMoving) {\n      this.emitCropMove(pos)\n    } else if (this.state.moving) {\n      this.emitMove(pos)\n    } else if (this.state.resizing) {\n      this.emitResize(pos)\n    }\n  }\n\n  handleDragEnd = () => {\n    const {onChange, onChangeEnd} = this.props\n    this.setState({moving: false, resizing: false, cropping: false, cropMoving: false})\n    const {hotspot, crop: rawCrop} = this.getClampedValue()\n\n    const crop = normalizeRect(rawCrop)\n\n    const finalValue = {\n      crop: {\n        top: crop.top,\n        bottom: 1 - crop.bottom,\n        left: crop.left,\n        right: 1 - crop.right,\n      },\n      hotspot: {\n        x: hotspot.center.x,\n        y: hotspot.center.y,\n        height: Math.abs(hotspot.height),\n        width: Math.abs(hotspot.width),\n      },\n    }\n    onChange(finalValue)\n    if (onChangeEnd) {\n      onChangeEnd(finalValue)\n    }\n  }\n\n  handlePointerOut = () => {\n    this.setState({pointerPosition: null})\n  }\n\n  handlePointerMove = (event: PointerEvent<HTMLCanvasElement>) => {\n    const clientRect = event.currentTarget.getBoundingClientRect()\n    this.setState({\n      pointerPosition: {\n        x: (event.clientX - clientRect.left) * this.getScale(),\n        y: (event.clientY - clientRect.top) * this.getScale(),\n      },\n    })\n  }\n\n  setCanvas = (node: {domNode: HTMLCanvasElement}) => {\n    this.canvas = node\n  }\n\n  render() {\n    const {image, readOnly} = this.props\n    const ratio = getDevicePixelRatio()\n    return (\n      <RootContainer>\n        <CanvasContainer\n          readOnly={readOnly}\n          ref={this.setCanvas as any}\n          onDrag={this.handleDrag}\n          onDragStart={this.handleDragStart}\n          onDragEnd={this.handleDragEnd}\n          onPointerMove={this.handlePointerMove}\n          onPointerOut={this.handlePointerOut}\n          height={image.height * ratio}\n          width={image.width * ratio}\n        />\n      </RootContainer>\n    )\n  }\n}\n\nfunction applyHotspotMoveBy(value: Partial<CropAndHotspot>, delta: Coordinate): {hotspot: Hotspot} {\n  const currentHotspot = (value && value.hotspot) || DEFAULT_HOTSPOT\n\n  return {\n    ...value,\n    hotspot: {\n      ...currentHotspot,\n      x: currentHotspot.x + delta.x,\n      y: currentHotspot.y + delta.y,\n    },\n  }\n}\n\nfunction applyHotspotResizeBy(\n  value: Partial<CropAndHotspot>,\n  delta: Dimensions,\n): {hotspot: Hotspot} {\n  const currentHotspot = (value && value.hotspot) || DEFAULT_HOTSPOT\n  return {\n    ...value,\n    hotspot: {\n      ...currentHotspot,\n      height: currentHotspot.height + delta.height,\n      width: currentHotspot.width + delta.width,\n    },\n  }\n}\n\nfunction applyCropMoveBy(value: Partial<CropAndHotspot>, delta: Offsets): {crop: Crop} {\n  const currentCrop = (value && value.crop) || DEFAULT_CROP\n  return {\n    ...value,\n    crop: {\n      left: currentCrop.left + (delta.left || 0),\n      right: currentCrop.right + (delta.right || 0),\n      top: currentCrop.top + (delta.top || 0),\n      bottom: currentCrop.bottom + (delta.bottom || 0),\n    },\n  }\n}\n","import {LoadingBlock} from '../../../../../components/loadingBlock'\nimport {ImageLoader} from './ImageLoader'\nimport {Resize} from './Resize'\nimport {ToolCanvas} from './ToolCanvas'\nimport {type ToolCanvasProps} from './types'\n\nexport interface ImageToolProps extends Omit<ToolCanvasProps, 'image'> {\n  image?: HTMLCanvasElement\n  src: string\n}\n\nexport function ImageTool(props: ImageToolProps) {\n  return (\n    <ImageLoader src={props.src}>\n      {({isLoading, image, error}) => {\n        if (isLoading) {\n          return <LoadingBlock showText />\n        }\n        if (error) {\n          return <div>{error.message}</div>\n        }\n        if (image) {\n          return (\n            <Resize image={image} maxHeight={ImageTool.maxHeight} maxWidth={ImageTool.maxWidth}>\n              {(canvas) => <ToolCanvas image={canvas} {...props} />}\n            </Resize>\n          )\n        }\n        return null\n      }}\n    </ImageLoader>\n  )\n}\n\nImageTool.maxHeight = 500\nImageTool.maxWidth = 1000\n","import {useEffect, useState} from 'react'\nimport {Observable} from 'rxjs'\n\n// http://probablyprogramming.com/2009/03/15/the-tiniest-gif-ever\nconst PROBABLY_THE_TINIEST_GIF_EVER = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='\n\nfunction isBlob(src: string) {\n  return src.startsWith('blob:')\n}\n\nexport function loadImage(src: string): Observable<HTMLImageElement> {\n  return new Observable((subscriber) => {\n    const image = document.createElement('img')\n\n    let completed = false\n    const onload = () => {\n      completed = true\n      subscriber.next(image)\n      subscriber.complete()\n    }\n\n    const onerror = () => {\n      completed = true\n      subscriber.error(new Error(`Could not load image from ${isBlob(src) ? 'blob' : src}`))\n    }\n\n    image.onload = onload\n    image.onerror = onerror\n    image.src = src\n\n    return () => {\n      image.onload = null\n      image.onerror = null\n\n      if (!completed) {\n        // if we unsubscribe before it's loaded this will cancel the image loading\n        image.src = PROBABLY_THE_TINIEST_GIF_EVER\n      }\n    }\n  })\n}\n\ntype ImageLoadState = {\n  isLoading: boolean\n  image?: HTMLImageElement\n  error?: Error\n}\n\nconst INITIAL_STATE = {isLoading: true}\n\nexport function useLoadImage(url: string): ImageLoadState {\n  const [state, setState] = useState<ImageLoadState>(INITIAL_STATE)\n\n  useEffect(() => {\n    setState(INITIAL_STATE)\n    const subscription = loadImage(url)\n      // .pipe(delay(2000))\n      .subscribe({\n        error: (err) => {\n          setState({isLoading: false, error: err})\n        },\n        next: (image) => {\n          setState({image, isLoading: false})\n        },\n      })\n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [url])\n\n  return state\n}\n","import {type Image, type ImageSchemaType} from '@sanity/types'\nimport {Box, Card, Flex, Grid, Heading, Text} from '@sanity/ui'\nimport {type ReactNode, useCallback, useEffect, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {ChangeIndicator} from '../../../../changeIndicators'\nimport {LoadingBlock} from '../../../../components/loadingBlock'\nimport {useTranslation} from '../../../../i18n'\nimport {EMPTY_ARRAY} from '../../../../util'\nimport {FormField} from '../../../components/formField'\nimport {useDidUpdate} from '../../../hooks/useDidUpdate'\nimport {set} from '../../../patch'\nimport {type ObjectInputProps} from '../../../types'\nimport {RatioBox} from '../common/RatioBox'\nimport {DEFAULT_CROP, DEFAULT_HOTSPOT, HotspotImage, ImageTool} from './imagetool'\nimport {useLoadImage} from './useLoadImage'\n\nexport interface ImageToolInputProps\n  extends Omit<ObjectInputProps<Image, ImageSchemaType>, 'markers' | 'renderDefault'> {\n  imageUrl: string\n}\n\nconst HOTSPOT_PATH = ['hotspot']\n\nconst PREVIEW_ASPECT_RATIOS = [\n  ['3:4', 3 / 4],\n  ['Square', 1 / 1],\n  ['16:9', 16 / 9],\n  ['Panorama', 4 / 1],\n] as const\n\nconst DEFAULT_VALUE: Partial<Image> = {\n  crop: DEFAULT_CROP,\n  hotspot: DEFAULT_HOTSPOT,\n}\n\nconst Placeholder = styled.div`\n  min-height: 6em;\n`\n\nfunction LoadStatus(props: {children: ReactNode}) {\n  return (\n    <Flex align=\"center\" justify=\"center\" padding={4} style={{overflowWrap: 'break-word'}}>\n      {props.children}\n    </Flex>\n  )\n}\n\nexport function ImageToolInput(props: ImageToolInputProps) {\n  const {\n    imageUrl,\n    value,\n    changed,\n    level,\n    path,\n    focusPath = EMPTY_ARRAY,\n    presence,\n    onChange,\n    schemaType,\n    onPathFocus,\n    readOnly,\n    elementProps,\n  } = props\n\n  const [localValue, setLocalValue] = useState(value || DEFAULT_VALUE)\n\n  const {image, isLoading: isImageLoading, error: imageLoadError} = useLoadImage(imageUrl)\n\n  const handleFocus = useCallback(() => {\n    onPathFocus(HOTSPOT_PATH)\n  }, [onPathFocus])\n\n  useEffect(() => {\n    setLocalValue(value || DEFAULT_VALUE)\n  }, [value])\n\n  const hasFocus = focusPath[0] === 'hotspot'\n\n  useDidUpdate(hasFocus, (hadFocus) => {\n    if (!hadFocus && hasFocus) {\n      elementProps.ref.current?.focus()\n    }\n  })\n\n  const handleChangeEnd = useCallback(\n    (finalValue: any) => {\n      if (readOnly) {\n        return\n      }\n      // For backwards compatibility, where hotspot/crop might not have a named type yet\n      const cropField = schemaType.fields.find(\n        (field) => field.name === 'crop' && field.type.name !== 'object',\n      )\n\n      const hotspotField = schemaType.fields.find(\n        (field) => field.type.name !== 'object' && field.name === 'hotspot',\n      )\n\n      // Note: when either hotspot or crop change we fill in the default if the other is missing\n      // (we can't have one without the other)\n      const crop = cropField\n        ? {_type: cropField.type.name, ...(finalValue.crop || DEFAULT_CROP)}\n        : finalValue.crop\n\n      const hotspot = hotspotField\n        ? {_type: hotspotField.type.name, ...(finalValue.hotspot || DEFAULT_HOTSPOT)}\n        : finalValue.hotspot\n\n      onChange([set(crop, ['crop']), set(hotspot, ['hotspot'])])\n    },\n    [onChange, readOnly, schemaType.fields],\n  )\n\n  const {t} = useTranslation()\n  return (\n    <FormField\n      title={t('inputs.imagetool.title')}\n      level={level}\n      description={t('inputs.imagetool.description')}\n      deprecated={schemaType.deprecated}\n      __unstable_presence={presence}\n    >\n      <div>\n        <Card\n          __unstable_checkered\n          __unstable_focusRing\n          tabIndex={0}\n          ref={elementProps.ref}\n          onFocus={handleFocus}\n        >\n          <ChangeIndicator\n            path={path.concat(HOTSPOT_PATH)}\n            hasFocus={focusPath[0] === 'hotspot'}\n            isChanged={changed}\n          >\n            <RatioBox ratio={3 / 2}>\n              {(isImageLoading || imageLoadError) && (\n                <LoadStatus>\n                  {imageLoadError ? (\n                    <Card padding={4} radius={2} tone=\"critical\" border>\n                      <Text>\n                        {t('inputs.imagetool.load-error', {\n                          errorMessage: imageLoadError.message,\n                        })}\n                      </Text>\n                    </Card>\n                  ) : (\n                    <LoadingBlock showText />\n                  )}\n                </LoadStatus>\n              )}\n              {!isImageLoading && image && (\n                <Box margin={1}>\n                  <ImageTool\n                    value={localValue}\n                    src={image.src}\n                    readOnly={Boolean(readOnly)}\n                    onChangeEnd={handleChangeEnd}\n                    onChange={setLocalValue}\n                  />\n                </Box>\n              )}\n            </RatioBox>\n          </ChangeIndicator>\n        </Card>\n        <Box marginTop={3}>\n          <Grid columns={PREVIEW_ASPECT_RATIOS.length} gap={1}>\n            {PREVIEW_ASPECT_RATIOS.map(([title, ratio]) => (\n              <div key={ratio}>\n                <Heading as=\"h4\" size={0}>\n                  {title}\n                </Heading>\n                <Box marginTop={2}>\n                  <RatioBox ratio={ratio}>\n                    <Card __unstable_checkered>\n                      {!isImageLoading && image ? (\n                        <HotspotImage\n                          aspectRatio={ratio}\n                          src={image.src}\n                          srcAspectRatio={image.width / image.height}\n                          hotspot={localValue.hotspot || DEFAULT_HOTSPOT}\n                          crop={localValue.crop || DEFAULT_CROP}\n                        />\n                      ) : (\n                        <Placeholder />\n                      )}\n                    </Card>\n                  </RatioBox>\n                </Box>\n              </div>\n            ))}\n          </Grid>\n        </Box>\n      </div>\n    </FormField>\n  )\n}\n","import {CropIcon} from '@sanity/icons'\nimport {Inline, Menu, useClickOutside, useGlobalKeyDown} from '@sanity/ui'\nimport {type MouseEventHandler, type ReactNode, useCallback, useEffect, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {Button, Popover, TooltipDelayGroupProvider} from '../../../../../ui-components'\nimport {ContextMenuButton} from '../../../../components/contextMenuButton'\nimport {useTranslation} from '../../../../i18n'\n\nexport const MenuActionsWrapper = styled(Inline)`\n  position: absolute;\n  top: 0;\n  right: 0;\n`\n\ninterface ImageActionsMenuProps {\n  children: ReactNode\n  onEdit: MouseEventHandler<HTMLButtonElement>\n  setHotspotButtonElement: (element: HTMLButtonElement | null) => void\n  setMenuButtonElement: (element: HTMLButtonElement | null) => void\n  showEdit: boolean\n  isMenuOpen: boolean\n  onMenuOpen: (flag: boolean) => void\n}\n\nexport function ImageActionsMenu(props: ImageActionsMenuProps) {\n  const {\n    onEdit,\n    children,\n    showEdit,\n    setHotspotButtonElement,\n    setMenuButtonElement,\n    onMenuOpen,\n    isMenuOpen,\n  } = props\n\n  const [menuElement, setMenuElement] = useState<HTMLDivElement | null>(null)\n  const [buttonElement, setButtonElement] = useState<HTMLButtonElement | null>(null)\n\n  const handleClick = useCallback(() => onMenuOpen(!isMenuOpen), [onMenuOpen, isMenuOpen])\n\n  useGlobalKeyDown(\n    useCallback(\n      (event) => {\n        if (isMenuOpen && (event.key === 'Escape' || event.key === 'Tab')) {\n          onMenuOpen(false)\n          buttonElement?.focus()\n        }\n      },\n      [isMenuOpen, onMenuOpen, buttonElement],\n    ),\n  )\n\n  // Close menu when clicking outside of it\n  // Not when clicking on the button\n  useClickOutside(\n    useCallback(\n      (event) => {\n        if (!buttonElement?.contains(event.target as Node)) {\n          onMenuOpen(false)\n        }\n      },\n      [buttonElement, onMenuOpen],\n    ),\n    [menuElement],\n  )\n\n  const setOptionsButtonRef = useCallback(\n    (el: HTMLButtonElement | null) => {\n      // Pass the button element to the parent component so that it can focus it when e.g. closing dialogs\n      setMenuButtonElement(el)\n\n      // Set focus back on the button when closing the menu\n      setButtonElement(el)\n    },\n    [setMenuButtonElement],\n  )\n\n  // When the popover is open, focus the menu to enable keyboard navigation\n  useEffect(() => {\n    if (isMenuOpen) {\n      menuElement?.focus()\n    }\n  }, [isMenuOpen, menuElement])\n\n  const {t} = useTranslation()\n  return (\n    <TooltipDelayGroupProvider>\n      <MenuActionsWrapper data-buttons space={1} padding={2}>\n        {showEdit && (\n          <Button\n            aria-label={t('inputs.image.actions-menu.edit-details.aria-label')}\n            data-testid=\"options-menu-edit-details\"\n            icon={CropIcon}\n            mode=\"ghost\"\n            onClick={onEdit}\n            ref={setHotspotButtonElement}\n            tooltipProps={{content: t('inputs.image.actions-menu.crop-image-tooltip')}}\n          />\n        )}\n        {/* Using a customized Popover instead of MenuButton because a MenuButton will close on click\n     and break replacing an uploaded file. */}\n        <Popover\n          id=\"image-actions-menu\"\n          content={<Menu ref={setMenuElement}>{children}</Menu>}\n          portal\n          open={isMenuOpen}\n          constrainSize\n        >\n          <ContextMenuButton\n            aria-label={t('inputs.image.actions-menu.options.aria-label')}\n            data-testid=\"options-menu-button\"\n            mode=\"ghost\"\n            onClick={handleClick}\n            ref={setOptionsButtonRef}\n          />\n        </Popover>\n      </MenuActionsWrapper>\n    </TooltipDelayGroupProvider>\n  )\n}\n","import {Card, type CardTone, Flex, rgba, studioTheme} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nexport const MAX_DEFAULT_HEIGHT = 30\n\nexport const RatioBox = styled(Card)`\n  position: relative;\n  width: 100%;\n  overflow: hidden;\n  overflow: clip;\n  min-height: 3.75rem;\n  max-height: 20rem;\n\n  & > div[data-container] {\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: flex !important;\n    align-items: center;\n    justify-content: center;\n  }\n\n  & img {\n    max-width: 100%;\n    max-height: 100%;\n  }\n`\n\nexport const Overlay = styled(Flex)<{\n  $drag: boolean\n  $tone: Exclude<CardTone, 'inherit'>\n}>(({$drag, $tone}) => {\n  const textColor = studioTheme.color.light[$tone].card.enabled.fg\n  const backgroundColor = rgba(studioTheme.color.light[$tone].card.enabled.bg, 0.8)\n\n  return css`\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    backdrop-filter: ${$drag ? 'blur(10px)' : ''};\n    color: ${$tone ? textColor : ''};\n    background-color: ${$drag ? backgroundColor : 'transparent'};\n  `\n})\n\nexport const FlexOverlay = styled(Flex)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n`\n","import {AccessDeniedIcon, ImageIcon, ReadOnlyIcon} from '@sanity/icons'\nimport {Box, Card, type CardTone, Heading, Text, useElementRect} from '@sanity/ui'\nimport {type ComponentProps, type ReactNode, useCallback, useEffect, useState} from 'react'\n\nimport {LoadingBlock} from '../../../../components/loadingBlock'\nimport {useTranslation} from '../../../../i18n'\nimport {FlexOverlay, MAX_DEFAULT_HEIGHT, Overlay, RatioBox} from './ImagePreview.styled'\n\ninterface Props {\n  readOnly?: boolean | null\n  drag: boolean\n  isRejected: boolean\n  src: string\n  alt: string\n}\n\n/*\n  Used for setting the initial image height - specifically for images\n  that are small and so can take less space in the document\n*/\nconst getImageSize = (src: string): number[] => {\n  const imageUrlParams = new URLSearchParams(src.split('?')[1])\n  const rect = imageUrlParams.get('rect')\n\n  if (rect) {\n    return [rect.split(',')[2], rect.split(',')[3]].map(Number)\n  }\n\n  return src.split('-')[1].split('.')[0].split('x').map(Number)\n}\n\nexport function ImagePreview(props: ComponentProps<typeof Card> & Props) {\n  const {drag, readOnly, isRejected, src, ...rest} = props\n  const [isLoaded, setLoaded] = useState(false)\n  const [rootElement, setRootElement] = useState<HTMLDivElement | null>(null)\n  const rootRect = useElementRect(rootElement)\n  const rootWidth = rootRect?.width || 0\n  const acceptTone = isRejected || readOnly ? 'critical' : 'primary'\n  const tone = drag ? acceptTone : 'default'\n\n  const maxHeightToPx = (MAX_DEFAULT_HEIGHT * document.documentElement.clientHeight) / 100 // convert from vh to px, max height of the input\n\n  const [imageWidth, imageHeight] = getImageSize(src)\n\n  const imageRatio = imageWidth / imageHeight\n\n  // is the image wider than root? if so calculate the resized height\n  const renderedImageHeight = imageWidth > rootWidth ? rootWidth / imageRatio : imageHeight\n\n  /*\n    if the rendered image is smaller than the max height then it doesn't require a height set\n    otherwise, set the max height (to prevent a large image in the document)\n  */\n  const rootHeight = renderedImageHeight < maxHeightToPx ? null : `${MAX_DEFAULT_HEIGHT}vh`\n\n  useEffect(() => {\n    /* set for when the src is being switched when the image input already had a image src\n    - meaning it already had an asset */\n    setLoaded(false)\n  }, [src])\n\n  const onLoadChange = useCallback(() => {\n    setLoaded(true)\n  }, [])\n\n  const {t} = useTranslation()\n  return (\n    <RatioBox {...rest} ref={setRootElement} style={{height: rootHeight}} tone=\"transparent\">\n      <Card data-container tone=\"inherit\">\n        {!isLoaded && (\n          <OverlayComponent cardTone=\"transparent\" drag content={<LoadingBlock showText />} />\n        )}\n        <img\n          src={src}\n          data-testid=\"hotspot-image-input\"\n          alt={props.alt}\n          onLoad={onLoadChange}\n          referrerPolicy=\"strict-origin-when-cross-origin\"\n        />\n      </Card>\n\n      {drag && (\n        <OverlayComponent\n          cardTone={tone}\n          drag={drag}\n          content={\n            <>\n              <Box marginBottom={3}>\n                <Heading>\n                  <HoverIcon isRejected={isRejected} readOnly={readOnly} />\n                </Heading>\n              </Box>\n              <Text size={1}>{t(getHoverTextTranslationKey({isRejected, readOnly}))}</Text>\n            </>\n          }\n        />\n      )}\n    </RatioBox>\n  )\n}\n\nfunction HoverIcon({isRejected, readOnly}: {isRejected: boolean; readOnly?: boolean}) {\n  if (isRejected) {\n    return <AccessDeniedIcon />\n  }\n  if (readOnly) {\n    return <ReadOnlyIcon />\n  }\n  return <ImageIcon />\n}\n\nfunction getHoverTextTranslationKey({\n  isRejected,\n  readOnly,\n}: {\n  isRejected: boolean\n  readOnly?: boolean\n}) {\n  if (isRejected) {\n    return 'inputs.image.drag-overlay.this-field-is-read-only'\n  }\n  return readOnly\n    ? 'inputs.image.drag-overlay.cannot-upload-here'\n    : 'inputs.image.drag-overlay.drop-to-upload-image'\n}\n\nfunction OverlayComponent({\n  cardTone,\n  drag,\n  content,\n}: {\n  cardTone: Exclude<CardTone, 'inherit'>\n  drag: boolean\n  content: ReactNode\n}) {\n  return (\n    <Overlay justify=\"flex-end\" padding={3} $drag={drag} $tone={cardTone}>\n      <FlexOverlay direction=\"column\" align=\"center\" justify=\"center\">\n        {content}\n      </FlexOverlay>\n    </Overlay>\n  )\n}\n","import {ResetIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Stack, Text} from '@sanity/ui'\n\nimport {Button} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\n\ntype Props = {\n  onClearValue?: () => void\n}\n\nexport function InvalidImageWarning({onClearValue}: Props) {\n  const {t} = useTranslation()\n  return (\n    <Card tone=\"caution\" padding={4} border radius={2}>\n      <Flex gap={4} marginBottom={4}>\n        <Box>\n          <Text size={1}>\n            <WarningOutlineIcon />\n          </Text>\n        </Box>\n        <Stack space={3}>\n          <Text size={1} weight=\"medium\">\n            {t('inputs.image.invalid-image-warning.title')}\n          </Text>\n          <Text size={1}>{t('inputs.image.invalid-image-warning.description')}</Text>\n        </Stack>\n      </Flex>\n      <Button\n        icon={ResetIcon}\n        mode=\"ghost\"\n        onClick={onClearValue}\n        text={t('inputs.image.invalid-image-warning.reset-button.text')}\n        width=\"fill\"\n      />\n    </Card>\n  )\n}\n","/* eslint-disable react/jsx-no-bind */\n/* eslint-disable import/no-unresolved,react/jsx-handler-names, react/display-name, react/no-this-in-sfc */\n\nimport {isImageSource} from '@sanity/asset-utils'\nimport {type SanityClient} from '@sanity/client'\nimport {ChevronDownIcon, ImageIcon, SearchIcon} from '@sanity/icons'\nimport {\n  type AssetFromSource,\n  type AssetSource,\n  type Image as BaseImage,\n  type ImageAsset,\n  type ImageSchemaType,\n  type Path,\n  type UploadState,\n} from '@sanity/types'\nimport {Box, Card, Menu, Stack, type ToastParams} from '@sanity/ui'\nimport {get, startCase} from 'lodash'\nimport {type FocusEvent, PureComponent, type ReactNode} from 'react'\nimport {type Observable, type Subscription} from 'rxjs'\n\nimport {\n  Button,\n  Dialog,\n  MenuButton,\n  type MenuButtonProps,\n  MenuItem,\n} from '../../../../../ui-components'\nimport {ChangeIndicator} from '../../../../changeIndicators'\nimport {ImperativeToast} from '../../../../components'\nimport {type FIXME} from '../../../../FIXME'\nimport {PresenceOverlay} from '../../../../presence'\nimport {FormInput} from '../../../components'\nimport {MemberField, MemberFieldError, MemberFieldSet} from '../../../members'\nimport {type PatchEvent, setIfMissing, unset} from '../../../patch'\nimport {type FieldMember} from '../../../store'\nimport {\n  type ResolvedUploader,\n  type Uploader,\n  type UploaderResolver,\n  type UploadOptions,\n} from '../../../studio/uploads/types'\nimport {type InputProps, type ObjectInputProps} from '../../../types'\nimport {WithReferencedAsset} from '../../../utils/WithReferencedAsset'\nimport {ActionsMenu} from '../common/ActionsMenu'\nimport {handleSelectAssetFromSource} from '../common/assetSource'\nimport {FileTarget} from '../common/styles'\nimport {UploadPlaceholder} from '../common/UploadPlaceholder'\nimport {UploadProgress} from '../common/UploadProgress'\nimport {UploadWarning} from '../common/UploadWarning'\nimport {ImageToolInput} from '../ImageToolInput'\nimport {type ImageUrlBuilder} from '../types'\nimport {ImageActionsMenu} from './ImageActionsMenu'\nimport {ImagePreview} from './ImagePreview'\nimport {InvalidImageWarning} from './InvalidImageWarning'\n\n/**\n * @hidden\n * @beta */\nexport interface BaseImageInputValue extends Partial<BaseImage> {\n  _upload?: UploadState\n}\n\n/**\n * @hidden\n * @beta */\nexport interface BaseImageInputProps\n  extends ObjectInputProps<BaseImageInputValue, ImageSchemaType> {\n  assetSources: AssetSource[]\n  directUploads?: boolean\n  imageUrlBuilder: ImageUrlBuilder\n  observeAsset: (documentId: string) => Observable<ImageAsset>\n  resolveUploader: UploaderResolver\n  client: SanityClient\n  t: (key: string, values?: Record<string, string>) => string\n}\n\nconst getDevicePixelRatio = () => {\n  if (typeof window === 'undefined' || !window.devicePixelRatio) {\n    return 1\n  }\n  return Math.round(Math.max(1, window.devicePixelRatio))\n}\n\ntype FileInfo = {\n  type: string // mime type\n  kind: string // 'file' or 'string'\n}\n\ninterface BaseImageInputState {\n  isUploading: boolean\n  selectedAssetSource: AssetSource | null\n  // Metadata about files currently over the drop area\n  hoveringFiles: FileInfo[]\n  isStale: boolean\n  hotspotButtonElement: HTMLButtonElement | null\n  menuButtonElement: HTMLButtonElement | null\n  isMenuOpen: boolean\n}\n\nfunction passThrough({children}: {children?: ReactNode}) {\n  return children\n}\n\nconst ASSET_FIELD_PATH = ['asset']\n\nconst ASSET_IMAGE_MENU_POPOVER: MenuButtonProps['popover'] = {portal: true}\n\n/** @internal */\nexport class BaseImageInput extends PureComponent<BaseImageInputProps, BaseImageInputState> {\n  _previewElement: HTMLDivElement | null = null\n  _assetPath: Path\n  uploadSubscription: null | Subscription = null\n\n  state: BaseImageInputState = {\n    isUploading: false,\n    selectedAssetSource: null,\n    hoveringFiles: [],\n    isStale: false,\n    hotspotButtonElement: null,\n    menuButtonElement: null,\n    isMenuOpen: false,\n  }\n\n  constructor(props: BaseImageInputProps) {\n    super(props)\n    this._assetPath = props.path.concat(ASSET_FIELD_PATH)\n  }\n\n  toast: {push: (params: ToastParams) => void} | null = null\n\n  setPreviewElement = (el: HTMLDivElement | null) => {\n    this._previewElement = el\n  }\n\n  setHotspotButtonElement = (el: HTMLButtonElement | null) => {\n    this.setState({hotspotButtonElement: el})\n  }\n\n  // Get the menu button element in `ImageActionsMenu` so that focus can be restored to\n  // it when closing the dialog (see `handleAssetSourceClosed`)\n  setMenuButtonElement = (el: HTMLButtonElement | null) => {\n    this.setState({menuButtonElement: el})\n  }\n\n  isImageToolEnabled() {\n    return get(this.props.schemaType, 'options.hotspot') === true\n  }\n\n  clearUploadStatus() {\n    if (this.props.value?._upload) {\n      this.props.onChange(unset(['_upload']))\n    }\n  }\n\n  cancelUpload() {\n    if (this.uploadSubscription) {\n      this.uploadSubscription.unsubscribe()\n      this.clearUploadStatus()\n    }\n  }\n\n  getUploadOptions = (file: File): ResolvedUploader[] => {\n    const {schemaType, resolveUploader} = this.props\n    const uploader = resolveUploader && resolveUploader(schemaType, file)\n    return uploader ? [{type: schemaType, uploader}] : []\n  }\n\n  uploadFirstAccepted(files: File[]) {\n    const {schemaType, resolveUploader} = this.props\n\n    const match = files\n      .map((file) => ({file, uploader: resolveUploader(schemaType, file)}))\n      .find((result) => result.uploader)\n\n    if (match) {\n      this.uploadWith(match.uploader!, match.file)\n    }\n\n    this.setState({isMenuOpen: false})\n  }\n\n  uploadWith = (uploader: Uploader, file: File, assetDocumentProps: UploadOptions = {}) => {\n    const {schemaType, onChange, client, t} = this.props\n    const {label, title, description, creditLine, source} = assetDocumentProps\n    const options = {\n      metadata: get(schemaType, 'options.metadata'),\n      storeOriginalFilename: get(schemaType, 'options.storeOriginalFilename'),\n      label,\n      title,\n      description,\n      creditLine,\n      source,\n    }\n\n    this.cancelUpload()\n    this.setState({isUploading: true})\n    onChange(setIfMissing({_type: schemaType.name}))\n    this.uploadSubscription = uploader.upload(client, file, schemaType, options).subscribe({\n      next: (uploadEvent) => {\n        if (uploadEvent.patches) {\n          onChange(uploadEvent.patches)\n        }\n      },\n      error: (err) => {\n        // eslint-disable-next-line no-console\n        console.error(err)\n        this.toast?.push({\n          status: 'error',\n          description: t('inputs.image.upload-error.description'),\n          title: t('inputs.image.upload-error.title'),\n        })\n\n        this.clearUploadStatus()\n      },\n      complete: () => {\n        onChange([unset(['hotspot']), unset(['crop'])])\n        this.setState({isUploading: false})\n        // this.toast.push({\n        //   status: 'success',\n        //   title: 'Upload completed',\n        // })\n      },\n    })\n  }\n\n  handleRemoveButtonClick = () => {\n    const {value} = this.props\n\n    // When removing the image, we should also remove any crop and hotspot\n    // _type and _key are \"meta\"-properties and are not significant unless\n    // other properties are present. Thus, we want to remove the entire\n    // \"container\" object if these are the only properties present, BUT\n    // only if we're not an array element, as removing the array element\n    // will close the selection dialog. Instead, when closing the dialog,\n    // the array logic will check for an \"empty\" value and remove it for us\n    const allKeys = Object.keys(value || {})\n    const remainingKeys = allKeys.filter(\n      (key) => !['_type', '_key', '_upload', 'asset', 'crop', 'hotspot'].includes(key),\n    )\n\n    const isEmpty = remainingKeys.length === 0\n    const removeKeys = ['asset']\n      .concat(allKeys.filter((key) => ['crop', 'hotspot', '_upload'].includes(key)))\n      .map((key) => unset([key]))\n\n    this.props.onChange(isEmpty && !this.valueIsArrayElement() ? unset() : removeKeys)\n  }\n\n  handleFieldChange = (event: PatchEvent) => {\n    const {onChange, schemaType} = this.props\n\n    // When editing a metadata field for an image (eg `altText`), and no asset\n    // is currently selected, we want to unset the entire image field if the\n    // field we are currently editing goes blank and gets unset.\n    //\n    // For instance:\n    // An image field with an `altText` and a `title` subfield, where the image\n    // `asset` and the `title` field is empty, and we are erasing the `alt` field.\n    // We do _not_ however want to clear the field if any content is present in\n    // the other fields - but we do not consider `crop` and `hotspot`.\n    //\n    // Also, we don't want to use this logic for array items, since the parent will\n    // take care of it when closing the array dialog\n    if (!this.valueIsArrayElement() && this.eventIsUnsettingLastFilledField(event)) {\n      onChange(unset())\n      return\n    }\n\n    onChange(\n      event.prepend(\n        setIfMissing({\n          _type: schemaType.name,\n        }),\n      ).patches,\n    )\n  }\n\n  eventIsUnsettingLastFilledField = (event: PatchEvent): boolean => {\n    const patch = event.patches[0]\n    if (event.patches.length !== 1 || patch.type !== 'unset') {\n      return false\n    }\n\n    const allKeys = Object.keys(this.props.value || {})\n    const remainingKeys = allKeys.filter(\n      (key) => !['_type', '_key', 'crop', 'hotspot'].includes(key),\n    )\n\n    const isEmpty =\n      event.patches[0].path.length === 1 &&\n      remainingKeys.length === 1 &&\n      remainingKeys[0] === event.patches[0].path[0]\n\n    return isEmpty\n  }\n\n  valueIsArrayElement = () => {\n    const {path} = this.props\n    const parentPathSegment = path.slice(-1)[0]\n\n    // String path segment mean an object path, while a number or a\n    // keyed segment means we're a direct child of an array\n    return typeof parentPathSegment !== 'string'\n  }\n\n  handleOpenDialog = () => {\n    this.props.onPathFocus(['hotspot'])\n  }\n\n  handleCloseDialog = () => {\n    this.props.onPathFocus([])\n\n    // Set focus on hotspot button in `ImageActionsMenu` when closing the dialog\n    this.state.hotspotButtonElement?.focus()\n  }\n\n  handleSelectAssetFromSource = (assetFromSource: AssetFromSource[]) => {\n    const {onChange, schemaType, resolveUploader} = this.props\n    handleSelectAssetFromSource({\n      assetFromSource,\n      onChange,\n      type: schemaType,\n      resolveUploader,\n      uploadWith: this.uploadWith,\n      isImage: true,\n    })\n\n    this.setState({selectedAssetSource: null})\n  }\n\n  handleFileTargetFocus = (event: FocusEvent) => {\n    // We want to handle focus when the file target element *itself* receives\n    // focus, not when an interactive child element receives focus. Since React has decided\n    // to let focus bubble, so this workaround is needed\n    // Background: https://github.com/facebook/react/issues/6410#issuecomment-671915381\n    if (\n      event.currentTarget === event.target &&\n      event.currentTarget === this.props.elementProps.ref?.current\n    ) {\n      this.props.elementProps.onFocus(event)\n    }\n  }\n\n  handleFilesOver = (hoveringFiles: FileInfo[]) => {\n    this.setState({\n      hoveringFiles: hoveringFiles.filter((file) => file.kind !== 'string'),\n    })\n  }\n  handleFilesOut = () => {\n    this.setState({\n      hoveringFiles: [],\n    })\n  }\n\n  handleCancelUpload = () => {\n    this.cancelUpload()\n  }\n\n  handleClearUploadState = () => {\n    this.setState({isStale: false})\n    this.clearUploadStatus()\n  }\n\n  handleStaleUpload = () => {\n    this.setState({isStale: true})\n  }\n\n  handleClearField = () => {\n    this.props.onChange([unset(['asset']), unset(['crop']), unset(['hotspot'])])\n  }\n\n  handleSelectFiles = (files: File[]) => {\n    const {directUploads, readOnly} = this.props\n    const {hoveringFiles} = this.state\n    if (directUploads && !readOnly) {\n      this.uploadFirstAccepted(files)\n    } else if (hoveringFiles.length > 0) {\n      this.handleFilesOut()\n    }\n  }\n\n  handleSelectImageFromAssetSource = (source: AssetSource) => {\n    this.setState({selectedAssetSource: source})\n  }\n\n  handleAssetSourceClosed = () => {\n    this.setState({selectedAssetSource: null})\n\n    // Set focus on menu button in `ImageActionsMenu` when closing the dialog\n    this.state.menuButtonElement?.focus()\n  }\n\n  renderHotspotInput = (hotspotInputProps: Omit<InputProps, 'renderDefault'>) => {\n    const {value, changed, id, imageUrlBuilder, t} = this.props\n\n    const withImageTool = this.isImageToolEnabled() && value && value.asset\n\n    return (\n      <Dialog\n        __unstable_autoFocus={false}\n        header={t('inputs.image.hotspot-dialog.title')}\n        id={`${id}_dialog`}\n        onClickOutside={this.handleCloseDialog}\n        onClose={this.handleCloseDialog}\n        width={1}\n      >\n        <PresenceOverlay>\n          <Stack space={5}>\n            {withImageTool && value?.asset && (\n              <ImageToolInput\n                {...this.props}\n                imageUrl={imageUrlBuilder.image(value.asset).url()}\n                value={value as FIXME}\n                presence={hotspotInputProps.presence}\n                changed={changed}\n              />\n            )}\n          </Stack>\n        </PresenceOverlay>\n      </Dialog>\n    )\n  }\n\n  renderPreview = () => {\n    const {value, schemaType, readOnly, directUploads, imageUrlBuilder, t, resolveUploader} =\n      this.props\n\n    if (!value || !isImageSource(value)) {\n      return null\n    }\n\n    const {hoveringFiles} = this.state\n\n    const acceptedFiles = hoveringFiles.filter((file) => resolveUploader(schemaType, file))\n\n    const rejectedFilesCount = hoveringFiles.length - acceptedFiles.length\n    const imageUrl = imageUrlBuilder\n      .width(2000)\n      .fit('max')\n      .image(value)\n      .dpr(getDevicePixelRatio())\n      .auto('format')\n      .url()\n\n    return (\n      <ImagePreview\n        onDoubleClick={this.handleOpenDialog}\n        drag={!value?._upload && hoveringFiles.length > 0}\n        isRejected={rejectedFilesCount > 0 || !directUploads}\n        readOnly={readOnly}\n        src={imageUrl}\n        alt={t('inputs.image.preview-uploaded-image')}\n      />\n    )\n  }\n\n  renderAssetMenu() {\n    const {\n      value,\n      assetSources,\n      schemaType,\n      readOnly,\n      directUploads,\n      imageUrlBuilder,\n      observeAsset,\n      t,\n    } = this.props\n\n    const asset = value?.asset\n    if (!asset) {\n      return null\n    }\n\n    const accept = get(schemaType, 'options.accept', 'image/*')\n\n    const showAdvancedEditButton = value && asset && this.isImageToolEnabled()\n\n    let browseMenuItem: ReactNode =\n      assetSources && assetSources.length === 0 ? null : (\n        <MenuItem\n          icon={SearchIcon}\n          text={t('inputs.image.browse-menu.text')}\n          onClick={() => {\n            this.setState({isMenuOpen: false})\n            this.handleSelectImageFromAssetSource(assetSources[0])\n          }}\n          disabled={readOnly}\n          data-testid=\"file-input-browse-button\"\n        />\n      )\n    if (assetSources && assetSources.length > 1) {\n      browseMenuItem = assetSources.map((assetSource) => {\n        return (\n          <MenuItem\n            key={assetSource.name}\n            text={\n              (assetSource.i18nKey ? t(assetSource.i18nKey) : assetSource.title) ||\n              startCase(assetSource.name)\n            }\n            onClick={() => {\n              this.setState({isMenuOpen: false})\n              this.handleSelectImageFromAssetSource(assetSource)\n            }}\n            icon={assetSource.icon || ImageIcon}\n            data-testid={`file-input-browse-button-${assetSource.name}`}\n            disabled={readOnly}\n          />\n        )\n      })\n    }\n\n    return (\n      <WithReferencedAsset observeAsset={observeAsset} reference={asset}>\n        {({_id, originalFilename, extension}) => {\n          let copyUrl: string | undefined\n          let downloadUrl: string | undefined\n\n          if (isImageSource(value)) {\n            const filename = originalFilename || `download.${extension}`\n            downloadUrl = imageUrlBuilder.image(_id).forceDownload(filename).url()\n            copyUrl = imageUrlBuilder.image(_id).url()\n          }\n\n          return (\n            <ImageActionsMenu\n              isMenuOpen={this.state.isMenuOpen}\n              onEdit={this.handleOpenDialog}\n              onMenuOpen={(isOpen) => this.setState({isMenuOpen: isOpen})}\n              setHotspotButtonElement={this.setHotspotButtonElement}\n              setMenuButtonElement={this.setMenuButtonElement}\n              showEdit={showAdvancedEditButton}\n            >\n              <ActionsMenu\n                onUpload={this.handleSelectFiles}\n                browse={browseMenuItem}\n                onReset={this.handleRemoveButtonClick}\n                downloadUrl={downloadUrl}\n                copyUrl={copyUrl}\n                readOnly={readOnly}\n                directUploads={directUploads}\n                accept={accept}\n              />\n            </ImageActionsMenu>\n          )\n        }}\n      </WithReferencedAsset>\n    )\n  }\n\n  renderBrowser() {\n    const {assetSources, readOnly, directUploads, id, t} = this.props\n\n    if (assetSources && assetSources.length === 0) return null\n\n    if (assetSources && assetSources.length > 1 && !readOnly && directUploads) {\n      return (\n        <MenuButton\n          id={`${id}_assetImageButton`}\n          ref={this.setMenuButtonElement}\n          button={\n            <Button\n              data-testid=\"file-input-multi-browse-button\"\n              icon={SearchIcon}\n              iconRight={ChevronDownIcon}\n              mode=\"bleed\"\n              text={t('inputs.image.browse-menu.text')}\n            />\n          }\n          menu={\n            <Menu>\n              {assetSources.map((assetSource) => {\n                return (\n                  <MenuItem\n                    key={assetSource.name}\n                    text={\n                      (assetSource.i18nKey ? t(assetSource.i18nKey) : assetSource.title) ||\n                      startCase(assetSource.name)\n                    }\n                    onClick={() => {\n                      this.setState({isMenuOpen: false})\n                      this.handleSelectImageFromAssetSource(assetSource)\n                    }}\n                    icon={assetSource.icon || ImageIcon}\n                    disabled={readOnly}\n                    data-testid={`file-input-browse-button-${assetSource.name}`}\n                  />\n                )\n              })}\n            </Menu>\n          }\n          popover={ASSET_IMAGE_MENU_POPOVER}\n        />\n      )\n    }\n\n    return (\n      <Button\n        text={t('inputs.image.browse-menu.text')}\n        icon={SearchIcon}\n        mode=\"bleed\"\n        onClick={() => {\n          this.setState({isMenuOpen: false})\n          this.handleSelectImageFromAssetSource(assetSources[0])\n        }}\n        data-testid=\"file-input-browse-button\"\n        disabled={readOnly}\n      />\n    )\n  }\n\n  renderUploadPlaceholder() {\n    const {schemaType, readOnly, directUploads, resolveUploader} = this.props\n\n    const {hoveringFiles} = this.state\n\n    const acceptedFiles = hoveringFiles.filter((file) => resolveUploader(schemaType, file))\n    const rejectedFilesCount = hoveringFiles.length - acceptedFiles.length\n\n    const accept = get(schemaType, 'options.accept', 'image/*')\n\n    return (\n      <div style={{padding: 1}}>\n        <Card\n          tone={readOnly ? 'transparent' : 'inherit'}\n          border\n          paddingX={3}\n          paddingY={2}\n          radius={2}\n          style={hoveringFiles.length === 0 ? {} : {borderColor: 'transparent'}}\n        >\n          <UploadPlaceholder\n            browse={this.renderBrowser()}\n            onUpload={this.handleSelectFiles}\n            readOnly={readOnly}\n            hoveringFiles={hoveringFiles}\n            acceptedFiles={acceptedFiles}\n            rejectedFilesCount={rejectedFilesCount}\n            type=\"image\"\n            accept={accept}\n            directUploads={directUploads}\n          />\n        </Card>\n      </div>\n    )\n  }\n\n  renderUploadState(uploadState: UploadState) {\n    const {isUploading} = this.state\n\n    // if there's a preview image already, preserve the height to avoid jumps\n    const height = this._previewElement?.offsetHeight\n    return (\n      <UploadProgress\n        uploadState={uploadState}\n        onCancel={isUploading ? this.handleCancelUpload : undefined}\n        onStale={this.handleStaleUpload}\n        height={height}\n      />\n    )\n  }\n\n  renderAssetSource() {\n    const {selectedAssetSource} = this.state\n    const {value, schemaType, observeAsset} = this.props\n    const accept = get(schemaType, 'options.accept', 'image/*')\n\n    if (!selectedAssetSource) {\n      return null\n    }\n    const Component = selectedAssetSource.component\n\n    if (value && value.asset) {\n      return (\n        <WithReferencedAsset observeAsset={observeAsset} reference={value.asset}>\n          {(imageAsset) => (\n            <Component\n              selectedAssets={[imageAsset]}\n              assetType=\"image\"\n              accept={accept}\n              selectionType=\"single\"\n              onClose={this.handleAssetSourceClosed}\n              onSelect={this.handleSelectAssetFromSource}\n            />\n          )}\n        </WithReferencedAsset>\n      )\n    }\n    return (\n      <Component\n        selectedAssets={[]}\n        selectionType=\"single\"\n        assetType=\"image\"\n        accept={accept}\n        onClose={this.handleAssetSourceClosed}\n        onSelect={this.handleSelectAssetFromSource}\n      />\n    )\n  }\n\n  setToast = (toast: {push: (params: ToastParams) => void}) => {\n    this.toast = toast\n  }\n\n  getFileTone() {\n    const {schemaType, value, readOnly, directUploads, resolveUploader} = this.props\n\n    const {hoveringFiles} = this.state\n\n    const acceptedFiles = hoveringFiles.filter((file) => resolveUploader(schemaType, file))\n    const rejectedFilesCount = hoveringFiles.length - acceptedFiles.length\n\n    if (hoveringFiles.length > 0) {\n      if (rejectedFilesCount > 0 || !directUploads) {\n        return 'critical'\n      }\n    }\n\n    if (!value?._upload && !readOnly && hoveringFiles.length > 0) {\n      return 'primary'\n    }\n\n    if (readOnly) {\n      return 'transparent'\n    }\n\n    return value?._upload && value?.asset ? 'transparent' : 'default'\n  }\n\n  renderAsset() {\n    const {value, readOnly, elementProps} = this.props\n\n    const {hoveringFiles, isStale} = this.state\n\n    const hasValueOrUpload = Boolean(value?._upload || value?.asset)\n\n    if (value && typeof value.asset !== 'undefined' && !value?._upload && !isImageSource(value)) {\n      return () => <InvalidImageWarning onClearValue={this.handleClearField} />\n    }\n\n    // todo: convert this to a functional component and use this with useCallback\n    //  it currently has to return a new function on every render in order to pick up state from this component\n    return (inputProps: Omit<InputProps, 'renderDefault'>) => (\n      <>\n        {isStale && (\n          <Box marginBottom={2}>\n            <UploadWarning onClearStale={this.handleClearUploadState} />\n          </Box>\n        )}\n\n        <ChangeIndicator\n          path={inputProps.path.concat(ASSET_FIELD_PATH)}\n          hasFocus={!!inputProps.focused}\n          isChanged={inputProps.changed}\n        >\n          {value?._upload ? (\n            this.renderUploadState(value._upload)\n          ) : (\n            <FileTarget\n              {...elementProps}\n              onFocus={this.handleFileTargetFocus}\n              tabIndex={0}\n              disabled={Boolean(readOnly)}\n              onFiles={this.handleSelectFiles}\n              onFilesOver={this.handleFilesOver}\n              onFilesOut={this.handleFilesOut}\n              tone={this.getFileTone()}\n              $border={hasValueOrUpload || hoveringFiles.length > 0}\n              sizing=\"border\"\n              radius={2}\n            >\n              {!value?.asset && this.renderUploadPlaceholder()}\n              {!value?._upload && value?.asset && (\n                <div style={{position: 'relative'}} ref={this.setPreviewElement}>\n                  {this.renderPreview()}\n                  {this.renderAssetMenu()}\n                </div>\n              )}\n            </FileTarget>\n          )}\n        </ChangeIndicator>\n      </>\n    )\n  }\n\n  render() {\n    const {\n      focusPath,\n      members,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n    } = this.props\n\n    const {selectedAssetSource} = this.state\n\n    // we use the hotspot field as the \"owner\" of both hotspot and crop\n    const hotspotField = members.find(\n      (member): member is FieldMember => member.kind === 'field' && member.name === 'hotspot',\n    )\n\n    return (\n      // The Stack space should match the space in ObjectInput\n      <Stack space={5} data-testid=\"image-input\">\n        <ImperativeToast ref={this.setToast} />\n        {members.map((member) => {\n          if (member.kind === 'field' && (member.name === 'crop' || member.name === 'hotspot')) {\n            // we're rendering these separately\n            return null\n          }\n\n          if (member.kind === 'field') {\n            return (\n              <MemberField\n                key={member.key}\n                member={member}\n                renderAnnotation={renderAnnotation}\n                renderBlock={renderBlock}\n                renderInlineBlock={renderInlineBlock}\n                renderInput={member.name === 'asset' ? this.renderAsset() : renderInput}\n                renderField={member.name === 'asset' ? passThrough : renderField}\n                renderItem={renderItem}\n                renderPreview={renderPreview}\n              />\n            )\n          }\n\n          if (member.kind === 'fieldSet') {\n            return (\n              <MemberFieldSet\n                key={member.key}\n                member={member}\n                renderAnnotation={renderAnnotation}\n                renderBlock={renderBlock}\n                renderField={renderField}\n                renderInlineBlock={renderInlineBlock}\n                renderInput={renderInput}\n                renderItem={renderItem}\n                renderPreview={renderPreview}\n              />\n            )\n          }\n          if (member.kind === 'error') {\n            return <MemberFieldError key={member.key} member={member} />\n          }\n          //@ts-expect-error all possible cases should be covered\n          return <>{t('inputs.image.error.unknown-member-kind', {kind: member.kind})}</>\n        })}\n\n        {hotspotField && focusPath[0] === 'hotspot' && (\n          <FormInput\n            {...this.props}\n            absolutePath={hotspotField.field.path}\n            renderInput={this.renderHotspotInput}\n          />\n        )}\n        {selectedAssetSource && this.renderAssetSource()}\n      </Stack>\n    )\n  }\n}\n","import imageUrlBuilder from '@sanity/image-url'\nimport {type SchemaType} from '@sanity/types'\nimport {useCallback, useMemo} from 'react'\n\nimport {useClient} from '../../../hooks'\nimport {useTranslation} from '../../../i18n'\nimport {useDocumentPreviewStore} from '../../../store'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../studioClient'\nimport {BaseImageInput, type BaseImageInputProps} from '../../inputs/files/ImageInput'\nimport {useFormBuilder} from '../../useFormBuilder'\nimport {resolveUploader as defaultResolveUploader} from '../uploads/resolveUploader'\nimport {type FileLike} from '../uploads/types'\nimport {observeImageAsset} from './client-adapters/assets'\n\n/**\n * @hidden\n * @beta */\nexport type ImageInputProps = Omit<\n  BaseImageInputProps,\n  | 'assetSources'\n  | 'directUploads'\n  | 'imageUrlBuilder'\n  | 'observeAsset'\n  | 'client'\n  | 'resolveUploader'\n>\n\n/**\n * @hidden\n * @beta */\nexport function StudioImageInput(props: ImageInputProps) {\n  const sourcesFromSchema = props.schemaType.options?.sources\n  const {image} = useFormBuilder().__internal\n  const documentPreviewStore = useDocumentPreviewStore()\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const supportsImageUploads = image.directUploads\n\n  const resolveUploader = useCallback(\n    (type: SchemaType, file: FileLike) => {\n      if (!supportsImageUploads) {\n        return null\n      }\n      return defaultResolveUploader(type, file)\n    },\n    [supportsImageUploads],\n  )\n\n  // note: type.options.sources may be an empty array and in that case we're\n  // disabling selecting images from asset source  (it's a feature, not a bug)\n  const assetSources = useMemo(\n    () => sourcesFromSchema || image.assetSources,\n    [image, sourcesFromSchema],\n  )\n\n  const builder = useMemo(() => imageUrlBuilder(client), [client])\n\n  const observeAsset = useCallback(\n    (id: string) => observeImageAsset(documentPreviewStore, id),\n    [documentPreviewStore],\n  )\n\n  const {t} = useTranslation()\n  return (\n    <BaseImageInput\n      {...props}\n      t={t}\n      client={client}\n      assetSources={assetSources}\n      directUploads={supportsImageUploads}\n      imageUrlBuilder={builder}\n      observeAsset={observeAsset}\n      resolveUploader={resolveUploader}\n    />\n  )\n}\n","import {type ComponentType} from 'react'\n\nimport {type FIXME} from '../../../FIXME'\nimport {UniversalArrayInput} from '../../inputs/arrays/UniversalArrayInput'\nimport {BooleanInput} from '../../inputs/BooleanInput'\nimport {DateInput, DateTimeInput} from '../../inputs/DateInputs'\nimport {EmailInput} from '../../inputs/EmailInput'\nimport {NumberInput} from '../../inputs/NumberInput'\nimport {ObjectInput} from '../../inputs/ObjectInput'\nimport {SlugInput} from '../../inputs/Slug/SlugInput'\nimport {StringInput} from '../../inputs/StringInput'\nimport {TextInput} from '../../inputs/TextInput'\nimport {UrlInput} from '../../inputs/UrlInput'\nimport {StudioCrossDatasetReferenceInput} from '../inputs/crossDatasetReference/StudioCrossDatasetReferenceInput'\nimport {StudioFileInput} from '../inputs/StudioFileInput'\nimport {StudioImageInput} from '../inputs/StudioImageInput'\n\nexport const defaultInputs: Record<string, ComponentType<FIXME>> = {\n  document: ObjectInput,\n  object: ObjectInput,\n  array: UniversalArrayInput,\n  boolean: BooleanInput,\n  number: NumberInput,\n  text: TextInput,\n  email: EmailInput,\n  datetime: DateTimeInput,\n  date: DateInput,\n  url: UrlInput,\n  image: StudioImageInput,\n  file: StudioFileInput,\n  string: StringInput,\n  slug: SlugInput,\n  crossDatasetReference: StudioCrossDatasetReferenceInput,\n}\n","import {defineEvent} from '@sanity/telemetry'\n\nexport const PortableTextInputExpanded = defineEvent({\n  version: 1,\n  name: 'Portable Text Editor Expanded',\n  description: 'The portable text editor was expanded',\n})\n\nexport const PortableTextInputCollapsed = defineEvent({\n  version: 1,\n  name: 'Portable Text Editor Collapsed',\n  description: 'The portable text editor was collapsed',\n})\n\nexport const PortableTextInvalidValueIgnore = defineEvent({\n  version: 1,\n  name: 'Portable Text Editor Invalid Value Ignored',\n  description:\n    'The portable text got an invalid value from the form and pressed button to ignore it',\n})\n\nexport const PortableTextInvalidValueResolve = defineEvent<{\n  PTEInvalidValueId: string\n  PTEInvalidValueDescription: string\n}>({\n  version: 1,\n  name: 'Portable Text Editor Invalid Value Resolved',\n  description:\n    'The portable text got an invalid value from the form and pressed button to resolve it.',\n})\n","import {Card, Flex} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const OverlayContainer = styled.div`\n  position: relative;\n`\n\nexport const ContentContainer = styled.div`\n  z-index: 13;\n  opacity: 0;\n  transition: opacity 300ms linear;\n`\n\nexport const CardContainer = styled(Card)`\n  border: 1px solid var(--card-border-color);\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 12;\n  transition: opacity 150ms ease-in-out;\n  opacity: 0;\n  box-sizing: border-box;\n`\n\nexport const FlexContainer = styled(Flex)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n\n  &:hover,\n  &:focus {\n    & ${CardContainer} {\n      opacity: 0.9;\n    }\n\n    & ${ContentContainer} {\n      opacity: 1;\n    }\n  }\n`\n","// This is transitional in order to track usage of the ActivateOnFocusPart part from within the form-builder package\nimport {Text} from '@sanity/ui'\nimport {type KeyboardEvent, type ReactNode, useCallback, useMemo, useState} from 'react'\n\nimport {useTranslation} from '../../../i18n'\nimport {\n  CardContainer,\n  ContentContainer,\n  FlexContainer,\n  OverlayContainer,\n} from './ActivateOnFocus.styles'\n\nconst isTouchDevice = () =>\n  (typeof window !== 'undefined' && 'ontouchstart' in window) ||\n  (typeof navigator !== 'undefined' && navigator.maxTouchPoints > 0)\n\n/**\n * @internal\n */\nexport interface ActivateOnFocusProps {\n  children: ReactNode\n  message?: ReactNode\n  onActivate?: () => void\n  isOverlayActive: boolean\n}\n\n/**\n * @internal\n */\n\nexport function ActivateOnFocus(props: ActivateOnFocusProps) {\n  const {children, message, onActivate, isOverlayActive} = props\n  const [focused, setFocused] = useState(false)\n  const {t} = useTranslation()\n\n  const handleClick = useCallback(() => {\n    if (onActivate) {\n      onActivate()\n    }\n  }, [onActivate])\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLDivElement>) => {\n      if (!isOverlayActive) {\n        return\n      }\n      if (event.code === 'Space' && onActivate) {\n        event.preventDefault()\n        onActivate()\n      }\n    },\n    [isOverlayActive, onActivate],\n  )\n\n  const handleOnFocus = useCallback(() => {\n    setFocused(true)\n  }, [])\n\n  const handleBlur = useCallback(() => {\n    setFocused(false)\n  }, [])\n\n  const msg = useMemo(() => {\n    const isTouch = isTouchDevice()\n    let messageContext\n\n    if (isTouch) {\n      messageContext = 'tap'\n    } else if (focused) {\n      messageContext = 'click-focused'\n    } else {\n      messageContext = 'click'\n    }\n\n    const text =\n      message ||\n      t('inputs.portable-text.activate-on-focus-message', {\n        context: messageContext,\n      })\n    return <Text weight=\"medium\">{text}</Text>\n  }, [focused, message, t])\n\n  return (\n    <OverlayContainer\n      onBlur={handleBlur}\n      onClick={handleClick}\n      onFocus={handleOnFocus}\n      onKeyDown={handleKeyDown}\n    >\n      {isOverlayActive && (\n        <FlexContainer data-testid=\"activate-overlay\" tabIndex={0} align=\"center\" justify=\"center\">\n          <CardContainer\n            // Almost all input elements have radius=1, and this component is\n            // typically used for overlaying input elements.\n            // @todo Consider making `radius` a component property of `ActivateOnFocus`.\n            radius={2}\n          />\n          <ContentContainer>{msg}</ContentContainer>\n        </FlexContainer>\n      )}\n      {children}\n    </OverlayContainer>\n  )\n}\n","/* eslint-disable camelcase */\n\nimport {Layer} from '@sanity/ui'\nimport {getTheme_v2} from '@sanity/ui/theme'\nimport styled, {css} from 'styled-components'\n\nimport {focusRingBorderStyle, focusRingStyle} from '../../components/withFocusRing/helpers'\n\nexport const Root = styled.div((props) => {\n  const {color, input, radius} = getTheme_v2(props.theme)\n\n  const border = {\n    color: color.input.default.enabled.border,\n    width: input.border.width,\n  }\n\n  return css`\n    --input-box-shadow: ${focusRingBorderStyle(border)};\n\n    position: relative;\n\n    & [data-wrapper] {\n      overflow: hidden;\n      overflow: clip;\n      position: relative;\n      z-index: 1;\n      padding: ${input.border.width}px;\n    }\n\n    & [data-border] {\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      box-shadow: var(--input-box-shadow);\n      z-index: 2;\n      border-radius: ${radius[2]}px;\n      pointer-events: none;\n    }\n\n    &:not([data-read-only])[data-focused] [data-border] {\n      --input-box-shadow: ${focusRingStyle({\n        base: color,\n        border,\n        focusRing: input.text.focusRing,\n      })};\n    }\n  `\n})\n\n// This element only wraps the input when in \"fullscreen\" mode\nexport const ExpandedLayer = styled(Layer)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n`\n","import {type ResponsivePaddingProps} from '@sanity/ui'\nimport {type ElementType} from 'react'\n\nexport const TEXT_LEVELS = [1, 2, 3, 4, 5, 6, 7, 8, 9]\n\nexport const TEXT_BULLET_MARKERS = ['', '', '']\n\nexport const TEXT_NUMBER_FORMATS = ['number', 'lower-alpha', 'lower-roman']\n\nexport const TEXT_DECORATOR_TAGS: Record<string, ElementType> = {\n  em: 'em',\n  'strike-through': 's',\n  underline: 'u',\n  strong: 'strong',\n  code: 'code',\n}\n\nexport const TEXT_STYLE_PADDING: Record<string, ResponsivePaddingProps> = {\n  h1: {\n    paddingTop: 5,\n    paddingBottom: 4,\n  },\n  h2: {\n    paddingTop: 4,\n    paddingBottom: 4,\n  },\n  h3: {\n    paddingTop: 4,\n    paddingBottom: 3,\n  },\n  h4: {\n    paddingTop: 4,\n    paddingBottom: 3,\n  },\n  h5: {\n    paddingTop: 4,\n    paddingBottom: 3,\n  },\n  h6: {\n    paddingTop: 4,\n    paddingBottom: 2,\n  },\n  normal: {\n    paddingTop: 2,\n    paddingBottom: 3,\n  },\n  blockquote: {\n    paddingTop: 2,\n    paddingBottom: 3,\n  },\n}\n","import {type BlockDecoratorRenderProps} from '@sanity/portable-text-editor'\nimport {useCallback, useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {type BlockDecoratorProps} from '../../../types'\nimport {TEXT_DECORATOR_TAGS} from './constants'\n\nconst Root = styled.span`\n  /* Make sure the annotation styling is visible */\n  &[data-mark='code'] {\n    mix-blend-mode: multiply;\n    color: inherit;\n  }\n`\n\nexport function Decorator(props: BlockDecoratorRenderProps) {\n  const {value, focused, selected, children, schemaType} = props\n  const tag = TEXT_DECORATOR_TAGS[value]\n  const CustomComponent = schemaType.component\n  const DefaultComponent = useCallback(\n    (defaultComponentProps: BlockDecoratorProps) => {\n      return (\n        <Root as={tag} data-mark={value}>\n          {defaultComponentProps.children}\n        </Root>\n      )\n    },\n    [tag, value],\n  )\n  return useMemo(() => {\n    const componentProps = {\n      focused,\n      renderDefault: DefaultComponent,\n      schemaType,\n      selected,\n      title: schemaType.title,\n      value,\n    }\n    return CustomComponent ? (\n      <CustomComponent {...componentProps}>{children}</CustomComponent>\n    ) : (\n      <DefaultComponent {...componentProps}>{children}</DefaultComponent>\n    )\n  }, [CustomComponent, DefaultComponent, children, focused, schemaType, selected, value])\n}\n","export function createListName(level: number): string {\n  return `list-level-${level}`\n}\n","import {rgba} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nexport const ReviewChangesHighlightBlock = styled.div(({theme}) => {\n  const {radius, space, color} = theme.sanity\n  const bg = rgba(color.spot.yellow, 0.2)\n\n  return css`\n    position: absolute;\n    border-radius: ${radius[3]}px;\n    top: -${space[2]}px;\n    bottom: -${space[1] + space[1]}px;\n    left: ${space[4] + space[1]}px;\n    right: 0;\n    background-color: ${bg};\n  `\n})\n","import styled, {css} from 'styled-components'\n\nimport {ChangeIndicator} from '../../../../changeIndicators'\n\nexport const StyledChangeIndicatorWithProvidedFullPath = styled(ChangeIndicator)(() => {\n  return css`\n    width: 1px;\n    height: 100%;\n\n    & > div {\n      height: 100%;\n    }\n  `\n})\n","import {normalizeBlock} from '@sanity/block-tools'\nimport {type PortableTextBlock} from '@sanity/types'\n\nimport {insert, PatchEvent} from '../../../patch'\nimport {type InsertCallback} from './types'\n\nexport function createInsertCallback(options: {\n  allowedDecorators: string[]\n  block: PortableTextBlock\n  onChange: (patches: PatchEvent) => void\n}): InsertCallback {\n  const {allowedDecorators, block, onChange} = options\n\n  let toInsert\n\n  return (givenBlock: PortableTextBlock | PortableTextBlock[]): void => {\n    toInsert = Array.isArray(givenBlock) ? givenBlock : [givenBlock]\n    toInsert = toInsert.map((blk) =>\n      normalizeBlock(blk, {\n        allowedDecorators,\n      }),\n    )\n\n    const patches = [insert(toInsert, 'after', [{_key: block._key}])]\n\n    return onChange(PatchEvent.from(patches))\n  }\n}\n","import {normalizeBlock} from '@sanity/block-tools'\nimport {type PortableTextBlock} from '@sanity/types'\n\nimport {PatchEvent, set} from '../../../patch'\nimport {type SetCallback} from './types'\n\nexport function createSetCallback(options: {\n  allowedDecorators: string[]\n  block: PortableTextBlock\n  onChange: (patches: PatchEvent) => void\n}): SetCallback {\n  const {allowedDecorators, block, onChange} = options\n\n  return (givenBlock: PortableTextBlock): void => {\n    const patches = [\n      set(\n        normalizeBlock(givenBlock, {\n          allowedDecorators,\n        }),\n\n        [{_key: block._key}],\n      ),\n    ]\n\n    return onChange(PatchEvent.from(patches))\n  }\n}\n","import {type PortableTextBlock} from '@sanity/types'\n\nimport {PatchEvent, unset} from '../../../patch'\nimport {type UnsetCallback} from './types'\n\nexport function createUnsetCallback(options: {\n  block: PortableTextBlock\n  onChange: (patches: PatchEvent) => void\n}): UnsetCallback {\n  const {block, onChange} = options\n\n  return (): void => {\n    const patches = [unset([{_key: block._key}])]\n\n    return onChange(PatchEvent.from(patches))\n  }\n}\n","import {PortableTextEditor, usePortableTextEditor} from '@sanity/portable-text-editor'\nimport {type PortableTextBlock} from '@sanity/types'\nimport {useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {type PatchEvent} from '../../patch'\nimport {\n  type RenderBlockActionsCallback,\n  type RenderBlockActionsProps,\n} from '../../types/_transitional'\nimport {createInsertCallback, createSetCallback, createUnsetCallback} from './callbacks'\n\ninterface BlockActionsProps {\n  block: PortableTextBlock\n  onChange: (patches: PatchEvent) => void\n  renderBlockActions?: RenderBlockActionsCallback\n}\n\nconst Root = styled.div`\n  display: flex;\n  pointer-events: all;\n`\n\nexport function BlockActions(props: BlockActionsProps) {\n  const editor = usePortableTextEditor()\n  const {block, onChange, renderBlockActions} = props\n  const decoratorValues = useMemo(() => editor.schemaTypes.decorators.map((d) => d.value), [editor])\n\n  const blockActions = useMemo(() => {\n    if (renderBlockActions) {\n      const blockActionProps: RenderBlockActionsProps = {\n        block,\n        value: PortableTextEditor.getValue(editor),\n        set: createSetCallback({allowedDecorators: decoratorValues, block, onChange}),\n        unset: createUnsetCallback({block, onChange}),\n        insert: createInsertCallback({allowedDecorators: decoratorValues, block, onChange}),\n      }\n      return renderBlockActions(blockActionProps)\n    }\n    return undefined\n  }, [renderBlockActions, block, editor, onChange, decoratorValues])\n\n  // Don't render anything if the renderBlockActions function returns null.\n  // Note that if renderBlockComponent is a React class, this will never be the case.\n  if (!blockActions) return null\n\n  return <Root contentEditable={false}>{blockActions}</Root>\n}\n","/* eslint-disable camelcase */\n\nimport {hues} from '@sanity/color'\nimport {Box, Flex, type Theme} from '@sanity/ui'\nimport {getTheme_v2, rgba} from '@sanity/ui/theme'\nimport styled, {css} from 'styled-components'\n\nimport {TEXT_BULLET_MARKERS, TEXT_NUMBER_FORMATS} from './constants'\nimport {createListName} from './helpers'\n\ninterface TextBlockStyleProps {\n  $level: number\n}\n\nfunction textBlockStyle(props: TextBlockStyleProps & {theme: Theme}) {\n  const {$level} = props\n  const {color, font, radius, space} = getTheme_v2(props.theme)\n\n  const numberMarker = TEXT_NUMBER_FORMATS[($level - 1) % TEXT_NUMBER_FORMATS.length]\n  const bulletMarker = TEXT_BULLET_MARKERS[($level - 1) % TEXT_BULLET_MARKERS.length]\n\n  return css`\n    --marker-bg-color: transparent;\n\n    mix-blend-mode: ${color._dark ? 'screen' : 'multiply'};\n    position: relative;\n\n    & > [data-ui='TextBlock_inner'] {\n      position: relative;\n      flex: 1;\n    }\n\n    & > div:before {\n      content: '';\n      position: absolute;\n      top: -${space[1]}px;\n      bottom: -${space[1]}px;\n      left: -${space[1]}px;\n      right: -${space[1]}px;\n      border-radius: ${radius[2]}px;\n      background-color: var(--marker-bg-color);\n      // This is to make sure the marker is always behind the text\n      z-index: -1;\n    }\n\n    &[data-markers] {\n      --marker-bg-color: ${color._dark ? hues.purple[950].hex : hues.purple[50].hex};\n    }\n\n    &[data-warning] {\n      --card-border-color: ${color.button.ghost.caution.enabled.border};\n      --marker-bg-color: ${color.button.ghost.caution.hovered.bg};\n    }\n\n    &[data-error] {\n      --card-border-color: ${color.button.ghost.critical.enabled.border};\n      --marker-bg-color: ${color.button.ghost.critical.hovered.bg};\n    }\n\n    & [data-list-prefix] {\n      position: absolute;\n      margin-left: -4.5rem;\n      width: 3.75rem;\n      text-align: right;\n      box-sizing: border-box;\n    }\n\n    &[data-list-item='number'] [data-list-prefix] {\n      font-variant-numeric: tabular-nums;\n\n      & > span:before {\n        content: counter(${createListName($level)}) '.';\n        content: counter(${createListName($level)}, ${numberMarker}) '.';\n      }\n    }\n\n    &[data-list-item='bullet'] [data-list-prefix] {\n      & > span {\n        position: relative;\n        top: -0.1875em;\n\n        &:before {\n          content: '${bulletMarker}';\n          font-size: 0.46666em;\n        }\n      }\n    }\n\n    & [data-text] {\n      overflow-wrap: anywhere;\n      text-transform: none;\n      white-space: pre-wrap;\n      font-family: ${font.text.family};\n      flex: 1;\n\n      *::selection {\n        background-color: ${rgba(color.focusRing, 0.3)};\n      }\n    }\n  `\n}\n\nexport const TextRoot = styled.div<TextBlockStyleProps>(textBlockStyle)\n\n// Because of a weird bug in Google Chrome regarding the @sanity/ui Flex component and spellchecking,\n// this is set to be a Box with 'display: flex'. Using the Flex component here results in Chrome\n// using 20% CPU when idle when spellchecking is on for some reason.\nexport const TextBlockFlexWrapper = styled(Box)`\n  position: relative;\n  display: flex;\n`\n\nexport const ListPrefixWrapper = styled.div`\n  user-select: none;\n  white-space: nowrap;\n`\n\nexport const BlockExtrasContainer = styled(Box)`\n  user-select: none;\n`\n\nexport const BlockActionsOuter = styled(Box)`\n  line-height: 0;\n  width: 25px;\n  position: relative;\n`\n\nexport const BlockActionsInner = styled(Flex)(({theme}: {theme: Theme}) => {\n  const {fonts, space} = theme.sanity\n  const textSize1 = fonts.text.sizes[1]\n  const textSize2 = fonts.text.sizes[2]\n  const capHeight1 = textSize1.lineHeight - textSize1.ascenderHeight - textSize1.descenderHeight\n  const capHeight2 = textSize2.lineHeight - textSize2.ascenderHeight - textSize2.descenderHeight\n  const buttonHeight = capHeight1 + space[2] + space[2]\n\n  // This calculates the following:\n  // > var buttonHeight = 25px\n  // > var capHeight2 = 11px\n  // > 0 - (buttonHeight - capHeight2) / 2 = -7px\n  const negativeTop = 0 - (buttonHeight - capHeight2) / 2\n\n  return css`\n    user-select: none;\n    position: absolute;\n    right: 0;\n    top: ${negativeTop}px;\n  `\n})\n\nexport const TooltipBox = styled(Box)`\n  max-width: 250px;\n`\n\nexport const TextFlex = styled(Flex)<{$level?: number}>`\n  position: relative;\n  padding-left: ${({$level}) => ($level ? $level * 32 : 0)}px;\n`\n\nexport const ChangeIndicatorWrapper = styled.div<{$hasChanges: boolean}>(\n  ({theme, $hasChanges}: {theme: Theme; $hasChanges: boolean}) => {\n    const {space} = theme.sanity\n\n    return css`\n      position: absolute;\n      width: ${space[2]}px;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      padding-left: ${space[1]}px;\n      user-select: none;\n\n      ${!$hasChanges &&\n      css`\n        display: none;\n      `}\n    `\n  },\n)\n","import {Heading, Text} from '@sanity/ui'\nimport {type ComponentType, type HTMLProps} from 'react'\nimport styled from 'styled-components'\n\ntype TextStyleProps = Omit<HTMLProps<HTMLDivElement>, 'as' | 'ref'>\ntype BlockQuoteStyleProps = Omit<HTMLProps<HTMLQuoteElement>, 'as' | 'ref'>\n\n/**\n * Without this container, editing with Android breaks due to how Text is styled via `responsiveFont` in `@sanity/ui`\n */\nexport const TextContainer = styled.div`\n  display: block;\n`\n\n/**\n * Portable Text Input built in style\n */\nexport const Normal = ({children, ...rest}: TextStyleProps) => (\n  <Text data-testid=\"text-style--normal\" {...rest}>\n    <TextContainer>{children}</TextContainer>\n  </Text>\n)\n\n/**\n * Styled component for Portable Text 'h1' style\n */\nexport const Heading1 = ({children, ...rest}: TextStyleProps) => (\n  <Heading as=\"h1\" data-testid=\"text-style--h1\" size={5} {...rest}>\n    <TextContainer>{children}</TextContainer>\n  </Heading>\n)\n\n/**\n * Styled component for Portable Text 'h2' style\n */\nexport const Heading2 = ({children, ...rest}: TextStyleProps) => (\n  <Heading as=\"h2\" data-testid=\"text-style--h2\" size={4} {...rest}>\n    <TextContainer>{children}</TextContainer>\n  </Heading>\n)\n\n/**\n * Styled component for Portable Text 'h3' style\n */\nexport const Heading3 = ({children, ...rest}: TextStyleProps) => (\n  <Heading as=\"h3\" data-testid=\"text-style--h3\" size={3} {...rest}>\n    <TextContainer>{children}</TextContainer>\n  </Heading>\n)\n\n/**\n * Styled component for Portable Text 'h4' style\n */\nexport const Heading4 = ({children, ...rest}: TextStyleProps) => (\n  <Heading as=\"h4\" data-testid=\"text-style--h4\" size={2} {...rest}>\n    <TextContainer>{children}</TextContainer>\n  </Heading>\n)\n\n/**\n * Styled component for Portable Text 'h5' style\n */\nexport const Heading5 = ({children, ...rest}: TextStyleProps) => (\n  <Heading as=\"h5\" data-testid=\"text-style--h5\" size={1} {...rest}>\n    <TextContainer>{children}</TextContainer>\n  </Heading>\n)\n\n/**\n * Styled component for Portable Text 'h6' style\n */\nexport const Heading6 = ({children, ...rest}: TextStyleProps) => (\n  <Heading as=\"h6\" data-testid=\"text-style--h6\" size={0} {...rest}>\n    <TextContainer>{children}</TextContainer>\n  </Heading>\n)\n\nconst BlockQuoteRoot = styled.blockquote`\n  position: relative;\n  display: block;\n  margin: 0;\n  padding-left: ${({theme}) => theme.sanity.space[3]}px;\n\n  &::before {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: -4px;\n    bottom: -4px;\n    width: 3px;\n    background: var(--card-border-color);\n  }\n`\n\n/**\n * Styled component for Portable Text 'blockquote' style\n */\nexport const BlockQuote = ({children, ...rest}: TextStyleProps) => (\n  <BlockQuoteRoot data-testid=\"text-style--blockquote\" {...(rest as BlockQuoteStyleProps)}>\n    <Text as=\"p\">{children}</Text>\n  </BlockQuoteRoot>\n)\n\n/**\n * Portable Text built in styles.\n */\nexport const TEXT_STYLES: Record<string, ComponentType<TextStyleProps>> = {\n  normal: Normal,\n  h1: Heading1,\n  h2: Heading2,\n  h3: Heading3,\n  h4: Heading4,\n  h5: Heading5,\n  h6: Heading6,\n  blockquote: BlockQuote,\n}\n","import {\n  type EditorSelection,\n  PortableTextEditor,\n  usePortableTextEditor,\n} from '@sanity/portable-text-editor'\nimport {type ObjectSchemaType, type Path, type PortableTextTextBlock} from '@sanity/types'\nimport {Box, Flex, type ResponsivePaddingProps, Text} from '@sanity/ui'\nimport {isEqual} from '@sanity/util/paths'\nimport {type ReactNode, type RefObject, useCallback, useMemo, useState} from 'react'\n\nimport {Tooltip} from '../../../../../ui-components'\nimport {pathToString} from '../../../../field'\nimport {EMPTY_ARRAY} from '../../../../util'\nimport {useFormCallbacks} from '../../../studio'\nimport {useChildPresence} from '../../../studio/contexts/Presence'\nimport {\n  type BlockProps,\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderCustomMarkers,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../../types'\nimport {type RenderBlockActionsCallback} from '../../../types/_transitional'\nimport {useFormBuilder} from '../../../useFormBuilder'\nimport {ReviewChangesHighlightBlock, StyledChangeIndicatorWithProvidedFullPath} from '../_common'\nimport {BlockActions} from '../BlockActions'\nimport {debugRender} from '../debugRender'\nimport {useMemberValidation} from '../hooks/useMemberValidation'\nimport {usePortableTextMarkers} from '../hooks/usePortableTextMarkers'\nimport {usePortableTextMemberItem} from '../hooks/usePortableTextMembers'\nimport {TEXT_STYLE_PADDING} from './constants'\nimport {\n  BlockActionsInner,\n  BlockActionsOuter,\n  BlockExtrasContainer,\n  ChangeIndicatorWrapper,\n  ListPrefixWrapper,\n  TextBlockFlexWrapper,\n  TextFlex,\n  TextRoot,\n  TooltipBox,\n} from './TextBlock.styles'\nimport {TextContainer} from './textStyles'\n\nexport interface TextBlockProps {\n  children: ReactNode\n  floatingBoundary: HTMLElement | null\n  focused: boolean\n  isFullscreen?: boolean\n  onItemClose: () => void\n  onItemOpen: (path: Path) => void\n  onItemRemove: (itemKey: string) => void\n  onPathFocus: (path: Path) => void\n  path: Path\n  readOnly?: boolean\n  referenceBoundary: HTMLElement | null\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderBlockActions?: RenderBlockActionsCallback\n  renderCustomMarkers?: RenderCustomMarkers\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n  schemaType: ObjectSchemaType\n  selected: boolean\n  spellCheck?: boolean\n  value: PortableTextTextBlock\n}\n\nexport function TextBlock(props: TextBlockProps) {\n  const {\n    children,\n    floatingBoundary,\n    focused,\n    isFullscreen,\n    onItemClose,\n    onItemOpen,\n    onPathFocus,\n    path,\n    readOnly,\n    referenceBoundary,\n    renderBlock,\n    renderAnnotation,\n    renderBlockActions,\n    renderCustomMarkers,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n    schemaType,\n    selected,\n    spellCheck,\n    value,\n  } = props\n  const {Markers} = useFormBuilder().__internal.components\n  const [reviewChangesHovered, setReviewChangesHovered] = useState<boolean>(false)\n  const markers = usePortableTextMarkers(path)\n  const memberItem = usePortableTextMemberItem(pathToString(path))\n  const editor = usePortableTextEditor()\n  const {onChange} = useFormCallbacks()\n\n  const presence = useChildPresence(path, true)\n  // Include all presence paths pointing either directly to a block, or directly to a block child\n  // (which is where the user most of the time would have the presence in a text block)\n  const textPresence = useMemo(() => {\n    return presence.filter(\n      (p) =>\n        isEqual(p.path, path) ||\n        (p.path.slice(-3)[1] === 'children' && p.path.length - path.length === 2),\n    )\n  }, [path, presence])\n\n  const handleChangeIndicatorMouseEnter = useCallback(() => setReviewChangesHovered(true), [])\n  const handleChangeIndicatorMouseLeave = useCallback(() => setReviewChangesHovered(false), [])\n\n  const {validation, hasError, hasWarning, hasInfo} = useMemberValidation(memberItem?.node)\n\n  const hasMarkers = Boolean(renderCustomMarkers) && markers.length > 0\n\n  const tooltipEnabled = hasError || hasWarning || hasMarkers || hasInfo\n\n  const onOpen = useCallback(() => {\n    if (memberItem) {\n      onItemOpen(memberItem.node.path)\n    }\n  }, [onItemOpen, memberItem])\n\n  const onRemove = useCallback(() => {\n    const point = {path: path.slice(-1), offset: 0}\n    const sel: EditorSelection = {\n      focus: point,\n      anchor: point,\n    }\n    PortableTextEditor.delete(editor, sel, {mode: 'blocks'})\n    PortableTextEditor.focus(editor)\n  }, [path, editor])\n\n  const text = useMemo(() => {\n    return (\n      <TextFlex align=\"flex-start\" $level={value?.level}>\n        {value.listItem && (\n          <ListPrefixWrapper contentEditable={false}>\n            <Text data-list-prefix=\"\">\n              <TextContainer />\n            </Text>\n          </ListPrefixWrapper>\n        )}\n        <div data-text=\"\" style={debugRender()}>\n          {children}\n        </div>\n      </TextFlex>\n    )\n  }, [value.listItem, value.level, children])\n\n  const innerPaddingProps: ResponsivePaddingProps = useMemo(() => {\n    if (isFullscreen && !renderBlockActions) {\n      return {paddingX: 5}\n    }\n\n    if (isFullscreen && renderBlockActions) {\n      return {paddingLeft: 5, paddingRight: 2}\n    }\n\n    if (renderBlockActions) {\n      return {\n        paddingLeft: 3,\n        paddingRight: 2,\n      }\n    }\n\n    return {paddingX: 3}\n  }, [isFullscreen, renderBlockActions])\n\n  const outerPaddingProps: ResponsivePaddingProps = useMemo(() => {\n    if (value.listItem) {\n      return {paddingY: 2}\n    }\n\n    return TEXT_STYLE_PADDING[value.style || 'normal'] || {paddingY: 2}\n  }, [value])\n\n  const isOpen = Boolean(memberItem?.member.open)\n  const parentSchemaType = editor.schemaTypes.portableText\n\n  const componentProps: BlockProps = useMemo(\n    () => ({\n      __unstable_floatingBoundary: floatingBoundary,\n      __unstable_referenceBoundary: referenceBoundary,\n      __unstable_referenceElement: (memberItem?.elementRef?.current || null) as HTMLElement | null,\n      children: text,\n      focused,\n      markers,\n      onClose: onItemClose,\n      onOpen,\n      onPathFocus,\n      onRemove,\n      open: isOpen,\n      parentSchemaType,\n      path: memberItem?.node.path || EMPTY_ARRAY,\n      presence: textPresence,\n      readOnly: Boolean(readOnly),\n      renderAnnotation,\n      renderBlock,\n      renderDefault: DefaultComponent,\n      renderField,\n      renderInput,\n      renderInlineBlock,\n      renderItem,\n      renderPreview,\n      schemaType,\n      selected,\n      validation,\n      value,\n    }),\n    [\n      floatingBoundary,\n      focused,\n      isOpen,\n      markers,\n      memberItem?.elementRef,\n      memberItem?.node.path,\n      onItemClose,\n      onOpen,\n      onPathFocus,\n      onRemove,\n      parentSchemaType,\n      readOnly,\n      referenceBoundary,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n      schemaType,\n      selected,\n      text,\n      textPresence,\n      validation,\n      value,\n    ],\n  )\n\n  const toolTipContent = useMemo(\n    () =>\n      (tooltipEnabled && (\n        <TooltipBox>\n          <Markers\n            markers={markers}\n            renderCustomMarkers={renderCustomMarkers}\n            validation={validation}\n          />\n        </TooltipBox>\n      )) ||\n      null,\n    [Markers, markers, renderCustomMarkers, tooltipEnabled, validation],\n  )\n\n  return useMemo(\n    () => (\n      <Box\n        data-testid=\"text-block\"\n        {...outerPaddingProps}\n        style={debugRender()}\n        ref={memberItem?.elementRef as RefObject<HTMLDivElement>}\n      >\n        <TextBlockFlexWrapper data-testid=\"text-block__wrapper\">\n          <Flex flex={1} {...innerPaddingProps}>\n            <Box flex={1}>\n              <Tooltip\n                content={toolTipContent}\n                disabled={!tooltipEnabled}\n                placement=\"top\"\n                portal=\"editor\"\n              >\n                <TextRoot\n                  $level={value.level || 1}\n                  data-error={hasError ? '' : undefined}\n                  data-list-item={value.listItem}\n                  data-markers={hasMarkers ? '' : undefined}\n                  data-read-only={readOnly}\n                  data-testid=\"text-block__text\"\n                  data-warning={hasWarning ? '' : undefined}\n                  spellCheck={spellCheck}\n                >\n                  {renderBlock && renderBlock(componentProps)}\n                </TextRoot>\n              </Tooltip>\n            </Box>\n\n            <BlockExtrasContainer contentEditable={false}>\n              <BlockActionsOuter marginRight={1}>\n                <BlockActionsInner>\n                  {renderBlockActions && focused && !readOnly && (\n                    <BlockActions\n                      onChange={onChange}\n                      block={value}\n                      renderBlockActions={renderBlockActions}\n                    />\n                  )}\n                </BlockActionsInner>\n              </BlockActionsOuter>\n\n              {isFullscreen && memberItem && (\n                <ChangeIndicatorWrapper\n                  $hasChanges={memberItem.member.item.changed}\n                  onMouseEnter={handleChangeIndicatorMouseEnter}\n                  onMouseLeave={handleChangeIndicatorMouseLeave}\n                >\n                  <StyledChangeIndicatorWithProvidedFullPath\n                    hasFocus={focused}\n                    isChanged={memberItem.member.item.changed}\n                    path={memberItem.member.item.path}\n                    withHoverEffect={false}\n                  />\n                </ChangeIndicatorWrapper>\n              )}\n            </BlockExtrasContainer>\n            {reviewChangesHovered && <ReviewChangesHighlightBlock />}\n          </Flex>\n        </TextBlockFlexWrapper>\n      </Box>\n    ),\n    [\n      componentProps,\n      focused,\n      handleChangeIndicatorMouseEnter,\n      handleChangeIndicatorMouseLeave,\n      hasError,\n      hasMarkers,\n      hasWarning,\n      innerPaddingProps,\n      isFullscreen,\n      memberItem,\n      onChange,\n      outerPaddingProps,\n      readOnly,\n      renderBlock,\n      renderBlockActions,\n      reviewChangesHovered,\n      spellCheck,\n      toolTipContent,\n      tooltipEnabled,\n      value,\n    ],\n  )\n}\n\nexport const DefaultComponent = (props: BlockProps) => {\n  return <>{props.children}</>\n}\n","/* eslint-disable camelcase */\n\nimport {Card, Container, rem} from '@sanity/ui'\nimport {getTheme_v2} from '@sanity/ui/theme'\nimport styled, {css} from 'styled-components'\n\nimport {ScrollContainer} from '../../../components/scroll'\nimport {createListName, TEXT_LEVELS} from './text'\n\nexport const Root = styled(Card)<{$fullscreen: boolean}>`\n  height: ${({$fullscreen}) => ($fullscreen ? '100%' : '19em')};\n\n  &:not([hidden]) {\n    display: flex;\n  }\n\n  flex-direction: column;\n`\n\nexport const ToolbarCard = styled(Card)`\n  z-index: 10;\n  line-height: 0;\n`\n\nexport const EditableCard = styled(Card)`\n  position: relative;\n  overflow: hidden;\n  overflow: clip;\n\n  & > [data-portal] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    pointer-events: none;\n\n    & > * {\n      pointer-events: initial;\n    }\n  }\n\n  &::selection,\n  *::selection {\n    background-color: transparent;\n  }\n`\n\nexport const Scroller = styled(ScrollContainer)`\n  position: relative;\n  overflow: auto;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n\n  & > * {\n    flex: 1;\n    min-height: auto;\n  }\n`\n\nexport const EditableContainer = styled(Container)`\n  /* @todo: calculate from theme */\n  /* max-width: 728px; */\n`\n\nexport const EditableWrapper = styled(Card)<{$isFullscreen: boolean; $readOnly?: boolean}>`\n  height: 100%;\n  width: 100%;\n  counter-reset: ${TEXT_LEVELS.map((l) => createListName(l)).join(' ')};\n  overflow: hidden;\n  overflow: clip;\n\n  & > div {\n    height: 100%;\n  }\n\n  & .pt-editable {\n    display: block;\n    width: 100%;\n    height: 100%;\n\n    ${TEXT_LEVELS.map((l) => {\n      return css`\n        & > .pt-list-item-number[class~='pt-list-item-level-${l}'] {\n          counter-increment: ${createListName(l)};\n        }\n      `\n    })}\n\n    & > .pt-list-item-bullet + .pt-list-item-number,\n    & > .pt-list-item-number + .pt-list-item-bullet {\n      margin-top: ${({theme}) => theme.sanity.space[3]}px;\n      counter-reset: ${TEXT_LEVELS.map((l) => createListName(l)).join(' ')};\n    }\n\n    & > :not(.pt-list-item) + .pt-list-item {\n      margin-top: ${({theme}) => theme.sanity.space[2]}px;\n    }\n\n    /* Reset the list count if the element is not a numbered list item */\n    & > :not(.pt-list-item-number) {\n      counter-reset: ${TEXT_LEVELS.map((l) => createListName(l)).join(' ')};\n    }\n\n    ${TEXT_LEVELS.slice(1).map((l) => {\n      return css`\n        & > .pt-list-item-level-${l} + .pt-list-item-level-${l - 1} {\n          counter-reset: ${createListName(l)};\n        }\n      `\n    })}\n\n    & > .pt-list-item + :not(.pt-list-item) {\n      margin-top: ${({theme}) => theme.sanity.space[3]}px;\n    }\n\n    & > :first-child {\n      padding-top: ${({$isFullscreen, theme}) => theme.sanity.space[$isFullscreen ? 5 : 3]}px;\n    }\n\n    & > :last-child {\n      padding-bottom: ${({$isFullscreen, theme}) => theme.sanity.space[$isFullscreen ? 9 : 5]}px;\n    }\n\n    /* & > .pt-block {\n      & .pt-inline-object {\n      }\n    } */\n\n    & .pt-drop-indicator {\n      pointer-events: none;\n      border: 1px solid var(--card-focus-ring-color) !important;\n      height: 0px !important;\n      border-radius: ${(props) => getTheme_v2(props.theme).radius[2]}px;\n      margin-top: -3px;\n      left: calc(\n        ${({$isFullscreen, theme}) =>\n            $isFullscreen ? rem(theme.sanity.space[5]) : rem(theme.sanity.space[3])} - 1px\n      );\n      right: calc(\n        ${({$isFullscreen, theme}) =>\n            $isFullscreen ? rem(theme.sanity.space[5]) : rem(theme.sanity.space[3])} - 1px\n      );\n      width: calc(\n        100% -\n          ${({$isFullscreen, theme}) =>\n            $isFullscreen ? rem(theme.sanity.space[5] * 2) : rem(theme.sanity.space[3] * 2)} + 2px\n      ) !important;\n    }\n  }\n`\n","import {PortableTextEditor} from '@sanity/portable-text-editor'\nimport {useMemo} from 'react'\nimport scrollIntoView from 'scroll-into-view-if-needed'\n\n// This hook is used to scroll the editor selection into place when actively editing the document.\nexport function useScrollSelectionIntoView(scrollElement: HTMLElement | null) {\n  return useMemo(\n    () =>\n      (editor: PortableTextEditor, domRange: Range): void => {\n        const selection = PortableTextEditor.getSelection(editor)\n        if (selection) {\n          const leafEl = domRange.startContainer.parentElement\n          if (!leafEl) {\n            return\n          }\n          scrollIntoView(leafEl, {\n            scrollMode: 'if-needed',\n            boundary: scrollElement,\n            block: 'start',\n            inline: 'nearest',\n          })\n        }\n      },\n    [scrollElement],\n  )\n}\n","import {usePortableTextEditor} from '@sanity/portable-text-editor'\nimport {useMemo} from 'react'\n\nexport function useSpellcheck(): boolean {\n  const editor = usePortableTextEditor()\n  return useMemo(() => {\n    // Chrome 96. has serious perf. issues with spellchecking\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=1271918\n    // This issue is verified fixed in Chrome 97.\n    const spellCheckOption = editor.schemaTypes.block.options?.spellCheck\n    const isChrome96 =\n      typeof navigator === 'undefined' ? false : /Chrome\\/96/.test(navigator.userAgent)\n    return spellCheckOption === undefined && isChrome96 === true ? false : spellCheckOption\n  }, [editor])\n}\n","import {type BlockListItemRenderProps} from '@sanity/portable-text-editor'\nimport {useMemo} from 'react'\n\nimport {type BlockListItemProps} from '../../../types'\n\nconst DefaultComponent = (dProps: BlockListItemProps) => {\n  return <>{dProps.children}</>\n}\n\nexport const ListItem = (props: BlockListItemRenderProps) => {\n  const {block, children, schemaType, selected, focused, level, value} = props\n  const {title, component: CustomComponent} = schemaType\n  return useMemo(() => {\n    const componentProps = {\n      block,\n      focused,\n      level,\n      renderDefault: DefaultComponent,\n      schemaType,\n      selected,\n      title,\n      value,\n    }\n    return CustomComponent ? (\n      <CustomComponent {...componentProps}>{children}</CustomComponent>\n    ) : (\n      <DefaultComponent {...componentProps}>{children}</DefaultComponent>\n    )\n  }, [CustomComponent, block, children, focused, level, schemaType, selected, title, value])\n}\n","import {type BlockStyleRenderProps} from '@sanity/portable-text-editor'\nimport {useCallback, useMemo} from 'react'\n\nimport {type BlockStyleProps} from '../../../types'\nimport {Normal as FallbackComponent, TEXT_STYLES, TextContainer} from './textStyles'\n\nexport const Style = (props: BlockStyleRenderProps) => {\n  const {block, focused, children, selected, schemaType} = props\n  const DefaultComponentWithFallback = useMemo(\n    () =>\n      (block.style && TEXT_STYLES[block.style] ? TEXT_STYLES[block.style] : TEXT_STYLES[0]) ||\n      FallbackComponent,\n    [block.style],\n  )\n\n  const DefaultComponent = useCallback(\n    (defaultComponentProps: BlockStyleProps) => {\n      return (\n        <DefaultComponentWithFallback>\n          <TextContainer data-testid={`text-style--${block.style}`}>\n            {defaultComponentProps.children}\n          </TextContainer>\n        </DefaultComponentWithFallback>\n      )\n    },\n    [DefaultComponentWithFallback, block.style],\n  )\n\n  return useMemo(() => {\n    const CustomComponent = schemaType.component\n    const {title, value} = schemaType\n    const componentProps = {\n      block,\n      focused,\n      renderDefault: DefaultComponent,\n      schemaType,\n      selected,\n      title,\n      value,\n    }\n    return CustomComponent ? (\n      <CustomComponent {...componentProps}>{children}</CustomComponent>\n    ) : (\n      <DefaultComponent {...componentProps}>{children}</DefaultComponent>\n    )\n  }, [DefaultComponent, block, children, focused, schemaType, selected])\n}\n","import styled from 'styled-components'\n\nconst DividerDiv = styled.div`\n  border-right: 1px solid var(--card-border-color);\n  height: auto;\n\n  &[data-hidden] {\n    opacity: 0;\n  }\n`\n\ninterface CollapseMenuDividerProps {\n  hidden?: boolean\n}\n\nexport function CollapseMenuDivider(props: CollapseMenuDividerProps) {\n  const {hidden, ...rest} = props\n\n  return (\n    <DividerDiv data-ui=\"CollapseMenuDivider\" data-hidden={hidden ? '' : undefined} {...rest} />\n  )\n}\n","import {Menu, MenuDivider} from '@sanity/ui'\nimport {type ForwardedRef, forwardRef, Fragment, type ReactElement} from 'react'\n\nimport {MenuButton, type MenuButtonProps, MenuItem} from '../../../ui-components'\nimport {type CollapseMenuProps} from './CollapseMenu'\n\nconst MENU_BUTTON_POPOVER_PROPS: MenuButtonProps['popover'] = {\n  portal: true,\n  constrainSize: true,\n}\n\nexport const CollapseOverflowMenu = forwardRef(function CollapseOverflowMenu(\n  props: Pick<\n    CollapseMenuProps,\n    'disableRestoreFocusOnClose' | 'menuButtonProps' | 'onMenuClose'\n  > & {menuOptions: ReactElement[]; menuButton: ReactElement},\n  forwardedRef: ForwardedRef<HTMLButtonElement>,\n) {\n  const {disableRestoreFocusOnClose, menuButton, menuButtonProps, menuOptions, onMenuClose} = props\n\n  return (\n    <MenuButton\n      __unstable_disableRestoreFocusOnClose={disableRestoreFocusOnClose}\n      id=\"menu-button\"\n      ref={forwardedRef}\n      onClose={onMenuClose}\n      popover={MENU_BUTTON_POPOVER_PROPS}\n      {...menuButtonProps}\n      button={menuButton}\n      menu={\n        <Menu>\n          {menuOptions.map((c, index) => {\n            const {\n              // eslint-disable-next-line @typescript-eslint/no-unused-vars\n              collapsedProps = {},\n              // eslint-disable-next-line @typescript-eslint/no-unused-vars\n              expandedProps = {},\n              // eslint-disable-next-line @typescript-eslint/no-unused-vars\n              tooltipProps = {},\n              // eslint-disable-next-line @typescript-eslint/no-unused-vars\n              tooltipText,\n              // eslint-disable-next-line @typescript-eslint/no-unused-vars\n              dividerBefore,\n              // eslint-disable-next-line @typescript-eslint/no-unused-vars\n              fontSize,\n              // eslint-disable-next-line @typescript-eslint/no-unused-vars\n              padding,\n              text,\n              icon,\n              selected,\n              ...rest\n            } = c.props\n\n            return (\n              <Fragment key={c.key}>\n                {dividerBefore && index !== 0 && <MenuDivider />}\n                <MenuItem text={text} icon={icon} pressed={selected} {...rest} />\n              </Fragment>\n            )\n          })}\n        </Menu>\n      }\n    />\n  )\n})\n","import {Flex} from '@sanity/ui'\nimport {type ReactElement, useEffect, useState} from 'react'\n\ninterface ObserveElementProps {\n  children: ReactElement\n  options?: IntersectionObserverInit\n  onIntersectionChange: IntersectionObserverCallback\n}\n\nexport function ObserveElement(props: ObserveElementProps) {\n  const {onIntersectionChange, children, options, ...rest} = props\n  const [el, setEl] = useState<HTMLDivElement | null>(null)\n\n  useEffect(() => {\n    if (!el) return undefined\n\n    const io = new IntersectionObserver(onIntersectionChange, options)\n    io.observe(el)\n\n    return () => {\n      io.unobserve(el)\n      io.disconnect()\n    }\n  }, [el, onIntersectionChange, options])\n\n  return (\n    <Flex ref={setEl} {...rest}>\n      {children}\n    </Flex>\n  )\n}\n","import {Flex} from '@sanity/ui'\nimport {difference} from 'lodash'\nimport {\n  Children,\n  cloneElement,\n  type ForwardedRef,\n  forwardRef,\n  Fragment,\n  memo,\n  type ReactElement,\n  type ReactNode,\n  useCallback,\n  useMemo,\n  useState,\n} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {type MenuButtonProps, Tooltip} from '../../../ui-components'\nimport {ContextMenuButton} from '../contextMenuButton'\nimport {CollapseMenuDivider} from './CollapseMenuDivider'\nimport {CollapseOverflowMenu} from './CollapseOverflowMenu'\nimport {ObserveElement} from './ObserveElement'\n\n/** @internal */\nexport interface CollapseMenuProps {\n  children: ReactNode | ReactNode[]\n  collapsed?: boolean\n  collapseText?: boolean\n  disableRestoreFocusOnClose?: boolean\n  gap?: number | number[]\n  menuButtonProps?: Omit<MenuButtonProps, 'id' | 'menu' | 'button'> & {\n    id?: string\n    button?: ReactElement\n  }\n  onMenuClose?: () => void\n}\n\nconst FOCUS_RING_PADDING = 3\n\nconst OPTION_STYLE = css`\n  list-style: none;\n  display: flex;\n  white-space: nowrap;\n\n  &[data-hidden='true'] {\n    opacity: 0;\n    visibility: hidden;\n  }\n`\n\nconst OuterFlex = styled(Flex)`\n  padding: ${FOCUS_RING_PADDING}px;\n  margin: -${FOCUS_RING_PADDING}px;\n  box-sizing: border-box;\n`\n\nconst RootFlex = styled(Flex)`\n  border-radius: inherit;\n  position: relative;\n`\n\nconst RowFlex = styled(Flex)`\n  width: max-content;\n  &[data-hidden='true'] {\n    visibility: hidden;\n    position: relative;\n    margin-top: -1px;\n    height: 1px;\n  }\n`\n\nconst OptionObserveElement = styled(ObserveElement)`\n  ${OPTION_STYLE}\n`\n\nfunction _isReactElement(node: unknown): node is ReactElement {\n  return Boolean(node)\n}\n\ninterface IntersectionEntry {\n  intersects: boolean\n  element: ReactElement\n  // todo: potentially add bounding rects so we can calculate how many we can fit non-collapsed vs collapsed\n}\n\ntype ElementIntersections = Record<string, IntersectionEntry>\n\n/** @internal */\nexport const CollapseMenu = forwardRef(function CollapseMenu(\n  props: CollapseMenuProps,\n  ref: ForwardedRef<any>,\n) {\n  const {children, collapsed, disableRestoreFocusOnClose, onMenuClose, menuButtonProps, ...rest} =\n    props\n\n  const menuOptions = useMemo(() => Children.toArray(children).filter(_isReactElement), [children])\n  const menuButton = useMemo(\n    () => menuButtonProps?.button || <ContextMenuButton />,\n    [menuButtonProps],\n  )\n\n  if (collapsed) {\n    // We're showing everything collapsed (e.g. not auto-collapsing), so just delegate straight to the Menu\n    return (\n      <CollapseOverflowMenu\n        ref={ref}\n        disableRestoreFocusOnClose={disableRestoreFocusOnClose}\n        menuButton={menuButton}\n        menuButtonProps={menuButtonProps}\n        menuOptions={menuOptions}\n        onMenuClose={onMenuClose}\n      />\n    )\n  }\n  return (\n    <AutoCollapseMenu\n      {...rest}\n      ref={ref}\n      disableRestoreFocusOnClose={disableRestoreFocusOnClose}\n      menuButtonProps={menuButtonProps}\n      menuOptions={menuOptions}\n      onMenuClose={onMenuClose}\n    />\n  )\n})\n\n/** @internal */\nexport const AutoCollapseMenu = forwardRef(function AutoCollapseMenu(\n  props: Omit<CollapseMenuProps, 'children' | 'collapsed'> & {menuOptions: ReactElement[]},\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const {\n    collapseText = true,\n    disableRestoreFocusOnClose,\n    gap,\n    menuOptions,\n    menuButtonProps,\n    onMenuClose,\n    ...rest\n  } = props\n\n  const [rootEl, setRootEl] = useState<HTMLDivElement | null>(null)\n\n  // We use this to keep track of intersections for expanded options\n  const [expandedIntersections, setExpandedIntersections] = useState<ElementIntersections>({})\n\n  // We use this to keep track of intersections for collapsed options\n  const [collapsedIntersections, setCollapsedIntersections] = useState<ElementIntersections>({})\n\n  const intersectionOptions = useMemo(\n    () => ({\n      root: rootEl,\n      // safari needs threshold to be < 1\n      threshold: 0.99,\n      rootMargin: '2px',\n    }),\n    [rootEl],\n  )\n\n  // Make a list of all element keys of menu options\n  const menuOptionKeys = useMemo(() => menuOptions.map((child) => child.key), [menuOptions])\n\n  // List of intersections we have not yet received\n  const pendingIntersections = useMemo(\n    () => [\n      ...difference(menuOptionKeys, Object.keys(expandedIntersections)),\n      ...difference(menuOptionKeys, Object.keys(collapsedIntersections)),\n    ],\n    [menuOptionKeys, expandedIntersections, collapsedIntersections],\n  )\n\n  // Get a list of the expanded elements that are currently overflowing\n  const overflowingExpandedElements = useMemo(\n    () =>\n      menuOptions.filter((optionElement) => {\n        const entry = expandedIntersections[optionElement.key as string]\n        return entry && !entry.intersects\n      }),\n    [expandedIntersections, menuOptions],\n  )\n\n  const handleExpandedIntersection = useCallback(\n    (e: IntersectionObserverEntry, element: ReactElement) => {\n      setExpandedIntersections((current) => {\n        const key = element.key\n        if (key === null) {\n          throw new Error('Expected element to have a non-null key')\n        }\n        const nextState = {\n          intersects: e.isIntersecting,\n          element: element,\n        }\n\n        const currentState = current[key]\n        if (!currentState || currentState.intersects !== nextState.intersects) {\n          return {\n            ...current,\n            [key]: nextState,\n          }\n        }\n        return current\n      })\n    },\n    [],\n  )\n\n  const handleCollapsedIntersection = useCallback(\n    (e: IntersectionObserverEntry, element: ReactElement) => {\n      setCollapsedIntersections((current) => {\n        const key = element.key\n        if (key === null) {\n          throw new Error('Expected child element to have a non-null key')\n        }\n        const currentElementIntersection = current[key]\n\n        const nextElementIntersection = {\n          intersects: e.isIntersecting,\n          element,\n        }\n        return currentElementIntersection?.intersects === nextElementIntersection.intersects\n          ? current\n          : {\n              ...current,\n              [key]: nextElementIntersection,\n            }\n      })\n    },\n    [],\n  )\n\n  // An array of children rendered in their collapsed state\n  const collapsedElements = useMemo(\n    () =>\n      menuOptions.map((optionElement) => {\n        const {collapsedProps} = optionElement.props\n        const modeProps = collapsedProps\n        const text = collapseText ? undefined : optionElement.props.text\n\n        return cloneElement(optionElement, {\n          ...modeProps,\n          text: text,\n        })\n      }),\n    [menuOptions, collapseText],\n  )\n\n  // Even if rendered collapsed, there might not be space to render all,\n  // so put the overflowing ones into the menu\n  const overflowingCollapsedOptionElements = useMemo(\n    () =>\n      menuOptions.filter((optionElement) => {\n        const intersection = collapsedIntersections[optionElement.key as string]\n        return intersection?.intersects === false\n      }),\n    [menuOptions, collapsedIntersections],\n  )\n\n  const shouldCollapse = overflowingExpandedElements.length > 0\n  const visibleMenuOptions = shouldCollapse\n    ? collapsedElements.filter((optionElement) => {\n        const intersection = collapsedIntersections[optionElement.key as string]\n        return intersection?.intersects === true\n      })\n    : menuOptions\n\n  const menuButton = useMemo(\n    () => menuButtonProps?.button || <ContextMenuButton />,\n    [menuButtonProps],\n  )\n\n  return (\n    <OuterFlex\n      align=\"center\"\n      data-ui=\"CollapseMenu\"\n      overflow=\"hidden\"\n      sizing=\"border\"\n      ref={ref}\n      {...rest}\n    >\n      <RootFlex direction=\"column\" flex={1} justify=\"center\" ref={setRootEl}>\n        {/* The actual visible options */}\n        <RowFlex gap={gap}>\n          {pendingIntersections.length === 0 &&\n            visibleMenuOptions.map((optionElement, index) => {\n              const {dividerBefore, tooltipText = '', tooltipProps = {}} = optionElement.props\n              const hidden =\n                !optionElement.key ||\n                !(optionElement.key in expandedIntersections) ||\n                overflowingCollapsedOptionElements.includes(optionElement)\n              return (\n                <Fragment key={optionElement.key}>\n                  {dividerBefore && index !== 0 && <CollapseMenuDivider hidden={hidden} />}\n                  <Tooltip portal disabled={!tooltipText} content={tooltipText} {...tooltipProps}>\n                    <Flex>\n                      {cloneElement(optionElement, {\n                        disabled: optionElement.props.disabled || hidden,\n                        'aria-hidden': hidden,\n                      })}\n                    </Flex>\n                  </Tooltip>\n                </Fragment>\n              )\n            })}\n        </RowFlex>\n        {/* Rendered hidden in order to calculate intersections for original (expanded) menu options */}\n        <RenderHidden\n          gap={gap}\n          elements={menuOptions}\n          intersectionOptions={intersectionOptions}\n          onIntersectionChange={handleExpandedIntersection}\n        />\n        {/* Rendered hidden in order to calculate intersections for collapsed menu options */}\n        <RenderHidden\n          gap={gap}\n          elements={collapsedElements}\n          intersectionOptions={intersectionOptions}\n          onIntersectionChange={handleCollapsedIntersection}\n        />\n      </RootFlex>\n\n      {/* Show the collapsed items that doesn't fit in a menu */}\n      {overflowingCollapsedOptionElements.length > 0 && (\n        <Flex marginLeft={gap}>\n          <CollapseOverflowMenu\n            disableRestoreFocusOnClose={disableRestoreFocusOnClose}\n            menuButton={menuButton}\n            menuButtonProps={menuButtonProps}\n            menuOptions={overflowingCollapsedOptionElements}\n            onMenuClose={onMenuClose}\n          />\n        </Flex>\n      )}\n    </OuterFlex>\n  )\n})\n\nconst RenderHidden = memo(function RenderHidden(props: {\n  elements: ReactElement[]\n  gap?: number | number[]\n  intersectionOptions: IntersectionObserverInit\n  onIntersectionChange: (e: IntersectionObserverEntry, element: ReactElement) => void\n}) {\n  const {elements, gap, intersectionOptions, onIntersectionChange} = props\n  return (\n    <RowFlex data-hidden aria-hidden=\"true\" gap={gap} overflow=\"hidden\">\n      {elements.map((element, index) => {\n        const {dividerBefore} = element.props\n        return (\n          <Fragment key={element.key}>\n            {dividerBefore && index !== 0 && <CollapseMenuDivider hidden />}\n\n            <OptionObserveElement\n              options={intersectionOptions}\n              // eslint-disable-next-line react/jsx-no-bind\n              onIntersectionChange={(e) => onIntersectionChange(e[0], element)}\n            >\n              <Flex>\n                {cloneElement(element, {\n                  disabled: true,\n                  'aria-hidden': true,\n                })}\n              </Flex>\n            </OptionObserveElement>\n          </Fragment>\n        )\n      })}\n    </RowFlex>\n  )\n})\n","import {\n  type ElementType,\n  type ForwardedRef,\n  forwardRef,\n  type HTMLProps,\n  type ReactNode,\n} from 'react'\n\nimport {Button, type ButtonProps, type TooltipProps} from '../../../ui-components'\n\n/** @internal */\nexport interface CommonProps extends Omit<ButtonProps, 'text' | 'iconRight'> {\n  as?: ElementType | keyof JSX.IntrinsicElements\n  dividerBefore?: boolean\n  focused?: boolean\n  tooltipProps?: TooltipProps\n  tooltipText?: ReactNode\n}\n\n/** @internal */\nexport interface CollapseMenuButtonProps extends CommonProps {\n  collapsedProps?: Omit<CommonProps, 'text'>\n  expandedProps?: CommonProps\n  text: string\n}\n\n/** @internal */\nexport const CollapseMenuButton = forwardRef(function CollapseMenuButton(\n  props: CollapseMenuButtonProps & Omit<HTMLProps<HTMLButtonElement>, 'as' | 'size'>,\n  ref: ForwardedRef<HTMLButtonElement>,\n) {\n  const {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    collapsedProps = {},\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    expandedProps = {},\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    tooltipProps = {},\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    tooltipText,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    dividerBefore,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ...rest\n  } = props\n\n  return <Button data-ui=\"CollapseMenuButton\" {...rest} ref={ref} />\n})\n","import {useMemo} from 'react'\nimport styled from 'styled-components'\n\ninterface Props {\n  icon: string\n  active: boolean\n}\n\nconst CustomIconDiv = styled.div`\n  width: 1em;\n  height: 1em;\n  border-radius: inherit;\n  background-origin: content-box;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  transform: scale(0.7);\n`\n\nexport function CustomIcon(props: Props) {\n  const {icon, active} = props\n\n  const inlineStyle = useMemo(\n    () => ({\n      backgroundImage: `url(${icon})`,\n      filter: active ? 'invert(100%)' : 'invert(0%)',\n    }),\n    [active, icon],\n  )\n\n  return <CustomIconDiv style={inlineStyle} />\n}\n","import {\n  BlockElementIcon,\n  BoldIcon,\n  CodeIcon,\n  InlineElementIcon,\n  ItalicIcon,\n  LinkIcon,\n  OlistIcon,\n  StrikethroughIcon,\n  UlistIcon,\n  UnderlineIcon,\n  UnknownIcon,\n} from '@sanity/icons'\nimport {\n  type HotkeyOptions,\n  PortableTextEditor,\n  type PortableTextMemberSchemaTypes,\n} from '@sanity/portable-text-editor'\nimport {type ObjectSchemaType} from '@sanity/types'\nimport {capitalize, get} from 'lodash'\nimport {type ComponentType} from 'react'\n\nimport {CustomIcon} from './CustomIcon'\nimport {\n  type BlockItem,\n  type BlockStyleItem,\n  type PTEToolbarAction,\n  type PTEToolbarActionGroup,\n} from './types'\n\nfunction getPTEFormatActions(\n  editor: PortableTextEditor,\n  disabled: boolean,\n  hotkeyOpts: HotkeyOptions,\n  t?: (key: string) => string,\n): PTEToolbarAction[] {\n  const types = editor.schemaTypes\n  return types.decorators.map((decorator) => {\n    const shortCutKey = Object.keys(hotkeyOpts.marks || {}).find(\n      (key) => hotkeyOpts.marks?.[key] === decorator.value,\n    )\n\n    let hotkeys: string[] = []\n    if (shortCutKey) {\n      hotkeys = [shortCutKey]\n    }\n\n    return {\n      type: 'format',\n      disabled: disabled,\n      icon: decorator?.icon,\n      key: decorator.value,\n      handle: (): void => {\n        PortableTextEditor.toggleMark(editor, decorator.value)\n        PortableTextEditor.focus(editor)\n      },\n      hotkeys,\n      title: decorator.i18nTitleKey && t ? t(decorator.i18nTitleKey) : decorator.title,\n    }\n  })\n}\n\nfunction getPTEListActions(\n  editor: PortableTextEditor,\n  disabled: boolean,\n  t?: (key: string) => string,\n): PTEToolbarAction[] {\n  const types = editor.schemaTypes\n  return types.lists.map((listItem) => {\n    return {\n      type: 'listStyle',\n      key: listItem.value,\n      disabled: disabled,\n      icon: listItem?.icon,\n      handle: (): void => {\n        PortableTextEditor.toggleList(editor, listItem.value)\n      },\n      title: listItem.i18nTitleKey && t ? t(listItem.i18nTitleKey) : listItem.title,\n    }\n  })\n}\n\nfunction getAnnotationIcon(type: ObjectSchemaType): ComponentType | string | undefined {\n  return (\n    get(type, 'icon') ||\n    get(type, 'type.icon') ||\n    get(type, 'type.to.icon') ||\n    get(type, 'type.to[0].icon')\n  )\n}\n\nfunction getPTEAnnotationActions(\n  editor: PortableTextEditor,\n  disabled: boolean,\n  onInsert: (type: ObjectSchemaType) => void,\n  t?: (key: string) => string,\n): PTEToolbarAction[] {\n  const types = editor.schemaTypes\n  const focusChild = PortableTextEditor.focusChild(editor)\n  const hasText = focusChild && focusChild.text\n  return types.annotations.map((aType) => {\n    return {\n      type: 'annotation',\n      disabled: !hasText || disabled,\n      icon: getAnnotationIcon(aType),\n      key: aType.name,\n      handle: (active?: boolean): void => {\n        if (active) {\n          PortableTextEditor.removeAnnotation(editor, aType)\n          PortableTextEditor.focus(editor)\n        } else {\n          onInsert(aType)\n        }\n      },\n      title:\n        aType.i18nTitleKey && t ? t(aType.i18nTitleKey) : aType.title || capitalize(aType.name),\n    }\n  })\n}\n\n/**\n * @internal\n */\nexport function getPTEToolbarActionGroups(\n  editor: PortableTextEditor,\n  disabled: boolean,\n  onInsertAnnotation: (type: ObjectSchemaType) => void,\n  hotkeyOpts: HotkeyOptions,\n  t?: (key: string) => string,\n): PTEToolbarActionGroup[] {\n  return [\n    {name: 'format', actions: getPTEFormatActions(editor, disabled, hotkeyOpts, t)},\n    {name: 'list', actions: getPTEListActions(editor, disabled, t)},\n    {name: 'annotation', actions: getPTEAnnotationActions(editor, disabled, onInsertAnnotation, t)},\n  ]\n}\n\nexport function getBlockStyles(types: PortableTextMemberSchemaTypes): BlockStyleItem[] {\n  return types.styles.map((style) => {\n    return {\n      key: `style-${style.value}`,\n      style: style.value,\n      styleComponent: style && style.component,\n      title: style.title,\n      i18nTitleKey: style.i18nTitleKey,\n    }\n  })\n}\n\nfunction getInsertMenuIcon(type: ObjectSchemaType, fallbackIcon: ComponentType): ComponentType {\n  const referenceIcon = get(type, 'to[0].icon')\n\n  return type.icon || (type.type && type.type.icon) || referenceIcon || fallbackIcon\n}\n\nexport function getInsertMenuItems(\n  types: PortableTextMemberSchemaTypes,\n  disabled: boolean,\n  onInsertBlock: (type: ObjectSchemaType) => void,\n  onInsertInline: (type: ObjectSchemaType) => void,\n): BlockItem[] {\n  const blockItems = types.blockObjects.map(\n    (type, index): BlockItem => ({\n      handle: () => onInsertBlock(type),\n      icon: getInsertMenuIcon(type, BlockElementIcon),\n      inline: false,\n      key: `block-${index}`,\n      type,\n    }),\n  )\n\n  const inlineItems = types.inlineObjects.map(\n    (type, index): BlockItem => ({\n      handle: () => onInsertInline(type),\n      icon: getInsertMenuIcon(type, InlineElementIcon),\n      inline: true,\n      key: `inline-${index}`,\n      type,\n    }),\n  )\n\n  // Do not include items that are supposed to be hidden\n  const filteredBlockItems = blockItems.concat(inlineItems).filter((item) => !item.type?.hidden)\n\n  return filteredBlockItems\n}\n\nconst annotationIcons: Record<string, ComponentType> = {\n  link: LinkIcon,\n}\n\nconst formatIcons: Record<string, ComponentType> = {\n  strong: BoldIcon,\n  em: ItalicIcon,\n  'strike-through': StrikethroughIcon,\n  underline: UnderlineIcon,\n  code: CodeIcon,\n}\n\nconst listStyleIcons: Record<string, ComponentType> = {\n  number: OlistIcon,\n  bullet: UlistIcon,\n}\n\nexport function getActionIcon(action: PTEToolbarAction, active: boolean) {\n  if (action.icon) {\n    if (typeof action.icon === 'string') {\n      return <CustomIcon active={active} icon={action.icon} />\n    }\n\n    return action.icon\n  }\n\n  if (action.type === 'annotation') {\n    return annotationIcons[action.key] || UnknownIcon\n  }\n\n  if (action.type === 'listStyle') {\n    return listStyleIcons[action.key] || UnknownIcon\n  }\n\n  return formatIcons[action.key] || UnknownIcon\n}\n","import {\n  type HotkeyOptions,\n  PortableTextEditor,\n  usePortableTextEditor,\n  usePortableTextEditorSelection,\n} from '@sanity/portable-text-editor'\nimport {\n  type ObjectSchemaType,\n  type Path,\n  type PortableTextBlock,\n  type PortableTextChild,\n} from '@sanity/types'\nimport {useCallback, useMemo} from 'react'\n\nimport {type FIXME} from '../../../../FIXME'\nimport {useTranslation} from '../../../../i18n'\nimport {useUnique} from '../../../../util'\nimport {getPTEToolbarActionGroups} from './helpers'\nimport {type BlockStyleItem, type PTEToolbarAction, type PTEToolbarActionGroup} from './types'\n\nexport function useFocusBlock(): PortableTextBlock | undefined {\n  const editor = usePortableTextEditor()\n  const selection = usePortableTextEditorSelection()\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  return useMemo(() => PortableTextEditor.focusBlock(editor), [editor, selection]) // selection must be an additional dep here\n}\n\nexport function useFocusChild(): PortableTextChild | undefined {\n  const editor = usePortableTextEditor()\n  const selection = usePortableTextEditorSelection()\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  return useMemo(() => PortableTextEditor.focusChild(editor), [editor, selection]) // selection must be an additional dep here\n}\n\nexport function useActionGroups({\n  hotkeys,\n  onMemberOpen,\n  resolveInitialValue,\n  disabled,\n}: {\n  hotkeys: HotkeyOptions\n  onMemberOpen: (relativePath: Path) => void\n  resolveInitialValue: (type: ObjectSchemaType) => FIXME\n  disabled: boolean\n}): PTEToolbarActionGroup[] {\n  const editor = usePortableTextEditor()\n  const {t} = useTranslation()\n\n  const handleInsertAnnotation = useCallback(\n    async (schemaType: ObjectSchemaType) => {\n      const initialValue = await resolveInitialValue(schemaType)\n      const paths = PortableTextEditor.addAnnotation(editor, schemaType, initialValue)\n      if (paths && paths.markDefPath) {\n        onMemberOpen(paths.markDefPath)\n      }\n    },\n    [editor, onMemberOpen, resolveInitialValue],\n  )\n\n  return useMemo(\n    () =>\n      editor ? getPTEToolbarActionGroups(editor, disabled, handleInsertAnnotation, hotkeys, t) : [],\n    [disabled, editor, handleInsertAnnotation, hotkeys, t],\n  )\n}\n\nexport function useActiveActionKeys({\n  actions,\n}: {\n  actions: Array<PTEToolbarAction & {firstInGroup?: true}>\n}): string[] {\n  const editor = usePortableTextEditor()\n  const selection = usePortableTextEditorSelection()\n\n  return useUnique(\n    useMemo(\n      () => {\n        const activeAnnotationKeys = PortableTextEditor.activeAnnotations(editor).map(\n          (a) => a._type,\n        )\n\n        return actions\n          .filter((a) => {\n            if (a.type === 'annotation') {\n              return activeAnnotationKeys.includes(a.key)\n            }\n\n            if (a.type === 'listStyle') {\n              return PortableTextEditor.hasListStyle(editor, a.key)\n            }\n\n            return PortableTextEditor.isMarkActive(editor, a.key)\n          })\n          .map((a) => a.key)\n      },\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [\n        editor,\n        // This is needed so that active actions update as `selection` changes\n        selection,\n      ],\n    ),\n  )\n}\n\nexport function useActiveStyleKeys({items}: {items: BlockStyleItem[]}): string[] {\n  const editor = usePortableTextEditor()\n  const focusBlock = useFocusBlock()\n  const selection = usePortableTextEditorSelection()\n\n  return useUnique(\n    useMemo(\n      () =>\n        items.filter((i) => PortableTextEditor.hasBlockStyle(editor, i.style)).map((i) => i.style),\n      //  eslint-disable-next-line react-hooks/exhaustive-deps\n      [\n        focusBlock,\n        // This is needed so that active styles update as `selection` changes\n        selection,\n      ],\n    ),\n  )\n}\n","import {\n  PortableTextEditor,\n  usePortableTextEditor,\n  usePortableTextEditorSelection,\n} from '@sanity/portable-text-editor'\nimport {isKeySegment} from '@sanity/types'\nimport {memo, useCallback, useMemo} from 'react'\nimport {useTranslation} from 'react-i18next'\n\nimport {type PopoverProps} from '../../../../../ui-components'\nimport {CollapseMenu, CollapseMenuButton} from '../../../../components/collapseMenu'\nimport {ContextMenuButton} from '../../../../components/contextMenuButton'\nimport {getActionIcon} from './helpers'\nimport {useActiveActionKeys, useFocusBlock} from './hooks'\nimport {type PTEToolbarAction, type PTEToolbarActionGroup} from './types'\n\nconst CollapseMenuMemo = memo(CollapseMenu)\n\nconst MENU_POPOVER_PROPS: PopoverProps = {constrainSize: true, portal: true}\n\ninterface ActionMenuProps {\n  disabled: boolean\n  groups: PTEToolbarActionGroup[]\n  isFullscreen?: boolean\n  collapsed?: boolean\n}\n\nexport const ActionMenu = memo(function ActionMenu(props: ActionMenuProps) {\n  const {disabled: disabledProp, groups, isFullscreen, collapsed} = props\n  const focusBlock = useFocusBlock()\n\n  const editor = usePortableTextEditor()\n  const selection = usePortableTextEditorSelection()\n  const {t} = useTranslation()\n  const isSelectingMultipleBlocks =\n    // Path at 0 is the block level, by comparing those we can detect if the user is selecting multiple blocks\n    selection && isKeySegment(selection.anchor.path[0]) && isKeySegment(selection.focus.path[0])\n      ? // In case of keyed segments\n        selection.anchor.path[0]._key !== selection?.focus.path[0]._key\n      : // In case of non-keyed segments\n        selection?.anchor.path[0] !== selection?.focus.path[0]\n\n  const isVoidBlock = focusBlock?._type !== editor.schemaTypes.block.name\n  const isEmptyTextBlock =\n    !isVoidBlock &&\n    Array.isArray(focusBlock.children) &&\n    focusBlock.children.length === 1 &&\n    focusBlock?.children[0].text === ''\n\n  const disabled = disabledProp || isVoidBlock\n\n  const actions: Array<PTEToolbarAction & {firstInGroup?: true}> = useMemo(\n    () =>\n      groups.reduce<Array<PTEToolbarAction & {firstInGroup?: true}>>((acc, group) => {\n        return acc.concat(\n          group.actions.map(\n            // eslint-disable-next-line max-nested-callbacks\n            (action: PTEToolbarAction, actionIndex) => {\n              if (actionIndex === 0) return {...action, firstInGroup: true}\n              return action\n            },\n          ),\n        )\n      }, []),\n    [groups],\n  )\n\n  const activeKeys = useActiveActionKeys({actions})\n\n  const handleMenuClose = useCallback(() => {\n    PortableTextEditor.focus(editor)\n  }, [editor])\n\n  const tooltipPlacement = isFullscreen ? 'bottom' : 'top'\n\n  const children = useMemo(\n    () =>\n      actions.map((action) => {\n        const annotationDisabled =\n          action.type === 'annotation' && (isEmptyTextBlock || isSelectingMultipleBlocks)\n        const annotationDisabledText = isEmptyTextBlock\n          ? t('user-menu.action.portable-text.annotation-disabled_empty-block', {\n              name: action.title || action.key,\n            })\n          : t('user-menu.action.portable-text.annotation-disabled_multiple-blocks', {\n              name: action.title || action.key,\n            })\n\n        const active = activeKeys.includes(action.key)\n        return (\n          <CollapseMenuButton\n            aria-label={t('toolbar.portable-text.action-button-aria-label', {\n              action: action.title || action.key,\n            })}\n            data-testid={`action-button-${action.key}`}\n            disabled={disabled || annotationDisabled}\n            mode=\"bleed\"\n            dividerBefore={action.firstInGroup}\n            icon={getActionIcon(action, active)}\n            key={action.key}\n            // eslint-disable-next-line react/jsx-no-bind\n            onClick={() => action.handle(active)}\n            selected={active}\n            text={action.title || action.key}\n            tooltipText={annotationDisabled ? annotationDisabledText : action.title || action.key}\n            tooltipProps={{\n              disabled: disabled,\n              placement: tooltipPlacement,\n              portal: 'default',\n            }}\n          />\n        )\n      }),\n    [\n      actions,\n      activeKeys,\n      disabled,\n      isEmptyTextBlock,\n      isSelectingMultipleBlocks,\n      t,\n      tooltipPlacement,\n    ],\n  )\n\n  const menuButtonProps = useMemo(\n    () => ({\n      button: (\n        <ContextMenuButton\n          data-testid=\"action-menu-button\"\n          disabled={disabled}\n          tooltipProps={{placement: tooltipPlacement}}\n        />\n      ),\n      popover: MENU_POPOVER_PROPS,\n    }),\n    [disabled, tooltipPlacement],\n  )\n\n  return (\n    <CollapseMenuMemo\n      data-testid=\"action-menu-auto-collapse-menu\"\n      collapsed={collapsed}\n      disableRestoreFocusOnClose\n      gap={1}\n      menuButtonProps={menuButtonProps}\n      onMenuClose={handleMenuClose}\n    >\n      {children}\n    </CollapseMenuMemo>\n  )\n})\n","import {ChevronDownIcon} from '@sanity/icons'\nimport {PortableTextEditor, usePortableTextEditor} from '@sanity/portable-text-editor'\nimport {\n  Menu,\n  // eslint-disable-next-line no-restricted-imports\n  MenuItem,\n  Text,\n} from '@sanity/ui'\nimport {memo, type MouseEvent, type ReactNode, useCallback, useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {Button, MenuButton, type MenuButtonProps} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {\n  BlockQuote,\n  Heading1,\n  Heading2,\n  Heading3,\n  Heading4,\n  Heading5,\n  Heading6,\n  Normal,\n} from '../text/textStyles'\nimport {useActiveStyleKeys, useFocusBlock} from './hooks'\nimport {type BlockStyleItem} from './types'\n\nconst MenuButtonMemo = memo(MenuButton)\n\ninterface BlockStyleSelectProps {\n  disabled: boolean\n  items: BlockStyleItem[]\n}\n\nconst StyledMenuItem = styled(MenuItem)`\n  // Change the border color variable used by BlockQuote\n  // to make the border visible when the MenuItem is selected\n  &[data-selected] {\n    [data-option='blockquote'] {\n      --card-border-color: var(--card-muted-fg-color);\n    }\n  }\n`\n\nconst MENU_POPOVER_PROPS: MenuButtonProps['popover'] = {\n  constrainSize: true,\n  placement: 'bottom-start',\n  portal: 'default',\n}\n\nconst TEXT_STYLE_OPTIONS: Record<string, (title: ReactNode) => ReactNode> = {\n  h1: (title) => <Heading1>{title}</Heading1>,\n  h2: (title) => <Heading2>{title}</Heading2>,\n  h3: (title) => <Heading3>{title}</Heading3>,\n  h4: (title) => <Heading4>{title}</Heading4>,\n  h5: (title) => <Heading5>{title}</Heading5>,\n  h6: (title) => <Heading6>{title}</Heading6>,\n  normal: (title) => <Normal>{title}</Normal>,\n  blockquote: (title) => <BlockQuote data-option=\"blockquote\">{title}</BlockQuote>,\n}\n\nconst TEXT_STYLE_KEYS = Object.keys(TEXT_STYLE_OPTIONS)\n\nconst preventDefault = (event: MouseEvent<HTMLButtonElement>) => event.preventDefault()\n\nconst emptyStyle: BlockStyleItem = {\n  key: 'style-none',\n  style: '',\n  title: 'No style',\n  i18nTitleKey: 'inputs.portable-text.style.none',\n}\n\nexport const BlockStyleSelect = memo(function BlockStyleSelect(\n  props: BlockStyleSelectProps,\n): JSX.Element {\n  const {disabled, items: itemsProp} = props\n  const editor = usePortableTextEditor()\n  const focusBlock = useFocusBlock()\n  const {t} = useTranslation()\n\n  const _disabled =\n    disabled || (focusBlock ? editor.schemaTypes.block.name !== focusBlock._type : false)\n\n  // @todo: Explain what this does\n  const activeKeys = useActiveStyleKeys({items: itemsProp})\n\n  const {activeItems, items} = useMemo(() => {\n    const _activeItems = itemsProp.filter((item) => activeKeys.includes(item.style))\n\n    let _items = itemsProp\n\n    if (_activeItems.length === 0 && _items.length > 1) {\n      _items = _items.concat([emptyStyle])\n      _activeItems.push(emptyStyle)\n    }\n\n    return {activeItems: _activeItems, items: _items}\n  }, [activeKeys, itemsProp])\n\n  const menuButtonText = useMemo(() => {\n    if (activeItems.length > 1) {\n      return t('inputs.portable-text.style.multiple')\n    }\n\n    if (activeItems.length !== 1) {\n      return emptyStyle.i18nTitleKey ? t(emptyStyle.i18nTitleKey) : emptyStyle.title\n    }\n\n    return activeItems[0].i18nTitleKey ? t(activeItems[0].i18nTitleKey) : activeItems[0].title\n  }, [activeItems, t])\n\n  const handleChange = useCallback(\n    (item: BlockStyleItem): void => {\n      if (focusBlock && item.style !== focusBlock.style) {\n        PortableTextEditor.toggleBlockStyle(editor, item.style)\n        PortableTextEditor.focus(editor)\n      }\n    },\n    [editor, focusBlock],\n  )\n\n  const renderOption = useCallback((style: string, title: string) => {\n    const hasTextStyle = TEXT_STYLE_KEYS.includes(style)\n    const renderStyle = TEXT_STYLE_OPTIONS[style]\n\n    if (hasTextStyle) {\n      return renderStyle(title)\n    }\n\n    return <Text>{title}</Text>\n  }, [])\n\n  const button = useMemo(\n    () => (\n      <Button\n        disabled={_disabled}\n        iconRight={ChevronDownIcon}\n        justify=\"space-between\"\n        mode=\"bleed\"\n        onClick={preventDefault}\n        text={menuButtonText}\n        width=\"fill\"\n      />\n    ),\n    [_disabled, menuButtonText],\n  )\n\n  const menu = useMemo(\n    () => (\n      <Menu disabled={_disabled}>\n        {items.map((item) => {\n          return (\n            <StyledMenuItem\n              key={item.key}\n              pressed={activeItems.includes(item)}\n              // eslint-disable-next-line react/jsx-no-bind\n              onClick={_disabled ? undefined : () => handleChange(item)}\n            >\n              {renderOption(\n                item.style,\n                item.i18nTitleKey ? t(item.i18nTitleKey) : item?.title || item.style,\n              )}\n            </StyledMenuItem>\n          )\n        })}\n      </Menu>\n    ),\n    [_disabled, activeItems, handleChange, items, renderOption, t],\n  )\n\n  return (\n    <MenuButtonMemo\n      popover={MENU_POPOVER_PROPS}\n      id=\"block-style-select\"\n      button={button}\n      menu={menu}\n    />\n  )\n})\n","import {PortableTextEditor, usePortableTextEditor} from '@sanity/portable-text-editor'\nimport {upperFirst} from 'lodash'\nimport {memo, useCallback, useMemo} from 'react'\n\nimport {type PopoverProps} from '../../../../../ui-components'\nimport {CollapseMenu, CollapseMenuButton} from '../../../../components/collapseMenu'\nimport {ContextMenuButton} from '../../../../components/contextMenuButton'\nimport {useTranslation} from '../../../../i18n'\nimport {useFocusBlock} from './hooks'\nimport {type BlockItem} from './types'\n\nconst CollapseMenuMemo = memo(CollapseMenu)\n\nconst MENU_POPOVER_PROPS: PopoverProps = {constrainSize: true, portal: true}\n\ninterface InsertMenuProps {\n  disabled: boolean\n  items: BlockItem[]\n  isFullscreen?: boolean\n  collapsed?: boolean\n}\n\nexport const InsertMenu = memo(function InsertMenu(props: InsertMenuProps) {\n  const {disabled, items, isFullscreen, collapsed} = props\n  const {t} = useTranslation()\n  const focusBlock = useFocusBlock()\n  const editor = usePortableTextEditor()\n\n  const isVoidFocus = focusBlock && focusBlock._type !== editor.schemaTypes.block.name\n\n  const handleMenuClose = useCallback(() => {\n    PortableTextEditor.focus(editor)\n  }, [editor])\n\n  const tooltipPlacement = isFullscreen ? 'bottom' : 'top'\n\n  const children = useMemo(() => {\n    return items.map((item) => {\n      const title = item.type.title || upperFirst(item.type.name)\n\n      return (\n        <CollapseMenuButton\n          aria-label={t(\n            item.inline\n              ? 'inputs.portable-text.action.insert-inline-object-aria-label'\n              : 'inputs.portable-text.action.insert-block-aria-label',\n            {typeName: title},\n          )}\n          mode=\"bleed\"\n          disabled={disabled || (isVoidFocus && item.inline === true)}\n          icon={item.icon}\n          key={item.key}\n          // eslint-disable-next-line react/jsx-no-bind, react/jsx-handler-names\n          onClick={item.handle}\n          text={title}\n          tooltipText={t(\n            item.inline\n              ? 'inputs.portable-text.action.insert-inline-object'\n              : 'inputs.portable-text.action.insert-block',\n            {typeName: title},\n          )}\n          tooltipProps={{\n            disabled,\n            placement: tooltipPlacement,\n            portal: 'default',\n          }}\n        />\n      )\n    })\n  }, [disabled, isVoidFocus, items, t, tooltipPlacement])\n\n  const menuButtonProps = useMemo(\n    () => ({\n      button: (\n        <ContextMenuButton\n          data-testid=\"insert-menu-button\"\n          disabled={disabled}\n          tooltipProps={{placement: tooltipPlacement}}\n        />\n      ),\n      popover: MENU_POPOVER_PROPS,\n    }),\n    [disabled, tooltipPlacement],\n  )\n\n  return (\n    <CollapseMenuMemo\n      data-testid=\"insert-menu-auto-collapse-menu\"\n      collapsed={collapsed}\n      collapseText={false}\n      disableRestoreFocusOnClose\n      gap={1}\n      menuButtonProps={menuButtonProps}\n      onMenuClose={handleMenuClose}\n    >\n      {children}\n    </CollapseMenuMemo>\n  )\n})\n","import {CollapseIcon, ExpandIcon} from '@sanity/icons'\nimport {\n  type HotkeyOptions,\n  PortableTextEditor,\n  usePortableTextEditor,\n  usePortableTextEditorSelection,\n} from '@sanity/portable-text-editor'\nimport {type ObjectSchemaType, type Path, type SchemaType} from '@sanity/types'\nimport {Box, Flex, useElementRect, useToast} from '@sanity/ui'\nimport {memo, type MouseEvent, useCallback, useMemo, useState} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {Button} from '../../../../../ui-components'\nimport {useRovingFocus} from '../../../../components'\nimport {useTranslation} from '../../../../i18n'\nimport {useResolveInitialValueForType} from '../../../../store'\nimport {ActionMenu} from './ActionMenu'\nimport {BlockStyleSelect} from './BlockStyleSelect'\nimport {getBlockStyles, getInsertMenuItems} from './helpers'\nimport {useActionGroups} from './hooks'\nimport {InsertMenu} from './InsertMenu'\nimport {type BlockItem, type BlockStyleItem, type PTEToolbarActionGroup} from './types'\n\ninterface ToolbarProps {\n  /** Whether annotation and block menu buttons should fully collapse at smaller element widths */\n  collapsible?: boolean\n  hotkeys: HotkeyOptions\n  isFullscreen: boolean\n  onMemberOpen: (relativePath: Path) => void\n  onToggleFullscreen: () => void\n  readOnly?: boolean\n}\n\nconst RootFlex = styled(Flex)`\n  width: 100%;\n`\n\nconst StyleSelectBox = styled(Box)`\n  width: 8em;\n`\n\nconst StyleSelectFlex = styled(Flex)`\n  border-right: 1px solid var(--card-border-color);\n`\n\nconst ActionMenuBox = styled(Box)<{$withInsertMenu: boolean}>`\n  ${({$withInsertMenu}) =>\n    $withInsertMenu &&\n    css`\n      max-width: max-content;\n      border-right: 1px solid var(--card-border-color);\n    `}\n`\n\nconst FullscreenButtonBox = styled(Box)`\n  border-left: 1px solid var(--card-border-color);\n`\n\nconst SLOW_INITIAL_VALUE_LIMIT = 300\n\nconst IS_MAC =\n  typeof window != 'undefined' && /Mac|iPod|iPhone|iPad/.test(window.navigator.platform)\n\nconst InnerToolbar = memo(function InnerToolbar({\n  actionGroups,\n  blockStyles,\n  collapsible,\n  disabled,\n  insertMenuItems,\n  isFullscreen,\n  onToggleFullscreen,\n}: {\n  actionGroups: PTEToolbarActionGroup[]\n  blockStyles: BlockStyleItem[]\n  collapsible?: boolean\n  disabled: boolean\n  insertMenuItems: BlockItem[]\n  isFullscreen: boolean\n  onToggleFullscreen: () => void\n}) {\n  const {t} = useTranslation()\n  const actionsLen = actionGroups.reduce((acc, x) => acc + x.actions.length, 0)\n  const showActionMenu = actionsLen > 0\n  const showInsertMenu = insertMenuItems.length > 0\n  const [rootElement, setRootElement] = useState<HTMLDivElement | null>(null)\n  const rootElementRect = useElementRect(rootElement)\n\n  const collapsed = collapsible && rootElementRect ? rootElementRect?.width < 400 : false\n  const showBlockStyleSelect = blockStyles.length > 1\n\n  useRovingFocus({\n    rootElement: rootElement,\n  })\n\n  const preventEditorBlurOnToolbarMouseDown = useCallback((e: MouseEvent) => {\n    e.preventDefault()\n  }, [])\n\n  return (\n    <RootFlex align=\"center\" ref={setRootElement} onMouseDown={preventEditorBlurOnToolbarMouseDown}>\n      {showBlockStyleSelect && (\n        <StyleSelectFlex flex={collapsed ? 1 : undefined}>\n          <StyleSelectBox padding={isFullscreen ? 2 : 1}>\n            <BlockStyleSelect disabled={disabled} items={blockStyles} />\n          </StyleSelectBox>\n        </StyleSelectFlex>\n      )}\n\n      <Flex flex={1}>\n        {showActionMenu && (\n          <ActionMenuBox\n            flex={collapsed ? undefined : 1}\n            padding={isFullscreen ? 2 : 1}\n            $withInsertMenu={showInsertMenu}\n          >\n            <ActionMenu\n              disabled={disabled}\n              collapsed={collapsed}\n              groups={actionGroups}\n              isFullscreen={isFullscreen}\n            />\n          </ActionMenuBox>\n        )}\n\n        {showInsertMenu && (\n          <Box flex={collapsed ? undefined : 1} padding={isFullscreen ? 2 : 1}>\n            <InsertMenu\n              disabled={disabled}\n              collapsed={collapsed}\n              items={insertMenuItems}\n              isFullscreen={isFullscreen}\n            />\n          </Box>\n        )}\n      </Flex>\n      <FullscreenButtonBox padding={isFullscreen ? 2 : 1}>\n        <Button\n          aria-label={t('inputs.portable-text.action.expand-editor')}\n          icon={isFullscreen ? CollapseIcon : ExpandIcon}\n          mode=\"bleed\"\n          onClick={onToggleFullscreen}\n          tooltipProps={{\n            content: t(\n              isFullscreen\n                ? 'inputs.portable-text.action.collapse-editor'\n                : 'inputs.portable-text.action.expand-editor',\n            ),\n            hotkeys: [`${IS_MAC ? 'Cmd' : 'Ctrl'}`, 'Enter'],\n            placement: isFullscreen ? 'bottom' : 'top',\n            portal: 'default',\n          }}\n        />\n      </FullscreenButtonBox>\n    </RootFlex>\n  )\n})\n\nexport function Toolbar(props: ToolbarProps) {\n  const {collapsible, hotkeys, isFullscreen, readOnly, onMemberOpen, onToggleFullscreen} = props\n  const editor = usePortableTextEditor()\n  const selection = usePortableTextEditorSelection()\n  const resolveInitialValueForType = useResolveInitialValueForType()\n  const disabled = readOnly || !selection\n\n  const {push} = useToast()\n\n  const resolveInitialValue = useCallback(\n    (type: ObjectSchemaType) => {\n      let isSlow = false\n      const slowTimer = setTimeout(() => {\n        isSlow = true\n        push({\n          id: 'resolving-initial-value',\n          status: 'info',\n          title: 'Resolving initial value',\n        })\n      }, SLOW_INITIAL_VALUE_LIMIT)\n      return resolveInitialValueForType(type as unknown as SchemaType, {})\n        .then((value) => {\n          if (isSlow) {\n            // I found no way to close an existing toast, so this will replace the message in the\n            // \"Resolving initial value\"-toast and then make sure it gets closed.\n            push({\n              id: 'resolving-initial-value',\n              status: 'info',\n              duration: 500,\n              title: 'Initial value resolved',\n            })\n          }\n          return value\n        })\n        .catch((error) => {\n          push({\n            title: `Could not resolve initial value`,\n            id: 'resolving-initial-value',\n            description: `Unable to resolve initial value for type: ${type.name}: ${error.message}.`,\n            status: 'error',\n          })\n\n          return undefined\n        })\n        .finally(() => clearTimeout(slowTimer))\n    },\n    [push, resolveInitialValueForType],\n  )\n\n  const handleInsertBlock = useCallback(\n    async (type: ObjectSchemaType) => {\n      const initialValue = await resolveInitialValue(type)\n      const path = PortableTextEditor.insertBlock(editor, type, initialValue)\n      if (path) {\n        onMemberOpen(path)\n      }\n    },\n    [editor, onMemberOpen, resolveInitialValue],\n  )\n\n  const handleInsertInline = useCallback(\n    async (type: ObjectSchemaType) => {\n      const initialValue = await resolveInitialValue(type)\n      const path = PortableTextEditor.insertChild(editor, type, initialValue)\n      if (path) {\n        onMemberOpen(path)\n      }\n    },\n    [editor, onMemberOpen, resolveInitialValue],\n  )\n\n  const actionGroups = useActionGroups({\n    hotkeys,\n    onMemberOpen,\n    resolveInitialValue,\n    disabled: true,\n  })\n\n  const blockStyles = useMemo(() => getBlockStyles(editor.schemaTypes), [editor])\n\n  const insertMenuItems = useMemo(\n    () => getInsertMenuItems(editor.schemaTypes, disabled, handleInsertBlock, handleInsertInline),\n    [disabled, editor, handleInsertBlock, handleInsertInline],\n  )\n\n  return (\n    <InnerToolbar\n      actionGroups={actionGroups}\n      blockStyles={blockStyles}\n      collapsible={collapsible}\n      disabled={disabled}\n      insertMenuItems={insertMenuItems}\n      isFullscreen={isFullscreen}\n      onToggleFullscreen={onToggleFullscreen}\n    />\n  )\n}\n","import {\n  type EditorSelection,\n  type HotkeyOptions,\n  type OnCopyFn,\n  type OnPasteFn,\n  PortableTextEditable,\n  type RangeDecoration,\n  type RenderAnnotationFunction,\n  type RenderBlockFunction,\n  type RenderChildFunction,\n  type RenderDecoratorFunction,\n  type RenderListItemFunction,\n  type RenderStyleFunction,\n} from '@sanity/portable-text-editor'\nimport {type Path} from '@sanity/types'\nimport {BoundaryElementProvider, useBoundaryElement, useGlobalKeyDown, useLayer} from '@sanity/ui'\n// eslint-disable-next-line camelcase\nimport {getTheme_v2} from '@sanity/ui/theme'\nimport {useCallback, useMemo, useRef} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {TooltipDelayGroupProvider} from '../../../../ui-components'\nimport {useTranslation} from '../../../i18n'\nimport {useFormBuilder} from '../../useFormBuilder'\nimport {\n  EditableCard,\n  EditableContainer,\n  EditableWrapper,\n  Root,\n  Scroller,\n  ToolbarCard,\n} from './Editor.styles'\nimport {useScrollSelectionIntoView} from './hooks/useScrollSelectionIntoView'\nimport {useSpellcheck} from './hooks/useSpellCheck'\nimport {Decorator} from './text'\nimport {ListItem} from './text/ListItem'\nimport {Style} from './text/Style'\nimport {Toolbar} from './toolbar'\n\nconst noOutlineStyle = {outline: 'none'} as const\n\n// The <FormBuilder> id that represents the default (document pane) form layout.\n// This is used to determine whether this editor should apply document pane specific styling.\nconst FORM_BUILDER_DEFAULT_ID = 'root'\n\nconst PlaceholderWrapper = styled.span((props) => {\n  const {color} = getTheme_v2(props.theme)\n  return css`\n    color: ${color.input.default.enabled.placeholder};\n  `\n})\n\ninterface EditorProps {\n  hotkeys: HotkeyOptions\n  initialSelection?: EditorSelection\n  isActive: boolean\n  isFullscreen: boolean\n  onCopy?: OnCopyFn\n  onItemOpen: (path: Path) => void\n  onPaste?: OnPasteFn\n  onToggleFullscreen: () => void\n  path: Path\n  readOnly?: boolean\n  rangeDecorations?: RangeDecoration[]\n  renderAnnotation: RenderAnnotationFunction\n  renderBlock: RenderBlockFunction\n  renderChild: RenderChildFunction\n  scrollElement: HTMLElement | null\n  setPortalElement?: (portalElement: HTMLDivElement | null) => void\n  setScrollElement: (scrollElement: HTMLElement | null) => void\n  ariaDescribedBy: string | undefined\n}\n\nconst renderDecorator: RenderDecoratorFunction = (props) => {\n  return <Decorator {...props} />\n}\n\nconst renderStyle: RenderStyleFunction = (props) => {\n  return <Style {...props} />\n}\n\nconst renderListItem: RenderListItemFunction = (props) => {\n  return <ListItem {...props} />\n}\n/**\n * @internal\n */\nexport function Editor(props: EditorProps) {\n  const {\n    hotkeys,\n    initialSelection,\n    isActive,\n    isFullscreen,\n    onCopy,\n    onItemOpen,\n    onPaste,\n    onToggleFullscreen,\n    path,\n    readOnly,\n    rangeDecorations,\n    renderAnnotation,\n    renderBlock,\n    renderChild,\n    scrollElement,\n    setPortalElement,\n    setScrollElement,\n    ariaDescribedBy,\n  } = props\n  const {id} = useFormBuilder()\n  const {t} = useTranslation()\n  const {isTopLayer} = useLayer()\n  const editableRef = useRef<HTMLDivElement | null>(null)\n\n  const {element: boundaryElement} = useBoundaryElement()\n\n  // Let escape close fullscreen mode\n  useGlobalKeyDown(\n    useCallback(\n      (event: KeyboardEvent) => {\n        if (!isTopLayer || !isFullscreen) {\n          return\n        }\n        if (event.key === 'Escape') {\n          onToggleFullscreen()\n        }\n      },\n      [onToggleFullscreen, isFullscreen, isTopLayer],\n    ),\n  )\n\n  const renderPlaceholder = useCallback(\n    () => (\n      <PlaceholderWrapper data-testid=\"pt-input-placeholder\">\n        {t('inputs.portable-text.empty-placeholder')}\n      </PlaceholderWrapper>\n    ),\n    [t],\n  )\n  const spellcheck = useSpellcheck()\n\n  const scrollSelectionIntoView = useScrollSelectionIntoView(scrollElement)\n\n  const editable = useMemo(\n    () => (\n      <PortableTextEditable\n        aria-describedby={ariaDescribedBy}\n        hotkeys={hotkeys}\n        onCopy={onCopy}\n        onPaste={onPaste}\n        ref={editableRef}\n        rangeDecorations={rangeDecorations}\n        renderAnnotation={renderAnnotation}\n        renderBlock={renderBlock}\n        renderChild={renderChild}\n        renderDecorator={renderDecorator}\n        renderListItem={renderListItem}\n        renderPlaceholder={renderPlaceholder}\n        renderStyle={renderStyle}\n        scrollSelectionIntoView={scrollSelectionIntoView}\n        selection={initialSelection}\n        spellCheck={spellcheck}\n        style={noOutlineStyle}\n      />\n    ),\n    [\n      ariaDescribedBy,\n      hotkeys,\n      initialSelection,\n      onCopy,\n      onPaste,\n      rangeDecorations,\n      renderAnnotation,\n      renderBlock,\n      renderChild,\n      renderPlaceholder,\n      scrollSelectionIntoView,\n      spellcheck,\n    ],\n  )\n\n  const handleToolBarOnMemberOpen = useCallback(\n    (relativePath: Path) => {\n      onItemOpen(path.concat(relativePath))\n    },\n    [onItemOpen, path],\n  )\n\n  // Always collapse toolbars at smaller container widths when in 'default' (document pane) FormBuilder instances\n  const collapsibleToolbar = id === FORM_BUILDER_DEFAULT_ID\n\n  return (\n    <Root $fullscreen={isFullscreen} data-testid=\"pt-editor\">\n      {isActive && (\n        <TooltipDelayGroupProvider>\n          <ToolbarCard data-testid=\"pt-editor__toolbar-card\" shadow={1}>\n            <Toolbar\n              collapsible={collapsibleToolbar}\n              hotkeys={hotkeys}\n              isFullscreen={isFullscreen}\n              onMemberOpen={handleToolBarOnMemberOpen}\n              onToggleFullscreen={onToggleFullscreen}\n              readOnly={readOnly}\n            />\n          </ToolbarCard>\n        </TooltipDelayGroupProvider>\n      )}\n\n      <EditableCard flex={1} tone={readOnly ? 'transparent' : 'default'}>\n        <Scroller ref={setScrollElement}>\n          <EditableContainer padding={isFullscreen ? 2 : 0} sizing=\"border\" width={1}>\n            <EditableWrapper\n              $isFullscreen={isFullscreen}\n              tone={readOnly ? 'transparent' : 'default'}\n            >\n              <BoundaryElementProvider element={isFullscreen ? scrollElement : boundaryElement}>\n                {editable}\n              </BoundaryElementProvider>\n            </EditableWrapper>\n          </EditableContainer>\n        </Scroller>\n\n        <div data-portal=\"\" ref={setPortalElement} />\n      </EditableCard>\n    </Root>\n  )\n}\n","import {type HotkeyOptions, usePortableTextEditor} from '@sanity/portable-text-editor'\nimport {useMemo, useState} from 'react'\n\n// This hook will create final hotkeys for the editor from on those from props.\nexport function useHotkeys(hotkeys: HotkeyOptions): HotkeyOptions {\n  const editor = usePortableTextEditor()\n\n  // Guard that hotkeys from props will be a stable object.\n  // If this props is defined inline and is always a new object, there will be issues with key handling and cursor!\n  const [initialHotkeys] = useState(() => hotkeys)\n  if (initialHotkeys !== hotkeys) {\n    console.warn(\n      'Make sure that hotkeys are a stable object across renders, or there will be issues with key handling in the Portable Text Editor.',\n    )\n  }\n  return useMemo(() => {\n    const defaultHotkeys: {marks: Record<string, string>} = {marks: {}}\n    editor.schemaTypes.decorators.forEach((dec) => {\n      switch (dec.value) {\n        case 'strong':\n          defaultHotkeys.marks['mod+b'] = dec.value\n          break\n        case 'em':\n          defaultHotkeys.marks['mod+i'] = dec.value\n          break\n        case 'underline':\n          defaultHotkeys.marks['mod+u'] = dec.value\n          break\n        case 'code':\n          defaultHotkeys.marks[\"mod+'\"] = dec.value\n          break\n        default:\n      }\n    })\n    return {\n      marks: {...defaultHotkeys.marks, ...(initialHotkeys || {}).marks},\n      custom: initialHotkeys.custom,\n    }\n  }, [editor, initialHotkeys])\n}\n\n// If we want to have a hotkey to open up a focused object, we can use this:\n//\n// const handleOpenObjectHotkey = (\n//   event: BaseSyntheticEvent,\n//   ptEditor: PortableTextEditor\n// ) => {\n//   const selection = PortableTextEditor.getSelection(ptEditor)\n//   if (selection) {\n//     event.preventDefault()\n//     event.stopPropagation()\n//     const {focus} = selection\n//     const activeAnnotations = PortableTextEditor.activeAnnotations(ptEditor)\n//     const focusBlock = PortableTextEditor.focusBlock(ptEditor)\n//     const focusChild = PortableTextEditor.focusChild(ptEditor)\n//     if (activeAnnotations.length > 0) {\n//       onFocus([\n//         ...focus.path.slice(0, 1),\n//         'markDefs',\n//         {_key: activeAnnotations[0]._key},\n//         FOCUS_TERMINATOR,\n//       ])\n//       return\n//     }\n//     if (focusChild && PortableTextEditor.isVoid(ptEditor, focusChild)) {\n//       onFocus([...focus.path, FOCUS_TERMINATOR])\n//       return\n//     }\n//     if (focusBlock && PortableTextEditor.isVoid(ptEditor, focusBlock)) {\n//       onFocus([...focus.path.slice(0, 1), FOCUS_TERMINATOR])\n//     }\n//   }\n// }\n","import {\n  PortableTextEditor,\n  usePortableTextEditor,\n  usePortableTextEditorSelection,\n} from '@sanity/portable-text-editor'\nimport {isKeyedObject, type KeyedObject, type Path} from '@sanity/types'\nimport {isEqual} from '@sanity/util/paths'\nimport {useLayoutEffect} from 'react'\nimport scrollIntoView from 'scroll-into-view-if-needed'\n\nimport {usePortableTextMemberItems} from './usePortableTextMembers'\n\ninterface Props {\n  focusPath: Path\n  boundaryElement: HTMLElement | null\n  onItemClose: () => void\n}\n\n// This hook will track the focusPath and make sure editor content is visible and focused accordingly.\nexport function useTrackFocusPath(props: Props): void {\n  const {focusPath, boundaryElement, onItemClose} = props\n  const portableTextMemberItems = usePortableTextMemberItems()\n  const editor = usePortableTextEditor()\n  const selection = usePortableTextEditorSelection()\n\n  useLayoutEffect(() => {\n    // Don't do anything if no focusPath\n    if (focusPath.length === 0) {\n      return\n    }\n\n    // Find the opened member item\n    const openItem = portableTextMemberItems.find((m) => m.member.open)\n\n    if (openItem && openItem.elementRef?.current) {\n      if (boundaryElement) {\n        // Scroll the boundary element into view (the scrollable element itself)\n        scrollIntoView(boundaryElement, {\n          scrollMode: 'if-needed',\n          block: 'start',\n          inline: 'start',\n        })\n        // Scroll the member into view (the member within the scroll-boundary)\n        scrollIntoView(openItem.elementRef.current, {\n          scrollMode: 'if-needed',\n          boundary: boundaryElement,\n          block: 'start',\n          inline: 'start',\n        })\n      }\n\n      // Don't do anything if the selection focus path is already equal to the focusPath\n      if (\n        selection?.focus.path &&\n        isEqual(selection.focus.path, focusPath.slice(0, selection.focus.path.length))\n      ) {\n        return\n      }\n\n      const isTextBlock = openItem.kind === 'textBlock'\n      const isBlockFocusPath = focusPath.length === 1\n\n      // Track focus and selection for focusPaths that are either inside text blocks,\n      // or is pointing to the block itself (text and object blocks)\n      if (isTextBlock || isBlockFocusPath) {\n        const textBlockChildKey =\n          isTextBlock && isKeyedObject(focusPath[2]) ? focusPath[2]._key : undefined\n        const child =\n          textBlockChildKey && Array.isArray(openItem.node.value?.children)\n            ? (openItem.node.value?.children.find((c) => c._key === textBlockChildKey) as\n                | KeyedObject\n                | undefined)\n            : undefined\n\n        // Is the focusPath pointing to span's `.text` property?\n        const isSpanTextFocusPath =\n          (child &&\n            child._type === 'span' &&\n            focusPath.length === 4 &&\n            focusPath[1] === 'children' &&\n            focusPath[3] === 'text') ||\n          false\n\n        // Is focus directly on a text block child?\n        const isTextChildFocusPath =\n          isTextBlock &&\n          ((focusPath.length === 3 && focusPath[1] === 'children') || isSpanTextFocusPath)\n\n        let path: Path = []\n        // Known text block child\n        if (isTextChildFocusPath) {\n          path = focusPath.slice(0, 3)\n        } else if (\n          // Known text block, but unknown child. Select first child in that block.\n          isTextBlock &&\n          isBlockFocusPath &&\n          Array.isArray(openItem.node.value?.children)\n        ) {\n          path = [focusPath[0], 'children', {_key: openItem.node.value?.children[0]._key}]\n          // Directly pointing to a non-text block\n        } else if (isBlockFocusPath) {\n          path = [{_key: openItem.key}]\n        }\n\n        // Select and focus the editor if we produced a path\n        if (path.length) {\n          PortableTextEditor.select(editor, {\n            anchor: {path, offset: 0},\n            focus: {path, offset: 0},\n          })\n          // Object blocks will have their interface opened when focused,\n          // so only call focus for regular text blocks\n          if (isTextBlock) {\n            PortableTextEditor.focus(editor)\n          }\n        }\n      }\n    }\n  }, [\n    boundaryElement,\n    editor,\n    focusPath,\n    onItemClose,\n    portableTextMemberItems,\n    selection?.focus.path,\n  ])\n}\n","import {hues} from '@sanity/color'\nimport {Box, Card, type Theme} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nexport const Root = styled(Card)(rootStyle)\n\nexport const PreviewSpan = styled.span`\n  display: block;\n  max-width: calc(5em + 80px);\n  position: relative;\n`\n\nexport const TooltipBox = styled(Box)`\n  max-width: 250px;\n`\n\nexport function rootStyle({theme}: {theme: Theme}) {\n  const {color, radius} = theme.sanity\n\n  return css`\n    line-height: 0;\n    border-radius: ${radius[2]}px;\n    padding: 2px;\n    box-shadow: inset 0 0 0 1px var(--card-border-color);\n    height: calc(1em - 1px);\n    margin-top: 0.0625em;\n    cursor: default;\n\n    &:not([hidden]) {\n      display: inline-flex;\n      align-items: center;\n      vertical-align: top;\n    }\n\n    &[data-ready-only] {\n      cursor: default;\n    }\n\n    &[data-focused] {\n      box-shadow: inset 0 0 0 1px ${color.selectable?.primary.selected.border};\n      color: ${color.selectable?.primary.pressed.fg};\n    }\n\n    &[data-selected] {\n      background-color: ${color.selectable?.primary.pressed.bg};\n    }\n\n    &:not([data-focused]):not([data-selected]) {\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ${color.input.default.hovered.border};\n        }\n      }\n    }\n\n    &[data-markers] {\n      --card-bg-color: ${color.dark ? hues.purple[950].hex : hues.purple[50].hex};\n    }\n\n    &[data-warning] {\n      --card-bg-color: ${color.muted.caution.hovered.bg};\n\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ${color.muted.caution.hovered.border};\n        }\n      }\n    }\n\n    &[data-invalid] {\n      --card-bg-color: ${color.input.invalid.enabled.bg};\n      --card-border-color: ${color.input.invalid.enabled.border};\n\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ${color.input.invalid.hovered.border};\n        }\n      }\n    }\n  `\n}\n","import {EditIcon, TrashIcon} from '@sanity/icons'\nimport {Box, Inline, Text, useGlobalKeyDown, useTheme} from '@sanity/ui'\nimport {type MouseEvent, useCallback, useMemo, useRef} from 'react'\n\nimport {Button, Popover, type PopoverProps} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\n\nconst POPOVER_FALLBACK_PLACEMENTS: PopoverProps['fallbackPlacements'] = ['top', 'bottom']\n\ninterface InlineObjectToolbarPopoverProps {\n  floatingBoundary: HTMLElement | null\n  open: boolean\n  onClosePopover: () => void\n  onDelete: (event: MouseEvent<HTMLButtonElement>) => void\n  onEdit: (event: MouseEvent<HTMLButtonElement>) => void\n  referenceBoundary: HTMLElement | null\n  referenceElement: HTMLElement | null\n  title: string\n}\n\nexport function InlineObjectToolbarPopover(props: InlineObjectToolbarPopoverProps) {\n  const {\n    floatingBoundary,\n    onClosePopover,\n    onEdit,\n    onDelete,\n    referenceBoundary,\n    referenceElement,\n    title,\n    open,\n  } = props\n  const {sanity} = useTheme()\n  const {t} = useTranslation()\n  const editButtonRef = useRef<HTMLButtonElement | null>(null)\n  const deleteButtonRef = useRef<HTMLButtonElement | null>(null)\n  const popoverScheme = sanity.color.dark ? 'light' : 'dark'\n\n  // Close floating toolbar on Escape\n  // Focus to edit button on Tab\n  useGlobalKeyDown(\n    useCallback(\n      (event) => {\n        if (event.key === 'Escape') {\n          event.preventDefault()\n          event.stopPropagation()\n          onClosePopover()\n        }\n      },\n      [onClosePopover],\n    ),\n  )\n\n  const handleDelete = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      if (deleteButtonRef.current?.disabled) {\n        return\n      }\n      event.preventDefault()\n      event.stopPropagation()\n      try {\n        onDelete(event)\n      } catch (err) {\n        console.error(err)\n      } finally {\n        if (deleteButtonRef.current) {\n          deleteButtonRef.current.disabled = true\n        }\n      }\n    },\n    [onDelete],\n  )\n\n  const popoverContent = useMemo(\n    () => (\n      <Box padding={1}>\n        <Inline space={1}>\n          <Box padding={2}>\n            <Text weight=\"medium\" size={1}>\n              {title}\n            </Text>\n          </Box>\n          <Button\n            aria-label={t('inputs.portable-text.inline-object.edit-aria-label')}\n            icon={EditIcon}\n            mode=\"bleed\"\n            onClick={onEdit}\n            ref={editButtonRef}\n            tooltipProps={{content: t('inputs.portable-text.inline-object.edit')}}\n          />\n          <Button\n            aria-label={t('inputs.portable-text.inline-object.remove-aria-label')}\n            ref={deleteButtonRef}\n            icon={TrashIcon}\n            mode=\"bleed\"\n            onClick={handleDelete}\n            tone=\"critical\"\n            tooltipProps={{content: t('inputs.portable-text.inline-object.remove')}}\n          />\n        </Inline>\n      </Box>\n    ),\n    [handleDelete, onEdit, title, t],\n  )\n\n  return (\n    <Popover\n      constrainSize\n      content={popoverContent}\n      fallbackPlacements={POPOVER_FALLBACK_PLACEMENTS}\n      floatingBoundary={floatingBoundary}\n      open={open}\n      placement=\"top\"\n      portal\n      referenceBoundary={referenceBoundary}\n      referenceElement={referenceElement}\n      scheme={popoverScheme}\n    />\n  )\n}\n","import {\n  type EditorSelection,\n  PortableTextEditor,\n  usePortableTextEditor,\n} from '@sanity/portable-text-editor'\nimport {\n  type ObjectSchemaType,\n  type Path,\n  type PortableTextBlock,\n  type PortableTextChild,\n} from '@sanity/types'\nimport {isEqual} from '@sanity/util/paths'\nimport {useCallback, useEffect, useMemo, useState} from 'react'\n\nimport {Tooltip} from '../../../../../ui-components'\nimport {pathToString} from '../../../../field/paths'\nimport {useTranslation} from '../../../../i18n'\nimport {EMPTY_ARRAY} from '../../../../util'\nimport {useChildPresence} from '../../../studio/contexts/Presence'\nimport {\n  type BlockProps,\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderCustomMarkers,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../../types'\nimport {useFormBuilder} from '../../../useFormBuilder'\nimport {useMemberValidation} from '../hooks/useMemberValidation'\nimport {usePortableTextMarkers} from '../hooks/usePortableTextMarkers'\nimport {usePortableTextMemberItem} from '../hooks/usePortableTextMembers'\nimport {PreviewSpan, Root, TooltipBox} from './InlineObject.styles'\nimport {InlineObjectToolbarPopover} from './InlineObjectToolbarPopover'\nimport {ObjectEditModal} from './modals/ObjectEditModal'\n\ninterface InlineObjectProps {\n  floatingBoundary: HTMLElement | null\n  focused: boolean\n  onItemClose: () => void\n  onItemOpen: (path: Path) => void\n  onPathFocus: (path: Path) => void\n  path: Path\n  readOnly?: boolean\n  referenceBoundary: HTMLElement | null\n  relativePath: Path\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderCustomMarkers?: RenderCustomMarkers\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n  schemaType: ObjectSchemaType\n  selected: boolean\n  value: PortableTextChild\n}\n\nexport const InlineObject = (props: InlineObjectProps) => {\n  const {\n    floatingBoundary,\n    focused,\n    onItemClose,\n    onItemOpen,\n    onPathFocus,\n    path,\n    readOnly,\n    referenceBoundary,\n    relativePath,\n    renderAnnotation,\n    renderBlock,\n    renderCustomMarkers,\n    renderField,\n    renderItem,\n    renderInlineBlock,\n    renderInput,\n    renderPreview,\n    schemaType,\n    selected,\n    value,\n  } = props\n  const {Markers} = useFormBuilder().__internal.components\n  const editor = usePortableTextEditor()\n  const markers = usePortableTextMarkers(path)\n  const memberItem = usePortableTextMemberItem(pathToString(path))\n  const {validation, hasError, hasInfo, hasWarning} = useMemberValidation(memberItem?.node)\n  const parentSchemaType = editor.schemaTypes.block\n  const hasMarkers = markers.length > 0\n  const selfSelection = useMemo(\n    (): EditorSelection => ({\n      anchor: {path: relativePath, offset: 0},\n      focus: {path: relativePath, offset: 0},\n    }),\n    [relativePath],\n  )\n\n  const onRemove = useCallback(() => {\n    PortableTextEditor.delete(editor, selfSelection, {mode: 'children'})\n    PortableTextEditor.focus(editor)\n  }, [selfSelection, editor])\n\n  const onOpen = useCallback(() => {\n    if (memberItem) {\n      // Take focus away from the editor so that it doesn't propagate a new focusPath and interfere here.\n      PortableTextEditor.blur(editor)\n      onItemOpen(memberItem.node.path)\n    }\n  }, [editor, onItemOpen, memberItem])\n\n  const onClose = useCallback(() => {\n    onItemClose()\n    PortableTextEditor.select(editor, selfSelection)\n    PortableTextEditor.focus(editor)\n  }, [onItemClose, editor, selfSelection])\n\n  const isOpen = Boolean(memberItem?.member.open)\n  const input = memberItem?.input\n  const nodePath = memberItem?.node.path || EMPTY_ARRAY\n  const referenceElement = memberItem?.elementRef?.current\n\n  const presence = useChildPresence(path, true)\n  const rootPresence = useMemo(\n    () => presence.filter((p) => isEqual(p.path, path)),\n    [path, presence],\n  )\n\n  const componentProps: BlockProps = useMemo(\n    () => ({\n      __unstable_floatingBoundary: floatingBoundary,\n      __unstable_referenceBoundary: referenceBoundary,\n      __unstable_referenceElement: referenceElement as HTMLElement | null,\n      children: input,\n      focused,\n      onClose,\n      onOpen,\n      onPathFocus,\n      onRemove,\n      open: isOpen,\n      markers,\n      member: memberItem?.member,\n      parentSchemaType,\n      path: nodePath,\n      presence: rootPresence,\n      readOnly: Boolean(readOnly),\n      renderAnnotation,\n      renderBlock,\n      renderDefault: DefaultInlineObjectComponent,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n      schemaType,\n      selected,\n      value: value as PortableTextBlock,\n      validation,\n    }),\n    [\n      floatingBoundary,\n      focused,\n      input,\n      isOpen,\n      markers,\n      memberItem?.member,\n      nodePath,\n      onClose,\n      onOpen,\n      onPathFocus,\n      onRemove,\n      parentSchemaType,\n      readOnly,\n      referenceBoundary,\n      referenceElement,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n      rootPresence,\n      schemaType,\n      selected,\n      validation,\n      value,\n    ],\n  )\n\n  // Tooltip indicating validation errors, warnings, info and markers\n  const tooltipEnabled = hasError || hasWarning || hasInfo || hasMarkers\n  const toolTipContent = useMemo(\n    () =>\n      (tooltipEnabled && (\n        <TooltipBox>\n          <Markers\n            markers={markers}\n            validation={validation}\n            renderCustomMarkers={renderCustomMarkers}\n          />\n        </TooltipBox>\n      )) ||\n      null,\n    [Markers, markers, renderCustomMarkers, tooltipEnabled, validation],\n  )\n\n  return useMemo(\n    () => (\n      <span ref={memberItem?.elementRef} contentEditable={false}>\n        <Tooltip\n          placement=\"bottom\"\n          portal=\"editor\"\n          // If the object modal is open, disable the tooltip to avoid it rerendering the inner items when the validation changes.\n          disabled={isOpen ? true : !tooltipEnabled}\n          content={toolTipContent}\n        >\n          {/* This relative span must be here for the ToolTip to properly show */}\n          {renderInlineBlock && (\n            <span style={{position: 'relative'}}>{renderInlineBlock(componentProps)}</span>\n          )}\n        </Tooltip>\n      </span>\n    ),\n    [\n      componentProps,\n      memberItem?.elementRef,\n      renderInlineBlock,\n      toolTipContent,\n      tooltipEnabled,\n      isOpen,\n    ],\n  )\n}\n\nexport const DefaultInlineObjectComponent = (props: BlockProps) => {\n  const {\n    __unstable_floatingBoundary: floatingBoundary,\n    __unstable_referenceBoundary: referenceBoundary,\n    __unstable_referenceElement: referenceElement,\n    children,\n    focused,\n    markers,\n    onClose,\n    onOpen,\n    onRemove,\n    open,\n    readOnly,\n    renderPreview,\n    schemaType,\n    selected,\n    validation,\n    value,\n  } = props\n  const {t} = useTranslation()\n  const hasMarkers = markers.length > 0\n  const [popoverOpen, setPopoverOpen] = useState<boolean>(false)\n  const popoverTitle = schemaType?.title || schemaType.name\n  const hasError = validation.filter((v) => v.level === 'error').length > 0\n  const hasWarning = validation.filter((v) => v.level === 'warning').length > 0\n\n  const openItem = useCallback((): void => {\n    setPopoverOpen(false)\n    onOpen()\n  }, [onOpen])\n\n  useEffect(() => {\n    if (open) {\n      setPopoverOpen(false)\n    } else if (focused) {\n      setPopoverOpen(true)\n    } else {\n      setPopoverOpen(false)\n    }\n  }, [focused, open])\n\n  const tone = useMemo(() => {\n    if (hasError) {\n      return 'critical'\n    }\n\n    if (hasWarning) {\n      return 'caution'\n    }\n\n    if (selected || focused) {\n      return 'primary'\n    }\n    return undefined\n  }, [focused, hasError, hasWarning, selected])\n\n  const onClosePopover = useCallback(() => {\n    setPopoverOpen(false)\n  }, [])\n\n  return (\n    <>\n      <Root\n        aria-label={t('inputs.portable-text.inline-block.aria-label')}\n        data-focused={focused || undefined}\n        data-invalid={hasError || undefined}\n        data-markers={hasMarkers || undefined}\n        data-read-only={readOnly || undefined}\n        data-selected={selected || undefined}\n        data-warning={hasWarning || undefined}\n        forwardedAs=\"span\"\n        onClick={readOnly ? openItem : undefined}\n        onDoubleClick={openItem}\n        tone={tone}\n      >\n        <PreviewSpan>\n          {renderPreview({\n            layout: 'inline',\n            schemaType,\n            skipVisibilityCheck: true,\n            value,\n            fallbackTitle: 'Click to edit',\n          })}\n        </PreviewSpan>\n      </Root>\n      {referenceElement && (\n        <InlineObjectToolbarPopover\n          floatingBoundary={floatingBoundary}\n          onClosePopover={onClosePopover}\n          onDelete={onRemove}\n          onEdit={openItem}\n          open={popoverOpen}\n          referenceBoundary={referenceBoundary}\n          referenceElement={referenceElement}\n          title={popoverTitle}\n        />\n      )}\n      {open && (\n        <ObjectEditModal\n          defaultType=\"popover\"\n          onClose={onClose}\n          autoFocus={focused}\n          floatingBoundary={floatingBoundary}\n          referenceBoundary={referenceBoundary}\n          referenceElement={referenceElement}\n          schemaType={schemaType}\n        >\n          {children}\n        </ObjectEditModal>\n      )}\n    </>\n  )\n}\n","import {\n  type BlockAnnotationRenderProps,\n  type BlockChildRenderProps as EditorChildRenderProps,\n  type BlockRenderProps as EditorBlockRenderProps,\n  type EditorSelection,\n  type HotkeyOptions,\n  type OnCopyFn,\n  type OnPasteFn,\n  type RangeDecoration,\n  usePortableTextEditor,\n} from '@sanity/portable-text-editor'\nimport {type Path, type PortableTextBlock, type PortableTextTextBlock} from '@sanity/types'\nimport {Box, Portal, PortalProvider, useBoundaryElement, usePortal} from '@sanity/ui'\nimport {useCallback, useMemo, useState} from 'react'\n\nimport {ChangeIndicator} from '../../../changeIndicators'\nimport {EMPTY_ARRAY} from '../../../util'\nimport {ActivateOnFocus} from '../../components/ActivateOnFocus/ActivateOnFocus'\nimport {type ArrayOfObjectsInputProps, type RenderCustomMarkers} from '../../types'\nimport {type RenderBlockActionsCallback} from '../../types/_transitional'\nimport {ExpandedLayer, Root} from './Compositor.styles'\nimport {Editor} from './Editor'\nimport {useHotkeys} from './hooks/useHotKeys'\nimport {useTrackFocusPath} from './hooks/useTrackFocusPath'\nimport {Annotation} from './object/Annotation'\nimport {BlockObject} from './object/BlockObject'\nimport {InlineObject} from './object/InlineObject'\nimport {TextBlock} from './text'\n\ninterface InputProps extends ArrayOfObjectsInputProps<PortableTextBlock> {\n  hasFocusWithin: boolean\n  hotkeys?: HotkeyOptions\n  isActive: boolean\n  isFullscreen: boolean\n  onActivate: () => void\n  onCopy?: OnCopyFn\n  onPaste?: OnPasteFn\n  onToggleFullscreen: () => void\n  path: Path\n  rangeDecorations?: RangeDecoration[]\n  renderBlockActions?: RenderBlockActionsCallback\n  renderCustomMarkers?: RenderCustomMarkers\n}\n\n/** @internal */\nexport type PortableTextEditorElement = HTMLDivElement | HTMLSpanElement\n\n/** @internal */\nexport function Compositor(props: Omit<InputProps, 'schemaType' | 'arrayFunctions'>) {\n  const {\n    changed,\n    focused,\n    focusPath = EMPTY_ARRAY,\n    hasFocusWithin,\n    hotkeys,\n    isActive,\n    isFullscreen,\n    onActivate,\n    onCopy,\n    onItemClose,\n    onItemOpen,\n    onItemRemove,\n    onPaste,\n    onPathFocus,\n    onToggleFullscreen,\n    path,\n    readOnly,\n    rangeDecorations,\n    renderAnnotation,\n    renderBlock,\n    renderBlockActions,\n    renderCustomMarkers,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n    value,\n  } = props\n\n  const editor = usePortableTextEditor()\n\n  const boundaryElement = useBoundaryElement().element\n  const [wrapperElement, setWrapperElement] = useState<HTMLDivElement | null>(null)\n  const [scrollElement, setScrollElement] = useState<HTMLElement | null>(null)\n\n  const handleToggleFullscreen = useCallback(() => {\n    onToggleFullscreen()\n  }, [onToggleFullscreen])\n\n  const hotkeysWithFullscreenToggle = useMemo(\n    () => ({\n      ...hotkeys,\n      custom: {\n        'mod+enter': onToggleFullscreen,\n        ...(hotkeys?.custom || {}),\n      },\n    }),\n\n    [hotkeys, onToggleFullscreen],\n  )\n\n  const editorHotkeys = useHotkeys(hotkeysWithFullscreenToggle)\n\n  const _renderBlockActions = !!value && renderBlockActions ? renderBlockActions : undefined\n  const _renderCustomMarkers = !!value && renderCustomMarkers ? renderCustomMarkers : undefined\n\n  const [portalElement, setPortalElement] = useState<HTMLDivElement | null>(null)\n\n  const renderTextBlock = useCallback(\n    (blockProps: EditorBlockRenderProps) => {\n      const {\n        children,\n        focused: blockFocused,\n        path: blockPath,\n        selected,\n        schemaType: blockSchemaType,\n        value: block,\n      } = blockProps\n      return (\n        <TextBlock\n          floatingBoundary={boundaryElement}\n          focused={blockFocused}\n          isFullscreen={isFullscreen}\n          onItemClose={onItemClose}\n          onItemOpen={onItemOpen}\n          onItemRemove={onItemRemove}\n          onPathFocus={onPathFocus}\n          path={path.concat(blockPath)}\n          readOnly={readOnly}\n          referenceBoundary={scrollElement}\n          renderAnnotation={renderAnnotation}\n          renderField={renderField}\n          renderInlineBlock={renderInlineBlock}\n          renderInput={renderInput}\n          renderItem={renderItem}\n          renderBlockActions={_renderBlockActions}\n          renderCustomMarkers={_renderCustomMarkers}\n          renderPreview={renderPreview}\n          renderBlock={renderBlock}\n          schemaType={blockSchemaType}\n          selected={selected}\n          value={block as PortableTextTextBlock}\n        >\n          {children}\n        </TextBlock>\n      )\n    },\n    [\n      _renderBlockActions,\n      _renderCustomMarkers,\n      boundaryElement,\n      isFullscreen,\n      onItemClose,\n      onItemOpen,\n      onItemRemove,\n      onPathFocus,\n      path,\n      readOnly,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n      scrollElement,\n    ],\n  )\n\n  const renderObjectBlock = useCallback(\n    (blockProps: EditorBlockRenderProps) => {\n      const {\n        focused: blockFocused,\n        path: blockPath,\n        selected: blockSelected,\n        schemaType: blockSchemaType,\n        value: blockValue,\n      } = blockProps\n      return (\n        <BlockObject\n          floatingBoundary={boundaryElement}\n          focused={blockFocused}\n          isFullscreen={isFullscreen}\n          onItemClose={onItemClose}\n          onItemOpen={onItemOpen}\n          onItemRemove={onItemRemove}\n          onPathFocus={onPathFocus}\n          path={path.concat(blockPath)}\n          readOnly={readOnly}\n          referenceBoundary={scrollElement}\n          relativePath={blockPath}\n          renderAnnotation={renderAnnotation}\n          renderBlock={renderBlock}\n          renderBlockActions={_renderBlockActions}\n          renderCustomMarkers={_renderCustomMarkers}\n          renderField={renderField}\n          renderInlineBlock={renderInlineBlock}\n          renderInput={renderInput}\n          renderItem={renderItem}\n          renderPreview={renderPreview}\n          schemaType={blockSchemaType}\n          selected={blockSelected}\n          value={blockValue}\n        />\n      )\n    },\n    [\n      boundaryElement,\n      scrollElement,\n      isFullscreen,\n      onItemClose,\n      onItemOpen,\n      onItemRemove,\n      onPathFocus,\n      path,\n      readOnly,\n      renderAnnotation,\n      renderBlock,\n      _renderBlockActions,\n      _renderCustomMarkers,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n    ],\n  )\n\n  // This is the function that is sent to PortableTextEditor's renderBlock callback\n  const editorRenderBlock = useCallback(\n    (blockProps: EditorBlockRenderProps) => {\n      const {value: block} = blockProps\n      const isTextBlock = block._type === editor.schemaTypes.block.name\n      if (isTextBlock) {\n        return renderTextBlock(blockProps)\n      }\n      return renderObjectBlock(blockProps)\n    },\n    [editor.schemaTypes.block.name, renderObjectBlock, renderTextBlock],\n  )\n\n  // This is the function that is sent to PortableTextEditor's renderChild callback\n  const editorRenderChild = useCallback(\n    (childProps: EditorChildRenderProps) => {\n      const {\n        children,\n        focused: childFocused,\n        path: childPath,\n        selected,\n        schemaType: childSchemaType,\n        value: child,\n      } = childProps\n      const isSpan = child._type === editor.schemaTypes.span.name\n      if (isSpan) {\n        return children\n      }\n      return (\n        <InlineObject\n          floatingBoundary={boundaryElement}\n          focused={childFocused}\n          onItemClose={onItemClose}\n          onItemOpen={onItemOpen}\n          onPathFocus={onPathFocus}\n          path={path.concat(childPath)}\n          readOnly={readOnly}\n          referenceBoundary={scrollElement}\n          relativePath={childPath}\n          renderAnnotation={renderAnnotation}\n          renderBlock={renderBlock}\n          renderCustomMarkers={renderCustomMarkers}\n          renderField={renderField}\n          renderInlineBlock={renderInlineBlock}\n          renderInput={renderInput}\n          renderItem={renderItem}\n          renderPreview={renderPreview}\n          schemaType={childSchemaType}\n          selected={selected}\n          value={child}\n        />\n      )\n    },\n    [\n      editor.schemaTypes.span.name,\n      boundaryElement,\n      onItemClose,\n      onItemOpen,\n      onPathFocus,\n      path,\n      readOnly,\n      scrollElement,\n      renderAnnotation,\n      renderBlock,\n      renderCustomMarkers,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n    ],\n  )\n\n  const editorRenderAnnotation = useCallback(\n    (annotationProps: BlockAnnotationRenderProps) => {\n      const {\n        children,\n        focused: editorNodeFocused,\n        path: aPath,\n        selected,\n        schemaType: aSchemaType,\n        value: aValue,\n      } = annotationProps\n      return (\n        <Annotation\n          editorNodeFocused={editorNodeFocused}\n          floatingBoundary={boundaryElement}\n          focused={Boolean(focused)}\n          onItemClose={onItemClose}\n          onItemOpen={onItemOpen}\n          onPathFocus={onPathFocus}\n          path={path.concat(aPath)}\n          readOnly={readOnly}\n          referenceBoundary={scrollElement}\n          renderAnnotation={renderAnnotation}\n          renderBlock={renderBlock}\n          renderCustomMarkers={renderCustomMarkers}\n          renderField={renderField}\n          renderInlineBlock={renderInlineBlock}\n          renderInput={renderInput}\n          renderItem={renderItem}\n          renderPreview={renderPreview}\n          schemaType={aSchemaType}\n          selected={selected}\n          value={aValue}\n        >\n          {children}\n        </Annotation>\n      )\n    },\n    [\n      boundaryElement,\n      scrollElement,\n      focused,\n      onItemClose,\n      onItemOpen,\n      onPathFocus,\n      path,\n      readOnly,\n      renderAnnotation,\n      renderBlock,\n      renderCustomMarkers,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n    ],\n  )\n  const ariaDescribedBy = props.elementProps['aria-describedby']\n\n  // Create an initial editor selection based on the focusPath\n  // at the time that the editor mounts. Any updates to the\n  // focusPath later will be handled by the useTrackFocusPath hook.\n  // The initial selection is handled explicitly as a separate\n  // prop to the Editable PTE component (initialSelection) so that\n  // selections can be set initially even though the editor value\n  // might not be fully propagated or rendered yet.\n  const initialSelection: EditorSelection | undefined = useMemo(() => {\n    // We can be sure that the focusPath is pointing directly to\n    // editor content when hasFocusWithin is true.\n    if (hasFocusWithin) {\n      return {\n        anchor: {\n          path: focusPath,\n          offset: 0,\n        },\n        focus: {\n          path: focusPath,\n          offset: 0,\n        },\n      }\n    }\n    return undefined\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []) // Only at mount time!\n\n  const editorNode = useMemo(\n    () => (\n      <Editor\n        ariaDescribedBy={ariaDescribedBy}\n        initialSelection={initialSelection}\n        hotkeys={editorHotkeys}\n        isActive={isActive}\n        isFullscreen={isFullscreen}\n        onItemOpen={onItemOpen}\n        onCopy={onCopy}\n        onPaste={onPaste}\n        onToggleFullscreen={handleToggleFullscreen}\n        path={path}\n        rangeDecorations={rangeDecorations}\n        readOnly={readOnly}\n        renderAnnotation={editorRenderAnnotation}\n        renderBlock={editorRenderBlock}\n        renderChild={editorRenderChild}\n        setPortalElement={setPortalElement}\n        scrollElement={scrollElement}\n        setScrollElement={setScrollElement}\n      />\n    ),\n\n    // Keep only stable ones here!\n    [\n      ariaDescribedBy,\n      editorHotkeys,\n      isActive,\n      isFullscreen,\n      onItemOpen,\n      onCopy,\n      onPaste,\n      handleToggleFullscreen,\n      path,\n      rangeDecorations,\n      readOnly,\n      editorRenderAnnotation,\n      editorRenderBlock,\n      editorRenderChild,\n      initialSelection,\n      scrollElement,\n    ],\n  )\n\n  const portal = usePortal()\n  const portalElements = useMemo(\n    () => ({\n      collapsed: wrapperElement,\n      default: portal.element,\n      editor: portalElement,\n      expanded: portal.element,\n    }),\n\n    [portal.element, portalElement, wrapperElement],\n  )\n\n  // Scroll to the DOM element of the \"opened\" portable text member when relevant.\n  useTrackFocusPath({\n    focusPath,\n    boundaryElement: scrollElement,\n    onItemClose,\n  })\n\n  // The editor should have a focus ring when the field itself is focused,\n  // or focus is pointing directly to a node inside the editor\n  // (as opposed to focus on fields inside object nodes like annotations, inline blocks etc.)\n  const editorFocused = focused || hasFocusWithin\n\n  return (\n    <PortalProvider __unstable_elements={portalElements} element={portal.element}>\n      <ActivateOnFocus onActivate={onActivate} isOverlayActive={!isActive}>\n        <ChangeIndicator\n          disabled={isFullscreen}\n          hasFocus={Boolean(focused)}\n          isChanged={changed}\n          path={path}\n        >\n          <Root\n            data-focused={editorFocused ? '' : undefined}\n            data-read-only={readOnly ? '' : undefined}\n          >\n            <Box data-wrapper=\"\" ref={setWrapperElement}>\n              <Portal __unstable_name={isFullscreen ? 'expanded' : 'collapsed'}>\n                {isFullscreen ? <ExpandedLayer>{editorNode}</ExpandedLayer> : editorNode}\n              </Portal>\n            </Box>\n            <div data-border=\"\" />\n          </Root>\n        </ChangeIndicator>\n      </ActivateOnFocus>\n    </PortalProvider>\n  )\n}\n","import {type InvalidValueResolution} from '@sanity/portable-text-editor'\nimport {useTelemetry} from '@sanity/telemetry/react'\nimport {\n  Box,\n  // eslint-disable-next-line no-restricted-imports\n  Button,\n  Card,\n  Code,\n  Grid,\n  Stack,\n  Text,\n} from '@sanity/ui'\nimport {useCallback} from 'react'\n\nimport {Translate, useTranslation} from '../../../i18n'\nimport {\n  PortableTextInvalidValueIgnore,\n  PortableTextInvalidValueResolve,\n} from '../../__telemetry__/form.telemetry'\nimport {Alert} from '../../components/Alert'\n\ninterface InvalidValueProps {\n  onChange: (...args: any[]) => any\n  onIgnore: () => void\n  readOnly?: boolean\n  resolution: InvalidValueResolution\n}\n\nexport function InvalidValue(props: InvalidValueProps) {\n  const {onChange, onIgnore, resolution, readOnly} = props\n  const telemetry = useTelemetry()\n\n  const {t} = useTranslation()\n\n  const handleAction = useCallback(() => {\n    if (resolution) {\n      onChange({type: 'mutation', patches: resolution.patches})\n      telemetry.log(PortableTextInvalidValueResolve, {\n        PTEInvalidValueId: resolution.i18n.description,\n        PTEInvalidValueDescription: resolution.description,\n      })\n    }\n  }, [onChange, resolution, telemetry])\n\n  const handleOnIgnore = useCallback(() => {\n    telemetry.log(PortableTextInvalidValueIgnore)\n    onIgnore()\n  }, [onIgnore, telemetry])\n\n  if (!resolution) return null\n\n  return (\n    <Alert\n      title={<>{t('inputs.portable-text.invalid-value.title')}</>}\n      suffix={\n        <Stack padding={2}>\n          {resolution.action && (\n            <Grid columns={[1, 2]} gap={1}>\n              <Button\n                mode=\"ghost\"\n                onClick={handleOnIgnore}\n                text={t('inputs.portable-text.invalid-value.ignore-button.text')}\n              />\n              {/* @todo: use plain string */}\n              {!readOnly && (\n                <Button\n                  onClick={handleAction}\n                  text={\n                    <Translate\n                      t={t}\n                      i18nKey={resolution.i18n.action}\n                      values={resolution.i18n.values}\n                    />\n                  }\n                  tone=\"caution\"\n                />\n              )}\n            </Grid>\n          )}\n\n          <Box padding={3}>\n            {resolution.action && (\n              <Text as=\"p\" muted size={1}>\n                {t('inputs.portable-text.invalid-value.action-disclaimer')}\n              </Text>\n            )}\n          </Box>\n        </Stack>\n      }\n    >\n      <Stack space={3}>\n        <Text as=\"p\" muted size={1}>\n          <Translate t={t} i18nKey={resolution.i18n.description} values={resolution.i18n.values} />\n        </Text>\n\n        <Card border overflow=\"auto\" padding={2} tone=\"inherit\">\n          <Code language=\"json\">{JSON.stringify(resolution.item, null, 2)}</Code>\n        </Card>\n      </Stack>\n    </Alert>\n  )\n}\n","import {type Path, type PathSegment} from '@sanity/types'\nimport {find, get} from 'lodash'\nimport {useCallback} from 'react'\nimport shallowEquals from 'shallow-equals'\n\nimport {isRecord} from '../../../util'\nimport {type FormPatch} from '../../patch'\nimport {useFormBuilder} from '../../useFormBuilder'\n\n/**\n * @internal\n */\nexport interface PatchesData {\n  patches: Array<FormPatch>\n  shouldReset: boolean\n  snapshot: any\n}\n\n/**\n * @internal\n */\nexport type PatchesSubscriber = (data: PatchesData) => void\n\n/**\n * @internal\n */\nexport function usePatches(props: {path: Path}): {\n  subscribe: (subscriber: PatchesSubscriber) => () => void\n} {\n  const {path} = props\n  const {patchChannel} = useFormBuilder().__internal\n\n  const subscribe = useCallback(\n    (subscriber: PatchesSubscriber) => {\n      return patchChannel.subscribe(({snapshot, patches}) => {\n        const filteredPatches = patches\n          .filter((patch) => _startsWith(patch.path, path))\n          .map((patch) => ({\n            ...patch,\n            path: patch.path.slice(path.length),\n          }))\n\n        if (filteredPatches.length) {\n          subscriber({\n            shouldReset: _shouldReset(path, patches),\n            snapshot: isRecord(snapshot) ? _getValueAtPath(snapshot, path) : {},\n            patches: filteredPatches,\n          })\n        }\n      })\n    },\n    [path, patchChannel],\n  )\n\n  return {subscribe}\n}\n\nfunction _isSegmentEqual(segment1: PathSegment, segment2: PathSegment) {\n  const segment1Type = typeof segment1\n  if (segment1Type !== typeof segment2) {\n    return false\n  }\n  if (segment1Type === 'object') {\n    return shallowEquals(segment1, segment2)\n  }\n  return segment1 === segment2\n}\n\nfunction _startsWith(subjectPath: Path, checkPath: Path) {\n  if (subjectPath === checkPath) {\n    return true\n  }\n  if (!Array.isArray(subjectPath) || !Array.isArray(checkPath)) {\n    return false\n  }\n  if (subjectPath.length < checkPath.length) {\n    return false\n  }\n  for (let i = 0, len = checkPath.length; i < len; i++) {\n    if (!_isSegmentEqual(checkPath[i], subjectPath[i])) {\n      return false\n    }\n  }\n  return true\n}\n\nfunction _isAncestor(path1: Path, path2: Path) {\n  return path1.length === 0 || (_startsWith(path2, path1) && !_startsWith(path1, path2))\n}\n\nfunction _shouldReset(path: Path, patches: FormPatch[]) {\n  return patches.some(\n    (patch) => _isAncestor(patch.path, path) && (patch.type === 'set' || patch.type === 'unset'),\n  )\n}\n\nfunction _getValueAtPath(value: Record<string, unknown>, path: Path) {\n  return path.reduce((result, segment) => {\n    if (typeof segment === 'object') {\n      return find(result, segment)\n    }\n\n    return get(result, segment)\n  }, value)\n}\n","import {\n  type EditorChange,\n  type InvalidValue,\n  type Patch as EditorPatch,\n  type Patch,\n  PortableTextEditor,\n} from '@sanity/portable-text-editor'\nimport {useTelemetry} from '@sanity/telemetry/react'\nimport {isKeySegment, type Path, type PortableTextBlock} from '@sanity/types'\nimport {Box, useToast} from '@sanity/ui'\nimport {\n  type MutableRefObject,\n  type ReactNode,\n  startTransition,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport {Subject} from 'rxjs'\n\nimport {EMPTY_ARRAY} from '../../../util'\nimport {\n  PortableTextInputCollapsed,\n  PortableTextInputExpanded,\n} from '../../__telemetry__/form.telemetry'\nimport {SANITY_PATCH_TYPE} from '../../patch'\nimport {type ArrayOfObjectsItemMember, type ObjectFormNode} from '../../store'\nimport {type PortableTextInputProps} from '../../types'\nimport {Compositor, type PortableTextEditorElement} from './Compositor'\nimport {PortableTextMarkersProvider} from './contexts/PortableTextMarkers'\nimport {PortableTextMemberItemsProvider} from './contexts/PortableTextMembers'\nimport {usePortableTextMemberItemsFromProps} from './hooks/usePortableTextMembers'\nimport {InvalidValue as RespondToInvalidContent} from './InvalidValue'\nimport {usePatches} from './usePatches'\n\n/** @internal */\nexport interface PortableTextMemberItem {\n  kind: 'annotation' | 'textBlock' | 'objectBlock' | 'inlineObject'\n  key: string\n  member: ArrayOfObjectsItemMember\n  node: ObjectFormNode\n  elementRef?: MutableRefObject<PortableTextEditorElement | null>\n  input?: ReactNode\n}\n\n/**\n * Input component for editing block content\n * ({@link https://github.com/portabletext/portabletext | Portable Text}) in the Sanity Studio.\n *\n * Supports multi-user real-time block content editing on larger documents.\n *\n * This component can be configured and customized extensively.\n * {@link https://www.sanity.io/docs/customizing-the-portable-text-editor | Go to the documentation for more details}.\n *\n * @public\n * @param props - {@link PortableTextInputProps} component props.\n */\nexport function PortableTextInput(props: PortableTextInputProps) {\n  const {\n    editorRef: editorRefProp,\n    elementProps,\n    hotkeys,\n    markers = EMPTY_ARRAY,\n    onChange,\n    onCopy,\n    onEditorChange,\n    onFullScreenChange,\n    onInsert,\n    onItemRemove,\n    onPaste,\n    onPathFocus,\n    path,\n    readOnly,\n    rangeDecorations,\n    renderBlockActions,\n    renderCustomMarkers,\n    schemaType,\n    value,\n  } = props\n\n  const {onBlur} = elementProps\n  const defaultEditorRef = useRef<PortableTextEditor | null>(null)\n  const editorRef = editorRefProp || defaultEditorRef\n\n  // This handle will allow for natively calling .focus\n  // on the returned component and have the PortableTextEditor focused,\n  // simulating a native input element (like with an string input)\n  useImperativeHandle(elementProps.ref, () => ({\n    focus() {\n      if (editorRef.current) {\n        PortableTextEditor.focus(editorRef.current)\n      }\n    },\n  }))\n\n  const {subscribe} = usePatches({path})\n  const [ignoreValidationError, setIgnoreValidationError] = useState(false)\n  const [invalidValue, setInvalidValue] = useState<InvalidValue | null>(null)\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const [isActive, setIsActive] = useState(false)\n  const [isOffline, setIsOffline] = useState(false)\n  const [hasFocusWithin, setHasFocusWithin] = useState(false)\n  const telemetry = useTelemetry()\n\n  const toast = useToast()\n\n  // Memoized patch stream\n  const patchSubject: Subject<{\n    patches: EditorPatch[]\n    snapshot: PortableTextBlock[] | undefined\n  }> = useMemo(() => new Subject(), [])\n  const patches$ = useMemo(() => patchSubject.asObservable(), [patchSubject])\n\n  const innerElementRef = useRef<HTMLDivElement | null>(null)\n\n  const handleToggleFullscreen = useCallback(() => {\n    setIsFullscreen((v) => {\n      const next = !v\n      if (next) {\n        telemetry.log(PortableTextInputExpanded)\n      } else {\n        telemetry.log(PortableTextInputCollapsed)\n      }\n\n      onFullScreenChange?.(next)\n      return next\n    })\n  }, [onFullScreenChange, telemetry])\n\n  // Reset invalidValue if new value is coming in from props\n  useEffect(() => {\n    if (invalidValue && value !== invalidValue.value) {\n      setInvalidValue(null)\n    }\n  }, [invalidValue, value])\n\n  // Subscribe to patches\n  useEffect(() => {\n    return subscribe(({patches, snapshot}): void => {\n      patchSubject.next({patches, snapshot})\n    })\n  }, [patchSubject, subscribe])\n\n  const portableTextMemberItems = usePortableTextMemberItemsFromProps(props)\n\n  // Set active if focused within the editor\n  useEffect(() => {\n    if (hasFocusWithin) {\n      setIsActive(true)\n    }\n  }, [hasFocusWithin])\n\n  // Report focus on spans with `.text` appended to the reported focusPath.\n  // This is done to support the Presentation tool which uses this kind of paths to refer to texts.\n  // The PT-input already supports these paths the other way around.\n  // It's a bit ugly right here, but it's a rather simple way to support the Presentation tool without\n  // having to change the PTE's internals.\n  const setFocusPathFromEditorSelection = useCallback(\n    (focusPath: Path) => {\n      // Test if the focusPath is pointing directly to a span\n      const isSpanPath =\n        focusPath.length === 3 && // A span path is always 3 segments long\n        focusPath[1] === 'children' && // Is a child of a block\n        isKeySegment(focusPath[2]) && // Contains the key of the child\n        !portableTextMemberItems.some(\n          (item) => isKeySegment(focusPath[2]) && item.member.key === focusPath[2]._key,\n        ) // Not an inline object (it would be a member in this list, where spans are not). By doing this check we avoid depending on the value.\n      if (isSpanPath) {\n        // Append `.text` to the focusPath\n        onPathFocus(focusPath.concat('text'))\n      } else {\n        // Call normally\n        onPathFocus(focusPath)\n      }\n    },\n    [onPathFocus, portableTextMemberItems],\n  )\n\n  // Handle editor changes\n  const handleEditorChange = useCallback(\n    (change: EditorChange): void => {\n      switch (change.type) {\n        case 'mutation':\n          onChange(toFormPatches(change.patches))\n          break\n        case 'connection':\n          if (change.value === 'offline') {\n            setIsOffline(true)\n          } else if (change.value === 'online') {\n            setIsOffline(false)\n          }\n          break\n        case 'selection':\n          // This doesn't need to be immediate,\n          // call through startTransition\n          startTransition(() => {\n            if (change.selection) {\n              setFocusPathFromEditorSelection(change.selection.focus.path)\n            }\n          })\n          break\n        case 'focus':\n          setIsActive(true)\n          setHasFocusWithin(true)\n          break\n        case 'blur':\n          onBlur(change.event)\n          setHasFocusWithin(false)\n          break\n        case 'undo':\n        case 'redo':\n          onChange(toFormPatches(change.patches))\n          break\n        case 'invalidValue':\n          setInvalidValue(change)\n          break\n        case 'error':\n          toast.push({\n            status: change.level,\n            description: change.description,\n          })\n          break\n        default:\n      }\n      if (editorRef.current && onEditorChange) {\n        onEditorChange(change, editorRef.current)\n      }\n    },\n    [editorRef, onBlur, onChange, onEditorChange, setFocusPathFromEditorSelection, toast],\n  )\n\n  useEffect(() => {\n    setIgnoreValidationError(false)\n  }, [value])\n\n  const handleIgnoreInvalidValue = useCallback((): void => {\n    setIgnoreValidationError(true)\n  }, [])\n\n  const respondToInvalidContent = useMemo(() => {\n    if (invalidValue && invalidValue.resolution) {\n      return (\n        <Box marginBottom={2}>\n          <RespondToInvalidContent\n            onChange={handleEditorChange}\n            onIgnore={handleIgnoreInvalidValue}\n            resolution={invalidValue.resolution}\n            readOnly={isOffline || readOnly}\n          />\n        </Box>\n      )\n    }\n    return null\n  }, [handleEditorChange, handleIgnoreInvalidValue, invalidValue, isOffline, readOnly])\n\n  const handleActivate = useCallback((): void => {\n    if (!isActive) {\n      setIsActive(true)\n      if (editorRef.current) {\n        PortableTextEditor.focus(editorRef.current)\n      }\n    }\n  }, [editorRef, isActive])\n\n  return (\n    <Box ref={innerElementRef}>\n      {!ignoreValidationError && respondToInvalidContent}\n      {(!invalidValue || ignoreValidationError) && (\n        <PortableTextMarkersProvider markers={markers}>\n          <PortableTextMemberItemsProvider memberItems={portableTextMemberItems}>\n            <PortableTextEditor\n              patches$={patches$}\n              onChange={handleEditorChange}\n              maxBlocks={undefined} // TODO: from schema?\n              ref={editorRef}\n              readOnly={isOffline || readOnly}\n              schemaType={schemaType}\n              value={value}\n            >\n              <Compositor\n                {...props}\n                hasFocusWithin={hasFocusWithin}\n                hotkeys={hotkeys}\n                isActive={isActive}\n                isFullscreen={isFullscreen}\n                onActivate={handleActivate}\n                onItemRemove={onItemRemove}\n                onCopy={onCopy}\n                onInsert={onInsert}\n                onPaste={onPaste}\n                onToggleFullscreen={handleToggleFullscreen}\n                rangeDecorations={rangeDecorations}\n                renderBlockActions={renderBlockActions}\n                renderCustomMarkers={renderCustomMarkers}\n              />\n            </PortableTextEditor>\n          </PortableTextMemberItemsProvider>\n        </PortableTextMarkersProvider>\n      )}\n    </Box>\n  )\n}\n\nfunction toFormPatches(patches: any) {\n  return patches.map((p: Patch) => ({...p, patchType: SANITY_PATCH_TYPE}))\n}\n","export function focusRingBorderStyle(border: {color: string; width: number}): string {\n  return `inset 0 0 0 ${border.width}px ${border.color}`\n}\n\nexport function focusRingStyle(opts: {\n  base?: {bg: string}\n  border?: {color: string; width: number}\n  focusRing: {offset: number; width: number}\n}): string {\n  const {base, border, focusRing} = opts\n  const focusRingOutsetWidth = focusRing.offset + focusRing.width\n  const focusRingInsetWidth = 0 - focusRing.offset\n  const bgColor = base ? base.bg : 'var(--card-bg-color)'\n\n  return [\n    focusRingInsetWidth > 0 && `inset 0 0 0 ${focusRingInsetWidth}px var(--card-focus-ring-color)`,\n    border && focusRingBorderStyle(border),\n    focusRingInsetWidth < 0 && `0 0 0 ${0 - focusRingInsetWidth}px ${bgColor}`,\n    focusRingOutsetWidth > 0 && `0 0 0 ${focusRingOutsetWidth}px var(--card-focus-ring-color)`,\n  ]\n    .filter(Boolean)\n    .join(',')\n}\n","import {CloseIcon} from '@sanity/icons'\nimport {Box, Card, Flex, isHTMLElement, rem, Text, type Theme, useForwardedRef} from '@sanity/ui'\nimport {\n  type ChangeEvent,\n  type FocusEvent,\n  forwardRef,\n  type HTMLProps,\n  type KeyboardEvent,\n  type PointerEvent,\n  type Ref,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react'\nimport styled, {css, type CSSObject} from 'styled-components'\n\nimport {Button} from '../../../../ui-components'\nimport {useTranslation} from '../../../i18n'\nimport {studioLocaleNamespace} from '../../../i18n/localeNamespaces'\nimport {focusRingBorderStyle, focusRingStyle} from './styles'\n\nconst Root = styled(Card)((props: {theme: Theme}): CSSObject => {\n  const {theme} = props\n  const {focusRing, input, radius} = theme.sanity\n  const color = theme.sanity.color.input\n  const space = rem(theme.sanity.space[1])\n\n  return {\n    position: 'relative',\n    borderRadius: `${radius[1]}px`,\n    color: color.default.enabled.fg,\n    boxShadow: focusRingBorderStyle({\n      color: color.default.enabled.border,\n      width: input.border.width,\n    }),\n\n    '& > .content': {\n      position: 'relative',\n      lineHeight: 0,\n      margin: `-${space} 0 0 -${space}`,\n    },\n\n    '& > .content > div': {\n      display: 'inline-block',\n      verticalAlign: 'top',\n      padding: `${space} 0 0 ${space}`,\n    },\n\n    // enabled\n    '&:not([data-read-only])': {\n      cursor: 'text',\n    },\n\n    // hovered\n    '@media(hover:hover):not([data-disabled]):not([data-read-only]):hover': {\n      borderColor: color.default.hovered.border,\n    },\n\n    // focused\n    '&:not([data-disabled]):not([data-read-only])[data-focused]': {\n      boxShadow: focusRingStyle({\n        border: {\n          color: color.default.enabled.border,\n          width: input.border.width,\n        },\n        focusRing,\n      }),\n    },\n\n    // disabled\n    '*:disabled + &': {\n      color: color.default.disabled.fg,\n      backgroundColor: color.default.disabled.bg,\n      boxShadow: focusRingBorderStyle({\n        color: color.default.disabled.border,\n        width: input.border.width,\n      }),\n    },\n  }\n})\n\nconst Input = styled.input((props: {theme: Theme}): CSSObject => {\n  const {theme} = props\n  const font = theme.sanity.fonts.text\n  const color = theme.sanity.color.input\n  const p = theme.sanity.space[2]\n  const size = theme.sanity.fonts.text.sizes[2]\n\n  return {\n    appearance: 'none',\n    background: 'none',\n    border: 0,\n    borderRadius: 0,\n    outline: 'none',\n    fontSize: rem(size.fontSize),\n    lineHeight: size.lineHeight / size.fontSize,\n    fontFamily: font.family,\n    fontWeight: font.weights.regular,\n    margin: 0,\n    display: 'block',\n    minWidth: '1px',\n    maxWidth: '100%',\n    boxSizing: 'border-box',\n    paddingTop: rem(p - size.ascenderHeight),\n    paddingRight: rem(p),\n    paddingBottom: rem(p - size.descenderHeight),\n    paddingLeft: rem(p),\n\n    // enabled\n    '&:not(:invalid):not(:disabled)': {\n      color: color.default.enabled.fg,\n    },\n\n    // disabled\n    '&:not(:invalid):disabled': {\n      color: color.default.disabled.fg,\n    },\n  }\n})\n\nconst Placeholder = styled(Box)((props: {theme: Theme}) => {\n  const {theme} = props\n  const color = theme.sanity.color.input\n\n  return css`\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    pointer-events: none;\n    --card-fg-color: ${color.default.enabled.placeholder};\n  `\n})\n\nconst TagBox = styled(Box)`\n  // This is needed to make textOverflow=\"ellipsis\" work properly for the Text primitive\n  max-width: 100%;\n`\n\nexport const TagInput = forwardRef(\n  (\n    props: {\n      readOnly?: boolean\n      onChange?: (newValue: {value: string}[]) => void\n      onFocus?: (event: FocusEvent) => void\n      placeholder?: string\n      value?: {value: string}[]\n    } & Omit<HTMLProps<HTMLInputElement>, 'as' | 'onChange' | 'onFocus' | 'ref' | 'value'>,\n    ref: Ref<HTMLInputElement>,\n  ) => {\n    const {\n      disabled,\n      onChange,\n      onFocus,\n      placeholder: placeholderProp,\n      readOnly,\n      value = [],\n      ...restProps\n    } = props\n\n    const {t} = useTranslation(studioLocaleNamespace)\n    const [inputValue, setInputValue] = useState('')\n    const enabled = !disabled && !readOnly\n    const [focused, setFocused] = useState(false)\n    const forwardedRef = useForwardedRef(ref)\n    const rootRef = useRef<HTMLDivElement | null>(null)\n\n    const handleRootPointerDown = useCallback(\n      (event: PointerEvent<HTMLDivElement>) => {\n        const isTagElement = isHTMLElement(event.target) && event.target.closest('[data-ui=\"Tag\"]')\n\n        if (isTagElement) return\n\n        const inputElement = forwardedRef.current\n\n        if (inputElement) {\n          setTimeout(() => inputElement.focus(), 0)\n        }\n      },\n      [forwardedRef],\n    )\n\n    const handleInputBlur = useCallback(() => {\n      setFocused(false)\n    }, [])\n\n    const handleInputChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n      setInputValue(event.currentTarget.value)\n    }, [])\n\n    const handleInputFocus = useCallback(\n      (event: FocusEvent) => {\n        setFocused(true)\n        if (onFocus) onFocus(event)\n      },\n      [onFocus],\n    )\n\n    const handleInputKeyDown = useCallback(\n      (event: KeyboardEvent<HTMLInputElement>) => {\n        if (event.key === 'Enter') {\n          event.preventDefault()\n          event.stopPropagation()\n\n          if (onChange && inputValue) {\n            const newValue = value.concat([{value: inputValue}])\n\n            setInputValue('')\n\n            if (onChange) onChange(newValue)\n          }\n        }\n      },\n      [inputValue, onChange, value],\n    )\n\n    const handleTagRemove = useCallback(\n      (index: number) => {\n        if (!onChange) return\n\n        const newValue = value.slice(0)\n\n        newValue.splice(index, 1)\n\n        onChange(newValue)\n      },\n      [onChange, value],\n    )\n\n    useEffect(() => {\n      const inputElement = forwardedRef.current\n\n      if (inputElement) {\n        inputElement.style.width = '0'\n        inputElement.style.width = `${inputElement.scrollWidth}px`\n      }\n    }, [forwardedRef, inputValue])\n\n    return (\n      <Root\n        data-disabled={disabled ? '' : undefined}\n        data-focused={focused ? '' : undefined}\n        data-read-only={readOnly ? '' : undefined}\n        data-ui=\"TagInput\"\n        onPointerDown={handleRootPointerDown}\n        overflow=\"auto\"\n        padding={1}\n        ref={rootRef}\n      >\n        {enabled && (\n          <Placeholder hidden={Boolean(inputValue || value.length)} padding={3}>\n            <Text textOverflow=\"ellipsis\">\n              {placeholderProp\n                ? placeholderProp\n                : t('inputs.tags.placeholder', {\n                    context:\n                      typeof window !== 'undefined' && 'ontouchstart' in window\n                        ? 'touch'\n                        : undefined,\n                  })}\n            </Text>\n          </Placeholder>\n        )}\n\n        <div className=\"content\">\n          {value.map((tag, tagIndex) => (\n            // eslint-disable-next-line react/no-array-index-key\n            <TagBox key={`tag-${tagIndex}`}>\n              <Tag\n                enabled={enabled}\n                index={tagIndex}\n                muted={!enabled}\n                onRemove={handleTagRemove}\n                tag={tag}\n              />\n            </TagBox>\n          ))}\n\n          <div key=\"tag-input\">\n            <Input\n              {...restProps}\n              disabled={!enabled}\n              onBlur={handleInputBlur}\n              onChange={handleInputChange}\n              onFocus={handleInputFocus}\n              onKeyDown={handleInputKeyDown}\n              ref={forwardedRef}\n              type=\"text\"\n              value={inputValue}\n            />\n          </div>\n        </div>\n      </Root>\n    )\n  },\n)\n\nTagInput.displayName = 'TagInput'\n\nfunction Tag(props: {\n  enabled: boolean\n  index: number\n  muted?: boolean\n  onRemove: (index: number) => void\n  tag: {value: string}\n}) {\n  const {enabled, index, muted, onRemove, tag} = props\n\n  const handleRemoveClick = useCallback(() => {\n    onRemove(index)\n  }, [index, onRemove])\n\n  return (\n    <Card data-ui=\"Tag\" radius={2} tone=\"transparent\">\n      <Flex align=\"center\" gap={1}>\n        <Box flex={1} paddingY={2} paddingLeft={2}>\n          <Text muted={muted} textOverflow=\"ellipsis\">\n            {tag.value}\n          </Text>\n        </Box>\n        {enabled && (\n          <Button\n            icon={CloseIcon}\n            mode=\"bleed\"\n            onClick={handleRemoveClick}\n            tooltipProps={{content: 'Remove'}}\n          />\n        )}\n      </Flex>\n    </Card>\n  )\n}\n","import {useCallback, useMemo} from 'react'\n\nimport {ChangeIndicator} from '../../changeIndicators'\nimport {TagInput} from '../components/tagInput'\nimport {set, unset} from '../patch'\nimport {type ArrayOfPrimitivesInputProps} from '../types'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport type TagsArrayInputProps = ArrayOfPrimitivesInputProps<string>\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function TagsArrayInput(props: TagsArrayInputProps) {\n  const {onChange, readOnly, value = [], elementProps, path, changed} = props\n  const tagInputValue = useMemo(() => value?.map((v) => ({value: v})), [value])\n\n  const handleChange = useCallback(\n    (nextValue: {value: string}[]) => {\n      onChange(nextValue.length === 0 ? unset() : set(nextValue.map((v) => v.value)))\n    },\n    [onChange],\n  )\n\n  return (\n    <ChangeIndicator path={path} isChanged={changed} hasFocus={false}>\n      <TagInput\n        onChange={handleChange}\n        readOnly={readOnly}\n        value={tagInputValue}\n        {...elementProps}\n      />\n    </ChangeIndicator>\n  )\n}\n","import {type ArraySchemaType} from '@sanity/types'\nimport {type ComponentType} from 'react'\n\nimport {ArrayOfObjectsInput} from '../../inputs/arrays/ArrayOfObjectsInput'\nimport {ArrayOfOptionsInput} from '../../inputs/arrays/ArrayOfOptionsInput'\nimport {ArrayOfPrimitivesInput} from '../../inputs/arrays/ArrayOfPrimitivesInput'\nimport {PortableTextInput} from '../../inputs/PortableText/PortableTextInput'\nimport {TagsArrayInput} from '../../inputs/TagsArrayInput'\nimport * as is from '../../utils/is'\n\nconst PRIMITIVES = ['string', 'number', 'boolean']\n\nexport function isArrayOfPrimitives(type: ArraySchemaType): boolean {\n  return type.of.every((ofType) => PRIMITIVES.includes(ofType.jsonType))\n}\n\nfunction isStringArray(type: ArraySchemaType): type is ArraySchemaType<string> {\n  return type.of.length === 1 && is.type('string', type.of[0])\n}\n\nfunction isTagsArray(type: ArraySchemaType<string>): boolean {\n  return type.options?.layout === 'tags'\n}\n\nfunction isPortableText(type: ArraySchemaType): boolean {\n  // TODO: better testing here, not only for type 'block' !\n  return type.of.some((memberType) => is.type('block', memberType))\n}\n\nfunction hasListOptions(type: ArraySchemaType): boolean {\n  return Boolean(type.options?.list)\n}\n\nexport function resolveArrayInput(type: ArraySchemaType): ComponentType<any> {\n  if (isStringArray(type) && isTagsArray(type)) {\n    return TagsArrayInput\n  }\n\n  // Schema provides predefines list\n  if (hasListOptions(type)) {\n    return ArrayOfOptionsInput\n  }\n\n  // Special component for array of primitive values\n  if (isArrayOfPrimitives(type)) {\n    return ArrayOfPrimitivesInput\n  }\n\n  // Use Portable Text editor if portable text.\n  if (isPortableText(type)) {\n    return PortableTextInput\n  }\n\n  return ArrayOfObjectsInput\n}\n","import {isTitledListValue, type TitledListValue} from '@sanity/types'\nimport {Box, Card, Flex, Inline, Radio, Select, Stack, Text} from '@sanity/ui'\nimport {capitalize} from 'lodash'\nimport {\n  type ChangeEvent,\n  type FocusEvent,\n  type ForwardedRef,\n  forwardRef,\n  useCallback,\n  useId,\n  useMemo,\n} from 'react'\n\nimport {ChangeIndicator} from '../../changeIndicators'\nimport {PatchEvent, set, unset} from '../patch'\nimport {type StringInputProps} from '../types'\n\nfunction toSelectItem(\n  option: TitledListValue<string | number> | string | number,\n): TitledListValue<string | number> {\n  return isTitledListValue(option) ? option : {title: capitalize(`${option}`), value: option}\n}\n\nconst EMPTY_ITEM = {title: '', value: undefined}\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function SelectInput(props: StringInputProps) {\n  const {\n    value,\n    readOnly,\n    validationError,\n    schemaType,\n    onChange,\n    path,\n    changed,\n    focused,\n    elementProps,\n  } = props\n  const items = useMemo(\n    () => (schemaType.options?.list || []).map(toSelectItem),\n    [schemaType.options?.list],\n  )\n  const currentItem = items.find((item) => item.value === value)\n  const isRadio = schemaType.options && schemaType.options.layout === 'radio'\n\n  const itemFromOptionValue = useCallback(\n    (optionValue: any) => {\n      const index = Number(optionValue)\n\n      return items[index]\n    },\n    [items],\n  )\n\n  const optionValueFromItem = useCallback(\n    (item: any) => {\n      return String(items.indexOf(item))\n    },\n    [items],\n  )\n\n  const inputId = useId()\n\n  const handleChange = useCallback(\n    (nextItem: TitledListValue<string | number> | null) => {\n      onChange(\n        PatchEvent.from(typeof nextItem?.value === 'undefined' ? unset() : set(nextItem.value)),\n      )\n    },\n    [onChange],\n  )\n\n  const handleSelectChange = useCallback(\n    (event: ChangeEvent<HTMLSelectElement>) => {\n      const nextItem = itemFromOptionValue(event.currentTarget.value)\n\n      if (!nextItem) {\n        handleChange(EMPTY_ITEM)\n        return\n      }\n\n      handleChange(nextItem)\n    },\n    [handleChange, itemFromOptionValue],\n  )\n\n  const content = isRadio ? (\n    <RadioSelect\n      {...elementProps}\n      value={currentItem}\n      inputId={inputId}\n      items={items}\n      direction={schemaType.options?.direction || 'vertical'}\n      customValidity={validationError}\n      onChange={handleChange}\n      readOnly={readOnly}\n    />\n  ) : (\n    <Select\n      {...elementProps}\n      customValidity={validationError}\n      value={optionValueFromItem(currentItem)}\n      readOnly={readOnly}\n      onChange={handleSelectChange}\n    >\n      {[EMPTY_ITEM, ...items].map((item, i) => (\n        <option key={`${i - 1}`} value={i - 1}>\n          {item.title}\n        </option>\n      ))}\n    </Select>\n  )\n  return (\n    <ChangeIndicator path={path} isChanged={changed} hasFocus={!!focused}>\n      {content}\n    </ChangeIndicator>\n  )\n}\n\nconst RadioSelect = forwardRef(function RadioSelect(\n  props: {\n    items: TitledListValue<string | number>[]\n    value?: TitledListValue<string | number>\n    direction: 'horizontal' | 'vertical'\n    readOnly?: boolean\n    onChange: (value: TitledListValue<string | number> | null) => void\n    onFocus: (event: FocusEvent<HTMLElement>) => void\n    customValidity?: string\n    inputId?: string\n  },\n\n  ref: ForwardedRef<HTMLInputElement>,\n) {\n  const {items, value, onChange, onFocus, readOnly, customValidity, direction, inputId} = props\n\n  const Layout = direction === 'horizontal' ? Inline : Stack\n  return (\n    <Card border padding={3} radius={2}>\n      <Layout space={3} role=\"group\">\n        {items.map((item, index) => (\n          <RadioSelectItem\n            customValidity={customValidity}\n            inputId={inputId}\n            item={item}\n            key={index}\n            onChange={onChange}\n            onFocus={onFocus}\n            readOnly={readOnly}\n            ref={index === 0 ? ref : null}\n            value={value}\n          />\n        ))}\n      </Layout>\n    </Card>\n  )\n})\n\nconst RadioSelectItem = forwardRef(function RadioSelectItem(\n  props: {\n    customValidity?: string\n    inputId?: string\n    item: TitledListValue<string | number>\n    onChange: (value: TitledListValue<string | number> | null) => void\n    onFocus: (event: FocusEvent<HTMLElement>) => void\n    readOnly?: boolean\n    value?: TitledListValue<string | number>\n  },\n\n  ref: ForwardedRef<HTMLInputElement>,\n) {\n  const {customValidity, inputId, item, onChange, onFocus, readOnly, value} = props\n\n  const handleChange = useCallback(() => {\n    onChange(item)\n  }, [item, onChange])\n\n  return (\n    <Flex as=\"label\" align=\"center\">\n      <Radio\n        ref={ref}\n        checked={value === item}\n        onChange={handleChange}\n        onFocus={onFocus}\n        readOnly={readOnly}\n        customValidity={customValidity}\n        name={inputId}\n      />\n\n      <Box marginLeft={2}>\n        <Text size={1} weight=\"medium\">\n          {item.title}\n        </Text>\n      </Box>\n    </Flex>\n  )\n})\n","import {type NumberSchemaType} from '@sanity/types'\n\nimport {NumberInput} from '../../inputs/NumberInput'\nimport {SelectInput} from '../../inputs/SelectInput'\nimport {getOption} from './helpers'\n\nexport function resolveNumberInput(type: NumberSchemaType) {\n  return getOption(type, 'list') ? SelectInput : NumberInput\n}\n","import {type StringSchemaType} from '@sanity/types'\n\nimport {SelectInput} from '../../inputs/SelectInput'\nimport {StringInput} from '../../inputs/StringInput'\nimport {getOption} from './helpers'\n\nexport function resolveStringInput(type: StringSchemaType) {\n  return getOption(type, 'list') ? SelectInput : StringInput\n}\n","/* eslint-disable react/jsx-handler-names */\nimport {\n  type ArraySchemaType,\n  type NumberSchemaType,\n  type SchemaType,\n  type StringSchemaType,\n} from '@sanity/types'\nimport {type ComponentType} from 'react'\n\nimport {type PreviewProps} from '../../../components'\nimport {type FIXME} from '../../../FIXME'\nimport {SanityDefaultPreview} from '../../../preview'\nimport {type InputProps} from '../../types'\nimport * as is from '../../utils/is'\nimport {StudioReferenceInput} from '../inputs/reference/StudioReferenceInput'\nimport {defaultInputs} from './defaultInputs'\nimport {getTypeChain} from './helpers'\nimport {resolveArrayInput} from './resolveArrayInput'\nimport {resolveNumberInput} from './resolveNumberInput'\nimport {resolveStringInput} from './resolveStringInput'\n\nfunction resolveComponentFromTypeVariants(type: SchemaType): ComponentType<FIXME> | undefined {\n  if (is.type('array', type)) {\n    return resolveArrayInput(type as ArraySchemaType)\n  }\n\n  if (is.type('reference', type)) {\n    return StudioReferenceInput\n  }\n\n  // String input with a select\n  if (is.type('string', type)) {\n    return resolveStringInput(type as StringSchemaType)\n  }\n\n  if (is.type('number', type)) {\n    return resolveNumberInput(type as NumberSchemaType)\n  }\n\n  return undefined\n}\n\nexport function defaultResolveInputComponent(\n  schemaType: SchemaType,\n): ComponentType<Omit<InputProps, 'renderDefault'>> {\n  if (schemaType.components?.input) return schemaType.components.input\n\n  const componentFromTypeVariants = resolveComponentFromTypeVariants(schemaType)\n  if (componentFromTypeVariants) {\n    return componentFromTypeVariants\n  }\n\n  const typeChain = getTypeChain(schemaType, new Set())\n  const deduped = typeChain.reduce(\n    (acc, type) => {\n      acc[type.name] = type\n      return acc\n    },\n    {} as Record<string, SchemaType>,\n  )\n\n  // using an object + Object.values to de-dupe the type chain by type name\n  const subType = Object.values(deduped).find((t) => defaultInputs[t.name])\n\n  if (subType) {\n    return defaultInputs[subType.name]\n  }\n\n  throw new Error(`Could not find input component for schema type \\`${schemaType.name}\\``)\n}\n\nexport function defaultResolvePreviewComponent(\n  schemaType: SchemaType,\n): ComponentType<Omit<PreviewProps, 'renderDefault'>> {\n  if (schemaType.components?.preview) return schemaType.components.preview\n\n  return SanityDefaultPreview\n}\n","import {CopyIcon as DuplicateIcon, TrashIcon} from '@sanity/icons'\nimport {type SchemaType} from '@sanity/types'\nimport {Box, Card, type CardTone, Menu} from '@sanity/ui'\nimport {useCallback, useMemo, useRef} from 'react'\n\nimport {MenuButton, MenuItem} from '../../../../../../ui-components'\nimport {ChangeIndicator} from '../../../../../changeIndicators'\nimport {ContextMenuButton} from '../../../../../components/contextMenuButton'\nimport {LoadingBlock} from '../../../../../components/loadingBlock'\nimport {useTranslation} from '../../../../../i18n'\nimport {FieldPresence} from '../../../../../presence'\nimport {getSchemaTypeTitle} from '../../../../../schema'\nimport {FormFieldValidationStatus} from '../../../../components'\nimport {EditPortal} from '../../../../components/EditPortal'\nimport {useDidUpdate} from '../../../../hooks/useDidUpdate'\nimport {useScrollIntoViewOnFocusWithin} from '../../../../hooks/useScrollIntoViewOnFocusWithin'\nimport {useChildPresence} from '../../../../studio/contexts/Presence'\nimport {useChildValidation} from '../../../../studio/contexts/Validation'\nimport {type ObjectItem, type ObjectItemProps} from '../../../../types'\nimport {randomKey} from '../../../../utils/randomKey'\nimport {RowLayout} from '../../layouts/RowLayout'\nimport {createProtoArrayValue} from '../createProtoArrayValue'\nimport {InsertMenu} from '../InsertMenu'\n\ntype PreviewItemProps<Item extends ObjectItem> = Omit<ObjectItemProps<Item>, 'renderDefault'>\n\nfunction getTone({\n  readOnly,\n  hasErrors,\n  hasWarnings,\n}: {\n  readOnly: boolean | undefined\n  hasErrors: boolean\n  hasWarnings: boolean\n}): CardTone {\n  if (readOnly) {\n    return 'transparent'\n  }\n  if (hasErrors) {\n    return 'critical'\n  }\n  return hasWarnings ? 'caution' : 'default'\n}\nconst MENU_POPOVER_PROPS = {portal: true, tone: 'default'} as const\n\nconst BUTTON_CARD_STYLE = {position: 'relative'} as const\n\nexport function PreviewItem<Item extends ObjectItem = ObjectItem>(props: PreviewItemProps<Item>) {\n  const {\n    schemaType,\n    parentSchemaType,\n    path,\n    readOnly,\n    onRemove,\n    value,\n    open,\n    onInsert,\n    onFocus,\n    onOpen,\n    onClose,\n    changed,\n    focused,\n    children,\n    inputProps: {renderPreview},\n  } = props\n  const {t} = useTranslation()\n\n  const sortable = !readOnly && parentSchemaType.options?.sortable !== false\n  const insertableTypes = parentSchemaType.of\n\n  const previewCardRef = useRef<HTMLDivElement | null>(null)\n\n  // this is here to make sure the item is visible if it's being edited behind a modal\n  useScrollIntoViewOnFocusWithin(previewCardRef, open)\n\n  useDidUpdate(focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus && previewCardRef.current) {\n      // Note: if editing an inline item, focus is handled by the item input itself and no ref is being set\n      previewCardRef.current?.focus()\n    }\n  })\n\n  const resolvingInitialValue = (value as any)._resolvingInitialValue\n\n  const handleDuplicate = useCallback(() => {\n    onInsert({\n      items: [{...value, _key: randomKey()}],\n      position: 'after',\n    })\n  }, [onInsert, value])\n\n  const handleInsert = useCallback(\n    (pos: 'before' | 'after', insertType: SchemaType) => {\n      onInsert({\n        items: [createProtoArrayValue(insertType)],\n        position: pos,\n      })\n    },\n    [onInsert],\n  )\n\n  const childPresence = useChildPresence(path, true)\n  const presence = useMemo(() => {\n    return childPresence.length === 0 ? null : (\n      <FieldPresence presence={childPresence} maxAvatars={1} />\n    )\n  }, [childPresence])\n\n  const childValidation = useChildValidation(path, true)\n  const validation = useMemo(() => {\n    return childValidation.length === 0 ? null : (\n      <Box paddingX={1} paddingY={3}>\n        <FormFieldValidationStatus validation={childValidation} __unstable_showSummary />\n      </Box>\n    )\n  }, [childValidation])\n\n  const hasErrors = childValidation.some((v) => v.level === 'error')\n  const hasWarnings = childValidation.some((v) => v.level === 'warning')\n\n  const menu = useMemo(\n    () =>\n      readOnly ? null : (\n        <MenuButton\n          button={<ContextMenuButton paddingY={3} />}\n          id={`${props.inputId}-menuButton`}\n          menu={\n            <Menu>\n              <MenuItem\n                text={t('inputs.array.action.remove')}\n                tone=\"critical\"\n                icon={TrashIcon}\n                onClick={onRemove}\n              />\n              <MenuItem\n                text={t('inputs.array.action.duplicate')}\n                icon={DuplicateIcon}\n                onClick={handleDuplicate}\n              />\n              <InsertMenu types={insertableTypes} onInsert={handleInsert} />\n            </Menu>\n          }\n          popover={MENU_POPOVER_PROPS}\n        />\n      ),\n    [handleDuplicate, handleInsert, onRemove, insertableTypes, props.inputId, readOnly, t],\n  )\n\n  const tone = getTone({readOnly, hasErrors, hasWarnings})\n  const item = (\n    <RowLayout\n      menu={menu}\n      presence={presence}\n      validation={validation}\n      tone={tone}\n      focused={focused}\n      dragHandle={sortable}\n      selected={open}\n    >\n      <Card\n        as=\"button\"\n        type=\"button\"\n        tone=\"inherit\"\n        radius={1}\n        disabled={resolvingInitialValue}\n        onClick={onOpen}\n        ref={previewCardRef}\n        onFocus={onFocus}\n        __unstable_focusRing\n        style={BUTTON_CARD_STYLE}\n      >\n        {renderPreview({\n          schemaType: props.schemaType,\n          value: props.value,\n          layout: 'default',\n          // Don't do visibility check for virtualized items as the calculation will be incorrect causing it to scroll\n          skipVisibilityCheck: true,\n        })}\n\n        {resolvingInitialValue && <LoadingBlock fill />}\n      </Card>\n    </RowLayout>\n  )\n\n  const itemTypeTitle = getSchemaTypeTitle(schemaType)\n  return (\n    <>\n      <ChangeIndicator path={path} isChanged={changed} hasFocus={Boolean(focused)}>\n        <Box paddingX={1}>{item}</Box>\n      </ChangeIndicator>\n      {open && (\n        <EditPortal\n          header={\n            readOnly\n              ? t('inputs.array.action.view', {itemTypeTitle})\n              : t('inputs.array.action.edit', {itemTypeTitle})\n          }\n          type={parentSchemaType?.options?.modal?.type || 'dialog'}\n          width={parentSchemaType?.options?.modal?.width ?? 1}\n          id={value._key}\n          onClose={onClose}\n          autofocus={focused}\n          legacy_referenceElement={previewCardRef.current}\n        >\n          {children}\n        </EditPortal>\n      )}\n    </>\n  )\n}\n","import {type ReactNode} from 'react'\n\nimport {type ReferenceItemRef, ReferenceItemRefContext} from './useReferenceItemRef'\n\n/**\n * @internal\n */\ninterface ReferenceItemRefProviderProps extends ReferenceItemRef {\n  children: ReactNode\n}\n\n/**\n *\n * @internal\n */\nexport function ReferenceItemRefProvider(props: ReferenceItemRefProviderProps) {\n  const {menuRef, containerRef} = props\n\n  return (\n    <ReferenceItemRefContext.Provider value={{menuRef, containerRef}}>\n      {props.children}\n    </ReferenceItemRefContext.Provider>\n  )\n}\n","import {\n  CloseIcon,\n  CopyIcon as DuplicateIcon,\n  LaunchIcon as OpenInNewTabIcon,\n  SyncIcon as ReplaceIcon,\n  TrashIcon,\n} from '@sanity/icons'\nimport {type Reference, type ReferenceSchemaType, type SchemaType} from '@sanity/types'\nimport {Box, type CardTone, Menu, MenuDivider} from '@sanity/ui'\nimport {\n  type ComponentProps,\n  type ForwardedRef,\n  forwardRef,\n  useCallback,\n  useMemo,\n  useRef,\n} from 'react'\nimport {IntentLink} from 'sanity/router'\n\nimport {MenuButton, MenuItem} from '../../../../ui-components'\nimport {ChangeIndicator} from '../../../changeIndicators'\nimport {ContextMenuButton} from '../../../components/contextMenuButton'\nimport {LoadingBlock} from '../../../components/loadingBlock'\nimport {useTranslation} from '../../../i18n'\nimport {FieldPresence} from '../../../presence'\nimport {FormFieldSet, FormFieldValidationStatus} from '../../components/formField'\nimport {useDidUpdate} from '../../hooks/useDidUpdate'\nimport {useScrollIntoViewOnFocusWithin} from '../../hooks/useScrollIntoViewOnFocusWithin'\nimport {set, unset} from '../../patch'\nimport {type ObjectItem, type ObjectItemProps} from '../../types'\nimport {randomKey} from '../../utils/randomKey'\nimport {createProtoArrayValue} from '../arrays/ArrayOfObjectsInput/createProtoArrayValue'\nimport {InsertMenu} from '../arrays/ArrayOfObjectsInput/InsertMenu'\nimport {RowLayout} from '../arrays/layouts/RowLayout'\nimport {PreviewReferenceValue} from './PreviewReferenceValue'\nimport {ReferenceFinalizeAlertStrip} from './ReferenceFinalizeAlertStrip'\nimport {ReferenceItemRefProvider} from './ReferenceItemRefProvider'\nimport {ReferenceLinkCard} from './ReferenceLinkCard'\nimport {ReferenceMetadataLoadErrorAlertStrip} from './ReferenceMetadataLoadFailure'\nimport {ReferenceStrengthMismatchAlertStrip} from './ReferenceStrengthMismatchAlertStrip'\nimport {useReferenceInfo} from './useReferenceInfo'\nimport {useReferenceInput} from './useReferenceInput'\n\nexport interface ReferenceItemValue extends Omit<ObjectItem, '_type'>, Omit<Reference, '_key'> {}\n\ninterface ReferenceItemProps<Item extends ReferenceItemValue>\n  extends Omit<ObjectItemProps<ReferenceItemValue>, 'renderDefault'> {\n  value: Item\n  schemaType: ReferenceSchemaType\n}\n\nfunction getTone({\n  readOnly,\n  hasErrors,\n  hasWarnings,\n}: {\n  readOnly: boolean | undefined\n  hasErrors: boolean\n  hasWarnings: boolean\n}): CardTone {\n  if (readOnly) {\n    return 'transparent'\n  }\n  if (hasErrors) {\n    return 'critical'\n  }\n  return hasWarnings ? 'caution' : 'default'\n}\nconst MENU_POPOVER_PROPS = {portal: true, tone: 'default'} as const\n\nexport function ReferenceItem<Item extends ReferenceItemValue = ReferenceItemValue>(\n  props: ReferenceItemProps<Item>,\n) {\n  const {\n    schemaType,\n    parentSchemaType,\n    path,\n    readOnly,\n    onRemove,\n    value,\n    open,\n    onInsert,\n    presence,\n    validation,\n    inputId,\n    changed,\n    focused,\n    children,\n    inputProps: {onChange, focusPath, onPathFocus, renderPreview, elementProps},\n  } = props\n\n  const sortable = !readOnly && parentSchemaType.options?.sortable !== false\n  const insertableTypes = parentSchemaType.of\n\n  const elementRef = useRef<HTMLDivElement | null>(null)\n  const menuRef = useRef<HTMLDivElement | null>(null)\n  const containerRef = useRef<HTMLDivElement | null>(null)\n\n  const {EditReferenceLink, getReferenceInfo, selectedState, isCurrentDocumentLiveEdit} =\n    useReferenceInput({\n      path,\n      schemaType,\n      value,\n    })\n\n  // this is here to make sure the item is visible if it's being edited behind a modal\n  useScrollIntoViewOnFocusWithin(elementRef, open)\n\n  useDidUpdate(focused, (hadFocus, hasFocus) => {\n    if (!hadFocus && hasFocus && elementRef.current) {\n      // Note: if editing an inline item, focus is handled by the item input itself and no ref is being set\n      elementRef.current?.focus()\n    }\n  })\n\n  const hasErrors = props.validation.some((v) => v.level === 'error')\n  const hasWarnings = props.validation.some((v) => v.level === 'warning')\n  const resolvingInitialValue = (value as any)._resolvingInitialValue\n\n  const handleDuplicate = useCallback(() => {\n    onInsert({\n      items: [{...value, _key: randomKey()}],\n      position: 'after',\n    })\n  }, [onInsert, value])\n\n  const handleInsert = useCallback(\n    (pos: 'before' | 'after', insertType: SchemaType) => {\n      onInsert({\n        items: [{...createProtoArrayValue(insertType), _key: randomKey()}],\n        position: pos,\n      })\n    },\n    [onInsert],\n  )\n  const loadableReferenceInfo = useReferenceInfo(value?._ref, getReferenceInfo)\n\n  const hasRef = value._ref\n  const refTypeName = loadableReferenceInfo.result?.type || value?._strengthenOnPublish?.type\n  const publishedReferenceExists = hasRef && loadableReferenceInfo.result?.preview?.published?._id\n\n  const handleRemoveStrengthenOnPublish = useCallback(() => {\n    onChange([\n      schemaType.weak === true ? set(true, ['_weak']) : unset(['_weak']),\n      unset(['_strengthenOnPublish']),\n    ])\n  }, [onChange, schemaType.weak])\n\n  const refType = refTypeName\n    ? schemaType.to.find((toType) => toType.name === refTypeName)\n    : undefined\n  const pressed = selectedState === 'pressed'\n  const selected = selectedState === 'selected'\n\n  const tone = getTone({readOnly, hasErrors, hasWarnings})\n  const isEditing = !hasRef || focusPath[0] === '_ref'\n\n  const {t} = useTranslation()\n\n  const OpenLink = useMemo(\n    () =>\n      // eslint-disable-next-line @typescript-eslint/no-shadow\n      forwardRef(function OpenLink(\n        restProps: ComponentProps<typeof IntentLink>,\n        _ref: ForwardedRef<HTMLAnchorElement>,\n      ) {\n        return (\n          <IntentLink\n            {...restProps}\n            intent=\"edit\"\n            params={{id: value?._ref, type: refType?.name}}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            ref={_ref}\n          />\n        )\n      }),\n    [refType?.name, value?._ref],\n  )\n\n  const handleReplace = useCallback(() => {\n    if (hasRef && isEditing) {\n      onPathFocus([])\n    } else {\n      onPathFocus(['_ref'])\n    }\n  }, [hasRef, isEditing, onPathFocus])\n\n  const menu = useMemo(\n    () =>\n      readOnly ? null : (\n        <MenuButton\n          button={<ContextMenuButton paddingY={3} />}\n          id={`${inputId}-menuButton`}\n          menu={\n            <Menu ref={menuRef}>\n              {!readOnly && (\n                <>\n                  <MenuItem\n                    text={t('inputs.reference.action.remove')}\n                    tone=\"critical\"\n                    icon={TrashIcon}\n                    onClick={onRemove}\n                  />\n                  <MenuItem\n                    text={t(\n                      hasRef && isEditing\n                        ? 'inputs.reference.action.replace-cancel'\n                        : 'inputs.reference.action.replace',\n                    )}\n                    icon={hasRef && isEditing ? CloseIcon : ReplaceIcon}\n                    onClick={handleReplace}\n                  />\n                  <MenuItem\n                    text={t('inputs.reference.action.duplicate')}\n                    icon={DuplicateIcon}\n                    onClick={handleDuplicate}\n                  />\n                  <InsertMenu onInsert={handleInsert} types={insertableTypes} />\n                </>\n              )}\n\n              {!readOnly && !isEditing && hasRef && <MenuDivider />}\n              {!isEditing && hasRef && (\n                <MenuItem\n                  as={OpenLink}\n                  data-as=\"a\"\n                  text={t('inputs.reference.action.open-in-new-tab')}\n                  icon={OpenInNewTabIcon}\n                />\n              )}\n            </Menu>\n          }\n          popover={MENU_POPOVER_PROPS}\n        />\n      ),\n    [\n      handleDuplicate,\n      handleInsert,\n      handleReplace,\n      hasRef,\n      inputId,\n      insertableTypes,\n      isEditing,\n      onRemove,\n      OpenLink,\n      readOnly,\n      t,\n    ],\n  )\n\n  const handleFixStrengthMismatch = useCallback(() => {\n    onChange(schemaType.weak === true ? set(true, ['_weak']) : unset(['_weak']))\n  }, [onChange, schemaType])\n\n  const actualStrength = value?._weak ? 'weak' : 'strong'\n  const weakShouldBe = schemaType.weak === true ? 'weak' : 'strong'\n\n  // If the reference value is marked with _strengthenOnPublish,\n  // we allow weak references if the reference points to a document that has a draft but not a published\n  // In all other cases we should display a \"weak mismatch\" warning\n  const weakWarningOverride =\n    hasRef && !loadableReferenceInfo.isLoading && value?._strengthenOnPublish\n\n  const showWeakRefMismatch =\n    !loadableReferenceInfo.isLoading &&\n    loadableReferenceInfo.result?.availability.available &&\n    hasRef &&\n    actualStrength !== weakShouldBe &&\n    !weakWarningOverride\n\n  const issues = (\n    <>\n      {isCurrentDocumentLiveEdit && publishedReferenceExists && value._strengthenOnPublish && (\n        <ReferenceFinalizeAlertStrip\n          schemaType={schemaType}\n          handleRemoveStrengthenOnPublish={handleRemoveStrengthenOnPublish}\n        />\n      )}\n      {showWeakRefMismatch && (\n        <ReferenceStrengthMismatchAlertStrip\n          actualStrength={actualStrength}\n          handleFixStrengthMismatch={handleFixStrengthMismatch}\n        />\n      )}\n      {loadableReferenceInfo.error && (\n        <ReferenceMetadataLoadErrorAlertStrip\n          errorMessage={loadableReferenceInfo.error.message}\n          onHandleRetry={loadableReferenceInfo.retry!}\n        />\n      )}\n    </>\n  )\n\n  const item = (\n    <ReferenceItemRefProvider menuRef={menuRef} containerRef={containerRef}>\n      <RowLayout\n        dragHandle={sortable}\n        presence={\n          !isEditing && presence.length > 0 && <FieldPresence presence={presence} maxAvatars={1} />\n        }\n        validation={\n          !isEditing &&\n          validation.length > 0 && <FormFieldValidationStatus validation={validation} />\n        }\n        menu={menu}\n        footer={isEditing ? undefined : issues}\n        tone={isEditing ? undefined : tone}\n        focused={focused}\n      >\n        {isEditing ? (\n          <Box padding={1} ref={containerRef}>\n            <FormFieldSet\n              title={schemaType.title}\n              description={schemaType.description}\n              __unstable_presence={presence}\n              validation={validation}\n              inputId={inputId}\n              deprecated={schemaType.deprecated}\n            >\n              {children}\n            </FormFieldSet>\n          </Box>\n        ) : (\n          <ReferenceLinkCard\n            as={EditReferenceLink}\n            tone=\"inherit\"\n            radius={2}\n            documentId={value?._ref}\n            documentType={refType?.name}\n            disabled={resolvingInitialValue}\n            __unstable_focusRing\n            selected={selected}\n            pressed={pressed}\n            data-selected={selected ? true : undefined}\n            data-pressed={pressed ? true : undefined}\n            {...elementProps}\n          >\n            <PreviewReferenceValue\n              value={value}\n              referenceInfo={loadableReferenceInfo}\n              renderPreview={renderPreview}\n              type={schemaType}\n            />\n            {resolvingInitialValue && <LoadingBlock fill />}\n          </ReferenceLinkCard>\n        )}\n      </RowLayout>\n    </ReferenceItemRefProvider>\n  )\n  return (\n    <ChangeIndicator path={path} isChanged={changed} hasFocus={Boolean(focused)}>\n      <Box paddingX={1}>{item}</Box>\n    </ChangeIndicator>\n  )\n}\n","import {isReferenceSchemaType, type SchemaType} from '@sanity/types'\nimport {type ComponentType} from 'react'\n\nimport {type FIXME} from '../../../FIXME'\nimport {PreviewItem} from '../../inputs/arrays/ArrayOfObjectsInput/List/PreviewItem'\nimport {ReferenceItem} from '../../inputs/ReferenceInput/ReferenceItem'\nimport {type ItemProps} from '../../types'\n\nexport function defaultResolveItemComponent(\n  schemaType: SchemaType,\n): ComponentType<Omit<ItemProps, 'renderDefault'>> {\n  if (schemaType.components?.item) return schemaType.components.item\n\n  if (isReferenceSchemaType(schemaType)) {\n    return ReferenceItem as FIXME\n  }\n\n  return PreviewItem as FIXME\n}\n","import {type PreviewValue, type SchemaType, type SortOrdering} from '@sanity/types'\nimport {useMemoObservable} from 'react-rx'\nimport {of} from 'rxjs'\nimport {catchError, map} from 'rxjs/operators'\n\nimport {useDocumentPreviewStore} from '../store'\nimport {type Previewable} from './types'\n\nexport {useDocumentPreview as unstable_useValuePreview}\n\ninterface State {\n  isLoading: boolean\n  error?: Error\n  value?: PreviewValue\n}\nconst INITIAL_STATE: State = {\n  isLoading: true,\n}\nconst PENDING_STATE: State = {\n  isLoading: false,\n}\n/**\n * @internal\n * @deprecated FOR INTERNAL USE.\n */\nfunction useDocumentPreview(props: {\n  enabled?: boolean\n  ordering?: SortOrdering\n  schemaType?: SchemaType\n  value: unknown | undefined\n}): State {\n  const {enabled = true, ordering, schemaType, value: previewValue} = props || {}\n  const {observeForPreview} = useDocumentPreviewStore()\n  return useMemoObservable<State>(\n    () => {\n      if (!enabled || !previewValue || !schemaType) return of(PENDING_STATE)\n\n      return observeForPreview(previewValue as Previewable, schemaType, {ordering}).pipe(\n        map((event) => ({isLoading: false, value: event.snapshot || undefined})),\n        catchError((error) => of({isLoading: false, error})),\n      )\n    },\n    [enabled, observeForPreview, ordering, schemaType, previewValue],\n    INITIAL_STATE,\n  )\n}\n","import {EMPTY, fromEvent} from 'rxjs'\nimport {shareReplay} from 'rxjs/operators'\n\nexport const orientationChange$ =\n  typeof window === 'undefined'\n    ? EMPTY\n    : fromEvent(window, 'orientationchange').pipe(shareReplay(1))\n","import {EMPTY, fromEvent} from 'rxjs'\nimport {shareReplay} from 'rxjs/operators'\n\nexport const resize$ =\n  typeof window === 'undefined' ? EMPTY : fromEvent(window, 'resize').pipe(shareReplay(1))\n","import {EMPTY, fromEvent} from 'rxjs'\nimport {shareReplay} from 'rxjs/operators'\n\nexport const scroll$ =\n  typeof window === 'undefined'\n    ? EMPTY\n    : fromEvent(window, 'scroll', {passive: true, capture: true}).pipe(shareReplay(1))\n","import {merge, Observable, of as observableOf, Subject} from 'rxjs'\nimport {filter, map, mergeMap} from 'rxjs/operators'\n\nimport {orientationChange$} from './orientationChange'\nimport {resize$} from './resize'\nimport {scroll$} from './scroll'\n\nconst ROOT_MARGIN_PX = 150\n\n/*\n  Adapted from the polyfill at https://github.com/WICG/IntersectionObserver\n*/\nfunction isIntersectionObserverSupported() {\n  if (\n    typeof window !== 'undefined' &&\n    'IntersectionObserver' in window &&\n    'IntersectionObserverEntry' in window &&\n    'intersectionRatio' in IntersectionObserverEntry.prototype\n  ) {\n    // Minimal polyfill for Edge 15's lack of `isIntersecting`\n    // See: https://github.com/WICG/IntersectionObserver/issues/211\n    if (!('isIntersecting' in IntersectionObserverEntry.prototype)) {\n      Object.defineProperty(IntersectionObserverEntry.prototype, 'isIntersecting', {\n        get() {\n          return this.intersectionRatio > 0\n        },\n      })\n    }\n    return true\n  }\n  return false\n}\n\ntype IntersectionEvent = {isIntersecting: boolean}\n\nexport const intersectionObservableFor = isIntersectionObserverSupported()\n  ? createIntersectionObserverBased()\n  : createLegacyBased()\n\ntype IntersectionObservableFor = (element: Element) => Observable<IntersectionEvent>\n\nfunction createIntersectionObserverBased(): IntersectionObservableFor {\n  const intersectionObserverEntriesSubject = new Subject<IntersectionObserverEntry>()\n\n  const intersectionObserver = new IntersectionObserver(\n    (entries) => {\n      entries.forEach((entry) => {\n        intersectionObserverEntriesSubject.next(entry)\n      })\n    },\n    {\n      threshold: 0,\n      rootMargin: `${ROOT_MARGIN_PX}px`,\n    },\n  )\n\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  return function intersectionObservableFor(element) {\n    return new Observable((observer) => {\n      intersectionObserver.observe(element)\n      observer.next()\n      return () => intersectionObserver.unobserve(element)\n    }).pipe(\n      mergeMap(() => intersectionObserverEntriesSubject.asObservable()),\n      filter((entry: IntersectionObserverEntry) => entry.target === element),\n      map((ev) => ({\n        isIntersecting: ev.isIntersecting,\n      })),\n    )\n  }\n}\n\n// This can be removed when intersection observer are supported by the browsers we support\nfunction createLegacyBased() {\n  function getViewport() {\n    return {\n      left: 0,\n      right: window.innerWidth,\n      top: 0,\n      bottom: window.innerHeight,\n    }\n  }\n\n  function intersects(\n    rect: DOMRect,\n    viewport: {left: number; right: number; top: number; bottom: number},\n    margin: number,\n  ) {\n    return (\n      rect.left <= viewport.right + margin &&\n      rect.right >= viewport.left - margin &&\n      rect.top <= viewport.bottom + margin &&\n      rect.bottom >= viewport.top - margin\n    )\n  }\n\n  function inViewport(element: HTMLElement) {\n    return () => intersects(element.getBoundingClientRect(), getViewport(), ROOT_MARGIN_PX)\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  return function intersectionObservableFor(element: HTMLElement): Observable<IntersectionEvent> {\n    const isElementInViewport = inViewport(element)\n    return merge(observableOf(isElementInViewport()), resize$, scroll$, orientationChange$).pipe(\n      // @todo: consider \"faking\" more of the IntersectionObserverEntry api if possible\n      map(isElementInViewport),\n      map((isIntersecting) => ({isIntersecting})),\n    )\n  }\n}\n","import {EMPTY, fromEvent, type Observable} from 'rxjs'\nimport {shareReplay} from 'rxjs/operators'\n\nexport const visibilityChange$: Observable<Event> =\n  typeof window === 'undefined'\n    ? EMPTY\n    : fromEvent(document, 'visibilitychange').pipe(shareReplay(1))\n","import {useEffect, useState} from 'react'\nimport {concat, of} from 'rxjs'\nimport {delay, distinctUntilChanged, map, switchMap} from 'rxjs/operators'\n\nimport {intersectionObservableFor} from './streams/intersectionObservableFor'\nimport {visibilityChange$} from './streams/visibilityChange'\n\nexport function useVisibility(props: {element: HTMLElement | null; hideDelay?: number}): boolean {\n  const {element, hideDelay = 0} = props\n  const [visible, setVisible] = useState(false)\n\n  useEffect(() => {\n    if (!element) {\n      return undefined\n    }\n\n    const isDocumentVisible$ = concat(\n      of(!document.hidden),\n      visibilityChange$.pipe(\n        map((event) => (event.target instanceof Document ? !event?.target?.hidden : false)),\n      ),\n    ).pipe(distinctUntilChanged())\n\n    const inViewport$ = intersectionObservableFor(element).pipe(\n      map((event) => event.isIntersecting),\n    )\n\n    const visible$ = isDocumentVisible$.pipe(\n      switchMap((isDocumentVisible) => (isDocumentVisible ? inViewport$ : of(false))),\n      switchMap((isVisible) => (isVisible ? of(true) : of(false).pipe(delay(hideDelay)))),\n      distinctUntilChanged(),\n    )\n\n    const sub = visible$.subscribe(setVisible)\n\n    return () => sub.unsubscribe()\n  }, [element, hideDelay])\n\n  return visible\n}\n","export const _HIDE_DELAY = 1000 * 2 // 2 seconds\n","import {type UploadState} from '@sanity/types'\n\nimport {isRecord, isString} from '../../util'\n\nexport function _extractUploadState(value: any): UploadState | undefined {\n  return _resolveUploadValue(value?._upload)\n}\n\nfunction getStringOrUndefined(value: unknown): string | undefined {\n  return isString(value) ? value : undefined\n}\nfunction _resolveUploadValue(value: unknown): UploadState | undefined {\n  if (!isRecord(value)) return undefined\n\n  const progress = typeof value.progress === 'number' ? value.progress : 0\n  const createdAt = getStringOrUndefined(value.initiated || value.createdAt)\n  const updatedAt = getStringOrUndefined(value.updated || value.updatedAt)\n  const fileName = getStringOrUndefined((value?.file as any)?.name)\n  const fileType = getStringOrUndefined((value?.file as any)?.type)\n  const previewImage = getStringOrUndefined(value.previewImage)\n\n  if (createdAt && updatedAt && fileName && fileType) {\n    return {\n      progress,\n      createdAt,\n      updatedAt,\n      file: {name: fileName, type: fileType},\n      previewImage,\n    }\n  }\n\n  return undefined\n}\n","import {\n  type ComponentType,\n  createElement,\n  type CSSProperties,\n  type ReactElement,\n  useMemo,\n  useState,\n} from 'react'\n\nimport {type PreviewProps} from '../../components'\nimport {type RenderPreviewCallbackProps} from '../../form'\nimport {useTranslation} from '../../i18n'\nimport {unstable_useValuePreview as useValuePreview} from '../useValuePreview'\nimport {useVisibility} from '../useVisibility'\nimport {_HIDE_DELAY} from './_constants'\nimport {_extractUploadState} from './_extractUploadState'\n\n/**\n * This component is responsible for converting renderPreview() calls into an element.\n * It:\n * - subscribes to \"prepared\" preview value as long as the element is visible on screen\n * - resolves the configured preview component for the schema type\n * - prepares \"preview\"-props and passes this to the configured preview component\n * @internal\n * */\nexport function PreviewLoader(\n  props: RenderPreviewCallbackProps & {\n    component: ComponentType<Omit<PreviewProps, 'renderDefault'>>\n  },\n): ReactElement {\n  const {\n    layout,\n    value,\n    component,\n    style: styleProp,\n    schemaType,\n    skipVisibilityCheck,\n    ...restProps\n  } = props\n\n  const {t} = useTranslation()\n  const [element, setElement] = useState<HTMLDivElement | null>(null)\n\n  // Subscribe to visibility\n  const isVisible = useVisibility({\n    element: skipVisibilityCheck ? null : element,\n    hideDelay: _HIDE_DELAY,\n  })\n\n  // Subscribe document preview value\n  const preview = useValuePreview({\n    enabled: skipVisibilityCheck || isVisible,\n    schemaType,\n    value,\n  })\n\n  const style: CSSProperties = useMemo(\n    () => ({\n      ...styleProp,\n      minWidth: styleProp?.minWidth || 1,\n      minHeight: styleProp?.minHeight || 1,\n    }),\n    [styleProp],\n  )\n\n  const uploadState = useMemo(() => _extractUploadState(value), [value])\n\n  const media: PreviewProps['media'] = useMemo(() => {\n    if (uploadState?.previewImage) {\n      return (\n        <img\n          alt={t('preview.image.file-is-being-uploaded.alt-text')}\n          src={uploadState.previewImage}\n        />\n      )\n    }\n\n    if (!preview?.value?.media) {\n      return schemaType.icon\n    }\n\n    // @todo: fix `TS2769: No overload matches this call.`\n    return preview?.value?.media as any\n  }, [preview, schemaType, uploadState, t])\n\n  return (\n    <div ref={setElement} style={style}>\n      {createElement(component, {\n        ...restProps,\n        ...(preview?.value || {}),\n        media,\n        error: preview?.error,\n        isPlaceholder: preview?.isLoading,\n        layout,\n        schemaType,\n      })}\n    </div>\n  )\n}\n","import {hues} from '@sanity/color'\nimport {Box, Card, Flex, type Theme} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nexport const Root = styled(Card)((props: {theme: Theme}) => {\n  const {color, radius, space} = props.theme.sanity\n\n  const overlay = css`\n    pointer-events: none;\n    content: '';\n    position: absolute;\n    top: -${space[1]}px;\n    bottom: -${space[1]}px;\n    left: -${space[1]}px;\n    right: -${space[1]}px;\n    border-radius: ${radius[2]}px;\n    mix-blend-mode: ${color.dark ? 'screen' : 'multiply'};\n  `\n\n  return css`\n    box-shadow: 0 0 0 1px var(--card-border-color);\n    border-radius: ${radius[1]}px;\n    pointer-events: all;\n    position: relative;\n\n    &[data-focused] {\n      --card-border-color: var(--card-focus-ring-color);\n    }\n\n    &:not([data-focused]):not([data-selected]) {\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ${color.input.default.hovered.border};\n        }\n      }\n    }\n\n    &[data-markers] {\n      &:after {\n        ${overlay}\n        background-color: ${color.dark ? hues.purple[950].hex : hues.purple[50].hex};\n      }\n    }\n\n    &[data-warning] {\n      &:after {\n        ${overlay}\n        background-color: ${color.muted.caution.hovered.bg};\n      }\n\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ${color.muted.caution.hovered.border};\n        }\n      }\n    }\n\n    &[data-invalid] {\n      &:after {\n        ${overlay}\n        background-color: ${color.input.invalid.enabled.bg};\n      }\n\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ${color.input.invalid.hovered.border};\n        }\n      }\n    }\n  `\n})\n\nexport const PreviewContainer = styled(Box)`\n  display: block;\n  width: 100%;\n  user-select: none;\n  pointer-events: all;\n`\n\nexport const ChangeIndicatorWrapper = styled.div<{$hasChanges: boolean}>(\n  ({theme, $hasChanges}: {theme: Theme; $hasChanges: boolean}) => {\n    const {space} = theme.sanity\n\n    return css`\n      position: absolute;\n      width: ${space[2]}px;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      padding-left: ${space[1]}px;\n      user-select: none;\n\n      ${!$hasChanges &&\n      css`\n        display: none;\n      `}\n\n      [data-dragged] & {\n        visibility: hidden;\n      }\n    `\n  },\n)\n\nexport const InnerFlex = styled(Flex)`\n  position: relative;\n\n  [data-dragged] > & {\n    opacity: 0.5;\n  }\n`\n\nexport const BlockActionsOuter = styled(Box)`\n  width: 25px;\n  position: relative;\n\n  [data-dragged] & {\n    visibility: hidden;\n  }\n`\n\nexport const BlockActionsInner = styled(Flex)`\n  position: absolute;\n  right: 0;\n  [data-dragged] & {\n    visibility: hidden;\n  }\n`\n\nexport const TooltipBox = styled(Box)`\n  max-width: 250px;\n`\n","import {EditIcon, EllipsisHorizontalIcon, EyeOpenIcon, LinkIcon, TrashIcon} from '@sanity/icons'\nimport {isReference, type PortableTextBlock} from '@sanity/types'\nimport {Box, Flex, Menu, useGlobalKeyDown} from '@sanity/ui'\nimport {\n  forwardRef,\n  type MouseEvent,\n  type PropsWithChildren,\n  type ReactElement,\n  type Ref,\n  useCallback,\n  useEffect,\n  useId,\n  useMemo,\n  useRef,\n} from 'react'\nimport {IntentLink} from 'sanity/router'\n\nimport {Button, MenuButton, type MenuButtonProps, MenuItem} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\n\ninterface BlockObjectActionsMenuProps extends PropsWithChildren {\n  focused: boolean\n  isOpen?: boolean\n  onOpen: () => void\n  onRemove: () => void\n  readOnly?: boolean\n  value: PortableTextBlock\n}\n\nconst POPOVER_PROPS: MenuButtonProps['popover'] = {\n  constrainSize: true,\n  placement: 'bottom',\n  portal: 'default',\n  tone: 'default',\n}\n\nexport function BlockObjectActionsMenu(props: BlockObjectActionsMenuProps): ReactElement {\n  const {children, focused, isOpen, onOpen, onRemove, readOnly, value} = props\n  const {t} = useTranslation()\n  const menuButtonId = useId()\n  const menuButton = useRef<HTMLButtonElement | null>(null)\n  const isTabbing = useRef<boolean>(false)\n\n  const referenceLink = useMemo(\n    () =>\n      isReference(value)\n        ? forwardRef(function ReferenceLink(linkProps, ref: Ref<HTMLAnchorElement> | undefined) {\n            return <IntentLink {...linkProps} intent=\"edit\" params={{id: value._ref}} ref={ref} />\n          })\n        : undefined,\n    [value],\n  )\n\n  useEffect(() => {\n    if (isOpen) {\n      isTabbing.current = false\n    }\n  }, [isOpen])\n\n  // Go to menu when tabbed to\n  useGlobalKeyDown(\n    useCallback(\n      (event) => {\n        if (!focused) {\n          return\n        }\n        if (event.key === 'Tab') {\n          if (menuButton.current && !isTabbing.current && !isOpen) {\n            event.preventDefault()\n            event.stopPropagation()\n            menuButton.current.focus()\n            isTabbing.current = true\n          }\n        }\n      },\n      [focused, isOpen],\n    ),\n  )\n\n  const handleDelete = useCallback(\n    (event: MouseEvent<HTMLDivElement>) => {\n      event.preventDefault()\n      event.stopPropagation()\n      onRemove()\n    },\n    [onRemove],\n  )\n\n  return (\n    <Flex>\n      <Box flex={1}>{children}</Box>\n      <Box>\n        <MenuButton\n          button={\n            <Button\n              aria-label={t('inputs.portable-text.block.open-menu-aria-label')}\n              icon={EllipsisHorizontalIcon}\n              mode=\"bleed\"\n              paddingY={3}\n              tabIndex={focused ? 0 : 1}\n              tooltipProps={{content: 'Open menu'}}\n            />\n          }\n          ref={menuButton}\n          id={menuButtonId}\n          menu={\n            <Menu>\n              <>\n                {'_ref' in value && value._ref && (\n                  <MenuItem\n                    as={referenceLink}\n                    data-as=\"a\"\n                    icon={LinkIcon}\n                    text={t('inputs.portable-text.block.open-reference')}\n                  />\n                )}\n\n                {readOnly && (\n                  <MenuItem\n                    icon={EyeOpenIcon}\n                    onClick={onOpen}\n                    text={t('inputs.portable-text.block.view')}\n                  />\n                )}\n                {!readOnly && (\n                  <MenuItem\n                    icon={EditIcon}\n                    onClick={onOpen}\n                    text={t('inputs.portable-text.block.edit')}\n                  />\n                )}\n                {!readOnly && (\n                  <MenuItem\n                    icon={TrashIcon}\n                    onClick={handleDelete}\n                    text={t('inputs.portable-text.block.remove')}\n                    tone=\"critical\"\n                  />\n                )}\n              </>\n            </Menu>\n          }\n          popover={POPOVER_PROPS}\n        />\n      </Box>\n    </Flex>\n  )\n}\n","/* eslint-disable complexity */\nimport {\n  type EditorSelection,\n  PortableTextEditor,\n  usePortableTextEditor,\n} from '@sanity/portable-text-editor'\nimport {isImage, type ObjectSchemaType, type Path, type PortableTextBlock} from '@sanity/types'\nimport {Box, Flex, type ResponsivePaddingProps} from '@sanity/ui'\nimport {isEqual} from '@sanity/util/paths'\nimport {\n  type MouseEvent,\n  type PropsWithChildren,\n  type RefObject,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\n\nimport {Tooltip} from '../../../../../ui-components'\nimport {pathToString} from '../../../../field'\nimport {useTranslation} from '../../../../i18n'\nimport {EMPTY_ARRAY} from '../../../../util'\nimport {useFormCallbacks} from '../../../studio'\nimport {useChildPresence} from '../../../studio/contexts/Presence'\nimport {\n  type BlockProps,\n  type RenderAnnotationCallback,\n  type RenderArrayOfObjectsItemCallback,\n  type RenderBlockCallback,\n  type RenderCustomMarkers,\n  type RenderFieldCallback,\n  type RenderInputCallback,\n  type RenderPreviewCallback,\n} from '../../../types'\nimport {type RenderBlockActionsCallback} from '../../../types/_transitional'\nimport {useFormBuilder} from '../../../useFormBuilder'\nimport {ReviewChangesHighlightBlock, StyledChangeIndicatorWithProvidedFullPath} from '../_common'\nimport {BlockActions} from '../BlockActions'\nimport {debugRender} from '../debugRender'\nimport {useMemberValidation} from '../hooks/useMemberValidation'\nimport {usePortableTextMarkers} from '../hooks/usePortableTextMarkers'\nimport {usePortableTextMemberItem} from '../hooks/usePortableTextMembers'\nimport {\n  BlockActionsInner,\n  BlockActionsOuter,\n  ChangeIndicatorWrapper,\n  InnerFlex,\n  PreviewContainer,\n  Root,\n  TooltipBox,\n} from './BlockObject.styles'\nimport {BlockObjectActionsMenu} from './BlockObjectActionsMenu'\nimport {ObjectEditModal} from './modals/ObjectEditModal'\n\ninterface BlockObjectProps extends PropsWithChildren {\n  floatingBoundary: HTMLElement | null\n  focused: boolean\n  isActive?: boolean\n  isFullscreen?: boolean\n  onItemClose: () => void\n  onItemOpen: (path: Path) => void\n  onItemRemove: (itemKey: string) => void\n  onPathFocus: (path: Path) => void\n  path: Path\n  readOnly?: boolean\n  referenceBoundary: HTMLElement | null\n  relativePath: Path\n  renderAnnotation?: RenderAnnotationCallback\n  renderBlock?: RenderBlockCallback\n  renderBlockActions?: RenderBlockActionsCallback\n  renderCustomMarkers?: RenderCustomMarkers\n  renderField: RenderFieldCallback\n  renderInlineBlock?: RenderBlockCallback\n  renderInput: RenderInputCallback\n  renderItem: RenderArrayOfObjectsItemCallback\n  renderPreview: RenderPreviewCallback\n  schemaType: ObjectSchemaType\n  selected: boolean\n  value: PortableTextBlock\n}\n\nexport function BlockObject(props: BlockObjectProps) {\n  const {\n    floatingBoundary,\n    focused,\n    isFullscreen,\n    onItemClose,\n    onItemOpen,\n    onPathFocus,\n    path,\n    readOnly,\n    referenceBoundary,\n    relativePath,\n    renderAnnotation,\n    renderBlock,\n    renderBlockActions,\n    renderCustomMarkers,\n    renderField,\n    renderInlineBlock,\n    renderInput,\n    renderItem,\n    renderPreview,\n    schemaType,\n    selected,\n    value,\n  } = props\n  const {onChange} = useFormCallbacks()\n  const {Markers} = useFormBuilder().__internal.components\n  const [reviewChangesHovered, setReviewChangesHovered] = useState<boolean>(false)\n  const markers = usePortableTextMarkers(path)\n  const editor = usePortableTextEditor()\n  const memberItem = usePortableTextMemberItem(pathToString(path))\n  const isDeleting = useRef<boolean>(false)\n\n  const selfSelection = useMemo(\n    (): EditorSelection => ({\n      anchor: {path: relativePath, offset: 0},\n      focus: {path: relativePath, offset: 0},\n    }),\n    [relativePath],\n  )\n\n  const handleMouseOver = useCallback(() => setReviewChangesHovered(true), [])\n  const handleMouseOut = useCallback(() => setReviewChangesHovered(false), [])\n\n  const onOpen = useCallback(() => {\n    if (memberItem) {\n      // Take focus away from the editor so that it doesn't propagate a new focusPath and interfere here.\n      PortableTextEditor.blur(editor)\n      onItemOpen(memberItem.node.path)\n    }\n  }, [editor, memberItem, onItemOpen])\n\n  const onClose = useCallback(() => {\n    onItemClose()\n    PortableTextEditor.select(editor, selfSelection)\n    PortableTextEditor.focus(editor)\n  }, [onItemClose, editor, selfSelection])\n\n  const onRemove = useCallback(() => {\n    // Guard against clicking \"Delete\" multiple times.\n    if (isDeleting.current) {\n      return\n    }\n    try {\n      PortableTextEditor.delete(editor, selfSelection, {mode: 'blocks'})\n    } catch (err) {\n      console.error(err)\n    } finally {\n      isDeleting.current = true\n    }\n  }, [editor, selfSelection])\n\n  // Focus the editor if this object is removed because it was deleted.\n  // This is some special code needed for how the Menu for the block object\n  // is taking focus while clicking \"Delete\" from the menu.\n  useEffect(\n    () => () => {\n      if (isDeleting.current) {\n        PortableTextEditor.focus(editor)\n      }\n    },\n    [editor],\n  )\n\n  const innerPaddingProps: ResponsivePaddingProps = useMemo(() => {\n    if (isFullscreen && !renderBlockActions) {\n      return {paddingX: 5}\n    }\n\n    if (isFullscreen && renderBlockActions) {\n      return {paddingLeft: 5, paddingRight: 2}\n    }\n\n    if (renderBlockActions) {\n      return {\n        paddingLeft: 3,\n        paddingRight: 2,\n      }\n    }\n\n    return {paddingX: 3}\n  }, [isFullscreen, renderBlockActions])\n\n  const {validation, hasError, hasWarning, hasInfo} = useMemberValidation(memberItem?.node)\n  const parentSchemaType = editor.schemaTypes.portableText\n  const hasMarkers = Boolean(markers.length > 0)\n\n  const presence = useChildPresence(path, true)\n  const rootPresence = useMemo(\n    () => presence.filter((p) => isEqual(p.path, path)),\n    [path, presence],\n  )\n\n  // Tooltip indicating validation errors, warnings, info and markers\n  const tooltipEnabled = hasError || hasWarning || hasInfo || hasMarkers\n  const toolTipContent = useMemo(\n    () =>\n      (tooltipEnabled && (\n        <TooltipBox>\n          <Markers\n            markers={markers}\n            validation={validation}\n            renderCustomMarkers={renderCustomMarkers}\n          />\n        </TooltipBox>\n      )) ||\n      null,\n    [Markers, markers, renderCustomMarkers, tooltipEnabled, validation],\n  )\n\n  const isOpen = Boolean(memberItem?.member.open)\n  const input = memberItem?.input\n  const nodePath = memberItem?.node.path || EMPTY_ARRAY\n  const referenceElement = memberItem?.elementRef?.current\n\n  const componentProps: BlockProps = useMemo(\n    () => ({\n      __unstable_floatingBoundary: floatingBoundary,\n      __unstable_referenceBoundary: referenceBoundary,\n      __unstable_referenceElement: (referenceElement || null) as HTMLElement | null,\n      children: input,\n      focused,\n      markers,\n      onClose,\n      onOpen,\n      onPathFocus,\n      onRemove,\n      open: isOpen,\n      parentSchemaType,\n      path: nodePath,\n      presence: rootPresence,\n      readOnly: Boolean(readOnly),\n      renderAnnotation,\n      renderBlock,\n      renderDefault: DefaultBlockObjectComponent,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n      schemaType,\n      selected,\n      validation,\n      value,\n    }),\n    [\n      floatingBoundary,\n      referenceElement,\n      input,\n      focused,\n      markers,\n      onClose,\n      onOpen,\n      onPathFocus,\n      onRemove,\n      isOpen,\n      parentSchemaType,\n      nodePath,\n      rootPresence,\n      readOnly,\n      referenceBoundary,\n      renderAnnotation,\n      renderBlock,\n      renderField,\n      renderInlineBlock,\n      renderInput,\n      renderItem,\n      renderPreview,\n      schemaType,\n      selected,\n      validation,\n      value,\n    ],\n  )\n\n  return useMemo(\n    () => (\n      <Box\n        ref={memberItem?.elementRef as RefObject<HTMLDivElement> | undefined}\n        contentEditable={false}\n      >\n        <Flex paddingBottom={1} marginY={3} style={debugRender()}>\n          <InnerFlex flex={1}>\n            <Tooltip\n              placement=\"top\"\n              portal=\"editor\"\n              // If the object modal is open, disable the tooltip to avoid it rerendering the inner items when the validation changes.\n              disabled={isOpen ? true : !tooltipEnabled}\n              content={toolTipContent}\n            >\n              <PreviewContainer {...innerPaddingProps}>\n                {renderBlock && renderBlock(componentProps)}\n              </PreviewContainer>\n            </Tooltip>\n            <BlockActionsOuter marginRight={1}>\n              <BlockActionsInner>\n                {renderBlockActions && value && focused && !readOnly && (\n                  <BlockActions\n                    block={value}\n                    onChange={onChange}\n                    renderBlockActions={renderBlockActions}\n                  />\n                )}\n              </BlockActionsInner>\n            </BlockActionsOuter>\n\n            {isFullscreen && memberItem && (\n              <ChangeIndicatorWrapper\n                $hasChanges={memberItem.member.item.changed}\n                onMouseOut={handleMouseOut}\n                onMouseOver={handleMouseOver}\n              >\n                <StyledChangeIndicatorWithProvidedFullPath\n                  hasFocus={focused}\n                  isChanged={memberItem.member.item.changed}\n                  path={memberItem.member.item.path}\n                  withHoverEffect={false}\n                />\n              </ChangeIndicatorWrapper>\n            )}\n\n            {reviewChangesHovered && <ReviewChangesHighlightBlock />}\n          </InnerFlex>\n        </Flex>\n      </Box>\n    ),\n    [\n      componentProps,\n      focused,\n      handleMouseOut,\n      handleMouseOver,\n      innerPaddingProps,\n      isFullscreen,\n      memberItem,\n      onChange,\n      readOnly,\n      renderBlock,\n      renderBlockActions,\n      reviewChangesHovered,\n      toolTipContent,\n      tooltipEnabled,\n      value,\n      isOpen,\n    ],\n  )\n}\n\nexport const DefaultBlockObjectComponent = (props: BlockProps) => {\n  const {\n    __unstable_floatingBoundary,\n    __unstable_referenceBoundary,\n    __unstable_referenceElement,\n    children,\n    focused,\n    markers,\n    onClose,\n    onOpen,\n    onRemove,\n    open,\n    readOnly,\n    renderPreview,\n    schemaType,\n    selected,\n    value,\n    validation,\n  } = props\n\n  const {t} = useTranslation()\n  const isImagePreview = isImage(value)\n  const hasError = validation.filter((v) => v.level === 'error').length > 0\n  const hasWarning = validation.filter((v) => v.level === 'warning').length > 0\n  const hasMarkers = Boolean(markers.length > 0)\n  const tone = selected || focused ? 'primary' : 'default'\n\n  const handleDoubleClickToOpen = useCallback(\n    (e: MouseEvent<Element, globalThis.MouseEvent>) => {\n      e.preventDefault()\n      e.stopPropagation()\n      onOpen()\n    },\n    [onOpen],\n  )\n\n  return (\n    <>\n      <Root\n        aria-label={t('inputs.portable-text.block.aria-label')}\n        data-focused={focused ? '' : undefined}\n        data-image-preview={isImagePreview ? '' : undefined}\n        data-invalid={hasError ? '' : undefined}\n        data-markers={hasMarkers ? '' : undefined}\n        data-read-only={readOnly ? '' : undefined}\n        data-selected={selected ? '' : undefined}\n        data-testid=\"pte-block-object\"\n        data-warning={hasWarning ? '' : undefined}\n        flex={1}\n        onDoubleClick={handleDoubleClickToOpen}\n        padding={isImagePreview ? 0 : 1}\n        tone={tone}\n      >\n        {renderPreview({\n          actions: (\n            <BlockObjectActionsMenu\n              isOpen={open}\n              focused={focused}\n              onOpen={onOpen}\n              onRemove={onRemove}\n              readOnly={readOnly}\n              value={value}\n            />\n          ),\n          layout: isImagePreview ? 'blockImage' : 'block',\n          schemaType,\n          skipVisibilityCheck: true,\n          value,\n        })}\n      </Root>\n      {open && (\n        <ObjectEditModal\n          floatingBoundary={__unstable_floatingBoundary}\n          defaultType=\"dialog\"\n          onClose={onClose}\n          autoFocus={focused}\n          schemaType={schemaType}\n          referenceBoundary={__unstable_referenceBoundary}\n          referenceElement={__unstable_referenceElement}\n        >\n          {children}\n        </ObjectEditModal>\n      )}\n    </>\n  )\n}\n","import {type SchemaType} from '@sanity/types'\nimport {type ComponentType} from 'react'\n\nimport {type FIXME} from '../../../FIXME'\nimport {isBlockType} from '../../inputs/PortableText/_helpers'\nimport {DefaultAnnotationComponent} from '../../inputs/PortableText/object/Annotation'\nimport {DefaultBlockObjectComponent} from '../../inputs/PortableText/object/BlockObject'\nimport {DefaultInlineObjectComponent} from '../../inputs/PortableText/object/InlineObject'\nimport {DefaultComponent as DefaultBlockTextComponent} from '../../inputs/PortableText/text/TextBlock'\nimport {type BlockAnnotationProps, type BlockProps} from '../../types'\n\nexport function defaultResolveBlockComponent(\n  schemaType: SchemaType,\n): ComponentType<Omit<BlockProps, 'renderDefault'>> {\n  if (schemaType.components?.block) return schemaType.components.block\n  if (isBlockType(schemaType)) {\n    return DefaultBlockTextComponent as FIXME\n  }\n  return DefaultBlockObjectComponent as FIXME\n}\n\nexport function defaultResolveInlineBlockComponent(\n  schemaType: SchemaType,\n): ComponentType<Omit<BlockProps, 'renderDefault'>> {\n  if (schemaType.components?.inlineBlock) return schemaType.components.inlineBlock\n  return DefaultInlineObjectComponent as FIXME\n}\n\nexport function defaultResolveAnnotationComponent(\n  schemaType: SchemaType,\n): ComponentType<Omit<BlockAnnotationProps, 'renderDefault'>> {\n  if (schemaType.components?.annotation) return schemaType.components.annotation\n  return DefaultAnnotationComponent as FIXME\n}\n","import {type SchemaType} from '@sanity/types'\nimport {type ComponentType, createElement, type ReactElement, useCallback} from 'react'\n\nimport {type PreviewProps} from '../../components/previews'\nimport {\n  defaultResolveAnnotationComponent,\n  defaultResolveBlockComponent,\n  defaultResolveInlineBlockComponent,\n} from '../studio/inputResolver/blockResolver'\nimport {defaultResolveFieldComponent} from '../studio/inputResolver/fieldResolver'\nimport {\n  defaultResolveInputComponent,\n  defaultResolvePreviewComponent,\n} from '../studio/inputResolver/inputResolver'\nimport {defaultResolveItemComponent} from '../studio/inputResolver/itemResolver'\nimport {\n  type BlockAnnotationProps,\n  type BlockProps,\n  type FieldProps,\n  type InputProps,\n  type ItemProps,\n} from '../types'\n\nfunction useResolveDefaultComponent<T extends {schemaType?: SchemaType}>(props: {\n  componentProps: Omit<T, 'renderDefault'>\n  componentResolver: (schemaType: SchemaType) => ComponentType<Omit<T, 'renderDefault'>>\n}): ReactElement<T> {\n  const {componentResolver, componentProps} = props\n\n  // NOTE: this will not happen, but we do this to avoid updating too many places\n  // TODO: We need to clean up the preview machinery + types to remove this\n  if (!componentProps.schemaType) {\n    throw new Error('the `schemaType` property must be defined')\n  }\n\n  const defaultResolvedComponent = componentResolver(componentProps.schemaType)\n\n  const renderDefault = useCallback(\n    (parentTypeProps: T) => {\n      if (!parentTypeProps.schemaType?.type) {\n        // In theory this should not be possible, and this error should never be thrown\n        throw new Error('Attempted to render form component of non-existent parent type')\n      }\n\n      // The components property is removed from the schemaType object\n      // in order to prevent that a component is render itself\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const {components, ...restSchemaType} = parentTypeProps.schemaType\n      const parentTypeResolvedComponent = componentResolver(restSchemaType)\n      return createElement(parentTypeResolvedComponent, parentTypeProps)\n    },\n    [componentResolver],\n  )\n\n  return createElement(defaultResolvedComponent, {\n    ...componentProps,\n    renderDefault,\n  }) as ReactElement<T>\n}\n\n/**\n * @internal\n */\nexport function DefaultInput(props: Omit<InputProps, 'renderDefault'>): ReactElement {\n  return useResolveDefaultComponent<Omit<InputProps, 'renderDefault'>>({\n    componentProps: props,\n    componentResolver: defaultResolveInputComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function DefaultField(props: Omit<FieldProps, 'renderDefault'>): ReactElement {\n  return useResolveDefaultComponent<Omit<FieldProps, 'renderDefault'>>({\n    componentProps: props,\n    componentResolver: defaultResolveFieldComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function DefaultItem(props: Omit<ItemProps, 'renderDefault'>): ReactElement {\n  return useResolveDefaultComponent<Omit<ItemProps, 'renderDefault'>>({\n    componentProps: props,\n    componentResolver: defaultResolveItemComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function DefaultPreview(props: Omit<PreviewProps, 'renderDefault'>): ReactElement {\n  return useResolveDefaultComponent<PreviewProps>({\n    componentProps: props,\n    componentResolver: defaultResolvePreviewComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function DefaultBlock(props: Omit<BlockProps, 'renderDefault'>): ReactElement {\n  return useResolveDefaultComponent<Omit<BlockProps, 'renderDefault'>>({\n    componentProps: props,\n    componentResolver: defaultResolveBlockComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function DefaultInlineBlock(props: Omit<BlockProps, 'renderDefault'>): ReactElement {\n  return useResolveDefaultComponent<Omit<BlockProps, 'renderDefault'>>({\n    componentProps: props,\n    componentResolver: defaultResolveInlineBlockComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function DefaultAnnotation(\n  props: Omit<BlockAnnotationProps, 'renderDefault'>,\n): ReactElement {\n  return useResolveDefaultComponent<Omit<BlockAnnotationProps, 'renderDefault'>>({\n    componentProps: props,\n    componentResolver: defaultResolveAnnotationComponent,\n  })\n}\n","import {type ComponentType} from 'react'\n\nimport {type PreviewProps} from '../../components/previews'\nimport {type PluginOptions} from '../../config'\nimport {\n  type BlockAnnotationProps,\n  type BlockProps,\n  type FieldProps,\n  type InputProps,\n  type ItemProps,\n} from '../types'\n\nexport function pickInputComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<InputProps, 'renderDefault'>> {\n  return plugin.form?.components?.input as ComponentType<Omit<InputProps, 'renderDefault'>>\n}\n\nexport function pickFieldComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<FieldProps, 'renderDefault'>> {\n  return plugin.form?.components?.field as ComponentType<Omit<FieldProps, 'renderDefault'>>\n}\n\nexport function pickPreviewComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<PreviewProps, 'renderDefault'>> {\n  return plugin.form?.components?.preview as ComponentType<Omit<PreviewProps, 'renderDefault'>>\n}\n\nexport function pickItemComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<ItemProps, 'renderDefault'>> {\n  return plugin.form?.components?.item as ComponentType<Omit<ItemProps, 'renderDefault'>>\n}\n\nexport function pickBlockComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<BlockProps, 'renderDefault'>> {\n  return plugin.form?.components?.block as ComponentType<Omit<BlockProps, 'renderDefault'>>\n}\n\nexport function pickInlineBlockComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<BlockProps, 'renderDefault'>> {\n  return plugin.form?.components?.inlineBlock as ComponentType<Omit<BlockProps, 'renderDefault'>>\n}\n\nexport function pickAnnotationComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<BlockAnnotationProps, 'renderDefault'>> {\n  return plugin.form?.components?.annotation as ComponentType<\n    Omit<BlockAnnotationProps, 'renderDefault'>\n  >\n}\n","import {type ComponentType} from 'react'\n\nimport {type PreviewProps} from '../../components'\nimport {useMiddlewareComponents} from '../../config/components'\nimport {\n  type BlockAnnotationProps,\n  type BlockProps,\n  type FieldProps,\n  type InputProps,\n  type ItemProps,\n} from '../types'\nimport {\n  DefaultAnnotation,\n  DefaultBlock,\n  DefaultField,\n  DefaultInlineBlock,\n  DefaultInput,\n  DefaultItem,\n  DefaultPreview,\n} from './components'\nimport {\n  pickAnnotationComponent,\n  pickBlockComponent,\n  pickFieldComponent,\n  pickInlineBlockComponent,\n  pickInputComponent,\n  pickItemComponent,\n  pickPreviewComponent,\n} from './picks'\n\n/**\n * @internal\n */\nexport function useInputComponent(): ComponentType<Omit<InputProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: DefaultInput,\n    pick: pickInputComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function useFieldComponent(): ComponentType<Omit<FieldProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: DefaultField,\n    pick: pickFieldComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function usePreviewComponent(): ComponentType<Omit<PreviewProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: DefaultPreview,\n    pick: pickPreviewComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function useItemComponent(): ComponentType<Omit<ItemProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: DefaultItem,\n    pick: pickItemComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function useBlockComponent(): ComponentType<Omit<BlockProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: DefaultBlock,\n    pick: pickBlockComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function useInlineBlockComponent(): ComponentType<Omit<BlockProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: DefaultInlineBlock,\n    pick: pickInlineBlockComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function useAnnotationComponent(): ComponentType<\n  Omit<BlockAnnotationProps, 'renderDefault'>\n> {\n  return useMiddlewareComponents({\n    defaultComponent: DefaultAnnotation,\n    pick: pickAnnotationComponent,\n  })\n}\n","import {usePreviewComponent} from '../../form/form-components-hooks'\nimport {type RenderPreviewCallbackProps} from '../../form/types'\nimport {PreviewLoader} from '../index'\n\n/**\n * @internal\n */\nexport function Preview(props: RenderPreviewCallbackProps) {\n  const PreviewComponent = usePreviewComponent()\n  return <PreviewLoader {...props} component={PreviewComponent} />\n}\n","import {\n  BlockImagePreview,\n  BlockPreview,\n  CompactPreview,\n  DefaultPreview,\n  DetailPreview,\n  InlinePreview,\n  MediaPreview,\n} from '../../components'\n\nexport const _previewComponents = {\n  block: BlockPreview,\n  blockImage: BlockImagePreview,\n  compact: CompactPreview,\n  default: DefaultPreview,\n  detail: DetailPreview,\n  inline: InlinePreview,\n  media: MediaPreview,\n} as const\n","import {isImageSource} from '@sanity/asset-utils'\nimport {DocumentIcon} from '@sanity/icons'\nimport imageUrlBuilder from '@sanity/image-url'\nimport {type SanityImageSource} from '@sanity/image-url/lib/types/types'\nimport {type ImageUrlFitMode} from '@sanity/types'\nimport {\n  type ComponentType,\n  createElement,\n  type ElementType,\n  isValidElement,\n  type ReactElement,\n  type ReactNode,\n  useCallback,\n  useMemo,\n} from 'react'\nimport {isValidElementType} from 'react-is'\n\nimport {Tooltip} from '../../../ui-components'\nimport {type PreviewProps} from '../../components/previews'\nimport {useClient} from '../../hooks'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../studioClient'\nimport {isString} from '../../util'\nimport {_previewComponents} from './_previewComponents'\n\nfunction FallbackIcon() {\n  return <DocumentIcon className=\"sanity-studio__preview-fallback-icon\" />\n}\n\n/** @internal */\nexport interface SanityDefaultPreviewProps extends Omit<PreviewProps, 'renderDefault'> {\n  error?: Error | null\n  icon?: ElementType | false\n  tooltip?: ReactNode\n}\n\n/**\n * Used in cases where no custom preview component is provided\n * @internal\n * */\nexport function SanityDefaultPreview(props: SanityDefaultPreviewProps): ReactElement {\n  const {icon, layout, media: mediaProp, imageUrl, title, tooltip, ...restProps} = props\n\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const imageBuilder = useMemo(() => imageUrlBuilder(client), [client])\n\n  // NOTE: This function exists because the previews provides options\n  // for the rendering of the media (dimensions)\n  const renderMedia = useCallback(\n    (options: {\n      dimensions: {width?: number; height?: number; fit: ImageUrlFitMode; dpr?: number}\n    }) => {\n      const {dimensions} = options\n\n      // Handle sanity image\n      return (\n        <img\n          alt={isString(title) ? title : undefined}\n          referrerPolicy=\"strict-origin-when-cross-origin\"\n          src={\n            imageBuilder\n              .image(\n                mediaProp as SanityImageSource /*will only enter this code path if it's compatible*/,\n              )\n              .width(dimensions.width || 100)\n              .height(dimensions.height || 100)\n              .fit(dimensions.fit)\n              .dpr(dimensions.dpr || 1)\n              .url() || ''\n          }\n        />\n      )\n    },\n    [imageBuilder, mediaProp, title],\n  )\n\n  const renderIcon = useCallback(() => {\n    return createElement(icon || FallbackIcon)\n  }, [icon])\n\n  const media = useMemo(() => {\n    if (icon === false) {\n      // Explicitly disabled\n      return false\n    }\n\n    if (isValidElementType(mediaProp)) {\n      return mediaProp\n    }\n\n    if (isValidElement(mediaProp)) {\n      return mediaProp\n    }\n\n    if (isImageSource(mediaProp)) {\n      return renderMedia\n    }\n\n    // Handle image urls\n    if (isString(imageUrl)) {\n      return (\n        <img\n          src={imageUrl}\n          alt={isString(title) ? title : undefined}\n          referrerPolicy=\"strict-origin-when-cross-origin\"\n        />\n      )\n    }\n\n    // Render fallback icon\n    return renderIcon\n  }, [icon, imageUrl, mediaProp, renderIcon, renderMedia, title])\n\n  const previewProps: Omit<PreviewProps, 'renderDefault'> = useMemo(\n    () => ({\n      ...restProps,\n      // @todo: fix `TS2769: No overload matches this call.`\n      media: media as any,\n      title,\n    }),\n    [media, restProps, title],\n  )\n\n  const layoutComponent = _previewComponents[layout || 'default']\n\n  const children = createElement(\n    layoutComponent as ComponentType<Omit<PreviewProps, 'renderDefault'>>,\n    previewProps,\n  )\n\n  if (tooltip) {\n    return (\n      <Tooltip\n        content={tooltip}\n        disabled={!tooltip}\n        fallbackPlacements={['top-end']}\n        placement=\"bottom-end\"\n      >\n        {/* Currently tooltips won't trigger without a wrapping element */}\n        <div>{children}</div>\n      </Tooltip>\n    )\n  }\n\n  return children\n}\n","import {WarningOutlineIcon} from '@sanity/icons'\nimport {type PreviewValue} from '@sanity/types'\n\nexport const INCLUDE_FIELDS_QUERY = ['_id', '_rev', '_type']\nexport const INCLUDE_FIELDS = [...INCLUDE_FIELDS_QUERY, '_key']\n\nexport const AVAILABILITY_READABLE = {\n  available: true,\n  reason: 'READABLE',\n} as const\n\nexport const AVAILABILITY_PERMISSION_DENIED = {\n  available: false,\n  reason: 'PERMISSION_DENIED',\n} as const\n\nexport const AVAILABILITY_NOT_FOUND = {\n  available: false,\n  reason: 'NOT_FOUND',\n} as const\n\nexport const INVALID_PREVIEW_FALLBACK: PreviewValue = {\n  title: 'Invalid preview config',\n  subtitle: 'Check the error log in the console',\n  media: <WarningOutlineIcon />,\n}\n","import {Observable, type Subscriber} from 'rxjs'\n\nimport {isNonNullable} from '../../util'\n\ninterface QueueItem {\n  args: any[]\n  observer: Subscriber<any>\n  completed: boolean\n}\n\n// Takes an observable returning function and returns a debounced function that, when called\n// collects its passed arguments until wait time has passed without receiving new calls.\n// When wait period is over, calls the original function with the collected arguments\nexport function debounceCollect<Fn extends (...args: any[]) => Observable<any[]>>(\n  fn: Fn,\n  wait: number,\n): Fn extends (collectedArgs: [...infer TArgs][]) => Observable<(infer TReturnValue)[]>\n  ? (...args: TArgs) => Observable<TReturnValue>\n  : never\nexport function debounceCollect(fn: any, wait: number) {\n  let timer: ReturnType<typeof setTimeout>\n  let queue: Record<number | string, QueueItem | undefined> = {}\n  let idx = 0\n  return function debounced(...args: any[]) {\n    return new Observable((obs) => {\n      clearTimeout(timer)\n      timer = setTimeout(flush, wait)\n      const queueItem: QueueItem = {\n        args: args,\n        observer: obs,\n        completed: false,\n      }\n      const id = idx++\n      queue[id] = queueItem\n      return () => {\n        // console.log('completed', queueItem.args)\n        queueItem.completed = true\n      }\n    })\n  }\n\n  function flush() {\n    const currentlyFlushingQueue = queue\n    queue = {}\n\n    const queueItemIds = Object.keys(currentlyFlushingQueue) // Todo: use debug\n      // .map(id => {\n      //   if (currentlyFlushingQueue[id].completed) {\n      //     console.log('Dropped', currentlyFlushingQueue[id].args)\n      //   }\n      //   return id\n      // })\n      .filter((id) => {\n        const queueItem = currentlyFlushingQueue[id]\n\n        return queueItem && !queueItem.completed\n      })\n\n    if (queueItemIds.length === 0) {\n      // nothing to do\n      return\n    }\n    const collectedArgs = queueItemIds\n      .map((id) => {\n        const queueItem = currentlyFlushingQueue[id]\n\n        return queueItem && queueItem.args\n      })\n      .filter(isNonNullable)\n    fn(collectedArgs).subscribe({\n      next(results: any[]) {\n        results.forEach((result, i) => {\n          const queueItem = currentlyFlushingQueue[queueItemIds[i]]\n          if (queueItem && !queueItem.completed) {\n            queueItem.observer.next(results[i])\n          }\n        })\n      },\n      complete() {\n        queueItemIds.forEach((id) => {\n          const entry = currentlyFlushingQueue[id]\n          if (entry && !entry.completed) {\n            entry.observer.complete()\n          }\n        })\n      },\n      error(err: Error) {\n        queueItemIds.forEach((id) => {\n          const entry = currentlyFlushingQueue[id]\n          if (entry && !entry.completed) {\n            entry.observer.error(err)\n          }\n        })\n      },\n    })\n  }\n}\n","/* eslint-disable max-nested-callbacks */\n\nimport {type SanityClient} from '@sanity/client'\nimport {flatten, keyBy} from 'lodash'\nimport {combineLatest, defer, from, type Observable, of} from 'rxjs'\nimport {distinctUntilChanged, map, mergeMap, reduce, switchMap} from 'rxjs/operators'\nimport shallowEquals from 'shallow-equals'\n\nimport {getDraftId, getPublishedId, isRecord} from '../util'\nimport {\n  AVAILABILITY_NOT_FOUND,\n  AVAILABILITY_PERMISSION_DENIED,\n  AVAILABILITY_READABLE,\n} from './constants'\nimport {\n  type AvailabilityResponse,\n  type DocumentAvailability,\n  type DraftsModelDocumentAvailability,\n  type ObservePathsFn,\n} from './types'\nimport {debounceCollect} from './utils/debounceCollect'\n\nconst MAX_DOCUMENT_ID_CHUNK_SIZE = 11164\n\n/**\n * Takes an array of document IDs and puts them into individual chunks.\n * Because document IDs can vary greatly in size, we want to chunk by the length of the\n * combined comma-separated ID set. We try to stay within 11164 bytes - this is about the\n * same length the Sanity client uses for max query size, and accounts for rather large\n * headers to be present - so this _should_ be safe.\n *\n * @param documentIds - Unique document IDs to chunk\n * @returns Array of document ID chunks\n */\nfunction chunkDocumentIds(documentIds: string[]): string[][] {\n  let chunk: string[] = []\n  let chunkSize = 0\n\n  const chunks: string[][] = []\n\n  for (const documentId of documentIds) {\n    // Reached the max length? start a new chunk\n    if (chunkSize + documentId.length + 1 >= MAX_DOCUMENT_ID_CHUNK_SIZE) {\n      chunks.push(chunk)\n      chunk = []\n      chunkSize = 0\n    }\n\n    chunkSize += documentId.length + 1 // +1 is to account for a comma between IDs\n    chunk.push(documentId)\n  }\n\n  if (!chunks.includes(chunk)) {\n    chunks.push(chunk)\n  }\n\n  return chunks\n}\n\n/**\n * Mutative concat\n * @param array - the array to concat to\n * @param chunks - the items to concat to the array\n */\nfunction mutConcat<T>(array: T[], chunks: T[]) {\n  array.push(...chunks)\n  return array\n}\n\nexport function create_preview_availability(\n  versionedClient: SanityClient,\n  observePaths: ObservePathsFn,\n): {\n  observeDocumentPairAvailability(id: string): Observable<DraftsModelDocumentAvailability>\n} {\n  /**\n   * Returns an observable of metadata for a given drafts model document\n   */\n  function observeDocumentPairAvailability(\n    id: string,\n  ): Observable<DraftsModelDocumentAvailability> {\n    const draftId = getDraftId(id)\n    const publishedId = getPublishedId(id)\n    return combineLatest([\n      observeDocumentAvailability(draftId),\n      observeDocumentAvailability(publishedId),\n    ]).pipe(\n      distinctUntilChanged(shallowEquals),\n      map(([draftReadability, publishedReadability]) => {\n        return {\n          draft: draftReadability,\n          published: publishedReadability,\n        }\n      }),\n    )\n  }\n\n  /**\n   * Observable of metadata for the document with the given id\n   * If we can't read a document it is either because it's not readable or because it doesn't exist\n   *\n   * @internal\n   */\n  function observeDocumentAvailability(id: string): Observable<DocumentAvailability> {\n    // check for existence\n    return observePaths({_ref: id}, [['_rev']]).pipe(\n      map((res) => isRecord(res) && Boolean('_rev' in res && res?._rev)),\n      distinctUntilChanged(),\n      switchMap((hasRev) => {\n        return hasRev\n          ? // short circuit: if we can read the _rev field we know it both exists and is readable\n            of(AVAILABILITY_READABLE)\n          : // we can't read the _rev field for two possible reasons: 1) the document isn't readable or 2) the document doesn't exist\n            fetchDocumentReadability(id)\n      }),\n    )\n  }\n\n  const fetchDocumentReadability = debounceCollect(function fetchDocumentReadability(\n    args: string[][],\n  ): Observable<DocumentAvailability[]> {\n    const uniqueIds = [...new Set(flatten(args))]\n    return from(chunkDocumentIds(uniqueIds)).pipe(\n      mergeMap(fetchDocumentReadabilityChunked, 10),\n      reduce<DocumentAvailability[], DocumentAvailability[]>(mutConcat, []),\n      map((res) => args.map(([id]) => res[uniqueIds.indexOf(id)])),\n    )\n  }, 1)\n\n  function fetchDocumentReadabilityChunked(ids: string[]): Observable<DocumentAvailability[]> {\n    return defer(() => {\n      const requestOptions = {\n        uri: versionedClient.getDataUrl('doc', ids.join(',')),\n        json: true,\n        query: {excludeContent: 'true'},\n        tag: 'preview.documents-availability',\n      }\n      return versionedClient.observable.request<AvailabilityResponse>(requestOptions).pipe(\n        map((response) => {\n          const omitted = keyBy(response.omitted || [], (entry) => entry.id)\n          return ids.map((id) => {\n            const omittedEntry = omitted[id]\n            if (!omittedEntry) {\n              // it's not omitted, so it exists and is readable\n              return AVAILABILITY_READABLE\n            }\n            if (omittedEntry.reason === 'existence') {\n              return AVAILABILITY_NOT_FOUND\n            }\n            if (omittedEntry.reason === 'permission') {\n              // it's not omitted, so it exists and is readable\n              return AVAILABILITY_PERMISSION_DENIED\n            }\n            throw new Error(`Unexpected reason for omission: \"${omittedEntry.reason}\"`)\n          })\n        }),\n      )\n    })\n  }\n\n  return {observeDocumentPairAvailability}\n}\n","export function keysOf<T extends object>(value: T) {\n  return Object.keys(value) as (keyof T)[]\n}\n","import {\n  combineLatest,\n  from as observableFrom,\n  isObservable,\n  Observable,\n  of as observableOf,\n} from 'rxjs'\nimport {map, mergeAll, scan, switchMap} from 'rxjs/operators'\n\nimport {keysOf} from './keysOf'\n\nfunction setKey(source: Record<string, unknown>, key: any, value: unknown) {\n  return {\n    ...source,\n    [key]: value,\n  }\n}\n\ntype Props<K extends keyof any, T> = {\n  [P in K]: T | Observable<T>\n}\n\nexport function props<K extends keyof any, T>(options: {wait?: boolean} = {}) {\n  return (source: Observable<Props<K, T>>) => {\n    return new Observable<Props<K, T>>((observer) => source.subscribe(observer)).pipe(\n      switchMap((object) => {\n        const keyObservables = keysOf(object).map((key) => {\n          const value = object[key]\n          return isObservable(value)\n            ? observableFrom(value).pipe(map((val) => [key, val]))\n            : observableOf([key, value])\n        })\n\n        return options.wait\n          ? combineLatest(keyObservables).pipe(\n              map((pairs) => pairs.reduce((acc, [key, value]) => setKey(acc, key, value), {})),\n            )\n          : observableFrom(keyObservables).pipe(\n              mergeAll(),\n              scan((acc, [key, value]) => setKey(acc, key, value), {}),\n            )\n      }),\n    )\n  }\n}\n","import {isCrossDatasetReference, isReference} from '@sanity/types'\nimport {uniq} from 'lodash'\nimport {type Observable, of as observableOf} from 'rxjs'\nimport {switchMap} from 'rxjs/operators'\n\nimport {isRecord} from '../util'\nimport {type ApiConfig, type FieldName, type Previewable, type PreviewPath} from './types'\nimport {props} from './utils/props'\n\nfunction createEmpty(fields: FieldName[]) {\n  return fields.reduce((result: Record<string, undefined>, field) => {\n    result[field] = undefined\n    return result\n  }, {})\n}\n\nfunction resolveMissingHeads(value: Record<string, unknown>, paths: string[][]) {\n  return paths.filter((path) => !(path[0] in value))\n}\n\nfunction getDocumentId(value: Previewable) {\n  if (isReference(value)) {\n    return value._ref\n  }\n  return '_id' in value ? value._id : undefined\n}\n\ntype ObserveFieldsFn = (\n  id: string,\n  fields: FieldName[],\n  apiConfig?: ApiConfig,\n) => Observable<Record<string, unknown> | null>\n\nfunction observePaths(\n  value: Previewable,\n  paths: PreviewPath[],\n  observeFields: ObserveFieldsFn,\n  apiConfig?: ApiConfig,\n): Observable<Record<string, unknown> | null> {\n  if (!value || typeof value !== 'object') {\n    // Reached a leaf. Return as is\n    return observableOf(value as null) // @todo\n  }\n\n  const id = getDocumentId(value)\n\n  const currentValue: Record<string, unknown> = id ? {...value, _id: id} : {...value}\n\n  if (currentValue._type === 'reference') {\n    delete currentValue._type\n    delete currentValue._ref\n    delete currentValue._weak\n    delete currentValue._dataset\n    delete currentValue._projectId\n    delete currentValue._strengthenOnPublish\n  }\n\n  const pathsWithMissingHeads = resolveMissingHeads(currentValue, paths)\n\n  if (id && pathsWithMissingHeads.length > 0) {\n    // Reached a node that is either a document (with _id), or a reference (with _ref) that\n    // needs to be \"materialized\"\n\n    const nextHeads: string[] = uniq(pathsWithMissingHeads.map((path: string[]) => path[0]))\n\n    const refApiConfig = isCrossDatasetReference(value)\n      ? {projectId: value._projectId, dataset: value._dataset}\n      : apiConfig\n\n    return observeFields(id, nextHeads, refApiConfig).pipe(\n      switchMap((snapshot) => {\n        if (snapshot === null) {\n          return observableOf(null)\n        }\n\n        return observePaths(\n          {\n            ...createEmpty(nextHeads),\n            ...(isReference(value) ? {...value, ...refApiConfig} : value),\n            ...snapshot,\n          } as Previewable,\n          paths,\n          observeFields,\n          refApiConfig,\n        )\n      }),\n    )\n  }\n\n  // We have all the fields needed already present on value\n  const leads: Record<string, string[][]> = {}\n  paths.forEach((path) => {\n    const [head, ...tail] = path\n    if (!leads[head]) {\n      leads[head] = []\n    }\n    leads[head].push(tail)\n  })\n\n  const next = Object.keys(leads).reduce((res: Record<string, unknown>, head) => {\n    const tails = leads[head].filter((tail) => tail.length > 0)\n    if (tails.length === 0) {\n      res[head] = isRecord(value) ? (value as Record<string, unknown>)[head] : undefined\n    } else {\n      res[head] = observePaths((value as any)[head], tails, observeFields, apiConfig)\n    }\n    return res\n  }, currentValue)\n\n  return observableOf(next).pipe(props({wait: true}))\n}\n\n// Normalizes path arguments so it supports both dot-paths and array paths, e.g.\n// - ['propA.propB', 'propA.propC']\n// - [['propA', 'propB'], ['propA', 'propC']]\nfunction normalizePaths(path: (FieldName | PreviewPath)[]): PreviewPath[] {\n  return path.map((segment: FieldName | PreviewPath) =>\n    typeof segment === 'string' ? segment.split('.') : segment,\n  )\n}\n\nexport function createPathObserver(context: {observeFields: ObserveFieldsFn}) {\n  const {observeFields} = context\n\n  return {\n    observePaths(\n      value: Previewable,\n      paths: (FieldName | PreviewPath)[],\n      apiConfig?: ApiConfig,\n    ): Observable<Record<string, unknown> | null> {\n      return observePaths(value, normalizePaths(paths), observeFields, apiConfig)\n    },\n  }\n}\n","import {type SchemaType} from '@sanity/types'\n\nimport {type PreviewPath} from '../types'\n\nconst DEFAULT_PREVIEW_PATHS: PreviewPath[] = [['_createdAt'], ['_updatedAt']]\n\n/** @internal */\nexport function getPreviewPaths(preview: SchemaType['preview']): PreviewPath[] | undefined {\n  const selection = preview?.select\n\n  if (!selection) return undefined\n\n  // Transform the selection dot-notation paths into array paths.\n  // Example: ['object.title', 'name'] => [['object', 'title'], ['name']]\n  const paths = Object.values(selection).map((value) => String(value).split('.')) || []\n\n  // Return the paths with the default preview paths appended.\n  return paths.concat(DEFAULT_PREVIEW_PATHS)\n}\n","import {isPortableTextSpan, isPortableTextTextBlock, type PortableTextBlock} from '@sanity/types'\n\nexport function isPortableTextPreviewValue(value: unknown): value is PortableTextBlock[] {\n  return Array.isArray(value) && (value.length === 0 || value.some(isPortableTextTextBlock))\n}\n\nexport function extractTextFromBlocks(blocks: unknown): string {\n  const firstBlock = Array.isArray(blocks) && blocks.find(isPortableTextTextBlock)\n  if (!firstBlock || !firstBlock.children) {\n    return ''\n  }\n\n  return firstBlock.children\n    .filter(isPortableTextSpan)\n    .map((span) => span.text)\n    .join('')\n}\n","import {\n  isTitledListValue,\n  type PrepareViewOptions,\n  type PreviewValue,\n  type SchemaType,\n  type TitledListValue,\n} from '@sanity/types'\nimport {debounce, flatten, get, isPlainObject, pick, uniqBy} from 'lodash'\n\nimport {isRecord} from '../../util'\nimport {INVALID_PREVIEW_FALLBACK} from '../constants'\nimport {type PreviewableType} from '../types'\nimport {keysOf} from './keysOf'\nimport {extractTextFromBlocks, isPortableTextPreviewValue} from './portableText'\n\nconst PRESERVE_KEYS = ['_id', '_type', '_upload', '_createdAt', '_updatedAt']\nconst EMPTY: never[] = []\n\ntype SelectedValue = Record<string, unknown>\n\nexport type PrepareInvocationResult = {\n  selectedValue?: SelectedValue\n  returnValue: null | PreviewValue\n  errors: Error[]\n}\n\nconst errorCollector = (() => {\n  let errorsByType: Record<string, {error: Error; type: SchemaType; value: SelectedValue}[]> = {}\n\n  return {\n    add: (type: SchemaType, value: SelectedValue, error: Error) => {\n      if (!errorsByType[type.name]) {\n        errorsByType[type.name] = []\n      }\n      errorsByType[type.name].push({error: error, type: type, value})\n    },\n    getAll() {\n      return errorsByType\n    },\n    clear() {\n      errorsByType = {}\n    },\n  }\n})()\n\nconst reportErrors = debounce(() => {\n  /* eslint-disable no-console */\n  const errorsByType = errorCollector.getAll()\n  const uniqueErrors = flatten(\n    Object.keys(errorsByType).map((typeName) => {\n      const entries = errorsByType[typeName]\n      return uniqBy(entries, (entry) => entry.error.message)\n    }),\n  )\n  const errorCount = uniqueErrors.length\n  if (errorCount === 0) {\n    return\n  }\n\n  console.groupCollapsed(\n    `%cHeads up! Got ${\n      errorCount === 1 ? 'error' : `${errorCount} errors`\n    } while preparing data for preview. Click for details.`,\n    'color: #ff7e7c',\n  )\n\n  Object.keys(errorsByType).forEach((typeName) => {\n    const entries = errorsByType[typeName]\n    const first = entries[0]\n    console.group(`Check the preview config for schema type \"${typeName}\": %o`, first.type.preview)\n    const uniqued = uniqBy(entries, (entry) => entry.error.message)\n    uniqued.forEach((entry) => {\n      if ((entry.error as any).type === 'returnValueError') {\n        const hasPrepare = typeof entry.type.preview?.prepare === 'function'\n        const {value, error} = entry\n        console.log(\n          `Encountered an invalid ${\n            hasPrepare\n              ? 'return value when calling prepare(%o)'\n              : 'value targeted by preview.select'\n          }:`,\n          value,\n        )\n        console.error(error)\n      }\n      if ((entry.error as any).type === 'prepareError') {\n        const {value, error} = entry\n        console.log('Encountered an error when calling prepare(%o):', value)\n        console.error(error)\n      }\n    })\n    console.groupEnd()\n  })\n  console.groupEnd()\n  errorCollector.clear()\n  /* eslint-enable no-console */\n}, 1000)\n\nconst isRenderable =\n  (fieldName: string) =>\n  (value: unknown): Error[] => {\n    const type = typeof value\n    if (\n      value === null ||\n      type === 'undefined' ||\n      type === 'string' ||\n      type === 'number' ||\n      type === 'boolean'\n    ) {\n      return EMPTY\n    }\n    return [\n      assignType(\n        'returnValueError',\n        new Error(\n          `The \"${fieldName}\" field should be a string, number, boolean, undefined or null, instead saw ${inspect(\n            value,\n          )}`,\n        ),\n      ),\n    ]\n  }\nconst FIELD_NAME_VALIDATORS: Record<string, (value: unknown) => Error[]> = {\n  media: () => {\n    // not sure how to validate media as it would  possibly involve executing a function and check the\n    // return value\n    return EMPTY\n  },\n  title: isRenderable('title'),\n  subtitle: isRenderable('subtitle'),\n  description: isRenderable('description'),\n  imageUrl: isRenderable('imageUrl'),\n  date: isRenderable('date'),\n}\n\nfunction inspect(val: unknown, prefixType = true): string {\n  if (isRecord(val)) {\n    const keys = Object.keys(val)\n    const ellipse = keys.length > 3 ? '...' : ''\n    const prefix = `object with keys `\n    return `${prefixType ? prefix : ''}{${keys.slice(0, 3).join(', ')}${ellipse}}`\n  }\n  if (Array.isArray(val)) {\n    const ellipse = val.length > 3 ? '...' : ''\n    const prefix = `array with `\n    return `${prefixType ? prefix : ''}[${val.map((v) => inspect(v, false))}${ellipse}]`\n  }\n  return `the ${typeof val} ${val}`\n}\n\nfunction validateFieldValue(fieldName: string, fieldValue: unknown) {\n  if (typeof fieldValue === 'undefined') {\n    return EMPTY\n  }\n  const validator = FIELD_NAME_VALIDATORS[fieldName]\n  return (validator && validator(fieldValue)) || EMPTY\n}\n\nfunction assignType(type: string, error: Error) {\n  return Object.assign(error, {type})\n}\n\nfunction validatePreparedValue(preparedValue: PreviewValue | null) {\n  if (!isPlainObject(preparedValue) || preparedValue === null) {\n    return [\n      assignType(\n        'returnValueError',\n        new Error(\n          `Invalid return value. Expected a plain object with at least a 'title' field, instead saw ${inspect(\n            preparedValue,\n          )}`,\n        ),\n      ),\n    ]\n  }\n\n  return Object.entries(preparedValue).reduce<Error[]>((acc, [fieldName, fieldValue]) => {\n    return [...acc, ...validateFieldValue(fieldName, fieldValue)]\n  }, EMPTY)\n}\n\nfunction validateReturnedPreview(result: PrepareInvocationResult) {\n  return {\n    ...result,\n    errors: [...(result.errors || []), ...validatePreparedValue(result.returnValue)],\n  }\n}\n\nfunction defaultPrepare(value: SelectedValue) {\n  return keysOf(value).reduce((acc: SelectedValue, fieldName: keyof SelectedValue) => {\n    const val = value[fieldName]\n    return {\n      ...acc,\n      [fieldName]: isPortableTextPreviewValue(val) ? extractTextFromBlocks(val) : val,\n    }\n  }, {})\n}\n\nexport function invokePrepare(\n  type: PreviewableType,\n  value: SelectedValue,\n  viewOptions: PrepareViewOptions = {},\n): PrepareInvocationResult {\n  const prepare = type.preview?.prepare\n  try {\n    return {\n      returnValue: prepare\n        ? (prepare(value, viewOptions) as Record<string, unknown>)\n        : defaultPrepare(value),\n      errors: EMPTY,\n    }\n  } catch (error) {\n    return {\n      returnValue: null,\n      errors: [assignType('prepareError', error)],\n    }\n  }\n}\n\nfunction withErrors(\n  result: {errors: Error[]},\n  type: SchemaType,\n  selectedValue: SelectedValue,\n): PreviewValue {\n  result.errors.forEach((error) => errorCollector.add(type, selectedValue, error))\n  reportErrors()\n\n  return INVALID_PREVIEW_FALLBACK\n}\n\ninterface EnumListOptions {\n  list: TitledListValue[] | unknown[]\n}\n\nfunction hasEnumListOptions(\n  type: SchemaType,\n): type is SchemaType & {options: SchemaType['options'] & EnumListOptions} {\n  const options = type.options && typeof type.options === 'object' ? type.options : false\n  if (!options || !('list' in options)) {\n    return false\n  }\n\n  const listOptions = (options as EnumListOptions).list\n  return Array.isArray(listOptions)\n}\n\nfunction getListOptions(type: SchemaType): TitledListValue[] | undefined {\n  if (!hasEnumListOptions(type)) {\n    return undefined\n  }\n\n  const listOptions = type.options.list as EnumListOptions['list']\n  return listOptions.map((option) =>\n    isTitledListValue(option) ? option : ({title: option, value: option} as TitledListValue),\n  )\n}\n\n/** @internal */\nexport function prepareForPreview(\n  rawValue: unknown,\n  type: SchemaType,\n  viewOptions: PrepareViewOptions = {},\n): PreviewValue & {_createdAt?: string; _updatedAt?: string} {\n  const hasCustomPrepare = typeof type.preview?.prepare === 'function'\n  const selection: Record<string, string> = type.preview?.select || {}\n  const targetKeys = Object.keys(selection)\n\n  const selectedValue = targetKeys.reduce<Record<string, unknown>>((acc, key) => {\n    // Find the field the value belongs to\n    const typeWithFields = 'fields' in type ? type : null\n    const targetFieldName = selection[key]\n    const valueField = typeWithFields?.fields?.find((f) => f.name === targetFieldName)\n    const listOptions = valueField && getListOptions(valueField.type)\n\n    // If the user has _not_ specified a `prepare()` function for the preview, and the\n    // field type has an `options.list`, we want to use the title of the selected item\n    // as the preview value. If, however, there _is_ a custom `prepare()`, we leave this\n    // mapping up to the user to perform should they want to. This is both to maintain\n    // backwards compatiblity, but also to allow using the raw value for prepare operations\n    if (!hasCustomPrepare && listOptions) {\n      // Find the selected option that matches the raw value\n      const selectedOption =\n        listOptions && listOptions.find((opt) => opt.value === get(rawValue, selection[key]))\n      acc[key] = selectedOption ? selectedOption.value : get(rawValue, selection[key])\n    } else {\n      acc[key] = get(rawValue, selection[key])\n    }\n\n    return acc\n  }, {})\n\n  const prepareResult = invokePrepare(type, selectedValue, viewOptions)\n  if (prepareResult.errors.length > 0) {\n    return withErrors(prepareResult, type, selectedValue)\n  }\n\n  const returnValueResult = validateReturnedPreview(invokePrepare(type, selectedValue, viewOptions))\n  return returnValueResult.errors.length > 0\n    ? withErrors(returnValueResult, type, selectedValue)\n    : {...pick(rawValue, PRESERVE_KEYS), ...prepareResult.returnValue}\n}\n","import {\n  isCrossDatasetReference,\n  isCrossDatasetReferenceSchemaType,\n  isReferenceSchemaType,\n  type PrepareViewOptions,\n} from '@sanity/types'\nimport {isPlainObject} from 'lodash'\nimport {type Observable, of as observableOf} from 'rxjs'\nimport {map, switchMap} from 'rxjs/operators'\n\nimport {\n  type ApiConfig,\n  type PreparedSnapshot,\n  type Previewable,\n  type PreviewableType,\n  type PreviewPath,\n} from './types'\nimport {getPreviewPaths} from './utils/getPreviewPaths'\nimport {invokePrepare, prepareForPreview} from './utils/prepareForPreview'\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return isPlainObject(value)\n}\n\nfunction isReference(value: unknown): value is {_ref: string} {\n  return isPlainObject(value)\n}\n\n// Takes a value and its type and prepares a snapshot for it that can be passed to a preview component\nexport function createPreviewObserver(context: {\n  observeDocumentTypeFromId: (id: string, apiConfig?: ApiConfig) => Observable<string | undefined>\n  observePaths: (value: Previewable, paths: PreviewPath[], apiConfig?: ApiConfig) => any\n}): (\n  value: Previewable,\n  type: PreviewableType,\n  viewOptions?: PrepareViewOptions,\n  apiConfig?: ApiConfig,\n) => Observable<PreparedSnapshot> {\n  const {observeDocumentTypeFromId, observePaths} = context\n\n  return function observeForPreview(\n    value: Previewable,\n    type: PreviewableType,\n    viewOptions?: PrepareViewOptions,\n    apiConfig?: ApiConfig,\n  ): Observable<PreparedSnapshot> {\n    if (isCrossDatasetReferenceSchemaType(type)) {\n      // if the value is of type crossDatasetReference, but has no _ref property, we cannot prepare any value for the preview\n      // and the most appropriate thing to do is to return `undefined` for snapshot\n      if (!isCrossDatasetReference(value)) {\n        return observableOf({snapshot: undefined})\n      }\n\n      const refApiConfig = {projectId: value._projectId, dataset: value._dataset}\n\n      return observeDocumentTypeFromId(value._ref, refApiConfig).pipe(\n        switchMap((typeName) => {\n          if (typeName) {\n            const refType = type.to.find((toType) => toType.type === typeName)\n            return observeForPreview(value, refType as any, {}, refApiConfig)\n          }\n          return observableOf({snapshot: undefined})\n        }),\n      )\n    }\n    if (isReferenceSchemaType(type)) {\n      // if the value is of type reference, but has no _ref property, we cannot prepare any value for the preview\n      // and the most appropriate thing to do is to return `undefined` for snapshot\n      if (!isReference(value)) {\n        return observableOf({snapshot: undefined})\n      }\n      // Previewing references actually means getting the referenced value,\n      // and preview using the preview config of its type\n      // todo: We need a way of knowing the type of the referenced value by looking at the reference record alone\n      return observeDocumentTypeFromId(value._ref).pipe(\n        switchMap((typeName) => {\n          if (typeName) {\n            const refType = type.to.find((toType) => toType.name === typeName)\n            return observeForPreview(value, refType as any)\n          }\n          // todo: in case we can't read the document type, we can figure out the reason why e.g. whether it's because\n          //  the document doesn't exist or it's not readable due to lack of permission.\n          //  We can use the \"observeDocumentAvailability\" function\n          //  for this, but currently not sure if needed\n          return observableOf({snapshot: undefined})\n        }),\n      )\n    }\n    const paths = getPreviewPaths(type.preview)\n    if (paths) {\n      return observePaths(value, paths, apiConfig).pipe(\n        map((snapshot) => ({\n          type: type,\n          snapshot: snapshot && prepareForPreview(snapshot, type as any, viewOptions),\n        })),\n      )\n    }\n\n    // Note: this case is typically rare (or non-existent) and occurs only if\n    // the SchemaType doesn't have a `select` field. The schema compiler\n    // provides a default `preview` implementation for `object`s, `image`s,\n    // `file`s, and `document`s\n    return observableOf({\n      type,\n      snapshot:\n        value && isRecord(value) ? invokePrepare(type, value, viewOptions).returnValue : null,\n    })\n  }\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type SanityDocument} from '@sanity/types'\nimport {combineLatest, type Observable, of} from 'rxjs'\nimport {map, switchMap} from 'rxjs/operators'\n\nimport {getIdPair, isRecord} from '../util'\nimport {create_preview_availability} from './availability'\nimport {type DraftsModelDocument, type ObservePathsFn, type PreviewPath} from './types'\n\nexport function create_preview_documentPair(\n  versionedClient: SanityClient,\n  observePaths: ObservePathsFn,\n): {\n  observePathsDocumentPair: <T extends SanityDocument = SanityDocument>(\n    id: string,\n    paths: PreviewPath[],\n  ) => Observable<DraftsModelDocument<T>>\n} {\n  const {observeDocumentPairAvailability} = create_preview_availability(\n    versionedClient,\n    observePaths,\n  )\n\n  const ALWAYS_INCLUDED_SNAPSHOT_PATHS: PreviewPath[] = [['_updatedAt'], ['_createdAt'], ['_type']]\n\n  return {observePathsDocumentPair}\n\n  function observePathsDocumentPair<T extends SanityDocument = SanityDocument>(\n    id: string,\n    paths: PreviewPath[],\n  ): Observable<DraftsModelDocument<T>> {\n    const {draftId, publishedId} = getIdPair(id)\n\n    return observeDocumentPairAvailability(draftId).pipe(\n      switchMap((availability) => {\n        if (!availability.draft.available && !availability.published.available) {\n          // short circuit, neither draft nor published is available so no point in trying to get a snapshot\n          return of({\n            id: publishedId,\n            type: null,\n            draft: {\n              availability: availability.draft,\n              snapshot: undefined,\n            },\n            published: {\n              availability: availability.published,\n              snapshot: undefined,\n            },\n          })\n        }\n\n        const snapshotPaths = [...paths, ...ALWAYS_INCLUDED_SNAPSHOT_PATHS]\n\n        return combineLatest([\n          observePaths({_type: 'reference', _ref: draftId}, snapshotPaths),\n          observePaths({_type: 'reference', _ref: publishedId}, snapshotPaths),\n        ]).pipe(\n          map(([draftSnapshot, publishedSnapshot]) => {\n            // note: assume type is always the same\n            const type =\n              (isRecord(draftSnapshot) && '_type' in draftSnapshot && draftSnapshot._type) ||\n              (isRecord(publishedSnapshot) &&\n                '_type' in publishedSnapshot &&\n                publishedSnapshot._type) ||\n              null\n\n            return {\n              id: publishedId,\n              type: typeof type === 'string' ? type : null,\n              draft: {\n                availability: availability.draft,\n                snapshot: draftSnapshot as T,\n              },\n              published: {\n                availability: availability.published,\n                snapshot: publishedSnapshot as T,\n              },\n            }\n          }),\n        )\n      }),\n    )\n  }\n}\n","export function hasEqualFields(fields: string[]) {\n  return (object: Record<string, any> | null, otherObject: Record<string, any> | null) => {\n    if (object === otherObject) {\n      return true\n    }\n    if (!object || !otherObject) {\n      return false\n    }\n    if (typeof object !== 'object' || typeof otherObject !== 'object') {\n      return false\n    }\n    return fields.every((field) => object[field] === otherObject[field])\n  }\n}\n","const id = <T>(value: T): T => value\n\ntype ItemSelector<T> = (element: T) => any\n\n// Takes an array and checks if each item is unique,\n// optionally by specifying an itemSelector function that will be called with\n// each item, returning the value to compare for uniqueness\nexport function isUniqueBy<T>(array: Array<T>, itemSelector: ItemSelector<T> = id): boolean {\n  let prevItem\n  let currItem\n  for (let i = 0; i < array.length; i++) {\n    if (i === 0) {\n      prevItem = itemSelector(array[i])\n      continue\n    }\n    currItem = itemSelector(array[i])\n    if (prevItem !== currItem) {\n      return false\n    }\n    prevItem = currItem\n  }\n  return true\n}\n","import {identity, sortBy, values} from 'lodash'\n\nimport {escapeField, fieldNeedsEscape} from '../../util'\nimport {INCLUDE_FIELDS_QUERY} from '../constants'\nimport {type FieldName, type Id, type Selection} from '../types'\n\ntype CombinedSelection = {\n  ids: Id[]\n  fields: FieldName[]\n  map: number[]\n}\n\ntype Doc = {\n  _id: string\n}\n\ntype Result = Doc[]\n\nexport function combineSelections(selections: Selection[]): CombinedSelection[] {\n  return values(\n    selections.reduce((output: {[key: string]: any}, [id, fields], index) => {\n      const key = sortBy(fields.join(','), identity).join('.')\n      if (!output[key]) {\n        output[key] = {fields: fields, ids: [], map: []}\n      }\n      const idx = output[key].ids.length\n      output[key].ids[idx] = id\n      output[key].map[idx] = index\n      return output\n    }, {}),\n  )\n}\n\nfunction stringifyId(id: string) {\n  return JSON.stringify(id)\n}\n\nconst maybeEscape = (fieldName: string) =>\n  fieldNeedsEscape(fieldName) ? `\"${fieldName}\": @${escapeField(fieldName)}` : fieldName\n\nfunction toSubQuery({ids, fields}: {ids: string[]; fields: string[]}) {\n  const allFields = [...INCLUDE_FIELDS_QUERY, ...fields]\n  return `*[_id in [${ids.map(stringifyId).join(',')}]][0...${ids.length}]{${allFields\n    .map(maybeEscape)\n    .join(',')}}`\n}\n\nexport function toQuery(combinedSelections: CombinedSelection[]): string {\n  return `[${combinedSelections.map(toSubQuery).join(',')}][0...${combinedSelections.length}]`\n}\n\nexport function reassemble(\n  queryResult: Result[],\n  combinedSelections: CombinedSelection[],\n): (Doc | null)[] {\n  return queryResult.reduce((reprojected: (Doc | null)[], subResult, index) => {\n    const map = combinedSelections[index].map\n    map.forEach((resultIdx, i) => {\n      const id = combinedSelections[index].ids[i]\n      const found = subResult.find((doc) => doc._id === id)\n      reprojected[resultIdx] = found || null\n    })\n    return reprojected\n  }, [])\n}\n","import {type SanityClient} from '@sanity/client'\nimport {difference, flatten, memoize} from 'lodash'\nimport {\n  combineLatest,\n  concat,\n  defer,\n  EMPTY,\n  from,\n  fromEvent,\n  merge,\n  type Observable,\n  of as observableOf,\n  timer,\n} from 'rxjs'\nimport {\n  distinctUntilChanged,\n  filter,\n  map,\n  mergeMap,\n  share,\n  shareReplay,\n  startWith,\n  switchMap,\n  tap,\n} from 'rxjs/operators'\n\nimport {INCLUDE_FIELDS} from './constants'\nimport {\n  type ApiConfig,\n  type FieldName,\n  type Id,\n  type ObservePathsFn,\n  type PreviewPath,\n  type Selection,\n} from './types'\nimport {debounceCollect} from './utils/debounceCollect'\nimport {hasEqualFields} from './utils/hasEqualFields'\nimport {isUniqueBy} from './utils/isUniqueBy'\nimport {combineSelections, reassemble, toQuery} from './utils/optimizeQuery'\n\ntype CachedFieldObserver = {\n  id: Id\n  fields: FieldName[]\n  changes$: Observable<any>\n}\n\ntype Cache = {\n  [id: string]: CachedFieldObserver[]\n}\n\nexport function create_preview_observeFields(context: {\n  observePaths: ObservePathsFn\n  versionedClient: SanityClient\n}) {\n  const {observePaths, versionedClient} = context\n\n  let _globalListener: any\n\n  const getGlobalEvents = () => {\n    if (!_globalListener) {\n      const allEvents$ = from(\n        versionedClient.listen(\n          '*[!(_id in path(\"_.**\"))]',\n          {},\n          {\n            events: ['welcome', 'mutation'],\n            includeResult: false,\n            visibility: 'query',\n            tag: 'preview.global',\n          },\n        ),\n      ).pipe(share())\n\n      // This is a stream of welcome events from the server, each telling us that we have established listener connection\n      // We map these to snapshot fetch/sync. It is good to wait for the first welcome event before fetching any snapshots as, we may miss\n      // events that happens in the time period after initial fetch and before the listener is established.\n      const welcome$ = allEvents$.pipe(\n        filter((event: any) => event.type === 'welcome'),\n        shareReplay({refCount: true, bufferSize: 1}),\n      )\n\n      // This will keep the listener active forever and in turn reduce the number of initial fetches\n      // as less 'welcome' events will be emitted.\n      // @todo: see if we can delay unsubscribing or connect with some globally defined shared listener\n      welcome$.subscribe()\n\n      const mutations$ = allEvents$.pipe(filter((event: any) => event.type === 'mutation'))\n\n      _globalListener = {\n        welcome$,\n        mutations$,\n      }\n    }\n\n    return _globalListener\n  }\n\n  function listen(id: Id) {\n    const globalEvents = getGlobalEvents()\n    return merge(\n      globalEvents.welcome$,\n      globalEvents.mutations$.pipe(filter((event: any) => event.documentId === id)),\n    )\n  }\n\n  function fetchAllDocumentPathsWith(client: SanityClient) {\n    return function fetchAllDocumentPath(selections: Selection[]) {\n      const combinedSelections = combineSelections(selections)\n      return client.observable\n        .fetch(toQuery(combinedSelections), {}, {tag: 'preview.document-paths'} as any)\n        .pipe(map((result: any) => reassemble(result, combinedSelections)))\n    }\n  }\n\n  const fetchDocumentPathsFast = debounceCollect(fetchAllDocumentPathsWith(versionedClient), 100)\n  const fetchDocumentPathsSlow = debounceCollect(fetchAllDocumentPathsWith(versionedClient), 1000)\n\n  function currentDatasetListenFields(id: Id, fields: PreviewPath[]) {\n    return listen(id).pipe(\n      switchMap((event: any) => {\n        if (event.type === 'welcome' || event.visibility === 'query') {\n          return fetchDocumentPathsFast(id, fields as any).pipe(\n            mergeMap((result) => {\n              return concat(\n                observableOf(result),\n                result === undefined // hack: if we get undefined as result here it can be because the document has\n                  ? // just been created and is not yet indexed. We therefore need to wait a bit\n                    // and then re-fetch.\n                    fetchDocumentPathsSlow(id, fields as any)\n                  : [],\n              )\n            }),\n          )\n        }\n        return fetchDocumentPathsSlow(id, fields as any)\n      }),\n    )\n  }\n\n  // keep for debugging purposes for now\n  // function fetchDocumentPaths(id, selection) {\n  //   return client.observable.fetch(`*[_id==$id]{_id,_type,${selection.join(',')}}`, {id})\n  //     .map(result => result[0])\n  // }\n\n  const CACHE: Cache = {} // todo: use a LRU cache instead (e.g. hashlru or quick-lru)\n\n  const getBatchFetcherForDataset = memoize(\n    function getBatchFetcherForDataset(apiConfig: ApiConfig) {\n      const client = versionedClient.withConfig(apiConfig)\n      const fetchAll = fetchAllDocumentPathsWith(client)\n      return debounceCollect(fetchAll, 10)\n    },\n    (apiConfig) => apiConfig.dataset + apiConfig.projectId,\n  )\n\n  const CROSS_DATASET_PREVIEW_POLL_INTERVAL = 10000\n  // We want to poll for changes in the other dataset, but only when window/tab is visible\n  // This sets up a shared stream that emits an event every `POLL_INTERVAL` milliseconds as long as the\n  // document is visible. It starts emitting immediately (if the page is visible)\n  const visiblePoll$ = fromEvent(document, 'visibilitychange').pipe(\n    startWith(0),\n    map(() => document.visibilityState === 'visible'),\n    switchMap((visible) => (visible ? timer(0, CROSS_DATASET_PREVIEW_POLL_INTERVAL) : EMPTY)),\n    share(),\n  )\n\n  function crossDatasetListenFields(id: Id, fields: PreviewPath[], apiConfig: ApiConfig) {\n    return visiblePoll$.pipe(startWith(0)).pipe(\n      switchMap(() => {\n        const batchFetcher = getBatchFetcherForDataset(apiConfig)\n        return batchFetcher(id, fields as any)\n      }),\n    )\n  }\n\n  function createCachedFieldObserver<T>(\n    id: any,\n    fields: any,\n    apiConfig: ApiConfig,\n  ): CachedFieldObserver {\n    let latest: T | null = null\n    const changes$ = merge(\n      defer(() => (latest === null ? EMPTY : observableOf(latest))),\n      (apiConfig\n        ? (crossDatasetListenFields(id, fields, apiConfig) as any)\n        : currentDatasetListenFields(id, fields)) as Observable<T>,\n    ).pipe(\n      tap((v: T | null) => (latest = v)),\n      shareReplay({refCount: true, bufferSize: 1}),\n    )\n\n    return {id, fields, changes$}\n  }\n\n  function cachedObserveFields(id: Id, fields: FieldName[], apiConfig?: ApiConfig) {\n    const cacheKey = apiConfig\n      ? `${apiConfig.projectId}:${apiConfig.dataset}:${id}`\n      : `$current$-${id}`\n\n    if (!(cacheKey in CACHE)) {\n      CACHE[cacheKey] = []\n    }\n\n    const existingObservers = CACHE[cacheKey]\n    const missingFields = difference(\n      fields,\n      flatten(existingObservers.map((cachedFieldObserver) => cachedFieldObserver.fields)),\n    )\n\n    if (missingFields.length > 0) {\n      existingObservers.push(createCachedFieldObserver(id, fields, apiConfig as any))\n    }\n\n    const cachedFieldObservers = existingObservers\n      .filter((observer) => observer.fields.some((fieldName) => fields.includes(fieldName)))\n      .map((cached) => cached.changes$)\n\n    return combineLatest(cachedFieldObservers).pipe(\n      // in the event that a document gets deleted, the cached values will be updated to store `undefined`\n      // if this happens, we should not pick any fields from it, but rather just return null\n      map((snapshots) => snapshots.filter(Boolean)), // make sure all snapshots agree on same revision\n      filter((snapshots) => isUniqueBy(snapshots, (snapshot) => snapshot._rev)), // pass on value with the requested fields (or null if value is deleted)\n      map((snapshots) => (snapshots.length === 0 ? null : pickFrom(snapshots, fields))), // emit values only if changed\n      distinctUntilChanged(hasEqualFields(fields)),\n    )\n  }\n\n  // API\n  return {observeFields: cachedObserveFields}\n\n  function pickFrom(objects: Record<string, any>[], fields: string[]) {\n    return [...INCLUDE_FIELDS, ...fields].reduce((result, fieldName) => {\n      const value = getFirstFieldValue(objects, fieldName)\n      if (value !== undefined) {\n        ;(result as any)[fieldName] = value\n      }\n      return result\n    }, {})\n  }\n\n  function getFirstFieldValue(objects: Record<string, any>[], fieldName: string) {\n    let value\n    objects.some((object) => {\n      if (fieldName in object) {\n        value = object[fieldName]\n        return true\n      }\n      return false\n    })\n    return value\n  }\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type PrepareViewOptions, type SanityDocument} from '@sanity/types'\nimport {type Observable} from 'rxjs'\nimport {distinctUntilChanged, map} from 'rxjs/operators'\n\nimport {isRecord} from '../util'\nimport {create_preview_availability} from './availability'\nimport {createPathObserver} from './createPathObserver'\nimport {createPreviewObserver} from './createPreviewObserver'\nimport {create_preview_documentPair} from './documentPair'\nimport {create_preview_observeFields} from './observeFields'\nimport {\n  type ApiConfig,\n  type DraftsModelDocument,\n  type DraftsModelDocumentAvailability,\n  type ObservePathsFn,\n  type PreparedSnapshot,\n  type Previewable,\n  type PreviewableType,\n  type PreviewPath,\n} from './types'\n\n/**\n * @hidden\n * @beta */\nexport type ObserveForPreviewFn = (\n  value: Previewable,\n  type: PreviewableType,\n  viewOptions?: PrepareViewOptions,\n  apiConfig?: ApiConfig,\n) => Observable<PreparedSnapshot>\n\n/**\n * @hidden\n * @beta */\nexport interface DocumentPreviewStore {\n  observePaths: ObservePathsFn\n  observeForPreview: ObserveForPreviewFn\n  observeDocumentTypeFromId: (id: string, apiConfig?: ApiConfig) => Observable<string | undefined>\n\n  /**\n   *\n   * @hidden\n   * @beta\n   */\n  unstable_observeDocumentPairAvailability: (\n    id: string,\n  ) => Observable<DraftsModelDocumentAvailability>\n\n  unstable_observePathsDocumentPair: <T extends SanityDocument = SanityDocument>(\n    id: string,\n    paths: PreviewPath[],\n  ) => Observable<DraftsModelDocument<T>>\n}\n\n/** @internal */\nexport interface DocumentPreviewStoreOptions {\n  client: SanityClient\n}\n\n/** @internal */\nexport function createDocumentPreviewStore({\n  client,\n}: DocumentPreviewStoreOptions): DocumentPreviewStore {\n  const versionedClient = client.withConfig({apiVersion: '1'})\n\n  // NOTE: this is workaroudn for circumventing a circular dependency between `observePaths` and\n  // `observeFields`.\n  // eslint-disable-next-line camelcase\n  const __proxy_observePaths: ObservePathsFn = (value, paths, apiConfig) => {\n    return observePaths(value, paths, apiConfig)\n  }\n\n  const {observeFields} = create_preview_observeFields({\n    observePaths: __proxy_observePaths,\n    versionedClient,\n  })\n\n  const {observePaths} = createPathObserver({observeFields})\n\n  function observeDocumentTypeFromId(\n    id: string,\n    apiConfig?: ApiConfig,\n  ): Observable<string | undefined> {\n    return observePaths({_type: 'reference', _ref: id}, ['_type'], apiConfig).pipe(\n      map((res) => (isRecord(res) && typeof res._type === 'string' ? res._type : undefined)),\n      distinctUntilChanged(),\n    )\n  }\n\n  // const {createPreviewObserver} = create_preview_createPreviewObserver(observeDocumentTypeFromId)\n  const observeForPreview = createPreviewObserver({observeDocumentTypeFromId, observePaths})\n  const {observeDocumentPairAvailability} = create_preview_availability(\n    versionedClient,\n    observePaths,\n  )\n  const {observePathsDocumentPair} = create_preview_documentPair(versionedClient, observePaths)\n\n  // @todo: explain why the API is like this now, and that it should not be like this in the future!\n  return {\n    observePaths,\n    observeForPreview,\n    observeDocumentTypeFromId,\n\n    // eslint-disable-next-line camelcase\n    unstable_observeDocumentPairAvailability: observeDocumentPairAvailability,\n    unstable_observePathsDocumentPair: observePathsDocumentPair,\n  }\n}\n","import {type PreviewValue, type SanityDocument, type SchemaType} from '@sanity/types'\nimport {type ReactNode} from 'react'\nimport {combineLatest, type Observable, of} from 'rxjs'\nimport {map, startWith} from 'rxjs/operators'\n\nimport {getDraftId, getPublishedId} from '../../util/draftUtils'\nimport {type DocumentPreviewStore} from '../documentPreviewStore'\n\nexport interface PreviewState {\n  isLoading?: boolean\n  draft?: PreviewValue | Partial<SanityDocument> | null\n  published?: PreviewValue | Partial<SanityDocument> | null\n}\n\nconst isLiveEditEnabled = (schemaType: SchemaType) => schemaType.liveEdit === true\n\n/**\n * Obtain a document's published and draft state, along with loading status.\n *\n * @internal\n */\nexport function getPreviewStateObservable(\n  documentPreviewStore: DocumentPreviewStore,\n  schemaType: SchemaType,\n  documentId: string,\n  title: ReactNode,\n): Observable<PreviewState> {\n  const draft$ = isLiveEditEnabled(schemaType)\n    ? of({snapshot: null})\n    : documentPreviewStore.observeForPreview(\n        {_type: 'reference', _ref: getDraftId(documentId)},\n        schemaType,\n      )\n\n  const published$ = documentPreviewStore.observeForPreview(\n    {_type: 'reference', _ref: getPublishedId(documentId)},\n    schemaType,\n  )\n\n  return combineLatest([draft$, published$]).pipe(\n    map(([draft, published]) => ({\n      draft: draft.snapshot ? {title, ...(draft.snapshot || {})} : null,\n      isLoading: false,\n      published: published.snapshot ? {title, ...(published.snapshot || {})} : null,\n    })),\n    startWith({draft: null, isLoading: true, published: null}),\n  )\n}\n","import {WarningOutlineIcon} from '@sanity/icons'\nimport {type PreviewValue, type SanityDocument} from '@sanity/types'\nimport {assignWith} from 'lodash'\n\nconst getMissingDocumentFallback = (item: SanityDocument) => ({\n  title: <em>{item.title ? String(item.title) : 'Missing document'}</em>,\n  subtitle: <em>{item.title ? `Missing document ID: ${item._id}` : `Document ID: ${item._id}`}</em>,\n  media: () => <WarningOutlineIcon />,\n})\n\n/**\n * Obtain document preview values used in <SanityPreview> and <SanityDefaultPreview> components.\n * Also displays fallback values if the document cannot be found.\n *\n * @internal\n */\nexport const getPreviewValueWithFallback = ({\n  value,\n  draft,\n  published,\n}: {\n  value: SanityDocument\n  draft?: Partial<SanityDocument> | PreviewValue | null\n  published?: Partial<SanityDocument> | PreviewValue | null\n}) => {\n  const snapshot = draft || published\n\n  if (!snapshot) {\n    return getMissingDocumentFallback(value)\n  }\n\n  return assignWith({}, snapshot, value, (objValue, srcValue) => {\n    return typeof srcValue === 'undefined' ? objValue : srcValue\n  }) as PreviewValue\n}\n","import {type CurrentUser, type User} from '@sanity/types'\nimport {useMemo} from 'react'\nimport {from} from 'rxjs'\n\nimport {useSource} from '../../studio'\nimport {createHookFromObservableFactory, type LoadingTuple} from '../../util'\nimport {type UserStore, useUserStore} from '../_legacy'\n\nconst useUserViaUserStore = createHookFromObservableFactory(\n  ([userStore, userId]: [UserStore, string]) => {\n    return from(\n      userStore.getUser(userId).catch((err) => {\n        console.error(err)\n        return null\n      }),\n    )\n  },\n)\n\n/** @internal */\nexport function useUser(userId: string): LoadingTuple<User | null | undefined> {\n  const userStore = useUserStore()\n  return useUserViaUserStore(useMemo(() => [userStore, userId], [userId, userStore]))\n}\n\n/**\n * Retrieves information about the currently authenticated user.\n *\n * @returns The current user or null if not available.\n *\n * @public\n *\n * @example\n * ```ts\n * const currentUser = useCurrentUser()\n *\n * if (currentUser) {\n *  console.log('Logged in as', currentUser.name)\n * }\n * ```\n */\nexport function useCurrentUser(): CurrentUser | null {\n  const {currentUser} = useSource()\n  return currentUser\n}\n","import {BufferedDocument, Mutation} from '@sanity/mutator'\nimport {type SanityDocument} from '@sanity/types'\nimport {BehaviorSubject, EMPTY, merge, type Observable, Subject} from 'rxjs'\nimport {\n  distinctUntilChanged,\n  filter,\n  map,\n  mergeMapTo,\n  publishReplay,\n  refCount,\n  scan,\n  share,\n  take,\n  tap,\n  withLatestFrom,\n} from 'rxjs/operators'\n\nimport {type ListenerEvent} from '../getPairListener'\nimport {type MutationEvent} from '../types'\nimport {\n  type DocumentMutationEvent,\n  type DocumentRebaseEvent,\n  type DocumentRemoteMutationEvent,\n  type MutationPayload,\n  type RemoteSnapshotEvent,\n  type SnapshotEvent,\n} from './types'\n\ninterface MutationAction {\n  type: 'mutation'\n  mutations: MutationPayload[]\n}\n\ninterface CommitAction {\n  type: 'commit'\n}\n\ntype Action = MutationAction | CommitAction\n\n/**\n * Represents \"commit requests\" from the mutator.\n * These are emitted from the BufferedDocument instance's `requestHandler` callback\n *\n * @internal\n */\nexport interface CommitRequest {\n  mutation: Mutation\n  success: () => void\n  failure: (error: Error) => void\n  cancel: (error: Error) => void\n}\n\n// BufferedDocument.LOCAL never updates its revision due to its internal consistency checks\n// but we sometimes we need the most current _rev on the document in UI land, e.g.\n// in order to do optimistic locking on the edited document to make sure we publish the document the user\n// actually are looking at, and not the one currently at the server\n// Also - the mutator is not setting _updatedAt on patches applied optimistically or\n// when they are received from server\nconst getUpdatedSnapshot = (bufferedDocument: BufferedDocument) => {\n  const LOCAL = bufferedDocument.LOCAL\n  const HEAD = bufferedDocument.document.HEAD\n  if (!LOCAL) {\n    return LOCAL\n  }\n\n  return {\n    ...LOCAL,\n    _type: (HEAD || LOCAL)._type,\n    _rev: (HEAD || LOCAL)._rev,\n    _updatedAt: new Date().toISOString(),\n  }\n}\n\nconst toSnapshotEvent = (document: any): SnapshotEvent => ({type: 'snapshot', document})\nconst getDocument = <T extends {document: any}>(event: T): T['document'] => event.document\n\n/** @internal */\n// This is an observable interface for BufferedDocument in an attempt\n// to make it easier to work with the api provided by it\nexport const createObservableBufferedDocument = (listenerEvent$: Observable<ListenerEvent>) => {\n  // Incoming local actions (e.g. a request to mutate, a request to commit pending changes, etc.)\n  const actions$ = new Subject<Action>()\n\n  // Stream of commit requests. Must be handled by a commit handler\n  const consistency$ = new BehaviorSubject<boolean>(true)\n\n  // Stream of mutations for this document\n  // NOTE: this will *not* include remote mutations received over the listener\n  // that has *already* applied locally/optimistically\n  const mutations$ = new Subject<DocumentMutationEvent>()\n\n  // a stream of rebase events emitted from the mutator\n  const rebase$ = new Subject<DocumentRebaseEvent>()\n\n  // a stream of remote mutations with effetcs\n  const remoteMutations = new Subject<DocumentRemoteMutationEvent>()\n\n  const commitRequests = new Subject<CommitRequest>()\n\n  const createInitialBufferedDocument = (initialSnapshot: SanityDocument | null) => {\n    const bufferedDocument = new BufferedDocument(initialSnapshot)\n    bufferedDocument.onMutation = ({mutation, remote}: any) => {\n      // this is called after either when:\n      // 1) local mutations has been added, optimistically applied and queued for sending\n      // 2) remote mutations originating from another client has arrived and been applied\n      mutations$.next({\n        type: 'mutation',\n        document: getUpdatedSnapshot(bufferedDocument) as any,\n        mutations: mutation.mutations,\n        origin: remote ? 'remote' : 'local',\n      })\n    }\n    bufferedDocument.onRemoteMutation = (mutation: any) => {\n      remoteMutations.next({\n        type: 'remoteMutation',\n        head: bufferedDocument.document.HEAD as any,\n        transactionId: mutation.transactionId,\n        timestamp: mutation.timestamp,\n        author: mutation.identity,\n        effects: mutation.effects,\n      })\n    }\n\n    bufferedDocument.onRebase = (edge: any, nextRemoteMutations: any, localMutations: any) => {\n      rebase$.next({\n        type: 'rebase',\n        document: edge,\n        remoteMutations: nextRemoteMutations,\n        localMutations,\n      })\n    }\n\n    bufferedDocument.onConsistencyChanged = (isConsistent) => {\n      consistency$.next(isConsistent)\n    }\n\n    bufferedDocument.commitHandler = (commitArg: CommitRequest) => commitRequests.next(commitArg)\n\n    return bufferedDocument\n  }\n\n  const currentBufferedDocument$ = listenerEvent$.pipe(\n    scan((bufferedDocument: BufferedDocument | null, listenerEvent) => {\n      // consider renaming 'snapshot' to initial/welcome\n      if (listenerEvent.type === 'snapshot') {\n        if (bufferedDocument) {\n          // we received a new snapshot and already got an old one. When we receive a snapshot again\n          // it is usually because the connection has been down. Attempt to save pending changes (if any)\n          bufferedDocument.commit()\n        }\n        return createInitialBufferedDocument(listenerEvent.document || null)\n      }\n      if (bufferedDocument === null) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          'Ignoring event of type \"%s\" since buffered document has not yet been set up with snapshot',\n          listenerEvent.type,\n        )\n        return null\n      }\n      return bufferedDocument\n    }, null),\n    filter(\n      <T>(bufferedDocument: T): bufferedDocument is NonNullable<T> => bufferedDocument !== null,\n    ),\n    distinctUntilChanged(),\n    publishReplay(1),\n    refCount(),\n  )\n\n  // this is a stream of document snapshots where each new snapshot are emitted after listener mutations\n  // has been applied. Since the optimistic patches is not emitted on the mutation$ stream, we need this\n  // in order to update the document with a new _rev (and _updatedAt)\n  const snapshotAfterSync$ = listenerEvent$.pipe(\n    filter((ev): ev is MutationEvent => ev.type === 'mutation'),\n    withLatestFrom(currentBufferedDocument$),\n    map(([mutationEvent, bufferedDocument]) => {\n      bufferedDocument!.arrive(new Mutation(mutationEvent))\n      return getUpdatedSnapshot(bufferedDocument!)\n    }),\n  )\n\n  // this is where the side effects mandated by local actions actually happens\n  const actionHandler$ = actions$.pipe(\n    withLatestFrom(currentBufferedDocument$),\n    tap(([action, bufferedDocument]: [Action, BufferedDocument]) => {\n      if (action.type === 'mutation') {\n        bufferedDocument!.add(new Mutation({mutations: action.mutations}))\n      }\n      if (action.type === 'commit') {\n        bufferedDocument!.commit()\n      }\n    }),\n    // We subscribe to this only for the side effects\n    mergeMapTo(EMPTY),\n    share(),\n  )\n\n  const emitAction = (action: any) => actions$.next(action)\n\n  const addMutations = (mutations: MutationPayload[]) => emitAction({type: 'mutation', mutations})\n  const addMutation = (mutation: MutationPayload) => addMutations([mutation])\n\n  const commit = () => {\n    currentBufferedDocument$\n      .pipe(\n        take(1),\n        tap((bufferedDocument) => bufferedDocument!.commit()),\n      )\n      .subscribe()\n  }\n\n  // A stream of this document's snapshot\n  const snapshot$ = merge(\n    currentBufferedDocument$.pipe(map((bufferedDocument) => bufferedDocument!.LOCAL)),\n    mutations$.pipe(map(getDocument)),\n    rebase$.pipe(map(getDocument)),\n    snapshotAfterSync$,\n  ).pipe(map(toSnapshotEvent), publishReplay(1), refCount())\n\n  const remoteSnapshot$: Observable<RemoteSnapshotEvent> = merge(\n    currentBufferedDocument$.pipe(\n      map((bufferedDocument) => bufferedDocument!.document.HEAD as any),\n      map(toSnapshotEvent),\n    ),\n    remoteMutations,\n  ).pipe(publishReplay(1), refCount())\n\n  return {\n    updates$: merge(snapshot$, actionHandler$, mutations$, rebase$),\n    consistency$: consistency$.pipe(distinctUntilChanged(), publishReplay(1), refCount()),\n    remoteSnapshot$,\n    commitRequest$: commitRequests,\n    addMutation,\n    addMutations,\n    commit,\n  }\n}\n","import {type SanityDocument} from '@sanity/types'\nimport {type Observable} from 'rxjs'\n\nimport {type ListenerEvent} from '../getPairListener'\nimport {\n  type CommitRequest,\n  createObservableBufferedDocument,\n} from './createObservableBufferedDocument'\nimport {\n  type CommittedEvent,\n  type DocumentMutationEvent,\n  type DocumentRebaseEvent,\n  type MutationPayload,\n  type RemoteSnapshotEvent,\n  type SnapshotEvent,\n} from './types'\n\n/**\n * @hidden\n * @beta */\nexport type BufferedDocumentEvent =\n  | SnapshotEvent\n  | DocumentRebaseEvent\n  | DocumentMutationEvent\n  | CommittedEvent\n\nconst prepare = (id: string) => (document: Partial<SanityDocument>) => {\n  const {_id, _rev, _updatedAt, ...rest} = document\n  return {_id: id, ...rest}\n}\n\n/** @internal */\nexport interface BufferedDocumentWrapper {\n  consistency$: Observable<boolean>\n  remoteSnapshot$: Observable<RemoteSnapshotEvent>\n  events: Observable<BufferedDocumentEvent>\n  commitRequest$: Observable<CommitRequest>\n  // helper functions\n  patch: (patches: any[]) => MutationPayload[]\n  create: (document: Partial<SanityDocument>) => MutationPayload\n  createIfNotExists: (document: SanityDocument) => MutationPayload\n  createOrReplace: (document: SanityDocument) => MutationPayload\n  delete: () => MutationPayload\n\n  mutate: (mutations: MutationPayload[]) => void\n  commit: () => void\n}\n\n/** @internal */\nexport const createBufferedDocument = (\n  documentId: string,\n  // consider naming it remoteEvent$\n  listenerEvent$: Observable<ListenerEvent>,\n): BufferedDocumentWrapper => {\n  const bufferedDocument = createObservableBufferedDocument(listenerEvent$)\n\n  const prepareDoc = prepare(documentId)\n\n  const DELETE = {delete: {id: documentId}}\n\n  return {\n    events: bufferedDocument.updates$,\n    consistency$: bufferedDocument.consistency$,\n    remoteSnapshot$: bufferedDocument.remoteSnapshot$,\n    commitRequest$: bufferedDocument.commitRequest$,\n\n    patch: (patches) => patches.map((patch) => ({patch: {...patch, id: documentId}})),\n    create: (document) => ({create: prepareDoc(document)}),\n    createIfNotExists: (document) => ({createIfNotExists: prepareDoc(document)}),\n    createOrReplace: (document) => ({createOrReplace: prepareDoc(document)}),\n    delete: () => DELETE,\n\n    mutate: (mutations: MutationPayload[]) => bufferedDocument.addMutations(mutations),\n    commit: () => bufferedDocument.commit(),\n  }\n}\n","/* eslint-disable @typescript-eslint/no-use-before-define */\nimport {type SanityClient} from '@sanity/client'\nimport {type SanityDocument} from '@sanity/types'\nimport {groupBy} from 'lodash'\nimport {defer, type Observable, of as observableOf} from 'rxjs'\nimport {concatMap, map, mergeMap, scan} from 'rxjs/operators'\n\nimport {\n  type IdPair,\n  type MutationEvent,\n  type PendingMutationsEvent,\n  type ReconnectEvent,\n  type WelcomeEvent,\n} from './types'\n\ninterface Snapshots {\n  draft: SanityDocument | null\n  published: SanityDocument | null\n}\n\n/** @internal */\nexport interface InitialSnapshotEvent {\n  type: 'snapshot'\n  documentId: string\n  document: SanityDocument | null\n}\n\n/** @internal */\nexport interface PairListenerOptions {\n  tag?: string\n}\n\n/** @internal */\nexport type ListenerEvent =\n  | MutationEvent\n  | ReconnectEvent\n  | InitialSnapshotEvent\n  | PendingMutationsEvent\n\nconst PENDING_START: PendingMutationsEvent = {type: 'pending', phase: 'begin'}\nconst PENDING_END: PendingMutationsEvent = {type: 'pending', phase: 'end'}\n\nfunction isMutationEvent(msg: ListenerEvent): msg is MutationEvent {\n  return msg.type === 'mutation'\n}\nfunction isMultiTransactionEvent(msg: MutationEvent) {\n  return msg.transactionTotalEvents > 1\n}\n\nfunction allPendingTransactionEventsReceived(listenerEvents: ListenerEvent[]) {\n  const groupedMutations = groupBy(\n    listenerEvents.filter((ev): ev is MutationEvent => ev.type === 'mutation'),\n    (e) => e.transactionId,\n  )\n  // Note: we can't assume that the events come in order, so instead of checking the counter attributes we check that we have actually received all\n  return Object.values(groupedMutations).every(\n    (mutations) => mutations.length === mutations[0].transactionTotalEvents,\n  )\n}\n\n/** @internal */\nexport function getPairListener(\n  client: SanityClient,\n  idPair: IdPair,\n  options: PairListenerOptions = {},\n): Observable<ListenerEvent> {\n  const {publishedId, draftId} = idPair\n  return defer(\n    () =>\n      client.observable.listen(\n        `*[_id == $publishedId || _id == $draftId]`,\n        {\n          publishedId,\n          draftId,\n        },\n        {\n          includeResult: false,\n          events: ['welcome', 'mutation', 'reconnect'],\n          effectFormat: 'mendoza',\n          tag: options.tag || 'document.pair-listener',\n        },\n      ) as Observable<WelcomeEvent | MutationEvent | ReconnectEvent>,\n  ).pipe(\n    concatMap((event) =>\n      event.type === 'welcome'\n        ? fetchInitialDocumentSnapshots().pipe(\n            concatMap((snapshots) => [\n              createSnapshotEvent(draftId, snapshots.draft),\n              createSnapshotEvent(publishedId, snapshots.published),\n            ]),\n          )\n        : observableOf(event),\n    ),\n    scan(\n      (acc: {next: ListenerEvent[]; buffer: ListenerEvent[]}, msg) => {\n        // we only care about mutation events\n        if (!isMutationEvent(msg)) {\n          return {next: [msg], buffer: []}\n        }\n\n        const isBuffering = acc.buffer.length > 0\n        const isMulti = isMultiTransactionEvent(msg)\n        if (!isMulti && !isBuffering) {\n          // simple case, we have no buffer, and the event is a single-transaction event, so just pass it on\n          return {next: [msg], buffer: []}\n        }\n\n        if (!isMulti) {\n          // we have received a single transaction event while waiting for the rest of events from a multi transaction\n          // put it in the buffer\n          return {next: [], buffer: acc.buffer.concat(msg)}\n        }\n\n        const nextBuffer = acc.buffer.concat(msg)\n        if (allPendingTransactionEventsReceived(nextBuffer)) {\n          // we have received all pending transactions, emit the buffer, and signal end of buffer\n          return {next: nextBuffer.concat(PENDING_END), buffer: []}\n        }\n        // if we get here, we are still waiting for more multi-transaction messages\n        // if nextBuffer only has one element, we know we just started buffering\n        return {next: nextBuffer.length === 1 ? [PENDING_START] : [], buffer: nextBuffer}\n      },\n      {next: [], buffer: []},\n    ),\n    // note: this flattens the array, and in the case of an empty array, no event will be pushed downstream\n    mergeMap((v) => v.next),\n  )\n\n  function fetchInitialDocumentSnapshots(): Observable<Snapshots> {\n    return client.observable\n      .getDocuments<SanityDocument>([draftId, publishedId], {tag: 'document.snapshots'})\n      .pipe(\n        map(([draft, published]) => ({\n          draft,\n          published,\n        })),\n      )\n  }\n}\n\nfunction createSnapshotEvent(\n  documentId: string,\n  document: null | SanityDocument,\n): InitialSnapshotEvent {\n  return {\n    type: 'snapshot',\n    documentId,\n    document,\n  }\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type Mutation} from '@sanity/mutator'\nimport {type SanityDocument} from '@sanity/types'\nimport {EMPTY, from, merge, type Observable, Subject} from 'rxjs'\nimport {filter, map, mergeMap, mergeMapTo, share, tap} from 'rxjs/operators'\n\nimport {\n  type BufferedDocumentEvent,\n  type CommitRequest,\n  createBufferedDocument,\n  type MutationPayload,\n  type RemoteSnapshotEvent,\n} from '../buffered-doc'\nimport {getPairListener, type ListenerEvent} from '../getPairListener'\nimport {type IdPair, type PendingMutationsEvent, type ReconnectEvent} from '../types'\n\nconst isMutationEventForDocId =\n  (id: string) =>\n  (\n    event: ListenerEvent,\n  ): event is Exclude<ListenerEvent, ReconnectEvent | PendingMutationsEvent> => {\n    return event.type !== 'reconnect' && event.type !== 'pending' && event.documentId === id\n  }\n\n/**\n * @hidden\n * @beta */\nexport type WithVersion<T> = T & {version: 'published' | 'draft'}\n\n/**\n * @hidden\n * @beta */\nexport type DocumentVersionEvent = WithVersion<ReconnectEvent | BufferedDocumentEvent>\n\n/**\n * @hidden\n * @beta */\nexport type RemoteSnapshotVersionEvent = WithVersion<RemoteSnapshotEvent>\n\n/**\n * @hidden\n * @beta */\nexport interface DocumentVersion {\n  consistency$: Observable<boolean>\n  remoteSnapshot$: Observable<RemoteSnapshotVersionEvent>\n  events: Observable<DocumentVersionEvent>\n\n  patch: (patches: any[]) => MutationPayload[]\n  create: (document: Partial<SanityDocument>) => MutationPayload\n  createIfNotExists: (document: SanityDocument) => MutationPayload\n  createOrReplace: (document: SanityDocument) => MutationPayload\n  delete: () => MutationPayload\n\n  mutate: (mutations: MutationPayload[]) => void\n  commit: () => void\n}\n\n/**\n * @hidden\n * @beta */\nexport interface Pair {\n  /** @internal */\n  transactionsPendingEvents$: Observable<PendingMutationsEvent>\n  published: DocumentVersion\n  draft: DocumentVersion\n  complete: () => void\n}\n\nfunction setVersion<T>(version: 'draft' | 'published') {\n  return (ev: T): T & {version: 'draft' | 'published'} => ({...ev, version})\n}\n\nfunction commitMutations(client: SanityClient, mutationParams: Mutation['params']) {\n  const {resultRev, ...mutation} = mutationParams\n  return client.dataRequest('mutate', mutation, {\n    visibility: 'async',\n    returnDocuments: false,\n    tag: 'document.commit',\n    // This makes sure the studio doesn't crash when a draft is crated\n    // because someone deleted a referenced document in the target dataset\n    skipCrossDatasetReferenceValidation: true,\n  })\n}\n\nfunction submitCommitRequest(client: SanityClient, request: CommitRequest) {\n  return from(commitMutations(client, request.mutation.params)).pipe(\n    tap({\n      error: (error) => {\n        const isBadRequest =\n          'statusCode' in error &&\n          typeof error.statusCode === 'number' &&\n          error.statusCode >= 400 &&\n          error.statusCode <= 500\n        if (isBadRequest) {\n          request.cancel(error)\n        } else {\n          request.failure(error)\n        }\n      },\n      next: () => request.success(),\n    }),\n  )\n}\n\n/** @internal */\nexport function checkoutPair(client: SanityClient, idPair: IdPair): Pair {\n  const {publishedId, draftId} = idPair\n\n  const listenerEventsConnector = new Subject<ListenerEvent>()\n  const listenerEvents$ = getPairListener(client, idPair).pipe(\n    share({connector: () => listenerEventsConnector}),\n  )\n\n  const reconnect$ = listenerEvents$.pipe(\n    filter((ev) => ev.type === 'reconnect'),\n  ) as Observable<ReconnectEvent>\n\n  const draft = createBufferedDocument(\n    draftId,\n    listenerEvents$.pipe(filter(isMutationEventForDocId(draftId))),\n  )\n\n  const published = createBufferedDocument(\n    publishedId,\n    listenerEvents$.pipe(filter(isMutationEventForDocId(publishedId))),\n  )\n\n  // share commit handling between draft and published\n  const transactionsPendingEvents$ = listenerEvents$.pipe(\n    filter((ev): ev is PendingMutationsEvent => ev.type === 'pending'),\n  )\n\n  const commits$ = merge(draft.commitRequest$, published.commitRequest$).pipe(\n    mergeMap((commitRequest) => submitCommitRequest(client, commitRequest)),\n    mergeMapTo(EMPTY),\n    share(),\n  )\n\n  return {\n    transactionsPendingEvents$,\n    draft: {\n      ...draft,\n      events: merge(commits$, reconnect$, draft.events).pipe(map(setVersion('draft'))),\n      consistency$: draft.consistency$,\n      remoteSnapshot$: draft.remoteSnapshot$.pipe(map(setVersion('draft'))),\n    },\n    published: {\n      ...published,\n      events: merge(commits$, reconnect$, published.events).pipe(map(setVersion('published'))),\n      consistency$: published.consistency$,\n      remoteSnapshot$: published.remoteSnapshot$.pipe(map(setVersion('published'))),\n    },\n    complete: () => listenerEventsConnector.complete(),\n  }\n}\n","import {type Observable} from 'rxjs'\n\nexport function memoize<T, Arg1>(\n  fn: (arg1: Arg1) => Observable<T>,\n  keyGen: (arg1: Arg1) => string,\n): (arg1: Arg1) => Observable<T>\nexport function memoize<T, Arg1, Arg2>(\n  fn: (arg1: Arg1, arg2: Arg2) => Observable<T>,\n  keyGen: (arg1: Arg1, arg2: Arg2) => string,\n): (arg1: Arg1, arg2: Arg2) => Observable<T>\n\nexport function memoize<T, Arg1, Arg2, Arg3>(\n  fn: (arg1: Arg1, arg2: Arg2, arg3: Arg3) => Observable<T>,\n  keyGen: (arg1: Arg1, arg2: Arg2, arg3: Arg3) => string,\n): (arg1: Arg1, arg2: Arg2, arg3: Arg3) => Observable<T>\n\nexport function memoize<T, Arg1, Arg2, Arg3, Arg4>(\n  fn: (arg1: Arg1, arg2: Arg2, arg3: Arg3, arg4: Arg4) => Observable<T>,\n  keyGen: (arg1: Arg1, arg2: Arg2, arg3: Arg3, arg4: Arg4) => string,\n): (arg1: Arg1, arg2: Arg2, arg3: Arg3, arg4: Arg4) => Observable<T>\n\nexport function memoize<T, Args>(\n  fn: (...args: Args[]) => Observable<T>,\n  keyGen: (...args: Args[]) => string,\n) {\n  const MEMO: {[key: string]: Observable<T>} = Object.create(null)\n  return (...args: any[]) => {\n    const key = keyGen(...args)\n    if (!(key in MEMO)) {\n      MEMO[key] = fn(...args)\n    }\n    return MEMO[key]\n  }\n}\n","import {type SanityClient} from '@sanity/client'\n\nimport {type IdPair} from '../types'\n\nexport function memoizeKeyGen(client: SanityClient, idPair: IdPair, typeName: string) {\n  const config = client.config()\n  return `${config.dataset ?? ''}-${config.projectId ?? ''}-${idPair.publishedId}-${typeName}`\n}\n","import {type SanityClient} from '@sanity/client'\nimport {Observable} from 'rxjs'\nimport {publishReplay, refCount} from 'rxjs/operators'\n\nimport {type IdPair} from '../types'\nimport {memoize} from '../utils/createMemoizer'\nimport {checkoutPair, type Pair} from './checkoutPair'\nimport {memoizeKeyGen} from './memoizeKeyGen'\n\nexport const memoizedPair: (\n  client: SanityClient,\n  idPair: IdPair,\n  typeName: string,\n) => Observable<Pair> = memoize(\n  (client: SanityClient, idPair: IdPair, _typeName: string): Observable<Pair> => {\n    return new Observable<Pair>((subscriber) => {\n      const pair = checkoutPair(client, idPair)\n      subscriber.next(pair)\n\n      return pair.complete\n    }).pipe(publishReplay(1), refCount())\n  },\n  memoizeKeyGen,\n)\n","import {type SanityClient} from '@sanity/client'\nimport {type SanityDocument} from '@sanity/types'\nimport {type Observable} from 'rxjs'\nimport {filter, map, publishReplay, refCount} from 'rxjs/operators'\n\nimport {type BufferedDocumentEvent, type MutationPayload, type SnapshotEvent} from '../buffered-doc'\nimport {type IdPair, type PendingMutationsEvent, type ReconnectEvent} from '../types'\nimport {memoize} from '../utils/createMemoizer'\nimport {type DocumentVersion} from './checkoutPair'\nimport {memoizedPair} from './memoizedPair'\n\n// return true if the event comes with a document snapshot\nfunction isSnapshotEvent(event: BufferedDocumentEvent | ReconnectEvent): event is SnapshotEvent & {\n  version: 'published' | 'draft'\n} {\n  return event.type === 'snapshot'\n}\n\nfunction withSnapshots(pair: DocumentVersion): DocumentVersionSnapshots {\n  return {\n    snapshots$: pair.events.pipe(\n      filter(isSnapshotEvent),\n      map((event) => event.document),\n      publishReplay(1),\n      refCount(),\n    ),\n\n    patch: pair.patch,\n    create: pair.create,\n    createIfNotExists: pair.createIfNotExists,\n    createOrReplace: pair.createOrReplace,\n    delete: pair.delete,\n\n    mutate: pair.mutate,\n    commit: pair.commit,\n  }\n}\n\n/** @internal */\nexport interface DocumentVersionSnapshots {\n  snapshots$: Observable<SanityDocument>\n\n  // helper functions\n  patch: (patches: any[]) => MutationPayload[]\n  create: (document: any) => MutationPayload\n  createIfNotExists: (document: any) => MutationPayload\n  createOrReplace: (document: any) => MutationPayload\n  delete: () => MutationPayload\n\n  mutate: (mutations: MutationPayload[]) => void\n  commit: () => void\n}\n\n/** @internal */\ninterface SnapshotPair {\n  transactionsPendingEvents$: Observable<PendingMutationsEvent>\n  draft: DocumentVersionSnapshots\n  published: DocumentVersionSnapshots\n}\n\n/** @internal */\nexport const snapshotPair = memoize(\n  (client: SanityClient, idPair: IdPair, typeName: string) => {\n    return memoizedPair(client, idPair, typeName).pipe(\n      map(({published, draft, transactionsPendingEvents$}): SnapshotPair => {\n        return {\n          transactionsPendingEvents$,\n          published: withSnapshots(published),\n          draft: withSnapshots(draft),\n        }\n      }),\n      publishReplay(1),\n      refCount(),\n    )\n  },\n  (client, idPair, typeName) => {\n    const config = client.config()\n\n    return `${config.dataset ?? ''}-${config.projectId ?? ''}-${idPair.publishedId}-${typeName}`\n  },\n)\n","import {type Schema} from '@sanity/types'\n\nexport const isLiveEditEnabled = (schema: Schema, typeName: string): boolean =>\n  schema.get(typeName)?.liveEdit === true\n","import {type SanityClient} from '@sanity/client'\nimport {type SanityDocument, type Schema} from '@sanity/types'\nimport {combineLatest, type Observable} from 'rxjs'\nimport {map, publishReplay, refCount, startWith, switchMap} from 'rxjs/operators'\n\nimport {type IdPair, type PendingMutationsEvent} from '../types'\nimport {memoize} from '../utils/createMemoizer'\nimport {memoizeKeyGen} from './memoizeKeyGen'\nimport {snapshotPair} from './snapshotPair'\nimport {isLiveEditEnabled} from './utils/isLiveEditEnabled'\n\ninterface TransactionSyncLockState {\n  enabled: boolean\n}\n\n/**\n * @hidden\n * @beta */\nexport interface EditStateFor {\n  id: string\n  type: string\n  transactionSyncLock: TransactionSyncLockState | null\n  draft: SanityDocument | null\n  published: SanityDocument | null\n  liveEdit: boolean\n  ready: boolean\n}\nconst LOCKED: TransactionSyncLockState = {enabled: true}\nconst NOT_LOCKED: TransactionSyncLockState = {enabled: false}\n\n/** @internal */\nexport const editState = memoize(\n  (\n    ctx: {\n      client: SanityClient\n      schema: Schema\n    },\n    idPair: IdPair,\n    typeName: string,\n  ): Observable<EditStateFor> => {\n    const liveEdit = isLiveEditEnabled(ctx.schema, typeName)\n    return snapshotPair(ctx.client, idPair, typeName).pipe(\n      switchMap((versions) =>\n        combineLatest([\n          versions.draft.snapshots$,\n          versions.published.snapshots$,\n          versions.transactionsPendingEvents$.pipe(\n            map((ev: PendingMutationsEvent) => (ev.phase === 'begin' ? LOCKED : NOT_LOCKED)),\n            startWith(NOT_LOCKED),\n          ),\n        ]),\n      ),\n      map(([draftSnapshot, publishedSnapshot, transactionSyncLock]) => ({\n        id: idPair.publishedId,\n        type: typeName,\n        draft: draftSnapshot,\n        published: publishedSnapshot,\n        liveEdit,\n        ready: true,\n        transactionSyncLock,\n      })),\n      startWith({\n        id: idPair.publishedId,\n        type: typeName,\n        draft: null,\n        published: null,\n        liveEdit,\n        ready: false,\n        transactionSyncLock: null,\n      }),\n      publishReplay(1),\n      refCount(),\n    )\n  },\n  (ctx, idPair, typeName) => memoizeKeyGen(ctx.client, idPair, typeName),\n)\n","import {type SanityClient} from '@sanity/client'\nimport {combineLatest, type Observable} from 'rxjs'\nimport {distinctUntilChanged, map, publishReplay, refCount, switchMap} from 'rxjs/operators'\n\nimport {type IdPair} from '../types'\nimport {memoize} from '../utils/createMemoizer'\nimport {memoizedPair} from './memoizedPair'\n\n// A stream of all events related to either published or draft, each event comes with a 'target'\n// that specifies which version (draft|published) the event is about\nexport const consistencyStatus: (\n  client: SanityClient,\n  idPair: IdPair,\n  typeName: string,\n) => Observable<boolean> = memoize(\n  (client: SanityClient, idPair: IdPair, typeName: string) => {\n    return memoizedPair(client, idPair, typeName).pipe(\n      switchMap(({draft, published}) =>\n        combineLatest([draft.consistency$, published.consistency$]),\n      ),\n      map(\n        ([draftIsConsistent, publishedIsConsistent]) => draftIsConsistent && publishedIsConsistent,\n      ),\n      distinctUntilChanged(),\n      publishReplay(1),\n      refCount(),\n    )\n  },\n  (client, idPair, typeName) => {\n    const config = client.config()\n\n    return `${config.dataset ?? ''}-${config.projectId ?? ''}-${idPair.publishedId}-${typeName}`\n  },\n)\n","/* eslint-disable @typescript-eslint/no-use-before-define */\n\nimport {type SanityClient} from '@sanity/client'\nimport {type Schema} from '@sanity/types'\nimport {combineLatest, type Observable} from 'rxjs'\nimport {map, publishReplay, refCount, switchMap} from 'rxjs/operators'\n\nimport {type HistoryStore} from '../../history'\nimport {type IdPair} from '../types'\nimport {memoize} from '../utils/createMemoizer'\nimport {type OperationArgs} from './operations'\nimport {snapshotPair} from './snapshotPair'\n\nexport const operationArgs = memoize(\n  (\n    ctx: {\n      client: SanityClient\n      historyStore: HistoryStore\n      schema: Schema\n    },\n    idPair: IdPair,\n    typeName: string,\n  ): Observable<OperationArgs> => {\n    return snapshotPair(ctx.client, idPair, typeName).pipe(\n      switchMap((versions) =>\n        combineLatest([versions.draft.snapshots$, versions.published.snapshots$]).pipe(\n          map(\n            ([draft, published]): OperationArgs => ({\n              ...ctx,\n              idPair,\n              typeName: typeName,\n              snapshots: {draft, published},\n              draft: versions.draft,\n              published: versions.published,\n            }),\n          ),\n        ),\n      ),\n      publishReplay(1),\n      refCount(),\n    )\n  },\n  (ctx, idPair, typeName) => {\n    const config = ctx.client.config()\n\n    return `${config.dataset ?? ''}-${config.projectId ?? ''}-${idPair.publishedId}-${typeName}`\n  },\n)\n","import {EMPTY} from 'rxjs'\n\nimport {type OperationImpl} from './types'\n\nexport const commit: OperationImpl = {\n  disabled: (): false => false,\n  execute: ({draft, published}) => {\n    draft.commit()\n    published.commit()\n    // note: we might be able to connect with the outgoing commit request stream here\n    return EMPTY\n  },\n}\n","import {isLiveEditEnabled} from '../utils/isLiveEditEnabled'\nimport {type OperationImpl} from './types'\n\nexport const del: OperationImpl<[], 'NOTHING_TO_DELETE'> = {\n  disabled: ({snapshots}) => (snapshots.draft || snapshots.published ? false : 'NOTHING_TO_DELETE'),\n  execute: ({client, schema, idPair, typeName}) => {\n    const tx = client.observable.transaction().delete(idPair.publishedId)\n\n    if (isLiveEditEnabled(schema, typeName)) {\n      return tx.commit({tag: 'document.delete'})\n    }\n\n    return tx.delete(idPair.draftId).commit({\n      tag: 'document.delete',\n      // this disables referential integrity for cross-dataset references. we\n      // have this set because we warn against deletes in the `ConfirmDeleteDialog`\n      // UI. This operation is run when \"delete anyway\" is clicked\n      skipCrossDatasetReferenceValidation: true,\n    })\n  },\n}\n","import {type OperationImpl} from './types'\n\ntype DisabledReason = 'NO_CHANGES' | 'NOT_PUBLISHED'\n\nexport const discardChanges: OperationImpl<[], DisabledReason> = {\n  disabled: ({snapshots}) => {\n    if (!snapshots.draft) {\n      return 'NO_CHANGES'\n    }\n    if (!snapshots.published) {\n      return 'NOT_PUBLISHED'\n    }\n    return false\n  },\n  execute: ({client, idPair}) => {\n    return client.observable\n      .transaction()\n      .delete(idPair.draftId)\n      .commit({tag: 'document.discard-changes'})\n  },\n}\n","import {omit} from 'lodash'\n\nimport {getDraftId} from '../../../../../util'\nimport {isLiveEditEnabled} from '../utils/isLiveEditEnabled'\nimport {type OperationImpl} from './types'\n\nconst omitProps = ['_createdAt', '_updatedAt']\n\nexport const duplicate: OperationImpl<[baseDocumentId: string], 'NOTHING_TO_DUPLICATE'> = {\n  disabled: ({snapshots}) => {\n    return snapshots.published || snapshots.draft ? false : 'NOTHING_TO_DUPLICATE'\n  },\n  execute: ({schema, client, snapshots, typeName}, dupeId) => {\n    const source = snapshots.draft || snapshots.published\n\n    if (!source) {\n      throw new Error('cannot execute on empty document')\n    }\n\n    return client.observable.create(\n      {\n        ...omit(source, omitProps),\n        _id: isLiveEditEnabled(schema, typeName) ? dupeId : getDraftId(dupeId),\n        _type: source._type,\n      },\n      {\n        tag: 'document.duplicate',\n      },\n    )\n  },\n}\n","import {isLiveEditEnabled} from '../utils/isLiveEditEnabled'\nimport {type OperationImpl} from './types'\n\n// todo: we could also consider exposing 'mutate' directly\nexport const patch: OperationImpl<[patches: any[], initialDocument?: Record<string, any>]> = {\n  disabled: (): false => false,\n  execute: (\n    {schema, snapshots, idPair, draft, published, typeName},\n    patches = [],\n    initialDocument,\n  ): void => {\n    if (isLiveEditEnabled(schema, typeName)) {\n      // No drafting, so patch and commit the published document\n      published.mutate([\n        published.createIfNotExists({\n          _type: typeName,\n          ...initialDocument,\n        }),\n        ...published.patch(patches),\n      ])\n    } else {\n      draft.mutate([\n        draft.createIfNotExists({\n          ...initialDocument,\n          ...snapshots.published,\n          _id: idPair.draftId,\n          _type: typeName,\n        }),\n        ...draft.patch(patches),\n      ])\n    }\n  },\n}\n","import {isReference} from '@sanity/types'\nimport {omit} from 'lodash'\n\nimport {isLiveEditEnabled} from '../utils/isLiveEditEnabled'\nimport {type OperationImpl} from './index'\n\nfunction strengthenOnPublish<T = any>(obj: T): T {\n  if (isReference(obj)) {\n    if (obj._strengthenOnPublish) {\n      return omit(\n        obj,\n        ['_strengthenOnPublish'].concat(obj._strengthenOnPublish.weak ? [] : ['_weak']),\n      ) as T\n    }\n    return obj\n  }\n  if (typeof obj !== 'object' || !obj) return obj\n  if (Array.isArray(obj)) return obj.map(strengthenOnPublish) as T\n  return Object.fromEntries(\n    Object.entries(obj).map(([key, value]) => [key, strengthenOnPublish(value)] as const),\n  ) as T\n}\n\ntype DisabledReason = 'LIVE_EDIT_ENABLED' | 'ALREADY_PUBLISHED' | 'NO_CHANGES'\n\nexport const publish: OperationImpl<[], DisabledReason> = {\n  disabled: ({schema, typeName, snapshots}) => {\n    if (isLiveEditEnabled(schema, typeName)) {\n      return 'LIVE_EDIT_ENABLED'\n    }\n    if (!snapshots.draft) {\n      return snapshots.published ? 'ALREADY_PUBLISHED' : 'NO_CHANGES'\n    }\n    return false\n  },\n  execute: ({client, idPair, snapshots}) => {\n    if (!snapshots.draft) {\n      throw new Error('cannot execute \"publish\" when draft is missing')\n    }\n    const value = strengthenOnPublish(omit(snapshots.draft, '_updatedAt'))\n    const tx = client.observable.transaction()\n    if (!snapshots.draft) {\n      throw new Error('cannot execute \"publish\" when draft is missing')\n    }\n\n    if (snapshots.published) {\n      // If it exists already, we only want to update it if the revision on the remote server\n      // matches what our local state thinks it's at\n      tx.patch(idPair.publishedId, {\n        // Hack until other mutations support revision locking\n        unset: ['_revision_lock_pseudo_field_'],\n        ifRevisionID: snapshots.published._rev,\n      })\n\n      tx.createOrReplace({\n        ...value,\n        _id: idPair.publishedId,\n        _type: snapshots.draft._type,\n      })\n    } else {\n      // If the document has not been published, we want to create it - if it suddenly exists\n      // before being created, we don't want to overwrite if, instead we want to yield an error\n      tx.create({\n        ...value,\n        _id: idPair.publishedId,\n        _type: snapshots.draft._type,\n      })\n    }\n\n    tx.delete(idPair.draftId)\n\n    return tx.commit({tag: 'document.publish', visibility: 'async'})\n  },\n}\n","import {isLiveEditEnabled} from '../utils/isLiveEditEnabled'\nimport {type OperationImpl} from './types'\n\nexport const restore: OperationImpl<[fromRevision: string]> = {\n  disabled: (): false => false,\n  execute: ({historyStore, schema, idPair, typeName}, fromRevision: string) => {\n    const targetId = isLiveEditEnabled(schema, typeName) ? idPair.publishedId : idPair.draftId\n    return historyStore.restore(idPair.publishedId, targetId, fromRevision)\n  },\n}\n","import {omit} from 'lodash'\n\nimport {isLiveEditEnabled} from '../utils/isLiveEditEnabled'\nimport {type OperationImpl} from './types'\n\ntype DisabledReason = 'LIVE_EDIT_ENABLED' | 'NOT_PUBLISHED'\n\nexport const unpublish: OperationImpl<[], DisabledReason> = {\n  disabled: ({schema, snapshots, typeName}) => {\n    if (isLiveEditEnabled(schema, typeName)) {\n      return 'LIVE_EDIT_ENABLED'\n    }\n    return snapshots.published ? false : 'NOT_PUBLISHED'\n  },\n  execute: ({client, idPair, snapshots}) => {\n    let tx = client.observable.transaction().delete(idPair.publishedId)\n\n    if (snapshots.published) {\n      tx = tx.createIfNotExists({\n        ...omit(snapshots.published, '_updatedAt'),\n        _id: idPair.draftId,\n        _type: snapshots.published._type,\n      })\n    }\n\n    return tx.commit({\n      tag: 'document.unpublish',\n      visibility: 'async',\n      // this disables referential integrity for cross-dataset references. we\n      // have this set because we warn against unpublishes in the `ConfirmDeleteDialog`\n      // UI. This operation is run when \"unpublish anyway\" is clicked\n      skipCrossDatasetReferenceValidation: true,\n    })\n  },\n}\n","/* eslint-disable max-nested-callbacks */\nimport {type SanityClient} from '@sanity/client'\nimport {type Schema} from '@sanity/types'\nimport {asyncScheduler, defer, EMPTY, merge, type Observable, of, Subject} from 'rxjs'\nimport {\n  catchError,\n  filter,\n  groupBy,\n  last,\n  map,\n  mergeMap,\n  mergeMapTo,\n  share,\n  switchMap,\n  take,\n  tap,\n  throttleTime,\n} from 'rxjs/operators'\n\nimport {type HistoryStore} from '../../history'\nimport {type IdPair} from '../types'\nimport {memoize} from '../utils/createMemoizer'\nimport {consistencyStatus} from './consistencyStatus'\nimport {operationArgs} from './operationArgs'\nimport {type OperationArgs, type OperationsAPI} from './operations'\nimport {commit} from './operations/commit'\nimport {del} from './operations/delete'\nimport {discardChanges} from './operations/discardChanges'\nimport {duplicate} from './operations/duplicate'\nimport {patch} from './operations/patch'\nimport {publish} from './operations/publish'\nimport {restore} from './operations/restore'\nimport {unpublish} from './operations/unpublish'\n\ninterface ExecuteArgs {\n  operationName: keyof OperationsAPI\n  idPair: IdPair\n  typeName: string\n  extraArgs: any[]\n}\n\nfunction maybeObservable(v: void | Observable<any>) {\n  return typeof v === 'undefined' ? of(null) : v\n}\n\nconst operationImpls = {\n  del: del,\n  delete: del,\n  publish,\n  patch,\n  commit,\n  discardChanges,\n  unpublish,\n  duplicate,\n  restore,\n} as const\n\nconst execute = (\n  operationName: keyof typeof operationImpls,\n  operationArguments: OperationArgs,\n  extraArgs: any[],\n): Observable<any> => {\n  const operation = operationImpls[operationName]\n  return defer(() =>\n    merge(of(null), maybeObservable(operation.execute(operationArguments, ...extraArgs))),\n  ).pipe(last())\n}\n\nconst operationCalls$ = new Subject<ExecuteArgs>()\n\n/** @internal */\nexport function emitOperation(\n  operationName: keyof OperationsAPI,\n  idPair: IdPair,\n  typeName: string,\n  extraArgs: any[],\n): void {\n  operationCalls$.next({operationName, idPair, typeName, extraArgs})\n}\n\n// These are the operations that cannot be performed while the document is in an inconsistent state\nconst REQUIRES_CONSISTENCY = ['publish', 'unpublish', 'discardChanges', 'delete']\n\n/**\n * @hidden\n * @beta */\nexport interface OperationError {\n  type: 'error'\n  /** @internal */\n  op: keyof OperationsAPI\n  id: string\n  error: Error\n}\n\n/**\n * @hidden\n * @beta */\nexport interface OperationSuccess {\n  type: 'success'\n  /** @internal */\n  op: keyof OperationsAPI\n  id: string\n}\n\ninterface IntermediarySuccess {\n  type: 'success'\n  args: ExecuteArgs\n}\n\ninterface IntermediaryError {\n  type: 'error'\n  args: ExecuteArgs\n  error: any\n}\n\n/** @internal */\nexport const operationEvents = memoize(\n  (ctx: {client: SanityClient; historyStore: HistoryStore; schema: Schema}) => {\n    const result$: Observable<IntermediarySuccess | IntermediaryError> = operationCalls$.pipe(\n      groupBy((op) => op.idPair.publishedId),\n      mergeMap((groups$) =>\n        groups$.pipe(\n          // although it might look like a bug, dropping pending async operations here is actually a feature\n          // E.g. if the user types `publish` which is async and then starts patching (sync) then the publish\n          // should be cancelled\n          switchMap((args) =>\n            operationArgs(ctx, args.idPair, args.typeName).pipe(\n              take(1),\n              switchMap((operationArguments) => {\n                const requiresConsistency = REQUIRES_CONSISTENCY.includes(args.operationName)\n                if (requiresConsistency) {\n                  operationArguments.published.commit()\n                  operationArguments.draft.commit()\n                }\n                const isConsistent$ = consistencyStatus(\n                  ctx.client,\n                  args.idPair,\n                  args.typeName,\n                ).pipe(filter(Boolean))\n                const ready$ = requiresConsistency ? isConsistent$.pipe(take(1)) : of(true)\n                return ready$.pipe(\n                  switchMap(() => execute(args.operationName, operationArguments, args.extraArgs)),\n                )\n              }),\n              map((): IntermediarySuccess => ({type: 'success', args})),\n              catchError(\n                (err): Observable<IntermediaryError> => of({type: 'error', args, error: err}),\n              ),\n            ),\n          ),\n        ),\n      ),\n      share(),\n    )\n\n    // this enables autocommit after patch operations\n    const AUTOCOMMIT_INTERVAL = 1000\n    const autoCommit$ = result$.pipe(\n      filter((result) => result.type === 'success' && result.args.operationName === 'patch'),\n      throttleTime(AUTOCOMMIT_INTERVAL, asyncScheduler, {leading: true, trailing: true}),\n      tap((result) => {\n        emitOperation('commit', result.args.idPair, result.args.typeName, [])\n      }),\n    )\n\n    return merge(result$, autoCommit$.pipe(mergeMapTo(EMPTY)))\n  },\n  (ctx) => {\n    const config = ctx.client.config()\n    // we only want one of these per dataset+projectid\n    return `${config.dataset ?? ''}-${config.projectId ?? ''}`\n  },\n)\n","import {type SanityClient} from '@sanity/client'\nimport {isReference, type Schema, type ValidationMarker} from '@sanity/types'\nimport {reduce as reduceJSON} from 'json-reduce'\nimport {omit} from 'lodash'\nimport {\n  asyncScheduler,\n  combineLatest,\n  concat,\n  defer,\n  from,\n  lastValueFrom,\n  type Observable,\n  of,\n  timer,\n} from 'rxjs'\nimport {\n  distinct,\n  distinctUntilChanged,\n  first,\n  groupBy,\n  map,\n  mergeMap,\n  scan,\n  shareReplay,\n  skip,\n  throttleTime,\n} from 'rxjs/operators'\nimport {exhaustMapWithTrailing} from 'rxjs-exhaustmap-with-trailing'\nimport shallowEquals from 'shallow-equals'\n\nimport {type SourceClientOptions} from '../../../../config'\nimport {type LocaleSource} from '../../../../i18n'\nimport {type DraftsModelDocumentAvailability} from '../../../../preview'\nimport {validateDocumentObservable, type ValidationContext} from '../../../../validation'\nimport {type IdPair} from '../types'\nimport {memoize} from '../utils/createMemoizer'\nimport {editState} from './editState'\n\n/**\n * @hidden\n * @beta */\nexport interface ValidationStatus {\n  isValidating: boolean\n  validation: ValidationMarker[]\n  revision?: string\n}\n\nconst INITIAL_VALIDATION_STATUS: ValidationStatus = {\n  isValidating: true,\n  validation: [],\n}\n\nfunction findReferenceIds(obj: any): Set<string> {\n  return reduceJSON(\n    obj,\n    (acc, node) => {\n      if (isReference(node)) {\n        acc.add(node._ref)\n      }\n      return acc\n    },\n    new Set<string>(),\n  )\n}\n\nconst EMPTY_VALIDATION: ValidationMarker[] = []\n\ntype GetDocumentExists = NonNullable<ValidationContext['getDocumentExists']>\n\ntype ObserveDocumentPairAvailability = (id: string) => Observable<DraftsModelDocumentAvailability>\n\nconst listenDocumentExists = (\n  observeDocumentAvailability: ObserveDocumentPairAvailability,\n  id: string,\n): Observable<boolean> =>\n  observeDocumentAvailability(id).pipe(map(({published}) => published.available))\n\n// throttle delay for document updates (i.e. time between responding to changes in the current document)\nconst DOC_UPDATE_DELAY = 200\n\n// throttle delay for referenced document updates (i.e. time between responding to changes in referenced documents)\nconst REF_UPDATE_DELAY = 1000\n\nfunction shareLatestWithRefCount<T>() {\n  return shareReplay<T>({bufferSize: 1, refCount: true})\n}\n\n/** @internal */\nexport const validation = memoize(\n  (\n    ctx: {\n      client: SanityClient\n      getClient: (options: SourceClientOptions) => SanityClient\n      observeDocumentPairAvailability: ObserveDocumentPairAvailability\n      schema: Schema\n      i18n: LocaleSource\n    },\n    {draftId, publishedId}: IdPair,\n    typeName: string,\n  ): Observable<ValidationStatus> => {\n    const document$ = editState(ctx, {draftId, publishedId}, typeName).pipe(\n      map(({draft, published}) => draft || published),\n      throttleTime(DOC_UPDATE_DELAY, asyncScheduler, {trailing: true}),\n      distinctUntilChanged((prev, next) => {\n        if (prev?._rev === next?._rev) {\n          return true\n        }\n        // _rev and _updatedAt may change without other fields changing (due to a limitation in mutator)\n        // so only pass on documents if _other_ attributes changes\n        return shallowEquals(omit(prev, '_rev', '_updatedAt'), omit(next, '_rev', '_updatedAt'))\n      }),\n      shareLatestWithRefCount(),\n    )\n\n    const referenceIds$ = document$.pipe(\n      map((document) => findReferenceIds(document)),\n      mergeMap((ids) => from(ids)),\n    )\n\n    // Note: we only use this to trigger a re-run of validation when a referenced document is published/unpublished\n    const referenceExistence$ = referenceIds$.pipe(\n      groupBy((id) => id, {duration: () => timer(1000 * 60 * 30)}),\n      mergeMap((id$) =>\n        id$.pipe(\n          distinct(),\n          mergeMap((id) =>\n            listenDocumentExists(ctx.observeDocumentPairAvailability, id).pipe(\n              map(\n                // eslint-disable-next-line max-nested-callbacks\n                (result) => [id, result] as const,\n              ),\n            ),\n          ),\n        ),\n      ),\n      scan((acc: Record<string, boolean>, [id, result]): Record<string, boolean> => {\n        if (acc[id] === result) {\n          return acc\n        }\n        return {...acc, [id]: result}\n      }, {}),\n      distinctUntilChanged(shallowEquals),\n      shareLatestWithRefCount(),\n    )\n\n    // Provided to individual validation functions to support using existence of a weakly referenced document\n    // as part of the validation rule (used by references in place)\n    const getDocumentExists: GetDocumentExists = ({id}) =>\n      lastValueFrom(\n        referenceExistence$.pipe(\n          // If the id is not present as key in the `referenceExistence` map it means it's existence status\n          // isn't yet loaded, so we want to wait until it is\n          first((referenceExistence) => id in referenceExistence),\n          map((referenceExistence) => referenceExistence[id]),\n        ),\n      )\n\n    const referenceDocumentUpdates$ = referenceExistence$.pipe(\n      // we'll skip the first emission since the document already gets an initial validation pass\n      // we're only interested in updates in referenced documents after that\n      skip(1),\n      throttleTime(REF_UPDATE_DELAY, asyncScheduler, {leading: true, trailing: true}),\n    )\n\n    return combineLatest([document$, concat(of(null), referenceDocumentUpdates$)]).pipe(\n      map(([document]) => document),\n      exhaustMapWithTrailing((document) => {\n        return defer(() => {\n          if (!document?._type) {\n            return of({validation: EMPTY_VALIDATION, isValidating: false})\n          }\n          return concat(\n            of({isValidating: true, revision: document._rev}),\n            validateDocumentObservable({\n              document,\n              getClient: ctx.getClient,\n              getDocumentExists,\n              i18n: ctx.i18n,\n              schema: ctx.schema,\n              environment: 'studio',\n            }).pipe(\n              map((validationMarkers) => ({validation: validationMarkers, isValidating: false})),\n            ),\n          )\n        })\n      }),\n      scan((acc, next) => ({...acc, ...next}), INITIAL_VALIDATION_STATUS),\n      shareLatestWithRefCount(),\n    )\n  },\n  (ctx, idPair, typeName) => {\n    const config = ctx.client.config()\n\n    return `${config.dataset ?? ''}-${config.projectId ?? ''}-${idPair.publishedId}-${typeName}`\n  },\n)\n","import {type SanityClient} from '@sanity/client'\nimport {merge, type Observable} from 'rxjs'\nimport {switchMap} from 'rxjs/operators'\n\nimport {type IdPair} from '../types'\nimport {memoize} from '../utils/createMemoizer'\nimport {type DocumentVersionEvent} from './checkoutPair'\nimport {memoizedPair} from './memoizedPair'\nimport {memoizeKeyGen} from './memoizeKeyGen'\n\n// A stream of all events related to either published or draft, each event comes with a 'target'\n// that specifies which version (draft|published) the event is about\nexport const documentEvents = memoize(\n  (client: SanityClient, idPair: IdPair, typeName: string): Observable<DocumentVersionEvent> => {\n    return memoizedPair(client, idPair, typeName).pipe(\n      switchMap(({draft, published}) => merge(draft.events, published.events)),\n    )\n  },\n  memoizeKeyGen,\n)\n","import {type IdPair} from '../../types'\nimport {emitOperation} from '../operationEvents'\nimport {commit} from './commit'\nimport {del} from './delete'\nimport {discardChanges} from './discardChanges'\nimport {duplicate} from './duplicate'\nimport {patch} from './patch'\nimport {publish} from './publish'\nimport {restore} from './restore'\nimport {type Operation, type OperationArgs, type OperationImpl, type OperationsAPI} from './types'\nimport {unpublish} from './unpublish'\n\nfunction createOperationGuard(opName: string): Operation<any[], 'NOT_READY'> {\n  return {\n    disabled: 'NOT_READY',\n    execute: () => {\n      throw new Error(`Called ${opName} before it was ready.`)\n    },\n  }\n}\n\n// This creates a version of the operations api that will throw if called.\n// Most operations depend on having the \"current document state\" available locally and if an action gets called\n// before we have the state available, we throw an error to signal \"premature\" invocation before ready\nexport const GUARDED: OperationsAPI = {\n  commit: createOperationGuard('commit'),\n  delete: createOperationGuard('delete'),\n  del: createOperationGuard('del'),\n  publish: createOperationGuard('publish'),\n  patch: createOperationGuard('patch'),\n  discardChanges: createOperationGuard('discardChanges'),\n  unpublish: createOperationGuard('unpublish'),\n  duplicate: createOperationGuard('duplicate'),\n  restore: createOperationGuard('restore'),\n}\nconst createEmitter =\n  (operationName: keyof OperationsAPI, idPair: IdPair, typeName: string) =>\n  (...executeArgs: any[]) =>\n    emitOperation(operationName, idPair, typeName, executeArgs)\n\nfunction wrap<ExtraArgs extends any[], DisabledReason extends string>(\n  opName: keyof OperationsAPI,\n  op: OperationImpl<ExtraArgs, DisabledReason>,\n  operationArgs: OperationArgs,\n): Operation<ExtraArgs, DisabledReason> {\n  const disabled = op.disabled(operationArgs)\n  return {\n    disabled,\n    execute: createEmitter(opName, operationArgs.idPair, operationArgs.typeName),\n  }\n}\n\nexport function createOperationsAPI(args: OperationArgs): OperationsAPI {\n  return {\n    commit: wrap('commit', commit, args),\n    delete: wrap('delete', del, args),\n    del: wrap('delete', del, args),\n    publish: wrap('publish', publish, args),\n    patch: wrap('patch', patch, args),\n    discardChanges: wrap('discardChanges', discardChanges, args),\n    unpublish: wrap('unpublish', unpublish, args),\n    duplicate: wrap('duplicate', duplicate, args),\n    restore: wrap('restore', restore, args),\n  }\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type Schema} from '@sanity/types'\nimport {concat, EMPTY, merge, type Observable, of} from 'rxjs'\nimport {map, mergeMap, shareReplay} from 'rxjs/operators'\n\nimport {type HistoryStore} from '../../history'\nimport {type IdPair} from '../types'\nimport {memoize} from '../utils/createMemoizer'\nimport {memoizeKeyGen} from './memoizeKeyGen'\nimport {operationArgs} from './operationArgs'\nimport {operationEvents} from './operationEvents'\nimport {type OperationsAPI} from './operations'\nimport {createOperationsAPI, GUARDED} from './operations/helpers'\n\nexport const editOperations = memoize(\n  (\n    ctx: {\n      client: SanityClient\n      historyStore: HistoryStore\n      schema: Schema\n    },\n    idPair: IdPair,\n    typeName: string,\n  ): Observable<OperationsAPI> => {\n    const operationEvents$ = operationEvents(ctx)\n\n    const operationArgs$ = operationArgs(ctx, idPair, typeName)\n    const operations$ = operationArgs$.pipe(map(createOperationsAPI))\n\n    // To makes sure we connect the stream that actually performs the operations\n    return concat(\n      of(GUARDED),\n      merge(operationEvents$.pipe(mergeMap(() => EMPTY)), operations$),\n    ).pipe(shareReplay({refCount: true, bufferSize: 1}))\n  },\n  (ctx, idPair, typeName) => memoizeKeyGen(ctx.client, idPair, typeName),\n)\n","import {isPlainObject} from 'lodash'\n\nexport function isRecord(value: unknown): value is Record<string, unknown> {\n  return isPlainObject(value)\n}\n","import {isRecord} from './isRecord'\n\n// deep object assign for objects\n// note: doesn't mutate target\nexport default function deepAssign(\n  target: Record<string, unknown>,\n  source: Record<string, unknown>,\n): Record<string, unknown> {\n  const result = {...target, ...source}\n\n  Object.keys(result).forEach((key) => {\n    const sourceVal = source[key]\n    const targetVal = target[key]\n    if (isRecord(sourceVal) && isRecord(targetVal)) {\n      result[key] = deepAssign(targetVal, sourceVal)\n    }\n  })\n  return result\n}\n","import {type Schema} from '@sanity/types'\nimport {randomKey} from '@sanity/util/content'\nimport {toString as pathToString} from '@sanity/util/paths'\n\nimport {type Template, type TemplateParameter} from './types'\nimport {isRecord} from './util/isRecord'\n\nconst ALLOWED_REF_PROPS = [\n  '_dataset',\n  '_projectId',\n  '_strengthenOnPublish',\n  '_key',\n  '_ref',\n  '_type',\n  '_weak',\n]\nconst REQUIRED_TEMPLATE_PROPS: (keyof Template)[] = ['id', 'title', 'schemaType', 'value']\n\nfunction templateId(template: Template, i: number) {\n  return quote(template.id || template.title) || (typeof i === 'number' && `at index ${i}`) || ''\n}\n\nfunction quote(str: string) {\n  return str && str.length > 0 ? `\"${str}\"` : str\n}\n\nexport function validateTemplates(schema: Schema, templates: Template[]): Template[] {\n  const idMap = new Map()\n\n  templates.forEach((template, i) => {\n    const id = templateId(template, i)\n\n    if (typeof (template as {[key: string]: any}).values !== 'undefined' && !template.value) {\n      throw new Error(`Template ${id} is missing \"value\" property, but contained \"values\". Typo?`)\n    }\n\n    const missing = REQUIRED_TEMPLATE_PROPS.filter((prop) => !template[prop])\n    if (missing.length > 0) {\n      throw new Error(`Template ${id} is missing required properties: ${missing.join(', ')}`)\n    }\n\n    if (typeof template.value !== 'function' && !isRecord(template.value)) {\n      throw new Error(\n        `Template ${id} has an invalid \"value\" property; should be a function or an object`,\n      )\n    }\n\n    if (typeof template.parameters !== 'undefined') {\n      if (Array.isArray(template.parameters)) {\n        template.parameters.forEach((param, j) => validateParameter(schema, param, template, j))\n      } else {\n        throw new Error(`Template ${id} has an invalid \"parameters\" property; must be an array`)\n      }\n    }\n\n    if (idMap.has(template.id)) {\n      const dupeIndex = idMap.get(template.id)\n      const dupe = `${quote(templates[dupeIndex].title)} at index ${dupeIndex}`\n      throw new Error(\n        `Template \"${template.title}\" at index ${i} has the same ID (\"${template.id}\") as template ${dupe}`,\n      )\n    }\n\n    idMap.set(template.id, i)\n  })\n\n  return templates\n}\n\nexport function validateInitialObjectValue<T extends Record<string, unknown>>(\n  value: T,\n  template: Template,\n): T {\n  const contextError = (msg: string) => `Template \"${template.id}\" initial value: ${msg}`\n\n  if (!isRecord(value)) {\n    throw new Error(contextError(`resolved to a non-object`))\n  }\n\n  if (value._type && template.schemaType !== value._type) {\n    throw new Error(\n      contextError(\n        `includes \"_type\"-property (${value._type}) that does not match template (${template.schemaType})`,\n      ),\n    )\n  }\n\n  try {\n    return validateValue(value)\n  } catch (err) {\n    err.message = contextError(err.message)\n    throw err\n  }\n}\n\nfunction validateValue(value: unknown, path: (string | number)[] = [], parentIsArray = false): any {\n  if (Array.isArray(value)) {\n    return value.map((item, i) => {\n      if (Array.isArray(item)) {\n        throw new Error(\n          `multidimensional arrays are not supported (at path \"${pathToString(path)}\")`,\n        )\n      }\n\n      return validateValue(item, path.concat(i), true)\n    })\n  }\n\n  if (!isRecord(value)) {\n    return value\n  }\n\n  // Apply missing keys is the parent is an array\n  const initial: {[key: string]: any} = parentIsArray && !value._key ? {_key: randomKey()} : {}\n\n  // Ensure non-root objects have _type\n  if (path.length > 0 && !value._type) {\n    if (value._ref) {\n      // In the case of references, we know what the type should be, so apply it\n      initial._type = 'reference'\n    } else {\n      // todo: consider if we need to re-instantiate this. It currently makes the valid case of having an initial object value for a field fail\n      // throw new Error(`missing \"_type\" property at path \"${pathToString(path)}\"`)\n    }\n  }\n\n  if (value._ref) {\n    validateReference(value, path)\n  }\n\n  // Validate deeply\n  return Object.keys(value).reduce((acc, key) => {\n    acc[key] = validateValue(value[key], path.concat([key]))\n    return acc\n  }, initial)\n}\n\nfunction validateParameter(\n  schema: Schema,\n  parameter: TemplateParameter,\n  template: Template,\n  index: number,\n) {\n  // const schema = getDefaultSchema()\n\n  if (!parameter.name) {\n    throw new Error(\n      `Template ${template.id} has a parameter at index ${index} that is missing its \"name\"-property`,\n    )\n  }\n\n  // I know, this is a weird one\n  if (parameter.name === 'template') {\n    throw new Error(\n      `Template parameters cannot be named \"template\", see parameter #${index} for template ${template.id}`,\n    )\n  }\n\n  if (!schema.get(parameter.type)) {\n    throw new Error(\n      `Template parameter \"${parameter.name}\" has an invalid/unknown type: \"${parameter.type}\"`,\n    )\n  }\n}\n\nfunction validateReference(\n  value: {_type?: unknown; type?: unknown},\n  path: (string | number)[] = [],\n) {\n  if (!value._type && value.type) {\n    throw new Error(\n      `Reference is missing \"_type\", but has a \"type\" property at path \"${pathToString(path)}\"`,\n    )\n  }\n\n  const disallowed = Object.keys(value).filter((key) => !ALLOWED_REF_PROPS.includes(key))\n  if (disallowed.length > 0) {\n    const plural = disallowed.length > 1 ? 'properties' : 'property'\n    throw new Error(\n      `Disallowed ${plural} found in reference: ${disallowed\n        .map(quote)\n        .join(', ')} at path \"${pathToString(path)}\"`,\n    )\n  }\n}\n","import {\n  type ArraySchemaType,\n  type InitialValueProperty,\n  type InitialValueResolver,\n  type InitialValueResolverContext,\n  isArraySchemaType,\n  isObjectSchemaType,\n  type ObjectSchemaType,\n  type Schema,\n  type SchemaType,\n} from '@sanity/types'\nimport {isDeepEmpty, randomKey, resolveTypeName} from '@sanity/util/content'\n\nimport {type Template} from './types'\nimport deepAssign from './util/deepAssign'\nimport {isRecord} from './util/isRecord'\nimport {validateInitialObjectValue} from './validate'\n\n/** @internal */\nexport type Serializeable<T> = {\n  serialize(): T\n}\n\n/** @internal */\nexport function isBuilder(template: unknown): template is Serializeable<Template> {\n  return isRecord(template) && typeof template.serialize === 'function'\n}\n\n/** @internal */\n// returns the \"resolved\" value from an initial value property (e.g. type.initialValue)\n// eslint-disable-next-line require-await\nexport async function resolveValue<Params, InitialValue>(\n  initialValueOpt: InitialValueProperty<Params, InitialValue>,\n  params: Params | undefined,\n  context: InitialValueResolverContext,\n): Promise<InitialValue | undefined> {\n  return typeof initialValueOpt === 'function'\n    ? (initialValueOpt as InitialValueResolver<Params, InitialValue>)(params, context)\n    : initialValueOpt\n}\n\n/** @internal */\nexport async function resolveInitialValue(\n  schema: Schema,\n  template: Template,\n  params: {[key: string]: any} = {},\n  context: InitialValueResolverContext,\n): Promise<{[key: string]: any}> {\n  // Template builder?\n  if (isBuilder(template)) {\n    return resolveInitialValue(schema, template.serialize(), params, context)\n  }\n\n  const {id, schemaType: schemaTypeName, value} = template\n  if (!value) {\n    throw new Error(`Template \"${id}\" has invalid \"value\" property`)\n  }\n\n  let resolvedValue = await resolveValue(value, params, context)\n\n  if (!isRecord(resolvedValue)) {\n    throw new Error(\n      `Template \"${id}\" has invalid \"value\" property - must be a plain object or a resolver function returning a plain object`,\n    )\n  }\n\n  // Ensure _type is set on empty objects\n  if (isRecord(resolvedValue) && !Object.keys(resolvedValue).length) {\n    resolvedValue = {_type: schemaTypeName}\n  }\n\n  // validate default document initial values\n  resolvedValue = validateInitialObjectValue(resolvedValue, template)\n\n  // Get deep initial values from schema types (note: the initial value from template overrides the types)\n  const schemaType = schema.get(schemaTypeName)\n  if (!schemaType) {\n    throw new Error(`Could not find schema type with name \"${schemaTypeName}\".`)\n  }\n\n  const newValue = deepAssign(\n    (await resolveInitialValueForType(schemaType, params, DEFAULT_MAX_RECURSION_DEPTH, context)) ||\n      {},\n    resolvedValue as Record<string, unknown>,\n  )\n\n  // revalidate and return new initial values\n  // todo: would be better to do validation as part of type resolution\n  return validateInitialObjectValue(newValue, template)\n}\n\n/** @internal */\nexport function getItemType(arrayType: ArraySchemaType, item: unknown): SchemaType | undefined {\n  const itemTypeName = resolveTypeName(item)\n\n  return itemTypeName === 'object' && arrayType.of.length === 1\n    ? arrayType.of[0]\n    : arrayType.of.find((memberType) => memberType.name === itemTypeName)\n}\n\n/** @internal */\nexport const DEFAULT_MAX_RECURSION_DEPTH = 10\n\n/**\n * Resolve initial value for the given schema type (recursively)\n *\n * @internal\n */\nexport function resolveInitialValueForType<Params extends Record<string, unknown>>(\n  /**\n   * This is the name of the document.\n   */\n  type: SchemaType,\n  /**\n   * Params is a sanity context object passed to every initial value function.\n   */\n  params: Params,\n  /**\n   * Maximum recursion depth (default 9).\n   */\n  maxDepth = DEFAULT_MAX_RECURSION_DEPTH,\n  context: InitialValueResolverContext,\n): Promise<any> {\n  if (maxDepth <= 0) {\n    return Promise.resolve(undefined)\n  }\n\n  if (isObjectSchemaType(type)) {\n    return resolveInitialObjectValue(type, params, maxDepth, context)\n  }\n\n  if (isArraySchemaType(type)) {\n    return resolveInitialArrayValue(type, params, maxDepth, context)\n  }\n\n  return resolveValue(type.initialValue, params, context)\n}\n\nasync function resolveInitialArrayValue<Params extends Record<string, unknown>>(\n  type: SchemaType,\n  params: Params,\n  maxDepth: number,\n  context: InitialValueResolverContext,\n): Promise<any> {\n  const initialArray = await resolveValue(type.initialValue, undefined, context)\n\n  if (!Array.isArray(initialArray)) {\n    return undefined\n  }\n\n  return Promise.all(\n    initialArray.map(async (initialItem) => {\n      const itemType = getItemType(type as ArraySchemaType, initialItem)!\n      return isObjectSchemaType(itemType)\n        ? {\n            ...initialItem,\n            ...(await resolveInitialValueForType(itemType, params, maxDepth - 1, context)),\n            _key: randomKey(),\n          }\n        : initialItem\n    }),\n  )\n}\n\n/** @internal */\nexport async function resolveInitialObjectValue<Params extends Record<string, unknown>>(\n  type: ObjectSchemaType,\n  params: Params,\n  maxDepth: number,\n  context: InitialValueResolverContext,\n): Promise<any> {\n  const initialObject: Record<string, unknown> = {\n    ...((await resolveValue(type.initialValue, params, context)) || {}),\n  }\n\n  const fieldValues: Record<string, any> = {}\n  await Promise.all(\n    type.fields.map(async (field) => {\n      const initialFieldValue = await resolveInitialValueForType(\n        field.type,\n        params,\n        maxDepth - 1,\n        context,\n      )\n      if (initialFieldValue !== undefined && initialFieldValue !== null) {\n        fieldValues[field.name] = initialFieldValue\n      }\n    }),\n  )\n\n  const merged = deepAssign(fieldValues, initialObject)\n\n  if (isDeepEmpty(merged)) {\n    return undefined\n  }\n\n  if (type.name !== 'object') {\n    merged._type = type.name\n  }\n\n  return merged\n}\n","import {type InitialValueResolverContext, type Schema} from '@sanity/types'\nimport {from, merge, type Observable, of} from 'rxjs'\nimport {\n  catchError,\n  debounceTime,\n  distinctUntilChanged,\n  filter,\n  map,\n  scan,\n  startWith,\n  switchMap,\n} from 'rxjs/operators'\n\nimport {type DocumentPreviewStore} from '../../../../preview'\nimport {resolveInitialValue, type Template} from '../../../../templates'\nimport {getDraftId, getPublishedId} from '../../../../util'\nimport {\n  type InitialValueErrorMsg,\n  type InitialValueLoadingMsg,\n  type InitialValueMsg,\n  type InitialValueSuccessMsg,\n} from './types'\n\n/**\n * @hidden\n * @beta */\nexport interface InitialValueOptions {\n  documentId: string\n  documentType: string\n  templateName?: string\n  templateParams?: Record<string, any>\n}\n\nconst LOADING_MSG: InitialValueLoadingMsg = {type: 'loading'}\n\n/**\n * @internal\n */\nexport function getInitialValueStream(\n  schema: Schema,\n  initialValueTemplates: Template[],\n  documentPreviewStore: DocumentPreviewStore,\n  opts: InitialValueOptions,\n  context: InitialValueResolverContext,\n): Observable<InitialValueMsg> {\n  const draft$ = documentPreviewStore.observePaths(\n    {_type: 'reference', _ref: getDraftId(opts.documentId)},\n    ['_type'],\n  )\n\n  const published$ = documentPreviewStore.observePaths(\n    {_type: 'reference', _ref: getPublishedId(opts.documentId)},\n    ['_type'],\n  )\n\n  const value$ = merge(\n    draft$.pipe(map((draft) => ({draft}))),\n    published$.pipe(map((published) => ({published}))),\n  ).pipe(\n    scan((prev, res) => ({...prev, ...res}), {}),\n    // Wait until we know the state of both draft and published\n    filter((res) => 'draft' in res && 'published' in res),\n    map((res: any) => res.draft || res.published),\n    // Only update if we didn't previously have a document but we now do\n    distinctUntilChanged((prev, next) => Boolean(prev) !== Boolean(next)),\n    // Prevent rapid re-resolving when transitioning between different templates\n    debounceTime(25),\n  )\n\n  return value$.pipe(\n    switchMap((document) => {\n      // Already exists, so no initial value is needed\n      if (document) {\n        return of({type: 'success', value: null})\n      }\n\n      if (!opts.templateName) {\n        // @todo: Make sure this is the correct behavior\n        return of({isResolving: false, initialValue: undefined})\n      }\n\n      const template = initialValueTemplates.find((t) => t.id === opts.templateName)\n\n      if (!template) {\n        // eslint-disable-next-line no-console\n        console.warn('Template \"%s\" not defined, using empty initial value', opts.templateName)\n        return of({isResolving: false, initialValue: undefined})\n      }\n\n      const initialValueWithParams$ = from(\n        resolveInitialValue(schema, template, opts.templateParams, context),\n      )\n        .pipe(map((initialValue) => ({isResolving: false, initialValue})))\n        .pipe(\n          catchError((resolveError) => {\n            /* eslint-disable no-console */\n            console.group('Failed to resolve initial value')\n            console.error(resolveError)\n            console.error('Template ID: %s', opts.templateName)\n            console.error('Parameters: %o', opts.templateParams)\n            console.groupEnd()\n            /* eslint-enable no-console */\n\n            const msg: InitialValueErrorMsg = {type: 'error', error: resolveError}\n\n            return of(msg)\n          }),\n        )\n\n      return merge(of({isResolving: true}), initialValueWithParams$).pipe(\n        switchMap(({isResolving, initialValue, resolveError}: any) => {\n          if (resolveError) {\n            return of({type: 'error', message: 'Failed to resolve initial value'})\n          }\n\n          if (isResolving) {\n            return of(LOADING_MSG)\n          }\n\n          const msg: InitialValueSuccessMsg = {type: 'success', value: initialValue}\n\n          return of(msg)\n        }),\n      )\n    }),\n\n    startWith(LOADING_MSG),\n    distinctUntilChanged(),\n  ) as Observable<InitialValueMsg>\n}\n","import {type ClientPerspective, type SanityClient} from '@sanity/client'\nimport {asyncScheduler, defer, merge, type Observable, of, partition, throwError, timer} from 'rxjs'\nimport {filter, mergeMap, share, take, throttleTime} from 'rxjs/operators'\nimport {exhaustMapWithTrailing} from 'rxjs-exhaustmap-with-trailing'\n\nimport {type MutationEvent, type ReconnectEvent, type WelcomeEvent} from './types'\n\n/** @internal */\nexport type ListenQueryParams = Record<string, string | number | boolean | string[]>\n\n/**\n * @hidden\n * @beta */\nexport interface ListenQueryOptions {\n  tag?: string\n  apiVersion?: string\n  perspective?: ClientPerspective\n  throttleTime?: number\n  transitions?: ('update' | 'appear' | 'disappear')[]\n}\n\nconst fetch = (\n  client: SanityClient,\n  query: string,\n  params: ListenQueryParams,\n  options: ListenQueryOptions,\n) =>\n  defer(() =>\n    client.observable.fetch(query, params, {\n      tag: options.tag,\n      filterResponse: true,\n      perspective: options.perspective,\n    }),\n  )\n\nconst listen = (\n  client: SanityClient,\n  query: string,\n  params: ListenQueryParams,\n  options: ListenQueryOptions,\n) =>\n  defer(() =>\n    client.listen(query, params, {\n      events: ['welcome', 'mutation', 'reconnect'],\n      includeResult: false,\n      visibility: 'query',\n      tag: options.tag,\n    }),\n  ) as Observable<ReconnectEvent | WelcomeEvent | MutationEvent>\n\nfunction isWelcomeEvent(\n  event: MutationEvent | ReconnectEvent | WelcomeEvent,\n): event is WelcomeEvent {\n  return event.type === 'welcome'\n}\n\n/** @internal */\nexport function listenQuery(\n  client: SanityClient,\n  query: string | {fetch: string; listen: string},\n  params: ListenQueryParams = {},\n  options: ListenQueryOptions = {},\n): Observable<any> {\n  const fetchQuery = typeof query === 'string' ? query : query.fetch\n  const listenerQuery = typeof query === 'string' ? query : query.listen\n\n  const events$ = listen(client, listenerQuery, params, options).pipe(\n    mergeMap((ev, i) => {\n      const isFirst = i === 0\n      if (isFirst && !isWelcomeEvent(ev)) {\n        // if the first event is not welcome, it is most likely a reconnect and\n        // if it's not a reconnect something is very wrong\n        return throwError(\n          () =>\n            new Error(\n              ev.type === 'reconnect'\n                ? 'Could not establish EventSource connection'\n                : `Received unexpected type of first event \"${ev.type}\"`,\n            ),\n        )\n      }\n      return of(ev)\n    }),\n    share(),\n  )\n\n  const [welcome$, mutationAndReconnect$] = partition(events$, isWelcomeEvent)\n  const isRelevantEvent = (event: MutationEvent | ReconnectEvent | WelcomeEvent): boolean => {\n    if (!options.transitions || event.type !== 'mutation') {\n      return true\n    }\n\n    return options.transitions.includes(event.transition)\n  }\n\n  const doFetch = () => fetch(client, fetchQuery, params, options)\n\n  return merge(\n    welcome$.pipe(take(1)),\n    mutationAndReconnect$.pipe(\n      filter(isRelevantEvent),\n      throttleTime(options.throttleTime || 1000, asyncScheduler, {leading: true, trailing: true}),\n    ),\n  ).pipe(\n    exhaustMapWithTrailing((event) => {\n      if (event.type === 'mutation' && event.visibility !== 'query') {\n        // Even though the listener request specifies visibility=query, the events are not guaranteed to be delivered with visibility=query\n        // If the event we are responding to arrives with visibility != query, we add a little delay to allow for the updated document to be available for queries\n        // See https://www.sanity.io/docs/listening#visibility-c4786e55c3ff\n        return timer(1200).pipe(mergeMap(doFetch))\n      }\n      return doFetch()\n    }),\n  )\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type Observable, of} from 'rxjs'\nimport {map} from 'rxjs/operators'\n\nimport {getDraftId, getPublishedId} from '../../../util'\n\nexport function resolveTypeForDocument(\n  client: SanityClient,\n  id: string,\n  specifiedType = '*',\n): Observable<string> {\n  // if is resolved document type\n  if (specifiedType && specifiedType !== '*') {\n    return of(specifiedType)\n  }\n\n  const query = '*[_id in [$documentId, $draftId]]._type'\n  const documentId = getPublishedId(id)\n  const draftId = getDraftId(documentId)\n\n  return client.observable.fetch(query, {documentId, draftId}).pipe(map((types) => types[0]))\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type InitialValueResolverContext, type Schema} from '@sanity/types'\nimport {type Observable} from 'rxjs'\nimport {filter, map} from 'rxjs/operators'\n\nimport {type SourceClientOptions} from '../../../config'\nimport {type LocaleSource} from '../../../i18n'\nimport {type DocumentPreviewStore} from '../../../preview'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../studioClient'\nimport {type Template} from '../../../templates'\nimport {getDraftId, isDraftId} from '../../../util'\nimport {type HistoryStore} from '../history'\nimport {checkoutPair, type DocumentVersionEvent, type Pair} from './document-pair/checkoutPair'\nimport {consistencyStatus} from './document-pair/consistencyStatus'\nimport {documentEvents} from './document-pair/documentEvents'\nimport {editOperations} from './document-pair/editOperations'\nimport {editState, type EditStateFor} from './document-pair/editState'\nimport {\n  type OperationError,\n  operationEvents,\n  type OperationSuccess,\n} from './document-pair/operationEvents'\nimport {type OperationsAPI} from './document-pair/operations'\nimport {validation, type ValidationStatus} from './document-pair/validation'\nimport {getInitialValueStream, type InitialValueMsg, type InitialValueOptions} from './initialValue'\nimport {listenQuery, type ListenQueryOptions} from './listenQuery'\nimport {resolveTypeForDocument} from './resolveTypeForDocument'\nimport {type IdPair} from './types'\n\n/**\n * @hidden\n * @beta */\nexport type QueryParams = Record<string, string | number | boolean | string[]>\n\nfunction getIdPairFromPublished(publishedId: string): IdPair {\n  if (isDraftId(publishedId)) {\n    throw new Error('editOpsOf does not expect a draft id.')\n  }\n\n  return {publishedId, draftId: getDraftId(publishedId)}\n}\n\n/**\n * @hidden\n * @beta */\nexport interface DocumentStore {\n  /** @internal */\n  checkoutPair: (idPair: IdPair) => Pair\n  initialValue: (\n    opts: InitialValueOptions,\n    context: InitialValueResolverContext,\n  ) => Observable<InitialValueMsg>\n  listenQuery: (\n    query: string | {fetch: string; listen: string},\n    params: QueryParams,\n    options: ListenQueryOptions,\n  ) => Observable<any>\n  resolveTypeForDocument: (id: string, specifiedType?: string) => Observable<string>\n\n  pair: {\n    consistencyStatus: (publishedId: string, type: string) => Observable<boolean>\n    /** @internal */\n    documentEvents: (publishedId: string, type: string) => Observable<DocumentVersionEvent>\n    /** @internal */\n    editOperations: (publishedId: string, type: string) => Observable<OperationsAPI>\n    editState: (publishedId: string, type: string) => Observable<EditStateFor>\n    operationEvents: (\n      publishedId: string,\n      type: string,\n    ) => Observable<OperationSuccess | OperationError>\n    validation: (publishedId: string, type: string) => Observable<ValidationStatus>\n  }\n}\n\n/** @internal */\nexport interface DocumentStoreOptions {\n  getClient: (options: SourceClientOptions) => SanityClient\n  documentPreviewStore: DocumentPreviewStore\n  historyStore: HistoryStore\n  schema: Schema\n  initialValueTemplates: Template[]\n  i18n: LocaleSource\n}\n\n/** @internal */\nexport function createDocumentStore({\n  getClient,\n  documentPreviewStore,\n  historyStore,\n  initialValueTemplates,\n  schema,\n  i18n,\n}: DocumentStoreOptions): DocumentStore {\n  const observeDocumentPairAvailability =\n    documentPreviewStore.unstable_observeDocumentPairAvailability\n\n  // Note that we're both passing a shared `client` here which is used by the\n  // internal operations, and a `getClient` method that we expose to user-land\n  // for things like validations\n  const client = getClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const ctx = {client, getClient, observeDocumentPairAvailability, historyStore, schema, i18n}\n\n  return {\n    // Public API\n    checkoutPair(idPair) {\n      return checkoutPair(client, idPair)\n    },\n    initialValue(opts, context) {\n      return getInitialValueStream(\n        schema,\n        initialValueTemplates,\n        documentPreviewStore,\n        opts,\n        context,\n      )\n    },\n    listenQuery(query, params, options) {\n      return listenQuery(client, query, params, options)\n    },\n    resolveTypeForDocument(id, specifiedType) {\n      return resolveTypeForDocument(client, id, specifiedType)\n    },\n    pair: {\n      consistencyStatus(publishedId, type) {\n        return consistencyStatus(ctx.client, getIdPairFromPublished(publishedId), type)\n      },\n      documentEvents(publishedId, type) {\n        return documentEvents(ctx.client, getIdPairFromPublished(publishedId), type)\n      },\n      editOperations(publishedId, type) {\n        return editOperations(ctx, getIdPairFromPublished(publishedId), type)\n      },\n      editState(publishedId, type) {\n        return editState(ctx, getIdPairFromPublished(publishedId), type)\n      },\n      operationEvents(publishedId, type) {\n        return operationEvents({client, historyStore, schema}).pipe(\n          filter(\n            (result) =>\n              result.args.idPair.publishedId === publishedId && result.args.typeName === type,\n          ),\n          map((result): OperationSuccess | OperationError => {\n            const {operationName, idPair: documentIds} = result.args\n            return result.type === 'success'\n              ? {type: 'success', op: operationName, id: documentIds.publishedId}\n              : {type: 'error', op: operationName, id: documentIds.publishedId, error: result.error}\n          }),\n        )\n      },\n      validation(publishedId, type) {\n        return validation(ctx, getIdPairFromPublished(publishedId), type)\n      },\n    },\n  }\n}\n","import {useMemo} from 'react'\nimport {type Observable, of} from 'rxjs'\n\nimport {type LoadableState, useLoadable} from '../../../../util'\nimport {useDocumentPreviewStore} from '../../datastores'\n\n/** @internal */\nexport function useDocumentValues<T = Record<string, unknown>>(\n  documentId: string,\n  paths: string[],\n): LoadableState<T | undefined> {\n  const documentPreviewStore = useDocumentPreviewStore()\n\n  const documentValues$ = useMemo(\n    () =>\n      documentId\n        ? (documentPreviewStore.observePaths(\n            {_type: 'reference', _ref: documentId},\n            paths,\n          ) as Observable<T>)\n        : of(undefined),\n    [documentId, documentPreviewStore, paths],\n  )\n\n  return useLoadable(documentValues$)\n}\n","import {type InitialValueResolverContext, type SanityDocumentLike} from '@sanity/types'\nimport {useEffect, useMemo, useState} from 'react'\n\nimport {useDataset, useProjectId, useSchema} from '../../../hooks'\nimport {useSource} from '../../../studio'\nimport {useUnique} from '../../../util'\nimport {useCurrentUser} from '../../user'\nimport {useDocumentStore} from '../datastores'\nimport {type InitialValueState} from './initialValue/types'\n\n/**\n * @internal\n */\nexport function useInitialValue(props: {\n  documentId: string\n  documentType: string\n  templateName?: string\n  templateParams?: Record<string, unknown>\n}): InitialValueState {\n  const {documentId, documentType, templateName, templateParams: templateParamsRaw} = props\n  const templateParams = useUnique(templateParamsRaw)\n  const documentStore = useDocumentStore()\n  const context = useInitialValueResolverContext()\n\n  const defaultValue: SanityDocumentLike = useMemo(\n    () => ({_id: documentId, _type: documentType}),\n    [documentId, documentType],\n  )\n\n  const [state, setState] = useState<InitialValueState>({\n    loading: false,\n    error: null,\n    value: defaultValue,\n  })\n\n  useEffect(() => {\n    const initialValueOptions = {documentId, documentType, templateName, templateParams}\n\n    if (!templateName) {\n      setState({loading: true, error: null, value: defaultValue})\n      return undefined\n    }\n\n    const initialValueMsg$ = documentStore.initialValue(initialValueOptions, context)\n\n    const sub = initialValueMsg$.subscribe((msg) => {\n      if (msg.type === 'loading') {\n        setState({loading: true, error: null, value: defaultValue})\n      }\n\n      if (msg.type === 'success') {\n        setState({\n          loading: false,\n          error: null,\n          value: msg.value ? {...defaultValue, ...msg.value} : defaultValue,\n        })\n      }\n\n      if (msg.type === 'error') {\n        setState({loading: false, error: msg.error, value: defaultValue})\n      }\n    })\n\n    setState({loading: true, error: null, value: defaultValue})\n\n    return () => sub.unsubscribe()\n  }, [defaultValue, documentId, documentStore, documentType, templateName, templateParams, context])\n\n  return state\n}\n\n/**\n * @internal\n */\nexport function useInitialValueResolverContext(): InitialValueResolverContext {\n  const source = useSource()\n  const schema = useSchema()\n  const currentUser = useCurrentUser()\n  const projectId = useProjectId()\n  const dataset = useDataset()\n  const getClient = source.getClient\n\n  return useMemo(() => {\n    return {\n      projectId,\n      dataset,\n      getClient,\n      schema,\n      currentUser,\n    }\n  }, [getClient, schema, currentUser, projectId, dataset])\n}\n","import {type SchemaType} from '@sanity/types'\nimport {useCallback} from 'react'\n\nimport {DEFAULT_MAX_RECURSION_DEPTH, resolveInitialValueForType} from '../../../templates'\nimport {useInitialValueResolverContext} from './useInitialValue'\n\n/** @internal */\nexport function useResolveInitialValueForType<Params extends Record<string, unknown>>(): (\n  /**\n   * This is the name of the document.\n   */\n  type: SchemaType,\n  /**\n   * Params is a sanity context object passed to every initial value function.\n   */\n  params: Params,\n) => Promise<any> {\n  const initialValueContext = useInitialValueResolverContext()\n\n  return useCallback(\n    (type: SchemaType, params: Params) => {\n      return resolveInitialValueForType(\n        type,\n        params,\n        DEFAULT_MAX_RECURSION_DEPTH,\n        initialValueContext,\n      )\n    },\n    [initialValueContext],\n  )\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type SanityDocument, type Schema, type SchemaType} from '@sanity/types'\nimport {useMemo} from 'react'\nimport {combineLatest, type Observable, of} from 'rxjs'\nimport {map, switchMap} from 'rxjs/operators'\n\nimport {useClient, useSchema} from '../../../hooks'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../studioClient'\nimport {\n  createHookFromObservableFactory,\n  getDraftId,\n  getPublishedId,\n  type PartialExcept,\n} from '../../../util'\nimport {useGrantsStore} from '../datastores'\nimport {snapshotPair} from '../document'\nimport {type GrantsStore, type PermissionCheckResult} from './types'\n\nfunction getSchemaType(schema: Schema, typeName: string): SchemaType {\n  const type = schema.get(typeName)\n\n  if (!type) {\n    throw new Error(`No such schema type: ${typeName}`)\n  }\n\n  return type\n}\n\ninterface PairPermissionsOptions {\n  grantsStore: GrantsStore\n  permission: DocumentPermission\n  draft: SanityDocument | null\n  published: SanityDocument | null\n  liveEdit: boolean\n}\n\nfunction getPairPermissions({\n  grantsStore,\n  permission,\n  draft,\n  published,\n  liveEdit,\n}: PairPermissionsOptions): Array<[string, Observable<PermissionCheckResult>] | null> {\n  // this was introduced because we ran into a bug where a user with publish\n  // access was marked as not allowed to duplicate a document unless it had a\n  // draft variant. this would happen in non-live edit cases where the document\n  // pair only had a published variant with the draft variant being null.\n  //\n  // note: this should _not_ be used if the draft and published versions should\n  // be considered separately/explicitly in the permissions.\n  const effectiveVersion = draft || published\n  const effectiveVersionType = effectiveVersion === draft ? 'draft' : 'published'\n\n  const {checkDocumentPermission} = grantsStore\n\n  switch (permission) {\n    case 'delete': {\n      if (liveEdit) {\n        return [\n          ['delete published document (live-edit)', checkDocumentPermission('update', published)],\n        ]\n      }\n\n      return [\n        ['delete draft document', checkDocumentPermission('update', draft)],\n        ['delete published document', checkDocumentPermission('update', published)],\n      ]\n    }\n\n    case 'discardDraft': {\n      if (liveEdit) return []\n\n      return [['delete draft document', checkDocumentPermission('update', draft)]]\n    }\n\n    case 'publish': {\n      if (liveEdit) return []\n\n      return [\n        // precondition\n        [\n          'update published document at its current state',\n          checkDocumentPermission('update', published),\n        ],\n\n        // post condition\n        ['delete draft document', checkDocumentPermission('update', draft)],\n        [\n          'create published document from draft',\n          checkDocumentPermission('create', draft && {...draft, _id: getPublishedId(draft._id)}),\n        ],\n      ]\n    }\n\n    case 'unpublish': {\n      if (liveEdit) return []\n\n      return [\n        // precondition\n        ['update draft document at its current state', checkDocumentPermission('create', draft)],\n\n        // post condition\n        ['delete published document', checkDocumentPermission('update', published)],\n        [\n          'create draft document from published version',\n          checkDocumentPermission(\n            'create',\n            published && {...published, _id: getDraftId(published._id)},\n          ),\n        ],\n      ]\n    }\n\n    case 'update': {\n      if (liveEdit) {\n        return [\n          ['update published document (live-edit)', checkDocumentPermission('update', published)],\n        ]\n      }\n\n      return [\n        [\n          `update ${effectiveVersionType} document`,\n          checkDocumentPermission('update', effectiveVersion),\n        ],\n      ]\n    }\n\n    case 'duplicate': {\n      if (liveEdit) {\n        return [\n          [\n            'create new published document from existing document (live-edit)',\n            checkDocumentPermission('create', {...published, _id: 'dummy-id'}),\n          ],\n        ]\n      }\n\n      return [\n        [\n          `create new draft document from existing ${effectiveVersionType} document`,\n          checkDocumentPermission('create', {...effectiveVersion, _id: getDraftId('dummy-id')}),\n        ],\n      ]\n    }\n\n    default: {\n      throw new Error(`Could not match permission: ${permission}`)\n    }\n  }\n}\n\n/** @internal */\nexport type DocumentPermission =\n  | 'delete'\n  | 'discardDraft'\n  | 'publish'\n  | 'unpublish'\n  | 'update'\n  | 'duplicate'\n\n/** @internal */\nexport interface DocumentPairPermissionsOptions {\n  client: SanityClient\n  schema: Schema\n  grantsStore: GrantsStore\n  id: string\n  type: string\n  permission: DocumentPermission\n}\n\n/**\n * The observable version of `useDocumentPairPermissions`\n *\n * @see useDocumentPairPermissions\n *\n * @internal\n */\nexport function getDocumentPairPermissions({\n  client,\n  grantsStore,\n  schema,\n  id,\n  permission,\n  type,\n}: DocumentPairPermissionsOptions): Observable<PermissionCheckResult> {\n  // this case was added to fix a crash that would occur if the `schemaType` was\n  // omitted from `S.documentList()`\n  //\n  // see `resolveTypeForDocument` which returns `'*'` if no type is provided\n  // https://github.com/sanity-io/sanity/blob/4d49b83a987d5097064d567f75d21b268a410cbf/packages/%40sanity/base/src/datastores/document/resolveTypeForDocument.ts#L7\n  if (type === '*') {\n    return of({granted: false, reason: 'Type specified was `*`'})\n  }\n\n  const liveEdit = Boolean(getSchemaType(schema, type).liveEdit)\n\n  return snapshotPair(\n    client,\n    {draftId: getDraftId(id), publishedId: getPublishedId(id)},\n    type,\n  ).pipe(\n    switchMap((pair) =>\n      combineLatest([pair.draft.snapshots$, pair.published.snapshots$]).pipe(\n        map(([draft, published]) => ({draft, published})),\n      ),\n    ),\n    switchMap(({draft, published}) => {\n      const pairPermissions = getPairPermissions({\n        grantsStore,\n        permission,\n        draft,\n        published,\n        liveEdit,\n      }).map(([label, observable]: any) =>\n        observable.pipe(\n          map(({granted, reason}: any) => ({\n            granted,\n            reason: granted ? '' : `not allowed to ${label}: ${reason}`,\n            label,\n            permission,\n          })),\n        ),\n      )\n\n      if (!pairPermissions.length) return of({granted: true, reason: ''})\n\n      return combineLatest(pairPermissions).pipe(\n        map((permissionResults: any[]) => {\n          const granted = permissionResults.every((permissionResult) => permissionResult.granted)\n          const reason = granted\n            ? ''\n            : `Unable to ${permission}:\\n\\t${permissionResults\n                .filter((permissionResult) => !permissionResult.granted)\n                .map((permissionResult) => permissionResult.reason)\n                .join('\\n\\t')}`\n\n          return {granted, reason}\n        }),\n      )\n    }),\n  )\n}\n\n/**\n * Gets document pair permissions based on a document ID and a type.\n *\n * This permissions API is a high-level permissions API that is draft-model\n * aware. In order to determine whether or not the user has the given\n * permission, both the draft and published documents are pulled and run through\n * all of the user's grants. If any pre or post conditions fail a permissions\n * checks, the operations will not be granted.\n *\n * The operations this hook accepts are only relevant to document pairs. E.g.\n * `'create'` is not included as an operation because it's not possible to tell\n * if a document can be created by only using the initial ID and type because an\n * initial template value may not have a matching grant (e.g. locked-document\n * pattern `!locked`). In contrast, the operation `'duplicate'` is supported\n * because the draft value of the document can be live queried and checked for\n * matching grants.\n *\n * Note: for live-edit documents, non-applicable operations (e.g. publish) will\n * return as true.\n *\n * @see useDocumentValuePermissions\n *\n * @internal\n */\nexport const useDocumentPairPermissionsFromHookFactory = createHookFromObservableFactory(\n  getDocumentPairPermissions,\n)\n\n/** @internal */\nexport function useDocumentPairPermissions({\n  id,\n  type,\n  permission,\n  client: overrideClient,\n  schema: overrideSchema,\n  grantsStore: overrideGrantsStore,\n}: PartialExcept<DocumentPairPermissionsOptions, 'id' | 'type' | 'permission'>): ReturnType<\n  typeof useDocumentPairPermissionsFromHookFactory\n> {\n  const defaultClient = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const defaultSchema = useSchema()\n  const defaultGrantsStore = useGrantsStore()\n\n  const client = useMemo(() => overrideClient || defaultClient, [defaultClient, overrideClient])\n  const schema = useMemo(() => overrideSchema || defaultSchema, [defaultSchema, overrideSchema])\n  const grantsStore = useMemo(\n    () => overrideGrantsStore || defaultGrantsStore,\n    [defaultGrantsStore, overrideGrantsStore],\n  )\n\n  return useDocumentPairPermissionsFromHookFactory(\n    useMemo(\n      () => ({client, schema, grantsStore, id, permission, type}),\n      [client, grantsStore, id, permission, schema, type],\n    ),\n  )\n}\n","import {type Observable} from 'rxjs'\n\nimport {createHookFromObservableFactory, type PartialExcept} from '../../../util'\nimport {useGrantsStore} from '../datastores'\nimport {type DocumentValuePermission, type GrantsStore, type PermissionCheckResult} from './types'\n\n/** @internal */\nexport interface DocumentValuePermissionsOptions {\n  grantsStore: GrantsStore\n  document: Record<string, unknown>\n  permission: DocumentValuePermission\n}\n\n/**\n * The observable version of `useDocumentValuePermissions`\n *\n * @see useDocumentValuePermissions\n *\n * @internal\n */\nexport function getDocumentValuePermissions({\n  grantsStore,\n  document,\n  permission,\n}: DocumentValuePermissionsOptions): Observable<PermissionCheckResult> {\n  const {checkDocumentPermission} = grantsStore\n\n  return checkDocumentPermission(permission, document)\n}\n\n/**\n * Gets permissions based on the value of the document passed into the hook\n * (stateless).\n *\n * Note: this is a lower-level API (compared to `useDocumentPairPermissions`)\n * that is _not_ draft-model aware.\n *\n * As a consequence, the operations it accepts are also low-level. (e.g.\n * `'publish'` permissions can't be determined with this API). This is because\n * it's not possible to tell if a user can do high-level document pair\n * operations on document using only one document value.\n *\n * For example, in order to determine if a user can publish, the current value\n * of the published document needs to be pulled and checked against the user's\n * grants. If there are no matching grants, then it fails the pre-condition and\n * no operation is allowed regardless of the given document.\n *\n * @see useDocumentPairPermissions\n *\n * @internal\n */\nexport const useDocumentValuePermissionsFromHookFactory = createHookFromObservableFactory(\n  getDocumentValuePermissions,\n)\n\n/** @internal */\nexport function useDocumentValuePermissions({\n  document,\n  permission,\n  ...rest\n}: PartialExcept<DocumentValuePermissionsOptions, 'permission' | 'document'>): ReturnType<\n  typeof useDocumentValuePermissionsFromHookFactory\n> {\n  const grantsStore = useGrantsStore()\n\n  return useDocumentValuePermissionsFromHookFactory({\n    grantsStore: rest.grantsStore || grantsStore,\n    document,\n    permission,\n  })\n}\n","import {concat, fromEvent, of} from 'rxjs'\nimport {distinctUntilChanged, map} from 'rxjs/operators'\n\nconst DEBUG_PREFIX = '_debug_'\n\nconst hashchange$ = typeof window === 'undefined' ? of({}) : fromEvent(window, 'hashchange')\n\nexport const debugParams$ = concat(of(0), hashchange$).pipe(\n  map(() => (typeof document === 'undefined' ? '#' : document.location.hash)),\n  distinctUntilChanged(),\n  map((hash) =>\n    hash\n      .substring(1)\n      .split(';')\n      .filter((p) => p.toLowerCase().startsWith(DEBUG_PREFIX))\n      .map((param) => param.substring(DEBUG_PREFIX.length)),\n  ),\n)\n\nexport const debugRolesParam$ = debugParams$.pipe(\n  map((args) => args.find((arg) => arg.startsWith('roles='))),\n  map(\n    (arg) =>\n      arg\n        ?.split('roles=')[1]\n        .split(',')\n        .map((r) => r.trim()) || [],\n  ),\n)\n","// NOTE: these example grants are used in other test files.\n// if you change this file, check to see if other files need to be updated too\nimport {type Grant} from '../types'\n\nexport const administrator: Grant[] = [\n  {\n    filter: '_id in path(\"**\")',\n    permissions: ['read', 'create', 'history', 'update'],\n  },\n]\n\nexport const editor: Grant[] = [\n  {\n    filter: '_id in path(\"**\")',\n    permissions: ['read', 'create', 'history', 'update'],\n  },\n]\n\nexport const developer: Grant[] = [\n  {\n    filter: '_id in path(\"**\")',\n    permissions: ['read', 'create', 'history', 'update'],\n  },\n]\n\nexport const contributor: Grant[] = [\n  {\n    filter: '_id in path(\"**\")',\n    permissions: ['read'],\n  },\n  {\n    filter: '_id in path(\"drafts.**\")',\n    permissions: ['create', 'history', 'update'],\n  },\n]\n\nexport const viewer: Grant[] = [\n  {\n    filter: '_id in path(\"**\")',\n    permissions: ['read', 'history'],\n  },\n]\n\nexport const requiresApproval: Grant[] = [\n  {\n    filter: '!locked',\n    permissions: ['read', 'create', 'update'],\n  },\n]\n\nexport const restricted: Grant[] = [\n  {\n    filter:\n      '_id in path(\"drafts.**\") && _type in [\"stringsTest\", \"book\", \"author\", \"referenceTest\"]',\n    permissions: ['read', 'create', 'history', 'update'],\n  },\n  {\n    filter: '_id in path(\"**\")',\n    permissions: ['read'],\n  },\n]\n","import {map} from 'rxjs/operators'\n\nimport {debugRolesParam$} from '../../debugParams'\nimport {type Grant} from '../types'\nimport * as grants from './exampleGrants'\nimport {type ExampleRoleName} from './exampleRoles'\n\nconst DEBUG_ROLE_GRANTS_MAP: Record<ExampleRoleName, Grant[]> = {\n  // basic\n  administrator: grants.administrator,\n  editor: grants.editor,\n  developer: grants.developer,\n  contributor: grants.contributor,\n  viewer: grants.viewer,\n\n  // custom\n  restricted: grants.restricted,\n  requiresApproval: grants.requiresApproval,\n\n  // legacy\n  read: grants.viewer,\n  write: grants.editor,\n}\n\n// todo: merge other resource keys(?)\nexport const debugGrants$ = debugRolesParam$.pipe(\n  map((roles) => {\n    if (!roles.length) return null\n\n    return roles\n      .filter((value) => Boolean(value) && value in DEBUG_ROLE_GRANTS_MAP)\n      .flatMap((roleName: ExampleRoleName) => DEBUG_ROLE_GRANTS_MAP[roleName] || [])\n  }),\n)\n","import {type SanityClient} from '@sanity/client'\nimport {type CurrentUser, type SanityDocument} from '@sanity/types'\nimport {evaluate, parse} from 'groq-js'\nimport {defer, of} from 'rxjs'\nimport {distinctUntilChanged, publishReplay, switchMap} from 'rxjs/operators'\nimport {refCountDelay} from 'rxjs-etc/operators'\nimport shallowEquals from 'shallow-equals'\n\nimport {debugGrants$} from './debug'\nimport {\n  type DocumentValuePermission,\n  type EvaluationParams,\n  type Grant,\n  type GrantsStore,\n  type PermissionCheckResult,\n} from './types'\n\nasync function getDatasetGrants(\n  client: SanityClient,\n  projectId: string,\n  dataset: string,\n): Promise<Grant[]> {\n  // `acl` stands for access control list and returns a list of grants\n  const grants: Grant[] = await client.request({\n    uri: `/projects/${projectId}/datasets/${dataset}/acl`,\n    tag: 'acl.get',\n    withCredentials: true,\n  })\n\n  return grants\n}\n\nfunction getParams(userId: string | null): EvaluationParams {\n  const params: EvaluationParams = {}\n\n  if (userId !== null) {\n    params.identity = userId\n  }\n\n  return params\n}\n\nconst PARSED_FILTERS_MEMO = new Map()\nasync function matchesFilter(userId: string | null, filter: string, document: SanityDocument) {\n  if (!PARSED_FILTERS_MEMO.has(filter)) {\n    // note: it might be tempting to also memoize the result of the evaluation here,\n    // Currently these filters are typically evaluated whenever a document change, which means they will be evaluated\n    // quite frequently with different versions of the document. There might be some gains in finding out which subset of document\n    // properties to use as key (e.g. by looking at the parsed filter and see what properties the filter cares about)\n    // But as always, it's worth considering if the complexity/memory usage is worth the potential perf gain\n    PARSED_FILTERS_MEMO.set(filter, parse(`*[${filter}]`))\n  }\n  const parsed = PARSED_FILTERS_MEMO.get(filter)\n\n  const evalParams = getParams(userId)\n  const {identity} = evalParams\n  const params: Record<string, unknown> = {...evalParams}\n  const data = await (await evaluate(parsed, {dataset: [document], identity, params})).get()\n  return data?.length === 1\n}\ninterface GrantsStoreOptionsCurrentUser {\n  client: SanityClient\n  /**\n   * @deprecated The `currentUser` option is deprecated. Use `userId` instead.\n   */\n  currentUser: CurrentUser | null\n}\n\ninterface GrantsStoreOptionsUserId {\n  client: SanityClient\n  userId: string | null\n}\n\n/** @internal */\nexport type GrantsStoreOptions = GrantsStoreOptionsCurrentUser | GrantsStoreOptionsUserId\n\n/** @internal */\nexport function createGrantsStore(opts: GrantsStoreOptions): GrantsStore {\n  const {client} = opts\n  const versionedClient = client.withConfig({apiVersion: '2021-06-07'})\n  const userId = 'userId' in opts ? opts.userId : opts?.currentUser?.id || null\n\n  const datasetGrants$ = defer(() => of(versionedClient.config())).pipe(\n    switchMap(({projectId, dataset}) => {\n      if (!projectId || !dataset) {\n        throw new Error('Missing projectId or dataset')\n      }\n      return getDatasetGrants(versionedClient, projectId, dataset)\n    }),\n  )\n\n  const currentUserDatasetGrants = debugGrants$.pipe(\n    switchMap((debugGrants) => (debugGrants ? of(debugGrants) : datasetGrants$)),\n    publishReplay(1),\n    refCountDelay(1000),\n  )\n\n  return {\n    checkDocumentPermission(permission: DocumentValuePermission, document: SanityDocument) {\n      return currentUserDatasetGrants.pipe(\n        switchMap((grants) => grantsPermissionOn(userId, grants, permission, document)),\n        distinctUntilChanged(shallowEquals),\n      )\n    },\n  }\n}\n\n/**\n * @internal\n * Takes a grants object, a permission and a document\n * checks whether the permission is granted for the given document\n */\nexport async function grantsPermissionOn(\n  userId: string | null,\n  grants: Grant[],\n  permission: DocumentValuePermission,\n  document: SanityDocument | null,\n): Promise<PermissionCheckResult> {\n  if (!document) {\n    // we say it's granted if null due to initial states\n    return {granted: true, reason: 'Null document, nothing to check'}\n  }\n\n  if (!grants.length) {\n    return {granted: false, reason: 'No document grants'}\n  }\n\n  const matchingGrants: Grant[] = []\n\n  for (const grant of grants) {\n    if (await matchesFilter(userId, grant.filter, document)) {\n      matchingGrants.push(grant)\n    }\n  }\n\n  const foundMatch = matchingGrants.some((grant) => grant.permissions.some((p) => p === permission))\n\n  return {\n    granted: foundMatch,\n    reason: foundMatch ? `Matching grant` : `No matching grants found`,\n  }\n}\n","import {type InitialValueResolverContext, type Schema} from '@sanity/types'\nimport {combineLatest, from, type Observable, of} from 'rxjs'\nimport {map, switchMap} from 'rxjs/operators'\n\nimport {useSchema, useTemplates} from '../../../hooks'\nimport {type InitialValueTemplateItem, resolveInitialValue, type Template} from '../../../templates'\nimport {\n  createHookFromObservableFactory,\n  getDraftId,\n  getPublishedId,\n  type PartialExcept,\n} from '../../../util'\nimport {useGrantsStore} from '../datastores'\nimport {useInitialValueResolverContext} from '../document'\nimport {getDocumentValuePermissions} from './documentValuePermissions'\nimport {type GrantsStore, type PermissionCheckResult} from './types'\n\n/** @internal */\nexport interface TemplatePermissionsResult<TInitialValue = Record<string, unknown>>\n  extends PermissionCheckResult,\n    InitialValueTemplateItem {\n  granted: boolean\n  reason: string\n  resolvedInitialValue: TInitialValue\n  subtitle?: string\n  template: Template\n}\n\ntype Serializable<T> = {serialize(): T}\n\nfunction serialize<T>(item: T | Serializable<T>): T {\n  if (typeof item === 'object' && item !== null && 'serialize' in item) {\n    return serialize(item.serialize())\n  }\n\n  return item as T\n}\n\n/** @internal */\nexport interface TemplatePermissionsOptions {\n  grantsStore: GrantsStore\n  schema: Schema\n  templates: Template[]\n  templateItems: InitialValueTemplateItem[]\n  context: InitialValueResolverContext\n}\n\n/**\n * The observable version of `useTemplatePermissions`\n *\n * @internal\n */\nexport function getTemplatePermissions({\n  grantsStore,\n  templateItems,\n  templates,\n  schema,\n  context,\n}: TemplatePermissionsOptions): Observable<\n  Array<TemplatePermissionsResult<Record<string, unknown>>>\n> {\n  if (!templateItems?.length) return of([])\n\n  return combineLatest(\n    templateItems\n      .map(serialize)\n      .map(async (item) => {\n        const template = templates.find((t) => t.id === item.templateId)\n\n        if (!template) {\n          throw new Error(`template not found: \"${item.templateId}\"`)\n        }\n\n        const resolvedInitialValue = await resolveInitialValue(\n          schema,\n          template,\n          item.parameters,\n          context,\n        )\n\n        return {template, item, resolvedInitialValue}\n      })\n      .map((promise) =>\n        from(promise).pipe(\n          switchMap(({item, resolvedInitialValue, template}) => {\n            const schemaType = schema.get(template.schemaType)\n\n            if (!schemaType) {\n              throw new Error(`schema type not found: \"${template.schemaType}\"`)\n            }\n\n            const liveEdit = schemaType?.liveEdit\n            const {initialDocumentId = 'dummy-id'} = item\n\n            return getDocumentValuePermissions({\n              grantsStore,\n              permission: 'create',\n              document: {\n                _id: liveEdit ? getPublishedId(initialDocumentId) : getDraftId(initialDocumentId),\n                ...resolvedInitialValue,\n              },\n            }).pipe(\n              map(({granted, reason}) => {\n                const title = item.title || template.title\n                const result: TemplatePermissionsResult = {\n                  ...item,\n                  i18n: item.i18n || template.i18n,\n                  granted,\n                  reason,\n                  resolvedInitialValue,\n                  template,\n                  title,\n                  subtitle: schemaType.title === title ? undefined : schemaType.title,\n                  description: item.description || template.description,\n                  icon: item.icon || template.icon,\n                }\n\n                return result\n              }),\n            )\n          }),\n        ),\n      ),\n  )\n}\n\n/**\n * Takes in an array of initial template values and returns an object of\n * `TemplatePermissionsResult` keyed by the IDs of the initial template values\n * given.\n *\n * The `TemplatePermissionsResult` is an object that contains a `granted`\n * boolean per key and can be used to determine if a user has the ability to\n * create documents using the given initial value template items.\n *\n * For each initial template value item, the corresponding template is found and\n * resolved against the parameters in each the initial template value item. The\n * resolved value is then run through the document-value permissions. If there\n * are any matching grants for the resolved initial template value, the\n * `TemplatePermissionsResult` will include `granted: true`.\n *\n * @internal\n */\nexport const useTemplatePermissionsFromHookFactory =\n  createHookFromObservableFactory(getTemplatePermissions)\n\n/** @internal */\nexport function useTemplatePermissions({\n  templateItems,\n  ...rest\n}: PartialExcept<TemplatePermissionsOptions, 'templateItems'>): ReturnType<\n  typeof useTemplatePermissionsFromHookFactory\n> {\n  const schema = useSchema()\n  const templates = useTemplates()\n  const grantsStore = useGrantsStore()\n  const initialValueContext = useInitialValueResolverContext()\n\n  return useTemplatePermissionsFromHookFactory({\n    templateItems,\n    grantsStore: rest.grantsStore || grantsStore,\n    schema: rest.schema || schema,\n    templates: rest.templates || templates,\n    context: initialValueContext,\n  })\n}\n","/* eslint-disable no-nested-ternary */\nimport {type MendozaEffectPair, type MendozaPatch} from '@sanity/types'\n\nimport {type Chunk, type ChunkType} from '../../../../field'\nimport {type Transaction} from './types'\n\nfunction canMergeEdit(type: ChunkType) {\n  return type === 'create' || type === 'editDraft'\n}\n\nconst CHUNK_WINDOW = 5 * 60 * 1000 // 5 minutes\n\nfunction isWithinMergeWindow(a: string, b: string) {\n  return Date.parse(b) - Date.parse(a) < CHUNK_WINDOW\n}\n\nexport function mergeChunk(left: Chunk, right: Chunk): Chunk | [Chunk, Chunk] {\n  if (left.end !== right.start) throw new Error('chunks are not next to each other')\n\n  // TODO: How to detect first squash/create\n\n  const draftState = combineState(left.draftState, right.draftState)\n  const publishedState = combineState(left.publishedState, right.publishedState)\n\n  if (left.type === 'delete' && right.type === 'editDraft') {\n    return [left, {...right, type: 'create', draftState, publishedState}]\n  }\n\n  // Convert deletes into either discardDraft or unpublish depending on what's been deleted.\n  if (right.type === 'delete') {\n    if (draftState === 'missing' && publishedState === 'present') {\n      return [left, {...right, type: 'discardDraft', draftState, publishedState}]\n    }\n\n    if (draftState === 'present' && publishedState === 'missing') {\n      return [left, {...right, type: 'unpublish', draftState, publishedState}]\n    }\n  }\n\n  if (\n    canMergeEdit(left.type) &&\n    right.type === 'editDraft' &&\n    isWithinMergeWindow(left.endTimestamp, right.startTimestamp)\n  ) {\n    const authors = new Set<string>()\n    for (const author of left.authors) authors.add(author)\n    for (const author of right.authors) authors.add(author)\n\n    return {\n      index: 0,\n      id: right.id,\n      type: left.type,\n      start: left.start,\n      end: right.end,\n      startTimestamp: left.startTimestamp,\n      endTimestamp: right.endTimestamp,\n      authors,\n      draftState,\n      publishedState,\n    }\n  }\n\n  return [left, {...right, draftState, publishedState}]\n}\n\ntype ChunkState = 'unedited' | 'deleted' | 'upsert'\nfunction getChunkState(effect?: MendozaEffectPair): ChunkState {\n  const modified = Boolean(effect)\n  const deleted = effect && isDeletePatch(effect?.apply)\n\n  if (deleted) {\n    return 'deleted'\n  }\n\n  if (modified) {\n    return 'upsert'\n  }\n\n  return 'unedited'\n}\n\n/*\n * getChunkType tries to determine what effect the given transaction had on the document\n * More information about the logic can be found here https://github.com/sanity-io/sanity/pull/2633#issuecomment-886461812\n *\n * |                    | draft unedited | draft deleted | draft upsert |\n * |--------------------|----------------|---------------|--------------|\n * | published unedited | X              | delete        | editDraft    |\n * | published deleted  | delete         | delete        | delete       |\n * | published upsert   | liveEdit       | publish       | liveEdit     |\n */\nfunction getChunkType(transaction: Transaction): ChunkType {\n  const draftState = getChunkState(transaction.draftEffect)\n  const publishedState = getChunkState(transaction.publishedEffect)\n\n  if (publishedState === 'unedited') {\n    if (draftState === 'deleted') {\n      return 'delete'\n    }\n\n    if (draftState === 'upsert') {\n      return 'editDraft'\n    }\n  }\n\n  if (publishedState === 'deleted') {\n    return 'delete'\n  }\n\n  if (publishedState === 'upsert') {\n    if (draftState === 'unedited') {\n      return 'editLive'\n    }\n\n    if (draftState === 'deleted') {\n      return 'publish'\n    }\n\n    if (draftState === 'upsert') {\n      return 'editLive'\n    }\n  }\n\n  return 'editLive'\n}\n\nexport function chunkFromTransaction(transaction: Transaction): Chunk {\n  const modifiedDraft = Boolean(transaction.draftEffect)\n  const modifiedPublished = Boolean(transaction.publishedEffect)\n\n  const draftDeleted = transaction.draftEffect && isDeletePatch(transaction.draftEffect.apply)\n  const publishedDeleted =\n    transaction.publishedEffect && isDeletePatch(transaction.publishedEffect.apply)\n\n  const type = getChunkType(transaction)\n\n  return {\n    index: 0,\n    id: transaction.id,\n    type,\n    start: transaction.index,\n    end: transaction.index + 1,\n    startTimestamp: transaction.timestamp,\n    endTimestamp: transaction.timestamp,\n    authors: new Set([transaction.author]),\n    draftState: modifiedDraft ? (draftDeleted ? 'missing' : 'present') : 'unknown',\n    publishedState: modifiedPublished ? (publishedDeleted ? 'missing' : 'present') : 'unknown',\n  }\n}\n\nfunction combineState(\n  left: 'present' | 'missing' | 'unknown',\n  right: 'present' | 'missing' | 'unknown',\n) {\n  return right === 'unknown' ? left : right\n}\n\nexport function isDeletePatch(patch: MendozaPatch): boolean {\n  return patch[0] === 0 && patch[1] === null\n}\n","import {type Annotation} from '../../../../field'\nimport {type CombinedDocument} from './types'\n\nexport function isSameAnnotation(a: Annotation, b: Annotation): boolean {\n  if (a && b) {\n    return a.author === b.author && a.chunk === b.chunk\n  }\n\n  if (!a && !b) {\n    return true\n  }\n\n  return false\n}\n\nexport function getAttrs(doc: CombinedDocument): Record<string, unknown> | null {\n  return doc.draft || doc.published\n}\n","import {\n  type ArrayInput,\n  type Diff,\n  diffInput,\n  type Input,\n  type ObjectInput,\n  type StringInput,\n  wrap,\n} from '@sanity/diff'\nimport {type incremental} from 'mendoza'\n\nimport {type Annotation, type Chunk} from '../../../../field'\nimport {type Timeline} from './Timeline'\nimport {isSameAnnotation} from './utils'\n\nexport type Meta = {chunk: Chunk; transactionIndex: number} | null\n\nexport type AnnotationExtractor = {\n  fromValue(value: incremental.Value<Meta>): Annotation\n  fromMeta(meta: Meta): Annotation\n}\n\nclass ArrayContentWrapper implements ArrayInput<Annotation> {\n  type = 'array' as const\n  value: unknown[]\n  length: number\n  annotation: Annotation\n  extractor: AnnotationExtractor\n\n  private content: incremental.ArrayContent<Meta>\n  private elements: Input<Annotation>[] = []\n\n  constructor(\n    content: incremental.ArrayContent<Meta>,\n    value: unknown[],\n    annotation: Annotation,\n    extractor: AnnotationExtractor,\n  ) {\n    this.content = content\n    this.value = value\n    this.annotation = annotation\n    this.extractor = extractor\n    this.length = content.elements.length\n  }\n\n  at(idx: number) {\n    if (idx >= this.length) throw new Error('out of bounds')\n    const input = this.elements[idx]\n    if (input) {\n      return input\n    }\n    return (this.elements[idx] = wrapValue(\n      this.content.elements[idx],\n      this.value[idx],\n      this.extractor,\n    ))\n  }\n\n  annotationAt(idx: number): Annotation {\n    const meta = this.content.metas[idx]\n    return this.extractor.fromMeta(meta)\n  }\n}\n\nclass ObjectContentWrapper implements ObjectInput<Annotation> {\n  type = 'object' as const\n  value: Record<string, unknown>\n  keys: string[]\n  annotation: Annotation\n  extractor: AnnotationExtractor\n\n  private content: incremental.ObjectContent<Meta>\n  private fields: Record<string, Input<Annotation>> = {}\n\n  constructor(\n    content: incremental.ObjectContent<Meta>,\n    value: Record<string, unknown>,\n    annotation: Annotation,\n    extractor: AnnotationExtractor,\n  ) {\n    this.content = content\n    this.value = value\n    this.annotation = annotation\n    this.extractor = extractor\n    this.keys = Object.keys(content.fields)\n  }\n\n  get(key: string) {\n    const input = this.fields[key]\n    if (input) {\n      return input\n    }\n    const value = this.content.fields[key]\n    if (!value) return undefined\n    return (this.fields[key] = wrapValue(value, this.value[key], this.extractor))\n  }\n}\n\nclass StringContentWrapper implements StringInput<Annotation> {\n  type = 'string' as const\n  value: string\n  annotation: Annotation\n  extractor: AnnotationExtractor\n\n  private content: incremental.StringContent<Meta>\n\n  constructor(\n    content: incremental.StringContent<Meta>,\n    value: string,\n    annotation: Annotation,\n    extractor: AnnotationExtractor,\n  ) {\n    this.content = content\n    this.value = value\n    this.annotation = annotation\n    this.extractor = extractor\n  }\n\n  sliceAnnotation(start: number, end: number): {text: string; annotation: Annotation}[] {\n    const result: {text: string; annotation: Annotation}[] = []\n    let idx = 0\n\n    function push(text: string, annotation: Annotation) {\n      if (result.length > 0) {\n        const lst = result[result.length - 1]\n        if (isSameAnnotation(lst.annotation, annotation)) {\n          lst.text += text\n          return\n        }\n      }\n\n      result.push({text, annotation})\n    }\n\n    for (const part of this.content.parts) {\n      const length = part.value.length\n\n      const subStart = Math.max(0, start - idx)\n      if (subStart < length) {\n        // The start of the slice is inside this part somewhere.\n\n        // Figure out where the end is:\n        const subEnd = Math.min(length, end - idx)\n\n        // If the end of the slice is before this part, then we're guaranteed\n        // that there are no more parts.\n        if (subEnd <= 0) break\n\n        push(part.value.slice(subStart, subEnd), this.extractor.fromValue(part))\n      }\n\n      idx += length\n    }\n\n    return result\n  }\n}\n\nfunction wrapValue(\n  value: incremental.Value<Meta>,\n  raw: unknown,\n  extractor: AnnotationExtractor,\n): Input<Annotation> {\n  const annotation = extractor.fromValue(value)\n\n  if (value.content) {\n    switch (value.content.type) {\n      case 'array':\n        return new ArrayContentWrapper(value.content, raw as unknown[], annotation, extractor)\n      case 'object':\n        return new ObjectContentWrapper(\n          value.content,\n          raw as Record<string, unknown>,\n          annotation,\n          extractor,\n        )\n      case 'string':\n        return new StringContentWrapper(value.content, raw as string, annotation, extractor)\n      default:\n      // do nothing\n    }\n  }\n\n  return wrap(raw, annotation)\n}\n\nfunction extractAnnotationForFromInput(\n  timeline: Timeline,\n  firstChunk: Chunk | null,\n  meta: Meta,\n): Annotation {\n  if (meta) {\n    // The next transaction is where it disappeared:\n    return annotationForTransactionIndex(timeline, meta.transactionIndex + 1, meta.chunk.index)\n  } else if (firstChunk) {\n    return annotationForTransactionIndex(timeline, firstChunk.start, firstChunk.index)\n  }\n\n  return null\n}\n\nfunction extractAnnotationForToInput(timeline: Timeline, meta: Meta): Annotation {\n  if (meta) {\n    return annotationForTransactionIndex(timeline, meta.transactionIndex, meta.chunk.index)\n  }\n\n  return null\n}\n\nfunction annotationForTransactionIndex(timeline: Timeline, idx: number, chunkIdx?: number) {\n  const tx = timeline.transactionByIndex(idx)\n  if (!tx) return null\n\n  const chunk = timeline.chunkByTransactionIndex(idx, chunkIdx)\n  if (!chunk) return null\n\n  return {\n    chunk,\n    timestamp: tx.timestamp,\n    author: tx.author,\n  }\n}\n\n// eslint-disable-next-line max-params\nexport function diffValue(\n  timeline: Timeline,\n  firstChunk: Chunk | null,\n  from: incremental.Value<Meta>,\n  fromRaw: unknown,\n  to: incremental.Value<Meta>,\n  toRaw: unknown,\n): Diff<Annotation> {\n  const fromInput = wrapValue(from, fromRaw, {\n    fromValue(value) {\n      return extractAnnotationForFromInput(timeline, firstChunk, value.endMeta)\n    },\n    fromMeta(meta) {\n      return extractAnnotationForFromInput(timeline, firstChunk, meta)\n    },\n  })\n\n  const toInput = wrapValue(to, toRaw, {\n    fromValue(value) {\n      return extractAnnotationForToInput(timeline, value.startMeta)\n    },\n    fromMeta(meta) {\n      return extractAnnotationForToInput(timeline, meta)\n    },\n  })\n  return diffInput(fromInput, toInput)\n}\n","export type Merger<T> = (left: T, right: T) => T | [T, T]\n\n/**\n * The two ended array supports pushing both at the beginning and\n * at the end while preserving indicies.\n */\nexport class TwoEndedArray<T extends {index: number}> {\n  private _postive: T[] = []\n  private _negative: T[] = []\n\n  addToEnd(elem: T): void {\n    elem.index = this._postive.length\n    this._postive.push(elem)\n  }\n\n  addToBeginning(elem: T): void {\n    // Prefer to place things at the positive side if possible.\n    if (this.length == 0) {\n      this.addToEnd(elem)\n      return\n    }\n\n    elem.index = -(this._negative.length + 1)\n    this._negative.push(elem)\n  }\n\n  mergeAtEnd(value: T, merger: Merger<T>): void {\n    if (this.length === 0) {\n      this.addToEnd(value)\n      return\n    }\n\n    const idx = this.lastIdx\n    const result = merger(this.get(idx), value)\n    if (Array.isArray(result)) {\n      this.set(idx, result[0])\n      this.addToEnd(result[1])\n    } else {\n      this.set(idx, result)\n    }\n  }\n\n  mergeAtBeginning(value: T, merger: Merger<T>): void {\n    if (this.length === 0) {\n      this.addToEnd(value)\n      return\n    }\n\n    const idx = this.firstIdx\n    const result = merger(value, this.get(idx))\n    if (Array.isArray(result)) {\n      this.set(idx, result[1])\n      this.addToBeginning(result[0])\n    } else {\n      this.set(idx, result)\n    }\n  }\n\n  removeFromEnd(): void {\n    if (this._postive.length === 0) {\n      this._negative.shift()\n    } else {\n      this._postive.pop()\n    }\n  }\n\n  has(idx: number): boolean {\n    if (idx >= 0) {\n      return idx < this._postive.length\n    }\n\n    return -(idx + 1) < this._negative.length\n  }\n\n  get(idx: number): T {\n    if (idx >= 0) {\n      return this._postive[idx]\n    }\n\n    return this._negative[-(idx + 1)]\n  }\n\n  set(idx: number, value: T): void {\n    if (idx >= 0) {\n      value.index = idx\n      this._postive[idx] = value\n    } else {\n      value.index = idx\n      this._negative[-(idx + 1)] = value\n    }\n  }\n\n  get lastIdx(): number {\n    // Note: This also works correctly when _positive is empty (it returns -1)\n    return this._postive.length - 1\n  }\n\n  get last(): T {\n    return this.get(this.lastIdx)\n  }\n\n  get firstIdx(): number {\n    // Note: This also works correctly when _negative is empty (it returns 0)\n    return -this._negative.length\n  }\n\n  get first(): T {\n    return this.get(this.firstIdx)\n  }\n\n  get length(): number {\n    return this._postive.length + this._negative.length\n  }\n}\n","import {type Diff} from '@sanity/diff'\nimport {type TransactionLogEventWithEffects} from '@sanity/types'\nimport {applyPatch, incremental} from 'mendoza'\n\nimport {type Annotation, type Chunk} from '../../../../field'\nimport {chunkFromTransaction, mergeChunk} from './chunker'\nimport {diffValue, type Meta} from './diffValue'\nimport {type TraceEvent} from './replay'\nimport {TwoEndedArray} from './TwoEndedArray'\nimport {\n  type CombinedDocument,\n  type DocumentRemoteMutationVersionEvent,\n  type Transaction,\n} from './types'\nimport {getAttrs} from './utils'\n\n/**\n * @hidden\n * @beta */\nexport type ParsedTimeRef = Chunk | 'loading' | 'invalid'\n\n/**\n * @hidden\n * @beta */\nexport interface TimelineOptions {\n  publishedId: string\n  enableTrace?: boolean\n}\n\n/**\n * Timeline maintains information about the history of a document:\n * Grouping raw translog entries into sensible groups, replaying and\n * reconstructing different versions and abstract other details.\n *\n * Note that this class by itself is not capable of _fetching_ information,\n * but will only organize and structure the incoming translog entries.\n *\n *\n * @hidden\n * @beta\n */\nexport class Timeline {\n  reachedEarliestEntry = false\n\n  publishedId: string\n  draftId: string\n  private _transactions = new TwoEndedArray<Transaction>()\n  private _chunks = new TwoEndedArray<Chunk>()\n\n  // These two properties are here to handle the case\n  private _possiblePendingTransactions = new Map<\n    string,\n    {\n      transaction: Transaction\n      idx: number\n    }\n  >()\n  private _recreateTransactionsFrom?: number\n  private _trace?: TraceEvent[]\n\n  constructor(opts: TimelineOptions) {\n    this.publishedId = opts.publishedId\n    this.draftId = `drafts.${opts.publishedId}`\n\n    if (opts.enableTrace) {\n      this._trace = []\n      this._trace.push({\n        type: 'initial',\n        publishedId: opts.publishedId,\n      })\n      ;(window as any).__sanityTimelineTrace = this._trace\n    }\n  }\n\n  get chunkCount(): number {\n    return this._chunks.length\n  }\n\n  /** Maps over the chunk from newest to oldest. */\n  mapChunks<T>(mapper: (chunk: Chunk, idx: number) => T): T[] {\n    const result: T[] = []\n\n    const firstIdx = this._chunks.firstIdx\n    const lastIdx = this._chunks.lastIdx\n\n    for (let idx = lastIdx; idx >= firstIdx; idx--) {\n      result.push(mapper(this._chunks.get(idx), idx))\n    }\n\n    return result\n  }\n\n  reset(): void {\n    this._transactions = new TwoEndedArray()\n    this._chunks = new TwoEndedArray()\n    this._possiblePendingTransactions = new Map()\n    this._recreateTransactionsFrom = undefined\n    this.reachedEarliestEntry = false\n  }\n\n  /**\n   * Adds a remote mutation to the timeline. This methods assumes that the remote mutations\n   * come in correct order for their respective version, but has no ordering requirements\n   * across draft/published.\n   *\n   * Example: [D1, D2, P1] (where D1 and P1 were mutations done to the draft and published\n   * version in the same transaction) is a valid input. [P1, D2, D1] is _not_ valid since\n   * the mutation for the draft is out of order.\n   */\n  addRemoteMutation(entry: DocumentRemoteMutationVersionEvent): void {\n    if (this._trace) this._trace.push({type: 'addRemoteMutation', event: entry})\n\n    const pending = this._possiblePendingTransactions.get(entry.transactionId)\n\n    const transaction: Transaction = pending\n      ? pending.transaction\n      : {\n          index: 0,\n          id: entry.transactionId,\n          timestamp: entry.timestamp.toISOString(),\n          author: entry.author,\n        }\n\n    if (entry.version === 'draft') {\n      transaction.draftEffect = entry.effects as any\n    } else {\n      transaction.publishedEffect = entry.effects as any\n    }\n\n    if (pending) {\n      this._possiblePendingTransactions.delete(entry.transactionId)\n      this._invalidateTransactionFrom(pending.idx)\n    } else {\n      this._transactions.addToEnd(transaction)\n      this._possiblePendingTransactions.set(entry.transactionId, {\n        transaction,\n        idx: this._transactions.lastIdx,\n      })\n    }\n  }\n\n  addTranslogEntry(event: TransactionLogEventWithEffects): void {\n    if (this._trace) this._trace.push({type: 'addTranslogEntry', event})\n\n    this._transactions.addToBeginning({\n      index: 0,\n      id: event.id,\n      author: event.author,\n      timestamp: event.timestamp,\n      draftEffect: event.effects[this.draftId],\n      publishedEffect: event.effects[this.publishedId],\n    })\n  }\n\n  /** Mark that we've reached the earliest entry. */\n  didReachEarliestEntry(): void {\n    if (this._trace) this._trace.push({type: 'didReachEarliestEntry'})\n\n    this.reachedEarliestEntry = true\n  }\n\n  /**\n   * updateChunks synchronizes the chunks to match the current state\n   * of the transactions array. After calling this method you need\n   * to invalidate all Chunks.\n   */\n  updateChunks(): void {\n    if (this._trace) this._trace.push({type: 'updateChunks'})\n\n    this._removeInvalidatedChunks()\n    this._addChunksFromTransactions()\n    this._createInitialChunk()\n  }\n\n  private _removeInvalidatedChunks() {\n    if (this._recreateTransactionsFrom) {\n      while (this._chunks.length > 0) {\n        const chunk = this._chunks.last\n        if (this._recreateTransactionsFrom < chunk.end) {\n          this._chunks.removeFromEnd()\n        } else {\n          break\n        }\n      }\n      this._recreateTransactionsFrom = undefined\n    }\n  }\n\n  private _addChunksFromTransactions() {\n    const firstIdx = this._transactions.firstIdx\n    const lastIdx = this._transactions.lastIdx\n\n    // Add transactions at the end:\n    const nextTransactionToChunk = this._chunks.length > 0 ? this._chunks.last.end : firstIdx\n    for (let idx = nextTransactionToChunk; idx <= lastIdx; idx++) {\n      const transaction = this._transactions.get(idx)\n      this._chunks.mergeAtEnd(chunkFromTransaction(transaction), mergeChunk)\n    }\n\n    // Add transactions at the beginning:\n    if (this._chunks.length == 0) return\n\n    const firstTransactionChunked = this._chunks.first.start\n\n    for (let idx = firstTransactionChunked - 1; idx >= firstIdx; idx--) {\n      const transaction = this._transactions.get(idx)\n      this._chunks.mergeAtBeginning(chunkFromTransaction(transaction), mergeChunk)\n    }\n  }\n\n  private _invalidateTransactionFrom(idx: number) {\n    if (this._recreateTransactionsFrom === undefined || idx < this._recreateTransactionsFrom) {\n      this._recreateTransactionsFrom = idx\n    }\n  }\n\n  private _createInitialChunk() {\n    if (this.reachedEarliestEntry) {\n      if (this._chunks.first?.type === 'initial') return\n\n      const firstTx = this._transactions.first\n      if (!firstTx) return\n      const initialChunk = chunkFromTransaction(firstTx)\n      initialChunk.type = 'initial'\n      initialChunk.id = '@initial'\n      initialChunk.end = initialChunk.start\n      this._chunks.addToBeginning(initialChunk)\n    }\n  }\n\n  /**\n   * Resolves a time reference.\n   *\n   * Note that the chunk returned is only valid if the timeline stays constant.\n   * Once the timeline is updated, you must re-parse all references.\n   */\n  parseTimeId(id: string): ParsedTimeRef {\n    if (this._chunks.length === 0) {\n      return this.reachedEarliestEntry ? 'invalid' : 'loading'\n    }\n\n    // NOTE:\n    // This was refactored from\n    // ```\n    // const [timestampStr, chunkId] = id.split('/', 3)\n    // ```\n    // in order to avoid issues with `@microsoft/api-extractor`.\n    const idSegments = id.split('/', 3)\n    const timestampStr = idSegments.shift()\n    const chunkId = idSegments.shift()\n    const timestamp = Number(timestampStr)\n\n    for (let idx = this._chunks.lastIdx; idx >= this._chunks.firstIdx; idx--) {\n      const chunk = this._chunks.get(idx)\n      if (chunk.id === chunkId) {\n        return chunk\n      }\n\n      if (Date.parse(chunk.endTimestamp) + 60 * 60 * 1000 < timestamp) {\n        // The chunk ended _before_ the timestamp we're asking for. This means that there\n        // is no point in looking further and the chunk is invalid.\n\n        // We add 1 hour to allow some slack since transactions are not guaranteed to be in order.\n        return 'invalid'\n      }\n    }\n\n    return this.reachedEarliestEntry ? 'invalid' : 'loading'\n  }\n\n  findLastPublishedBefore(chunk: Chunk | null): ParsedTimeRef {\n    for (\n      let chunkIdx = chunk ? chunk.index - 1 : this._chunks.lastIdx;\n      chunkIdx >= this._chunks.firstIdx;\n      chunkIdx--\n    ) {\n      const currentChunk = this._chunks.get(chunkIdx)\n      if (currentChunk.type === 'publish' || currentChunk.type === 'initial') {\n        return currentChunk\n      }\n    }\n\n    if (!this.reachedEarliestEntry) return 'loading'\n\n    return this._chunks.first\n  }\n\n  isLatestChunk(chunk: Chunk): boolean {\n    return chunk === this._chunks.last\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  createTimeId(chunk: Chunk): string {\n    return `${chunk.endTimestamp.valueOf()}/${chunk.id}`\n  }\n\n  lastChunk(): Chunk {\n    return this._chunks.last\n  }\n\n  transactionByIndex(idx: number): Transaction | null {\n    if (!this._transactions.has(idx)) return null\n    return this._transactions.get(idx)\n  }\n\n  chunkByTransactionIndex(idx: number, startChunkIdx = 0): Chunk {\n    let chunkIdx = startChunkIdx\n    for (;;) {\n      const chunk = this._chunks.get(chunkIdx)\n      if (!chunk) throw new Error('transaction does not belong in any chunk')\n\n      if (idx >= chunk.end) {\n        chunkIdx++\n      } else if (idx < chunk.start) {\n        chunkIdx--\n      } else {\n        return chunk\n      }\n    }\n  }\n\n  replayBackwardsBetween(\n    firstIdx: number,\n    lastIdx: number,\n    doc: CombinedDocument,\n  ): CombinedDocument {\n    let draft = doc.draft\n    let published = doc.published\n\n    for (let idx = lastIdx; idx >= firstIdx; idx--) {\n      const transaction = this._transactions.get(idx)\n\n      if (transaction.draftEffect) {\n        draft = applyPatch(draft, transaction.draftEffect.revert)\n      }\n\n      if (transaction.publishedEffect) {\n        published = applyPatch(published, transaction.publishedEffect.revert)\n      }\n    }\n\n    return {draft, published}\n  }\n\n  replayBackwardsUntil(firstIdx: number, doc: CombinedDocument): CombinedDocument {\n    return this.replayBackwardsBetween(firstIdx, this._transactions.lastIdx, doc)\n  }\n\n  calculateDiff(\n    initialDoc: CombinedDocument,\n    finalDoc: CombinedDocument,\n    firstIdx: number,\n    lastIdx: number,\n  ): Diff<Annotation> {\n    let draftValue = incremental.wrap<Meta>(initialDoc.draft, null)\n    let publishedValue = incremental.wrap<Meta>(initialDoc.published, null)\n\n    const initialValue = getValue(draftValue, publishedValue)\n    const initialAttributes = getAttrs(initialDoc)\n    let firstChunk: Chunk | null = null\n\n    // Loop over all of the chunks:\n    for (let chunkIdx = firstIdx; chunkIdx <= lastIdx; chunkIdx++) {\n      const chunk = this._chunks.get(chunkIdx)\n      if (!firstChunk) firstChunk = chunk\n\n      for (let idx = chunk.start; idx < chunk.end; idx++) {\n        const transaction = this._transactions.get(idx)\n\n        const meta = {\n          chunk,\n          transactionIndex: idx,\n        }\n\n        const preDraftValue = draftValue\n        const prePublishedValue = publishedValue\n\n        if (transaction.draftEffect) {\n          draftValue = incremental.applyPatch(draftValue, transaction.draftEffect.apply, meta)\n        }\n\n        if (transaction.publishedEffect) {\n          publishedValue = incremental.applyPatch(\n            publishedValue,\n            transaction.publishedEffect.apply,\n            meta,\n          )\n        }\n\n        const didHaveDriaft = incremental.getType(preDraftValue) !== 'null'\n        const haveDraft = incremental.getType(draftValue) !== 'null'\n        const havePublished = incremental.getType(publishedValue) !== 'null'\n\n        if (havePublished && !haveDraft) {\n          publishedValue = incremental.rebaseValue(preDraftValue, publishedValue)\n        }\n\n        if (haveDraft && !didHaveDriaft) {\n          draftValue = incremental.rebaseValue(prePublishedValue, draftValue)\n        }\n      }\n    }\n\n    const finalValue = incremental.getType(draftValue) === 'null' ? publishedValue : draftValue\n    const finalAttributes = getAttrs(finalDoc)\n\n    return diffValue(this, firstChunk, initialValue, initialAttributes, finalValue, finalAttributes)\n  }\n}\n\nfunction getValue(draftValue: incremental.Value<Meta>, publishedValue: incremental.Value<Meta>) {\n  return incremental.getType(draftValue) === 'null' ? publishedValue : draftValue\n}\n","import {type SanityDocument, type TransactionLogEventWithEffects} from '@sanity/types'\nimport {applyPatch} from 'mendoza'\n\nimport {type RemoteSnapshotVersionEvent} from '../../document/document-pair/checkoutPair'\nimport {type Timeline} from './Timeline'\nimport {type CombinedDocument, type DocumentRemoteMutationVersionEvent} from './types'\n\ntype VersionState = {\n  id: string\n  hasAttrs: boolean\n  attrs: Record<string, unknown> | null\n  rev: string | null\n  events: Array<DocumentRemoteMutationVersionEvent>\n  aligned: boolean\n}\n\nfunction emptyVersionState(id: string): VersionState {\n  return {\n    id,\n    hasAttrs: false,\n    attrs: null,\n    rev: null,\n    events: [],\n    aligned: false,\n  }\n}\n\nfunction align(history: TransactionLogEventWithEffects, state: VersionState): number {\n  const idx = state.events.findIndex((evt) => history.id === evt.transactionId)\n  if (idx >= 0) {\n    // Return the next event as we don't want this to be included.\n    return idx + 1\n  }\n\n  if (state.rev) {\n    return state.rev === history.id ? 0 : -1\n  }\n\n  // At this point the document doesn't exist and we were not able to match\n  // it up with a received mutation. This is a bit unfortunate as we don't\n  // have a _reliably_ way of aligning it. For now we just always assume\n  // that it's consistent.\n\n  return 0\n}\n\nfunction startFromSnapshot(state: VersionState, doc: SanityDocument) {\n  state.hasAttrs = true\n\n  if (doc) {\n    state.attrs = {...doc}\n    if (typeof state.attrs._rev != 'string') throw new Error('snapshot has no _rev')\n    state.rev = state.attrs._rev\n    delete state.attrs._rev\n  } else {\n    state.attrs = null\n    state.rev = null\n  }\n\n  state.events = []\n}\n\n/**\n * The timeline consists of data from (1) the history, (2) live draft mutations, and\n * (3) live published mutations. It's critical for us that the chain of transactions\n * is complete and without holes. The following class can be used as a layer in front\n * of Timeline to ensure this:\n *\n * - Invoke `appendRemoteSnapshotEvent` when there's an incoming remote mutation.\n *   These mutations are buffered internally and _not_ passed to the timeline quite yet.\n *\n * - Once we've received snapshots for both draft and published, then `acceptsHistory`\n *   becomes true and the caller can fetch a chunk of the translog. The flag\n *   `earliestTransactionId` can be used to figure out where to fetch transactions from.\n *\n * - The caller invokes `prependHistoryEvent` for each of the events. These history events\n *   are always pushed to the timeline and it will become available immediately.\n *\n * - Internally this class will then try to align the history event to the received\n *   mutations and then dispatch to the timeline.\n *\n * - The aligner also maintains the latest version for both the draft and the published version.\n *\n *\n */\nexport class Aligner {\n  timeline: Timeline\n  earliestTransactionId: string | null = null\n\n  constructor(timeline: Timeline) {\n    this.timeline = timeline\n    this._states = {\n      draft: emptyVersionState(timeline.draftId),\n      published: emptyVersionState(timeline.publishedId),\n    }\n  }\n\n  private _states: {\n    draft: VersionState\n    published: VersionState\n  }\n\n  appendRemoteSnapshotEvent(evt: RemoteSnapshotVersionEvent): void {\n    const state = this._states[evt.version]\n\n    if (evt.type === 'snapshot') {\n      this._maybeInvalidateHistory()\n\n      startFromSnapshot(state, evt.document)\n      return\n    }\n\n    if (evt.type === 'remoteMutation') {\n      if (state.aligned) {\n        this._apply(state, evt)\n        this.timeline.addRemoteMutation(evt)\n      } else if (state.hasAttrs) {\n        state.events.push(evt)\n      } else {\n        startFromSnapshot(state, evt.head)\n      }\n    }\n  }\n\n  prependHistoryEvent(evt: TransactionLogEventWithEffects): void {\n    if (!this.acceptsHistory) throw new Error('cannot prepend history at this point')\n\n    for (const state of Object.values(this._states)) {\n      if (!state.aligned) {\n        const idx = align(evt, state)\n\n        if (idx >= 0) {\n          this._alignAtIndex(state, idx)\n        }\n      }\n    }\n\n    this.timeline.addTranslogEntry(evt)\n    this.earliestTransactionId = evt.id\n  }\n\n  didReachEarliestEntry(): void {\n    for (const state of Object.values(this._states)) {\n      if (!state.aligned) {\n        if (state.attrs !== null) throw new Error('unable to find translog entry to align to')\n        this._alignAtIndex(state, 0)\n      }\n    }\n    this.timeline.didReachEarliestEntry()\n  }\n\n  get isAligned(): boolean {\n    return Object.values(this._states).every((state) => state.aligned)\n  }\n\n  get acceptsHistory(): boolean {\n    return this._isComplete\n  }\n\n  get currentDocument(): CombinedDocument {\n    return {draft: this._states.draft.attrs, published: this._states.published.attrs}\n  }\n\n  private _alignAtIndex(state: VersionState, idx: number) {\n    // These we must only apply locally since they are present in the fetched translog.\n    for (const mutEvt of state.events.slice(0, idx)) {\n      this._apply(state, mutEvt)\n    }\n\n    // ... while these must also be pushed to the timeline:\n    for (const mutEvt of state.events.slice(idx)) {\n      this._apply(state, mutEvt)\n      this.timeline.addRemoteMutation(mutEvt)\n    }\n\n    state.events = []\n    state.aligned = true\n  }\n\n  private get _isComplete(): boolean {\n    return Object.values(this._states).every((state) => state.hasAttrs)\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  private _apply(state: VersionState, evt: DocumentRemoteMutationVersionEvent) {\n    state.attrs = applyPatch(state.attrs, evt.effects.apply as any)\n    state.rev = evt.transactionId\n  }\n\n  private _maybeInvalidateHistory() {\n    if (this._isComplete) {\n      for (const state of Object.values(this._states)) {\n        state.aligned = false\n      }\n      this.earliestTransactionId = null\n      this.timeline.reset()\n    }\n  }\n}\n","import {type Diff} from '@sanity/diff'\n\nimport {type Annotation, type Chunk} from '../../../../field'\nimport {type Timeline} from './Timeline'\nimport {type CombinedDocument} from './types'\n\n/**\n * A reconstruction represents a single reconstruction of a\n */\nexport class Reconstruction {\n  timeline: Timeline\n  start: Chunk | null\n  end: Chunk\n  doc: CombinedDocument\n\n  constructor(timeline: Timeline, doc: CombinedDocument, start: Chunk | null, end: Chunk) {\n    this.timeline = timeline\n    this.start = start\n    this.end = end\n    this.doc = doc\n  }\n\n  same(start: Chunk | null, end: Chunk): boolean {\n    return this.start === start && this.end === end\n  }\n\n  private _startDocument?: CombinedDocument\n  private _endDocument?: CombinedDocument\n  private _diff?: Diff<Annotation>\n\n  /** Returns the attributes as seen at the end of the range. */\n  endAttributes(): Record<string, unknown> | null {\n    return getAttrs(this.endDocument())\n  }\n\n  endDocument(): CombinedDocument {\n    if (!this._endDocument) {\n      this._endDocument = this.timeline.replayBackwardsUntil(this.end.end, this.doc)\n    }\n\n    return this._endDocument\n  }\n\n  /** Returns the attributes as seen at the end of the range. */\n  startAttributes(): Record<string, unknown> | null {\n    return getAttrs(this.startDocument())\n  }\n\n  startDocument(): CombinedDocument {\n    if (!this.start) throw new Error('start required')\n\n    if (!this._startDocument) {\n      this._startDocument = this.timeline.replayBackwardsBetween(\n        this.start.end,\n        this.end.end - 1,\n        this.endDocument(),\n      )\n    }\n\n    return this._startDocument\n  }\n\n  diff(): Diff<Annotation> {\n    if (!this._diff) {\n      if (!this.start) throw new Error('start required')\n\n      this._diff = this.timeline.calculateDiff(\n        this.startDocument(),\n        this.endDocument(),\n        this.start.index + 1,\n        this.end.index,\n      )\n    }\n\n    return this._diff\n  }\n}\n\nfunction getAttrs(doc: CombinedDocument) {\n  return doc.draft || doc.published\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type Diff, type ObjectDiff} from '@sanity/diff'\n\nimport {type Annotation, type Chunk} from '../../../../field'\nimport {type RemoteSnapshotVersionEvent} from '../../document/document-pair/checkoutPair'\nimport {Aligner} from './Aligner'\nimport {getJsonStream} from './getJsonStream'\nimport {Reconstruction} from './Reconstruction'\nimport {type ParsedTimeRef, type Timeline} from './Timeline'\n\nconst TRANSLOG_ENTRY_LIMIT = 50\n\n/**\n * @hidden\n * @beta */\nexport type TimelineControllerOptions = {\n  timeline: Timeline\n  client: SanityClient\n  documentId: string\n  documentType: string\n  handler?: (err: Error | null, controller: TimelineController) => void\n}\n\n/**\n * @hidden\n * @beta */\nexport type SelectionState = 'inactive' | 'rev' | 'range' | 'loading' | 'invalid'\n\n/**\n * The controller is responsible for fetching information\n * about a document and maintaining a Timeline.\n *\n *\n * @hidden\n * @beta\n */\nexport class TimelineController {\n  timeline: Timeline\n  client: SanityClient\n  handler: TimelineControllerOptions['handler']\n\n  version = 0\n\n  /**\n   * The selection state represents the  different states of the current selection:\n   * - inactive: No selection is active.\n   * - rev: A selection is active for a single revision.\n   * - range: A selection is active for a range and we have all the data needed to render it.\n   * - loading: A selection is active, but we don't have the entries yet.\n   * - invalid: The selection picked is invalid.\n   */\n  selectionState: SelectionState = 'inactive'\n\n  constructor(options: TimelineControllerOptions) {\n    this.timeline = options.timeline\n    this.client = options.client\n    this.handler = options.handler\n    this._aligner = new Aligner(this.timeline)\n\n    this.markChange()\n  }\n\n  private _aligner: Aligner\n\n  private _fetchMore = false\n  private _fetchAtLeast = 0\n  private _isRunning = false\n  private _isSuspended = false\n  private _didErr = false\n\n  private _since: string | null = null\n  private _sinceTime: ParsedTimeRef | null = null\n  private _rev: string | null = null\n  private _revTime: ParsedTimeRef | null = null\n\n  private _reconstruction?: Reconstruction\n\n  clearRange(): void {\n    this.setRange(null, null)\n  }\n\n  setRange(since: string | null, rev: string | null): void {\n    if (rev !== this._rev) this.setRevTime(rev)\n    if (since !== this._since) this.setSinceTime(since)\n\n    let _fetchAtLeast = 10\n\n    if (this._sinceTime === 'loading' || this._revTime === 'loading' || !this._aligner.isAligned) {\n      this.selectionState = 'loading'\n    } else if (this._sinceTime === 'invalid' || this._revTime === 'invalid') {\n      this.selectionState = 'invalid'\n    } else if (this._sinceTime) {\n      this.selectionState = 'range'\n\n      const targetRev = this._revTime || this.timeline.lastChunk()\n\n      if (this._sinceTime.index > targetRev.index) {\n        this._revTime = 'invalid'\n        this.selectionState = 'invalid'\n      } else {\n        this.setReconstruction(this._sinceTime, targetRev)\n      }\n    } else if (this._revTime) {\n      this.selectionState = 'rev'\n      this.setReconstruction(null, this._revTime)\n    } else {\n      this.selectionState = 'inactive'\n      _fetchAtLeast = 0\n    }\n\n    this._fetchAtLeast = _fetchAtLeast\n\n    this.start()\n  }\n\n  setLoadMore(flag: boolean): void {\n    this._fetchMore = flag\n    this.start()\n  }\n\n  get sinceTime(): Chunk | null {\n    return this._sinceTime && typeof this._sinceTime === 'object' ? this._sinceTime : null\n  }\n\n  get revTime(): Chunk | null {\n    return this._revTime && typeof this._revTime === 'object' ? this._revTime : null\n  }\n\n  get realRevChunk(): Chunk {\n    return this.revTime || this.timeline.lastChunk()\n  }\n\n  /** Returns true when there's an older revision we want to render. */\n  onOlderRevision(): boolean {\n    return Boolean(this._rev) && (this.selectionState === 'range' || this.selectionState === 'rev')\n  }\n\n  findRangeForNewRev(rev: Chunk): [string | null, string | null] {\n    const revTimeId = this.timeline.isLatestChunk(rev) ? null : this.timeline.createTimeId(rev)\n\n    if (!this._since) {\n      return [null, revTimeId]\n    }\n\n    const sinceChunk = this.sinceTime\n    if (sinceChunk && sinceChunk.index < rev.index) {\n      return [this._since, revTimeId]\n    }\n\n    return ['@lastPublished', revTimeId]\n  }\n\n  findRangeForNewSince(since: Chunk): [string, string | null] {\n    const revChunk = this.revTime\n\n    // If the the `since` timestamp is earlier than the `rev`, then we can\n    // accept it. Otherwise we'll move the current revision to the current draft.\n\n    if (revChunk && since.index < revChunk.index) {\n      return [this.timeline.createTimeId(since), this._rev]\n    }\n\n    return [this.timeline.createTimeId(since), null]\n  }\n\n  setRevTime(rev: string | null): void {\n    this._rev = rev\n    this._revTime = rev ? this.timeline.parseTimeId(rev) : null\n\n    if (this._since === '@lastPublished') {\n      // Make sure we invalidate it since this depends on the _rev.\n      this._since = null\n      this._sinceTime = null\n    }\n  }\n\n  setSinceTime(since: string | null): void {\n    if (since === '@lastPublished') {\n      if (typeof this._revTime === 'string') {\n        this._sinceTime = this._revTime\n      } else {\n        this._sinceTime = this.timeline.findLastPublishedBefore(this._revTime)\n      }\n    } else {\n      this._sinceTime = since ? this.timeline.parseTimeId(since) : null\n    }\n\n    this._since = since\n  }\n\n  sinceAttributes(): Record<string, unknown> | null {\n    return this._sinceTime && this._reconstruction ? this._reconstruction.startAttributes() : null\n  }\n\n  displayed(): Record<string, unknown> | null {\n    return this._revTime && this._reconstruction ? this._reconstruction.endAttributes() : null\n  }\n\n  setReconstruction(since: Chunk | null, rev: Chunk): void {\n    if (this._reconstruction && this._reconstruction.same(since, rev)) return\n    this._reconstruction = new Reconstruction(\n      this.timeline,\n      this._aligner.currentDocument,\n      since,\n      rev,\n    )\n  }\n\n  currentDiff(): Diff<Annotation> | null {\n    return this._reconstruction ? this._reconstruction.diff() : null\n  }\n\n  currentObjectDiff(): ObjectDiff<Annotation> | null {\n    const diff = this.currentDiff()\n    if (diff) {\n      if (diff.type === 'null') return null\n      if (diff.type !== 'object') throw new Error(`ObjectDiff expected, got ${diff.type}`)\n    }\n\n    return diff as ObjectDiff<Annotation>\n  }\n\n  handleRemoteMutation(ev: RemoteSnapshotVersionEvent): void {\n    this._aligner.appendRemoteSnapshotEvent(ev)\n    this.markChange()\n\n    // Make sure we fetch history as soon as possible.\n    if (this._aligner.acceptsHistory) this.start()\n  }\n\n  start(): void {\n    if (this._didErr) return\n\n    if (!this._isRunning) {\n      this._isRunning = true\n\n      this.tick().then(() => {\n        this._isRunning = false\n      })\n    }\n  }\n\n  resume(): void {\n    this._isSuspended = false\n  }\n\n  suspend(): void {\n    this._isSuspended = true\n  }\n\n  private async tick() {\n    const shouldFetchMore =\n      this._aligner.acceptsHistory &&\n      !this.timeline.reachedEarliestEntry &&\n      (this.selectionState === 'loading' ||\n        this._fetchMore ||\n        this.timeline.chunkCount <= this._fetchAtLeast) &&\n      !this._isSuspended\n\n    if (!shouldFetchMore) {\n      return\n    }\n\n    try {\n      await this.fetchMoreTransactions()\n    } catch (err) {\n      this._didErr = true\n      this.handler?.(err, this)\n      return\n    }\n\n    await this.tick()\n  }\n\n  private async fetchMoreTransactions() {\n    const publishedId = this.timeline.publishedId\n    const draftId = this.timeline.draftId\n    const clientConfig = this.client.config()\n    const limit = TRANSLOG_ENTRY_LIMIT\n\n    let queryParams = `tag=sanity.studio.structure.history&effectFormat=mendoza&excludeContent=true&excludeMutations=true&includeIdentifiedDocumentsOnly=true&reverse=true&limit=${limit}`\n    let tid = this._aligner.earliestTransactionId\n    if (tid) {\n      queryParams += `&toTransaction=${tid}`\n    }\n\n    const transactionsUrl = this.client.getUrl(\n      `/data/history/${clientConfig.dataset}/transactions/${publishedId},${draftId}?${queryParams}`,\n    )\n    const stream = await getJsonStream(transactionsUrl, clientConfig.token)\n    const reader = stream.getReader()\n    let count = 0\n\n    for (;;) {\n      // eslint-disable-next-line no-await-in-loop\n      const result = await reader.read()\n      if (result.done) break\n\n      if ('error' in result.value) {\n        throw new Error(result.value.error.description || result.value.error.type)\n      }\n\n      count++\n\n      if (result.value.id === tid) {\n        // toTransaction is inclusive so we must ignore it when we fetch the next page\n        continue\n      }\n\n      // For some reason, the aligner is now interested in a different set of entries.\n      // This can happen if a new snapshot comes in as we're streaming the translog.\n      // In this case it's safe to abort, and the run-loop will re-schedule it correctly.\n      if (this._aligner.earliestTransactionId !== tid || !this._aligner.acceptsHistory) {\n        return\n      }\n\n      this._aligner.prependHistoryEvent(result.value)\n      tid = this._aligner.earliestTransactionId\n    }\n\n    // Same consistency checking here:\n    if (this._aligner.earliestTransactionId !== tid || !this._aligner.acceptsHistory) {\n      return\n    }\n\n    if (count < limit) {\n      this._aligner.didReachEarliestEntry()\n    }\n\n    this.markChange()\n  }\n\n  private markChange() {\n    this.timeline.updateChunks()\n\n    this.setRevTime(this._rev)\n    this.setSinceTime(this._rev)\n\n    this.version++\n    this.handler?.(null, this)\n  }\n}\n","import {type SanityClient} from '@sanity/client'\nimport {\n  isReference,\n  type Reference,\n  type SanityDocument,\n  type TransactionLogEventWithMutations,\n} from '@sanity/types'\nimport {reduce as jsonReduce} from 'json-reduce'\nimport {from, type Observable} from 'rxjs'\nimport {map, mergeMap} from 'rxjs/operators'\n\nimport {isDev} from '../../../environment'\nimport {getDraftId, getPublishedId, isRecord} from '../../../util'\nimport {Timeline, TimelineController} from './history'\n\n/**\n * @hidden\n * @beta */\nexport interface HistoryStore {\n  getDocumentAtRevision: (\n    documentId: string,\n    revision: string,\n  ) => Promise<SanityDocument | undefined>\n\n  getHistory: (\n    documentIds: string[],\n    options?: {time?: string; revision?: string},\n  ) => Promise<{documents: SanityDocument[]}>\n\n  getTransactions: (documentIds: string[]) => Promise<TransactionLogEventWithMutations[]>\n\n  restore: (id: string, targetId: string, rev: string) => Observable<SanityDocument>\n\n  /** @internal */\n  getTimelineController: (options: {\n    client: SanityClient\n    documentId: string\n    documentType: string\n  }) => TimelineController\n}\n\nconst documentRevisionCache: Record<string, Promise<SanityDocument | undefined> | undefined> =\n  Object.create(null)\n\nconst getHistory = (\n  client: SanityClient,\n  documentIds: string[],\n  options: {time?: string; revision?: string} = {},\n): Promise<{documents: SanityDocument[]}> => {\n  const ids = Array.isArray(documentIds) ? documentIds : [documentIds]\n  const {time, revision} = options\n\n  if (time && revision) {\n    throw new Error(`getHistory can't handle both time and revision parameters`)\n  }\n\n  const dataset = client.config().dataset\n  let url = `/data/history/${dataset}/documents/${ids.join(',')}`\n\n  if (revision) {\n    url = `${url}?revision=${revision}`\n  } else {\n    const timestamp = time || new Date().toISOString()\n\n    url = `${url}?time=${timestamp}`\n  }\n\n  return client.request({url})\n}\n\nconst getDocumentAtRevision = (\n  client: SanityClient,\n  documentId: string,\n  revision: string,\n): Promise<SanityDocument | undefined> => {\n  const publishedId = getPublishedId(documentId)\n  const draftId = getDraftId(documentId)\n  const cacheKey = `${publishedId}@${revision}`\n  const cached = documentRevisionCache[cacheKey]\n  if (cached) {\n    return cached\n  }\n\n  const dataset = client.config().dataset\n  const url = `/data/history/${dataset}/documents/${publishedId},${draftId}?revision=${revision}`\n\n  const entry = client.request<{documents?: SanityDocument[]}>({url}).then((result) => {\n    const documents = result.documents || []\n    const published = documents.find((res) => res._id === publishedId)\n    const draft = documents.find((res) => res._id === draftId)\n    return draft || published\n  })\n\n  documentRevisionCache[cacheKey] = entry\n  return entry\n}\n\nconst getTimelineController = ({\n  client,\n  documentId,\n  documentType,\n}: {\n  client: SanityClient\n  documentId: string\n  documentType: string\n}): TimelineController => {\n  const timeline = new Timeline({\n    enableTrace: isDev,\n    publishedId: documentId,\n  })\n  return new TimelineController({\n    client,\n    documentId,\n    documentType,\n    timeline,\n  })\n}\n\nconst getTransactions = async (\n  client: SanityClient,\n  documentIds: string | string[],\n): Promise<TransactionLogEventWithMutations[]> => {\n  const ids = Array.isArray(documentIds) ? documentIds : [documentIds]\n  const dataset = client.config().dataset\n  const query = {excludeContent: 'true', includeIdentifiedDocumentsOnly: 'true'}\n  const url = `/data/history/${dataset}/transactions/${ids.join(',')}`\n  const result = await client.request({url, query})\n  const transactions = result\n    .toString('utf8')\n    .split('\\n')\n    .filter(Boolean)\n    .map((line: string) => JSON.parse(line))\n\n  return transactions\n}\n\nconst getAllRefIds = (doc: SanityDocument): string[] =>\n  jsonReduce(\n    doc as any,\n    (acc: any, node) => (isReference(node) && !acc.includes(node._ref) ? [...acc, node._ref] : acc),\n    [],\n  )\n\nfunction jsonMap(value: unknown, mapFn: any): any {\n  if (Array.isArray(value)) {\n    return mapFn(\n      value.map((item) => jsonMap(item, mapFn)).filter((item) => typeof item !== 'undefined'),\n    )\n  }\n\n  if (isRecord(value)) {\n    return mapFn(\n      Object.keys(value).reduce<Record<string, unknown>>((res, key) => {\n        const mappedValue = jsonMap(value[key], mapFn)\n        if (typeof mappedValue !== 'undefined') {\n          res[key] = mappedValue\n        }\n\n        return res\n      }, {}),\n    )\n  }\n\n  return mapFn(value)\n}\n\nconst mapRefNodes = (doc: SanityDocument, mapFn: (node: Reference) => Reference | undefined) =>\n  jsonMap(doc, (node: unknown) => (isReference(node) ? mapFn(node) : node))\n\n/** @internal */\nexport const removeMissingReferences = (\n  doc: SanityDocument,\n  existingIds: Record<string, boolean | undefined>,\n): SanityDocument =>\n  mapRefNodes(doc, (refNode) => {\n    const documentExists = existingIds[refNode._ref]\n    return documentExists ? refNode : undefined\n  })\n\nfunction restore(client: SanityClient, documentId: string, targetDocumentId: string, rev: string) {\n  return from(getDocumentAtRevision(client, documentId, rev)).pipe(\n    mergeMap((documentAtRevision) => {\n      if (!documentAtRevision) {\n        throw new Error(`Unable to find document with ID ${documentId} at revision ${rev}`)\n      }\n\n      const existingIdsQuery = getAllRefIds(documentAtRevision)\n        .map((refId) => `\"${refId}\": defined(*[_id==\"${refId}\"]._id)`)\n        .join(',')\n\n      return client.observable\n        .fetch<Record<string, boolean | undefined>>(`{${existingIdsQuery}}`)\n        .pipe(map((existingIds) => removeMissingReferences(documentAtRevision, existingIds)))\n    }),\n    map((documentAtRevision) => {\n      // Remove _updatedAt and create a new draft from the document at given revision\n      const {_updatedAt, ...document} = documentAtRevision\n      return {...document, _id: targetDocumentId}\n    }),\n    mergeMap((restoredDraft) =>\n      client.observable.createOrReplace(restoredDraft, {visibility: 'async'}),\n    ),\n  )\n}\n\n/** @internal */\nexport interface HistoryStoreOptions {\n  client: SanityClient\n}\n\n/** @internal */\nexport function createHistoryStore({client}: HistoryStoreOptions): HistoryStore {\n  return {\n    getDocumentAtRevision: (documentId, revision) =>\n      getDocumentAtRevision(client, documentId, revision),\n\n    getHistory: (documentIds, options) => getHistory(client, documentIds, options),\n\n    getTransactions: (documentIds) => getTransactions(client, documentIds),\n\n    restore: (id, targetId, rev) => restore(client, id, targetId, rev),\n\n    getTimelineController,\n  }\n}\n","import {type BifurClient} from '@sanity/bifur-client'\nimport {EMPTY, type Observable} from 'rxjs'\nimport {map, share} from 'rxjs/operators'\n\nimport {type PresenceLocation} from '../types'\nimport {type Transport, type TransportEvent, type TransportMessage} from './transport'\n\ntype BifurStateMessage = {\n  type: 'state'\n  i: string\n  m: {\n    sessionId: string\n    locations: PresenceLocation[]\n  }\n}\n\ntype BifurDisconnectMessage = {\n  type: 'disconnect'\n  i: string\n  m: {session: string}\n}\n\ntype RollCallEvent = {\n  type: 'rollCall'\n  i: string\n  session: string\n}\n\ntype IncomingBifurEvent<T> = RollCallEvent | BifurStateMessage | BifurDisconnectMessage\n\nconst handleIncomingMessage = (event: IncomingBifurEvent<Location[]>): TransportEvent => {\n  if (event.type === 'rollCall') {\n    return {\n      type: 'rollCall',\n      userId: event.i,\n      sessionId: event.session,\n    }\n  }\n  if (event.type === 'state') {\n    const {sessionId, locations} = event.m\n    return {\n      type: 'state',\n      userId: event.i,\n      sessionId: sessionId,\n      timestamp: new Date().toISOString(),\n      locations,\n    }\n  }\n\n  if (event.type === 'disconnect') {\n    return {\n      type: 'disconnect',\n      userId: event.i,\n      sessionId: event.m.session,\n      timestamp: new Date().toISOString(),\n    }\n  }\n\n  throw new Error(`Got unknown presence event: ${JSON.stringify(event)}`)\n}\n\nexport const createBifurTransport = (bifur: BifurClient, sessionId: string): Transport => {\n  const incomingEvents$: Observable<TransportEvent> = bifur\n    .request<IncomingBifurEvent<Location[]>>('presence')\n    .pipe(map(handleIncomingMessage))\n\n  const dispatchMessage = (message: TransportMessage): Observable<undefined> => {\n    if (message.type === 'rollCall') {\n      return bifur.request('presence_rollcall', {session: sessionId})\n    }\n\n    if (message.type === 'state') {\n      return bifur.request('presence_announce', {\n        data: {locations: message.locations, sessionId},\n      })\n    }\n\n    if (message.type === 'disconnect') {\n      return bifur.request('presence_disconnect', {session: sessionId})\n    }\n\n    return EMPTY\n  }\n\n  return [incomingEvents$.pipe(share()), dispatchMessage]\n}\n","import {sample} from 'lodash'\nimport {defer, timer} from 'rxjs'\nimport {map, mergeMapTo, shareReplay} from 'rxjs/operators'\n\nimport {type StateEvent} from './message-transports/transport'\n\nconst USERIDS = [\n  'pqSMwf6hH',\n  'pnLYqNfv5',\n  'priDVVmy8',\n  'p0NFOU0j8',\n  'pTDl2jw8d',\n  'pHMeQnTse',\n  'pDQYzJbyS',\n  'pZyoPHKUs',\n  'p4Tyi2Be5',\n  'pb9vii060',\n  'pE8yhOisw',\n  'p7Fd2C6Cj',\n  'p3exSgYCx',\n  'pbIQRYViC',\n  'p8GJaTEhN',\n  'p27ewL8aM',\n  'pYg97z75S',\n  'pdLr4quHv',\n  'pkJXiDgg6',\n  'pkl4UAKcA',\n\n  // Included to ensure we handle the case when a user profile cannot\n  // be fetched due to insufficient privileges or similar\n  'pNoExists',\n]\n\nconst PATHS = [\n  ['nested', 'first'],\n  ['nested', 'second'],\n  [\n    'nestedArray',\n    {_key: '565c867c8dac'},\n    'arrayNo1',\n    {_key: 'a645548a8f01'},\n    'arrayNo1',\n    {_key: '1685e372c40f'},\n    'fieldNo0',\n  ],\n  ['nestedArray', {_key: '565c867c8dac'}, 'fieldNo0'],\n  ['nestedArray', {_key: '565c867c8dac'}, 'arrayNo19', {_key: 'a02e7a93e2a2'}, 'fieldNo0'],\n  ['nestedArray', {_key: '565c867c8dac'}, 'arrayNo19', {_key: 'a02e7a93e2a2'}, 'fieldNo19'],\n  ['address', 'country'],\n  ['address', 'street'],\n  ['customInputWithDefaultPresence', 'row3', 'cell3'],\n]\n\nexport const mock$ = defer(() => timer(0, 10000)).pipe(\n  mergeMapTo(USERIDS),\n  map(\n    (id, n): StateEvent => ({\n      type: 'state',\n      userId: id,\n      sessionId: id + n,\n      timestamp: new Date().toISOString(),\n      locations: [\n        {\n          type: 'document',\n          documentId: 'presence-debug',\n          lastActiveAt: new Date().toISOString(),\n          path: sample(PATHS),\n        },\n      ] as any,\n    }),\n  ),\n  shareReplay(),\n)\n","/* eslint-disable camelcase */\n\nimport {type BifurClient} from '@sanity/bifur-client'\nimport {type User} from '@sanity/types'\nimport {flatten, groupBy, omit, uniq} from 'lodash'\nimport {nanoid} from 'nanoid'\nimport {\n  BehaviorSubject,\n  defer,\n  EMPTY,\n  from,\n  fromEvent,\n  merge,\n  NEVER,\n  type Observable,\n  timer,\n} from 'rxjs'\nimport {\n  auditTime,\n  distinctUntilChanged,\n  filter,\n  flatMap,\n  map,\n  mergeMapTo,\n  scan,\n  share,\n  shareReplay,\n  switchMap,\n  switchMapTo,\n  takeUntil,\n  tap,\n  toArray,\n  withLatestFrom,\n} from 'rxjs/operators'\n\nimport {type ConnectionStatusStore} from '../connection-status/connection-status-store'\nimport {debugParams$} from '../debugParams'\nimport {type UserStore} from '../user'\nimport {createBifurTransport} from './message-transports/bifurTransport'\nimport {\n  type DisconnectEvent,\n  type RollCallEvent,\n  type StateEvent,\n  type TransportEvent,\n} from './message-transports/transport'\nimport {mock$} from './mock-events'\nimport {\n  type DocumentPresence,\n  type GlobalPresence,\n  type PresenceLocation,\n  type Session,\n  type UserSessionPair,\n} from './types'\n\n/**\n * @hidden\n * @beta */\nexport interface PresenceStore {\n  /**\n   * @internal\n   */\n  documentPresence: (documentId: string) => Observable<DocumentPresence[]>\n\n  /**\n   * @internal\n   */\n  globalPresence$: Observable<GlobalPresence[]>\n\n  /**\n   * @internal\n   */\n  reportLocations: (locations: PresenceLocation[]) => Observable<void>\n\n  /**\n   * @internal\n   */\n  setLocation: (nextLocation: PresenceLocation[]) => void\n\n  /**\n   * @internal\n   */\n  debugPresenceParam$: Observable<string[]>\n}\n\nconst KEY = 'presence_session_id'\nconst generate = () => nanoid(16)\n\n// We're keeping the session id in sessionStorage as it will survive page reloads.\n// todo:\n//  There's a potential issue with window.open(...) here as it inherits the top level session storage and thus will\n//  re-use session ids:\n//    > Opening a page in a new tab or window creates a new session with the value of the top-level browsing context,\n//      which differs from how session cookies work.\n//      More at https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage\n//  This is _probably_ a quite marginal case and not going to be much of a issue in practice\nfunction getSessionId() {\n  try {\n    return window.sessionStorage.getItem(KEY)\n  } catch (err) {\n    // We don't want to fail hard if session storage can't be accessed for some reason\n  }\n  return null\n}\n\nfunction setSessionId(id: string) {\n  try {\n    window.sessionStorage.setItem(KEY, id)\n  } catch (err) {\n    // We don't want to fail hard if session storage can't be accessed for some reason\n  }\n  return id\n}\n\n/** @internal */\nexport const SESSION_ID = getSessionId() || setSessionId(generate())\n\n/** @internal */\nexport function __tmp_wrap_presenceStore(context: {\n  bifur: BifurClient\n  connectionStatusStore: ConnectionStatusStore\n  userStore: UserStore\n}): PresenceStore {\n  const {bifur, connectionStatusStore, userStore} = context\n\n  const [presenceEvents$, sendMessage] = createBifurTransport(bifur, SESSION_ID)\n\n  const currentLocation$ = new BehaviorSubject<PresenceLocation[]>([])\n  const locationChange$ = currentLocation$.pipe(distinctUntilChanged())\n\n  // export\n  const setLocation = (nextLocation: PresenceLocation[]) => {\n    currentLocation$.next(nextLocation)\n  }\n\n  // export\n  const reportLocations = (locations: PresenceLocation[]) =>\n    sendMessage({type: 'state', locations: locations})\n\n  const requestRollCall = () => sendMessage({type: 'rollCall'})\n\n  const rollCallRequests$ = presenceEvents$.pipe(\n    filter((event: TransportEvent): event is RollCallEvent => event.type === 'rollCall'),\n    // do not respond to my own rollcall requests\n    filter((event: RollCallEvent) => event.sessionId !== SESSION_ID),\n  )\n\n  const REPORT_MIN_INTERVAL = 30000\n\n  // Interval to report my own location at\n  const reportLocationInterval$ = timer(0, REPORT_MIN_INTERVAL)\n\n  const reportLocation$ = defer(() => merge(locationChange$, rollCallRequests$)).pipe(\n    switchMap(() => reportLocationInterval$),\n    withLatestFrom(currentLocation$),\n    map(([, locations]) => locations),\n    auditTime(200),\n    switchMap((locations) => reportLocations(locations)),\n    mergeMapTo(EMPTY),\n    share(),\n  )\n\n  // This represents my rollcall request to other clients\n  // Note: We are requesting a rollcall whenever we (re)connect\n  const myRollCall$ = defer(() => requestRollCall()).pipe(mergeMapTo(EMPTY))\n\n  const connectionChange$ = connectionStatusStore.connectionStatus$.pipe(\n    map((status) => status.type),\n    filter((statusType) => statusType === 'connected' || statusType === 'error'),\n    distinctUntilChanged(),\n  )\n\n  // export\n  const debugPresenceParam$ = debugParams$.pipe(\n    map((args) => args.find((arg) => arg.startsWith('presence='))),\n    map(\n      (arg) =>\n        arg\n          ?.split('presence=')[1]\n          .split(',')\n          .map((r) => r.trim()) || [],\n    ),\n  )\n\n  const useMock$ = debugPresenceParam$.pipe(\n    filter((args) => args.includes('fake_others')),\n    tap(() => {\n      // eslint-disable-next-line no-console\n      console.log(\n        'Faking other users present in the studio. They will hang out in the document with _type: \"presence\" and _id: \"presence-debug\"',\n      )\n    }),\n    switchMapTo(mock$),\n  )\n\n  const debugIntrospect$ = debugPresenceParam$.pipe(map((args) => args.includes('show_own')))\n\n  const syncEvent$ = merge(myRollCall$, presenceEvents$).pipe(\n    filter(\n      (event: TransportEvent): event is StateEvent | DisconnectEvent =>\n        event.type === 'state' || event.type === 'disconnect',\n    ),\n  )\n\n  const stateEventToSession = (stateEvent: StateEvent): Session => {\n    return {\n      lastActiveAt: stateEvent.timestamp,\n      locations: stateEvent.locations,\n      sessionId: stateEvent.sessionId,\n      userId: stateEvent.userId,\n    }\n  }\n\n  const states$: Observable<{[sessionId: string]: Session}> = merge(syncEvent$, useMock$).pipe(\n    scan(\n      (keyed, event: StateEvent | DisconnectEvent): {[sessionId: string]: Session} =>\n        event.type === 'disconnect'\n          ? omit(keyed, event.sessionId)\n          : {...keyed, [event.sessionId]: stateEventToSession(event)},\n      {},\n    ),\n  )\n\n  const allSessions$: Observable<UserSessionPair[]> = connectionChange$.pipe(\n    switchMap((status) => (status === 'connected' ? merge(states$, reportLocation$) : NEVER)),\n    map((keyedSessions) => Object.values(keyedSessions)),\n    switchMap((sessions) => {\n      const userIds = uniq(sessions.map((sess) => sess.userId))\n      return from(userStore.getUsers(userIds)).pipe(\n        map((users) =>\n          sessions\n            .map((session) => ({\n              // eslint-disable-next-line max-nested-callbacks\n              user: users.find((res) => res.id === session.userId),\n              session: session,\n            }))\n            // If we failed to find a user profile for a session, remove it\n            .filter(userSessionPairHasUser),\n        ),\n      )\n    }),\n    takeUntil(\n      fromEvent(window, 'beforeunload').pipe(switchMap(() => sendMessage({type: 'disconnect'}))),\n    ),\n    shareReplay({refCount: true, bufferSize: 1}),\n  )\n\n  function userSessionPairHasUser(pair: Partial<UserSessionPair>): pair is UserSessionPair {\n    return Boolean(pair.user && pair.session)\n  }\n\n  // export\n  const globalPresence$: Observable<GlobalPresence[]> = allSessions$.pipe(\n    map((sessions): {user: User; sessions: Session[]}[] => {\n      const grouped = groupBy(\n        sessions.map((s) => s.session),\n        (e) => e.userId,\n      )\n\n      return Object.keys(grouped).map((userId): {user: User; sessions: Session[]} => ({\n        user: sessions.find((s) => s.user.id === userId)?.user as User,\n        sessions: grouped[userId],\n      }))\n    }),\n    withLatestFrom(debugIntrospect$),\n    map(([userAndSessions, debugIntrospect]) =>\n      userAndSessions.filter((userAndSession) => {\n        if (debugIntrospect) {\n          return true\n        }\n\n        const isCurrent = userAndSession.sessions.some((sess) => sess.sessionId === SESSION_ID)\n\n        return !isCurrent\n      }),\n    ),\n    map((userAndSessions) =>\n      userAndSessions.map((userAndSession) => ({\n        user: userAndSession.user,\n        status: 'online',\n        lastActiveAt: userAndSession.sessions.sort()[0]?.lastActiveAt,\n        locations: flatten(\n          (userAndSession.sessions || []).map((session) => session.locations || []),\n        )\n          .map((location) => ({\n            type: location.type,\n            documentId: location.documentId,\n            path: location.path,\n            lastActiveAt: location.lastActiveAt,\n          }))\n          .reduce((prev, curr) => prev.concat(curr), [] as PresenceLocation[]),\n      })),\n    ),\n  )\n\n  // export\n  const documentPresence = (documentId: string): Observable<DocumentPresence[]> => {\n    return allSessions$.pipe(\n      withLatestFrom(debugIntrospect$),\n      switchMap(([userAndSessions, debugIntrospect]) =>\n        from(userAndSessions).pipe(\n          filter(\n            (userAndSession) => debugIntrospect || userAndSession.session.sessionId !== SESSION_ID,\n          ),\n          flatMap((userAndSession) =>\n            (userAndSession.session.locations || [])\n              .filter((item) => item.documentId === documentId)\n              .map((location) => ({\n                user: userAndSession.user,\n                lastActiveAt: userAndSession.session.lastActiveAt,\n                path: location.path || [],\n                sessionId: userAndSession.session.sessionId,\n              })),\n          ),\n          toArray(),\n        ),\n      ),\n    )\n  }\n\n  return {setLocation, reportLocations, debugPresenceParam$, globalPresence$, documentPresence}\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type Observable} from 'rxjs'\n\nimport {type ProjectData, type ProjectStore} from './types'\n\n/** @internal */\nexport function createProjectStore(context: {client: SanityClient}): ProjectStore {\n  const {client} = context\n  const projectId = client.config().projectId\n  const versionedClient = client.withConfig({apiVersion: '2021-12-15'})\n\n  function get(): Observable<ProjectData> {\n    return versionedClient.observable.request({\n      url: `/projects/${projectId}`,\n    })\n  }\n\n  function getDatasets() {\n    return versionedClient.observable.request({\n      url: `/projects/${projectId}/datasets`,\n    })\n  }\n\n  return {get, getDatasets}\n}\n","interface MultiKeyWeakMapNode {\n  type: 'multi-key-weak-map-node'\n  value: unknown\n  next: WeakMap<object, MultiKeyWeakMapNode>\n}\n\nexport interface MultiKeyWeakMap {\n  get<T>(keys: object[]): T | undefined\n  get(keys: object[]): unknown\n\n  set(keys: object[], value: unknown): void\n}\n\nexport function createMultiKeyWeakMap(): MultiKeyWeakMap {\n  const rootMap = new WeakMap<object, MultiKeyWeakMapNode>()\n  const idCache = new WeakMap<object, string>()\n\n  function randomId() {\n    return Array.from({length: 10})\n      .map(() =>\n        Math.floor(Math.random() * 255)\n          .toString(16)\n          .padStart(2, '0'),\n      )\n      .join('')\n  }\n\n  function assignId(key: object) {\n    const cachedId = idCache.get(key)\n    if (cachedId) return cachedId\n    const id = randomId()\n    idCache.set(key, id)\n    return id\n  }\n\n  function arrangeKeys(keys: object[]) {\n    return Array.from(new Set(keys))\n      .map((key) => [assignId(key), key] as const)\n      .sort(([a], [b]) => a.localeCompare(b, 'en'))\n      .map(([, key]) => key)\n  }\n\n  function getDeep(keys: object[], map: WeakMap<object, MultiKeyWeakMapNode>): unknown {\n    if (!keys.length) return undefined\n    const [firstKey, ...restOfKeys] = keys\n    const node = map.get(firstKey)\n\n    if (!node) return undefined\n    if (!restOfKeys.length) return node.value\n    return getDeep(restOfKeys, node.next)\n  }\n\n  function setDeep(\n    keys: object[],\n    map: WeakMap<object, MultiKeyWeakMapNode>,\n    value: unknown,\n  ): void {\n    if (!keys.length) return\n\n    const [firstKey, ...restOfKeys] = keys\n    const node = map.get(firstKey) || {\n      type: 'multi-key-weak-map-node',\n      value: undefined,\n      next: new WeakMap(),\n    }\n    map.set(firstKey, node)\n\n    if (!restOfKeys.length) {\n      node.value = value\n      return\n    }\n\n    setDeep(restOfKeys, node.next, value)\n  }\n\n  function get<T>(keys: object[]): T | undefined\n  function get(keys: object[]) {\n    return getDeep(arrangeKeys(keys), rootMap)\n  }\n\n  function set(keys: object[], value: unknown) {\n    setDeep(arrangeKeys(keys), rootMap, value)\n  }\n\n  return {get, set}\n}\n","import {createContext, type ReactNode, useContext, useMemo} from 'react'\n\nimport {createMultiKeyWeakMap, type MultiKeyWeakMap} from './createMultiKeyWeakMap'\n\n/** @internal */\nexport interface ResourceCache {\n  get<T = unknown>(options: {namespace: string; dependencies: (object | null)[]}): T | undefined\n  set(options: {namespace: string; dependencies: (object | null)[]; value: unknown}): void\n}\n\nconst ResourceCacheContext = createContext<ResourceCache | null>(null)\n\n/** @internal */\nexport interface ResourceCacheProviderProps {\n  children: ReactNode\n}\n\n/** @internal */\nexport function ResourceCacheProvider({children}: ResourceCacheProviderProps) {\n  const resourceCache = useMemo((): ResourceCache => {\n    const namespaces = new Map<string, MultiKeyWeakMap>()\n\n    // this is used to replace the `null` values in any `dependencies` so that\n    // they can be used in the `MultiKeyWeakMap` which doesn't accept null\n    const nullReplacer = {}\n\n    return {\n      get: ({namespace, dependencies}) => {\n        const dependenciesWithoutNull = dependencies.map((dep) =>\n          dep === null ? nullReplacer : dep,\n        )\n        const namespaceMap = namespaces.get(namespace)\n        return namespaceMap?.get(dependenciesWithoutNull)\n      },\n\n      set: ({namespace, dependencies, value}) => {\n        const namespaceMap = namespaces.get(namespace) || createMultiKeyWeakMap()\n        const dependenciesWithoutNull = dependencies.map((dep) =>\n          dep === null ? nullReplacer : dep,\n        )\n        namespaces.set(namespace, namespaceMap)\n        namespaceMap.set(dependenciesWithoutNull, value)\n      },\n    }\n  }, [])\n\n  return (\n    <ResourceCacheContext.Provider value={resourceCache}>{children}</ResourceCacheContext.Provider>\n  )\n}\n\n/** @internal */\nexport function useResourceCache(): ResourceCache {\n  const cache = useContext(ResourceCacheContext)\n  if (!cache) throw new Error('Could not find `cache` context')\n  return cache\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type CurrentUser, type User} from '@sanity/types'\nimport DataLoader from 'dataloader'\nimport raf from 'raf'\n\nimport {isRecord} from '../../../util'\n\n/** @internal */\nexport interface UserStoreOptions {\n  client: SanityClient\n  currentUser: CurrentUser | null\n}\n\nconst INTERNAL_USER_IDS: User[] = [\n  {\n    id: '<system>',\n    displayName: 'Sanity',\n    imageUrl: 'https://public.sanity.io/logos/favicon-192.png',\n  },\n]\n\n/**\n * @hidden\n * @beta */\nexport interface UserStore {\n  getUser(userId: string): Promise<User | null>\n  getUsers(userIds: string[]): Promise<User[]>\n}\n\n/**\n * Given a `client` and a `currentUser` creates a datastore that handles\n * fetching, batch fetching, and caching users.\n *\n * @internal\n */\nexport function createUserStore({client: _client, currentUser}: UserStoreOptions): UserStore {\n  const client = _client.withConfig({apiVersion: '2021-06-07'})\n\n  const userLoader = new DataLoader<string, User | null>(\n    async (userIds) => {\n      const value = await client.request<(User | null)[]>({\n        uri: `/users/${userIds.join(',')}`,\n        withCredentials: true,\n        tag: 'users.get',\n      })\n      const response = Array.isArray(value) ? value : [value]\n      const users = response.reduce(\n        (acc, next) => {\n          if (next?.id) {\n            acc[next.id] = next\n          }\n          return acc\n        },\n        {} as Record<string, User | null>,\n      )\n      return userIds.map((id) => users[id] || null)\n    },\n    {batchScheduleFn: (cb) => raf(cb)},\n  )\n\n  const userFromCurrentUser: User | null = currentUser && {\n    id: currentUser.id,\n    displayName: currentUser.name,\n    imageUrl: currentUser.profileImage,\n  }\n\n  userLoader.prime('me', userFromCurrentUser)\n\n  if (userFromCurrentUser?.id) {\n    userLoader.prime(userFromCurrentUser.id, userFromCurrentUser)\n  }\n\n  INTERNAL_USER_IDS.forEach((user) => userLoader.prime(user.id, user))\n\n  return {\n    getUser: async (userId) => {\n      if (!userId) return Promise.resolve(null)\n\n      try {\n        return await userLoader.load(userId)\n      } catch (err) {\n        /**\n         * 403 Forbidden responses indicate that the current user doesn't have read access to project members.\n         * In these instances, we don't throw and resolve `null` instead.\n         * Components consuming this (such as `<UserAvatar>`) shouldn't render anything in these cases.\n         */\n        if (err.statusCode === 403) {\n          return Promise.resolve(null)\n        }\n        // Throw all other errors\n        throw err\n      }\n    },\n    getUsers: async (userIds) => {\n      const results = await userLoader.loadMany(userIds)\n      /**\n       * Unlike `load()`, DataLoader's `loadMany()` will always resolve even if it contains `Error` instances.\n       * Here, we remove all Errors (or more specifically, only include records with valid IDs).\n       */\n      return results.filter(\n        (result): result is User => isRecord(result) && typeof result.id === 'string',\n      )\n    },\n  }\n}\n","/* eslint-disable camelcase */\n\nimport {useMemo} from 'react'\n\nimport {useClient, useSchema, useTemplates} from '../../hooks'\nimport {createDocumentPreviewStore, type DocumentPreviewStore} from '../../preview'\nimport {useSource, useWorkspace} from '../../studio'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../studioClient'\nimport {createKeyValueStore, type KeyValueStore} from '../key-value'\nimport {useCurrentUser} from '../user'\nimport {\n  type ConnectionStatusStore,\n  createConnectionStatusStore,\n} from './connection-status/connection-status-store'\nimport {createDocumentStore, type DocumentStore} from './document'\nimport {createGrantsStore, type GrantsStore} from './grants'\nimport {createHistoryStore, type HistoryStore} from './history'\nimport {__tmp_wrap_presenceStore, type PresenceStore} from './presence/presence-store'\nimport {createProjectStore, type ProjectStore} from './project'\nimport {useResourceCache} from './ResourceCacheProvider'\nimport {createUserStore, type UserStore} from './user'\n\n/**\n * @hidden\n * @beta */\nexport function useUserStore(): UserStore {\n  const {getClient, currentUser} = useSource()\n  const resourceCache = useResourceCache()\n  const client = getClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n\n  return useMemo(() => {\n    const userStore =\n      resourceCache.get<UserStore>({\n        namespace: 'userStore',\n        dependencies: [client, currentUser],\n      }) || createUserStore({client, currentUser})\n\n    resourceCache.set({\n      namespace: 'userStore',\n      dependencies: [client, currentUser],\n      value: userStore,\n    })\n\n    return userStore\n  }, [client, currentUser, resourceCache])\n}\n\n/**\n * @hidden\n * @beta */\nexport function useGrantsStore(): GrantsStore {\n  const {getClient} = useSource()\n  const client = getClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const currentUser = useCurrentUser()\n  const resourceCache = useResourceCache()\n\n  return useMemo(() => {\n    const grantsStore =\n      resourceCache.get<GrantsStore>({\n        namespace: 'grantsStore',\n        dependencies: [client, currentUser],\n      }) || createGrantsStore({client, userId: currentUser?.id || null})\n\n    resourceCache.set({\n      namespace: 'grantsStore',\n      dependencies: [client, currentUser],\n      value: grantsStore,\n    })\n\n    return grantsStore\n  }, [client, currentUser, resourceCache])\n}\n\n/**\n * @hidden\n * @beta */\nexport function useHistoryStore(): HistoryStore {\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const resourceCache = useResourceCache()\n\n  return useMemo(() => {\n    const historyStore =\n      resourceCache.get<HistoryStore>({\n        namespace: 'historyStore',\n        dependencies: [client],\n      }) || createHistoryStore({client})\n\n    resourceCache.set({\n      namespace: 'historyStore',\n      dependencies: [client],\n      value: historyStore,\n    })\n\n    return historyStore\n  }, [client, resourceCache])\n}\n\n/**\n * @hidden\n * @beta */\nexport function useDocumentPreviewStore(): DocumentPreviewStore {\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const resourceCache = useResourceCache()\n\n  return useMemo(() => {\n    const documentPreviewStore =\n      resourceCache.get<DocumentPreviewStore>({\n        namespace: 'documentPreviewStore',\n        dependencies: [client],\n      }) || createDocumentPreviewStore({client})\n\n    resourceCache.set({\n      namespace: 'documentPreviewStore',\n      dependencies: [client],\n      value: documentPreviewStore,\n    })\n\n    return documentPreviewStore\n  }, [client, resourceCache])\n}\n\n/**\n * @hidden\n * @beta */\nexport function useDocumentStore(): DocumentStore {\n  const {getClient, i18n} = useSource()\n  const schema = useSchema()\n  const templates = useTemplates()\n  const resourceCache = useResourceCache()\n  const historyStore = useHistoryStore()\n  const documentPreviewStore = useDocumentPreviewStore()\n\n  return useMemo(() => {\n    const documentStore =\n      resourceCache.get<DocumentStore>({\n        namespace: 'documentStore',\n        dependencies: [getClient, documentPreviewStore, historyStore, schema, i18n],\n      }) ||\n      createDocumentStore({\n        getClient,\n        documentPreviewStore,\n        historyStore,\n        initialValueTemplates: templates,\n        schema,\n        i18n,\n      })\n\n    resourceCache.set({\n      namespace: 'documentStore',\n      dependencies: [getClient, documentPreviewStore, historyStore, schema, i18n],\n      value: documentStore,\n    })\n\n    return documentStore\n  }, [getClient, documentPreviewStore, historyStore, resourceCache, schema, templates, i18n])\n}\n\n/** @internal */\nexport function useConnectionStatusStore(): ConnectionStatusStore {\n  const {bifur} = useSource().__internal\n  const resourceCache = useResourceCache()\n\n  return useMemo(() => {\n    const connectionStatusStore =\n      resourceCache.get<ConnectionStatusStore>({\n        namespace: 'connectionStatusStore',\n        dependencies: [bifur],\n      }) || createConnectionStatusStore({bifur})\n\n    resourceCache.set({\n      namespace: 'connectionStatusStore',\n      dependencies: [bifur],\n      value: connectionStatusStore,\n    })\n\n    return connectionStatusStore\n  }, [bifur, resourceCache])\n}\n\n/**\n * @hidden\n * @beta */\nexport function usePresenceStore(): PresenceStore {\n  const {\n    __internal: {bifur},\n  } = useSource()\n  const resourceCache = useResourceCache()\n  const userStore = useUserStore()\n  const connectionStatusStore = useConnectionStatusStore()\n\n  return useMemo(() => {\n    const presenceStore =\n      resourceCache.get<PresenceStore>({\n        namespace: 'presenceStore',\n        dependencies: [bifur, connectionStatusStore, userStore],\n      }) || __tmp_wrap_presenceStore({bifur, connectionStatusStore, userStore})\n\n    resourceCache.set({\n      namespace: 'presenceStore',\n      dependencies: [bifur, connectionStatusStore, userStore],\n      value: presenceStore,\n    })\n\n    return presenceStore\n  }, [bifur, connectionStatusStore, resourceCache, userStore])\n}\n\n/**\n * @hidden\n * @beta */\nexport function useProjectStore(): ProjectStore {\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const resourceCache = useResourceCache()\n\n  return useMemo(() => {\n    const projectStore =\n      resourceCache.get<ProjectStore>({\n        namespace: 'projectStore',\n        dependencies: [client],\n      }) || createProjectStore({client})\n\n    resourceCache.set({\n      namespace: 'projectStore',\n      dependencies: [client],\n      value: projectStore,\n    })\n\n    return projectStore\n  }, [client, resourceCache])\n}\n\n/** @internal */\nexport function useKeyValueStore(): KeyValueStore {\n  const resourceCache = useResourceCache()\n  const workspace = useWorkspace()\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n\n  return useMemo(() => {\n    const keyValueStore =\n      resourceCache.get<KeyValueStore>({\n        dependencies: [workspace],\n        namespace: 'KeyValueStore',\n      }) || createKeyValueStore({client})\n\n    resourceCache.set({\n      dependencies: [workspace],\n      namespace: 'KeyValueStore',\n      value: keyValueStore,\n    })\n\n    return keyValueStore\n  }, [client, resourceCache, workspace])\n}\n","import {useEffect, useState} from 'react'\n\nimport {usePresenceStore} from '../datastores'\nimport {type DocumentPresence} from './types'\n\n/** @internal */\nexport function useDocumentPresence(documentId: string): DocumentPresence[] {\n  const presenceStore = usePresenceStore()\n  const [presence, setPresence] = useState<DocumentPresence[]>([])\n\n  useEffect(() => {\n    const subscription = presenceStore.documentPresence(documentId).subscribe(setPresence)\n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [documentId, presenceStore])\n\n  return presence\n}\n","import {useEffect, useState} from 'react'\n\nimport {usePresenceStore} from '../datastores'\nimport {type GlobalPresence} from './types'\n\n/** @internal */\nexport function useGlobalPresence(): GlobalPresence[] {\n  const [presence, setPresence] = useState<GlobalPresence[]>([])\n  const presenceStore = usePresenceStore()\n\n  useEffect(() => {\n    const subscription = presenceStore.globalPresence$.subscribe(setPresence)\n\n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [presenceStore])\n\n  return presence\n}\n","import {type SanityDocument} from '@sanity/types'\nimport {useMemoObservable} from 'react-rx'\nimport {map, startWith} from 'rxjs/operators'\n\nimport {useDocumentStore} from '../store'\n\ninterface ReferringDocumentsState {\n  isLoading: boolean\n  referringDocuments: SanityDocument[]\n}\n\nconst INITIAL_STATE: ReferringDocumentsState = {referringDocuments: [], isLoading: true}\n\n/**\n * @internal\n * @param id - the id to search for referring documents for\n */\nexport function useReferringDocuments(id: string): ReferringDocumentsState {\n  const documentStore = useDocumentStore()\n  return useMemoObservable(\n    () =>\n      documentStore\n        .listenQuery(\n          '*[references($docId)] [0...101]',\n          {docId: id},\n          {tag: 'use-referring-documents'},\n        )\n        .pipe(\n          map(\n            (docs: SanityDocument[]): ReferringDocumentsState => ({\n              referringDocuments: docs,\n              isLoading: false,\n            }),\n          ),\n          startWith(INITIAL_STATE),\n        ),\n    [documentStore, id],\n    INITIAL_STATE,\n  )\n}\n","import {type Asset as AssetType, type SanityDocument} from '@sanity/types'\nimport {Card, Flex, Text} from '@sanity/ui'\nimport {type HTMLProps, useCallback} from 'react'\nimport {IntentLink} from 'sanity/router'\n\nimport {useSchema} from '../../../../hooks'\nimport {Translate, useTranslation} from '../../../../i18n'\nimport {Preview} from '../../../../preview/components/Preview'\n\nexport const AssetUsageList = ({\n  asset,\n  assetType,\n  referringDocuments,\n}: {\n  asset: AssetType\n  assetType: 'image' | 'file'\n  referringDocuments: SanityDocument[]\n}) => {\n  const {t} = useTranslation()\n  const count = referringDocuments.length\n  return (\n    <>\n      <Card borderBottom={count > 0} marginTop={2} paddingBottom={2} marginBottom={1}>\n        <Text size={1} as=\"h2\" weight=\"medium\">\n          <Translate\n            t={t}\n            i18nKey={`asset-source.usage-list.documents-using-${assetType}`}\n            context={asset.originalFilename ? 'named' : 'unnamed'}\n            values={{filename: asset.originalFilename, count}}\n          />\n        </Text>\n      </Card>\n      {referringDocuments.map((document: SanityDocument) => (\n        <DocumentLink key={document._id} document={document} />\n      ))}\n    </>\n  )\n}\n\nconst DocumentLink = ({document}: {document: SanityDocument}) => {\n  const schema = useSchema()\n\n  const LinkComponent = useCallback(\n    (linkProps: Omit<HTMLProps<HTMLAnchorElement>, 'ref'>) => (\n      <IntentLink {...linkProps} params={{id: document._id, type: document._type}} intent=\"edit\" />\n    ),\n\n    [document],\n  )\n\n  return (\n    <Card as={LinkComponent} radius={2} key={document._id} data-as=\"a\" tabIndex={0}>\n      <Flex align=\"center\" gap={2}>\n        <Preview\n          layout=\"default\"\n          value={{_type: 'reference', _ref: document._id}}\n          schemaType={schema.get(document._type)!}\n        />\n      </Flex>\n    </Card>\n  )\n}\n","import {WarningOutlineIcon} from '@sanity/icons'\nimport {Card, Flex, Grid, Text} from '@sanity/ui'\nimport {type CSSProperties} from 'react'\n\nimport {Translate, useTranslation} from '../../../../i18n'\nimport {type UsageDialogProps} from './AssetDeleteDialog'\n\ntype ConfirmMessageProps = Omit<UsageDialogProps, 'onClose' | 'onDelete'> & {\n  hasResults?: boolean\n}\n\nconst STYLE_ASSET_IMAGE: CSSProperties = {\n  maxWidth: '100%',\n  height: '120px',\n  objectFit: 'contain',\n  objectPosition: 'center',\n}\nconst STYLE_CONFIRM_CARD: CSSProperties = {\n  gridColumn: 'span 1',\n  overflow: 'hidden',\n  display: 'flex',\n  alignSelf: 'center',\n  justifyContent: 'center',\n}\nconst STYLE_IMAGE_WRAPPER: CSSProperties = {height: '100%'}\n\nexport const ConfirmMessage = ({asset, assetType, hasResults = false}: ConfirmMessageProps) => {\n  const isImage = assetType === 'image'\n  const {t} = useTranslation()\n\n  if (hasResults) {\n    return (\n      <Card tone=\"caution\" padding={[3, 3, 4]} border radius={2} marginBottom={3}>\n        <Grid columns={3} gap={[2, 3, 4]}>\n          <Flex gap={[3, 4]} align=\"center\" style={{gridColumn: isImage ? 'span 2' : 'span 3'}}>\n            <Text>\n              <WarningOutlineIcon />\n            </Text>\n            <Text size={1}>\n              {t(`asset-source.delete-dialog.usage-list.warning-${assetType}-is-in-use`, {\n                context: asset.originalFilename ? 'named' : 'unnamed',\n                filename: asset.originalFilename,\n              })}\n            </Text>\n          </Flex>\n          {isImage && (\n            <Card __unstable_checkered border radius={1} style={STYLE_CONFIRM_CARD}>\n              <Flex align=\"center\" justify=\"center\" style={STYLE_IMAGE_WRAPPER}>\n                <img\n                  src={`${asset.url}?w=200`}\n                  style={STYLE_ASSET_IMAGE}\n                  alt={t('asset-source.usage-list.image-alt')}\n                  referrerPolicy=\"strict-origin-when-cross-origin\"\n                />\n              </Flex>\n            </Card>\n          )}\n        </Grid>\n      </Card>\n    )\n  }\n\n  return (\n    <Card paddingX={[2, 3, 4]} paddingY={[3, 3, 3, 4]}>\n      <Grid columns={3} gap={3}>\n        <Flex style={{gridColumn: isImage ? 'span 2' : 'span 3'}} align=\"center\">\n          <Text>\n            <Translate\n              t={t}\n              i18nKey={`asset-source.delete-dialog.usage-list.confirm-delete-${assetType}`}\n              context={asset.originalFilename ? 'named' : 'unnamed'}\n              values={{filename: asset.originalFilename}}\n            />\n          </Text>\n        </Flex>\n        {isImage && (\n          <Card __unstable_checkered border radius={1} style={STYLE_CONFIRM_CARD}>\n            <Flex align=\"center\" justify=\"center\" style={STYLE_IMAGE_WRAPPER}>\n              <img\n                src={`${asset.url}?w=200`}\n                style={STYLE_ASSET_IMAGE}\n                alt={t('asset-source.asset-list.table.preview-alt')}\n                referrerPolicy=\"strict-origin-when-cross-origin\"\n              />\n            </Flex>\n          </Card>\n        )}\n      </Grid>\n    </Card>\n  )\n}\n","import {TrashIcon} from '@sanity/icons'\nimport {type Asset as AssetType} from '@sanity/types'\nimport {Box, Stack} from '@sanity/ui'\nimport {useMemo} from 'react'\n\nimport {Dialog} from '../../../../../ui-components'\nimport {LoadingBlock} from '../../../../components/loadingBlock'\nimport {useReferringDocuments} from '../../../../hooks/useReferringDocuments'\nimport {useTranslation} from '../../../../i18n'\nimport {AssetUsageList} from './AssetUsageList'\nimport {ConfirmMessage} from './ConfirmMessage'\n\nexport interface UsageDialogProps {\n  assetType: 'file' | 'image'\n  asset: AssetType\n  isDeleting?: boolean\n  onClose: () => void\n  onDelete: () => void\n}\n\nexport function AssetDeleteDialog({\n  asset,\n  assetType,\n  isDeleting = false,\n  onClose,\n  onDelete,\n}: UsageDialogProps) {\n  const {isLoading, referringDocuments} = useReferringDocuments(asset._id)\n\n  const publishedDocuments = useMemo(() => {\n    const drafts = referringDocuments.reduce<string[]>(\n      (acc, doc) => (doc._id.startsWith('drafts.') ? acc.concat(doc._id.slice(7)) : acc),\n      [],\n    )\n\n    return referringDocuments.filter((doc) => !drafts.includes(doc._id))\n  }, [referringDocuments])\n\n  const hasResults = publishedDocuments.length > 0\n\n  const {t} = useTranslation()\n\n  return (\n    <Dialog\n      __unstable_autoFocus={isLoading}\n      footer={{\n        cancelButton: {\n          onClick: onClose,\n          text: t('asset-source.delete-dialog.action.cancel'),\n        },\n        confirmButton: {\n          disabled: hasResults,\n          icon: TrashIcon,\n          loading: isDeleting,\n          onClick: onDelete,\n          text: t('asset-source.delete-dialog.action.delete'),\n        },\n      }}\n      header={t('asset-source.delete-dialog.header', {context: assetType})}\n      id=\"asset-dialog\"\n      onClickOutside={onClose}\n      onClose={onClose}\n      width={1}\n    >\n      {isLoading ? (\n        <Box padding={4}>\n          <LoadingBlock showText />\n        </Box>\n      ) : (\n        <Stack\n          paddingX={hasResults ? [2, 3, 4] : 0}\n          paddingY={hasResults ? [3, 3, 3, 4] : 0}\n          space={1}\n        >\n          <ConfirmMessage asset={asset} assetType={assetType} hasResults={hasResults} />\n\n          {hasResults && (\n            <AssetUsageList\n              asset={asset}\n              referringDocuments={publishedDocuments}\n              assetType={assetType}\n            />\n          )}\n        </Stack>\n      )}\n    </Dialog>\n  )\n}\n","import {LinkIcon, TrashIcon} from '@sanity/icons'\nimport {Menu} from '@sanity/ui'\n\nimport {MenuButton, MenuItem} from '../../../../../ui-components'\nimport {ContextMenuButton} from '../../../../components/contextMenuButton'\nimport {useTranslation} from '../../../../i18n'\nimport {type AssetMenuAction} from '../types'\n\nconst MENU_POPOVER_PROPS = {portal: true, placement: 'right'} as const\n\nexport function AssetMenu({\n  isSelected,\n  border = true,\n  onAction,\n}: {\n  isSelected: boolean\n  border?: boolean\n  onAction: (action: AssetMenuAction) => void\n}) {\n  const triggerButtonMode = isSelected ? 'default' : 'bleed'\n  const triggerButtonTone = isSelected ? 'primary' : 'default'\n\n  const {t} = useTranslation()\n  return (\n    <MenuButton\n      button={\n        <ContextMenuButton\n          mode={border ? 'ghost' : triggerButtonMode}\n          tone={border ? 'default' : triggerButtonTone}\n        />\n      }\n      id=\"asset-menu\"\n      menu={\n        <Menu>\n          <MenuItem\n            text={t('asset-source.asset-list.menu.show-usage')}\n            icon={LinkIcon}\n            onClick={() => {\n              onAction({type: 'showUsage'})\n            }}\n          />\n          <MenuItem\n            text={t('asset-source.asset-list.menu.delete')}\n            icon={TrashIcon}\n            tone=\"critical\"\n            onClick={() => {\n              onAction({type: 'delete'})\n            }}\n          />\n        </Menu>\n      }\n      popover={MENU_POPOVER_PROPS}\n    />\n  )\n}\n","import {type Asset as AssetType} from '@sanity/types'\nimport {useMemo} from 'react'\n\nimport {Dialog} from '../../../../../ui-components'\nimport {LoadingBlock} from '../../../../components/loadingBlock'\nimport {useReferringDocuments} from '../../../../hooks/useReferringDocuments'\nimport {useTranslation} from '../../../../i18n'\nimport {AssetUsageList} from './AssetUsageList'\n\nexport interface UsageDialogProps {\n  assetType: 'file' | 'image'\n  asset: AssetType\n  onClose: () => void\n}\n\nexport function AssetUsageDialog({asset, assetType, onClose}: UsageDialogProps) {\n  const {isLoading, referringDocuments} = useReferringDocuments(asset._id)\n\n  const publishedDocuments = useMemo(() => {\n    const drafts = referringDocuments.reduce<string[]>(\n      (acc, doc) => (doc._id.startsWith('drafts.') ? acc.concat(doc._id.slice(7)) : acc),\n      [],\n    )\n\n    return referringDocuments.filter((doc) => !drafts.includes(doc._id))\n  }, [referringDocuments])\n\n  const {t} = useTranslation()\n\n  return (\n    <Dialog\n      __unstable_autoFocus\n      header={t('asset-source.asset-usage-dialog.header', {context: assetType})}\n      id=\"asset-dialog\"\n      onClickOutside={onClose}\n      onClose={onClose}\n      width={1}\n    >\n      {isLoading ? (\n        <LoadingBlock showText />\n      ) : (\n        <AssetUsageList\n          asset={asset}\n          referringDocuments={publishedDocuments}\n          assetType={assetType}\n        />\n      )}\n    </Dialog>\n  )\n}\n","interface MimeTypeInfo {\n  title: string\n}\n\nconst MIME_TYPES: Record<string, MimeTypeInfo> = {\n  // Images\n  'image/bmp': {\n    title: 'Bitmap Image',\n  },\n  'image/jpeg': {\n    title: 'JPEG Image',\n  },\n  'image/gif': {\n    title: 'GIF Image',\n  },\n  'image/vnd.microsoft.icon': {\n    title: 'Icon',\n  },\n  'image/png': {\n    title: 'PNG Image',\n  },\n  'image/svg+xml': {\n    title: 'SVG Image',\n  },\n  'image/webp': {\n    title: 'WebP Image',\n  },\n  'image/tiff': {\n    title: 'TIFF Image',\n  },\n  'image/heic': {\n    title: 'HEIC Image',\n  },\n  // Audio\n  'audio/midi': {\n    title: 'MIDI Audio',\n  },\n  'audio/midi-x': {\n    title: 'MIDI Audio',\n  },\n  'audio/mpeg': {\n    title: 'MP3 Audio',\n  },\n  'audio/ogg': {\n    title: 'OGG Audio',\n  },\n  'audio/wav': {\n    title: 'WAV Audio',\n  },\n  'audio/webm': {\n    title: 'WebM Audio',\n  },\n  'audio/aac': {\n    title: 'AAC Audio',\n  },\n  // Video\n  'video/x-msvideo': {\n    title: 'AVI Video',\n  },\n  'video/mp4': {\n    title: 'MP4 Video',\n  },\n  'video/mpeg': {\n    title: 'MPEG Video',\n  },\n  'video/ogg': {\n    title: 'OGG Video',\n  },\n  'video/webm': {\n    title: 'WebM Video',\n  },\n  'video/quicktime': {\n    title: 'QuickTime Video',\n  },\n  // Documents\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': {\n    title: 'Excel Spreadsheet',\n  },\n  'application/vnd.ms-excel': {\n    title: 'Excel Spreadsheet',\n  },\n  'text/plain': {\n    title: 'Text',\n  },\n  'text/javascript': {\n    title: 'JavaScript',\n  },\n  'text/markdown': {\n    title: 'Markdown',\n  },\n  'text/csv': {\n    title: 'CSV',\n  },\n  'text/css': {\n    title: 'CSS',\n  },\n  'application/pdf': {\n    title: 'PDF Document',\n  },\n  'application/xml': {\n    title: 'XML Document',\n  },\n  'text/xml': {\n    title: 'XML Document',\n  },\n  'application/zip': {\n    title: 'ZIP Archive',\n  },\n  'application/vnd.rar': {\n    title: 'RAR Archive',\n  },\n  'application/x-7z-compressed': {\n    title: '7-zip Archive',\n  },\n  'application/octet-stream': {\n    title: 'Binary',\n  },\n}\n\nfunction convertMimeTypeToSomethingNice(mimeType: string): string {\n  const part = mimeType.replace('x-', '').split('/')[1]\n\n  return part.charAt(0).toUpperCase() + part.slice(1)\n}\n\nexport function formatMimeType(mimeType: string): string {\n  if (MIME_TYPES?.[mimeType]) {\n    return MIME_TYPES[mimeType].title\n  }\n\n  return convertMimeTypeToSomethingNice(mimeType)\n}\n","import {ChevronDownIcon, ChevronUpIcon, DocumentIcon, LinkIcon, TrashIcon} from '@sanity/icons'\nimport {type Asset as AssetType} from '@sanity/types'\nimport {\n  Box,\n  // eslint-disable-next-line no-restricted-imports\n  Button,\n  Card,\n  Flex,\n  Grid,\n  Stack,\n  Text,\n  useToast,\n} from '@sanity/ui'\nimport {type KeyboardEvent, type MouseEvent, useCallback, useMemo, useRef, useState} from 'react'\nimport {type Subscription} from 'rxjs'\nimport styled, {css} from 'styled-components'\n\nimport {Tooltip} from '../../../../../ui-components'\nimport {getHumanFriendlyBytes} from '../../../../field/types/file/diff/helpers'\nimport {useClient, useRelativeTime, useUnitFormatter} from '../../../../hooks'\nimport {useTranslation} from '../../../../i18n'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../studioClient'\nimport {AssetDeleteDialog} from '../shared/AssetDeleteDialog'\nimport {AssetMenu} from '../shared/AssetMenu'\nimport {AssetUsageDialog} from '../shared/AssetUsageDialog'\nimport {type AssetMenuAction} from '../types'\nimport {formatMimeType} from '../utils/mimeType'\n\ninterface RowProps {\n  isMobile?: boolean\n  asset: AssetType\n  isSelected?: boolean\n  onClick?: (event: MouseEvent) => void\n  onKeyPress?: (event: KeyboardEvent) => void\n  onDeleteFinished?: (assetId: string) => void\n}\n\nconst CardIconWrapper = styled.span`\n  background-color: transparent;\n  flex-shrink: 0;\n`\n\n// These are here because using vanilla UI components caused a type issue inside of styled-components\nconst CustomFlex = styled(Flex)``\n\nconst CustomCard = styled(Card)<RowProps>`\n  ${(props) =>\n    props.isSelected &&\n    css`\n      --card-muted-fg-color: var(--card-bg-color);\n      --card-fg-color: var(--card-bg-color);\n    `}\n`\n\nconst RowButton = styled(Button)<RowProps>`\n  box-shadow: none;\n  min-width: 0;\n  cursor: pointer;\n  position: initial;\n\n  &:before,\n  &:after {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 2;\n  }\n\n  &:before {\n    z-index: 0;\n    pointer-events: none;\n    border-radius: inherit;\n  }\n\n  ${(props) =>\n    props.isSelected &&\n    css`\n      --card-muted-fg-color: var(--card-bg-color);\n      --card-fg-color: var(--card-bg-color);\n\n      &:before {\n        background-color: var(--card-focus-ring-color);\n      }\n\n      ${CardIconWrapper} {\n        --card-muted-fg-color: var(--card-bg-color);\n      }\n\n      ${CustomFlex} {\n        --card-muted-fg-color: var(--card-bg-color);\n        --card-fg-color: var(--card-bg-color);\n      }\n    `}\n\n  ${(props) =>\n    !props.isSelected &&\n    css`\n      &:hover:before {\n        background-color: var(--card-bg-color);\n      }\n\n      &:focus:before {\n        background-color: var(--card-code-bg-color);\n      }\n\n      &:focus-within:before {\n        background-color: var(--card-bg-color);\n      }\n    `}\n`\n\nconst TypeText = styled(Text)`\n  overflow-wrap: anywhere;\n`\n\nconst STYLES_ROW_CARD = {\n  position: 'relative',\n} as const\n\nconst STYLES_ICON_CARD = {flexShrink: 0}\nconst STYLES_BUTTON_TEXT = {minWidth: 0}\nconst STYLES_ASSETMENU_WRAPPER = {\n  zIndex: 3,\n  marginTop: '-0.5rem',\n  marginBottom: '-0.5rem',\n}\n\nexport const AssetRow = (props: RowProps) => {\n  const versionedClient = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const toast = useToast()\n  const deleteRef$ = useRef<Subscription>()\n  const [showUsageDialog, setShowUsageDialog] = useState(false)\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false)\n  const [isDeleting, setIsDeleting] = useState(false)\n  const [isOpen, setIsOpen] = useState(false)\n  const {asset, onClick, onKeyPress, onDeleteFinished, isSelected, isMobile} = props\n  const {originalFilename, _id, mimeType, size, _createdAt} = asset\n  const formattedTime = useRelativeTime(_createdAt, {useTemporalPhrase: true})\n  const formattedMimeType = formatMimeType(mimeType)\n\n  const formatUnit = useUnitFormatter({unitDisplay: 'short', maximumFractionDigits: 2})\n  const formattedSize = getHumanFriendlyBytes(size, formatUnit)\n\n  const showTooltip = (originalFilename || '').length > 37\n\n  const {t} = useTranslation()\n  const handleConfirmDelete = useCallback(() => {\n    setShowDeleteDialog(true)\n  }, [])\n\n  const handleDeleteError = useCallback(\n    (error: Error) => {\n      toast.push({\n        closable: true,\n        status: 'error',\n        title: t('asset-source.file.asset-list.delete-failed'),\n        description: error.message,\n      })\n    },\n    [t, toast],\n  )\n\n  const handleDeleteSuccess = useCallback(() => {\n    toast.push({\n      status: 'success',\n      title: t('asset-source.file.asset-list.delete-successful'),\n    })\n  }, [t, toast])\n\n  const handleDeleteAsset = useCallback(() => {\n    setIsDeleting(true)\n\n    deleteRef$.current = versionedClient.observable.delete(asset._id).subscribe({\n      next: () => {\n        setIsDeleting(false)\n        onDeleteFinished?.(asset._id)\n        setShowDeleteDialog(false)\n        handleDeleteSuccess()\n      },\n      error: (err: Error) => {\n        setIsDeleting(false)\n        handleDeleteError(err)\n        // eslint-disable-next-line no-console\n        console.error('Could not delete asset', err)\n      },\n    })\n  }, [\n    asset._id,\n    handleDeleteError,\n    handleDeleteSuccess,\n    onDeleteFinished,\n    versionedClient.observable,\n  ])\n\n  const handleDialogClose = () => {\n    setShowUsageDialog(false)\n    setShowDeleteDialog(false)\n  }\n\n  const handleToggleUsageDialog = () => {\n    setShowUsageDialog(true)\n  }\n\n  const handleToggleOpen = () => {\n    setIsOpen(!isOpen)\n  }\n\n  const handleMenuAction = (action: AssetMenuAction) => {\n    if (action.type === 'delete') {\n      handleConfirmDelete()\n    }\n\n    if (action.type === 'showUsage') {\n      handleToggleUsageDialog()\n    }\n  }\n\n  const usageDialog = useMemo(() => {\n    return (\n      showUsageDialog && (\n        <AssetUsageDialog assetType=\"file\" asset={asset} onClose={handleDialogClose} />\n      )\n    )\n  }, [asset, showUsageDialog])\n\n  const deleteDialog = useMemo(() => {\n    return (\n      showDeleteDialog && (\n        <AssetDeleteDialog\n          assetType=\"file\"\n          asset={asset}\n          onClose={handleDialogClose}\n          onDelete={handleDeleteAsset}\n          isDeleting={isDeleting}\n        />\n      )\n    )\n  }, [asset, handleDeleteAsset, isDeleting, showDeleteDialog])\n\n  if (isMobile) {\n    return (\n      <Card paddingBottom={2} style={STYLES_ROW_CARD}>\n        <Grid\n          columns={4}\n          gap={1}\n          style={{\n            position: 'relative',\n            gridTemplateColumns: '1fr 30px',\n            opacity: isDeleting ? 0.5 : 1,\n          }}\n        >\n          <RowButton\n            asset={asset}\n            mode=\"bleed\"\n            padding={0}\n            data-id={_id}\n            onClick={onClick}\n            paddingY={1}\n            radius={2}\n          >\n            <Flex gap={2} flex={2} align=\"center\">\n              <Card as={CardIconWrapper} padding={2} tone=\"transparent\" radius={2}>\n                <Text muted size={2} style={STYLES_ICON_CARD}>\n                  <DocumentIcon />\n                </Text>\n              </Card>\n              <Text size={1} align=\"left\" textOverflow=\"ellipsis\" style={STYLES_BUTTON_TEXT}>\n                {originalFilename}\n              </Text>\n            </Flex>\n          </RowButton>\n          <Flex justify=\"flex-end\" align=\"center\" paddingRight={1} style={STYLES_ASSETMENU_WRAPPER}>\n            <Button\n              mode=\"bleed\"\n              fontSize={1}\n              padding={2}\n              onClick={handleToggleOpen}\n              icon={isOpen ? ChevronUpIcon : ChevronDownIcon}\n            />\n          </Flex>\n        </Grid>\n        {isOpen && (\n          <>\n            <Grid marginTop={3} columns={3} gap={1}>\n              <Stack space={2}>\n                <Text size={1} muted weight=\"medium\">\n                  {t('asset-source.file.asset-list.header.size')}\n                </Text>\n                <Text size={1} muted>\n                  {formattedSize}\n                </Text>\n              </Stack>\n              <Stack space={2}>\n                <Text size={1} muted weight=\"medium\">\n                  {t('asset-source.file.asset-list.header.type')}\n                </Text>\n                <Text size={1} muted>\n                  {formattedMimeType}\n                </Text>\n              </Stack>\n              <Stack space={2}>\n                <Text size={1} muted weight=\"medium\">\n                  {t('asset-source.file.asset-list.header.date-added')}\n                </Text>\n                <Text size={1} muted>\n                  {formattedTime}\n                </Text>\n              </Stack>\n            </Grid>\n            <Stack space={2} marginTop={3}>\n              <Button\n                fontSize={1}\n                tone=\"default\"\n                mode=\"ghost\"\n                text={t('asset-source.file.asset-list.action.show-usage.title')}\n                onClick={handleToggleUsageDialog}\n                icon={LinkIcon}\n              />\n\n              <Button\n                fontSize={1}\n                tone=\"critical\"\n                mode=\"ghost\"\n                text={t('asset-source.file.asset-list.action.delete.title')}\n                icon={TrashIcon}\n                disabled={isSelected}\n                title={t(\n                  isSelected\n                    ? 'asset-source.file.asset-list.action.delete.disabled-cannot-delete-current-file'\n                    : 'asset-source.file.asset-list.action.delete.title',\n                )}\n                onClick={handleConfirmDelete}\n              />\n            </Stack>\n          </>\n        )}\n        {usageDialog || deleteDialog}\n      </Card>\n    )\n  }\n\n  return (\n    <CustomCard\n      asset={asset}\n      paddingBottom={1}\n      style={STYLES_ROW_CARD}\n      radius={0}\n      overflow={'hidden'}\n      isSelected={isSelected}\n      aria-selected=\"true\"\n    >\n      <Grid\n        columns={4}\n        gap={1}\n        data-id={_id}\n        paddingY={1}\n        style={{\n          position: 'relative',\n          gridTemplateColumns: '3fr 1fr 1fr 2fr 30px',\n          opacity: isDeleting ? 0.5 : 1,\n        }}\n      >\n        <RowButton\n          asset={asset}\n          mode=\"bleed\"\n          data-id={_id}\n          onClick={onClick}\n          padding={0}\n          onKeyPress={onKeyPress}\n          title={t('asset-source.file.asset-list.item.select-file-tooltip', {\n            filename: originalFilename,\n          })}\n          isSelected={isSelected}\n          radius={2}\n        >\n          <CustomFlex\n            gap={2}\n            flex={2}\n            paddingRight={1}\n            align=\"center\"\n            onClick={onClick}\n            onKeyPress={onKeyPress}\n            data-id={_id}\n          >\n            <Card\n              as={CardIconWrapper}\n              padding={2}\n              tone=\"transparent\"\n              radius={2}\n              style={STYLES_ICON_CARD}\n            >\n              <Text muted size={2}>\n                <DocumentIcon />\n              </Text>\n            </Card>\n            {showTooltip && (\n              <Tooltip content={originalFilename}>\n                <Text size={1} align=\"left\" textOverflow=\"ellipsis\" style={STYLES_BUTTON_TEXT}>\n                  {originalFilename}\n                </Text>\n              </Tooltip>\n            )}\n\n            {!showTooltip && (\n              <Text size={1} align=\"left\" textOverflow=\"ellipsis\" style={STYLES_BUTTON_TEXT}>\n                {originalFilename}\n              </Text>\n            )}\n          </CustomFlex>\n        </RowButton>\n        <CustomFlex align=\"center\">\n          <Text size={1} muted>\n            {formattedSize}\n          </Text>\n        </CustomFlex>\n        <CustomFlex align=\"center\">\n          <Box>\n            <TypeText size={1} muted textOverflow=\"ellipsis\">\n              {formattedMimeType}\n            </TypeText>\n          </Box>\n        </CustomFlex>\n        <CustomFlex align=\"center\">\n          <Text as=\"time\" size={1} muted dateTime={_createdAt}>\n            {formattedTime}\n          </Text>\n        </CustomFlex>\n        <CustomFlex\n          justify=\"flex-end\"\n          align=\"center\"\n          paddingX={1}\n          paddingY={1}\n          style={STYLES_ASSETMENU_WRAPPER}\n        >\n          <AssetMenu border={false} isSelected={false} onAction={handleMenuAction} />\n        </CustomFlex>\n      </Grid>\n      {usageDialog || deleteDialog}\n    </CustomCard>\n  )\n}\n","import {type Asset} from '@sanity/types'\nimport {Box, Card, Flex, Grid, Spinner, Stack, Text, useMediaIndex} from '@sanity/ui'\nimport {type KeyboardEvent, type MouseEvent} from 'react'\n\nimport {useTranslation} from '../../../../i18n'\nimport {AssetRow} from './AssetRow'\n\ninterface Props {\n  onClick?: (event: MouseEvent) => void\n  onKeyPress?: (event: KeyboardEvent) => void\n  onDeleteFinished: (assetId: string) => void\n  assets: Asset[]\n  isLoading?: boolean\n  selectedAssets: Asset[]\n}\n\nconst STYLES_FILENAME = {paddingLeft: '2.2rem'}\nconst STYLES_GRID = {gridTemplateColumns: '3fr 1fr 1fr 2fr 30px'}\n\nexport function FileListView(props: Props) {\n  const mediaIndex = useMediaIndex()\n  const isMobile = mediaIndex < 2\n  const {assets, onClick, onKeyPress, onDeleteFinished, selectedAssets, isLoading} = props\n\n  const {t} = useTranslation()\n  return (\n    <Box>\n      <Card borderBottom paddingBottom={2} marginBottom={1}>\n        {isMobile ? (\n          <Grid style={STYLES_GRID}>\n            <Box flex={2} paddingLeft={5}>\n              <Text muted size={1} weight=\"medium\">\n                {t('asset-source.file.asset-list.header.filename')}\n              </Text>\n            </Box>\n          </Grid>\n        ) : (\n          <Grid gap={1} style={STYLES_GRID}>\n            <Box flex={2} style={STYLES_FILENAME}>\n              <Text muted size={1} weight=\"medium\">\n                {t('asset-source.file.asset-list.header.filename')}\n              </Text>\n            </Box>\n            <Box flex={1}>\n              <Text muted size={1} weight=\"medium\">\n                {t('asset-source.file.asset-list.header.size')}\n              </Text>\n            </Box>\n            <Box flex={1}>\n              <Text muted size={1} weight=\"medium\">\n                {t('asset-source.file.asset-list.header.type')}\n              </Text>\n            </Box>\n            <Box flex={1}>\n              <Text muted size={1} weight=\"medium\">\n                {t('asset-source.file.asset-list.header.date-added')}\n              </Text>\n            </Box>\n          </Grid>\n        )}\n      </Card>\n      <Stack>\n        {isLoading && assets.length === 0 && (\n          <Box paddingTop={4} paddingBottom={2}>\n            <Flex justify=\"center\">\n              <Spinner muted />\n            </Flex>\n          </Box>\n        )}\n        {assets.map((asset) => (\n          <AssetRow\n            key={asset._id}\n            asset={asset}\n            isMobile={isMobile}\n            isSelected={selectedAssets.some((selected) => selected._id === asset._id)}\n            onClick={onClick}\n            onKeyPress={onKeyPress}\n            onDeleteFinished={onDeleteFinished}\n          />\n        ))}\n      </Stack>\n    </Box>\n  )\n}\n","import {type Asset} from '@sanity/types'\nimport {\n  // eslint-disable-next-line no-restricted-imports\n  Button,\n  Card,\n  useToast,\n} from '@sanity/ui'\nimport {memo, useCallback, useEffect, useMemo, useRef, useState} from 'react'\nimport {type Subscription} from 'rxjs'\nimport styled from 'styled-components'\n\nimport {LoadingBlock} from '../../../../components/loadingBlock'\nimport {useClient} from '../../../../hooks'\nimport {useTranslation} from '../../../../i18n'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../studioClient'\nimport {AssetDeleteDialog} from '../shared/AssetDeleteDialog'\nimport {AssetMenu} from '../shared/AssetMenu'\nimport {AssetUsageDialog} from '../shared/AssetUsageDialog'\nimport {type AssetMenuAction} from '../types'\n\ninterface AssetProps {\n  asset: Asset\n  isSelected: boolean\n  onClick?: (event: React.MouseEvent) => void\n  onKeyPress?: (event: React.KeyboardEvent) => void\n  onDeleteFinished: (assetId: string) => void\n}\n\n// Get pixel density of the current device\nconst DPI =\n  typeof window === 'undefined' || !window.devicePixelRatio\n    ? 1\n    : Math.round(window.devicePixelRatio)\n\nconst Image = styled.img`\n  position: absolute;\n  z-index: 1;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: block;\n  object-fit: contain;\n`\n\nconst Container = styled(Card)`\n  position: relative;\n  z-index: 1;\n  padding-bottom: 100%;\n`\n\nconst Root = styled.div`\n  position: relative;\n  display: inherit;\n`\nconst MenuContainer = styled.div`\n  box-sizing: border-box;\n  position: absolute;\n  z-index: 2;\n  top: 3px;\n  right: 3px;\n\n  & button[data-selected] {\n    display: block;\n  }\n\n  @media (hover: hover) {\n    // If hover is supported, hide the buttons until the user hovers or focuses the asset\n    // Use opacity to enable the buttons to still be focusable\n    & button {\n      opacity: 0;\n    }\n\n    ${Root}:hover & {\n      button {\n        opacity: 1;\n      }\n    }\n\n    ${Root}:focus-within & {\n      button {\n        opacity: 1;\n      }\n    }\n  }\n`\n\nexport const AssetThumb = memo(function AssetThumb(props: AssetProps) {\n  const versionedClient = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const toast = useToast()\n  const deleteRef$ = useRef<Subscription>()\n  const {asset, onClick, onKeyPress, onDeleteFinished, isSelected} = props\n  const [showUsageDialog, setShowUsageDialog] = useState(false)\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false)\n  const [isDeleting, setIsDeleting] = useState(false)\n  const {t} = useTranslation()\n\n  useEffect(() => {\n    return () => {\n      if (deleteRef$.current) {\n        deleteRef$.current.unsubscribe()\n      }\n    }\n  }, [])\n\n  const handleConfirmDelete = useCallback(() => {\n    setShowDeleteDialog(true)\n  }, [setShowDeleteDialog])\n\n  const handleDialogClose = useCallback(() => {\n    setShowUsageDialog(false)\n    setShowDeleteDialog(false)\n  }, [setShowUsageDialog, setShowDeleteDialog])\n\n  const handleToggleUsageDialog = useCallback(() => {\n    setShowUsageDialog(true)\n  }, [setShowUsageDialog])\n\n  const handleDeleteError = useCallback(\n    (error: {message: string}) => {\n      toast.push({\n        closable: true,\n        status: 'error',\n        title: t('asset-source.image.asset-list.delete-failed'),\n        description: error.message,\n      })\n    },\n    [t, toast],\n  )\n\n  const handleDeleteSuccess = useCallback(() => {\n    toast.push({\n      status: 'success',\n      title: t('asset-source.image.asset-list.delete-successful'),\n    })\n  }, [t, toast])\n\n  const handleDeleteAsset = useCallback(() => {\n    setIsDeleting(true)\n\n    deleteRef$.current = versionedClient.observable.delete(asset._id).subscribe({\n      next: () => {\n        setIsDeleting(false)\n        onDeleteFinished(asset._id)\n        setShowDeleteDialog(false)\n        handleDeleteSuccess()\n      },\n      error: (err: Error) => {\n        setIsDeleting(false)\n        handleDeleteError(err)\n        // eslint-disable-next-line no-console\n        console.error('Could not delete asset', err)\n      },\n    })\n  }, [\n    asset._id,\n    handleDeleteError,\n    handleDeleteSuccess,\n    onDeleteFinished,\n    versionedClient.observable,\n  ])\n\n  const handleMenuAction = useCallback(\n    (action: AssetMenuAction) => {\n      if (action.type === 'delete') {\n        handleConfirmDelete()\n      }\n\n      if (action.type === 'showUsage') {\n        handleToggleUsageDialog()\n      }\n    },\n    [handleConfirmDelete, handleToggleUsageDialog],\n  )\n\n  const usageDialog = useMemo(() => {\n    return (\n      showUsageDialog && (\n        <AssetUsageDialog assetType=\"file\" asset={asset} onClose={handleDialogClose} />\n      )\n    )\n  }, [asset, handleDialogClose, showUsageDialog])\n\n  const deleteDialog = useMemo(() => {\n    return (\n      showDeleteDialog && (\n        <AssetDeleteDialog\n          assetType=\"file\"\n          asset={asset}\n          onClose={handleDialogClose}\n          onDelete={handleDeleteAsset}\n          isDeleting={isDeleting}\n        />\n      )\n    )\n  }, [asset, handleDeleteAsset, handleDialogClose, isDeleting, showDeleteDialog])\n\n  // const {asset, onClick, onKeyPress, isSelected} = props\n  const {originalFilename, _id, url} = asset\n  const imgH = 200 * Math.max(1, DPI)\n\n  // Mead can't convert gifs, so we might end up with large gifs that will cause the source window to use a lot of CPU\n  // We instead force them to display as jpgs\n  const imageUrl = url.includes('.gif')\n    ? `${url}?h=${imgH}&fit=max&fm=jpg`\n    : `${url}?h=${imgH}&fit=max`\n\n  return (\n    <Root>\n      <Button\n        selected={isSelected}\n        tabIndex={0}\n        data-id={_id}\n        mode=\"ghost\"\n        onKeyPress={onKeyPress}\n        padding={0}\n        style={{padding: 2}}\n      >\n        <Container __unstable_checkered>\n          <Image alt={originalFilename} src={imageUrl} onClick={onClick} data-id={_id} />\n          {isDeleting && <LoadingBlock />}\n        </Container>\n      </Button>\n      <MenuContainer>\n        <AssetMenu isSelected={isSelected} onAction={handleMenuAction} />\n      </MenuContainer>\n      {usageDialog || deleteDialog}\n    </Root>\n  )\n})\n","import {type Asset} from '@sanity/types'\nimport {Box, Flex, Grid, Spinner, Text} from '@sanity/ui'\nimport {type KeyboardEvent, type MouseEvent} from 'react'\nimport styled from 'styled-components'\n\nimport {AssetThumb} from './AssetThumb'\n\ninterface ImageListViewProps {\n  isLoading?: boolean\n  assets: Asset[]\n  selectedAssets: Asset[]\n  onItemClick: (event: MouseEvent) => void\n  onItemKeyPress: (event: KeyboardEvent) => void\n  onDeleteFinished: (assetId: string) => void\n}\n\nconst ThumbGrid = styled(Grid)`\n  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n`\n\nexport function ImageListView(props: ImageListViewProps) {\n  const {isLoading, assets, selectedAssets, onItemClick, onItemKeyPress, onDeleteFinished} = props\n  return (\n    <Box padding={4}>\n      <ThumbGrid gap={2}>\n        {assets.map((asset) => (\n          <AssetThumb\n            key={asset._id}\n            asset={asset}\n            isSelected={selectedAssets.some((selected) => selected._id === asset._id)}\n            onClick={onItemClick}\n            onKeyPress={onItemKeyPress}\n            onDeleteFinished={onDeleteFinished}\n          />\n        ))}\n      </ThumbGrid>\n      {isLoading && assets.length === 0 && (\n        <Flex justify=\"center\">\n          <Spinner muted />\n        </Flex>\n      )}\n      {!isLoading && assets.length === 0 && <Text align=\"center\" muted />}\n    </Box>\n  )\n}\n","import {DownloadIcon, InfoOutlineIcon} from '@sanity/icons'\nimport {type Asset, type AssetFromSource, type AssetSourceComponentProps} from '@sanity/types'\nimport {Card, Flex, Stack, Text} from '@sanity/ui'\nimport {uniqueId} from 'lodash'\nimport {\n  type ForwardedRef,\n  forwardRef,\n  type KeyboardEvent,\n  memo,\n  type MouseEvent,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport {type Subscription} from 'rxjs'\nimport styled from 'styled-components'\n\nimport {Button, Dialog} from '../../../../../ui-components'\nimport {useClient, useListFormat} from '../../../../hooks'\nimport {Translate, useTranslation} from '../../../../i18n'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../studioClient'\nimport {FileListView} from '../file/FileListView'\nimport {ImageListView} from '../image/ImageListView'\n\nconst PER_PAGE = 200\nconst ASSET_TYPE_IMAGE = 'sanity.imageAsset'\nconst ASSET_TYPE_FILE = 'sanity.fileAsset'\n\nconst buildFilterQuery = (acceptParam: string) => {\n  const WILDCARD_ACCEPT = ['image/*', 'audio/*', 'video/*']\n  const acceptItems = acceptParam.split(',').map((accept) => accept.trim())\n\n  const typesForFilter: {[key: string]: string} = acceptItems.reduce(\n    (acceptTypes: {[key: string]: string}, acceptValue: string) => {\n      // builds the wildcard part of the groq query\n      if (WILDCARD_ACCEPT.includes(acceptValue)) {\n        return {\n          ...acceptTypes,\n          wildcards: `mimeType match '${acceptValue}' || ${acceptTypes.wildcards}`,\n        }\n      }\n\n      // builds the extension part of the groq query (and removes the .)\n      if (acceptValue.indexOf('.') === 0) {\n        return {\n          ...acceptTypes,\n          extensions: `'${acceptValue.replace('.', '')}', ${acceptTypes.extensions}`,\n        }\n      }\n\n      // all that remains is then the mime types, so we build that part\n      return {...acceptTypes, mimes: `'${acceptValue}', ${acceptTypes.mimes}`}\n    },\n    {mimes: '', extensions: '', wildcards: ''},\n  )\n\n  /* when no accept filter is set, we don't need to add the filter condition\n  wildcards conditions do not work with arrays so the whole query is built at the top on the condition connected\n  with ORs. So when they are empty it means that we can keep the whole first section clean.\n  The extension and mimeType work when the arrays are empty returning the right values so they are kept in the query */\n  return `&&\n  (\n    ${typesForFilter.wildcards}\n    extension in [${typesForFilter.extensions}] ||\n    mimeType in [${typesForFilter.mimes}]\n  )`\n}\n\nconst buildQuery = (\n  start = 0,\n  end = PER_PAGE,\n  assetType = ASSET_TYPE_IMAGE,\n  acceptParam: string,\n) => {\n  const hasAccept = acceptParam.length > 0\n  const filterCondition = hasAccept ? buildFilterQuery(acceptParam) : ''\n\n  return `\n  *[_type == \"${assetType}\" ${filterCondition}] | order(_updatedAt desc) [${start}...${end}] {\n    _id,\n    _updatedAt,\n    _createdAt,\n    url,\n    originalFilename,\n    mimeType,\n    extension,\n    size,\n    metadata {dimensions}\n  }\n`\n}\n\nconst CardLoadMore = styled(Card)`\n  border-top: 1px solid var(--card-border-color);\n  position: sticky;\n  bottom: 0;\n  z-index: 200;\n`\n\nconst DefaultAssetSource = function DefaultAssetSource(\n  props: AssetSourceComponentProps,\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const versionedClient = useMemo(() => client.withConfig({apiVersion: '2023-02-14'}), [client])\n  const _elementId = useRef(`default-asset-source-${uniqueId()}`)\n  const currentPageNumber = useRef(0)\n  const {t} = useTranslation()\n  const fetch$ = useRef<Subscription>()\n  const [assets, setAssets] = useState<Asset[]>([])\n  const [isLastPage, setIsLastPage] = useState(false)\n  const [hasResetAutoFocus, setHasResetFocus] = useState(false)\n  const [isLoading, setIsLoading] = useState(true)\n  const {selectedAssets, assetType = 'image', dialogHeaderTitle, onClose, onSelect, accept} = props\n\n  const isImageOnlyWildCard = accept && accept === 'image/*' && assetType === 'image'\n  const fetchPage = useCallback(\n    (pageNumber: number) => {\n      const start = pageNumber * PER_PAGE\n      const end = start + PER_PAGE\n      const isImageAssetType = assetType === 'image'\n      const tag = isImageAssetType ? 'asset.image-list' : 'asset.file-list'\n      const assetTypeParam = isImageAssetType ? ASSET_TYPE_IMAGE : ASSET_TYPE_FILE\n\n      setIsLoading(true)\n\n      if (typeof accept !== 'undefined') {\n        fetch$.current = versionedClient.observable\n          .fetch(buildQuery(start, end, assetTypeParam, accept), {}, {tag})\n          .subscribe((result) => {\n            setIsLastPage(result.length < PER_PAGE)\n            setAssets((prevState) => prevState.concat(result))\n            setIsLoading(false)\n          })\n      }\n    },\n    [assetType, accept, versionedClient],\n  )\n\n  const handleDeleteFinished = useCallback(\n    (id: string) => {\n      // eslint-disable-next-line max-nested-callbacks\n      setAssets((prevState) => prevState.filter((asset) => asset._id !== id))\n    },\n    [setAssets],\n  )\n\n  const select = useCallback(\n    (id: string) => {\n      const selected = assets.find((doc) => doc._id === id)\n\n      if (selected) {\n        const selectedSource: AssetFromSource[] = [{kind: 'assetDocumentId', value: id}]\n\n        onSelect(selectedSource)\n      }\n    },\n    [assets, onSelect],\n  )\n\n  const handleItemClick = useCallback(\n    (event: MouseEvent) => {\n      event.preventDefault()\n      const id = event.currentTarget.getAttribute('data-id')\n      if (!id) {\n        throw new Error('Missing data-id attribute on item')\n      }\n      select(id)\n    },\n    [select],\n  )\n\n  const handleItemKeyPress = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Enter') {\n        event.preventDefault()\n        const id = event.currentTarget.getAttribute('data-id')\n        if (!id) {\n          throw new Error('Missing data-id attribute on item')\n        }\n        select(id)\n      }\n    },\n    [select],\n  )\n\n  const handleClose = useCallback(() => {\n    if (onClose) {\n      onClose()\n    }\n  }, [onClose])\n\n  const handleFetchNextPage = useCallback(\n    (event: MouseEvent) => {\n      event.preventDefault()\n      fetchPage(++currentPageNumber.current)\n    },\n    [fetchPage],\n  )\n\n  useEffect(() => {\n    fetchPage(currentPageNumber.current)\n\n    return () => {\n      if (fetch$.current) {\n        fetch$.current.unsubscribe()\n      }\n    }\n  }, [fetchPage])\n\n  useEffect(() => {\n    // We focus on the first item after we're doing loading, but only on initial load, as\n    // this will reset the scroll position to the top if we do it on the second page\n    if (!isLoading && (!currentPageNumber.current || currentPageNumber.current === 0)) {\n      setHasResetFocus(true)\n    }\n  }, [isLoading])\n\n  const listFormat = useListFormat({style: 'narrow'})\n\n  return (\n    <Dialog\n      __unstable_autoFocus={hasResetAutoFocus}\n      header={\n        dialogHeaderTitle ||\n        t('asset-source.dialog.default-title', {\n          context: assetType,\n        })\n      }\n      id={_elementId.current}\n      onClickOutside={handleClose}\n      onClose={handleClose}\n      ref={ref}\n      width={2}\n    >\n      <Stack space={5}>\n        {!isImageOnlyWildCard && !isLoading && accept?.length > 0 && (\n          <Card tone=\"primary\" padding={3} border radius={2}>\n            <Flex gap={3} align=\"center\">\n              <Text size={1}>\n                <InfoOutlineIcon />\n              </Text>\n              <Text size={1}>\n                <Translate\n                  t={t}\n                  i18nKey=\"asset-source.dialog.accept-message\"\n                  values={{\n                    acceptTypes: listFormat.format(accept.split(',').map((type) => type.trim())),\n                  }}\n                />\n              </Text>\n            </Flex>\n          </Card>\n        )}\n        {assetType === 'file' && (\n          <FileListView\n            assets={assets}\n            onDeleteFinished={handleDeleteFinished}\n            onClick={handleItemClick}\n            onKeyPress={handleItemKeyPress}\n            isLoading={isLoading}\n            selectedAssets={selectedAssets}\n          />\n        )}\n        {assetType === 'image' && (\n          <ImageListView\n            assets={assets}\n            onDeleteFinished={handleDeleteFinished}\n            onItemClick={handleItemClick}\n            onItemKeyPress={handleItemKeyPress}\n            isLoading={isLoading}\n            selectedAssets={selectedAssets}\n          />\n        )}\n        {assets.length > 0 && !isLastPage && (\n          <CardLoadMore tone=\"default\" padding={4}>\n            <Flex direction=\"column\">\n              <Button\n                type=\"button\"\n                icon={DownloadIcon}\n                loading={isLoading}\n                onClick={handleFetchNextPage}\n                size=\"large\"\n                text={t('asset-source.dialog.load-more')}\n                tone=\"primary\"\n              />\n            </Flex>\n          </CardLoadMore>\n        )}\n      </Stack>\n    </Dialog>\n  )\n}\n\nexport const DefaultSource = memo(forwardRef(DefaultAssetSource))\n","import {DocumentsIcon} from '@sanity/icons'\nimport {type AssetSource} from '@sanity/types'\n\nimport {DefaultSource} from './shared/DefaultSource'\n\nexport const FileSource: AssetSource = {\n  name: 'sanity-default',\n  title: 'Uploaded files',\n  i18nKey: 'asset-source.file.title',\n  component: DefaultSource,\n  icon: DocumentsIcon,\n}\n","import {ImageIcon} from '@sanity/icons'\nimport {type AssetSource} from '@sanity/types'\n\nimport {DefaultSource} from './shared/DefaultSource'\n\nexport const ImageSource: AssetSource = {\n  name: 'sanity-default',\n  title: 'Uploaded images',\n  i18nKey: 'asset-source.image.title',\n  component: DefaultSource,\n  icon: ImageIcon,\n}\n","import {type AssetSource, type SchemaTypeDefinition} from '@sanity/types'\nimport {type ReactNode} from 'react'\n\nimport {type LocaleConfigContext, type LocaleDefinition, type LocaleResourceBundle} from '../i18n'\nimport {type Template, type TemplateItem} from '../templates'\nimport {getPrintableType} from '../util/getPrintableType'\nimport {\n  type DocumentActionComponent,\n  type DocumentBadgeComponent,\n  type DocumentInspector,\n} from './document'\nimport {flattenConfig} from './flattenConfig'\nimport {\n  type AsyncConfigPropertyReducer,\n  type ConfigContext,\n  type ConfigPropertyReducer,\n  type DocumentActionsContext,\n  type DocumentBadgesContext,\n  type DocumentCommentsEnabledContext,\n  type DocumentInspectorContext,\n  type DocumentLanguageFilterComponent,\n  type DocumentLanguageFilterContext,\n  type NewDocumentOptionsContext,\n  type PluginOptions,\n  type ResolveProductionUrlContext,\n  type Tool,\n} from './types'\n\nexport const initialDocumentBadges: DocumentBadgeComponent[] = []\n\nexport const initialDocumentActions: DocumentActionComponent[] = []\n\nexport const initialLanguageFilter: DocumentLanguageFilterComponent[] = []\n\nexport const schemaTypesReducer: ConfigPropertyReducer<\n  SchemaTypeDefinition[],\n  Omit<ConfigContext, 'schema' | 'currentUser' | 'client' | 'getClient' | 'i18n'>\n> = (prev, {schema}, context) => {\n  const schemaTypes = schema?.types\n\n  if (!schemaTypes) return prev\n  if (typeof schemaTypes === 'function') return schemaTypes(prev, context)\n  if (Array.isArray(schemaTypes)) return [...prev, ...schemaTypes]\n\n  throw new Error(\n    `Expected \\`schema.types\\` to be an array or a function, but received ${getPrintableType(\n      schemaTypes,\n    )}`,\n  )\n}\n\nexport const resolveProductionUrlReducer: AsyncConfigPropertyReducer<\n  string | undefined,\n  ResolveProductionUrlContext\n> = async (prev, {document}, context) => {\n  const resolveProductionUrl = document?.productionUrl\n  // the redundant await is useful for error logging because the error is caught\n  // in this stack vs somewhere down stream\n  // eslint-disable-next-line no-return-await\n  if (resolveProductionUrl) return await resolveProductionUrl(prev, context)\n  return prev\n}\n\nexport const toolsReducer: ConfigPropertyReducer<Tool[], ConfigContext> = (\n  prev,\n  {tools},\n  context,\n) => {\n  if (!tools) return prev\n  if (typeof tools === 'function') return tools(prev, context)\n  if (Array.isArray(tools)) return [...prev, ...tools]\n\n  throw new Error(\n    `Expected \\`tools\\` to be an array or a function, but received ${getPrintableType(tools)}`,\n  )\n}\n\n// we will need this when we ressurect user config for search\n/*export const searchFilterReducer: ConfigPropertyReducer<\n  SearchFilterDefinition<string>[],\n  ConfigContext\n> = (prev, {search}, context) => {\n  const filters = search?.filters\n  if (!filters) return prev\n  if (typeof filters === 'function') return filters(prev, context)\n  if (Array.isArray(filters)) return [...prev, ...filters]\n\n  throw new Error(\n    `Expected \\`search.filters\\` to be an array or a function, but received ${typeof filters}`\n  )\n}\n\nexport const searchOperatorsReducer: ConfigPropertyReducer<\n  SearchOperatorDefinition[],\n  ConfigContext\n> = (prev, {search}, context) => {\n  const operators = search?.operators\n  if (!operators) return prev\n  if (typeof operators === 'function') return operators(prev, context)\n  if (Array.isArray(operators)) return [...prev, ...operators]\n\n  throw new Error(\n    `Expected \\`operators\\` to be be an array or a function, but received ${getPrintableType(operators)}`\n  )\n}*/\n\nexport const schemaTemplatesReducer: ConfigPropertyReducer<Template[], ConfigContext> = (\n  prev,\n  {schema},\n  context,\n) => {\n  const schemaTemplates = schema?.templates\n  if (!schemaTemplates) return prev\n  if (typeof schemaTemplates === 'function') return schemaTemplates(prev, context)\n  if (Array.isArray(schemaTemplates)) return [...prev, ...schemaTemplates]\n\n  throw new Error(\n    `Expected \\`schema.templates\\` to be an array or a function, but received ${getPrintableType(\n      schemaTemplates,\n    )}`,\n  )\n}\n\nexport const localeDefReducer: ConfigPropertyReducer<LocaleDefinition[], LocaleConfigContext> = (\n  prev,\n  {i18n},\n  context,\n) => {\n  const locales = i18n?.locales\n  if (!locales) return prev\n  if (typeof locales === 'function') return locales(prev, context)\n  if (Array.isArray(locales)) return [...prev, ...locales]\n\n  throw new Error(\n    `Expected \\`i18n.locales\\` to be an array or a function, but received ${getPrintableType(\n      locales,\n    )}`,\n  )\n}\n\nexport const localeBundlesReducer: ConfigPropertyReducer<\n  LocaleResourceBundle[],\n  LocaleConfigContext\n> = (prev, {i18n}, context) => {\n  const bundles = i18n?.bundles\n  if (!bundles) return prev\n  if (Array.isArray(bundles)) return [...prev, ...bundles]\n  if (typeof bundles === 'function') return bundles(prev, context)\n\n  throw new Error(\n    `Expected \\`i18n.bundles\\` to be an array or a function, but received ${typeof bundles}`,\n  )\n}\n\nexport const documentBadgesReducer: ConfigPropertyReducer<\n  DocumentBadgeComponent[],\n  DocumentBadgesContext\n> = (prev, {document}, context) => {\n  const documentBadges = document?.badges\n  if (!documentBadges) return prev\n\n  if (typeof documentBadges === 'function') return documentBadges(prev, context)\n  if (Array.isArray(documentBadges)) return [...prev, ...documentBadges]\n\n  throw new Error(\n    `Expected \\`document.badges\\` to be an array or a function, but received ${getPrintableType(\n      documentBadges,\n    )}`,\n  )\n}\n\nexport const documentActionsReducer: ConfigPropertyReducer<\n  DocumentActionComponent[],\n  DocumentActionsContext\n> = (prev, {document}, context) => {\n  const documentActions = document?.actions\n  if (!documentActions) return prev\n\n  if (typeof documentActions === 'function') return documentActions(prev, context)\n  if (Array.isArray(documentActions)) return [...prev, ...documentActions]\n\n  throw new Error(\n    `Expected \\`document.actions\\` to be an array or a function, but received ${getPrintableType(\n      documentActions,\n    )}`,\n  )\n}\n\nexport const newDocumentOptionsResolver: ConfigPropertyReducer<\n  TemplateItem[],\n  NewDocumentOptionsContext\n> = (prev, {document}, context) => {\n  const resolveNewDocumentOptions = document?.newDocumentOptions\n  if (!resolveNewDocumentOptions) return prev\n\n  if (typeof resolveNewDocumentOptions !== 'function') {\n    throw new Error(\n      `Expected \\`document.resolveNewDocumentOptions\\` to be a function, but received ${getPrintableType(\n        resolveNewDocumentOptions,\n      )}`,\n    )\n  }\n\n  return resolveNewDocumentOptions(prev, context)\n}\n\nexport const fileAssetSourceResolver: ConfigPropertyReducer<AssetSource[], ConfigContext> = (\n  prev,\n  {form},\n  context,\n) => {\n  const assetSources = form?.file?.assetSources\n  if (!assetSources) return prev\n\n  if (typeof assetSources === 'function') return assetSources(prev, context)\n  if (Array.isArray(assetSources)) return [...prev, ...assetSources]\n\n  throw new Error(\n    `Expected \\`form.file.assetSources\\` to be an array or a function, but received ${getPrintableType(\n      assetSources,\n    )}`,\n  )\n}\n\nexport const imageAssetSourceResolver: ConfigPropertyReducer<AssetSource[], ConfigContext> = (\n  prev,\n  {form},\n  context,\n) => {\n  const assetSources = form?.image?.assetSources\n  if (!assetSources) return prev\n\n  if (typeof assetSources === 'function') return assetSources(prev, context)\n  if (Array.isArray(assetSources)) return [...prev, ...assetSources]\n\n  throw new Error(\n    `Expected \\`form.image.assetSources\\` to be an array or a function, but received ${getPrintableType(\n      assetSources,\n    )}`,\n  )\n}\n\n/**\n * @internal\n */\nexport const documentLanguageFilterReducer: ConfigPropertyReducer<\n  DocumentLanguageFilterComponent[],\n  DocumentLanguageFilterContext\n> = (prev, {document}, context) => {\n  const resolveDocumentLanguageFilter = document?.unstable_languageFilter\n  if (!resolveDocumentLanguageFilter) return prev\n\n  if (typeof resolveDocumentLanguageFilter === 'function')\n    return resolveDocumentLanguageFilter(prev, context)\n\n  if (Array.isArray(resolveDocumentLanguageFilter))\n    return [...prev, ...resolveDocumentLanguageFilter]\n\n  throw new Error(\n    `Expected \\`document.unstable_languageFilter\\` to be an array or a function, but received ${getPrintableType(\n      resolveDocumentLanguageFilter,\n    )}`,\n  )\n}\n\nexport const documentInspectorsReducer: ConfigPropertyReducer<\n  DocumentInspector[],\n  DocumentInspectorContext\n> = (prev, {document}, context) => {\n  const resolveInspectorsFilter = document?.inspectors\n  if (!resolveInspectorsFilter) return prev\n\n  if (typeof resolveInspectorsFilter === 'function') return resolveInspectorsFilter(prev, context)\n\n  if (Array.isArray(resolveInspectorsFilter)) return [...prev, ...resolveInspectorsFilter]\n\n  throw new Error(\n    `Expected \\`document.inspectors\\` to be an array or a function, but received ${getPrintableType(\n      resolveInspectorsFilter,\n    )}`,\n  )\n}\n\nexport const documentCommentsEnabledReducer = (opts: {\n  config: PluginOptions\n  context: DocumentCommentsEnabledContext\n  initialValue: boolean\n}): boolean => {\n  const {config, context, initialValue} = opts\n  const flattenedConfig = flattenConfig(config, [])\n\n  // There is no concept of 'previous value' in this API. We only care about the final value.\n  // That is, if a plugin returns true, but the next plugin returns false, the result will be false.\n  // The last plugin 'wins'.\n  const result = flattenedConfig.reduce((acc, {config: innerConfig}) => {\n    const resolver = innerConfig.document?.unstable_comments?.enabled\n\n    if (!resolver && typeof resolver !== 'boolean') return acc\n    if (typeof resolver === 'function') return resolver(context)\n    if (typeof resolver === 'boolean') return resolver\n\n    throw new Error(\n      `Expected \\`document.unstable_comments.enabled\\` to be a boolean or a function, but received ${getPrintableType(\n        resolver,\n      )}`,\n    )\n  }, initialValue)\n\n  return result\n}\n\nexport const internalTasksReducer = (opts: {\n  config: PluginOptions\n}): {footerAction: ReactNode} | undefined => {\n  const {config} = opts\n  const flattenedConfig = flattenConfig(config, [])\n\n  const result = flattenedConfig.reduce(\n    (acc: {footerAction: ReactNode} | undefined, {config: innerConfig}) => {\n      const resolver = innerConfig.__internal_tasks\n\n      if (!resolver) return acc\n      if (typeof resolver === 'object' && resolver.footerAction) return resolver\n\n      throw new Error(\n        `Expected \\`__internal__tasks\\` to be an object with footerAction, but received ${getPrintableType(\n          resolver,\n        )}`,\n      )\n    },\n    undefined,\n  )\n\n  return result\n}\n\nexport const partialIndexingEnabledReducer = (opts: {\n  config: PluginOptions\n  initialValue: boolean\n}): boolean => {\n  const {config, initialValue} = opts\n  const flattenedConfig = flattenConfig(config, [])\n\n  const result = flattenedConfig.reduce((acc, {config: innerConfig}) => {\n    const resolver = innerConfig.search?.unstable_partialIndexing?.enabled\n\n    if (!resolver && typeof resolver !== 'boolean') return acc\n    if (typeof resolver === 'boolean') return resolver\n\n    throw new Error(\n      `Expected \\`search.unstable_partialIndexing.enabled\\` to be a boolean, but received ${getPrintableType(\n        resolver,\n      )}`,\n    )\n  }, initialValue)\n\n  return result\n}\n\nexport const newSearchEnabledReducer: ConfigPropertyReducer<boolean, ConfigContext> = (\n  prev,\n  {search},\n): boolean => {\n  return prev || search?.unstable_enableNewSearch || false\n}\n","import {ConfigPropertyError} from './ConfigPropertyError'\nimport {flattenConfig} from './flattenConfig'\nimport {\n  type AsyncConfigPropertyReducer,\n  type ConfigPropertyReducer,\n  type PluginOptions,\n} from './types'\n\ninterface ResolveConfigPropertyOptions<TValue, TContext> {\n  propertyName: string\n  config: PluginOptions\n  context: TContext\n  initialValue: TValue\n  reducer: ConfigPropertyReducer<TValue, TContext>\n}\ninterface AsyncResolveConfigPropertyOptions<TValue, TContext> {\n  propertyName: string\n  config: PluginOptions\n  context: TContext\n  initialValue: TValue\n  asyncReducer: AsyncConfigPropertyReducer<TValue, TContext>\n}\n\nexport function resolveConfigProperty<TValue, TContext>(\n  options: ResolveConfigPropertyOptions<TValue, TContext>,\n): TValue\nexport function resolveConfigProperty<TValue, TContext>(\n  options: AsyncResolveConfigPropertyOptions<TValue, TContext>,\n): Promise<TValue>\nexport function resolveConfigProperty<TValue, TContext>({\n  config: inputConfig,\n  context,\n  initialValue,\n  propertyName,\n  ...reducers\n}:\n  | ResolveConfigPropertyOptions<TValue, TContext>\n  | AsyncResolveConfigPropertyOptions<TValue, TContext>): TValue | Promise<TValue> {\n  const configs = flattenConfig(inputConfig, [])\n\n  if ('reducer' in reducers) {\n    return configs.reduce((acc, {config, path}) => {\n      try {\n        return reducers.reducer(acc, config, context)\n      } catch (e) {\n        throw new ConfigPropertyError({\n          propertyName,\n          path: path,\n          cause: e,\n        })\n      }\n    }, initialValue)\n  }\n\n  const reducer = reducers.asyncReducer\n  return (async () => {\n    let current = initialValue\n    for (const {config, path} of configs) {\n      try {\n        current = await reducer(current, config, context)\n      } catch (e) {\n        throw new ConfigPropertyError({\n          propertyName,\n          path,\n          cause: e,\n        })\n      }\n    }\n    return current\n  })()\n}\n","import {type BackendModule, type ReadCallback} from 'i18next'\nimport {isPlainObject} from 'lodash'\n\nimport {type LocaleResourceBundle, type LocaleResourceKey, type LocaleResourceRecord} from './types'\n\n/**\n * Options for the Sanity i18next backend\n *\n * @internal\n * @hidden\n */\nexport interface SanityI18nBackendOptions {\n  bundles: LocaleResourceBundle[]\n}\n\n/**\n * Creates a \"backend\" for i18next that loads locale resources defined in configuration/plugins.\n *\n * This allows us to dynamically load only the resources used. For instance, if the user requests\n * the `vision` namespace and is using the `fr` locale, we skip loading all the other locales.\n *\n * Note that this only works if the locale bundles are defined with an async function for the\n * `resources` key, usually by using a dynamic import (`import('some/path/en.js')`. Otherwise,\n * the resources will be loaded at once.\n *\n * @param options - Options for the backend\n * @returns A backend module for i18next\n * @internal\n * @hidden\n */\nexport function createSanityI18nBackend(options: SanityI18nBackendOptions): BackendModule {\n  const {bundles} = options\n  function init() {\n    // intentional noop - i18next requires a init function, but we don't need it\n  }\n\n  function read(locale: string, namespace: string, callback: ReadCallback) {\n    const loadable = bundles.filter(\n      (bundle) => bundle.locale === locale && bundle.namespace === namespace,\n    )\n\n    if (loadable.length === 0) {\n      // @todo warn? This means someone requested a namespace/locale combination that there are no resources for\n      callback(\n        `No translations found for namespace \"${namespace}\", language \"${locale}\"`,\n        undefined, // Returning undefined here will i18next _not_ retry\n      )\n      return\n    }\n\n    loadBundles(loadable)\n      .then((resources) => callback(null, resources))\n      // Returning true for second parameter will make i18next retry.\n      // It handles the retry internally, and has both max retries and timeouts.\n      .catch((err) => callback(err, true))\n  }\n\n  return {\n    type: 'backend',\n    init,\n    read,\n  }\n}\n\n/**\n * Load the given locale bundles, and return a promise for a merged resource object.\n *\n * @param bundles - Array of bundles to load resources for\n * @returns An object of locale resources\n * @remarks\n * - The bundles passed **MUST** be for the same namespace and locale!\n * - The algorithm differs from i18next:\n *   - in i18next, if `deep` is `false`, `overwrite` is _always_ `true`\n *   - in Sanity,  `overwrite` is always respected\n * @internal\n * @hidden\n */\nasync function loadBundles(bundles: LocaleResourceBundle[]): Promise<LocaleResourceRecord> {\n  // Resolve resources in parallell to avoid waiting for each bundle as we extend\n  // Note: we may want a queue for this if people do very dynamic loading strategies\n  const resolved = await Promise.all(\n    bundles.map(async (bundle) => ({\n      ...bundle,\n      resources: await loadBundleResources(bundle),\n    })),\n  )\n\n  const base: LocaleResourceRecord = {}\n  for (const item of resolved) {\n    const deep = item.deep ?? true\n    const overwrite = item.overwrite ?? true\n\n    if (deep) {\n      deepExtend(base, item.resources, overwrite)\n    } else if (overwrite) {\n      Object.assign(base, item.resources)\n    } else {\n      Object.assign({}, item.resources, base)\n    }\n  }\n\n  return base\n}\n\n/**\n * Loads the resources of a bundle, calling any function and unwrapping any default module exports.\n *\n * @param bundle - Bundle to load resources for\n * @returns Record of resources\n */\nasync function loadBundleResources(bundle: LocaleResourceBundle): Promise<LocaleResourceRecord> {\n  if (typeof bundle.resources !== 'function') {\n    return bundle.resources\n  }\n\n  const resources = await bundle.resources()\n  return maybeUnwrapModule(resources)\n}\n\n/**\n * Deeply extend an object of resources, taking into account flat string shapes and nested objects.\n *\n * Typescripted version of i18next's internal utility for the same operation, see\n * {@link https://github.com/i18next/i18next/blob/v23.2.11/src/utils.js#L89}\n *\n * We need this because we're letting the backend do the merging instead of using `addResourceBundle`.\n *\n * @param target - Target object to extend\n * @param source - Source object to merge into target\n * @param overwrite - Whether to overwrite existing strings/objects\n * @returns A merged object\n * @internal\n */\nfunction deepExtend(\n  target: LocaleResourceRecord,\n  source: LocaleResourceRecord,\n  overwrite = false,\n): LocaleResourceRecord {\n  for (const prop in source) {\n    if (prop === '__proto__' || prop === 'constructor') {\n      continue\n    }\n\n    // Assign missing properties directly\n    if (!(prop in target)) {\n      target[prop] = source[prop]\n      continue\n    }\n\n    const targetLeaf = target[prop]\n    const sourceLeaf = source[prop]\n\n    const targetIsString = isStringLeaf(targetLeaf)\n    const sourceIsString = isStringLeaf(sourceLeaf)\n\n    // We reached a leaf string in target OR source\n    if ((targetIsString || sourceIsString) && overwrite) {\n      target[prop] = source[prop]\n      continue\n    }\n\n    if (targetIsString || sourceIsString) {\n      // Skip, since we are not overwriting\n      continue\n    }\n\n    // If we're overwriting with an array, don't try to merge objects/arrays, just overwrite\n    const sourceIsArray = Array.isArray(sourceLeaf)\n    const targetIsArray = Array.isArray(targetLeaf)\n    if (sourceIsArray || targetIsArray) {\n      // Nothing to do here if we can't overwrite\n      if (overwrite) {\n        target[prop] = sourceLeaf\n      }\n      continue\n    }\n\n    // Recurse deeper since we haven't reached a leaf\n    deepExtend(targetLeaf, sourceLeaf, overwrite)\n  }\n\n  return target\n}\n\n/**\n * Returns whether or not the target is leaf, eg a string\n *\n * @param target - The target to check\n * @returns True if string/instance of string, false otherwise\n * @internal\n */\nfunction isStringLeaf(target: LocaleResourceKey): target is string {\n  return typeof target === 'string' || target instanceof String\n}\n\n/**\n * Unwraps an imported module if it only contains a default export\n *\n * @param maybeModule - Module to unwrap\n * @returns Unwrapped resource record\n * @internal\n */\nfunction maybeUnwrapModule(\n  maybeModule: LocaleResourceRecord | {default: LocaleResourceRecord},\n): LocaleResourceRecord {\n  return isWrappedModule(maybeModule) ? maybeModule.default : maybeModule\n}\n\n/**\n * Checks whether or not the passed item is wrapped\n *\n * @param mod - Item to check whether or not is wrapped\n * @returns True if wrapped, false otherwise\n * @internal\n */\nfunction isWrappedModule(\n  mod: LocaleResourceRecord | {default: LocaleResourceRecord},\n): mod is {default: LocaleResourceRecord} {\n  return 'default' in mod && typeof mod.default === 'object' && isPlainObject(mod.default)\n}\n","import {createInstance as createI18nInstance, type i18n, type InitOptions} from 'i18next'\nimport {initReactI18next} from 'react-i18next'\n\nimport {type SourceOptions} from '../config'\nimport {localeBundlesReducer, localeDefReducer} from '../config/configPropertyReducers'\nimport {resolveConfigProperty} from '../config/resolveConfigProperty'\nimport {createSanityI18nBackend} from './backend'\nimport {DEBUG_I18N, maybeWrapT} from './debug'\nimport {studioLocaleNamespace} from './localeNamespaces'\nimport {defaultLocale} from './locales'\nimport {getPreferredLocale} from './localeStore'\nimport {\n  type Locale,\n  type LocaleDefinition,\n  type LocaleResourceBundle,\n  type LocaleSource,\n} from './types'\n\n/**\n * @internal\n * @hidden\n */\nexport function prepareI18n(source: SourceOptions): {source: LocaleSource; i18next: i18n} {\n  const {projectId, dataset, name: sourceName} = source\n  const context = {projectId: projectId, dataset}\n\n  const locales = resolveConfigProperty({\n    config: source,\n    context,\n    propertyName: 'i18n.locales',\n    reducer: localeDefReducer,\n    initialValue: [defaultLocale],\n  })\n\n  const bundles = resolveConfigProperty({\n    config: source,\n    context,\n    propertyName: 'i18n.bundles',\n    reducer: localeBundlesReducer,\n    initialValue: normalizeResourceBundles(locales),\n  })\n\n  return createI18nApi({\n    locales,\n    bundles,\n    projectId,\n    sourceName,\n  })\n}\n\nfunction createI18nApi({\n  locales,\n  bundles,\n  projectId,\n  sourceName,\n}: {\n  locales: LocaleDefinition[]\n  bundles: LocaleResourceBundle[]\n  projectId: string\n  sourceName: string\n}): {source: LocaleSource; i18next: i18n} {\n  const namespaceNames = new Set(bundles.map((bundle) => bundle.namespace))\n  const options = getI18NextOptions(projectId, sourceName, locales, namespaceNames)\n  const i18nInstance = createI18nInstance()\n    .use(createSanityI18nBackend({bundles}))\n    .use(initReactI18next)\n\n  i18nInstance.init(options).catch((err) => {\n    console.error('Failed to initialize i18n backend: %s', err)\n  })\n\n  const reducedLocales = locales.map(reduceLocaleDefinition)\n\n  return {\n    /** @public */\n    source: {\n      get currentLocale() {\n        return reducedLocales.find((locale) => locale.id === i18nInstance.language) ?? defaultLocale\n      },\n      loadNamespaces(namespaces: string[]): Promise<void> {\n        const missing = namespaces.filter((ns) => !i18nInstance.hasLoadedNamespace(ns))\n        return missing.length === 0 ? Promise.resolve() : i18nInstance.loadNamespaces(missing)\n      },\n      locales: reducedLocales,\n      t: maybeWrapT(i18nInstance.t),\n    },\n\n    /** @internal */\n    i18next: i18nInstance,\n  }\n}\n\n/**\n * Takes the locales config and returns a normalized array of bundles from the defined locales.\n *\n * @param locales - The locale bundles defined in configuration/plugins\n * @returns An array of normalized bundles\n * @internal\n */\nfunction normalizeResourceBundles(locales: LocaleDefinition[]): LocaleResourceBundle[] {\n  const normalized: LocaleResourceBundle[] = []\n\n  for (const lang of locales) {\n    if (lang.bundles && !Array.isArray(lang.bundles)) {\n      throw new Error(`Resource bundle for locale ${lang.id} is not an array`)\n    }\n\n    if (!lang.bundles) {\n      continue\n    }\n\n    for (const bundle of lang.bundles) {\n      if ('locale' in bundle && bundle.locale !== lang.id) {\n        throw new Error(`Resource bundle inside locale ${lang.id} has mismatching locale id`)\n      }\n\n      const ns = bundle.namespace\n      if (!ns) {\n        throw new Error(`Resource bundle for locale ${lang.id} is missing namespace`)\n      }\n\n      normalized.push('locale' in bundle ? bundle : {...bundle, locale: lang.id})\n    }\n  }\n\n  return normalized\n}\n\nconst defaultOptions: InitOptions = {\n  /**\n   * Even though we're only defining the studio namespace, i18next will still load requested\n   * namespaces through the backend. The reason why we're defining the namespace at all is to\n   * prevent i18next from (trying) to load the i18next default `translation` namespace.\n   */\n  ns: [studioLocaleNamespace],\n  defaultNS: studioLocaleNamespace,\n  partialBundledLanguages: true,\n\n  // Fall back to English (US) locale\n  fallbackLng: defaultLocale.id,\n\n  // This will be overriden with the users detected/preferred locale before initing,\n  // but to satisfy the init options and prevent mistakes, we include a default here.\n  lng: defaultLocale.id,\n\n  // In rare cases we'll want to be able to debug i18next - there is a `debug` option\n  // in the studio i18n configuration for that, which will override this value.\n  debug: DEBUG_I18N,\n\n  // When specifying language 'en-US', do not load 'en-US', 'en', 'dev' - only `en-US`.\n  load: 'currentOnly',\n\n  // We always use our \"backend\" for loading translations, allowing us to handle i18n resources\n  // in a single place with a single approach. This means we shouldn't need to wait for the init,\n  // as any missing translations will be loaded async (through react suspense).\n  initImmediate: true,\n\n  // Because we use i18next-react, we do not need to escale values\n  interpolation: {\n    escapeValue: false,\n  },\n\n  // Theoretically, if the framework somehow gets new translations added, re-render.\n  // Note that this shouldn't actually happen, as we only use the Sanity backend\n  react: {\n    bindI18nStore: 'added',\n  },\n}\n\nfunction getI18NextOptions(\n  projectId: string,\n  sourceName: string,\n  locales: LocaleDefinition[],\n  namespaces: Set<string>,\n): InitOptions & {lng: string} {\n  const preferredLocaleId = getPreferredLocale(projectId, sourceName)\n  const preferredLocale = locales.find((l) => l.id === preferredLocaleId)\n  const lastLocale = locales[locales.length - 1]\n  const locale = preferredLocale?.id ?? lastLocale.id ?? defaultOptions.lng\n  return {\n    ...defaultOptions,\n    ns: Array.from(namespaces), // For now, let us load all namespaces. We can optimize later.\n    lng: locale,\n    supportedLngs: locales.map((def) => def.id),\n  }\n}\n\n/**\n * Reduce a locale definition to a Locale instance\n *\n * @param definition - The locale definition to reduce\n * @returns A Locale instance\n * @internal\n */\nfunction reduceLocaleDefinition(definition: LocaleDefinition): Locale {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const {bundles, ...locale} = definition\n  return locale\n}\n","import {type IntrinsicTypeName} from '@sanity/types'\nimport {type ComponentType} from 'react'\n\nimport {type SearchOperatorType} from './operators/defaultOperators'\n\nexport type Operator<TOperators = string> = OperatorDivider | OperatorItem<TOperators>\n\nexport type OperatorDivider = {\n  type: 'divider'\n}\n\nexport type OperatorItem<TOperators = string> = {\n  name: TOperators\n  type: 'item'\n}\n\ninterface SearchFilterBaseDefinition<TOperators> {\n  description?: string\n  icon: ComponentType\n  name: string\n  operators: Operator<TOperators>[]\n}\n\nexport interface SearchFilterFieldDefinition<TOperators = string>\n  extends SearchFilterBaseDefinition<TOperators> {\n  fieldType: IntrinsicTypeName\n  type: 'field'\n}\n\nexport interface SearchFilterPinnedDefinition<TOperators = string>\n  extends SearchFilterBaseDefinition<TOperators> {\n  fieldPath?: string\n  group?: string\n  title: string\n  type: 'pinned'\n}\n\n/**\n * @beta\n */\nexport type SearchFilterDefinition<TOperators = string> =\n  | SearchFilterFieldDefinition<TOperators>\n  | SearchFilterPinnedDefinition<TOperators>\n\n/**\n * @internal\n */\nexport function createFilterDefinitionDictionary(\n  filterDefinitions: SearchFilterDefinition[],\n): SearchFilterDefinitionDictionary {\n  return filterDefinitions.reduce<SearchFilterDefinitionDictionary>((acc, val) => {\n    acc[val.name] = val\n    return acc\n  }, {})\n}\n\n/**\n * @alpha\n */\nexport function defineSearchFilter<TOperators = SearchOperatorType>(\n  filterDef: SearchFilterDefinition<TOperators>,\n): typeof filterDef {\n  return filterDef\n}\n\n/**\n * @alpha\n */\nexport function defineSearchFilterOperators<TOperators = SearchOperatorType>(\n  operators: Operator<TOperators>[],\n): typeof operators {\n  return operators\n}\n\nexport function getFilterDefinition(\n  definitions: SearchFilterDefinitionDictionary,\n  filterName: string,\n): SearchFilterDefinition | undefined {\n  return definitions[filterName]\n}\n\n// TODO: we'll need to add field type to pinned filters, in order to properly infer\n// supported field types in the event all field filters are disabled / override\nexport function getSupportedFieldTypes(filterDefs: SearchFilterDefinition[]): string[] {\n  return filterDefs.reduce<string[]>((acc, val) => {\n    if (val.type === 'field') {\n      acc.push(val.fieldType)\n    }\n    return acc\n  }, [])\n}\n\n/**\n * @internal\n */\nexport type SearchFilterDefinitionDictionary = Record<\n  SearchFilterDefinition['name'],\n  SearchFilterDefinition\n>\n","import {\n  BlockContentIcon,\n  CalendarIcon,\n  CheckmarkCircleIcon,\n  ChevronDownIcon,\n  DocumentIcon,\n  ImageIcon,\n  LinkIcon,\n  NumberIcon,\n  StringIcon,\n  UlistIcon,\n} from '@sanity/icons'\n\nimport {defineSearchFilter, type SearchFilterDefinition} from './filters'\nimport {type SearchOperatorType} from './operators/defaultOperators'\n\nexport const filterDefinitions: SearchFilterDefinition[] = [\n  // 'Pinned' filters\n  defineSearchFilter<SearchOperatorType>({\n    fieldPath: '_updatedAt',\n    icon: CalendarIcon,\n    operators: [\n      {name: 'dateTimeLast', type: 'item'},\n      {type: 'divider'},\n      {name: 'dateTimeRange', type: 'item'},\n      {name: 'dateTimeAfter', type: 'item'},\n      {name: 'dateTimeBefore', type: 'item'},\n      {type: 'divider'},\n      {name: 'dateTimeEqual', type: 'item'},\n      {name: 'dateTimeNotEqual', type: 'item'},\n    ],\n    title: 'Edited at',\n    name: 'updatedAt',\n    type: 'pinned',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldPath: '_createdAt',\n    icon: CalendarIcon,\n    operators: [\n      {name: 'dateTimeLast', type: 'item'},\n      {type: 'divider'},\n      {name: 'dateTimeRange', type: 'item'},\n      {name: 'dateTimeAfter', type: 'item'},\n      {name: 'dateTimeBefore', type: 'item'},\n      {type: 'divider'},\n      {name: 'dateTimeEqual', type: 'item'},\n      {name: 'dateTimeNotEqual', type: 'item'},\n    ],\n    title: 'Created at',\n    name: 'createdAt',\n    type: 'pinned',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    icon: LinkIcon,\n    operators: [\n      {name: 'referencesDocument', type: 'item'},\n      {name: 'referencesAssetImage', type: 'item'},\n      {name: 'referencesAssetFile', type: 'item'},\n    ],\n    title: 'Contains document, image or file',\n    name: 'references',\n    type: 'pinned',\n  }),\n  // 'Field' filters\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'array',\n    icon: UlistIcon,\n    name: 'array',\n    operators: [\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n      {type: 'divider'},\n      {name: 'arrayCountEqual', type: 'item'},\n      {name: 'arrayCountNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'arrayCountGt', type: 'item'},\n      {name: 'arrayCountGte', type: 'item'},\n      {name: 'arrayCountLt', type: 'item'},\n      {name: 'arrayCountLte', type: 'item'},\n      {type: 'divider'},\n      {name: 'arrayCountRange', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'array',\n    icon: UlistIcon,\n    name: 'arrayList',\n    operators: [\n      {name: 'arrayListIncludes', type: 'item'},\n      {name: 'arrayListNotIncludes', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n      {type: 'divider'},\n      {name: 'arrayCountEqual', type: 'item'},\n      {name: 'arrayCountNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'arrayCountGt', type: 'item'},\n      {name: 'arrayCountGte', type: 'item'},\n      {name: 'arrayCountLt', type: 'item'},\n      {name: 'arrayCountLte', type: 'item'},\n      {type: 'divider'},\n      {name: 'arrayCountRange', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'array',\n    icon: UlistIcon,\n    name: 'arrayReferences',\n    operators: [\n      {name: 'arrayReferenceIncludes', type: 'item'},\n      {name: 'arrayReferenceNotIncludes', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n      {type: 'divider'},\n      {name: 'arrayCountEqual', type: 'item'},\n      {name: 'arrayCountNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'arrayCountGt', type: 'item'},\n      {name: 'arrayCountGte', type: 'item'},\n      {name: 'arrayCountLt', type: 'item'},\n      {name: 'arrayCountLte', type: 'item'},\n      {type: 'divider'},\n      {name: 'arrayCountRange', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'boolean',\n    icon: CheckmarkCircleIcon,\n    name: 'boolean',\n    operators: [\n      {name: 'booleanEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'date',\n    icon: CalendarIcon,\n    name: 'date',\n    operators: [\n      {name: 'dateLast', type: 'item'},\n      {type: 'divider'},\n      {name: 'dateRange', type: 'item'},\n      {name: 'dateAfter', type: 'item'},\n      {name: 'dateBefore', type: 'item'},\n      {type: 'divider'},\n      {name: 'dateEqual', type: 'item'},\n      {name: 'dateNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'datetime',\n    icon: CalendarIcon,\n    name: 'datetime',\n    operators: [\n      {name: 'dateTimeLast', type: 'item'},\n      {type: 'divider'},\n      {name: 'dateTimeRange', type: 'item'},\n      {name: 'dateTimeAfter', type: 'item'},\n      {name: 'dateTimeBefore', type: 'item'},\n      {type: 'divider'},\n      {name: 'dateTimeEqual', type: 'item'},\n      {name: 'dateTimeNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'email',\n    icon: StringIcon,\n    name: 'email',\n    operators: [\n      {name: 'stringMatches', type: 'item'},\n      {name: 'stringNotMatches', type: 'item'},\n      {type: 'divider'},\n      {name: 'stringEqual', type: 'item'},\n      {name: 'stringNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'file',\n    icon: DocumentIcon,\n    name: 'file',\n    operators: [\n      {name: 'assetFileEqual', type: 'item'},\n      {name: 'assetFileNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'image',\n    icon: ImageIcon,\n    name: 'image',\n    operators: [\n      {name: 'assetImageEqual', type: 'item'},\n      {name: 'assetImageNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'number',\n    icon: NumberIcon,\n    name: 'number',\n    operators: [\n      {name: 'numberEqual', type: 'item'},\n      {name: 'numberNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'numberGt', type: 'item'},\n      {name: 'numberGte', type: 'item'},\n      {name: 'numberLt', type: 'item'},\n      {name: 'numberLte', type: 'item'},\n      {type: 'divider'},\n      {name: 'numberRange', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'array',\n    icon: BlockContentIcon,\n    name: 'portableText',\n    operators: [\n      {name: 'portableTextMatches', type: 'item'},\n      {name: 'portableTextNotMatches', type: 'item'},\n      {type: 'divider'},\n      {name: 'portableTextEqual', type: 'item'},\n      {name: 'portableTextNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'reference',\n    icon: LinkIcon,\n    name: 'reference',\n    operators: [\n      {name: 'referenceEqual', type: 'item'},\n      {name: 'referenceNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'slug',\n    icon: StringIcon,\n    name: 'slug',\n    operators: [\n      {name: 'slugMatches', type: 'item'},\n      {name: 'slugNotMatches', type: 'item'},\n      {type: 'divider'},\n      {name: 'slugEqual', type: 'item'},\n      {name: 'slugNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'string',\n    icon: StringIcon,\n    name: 'string',\n    operators: [\n      {name: 'stringMatches', type: 'item'},\n      {name: 'stringNotMatches', type: 'item'},\n      {type: 'divider'},\n      {name: 'stringEqual', type: 'item'},\n      {name: 'stringNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'string',\n    icon: ChevronDownIcon,\n    name: 'stringList',\n    operators: [\n      {name: 'stringListEqual', type: 'item'},\n      {name: 'stringListNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'stringMatches', type: 'item'},\n      {name: 'stringNotMatches', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'text',\n    icon: StringIcon,\n    name: 'text',\n    operators: [\n      {name: 'stringMatches', type: 'item'},\n      {name: 'stringNotMatches', type: 'item'},\n      {type: 'divider'},\n      {name: 'stringEqual', type: 'item'},\n      {name: 'stringNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n  defineSearchFilter<SearchOperatorType>({\n    fieldType: 'url',\n    icon: StringIcon,\n    name: 'url',\n    operators: [\n      {name: 'stringMatches', type: 'item'},\n      {name: 'stringNotMatches', type: 'item'},\n      {type: 'divider'},\n      {name: 'stringEqual', type: 'item'},\n      {name: 'stringNotEqual', type: 'item'},\n      {type: 'divider'},\n      {name: 'defined', type: 'item'},\n      {name: 'notDefined', type: 'item'},\n    ],\n    type: 'field',\n  }),\n]\n","import {useCurrentLocale} from '../i18n/hooks/useLocale'\nimport {intlCache} from '../i18n/intlCache'\n\n/**\n * Options for the `useDateTimeFormat` hook\n *\n * @public\n */\nexport type UseDateTimeFormatOptions = Omit<Intl.DateTimeFormatOptions, 'fractionalSecondDigits'>\n\n/**\n * Returns an instance of `Intl.DateTimeFormat` that uses the currently selected locale,\n * and enables locale and culture-sensitive date formatting.\n *\n * @param options - Optional options for the date/time formatter\n * @returns Instance of `Intl.DateTimeFormat`\n * @public\n */\nexport function useDateTimeFormat(options: UseDateTimeFormatOptions = {}): Intl.DateTimeFormat {\n  const currentLocale = useCurrentLocale().id\n  return intlCache.dateTimeFormat(currentLocale, options)\n}\n","import {useCurrentLocale} from '../i18n/hooks/useLocale'\nimport {intlCache} from '../i18n/intlCache'\n\n/**\n * Options for the `useUnitFormatter` hook\n *\n * @public\n */\nexport type UseUnitFormatterOptions = Pick<\n  Intl.NumberFormatOptions,\n  'notation' | 'signDisplay' | 'unitDisplay' | 'maximumFractionDigits' | 'minimumFractionDigits'\n>\n\n/**\n * Available measurement units\n *\n * @public\n */\nexport type FormattableMeasurementUnit =\n  | 'acre'\n  | 'bit'\n  | 'byte'\n  | 'celsius'\n  | 'centimeter'\n  | 'day'\n  | 'degree'\n  | 'fahrenheit'\n  | 'fluid-ounce'\n  | 'foot'\n  | 'gallon'\n  | 'gigabit'\n  | 'gigabyte'\n  | 'gram'\n  | 'hectare'\n  | 'hour'\n  | 'inch'\n  | 'kilobit'\n  | 'kilobyte'\n  | 'kilogram'\n  | 'kilometer'\n  | 'liter'\n  | 'megabit'\n  | 'megabyte'\n  | 'meter'\n  | 'mile'\n  | 'mile-scandinavian'\n  | 'milliliter'\n  | 'millimeter'\n  | 'millisecond'\n  | 'minute'\n  | 'month'\n  | 'ounce'\n  | 'percent'\n  | 'petabyte'\n  | 'pound'\n  | 'second'\n  | 'stone'\n  | 'terabit'\n  | 'terabyte'\n  | 'week'\n  | 'yard'\n  | 'year'\n\n/**\n * Formats a number using the specified unit, using the currently active locale.\n *\n * @param value - The number to format\n * @param unit - The unit to format the number as\n * @returns The formatted number\n * @public\n */\nexport type UnitFormatter = (value: number, unit: FormattableMeasurementUnit) => string\n\n/**\n * Returns a formatter with the given options. Function takes a number and the unit to format as\n * the second argument. The formatter will yield localized output, based on the users' selected\n * locale.\n *\n * This differs from regular `Intl.NumberFormat` in two ways:\n * 1. You do not need to instantiate a new formatter for each unit you want to format\n *    (still happens behind the scenes, but is memoized)\n * 2. The default unit display style (`unitDisplay`) is `long`\n *\n * @example\n * ```ts\n * function MyComponent() {\n *   const format = useUnitFormatter()\n *   return <div>{format(2313, 'meter')}</div>\n *   // en-US -> 2,313 meters\n *   // fr-FR -> 2 313 mtres\n * }\n * ```\n *\n * @param options - Optional options for the unit formatter\n * @returns Formatter function\n * @public\n */\nexport function useUnitFormatter(options: UseUnitFormatterOptions = {}): UnitFormatter {\n  const currentLocale = useCurrentLocale().id\n  const defaultOptions: Intl.NumberFormatOptions = {\n    unitDisplay: 'long',\n    ...options,\n    style: 'unit',\n  }\n\n  return function format(value: number, unit: FormattableMeasurementUnit) {\n    const formatter = intlCache.numberFormat(currentLocale, {...defaultOptions, unit})\n    return formatter.format(value)\n  }\n}\n","import {type SanityDocument, type SchemaType} from '@sanity/types'\nimport {Skeleton} from '@sanity/ui'\nimport {useMemo} from 'react'\nimport {useMemoObservable} from 'react-rx'\n\nimport {getPreviewStateObservable, getPreviewValueWithFallback} from '../../../../../../../preview'\nimport {useDocumentPreviewStore} from '../../../../../../../store'\n\nexport function ReferencePreviewTitle({\n  documentId,\n  schemaType,\n}: {\n  documentId: string\n  schemaType: SchemaType\n}) {\n  const documentPreviewStore = useDocumentPreviewStore()\n\n  // NOTE: this emits sync so can never be null\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const {draft, published, isLoading} = useMemoObservable(\n    () => getPreviewStateObservable(documentPreviewStore, schemaType, documentId, ''),\n    [documentId, documentPreviewStore, schemaType],\n  )!\n\n  const sanityDocument = useMemo(() => {\n    return {\n      _id: documentId,\n      _type: schemaType.name,\n    } as SanityDocument\n  }, [documentId, schemaType.name])\n\n  const previewValue = getPreviewValueWithFallback({\n    draft,\n    published,\n    value: sanityDocument,\n  })\n\n  if (isLoading) {\n    return <Skeleton animated marginLeft={1} radius={2} style={{width: '10ch', height: '1em'}} />\n  }\n\n  return <>{previewValue.title || documentId.slice(0, 8)}</>\n}\n","import {type Reference} from '@sanity/types'\nimport {isValid} from 'date-fns'\n\nimport {useSchema} from '../../../../../../../hooks'\nimport {useDateTimeFormat} from '../../../../../../../hooks/useDateTimeFormat'\nimport {useUnitFormatter} from '../../../../../../../hooks/useUnitFormatter'\nimport {useTranslation} from '../../../../../../../i18n'\nimport {\n  type OperatorDateEqualValue,\n  type OperatorDateLastValue,\n  type OperatorDateRangeValue,\n} from '../../../definitions/operators/dateOperators'\nimport {type OperatorButtonValueComponentProps} from '../../../definitions/operators/operatorTypes'\nimport {ReferencePreviewTitle} from './ReferencePreviewTitle'\n\nconst DEFAULT_DATE_FORMAT = 'yyyy-MM-dd'\n\nexport function SearchButtonValueBoolean({value}: OperatorButtonValueComponentProps<boolean>) {\n  const {t} = useTranslation()\n  return <>{value ? t('search.filter-boolean-true') : t('search.filter-boolean-false')}</>\n}\n\nexport function SearchButtonValueDate({\n  value,\n}: OperatorButtonValueComponentProps<OperatorDateEqualValue>) {\n  const dateFormat = useDateTimeFormat({\n    dateStyle: 'medium',\n    timeStyle: value.includeTime ? 'short' : undefined,\n  })\n  const date = value?.date ? new Date(value.date) : null\n  if (!date || !isValid(date)) {\n    return null\n  }\n  return <>{dateFormat.format(date)}</>\n}\n\nexport function SearchButtonValueDateLast({\n  value,\n}: OperatorButtonValueComponentProps<OperatorDateLastValue>) {\n  const formatUnit = useUnitFormatter()\n  return <>{formatUnit(Math.floor(value?.unitValue ?? 0), value.unit)}</>\n}\n\nexport function SearchButtonValueDateRange({\n  value,\n}: OperatorButtonValueComponentProps<OperatorDateRangeValue>) {\n  const dateFormat = useDateTimeFormat({\n    dateStyle: 'medium',\n    timeStyle: value.includeTime ? 'short' : undefined,\n  })\n  const startDate = value?.from ? new Date(value.from) : null\n  const endDate = value?.to ? new Date(value.to) : null\n  if (!endDate || !startDate || !isValid(endDate) || !isValid(startDate)) {\n    return null\n  }\n\n  const from = dateFormat.format(startDate)\n  const to = dateFormat.format(endDate)\n  return <>{`${from}  ${to}`}</>\n}\n\nexport function SearchButtonValueReference({value}: OperatorButtonValueComponentProps<Reference>) {\n  const schema = useSchema()\n  const documentId = value._ref\n  const schemaType = schema.get(value._type)\n  if (!schemaType) {\n    return null\n  }\n  return <ReferencePreviewTitle documentId={documentId} schemaType={schemaType} />\n}\n","import {createContext, type Dispatch, type SetStateAction} from 'react'\n\nimport {type CommandListHandle} from '../../../../../../components/commandList/types'\nimport {type SearchAction, type SearchReducerState} from './reducer'\n\n/**\n * @internal\n */\nexport interface SearchContextValue {\n  dispatch: Dispatch<SearchAction>\n  onClose: (() => void) | null\n  searchCommandList: CommandListHandle | null\n  setSearchCommandList: Dispatch<SetStateAction<CommandListHandle | null>>\n  setOnClose: (onClose: () => void) => void\n  state: SearchReducerState\n}\n\n/**\n * @internal\n */\nexport const SearchContext = createContext<SearchContextValue | undefined>(undefined)\n","import {useContext} from 'react'\n\nimport {SearchContext, type SearchContextValue} from './SearchContext'\n\n/**\n * @internal\n */\nexport function useSearchState(): SearchContextValue {\n  const context = useContext(SearchContext)\n\n  if (context === undefined) {\n    throw new Error('useSearchState must be used within an SearchProvider')\n  }\n  return context\n}\n","import {TextInput} from '@sanity/ui'\nimport {type ChangeEvent, useCallback, useState} from 'react'\n\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\n\nexport function SearchFilterNumberInput({value, onChange}: OperatorInputComponentProps<number>) {\n  const [uncontrolledValue, setUncontrolledValue] = useState(value ?? '')\n\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const handleChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      setUncontrolledValue(event.currentTarget.value)\n      const numValue = parseFloat(event.currentTarget.value)\n      onChange(Number.isFinite(numValue) ? numValue : null)\n    },\n    [onChange],\n  )\n\n  return (\n    <TextInput\n      fontSize={fullscreen ? 2 : 1}\n      onChange={handleChange}\n      placeholder={t('search.filter-number-value-placeholder')}\n      radius={2}\n      step=\"any\"\n      type=\"number\"\n      value={uncontrolledValue}\n    />\n  )\n}\n","import {Box, Flex, TextInput} from '@sanity/ui'\nimport {type ChangeEvent, useCallback, useState} from 'react'\n\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorNumberRangeValue} from '../../../../../definitions/operators/common'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\n\nexport function SearchFilterNumberRangeInput({\n  onChange,\n  value,\n}: OperatorInputComponentProps<OperatorNumberRangeValue>) {\n  const [to, setTo] = useState(value?.to ?? '')\n  const [from, setFrom] = useState(value?.from ?? '')\n\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const handleToChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      setTo(event.currentTarget.value)\n      const numValue = parseFloat(event.currentTarget.value)\n      onChange({\n        to: Number.isFinite(numValue) ? numValue : null,\n        from: value?.from ?? null,\n      })\n    },\n    [value?.from, onChange],\n  )\n  const handleFromChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      setFrom(event.currentTarget.value)\n      const numValue = parseFloat(event.currentTarget.value)\n      onChange({\n        to: value?.to ?? null,\n        from: Number.isFinite(numValue) ? numValue : null,\n      })\n    },\n    [value?.to, onChange],\n  )\n\n  return (\n    <Flex gap={2}>\n      <Box flex={1}>\n        <TextInput\n          fontSize={fullscreen ? 2 : 1}\n          onChange={handleFromChange}\n          placeholder={t('search.filter-number-min-value-placeholder')}\n          radius={2}\n          step=\"any\"\n          type=\"number\"\n          value={from}\n        />\n      </Box>\n      <Box flex={1}>\n        <TextInput\n          fontSize={fullscreen ? 2 : 1}\n          onChange={handleToChange}\n          placeholder={t('search.filter-number-max-value-placeholder')}\n          radius={2}\n          step=\"any\"\n          type=\"number\"\n          value={to}\n        />\n      </Box>\n    </Flex>\n  )\n}\n","import {isObjectSchemaType, type ObjectField, type SchemaType} from '@sanity/types'\n\nexport function getSchemaField(\n  schemaType: SchemaType,\n  fieldPath: string,\n): ObjectField<SchemaType> | undefined {\n  const paths = fieldPath.split('.')\n  const firstPath = paths[0]\n  if (firstPath && isObjectSchemaType(schemaType)) {\n    const field = schemaType.fields.find((f) => f.name === firstPath)\n    if (field) {\n      const nextPath = paths.slice(1).join('.')\n      if (nextPath) {\n        return getSchemaField(field.type, nextPath)\n      }\n      return field\n    }\n  }\n  return undefined\n}\n","import {type SanityDocument} from '@sanity/client'\nimport {type SchemaType} from '@sanity/types'\nimport {Badge, Box, Flex} from '@sanity/ui'\nimport {useMemo} from 'react'\nimport {useMemoObservable} from 'react-rx'\nimport styled from 'styled-components'\n\nimport {type GeneralPreviewLayoutKey} from '../../../../../../../components'\nimport {DocumentStatus} from '../../../../../../../components/documentStatus'\nimport {DocumentStatusIndicator} from '../../../../../../../components/documentStatusIndicator'\nimport {DocumentPreviewPresence} from '../../../../../../../presence'\nimport {\n  getPreviewStateObservable,\n  getPreviewValueWithFallback,\n  SanityDefaultPreview,\n} from '../../../../../../../preview'\nimport {type DocumentPresence, useDocumentPreviewStore} from '../../../../../../../store'\n\ninterface SearchResultItemPreviewProps {\n  documentId: string\n  layout?: GeneralPreviewLayoutKey\n  presence?: DocumentPresence[]\n  schemaType: SchemaType\n  showBadge?: boolean\n}\n\n/**\n * Temporary workaround: force all nested boxes on iOS to use `background-attachment: scroll`\n * to allow <Skeleton> components to render correctly within virtual lists.\n */\nconst SearchResultItemPreviewBox = styled(Box)`\n  @supports (-webkit-overflow-scrolling: touch) {\n    * [data-ui='Box'] {\n      background-attachment: scroll;\n    }\n  }\n`\n\n/**\n * @internal\n */\nexport function SearchResultItemPreview({\n  documentId,\n  layout,\n  presence,\n  schemaType,\n  showBadge = true,\n}: SearchResultItemPreviewProps) {\n  const documentPreviewStore = useDocumentPreviewStore()\n\n  // NOTE: this emits sync so can never be null\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const {draft, published, isLoading} = useMemoObservable(\n    () => getPreviewStateObservable(documentPreviewStore, schemaType, documentId, ''),\n    [documentId, documentPreviewStore, schemaType],\n  )!\n\n  const sanityDocument = useMemo(() => {\n    return {\n      _id: documentId,\n      _type: schemaType.name,\n    } as SanityDocument\n  }, [documentId, schemaType.name])\n\n  const status = useMemo(() => {\n    if (isLoading) return null\n    return (\n      <Flex align=\"center\" gap={3}>\n        {presence && presence.length > 0 && <DocumentPreviewPresence presence={presence} />}\n        {showBadge && <Badge>{schemaType.title}</Badge>}\n        <DocumentStatusIndicator draft={draft} published={published} />\n      </Flex>\n    )\n  }, [draft, isLoading, presence, published, schemaType.title, showBadge])\n\n  const tooltip = <DocumentStatus draft={draft} published={published} />\n\n  return (\n    <SearchResultItemPreviewBox>\n      <SanityDefaultPreview\n        {...getPreviewValueWithFallback({\n          draft,\n          published,\n          value: sanityDocument,\n        })}\n        isPlaceholder={isLoading ?? true}\n        layout={layout || 'default'}\n        icon={schemaType.icon}\n        status={status}\n        tooltip={tooltip}\n      />\n    </SearchResultItemPreviewBox>\n  )\n}\n","import {type SanityDocumentLike} from '@sanity/types'\nimport {Box, type ResponsiveMarginProps, type ResponsivePaddingProps} from '@sanity/ui'\nimport {type MouseEvent, useCallback, useMemo} from 'react'\nimport {useIntentLink} from 'sanity/router'\n\nimport {type GeneralPreviewLayoutKey, PreviewCard} from '../../../../../../../components'\nimport {useSchema} from '../../../../../../../hooks'\nimport {useDocumentPresence} from '../../../../../../../store'\nimport {SearchResultItemPreview} from './SearchResultItemPreview'\n\nexport type ItemSelectHandler = (item: Pick<SanityDocumentLike, '_id' | '_type'>) => void\n\ninterface SearchResultItemProps extends ResponsiveMarginProps, ResponsivePaddingProps {\n  disableIntentLink?: boolean\n  documentId: string\n  documentType: string\n  layout?: GeneralPreviewLayoutKey\n  onClick?: () => void\n  onItemSelect?: ItemSelectHandler\n}\n\nexport function SearchResultItem({\n  disableIntentLink,\n  documentId,\n  documentType,\n  layout,\n  onClick,\n  onItemSelect,\n  ...rest\n}: SearchResultItemProps) {\n  const schema = useSchema()\n  const type = schema.get(documentType)\n  const documentPresence = useDocumentPresence(documentId)\n\n  const params = useMemo(() => ({id: documentId, type: type?.name}), [documentId, type?.name])\n  const {onClick: onIntentClick, href} = useIntentLink({\n    intent: 'edit',\n    params,\n  })\n\n  const handleClick = useCallback(\n    (e: MouseEvent<HTMLElement>) => {\n      onItemSelect?.({_id: documentId, _type: documentType})\n      if (!disableIntentLink) {\n        onIntentClick(e)\n      }\n      onClick?.()\n    },\n    [onItemSelect, documentId, documentType, disableIntentLink, onClick, onIntentClick],\n  )\n\n  if (!type) return null\n\n  return (\n    <Box {...rest}>\n      <PreviewCard\n        as=\"a\"\n        data-as=\"a\"\n        flex={1}\n        href={disableIntentLink ? undefined : href}\n        onClick={handleClick}\n        radius={2}\n        tabIndex={-1}\n      >\n        <SearchResultItemPreview\n          documentId={documentId}\n          layout={layout}\n          presence={documentPresence}\n          schemaType={type}\n        />\n      </PreviewCard>\n    </Box>\n  )\n}\n","import {studioTheme} from '@sanity/ui'\n\nconst IS_MAC =\n  typeof window != 'undefined' && /Mac|iPod|iPhone|iPad/.test(window.navigator.platform)\n\n// Enable debug mode when the current URL contains the below fragment.\n// Must be prefixed with `_debug_`\nexport const DEBUG_FRAGMENT = '_debug_search_score'\n\n// Display debug filter information: shared document types and field values\nexport const DEBUG_MODE = false\n\n// Max number of records to fetch per search request - intentionally set high to workaround\n// current limitations with studio search config\nexport const SEARCH_LIMIT = 1000\n\nexport const GLOBAL_SEARCH_KEY = 'k'\nexport const GLOBAL_SEARCH_KEY_MODIFIER = IS_MAC ? 'Cmd' : 'Ctrl'\n\nexport const POPOVER_INPUT_PADDING = studioTheme.space[4] // px\nexport const POPOVER_MAX_HEIGHT = 735 // px\nexport const POPOVER_MAX_WIDTH = 800 // px\n\n// Custom space between buttons and popover content\nexport const POPOVER_VERTICAL_MARGIN = 5 // px\n\nexport const POPOVER_RADIUS = 3\n","import {type SearchTerms} from '../../../../../search'\n\n/**\n * Check if current search terms are valid.\n *\n * By default, completely empty search terms (no search query, types or filter) are considered invalid,\n * unless `allowEmptyQueries` is true.\n */\nexport function hasSearchableTerms({\n  allowEmptyQueries,\n  terms,\n}: {\n  allowEmptyQueries?: boolean\n  terms: SearchTerms\n}): boolean {\n  const hasQuery = allowEmptyQueries ? true : terms.query.length > 0\n  const hasFilter = !!terms.filter\n  const hasSelectedTypes = terms.types.length > 0\n\n  return hasQuery || hasFilter || hasSelectedTypes\n}\n","import {type ObjectSchemaType, type Schema, type SchemaType} from '@sanity/types'\n\nimport {getSearchableTypes} from '../../../../../search'\n\n/**\n * Returns a list of all available document types filtered by a search string.\n * Types containing the search string in its `title` or `name` will be returned.\n */\nexport function getSelectableOmnisearchTypes(schema: Schema, typeFilter: string): SchemaType[] {\n  return getSearchableOmnisearchTypes(schema)\n    .filter((type) => inTypeFilter(type, typeFilter))\n    .sort(sortTypes)\n}\n\n/**\n * Return all searchable document types that are visible to omnisearch.\n * Documents with `__experimental_omnisearch_visibility: false` will be hidden.\n */\nexport function getSearchableOmnisearchTypes(schema: Schema): ObjectSchemaType[] {\n  return getSearchableTypes(schema).filter(\n    (type) => !(type.__experimental_omnisearch_visibility === false),\n  )\n}\n\nexport function sortTypes(a: SchemaType, b: SchemaType): number {\n  return (a.title ?? a.name).localeCompare(b.title ?? b.name)\n}\n\nfunction inTypeFilter(type: SchemaType, typeFilter: string): boolean {\n  return !typeFilter || (type.title ?? type.name).toLowerCase().includes(typeFilter?.toLowerCase())\n}\n","import {type Schema} from '@sanity/types'\nimport isEqual from 'lodash/isEqual'\nimport {useCallback, useMemo, useState} from 'react'\nimport {useObservableCallback} from 'react-rx'\nimport {concat, EMPTY, iif, type Observable, of, timer} from 'rxjs'\nimport {\n  catchError,\n  debounce,\n  distinctUntilChanged,\n  filter,\n  map,\n  scan,\n  switchMap,\n  tap,\n} from 'rxjs/operators'\n\nimport {useClient} from '../../../../../hooks'\nimport {\n  createSearch,\n  type SearchHit,\n  type SearchOptions,\n  type SearchTerms,\n} from '../../../../../search'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../../studioClient'\nimport {useWorkspace} from '../../../../workspace'\nimport {type SearchState} from '../types'\nimport {hasSearchableTerms} from '../utils/hasSearchableTerms'\nimport {getSearchableOmnisearchTypes} from '../utils/selectors'\nimport {useSearchMaxFieldDepth} from './useSearchMaxFieldDepth'\n\ninterface SearchRequest {\n  debounceTime?: number\n  options?: SearchOptions\n  terms: SearchTerms\n}\n\nconst DEFAULT_DEBOUNCE_TIME = 300 // ms\n\nconst INITIAL_SEARCH_STATE: SearchState = {\n  error: null,\n  hits: [],\n  loading: false,\n  terms: {\n    query: '',\n    types: [],\n  },\n}\n\nfunction nonNullable<T>(v: T): v is NonNullable<T> {\n  return v !== null\n}\n\nfunction sanitizeRequest(request: SearchRequest) {\n  return {\n    ...request,\n    terms: {\n      ...request.terms,\n      filter: request.terms.filter?.trim(),\n      query: request.terms.query.trim(),\n    },\n  }\n}\n\nexport function useSearch({\n  allowEmptyQueries,\n  initialState,\n  onComplete,\n  onError,\n  onStart,\n  schema,\n}: {\n  allowEmptyQueries?: boolean\n  initialState: SearchState\n  onComplete?: (result: {hits: SearchHit[]; nextCursor: string | undefined}) => void\n  onError?: (error: Error) => void\n  onStart?: () => void\n  schema: Schema\n}): {\n  handleSearch: (request: SearchRequest) => void\n  searchState: SearchState\n} {\n  const [searchState, setSearchState] = useState(initialState)\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const maxFieldDepth = useSearchMaxFieldDepth()\n  const {unstable_enableNewSearch = false} = useWorkspace().search\n\n  const search = useMemo(\n    () =>\n      createSearch(getSearchableOmnisearchTypes(schema), client, {\n        tag: 'search.global',\n        unique: true,\n        unstable_enableNewSearch,\n        maxDepth: maxFieldDepth,\n      }),\n    [client, maxFieldDepth, schema, unstable_enableNewSearch],\n  )\n\n  const handleQueryChange = useObservableCallback(\n    (inputValue$: Observable<SearchRequest | null>) => {\n      return inputValue$.pipe(\n        // Ignore null values\n        filter(nonNullable),\n        // Sanitize request (trim query and filter)\n        map(sanitizeRequest),\n        // Only emit when values have changed\n        distinctUntilChanged(isEqual),\n        // Debounce requests\n        debounce((request) => timer(request?.debounceTime || DEFAULT_DEBOUNCE_TIME)),\n        // Trigger `onStart` callback\n        tap(onStart),\n        switchMap((request) => {\n          return concat(\n            // Emit loading start\n            of({\n              ...INITIAL_SEARCH_STATE,\n              loading: true,\n              options: request.options,\n              terms: request.terms,\n            }),\n            // Conditionally trigger search ONLY if we have valid searchable terms.\n            // Typically, search terms are valid if either query, filter or selected types is non-empty.\n            // There are exceptions (e.g. searching within <AutoComplete> components) where empty queries are permitted,\n            // which is what `allowEmptyQueries` is used for.\n            iif(\n              () => hasSearchableTerms({allowEmptyQueries, terms: request.terms}),\n              // If we have a valid search, run async fetch, map results and trigger `onComplete` / `onError` callbacks\n              search(request.terms, request.options).pipe(\n                tap(({hits, nextCursor}) => onComplete?.({hits, nextCursor})),\n                catchError((error) => {\n                  onError?.(error)\n                  return of({\n                    ...INITIAL_SEARCH_STATE,\n                    error,\n                    loading: false,\n                    options: request.options,\n                    terms: request.terms,\n                  })\n                }),\n              ),\n              // If there is no valid search, emit an empty observable and trigger `onComplete` event\n              of(EMPTY).pipe(tap(() => onComplete?.({hits: [], nextCursor: undefined}))),\n            ),\n            // Emit loading completed\n            of({loading: false}),\n          )\n        }),\n        scan((prevState, nextState): SearchState => {\n          return {...prevState, ...nextState}\n        }, INITIAL_SEARCH_STATE),\n        // Update local search state\n        tap(setSearchState),\n      )\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- @todo: add onComplete, onError and onStart to the deps list when it's verified that it's safe to do so\n    [allowEmptyQueries, search],\n  )\n\n  const handleSearch = useCallback(\n    (searchRequest: SearchRequest) => handleQueryChange(searchRequest),\n    [handleQueryChange],\n  )\n\n  return {handleSearch, searchState}\n}\n","import {type SchemaType} from '@sanity/types'\n\nimport {type TFunction} from '../../../../../i18n'\n\nconst DEFAULT_AVAILABLE_CHARS = 40 // excluding \"+x more\" suffix\n\n/**\n * From the list of provided document types, return as many type names as possible that can fit\n * within the `availableCharacters` parameter, formatted by title where available. Includes the\n * number of remaining types that were _not_ included in the returned array of types, so a UI can\n * choose to display a \"+x more\" suffix.\n *\n * @see documentTypesTruncated for a helper function that returns a formatted string\n *\n * @param options - Options object\n * @returns An object containing truncated list of types, as well as number of excluded types\n * @internal\n */\nexport function getDocumentTypesTruncated({\n  availableCharacters = DEFAULT_AVAILABLE_CHARS,\n  types,\n}: {\n  availableCharacters?: number\n  types: SchemaType[]\n}): {types: string[]; remainingCount: number} {\n  if (types.length === 0) {\n    return {remainingCount: 0, types: []}\n  }\n\n  /**\n   * Get the total number of visible document types whose titles fit within `availableCharacters` count.\n   * The first document is always included, regardless of whether it fits within `availableCharacters` or not.\n   */\n  const visibleTypes = types.reduce<SchemaType[]>(\n    (function () {\n      let remaining = availableCharacters\n      return function (acc, val, index) {\n        const title = typeTitle(val)\n        remaining -= title.length\n\n        // Always include the first type, regardless of title length\n        if (index === 0) {\n          acc.push(val)\n        } else if (availableCharacters > title.length && remaining > title.length) {\n          acc.push(val)\n        }\n        return acc\n      }\n    })(),\n    [],\n  )\n\n  return {\n    remainingCount: types.length - visibleTypes.length,\n    types: visibleTypes.map(typeTitle),\n  }\n}\n\n/**\n * From the list of provided document types, return as many type names as possible that can fit\n * within the `availableCharacters` parameter, formatted by title where available. Includes the\n * number of remaining types that were _not_ included in the returned array of types, so a UI can\n * choose to display a \"+x more\" suffix.\n *\n * @param options - Options object\n * @returns A formatted string of types\n * @internal\n */\nexport function documentTypesTruncated({\n  t,\n  availableCharacters,\n  types,\n}: {\n  availableCharacters?: number\n  types: SchemaType[]\n  t: TFunction<'studio', undefined>\n}): string {\n  if (types.length === 0) {\n    return t('search.document-type-list-all-types')\n  }\n\n  const {remainingCount, types: visibleTypes} = getDocumentTypesTruncated({\n    availableCharacters,\n    types,\n  })\n\n  const key =\n    remainingCount > 0 ? 'search.document-type-list-truncated' : 'search.document-type-list'\n\n  // \"Author, Book\" or \"Author, Book, Pet, Person +2 more\"\n  return t(key, {\n    count: remainingCount,\n    types: visibleTypes,\n    formatParams: {types: {style: 'short', type: 'unit'}},\n  })\n}\n\nfunction typeTitle(schemaType: SchemaType) {\n  return schemaType.title ?? schemaType.name\n}\n","import {type ReferenceValue, type SchemaType} from '@sanity/types'\nimport {Autocomplete, Box, Flex, Text} from '@sanity/ui'\nimport {\n  type ForwardedRef,\n  forwardRef,\n  type ReactElement,\n  useCallback,\n  useId,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../../../../../../../ui-components'\nimport {useSchema} from '../../../../../../../../../hooks'\nimport {Translate, useTranslation} from '../../../../../../../../../i18n'\nimport {type SearchHit} from '../../../../../../../../../search'\nimport {getPublishedId} from '../../../../../../../../../util'\nimport {POPOVER_RADIUS} from '../../../../../constants'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {useSearch} from '../../../../../hooks/useSearch'\nimport {getDocumentTypesTruncated} from '../../../../../utils/documentTypesTruncated'\nimport {SearchResultItem} from '../../../../searchResults/item/SearchResultItem'\n\ntype AutocompleteSearchHit = {value: string} & SearchHit\n\ninterface PopoverContentProps {\n  content: ReactElement | null\n  hidden: boolean\n  onMouseEnter: () => void\n  onMouseLeave: () => void\n}\n\ninterface ReferenceAutocompleteProps {\n  onSelect?: (reference: ReferenceValue | null) => void\n  types?: SchemaType[]\n  value?: ReferenceValue | null\n}\n\nconst NO_FILTER = () => true\n\nconst StyledText = styled(Text)`\n  word-break: break-word;\n`\n\nexport const ReferenceAutocomplete = forwardRef(function ReferenceAutocomplete(\n  {onSelect, types = [], value}: ReferenceAutocompleteProps,\n  ref: ForwardedRef<HTMLInputElement>,\n) {\n  const autocompletePopoverReferenceElementRef = useRef<HTMLDivElement | null>(null)\n\n  const schema = useSchema()\n\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const autocompleteId = useId()\n\n  const [hits, setHits] = useState<AutocompleteSearchHit[]>([])\n  const {handleSearch, searchState} = useSearch({\n    allowEmptyQueries: true,\n    initialState: {\n      hits: [],\n      loading: false,\n      error: null,\n      terms: {query: '', types},\n    },\n    onComplete: (result) => {\n      setHits(result.hits.map(({hit}) => ({value: hit._id, hit})))\n    },\n    schema,\n  })\n\n  /**\n   * Trigger non-debounced search query when autocomplete is manually opened\n   */\n  const handleAutocompleteOpenButtonClick = useCallback(() => {\n    handleSearch({\n      debounceTime: 0,\n      options: {limit: 100},\n      terms: {query: '', types},\n    })\n  }, [handleSearch, types])\n\n  /**\n   * Trigger debounced search queries on text input.\n   *\n   * When search query has been cleared (either via manual input or by closing autocomplete),\n   * trigger an non-debounecd 'empty' search to clear search state terms and reset hits.\n   */\n  const handleQueryChange = useCallback(\n    (query: string | null) => {\n      if (query) {\n        handleSearch({\n          options: {limit: 100},\n          terms: {query: query || '', types},\n        })\n      } else {\n        handleSearch({\n          debounceTime: 0,\n          options: {limit: 0},\n          terms: {query: '', types},\n        })\n      }\n    },\n    [handleSearch, types],\n  )\n\n  const handleSelect = useCallback(\n    (val: string) => {\n      const hit = hits.find((h) => h.value === val)?.hit\n      if (hit) {\n        onSelect?.({\n          _ref: getPublishedId(hit._id),\n          _type: hit._type,\n        })\n      }\n    },\n    [hits, onSelect],\n  )\n  const placeholderText = useMemo(() => {\n    if (types.length === 0) {\n      // \"Search all documents\"\n      return t('search.action.search-all-types')\n    }\n\n    const {remainingCount, types: visibleTypes} = getDocumentTypesTruncated({types})\n    const key =\n      remainingCount > 0\n        ? 'search.action.search-specific-types-truncated'\n        : 'search.action.search-specific-types'\n\n    // \"Search for Author, Book\" or \"Search for Author, Book +2 more\"\n    return t(key, {\n      count: remainingCount,\n      types: visibleTypes,\n      formatParams: {types: {style: 'short', type: 'unit'}},\n    })\n  }, [types, t])\n\n  const renderOption = useCallback((option: AutocompleteSearchHit) => {\n    return (\n      <SearchResultItem\n        disableIntentLink\n        documentId={option.value}\n        documentType={option.hit._type}\n        layout=\"compact\"\n      />\n    )\n  }, [])\n\n  const renderPopover = useCallback(\n    (props: PopoverContentProps, contentRef: ForwardedRef<HTMLDivElement>) => {\n      const {content, hidden, onMouseEnter, onMouseLeave} = props\n      const hasResults = hits && hits.length > 0\n      return (\n        <Popover\n          constrainSize\n          content={\n            <div ref={contentRef}>\n              {hasResults\n                ? content\n                : searchState.terms.query && (\n                    <Box padding={4}>\n                      <Flex align=\"center\" height=\"fill\" justify=\"center\">\n                        <StyledText align=\"center\" muted>\n                          <Translate\n                            t={t}\n                            i18nKey=\"new-document.no-results\"\n                            values={{searchQuery: searchState.terms.query}}\n                          />\n                        </StyledText>\n                      </Flex>\n                    </Box>\n                  )}\n            </div>\n          }\n          fallbackPlacements={['bottom', 'bottom-end']}\n          matchReferenceWidth\n          onMouseEnter={onMouseEnter}\n          onMouseLeave={onMouseLeave}\n          open={!searchState.loading && !hidden}\n          overflow=\"auto\"\n          placement=\"bottom-start\"\n          radius={POPOVER_RADIUS}\n          referenceElement={autocompletePopoverReferenceElementRef.current}\n        />\n      )\n    },\n    [hits, searchState.loading, searchState.terms.query, t],\n  )\n\n  return (\n    <div ref={autocompletePopoverReferenceElementRef}>\n      <Autocomplete\n        aria-label={placeholderText}\n        filterOption={NO_FILTER}\n        fontSize={fullscreen ? 2 : 1}\n        id={autocompleteId}\n        loading={searchState.loading}\n        openButton={{onClick: handleAutocompleteOpenButtonClick}}\n        options={hits}\n        onQueryChange={handleQueryChange}\n        onSelect={handleSelect}\n        placeholder={placeholderText}\n        radius={2}\n        ref={ref}\n        renderOption={renderOption}\n        renderPopover={renderPopover}\n        value={value?._ref}\n      />\n    </div>\n  )\n})\n","import {\n  isArraySchemaType,\n  isReferenceSchemaType,\n  type ReferenceValue,\n  type SchemaType,\n} from '@sanity/types'\nimport {Box, Card, Stack} from '@sanity/ui'\nimport {useCallback, useMemo} from 'react'\n\nimport {Button} from '../../../../../../../../../../ui-components'\nimport {useSchema} from '../../../../../../../../../hooks'\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {getSchemaField} from '../../../../../utils/getSchemaField'\nimport {SearchResultItem} from '../../../../searchResults/item/SearchResultItem'\nimport {ReferenceAutocomplete} from './ReferenceAutocomplete'\n\nexport function SearchFilterReferenceInput({\n  fieldDefinition,\n  onChange,\n  value,\n}: OperatorInputComponentProps<ReferenceValue>) {\n  const {\n    onClose,\n    state: {documentTypesNarrowed},\n  } = useSearchState()\n  const schema = useSchema()\n  const {t} = useTranslation()\n\n  const handleChange = useCallback(\n    (referenceValue: ReferenceValue | null) => onChange(referenceValue),\n    [onChange],\n  )\n\n  // Extract all searchable types\n  const searchableTypes = useMemo(() => {\n    if (!fieldDefinition) {\n      return []\n    }\n\n    return fieldDefinition.documentTypes\n      .filter((d) => documentTypesNarrowed.includes(d))\n      .flatMap((type) => {\n        const schemaType = schema.get(type)\n        if (schemaType) {\n          const field = getSchemaField(schemaType, fieldDefinition.fieldPath)\n          if (isArraySchemaType(field?.type)) {\n            return field?.type.of.filter(isReferenceSchemaType).flatMap((i) => i.to)\n          }\n          if (isReferenceSchemaType(field?.type)) {\n            return field?.type.to\n          }\n        }\n        return []\n      })\n      .reduce<SchemaType[]>((acc, val) => {\n        if (acc.findIndex((v) => v.name === val?.name) < 0) {\n          acc.push(val as SchemaType)\n        }\n        return acc\n      }, [])\n  }, [documentTypesNarrowed, fieldDefinition, schema])\n\n  const handleClear = useCallback(() => handleChange(null), [handleChange])\n\n  const handleClick = useCallback(() => {\n    onClose?.()\n  }, [onClose])\n\n  return (\n    <Box style={{width: 'min(calc(100vw - 40px), 420px)'}}>\n      {value?._ref && value?._type ? (\n        <Stack space={3}>\n          <Card padding={1} radius={1} shadow={1}>\n            <SearchResultItem\n              documentId={value._ref}\n              documentType={value._type}\n              layout=\"compact\"\n              onClick={handleClick}\n            />\n          </Card>\n          <Button\n            mode=\"ghost\"\n            onClick={handleClear}\n            text={t('search.filter-reference-clear')}\n            tone=\"critical\"\n          />\n        </Stack>\n      ) : (\n        <ReferenceAutocomplete onSelect={handleChange} types={searchableTypes} value={value} />\n      )}\n    </Box>\n  )\n}\n","import {ChevronDownIcon} from '@sanity/icons'\nimport {isTitledListValue, type StringOptions, type TitledListValue} from '@sanity/types'\nimport {Menu} from '@sanity/ui'\nimport {capitalize, uniq} from 'lodash'\nimport {useCallback, useId, useMemo} from 'react'\n\nimport {Button, MenuButton, MenuItem} from '../../../../../../../../../../ui-components'\nimport {useSchema} from '../../../../../../../../../hooks'\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {isNonNullable} from '../../../../../../../../../util'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {getSchemaField} from '../../../../../utils/getSchemaField'\n\ninterface TitledListValueGroup extends Omit<TitledListValue<number | string>, 'title'> {\n  title: (number | string)[]\n}\n\nfunction CustomMenuItem({\n  onClick,\n  selected,\n  title,\n  value,\n}: {\n  onClick: (value: number | string) => void\n  selected: boolean\n  title: string\n  value: number | string\n}) {\n  const handleClick = useCallback(() => onClick(value), [onClick, value])\n\n  let menuItemText = `${title}`\n  if (typeof value !== 'undefined' && title !== value) {\n    menuItemText += ` (${value})`\n  }\n\n  return <MenuItem onClick={handleClick} pressed={selected} tone=\"default\" text={menuItemText} />\n}\n\nexport function SearchFilterStringListInput({\n  fieldDefinition,\n  onChange,\n  value,\n}: OperatorInputComponentProps<number | string>) {\n  const menuButtonId = useId()\n\n  const {\n    state: {documentTypesNarrowed},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const schema = useSchema()\n\n  // Build list items\n  const items = useMemo(() => {\n    if (!fieldDefinition) {\n      return []\n    }\n\n    const options = fieldDefinition.documentTypes\n      .filter((d) => documentTypesNarrowed.includes(d))\n      .map((type) => {\n        const schemaType = schema.get(type)\n        if (schemaType) {\n          const field = getSchemaField(schemaType, fieldDefinition.fieldPath)\n          return field?.type.options as StringOptions\n        }\n        return null\n      })\n      .filter(isNonNullable)\n\n    const selectOptions = options\n      .map((o) => o.list)\n      .flatMap((list) => list?.map((l) => toSelectItem(l)))\n      .filter(isNonNullable)\n\n    return selectOptions.reduce<TitledListValueGroup[]>((acc, val) => {\n      const prevIndex = acc.findIndex((v) => v.value === val?.value)\n      if (prevIndex > -1) {\n        const prevValue = acc[prevIndex]\n        acc[prevIndex] = {\n          ...acc[prevIndex],\n          title: uniq([...prevValue.title, val.title]).sort(),\n        }\n      } else {\n        acc.push({\n          ...val,\n          title: [val.title],\n        })\n      }\n      return acc\n    }, [])\n  }, [documentTypesNarrowed, fieldDefinition, schema])\n\n  const handleClick = useCallback(\n    (v: number | string) => {\n      onChange(v)\n    },\n    [onChange],\n  )\n\n  return (\n    <MenuButton\n      button={\n        <Button\n          mode=\"ghost\"\n          iconRight={ChevronDownIcon}\n          text={value ? String(value) : t('search.filter-string-value-select-predefined-value')}\n        />\n      }\n      id={menuButtonId || ''}\n      menu={\n        <Menu>\n          {items.map((item, index) => (\n            <CustomMenuItem\n              // eslint-disable-next-line react/no-array-index-key\n              key={index}\n              onClick={handleClick}\n              selected={item.value === value}\n              title={item.title.join(', ')}\n              value={item.value || ''}\n            />\n          ))}\n        </Menu>\n      }\n      popover={{\n        constrainSize: true,\n        placement: 'bottom-start',\n        portal: false,\n        radius: 2,\n      }}\n    />\n  )\n}\n\nfunction toSelectItem(\n  option: TitledListValue<string | number> | string | number,\n): TitledListValue<string | number> {\n  return isTitledListValue(option) ? option : {title: capitalize(`${option}`), value: option}\n}\n","export const GteIcon = () => (\n  <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n      d=\"M7.04 19V17.512H17.36V19H7.04ZM7.04 15.328V13.624L12.08 11.872L15.32 10.816V10.72L12.08 9.664L7.04 7.912V6.208L17.36 9.88V11.656L7.04 15.328Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n)\n","export const GtIcon = () => (\n  <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n      d=\"M7.568 18.848V16.952L14.792 12.08V11.984L7.568 7.112V5.216L16.52 11.288V12.776L7.568 18.848Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n)\n","export const LteIcon = () => (\n  <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n      d=\"M7.04 19V17.512H17.36V19H7.04ZM17.36 15.328L7.04 11.656V9.88L17.36 6.208V7.912L12.32 9.664L9.08 10.72V10.816L12.32 11.872L17.36 13.624V15.328Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n)\n","export const LtIcon = () => (\n  <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n      d=\"M16.952 19.632L8 13.56V12.072L16.952 6V7.896L9.728 12.768V12.864L16.952 17.736V19.632Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n)\n","import {type ComponentType} from 'react'\n\nimport {type LocaleSource} from '../../../../../../i18n'\nimport {type SearchFieldDefinition} from '../fields'\n\n/**\n * @alpha\n */\nexport type I18nSearchOperatorNameKey = `search.operator.${Lowercase<string>}.name`\n\n/**\n * @alpha\n */\nexport type I18nSearchOperatorDescriptionKey = `search.operator.${Lowercase<string>}.description`\n\n/**\n * @alpha\n */\nexport interface SearchOperatorBase {\n  /** i18n resource key for the \"name\", eg `quantity is` or `contains` */\n  nameKey: I18nSearchOperatorNameKey\n\n  /** i18n resource key for the \"name\", eg `quantity is` or `contains` */\n  descriptionKey: I18nSearchOperatorDescriptionKey\n\n  /** icon for explaining the operator (React component) */\n  icon?: ComponentType\n\n  /** name/type of operator, eg `arrayCountEqual` or `numberGt` */\n  type: string\n}\n\n/**\n * @alpha\n */\nexport type SearchOperatorInput<TValue> = ComponentType<OperatorInputComponentProps<TValue>>\n\n/**\n * @alpha\n */\nexport type SearchOperatorButtonValue<TValue> = ComponentType<\n  OperatorButtonValueComponentProps<TValue>\n>\n\n/**\n * @alpha\n */\nexport interface OperatorButtonValueComponentProps<T> {\n  value: T\n}\n\n/**\n * @alpha\n */\nexport interface OperatorInputComponentProps<T> {\n  fieldDefinition?: SearchFieldDefinition\n  onChange: (value: T | null) => void\n  value: T | null\n}\n\n/**\n * @alpha\n */\nexport type SearchOperatorParams<TValue> = {fieldPath?: string; value?: TValue}\n\n/**\n * @alpha\n */\nexport type ValuelessSearchOperatorParams = {fieldPath?: string}\n\n/**\n * @alpha\n */\nexport type SearchValueFormatterContext = {\n  i18n: LocaleSource\n}\n\n/**\n * @alpha\n */\nexport interface SearchOperatorBuilder<TType extends string, TValue> extends SearchOperatorBase {\n  buttonValueComponent?: SearchOperatorButtonValue<TValue>\n  groqFilter: (params: SearchOperatorParams<TValue>) => string | null\n  initialValue: TValue | null\n  inputComponent: SearchOperatorInput<TValue>\n  type: TType\n}\n\n/**\n * @alpha\n */\nexport interface ValuelessSearchOperatorBuilder<TType extends string> extends SearchOperatorBase {\n  buttonValueComponent?: never\n  groqFilter: (params: ValuelessSearchOperatorParams) => string | null\n  initialValue?: never\n  inputComponent?: never\n  type: TType\n}\n\n/**\n * @alpha\n */\nexport function defineSearchOperator<\n  TType extends string,\n  TValue extends unknown | never,\n  TOperatorSnippet extends\n    | {type: TType; inputComponent?: never}\n    | {type: TType; inputComponent: SearchOperatorInput<TValue>},\n>(\n  definition: (TOperatorSnippet extends {\n    type: TType\n    inputComponent: SearchOperatorInput<TValue>\n  }\n    ? SearchOperatorBuilder<TType, TValue>\n    : ValuelessSearchOperatorBuilder<TType>) &\n    TOperatorSnippet,\n): typeof definition {\n  return definition\n}\n","export function toJSON(val: unknown): string {\n  return JSON.stringify(val)\n}\n","import {type ReferenceValue} from '@sanity/types'\n\nimport {SearchButtonValueReference} from '../../components/filters/common/ButtonValue'\nimport {SearchFilterNumberInput} from '../../components/filters/filter/inputs/number/Number'\nimport {SearchFilterNumberRangeInput} from '../../components/filters/filter/inputs/number/NumberRange'\nimport {SearchFilterReferenceInput} from '../../components/filters/filter/inputs/reference/Reference'\nimport {SearchFilterStringListInput} from '../../components/filters/filter/inputs/string/StringList'\nimport {GteIcon} from '../../components/filters/icons/GteIcon'\nimport {GtIcon} from '../../components/filters/icons/GtIcon'\nimport {LteIcon} from '../../components/filters/icons/LteIcon'\nimport {LtIcon} from '../../components/filters/icons/LtIcon'\nimport {type OperatorNumberRangeValue} from './common'\nimport {\n  defineSearchOperator,\n  type SearchOperatorButtonValue,\n  type SearchOperatorInput,\n} from './operatorTypes'\nimport {toJSON} from './operatorUtils'\n\n// @todo: don't manually cast `buttonValueComponent` and `inputComponent` once\n// we understand why `npm run etl` fails with 'Unable to follow symbol' errors\nexport const arrayOperators = {\n  arrayCountEqual: defineSearchOperator({\n    nameKey: 'search.operator.array-count-equal.name',\n    descriptionKey: 'search.operator.array-count-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `count(${fieldPath}) == ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'arrayCountEqual',\n  }),\n  arrayCountGt: defineSearchOperator({\n    nameKey: 'search.operator.array-count-gt.name',\n    descriptionKey: 'search.operator.array-count-gt.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `count(${fieldPath}) > ${toJSON(value)}` : null,\n    icon: GtIcon,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'arrayCountGt',\n  }),\n  arrayCountGte: defineSearchOperator({\n    nameKey: 'search.operator.array-count-gte.name',\n    descriptionKey: 'search.operator.array-count-gte.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `count(${fieldPath}) >= ${toJSON(value)}` : null,\n    icon: GteIcon,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'arrayCountGte',\n  }),\n  arrayCountLt: defineSearchOperator({\n    nameKey: 'search.operator.array-count-lt.name',\n    descriptionKey: 'search.operator.array-count-lt.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `count(${fieldPath}) < ${toJSON(value)}` : null,\n    icon: LtIcon,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'arrayCountLt',\n  }),\n  arrayCountLte: defineSearchOperator({\n    nameKey: 'search.operator.array-count-lte.name',\n    descriptionKey: 'search.operator.array-count-lte.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `count(${fieldPath}) <= ${toJSON(value)}` : null,\n    icon: LteIcon,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'arrayCountLte',\n  }),\n  arrayCountNotEqual: defineSearchOperator({\n    nameKey: 'search.operator.array-count-not-equal.name',\n    descriptionKey: 'search.operator.array-count-not-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `count(${fieldPath}) != ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'arrayCountNotEqual',\n  }),\n  arrayCountRange: defineSearchOperator({\n    nameKey: 'search.operator.array-count-range.name',\n    descriptionKey: 'search.operator.array-count-range.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value?.to) && Number.isFinite(value?.from) && fieldPath\n        ? `count(${fieldPath}) > ${toJSON(value?.from)} && count(${fieldPath}) < ${toJSON(\n            value?.to,\n          )}`\n        : '',\n    initialValue: null,\n    inputComponent: SearchFilterNumberRangeInput as SearchOperatorInput<OperatorNumberRangeValue>,\n    type: 'arrayCountRange',\n  }),\n  arrayListIncludes: defineSearchOperator({\n    nameKey: 'search.operator.array-list-includes.name',\n    descriptionKey: 'search.operator.array-list-includes.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `${toJSON(value)} in ${fieldPath}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringListInput as SearchOperatorInput<string | number>,\n    type: 'arrayListIncludes',\n  }),\n  arrayListNotIncludes: defineSearchOperator({\n    nameKey: 'search.operator.array-list-not-includes.name',\n    descriptionKey: 'search.operator.array-list-not-includes.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `!(${toJSON(value)} in ${fieldPath})` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringListInput as SearchOperatorInput<string | number>,\n    type: 'arrayListNotIncludes',\n  }),\n  arrayReferenceIncludes: defineSearchOperator({\n    nameKey: 'search.operator.array-reference-includes.name',\n    descriptionKey: 'search.operator.array-reference-includes.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({fieldPath, value}) =>\n      value?._ref && fieldPath ? `${toJSON(value._ref)} in ${fieldPath}[]._ref` : null,\n    initialValue: null,\n    inputComponent: SearchFilterReferenceInput as SearchOperatorInput<ReferenceValue>,\n    type: 'arrayReferenceIncludes',\n  }),\n  arrayReferenceNotIncludes: defineSearchOperator({\n    nameKey: 'search.operator.array-reference-not-includes.name',\n    descriptionKey: 'search.operator.array-reference-not-includes.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({fieldPath, value}) =>\n      value?._ref && fieldPath ? `!(${toJSON(value._ref)} in ${fieldPath}[]._ref)` : null,\n    initialValue: null,\n    inputComponent: SearchFilterReferenceInput as SearchOperatorInput<ReferenceValue>,\n    type: 'arrayReferenceNotIncludes',\n  }),\n}\n","import {createContext, type ReactNode, useContext} from 'react'\n\nimport {type Source} from '../config'\nimport {useWorkspace} from './workspace'\n\n/** @internal */\nexport type SourceProviderProps =\n  | {source: Source; children?: ReactNode}\n  | {name: string; children?: ReactNode}\n\nconst SourceContext = createContext<Source | null>(null)\n\n/** @internal */\nexport function SourceProvider({children, ...props}: SourceProviderProps) {\n  const parentSource = useContext(SourceContext)\n  const {unstable_sources: sources} = useWorkspace()\n\n  if ('source' in props) {\n    const {source} = props\n    return <SourceContext.Provider value={source}>{children}</SourceContext.Provider>\n  }\n\n  if ('name' in props) {\n    const {name} = props\n    const source = sources.find((s) => s.name === name)\n    if (!source) {\n      throw new Error(`Could not find source with name \\`${name}\\` in current workspace`)\n    }\n    if (parentSource === source) return <>{children}</>\n\n    return <SourceContext.Provider value={source}>{children}</SourceContext.Provider>\n  }\n\n  throw new Error(\n    'Invalid props passed into SourceProvider. A `name` or a `source` object is required.',\n  )\n}\n\n/**\n * @internal\n * @deprecated INTERNAL USE ONLY\n */\nexport function useSource(): Source {\n  const source = useContext(SourceContext)\n  if (!source) throw new Error('Could not find `source` context')\n  return source\n}\n","import {WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Flex, type ResponsivePaddingProps, Stack} from '@sanity/ui'\n\nimport {TextWithTone} from '../../../../../../../../../components'\nimport {useTranslation} from '../../../../../../../../../i18n'\n\nexport function AssetSourceError(props: ResponsivePaddingProps) {\n  const {t} = useTranslation()\n\n  return (\n    <Box {...props}>\n      <Flex align=\"flex-start\" gap={3}>\n        <TextWithTone tone=\"caution\">\n          <WarningOutlineIcon />\n        </TextWithTone>\n        <Stack space={4}>\n          <TextWithTone size={1} tone=\"caution\" weight=\"medium\">\n            {t('search.error.no-valid-asset-source-title')}\n          </TextWithTone>\n          <TextWithTone size={1} tone=\"caution\">\n            {t('search.error.no-valid-asset-source-only-default-description')}\n          </TextWithTone>\n          <TextWithTone size={1} tone=\"caution\">\n            {t('search.error.no-valid-asset-source-check-config-description')}\n          </TextWithTone>\n        </Stack>\n      </Flex>\n    </Box>\n  )\n}\n","import {BinaryDocumentIcon} from '@sanity/icons'\nimport {type FileAsset, type ReferenceValue} from '@sanity/types'\nimport {Card, Flex, Stack, Text, TextSkeleton} from '@sanity/ui'\nimport {useCallback} from 'react'\n\nimport {formatBytes} from '../../../../../../../../../../form/inputs/common/helper'\nimport {observeFileAsset} from '../../../../../../../../../../form/studio/inputs/client-adapters/assets'\nimport {WithReferencedAsset} from '../../../../../../../../../../form/utils/WithReferencedAsset'\nimport {useDocumentPreviewStore} from '../../../../../../../../../../store'\n\ninterface FileReferencePreviewProps {\n  reference: ReferenceValue\n}\n\nexport function FileReferencePreview({reference}: FileReferencePreviewProps) {\n  const documentPreviewStore = useDocumentPreviewStore()\n  const observeAsset = useCallback(\n    (id: string) => observeFileAsset(documentPreviewStore, id),\n    [documentPreviewStore],\n  )\n  return (\n    <WithReferencedAsset\n      observeAsset={observeAsset}\n      reference={reference}\n      waitPlaceholder={<FileSkeleton />}\n    >\n      {(asset) => <FilePreview asset={asset} />}\n    </WithReferencedAsset>\n  )\n}\n\nfunction FilePreview({asset}: {asset: FileAsset}) {\n  // todo: consider replacing with <SanityDefaultPreview>\n  return (\n    <Card padding={2} shadow={1}>\n      <Flex align=\"center\" justify=\"space-between\" wrap=\"nowrap\">\n        <Card padding={3} radius={1} shadow={1} tone=\"transparent\">\n          <Text>\n            <BinaryDocumentIcon />\n          </Text>\n        </Card>\n        <Stack flex={1} space={2} marginLeft={3}>\n          <Text muted size={1} textOverflow=\"ellipsis\" weight=\"medium\">\n            {asset?.originalFilename || asset._id}\n          </Text>\n          <Text size={1} muted>\n            {formatBytes(asset.size)}\n          </Text>\n        </Stack>\n      </Flex>\n    </Card>\n  )\n}\n\nfunction FileSkeleton() {\n  return (\n    <Card padding={2} shadow={1}>\n      <Flex align=\"center\" justify=\"flex-start\">\n        <Card padding={3} radius={1} shadow={1} tone=\"transparent\">\n          <Text>\n            <BinaryDocumentIcon />\n          </Text>\n        </Card>\n        <Stack flex={1} space={2} marginLeft={3}>\n          <TextSkeleton animated style={{width: '100%'}} radius={1} />\n          <TextSkeleton animated style={{width: '100%'}} radius={1} />\n        </Stack>\n      </Flex>\n    </Card>\n  )\n}\n","import {type ImageAsset, type ReferenceValue} from '@sanity/types'\nimport {Card} from '@sanity/ui'\nimport {useCallback, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {LoadingBlock} from '../../../../../../../../../../components/loadingBlock'\nimport {observeImageAsset} from '../../../../../../../../../../form/studio/inputs/client-adapters/assets'\nimport {WithReferencedAsset} from '../../../../../../../../../../form/utils/WithReferencedAsset'\nimport {useDocumentPreviewStore} from '../../../../../../../../../../store'\n\ninterface ImageReferencePreviewProps {\n  reference: ReferenceValue\n}\n\nconst Container = styled(Card)`\n  position: relative;\n  padding-bottom: 100%;\n`\n\nconst Image = styled.img`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: block;\n  object-fit: contain;\n`\n\nexport function ImageReferencePreview({reference}: ImageReferencePreviewProps) {\n  const documentPreviewStore = useDocumentPreviewStore()\n  const observeAsset = useCallback(\n    (id: string) => observeImageAsset(documentPreviewStore, id),\n    [documentPreviewStore],\n  )\n  return (\n    <WithReferencedAsset observeAsset={observeAsset} reference={reference}>\n      {(asset) => <ImagePreview asset={asset} />}\n    </WithReferencedAsset>\n  )\n}\n\nfunction ImagePreview({asset}: {asset: ImageAsset}) {\n  const [loaded, setLoaded] = useState(false)\n  const imageUrl = `${asset.url}?h=800&fit=max`\n  const handleLoad = useCallback(() => setLoaded(true), [])\n\n  return (\n    <Container __unstable_checkered border>\n      {!loaded && <LoadingBlock fill showText />}\n      <Image onLoad={handleLoad} src={imageUrl} />\n    </Container>\n  )\n}\n","import {type ReferenceValue} from '@sanity/types'\n\nimport {FileReferencePreview} from './FileReferencePreview'\nimport {ImageReferencePreview} from './ImageReferencePreview'\n\ninterface AssetPreviewProps {\n  reference: ReferenceValue\n}\nexport function AssetPreview({reference}: AssetPreviewProps) {\n  if (!reference) {\n    return null\n  }\n  if (reference._type.startsWith('sanity.fileAsset')) {\n    return <FileReferencePreview reference={reference} />\n  }\n  if (reference._type.startsWith('sanity.imageAsset')) {\n    return <ImageReferencePreview reference={reference} />\n  }\n  return null\n}\n","import {ChevronDownIcon, ImageIcon, SearchIcon, UndoIcon} from '@sanity/icons'\nimport {type AssetFromSource, type AssetSource, type ReferenceValue} from '@sanity/types'\nimport {Box, Flex, Menu, Portal, Stack} from '@sanity/ui'\nimport {get, startCase} from 'lodash'\nimport {useCallback, useEffect, useId, useMemo, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {Button, MenuButton, MenuItem} from '../../../../../../../../../../ui-components'\nimport {type Source} from '../../../../../../../../../config'\nimport {FileSource, ImageSource} from '../../../../../../../../../form/studio/assetSource'\nimport {useClient} from '../../../../../../../../../hooks'\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../../../../../../studioClient'\nimport {useSource} from '../../../../../../../../source'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {AssetSourceError} from './AssetSourceError'\nimport {AssetPreview} from './preview/AssetPreview'\n\ntype AssetType = keyof Pick<Source['form'], 'file' | 'image'>\n\nconst ASSET_TYPE: Record<AssetType, string> = {\n  file: 'sanity.fileAsset',\n  image: 'sanity.imageAsset',\n}\n\nconst ContainerBox = styled(Box)`\n  width: min(calc(100vw - 40px), 320px);\n`\n\nexport function SearchFilterAssetInput(type?: AssetType) {\n  return function FieldInputAssetWithType({\n    onChange,\n    value,\n  }: OperatorInputComponentProps<ReferenceValue>) {\n    const [selectedAssetSource, setSelectedAssetSource] = useState<AssetSource | null>(null)\n    const [selectedAssetFromSource, setSelectedAssetFromSource] = useState<AssetFromSource | null>(\n      null,\n    )\n\n    const {\n      state: {fullscreen},\n    } = useSearchState()\n\n    const {file, image} = useSource().form\n    const {t} = useTranslation()\n\n    // Get available asset sources\n    // NOTE: currently only the default studio asset source is supported\n    const assetSources = useMemo(() => {\n      switch (type) {\n        case 'file':\n          return file.assetSources.filter((a) => a.name === FileSource.name)\n        case 'image':\n          return image.assetSources.filter((a) => a.name === ImageSource.name)\n        default:\n          throw Error('Unknown asset source found')\n      }\n    }, [file.assetSources, image.assetSources])\n\n    const menuButtonId = useId()\n\n    const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n\n    const handleClear = useCallback(() => {\n      setSelectedAssetFromSource(null)\n      onChange(null)\n    }, [onChange])\n\n    const handleCloseAssetSource = useCallback(() => {\n      setSelectedAssetSource(null)\n    }, [])\n\n    const handleSelectAssetFromSource = useCallback(\n      (assetFromSource: AssetFromSource[]) => {\n        const firstAsset = assetFromSource[0]\n        setSelectedAssetFromSource(firstAsset)\n        handleCloseAssetSource()\n      },\n      [handleCloseAssetSource],\n    )\n\n    const handleSelectAssetSource = useCallback(\n      (source: AssetSource) => setSelectedAssetSource(source),\n      [],\n    )\n\n    useEffect(() => {\n      // TODO: add custom resolver to handle other source types in future\n      if (\n        selectedAssetFromSource?.kind === 'assetDocumentId' &&\n        typeof selectedAssetFromSource?.value === 'string'\n      ) {\n        if (type) {\n          onChange({\n            _ref: selectedAssetFromSource.value,\n            _type: ASSET_TYPE[type],\n          })\n        }\n      }\n    }, [client, onChange, selectedAssetFromSource])\n\n    const AssetSourceComponent = selectedAssetSource?.component\n\n    const fontSize = fullscreen ? 2 : 1\n\n    const buttonText = t(value ? 'search.filter-asset-change' : 'search.filter-asset-select', {\n      context: type,\n    })\n\n    const accept = get(type, 'options.accept', type === 'image' ? 'image/*' : '')\n\n    return (\n      <ContainerBox>\n        <Stack space={3}>\n          {/* Asset source component */}\n          {selectedAssetSource && AssetSourceComponent && (\n            <Portal>\n              <AssetSourceComponent\n                assetType={type}\n                dialogHeaderTitle={t('search.action.select-asset', {context: type})}\n                onClose={handleCloseAssetSource}\n                onSelect={handleSelectAssetFromSource}\n                selectedAssets={[]}\n                selectionType=\"single\"\n                accept={accept}\n              />\n            </Portal>\n          )}\n\n          {/* Selected asset preview */}\n          {value && <AssetPreview reference={value} />}\n\n          <Flex gap={2}>\n            {/* No asset sources found */}\n            {assetSources.length === 0 && <AssetSourceError padding={2} />}\n\n            {/* Asset source select */}\n            {assetSources.length > 0 && (\n              <>\n                {assetSources.length > 1 ? (\n                  <MenuButton\n                    button={\n                      <Button\n                        icon={value ? UndoIcon : SearchIcon}\n                        iconRight={ChevronDownIcon}\n                        mode=\"ghost\"\n                        width={value ? 'fill' : undefined}\n                        text={buttonText}\n                      />\n                    }\n                    id={menuButtonId}\n                    menu={\n                      <Menu>\n                        {assetSources.map((source) => (\n                          <MenuItem\n                            icon={source.icon || ImageIcon}\n                            key={source.name}\n                            // eslint-disable-next-line react/jsx-no-bind\n                            onClick={() => handleSelectAssetSource(source)}\n                            text={\n                              (source.i18nKey ? t(source.i18nKey) : source.title) ||\n                              startCase(source.name)\n                            }\n                          />\n                        ))}\n                      </Menu>\n                    }\n                    popover={{\n                      constrainSize: true,\n                      portal: false,\n                      radius: 2,\n                    }}\n                  />\n                ) : (\n                  <Button\n                    icon={value ? UndoIcon : SearchIcon}\n                    mode=\"ghost\"\n                    // eslint-disable-next-line react/jsx-no-bind\n                    onClick={() => handleSelectAssetSource(assetSources[0])}\n                    width={value ? 'fill' : undefined}\n                    text={buttonText}\n                  />\n                )}\n              </>\n            )}\n\n            {/* Clear selected asset */}\n            {value && (\n              <Button\n                mode=\"ghost\"\n                onClick={handleClear}\n                width=\"fill\"\n                text={t('search.filter-asset-clear')}\n                tone=\"critical\"\n              />\n            )}\n          </Flex>\n        </Stack>\n      </ContainerBox>\n    )\n  }\n}\n","import {type ReferenceValue} from '@sanity/types'\n\nimport {SearchButtonValueReference} from '../../components/filters/common/ButtonValue'\nimport {SearchFilterAssetInput} from '../../components/filters/filter/inputs/asset/Asset'\nimport {defineSearchOperator, type SearchOperatorButtonValue} from './operatorTypes'\nimport {toJSON} from './operatorUtils'\n\n// @todo: don't manually cast `buttonValueComponent` and `inputComponent` once\n// we understand why `npm run etl` fails with 'Unable to follow symbol' errors\nexport const assetOperators = {\n  assetFileEqual: defineSearchOperator({\n    nameKey: 'search.operator.asset-file-equal.name',\n    descriptionKey: 'search.operator.asset-file-equal.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({fieldPath, value}) =>\n      value?._ref && fieldPath ? `${fieldPath}.asset._ref == ${toJSON(value._ref)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterAssetInput('file'),\n    label: 'is',\n    type: 'assetFileEqual',\n  }),\n  assetFileNotEqual: defineSearchOperator({\n    nameKey: 'search.operator.asset-file-not-equal.name',\n    descriptionKey: 'search.operator.asset-file-not-equal.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({fieldPath, value}) =>\n      value?._ref && fieldPath ? `${fieldPath}.asset._ref != ${toJSON(value._ref)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterAssetInput('file'),\n    label: 'is not',\n    type: 'assetFileNotEqual',\n  }),\n  assetImageEqual: defineSearchOperator({\n    nameKey: 'search.operator.asset-image-equal.name',\n    descriptionKey: 'search.operator.asset-image-equal.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({fieldPath, value}) =>\n      value?._ref && fieldPath ? `${fieldPath}.asset._ref == ${toJSON(value._ref)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterAssetInput('image'),\n    label: 'is',\n    type: 'assetImageEqual',\n  }),\n  assetImageNotEqual: defineSearchOperator({\n    nameKey: 'search.operator.asset-image-not-equal.name',\n    descriptionKey: 'search.operator.asset-image-not-equal.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({fieldPath, value}) =>\n      value?._ref && fieldPath ? `${fieldPath}.asset._ref != ${toJSON(value._ref)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterAssetInput('image'),\n    label: 'is not',\n    type: 'assetImageNotEqual',\n  }),\n}\n","import {Select} from '@sanity/ui'\nimport {type ChangeEvent, useCallback} from 'react'\n\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\n\nexport function SearchFilterBooleanInput({onChange, value}: OperatorInputComponentProps<boolean>) {\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const handleChange = useCallback(\n    (event: ChangeEvent<HTMLSelectElement>) => {\n      onChange(event.currentTarget.value === 'true')\n    },\n    [onChange],\n  )\n\n  return (\n    <Select\n      fontSize={fullscreen ? 2 : 1}\n      onChange={handleChange}\n      radius={2}\n      value={String(value ?? true)}\n    >\n      <option value=\"true\">{t('search.filter-boolean-true')}</option>\n      <option value=\"false\">{t('search.filter-boolean-false')}</option>\n    </Select>\n  )\n}\n","import {SearchFilterBooleanInput} from '../../components/filters/filter/inputs/boolean/Boolean'\nimport {\n  defineSearchOperator,\n  type SearchOperatorInput,\n  type SearchOperatorParams,\n} from './operatorTypes'\nimport {toJSON} from './operatorUtils'\n\n// @todo: don't manually cast `buttonValueComponent` and `inputComponent` once\n// we understand why `npm run etl` fails with 'Unable to follow symbol' errors\nexport const booleanOperators = {\n  booleanEqual: defineSearchOperator({\n    nameKey: 'search.operator.boolean-equal.name',\n    descriptionKey: 'search.operator.boolean-equal.description',\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<boolean>) =>\n      typeof value !== 'undefined' && fieldPath ? `${fieldPath} == ${toJSON(value)}` : null,\n    initialValue: true,\n    inputComponent: SearchFilterBooleanInput as SearchOperatorInput<boolean>,\n    type: 'booleanEqual',\n  }),\n}\n","import {Flex, Stack, Switch, Text} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../../../../../../../../i18n'\n\ninterface DateIncludeTimeFooterProps {\n  onChange: () => void\n  value: boolean\n}\n\nconst TimeLabelText = styled(Text)`\n  cursor: default;\n`\n\nexport function DateIncludeTimeFooter({onChange, value}: DateIncludeTimeFooterProps) {\n  const {t} = useTranslation()\n  return (\n    <Flex align=\"center\" gap={2} justify=\"flex-end\" marginTop={1}>\n      <Stack>\n        <TimeLabelText muted onClick={onChange} size={1} weight=\"medium\">\n          {t('calendar.action.include-time-label')}\n        </TimeLabelText>\n      </Stack>\n      <Switch checked={value} label={t('calendar.action.include-time-label')} onChange={onChange} />\n    </Flex>\n  )\n}\n","import {createContext} from 'react'\n\nexport interface CalendarContextValue {\n  date?: Date\n  endDate?: Date\n  focusedDate: Date\n  selectRange?: boolean\n  selectTime?: boolean\n\n  /**\n   * An integer indicating the first day of the week.\n   * Can be either 1 (Monday) or 7 (Sunday).\n   */\n  firstWeekDay: 1 | 7\n}\n\nexport const CalendarContext = createContext<CalendarContextValue | undefined>(undefined)\n","import {useContext} from 'react'\n\nimport {CalendarContext, type CalendarContextValue} from './CalendarContext'\n\nexport function useCalendar(): CalendarContextValue {\n  const context = useContext(CalendarContext)\n  if (context === undefined) {\n    throw new Error('useCalendar must be used within an CalendarContext.Provider')\n  }\n  return context\n}\n","import {ChevronLeftIcon, ChevronRightIcon} from '@sanity/icons'\nimport {Flex, Inline, Text} from '@sanity/ui'\nimport {upperFirst} from 'lodash'\nimport {useCallback} from 'react'\n\nimport {Button} from '../../../../../../../../../../../../ui-components'\nimport {useDateTimeFormat} from '../../../../../../../../../../../hooks/useDateTimeFormat'\nimport {useTranslation} from '../../../../../../../../../../../i18n'\nimport {useCalendar} from './contexts/useDatePicker'\n\nexport function CalendarHeader(props: {\n  moveFocusedDate: (by: number) => void\n  onNowClick: () => void\n}) {\n  const {t} = useTranslation()\n  const monthFormatter = useDateTimeFormat({month: 'long', year: 'numeric'})\n  const {focusedDate} = useCalendar()\n\n  const {moveFocusedDate, onNowClick} = props\n\n  const handlePrevMonthClick = useCallback(() => moveFocusedDate(-1), [moveFocusedDate])\n\n  const handleNextMonthClick = useCallback(() => moveFocusedDate(1), [moveFocusedDate])\n\n  return (\n    <Flex align=\"center\" flex={1} justify=\"space-between\">\n      <Inline paddingLeft={2} space={1}>\n        {/* Technically not correct to simply uppercase first here, but simplifying for now */}\n        <Text size={1} weight=\"medium\">\n          {upperFirst(monthFormatter.format(focusedDate))}\n        </Text>\n      </Inline>\n      <Flex align=\"center\">\n        <Button\n          aria-label={t('calendar.action.go-to-today-aria-label')}\n          mode=\"bleed\"\n          onClick={onNowClick}\n          text={t('calendar.action.go-to-today')}\n        />\n        <Button\n          icon={ChevronLeftIcon}\n          mode=\"bleed\"\n          onClick={handlePrevMonthClick}\n          tooltipProps={{content: t('calendar.action.go-to-previous-month')}}\n        />\n        <Button\n          icon={ChevronRightIcon}\n          mode=\"bleed\"\n          onClick={handleNextMonthClick}\n          tooltipProps={{content: t('calendar.action.go-to-next-month')}}\n        />\n      </Flex>\n    </Flex>\n  )\n}\n","import {Card, Text, type Theme} from '@sanity/ui'\nimport {isAfter, isBefore, isSameDay, isSameMonth} from 'date-fns'\nimport {useCallback} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {useCalendar} from './contexts/useDatePicker'\n\ninterface CalendarDayProps {\n  date: Date\n  onSelect: (date: Date) => void\n}\n\nconst CircleSvg = styled.svg(({theme}: {theme: Theme}) => {\n  return css`\n    bottom: 0;\n    left: 0;\n    position: absolute;\n    right: 0;\n    top: 0;\n\n    circle {\n      stroke: ${theme.sanity.color.card.enabled.border};\n      stroke-width: 3;\n      fill: none;\n    }\n  `\n})\n\nconst CustomCard = styled(Card)`\n  position: relative;\n\n  &[data-focused='true'] {\n    z-index: 1;\n  }\n\n  &[data-start-date='true'] {\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n  }\n\n  &[data-end-date='true'] {\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n  }\n\n  &[data-within-range='true'] {\n    border-radius: 0;\n  }\n`\n\nexport function CalendarDay({date, onSelect}: CalendarDayProps) {\n  const handleClick = useCallback(() => {\n    onSelect(date)\n  }, [date, onSelect])\n\n  const {date: selectedDate, endDate: selectedEndDate, focusedDate, selectRange} = useCalendar()\n\n  const isSelected = selectedDate && isSameDay(date, selectedDate)\n  const isStartDate = selectRange && selectedDate && isSameDay(date, selectedDate)\n  const isEndDate = selectRange && selectedEndDate && isSameDay(date, selectedEndDate)\n\n  const isCurrentMonth = isSameMonth(date, focusedDate)\n  const isFocused = focusedDate && isSameDay(date, focusedDate)\n  const isToday = isSameDay(date, new Date())\n\n  const isWithinRange =\n    selectedDate &&\n    selectedEndDate &&\n    !isStartDate &&\n    !isEndDate &&\n    isAfter(date, selectedDate) &&\n    isBefore(date, selectedEndDate)\n\n  return (\n    <CustomCard\n      __unstable_focusRing\n      aria-label={date.toDateString()}\n      aria-pressed={isSelected}\n      data-end-date={isEndDate ? true : undefined}\n      data-focused={isFocused ? 'true' : ''}\n      data-ui=\"CalendarDay\"\n      aria-selected={isSelected}\n      data-start-date={isStartDate ? true : undefined}\n      data-within-range={isWithinRange ? true : undefined}\n      forwardedAs=\"button\"\n      onClick={handleClick}\n      paddingX={3}\n      paddingY={2}\n      radius={2}\n      role=\"button\"\n      selected={isSelected || isStartDate || isEndDate}\n      tabIndex={-1}\n      tone={isWithinRange ? 'primary' : 'default'}\n    >\n      {isToday && (\n        <CircleSvg\n          height=\"100%\"\n          preserveAspectRatio=\"xMidYMid meet\"\n          vectorEffect=\"non-scaling-stroke\"\n          viewBox=\"0 0 100 100\"\n          width=\"100%\"\n        >\n          <circle cx=\"50\" cy=\"50\" r=\"40%\" />\n        </CircleSvg>\n      )}\n      <Text\n        align=\"center\"\n        muted={!isSelected && !isCurrentMonth}\n        size={1}\n        weight={isCurrentMonth ? 'medium' : 'regular'}\n      >\n        {date.getDate()}\n      </Text>\n    </CustomCard>\n  )\n}\n","import {range} from 'lodash'\n\nimport {type StudioLocaleResourceKeys} from '../../../../../../../../../../../i18n'\n\nexport const MONTH_NAME_KEYS: StudioLocaleResourceKeys[] = [\n  'calendar.month-names.january',\n  'calendar.month-names.february',\n  'calendar.month-names.march',\n  'calendar.month-names.april',\n  'calendar.month-names.may',\n  'calendar.month-names.june',\n  'calendar.month-names.july',\n  'calendar.month-names.august',\n  'calendar.month-names.september',\n  'calendar.month-names.october',\n  'calendar.month-names.november',\n  'calendar.month-names.december',\n]\n\nexport const SHORT_WEEK_DAY_KEYS: StudioLocaleResourceKeys[] = [\n  'calendar.weekday-names.short.monday',\n  'calendar.weekday-names.short.tuesday',\n  'calendar.weekday-names.short.wednesday',\n  'calendar.weekday-names.short.thursday',\n  'calendar.weekday-names.short.friday',\n  'calendar.weekday-names.short.saturday',\n  'calendar.weekday-names.short.sunday',\n]\n\nexport const HOURS_24 = range(0, 24)\n\nexport const ARROW_KEYS = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight']\n\n// all weekdays except first\nexport const TAIL_WEEKDAYS = [1, 2, 3, 4, 5, 6]\n","import {addDays, eachWeekOfInterval, getWeek, lastDayOfMonth, startOfMonth} from 'date-fns'\n\nimport {useCurrentLocale} from '../../../../../../../../../../../i18n/hooks/useLocale'\nimport {TAIL_WEEKDAYS} from './constants'\n\n/**\n * NOTE: `weekStartsOn` uses 1 for Monday, 7 for Sunday. date-fns wants 0 for Sunday, 6 for Saturday.\n */\nconst getWeekStartsOfMonth = (date: Date, weekStartsOn: 1 | 2 | 3 | 4 | 5 | 6 | 7): Date[] => {\n  const firstDay = startOfMonth(date)\n  return eachWeekOfInterval(\n    {\n      start: firstDay,\n      end: lastDayOfMonth(firstDay),\n    },\n    {\n      weekStartsOn: weekStartsOn === 7 ? 0 : weekStartsOn,\n    },\n  )\n}\n\nconst getWeekDaysFromWeekStarts = (weekStarts: Date[]): Date[][] => {\n  return weekStarts.map((weekStart) => [\n    weekStart,\n    ...TAIL_WEEKDAYS.map((d) => addDays(weekStart, d)),\n  ])\n}\n\ntype Week = {\n  number: number\n  days: Date[]\n}\n\nexport const useWeeksOfMonth = (date: Date): Week[] => {\n  const {weekInfo} = useCurrentLocale()\n  return getWeekDaysFromWeekStarts(getWeekStartsOfMonth(date, weekInfo.firstDay)).map(\n    (days): Week => ({\n      number: getWeek(days[0]),\n      days,\n    }),\n  )\n}\n\nexport const formatTime = (hours: number, minutes: number): string =>\n  `${`${hours}`.padStart(2, '0')}:${`${minutes}`.padStart(2, '0')}`\n","import {Box, Grid, Text} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../../../../../../../../../i18n'\nimport {CalendarDay} from './CalendarDay'\nimport {SHORT_WEEK_DAY_KEYS} from './constants'\nimport {useCalendar} from './contexts/useDatePicker'\nimport {useWeeksOfMonth} from './utils'\n\nconst WEEK_DAY_NAME_KEYS = {\n  // Monday is start of the week\n  1: SHORT_WEEK_DAY_KEYS,\n\n  // Sunday is start of the week\n  7: [SHORT_WEEK_DAY_KEYS[6], ...SHORT_WEEK_DAY_KEYS.slice(0, 6)],\n}\n\ninterface CalendarMonthProps {\n  hidden?: boolean\n  onSelect: (date: Date) => void\n}\n\nconst CustomGrid = styled(Grid)`\n  grid-template-columns: repeat(7, minmax(44px, auto));\n`\n\nexport function CalendarMonth({hidden, onSelect}: CalendarMonthProps) {\n  const {focusedDate, firstWeekDay} = useCalendar()\n  const {t} = useTranslation()\n\n  return (\n    <Box aria-hidden={hidden || false} data-ui=\"CalendarMonth\">\n      <CustomGrid gapY={1}>\n        {WEEK_DAY_NAME_KEYS[firstWeekDay].map((weekdayDay) => (\n          <Box key={weekdayDay} paddingBottom={3} paddingTop={2}>\n            <Text align=\"center\" size={1} weight=\"medium\">\n              {t(weekdayDay)}\n            </Text>\n          </Box>\n        ))}\n\n        {useWeeksOfMonth(focusedDate).map((week, weekIdx) =>\n          week.days.map((weekDayDate, dayIdx) => {\n            return (\n              <CalendarDay\n                date={weekDayDate}\n                // eslint-disable-next-line react/no-array-index-key\n                key={`${weekIdx}-${dayIdx}`}\n                onSelect={onSelect}\n              />\n            )\n          }),\n        )}\n      </CustomGrid>\n    </Box>\n  )\n}\n","import {Box, Flex} from '@sanity/ui'\nimport {addDays, addMonths, isAfter, isBefore, set} from 'date-fns'\nimport {\n  type ComponentProps,\n  type KeyboardEvent,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react'\n\nimport {useCurrentLocale} from '../../../../../../../../../../../i18n/hooks/useLocale'\nimport {CalendarHeader} from './CalendarHeader'\nimport {CalendarMonth} from './CalendarMonth'\nimport {ARROW_KEYS} from './constants'\nimport {CalendarContext} from './contexts/CalendarContext'\n\ntype CalendarProps = Omit<ComponentProps<'div'>, 'onSelect'> & {\n  date?: Date\n  endDate?: Date\n  onSelect: ({date, endDate}: {date: Date | null; endDate?: Date | null}) => void\n  selectRange?: boolean\n  selectTime?: boolean\n}\n\n// This is used to maintain focus on a child element of the calendar-grid between re-renders\n// When using arrow keys to move focus from a day in one month to another we are setting focus at the button for the day\n// after it has changed but *only* if we *already* had focus inside the calendar grid (e.g not if focus was on the \"next\n// year\" button, or any of the other controls)\n// When moving from the last day of a month that displays 6 weeks in the grid to a month that displays 5 weeks, current\n// focus gets lost on render, so this provides us with a stable element to help us preserve focus on a child element of\n// the calendar grid between re-renders\nconst PRESERVE_FOCUS_ELEMENT = (\n  <span\n    data-preserve-focus\n    style={{overflow: 'hidden', position: 'absolute', outline: 'none'}}\n    tabIndex={-1}\n  />\n)\n\nexport function Calendar(props: CalendarProps) {\n  const {date, endDate, onSelect, selectRange, selectTime} = props\n\n  const [calendarElement, setCalendarElement] = useState<HTMLElement | null>(null)\n  const [selectEndValue, setSelectEndValue] = useState(false)\n  const [focusedDate, setFocusedDate] = useState(date || new Date())\n\n  const previousDate = useRef<Date | null>(date || null)\n  const previousEndDate = useRef<Date | null>(endDate || null)\n\n  const {\n    weekInfo: {firstDay: firstWeekDay},\n  } = useCurrentLocale()\n\n  const focusCurrentWeekDay = useCallback(() => {\n    calendarElement?.querySelector<HTMLElement>(`[data-focused=\"true\"]`)?.focus()\n  }, [calendarElement])\n\n  const handleDateChange = useCallback(\n    (d: Date) => {\n      const selectedDate = set(d, {\n        hours: d.getHours(),\n        minutes: d.getMinutes(),\n        seconds: 0,\n        milliseconds: 0,\n      })\n\n      const dateIsBeforeStartDate = date && isBefore(selectedDate, date)\n      const dateIsAfterEndDate = endDate && isAfter(selectedDate, endDate)\n\n      if (selectRange) {\n        // Update existing start date and clear end date\n        if (dateIsBeforeStartDate || dateIsAfterEndDate) {\n          onSelect({date: selectedDate, endDate: null})\n          return\n        }\n        if (selectEndValue) {\n          // Update end date, retain start date if present\n          onSelect({date: date || null, endDate: selectedDate})\n        } else {\n          // Update start date, retain end date only if no date is present\n          onSelect({date: selectedDate, endDate: date ? null : endDate || null})\n        }\n      } else {\n        onSelect({date: selectedDate})\n      }\n    },\n    [date, endDate, onSelect, selectEndValue, selectRange],\n  )\n\n  const handleNowClick = useCallback(() => {\n    const now = new Date()\n    if (selectRange) {\n      setFocusedDate(now)\n    } else {\n      onSelect({date: now})\n    }\n  }, [onSelect, selectRange, setFocusedDate])\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (!ARROW_KEYS.includes(event.key)) {\n        return\n      }\n      event.preventDefault()\n      if ((event.target as HTMLElement).hasAttribute('data-calendar-grid')) {\n        focusCurrentWeekDay()\n        return\n      }\n      if (event.key === 'ArrowUp') {\n        setFocusedDate(addDays(focusedDate, -7))\n      }\n      if (event.key === 'ArrowDown') {\n        setFocusedDate(addDays(focusedDate, 7))\n      }\n      if (event.key === 'ArrowLeft') {\n        setFocusedDate(addDays(focusedDate, -1))\n      }\n      if (event.key === 'ArrowRight') {\n        setFocusedDate(addDays(focusedDate, 1))\n      }\n      // set focus temporarily on this element to make sure focus is still inside the calendar-grid after re-render\n      calendarElement?.querySelector<HTMLElement>('[data-preserve-focus]')?.focus()\n    },\n    [calendarElement, focusCurrentWeekDay, focusedDate, setFocusedDate],\n  )\n\n  const moveFocusedDate = useCallback(\n    (by: number) => setFocusedDate(addMonths(focusedDate, by)),\n    [focusedDate, setFocusedDate],\n  )\n\n  useEffect(() => {\n    focusCurrentWeekDay()\n  }, [focusCurrentWeekDay])\n\n  useEffect(() => {\n    const currentFocusInCalendarGrid = document.activeElement?.matches(\n      '[data-calendar-grid], [data-calendar-grid] [data-preserve-focus]',\n    )\n    if (\n      // Only move focus if it's currently in the calendar grid\n      currentFocusInCalendarGrid\n    ) {\n      focusCurrentWeekDay()\n    }\n  }, [focusCurrentWeekDay, focusedDate])\n\n  useEffect(() => {\n    const dateChanged = date?.getTime() !== previousDate.current?.getTime()\n    const endDateChanged = endDate?.getTime() !== previousEndDate.current?.getTime()\n    const onlyDateChanged = dateChanged && !endDateChanged\n    const onlyEndDateChanged = !dateChanged && endDateChanged\n    const dateIsAfterEndDate = date && endDate && isAfter(date, endDate)\n\n    // Only date has changed\n    if (onlyDateChanged) {\n      if (dateIsAfterEndDate) {\n        setSelectEndValue(true)\n        onSelect({date, endDate: null})\n      }\n      setSelectEndValue(!!date)\n      // Focus start date\n      if (date) setFocusedDate(date)\n    }\n    // Only end date has changed\n    if (onlyEndDateChanged) {\n      if (dateIsAfterEndDate) {\n        setSelectEndValue(true)\n        onSelect({date: endDate, endDate: null})\n      }\n      // Switch to end value, only if we have an existing start date and no end date\n      setSelectEndValue(!!date && !endDate)\n      // Focus end date\n      if (endDate) setFocusedDate(endDate)\n    }\n    // Both dates have changed\n    if (dateChanged && endDateChanged) {\n      setSelectEndValue(true)\n      // Focus start date\n      if (date) setFocusedDate(date)\n    }\n\n    previousDate.current = date || null\n    previousEndDate.current = endDate || null\n  }, [date, endDate, onSelect])\n\n  return (\n    <CalendarContext.Provider\n      value={{\n        date,\n        endDate,\n        focusedDate,\n        selectRange,\n        selectTime,\n        firstWeekDay,\n      }}\n    >\n      <Box data-ui=\"Calendar\" ref={setCalendarElement}>\n        {/* Select month and year */}\n        <Flex>\n          <Box flex={1}>\n            <CalendarHeader moveFocusedDate={moveFocusedDate} onNowClick={handleNowClick} />\n          </Box>\n        </Flex>\n\n        {/* Selected month (grid of days) */}\n        <Box\n          data-calendar-grid\n          onKeyDown={handleKeyDown}\n          marginTop={2}\n          overflow=\"hidden\"\n          tabIndex={0}\n        >\n          <CalendarMonth onSelect={handleDateChange} />\n          {PRESERVE_FOCUS_ELEMENT}\n        </Box>\n      </Box>\n    </CalendarContext.Provider>\n  )\n}\n","import {useCallback} from 'react'\n\nimport {Calendar} from './calendar/Calendar'\n\ninterface DatePickerProps {\n  date?: Date\n  endDate?: Date\n  onChange: ({date, endDate}: {date?: Date | null; endDate?: Date | null}) => void\n  selectRange?: boolean\n  selectTime?: boolean\n}\n\nexport function DatePicker({date, endDate, onChange, selectRange, selectTime}: DatePickerProps) {\n  const handleSelect = useCallback(\n    (dates: {date: Date | null; endDate?: Date | null}) => {\n      onChange(dates)\n    },\n    [onChange],\n  )\n\n  return (\n    <Calendar\n      date={date}\n      endDate={endDate}\n      onSelect={handleSelect}\n      selectRange={selectRange}\n      selectTime={selectTime}\n    />\n  )\n}\n","import {Box} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nexport const CustomTextInputBox = styled(Box)<{\n  $background?: boolean\n  $smallClearButton?: boolean\n}>(({$background, $smallClearButton}) => {\n  return css`\n    width: 100%;\n\n    input + span {\n      background: ${({theme}) =>\n        $background ? theme.sanity.color.card.disabled.bg2 : 'transparent'};\n    }\n\n    [data-qa='clear-button'] {\n      background: none;\n      box-shadow: none;\n      display: flex; /* TODO: hack, currently used to vertically center <TextInput>'s clearButton */\n      transform: ${$smallClearButton ? 'scale(0.8)' : 'scale(1)'};\n      &:hover {\n        opacity: 0.5;\n      }\n    }\n  `\n})\n","import {TextInput} from '@sanity/ui'\nimport {type ComponentProps, forwardRef} from 'react'\n\nimport {CustomTextInputBox} from './CustomTextInputBox'\n\ninterface CustomTextInputProps extends ComponentProps<typeof TextInput> {\n  $background?: boolean\n  $smallClearButton?: boolean\n}\n\nexport const CustomTextInput = forwardRef<HTMLInputElement, CustomTextInputProps>(\n  function CustomTextInput(props, ref) {\n    const {$background, $smallClearButton, ...rest} = props\n\n    return (\n      <CustomTextInputBox $background={$background} $smallClearButton={$smallClearButton}>\n        <TextInput {...rest} ref={ref} />\n      </CustomTextInputBox>\n    )\n  },\n)\n","import {endOfDay, startOfDay} from 'date-fns'\n\nexport type RoundDayValue = 'end' | 'start'\n\n/**\n * Get the ISO 8601 string of a provided date.\n *\n * Returns a full ISO string if `datetime=true` (e.g. '2023-01-04T10:00:00.000Z')\n * Otherwise, returns a partial string containing only the date (e.g. '2023-01-04'),\n */\nexport function getDateISOString({\n  date,\n  dateOnly,\n  roundDay,\n}: {\n  date: Date\n  dateOnly?: boolean\n  roundDay?: RoundDayValue\n}): string {\n  let adjustedDate: Date\n  switch (roundDay) {\n    case 'end':\n      adjustedDate = endOfDay(date)\n      break\n    case 'start':\n      adjustedDate = startOfDay(date)\n      break\n    default:\n      adjustedDate = date\n      break\n  }\n\n  return dateOnly ? adjustedDate.toISOString().split('T')[0] : adjustedDate.toISOString()\n}\n","import {format, isValid, parse} from 'date-fns'\nimport {\n  type ChangeEvent,\n  type ComponentProps,\n  type KeyboardEvent,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react'\n\nimport {Tooltip} from '../../../../../../../../../../ui-components'\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {CustomTextInput} from '../../../../common/CustomTextInput'\nimport {getDateISOString} from './utils/getDateISOString'\n\ninterface ParsedDateTextInputProps\n  extends Omit<ComponentProps<typeof CustomTextInput>, 'onChange' | 'value'> {\n  /**\n   * Determines whether `onChange` returns a full or partial ISO-8601 string.\n   * e.g. '2023-01-04T10:00:00.000Z' or '2023-01-04'\n   */\n  isDateTime: boolean\n  /**\n   * Determines whether dates are formatted with full or partial date format\n   * e.g. 'Feb 1, 2000 12:00 AM' vs 'Feb 1, 2000'\n   */\n  isDateTimeFormat?: boolean\n  onChange: (val: string | null) => void\n  placeholderDate?: Date\n  value?: string | null\n}\n\nconst FORMAT: Record<\n  'date' | 'datetime',\n  {\n    /** Displayed in validation errors */\n    exampleDate: string\n    pattern: string\n  }\n> = {\n  date: {\n    exampleDate: 'Jan 1, 2000',\n    pattern: 'MMM d, yyyy',\n  },\n  datetime: {\n    exampleDate: 'Jan 1, 2000 12:00 AM',\n    pattern: 'MMM d, yyyy p',\n  },\n}\n\nexport function ParsedDateTextInput({\n  isDateTime,\n  onChange,\n  placeholderDate,\n  isDateTimeFormat,\n  value,\n  ...rest\n}: ParsedDateTextInputProps) {\n  const {t} = useTranslation()\n  const dateFormat = isDateTimeFormat ? FORMAT.datetime.pattern : FORMAT.date.pattern\n\n  const [customValidity, setCustomValidity] = useState<string | undefined>(undefined)\n  const [inputValue, setInputValue] = useState<string>(() => {\n    if (!value) {\n      return ''\n    }\n    const inputValueDate = new Date(value)\n    return format(inputValueDate, dateFormat)\n  })\n\n  /**\n   * Conditionally create placeholder text\n   */\n  const formattedPlaceholder = useMemo(() => {\n    const date = placeholderDate || new Date()\n    return format(date, dateFormat)\n  }, [dateFormat, placeholderDate])\n\n  /**\n   * Process current input value:\n   * - If `useDateFormat = true`, parse custom date string format and create date object.\n   * (Otherwise assume ISO-8601 format).\n   * - Validate the parsed date, update `customValidity` state on <TextInput />\n   * - If valid, update local input value and optionally trigger onChange callback.\n   */\n  const processInputString = useCallback(\n    ({dateString, triggerOnChange}: {dateString: string; triggerOnChange?: boolean}) => {\n      if (!dateString) {\n        return\n      }\n      const dateParsed = parse(dateString, dateFormat, new Date())\n      const validDate = isValid(dateParsed)\n      if (validDate) {\n        if (triggerOnChange) {\n          onChange(getDateISOString({date: dateParsed, dateOnly: !isDateTime}))\n        }\n        setInputValue(format(dateParsed, dateFormat))\n      }\n      setCustomValidity(validDate ? undefined : `Invalid ${isDateTime ? 'datetime' : 'date'}`)\n    },\n    [dateFormat, isDateTime, onChange],\n  )\n\n  /**\n   * Re-process (parse, validate and update) current input value on blur\n   */\n  const handleTextInputBlur = useCallback(() => {\n    processInputString({dateString: inputValue, triggerOnChange: true})\n  }, [inputValue, processInputString])\n\n  const handleTextInputChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    setInputValue(event.currentTarget.value)\n  }, [])\n\n  /**\n   * Reset state on input clear\n   */\n  const handleTextInputClear = useCallback(() => {\n    onChange(null)\n    setCustomValidity(undefined)\n    setInputValue('')\n  }, [onChange])\n\n  /**\n   * Re-process (parse, validate and update) current input value on ENTER\n   */\n  const handleTextInputKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLInputElement>) => {\n      if (event.key === 'Enter') {\n        processInputString({dateString: inputValue, triggerOnChange: true})\n      }\n    },\n    [inputValue, processInputString],\n  )\n\n  /**\n   * Re-process input string when props value is updated\n   */\n  useEffect(() => {\n    const updatedDate = value && new Date(value)\n    if (updatedDate) {\n      processInputString({\n        dateString: format(updatedDate, dateFormat),\n        triggerOnChange: false,\n      })\n    }\n  }, [dateFormat, processInputString, isDateTimeFormat, value])\n\n  return (\n    <Tooltip\n      content={t('calendar.error.must-be-in-format', {\n        exampleDate: isDateTimeFormat ? FORMAT.datetime.exampleDate : FORMAT.date.exampleDate,\n      })}\n      disabled={!customValidity}\n      placement=\"top\"\n      portal\n    >\n      {/* HACK: Wrapping element required for <Tooltip> to function */}\n      <CustomTextInput\n        {...rest}\n        clearButton={!!inputValue}\n        customValidity={customValidity}\n        onBlur={handleTextInputBlur}\n        onChange={handleTextInputChange}\n        onClear={handleTextInputClear}\n        onKeyDown={handleTextInputKeyDown}\n        placeholder={formattedPlaceholder}\n        value={inputValue}\n      />\n    </Tooltip>\n  )\n}\n","import {Stack} from '@sanity/ui'\nimport {useCallback, useMemo} from 'react'\n\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorDateDirectionValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {DateIncludeTimeFooter} from './dateIncludeTimeFooter/DateIncludeTimeFooter'\nimport {DatePicker} from './datePicker/DatePicker'\nimport {ParsedDateTextInput} from './ParsedDateTextInput'\nimport {getDateISOString} from './utils/getDateISOString'\n\nexport function CommonDateDirectionInput({\n  direction,\n  isDateTime,\n  onChange,\n  value,\n}: OperatorInputComponentProps<OperatorDateDirectionValue> & {\n  direction: 'after' | 'before'\n  isDateTime: boolean\n}) {\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const roundDay = useMemo(() => {\n    switch (direction) {\n      case 'after':\n        return 'end'\n      case 'before':\n        return 'start'\n      default:\n        return undefined\n    }\n  }, [direction])\n\n  const handleDatePickerChange = useCallback(\n    ({date}: {date?: Date | null}) => {\n      let dateISOString: string | null = null\n      if (date) {\n        dateISOString = getDateISOString({\n          date,\n          dateOnly: !isDateTime,\n          roundDay: value?.includeTime ? undefined : roundDay,\n        })\n      }\n      onChange({\n        includeTime: value?.includeTime,\n        date: dateISOString,\n      })\n    },\n    [isDateTime, onChange, roundDay, value?.includeTime],\n  )\n\n  const handleIncludeTimeChange = useCallback(() => {\n    const includeTime = !value?.includeTime\n    const date = value?.date ? new Date(value.date) : null\n\n    let dateISOString: string | null = null\n    if (date) {\n      dateISOString = getDateISOString({\n        date,\n        dateOnly: !isDateTime,\n        roundDay: includeTime ? 'start' : roundDay,\n      })\n    }\n    onChange({includeTime, date: dateISOString})\n  }, [isDateTime, onChange, roundDay, value])\n\n  const handleTextDateChange = useCallback(\n    (date: string | null) => {\n      onChange({\n        includeTime: value?.includeTime,\n        date: date || null,\n      })\n    },\n    [onChange, value?.includeTime],\n  )\n\n  return (\n    <Stack space={3}>\n      <ParsedDateTextInput\n        aria-label={t('search.filter-date-aria-label')}\n        fontSize={fullscreen ? 2 : 1}\n        isDateTime={isDateTime}\n        isDateTimeFormat={isDateTime && value?.includeTime}\n        onChange={handleTextDateChange}\n        radius={2}\n        value={value?.date}\n      />\n      <DatePicker\n        date={value?.date ? new Date(value.date) : undefined}\n        onChange={handleDatePickerChange}\n        selectTime={isDateTime}\n      />\n      {/* Include time footer */}\n      {isDateTime && (\n        <DateIncludeTimeFooter onChange={handleIncludeTimeChange} value={!!value?.includeTime} />\n      )}\n    </Stack>\n  )\n}\n","import {type OperatorDateDirectionValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {CommonDateDirectionInput} from './CommonDateDirection'\n\nexport function SearchFilterDateAfterInput(\n  props: OperatorInputComponentProps<OperatorDateDirectionValue>,\n) {\n  return <CommonDateDirectionInput {...props} direction=\"after\" isDateTime={false} />\n}\n","import {type OperatorDateDirectionValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {CommonDateDirectionInput} from './CommonDateDirection'\n\nexport function SearchFilterDateBeforeInput(\n  props: OperatorInputComponentProps<OperatorDateDirectionValue>,\n) {\n  return <CommonDateDirectionInput {...props} direction=\"before\" isDateTime={false} />\n}\n","import {Stack} from '@sanity/ui'\nimport {useCallback} from 'react'\n\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorDateEqualValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {DateIncludeTimeFooter} from './dateIncludeTimeFooter/DateIncludeTimeFooter'\nimport {DatePicker} from './datePicker/DatePicker'\nimport {ParsedDateTextInput} from './ParsedDateTextInput'\nimport {getDateISOString} from './utils/getDateISOString'\n\nexport function CommonDateEqualInput({\n  isDateTime,\n  onChange,\n  value,\n}: OperatorInputComponentProps<OperatorDateEqualValue> & {\n  isDateTime: boolean\n}) {\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const handleDatePickerChange = useCallback(\n    ({date}: {date?: Date | null}) => {\n      if (date) {\n        const dateISOString = getDateISOString({date, dateOnly: !isDateTime})\n        onChange({\n          includeTime: value?.includeTime,\n          date: dateISOString,\n        })\n      } else {\n        onChange(null)\n      }\n    },\n    [isDateTime, onChange, value?.includeTime],\n  )\n\n  const handleIncludeTimeChange = useCallback(() => {\n    const includeTime = !value?.includeTime\n    const date = value?.date ? new Date(value.date) : null\n\n    let dateISOString: string | null = null\n    if (date) {\n      dateISOString = getDateISOString({\n        date,\n        dateOnly: !isDateTime,\n      })\n    }\n    onChange({includeTime, date: dateISOString})\n  }, [isDateTime, onChange, value])\n\n  const handleTextDateChange = useCallback(\n    (date: string | null) => {\n      onChange({\n        includeTime: value?.includeTime,\n        date: date || null,\n      })\n    },\n    [onChange, value?.includeTime],\n  )\n\n  return (\n    <Stack space={3}>\n      <ParsedDateTextInput\n        aria-label={t('search.filter-date-aria-label')}\n        fontSize={fullscreen ? 2 : 1}\n        isDateTime={isDateTime}\n        isDateTimeFormat={isDateTime && value?.includeTime}\n        onChange={handleTextDateChange}\n        radius={2}\n        value={value?.date}\n      />\n      <DatePicker\n        date={value?.date ? new Date(value.date) : undefined}\n        onChange={handleDatePickerChange}\n        selectTime={isDateTime}\n      />\n      {/* Include time footer */}\n      {isDateTime && (\n        <DateIncludeTimeFooter onChange={handleIncludeTimeChange} value={!!value?.includeTime} />\n      )}\n    </Stack>\n  )\n}\n","import {type OperatorDateEqualValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {CommonDateEqualInput} from './CommonDateEqual'\n\nexport function SearchFilterDateEqualInput(\n  props: OperatorInputComponentProps<OperatorDateEqualValue>,\n) {\n  return <CommonDateEqualInput {...props} isDateTime={false} />\n}\n","import {Box, Flex, Select, TextInput} from '@sanity/ui'\nimport {type ChangeEvent, useCallback, useRef, useState} from 'react'\n\nimport {type StudioLocaleResourceKeys, useTranslation} from '../../../../../../../../../i18n'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorDateLastValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\n\ntype UnitChoice = {\n  unit: OperatorDateLastValue['unit']\n  key: StudioLocaleResourceKeys\n}\n\nconst UNIT_CHOICES: UnitChoice[] = [\n  {unit: 'day', key: 'search.filter-date-unit_days'},\n  {unit: 'month', key: 'search.filter-date-unit_months'},\n  {unit: 'year', key: 'search.filter-date-unit_years'},\n]\n\nexport function SearchFilterDateLastInput({\n  onChange,\n  value,\n}: OperatorInputComponentProps<OperatorDateLastValue>) {\n  const [uncontrolledValue, setUncontrolledValue] = useState(value?.unitValue || '')\n  const dateUnit = useRef<OperatorDateLastValue['unit']>('day')\n  const dateValue = useRef<OperatorDateLastValue['unitValue']>(value?.unitValue || null)\n  const {t} = useTranslation()\n\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n\n  const handleChange = useCallback(() => {\n    onChange({\n      unit: dateUnit?.current,\n      unitValue: dateValue?.current,\n    })\n  }, [onChange])\n\n  const handleUnitChange = useCallback(\n    (event: ChangeEvent<HTMLSelectElement>) => {\n      dateUnit.current = event.currentTarget.value as OperatorDateLastValue['unit']\n      handleChange()\n    },\n    [handleChange],\n  )\n  const handleValueChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      setUncontrolledValue(event.currentTarget.value)\n      const numValue = parseFloat(event.currentTarget.value)\n      dateValue.current = Number.isFinite(numValue) ? numValue : null\n      handleChange()\n    },\n    [handleChange],\n  )\n\n  return (\n    <Flex gap={2}>\n      <Box flex={1}>\n        <TextInput\n          aria-label={t('search.filter-date-value-aria-label')}\n          fontSize={fullscreen ? 2 : 1}\n          onChange={handleValueChange}\n          pattern=\"\\d*\"\n          radius={2}\n          step=\"1\"\n          type=\"number\"\n          value={uncontrolledValue}\n        />\n      </Box>\n      <Box flex={1}>\n        <Select\n          aria-label={t('search.filter-date-unit-aria-label')}\n          fontSize={fullscreen ? 2 : 1}\n          onChange={handleUnitChange}\n          radius={2}\n          value={value?.unit}\n        >\n          {UNIT_CHOICES.map((choice) => (\n            <option key={choice.key} value={choice.unit}>\n              {t(choice.key)}\n            </option>\n          ))}\n        </Select>\n      </Box>\n    </Flex>\n  )\n}\n","import {Flex, Stack} from '@sanity/ui'\nimport {addDays} from 'date-fns'\nimport {useCallback, useMemo} from 'react'\n\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorDateRangeValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {DateIncludeTimeFooter} from './dateIncludeTimeFooter/DateIncludeTimeFooter'\nimport {DatePicker} from './datePicker/DatePicker'\nimport {ParsedDateTextInput} from './ParsedDateTextInput'\nimport {getDateISOString} from './utils/getDateISOString'\n\nconst PLACEHOLDER_START_DATE_OFFSET = -7 // days\n\nexport function CommonDateRangeInput({\n  isDateTime,\n  onChange,\n  value,\n}: OperatorInputComponentProps<OperatorDateRangeValue> & {\n  isDateTime: boolean\n}) {\n  const {t} = useTranslation()\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n\n  /**\n   * For placeholder values: Use the current date for the end date input, and an arbitrary date\n   * in the past (e.g. -7 days from now) for the start date input.\n   */\n  const placeholderStartDate = useMemo(() => addDays(new Date(), PLACEHOLDER_START_DATE_OFFSET), [])\n  const placeholderEndDate = useMemo(() => new Date(), [])\n\n  const handleDatePickerChange = useCallback(\n    ({date, endDate}: {date?: Date | null; endDate?: Date | null}) => {\n      onChange(\n        getStartAndEndDate({\n          date,\n          endDate,\n          includeTime: value?.includeTime,\n          isDateTime,\n        }),\n      )\n    },\n    [isDateTime, onChange, value?.includeTime],\n  )\n\n  const handleIncludeTimeChange = useCallback(() => {\n    const includeTime = !value?.includeTime\n    onChange(\n      getStartAndEndDate({\n        date: value?.from ? new Date(value.from) : null,\n        endDate: value?.to ? new Date(value.to) : null,\n        includeTime,\n        isDateTime,\n      }),\n    )\n  }, [isDateTime, onChange, value])\n\n  const handleTextEndDateChange = useCallback(\n    (date: string | null) => {\n      onChange({\n        includeTime: value?.includeTime,\n        to: date || null,\n        from: value?.from || null,\n      })\n    },\n    [onChange, value],\n  )\n\n  const handleTextStartDateChange = useCallback(\n    (date: string | null) => {\n      onChange({\n        includeTime: value?.includeTime,\n        to: value?.to || null,\n        from: date || null,\n      })\n    },\n    [onChange, value],\n  )\n\n  return (\n    <div>\n      <Stack space={3}>\n        <Flex direction=\"column\" gap={3}>\n          {/* Start date */}\n          <ParsedDateTextInput\n            aria-label={t('search.filter-date-range-start-date-aria-label')}\n            fontSize={fullscreen ? 2 : 1}\n            isDateTime={isDateTime}\n            isDateTimeFormat={isDateTime && value?.includeTime}\n            onChange={handleTextStartDateChange}\n            placeholderDate={placeholderStartDate}\n            radius={2}\n            value={value?.from}\n          />\n          {/* End date */}\n          <ParsedDateTextInput\n            aria-label={t('search.filter-date-range-end-date-aria-label')}\n            fontSize={fullscreen ? 2 : 1}\n            isDateTime={isDateTime}\n            isDateTimeFormat={isDateTime && value?.includeTime}\n            onChange={handleTextEndDateChange}\n            placeholderDate={placeholderEndDate}\n            radius={2}\n            value={value?.to}\n          />\n        </Flex>\n        <DatePicker\n          date={value?.from ? new Date(value.from) : undefined}\n          endDate={value?.to ? new Date(value.to) : undefined}\n          onChange={handleDatePickerChange}\n          selectRange\n          selectTime={isDateTime}\n        />\n        {/* Include time footer */}\n        {isDateTime && (\n          <DateIncludeTimeFooter onChange={handleIncludeTimeChange} value={!!value?.includeTime} />\n        )}\n      </Stack>\n    </div>\n  )\n}\n\nfunction getStartAndEndDate({\n  date,\n  endDate,\n  includeTime,\n  isDateTime,\n}: {\n  date?: Date | null\n  endDate?: Date | null\n  includeTime?: boolean\n  isDateTime?: boolean\n}): {\n  includeTime?: boolean\n  to: string | null\n  from: string | null\n} {\n  if (includeTime) {\n    return {\n      includeTime,\n      to: endDate\n        ? getDateISOString({date: endDate, dateOnly: !isDateTime, roundDay: 'start'})\n        : null,\n      from: date ? getDateISOString({date: date, dateOnly: !isDateTime, roundDay: 'start'}) : null,\n    }\n  }\n\n  return {\n    includeTime,\n    to: endDate ? getDateISOString({date: endDate, dateOnly: !isDateTime, roundDay: 'end'}) : null,\n    from: date ? getDateISOString({date, dateOnly: !isDateTime, roundDay: 'start'}) : null,\n  }\n}\n","import {type OperatorDateRangeValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {CommonDateRangeInput} from './CommonDateRange'\n\nexport function SearchFilterDateRangeInput(\n  props: OperatorInputComponentProps<OperatorDateRangeValue>,\n) {\n  return <CommonDateRangeInput {...props} isDateTime={false} />\n}\n","import {type OperatorDateDirectionValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {CommonDateDirectionInput} from './CommonDateDirection'\n\nexport function SearchFilterDateTimeAfterInput(\n  props: OperatorInputComponentProps<OperatorDateDirectionValue>,\n) {\n  return <CommonDateDirectionInput {...props} direction=\"after\" isDateTime />\n}\n","import {type OperatorDateDirectionValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {CommonDateDirectionInput} from './CommonDateDirection'\n\nexport function SearchFilterDateTimeBeforeInput(\n  props: OperatorInputComponentProps<OperatorDateDirectionValue>,\n) {\n  return <CommonDateDirectionInput {...props} direction=\"before\" isDateTime />\n}\n","import {type OperatorDateEqualValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {CommonDateEqualInput} from './CommonDateEqual'\n\nexport function SearchFilterDateTimeEqualInput(\n  props: OperatorInputComponentProps<OperatorDateEqualValue>,\n) {\n  return <CommonDateEqualInput {...props} isDateTime />\n}\n","import {type OperatorDateRangeValue} from '../../../../../definitions/operators/dateOperators'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\nimport {CommonDateRangeInput} from './CommonDateRange'\n\nexport function SearchFilterDateTimeRangeInput(\n  props: OperatorInputComponentProps<OperatorDateRangeValue>,\n) {\n  return <CommonDateRangeInput {...props} isDateTime />\n}\n","import {\n  endOfDay,\n  endOfMinute,\n  isValid,\n  startOfDay,\n  startOfMinute,\n  startOfToday,\n  sub,\n} from 'date-fns'\n\nimport {\n  SearchButtonValueDate,\n  SearchButtonValueDateLast,\n  SearchButtonValueDateRange,\n} from '../../components/filters/common/ButtonValue'\nimport {SearchFilterDateAfterInput} from '../../components/filters/filter/inputs/date/DateAfter'\nimport {SearchFilterDateBeforeInput} from '../../components/filters/filter/inputs/date/DateBefore'\nimport {SearchFilterDateEqualInput} from '../../components/filters/filter/inputs/date/DateEqual'\nimport {SearchFilterDateLastInput} from '../../components/filters/filter/inputs/date/DateLast'\nimport {SearchFilterDateRangeInput} from '../../components/filters/filter/inputs/date/DateRange'\nimport {SearchFilterDateTimeAfterInput} from '../../components/filters/filter/inputs/date/DateTimeAfter'\nimport {SearchFilterDateTimeBeforeInput} from '../../components/filters/filter/inputs/date/DateTimeBefore'\nimport {SearchFilterDateTimeEqualInput} from '../../components/filters/filter/inputs/date/DateTimeEqual'\nimport {SearchFilterDateTimeRangeInput} from '../../components/filters/filter/inputs/date/DateTimeRange'\nimport {\n  defineSearchOperator,\n  type SearchOperatorButtonValue,\n  type SearchOperatorInput,\n  type SearchOperatorParams,\n} from './operatorTypes'\nimport {toJSON} from './operatorUtils'\n\n// 'Before' and 'after' dates\nexport interface OperatorDateDirectionValue {\n  includeTime?: boolean\n  date: string | null\n}\n\nexport interface OperatorDateEqualValue {\n  includeTime?: boolean\n  date: string | null\n}\n\nexport interface OperatorDateRangeValue {\n  to: string | null\n  from: string | null\n  includeTime?: boolean\n}\n\nexport interface OperatorDateLastValue {\n  unit: 'day' | 'month' | 'year'\n  unitValue: number | null\n}\n\n// @todo: don't manually cast `buttonValueComponent` and `inputComponent` once\n// we understand why `npm run etl` fails with 'Unable to follow symbol' errors\n\n// Common values shared between date & datetime defs\nconst COMMON = {\n  dateAfter: {\n    buttonValueComponent:\n      SearchButtonValueDate as SearchOperatorButtonValue<OperatorDateDirectionValue>,\n    initialValue: null,\n  },\n  dateBefore: {\n    buttonValueComponent:\n      SearchButtonValueDate as SearchOperatorButtonValue<OperatorDateDirectionValue>,\n    initialValue: null,\n  },\n  dateEqual: {\n    buttonValueComponent:\n      SearchButtonValueDate as SearchOperatorButtonValue<OperatorDateEqualValue>,\n    initialValue: {\n      date: null,\n      includeTime: false,\n    },\n  },\n  dateLast: {\n    buttonValueComponent:\n      SearchButtonValueDateLast as SearchOperatorButtonValue<OperatorDateLastValue>,\n  },\n  dateNotEqual: {\n    buttonValueComponent:\n      SearchButtonValueDate as SearchOperatorButtonValue<OperatorDateEqualValue>,\n    initialValue: {\n      date: null,\n      includeTime: false,\n    },\n  },\n  dateRange: {\n    initialValue: null,\n  },\n}\n\nexport const dateOperators = {\n  dateAfter: defineSearchOperator({\n    ...COMMON.dateAfter,\n\n    nameKey: 'search.operator.date-after.name',\n    descriptionKey: 'search.operator.date-after.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateDirectionValue>) => {\n      return value?.date && fieldPath ? `${fieldPath} > ${toJSON(value?.date)}` : null\n    },\n    inputComponent: SearchFilterDateAfterInput as SearchOperatorInput<OperatorDateDirectionValue>,\n    type: 'dateAfter',\n  }),\n  dateBefore: defineSearchOperator({\n    ...COMMON.dateBefore,\n\n    nameKey: 'search.operator.date-before.name',\n    descriptionKey: 'search.operator.date-before.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateDirectionValue>) => {\n      return value?.date && fieldPath ? `${fieldPath} < ${toJSON(value?.date)}` : null\n    },\n    inputComponent: SearchFilterDateBeforeInput as SearchOperatorInput<OperatorDateDirectionValue>,\n    type: 'dateBefore',\n  }),\n  dateEqual: defineSearchOperator({\n    ...COMMON.dateEqual,\n\n    nameKey: 'search.operator.date-equal.name',\n    descriptionKey: 'search.operator.date-equal.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateEqualValue>) => {\n      return value?.date && fieldPath ? `${fieldPath} == ${toJSON(value.date)}` : null\n    },\n    inputComponent: SearchFilterDateEqualInput as SearchOperatorInput<OperatorDateEqualValue>,\n    type: 'dateEqual',\n  }),\n  dateLast: defineSearchOperator({\n    ...COMMON.dateLast,\n\n    nameKey: 'search.operator.date-last.name',\n    descriptionKey: 'search.operator.date-last.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateLastValue>) => {\n      const flooredValue =\n        typeof value?.unitValue === 'number' ? Math.floor(value.unitValue) : undefined\n      const timestampAgo = Number.isFinite(flooredValue)\n        ? sub(new Date(), {\n            days: value?.unit === 'day' ? flooredValue : 0,\n            months: value?.unit === 'month' ? flooredValue : 0,\n            years: value?.unit === 'year' ? flooredValue : 0,\n          })\n            .toISOString()\n            .split('T')[0] // only include date\n        : null\n      return timestampAgo && fieldPath ? `${fieldPath} > ${toJSON(timestampAgo)}` : null\n    },\n    inputComponent: SearchFilterDateLastInput as SearchOperatorInput<OperatorDateLastValue>,\n    initialValue: {\n      unit: 'day',\n      unitValue: 7,\n    },\n    type: 'dateLast',\n  }),\n  dateNotEqual: defineSearchOperator({\n    ...COMMON.dateNotEqual,\n\n    nameKey: 'search.operator.date-not-equal.name',\n    descriptionKey: 'search.operator.date-not-equal.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateEqualValue>) => {\n      return value?.date && fieldPath ? `${fieldPath} != ${toJSON(value.date)}` : null\n    },\n    inputComponent: SearchFilterDateEqualInput as SearchOperatorInput<OperatorDateEqualValue>,\n    type: 'dateNotEqual',\n  }),\n  dateRange: defineSearchOperator({\n    ...COMMON.dateRange,\n\n    nameKey: 'search.operator.date-range.name',\n    descriptionKey: 'search.operator.date-range.description',\n\n    buttonValueComponent:\n      SearchButtonValueDateRange as SearchOperatorButtonValue<OperatorDateRangeValue>,\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateRangeValue>) => {\n      return value?.to && value?.from && fieldPath\n        ? `${fieldPath} >= ${toJSON(value.from)} && ${fieldPath} <= ${toJSON(value.to)}`\n        : null\n    },\n    initialValue: {\n      includeTime: false,\n      to: startOfToday().toISOString(),\n      from: null,\n    },\n    inputComponent: SearchFilterDateRangeInput as SearchOperatorInput<OperatorDateRangeValue>,\n    type: 'dateRange',\n  }),\n  dateTimeAfter: defineSearchOperator({\n    ...COMMON.dateAfter,\n\n    nameKey: 'search.operator.date-time-after.name',\n    descriptionKey: 'search.operator.date-time-after.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateDirectionValue>) => {\n      return value?.date && fieldPath\n        ? `dateTime(${fieldPath}) > dateTime(${toJSON(value.date)})`\n        : null\n    },\n    inputComponent:\n      SearchFilterDateTimeAfterInput as SearchOperatorInput<OperatorDateDirectionValue>,\n    type: 'dateTimeAfter',\n  }),\n  dateTimeBefore: defineSearchOperator({\n    ...COMMON.dateBefore,\n\n    nameKey: 'search.operator.date-time-before.name',\n    descriptionKey: 'search.operator.date-time-before.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateDirectionValue>) => {\n      return value?.date && fieldPath\n        ? `dateTime(${fieldPath}) < dateTime(${toJSON(value.date)})`\n        : null\n    },\n    inputComponent:\n      SearchFilterDateTimeBeforeInput as SearchOperatorInput<OperatorDateDirectionValue>,\n    type: 'dateTimeBefore',\n  }),\n  dateTimeEqual: defineSearchOperator({\n    ...COMMON.dateEqual,\n\n    nameKey: 'search.operator.date-time-equal.name',\n    descriptionKey: 'search.operator.date-time-equal.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateEqualValue>) => {\n      const date = value?.date && new Date(value.date)\n      if (!date || !isValid(date) || !fieldPath) {\n        return null\n      }\n      const dateStart = (value?.includeTime ? startOfMinute(date) : startOfDay(date)).toISOString()\n      const dateEnd = (value?.includeTime ? endOfMinute(date) : endOfDay(date)).toISOString()\n      return `dateTime(${fieldPath}) > dateTime(${toJSON(\n        dateStart,\n      )}) && dateTime(${fieldPath}) < dateTime(${toJSON(dateEnd)})`\n    },\n    inputComponent: SearchFilterDateTimeEqualInput as SearchOperatorInput<OperatorDateEqualValue>,\n    type: 'dateTimeEqual',\n  }),\n  dateTimeLast: defineSearchOperator({\n    ...COMMON.dateLast,\n\n    nameKey: 'search.operator.date-time-last.name',\n    descriptionKey: 'search.operator.date-time-last.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateLastValue>) => {\n      const flooredValue =\n        typeof value?.unitValue === 'number' ? Math.floor(value.unitValue) : undefined\n      const timestampAgo = Number.isFinite(flooredValue)\n        ? sub(new Date(), {\n            days: value?.unit === 'day' ? flooredValue : 0,\n            months: value?.unit === 'month' ? flooredValue : 0,\n            years: value?.unit === 'year' ? flooredValue : 0,\n          }).toISOString()\n        : null\n      return timestampAgo && fieldPath\n        ? `dateTime(${fieldPath}) > dateTime(${toJSON(timestampAgo)})`\n        : null\n    },\n    initialValue: {\n      unit: 'day',\n      unitValue: 7,\n    },\n    inputComponent: SearchFilterDateLastInput as SearchOperatorInput<OperatorDateLastValue>,\n    type: 'dateTimeLast',\n  }),\n  dateTimeNotEqual: defineSearchOperator({\n    ...COMMON.dateNotEqual,\n\n    nameKey: 'search.operator.date-time-not-equal.name',\n    descriptionKey: 'search.operator.date-time-not-equal.description',\n\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateEqualValue>) => {\n      const date = value?.date && new Date(value.date)\n      if (!date || !isValid(date) || !fieldPath) {\n        return null\n      }\n      const dateStart = (value?.includeTime ? startOfMinute(date) : startOfDay(date)).toISOString()\n      const dateEnd = (value?.includeTime ? endOfMinute(date) : endOfDay(date)).toISOString()\n      return `dateTime(${fieldPath}) < dateTime(${toJSON(\n        dateStart,\n      )}) || dateTime(${fieldPath}) > dateTime(${toJSON(dateEnd)})`\n    },\n    inputComponent: SearchFilterDateTimeEqualInput as SearchOperatorInput<OperatorDateEqualValue>,\n    type: 'dateTimeNotEqual',\n  }),\n\n  dateTimeRange: defineSearchOperator({\n    ...COMMON.dateRange,\n\n    nameKey: 'search.operator.date-time-range.name',\n    descriptionKey: 'search.operator.date-time-range.description',\n\n    buttonValueComponent:\n      SearchButtonValueDateRange as SearchOperatorButtonValue<OperatorDateRangeValue>,\n    groqFilter: ({fieldPath, value}: SearchOperatorParams<OperatorDateRangeValue>) => {\n      return value?.to && value?.from && fieldPath\n        ? `dateTime(${fieldPath}) >= dateTime(${toJSON(\n            value.from,\n          )}) && dateTime(${fieldPath}) <= dateTime(${toJSON(value.to)})`\n        : null\n    },\n    initialValue: {\n      includeTime: false,\n      to: startOfToday().toISOString(),\n      from: null,\n    },\n    inputComponent: SearchFilterDateTimeRangeInput as SearchOperatorInput<OperatorDateRangeValue>,\n    type: 'dateTimeRange',\n  }),\n}\n","import {defineSearchOperator} from './operatorTypes'\n\nexport const definedOperators = {\n  defined: defineSearchOperator({\n    nameKey: 'search.operator.defined.name',\n    descriptionKey: 'search.operator.defined.description',\n\n    groqFilter: ({fieldPath}) => (fieldPath ? `defined(${fieldPath})` : null),\n    type: 'defined',\n  }),\n  notDefined: defineSearchOperator({\n    nameKey: 'search.operator.not-defined.name',\n    descriptionKey: 'search.operator.not-defined.description',\n\n    i18nKey: 'search.operator.not-defined',\n    groqFilter: ({fieldPath}) => (fieldPath ? `!defined(${fieldPath})` : null),\n    type: 'notDefined',\n  }),\n}\n","import {SearchFilterNumberInput} from '../../components/filters/filter/inputs/number/Number'\nimport {SearchFilterNumberRangeInput} from '../../components/filters/filter/inputs/number/NumberRange'\nimport {GteIcon} from '../../components/filters/icons/GteIcon'\nimport {GtIcon} from '../../components/filters/icons/GtIcon'\nimport {LteIcon} from '../../components/filters/icons/LteIcon'\nimport {LtIcon} from '../../components/filters/icons/LtIcon'\nimport {type OperatorNumberRangeValue} from './common'\nimport {defineSearchOperator, type SearchOperatorInput} from './operatorTypes'\nimport {toJSON} from './operatorUtils'\n\n// @todo: don't manually cast `buttonValueComponent` and `inputComponent` once\n// we understand why `npm etl` fails with 'Unable to follow symbol' errors\nexport const numberOperators = {\n  numberEqual: defineSearchOperator({\n    nameKey: 'search.operator.number-equal.name',\n    descriptionKey: 'search.operator.number-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `${fieldPath} == ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'numberEqual',\n  }),\n  numberGt: defineSearchOperator({\n    nameKey: 'search.operator.number-gt.name',\n    descriptionKey: 'search.operator.number-gt.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `${fieldPath} > ${toJSON(value)}` : null,\n    icon: GtIcon,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'numberGt',\n  }),\n  numberGte: defineSearchOperator({\n    nameKey: 'search.operator.number-gte.name',\n    descriptionKey: 'search.operator.number-gte.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `${fieldPath} >= ${toJSON(value)}` : null,\n    icon: GteIcon,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'numberGte',\n  }),\n  numberLt: defineSearchOperator({\n    nameKey: 'search.operator.number-lt.name',\n    descriptionKey: 'search.operator.number-lt.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `${fieldPath} < ${toJSON(value)}` : null,\n    icon: LtIcon,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'numberLt',\n  }),\n  numberLte: defineSearchOperator({\n    nameKey: 'search.operator.number-lte.name',\n    descriptionKey: 'search.operator.number-lte.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `${fieldPath} <= ${toJSON(value)}` : null,\n    icon: LteIcon,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'numberLte',\n  }),\n  numberNotEqual: defineSearchOperator({\n    nameKey: 'search.operator.number-not-equal.name',\n    descriptionKey: 'search.operator.number-not-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value) && fieldPath ? `${fieldPath} != ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterNumberInput as SearchOperatorInput<number>,\n    type: 'numberNotEqual',\n  }),\n  numberRange: defineSearchOperator({\n    nameKey: 'search.operator.number-range.name',\n    descriptionKey: 'search.operator.number-range.description',\n    groqFilter: ({fieldPath, value}) =>\n      Number.isFinite(value?.to) && Number.isFinite(value?.from) && fieldPath\n        ? `${fieldPath} > ${toJSON(value?.from)} && ${fieldPath} < ${toJSON(value?.to)}`\n        : '',\n    initialValue: null,\n    inputComponent: SearchFilterNumberRangeInput as SearchOperatorInput<OperatorNumberRangeValue>,\n    type: 'numberRange',\n  }),\n}\n","import {TextInput} from '@sanity/ui'\nimport {type ChangeEvent, useCallback} from 'react'\n\nimport {useTranslation} from '../../../../../../../../../i18n'\nimport {useSearchState} from '../../../../../contexts/search/useSearchState'\nimport {type OperatorInputComponentProps} from '../../../../../definitions/operators/operatorTypes'\n\nexport function SearchFilterStringInput({\n  onChange,\n  value,\n}: OperatorInputComponentProps<number | string>) {\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const handleChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => onChange(event.currentTarget.value || null),\n    [onChange],\n  )\n\n  return (\n    <TextInput\n      fontSize={fullscreen ? 2 : 1}\n      onChange={handleChange}\n      placeholder={t('search.filter-string-value-placeholder')}\n      radius={2}\n      value={value || ''}\n    />\n  )\n}\n","import {SearchFilterStringInput} from '../../components/filters/filter/inputs/string/String'\nimport {defineSearchOperator, type SearchOperatorInput} from './operatorTypes'\nimport {toJSON} from './operatorUtils'\n\n// @todo: don't manually cast `buttonValueComponent` and `inputComponent` once\n// we understand why `npm etl` fails with 'Unable to follow symbol' errors\nexport const portableTextOperators = {\n  portableTextEqual: defineSearchOperator({\n    nameKey: 'search.operator.portable-text-equal.name',\n    descriptionKey: 'search.operator.portable-text-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `pt::text(${fieldPath}) == ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'portableTextEqual',\n  }),\n  portableTextMatches: defineSearchOperator({\n    nameKey: 'search.operator.portable-text-contains.name',\n    descriptionKey: 'search.operator.portable-text-contains.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `pt::text(${fieldPath}) match ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'portableTextMatches',\n  }),\n  portableTextNotEqual: defineSearchOperator({\n    nameKey: 'search.operator.portable-text-not-equal.name',\n    descriptionKey: 'search.operator.portable-text-not-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `pt::text(${fieldPath}) != ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'portableTextNotEqual',\n  }),\n  portableTextNotMatches: defineSearchOperator({\n    nameKey: 'search.operator.portable-text-not-contains.name',\n    descriptionKey: 'search.operator.portable-text-not-contains.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `!(pt::text(${fieldPath}) match ${toJSON(value)})` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'portableTextNotMatches',\n  }),\n}\n","import {type ReferenceValue} from '@sanity/types'\n\nimport {SearchButtonValueReference} from '../../components/filters/common/ButtonValue'\nimport {SearchFilterAssetInput} from '../../components/filters/filter/inputs/asset/Asset'\nimport {SearchFilterReferenceInput} from '../../components/filters/filter/inputs/reference/Reference'\nimport {\n  defineSearchOperator,\n  type SearchOperatorButtonValue,\n  type SearchOperatorInput,\n} from './operatorTypes'\nimport {toJSON} from './operatorUtils'\n\n// @todo: don't manually cast `buttonValueComponent` and `inputComponent` once\n// we understand why `npm etl` fails with 'Unable to follow symbol' errors\nexport const referenceOperators = {\n  referenceEqual: defineSearchOperator({\n    nameKey: 'search.operator.reference-equal.name',\n    descriptionKey: 'search.operator.reference-equal.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({fieldPath, value}) =>\n      value?._ref && fieldPath ? `${fieldPath}._ref == ${toJSON(value._ref)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterReferenceInput as SearchOperatorInput<ReferenceValue>,\n    type: 'referenceEqual',\n  }),\n  referenceNotEqual: defineSearchOperator({\n    nameKey: 'search.operator.reference-not-equal.name',\n    descriptionKey: 'search.operator.reference-not-equal.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({fieldPath, value}) =>\n      value?._ref && fieldPath ? `${fieldPath}._ref != ${toJSON(value._ref)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterReferenceInput as SearchOperatorInput<ReferenceValue>,\n    type: 'referenceNotEqual',\n  }),\n  referencesAssetFile: defineSearchOperator({\n    nameKey: 'search.operator.reference-asset-file.name',\n    descriptionKey: 'search.operator.reference-asset-file.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({value}) => (value?._ref ? `references(${toJSON(value._ref)})` : null),\n    initialValue: null,\n    inputComponent: SearchFilterAssetInput('file'),\n    type: 'referencesAssetFile',\n  }),\n  referencesAssetImage: defineSearchOperator({\n    nameKey: 'search.operator.reference-asset-image.name',\n    descriptionKey: 'search.operator.reference-asset-image.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({value}) => (value?._ref ? `references(${toJSON(value._ref)})` : null),\n    initialValue: null,\n    inputComponent: SearchFilterAssetInput('image'),\n    type: 'referencesAssetImage',\n  }),\n  referencesDocument: defineSearchOperator({\n    nameKey: 'search.operator.reference-document.name',\n    descriptionKey: 'search.operator.reference-document.description',\n    buttonValueComponent: SearchButtonValueReference as SearchOperatorButtonValue<ReferenceValue>,\n    groqFilter: ({value}) => (value?._ref ? `references(${toJSON(value._ref)})` : null),\n    initialValue: null,\n    inputComponent: SearchFilterReferenceInput as SearchOperatorInput<ReferenceValue>,\n    type: 'referencesDocument',\n  }),\n}\n","import {SearchFilterStringInput} from '../../components/filters/filter/inputs/string/String'\nimport {defineSearchOperator, type SearchOperatorInput} from './operatorTypes'\nimport {toJSON} from './operatorUtils'\n\n// @todo: don't manually cast `buttonValueComponent` and `inputComponent` once\n// we understand why `npm etl` fails with 'Unable to follow symbol' errors\nexport const slugOperators = {\n  slugEqual: defineSearchOperator({\n    nameKey: 'search.operator.slug-equal.name',\n    descriptionKey: 'search.operator.slug-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `${fieldPath}.current == ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'slugEqual',\n  }),\n  slugMatches: defineSearchOperator({\n    nameKey: 'search.operator.slug-contains.name',\n    descriptionKey: 'search.operator.slug-contains.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `${fieldPath}.current match ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    label: 'contains',\n    type: 'slugMatches',\n  }),\n  slugNotEqual: defineSearchOperator({\n    nameKey: 'search.operator.slug-not-equal.name',\n    descriptionKey: 'search.operator.slug-not-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `${fieldPath}.current != ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'slugNotEqual',\n  }),\n  slugNotMatches: defineSearchOperator({\n    nameKey: 'search.operator.slug-not-contains.name',\n    descriptionKey: 'search.operator.slug-not-contains.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `!(${fieldPath}.current match ${toJSON(value)})` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'slugNotMatches',\n  }),\n}\n","import {SearchFilterStringInput} from '../../components/filters/filter/inputs/string/String'\nimport {SearchFilterStringListInput} from '../../components/filters/filter/inputs/string/StringList'\nimport {defineSearchOperator, type SearchOperatorInput} from './operatorTypes'\nimport {toJSON} from './operatorUtils'\n\n// @todo: don't manually cast `buttonValueComponent` and `inputComponent` once\n// we understand why `npm etl` fails with 'Unable to follow symbol' errors\nexport const stringOperators = {\n  stringEqual: defineSearchOperator({\n    nameKey: 'search.operator.string-equal.name',\n    descriptionKey: 'search.operator.string-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `${fieldPath} == ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'stringEqual',\n  }),\n  stringListEqual: defineSearchOperator({\n    nameKey: 'search.operator.string-list-equal.name',\n    descriptionKey: 'search.operator.string-list-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `${fieldPath} == ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringListInput as SearchOperatorInput<string | number>,\n    type: 'stringListEqual',\n  }),\n  stringListNotEqual: defineSearchOperator({\n    nameKey: 'search.operator.string-list-not-equal.name',\n    descriptionKey: 'search.operator.string-list-not-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `${fieldPath} != ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringListInput as SearchOperatorInput<string | number>,\n    type: 'stringListNotEqual',\n  }),\n  stringMatches: defineSearchOperator({\n    nameKey: 'search.operator.string-contains.name',\n    descriptionKey: 'search.operator.string-contains.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `${fieldPath} match ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'stringMatches',\n  }),\n  stringNotEqual: defineSearchOperator({\n    nameKey: 'search.operator.string-not-equal.name',\n    descriptionKey: 'search.operator.string-not-equal.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `${fieldPath} != ${toJSON(value)}` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'stringNotEqual',\n  }),\n  stringNotMatches: defineSearchOperator({\n    nameKey: 'search.operator.string-not-contains.name',\n    descriptionKey: 'search.operator.string-not-contains.description',\n    groqFilter: ({fieldPath, value}) =>\n      value && fieldPath ? `!(${fieldPath} match ${toJSON(value)})` : null,\n    initialValue: null,\n    inputComponent: SearchFilterStringInput as SearchOperatorInput<string | number>,\n    type: 'stringNotMatches',\n  }),\n}\n","import {arrayOperators} from './arrayOperators'\nimport {assetOperators} from './assetOperators'\nimport {booleanOperators} from './booleanOperators'\nimport {dateOperators} from './dateOperators'\nimport {definedOperators} from './definedOperators'\nimport {numberOperators} from './numberOperators'\nimport {portableTextOperators} from './portableTextOperators'\nimport {referenceOperators} from './referenceOperators'\nimport {slugOperators} from './slugOperators'\nimport {stringOperators} from './stringOperators'\n\nconst searchOperators = {\n  ...arrayOperators,\n  ...assetOperators,\n  ...booleanOperators,\n  ...dateOperators,\n  ...definedOperators,\n  ...numberOperators,\n  ...portableTextOperators,\n  ...referenceOperators,\n  ...slugOperators,\n  ...stringOperators,\n}\n\ntype DefaultOperators = typeof searchOperators\n\n/**\n * @alpha\n */\nexport type SearchOperatorType = keyof DefaultOperators\n\n/**\n * @internal\n */\nexport const operatorDefinitions = Object.values(searchOperators)\n","import {COLOR_HUES, hues} from '@sanity/color'\nimport {darken, hasBadContrast, lighten, readableColor} from 'color2k'\nimport styled from 'styled-components'\n\nfunction pseudoRandomNumber(seed: string) {\n  const hashCode = seed\n    .split('')\n    // eslint-disable-next-line no-bitwise\n    .reduce((prevHash, currVal) => ((prevHash << 5) - prevHash + currVal.charCodeAt(0)) | 0, 0)\n  return Math.abs((hashCode * 16807) % 2147483647) / 2147483647\n}\n\nconst SvgText = styled.text`\n  font-family: ${({theme}) => theme.sanity.fonts.text.family};\n  font-weight: ${({theme}) => theme.sanity.fonts.text.weights.medium};\n  font-size: ${({theme}) => theme.sanity.fonts.text.sizes[1].fontSize}px;\n  transform: translateY(1px);\n`\n\n/**\n * Creates an icon element based on the input title\n */\nexport function createDefaultIcon(title: string, subtitle: string) {\n  const rng1 = pseudoRandomNumber(`${title} ${subtitle}`)\n\n  const huesWithoutGray = COLOR_HUES.filter((hue) => hue !== 'gray')\n  const colorHue = huesWithoutGray[Math.floor(rng1 * huesWithoutGray.length)]\n  const possibleTints = ['300', '400', '500', '600', '700'] as const\n  const rng2 = pseudoRandomNumber(rng1.toString())\n  const tint = possibleTints[Math.floor(rng2 * possibleTints.length)]\n  const color = hues[colorHue][tint].hex\n\n  const letters = title\n    // split by whitespace\n    .split(/\\s/g)\n    // replace all non-word characters with empty string\n    .map((word) => word.replace(/\\\\W/g, ''))\n    // remove empty strings\n    .filter(Boolean)\n    // take the first two words\n    .slice(0, 2)\n    // grab the first letter and make it upper case\n    .map((i) => i.charAt(0).toUpperCase())\n\n  const darkened = darken(color, 0.4)\n  const lightened = lighten(color, 0.4)\n\n  /* eslint-disable no-negated-condition */\n  // eslint-disable-next-line no-nested-ternary\n  const textColor = !hasBadContrast(color, 'readable', darkened)\n    ? darkened\n    : !hasBadContrast(color, 'readable', lightened)\n      ? lightened\n      : readableColor(color)\n  /* eslint-enable no-negated-condition */\n\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n      <rect width={32} height={32} rx={2} fill={color} />\n      <SvgText\n        x=\"50%\"\n        y=\"50%\"\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n        dominantBaseline=\"middle\"\n        fill={textColor}\n      >\n        {letters}\n      </SvgText>\n    </svg>\n  )\n}\n","import {type SchemaTypeDefinition} from '@sanity/types'\n\nimport {schemaTypesReducer} from './configPropertyReducers'\nimport {resolveConfigProperty} from './resolveConfigProperty'\nimport {type ConfigPropertyReducer, type PluginOptions} from './types'\n\ntype ConfigContext<T> = T extends ConfigPropertyReducer<any, infer TContext> ? TContext : never\ntype SchemaTypeContext = ConfigContext<typeof schemaTypesReducer>\n\ninterface ResolveSchemaTypesOptions {\n  config: PluginOptions\n  context: SchemaTypeContext\n}\n\n/**\n * @internal\n * @hidden\n */\nexport function resolveSchemaTypes({\n  config,\n  context,\n}: ResolveSchemaTypesOptions): SchemaTypeDefinition[] {\n  return resolveConfigProperty({\n    propertyName: 'schema.types',\n    config,\n    context,\n    initialValue: [],\n    reducer: schemaTypesReducer,\n  })\n}\n","import {type Schema} from '@sanity/types'\n\n/** @internal */\n// TODO: consider removing this error in favor of the `ConfigResolutionError`\nexport class SchemaError extends Error {\n  constructor(public schema: Schema) {\n    super('SchemaError')\n  }\n}\n","import {fromUrl} from '@sanity/bifur-client'\nimport {createClient, type SanityClient} from '@sanity/client'\nimport {type CurrentUser, type Schema, type SchemaValidationProblem} from '@sanity/types'\nimport {studioTheme} from '@sanity/ui'\nimport {type i18n} from 'i18next'\nimport {startCase} from 'lodash'\nimport {type ComponentType, createElement, type ElementType, isValidElement} from 'react'\nimport {isValidElementType} from 'react-is'\nimport {map, shareReplay} from 'rxjs/operators'\n\nimport {FileSource, ImageSource} from '../form/studio/assetSource'\nimport {type LocaleSource} from '../i18n'\nimport {prepareI18n} from '../i18n/i18nConfig'\nimport {createSchema} from '../schema'\nimport {type AuthStore, createAuthStore, isAuthStore} from '../store/_legacy'\nimport {validateWorkspaces} from '../studio'\nimport {filterDefinitions} from '../studio/components/navbar/search/definitions/defaultFilters'\nimport {operatorDefinitions} from '../studio/components/navbar/search/definitions/operators/defaultOperators'\nimport {type InitialValueTemplateItem, type Template, type TemplateItem} from '../templates'\nimport {EMPTY_ARRAY, isNonNullable} from '../util'\nimport {\n  documentActionsReducer,\n  documentBadgesReducer,\n  documentCommentsEnabledReducer,\n  documentInspectorsReducer,\n  documentLanguageFilterReducer,\n  fileAssetSourceResolver,\n  imageAssetSourceResolver,\n  initialDocumentActions,\n  initialDocumentBadges,\n  initialLanguageFilter,\n  internalTasksReducer,\n  newDocumentOptionsResolver,\n  newSearchEnabledReducer,\n  partialIndexingEnabledReducer,\n  resolveProductionUrlReducer,\n  schemaTemplatesReducer,\n  toolsReducer,\n} from './configPropertyReducers'\nimport {ConfigResolutionError} from './ConfigResolutionError'\nimport {createDefaultIcon} from './createDefaultIcon'\nimport {documentFieldActionsReducer, initialDocumentFieldActions} from './document'\nimport {resolveConfigProperty} from './resolveConfigProperty'\nimport {resolveSchemaTypes} from './resolveSchemaTypes'\nimport {SchemaError} from './SchemaError'\nimport {\n  type Config,\n  type ConfigContext,\n  type MissingConfigFile,\n  type PreparedConfig,\n  type SingleWorkspace,\n  type Source,\n  type SourceClientOptions,\n  type SourceOptions,\n  type WorkspaceOptions,\n  type WorkspaceSummary,\n} from './types'\n\ntype InternalSource = WorkspaceSummary['__internal']['sources'][number]\n\nconst isError = (p: SchemaValidationProblem) => p.severity === 'error'\n\nfunction normalizeIcon(\n  icon: ComponentType | ElementType | undefined,\n  title: string,\n  subtitle = '',\n): JSX.Element {\n  if (isValidElementType(icon)) return createElement(icon)\n  if (isValidElement(icon)) return icon\n  return createDefaultIcon(title, subtitle)\n}\n\nconst preparedWorkspaces = new WeakMap<SingleWorkspace | WorkspaceOptions, WorkspaceSummary>()\n\n/**\n * Takes in a config (created from the `defineConfig` function) and returns\n * an array of `WorkspaceSummary`. Note: this only partially resolves a config.\n *\n * For usage inside the Studio, it's preferred to pull the pre-resolved\n * workspaces and sources via `useWorkspace` or `useSource`. For usage outside\n * the Studio or for testing, use `resolveConfig`.\n *\n * @internal\n */\nexport function prepareConfig(\n  config: Config | MissingConfigFile,\n  options?: {basePath?: string},\n): PreparedConfig {\n  if (!Array.isArray(config) && 'missingConfigFile' in config) {\n    throw new ConfigResolutionError({\n      name: '',\n      type: 'configuration file',\n      causes: ['No `sanity.config.ts` file found', 'No `sanity.config.js` file found'],\n    })\n  }\n\n  const rootPath = getRootPath(options?.basePath)\n  const workspaceOptions: WorkspaceOptions[] | [SingleWorkspace] = Array.isArray(config)\n    ? config\n    : [config]\n\n  try {\n    validateWorkspaces({workspaces: workspaceOptions})\n  } catch (e) {\n    throw new ConfigResolutionError({\n      name: '',\n      type: 'workspace',\n      causes: [e.message],\n    })\n  }\n\n  const workspaces = workspaceOptions.map((rawWorkspace): WorkspaceSummary => {\n    if (preparedWorkspaces.has(rawWorkspace)) {\n      return preparedWorkspaces.get(rawWorkspace)!\n    }\n    const {unstable_sources: nestedSources = [], ...rootSource} = rawWorkspace\n    const sources = [rootSource as SourceOptions, ...nestedSources]\n\n    const resolvedSources = sources.map((source): InternalSource => {\n      const {projectId, dataset} = source\n\n      let schemaTypes\n      try {\n        schemaTypes = resolveSchemaTypes({\n          config: source,\n          context: {projectId, dataset},\n        })\n      } catch (e) {\n        throw new ConfigResolutionError({\n          name: source.name,\n          type: 'source',\n          causes: [e],\n        })\n      }\n\n      const schema = createSchema({\n        name: source.name,\n        types: schemaTypes,\n      })\n\n      const schemaValidationProblemGroups = schema._validation\n      const schemaErrors = schemaValidationProblemGroups?.filter((msg) =>\n        msg.problems.some(isError),\n      )\n\n      if (schemaValidationProblemGroups && schemaErrors?.length) {\n        // TODO: consider using the `ConfigResolutionError`\n        throw new SchemaError(schema)\n      }\n\n      const auth = getAuthStore(source)\n      const i18n = prepareI18n(source)\n      const source$ = auth.state.pipe(\n        map(({client, authenticated, currentUser}) => {\n          return resolveSource({\n            config: source,\n            client,\n            currentUser,\n            schema,\n            authenticated,\n            auth,\n            i18n,\n          })\n        }),\n        shareReplay(1),\n      )\n\n      return {\n        name: source.name,\n        projectId: source.projectId,\n        dataset: source.dataset,\n        title: source.title || startCase(source.name),\n        auth,\n        schema,\n        i18n: i18n.source,\n        source: source$,\n      }\n    })\n\n    const title = rootSource.title || startCase(rootSource.name)\n\n    const workspaceSummary: WorkspaceSummary = {\n      type: 'workspace-summary',\n      auth: resolvedSources[0].auth,\n      basePath: joinBasePath(rootPath, rootSource.basePath),\n      dataset: rootSource.dataset,\n      schema: resolvedSources[0].schema,\n      i18n: resolvedSources[0].i18n,\n      customIcon: !!rootSource.icon,\n      icon: normalizeIcon(rootSource.icon, title, `${rootSource.projectId} ${rootSource.dataset}`),\n      name: rootSource.name || 'default',\n      projectId: rootSource.projectId,\n      theme: rootSource.theme || studioTheme,\n      title,\n      subtitle: rootSource.subtitle,\n      __internal: {\n        sources: resolvedSources,\n      },\n      tasks: rawWorkspace.unstable_tasks ?? {enabled: true},\n    }\n    preparedWorkspaces.set(rawWorkspace, workspaceSummary)\n    return workspaceSummary\n  })\n\n  return {type: 'prepared-config', workspaces}\n}\n\nfunction getAuthStore(source: SourceOptions): AuthStore {\n  if (isAuthStore(source.auth)) {\n    return source.auth\n  }\n\n  const clientFactory = source.unstable_clientFactory || createClient\n  const {projectId, dataset, apiHost} = source\n  return createAuthStore({apiHost, ...source.auth, clientFactory, dataset, projectId})\n}\n\ninterface ResolveSourceOptions {\n  config: SourceOptions\n  schema: Schema\n  client: SanityClient\n  currentUser: CurrentUser | null\n  authenticated: boolean\n  auth: AuthStore\n  i18n: {i18next: i18n; source: LocaleSource}\n}\n\nfunction getBifurClient(client: SanityClient, auth: AuthStore) {\n  const bifurVersionedClient = client.withConfig({apiVersion: '2022-06-30'})\n  const {dataset, url: baseUrl, requestTagPrefix = 'sanity.studio'} = bifurVersionedClient.config()\n  const url = `${baseUrl.replace(/\\/+$/, '')}/socket/${dataset}`.replace(/^http/, 'ws')\n  const urlWithTag = `${url}?tag=${requestTagPrefix}`\n\n  const options = auth.token ? {token$: auth.token} : {}\n  return fromUrl(urlWithTag, options)\n}\n\nfunction resolveSource({\n  config,\n  client,\n  currentUser,\n  schema,\n  authenticated,\n  auth,\n  i18n,\n}: ResolveSourceOptions): Source {\n  const {dataset, projectId} = config\n  const bifur = getBifurClient(client, auth)\n  const errors: unknown[] = []\n  const clients: Record<string, SanityClient> = {}\n  const getClient = (options: SourceClientOptions): SanityClient => {\n    if (!options || !options.apiVersion) {\n      throw new Error('Missing required `apiVersion` option')\n    }\n\n    if (!clients[options.apiVersion]) {\n      clients[options.apiVersion] = client.withConfig(options)\n    }\n\n    return clients[options.apiVersion]\n  }\n\n  const context: ConfigContext & {client: SanityClient} = {\n    client,\n    getClient,\n    currentUser,\n    dataset,\n    projectId,\n    schema,\n    i18n: i18n.source,\n  }\n\n  // <TEMPORARY UGLY HACK TO PRINT DEPRECATION WARNINGS ON USE>\n  /* eslint-disable no-proto */\n  const wrappedClient = client as any\n  context.client = [...Object.keys(client), ...Object.keys(wrappedClient.__proto__)].reduce(\n    (acc, key) => {\n      const original = Object.hasOwnProperty.call(client, key)\n        ? wrappedClient[key]\n        : wrappedClient.__proto__[key]\n\n      return Object.defineProperty(acc, key, {\n        get() {\n          console.warn(\n            '`configContext.client` is deprecated and will be removed in the next release! Use `context.getClient({apiVersion: \"2021-06-07\"})` instead',\n          )\n          return original\n        },\n      })\n    },\n    {},\n  ) as any as SanityClient\n  /* eslint-enable no-proto */\n  // </TEMPORARY UGLY HACK TO PRINT DEPRECATION WARNINGS ON USE>\n\n  let templates!: Source['templates']\n  try {\n    templates = resolveConfigProperty({\n      config,\n      context,\n      propertyName: 'schema.templates',\n      reducer: schemaTemplatesReducer,\n      initialValue: schema\n        .getTypeNames()\n        .filter((typeName) => !/^sanity\\./.test(typeName))\n        .map((typeName) => schema.get(typeName))\n        .filter(isNonNullable)\n        .filter((schemaType) => schemaType.type?.name === 'document')\n        .map((schemaType) => {\n          const template: Template = {\n            id: schemaType.name,\n            schemaType: schemaType.name,\n            title: schemaType.title || schemaType.name,\n            icon: schemaType.icon,\n            value: schemaType.initialValue || {_type: schemaType.name},\n          }\n\n          return template\n        }),\n    })\n    // TODO: validate templates\n    // TODO: validate that each one has a unique template ID\n  } catch (e) {\n    throw new ConfigResolutionError({\n      name: config.name,\n      type: 'source',\n      causes: [e],\n    })\n  }\n\n  let tools!: Source['tools']\n  try {\n    tools = resolveConfigProperty({\n      config,\n      context,\n      initialValue: [],\n      propertyName: 'tools',\n      reducer: toolsReducer,\n    })\n  } catch (e) {\n    throw new ConfigResolutionError({\n      name: config.name,\n      type: 'source',\n      causes: [e],\n    })\n  }\n\n  // In this case we want to throw an error because it is not possible to have\n  // a tool with the name \"tool\" due to logic that happens in the router.\n  if (tools.some(({name}) => name === 'tool')) {\n    throw new Error('A tool cannot have the name \"tool\". Please enter a different name.')\n  }\n\n  const initialTemplatesResponses = templates\n    // filter out the ones with parameters to fill\n    .filter((template) => !template.parameters?.length)\n    .map(\n      (template): TemplateItem => ({\n        templateId: template.id,\n        description: template.description,\n        icon: template.icon,\n        title: template.title,\n      }),\n    )\n\n  const templateMap = templates.reduce((acc, template) => {\n    acc.set(template.id, template)\n    return acc\n  }, new Map<string, Template>())\n\n  // TODO: extract this function\n  const resolveNewDocumentOptions: Source['document']['resolveNewDocumentOptions'] = (\n    creationContext,\n  ) => {\n    const {schemaType: schemaTypeName} = creationContext\n\n    const templateResponses = resolveConfigProperty({\n      config,\n      context: {...context, creationContext},\n      initialValue: initialTemplatesResponses,\n      propertyName: 'document.resolveNewDocumentOptions',\n      reducer: newDocumentOptionsResolver,\n    })\n\n    const templateErrors: unknown[] = []\n\n    // TODO: validate template responses\n    // ensure there is a matching template per each one\n    if (templateErrors.length) {\n      throw new ConfigResolutionError({\n        name: config.name,\n        type: 'source',\n        causes: templateErrors,\n      })\n    }\n\n    return (\n      templateResponses\n        // take the template responses and transform them into the formal\n        // `InitialValueTemplateItem`\n        .map((response, index): InitialValueTemplateItem => {\n          const template = templateMap.get(response.templateId)\n          if (!template) {\n            throw new Error(`Could not find template with ID \\`${response.templateId}\\``)\n          }\n\n          const schemaType = schema.get(template.schemaType)\n\n          if (!schemaType) {\n            throw new Error(\n              `Could not find matching schema type \\`${template.schemaType}\\` for template \\`${template.id}\\``,\n            )\n          }\n\n          const title = response.title || template.title\n          // Don't show the type name as subtitle if it's the same as the template name\n          const defaultSubtitle = schemaType?.title === title ? undefined : schemaType?.title\n\n          return {\n            id: `${response.templateId}-${index}`,\n            templateId: response.templateId,\n            type: 'initialValueTemplateItem',\n            title,\n            i18n: response.i18n || template.i18n,\n            subtitle: response.subtitle || defaultSubtitle,\n            description: response.description || template.description,\n            icon: response.icon || template.icon || schemaType?.icon,\n            initialDocumentId: response.initialDocumentId,\n            parameters: response.parameters,\n            schemaType: template.schemaType,\n          }\n        })\n        .filter((item) => {\n          // if we are in a creationContext where there is no schema type,\n          // then keep everything\n          if (!schemaTypeName) return true\n\n          // If we are in a 'document' creationContext then keep everything\n          if (creationContext.type === 'document') return true\n\n          // else only keep the `schemaType`s that match the creationContext\n          return schemaTypeName === templateMap.get(item.templateId)?.schemaType\n        })\n    )\n  }\n\n  let staticInitialValueTemplateItems!: InitialValueTemplateItem[]\n  try {\n    staticInitialValueTemplateItems = resolveNewDocumentOptions({type: 'global'})\n  } catch (e) {\n    errors.push(e)\n  }\n\n  if (errors.length) {\n    throw new ConfigResolutionError({\n      name: config.name,\n      type: 'source',\n      causes: errors,\n    })\n  }\n\n  const source: Source = {\n    type: 'source',\n    name: config.name,\n    title: config.title || startCase(config.name),\n    schema,\n    getClient,\n    dataset,\n    projectId,\n    tools,\n    currentUser,\n    authenticated,\n    templates,\n    auth,\n    i18n: i18n.source,\n    // eslint-disable-next-line camelcase\n    __internal_tasks: internalTasksReducer({\n      config,\n    }),\n    document: {\n      actions: (partialContext) =>\n        resolveConfigProperty({\n          config,\n          context: {...context, ...partialContext},\n          initialValue: initialDocumentActions,\n          propertyName: 'document.actions',\n          reducer: documentActionsReducer,\n        }),\n      badges: (partialContext) =>\n        resolveConfigProperty({\n          config,\n          context: {...context, ...partialContext},\n          initialValue: initialDocumentBadges,\n          propertyName: 'document.badges',\n          reducer: documentBadgesReducer,\n        }),\n      unstable_fieldActions: (partialContext) =>\n        resolveConfigProperty({\n          config,\n          context: {...context, ...partialContext},\n          initialValue: initialDocumentFieldActions,\n          propertyName: 'document.unstable_fieldActions',\n          reducer: documentFieldActionsReducer,\n        }),\n      inspectors: (partialContext) =>\n        resolveConfigProperty({\n          config,\n          context: {...context, ...partialContext},\n          initialValue: EMPTY_ARRAY,\n          propertyName: 'document.inspectors',\n          reducer: documentInspectorsReducer,\n        }),\n      resolveProductionUrl: (partialContext) =>\n        resolveConfigProperty({\n          config,\n          context: {...context, ...partialContext},\n          initialValue: undefined,\n          propertyName: 'resolveProductionUrl',\n          asyncReducer: resolveProductionUrlReducer,\n        }),\n      resolveNewDocumentOptions,\n      unstable_languageFilter: (partialContext) =>\n        resolveConfigProperty({\n          config,\n          context: {...context, ...partialContext},\n          initialValue: initialLanguageFilter,\n          propertyName: 'document.unstable_languageFilter',\n          reducer: documentLanguageFilterReducer,\n        }),\n\n      unstable_comments: {\n        enabled: (partialContext) => {\n          return documentCommentsEnabledReducer({\n            context: partialContext,\n            config,\n            initialValue: true,\n          })\n        },\n      },\n    },\n\n    form: {\n      file: {\n        assetSources: resolveConfigProperty({\n          config,\n          context,\n          initialValue: [FileSource],\n          propertyName: 'formBuilder.file.assetSources',\n          reducer: fileAssetSourceResolver,\n        }),\n        directUploads:\n          // TODO: consider refactoring this to `noDirectUploads` or similar\n          // default value for this is `true`\n          config.form?.file?.directUploads === undefined ? true : config.form.file.directUploads,\n      },\n      image: {\n        assetSources: resolveConfigProperty({\n          config,\n          context,\n          initialValue: [ImageSource],\n          propertyName: 'formBuilder.image.assetSources',\n          reducer: imageAssetSourceResolver,\n        }),\n        directUploads:\n          // TODO: consider refactoring this to `noDirectUploads` or similar\n          // default value for this is `true`\n          config.form?.image?.directUploads === undefined ? true : config.form.image.directUploads,\n      },\n    },\n\n    search: {\n      filters: filterDefinitions,\n      operators: operatorDefinitions,\n      unstable_partialIndexing: {\n        enabled: partialIndexingEnabledReducer({\n          config,\n          initialValue: config.search?.unstable_partialIndexing?.enabled ?? false,\n        }),\n      },\n      unstable_enableNewSearch: resolveConfigProperty({\n        config,\n        context,\n        reducer: newSearchEnabledReducer,\n        propertyName: 'search.unstable_enableNewSearch',\n        initialValue: false,\n      }),\n      // we will use this when we add search config to PluginOptions\n      /*filters: resolveConfigProperty({\n        config,\n        context: context,\n        initialValue: filterDefinitions,\n        propertyName: 'search.filters',\n        reducer: searchFilterReducer,\n      }),\n      operators: resolveConfigProperty({\n        config,\n        context: context,\n        initialValue: operatorDefinitions as SearchOperatorDefinition[],\n        propertyName: 'search.operators',\n        reducer: searchOperatorsReducer,\n      }),*/\n    },\n\n    __internal: {\n      bifur,\n      i18next: i18n.i18next,\n      staticInitialValueTemplateItems,\n      options: config,\n    },\n  }\n\n  return source\n}\n\n/**\n * Validate and normalize the `basePath` option.\n * The root path will be used to prepend workspace-specific base paths.\n * For instance, a `/studio` root path is joined with `/design` to become `/studio/design`.\n *\n * @param basePath - The base path to validate. If not set, an empty string will be returned.\n * @returns A normalized string\n * @throws ConfigResolutionError if the basePath is invalid\n * @internal\n */\nfunction getRootPath(basePath?: string) {\n  const rootPath = basePath || ''\n  if (typeof rootPath !== 'string' || (rootPath.length > 0 && !rootPath.startsWith('/'))) {\n    throw new ConfigResolutionError({\n      name: '',\n      type: 'options',\n      causes: ['basePath must be a string, and must start with a slash'],\n    })\n  }\n\n  // Since we'll be appending other base paths, we don't want to end up with double slashes\n  return rootPath === '/' ? '' : rootPath\n}\n\n/**\n * Join the root path of the studio with a workspace base path\n *\n * @param rootPath - The root path to prepend to the base path\n * @param basePath - The base path of the workspace (can be empty)\n * @returns A normalized and joined, complete base path for a workspace\n * @internal\n */\nfunction joinBasePath(rootPath: string, basePath?: string) {\n  const joined = [rootPath, basePath || '']\n    // Remove leading/trailing slashes\n    .map((path) => path.replace(/^\\/+/g, '').replace(/\\/+$/g, ''))\n    // Remove empty segments\n    .filter(Boolean)\n    // Join the segments\n    .join('/')\n\n  return `/${joined}`\n}\n","import {type ReactNode, useMemo} from 'react'\n\nimport {type Config, prepareConfig} from '../../config'\nimport {WorkspacesContext} from './WorkspacesContext'\n\n/** @internal */\nexport interface WorkspacesProviderProps {\n  config: Config\n  children: ReactNode\n  basePath?: string\n}\n\n/** @internal */\nexport function WorkspacesProvider({config, children, basePath}: WorkspacesProviderProps) {\n  const {workspaces} = useMemo(() => prepareConfig(config, {basePath}), [config, basePath])\n  return <WorkspacesContext.Provider value={workspaces}>{children}</WorkspacesContext.Provider>\n}\n","import {createContext, type ReactNode, useContext} from 'react'\n\nimport {type RouterHistory} from './types'\n\n/**\n * Internal use only. Userland should leverage the public `useRouter` APIs.\n * @internal\n */\nconst RouterHistoryContext = createContext<RouterHistory | null>(null)\n\n/** @internal */\nexport function RouterHistoryProvider({\n  children,\n  history,\n}: {\n  children: ReactNode\n  history: RouterHistory\n}) {\n  return <RouterHistoryContext.Provider value={history}>{children}</RouterHistoryContext.Provider>\n}\n\n/** @internal */\nexport function useRouterHistory(): RouterHistory {\n  const value = useContext(RouterHistoryContext)\n  if (!value) throw new Error('Could not find `RouterHistoryProvider` context')\n  return value\n}\n","import {createContext} from 'react'\n\nimport {type WorkspaceSummary} from '../../config'\n\n/** @internal */\nexport interface ActiveWorkspaceMatcherContextValue {\n  activeWorkspace: WorkspaceSummary\n  setActiveWorkspace: (workspaceName: string) => void\n}\n\n/** @internal */\nexport const ActiveWorkspaceMatcherContext =\n  createContext<ActiveWorkspaceMatcherContextValue | null>(null)\n","import {memo, type ReactNode, useMemo} from 'react'\n\nimport {type RouterHistory} from '../router'\nimport {RouterHistoryProvider} from '../router/RouterHistoryContext'\nimport {type WorkspacesContextValue} from '../workspaces'\nimport {\n  ActiveWorkspaceMatcherContext,\n  type ActiveWorkspaceMatcherContextValue,\n} from './ActiveWorkspaceMatcherContext'\n\n/** @internal */\nexport const ActiveWorkspaceMatcherProvider = memo(function ActiveWorkspaceMatcherContextProvider({\n  children,\n  history,\n  activeWorkspace,\n  setActiveWorkspace,\n}: {\n  children: ReactNode\n  history: RouterHistory\n  activeWorkspace: WorkspacesContextValue[number]\n  setActiveWorkspace: (workspaceName: string) => void\n}) {\n  const value = useMemo(\n    () =>\n      ({\n        activeWorkspace,\n        setActiveWorkspace,\n      }) satisfies ActiveWorkspaceMatcherContextValue,\n    [activeWorkspace, setActiveWorkspace],\n  )\n\n  return (\n    <ActiveWorkspaceMatcherContext.Provider value={value}>\n      <RouterHistoryProvider history={history}>{children}</RouterHistoryProvider>\n    </ActiveWorkspaceMatcherContext.Provider>\n  )\n})\n","import {escapeRegExp} from 'lodash'\n\nimport {type NormalizedWorkspace} from './types'\n\n/**\n * Recursively creates a matching expression.\n * A list over normalized workspaces, like\n * ```\n * [\n *  {workspace: {}, name: 'default', basePath: '/studio/deep/shared/test'},\n *  {workspace: {}, name: 'playground', basePath: '/studio/deep/shared/playground'}\n *  {workspace: {}, name: 'staging', basePath: '/studio/deep/shared/staging'}\n * ]\n * ```\n * Becomes a Regex like `/^(\\/studio(\\/deep(\\/shared(\\/|$))?(\\/|$))?(\\/|$))?$/i`\n * @internal\n */\nexport function createCommonBasePathRegex(workspaces: NormalizedWorkspace[]): RegExp {\n  const workspaceSegments = workspaces.map((workspace) =>\n    // gets the segments from the basePath\n    workspace.basePath\n      // removes the leading `/`\n      .substring(1)\n      .split('/'),\n  )\n\n  // this common base path is used to check if we should redirect. it's the base\n  // path that is common between all the workspaces.\n  const commonBasePath = workspaceSegments.reduce((commonSegments, segments) => {\n    for (let i = 0; i < commonSegments.length; i++) {\n      const commonSegment = commonSegments[i]\n      const segment = segments[i].toLowerCase()\n\n      if (commonSegment !== segment) {\n        return commonSegments.slice(0, i)\n      }\n    }\n\n    return commonSegments\n  })\n\n  // recursively creates a matching expression\n  // `/foo/bar/baz` becomes `(\\/foo(\\/bar(\\/baz(\\/|$))?(\\/|$))?(\\/|$))?`\n  function createCommonBasePathRegexRecursively([first, ...rest]: string[]): string {\n    if (!first) return ''\n    return `(\\\\/${escapeRegExp(first)}${createCommonBasePathRegexRecursively(rest)}(\\\\/|$))?`\n  }\n\n  return new RegExp(`^${createCommonBasePathRegexRecursively(commonBasePath)}$`, 'i')\n}\n","import {type WorkspacesContextValue} from '../workspaces'\nimport {type NormalizedWorkspace} from './types'\n\n/** @internal */\nexport interface MatchWorkspaceOptions {\n  workspaces: NormalizedWorkspace[]\n  pathname: string\n  basePathRegex: RegExp\n}\n\n/** @internal */\nexport type MatchWorkspaceResult =\n  | {type: 'match'; workspace: WorkspacesContextValue[number]}\n  | {type: 'redirect'; pathname: string}\n  | {type: 'not-found'}\n\n/**\n * Given a pathname and a list of workspaces, returns either a workspace match,\n * a redirect, or not-found.\n *\n * @internal\n */\nexport function matchWorkspace({\n  pathname,\n  workspaces,\n  basePathRegex,\n}: MatchWorkspaceOptions): MatchWorkspaceResult {\n  const [firstWorkspace] = workspaces\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  for (const {workspace, basePath, basePathRegex} of workspaces) {\n    // this regex ends with a `(\\\\/|$)` (forward slash or end) to prevent false\n    // matches where the pathname is a false subset of the current pathname.\n    // e.g. if the `workspace.basePath` is `/base/foobar` and the current\n    // pathname is `/base/foo`, then that should not be a match\n    if (basePathRegex.test(pathname) || basePath === '/') {\n      return {type: 'match', workspace}\n    }\n  }\n\n  // if the pathname is only a leading slash, then return a redirect\n  if (pathname === '/') {\n    return {type: 'redirect', pathname: firstWorkspace.basePath}\n  }\n\n  if (basePathRegex.test(pathname)) {\n    // redirect to the first workspace configured\n    return {type: 'redirect', pathname: firstWorkspace.basePath}\n  }\n\n  // if the pathname was not a subset of the common base path, then the route\n  // the user is looking for is not present and we should show some sort of 404\n  // screen\n  return {type: 'not-found'}\n}\n","import {escapeRegExp} from 'lodash'\nimport {useMemo} from 'react'\n\nimport {type WorkspacesContextValue} from '../workspaces'\nimport {type NormalizedWorkspace} from './types'\n\n/** @internal */\nexport function useNormalizedWorkspaces(workspaces: WorkspacesContextValue): NormalizedWorkspace[] {\n  return useMemo(\n    () => normalizedWorkspaces(workspaces) satisfies NormalizedWorkspace[],\n    [workspaces],\n  )\n}\n\n/** @internal */\nexport function normalizedWorkspaces(workspaces: WorkspacesContextValue): NormalizedWorkspace[] {\n  return workspaces.map((workspace) => {\n    const basePath = workspace.basePath || '/'\n    return {\n      workspace,\n      name: workspace.name,\n      basePath,\n      // this regex ends with a `(\\\\/|$)` (forward slash or end) to prevent false\n      // matches where the pathname is a false subset of the current pathname.\n      // e.g. if the `workspace.basePath` is `/base/foobar` and the current\n      // pathname is `/base/foo`, then that should not be a match\n      basePathRegex: new RegExp(`^${escapeRegExp(basePath)}(\\\\/|$)`, 'i'),\n    } satisfies NormalizedWorkspace\n  })\n}\n","import {useMemo, useState} from 'react'\nimport {useSyncExternalStoreWithSelector} from 'use-sync-external-store/with-selector'\n\nimport {type RouterHistory} from '../router'\nimport {type WorkspacesContextValue} from '../workspaces'\nimport {createCommonBasePathRegex} from './createCommonBasePathRegex'\nimport {matchWorkspace, type MatchWorkspaceResult} from './matchWorkspace'\nimport {useNormalizedWorkspaces} from './useNormalizedWorkspaces'\n\n/**\n * Reads the `history` pathname and responds to changes, returns matching workspace\n *  @internal\n */\nexport function useSyncPathnameWithWorkspace(\n  history: RouterHistory,\n  _workspaces: WorkspacesContextValue,\n): MatchWorkspaceResult {\n  // Workspaces changes infrequently, but router matching can fire a lot. And so there's value in memoizing the normalized\n  // to avoid creating new arrays on every render.\n  const workspaces = useNormalizedWorkspaces(_workspaces)\n  // As with `workspaces` there's value in only create the recursive basePath regex if there's `workspaces` have at all changed\n  const basePathRegex = useMemo(() => createCommonBasePathRegex(workspaces), [workspaces])\n  // history.location is mutable, so we snapshot it with useState to preserve the original pathname\n  const [serverSnapshot] = useState(() => history.location.pathname)\n\n  // React will only re-subscribe if store.subscribe changes identity, so by memoizing the whole store\n  // we ensure that if any of the dependencies used by store.selector changes, we'll re-subscribe.\n  // If we don't, we risk hot reload seeing stale workspace configs as the user is editing them.\n  const store = useMemo(() => {\n    return {\n      subscribe: (onStoreChange: () => void) => history.listen(onStoreChange),\n      getSnapshot: () => history.location.pathname,\n      getServerSnapshot: () => serverSnapshot,\n      selector: (pathname: string) => matchWorkspace({basePathRegex, pathname, workspaces}),\n      isEqual: (a: MatchWorkspaceResult, b: MatchWorkspaceResult) => {\n        if (a.type !== b.type) return false\n        switch (a.type) {\n          case 'match':\n            return a.workspace === (b as typeof a).workspace\n          case 'redirect':\n            return a.pathname === (b as typeof a).pathname\n          case 'not-found':\n            return true\n          default:\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any -- TS thinks this will never happen, but the point of the error is if it somehow did\n            throw new Error(`Unknown type: ${(a as any).type}`)\n        }\n      },\n    }\n  }, [basePathRegex, history, serverSnapshot, workspaces])\n\n  return useSyncExternalStoreWithSelector<string, MatchWorkspaceResult>(\n    store.subscribe,\n    store.getSnapshot,\n    store.getServerSnapshot,\n    store.selector,\n    store.isEqual,\n  )\n}\n","import {createBrowserHistory, createMemoryHistory} from 'history'\nimport {type ComponentType, type ReactNode, useCallback, useEffect, useMemo} from 'react'\n\nimport {type RouterHistory} from '../router'\nimport {useWorkspaces} from '../workspaces'\nimport {ActiveWorkspaceMatcherProvider} from './ActiveWorkspaceMatcherProvider'\nimport {useSyncPathnameWithWorkspace} from './useSyncPathnameWithWorkspace'\n\n/** @internal */\nexport interface ActiveWorkspaceMatcherProps {\n  children: ReactNode\n  unstable_history?: RouterHistory\n  NotFoundComponent: ComponentType<{onNavigateToDefaultWorkspace: () => void}>\n  LoadingComponent: ComponentType\n}\n\nconst createHistory = () =>\n  typeof document === 'undefined' ? createMemoryHistory() : createBrowserHistory()\n\n/** @internal */\nexport function ActiveWorkspaceMatcher({\n  children,\n  LoadingComponent,\n  NotFoundComponent,\n  unstable_history: historyProp,\n}: ActiveWorkspaceMatcherProps) {\n  const workspaces = useWorkspaces()\n  const history = useMemo(() => historyProp || createHistory(), [historyProp])\n\n  const setActiveWorkspaceName = useCallback(\n    (workspaceName: string) => {\n      const foundWorkspace = workspaces.find((workspace) => workspace.name === workspaceName)\n      if (foundWorkspace) {\n        history.push(foundWorkspace.basePath)\n      }\n    },\n    [history, workspaces],\n  )\n  const handleNavigateToDefaultWorkspace = useCallback(() => {\n    setActiveWorkspaceName(workspaces[0].name)\n  }, [setActiveWorkspaceName, workspaces])\n\n  const result = useSyncPathnameWithWorkspace(history, workspaces)\n\n  useEffect(() => {\n    if (result.type === 'redirect') {\n      history.replace(result.pathname)\n    }\n  }, [history, result])\n\n  switch (result.type) {\n    case 'match':\n      return (\n        <ActiveWorkspaceMatcherProvider\n          activeWorkspace={result.workspace}\n          history={history}\n          setActiveWorkspace={setActiveWorkspaceName}\n        >\n          {children}\n        </ActiveWorkspaceMatcherProvider>\n      )\n    case 'redirect':\n      return <LoadingComponent />\n    case 'not-found':\n      return <NotFoundComponent onNavigateToDefaultWorkspace={handleNavigateToDefaultWorkspace} />\n    default:\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any -- TS thinks this will never happen, but the point of the error is if it somehow did\n      throw new Error(`Unknown type: ${(result as any).type}`)\n  }\n}\n","import {useContext} from 'react'\n\nimport {\n  ActiveWorkspaceMatcherContext,\n  type ActiveWorkspaceMatcherContextValue,\n} from './ActiveWorkspaceMatcherContext'\n\n/** @internal */\nexport function useActiveWorkspace(): ActiveWorkspaceMatcherContextValue {\n  const value = useContext(ActiveWorkspaceMatcherContext)\n  if (!value) throw new Error('Could not find `ActiveWorkspaceMatcher` context')\n  return value\n}\n","import {createContext} from 'react'\n\nimport {type AddonDatasetContextValue} from './types'\n\n/**\n * @beta\n * @hidden\n */\nexport const AddonDatasetContext = createContext<AddonDatasetContextValue | null>(null)\n","import {DesktopIcon, MoonIcon, SunIcon} from '@sanity/icons'\nimport {studioTheme, type ThemeColorSchemeKey, ThemeProvider, usePrefersDark} from '@sanity/ui'\nimport {\n  type ComponentType,\n  createContext,\n  type ReactNode,\n  useContext,\n  useEffect,\n  useMemo,\n  useSyncExternalStore,\n} from 'react'\n\nimport {type TFunction} from '../i18n'\nimport {type StudioThemeColorSchemeKey} from '../theme/types'\n\n/**\n * Used to keep track of the internal value, which can be \"system\" in addition to \"light\" and \"dark\"\n * @internal\n */\nexport const ColorSchemeValueContext = createContext<StudioThemeColorSchemeKey | null>(null)\n\n/**\n * The setter for ColorSchemeValueContext, in a separate context to avoid unnecessary re-renders\n * If set to false then the UI should adjust to reflect that the Studio can't change the color scheme\n * @internal\n */\nexport const ColorSchemeSetValueContext = createContext<\n  ((nextScheme: StudioThemeColorSchemeKey) => void) | false | null\n>(null)\n\n/** @internal */\nfunction useSystemScheme(): ThemeColorSchemeKey {\n  const prefersDark = usePrefersDark()\n  return prefersDark ? 'dark' : 'light'\n}\n\nfunction ColorThemeProvider({\n  children,\n  scheme: _scheme,\n}: {\n  children: ReactNode\n  scheme: StudioThemeColorSchemeKey\n}) {\n  const systemScheme = useSystemScheme()\n  const scheme = _scheme === 'system' ? systemScheme : _scheme\n\n  return (\n    <ThemeProvider scheme={scheme} theme={studioTheme}>\n      {/* Note: this is a fallback ThemeProvider that is for any components */}\n      {/* that may render before the StudioThemeProvider renders. this is */}\n      {/* required because the StudioThemeProvider has a dependence on the */}\n      {/* active workspace provided via the ActiveWorkspaceMatcher */}\n      {children}\n    </ThemeProvider>\n  )\n}\n\nconst LOCAL_STORAGE_KEY = 'sanityStudio:ui:colorScheme'\n\n/** @internal */\nexport interface ColorSchemeProviderProps {\n  children: ReactNode\n  onSchemeChange?: (nextScheme: StudioThemeColorSchemeKey) => void\n  scheme?: StudioThemeColorSchemeKey\n}\n\n/** @internal */\nexport function ColorSchemeProvider({\n  children,\n  onSchemeChange,\n  scheme: schemeProp,\n}: ColorSchemeProviderProps) {\n  if (schemeProp) {\n    return (\n      <ColorSchemeCustomProvider scheme={schemeProp} onSchemeChange={onSchemeChange}>\n        {children}\n      </ColorSchemeCustomProvider>\n    )\n  }\n\n  return (\n    <ColorSchemeLocalStorageProvider onSchemeChange={onSchemeChange}>\n      {children}\n    </ColorSchemeLocalStorageProvider>\n  )\n}\n\n/**\n * Uses useSyncExternalStore to ensure that localStorage is accessed in a SSR hydration compatible way\n * @internal\n */\nexport function ColorSchemeLocalStorageProvider({\n  children,\n  onSchemeChange,\n}: Pick<ColorSchemeProviderProps, 'children' | 'onSchemeChange'>) {\n  const store = useMemo(() => {\n    let snapshot: StudioThemeColorSchemeKey\n    const subscribers = new Set<() => void>()\n\n    return {\n      subscribe: (onStoreChange: () => void) => {\n        if (!snapshot) {\n          snapshot = getScheme(localStorage.getItem(LOCAL_STORAGE_KEY)) || 'system'\n        }\n        subscribers.add(onStoreChange)\n        return () => {\n          subscribers.delete(onStoreChange)\n        }\n      },\n      getSnapshot: () => snapshot,\n      setSnapshot: (nextScheme: StudioThemeColorSchemeKey) => {\n        snapshot = getScheme(nextScheme)\n        for (const subscription of subscribers) {\n          subscription()\n        }\n      },\n      // Only called during server-side rendering, and hydration if using hydrateRoot\n      // https://beta.reactjs.org/apis/react/useSyncExternalStore#adding-support-for-server-rendering\n      getServerSnapshot: () => 'system',\n    }\n  }, [])\n  const scheme = useSyncExternalStore(store.subscribe, store.getSnapshot, store.getServerSnapshot)\n\n  useEffect(() => {\n    if (typeof onSchemeChange === 'function') {\n      onSchemeChange(scheme)\n    }\n    localStorage.setItem(LOCAL_STORAGE_KEY, scheme)\n  }, [onSchemeChange, scheme])\n\n  return (\n    <ColorSchemeSetValueContext.Provider value={store.setSnapshot}>\n      <ColorSchemeValueContext.Provider value={scheme}>\n        <ColorThemeProvider scheme={scheme}>{children}</ColorThemeProvider>\n      </ColorSchemeValueContext.Provider>\n    </ColorSchemeSetValueContext.Provider>\n  )\n}\n\nfunction getScheme(scheme: unknown): StudioThemeColorSchemeKey {\n  switch (scheme) {\n    case 'dark':\n    case 'light':\n      return scheme\n    default:\n      return 'system'\n  }\n}\n\n/**\n * If the `scheme` prop is provided we don't need to setup any logic to handle localStorage\n * @internal\n */\nexport function ColorSchemeCustomProvider({\n  children,\n  onSchemeChange,\n  scheme,\n}: Pick<ColorSchemeProviderProps, 'children' | 'onSchemeChange'> & {\n  scheme: StudioThemeColorSchemeKey\n}) {\n  return (\n    <ColorSchemeSetValueContext.Provider\n      value={typeof onSchemeChange === 'function' ? onSchemeChange : false}\n    >\n      <ColorSchemeValueContext.Provider value={scheme}>\n        <ColorThemeProvider scheme={scheme}>{children}</ColorThemeProvider>\n      </ColorSchemeValueContext.Provider>\n    </ColorSchemeSetValueContext.Provider>\n  )\n}\n\n/** @alpha */\nexport function useColorSchemeSetValue() {\n  const setValue = useContext(ColorSchemeSetValueContext)\n  if (setValue === null) throw new Error('Could not find `ColorSchemeSetValueContext` context')\n  return setValue\n}\n\n/** @internal */\nexport function _useColorSchemeInternalValue(): StudioThemeColorSchemeKey {\n  const value = useContext(ColorSchemeValueContext)\n  if (value === null) throw new Error('Could not find `ColorSchemeValueContext` context')\n  return value\n}\n\n/** @alpha */\nexport function useColorSchemeValue(): ThemeColorSchemeKey {\n  const scheme = _useColorSchemeInternalValue()\n  const systemScheme = useSystemScheme()\n  return scheme === 'system' ? systemScheme : scheme\n}\n\n/**\n * @deprecated Use `useColorSchemeValue` or `useColorSchemeSetValue` instead\n * @internal\n */\nexport function useColorScheme() {\n  const scheme = useColorSchemeValue()\n  const setScheme = useColorSchemeSetValue()\n  return useMemo(() => ({scheme, setScheme}), [scheme, setScheme])\n}\n\ninterface ColorSchemeOption {\n  icon: ComponentType\n  label: string\n  name: StudioThemeColorSchemeKey\n  onSelect: () => void\n  selected: boolean\n  title: string\n}\n/**\n * @internal\n */\nexport function useColorSchemeOptions(\n  setScheme: (nextScheme: StudioThemeColorSchemeKey) => void,\n  t: TFunction<'studio', undefined>,\n) {\n  const scheme = _useColorSchemeInternalValue()\n\n  return useMemo(() => {\n    return [\n      {\n        title: t('user-menu.color-scheme.system-title'),\n        name: 'system',\n        label: t('user-menu.color-scheme.system-description'),\n        selected: scheme === 'system',\n        onSelect: () => setScheme('system'),\n        icon: DesktopIcon,\n      },\n      {\n        title: t('user-menu.color-scheme.dark-title'),\n        name: 'dark',\n        label: t('user-menu.color-scheme.dark-description'),\n        selected: scheme === 'dark',\n        onSelect: () => setScheme('dark'),\n        icon: MoonIcon,\n      },\n      {\n        title: t('user-menu.color-scheme.light-title'),\n        name: 'light',\n        label: t('user-menu.color-scheme.light-description'),\n        selected: scheme === 'light',\n        onSelect: () => setScheme('light'),\n        icon: SunIcon,\n      },\n    ] satisfies ColorSchemeOption[]\n  }, [scheme, setScheme, t])\n}\n","import {useGlobalKeyDown, useLayer} from '@sanity/ui'\nimport isHotkey from 'is-hotkey'\nimport {useCallback} from 'react'\n\nimport {GLOBAL_SEARCH_KEY} from '../constants'\n\nconst isSearchHotKey = isHotkey(`mod+${GLOBAL_SEARCH_KEY}`)\nconst isEscape = isHotkey('escape')\n\n/**\n * This hook binds a global shortcut combination, as well as the ESC key, to open / close callbacks.\n *\n * It will prevent the ESC key from firing `onClose` callbacks if it's not the top most layer\n * (i.e. if a nested dialog is mounted).\n */\nexport function useSearchHotkeys({\n  open,\n  onClose,\n  onOpen,\n}: {\n  open: boolean\n  onClose?: () => void\n  onOpen?: () => void\n}): void {\n  const {isTopLayer} = useLayer()\n\n  const handleClose = useCallback(() => {\n    onClose?.()\n  }, [onClose])\n\n  const handleGlobalKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (isSearchHotKey(event)) {\n        event.preventDefault()\n        if (open) {\n          handleClose()\n        } else {\n          onOpen?.()\n        }\n      }\n      if (isEscape(event) && open && isTopLayer) {\n        handleClose()\n      }\n    },\n    [handleClose, isTopLayer, open, onOpen],\n  )\n\n  useGlobalKeyDown(handleGlobalKeyDown)\n}\n","import {type ReactNode, useCallback, useEffect, useRef} from 'react'\n\nimport {useSearchState} from '../../contexts/search/useSearchState'\nimport {useSearchHotkeys} from '../../hooks/useSearchHotkeys'\n\ninterface SearchWrapperProps {\n  children: ReactNode\n  hasValidTerms: boolean\n  onClose: () => void\n  onOpen?: () => void\n  open: boolean\n}\n\nexport function SearchWrapper({\n  children,\n  hasValidTerms,\n  onClose,\n  onOpen,\n  open,\n}: SearchWrapperProps) {\n  const isMountedRef = useRef(false)\n\n  const {\n    dispatch,\n    searchCommandList,\n    setOnClose,\n    state: {result},\n  } = useSearchState()\n\n  /**\n   * Store top-most search result scroll index on close\n   */\n  const handleClose = useCallback(() => {\n    dispatch({index: searchCommandList?.getTopIndex() ?? -1, type: 'LAST_ACTIVE_INDEX_SET'})\n    onClose()\n  }, [dispatch, onClose, searchCommandList])\n\n  /**\n   * Bind hotkeys to open action\n   */\n  useSearchHotkeys({onClose: handleClose, onOpen, open})\n\n  /**\n   * Set shared `onClose` in search context\n   */\n  useEffect(() => {\n    setOnClose(handleClose)\n  }, [handleClose, setOnClose])\n\n  /**\n   * Reset last search index when new results are loaded, or visiting recent searches\n   */\n  // @todo Revise if/when we introduce pagination\n  useEffect(() => {\n    if ((!hasValidTerms || result.loaded) && isMountedRef.current) {\n      dispatch({index: 0, type: 'LAST_ACTIVE_INDEX_SET'})\n    }\n  }, [dispatch, hasValidTerms, result.loaded])\n\n  /**\n   * Reset ordering when is closed (without valid search terms)\n   */\n  useEffect(() => {\n    if (!hasValidTerms && isMountedRef.current && !open) {\n      dispatch({type: 'ORDERING_RESET'})\n    }\n  }, [dispatch, hasValidTerms, open])\n\n  /**\n   * Store mounted state\n   */\n  useEffect(() => {\n    if (!isMountedRef?.current) {\n      isMountedRef.current = true\n    }\n  }, [])\n\n  return children\n}\n","import {\n  type SearchOperatorBase,\n  type SearchOperatorButtonValue,\n  type SearchOperatorInput,\n  type SearchOperatorParams,\n} from './operatorTypes'\n\n/** @internal */\nexport interface SearchOperatorDefinition<TValue = any> extends SearchOperatorBase {\n  buttonValueComponent?: SearchOperatorButtonValue<TValue>\n  groqFilter: (params: SearchOperatorParams<TValue>) => string | null\n  initialValue?: TValue\n  inputComponent?: SearchOperatorInput<TValue>\n  type: string\n}\n\nexport function createOperatorDefinitionDictionary(\n  operatorDefinitions: SearchOperatorDefinition[],\n): SearchOperatorDefinitionDictionary {\n  return operatorDefinitions.reduce<SearchOperatorDefinitionDictionary>((acc, val) => {\n    acc[val.type] = val\n    return acc\n  }, {})\n}\n\nexport function getOperatorDefinition(\n  operators: SearchOperatorDefinitionDictionary,\n  operatorType?: string,\n): SearchOperatorDefinition | undefined {\n  return operatorType ? operators[operatorType] : undefined\n}\n\nexport function getOperatorInitialValue(\n  operators: SearchOperatorDefinitionDictionary,\n  operatorType: string,\n): SearchOperatorDefinition['initialValue'] | undefined {\n  return getOperatorDefinition(operators, operatorType)?.initialValue\n}\n\n/** @internal */\nexport type SearchOperatorDefinitionDictionary = Record<\n  SearchOperatorDefinition['type'],\n  SearchOperatorDefinition\n>\n","import {type SchemaType} from '@sanity/types'\nimport intersection from 'lodash/intersection'\nimport isEmpty from 'lodash/isEmpty'\n\nimport {isNonNullable} from '../../../../../util'\nimport {\n  type SearchFieldDefinition,\n  type SearchFieldDefinitionDictionary,\n} from '../definitions/fields'\nimport {\n  getFilterDefinition,\n  type OperatorItem,\n  type SearchFilterDefinition,\n  type SearchFilterDefinitionDictionary,\n} from '../definitions/filters'\nimport {\n  getOperatorDefinition,\n  type SearchOperatorDefinitionDictionary,\n} from '../definitions/operators'\nimport {type SearchFilter} from '../types'\n\nexport function buildSearchFilter(\n  filterDefinition: SearchFilterDefinition,\n  fieldId?: string,\n): SearchFilter {\n  return {\n    fieldId,\n    filterName: filterDefinition.name,\n    operatorType:\n      filterDefinition?.operators.find((operator): operator is OperatorItem => {\n        return operator.type === 'item'\n      })?.name || '',\n  }\n}\n\nexport function generateFilterQuery({\n  fieldDefinitions,\n  filterDefinitions,\n  filters,\n  operatorDefinitions,\n}: {\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  filterDefinitions: SearchFilterDefinitionDictionary\n  filters: SearchFilter[]\n  operatorDefinitions: SearchOperatorDefinitionDictionary\n}): string {\n  return filters\n    .filter((filter) =>\n      validateFilter({\n        filter,\n        filterDefinitions,\n        fieldDefinitions,\n        operatorDefinitions,\n      }),\n    )\n    .map((filter) => {\n      return getOperatorDefinition(operatorDefinitions, filter.operatorType)?.groqFilter({\n        fieldPath: resolveFieldPath({filter, fieldDefinitions, filterDefinitions}),\n        value: filter?.value,\n      })\n    })\n    .filter((filter) => !isEmpty(filter))\n    .filter(isNonNullable)\n    .join(' && ')\n}\n\nexport function getFieldFromFilter(\n  fields: SearchFieldDefinitionDictionary,\n  filter: SearchFilter,\n): SearchFieldDefinition | undefined {\n  return filter?.fieldId ? fields[filter.fieldId] : undefined\n}\n\nexport function getFilterKey(filter: SearchFilter): string {\n  return [filter.filterName, ...(filter.fieldId ? [filter.fieldId] : [])].join('-')\n}\n\nexport function narrowDocumentTypes({\n  fieldDefinitions,\n  filters,\n  types,\n}: {\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  filters: SearchFilter[]\n  types: SchemaType[]\n}): string[] {\n  // Get all 'manually' selected document types\n  const selectedDocumentTypes = types.map((type) => type.name)\n\n  const filteredDocumentTypes = Object.values(fieldDefinitions)\n    .filter((field) => filters.map((filter) => filter?.fieldId).includes(field.id))\n    .filter((field) => field.documentTypes.length > 0)\n    .map((field) => field.documentTypes)\n\n  // Get intersecting document types across all active filters (that have at least one document type).\n  // Filters that have no document types (i.e. `_updatedAt` which is available to all) are ignored.\n  const intersectingDocumentTypes = intersection(...filteredDocumentTypes)\n\n  const documentTypes: string[][] = []\n  if (selectedDocumentTypes.length > 0) {\n    documentTypes.push(selectedDocumentTypes)\n  }\n  if (intersectingDocumentTypes.length > 0) {\n    documentTypes.push(intersectingDocumentTypes)\n  }\n\n  return intersection(...documentTypes).sort()\n}\n\nfunction resolveFieldPath({\n  filter,\n  fieldDefinitions,\n  filterDefinitions,\n}: {\n  filter: SearchFilter\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  filterDefinitions: SearchFilterDefinitionDictionary\n}): string | undefined {\n  const fieldDefinition = getFieldFromFilter(fieldDefinitions, filter)\n  const filterDefinition = getFilterDefinition(filterDefinitions, filter.filterName)\n\n  if (!filterDefinition) {\n    return undefined\n  }\n\n  switch (filterDefinition.type) {\n    case 'field':\n      return fieldDefinition?.fieldPath\n    case 'pinned':\n      return filterDefinition?.fieldPath\n    default:\n      return undefined\n  }\n}\n\n/**\n * Validate if the supplied filter:\n * - has a valid filter defintion\n * - has a valid field definition (if it references a fieldId)\n * - has a valid operator (if present)\n */\nexport function validateFilter({\n  filter,\n  filterDefinitions,\n  fieldDefinitions,\n  operatorDefinitions,\n}: {\n  filter: SearchFilter\n  filterDefinitions: SearchFilterDefinitionDictionary\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  operatorDefinitions: SearchOperatorDefinitionDictionary\n}): boolean {\n  const filterDef = getFilterDefinition(filterDefinitions, filter.filterName)\n  const operatorDef = getOperatorDefinition(operatorDefinitions, filter.operatorType)\n  const fieldDef = getFieldFromFilter(fieldDefinitions, filter)\n\n  // Fail: No matching filter definition\n  if (!filterDef) {\n    return false\n  }\n\n  // Fail: No matching operator\n  if (!operatorDef) {\n    return false\n  }\n\n  // Fail: No matching field definition\n  if (filter.fieldId) {\n    if (!fieldDef) {\n      return false\n    }\n  }\n\n  // Field filters:\n  if (filterDef.type === 'field') {\n    // Fail: field definition has invalid path\n    if (!fieldDef?.fieldPath) {\n      return false\n    }\n    // Fail: no field ID\n    if (!filter.fieldId) {\n      return false\n    }\n    // Fail: no filter value\n    const hasFilterValue = operatorDef.groqFilter({\n      fieldPath: fieldDef.fieldPath,\n      value: filter.value,\n    })\n    if (!hasFilterValue) {\n      return false\n    }\n  }\n\n  // Pinned filters:\n  if (filterDef.type === 'pinned') {\n    // Fail: no filter value\n    const hasFilterValue = operatorDef.groqFilter({\n      fieldPath: filterDef.fieldPath,\n      value: filter.value,\n    })\n    if (!hasFilterValue) {\n      return false\n    }\n  }\n\n  return true\n}\n","import {Card, Flex, useGlobalKeyDown, useLayer} from '@sanity/ui'\nimport isHotkey from 'is-hotkey'\nimport {type ReactNode, useCallback, useEffect, useState} from 'react'\nimport FocusLock from 'react-focus-lock'\nimport styled from 'styled-components'\n\nimport {POPOVER_INPUT_PADDING, POPOVER_RADIUS, POPOVER_VERTICAL_MARGIN} from '../../../constants'\n\ninterface FilterPopoverWrapperProps {\n  anchorElement?: HTMLElement | null\n  children?: ReactNode\n  onClose: () => void\n}\n\nconst isEscape = isHotkey('escape')\n\nconst MAX_HEIGHT = 500 // px\n\nconst HiddenOverlay = styled.div`\n  background: transparent;\n  height: 100%;\n  left: 0;\n  position: fixed;\n  top: 0;\n  width: 100%;\n  z-index: -1;\n`\n\nexport function FilterPopoverWrapper({\n  anchorElement,\n  children,\n  onClose,\n}: FilterPopoverWrapperProps) {\n  const {isTopLayer} = useLayer()\n\n  const handleGlobalKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (isEscape(event) && isTopLayer) {\n        onClose()\n      }\n    },\n    [isTopLayer, onClose],\n  )\n\n  useGlobalKeyDown(handleGlobalKeyDown)\n\n  const popoverOffset = usePopoverOffset(anchorElement || null)\n\n  return (\n    <>\n      <HiddenOverlay onClick={onClose} />\n      <FocusLock autoFocus={false} returnFocus>\n        <Card\n          display=\"flex\"\n          overflow=\"hidden\"\n          radius={POPOVER_RADIUS}\n          style={{\n            maxHeight: `min(calc(100vh - ${popoverOffset}px - ${POPOVER_VERTICAL_MARGIN}px - ${POPOVER_INPUT_PADDING}px), ${MAX_HEIGHT}px`,\n            zIndex: 1,\n          }}\n        >\n          <Flex>{children}</Flex>\n        </Card>\n      </FocusLock>\n    </>\n  )\n}\n\nfunction calcPopoverOffset(element: HTMLElement) {\n  const rect = element.getBoundingClientRect()\n  const offset = rect.y + rect.height + POPOVER_VERTICAL_MARGIN\n  return offset\n}\n\nfunction usePopoverOffset(element: HTMLElement | null) {\n  const [offset, setOffset] = useState<number | null>(element && calcPopoverOffset(element))\n\n  const handleWindowResize = useCallback(() => {\n    if (element) {\n      setOffset(calcPopoverOffset(element))\n    }\n  }, [element])\n\n  useEffect(() => {\n    if (element) {\n      setOffset(calcPopoverOffset(element))\n    }\n  }, [element])\n\n  useEffect(() => {\n    window.addEventListener('resize', handleWindowResize)\n    return () => window.removeEventListener('resize', handleWindowResize)\n  }, [handleWindowResize])\n\n  return offset\n}\n","import {SearchIcon} from '@sanity/icons'\nimport {Box, Flex} from '@sanity/ui'\nimport {forwardRef, type KeyboardEvent} from 'react'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../../../../../i18n'\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {CustomTextInput} from '../../common/CustomTextInput'\n\ninterface FilterPopoverContentHeaderProps {\n  ariaInputLabel: string\n  onChange: (e: KeyboardEvent<HTMLInputElement>) => void\n  onClear: () => void\n  typeFilter: string\n}\n\nconst SearchHeaderBox = styled(Box)`\n  border-bottom: 1px solid ${({theme}) => theme.sanity.color.base.border};\n  flex-shrink: 0;\n`\n\nconst SearchHeaderContentFlex = styled(Flex)`\n  box-sizing: border-box;\n`\n\nexport const FilterPopoverContentHeader = forwardRef<\n  HTMLInputElement,\n  FilterPopoverContentHeaderProps\n>(function FilterPopoverContentHeader({ariaInputLabel, onChange, onClear, typeFilter}, ref) {\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  return (\n    <SearchHeaderBox>\n      <SearchHeaderContentFlex align=\"center\" flex={1} padding={1}>\n        <CustomTextInput\n          __unstable_disableFocusRing\n          $smallClearButton\n          aria-label={ariaInputLabel}\n          autoComplete=\"off\"\n          border={false}\n          clearButton={!!typeFilter}\n          fontSize={fullscreen ? 2 : 1}\n          icon={SearchIcon}\n          muted\n          onChange={onChange}\n          onClear={onClear}\n          placeholder={t('search.filter-placeholder')}\n          ref={ref}\n          spellCheck={false}\n          radius={2}\n          value={typeFilter}\n        />\n      </SearchHeaderContentFlex>\n    </SearchHeaderBox>\n  )\n})\n","import {type Schema, type SchemaType} from '@sanity/types'\nimport {type ButtonTone} from '@sanity/ui'\nimport {difference, startCase} from 'lodash'\n\nimport {type TFunction} from '../../../../../../../i18n'\nimport {isNonNullable} from '../../../../../../../util'\nimport {\n  type SearchFieldDefinition,\n  type SearchFieldDefinitionDictionary,\n} from '../../../definitions/fields'\nimport {\n  getFilterDefinition,\n  type SearchFilterDefinition,\n  type SearchFilterDefinitionDictionary,\n  type SearchFilterPinnedDefinition,\n} from '../../../definitions/filters'\nimport {\n  type FilterMenuItem,\n  type FilterMenuItemFilter,\n  type FilterMenuItemHeader,\n  type SearchFilter,\n} from '../../../types'\nimport {buildSearchFilter, getFieldFromFilter} from '../../../utils/filterUtils'\n\n/**\n * Creates a flat list of filter menu items based on the current filter text input.\n */\nexport function createFilterMenuItems({\n  documentTypesNarrowed,\n  fieldDefinitions,\n  filterDefinitions,\n  schema,\n  titleFilter,\n  types,\n  t,\n}: {\n  documentTypesNarrowed: string[]\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  filterDefinitions: SearchFilterDefinitionDictionary\n  schema: Schema\n  titleFilter: string\n  types: SchemaType[]\n  t: TFunction<'studio', undefined>\n}): FilterMenuItem[] {\n  // Construct field filters based on available definitions and current title fitler\n  const fieldFilters = Object.values(fieldDefinitions)\n    .filter((fieldDef) => includesTitleInFieldDefinition(fieldDef, titleFilter))\n    .map((fieldDef) => {\n      const filterDef = getFilterDefinition(filterDefinitions, fieldDef.filterName)\n      if (filterDef) {\n        return buildSearchFilter(filterDef, fieldDef.id)\n      }\n      return null\n    })\n    .filter(isNonNullable)\n\n  const pinnedItems = buildPinnedMenuItems({\n    fieldDefinitions,\n    filterDefinitions,\n    titleFilter,\n  })\n\n  if (documentTypesNarrowed.length === 0) {\n    return [\n      ...pinnedItems,\n      // All fields\n      ...filterGroup({\n        fieldDefinitions,\n        filterDefinitions,\n        filters: fieldFilters,\n        headerTitle: t('search.filter-all-fields-header'),\n        id: 'field',\n      }),\n    ]\n  }\n\n  return [\n    ...pinnedItems,\n    // All shared / narrowed items\n    ...buildFieldMenuItemsNarrowed({\n      documentTypesNarrowed,\n      fieldDefinitions,\n      filterDefinitions,\n      filters: fieldFilters,\n      schema,\n      types,\n      t,\n    }),\n  ]\n}\n\nfunction filterGroup({\n  fieldDefinitions,\n  filterDefinitions,\n  filters,\n  id,\n  headerTitle,\n  tone,\n}: {\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  filterDefinitions: SearchFilterDefinitionDictionary\n  filters: SearchFilter[]\n  id: string\n  headerTitle?: string\n  tone?: ButtonTone\n}): FilterMenuItem[] {\n  const header: FilterMenuItemHeader = {\n    title: headerTitle || '',\n    tone: tone || 'default',\n    type: 'header',\n  }\n  const filterItems = filters.map(\n    (filter) =>\n      ({\n        fieldDefinition: getFieldFromFilter(fieldDefinitions, filter),\n        filterDefinition: getFilterDefinition(filterDefinitions, filter.filterName),\n        filter,\n        group: id,\n        tone: tone || 'default',\n        type: 'filter',\n      }) as FilterMenuItemFilter,\n  )\n\n  return filterItems.length > 0\n    ? [\n        ...(headerTitle ? [header] : []), //\n        ...filterItems,\n      ]\n    : []\n}\n\n/**\n * Construct a flat list of narrowed field menu items, including shared fields.\n * Shared fields should always appear first.\n */\nfunction buildFieldMenuItemsNarrowed({\n  documentTypesNarrowed,\n  fieldDefinitions,\n  filterDefinitions,\n  filters,\n  schema,\n  types,\n  t,\n}: {\n  documentTypesNarrowed: string[]\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  filterDefinitions: SearchFilterDefinitionDictionary\n  filters: SearchFilter[]\n  schema: Schema\n  types: SchemaType[]\n  t: TFunction<'studio', undefined>\n}) {\n  const sharedFilters = filters.filter((filter) => {\n    const fieldDefinition = getFieldFromFilter(fieldDefinitions, filter)\n    return sharesDocumentTypes(documentTypesNarrowed, fieldDefinition)\n  })\n\n  const sharedItems =\n    documentTypesNarrowed.length > 1 && types.length > 1\n      ? filterGroup({\n          fieldDefinitions,\n          filterDefinitions,\n          filters: sharedFilters,\n          headerTitle: t('search.filter-shared-fields-header'),\n          id: 'shared',\n          tone: 'primary',\n        })\n      : []\n\n  const groupedItems = documentTypesNarrowed\n    .map((documentType) => {\n      const docType = schema.get(documentType)\n      return {\n        // Note: it shouldn't be possible to select document types that do not exist in schema,\n        // and there is no way to inject it into state (eg not persisted in URL), thus we leave\n        // this fallback (`Unknown type`) only as a edge-case safety net and will not translate it.\n        title: docType?.title || startCase(docType?.name) || '(Unknown type)',\n        documentType,\n      }\n    })\n    // Sort groups by title\n    .sort((a, b) => a.title.localeCompare(b.title))\n    .map(({documentType, title}) => {\n      const groupFilters = filters.filter((filter) => {\n        const fieldDefinition = getFieldFromFilter(fieldDefinitions, filter)\n        return includesDocumentTypes([documentType], fieldDefinition)\n      })\n      return filterGroup({\n        fieldDefinitions,\n        filterDefinitions,\n        filters: groupFilters,\n        id: title,\n        headerTitle: title,\n      })\n    })\n    .flat()\n\n  return [...sharedItems, ...groupedItems]\n}\n\n/**\n * Construct a flat list of all pinned filter menu items (both ungrouped and grouped).\n * Un-grouped items should always appear first.\n */\nfunction buildPinnedMenuItems({\n  fieldDefinitions,\n  filterDefinitions,\n  titleFilter,\n}: {\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  filterDefinitions: SearchFilterDefinitionDictionary\n  titleFilter: string\n}) {\n  // Extract all ungrouped pinned filters, these sit above all other items.\n  const ungroupedPinnedFilters = Object.values(filterDefinitions)\n    .filter(isPinnedFilterDefWithoutGroup)\n    .filter((filterDef) => includesTitleInPinnedFilterDefinition(filterDef, titleFilter))\n    .map((filterDef) => buildSearchFilter(filterDef))\n\n  // Extract grouped pinned filters\n  const groupedPinnedFilters = Object.values(filterDefinitions)\n    .filter(isPinnedFilterDefWithGroup)\n    .filter((filterDef) => includesTitleInPinnedFilterDefinition(filterDef, titleFilter))\n    .reduce<Record<string, SearchFilter[]>>((acc, val) => {\n      acc[val.group] = acc[val.group] || []\n      acc[val.group].push(buildSearchFilter(val))\n      return acc\n    }, {})\n\n  return [\n    // Ungrouped\n    ...filterGroup({\n      fieldDefinitions,\n      filterDefinitions,\n      filters: ungroupedPinnedFilters,\n      id: 'pinned-ungrouped',\n      tone: 'primary',\n    }),\n    // Grouped\n    ...Object.entries(groupedPinnedFilters).flatMap(([groupTitle, filters]) =>\n      filterGroup({\n        fieldDefinitions,\n        filterDefinitions,\n        filters,\n        headerTitle: groupTitle,\n        id: groupTitle,\n        tone: 'primary',\n      }),\n    ),\n  ]\n}\n\nfunction includesDocumentTypes(documentTypes: string[], fieldDefinition?: SearchFieldDefinition) {\n  return fieldDefinition?.documentTypes.some((type) => documentTypes.includes(type))\n}\n\nfunction includesTitleInFieldDefinition(field: SearchFieldDefinition, currentTitle: string) {\n  const fieldTitle = field.titlePath.join('/')\n  return fieldTitle.toLowerCase().includes(currentTitle.toLowerCase())\n}\n\nfunction includesTitleInPinnedFilterDefinition(\n  filter: SearchFilterPinnedDefinition,\n  currentTitle: string,\n) {\n  return filter.title.toLowerCase().includes(currentTitle.toLowerCase())\n}\n\nfunction isPinnedFilterDefWithGroup(\n  filterDef: SearchFilterDefinition,\n): filterDef is SearchFilterPinnedDefinition & {group: string} {\n  return filterDef.type === 'pinned' && typeof filterDef?.group !== 'undefined'\n}\n\nfunction isPinnedFilterDefWithoutGroup(\n  filterDef: SearchFilterDefinition,\n): filterDef is SearchFilterPinnedDefinition {\n  return filterDef.type === 'pinned' && typeof filterDef?.group === 'undefined'\n}\n\nfunction sharesDocumentTypes(documentTypes: string[], fieldDefinition?: SearchFieldDefinition) {\n  return difference(documentTypes, fieldDefinition?.documentTypes || []).length === 0\n}\n","import {useMemo} from 'react'\n\nimport {useSearchState} from '../../contexts/search/useSearchState'\nimport {getFilterDefinition} from '../../definitions/filters'\nimport {type SearchFilter} from '../../types'\nimport {getFieldFromFilter} from '../../utils/filterUtils'\n\ninterface FilterTitleProps {\n  filter: SearchFilter\n  maxLength?: number\n}\n\nexport function FilterTitle({filter, maxLength}: FilterTitleProps) {\n  const {\n    state: {definitions},\n  } = useSearchState()\n\n  const title = useMemo(() => {\n    const filterDef = getFilterDefinition(definitions.filters, filter.filterName)\n    switch (filterDef?.type) {\n      case 'field': {\n        const fieldDefinition = getFieldFromFilter(definitions.fields, filter)\n        if (fieldDefinition?.titlePath) {\n          return fieldDefinition.titlePath[fieldDefinition.titlePath.length - 1]\n        }\n        return null\n      }\n      case 'pinned':\n        return filterDef.title\n      default:\n        return null\n    }\n  }, [definitions, filter])\n\n  if (!title) {\n    return null\n  }\n\n  return maxLength && title.length > maxLength ? (\n    <span>{title.slice(0, maxLength)}</span>\n  ) : (\n    <span>{title}</span>\n  )\n}\n","import {UnknownIcon} from '@sanity/icons'\nimport {createElement} from 'react'\n\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {getFilterDefinition} from '../../../definitions/filters'\nimport {type SearchFilter} from '../../../types'\n\ninterface FilterIconProps {\n  filter: SearchFilter\n}\n\nexport function FilterIcon({filter}: FilterIconProps) {\n  const {\n    state: {definitions},\n  } = useSearchState()\n\n  const icon = getFilterDefinition(definitions.filters, filter.filterName)?.icon\n  if (icon) {\n    return createElement(icon)\n  }\n  return <UnknownIcon />\n}\n","import {ChevronRightIcon} from '@sanity/icons'\nimport {Box, Flex, Stack, Text} from '@sanity/ui'\nimport {Fragment} from 'react'\n\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {type SearchFilter} from '../../../types'\nimport {getFieldFromFilter} from '../../../utils/filterUtils'\nimport {FilterTitle} from '../../common/FilterTitle'\nimport {FilterIcon} from './FilterIcon'\n\ninterface FilterDetailsProps {\n  filter: SearchFilter\n}\n\nexport function FilterDetails({filter}: FilterDetailsProps) {\n  const {\n    state: {definitions},\n  } = useSearchState()\n  const fieldDefinition = getFieldFromFilter(definitions.fields, filter)\n\n  return (\n    <Stack space={2}>\n      {/* Path */}\n      {fieldDefinition?.titlePath && fieldDefinition.titlePath?.length > 1 && (\n        <Box marginLeft={4}>\n          <Text muted size={0}>\n            {fieldDefinition.titlePath.slice(0, -1).map((pathTitle, index) => {\n              return (\n                <Fragment\n                  // eslint-disable-next-line react/no-array-index-key\n                  key={index}\n                >\n                  <span>{pathTitle}</span>\n                  {index !== fieldDefinition.titlePath.length - 2 && (\n                    <span\n                      style={{\n                        opacity: 0.75,\n                        paddingLeft: '0.25em',\n                        paddingRight: '0.25em',\n                      }}\n                    >\n                      <ChevronRightIcon />\n                    </span>\n                  )}\n                </Fragment>\n              )\n            })}\n          </Text>\n        </Box>\n      )}\n\n      <Flex align=\"flex-start\" gap={3}>\n        <Box style={{flexShrink: 0}}>\n          <Text size={1}>\n            <FilterIcon filter={filter} />\n          </Text>\n        </Box>\n        <Text size={1} weight=\"medium\">\n          <FilterTitle filter={filter} />\n        </Text>\n      </Flex>\n    </Stack>\n  )\n}\n","import {isValidElement, type ReactElement} from 'react'\nimport {renderToString} from 'react-dom/server'\n\n/**\n * Convert a field value to a string (if it's a React element) and remove HTML tags.\n * If the field value is a string, pass through as-is.\n */\nexport function sanitizeFieldValue(name: string | ReactElement): string {\n  if (isValidElement(name)) {\n    return stripHtmlTags(renderToString(name))\n  }\n\n  return typeof name === 'string' ? name : ''\n}\n\nfunction stripHtmlTags(str: string) {\n  return new DOMParser().parseFromString(str, 'text/html')?.body.textContent || ''\n}\n","import {Card, Flex, Stack, Text} from '@sanity/ui'\nimport {startCase, uniq} from 'lodash'\nimport {type ReactElement, useMemo} from 'react'\n\nimport {Tooltip} from '../../../../../../../../../ui-components'\nimport {TextWithTone} from '../../../../../../../../components'\nimport {useSchema} from '../../../../../../../../hooks'\nimport {useTranslation} from '../../../../../../../../i18n'\nimport {isNonNullable, truncateString} from '../../../../../../../../util'\nimport {useSearchState} from '../../../../contexts/search/useSearchState'\nimport {type SearchFieldDefinition} from '../../../../definitions/fields'\nimport {type SearchFilterDefinition} from '../../../../definitions/filters'\nimport {getSchemaField} from '../../../../utils/getSchemaField'\nimport {sanitizeFieldValue} from '../../../../utils/sanitizeField'\n\ninterface FilterTooltipProps {\n  children: ReactElement\n  fieldDefinition?: SearchFieldDefinition\n  filterDefinition: SearchFilterDefinition\n  visible?: boolean\n}\n\nconst MAX_VISIBLE_TYPES = 10\n\nexport function FilterTooltip({\n  children,\n  fieldDefinition,\n  filterDefinition,\n  visible,\n}: FilterTooltipProps) {\n  const {\n    state: {documentTypesNarrowed},\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const schema = useSchema()\n\n  const fieldDefinitionDocumentTypeTitles = useMemo(() => {\n    if (fieldDefinition?.documentTypes) {\n      return fieldDefinition.documentTypes\n        .map((d) => {\n          const defType = schema.get(d)\n          return defType?.title || startCase(defType?.name)\n        })\n        .filter(isNonNullable)\n        .sort()\n    }\n    return []\n  }, [fieldDefinition?.documentTypes, schema])\n\n  /**\n   * Obtain the shared field description for the current field definition.\n   * Return a description only if this field description is identical (and defined)\n   * across all ALL associated fields.\n   */\n  const fieldDefinitionDescription = useMemo(() => {\n    if (fieldDefinition?.documentTypes) {\n      const descriptions = fieldDefinition.documentTypes\n        .map((d) => {\n          const defType = schema.get(d)\n          if (defType) {\n            const field = getSchemaField(defType, fieldDefinition.fieldPath)\n            // Sanitize schema descriptions (which may either be a string or React element)\n            return field?.type.description && sanitizeFieldValue(field?.type.description)\n          }\n          return null\n        })\n        .filter(isNonNullable)\n        .sort()\n\n      const uniqueDescriptions = uniq(descriptions)\n      if (uniqueDescriptions.length === 1) {\n        return uniqueDescriptions[0]\n      }\n    }\n    return undefined\n  }, [fieldDefinition?.documentTypes, fieldDefinition?.fieldPath, schema])\n\n  return (\n    <Tooltip\n      content={\n        <Card tone=\"default\" radius={2} style={{maxWidth: '250px'}}>\n          <Stack space={4}>\n            {/* Field name */}\n            {fieldDefinition && (\n              <Stack space={3}>\n                <Text muted size={1} weight=\"medium\">\n                  {t('search.filter-field-tooltip-name')}\n                </Text>\n                <TextWithTone\n                  size={1}\n                  style={{fontFamily: 'monospace'}}\n                  tone=\"primary\"\n                  textOverflow=\"ellipsis\"\n                >\n                  {fieldDefinition?.name}\n                </TextWithTone>\n              </Stack>\n            )}\n\n            {/* Field description */}\n            {fieldDefinitionDescription && (\n              <Stack space={3}>\n                <Text muted size={1} weight=\"medium\">\n                  {t('search.filter-field-tooltip-description')}\n                </Text>\n                <Text muted size={1}>\n                  {truncateString(fieldDefinitionDescription, 256)}\n                </Text>\n              </Stack>\n            )}\n\n            {/* Filter description */}\n            {filterDefinition?.description && (\n              <Text muted size={1}>\n                {truncateString(filterDefinition.description, 256)}\n              </Text>\n            )}\n\n            {/* Field document titles */}\n            {!documentTypesNarrowed.length && fieldDefinitionDocumentTypeTitles.length > 0 && (\n              <Stack space={2}>\n                <Flex align=\"center\" gap={1}>\n                  <Text muted size={1} weight=\"medium\">\n                    {t('search.filter-field-tooltip-used-in-document-types')}\n                  </Text>\n                  <Card padding={1} radius={2} tone=\"transparent\">\n                    <Text size={1} muted>\n                      {fieldDefinitionDocumentTypeTitles.length}\n                    </Text>\n                  </Card>\n                </Flex>\n                <Text size={1} weight=\"regular\" muted>\n                  {fieldDefinitionDocumentTypeTitles.slice(0, MAX_VISIBLE_TYPES).join(', ')}\n                  {fieldDefinitionDocumentTypeTitles?.length > MAX_VISIBLE_TYPES\n                    ? ` +${fieldDefinitionDocumentTypeTitles.length - MAX_VISIBLE_TYPES} more`\n                    : ''}\n                </Text>\n              </Stack>\n            )}\n          </Stack>\n        </Card>\n      }\n      disabled={!visible}\n      fallbackPlacements={['left']}\n      placement=\"right\"\n      portal\n    >\n      {children}\n    </Tooltip>\n  )\n}\n","import {\n  Box,\n  // eslint-disable-next-line no-restricted-imports\n  Button, // Button with specific styling and children.\n  type ResponsiveMarginProps,\n  type ResponsivePaddingProps,\n} from '@sanity/ui'\nimport {memo, useCallback} from 'react'\n\nimport {useSearchState} from '../../../../contexts/search/useSearchState'\nimport {type FilterMenuItemFilter} from '../../../../types'\nimport {getFilterKey} from '../../../../utils/filterUtils'\nimport {FilterDetails} from '../../common/FilterDetails'\nimport {FilterTooltip} from './FilterTooltip'\n\ninterface FilterMenuItemProps extends ResponsiveMarginProps, ResponsivePaddingProps {\n  item: FilterMenuItemFilter\n  onClose: () => void\n}\n\nexport const MenuItemFilter = memo(function MenuItemFilter({\n  item,\n  onClose,\n  ...rest\n}: FilterMenuItemProps) {\n  const {\n    dispatch,\n    state: {filters},\n  } = useSearchState()\n\n  const handleClick = useCallback(() => {\n    dispatch({filter: item.filter, type: 'TERMS_FILTERS_ADD'})\n    onClose?.()\n  }, [dispatch, item.filter, onClose])\n\n  const isAlreadyActive = !!filters.find((f) => getFilterKey(f) === getFilterKey(item.filter))\n\n  // Only enable tooltips if an associated field definition exists, or the filter has a valid description\n  const tooltipEnabled = !!(item.fieldDefinition || item.filterDefinition.description)\n\n  return (\n    <Box {...rest}>\n      <Button\n        disabled={isAlreadyActive}\n        fontSize={1}\n        justify=\"flex-start\"\n        mode=\"bleed\"\n        onClick={isAlreadyActive ? undefined : handleClick}\n        padding={0}\n        style={{position: 'relative', whiteSpace: 'normal', width: '100%'}}\n        tabIndex={-1}\n        tone={item?.tone}\n      >\n        <FilterTooltip\n          fieldDefinition={item.fieldDefinition}\n          filterDefinition={item.filterDefinition}\n          visible={tooltipEnabled}\n        >\n          <Box padding={3}>\n            <FilterDetails filter={item.filter} />\n          </Box>\n        </FilterTooltip>\n      </Button>\n    </Box>\n  )\n})\n","import {Box, Card, Text} from '@sanity/ui'\nimport {memo} from 'react'\n\nimport {type FilterMenuItemHeader} from '../../../../types'\n\ninterface MenuItemHeaderFields {\n  item: FilterMenuItemHeader\n}\n\nexport const MenuItemHeader = memo(function MenuItemHeader({item}: MenuItemHeaderFields) {\n  return (\n    <Box paddingTop={1}>\n      <Card borderBottom paddingX={2} paddingY={3} tone={item?.tone}>\n        <Text muted size={1} textOverflow=\"ellipsis\" weight=\"medium\">\n          {item.title}\n        </Text>\n      </Card>\n    </Box>\n  )\n})\n","import {Box, Flex, Text} from '@sanity/ui'\nimport {type KeyboardEvent, useCallback, useMemo, useState} from 'react'\n\nimport {\n  CommandList,\n  type CommandListGetItemDisabledCallback,\n  type CommandListRenderItemCallback,\n} from '../../../../../../../components'\nimport {useSchema} from '../../../../../../../hooks'\nimport {useTranslation} from '../../../../../../../i18n'\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {type FilterMenuItem} from '../../../types'\nimport {getFilterKey} from '../../../utils/filterUtils'\nimport {FilterPopoverContentHeader} from '../common/FilterPopoverContentHeader'\nimport {createFilterMenuItems} from './createFilterMenuItems'\nimport {MenuItemFilter} from './items/MenuItemFilter'\nimport {MenuItemHeader} from './items/MenuItemHeader'\n\ninterface AddFilterPopoverContentProps {\n  onClose: () => void\n}\n\nconst POPOVER_STYLES = {width: '300px'}\n\nexport function AddFilterPopoverContent({onClose}: AddFilterPopoverContentProps) {\n  const [inputElement, setInputElement] = useState<HTMLInputElement | null>(null)\n  const [titleFilter, setTitleFilter] = useState('')\n  const {t} = useTranslation()\n\n  const handleFilterChange = useCallback(\n    (e: KeyboardEvent<HTMLInputElement>) => setTitleFilter(e.currentTarget.value),\n    [setTitleFilter],\n  )\n  const handleFilterClear = useCallback(() => setTitleFilter(''), [])\n\n  const schema = useSchema()\n\n  const {\n    state: {\n      documentTypesNarrowed,\n      definitions,\n      filters,\n      terms: {types},\n    },\n  } = useSearchState()\n\n  const filteredMenuItems = useMemo(\n    () =>\n      createFilterMenuItems({\n        documentTypesNarrowed,\n        fieldDefinitions: definitions.fields,\n        filterDefinitions: definitions.filters,\n        schema,\n        titleFilter,\n        types,\n        t,\n      }),\n    [documentTypesNarrowed, definitions.fields, definitions.filters, schema, titleFilter, types, t],\n  )\n\n  const renderItem = useCallback<CommandListRenderItemCallback<FilterMenuItem>>(\n    (item) => {\n      if (item.type === 'filter') {\n        return <MenuItemFilter item={item} onClose={onClose} paddingBottom={1} />\n      }\n      if (item.type === 'header') {\n        return <MenuItemHeader item={item} />\n      }\n      return null\n    },\n    [onClose],\n  )\n\n  const getItemDisabled = useCallback<CommandListGetItemDisabledCallback>(\n    (index) => {\n      const filterItem = filteredMenuItems[index]\n      return (\n        filterItem.type !== 'filter' ||\n        !!filters.find((f) => getFilterKey(f) === getFilterKey(filterItem.filter))\n      )\n    },\n    [filteredMenuItems, filters],\n  )\n\n  const getItemKey = useCallback(\n    (index: number) => {\n      const menuItem = filteredMenuItems[index]\n      switch (menuItem.type) {\n        case 'filter':\n          return [\n            ...(menuItem.group ? [menuItem.group] : []), //\n            getFilterKey(menuItem.filter),\n          ].join('-')\n        case 'header':\n          return `${menuItem.type}-${menuItem.title}`\n        default:\n          return index\n      }\n    },\n    [filteredMenuItems],\n  )\n\n  return (\n    <Flex direction=\"column\" style={POPOVER_STYLES}>\n      {/* Filter header */}\n      <FilterPopoverContentHeader\n        ariaInputLabel={t('search.filter-by-title-aria-label')}\n        onChange={handleFilterChange}\n        onClear={handleFilterClear}\n        ref={setInputElement}\n        typeFilter={titleFilter}\n      />\n\n      <Flex>\n        {filteredMenuItems.length > 0 && (\n          <CommandList\n            activeItemDataAttr=\"data-hovered\"\n            ariaLabel={t('search.filters-aria-label', {count: filteredMenuItems.length})}\n            autoFocus=\"input\"\n            getItemDisabled={getItemDisabled}\n            getItemKey={getItemKey}\n            inputElement={inputElement}\n            itemHeight={45}\n            items={filteredMenuItems}\n            overscan={20}\n            padding={1}\n            paddingBottom={0}\n            renderItem={renderItem}\n          />\n        )}\n\n        {/* No results */}\n        {filteredMenuItems.length == 0 && (\n          <Box padding={3}>\n            <Text muted size={1} textOverflow=\"ellipsis\">\n              {t('search.filter-no-matches-found', {filter: titleFilter})}\n            </Text>\n          </Box>\n        )}\n      </Flex>\n    </Flex>\n  )\n}\n","import {AddIcon} from '@sanity/icons'\nimport {useClickOutside} from '@sanity/ui'\nimport {useCallback, useState} from 'react'\n\nimport {Button, Popover} from '../../../../../../../../ui-components'\nimport {useTranslation} from '../../../../../../../i18n'\nimport {POPOVER_RADIUS, POPOVER_VERTICAL_MARGIN} from '../../../constants'\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {FilterPopoverWrapper} from '../common/FilterPopoverWrapper'\nimport {AddFilterPopoverContent} from './AddFilterPopoverContent'\n\nexport function AddFilterButton() {\n  const [open, setOpen] = useState(false)\n  const [buttonElement, setButtonElement] = useState<HTMLElement | null>(null)\n  const [popoverElement, setPopoverElement] = useState<HTMLElement | null>(null)\n  const {t} = useTranslation()\n\n  const {\n    state: {fullscreen},\n  } = useSearchState()\n\n  const handleClose = useCallback(() => setOpen(false), [])\n  const handleOpen = useCallback(() => setOpen(true), [])\n\n  useClickOutside(handleClose, [buttonElement, popoverElement])\n\n  return (\n    <Popover\n      __unstable_margins={[POPOVER_VERTICAL_MARGIN, 0, 0, 0]}\n      content={\n        <FilterPopoverWrapper anchorElement={buttonElement} onClose={handleClose}>\n          <AddFilterPopoverContent onClose={handleClose} />\n        </FilterPopoverWrapper>\n      }\n      open={open}\n      placement=\"bottom-start\"\n      radius={POPOVER_RADIUS}\n      ref={setPopoverElement}\n      portal\n    >\n      <Button\n        icon={AddIcon}\n        mode=\"bleed\"\n        onClick={handleOpen}\n        size={fullscreen ? 'large' : 'default'}\n        ref={setButtonElement}\n        selected={open}\n        text={t('search.action.add-filter')}\n      />\n    </Popover>\n  )\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {type SchemaType} from '@sanity/types'\nimport {Box, type ResponsiveMarginProps, type ResponsivePaddingProps} from '@sanity/ui'\nimport {memo, useCallback} from 'react'\n\nimport {Button} from '../../../../../../../../../ui-components'\nimport {useSearchState} from '../../../../contexts/search/useSearchState'\n\ninterface DocumentTypeFilterItemProps extends ResponsiveMarginProps, ResponsivePaddingProps {\n  selected: boolean\n  type: SchemaType\n}\n\nexport const DocumentTypeFilterItem = memo(function TypeFilterItem({\n  selected,\n  type,\n  ...rest\n}: DocumentTypeFilterItemProps) {\n  const {dispatch} = useSearchState()\n\n  const handleTypeAdd = useCallback(() => {\n    dispatch({type: 'TERMS_TYPE_ADD', schemaType: type})\n  }, [dispatch, type])\n\n  const handleTypeRemove = useCallback(() => {\n    dispatch({type: 'TERMS_TYPE_REMOVE', schemaType: type})\n  }, [dispatch, type])\n\n  const handleClick = useCallback(() => {\n    if (selected) {\n      handleTypeRemove()\n    } else {\n      handleTypeAdd()\n    }\n  }, [handleTypeAdd, handleTypeRemove, selected])\n\n  return (\n    <Box {...rest}>\n      <Button\n        iconRight={selected && CheckmarkIcon}\n        justify=\"flex-start\"\n        key={type.title ?? type.name}\n        mode=\"bleed\"\n        onClick={handleClick}\n        width=\"fill\"\n        size=\"large\"\n        tabIndex={-1}\n        text={type.title ?? type.name}\n        tone={selected ? 'primary' : 'default'}\n      />\n    </Box>\n  )\n})\n","import {type Schema, type SchemaType} from '@sanity/types'\nimport {Box, Flex, MenuDivider, Stack, Text} from '@sanity/ui'\nimport {partition} from 'lodash'\nimport {type KeyboardEvent, useCallback, useMemo, useRef, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {Button} from '../../../../../../../../ui-components'\nimport {\n  CommandList,\n  type CommandListGetItemSelectedCallback,\n  type CommandListHandle,\n  type CommandListRenderItemCallback,\n} from '../../../../../../../components'\nimport {useSchema} from '../../../../../../../hooks'\nimport {useTranslation} from '../../../../../../../i18n'\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {type DocumentTypeMenuItem} from '../../../types'\nimport {getSelectableOmnisearchTypes} from '../../../utils/selectors'\nimport {FilterPopoverContentHeader} from '../common/FilterPopoverContentHeader'\nimport {DocumentTypeFilterItem} from './items/DocumentTypeFilterItem'\n\nconst ClearButtonBox = styled(Box)`\n  border-top: 1px solid ${({theme}) => theme.sanity.color.base.border};\n  flex-shrink: 0;\n`\n\nconst POPOVER_STYLES = {width: '250px'}\n\nexport function DocumentTypesPopoverContent() {\n  const [inputElement, setInputElement] = useState<HTMLInputElement | null>(null)\n  const [typeFilter, setTypeFilter] = useState('')\n  const commandListRef = useRef<CommandListHandle | null>(null)\n  const {t} = useTranslation()\n\n  const schema = useSchema()\n\n  const {\n    dispatch,\n    state: {\n      terms: {types: selectedTypes},\n    },\n  } = useSearchState()\n\n  // Get a snapshot of initial selected types\n  const [selectedTypesSnapshot, setSelectedTypesSnapshot] = useState(selectedTypes)\n\n  const documentTypeItems = useGetDocumentTypeItems(\n    schema,\n    selectedTypes,\n    selectedTypesSnapshot,\n    typeFilter,\n  )\n\n  const handleFilterChange = useCallback(\n    (e: KeyboardEvent<HTMLInputElement>) => setTypeFilter(e.currentTarget.value),\n    [setTypeFilter],\n  )\n  const handleFilterClear = useCallback(() => setTypeFilter(''), [])\n\n  const handleTypesClear = useCallback(() => {\n    setSelectedTypesSnapshot([])\n    dispatch({type: 'TERMS_TYPES_CLEAR'})\n\n    // Re-focus the command list input element\n    commandListRef?.current?.focusInputElement()\n    commandListRef?.current?.scrollToIndex(0)\n  }, [dispatch])\n\n  const getItemKey = useCallback(\n    (index: number) => {\n      const virtualItem = documentTypeItems[index]\n      switch (virtualItem.type) {\n        case 'divider':\n          return `${virtualItem.type}-${index}`\n        case 'header':\n          return `${virtualItem.type}-${virtualItem.title}`\n        case 'item':\n          return `${virtualItem.type}-${virtualItem.item.name}`\n        default:\n          return index\n      }\n    },\n    [documentTypeItems],\n  )\n\n  const renderItem = useCallback<CommandListRenderItemCallback<DocumentTypeMenuItem>>((item) => {\n    if (item.type === 'divider') {\n      return (\n        <Box paddingY={1}>\n          <MenuDivider />\n        </Box>\n      )\n    }\n    if (item.type === 'header') {\n      return (\n        <Box margin={2} padding={1}>\n          <Text muted size={1} weight=\"medium\">\n            {item.title}\n          </Text>\n        </Box>\n      )\n    }\n    if (item.type === 'item') {\n      return <DocumentTypeFilterItem paddingBottom={1} selected={item.selected} type={item.item} />\n    }\n    return null\n  }, [])\n\n  const getItemDisabled = useCallback<CommandListGetItemSelectedCallback>(\n    (index) => {\n      const item = documentTypeItems[index]\n      return item.type !== 'item'\n    },\n    [documentTypeItems],\n  )\n\n  const getItemSelected = useCallback<CommandListGetItemSelectedCallback>(\n    (index) => {\n      const item = documentTypeItems[index]\n      return item.type === 'item' && item.selected\n    },\n    [documentTypeItems],\n  )\n\n  return (\n    <Flex direction=\"column\" style={POPOVER_STYLES}>\n      {/* Search header */}\n      <FilterPopoverContentHeader\n        ariaInputLabel={t('search.action.filter-by-document-type-aria-label')}\n        onChange={handleFilterChange}\n        onClear={handleFilterClear}\n        ref={setInputElement}\n        typeFilter={typeFilter}\n      />\n\n      <Flex>\n        {documentTypeItems.length > 0 && (\n          <CommandList\n            activeItemDataAttr=\"data-hovered\"\n            ariaLabel={t('search.document-types-aria-label')}\n            ariaMultiselectable\n            autoFocus=\"input\"\n            getItemDisabled={getItemDisabled}\n            getItemSelected={getItemSelected}\n            getItemKey={getItemKey}\n            inputElement={inputElement}\n            itemHeight={37}\n            items={documentTypeItems}\n            overscan={20}\n            padding={1}\n            paddingBottom={0}\n            ref={commandListRef}\n            renderItem={renderItem}\n          />\n        )}\n\n        {/* No results */}\n        {!documentTypeItems.length && (\n          <Box padding={3}>\n            <Text muted size={1} textOverflow=\"ellipsis\">\n              {t('search.document-types-no-matches-found', {filter: typeFilter})}\n            </Text>\n          </Box>\n        )}\n      </Flex>\n\n      {/* Clear button */}\n      {!typeFilter && selectedTypes.length > 0 && (\n        <ClearButton onClick={handleTypesClear} selectedTypes={selectedTypes} />\n      )}\n    </Flex>\n  )\n}\n\nfunction ClearButton({onClick, selectedTypes}: {onClick: () => void; selectedTypes: SchemaType[]}) {\n  const {t} = useTranslation()\n\n  return (\n    <ClearButtonBox padding={1}>\n      <Stack>\n        <Button\n          aria-label={t('search.action.clear-type-filters-aria-label')}\n          data-name=\"type-filter-button\"\n          disabled={selectedTypes.length === 0}\n          mode=\"bleed\"\n          onClick={onClick}\n          text={t('search.action.clear-type-filters-label')}\n          tone=\"primary\"\n        />\n      </Stack>\n    </ClearButtonBox>\n  )\n}\n\nfunction useGetDocumentTypeItems(\n  schema: Schema,\n  selectedTypes: SchemaType[],\n  selectedTypesSnapshot: SchemaType[],\n  typeFilter: string,\n) {\n  return useMemo(() => {\n    const [itemsSelected, itemsUnselected] = partition(\n      getSelectableOmnisearchTypes(schema, typeFilter),\n      (type) => selectedTypesSnapshot.includes(type),\n    )\n\n    const hasSelectedItems = itemsSelected.length > 0\n    const hasUnselectedItems = itemsSelected.length > 0\n\n    const items: DocumentTypeMenuItem[] = []\n    if (hasSelectedItems) {\n      items.push({title: 'Selected', type: 'header'})\n    }\n    itemsSelected.forEach((item) =>\n      items.push({item, selected: selectedTypes.includes(item), type: 'item'}),\n    )\n    if (hasSelectedItems && hasUnselectedItems) {\n      items.push({type: 'divider'})\n    }\n    itemsUnselected.forEach((item) =>\n      items.push({item, selected: selectedTypes.includes(item), type: 'item'}),\n    )\n\n    return items\n  }, [schema, selectedTypes, selectedTypesSnapshot, typeFilter])\n}\n","import {ChevronDownIcon} from '@sanity/icons'\nimport {type Placement, useClickOutside} from '@sanity/ui'\nimport {useCallback, useMemo, useState} from 'react'\n\nimport {Button, Popover} from '../../../../../../../../ui-components'\nimport {useTranslation} from '../../../../../../../i18n'\nimport {POPOVER_RADIUS, POPOVER_VERTICAL_MARGIN} from '../../../constants'\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {documentTypesTruncated} from '../../../utils/documentTypesTruncated'\nimport {FilterPopoverWrapper} from '../common/FilterPopoverWrapper'\nimport {DocumentTypesPopoverContent} from './DocumentTypesPopoverContent'\n\nconst FALLBACK_PLACEMENTS: Placement[] = ['top-start', 'bottom-start']\n\nexport function DocumentTypesButton() {\n  const [open, setOpen] = useState(false)\n  const [buttonElement, setButtonElement] = useState<HTMLElement | null>(null)\n  const [popoverElement, setPopoverElement] = useState<HTMLElement | null>(null)\n\n  const {\n    state: {\n      fullscreen,\n      terms: {types},\n    },\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const handleClose = useCallback(() => setOpen(false), [])\n  const handleOpen = useCallback(() => setOpen(true), [])\n\n  useClickOutside(handleClose, [buttonElement, popoverElement])\n\n  const title = useMemo(() => documentTypesTruncated({types, t}), [types, t])\n\n  return (\n    <Popover\n      __unstable_margins={[POPOVER_VERTICAL_MARGIN, 0, 0, 0]}\n      content={\n        <FilterPopoverWrapper anchorElement={buttonElement} onClose={handleClose}>\n          <DocumentTypesPopoverContent />\n        </FilterPopoverWrapper>\n      }\n      open={open}\n      placement=\"bottom-start\"\n      fallbackPlacements={FALLBACK_PLACEMENTS}\n      portal\n      radius={POPOVER_RADIUS}\n      ref={setPopoverElement}\n    >\n      <Button\n        iconRight={ChevronDownIcon}\n        mode=\"ghost\"\n        onClick={handleOpen}\n        size={fullscreen ? 'large' : 'default'}\n        ref={setButtonElement}\n        selected={open}\n        text={title}\n        tone=\"default\"\n      />\n    </Popover>\n  )\n}\n","import {Box, Flex} from '@sanity/ui'\nimport {useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {TextWithTone} from '../../../../../../components'\nimport {useTranslation} from '../../../../../../i18n'\nimport {Translate, type TranslateComponentMap} from '../../../../../../i18n/Translate'\nimport {isRecord} from '../../../../../../util'\nimport {useSearchState} from '../../contexts/search/useSearchState'\nimport {getOperatorDefinition} from '../../definitions/operators'\nimport {type SearchFilter, type SearchFilterValues} from '../../types'\nimport {FilterTitle} from './FilterTitle'\n\ninterface FilterLabelProps {\n  filter: SearchFilter\n  fontSize?: number\n  showContent?: boolean\n}\n\nconst CustomBox = styled(Box)<{$flexShrink?: number}>`\n  flex-shrink: ${({$flexShrink = 0}) => $flexShrink};\n`\n\nexport function FilterLabel({filter, fontSize = 1, showContent = true}: FilterLabelProps) {\n  const {t} = useTranslation()\n  const {\n    state: {definitions, fullscreen},\n  } = useSearchState()\n\n  const operator = getOperatorDefinition(definitions.operators, filter.operatorType)\n\n  const ButtonValue = operator?.buttonValueComponent\n  const filterValue = filter.value\n\n  const components: TranslateComponentMap = useMemo(\n    () => ({\n      Field: () => (\n        <CustomBox $flexShrink={fullscreen ? 1 : 0}>\n          <TextWithTone tone=\"default\" size={fontSize} textOverflow=\"ellipsis\" weight=\"medium\">\n            <FilterTitle filter={filter} maxLength={fullscreen ? 25 : 40} />\n          </TextWithTone>\n        </CustomBox>\n      ),\n      Operator: ({children}) =>\n        showContent ? (\n          <CustomBox $flexShrink={0}>\n            <TextWithTone tone=\"default\" size={fontSize} textOverflow=\"ellipsis\" weight=\"regular\">\n              {children}\n            </TextWithTone>\n          </CustomBox>\n        ) : null,\n      Value: ({children}) =>\n        showContent ? (\n          <CustomBox $flexShrink={1}>\n            <TextWithTone tone=\"default\" size={fontSize} textOverflow=\"ellipsis\" weight=\"medium\">\n              {ButtonValue ? <ButtonValue value={filterValue} /> : children}\n            </TextWithTone>\n          </CustomBox>\n        ) : null,\n    }),\n    [filter, fontSize, fullscreen, showContent, ButtonValue, filterValue],\n  )\n\n  if (!operator?.descriptionKey) {\n    console.warn('Missing `descriptionKey` for operator `%s`', filter.operatorType)\n  }\n\n  if (!showContent || !operator?.descriptionKey) {\n    const Field = components.Field\n    return (\n      <Flex align=\"center\" gap={1}>\n        <Field />\n      </Flex>\n    )\n  }\n\n  return (\n    <Flex align=\"center\" gap={1}>\n      <Translate\n        t={t}\n        i18nKey={operator?.descriptionKey}\n        components={components}\n        values={getFilterValues(filter)}\n      />\n    </Flex>\n  )\n}\n\nfunction getFilterValues(filter: SearchFilter): SearchFilterValues {\n  const values: SearchFilterValues = {}\n  if (typeof filter.value === 'number') {\n    values.count = filter.value\n  }\n  if (isStringOrNumber(filter.value)) {\n    values.value = filter.value\n  }\n  if (isRecord(filter.value) && 'from' in filter.value && isStringOrNumber(filter.value.from)) {\n    values.from = filter.value.from\n  }\n  if (isRecord(filter.value) && 'to' in filter.value && isStringOrNumber(filter.value.to)) {\n    values.to = filter.value.to\n  }\n  return values\n}\n\nfunction isStringOrNumber(value: unknown): value is string | number {\n  return typeof value === 'string' || typeof value === 'number'\n}\n","import {ErrorOutlineIcon} from '@sanity/icons'\nimport {Box, Flex, type ResponsivePaddingProps, Stack} from '@sanity/ui'\n\nimport {TextWithTone} from '../../../../../../../components'\nimport {useTranslation} from '../../../../../../../i18n'\n\nexport function FilterError(props: ResponsivePaddingProps) {\n  const {t} = useTranslation()\n\n  return (\n    <Box {...props}>\n      <Flex align=\"flex-start\" gap={3}>\n        <TextWithTone tone=\"critical\">\n          <ErrorOutlineIcon />\n        </TextWithTone>\n        <Stack space={4}>\n          <TextWithTone size={1} tone=\"critical\" weight=\"medium\">\n            {t('search.error.display-filter-title')}\n          </TextWithTone>\n          <TextWithTone size={1} tone=\"critical\">\n            {t('search.error.display-filter-description')}\n          </TextWithTone>\n        </Stack>\n      </Flex>\n    </Box>\n  )\n}\n","import {ChevronDownIcon} from '@sanity/icons'\nimport {Inline, Menu, MenuDivider} from '@sanity/ui'\nimport {useCallback, useId} from 'react'\n\nimport {Button, MenuButton, MenuItem} from '../../../../../../../../ui-components'\nimport {useTranslation} from '../../../../../../../i18n'\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {getFilterDefinition} from '../../../definitions/filters'\nimport {getOperatorDefinition, type SearchOperatorDefinition} from '../../../definitions/operators'\nimport {type SearchFilter} from '../../../types'\nimport {getFilterKey} from '../../../utils/filterUtils'\n\ninterface OperatorsMenuButtonProps {\n  filter: SearchFilter\n  operator?: SearchOperatorDefinition\n}\n\nfunction CustomMenuItem({\n  onClick,\n  operator,\n  selected,\n}: {\n  onClick: (operatorType: string) => void\n  operator: SearchOperatorDefinition\n  selected: boolean\n}) {\n  const handleClick = useCallback(() => onClick(operator.type), [onClick, operator.type])\n  const {t} = useTranslation()\n\n  return (\n    <MenuItem\n      onClick={handleClick}\n      pressed={selected}\n      tone=\"default\"\n      text={t(operator.nameKey)}\n      iconRight={operator?.icon}\n    />\n  )\n}\n\nexport function OperatorsMenuButton({filter, operator}: OperatorsMenuButtonProps) {\n  const menuButtonId = useId()\n\n  const {t} = useTranslation()\n  const {dispatch, state} = useSearchState()\n  const operatorItems = getFilterDefinition(state.definitions.filters, filter.filterName)?.operators\n\n  const handleClick = useCallback(\n    (operatorType: string) => {\n      dispatch({\n        filterKey: getFilterKey(filter),\n        operatorType,\n        type: 'TERMS_FILTERS_SET_OPERATOR',\n      })\n    },\n    [dispatch, filter],\n  )\n\n  if (!operator || !operatorItems || operatorItems.length <= 1) {\n    return null\n  }\n\n  return (\n    <Inline>\n      <MenuButton\n        button={<Button mode=\"ghost\" iconRight={ChevronDownIcon} text={t(operator.nameKey)} />}\n        id={menuButtonId || ''}\n        menu={\n          <Menu>\n            {operatorItems.map((item, index) => {\n              if (item.type === 'item') {\n                const menuOperator = getOperatorDefinition(state.definitions.operators, item.name)\n                if (!menuOperator) {\n                  return null\n                }\n                return (\n                  <CustomMenuItem\n                    // eslint-disable-next-line react/no-array-index-key\n                    key={index}\n                    onClick={handleClick}\n                    operator={menuOperator}\n                    selected={operator.type === item.name}\n                  />\n                )\n              }\n              if (item.type === 'divider') {\n                // eslint-disable-next-line react/no-array-index-key\n                return <MenuDivider key={index} />\n              }\n              return null\n            })}\n          </Menu>\n        }\n        placement=\"bottom-start\"\n        popover={{\n          constrainSize: true,\n          portal: false,\n          radius: 2,\n        }}\n      />\n    </Inline>\n  )\n}\n","import {TrashIcon} from '@sanity/icons'\nimport {Box, Card, ErrorBoundary, Flex, Stack, Text} from '@sanity/ui'\nimport {type ErrorInfo, useCallback, useState} from 'react'\nimport FocusLock from 'react-focus-lock'\n\nimport {Button} from '../../../../../../../../ui-components'\nimport {supportsTouch} from '../../../../../../../util'\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {getFilterDefinition} from '../../../definitions/filters'\nimport {getOperatorDefinition} from '../../../definitions/operators'\nimport {type SearchFilter} from '../../../types'\nimport {getFieldFromFilter, getFilterKey} from '../../../utils/filterUtils'\nimport {FilterDetails} from '../common/FilterDetails'\nimport {FilterError} from './FilterError'\nimport {OperatorsMenuButton} from './OperatorsMenuButton'\n\ninterface FilterFormProps {\n  filter: SearchFilter\n}\n\ninterface ErrorParams {\n  error: Error\n  info: ErrorInfo\n}\n\nexport function FilterForm({filter}: FilterFormProps) {\n  const [errorParams, setErrorParams] = useState<ErrorParams | null>(null)\n  const {\n    dispatch,\n    state: {definitions, fullscreen},\n  } = useSearchState()\n\n  const filterDefinition = getFilterDefinition(definitions.filters, filter.filterName)\n  const operator = getOperatorDefinition(definitions.operators, filter.operatorType)\n  const fieldDefinition = getFieldFromFilter(definitions.fields, filter)\n  const filterKey = getFilterKey(filter)\n\n  const handleClose = useCallback(() => {\n    dispatch({\n      filterKey: getFilterKey(filter),\n      type: 'TERMS_FILTERS_REMOVE',\n    })\n  }, [dispatch, filter])\n\n  const handleValueChange = useCallback(\n    (value: any) => {\n      dispatch({\n        filterKey: filterKey,\n        type: 'TERMS_FILTERS_SET_VALUE',\n        value,\n      })\n    },\n    [dispatch, filterKey],\n  )\n\n  const handleCatchError = useCallback((params: ErrorParams) => {\n    setErrorParams(params)\n  }, [])\n\n  const Component = operator?.inputComponent\n\n  if (errorParams) {\n    return <FilterError padding={4} />\n  }\n\n  // Flex order is reversed to ensure form inputs are focusable first\n  return (\n    <ErrorBoundary onCatch={handleCatchError}>\n      <FocusLock autoFocus={!supportsTouch} returnFocus>\n        <Flex direction=\"column-reverse\">\n          {/* Value */}\n          {Component && (\n            <Card borderTop padding={3}>\n              <Component\n                fieldDefinition={fieldDefinition}\n                // re-render on new operators\n                key={filter.operatorType}\n                onChange={handleValueChange}\n                value={filter.value}\n              />\n            </Card>\n          )}\n\n          {/* Title, description and operator */}\n          <Card padding={3}>\n            <Stack space={3}>\n              <Flex align=\"flex-start\" gap={3} justify=\"space-between\">\n                <Box paddingLeft={1} paddingRight={2} paddingY={1}>\n                  <FilterDetails filter={filter} />\n                </Box>\n\n                {fullscreen && (\n                  <Button\n                    icon={TrashIcon}\n                    mode=\"bleed\"\n                    onClick={handleClose}\n                    tone=\"critical\"\n                    tooltipProps={{content: 'Remove filter'}}\n                  />\n                )}\n              </Flex>\n              {filterDefinition?.description && (\n                <Card border padding={3} radius={2} tone=\"transparent\">\n                  <Text muted size={1}>\n                    {filterDefinition.description}\n                  </Text>\n                </Card>\n              )}\n              <OperatorsMenuButton filter={filter} operator={operator} />\n            </Stack>\n          </Card>\n        </Flex>\n      </FocusLock>\n    </ErrorBoundary>\n  )\n}\n","import {Flex} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {DEBUG_MODE} from '../../../constants'\nimport {type SearchFilter} from '../../../types'\nimport {DebugDocumentTypes} from '../debug/_DebugDocumentTypes'\nimport {DebugFilterValues} from '../debug/_DebugFilterValues'\nimport {FilterForm} from './FilterForm'\n\ninterface FilterPopoverContentProps {\n  filter: SearchFilter\n}\n\nconst ContainerFlex = styled(Flex)`\n  max-width: 480px;\n  min-width: 150px;\n  overflow: hidden;\n  overflow: clip;\n  width: 100%;\n`\n\nexport function FilterPopoverContent({filter}: FilterPopoverContentProps) {\n  return (\n    <ContainerFlex direction=\"column\">\n      <FilterForm filter={filter} />\n\n      {/* Debug panels */}\n      {DEBUG_MODE && (\n        <>\n          <DebugFilterValues filter={filter} />\n          <DebugDocumentTypes filter={filter} />\n        </>\n      )}\n    </ContainerFlex>\n  )\n}\n","import {CloseIcon} from '@sanity/icons'\nimport {\n  // eslint-disable-next-line no-restricted-imports\n  Button, // Button with specific styling and children behavior.\n  Card,\n  rem,\n  useClickOutside,\n} from '@sanity/ui'\nimport {type KeyboardEvent, useCallback, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {Popover} from '../../../../../../../../ui-components'\nimport {useTranslation} from '../../../../../../../i18n'\nimport {POPOVER_RADIUS, POPOVER_VERTICAL_MARGIN} from '../../../constants'\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {type SearchFilter} from '../../../types'\nimport {getFilterKey, validateFilter} from '../../../utils/filterUtils'\nimport {FilterLabel} from '../../common/FilterLabel'\nimport {FilterPopoverWrapper} from '../common/FilterPopoverWrapper'\nimport {FilterPopoverContent} from './FilterPopoverContent'\n\ninterface FilterButtonProps {\n  filter: SearchFilter\n  initialOpen?: boolean\n}\n\nconst CloseButton = styled(Button)`\n  border-radius: ${({theme}) =>\n    `0 ${rem(theme.sanity.radius[2])} ${rem(theme.sanity.radius[2])} 0`};\n`\n\nconst CloseCard = styled(Card)`\n  position: absolute;\n  right: 0;\n`\n\nconst ContainerDiv = styled.div`\n  align-items: center;\n  display: inline-flex;\n  max-width: 100%;\n  position: relative;\n`\n\nconst LabelButton = styled(Button)`\n  border: none;\n  width: 100%;\n`\n\nexport function FilterButton({filter, initialOpen}: FilterButtonProps) {\n  const [open, setOpen] = useState(initialOpen)\n  const [buttonElement, setButtonElement] = useState<HTMLElement | null>(null)\n  const [popoverElement, setPopoverElement] = useState<HTMLElement | null>(null)\n\n  const {\n    dispatch,\n    state: {definitions, fullscreen},\n  } = useSearchState()\n\n  const {t} = useTranslation()\n\n  const handleClose = useCallback(() => setOpen(false), [])\n  const handleOpen = useCallback(() => setOpen(true), [])\n  const handleRemove = useCallback(\n    () =>\n      dispatch({\n        filterKey: getFilterKey(filter),\n        type: 'TERMS_FILTERS_REMOVE',\n      }),\n    [dispatch, filter],\n  )\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLButtonElement>) => {\n      if (['Backspace', 'Delete'].includes(event.key)) {\n        handleRemove()\n      }\n    },\n    [handleRemove],\n  )\n\n  useClickOutside(handleClose, [buttonElement, popoverElement])\n\n  const isValid = validateFilter({\n    fieldDefinitions: definitions.fields,\n    filter,\n    filterDefinitions: definitions.filters,\n    operatorDefinitions: definitions.operators,\n  })\n\n  return (\n    <Popover\n      __unstable_margins={[POPOVER_VERTICAL_MARGIN, 0, 0, 0]}\n      content={\n        <FilterPopoverWrapper anchorElement={buttonElement} onClose={handleClose}>\n          <FilterPopoverContent filter={filter} />\n        </FilterPopoverWrapper>\n      }\n      constrainSize\n      open={open}\n      overflow=\"auto\"\n      placement=\"bottom-start\"\n      portal\n      radius={POPOVER_RADIUS}\n      ref={setPopoverElement}\n    >\n      <ContainerDiv>\n        <Card\n          __unstable_focusRing\n          display=\"flex\"\n          radius={2}\n          tone={isValid ? 'primary' : 'transparent'}\n        >\n          <LabelButton\n            mode=\"bleed\"\n            onClick={handleOpen}\n            onKeyDown={handleKeyDown}\n            paddingLeft={fullscreen ? 3 : 2}\n            paddingRight={fullscreen ? 3 : 5}\n            paddingY={fullscreen ? 3 : 2}\n            ref={setButtonElement}\n          >\n            <FilterLabel filter={filter} showContent={isValid} />\n          </LabelButton>\n        </Card>\n\n        {!fullscreen && (\n          <CloseCard\n            __unstable_focusRing\n            display=\"flex\"\n            radius={2}\n            tone={isValid ? 'primary' : 'transparent'}\n          >\n            <CloseButton\n              aria-label={t('search.action.remove-filter-aria-label')}\n              fontSize={1}\n              icon={CloseIcon}\n              mode=\"bleed\"\n              onClick={handleRemove}\n              onKeyDown={handleKeyDown}\n              padding={2}\n              radius={2}\n            />\n          </CloseCard>\n        )}\n      </ContainerDiv>\n    </Popover>\n  )\n}\n","import {Flex} from '@sanity/ui'\nimport {useCallback, useEffect, useRef} from 'react'\n\nimport {Button} from '../../../../../../../ui-components'\nimport {useTranslation} from '../../../../../../i18n'\nimport {DEBUG_MODE} from '../../constants'\nimport {useSearchState} from '../../contexts/search/useSearchState'\nimport {getFilterKey} from '../../utils/filterUtils'\nimport {AddFilterButton} from './addFilter/AddFilterButton'\nimport {DebugDocumentTypesNarrowed} from './debug/_DebugDocumentTypesNarrowed'\nimport {DebugFilterQuery} from './debug/_DebugFilterQuery'\nimport {DocumentTypesButton} from './documentTypes/DocumentTypesButton'\nimport {FilterButton} from './filter/FilterButton'\n\nexport function Filters() {\n  const {\n    dispatch,\n    state: {\n      filters,\n      fullscreen,\n      lastAddedFilter,\n      terms: {types},\n    },\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const isMounted = useRef(false)\n\n  const handleClear = useCallback(() => {\n    dispatch({type: 'TERMS_FILTERS_CLEAR'})\n    dispatch({type: 'TERMS_TYPES_CLEAR'})\n  }, [dispatch])\n\n  const clearFiltersButtonVisible = filters.length > 0 || types.length > 0\n\n  useEffect(() => {\n    isMounted.current = true\n  }, [])\n\n  const lastAddedFilterKey = lastAddedFilter && getFilterKey(lastAddedFilter)\n\n  const ClearFiltersButton = () => (\n    <Button\n      mode=\"bleed\"\n      onClick={handleClear}\n      size={fullscreen ? 'large' : 'default'}\n      text={t('search.action.clear-filters')}\n      tone=\"critical\"\n    />\n  )\n\n  return (\n    <>\n      <Flex align=\"flex-start\" gap={3} justify=\"space-between\" padding={2}>\n        <Flex flex={1} gap={2} wrap=\"wrap\">\n          <DocumentTypesButton />\n          {filters?.map((filter) => {\n            const key = getFilterKey(filter)\n            return (\n              <FilterButton\n                filter={filter}\n                initialOpen={isMounted.current && lastAddedFilterKey === key}\n                key={key}\n              />\n            )\n          })}\n          {!fullscreen && <AddFilterButton />}\n        </Flex>\n        {clearFiltersButtonVisible && !fullscreen && <ClearFiltersButton />}\n      </Flex>\n\n      {fullscreen && (\n        <Flex justify=\"space-between\" paddingBottom={2} paddingX={2}>\n          <AddFilterButton />\n          {clearFiltersButtonVisible && <ClearFiltersButton />}\n        </Flex>\n      )}\n\n      {/* Debug panels */}\n      {DEBUG_MODE && (\n        <>\n          <DebugFilterQuery />\n          <DebugDocumentTypesNarrowed />\n        </>\n      )}\n    </>\n  )\n}\n","import {\n  type ArrayDefinition,\n  type ObjectDefinition,\n  type Schema,\n  type SchemaTypeDefinition,\n  type StringDefinition,\n} from '@sanity/types'\nimport startCase from 'lodash/startCase'\n\nimport {sanitizeFieldValue} from '../utils/sanitizeField'\nimport {getSearchableOmnisearchTypes} from '../utils/selectors'\nimport {getSupportedFieldTypes, type SearchFilterDefinition} from './filters'\n\nexport const MAX_OBJECT_TRAVERSAL_DEPTH = 3\n\n/**\n * @internal\n */\nexport interface SearchFieldDefinition {\n  documentTypes: string[]\n  fieldPath: string\n  filterName: string\n  id: string\n  name: string\n  title: string\n  titlePath: string[]\n  type: string\n}\n\n/**\n * @internal\n */\nexport type SearchFieldDefinitionDictionary = Record<\n  SearchFieldDefinition['id'],\n  SearchFieldDefinition\n>\n\nexport function createFieldDefinitions(\n  schema: Schema,\n  filterDefinitions: SearchFilterDefinition[],\n): SearchFieldDefinition[] {\n  // Get allowed document types (`__experimental_omnisearch_visibility !== false`)\n  const searchableDocumentTypeNames = getSearchableOmnisearchTypes(schema).map((s) => s.name)\n\n  // Get user-defined schema types, partitioned into documents and objects\n  const {documentTypes, objectTypes} = (schema._original?.types || [])\n    // Ignore document types hidden by omnisearch\n    .filter((t) =>\n      isDocumentObjectDefinition(t) ? searchableDocumentTypeNames.includes(t.name) : true,\n    )\n    // Ignore the 'slug' object to prevent surfacing 'current' and (deprecated) 'source field' fields.\n    .filter((schemaType) => schemaType.name !== 'slug')\n    // Ignore sanity documents and assets\n    .filter((schemaType) => !schemaType.name.startsWith('sanity.'))\n    // Partition\n    .reduce<{\n      documentTypes: Record<string, ObjectDefinition>\n      objectTypes: Record<string, ObjectDefinition>\n    }>(\n      (acc, schemaType) => {\n        if (isDocumentObjectDefinition(schemaType)) {\n          acc.documentTypes[schemaType.name] = schemaType\n        }\n        if (isObjectDefinition(schemaType)) {\n          acc.objectTypes[schemaType.name] = schemaType as ObjectDefinition\n        }\n        return acc\n      },\n      {documentTypes: {}, objectTypes: {}},\n    ) || {documentTypes: {}, objectTypes: {}}\n\n  // Get supported filter field types that have corresponding filters defined\n  const supportedFieldTypes = getSupportedFieldTypes(filterDefinitions)\n\n  return getDocumentFieldDefinitions(supportedFieldTypes, documentTypes, objectTypes)\n}\n\nexport function createFieldDefinitionDictionary(\n  fieldDefinitions: SearchFieldDefinition[],\n): SearchFieldDefinitionDictionary {\n  return fieldDefinitions.reduce<SearchFieldDefinitionDictionary>((acc, val) => {\n    acc[val.id] = val\n    return acc\n  }, {})\n}\n\nexport function generateFieldId(field: SearchFieldDefinition): string {\n  return [field.type, field.fieldPath, field.filterName, field.documentTypes.join(',')].join('-')\n}\n\nfunction getDocumentFieldDefinitions(\n  supportedFieldTypes: string[],\n  documentTypes: Record<string, ObjectDefinition>,\n  objectTypes: Record<string, ObjectDefinition>,\n) {\n  // Recursively iterate through all documents and resolve objects\n  function addFieldDefinitionRecursive({\n    acc,\n    defType,\n    depth = 0,\n    documentType,\n    prevFieldPath,\n    prevTitlePath,\n  }: {\n    acc: SearchFieldDefinition[]\n    defType: SchemaTypeDefinition\n    depth?: number\n    documentType: string\n    prevFieldPath?: string\n    prevTitlePath?: string[]\n  }) {\n    const continueRecursion = depth <= MAX_OBJECT_TRAVERSAL_DEPTH\n    const isInternalField = defType.name.startsWith('_')\n    // Sanitize schema titles (which may either be a string or React element)\n    const title = defType?.title ? sanitizeFieldValue(defType.title) : startCase(defType.name)\n    const fieldPath = prevFieldPath ? `${prevFieldPath}.${defType.name}` : defType.name\n    const titlePath = prevTitlePath ? [...prevTitlePath, title] : [title]\n\n    if (!continueRecursion) return\n\n    // Map to an existing document, object or inline object if found\n    const existingObject = objectTypes[defType.type]\n    const existingDocument = documentTypes[defType.type]\n    const inlineObject = isObjectDefinition(defType) ? defType : null\n    const targetObject = existingDocument || existingObject || inlineObject\n\n    if (targetObject) {\n      targetObject?.fields?.forEach((field) =>\n        addFieldDefinitionRecursive({\n          acc,\n          defType: field as ObjectDefinition,\n          depth: depth + 1,\n          documentType,\n          prevFieldPath: fieldPath,\n          prevTitlePath: titlePath,\n        }),\n      )\n      return\n    }\n\n    // Return if the current field type doesn't have a corresponding filter\n    if (!supportedFieldTypes.includes(defType.type)) return\n\n    acc.push({\n      documentTypes: documentType && !isInternalField ? [documentType] : [],\n      fieldPath,\n      filterName: resolveFilterName(defType),\n      id: '',\n      name: defType.name,\n      titlePath,\n      title,\n      type: defType.type,\n    })\n  }\n\n  const fieldDefinitions = Object.values(documentTypes)\n    .reduce<SearchFieldDefinition[]>((acc, documentType) => {\n      const documentFields = (documentType.fields as ObjectDefinition[]).reduce<\n        SearchFieldDefinition[]\n      >((a, field) => {\n        addFieldDefinitionRecursive({acc: a, defType: field, documentType: documentType.name})\n        return a\n      }, [])\n      acc.push(...documentFields)\n      return acc\n    }, [])\n    .reduce<SearchFieldDefinition[]>((acc, val) => {\n      const prevIndex = acc.findIndex(\n        (v) => v.fieldPath === val.fieldPath && v.title === val.title && v.type === val.type,\n      )\n      if (prevIndex > -1) {\n        acc[prevIndex] = {\n          ...acc[prevIndex],\n          documentTypes: [...acc[prevIndex].documentTypes, ...val.documentTypes],\n        }\n      } else {\n        acc.push(val)\n      }\n      return acc\n    }, [])\n    .map(addFieldDefinitionId)\n    .sort(sortFieldDefinitions)\n\n  return fieldDefinitions\n}\n\n/**\n * Create unique ID as a hash from documentTypes, full field path, filter and field types\n */\nfunction addFieldDefinitionId(field: SearchFieldDefinition) {\n  return {\n    ...field,\n    id: generateFieldId(field),\n  }\n}\n\nfunction isArrayOfPrimitives(schemaType: SchemaTypeDefinition): schemaType is ArrayDefinition {\n  if (isArrayDefinition(schemaType)) {\n    return (\n      schemaType.of.every((item) => ['boolean', 'number', 'string'].includes(item.type)) &&\n      (schemaType.options?.list ? schemaType.options.list.length > 0 : false)\n    )\n  }\n  return false\n}\n\nfunction isArrayDefinition(schemaType: SchemaTypeDefinition): schemaType is ArrayDefinition {\n  return schemaType.type === 'array'\n}\n\nfunction isDocumentObjectDefinition(\n  schemaType: SchemaTypeDefinition,\n): schemaType is ObjectDefinition {\n  return schemaType.type === 'document'\n}\n\nfunction isObjectDefinition(schemaType: SchemaTypeDefinition): schemaType is ObjectDefinition {\n  return schemaType.type === 'object'\n}\n\nfunction isStringDefinition(schemaType: SchemaTypeDefinition): schemaType is StringDefinition {\n  return schemaType.type === 'string'\n}\n\nfunction isStringListDefinition(schemaType: SchemaTypeDefinition): schemaType is StringDefinition {\n  if (isStringDefinition(schemaType)) {\n    return schemaType.options?.list ? schemaType.options.list.length > 0 : false\n  }\n  return false\n}\n\nfunction resolveFilterName(schemaType: SchemaTypeDefinition) {\n  if (isStringListDefinition(schemaType)) {\n    return 'stringList'\n  }\n  if (isArrayDefinition(schemaType)) {\n    if (schemaType.of.some((item) => item.type === 'reference')) {\n      return 'arrayReferences'\n    }\n    if (schemaType.of.find((item) => item.type === 'block')) {\n      return 'portableText'\n    }\n    if (isArrayOfPrimitives(schemaType)) {\n      return 'arrayList'\n    }\n  }\n  return schemaType.type\n}\n\n/**\n * Sort definitions by title, joined titlePath and fieldPath (in that order)\n */\nfunction sortFieldDefinitions(a: SearchFieldDefinition, b: SearchFieldDefinition): number {\n  const aTitlePath = a.titlePath.slice(0, -1).join('/')\n  const bTitlePath = b.titlePath.slice(0, -1).join('/')\n  return (\n    a.title.localeCompare(b.title) ||\n    aTitlePath.localeCompare(bTitlePath) ||\n    a.fieldPath.localeCompare(b.fieldPath)\n  )\n}\n","import {useCallback, useEffect, useMemo, useState} from 'react'\nimport {map, startWith} from 'rxjs/operators'\n\nimport {useClient} from '../../../../../hooks'\nimport {useKeyValueStore} from '../../../../../store'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../../../../../studioClient'\n\nexport const RECENT_SEARCH_VERSION = 2\nconst STORED_SEARCHES_NAMESPACE = 'studio.search.recent'\n\ninterface StoredSearch {\n  version: number\n  recentSearches: any[]\n}\n\nconst defaultValue: StoredSearch = {\n  version: RECENT_SEARCH_VERSION,\n  recentSearches: [],\n}\n\nexport function useStoredSearch(): [StoredSearch, (_value: StoredSearch) => void] {\n  const keyValueStore = useKeyValueStore()\n  const client = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const {dataset} = client.config()\n\n  const keyValueStoreKey = useMemo(() => `${STORED_SEARCHES_NAMESPACE}.${dataset}`, [dataset])\n\n  const [value, setValue] = useState<StoredSearch>(defaultValue)\n\n  const settings = useMemo(() => {\n    return keyValueStore.getKey(keyValueStoreKey)\n  }, [keyValueStore, keyValueStoreKey])\n\n  useEffect(() => {\n    const sub = settings\n      .pipe(\n        startWith(defaultValue as any),\n        map((data: StoredSearch) => {\n          // Check if the version matches RECENT_SEARCH_VERSION\n          if (data?.version !== RECENT_SEARCH_VERSION) {\n            // If not, return the default object and mutate the store (per original verifySearchVersionNumber logic)\n            keyValueStore.setKey(keyValueStoreKey, defaultValue as any)\n            return defaultValue\n          }\n          // Otherwise, return the data as is\n          return data\n        }),\n      )\n      .subscribe({\n        next: setValue,\n      })\n\n    return () => sub?.unsubscribe()\n  }, [settings, keyValueStore, keyValueStoreKey])\n\n  const set = useCallback(\n    (newValue: StoredSearch) => {\n      setValue(newValue)\n      keyValueStore.setKey(keyValueStoreKey, newValue as any)\n    },\n    [keyValueStore, keyValueStoreKey],\n  )\n\n  return useMemo(() => [value, set], [set, value])\n}\n","import {type ObjectSchemaType, type Schema} from '@sanity/types'\nimport {isEqual, omit} from 'lodash'\nimport {useMemo} from 'react'\n\nimport {useSchema} from '../../../../../hooks'\nimport {type SearchTerms} from '../../../../../search'\nimport {useSource} from '../../../../source'\nimport {\n  createFieldDefinitionDictionary,\n  createFieldDefinitions,\n  type SearchFieldDefinitionDictionary,\n} from '../definitions/fields'\nimport {\n  createFilterDefinitionDictionary,\n  type SearchFilterDefinitionDictionary,\n} from '../definitions/filters'\nimport {\n  createOperatorDefinitionDictionary,\n  type SearchOperatorDefinitionDictionary,\n} from '../definitions/operators'\nimport {type SearchFilter} from '../types'\nimport {validateFilter} from '../utils/filterUtils'\nimport {getSearchableOmnisearchTypes} from '../utils/selectors'\nimport {useStoredSearch} from './useStoredSearch'\n\nexport const MAX_RECENT_SEARCHES = 5\n/**\n * Current recent search version.\n *\n * Users with recent searches containing mismatching versions will have their recent searches cleared.\n * This value should only be incremented when search filter operator `value` data types are updated,\n * ensuring that users don't have stored recent searches containing invalid operator values.\n *\n * This is a bit of a blunt instrument: in future we could look to validate individual filter values and\n * remove outdated entries individually.\n */\nexport const RECENT_SEARCH_VERSION = 2\n\nexport type RecentSearch = SearchTerms & {\n  __recent: {\n    index: number\n    timestamp: number\n  }\n  filters?: SearchFilter[]\n}\n\nexport interface RecentSearchesStore {\n  addSearch: (searchTerm: SearchTerms, filters?: SearchFilter[]) => RecentSearch[]\n  getRecentSearches: () => RecentSearch[]\n  removeSearch: () => RecentSearch[]\n  removeSearchAtIndex: (index: number) => RecentSearch[]\n}\n\ninterface StoredSearch {\n  version: number\n  recentSearches: StoredSearchItem[]\n}\n\ninterface StoredSearchItem {\n  created: string\n  filters: SearchFilter[]\n  terms: Omit<SearchTerms, 'types'> & {typeNames: string[]}\n}\n\nexport function useRecentSearchesStore(): RecentSearchesStore {\n  const [storedSearch, setStoredSearch] = useStoredSearch()\n  const schema = useSchema()\n  const {\n    search: {operators, filters},\n  } = useSource()\n\n  // Create field, filter and operator dictionaries\n  const {fieldDefinitions, filterDefinitions, operatorDefinitions} = useMemo(() => {\n    return {\n      fieldDefinitions: createFieldDefinitionDictionary(createFieldDefinitions(schema, filters)),\n      filterDefinitions: createFilterDefinitionDictionary(filters),\n      operatorDefinitions: createOperatorDefinitionDictionary(operators),\n    }\n  }, [filters, operators, schema])\n\n  return {\n    /**\n     * Write a search term to Local Storage and return updated recent searches.\n     */\n    addSearch: (searchTerm: SearchTerms, searchFilters?: SearchFilter[]): RecentSearch[] => {\n      const storedFilters = (searchFilters || []).map(\n        (filter): SearchFilter => ({\n          fieldId: filter.fieldId,\n          filterName: filter.filterName,\n          operatorType: filter.operatorType,\n          value: filter.value,\n        }),\n      )\n\n      // Remove any filters in 'incomplete' states prior to writing to local storage.\n      const validStoredFilters = storedFilters.filter((filter) =>\n        validateFilter({\n          fieldDefinitions,\n          filter,\n          filterDefinitions,\n          operatorDefinitions,\n        }),\n      )\n\n      const newSearchItem: StoredSearchItem = {\n        created: new Date().toISOString(),\n        filters: validStoredFilters,\n        terms: {\n          query: searchTerm.query.trim(),\n          typeNames: searchTerm.types.map((s) => s.name),\n        },\n      }\n      // Add new search item, remove previous duplicates (if any) and truncate array.\n      // When comparing search items, don't compare against the created date (which will always be different).\n      const newRecent: StoredSearch = {\n        version: RECENT_SEARCH_VERSION,\n        recentSearches: [\n          newSearchItem,\n          ...storedSearch.recentSearches.filter((r) => {\n            return !isEqual(omit(r, 'created'), omit(newSearchItem, 'created'))\n          }),\n        ].slice(0, MAX_RECENT_SEARCHES),\n      }\n      setStoredSearch(newRecent)\n\n      return getRecentSearchTerms({\n        fieldDefinitions,\n        filterDefinitions,\n        operatorDefinitions,\n        schema,\n        storedSearch: newRecent,\n        setStoredSearch,\n      })\n    },\n    /**\n     * Fetch all recent searches from Local Storage.\n     * Invalid search terms will be filtered out and terms will be re-written to Local Storage.\n     */\n    getRecentSearches: () =>\n      getRecentSearchTerms({\n        fieldDefinitions,\n        filterDefinitions,\n        operatorDefinitions,\n        schema,\n        storedSearch,\n        setStoredSearch,\n      }),\n    /**\n     * Remove all search terms from Local Storage and return updated recent searches.\n     */\n    removeSearch: () => {\n      const newRecent: StoredSearch = {\n        ...storedSearch,\n        recentSearches: [],\n      }\n\n      setStoredSearch(newRecent)\n\n      return getRecentSearchTerms({\n        fieldDefinitions,\n        filterDefinitions,\n        operatorDefinitions,\n        schema,\n        storedSearch: newRecent,\n        setStoredSearch,\n      })\n    },\n    /**\n     * Remove a search term from Local Storage and return updated recent searches.\n     */\n    removeSearchAtIndex: (index: number) => {\n      if (index < 0 || index > storedSearch.recentSearches.length) {\n        return getRecentSearchTerms({\n          fieldDefinitions,\n          filterDefinitions,\n          operatorDefinitions,\n          schema,\n          storedSearch,\n          setStoredSearch,\n        })\n      }\n\n      const newRecent: StoredSearch = {\n        ...storedSearch,\n        recentSearches: [\n          ...storedSearch.recentSearches.slice(0, index),\n          ...storedSearch.recentSearches.slice(index + 1),\n        ],\n      }\n\n      setStoredSearch(newRecent)\n\n      return getRecentSearchTerms({\n        fieldDefinitions,\n        filterDefinitions,\n        operatorDefinitions,\n        schema,\n        storedSearch: newRecent,\n        setStoredSearch,\n      })\n    },\n  }\n}\n\n/**\n * Get a list of recent searches from Local Storage.\n * Recent searches contain full document schema types.\n */\nfunction getRecentSearchTerms({\n  schema,\n  fieldDefinitions,\n  filterDefinitions,\n  operatorDefinitions,\n  storedSearch,\n  setStoredSearch,\n}: {\n  schema: Schema\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  filterDefinitions: SearchFilterDefinitionDictionary\n  operatorDefinitions: SearchOperatorDefinitionDictionary\n  storedSearch: StoredSearch\n  setStoredSearch: (_value: StoredSearch) => void\n}): RecentSearch[] {\n  return sanitizeStoredSearch({\n    studioSchema: schema,\n    filterDefinitions,\n    fieldDefinitions,\n    operatorDefinitions,\n    storedSearch,\n    setStoredSearch,\n  })\n    .recentSearches.filter((r) => !!r.terms)\n    .map((r, index) => ({\n      __recent: {\n        index,\n        timestamp: new Date(r.created).getTime(),\n      },\n      filters: r.filters,\n      query: r.terms.query,\n      types: r.terms.typeNames\n        .map((typeName) => schema.get(typeName))\n        .filter((s): s is ObjectSchemaType => !!(s && s.jsonType === 'object')),\n    }))\n}\n\n/**\n * Sanitize stored search.\n *\n * Ignore searches containing:\n * - Any number of invalid document schema types\n * - Document types hidden from omnisearch with __experimental_omnisearch_visibility\n * - Invalid filters\n *\n * This mutates Local Storage if any invalid terms are found.\n */\nfunction sanitizeStoredSearch({\n  fieldDefinitions,\n  filterDefinitions,\n  operatorDefinitions,\n  studioSchema,\n  storedSearch,\n  setStoredSearch,\n}: {\n  fieldDefinitions: SearchFieldDefinitionDictionary\n  filterDefinitions: SearchFilterDefinitionDictionary\n  operatorDefinitions: SearchOperatorDefinitionDictionary\n  studioSchema: Schema\n  storedSearch: StoredSearch\n  setStoredSearch: (_value: StoredSearch) => void\n}): StoredSearch {\n  // Obtain all 'searchable' type names  defined as a type that exists in\n  // the current schema and also visible to omnisearch.\n  const searchableTypeNames = getSearchableOmnisearchTypes(studioSchema).map(\n    (schema) => schema.name,\n  )\n\n  const filteredSearch = storedSearch.recentSearches.filter((recentSearch) => {\n    return (\n      // Has valid searchable types (not hidden by omnisearch)\n      recentSearch.terms.typeNames.every((typeName) => searchableTypeNames.includes(typeName)) &&\n      recentSearch.filters.every((filter) =>\n        validateFilter({fieldDefinitions, filter, filterDefinitions, operatorDefinitions}),\n      )\n    )\n  })\n\n  const newStoredSearch: StoredSearch = {\n    version: RECENT_SEARCH_VERSION,\n    recentSearches: filteredSearch,\n  }\n\n  if (newStoredSearch.recentSearches.length < storedSearch.recentSearches.length) {\n    setStoredSearch(newStoredSearch)\n  }\n\n  return newStoredSearch\n}\n","import {ControlsIcon} from '@sanity/icons'\nimport {Flex, Inline, Text} from '@sanity/ui'\n\nimport {Translate, useTranslation} from '../../../../../i18n'\n\nexport function Instructions() {\n  const {t} = useTranslation()\n\n  return (\n    <Flex align=\"center\" direction=\"column\" gap={4} paddingX={4} paddingY={5}>\n      <Inline space={3}>\n        <Text muted>\n          <Translate\n            t={t}\n            i18nKey=\"search.instructions\"\n            components={{\n              ControlsIcon: () => <ControlsIcon key={0} style={{padding: '0 0.25rem'}} />,\n            }}\n          />\n        </Text>\n      </Inline>\n    </Flex>\n  )\n}\n","import {type SchemaType} from '@sanity/types'\nimport {Card, Text} from '@sanity/ui'\nimport {useMemo} from 'react'\n\nimport {useTranslation} from '../../../../../../i18n'\nimport {documentTypesTruncated} from '../../utils/documentTypesTruncated'\n\ninterface TypePillsProps {\n  availableCharacters?: number\n  types: SchemaType[]\n}\n\nexport function DocumentTypesPill({availableCharacters, types}: TypePillsProps) {\n  const {t} = useTranslation()\n  const title = useMemo(\n    () => documentTypesTruncated({availableCharacters, types, t}),\n    [availableCharacters, types, t],\n  )\n\n  return (\n    <Card border padding={2} radius={2}>\n      <Text muted size={1}>\n        {title}\n      </Text>\n    </Card>\n  )\n}\n","import {Card} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {type SearchFilter} from '../../types'\nimport {FilterLabel} from './FilterLabel'\n\ninterface FilterPillProps {\n  filter: SearchFilter\n}\n\nconst FilterPillCard = styled(Card)`\n  cursor: default;\n`\n\nexport function FilterPill({filter}: FilterPillProps) {\n  return (\n    <FilterPillCard border padding={2} radius={2} tone=\"primary\">\n      <FilterLabel filter={filter} />\n    </FilterPillCard>\n  )\n}\n","import {ClockIcon, CloseIcon} from '@sanity/icons'\nimport {\n  Box,\n  // eslint-disable-next-line no-restricted-imports\n  Button, // Button with specific styling and children behavior.\n  Flex,\n  Inline,\n  rem,\n  type ResponsiveMarginProps,\n  type ResponsivePaddingProps,\n  Text,\n} from '@sanity/ui'\nimport {type MouseEvent, useCallback} from 'react'\nimport styled from 'styled-components'\n\nimport {useSearchState} from '../../../contexts/search/useSearchState'\nimport {type RecentSearch, useRecentSearchesStore} from '../../../datastores/recentSearches'\nimport {DocumentTypesPill} from '../../common/DocumentTypesPill'\nimport {FilterPill} from '../../common/FilterPill'\n\nexport interface RecentSearchesProps extends ResponsiveMarginProps, ResponsivePaddingProps {\n  index: number\n  maxVisibleTypePillChars?: number\n  value: RecentSearch\n}\n\nconst DEFAULT_COMBINED_TYPE_COUNT = 40\n\nconst RecentSearchItemButton = styled(Button)`\n  border-radius: ${({theme}) => rem(theme.sanity.radius[2])};\n  cursor: default;\n  width: 100%;\n`\n\nconst SearchItemPillsBox = styled(Box)`\n  flex-shrink: 3;\n`\n\nconst SearchItemQueryFlex = styled(Flex)`\n  flex-shrink: 2;\n`\n\nconst CloseButtonDiv = styled.div`\n  opacity: 0.8;\n  visibility: hidden;\n\n  @media (hover: hover) {\n    ${RecentSearchItemButton}:hover & {\n      visibility: visible;\n    }\n    &:hover {\n      opacity: 0.4;\n    }\n  }\n`\n\nexport function RecentSearchItem({\n  index,\n  maxVisibleTypePillChars = DEFAULT_COMBINED_TYPE_COUNT,\n  value,\n  ...rest\n}: RecentSearchesProps) {\n  const {dispatch} = useSearchState()\n  const recentSearchesStore = useRecentSearchesStore()\n\n  // Determine how many characters are left to render type pills\n  const availableCharacters = maxVisibleTypePillChars - value.query.length\n\n  const handleClick = useCallback(() => {\n    dispatch({type: 'TERMS_SET', filters: value?.filters, terms: value})\n\n    // Add to Local Storage\n    if (recentSearchesStore) {\n      recentSearchesStore?.addSearch(value, value?.filters)\n    }\n  }, [dispatch, recentSearchesStore, value])\n\n  const handleDelete = useCallback(\n    (event: MouseEvent) => {\n      event.stopPropagation()\n      // Remove from Local Storage\n      if (recentSearchesStore) {\n        recentSearchesStore?.removeSearchAtIndex(index)\n      }\n    },\n    [index, recentSearchesStore],\n  )\n\n  return (\n    <Box {...rest}>\n      <RecentSearchItemButton\n        mode=\"bleed\"\n        onClick={handleClick}\n        paddingLeft={3}\n        paddingRight={1}\n        paddingY={1}\n        tabIndex={-1}\n      >\n        <Flex align=\"stretch\">\n          {/* Combination of <Inline> and a zero-width character to ensure icon is optically aligned with adjacent text */}\n          <Inline paddingY={2}>\n            <Text muted size={1}>\n              <ClockIcon />\n            </Text>\n            {/* eslint-disable-next-line i18next/no-literal-string */}\n            <Text>&#8203;</Text>\n          </Inline>\n          <Flex align=\"stretch\" flex={1} gap={2} justify=\"flex-start\" marginLeft={3} wrap=\"wrap\">\n            {/* Text query */}\n            {value.query && (\n              <SearchItemQueryFlex align=\"center\" paddingY={2}>\n                <Text muted size={1} textOverflow=\"ellipsis\" weight=\"medium\">\n                  {value.query}\n                </Text>\n              </SearchItemQueryFlex>\n            )}\n            {/* Document type */}\n            {value.types.length > 0 && (\n              <SearchItemPillsBox>\n                <DocumentTypesPill availableCharacters={availableCharacters} types={value.types} />\n              </SearchItemPillsBox>\n            )}\n            {/* Filters */}\n            {value?.filters?.map((filter, i) => {\n              // eslint-disable-next-line react/no-array-index-key\n              return <FilterPill filter={filter} key={i} />\n            })}\n          </Flex>\n\n          {/* TODO: this is neither semantic nor accessible, consider revising */}\n          <Flex align=\"center\">\n            <CloseButtonDiv onClick={handleDelete}>\n              <Flex padding={2}>\n                <Text size={1}>\n                  <CloseIcon />\n                </Text>\n              </Flex>\n            </CloseButtonDiv>\n          </Flex>\n        </Flex>\n      </RecentSearchItemButton>\n    </Box>\n  )\n}\n","import {Box, Card, Text, useMediaIndex} from '@sanity/ui'\nimport {useCallback, useMemo, useRef} from 'react'\nimport styled from 'styled-components'\n\nimport {Button} from '../../../../../../../ui-components'\nimport {\n  CommandList,\n  type CommandListHandle,\n  type CommandListRenderItemCallback,\n} from '../../../../../../components'\nimport {useTranslation} from '../../../../../../i18n'\nimport {useSearchState} from '../../contexts/search/useSearchState'\nimport {type RecentSearch, useRecentSearchesStore} from '../../datastores/recentSearches'\nimport {Instructions} from '../Instructions'\nimport {RecentSearchItem} from './item/RecentSearchItem'\n\nconst VIRTUAL_LIST_RECENT_SEARCH_ITEM_HEIGHT = 36 // px\n\n// Max character count of selected document types (combined) by breakpoint\nconst MAX_COMBINED_TYPE_COUNT_SMALL = 20\nconst MAX_COMBINED_TYPE_COUNT_LARGE = 40\n\nconst RecentSearchesBox = styled(Card)`\n  overflow-x: hidden;\n  overflow-y: auto;\n  position: relative;\n`\n\ninterface RecentSearchesProps {\n  inputElement?: HTMLInputElement | null\n}\n\nexport function RecentSearches({inputElement}: RecentSearchesProps) {\n  const {\n    dispatch,\n    state: {filtersVisible, fullscreen},\n  } = useSearchState()\n  const recentSearchesStore = useRecentSearchesStore()\n  const recentSearches = useMemo(\n    () => recentSearchesStore?.getRecentSearches(),\n    [recentSearchesStore],\n  )\n\n  const commandListRef = useRef<CommandListHandle | null>(null)\n\n  const {t} = useTranslation()\n\n  /**\n   * Remove terms from local storage.\n   * Also re-focus input (on non-touch devices)\n   */\n  const handleClearRecentSearchesClick = useCallback(() => {\n    if (recentSearchesStore) {\n      recentSearchesStore.removeSearch()\n    }\n    commandListRef?.current?.focusInputElement()\n  }, [recentSearchesStore])\n\n  const mediaIndex = useMediaIndex()\n\n  const maxVisibleTypePillChars = useMemo(() => {\n    return mediaIndex < 2 ? MAX_COMBINED_TYPE_COUNT_SMALL : MAX_COMBINED_TYPE_COUNT_LARGE\n  }, [mediaIndex])\n\n  const renderItem = useCallback<CommandListRenderItemCallback<RecentSearch>>(\n    (item, {virtualIndex}) => {\n      return (\n        <RecentSearchItem\n          index={virtualIndex}\n          maxVisibleTypePillChars={maxVisibleTypePillChars}\n          paddingBottom={1}\n          value={item}\n        />\n      )\n    },\n    [maxVisibleTypePillChars],\n  )\n\n  const hasRecentSearches = !!recentSearches.length\n\n  return (\n    <RecentSearchesBox\n      borderTop={hasRecentSearches || (!hasRecentSearches && !filtersVisible && fullscreen)}\n      flex={1}\n    >\n      {recentSearches.length > 0 ? (\n        <>\n          <Box paddingBottom={2} paddingTop={4} paddingX={3}>\n            <Text muted size={1} weight=\"medium\">\n              {t('search.recent-searches-label')}\n            </Text>\n          </Box>\n          <Box>\n            <CommandList\n              activeItemDataAttr=\"data-hovered\"\n              ariaLabel={t('search.recent-searches-aria-label')}\n              inputElement={inputElement}\n              initialIndex={0}\n              itemHeight={VIRTUAL_LIST_RECENT_SEARCH_ITEM_HEIGHT}\n              items={recentSearches}\n              paddingX={2}\n              paddingY={1}\n              renderItem={renderItem}\n            />\n          </Box>\n          <Box paddingBottom={2} paddingTop={1} paddingX={2}>\n            <Button\n              mode=\"bleed\"\n              onClick={handleClearRecentSearchesClick}\n              tone=\"default\"\n              text={t('search.action.clear-recent-searches')}\n              muted\n            />\n          </Box>\n        </>\n      ) : (\n        !filtersVisible && fullscreen && <Instructions />\n      )}\n    </RecentSearchesBox>\n  )\n}\n","import {ArrowLeftIcon, ControlsIcon, SearchIcon, SpinnerIcon} from '@sanity/icons'\nimport {Box, Card, Flex} from '@sanity/ui'\nimport {forwardRef, type KeyboardEvent, useCallback, useEffect, useRef} from 'react'\nimport styled, {keyframes} from 'styled-components'\n\nimport {Button} from '../../../../../../ui-components'\nimport {StatusButton} from '../../../../../components'\nimport {useTranslation} from '../../../../../i18n'\nimport {useSearchState} from '../contexts/search/useSearchState'\nimport {CustomTextInput} from './common/CustomTextInput'\n\nconst rotate = keyframes`\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n`\n\nconst AnimatedSpinnerIcon = styled(SpinnerIcon)`\n  animation: ${rotate} 500ms linear infinite;\n`\n\nconst FilterDiv = styled.div`\n  line-height: 0;\n  position: relative;\n`\n\ninterface SearchHeaderProps {\n  ariaInputLabel: string\n  onClose?: () => void\n}\n\nexport const SearchHeader = forwardRef<HTMLInputElement, SearchHeaderProps>(function SearchHeader(\n  {ariaInputLabel, onClose},\n  ref,\n) {\n  const isMountedRef = useRef(false)\n\n  const {\n    dispatch,\n    state: {\n      filters,\n      filtersVisible,\n      fullscreen,\n      result: {loading},\n      terms: {types, query},\n    },\n  } = useSearchState()\n  const {t} = useTranslation()\n\n  const handleFiltersToggle = useCallback(\n    () => dispatch({type: 'FILTERS_VISIBLE_SET', visible: !filtersVisible}),\n    [dispatch, filtersVisible],\n  )\n  const handleQueryChange = useCallback(\n    (e: KeyboardEvent<HTMLInputElement>) =>\n      dispatch({type: 'TERMS_QUERY_SET', query: e.currentTarget.value}),\n    [dispatch],\n  )\n  const handleQueryClear = useCallback(() => {\n    dispatch({type: 'TERMS_QUERY_SET', query: ''})\n  }, [dispatch])\n\n  /**\n   * Always show filters on non-fullscreen mode\n   */\n  useEffect(() => {\n    if (!fullscreen) {\n      dispatch({type: 'FILTERS_VISIBLE_SET', visible: true})\n    }\n  }, [dispatch, fullscreen])\n\n  useEffect(() => {\n    isMountedRef.current = true\n  }, [])\n\n  const notificationBadgeVisible = filters.length > 0 || types.length > 0\n\n  return (\n    <Card flex=\"none\">\n      <Flex align=\"center\" flex={1} gap={fullscreen ? 2 : 1} padding={fullscreen ? 2 : 1}>\n        {/* (Fullscreen) Close button */}\n        {fullscreen && (\n          <Button\n            aria-label={t('search.action.close-search-aria-label')}\n            icon={ArrowLeftIcon}\n            mode=\"bleed\"\n            onClick={onClose}\n            size=\"large\"\n            tooltipProps={{content: t('search.action.close-search-aria-label')}}\n          />\n        )}\n\n        {/* Search field */}\n        <Box flex={1}>\n          <CustomTextInput\n            __unstable_disableFocusRing\n            $background={fullscreen}\n            $smallClearButton={fullscreen}\n            aria-label={ariaInputLabel}\n            autoComplete=\"off\"\n            border={false}\n            clearButton={!!query}\n            fontSize={[2, 2, 1]}\n            icon={loading ? AnimatedSpinnerIcon : SearchIcon}\n            onChange={handleQueryChange}\n            onClear={handleQueryClear}\n            placeholder={t('search.placeholder')}\n            radius={2}\n            ref={ref}\n            spellCheck={false}\n            value={query}\n          />\n        </Box>\n\n        {/* Filter toggle */}\n        {fullscreen && (\n          <FilterDiv>\n            <StatusButton\n              aria-expanded={filtersVisible}\n              aria-label={t('search.action.toggle-filters-aria-label', {\n                context: filtersVisible ? 'hide' : 'show',\n              })}\n              icon={ControlsIcon}\n              mode=\"bleed\"\n              onClick={handleFiltersToggle}\n              selected={filtersVisible}\n              size=\"large\"\n              tone={notificationBadgeVisible ? 'primary' : undefined}\n              tooltipProps={{\n                content: t('search.action.toggle-filters-label', {\n                  context: filtersVisible ? 'hide' : 'show',\n                }),\n              }}\n            />\n          </FilterDiv>\n        )}\n      </Flex>\n    </Card>\n  )\n})\n","import {Container, Stack, Text} from '@sanity/ui'\n\nimport {useTranslation} from '../../../../../i18n'\n\nexport function NoResults() {\n  const {t} = useTranslation()\n\n  return (\n    <Container width={0}>\n      <Stack aria-live=\"assertive\" space={4} paddingX={4} paddingY={5}>\n        <Text align=\"center\" muted size={1} weight=\"medium\">\n          {t('search.no-results-title')}\n        </Text>\n        <Text align=\"center\" muted size={1}>\n          {t('search.no-results-help-description')}\n        </Text>\n      </Stack>\n    </Container>\n  )\n}\n","import {type ButtonTone, Text} from '@sanity/ui'\nimport {type ComponentProps, forwardRef, type Ref} from 'react'\nimport styled from 'styled-components'\n\n/** @internal */\nexport interface TextWithToneProps extends ComponentProps<typeof Text> {\n  tone: ButtonTone\n  dimmed?: boolean\n}\n\n/** @internal */\nconst TextWithToneStyle = styled(Text)`\n  &:not([data-muted]) {\n    &[data-tone='default'] {\n      --card-fg-color: var(--card-badge-default-fg-color);\n    }\n    &[data-tone='primary'] {\n      --card-fg-color: var(--card-badge-primary-fg-color);\n    }\n    &[data-tone='positive'] {\n      --card-fg-color: var(--card-badge-positive-fg-color);\n    }\n    &[data-tone='caution'] {\n      --card-fg-color: var(--card-badge-caution-fg-color);\n    }\n    &[data-tone='critical'] {\n      --card-fg-color: var(--card-badge-critical-fg-color);\n    }\n  }\n\n  &[data-dimmed] {\n    opacity: 0.3;\n  }\n`\n\n/** @internal */\nexport const TextWithTone = forwardRef(function TextWithTone(\n  props: TextWithToneProps,\n  ref: Ref<HTMLDivElement>,\n) {\n  const {tone, dimmed, muted, ...rest} = props\n\n  return (\n    <TextWithToneStyle\n      data-ui=\"TextWithTone\"\n      data-dimmed={dimmed ? '' : undefined}\n      data-muted={muted ? '' : undefined}\n      data-tone={tone}\n      muted={muted}\n      ref={ref}\n      {...rest}\n    />\n  )\n})\n","import {WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Flex} from '@sanity/ui'\n\nimport {TextWithTone} from '../../../../../components/textWithTone/TextWithTone'\nimport {useTranslation} from '../../../../../i18n'\n\nexport function SearchError() {\n  const {t} = useTranslation()\n\n  return (\n    <Flex\n      align=\"center\"\n      aria-live=\"assertive\"\n      direction=\"column\"\n      flex={1}\n      gap={3}\n      marginY={2}\n      padding={4}\n    >\n      <Box marginBottom={1}>\n        <TextWithTone tone=\"critical\">\n          <WarningOutlineIcon />\n        </TextWithTone>\n      </Box>\n      <TextWithTone size={2} tone=\"critical\" weight=\"medium\">\n        {t('search.error.unspecified-error-title')}\n      </TextWithTone>\n      <TextWithTone size={1} tone=\"critical\">\n        {t('search.error.unspecified-error-help-description')}\n      </TextWithTone>\n    </Flex>\n  )\n}\n","import {type SearchOrdering} from '../types'\n\nexport const ORDERINGS: Record<string, SearchOrdering> = {\n  createdAsc: {\n    ignoreScore: true,\n    sort: {direction: 'asc', field: '_createdAt'},\n    titleKey: 'search.ordering.created-ascending-label',\n  },\n  createdDesc: {\n    ignoreScore: true,\n    sort: {direction: 'desc', field: '_createdAt'},\n    titleKey: 'search.ordering.created-descending-label',\n  },\n  relevance: {\n    customMeasurementLabel: 'relevance',\n    sort: {direction: 'desc', field: '_updatedAt'},\n    titleKey: 'search.ordering.best-match-label',\n  },\n  updatedAsc: {\n    ignoreScore: true,\n    sort: {direction: 'asc', field: '_updatedAt'},\n    titleKey: 'search.ordering.updated-ascending-label',\n  },\n  updatedDesc: {\n    ignoreScore: true,\n    sort: {direction: 'desc', field: '_updatedAt'},\n    titleKey: 'search.ordering.updated-descending-label',\n  },\n}\n","import {SortIcon} from '@sanity/icons'\nimport {Card, Flex, Menu, MenuDivider} from '@sanity/ui'\nimport isEqual from 'lodash/isEqual'\nimport {useCallback, useId, useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {Button, MenuButton, MenuItem} from '../../../../../../ui-components'\nimport {useTranslation} from '../../../../../i18n'\nimport {useSearchState} from '../contexts/search/useSearchState'\nimport {ORDERINGS} from '../definitions/orderings'\nimport {type SearchOrdering} from '../types'\n\ninterface SearchDivider {\n  type: 'divider'\n}\n\nconst MENU_ORDERINGS: (SearchDivider | SearchOrdering)[] = [\n  ORDERINGS.relevance,\n  {type: 'divider'},\n  ORDERINGS.createdAsc,\n  ORDERINGS.createdDesc,\n  {type: 'divider'},\n  ORDERINGS.updatedAsc,\n  ORDERINGS.updatedDesc,\n]\n\nconst SortMenuContentFlex = styled(Flex)`\n  box-sizing: border-box;\n`\n\nfunction isSearchDivider(item: SearchDivider | SearchOrdering): item is SearchDivider {\n  return (item as SearchDivider).type === 'divider'\n}\n\nfunction CustomMenuItem({ordering}: {ordering: SearchOrdering}) {\n  const {t} = useTranslation()\n  const {\n    dispatch,\n    state: {ordering: currentOrdering},\n  } = useSearchState()\n\n  const handleClick = useCallback(() => {\n    dispatch({ordering, type: 'ORDERING_SET'})\n  }, [dispatch, ordering])\n\n  const isSelected = useMemo(() => isEqual(currentOrdering, ordering), [currentOrdering, ordering])\n\n  return (\n    <MenuItem\n      onClick={handleClick}\n      pressed={isSelected}\n      tone=\"default\"\n      text={t(ordering.titleKey)}\n    />\n  )\n}\n\nexport function SortMenu() {\n  const {t} = useTranslation()\n  const {\n    state: {ordering},\n  } = useSearchState()\n\n  const menuButtonId = useId()\n\n  const currentMenuItem = MENU_ORDERINGS.find(\n    (item): item is SearchOrdering => isEqual(ordering, item) && !isSearchDivider(item),\n  )\n\n  if (!currentMenuItem) {\n    return null\n  }\n\n  return (\n    <Card borderBottom>\n      <SortMenuContentFlex align=\"center\" flex={1} padding={2}>\n        <MenuButton\n          button={<Button mode=\"bleed\" icon={SortIcon} text={t(currentMenuItem.titleKey)} />}\n          id={menuButtonId || ''}\n          menu={\n            <Menu>\n              {MENU_ORDERINGS.map((item, index) => {\n                if (isSearchDivider(item)) {\n                  // eslint-disable-next-line react/no-array-index-key\n                  return <MenuDivider key={index} />\n                }\n                return (\n                  <CustomMenuItem\n                    // eslint-disable-next-line react/no-array-index-key\n                    key={index}\n                    ordering={item}\n                  />\n                )\n              })}\n            </Menu>\n          }\n          placement=\"bottom-start\"\n          popover={{portal: true, radius: 2}}\n        />\n      </SortMenuContentFlex>\n    </Card>\n  )\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {Card, type CardTone, Code, Inline, Stack} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {Tooltip} from '../../../../../../../../ui-components'\nimport {type WeightedHit} from '../../../../../../../search'\n\ninterface DebugScoreProps {\n  data: WeightedHit\n}\n\nconst DebugScoreCard = styled(Card)`\n  cursor: help;\n  left: 0;\n  position: absolute;\n  top: 0;\n`\n\nexport function DebugOverlay({data}: DebugScoreProps) {\n  const {score} = data\n\n  let tone: CardTone = 'default'\n  if (score <= 0.1) {\n    tone = 'critical'\n  } else if (score >= 0.5) {\n    tone = 'primary'\n  }\n\n  const matchingStories = data.stories.filter((story) => story.score > 0)\n\n  return (\n    <>\n      <Tooltip\n        content={\n          <Stack space={2}>\n            {matchingStories.length ? (\n              <>\n                {matchingStories.map((story) => (\n                  <Inline key={story.path} space={3}>\n                    <Code size={0} weight=\"medium\">\n                      {story.path}\n                    </Code>\n                    <Code size={0}>{story.why}</Code>\n                  </Inline>\n                ))}\n              </>\n            ) : (\n              <Code size={0}>No matches</Code>\n            )}\n          </Stack>\n        }\n        placement=\"bottom-start\"\n        portal\n      >\n        <DebugScoreCard padding={1} shadow={1} tone={tone}>\n          <Code size={0}>score: {score}</Code>\n        </DebugScoreCard>\n      </Tooltip>\n    </>\n  )\n}\n","import {Card, Flex} from '@sanity/ui'\nimport {useCallback} from 'react'\nimport styled from 'styled-components'\n\nimport {CommandList, type CommandListRenderItemCallback} from '../../../../../../components'\nimport {useTranslation} from '../../../../../../i18n'\nimport {type WeightedHit} from '../../../../../../search'\nimport {getPublishedId} from '../../../../../../util/draftUtils'\nimport {useSearchState} from '../../contexts/search/useSearchState'\nimport {useRecentSearchesStore} from '../../datastores/recentSearches'\nimport {NoResults} from '../NoResults'\nimport {SearchError} from '../SearchError'\nimport {SortMenu} from '../SortMenu'\nimport {DebugOverlay} from './item/DebugOverlay'\nimport {type ItemSelectHandler, SearchResultItem} from './item/SearchResultItem'\n\nconst VIRTUAL_LIST_SEARCH_RESULT_ITEM_HEIGHT = 57 // px\nconst VIRTUAL_LIST_OVERSCAN = 4\n\nconst SearchResultsInnerFlex = styled(Flex)<{$loading: boolean}>`\n  opacity: ${({$loading}) => ($loading ? 0.5 : 1)};\n  overflow-x: hidden;\n  overflow-y: auto;\n  position: relative;\n  transition: 300ms opacity;\n  width: 100%;\n`\n\ninterface SearchResultsProps {\n  disableIntentLink?: boolean\n  inputElement: HTMLInputElement | null\n  onItemSelect?: ItemSelectHandler\n}\n\nexport function SearchResults({disableIntentLink, inputElement, onItemSelect}: SearchResultsProps) {\n  const {\n    dispatch,\n    onClose,\n    setSearchCommandList,\n    state: {debug, filters, fullscreen, lastActiveIndex, result, terms},\n  } = useSearchState()\n  const {t} = useTranslation()\n  const recentSearchesStore = useRecentSearchesStore()\n\n  const hasSearchResults = !!result.hits.length\n  const hasNoSearchResults = !result.hits.length && result.loaded\n  const hasError = result.error\n\n  /**\n   * Add current search to recent searches, trigger child item click and close search\n   */\n  const handleSearchResultClick = useCallback(() => {\n    if (recentSearchesStore) {\n      recentSearchesStore.addSearch(terms, filters)\n    }\n    onClose?.()\n  }, [filters, onClose, recentSearchesStore, terms])\n\n  const handleEndReached = useCallback(() => {\n    dispatch({type: 'PAGE_INCREMENT'})\n  }, [dispatch])\n\n  const renderItem = useCallback<CommandListRenderItemCallback<WeightedHit>>(\n    (item) => {\n      return (\n        <>\n          <SearchResultItem\n            disableIntentLink={disableIntentLink}\n            documentId={getPublishedId(item.hit._id) || ''}\n            documentType={item.hit._type}\n            onClick={handleSearchResultClick}\n            onItemSelect={onItemSelect}\n            paddingY={1}\n          />\n          {debug && <DebugOverlay data={item} />}\n        </>\n      )\n    },\n    [debug, disableIntentLink, handleSearchResultClick, onItemSelect],\n  )\n\n  return (\n    <Flex>\n      <Card\n        borderTop={fullscreen || !!(hasError || hasSearchResults || hasNoSearchResults)}\n        flex={1}\n      >\n        <Flex direction=\"column\" height=\"fill\">\n          {/* Sort menu */}\n          {hasSearchResults && <SortMenu />}\n\n          {/* Results */}\n          <SearchResultsInnerFlex $loading={result.loading} aria-busy={result.loading} flex={1}>\n            {hasError ? (\n              <SearchError />\n            ) : (\n              <>\n                {hasSearchResults && (\n                  <CommandList\n                    activeItemDataAttr=\"data-hovered\"\n                    ariaLabel={t('search.search-results-label')}\n                    data-testid=\"search-results\"\n                    fixedHeight\n                    initialIndex={lastActiveIndex}\n                    inputElement={inputElement}\n                    itemHeight={VIRTUAL_LIST_SEARCH_RESULT_ITEM_HEIGHT}\n                    items={result.hits}\n                    overscan={VIRTUAL_LIST_OVERSCAN}\n                    onEndReached={handleEndReached}\n                    paddingX={2}\n                    paddingY={1}\n                    ref={setSearchCommandList}\n                    renderItem={renderItem}\n                  />\n                )}\n                {hasNoSearchResults && <NoResults />}\n              </>\n            )}\n          </SearchResultsInnerFlex>\n        </Flex>\n      </Card>\n    </Flex>\n  )\n}\n","import {Card, Portal, useClickOutside, useLayer} from '@sanity/ui'\nimport {AnimatePresence, motion, type Transition, type Variants} from 'framer-motion'\nimport {useCallback, useRef, useState} from 'react'\nimport FocusLock from 'react-focus-lock'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../../../i18n'\nimport {supportsTouch} from '../../../../../util'\nimport {\n  POPOVER_INPUT_PADDING,\n  POPOVER_MAX_HEIGHT,\n  POPOVER_MAX_WIDTH,\n  POPOVER_RADIUS,\n} from '../constants'\nimport {useSearchState} from '../contexts/search/useSearchState'\nimport {hasSearchableTerms} from '../utils/hasSearchableTerms'\nimport {SearchWrapper} from './common/SearchWrapper'\nimport {Filters} from './filters/Filters'\nimport {RecentSearches} from './recentSearches/RecentSearches'\nimport {SearchHeader} from './SearchHeader'\nimport {type ItemSelectHandler} from './searchResults/item/SearchResultItem'\nimport {SearchResults} from './searchResults/SearchResults'\n\n/**\n * @internal\n */\nexport interface SearchPopoverProps {\n  disableFocusLock?: boolean\n  disableIntentLink?: boolean\n  onClose: () => void\n  onItemSelect?: ItemSelectHandler\n  /**\n   * If provided, will trigger to open the search popover when user types hotkey + k\n   */\n  onOpen?: () => void\n  open: boolean\n}\n\nconst ANIMATION_TRANSITION: Transition = {\n  duration: 0.4,\n  type: 'spring',\n}\n\nconst CARD_VARIANTS: Variants = {\n  open: {opacity: 1, scale: 1, x: '-50%'},\n  closed: {opacity: 0, scale: 0.99, x: '-50%'},\n}\n\nconst OVERLAY_VARIANTS: Variants = {\n  open: {opacity: 1},\n  closed: {opacity: 0},\n}\n\nconst Y_POSITION = 12 // vh\n\nconst MotionOverlay = styled(motion(Card))`\n  background-color: var(--card-backdrop-color);\n  bottom: 0;\n  left: 0;\n  position: absolute;\n  right: 0;\n  top: 0;\n`\n\nconst SearchMotionCard = styled(motion(Card))`\n  display: flex !important;\n  flex-direction: column;\n  left: 50%;\n  max-height: min(\n    calc(100vh - ${Y_POSITION}vh - ${POPOVER_INPUT_PADDING}px),\n    ${POPOVER_MAX_HEIGHT}px\n  );\n  position: absolute;\n  top: ${Y_POSITION}vh;\n  width: min(calc(100vw - ${POPOVER_INPUT_PADDING * 2}px), ${POPOVER_MAX_WIDTH}px);\n`\n\n/**\n * @internal\n */\nexport function SearchPopover({\n  disableFocusLock,\n  disableIntentLink,\n  onClose,\n  onItemSelect,\n  onOpen,\n  open,\n}: SearchPopoverProps) {\n  const [inputElement, setInputElement] = useState<HTMLInputElement | null>(null)\n\n  const popoverElement = useRef<HTMLElement | null>(null)\n\n  const {isTopLayer, zIndex} = useLayer()\n  const {t} = useTranslation()\n\n  const {\n    onClose: onSearchClose,\n    state: {filtersVisible, terms},\n  } = useSearchState()\n\n  const hasValidTerms = hasSearchableTerms({terms})\n\n  /**\n   * Check for top-most layer to prevent closing if a portalled element (i.e. menu button) is active\n   */\n  const handleClickOutside = useCallback(() => {\n    if (isTopLayer && onSearchClose && open) {\n      onSearchClose()\n    }\n  }, [isTopLayer, onSearchClose, open])\n\n  useClickOutside(handleClickOutside, [popoverElement.current])\n\n  return (\n    <SearchWrapper hasValidTerms={hasValidTerms} onClose={onClose} onOpen={onOpen} open={open}>\n      <AnimatePresence>\n        {open && (\n          <Portal>\n            <FocusLock autoFocus={!supportsTouch} disabled={disableFocusLock} returnFocus>\n              <MotionOverlay\n                animate=\"open\"\n                exit=\"closed\"\n                initial=\"closed\"\n                style={{zIndex}}\n                transition={ANIMATION_TRANSITION}\n                variants={OVERLAY_VARIANTS}\n              />\n\n              <SearchMotionCard\n                animate=\"open\"\n                exit=\"closed\"\n                initial=\"closed\"\n                overflow=\"hidden\"\n                radius={POPOVER_RADIUS}\n                ref={popoverElement}\n                shadow={2}\n                style={{zIndex}}\n                transition={ANIMATION_TRANSITION}\n                variants={CARD_VARIANTS}\n              >\n                <SearchHeader\n                  ariaInputLabel={\n                    hasValidTerms\n                      ? t('search.search-results-aria-label')\n                      : t('search.recent-searches-aria-label')\n                  }\n                  onClose={onClose}\n                  ref={setInputElement}\n                />\n                {filtersVisible && (\n                  <Card borderTop flex=\"none\">\n                    <Filters />\n                  </Card>\n                )}\n                {hasValidTerms ? (\n                  <SearchResults\n                    inputElement={inputElement}\n                    onItemSelect={onItemSelect}\n                    disableIntentLink={disableIntentLink}\n                  />\n                ) : (\n                  <RecentSearches inputElement={inputElement} />\n                )}\n              </SearchMotionCard>\n            </FocusLock>\n          </Portal>\n        )}\n      </AnimatePresence>\n    </SearchWrapper>\n  )\n}\n","import {type SearchTerms} from '../../../../../search'\nimport {type RecentSearch} from '../datastores/recentSearches'\n\nexport function isRecentSearchTerms(terms: SearchTerms | RecentSearch): terms is RecentSearch {\n  return typeof (terms as RecentSearch).__recent !== 'undefined'\n}\n","import debug from 'debug'\n\nimport {DEBUG_FRAGMENT} from '../constants'\n\nconst rootName = 'core:studio:navbar:search:'\n\nexport default debug(rootName)\nexport function debugWithName(name: string): debug.Debugger {\n  const namespace = `${rootName}${name}`\n  if (debug && debug.enabled(namespace)) {\n    return debug(namespace)\n  }\n  return debug(rootName)\n}\n\nexport function isDebugMode(): boolean {\n  return typeof window === 'undefined'\n    ? false\n    : window.location.hash.slice(1).split(';').includes(DEBUG_FRAGMENT)\n}\n","import {type CurrentUser, type SchemaType} from '@sanity/types'\n\nimport {type SearchHit, type SearchTerms} from '../../../../../../search'\nimport {getPublishedId} from '../../../../../../util'\nimport {type RecentSearch} from '../../datastores/recentSearches'\nimport {type SearchFieldDefinitionDictionary} from '../../definitions/fields'\nimport {type SearchFilterDefinitionDictionary} from '../../definitions/filters'\nimport {\n  getOperatorDefinition,\n  getOperatorInitialValue,\n  type SearchOperatorDefinitionDictionary,\n} from '../../definitions/operators'\nimport {ORDERINGS} from '../../definitions/orderings'\nimport {type SearchFilter, type SearchOrdering} from '../../types'\nimport {debugWithName, isDebugMode} from '../../utils/debug'\nimport {\n  generateFilterQuery,\n  getFieldFromFilter,\n  getFilterKey,\n  narrowDocumentTypes,\n} from '../../utils/filterUtils'\nimport {isRecentSearchTerms} from '../../utils/isRecentSearchTerms'\nimport {sortTypes} from '../../utils/selectors'\n\ninterface PaginationState {\n  cursor: string | null\n  nextCursor: string | null\n}\n\nexport type SearchReducerState = PaginationState & {\n  currentUser: CurrentUser | null\n  debug: boolean\n  definitions: SearchDefinitions\n  documentTypesNarrowed: string[]\n  filters: SearchFilter[]\n  filtersVisible: boolean\n  fullscreen?: boolean\n  lastAddedFilter?: SearchFilter | null\n  lastActiveIndex: number\n  ordering: SearchOrdering\n  result: SearchResult\n  terms: RecentSearch | SearchTerms\n}\n\nexport interface SearchDefinitions {\n  fields: SearchFieldDefinitionDictionary\n  filters: SearchFilterDefinitionDictionary\n  operators: SearchOperatorDefinitionDictionary\n}\n\nexport interface SearchResult {\n  error: Error | null\n  hasLocal: boolean\n  hits: SearchHit[]\n  loaded: boolean\n  loading: boolean\n}\n\nexport interface InitialSearchState {\n  currentUser: CurrentUser | null\n  fullscreen?: boolean\n  definitions: SearchDefinitions\n  pagination: PaginationState\n}\n\nexport function initialSearchState({\n  currentUser,\n  fullscreen,\n  definitions,\n  pagination,\n}: InitialSearchState): SearchReducerState {\n  return {\n    currentUser,\n    debug: isDebugMode(),\n    documentTypesNarrowed: [],\n    filters: [],\n    filtersVisible: true,\n    fullscreen,\n    lastActiveIndex: -1,\n    ordering: ORDERINGS.relevance,\n    ...pagination,\n    result: {\n      error: null,\n      hasLocal: false,\n      hits: [],\n      loaded: false,\n      loading: false,\n    },\n    terms: {\n      query: '',\n      types: [],\n    },\n    definitions,\n  }\n}\n\nexport type FiltersVisibleSet = {type: 'FILTERS_VISIBLE_SET'; visible: boolean}\nexport type LastActiveIndexSet = {type: 'LAST_ACTIVE_INDEX_SET'; index: number}\nexport type PageIncrement = {type: 'PAGE_INCREMENT'}\nexport type OrderingReset = {type: 'ORDERING_RESET'}\nexport type OrderingSet = {ordering: SearchOrdering; type: 'ORDERING_SET'}\nexport type SearchClear = {type: 'SEARCH_CLEAR'}\nexport type SearchRequestComplete = {\n  type: 'SEARCH_REQUEST_COMPLETE'\n  hits: SearchHit[]\n  nextCursor: string | undefined\n}\nexport type SearchRequestError = {type: 'SEARCH_REQUEST_ERROR'; error: Error}\nexport type SearchRequestStart = {type: 'SEARCH_REQUEST_START'}\nexport type TermsFiltersAdd = {filter: SearchFilter; type: 'TERMS_FILTERS_ADD'}\nexport type TermsFiltersClear = {type: 'TERMS_FILTERS_CLEAR'}\nexport type TermsFiltersRemove = {filterKey: string; type: 'TERMS_FILTERS_REMOVE'}\nexport type TermsFiltersSetOperator = {\n  filterKey: string\n  operatorType: string\n  type: 'TERMS_FILTERS_SET_OPERATOR'\n}\nexport type TermsFiltersSetValue = {\n  filterKey: string\n  type: 'TERMS_FILTERS_SET_VALUE'\n  value?: any\n}\nexport type TermsQuerySet = {type: 'TERMS_QUERY_SET'; query: string}\nexport type TermsSet = {type: 'TERMS_SET'; filters?: SearchFilter[]; terms: SearchTerms}\nexport type TermsTypeAdd = {type: 'TERMS_TYPE_ADD'; schemaType: SchemaType}\nexport type TermsTypeRemove = {type: 'TERMS_TYPE_REMOVE'; schemaType: SchemaType}\nexport type TermsTypesClear = {type: 'TERMS_TYPES_CLEAR'}\n\nexport type SearchAction =\n  | FiltersVisibleSet\n  | LastActiveIndexSet\n  | OrderingReset\n  | OrderingSet\n  | PageIncrement\n  | SearchClear\n  | SearchRequestComplete\n  | SearchRequestError\n  | SearchRequestStart\n  | TermsFiltersAdd\n  | TermsFiltersClear\n  | TermsFiltersSetOperator\n  | TermsFiltersRemove\n  | TermsFiltersSetValue\n  | TermsQuerySet\n  | TermsSet\n  | TermsTypeAdd\n  | TermsTypeRemove\n  | TermsTypesClear\n\nconst debug = debugWithName('reducer')\n\nexport function searchReducer(state: SearchReducerState, action: SearchAction): SearchReducerState {\n  let prefix = ''\n  if (action.type.startsWith('SEARCH_REQUEST')) {\n    prefix = ''\n  }\n  if (action.type.startsWith('RECENT_SEARCHES')) {\n    prefix = ''\n  }\n  debug(prefix, action)\n\n  switch (action.type) {\n    case 'FILTERS_VISIBLE_SET':\n      return {\n        ...state,\n        filtersVisible: action.visible,\n      }\n    case 'LAST_ACTIVE_INDEX_SET':\n      return {\n        ...state,\n        lastActiveIndex: action.index,\n      }\n    case 'ORDERING_RESET':\n      return {\n        ...state,\n        ordering: ORDERINGS.relevance,\n        terms: stripRecent(state.terms),\n      }\n    case 'ORDERING_SET':\n      return {\n        ...state,\n        ordering: action.ordering,\n        terms: stripRecent(state.terms),\n        result: {\n          ...state.result,\n          hasLocal: false,\n        },\n      }\n    case 'PAGE_INCREMENT':\n      return {\n        ...state,\n        cursor: state.nextCursor ?? state.cursor,\n        nextCursor: null,\n        terms: stripRecent(state.terms),\n      }\n    case 'SEARCH_CLEAR':\n      return {\n        ...state,\n        cursor: null,\n        nextCursor: null,\n        result: {\n          ...state.result,\n          hasLocal: false,\n          hits: [],\n        },\n      }\n    case 'SEARCH_REQUEST_COMPLETE':\n      return {\n        ...state,\n        nextCursor: action.nextCursor ?? null,\n        result: {\n          ...state.result,\n          error: null,\n          hasLocal: true,\n          hits: state.result.hasLocal\n            ? deduplicate([...state.result.hits, ...action.hits])\n            : action.hits,\n          loaded: true,\n          loading: false,\n        },\n      }\n    case 'SEARCH_REQUEST_ERROR':\n      return {\n        ...state,\n        result: {\n          ...state.result,\n          error: action.error,\n          loaded: false,\n          loading: false,\n        },\n      }\n    case 'SEARCH_REQUEST_START':\n      return {\n        ...state,\n        result: {\n          ...state.result,\n          loaded: false,\n          loading: true,\n        },\n      }\n    case 'TERMS_FILTERS_ADD': {\n      const newFilter: SearchFilter = {\n        ...action.filter,\n        value: getOperatorInitialValue(state.definitions.operators, action.filter.operatorType),\n      }\n      const filters = [...state.filters, newFilter]\n\n      return {\n        ...state,\n        documentTypesNarrowed: narrowDocumentTypes({\n          fieldDefinitions: state.definitions.fields,\n          filters,\n          types: state.terms.types,\n        }),\n        filters,\n        lastAddedFilter: newFilter,\n        terms: {\n          ...state.terms,\n          filter: generateFilterQuery({\n            fieldDefinitions: state.definitions.fields,\n            filterDefinitions: state.definitions.filters,\n            filters,\n            operatorDefinitions: state.definitions.operators,\n          }),\n        },\n      }\n    }\n    case 'TERMS_FILTERS_CLEAR': {\n      const filters: SearchFilter[] = []\n\n      return {\n        ...state,\n        documentTypesNarrowed: narrowDocumentTypes({\n          fieldDefinitions: state.definitions.fields,\n          filters,\n          types: state.terms.types,\n        }),\n        filters,\n        terms: {\n          ...state.terms,\n          filter: generateFilterQuery({\n            fieldDefinitions: state.definitions.fields,\n            filterDefinitions: state.definitions.filters,\n            filters,\n            operatorDefinitions: state.definitions.operators,\n          }),\n        },\n      }\n    }\n    case 'TERMS_FILTERS_REMOVE': {\n      const index = state.filters.findIndex((filter) => getFilterKey(filter) === action.filterKey)\n\n      const filters = [\n        ...state.filters.slice(0, index), //\n        ...state.filters.slice(index + 1),\n      ]\n\n      return {\n        ...state,\n        documentTypesNarrowed: narrowDocumentTypes({\n          fieldDefinitions: state.definitions.fields,\n          filters,\n          types: state.terms.types,\n        }),\n        filters,\n        terms: {\n          ...state.terms,\n          filter: generateFilterQuery({\n            fieldDefinitions: state.definitions.fields,\n            filterDefinitions: state.definitions.filters,\n            filters,\n            operatorDefinitions: state.definitions.operators,\n          }),\n        },\n      }\n    }\n    case 'TERMS_FILTERS_SET_OPERATOR': {\n      // Compare input components between current and target operators, and update\n      // target filter value if it has changed.\n      const matchedFilter = state.filters.find(\n        (filter) => getFilterKey(filter) === action.filterKey,\n      )\n      const currentOperator = getOperatorDefinition(\n        state.definitions.operators,\n        matchedFilter?.operatorType,\n      )\n      const nextOperator = getOperatorDefinition(state.definitions.operators, action.operatorType)\n      const nextInitialValue = nextOperator?.initialValue\n      const inputComponentChanged = currentOperator?.inputComponent != nextOperator?.inputComponent\n\n      const filters = state.filters.map((filter) => {\n        if (getFilterKey(filter) === action.filterKey) {\n          return {\n            ...filter,\n            operatorType: action.operatorType,\n            ...(inputComponentChanged ? {value: nextInitialValue} : {}),\n          }\n        }\n        return filter\n      })\n\n      return {\n        ...state,\n        filters,\n        terms: {\n          ...state.terms,\n          filter: generateFilterQuery({\n            fieldDefinitions: state.definitions.fields,\n            filterDefinitions: state.definitions.filters,\n            filters,\n            operatorDefinitions: state.definitions.operators,\n          }),\n        },\n      }\n    }\n    case 'TERMS_FILTERS_SET_VALUE': {\n      const filters = state.filters.map((filter) => {\n        if (getFilterKey(filter) === action.filterKey) {\n          return {\n            ...filter,\n            value: action.value,\n          }\n        }\n        return filter\n      })\n\n      return {\n        ...state,\n        filters,\n        terms: {\n          ...state.terms,\n          filter: generateFilterQuery({\n            fieldDefinitions: state.definitions.fields,\n            filterDefinitions: state.definitions.filters,\n            filters,\n            operatorDefinitions: state.definitions.operators,\n          }),\n        },\n      }\n    }\n    case 'TERMS_QUERY_SET':\n      return {\n        ...state,\n        cursor: null,\n        nextCursor: null,\n        result: {\n          ...state.result,\n          loaded: false,\n          hasLocal: false,\n        },\n        terms: stripRecent({\n          ...state.terms,\n          query: action.query,\n        }),\n      }\n    case 'TERMS_SET': {\n      const filters = action.filters || []\n      const types = [\n        ...(state.terms.types || []), //\n        ...action.terms.types,\n      ].sort(sortTypes)\n\n      return {\n        ...state,\n        documentTypesNarrowed: narrowDocumentTypes({\n          fieldDefinitions: state.definitions.fields,\n          filters,\n          types,\n        }),\n        filters,\n        lastAddedFilter: null,\n        cursor: null,\n        nextCursor: null,\n        result: {\n          ...state.result,\n          loaded: false,\n          hasLocal: false,\n        },\n        terms: {\n          ...action.terms,\n          filter: generateFilterQuery({\n            fieldDefinitions: state.definitions.fields,\n            filterDefinitions: state.definitions.filters,\n            filters,\n            operatorDefinitions: state.definitions.operators,\n          }),\n        },\n      }\n    }\n    case 'TERMS_TYPE_ADD': {\n      const types = [\n        ...(state.terms.types || []), //\n        action.schemaType,\n      ].sort(sortTypes)\n\n      // Get narrowed document types based on selected types only (ignore filters)\n      const documentTypesNarrowed = narrowDocumentTypes({\n        fieldDefinitions: state.definitions.fields,\n        filters: [],\n        types,\n      })\n\n      // Remove field filters that don't qualify under the above narrowed document types.\n      // Non field-filters are always included.\n      const filters = state.filters.filter((f) => {\n        const fieldDefinition = getFieldFromFilter(state.definitions.fields, f)\n        if (fieldDefinition) {\n          // An empty documentTypes array denotes support across all fields.\n          if (fieldDefinition.documentTypes.length === 0) {\n            return true\n          }\n          return documentTypesNarrowed.every(\n            (type) => fieldDefinition.documentTypes.findIndex((t) => t === type) > -1,\n          )\n        }\n        return true\n      })\n\n      return {\n        ...state,\n        documentTypesNarrowed,\n        filters,\n        cursor: null,\n        nextCursor: null,\n        result: {\n          ...state.result,\n          loaded: false,\n          hasLocal: false,\n        },\n        terms: stripRecent({\n          ...state.terms,\n          filter: generateFilterQuery({\n            fieldDefinitions: state.definitions.fields,\n            filterDefinitions: state.definitions.filters,\n            operatorDefinitions: state.definitions.operators,\n            filters,\n          }),\n          types,\n        }),\n      }\n    }\n    case 'TERMS_TYPE_REMOVE': {\n      const types = (state.terms.types || []).filter((s) => s !== action.schemaType)\n\n      return {\n        ...state,\n        documentTypesNarrowed: narrowDocumentTypes({\n          fieldDefinitions: state.definitions.fields,\n          filters: state.filters,\n          types,\n        }),\n        cursor: null,\n        nextCursor: null,\n        result: {\n          ...state.result,\n          loaded: false,\n          hasLocal: false,\n        },\n        terms: stripRecent({\n          ...state.terms,\n          types,\n        }),\n      }\n    }\n    case 'TERMS_TYPES_CLEAR': {\n      const types: SchemaType[] = []\n\n      return {\n        ...state,\n        documentTypesNarrowed: narrowDocumentTypes({\n          fieldDefinitions: state.definitions.fields,\n          filters: state.filters,\n          types,\n        }),\n        cursor: null,\n        nextCursor: null,\n        result: {\n          ...state.result,\n          loaded: false,\n          hasLocal: false,\n        },\n        terms: stripRecent({\n          ...state.terms,\n          types: [],\n        }),\n      }\n    }\n    default:\n      return state\n  }\n}\n\n/**\n * This function is used to strip __recent from terms, generally whenever there's a change in\n * search terms or options that would otherwise trigger an additional search request.\n * (e.g. updating the search query, changing a sort filter, adding / removing document types)\n *\n * This is done so we can better disambiguate between requests sent as a result of clicking a 'recent search'\n * for purposes of measurement.\n *\n */\n// @todo: remove this (and associated tests) once client-side instrumentation is available\nfunction stripRecent(terms: RecentSearch | SearchTerms) {\n  if (isRecentSearchTerms(terms)) {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const {__recent, ...rest} = terms\n    return rest\n  }\n  return terms\n}\n\n/**\n * At page boundaries, the Text Search API may sometimes produce duplicate results. This function\n * deduplicates an array of results based on their ids.\n *\n * Note that should any result appear again in subsequent pages, its first instance will be removed.\n */\nfunction deduplicate(hits: SearchHit[]): SearchHit[] {\n  const hitsById = hits.reduce((map, hit) => {\n    const id = getPublishedId(hit.hit._id)\n\n    return {\n      ...map,\n      [id]: hit,\n    }\n  }, {})\n\n  return Object.values(hitsById)\n}\n","import isEqual from 'lodash/isEqual'\nimport {type ReactNode, useCallback, useEffect, useMemo, useReducer, useRef, useState} from 'react'\n\nimport {type CommandListHandle} from '../../../../../../components'\nimport {useSchema} from '../../../../../../hooks'\nimport {type SearchTerms} from '../../../../../../search'\nimport {useCurrentUser} from '../../../../../../store'\nimport {useSource} from '../../../../../source'\nimport {SEARCH_LIMIT} from '../../constants'\nimport {type RecentSearch} from '../../datastores/recentSearches'\nimport {createFieldDefinitionDictionary, createFieldDefinitions} from '../../definitions/fields'\nimport {createFilterDefinitionDictionary} from '../../definitions/filters'\nimport {createOperatorDefinitionDictionary} from '../../definitions/operators'\nimport {useSearch} from '../../hooks/useSearch'\nimport {type SearchOrdering} from '../../types'\nimport {validateFilter} from '../../utils/filterUtils'\nimport {hasSearchableTerms} from '../../utils/hasSearchableTerms'\nimport {isRecentSearchTerms} from '../../utils/isRecentSearchTerms'\nimport {initialSearchState, searchReducer} from './reducer'\nimport {SearchContext} from './SearchContext'\n\ninterface SearchProviderProps {\n  children?: ReactNode\n  fullscreen?: boolean\n}\n\n/**\n * @internal\n */\nexport function SearchProvider({children, fullscreen}: SearchProviderProps) {\n  const onCloseRef = useRef<(() => void) | null>(null)\n  const [searchCommandList, setSearchCommandList] = useState<CommandListHandle | null>(null)\n\n  const schema = useSchema()\n  const currentUser = useCurrentUser()\n  const {\n    search: {operators, filters},\n  } = useSource()\n\n  // Create field, filter and operator dictionaries\n  const {fieldDefinitions, filterDefinitions, operatorDefinitions} = useMemo(() => {\n    return {\n      fieldDefinitions: createFieldDefinitionDictionary(createFieldDefinitions(schema, filters)),\n      filterDefinitions: createFilterDefinitionDictionary(filters),\n      operatorDefinitions: createOperatorDefinitionDictionary(operators),\n    }\n  }, [filters, operators, schema])\n\n  const initialState = useMemo(\n    () =>\n      initialSearchState({\n        currentUser,\n        fullscreen,\n        definitions: {\n          fields: fieldDefinitions,\n          operators: operatorDefinitions,\n          filters: filterDefinitions,\n        },\n        pagination: {\n          cursor: null,\n          nextCursor: null,\n        },\n      }),\n    [currentUser, fieldDefinitions, filterDefinitions, fullscreen, operatorDefinitions],\n  )\n  const [state, dispatch] = useReducer(searchReducer, initialState)\n\n  const {documentTypesNarrowed, filters: currentFilters, ordering, cursor, result, terms} = state\n\n  const isMountedRef = useRef(false)\n  const previousOrderingRef = useRef<SearchOrdering>(initialState.ordering)\n  const previousCursorRef = useRef<string | null>(initialState.cursor)\n  const previousTermsRef = useRef<SearchTerms | RecentSearch>(initialState.terms)\n\n  const {handleSearch, searchState} = useSearch({\n    initialState: {...result, terms},\n    onComplete: (searchResult) => dispatch({...searchResult, type: 'SEARCH_REQUEST_COMPLETE'}),\n    onError: (error) => dispatch({error, type: 'SEARCH_REQUEST_ERROR'}),\n    onStart: () => dispatch({type: 'SEARCH_REQUEST_START'}),\n    schema,\n  })\n\n  const hasValidTerms = hasSearchableTerms({terms})\n\n  // Get a narrowed list of document types to search on based on any current active filters.\n  const documentTypes = documentTypesNarrowed.map((documentType) => schema.get(documentType)!)\n\n  // Get a list of 'complete' filters (filters that return valid values)\n  const completeFilters = currentFilters.filter((filter) =>\n    validateFilter({\n      fieldDefinitions,\n      filter,\n      filterDefinitions,\n      operatorDefinitions,\n    }),\n  )\n\n  const handleSetOnClose = useCallback((onClose: () => void) => {\n    onCloseRef.current = onClose\n  }, [])\n\n  /**\n   * Trigger search when any terms (query or selected types) OR current pageIndex has changed\n   *\n   * Note that we compare inbound terms with our last local snapshot, and not the value of\n   * `searchState` from `useSearch`, as that only contains a reference to the last fully _executed_ request.\n   * There are cases were we may not run searches when terms change (e.g. when search terms are empty / invalid).\n   */\n  useEffect(() => {\n    const orderingChanged = !isEqual(ordering, previousOrderingRef.current)\n    const cursorChanged = cursor !== previousCursorRef.current\n    const termsChanged = !isEqual(terms, previousTermsRef.current)\n\n    if (orderingChanged || cursorChanged || termsChanged) {\n      // Use a custom label if provided, otherwise return field and direction, e.g. `_updatedAt desc`\n      const sortLabel =\n        ordering?.customMeasurementLabel || `${ordering.sort.field} ${ordering.sort.direction}`\n\n      handleSearch({\n        options: {\n          // Comments prepended to each query for future measurement\n          comments: [\n            ...(isRecentSearchTerms(terms)\n              ? [`findability-recent-search:${terms.__recent.index}`]\n              : []),\n            `findability-selected-types:${terms.types.length}`,\n            `findability-sort:${sortLabel}`,\n            `findability-source: global`,\n            `findability-filter-count:${completeFilters.length}`,\n          ],\n          limit: SEARCH_LIMIT,\n          skipSortByScore: ordering.ignoreScore,\n          sort: [ordering.sort],\n          cursor: cursor || undefined,\n        },\n        terms: {\n          ...terms,\n          // Narrow document type search\n          ...(documentTypes ? {types: documentTypes} : {}),\n        },\n      })\n\n      // Update previousCursorRef snapshot only on a valid search request\n      previousCursorRef.current = cursor\n    }\n\n    // Update snapshots, even if no search request was executed\n    previousOrderingRef.current = ordering\n    previousTermsRef.current = terms\n  }, [\n    completeFilters.length,\n    currentFilters,\n    documentTypes,\n    handleSearch,\n    hasValidTerms,\n    ordering,\n    searchState.terms,\n    terms,\n    cursor,\n  ])\n\n  /**\n   * Reset search hits / state when (after initial amount):\n   * - we have no valid search terms and\n   * - we have existing hits\n   */\n  useEffect(() => {\n    if (!hasValidTerms && isMountedRef?.current && result.hits.length > 0) {\n      dispatch({type: 'SEARCH_CLEAR'})\n    }\n\n    isMountedRef.current = true\n  }, [dispatch, hasValidTerms, result.hits, terms.query, terms.types])\n\n  return (\n    <SearchContext.Provider\n      value={{\n        dispatch,\n        onClose: onCloseRef?.current,\n        searchCommandList,\n        setSearchCommandList,\n        setOnClose: handleSetOnClose,\n        state: {\n          ...state,\n          fullscreen,\n        },\n      }}\n    >\n      {children}\n    </SearchContext.Provider>\n  )\n}\n","import {SearchIcon} from '@sanity/icons'\nimport {type ForwardedRef, forwardRef} from 'react'\nimport {useTranslation} from 'react-i18next'\n\nimport {Button} from '../../../../../ui-components'\nimport {GLOBAL_SEARCH_KEY, GLOBAL_SEARCH_KEY_MODIFIER} from './constants'\n\ninterface SearchButtonProps {\n  onClick: () => void\n}\n\n/**\n * @internal\n */\nexport const SearchButton = forwardRef(function SearchButton(\n  {onClick}: SearchButtonProps,\n  ref: ForwardedRef<HTMLButtonElement>,\n) {\n  const {t} = useTranslation()\n\n  return (\n    <Button\n      aria-label={t('search.action-open-aria-label')}\n      data-testid=\"studio-search\"\n      icon={SearchIcon}\n      tooltipProps={{\n        content: t('search.button.tooltip'),\n        hotkeys: [GLOBAL_SEARCH_KEY_MODIFIER, GLOBAL_SEARCH_KEY.toUpperCase()],\n        portal: true,\n      }}\n      onClick={onClick}\n      mode=\"bleed\"\n      ref={ref}\n    />\n  )\n})\n","import {Box, Card, Portal} from '@sanity/ui'\nimport {useState} from 'react'\nimport FocusLock from 'react-focus-lock'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../../i18n'\nimport {supportsTouch} from '../../../../util'\nimport {useColorScheme} from '../../../colorScheme'\nimport {SearchWrapper} from './components/common/SearchWrapper'\nimport {Filters} from './components/filters/Filters'\nimport {RecentSearches} from './components/recentSearches/RecentSearches'\nimport {SearchHeader} from './components/SearchHeader'\nimport {SearchResults} from './components/searchResults/SearchResults'\nimport {useSearchState} from './contexts/search/useSearchState'\nimport {hasSearchableTerms} from './utils/hasSearchableTerms'\n\ninterface SearchDialogProps {\n  onClose: () => void\n  onOpen: () => void\n  open: boolean\n}\n\nconst InnerCard = styled(Card)`\n  flex-direction: column;\n  overflow: hidden;\n  overflow: clip;\n  pointer-events: all;\n  position: relative;\n`\n\nconst SearchDialogBox = styled(Box)`\n  height: 100%;\n  left: 0;\n  overflow: hidden;\n  overflow: clip;\n  pointer-events: none;\n  position: fixed;\n  top: 0;\n  width: 100%;\n  z-index: 1;\n`\n\n/**\n * @internal\n */\nexport function SearchDialog({onClose, onOpen, open}: SearchDialogProps) {\n  const [inputElement, setInputElement] = useState<HTMLInputElement | null>(null)\n  const {scheme} = useColorScheme()\n  const {t} = useTranslation()\n\n  const {\n    state: {filtersVisible, terms},\n  } = useSearchState()\n\n  const hasValidTerms = hasSearchableTerms({terms})\n\n  return (\n    <SearchWrapper hasValidTerms={hasValidTerms} onClose={onClose} onOpen={onOpen} open={open}>\n      {open && (\n        <Portal>\n          <FocusLock autoFocus={!supportsTouch} returnFocus>\n            <SearchDialogBox>\n              <InnerCard display=\"flex\" height=\"fill\" scheme={scheme} tone=\"default\">\n                <SearchHeader\n                  ariaInputLabel={\n                    hasValidTerms\n                      ? t('search.search-results-aria-label')\n                      : t('search.recent-searches-aria-label')\n                  }\n                  onClose={onClose}\n                  ref={setInputElement}\n                />\n                {filtersVisible && (\n                  <Card borderTop flex=\"none\">\n                    <Filters />\n                  </Card>\n                )}\n                {hasValidTerms ? (\n                  <SearchResults inputElement={inputElement} />\n                ) : (\n                  <RecentSearches inputElement={inputElement} />\n                )}\n              </InnerCard>\n            </SearchDialogBox>\n          </FocusLock>\n        </Portal>\n      )}\n    </SearchWrapper>\n  )\n}\n","import {createElement} from 'react'\n\nimport {type Tool} from '../../../config'\n\ninterface StudioActiveToolLayoutProps {\n  activeTool: Tool\n}\n\nexport function StudioActiveToolLayout(props: StudioActiveToolLayoutProps) {\n  const {activeTool} = props\n  return createElement(activeTool.component, {tool: activeTool})\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Card, Container, Flex, Stack, Text} from '@sanity/ui'\n\nexport function NoToolsScreen() {\n  return (\n    <Card height=\"fill\">\n      <Flex align=\"center\" height=\"fill\" justify=\"center\" padding={4} sizing=\"border\">\n        <Container width={0}>\n          <Card padding={4} radius={2} shadow={1} tone=\"caution\">\n            <Flex>\n              <Box>\n                <Text size={1}>\n                  <WarningOutlineIcon />\n                </Text>\n              </Box>\n              <Stack flex={1} marginLeft={3} space={3}>\n                <Text as=\"h1\" size={1} weight=\"medium\">\n                  No configured tools\n                </Text>\n                <Text as=\"p\" muted size={1}>\n                  Please configure a tool in your Studio configuration.\n                </Text>\n                <Text as=\"p\" muted size={1}>\n                  <a\n                    href=\"https://www.sanity.io/docs/studio-tools\"\n                    rel=\"noreferrer\"\n                    target=\"_blank\"\n                  >\n                    Learn how to add a tool &rarr;\n                  </a>\n                </Text>\n              </Stack>\n            </Flex>\n          </Card>\n        </Container>\n      </Flex>\n    </Card>\n  )\n}\n","import {DoubleChevronRightIcon} from '@sanity/icons'\nimport {Box, Card, Container, Flex, Stack, Text} from '@sanity/ui'\n\nexport function RedirectingScreen(props: {reason?: string}) {\n  const {reason = 'Redirecting'} = props\n\n  return (\n    <Card height=\"fill\">\n      <Flex align=\"center\" height=\"fill\" justify=\"center\" padding={4} sizing=\"border\">\n        <Container width={0}>\n          <Card padding={4} radius={2} shadow={1} tone=\"primary\">\n            <Flex>\n              <Box>\n                <Text size={1}>\n                  <DoubleChevronRightIcon />\n                </Text>\n              </Box>\n              <Stack flex={1} marginLeft={3} space={3}>\n                <Text as=\"h1\" size={1} weight=\"bold\">\n                  {reason}\n                </Text>\n              </Stack>\n            </Flex>\n          </Card>\n        </Container>\n      </Flex>\n    </Card>\n  )\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {WarningOutlineIcon} from '@sanity/icons'\nimport {Box, Card, Container, Flex, Stack, Text} from '@sanity/ui'\n\nexport function ToolNotFoundScreen(props: {toolName: string}) {\n  const {toolName} = props\n\n  return (\n    <Card height=\"fill\">\n      <Flex align=\"center\" height=\"fill\" justify=\"center\" padding={4} sizing=\"border\">\n        <Container width={0}>\n          <Card padding={4} radius={2} shadow={1} tone=\"caution\">\n            <Flex>\n              <Box>\n                <Text size={1}>\n                  <WarningOutlineIcon />\n                </Text>\n              </Box>\n              <Stack flex={1} marginLeft={3} space={3}>\n                <Text as=\"h1\" size={1} weight=\"medium\">\n                  Tool not found: <code>{toolName}</code>\n                </Text>\n              </Stack>\n            </Flex>\n          </Card>\n        </Container>\n      </Flex>\n    </Card>\n  )\n}\n","export const WORKSPACES_DOCS_URL = 'https://www.sanity.io/docs/workspaces'\n","import {combineLatest} from 'rxjs'\nimport {map} from 'rxjs/operators'\n\nimport {type WorkspaceSummary} from '../../../../../config'\nimport {createHookFromObservableFactory} from '../../../../../util'\n\nexport const useWorkspaceAuthStates = createHookFromObservableFactory(\n  (workspaces: WorkspaceSummary[]) =>\n    combineLatest(\n      workspaces.map((workspace) =>\n        // eslint-disable-next-line max-nested-callbacks\n        workspace.auth.state.pipe(map((state) => [workspace.name, state] as const)),\n      ),\n    ).pipe(map((entries) => Object.fromEntries(entries))),\n)\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {Box, Flex, Stack, Text} from '@sanity/ui'\nimport {type ComponentType, createElement, isValidElement, type ReactNode, useMemo} from 'react'\nimport {isValidElementType} from 'react-is'\nimport styled from 'styled-components'\n\nexport const STATE_TITLES = {\n  'logged-in': '',\n  'logged-out': 'Signed out',\n  'no-access': '',\n}\n\ntype PreviewIconSize = 'small' | 'large'\ninterface MediaProps {\n  $size: PreviewIconSize\n}\n\nexport const Media = styled.div<MediaProps>`\n  width: ${(props) => (props.$size === 'small' ? '25px' : '41px')};\n  height: ${(props) => (props.$size === 'small' ? '25px' : '41px')};\n\n  svg {\n    width: 100%;\n    height: 100%;\n  }\n`\n\nexport const WorkspacePreviewIcon = ({\n  icon,\n  size = 'small',\n}: {\n  icon: ComponentType | ReactNode\n  size: PreviewIconSize\n}) => {\n  const iconComponent = useMemo(() => createIcon(icon), [icon])\n\n  return <Media $size={size}>{iconComponent}</Media>\n}\n\nconst createIcon = (icon: ComponentType | ReactNode) => {\n  if (isValidElementType(icon)) return createElement(icon)\n  if (isValidElement(icon)) return icon\n  return undefined\n}\n\nexport interface WorkspacePreviewProps {\n  icon?: ComponentType | ReactNode\n  iconRight?: ComponentType | ReactNode\n  selected?: boolean\n  state?: 'logged-in' | 'logged-out' | 'no-access'\n  subtitle?: string\n  title: string\n}\n\nexport function WorkspacePreview(props: WorkspacePreviewProps) {\n  const {state, subtitle, selected, title, icon, iconRight} = props\n\n  const iconRightComponent = useMemo(() => createIcon(iconRight), [iconRight])\n\n  return (\n    <Flex align=\"center\" flex=\"none\" gap={3}>\n      <WorkspacePreviewIcon icon={icon} size=\"small\" />\n\n      <Stack flex={1} space={2}>\n        <Text size={1} textOverflow=\"ellipsis\" weight=\"medium\">\n          {title}\n        </Text>\n\n        {subtitle && (\n          <Text muted size={1} textOverflow=\"ellipsis\">\n            {subtitle}\n          </Text>\n        )}\n      </Stack>\n\n      {state && STATE_TITLES[state] && (\n        <Box paddingLeft={1}>\n          <Text size={1} muted textOverflow=\"ellipsis\">\n            {STATE_TITLES[state]}\n          </Text>\n        </Box>\n      )}\n\n      {(selected || iconRightComponent) && (\n        <Flex align=\"center\" gap={4} paddingLeft={3} paddingRight={2}>\n          {selected && (\n            <Text>\n              <CheckmarkIcon />\n            </Text>\n          )}\n\n          {iconRightComponent && <Text muted>{iconRightComponent}</Text>}\n        </Flex>\n      )}\n    </Flex>\n  )\n}\n","import {SanityLogo} from '@sanity/logos'\nimport {Box, Card, Flex, Heading, Stack, Text} from '@sanity/ui'\nimport {Fragment, type ReactNode} from 'react'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../../../i18n'\n\nconst LINKS = [\n  {\n    url: 'https://slack.sanity.io/',\n    i18nKey: 'workspaces.community-title',\n    title: 'Community',\n  },\n  {\n    url: 'https://www.sanity.io/docs',\n    i18nKey: 'workspaces.docs-title',\n    title: 'Docs',\n  },\n  {\n    url: 'https://www.sanity.io/legal/privacy',\n    i18nKey: 'workspaces.privacy-title',\n    title: 'Privacy',\n  },\n  {\n    url: 'https://www.sanity.io',\n    i18nKey: 'workspaces.sanity-io-title',\n    title: 'sanity.io',\n  },\n]\n\nconst StyledText = styled(Text)`\n  a {\n    color: inherit;\n  }\n`\n\ninterface LayoutProps {\n  header?: ReactNode\n  children: ReactNode\n  footer?: ReactNode\n}\n\nexport function Layout(props: LayoutProps) {\n  const {children, footer, header} = props\n  const {t} = useTranslation()\n\n  return (\n    <Stack space={6}>\n      <Card border radius={3} overflow=\"auto\">\n        <Stack>\n          {typeof header === 'object' && <Box>{header}</Box>}\n          {typeof header === 'string' && (\n            <Box paddingY={4}>\n              <Heading align=\"center\" size={1}>\n                {header}\n              </Heading>\n            </Box>\n          )}\n\n          <Box paddingX={1}>\n            <Card borderTop={Boolean(header)} borderBottom={Boolean(footer)}>\n              {children}\n            </Card>\n          </Box>\n\n          {footer && <Box>{footer}</Box>}\n        </Stack>\n      </Card>\n\n      <Flex direction=\"column\" gap={4} justify=\"center\" align=\"center\" paddingBottom={4}>\n        <Text size={3}>\n          <SanityLogo />\n        </Text>\n\n        <Flex align=\"center\" gap={2}>\n          {LINKS.map((link, index) => (\n            <Fragment key={link.title}>\n              <StyledText muted size={1}>\n                <a href={link.url} target=\"_blank\" rel=\"noopener noreferrer\">\n                  {link.title}\n                </a>\n              </StyledText>\n\n              {index < LINKS.length - 1 && (\n                <Text size={1} muted>\n                  \n                </Text>\n              )}\n            </Fragment>\n          ))}\n        </Flex>\n      </Flex>\n    </Stack>\n  )\n}\n","import {AddIcon, ArrowLeftIcon, ChevronRightIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Stack} from '@sanity/ui'\nimport {useCallback, useState} from 'react'\n\nimport {Button} from '../../../../../../ui-components'\nimport {LoadingBlock} from '../../../../../components/loadingBlock'\nimport {useTranslation} from '../../../../../i18n'\nimport {useActiveWorkspace} from '../../../../activeWorkspaceMatcher'\nimport {useWorkspaces} from '../../../../workspaces'\nimport {WORKSPACES_DOCS_URL} from '../constants'\nimport {useWorkspaceAuthStates} from '../hooks'\nimport {WorkspacePreview} from '../WorkspacePreview'\nimport {Layout} from './Layout'\n\nexport function WorkspaceAuth() {\n  const workspaces = useWorkspaces()\n  const {activeWorkspace, setActiveWorkspace} = useActiveWorkspace()\n  const [authStates] = useWorkspaceAuthStates(workspaces)\n  const [selectedWorkspaceName, setSelectedWorkspaceName] = useState<string | null>(\n    activeWorkspace?.name || null,\n  )\n  const selectedWorkspace =\n    workspaces.length === 1\n      ? workspaces[0]\n      : workspaces.find((workspace) => workspace.name === selectedWorkspaceName)\n  const LoginComponent = selectedWorkspace?.auth?.LoginComponent\n\n  const handleBack = useCallback(() => setSelectedWorkspaceName(null), [])\n  const {t} = useTranslation()\n\n  if (!authStates) return <LoadingBlock showText />\n\n  if (LoginComponent && selectedWorkspace) {\n    return (\n      <Stack space={2}>\n        {workspaces.length > 1 && (\n          <Flex>\n            <Button\n              icon={ArrowLeftIcon}\n              mode=\"bleed\"\n              onClick={handleBack}\n              text={t('workspaces.action.choose-another-workspace')}\n            />\n          </Flex>\n        )}\n\n        <Layout\n          header={\n            <Box padding={3}>\n              <WorkspacePreview\n                icon={selectedWorkspace.icon}\n                title={selectedWorkspace.title}\n                subtitle={selectedWorkspace?.subtitle}\n              />\n            </Box>\n          }\n        >\n          <Stack padding={2} paddingBottom={3} paddingTop={4}>\n            <LoginComponent\n              projectId={selectedWorkspace.projectId}\n              redirectPath={\n                window.location.pathname.startsWith(selectedWorkspace.basePath)\n                  ? // NOTE: the fragment cannot be preserved because it's used\n                    // to transfer an sid to a token\n                    `${window.location.pathname}${window.location.search}`\n                  : selectedWorkspace.basePath\n              }\n              key={selectedWorkspaceName}\n            />\n          </Stack>\n        </Layout>\n      </Stack>\n    )\n  }\n\n  return (\n    <Layout\n      header={t('workspaces.choose-your-workspace-label')}\n      footer={\n        <Stack padding={1}>\n          <Button\n            as=\"a\"\n            href={WORKSPACES_DOCS_URL}\n            icon={AddIcon}\n            mode=\"bleed\"\n            rel=\"noopener noreferrer\"\n            size=\"large\"\n            target=\"__blank\"\n            text={t('workspaces.action.add-workspace')}\n          />\n        </Stack>\n      }\n    >\n      <Stack space={1} paddingX={1} paddingY={2}>\n        {workspaces.map((workspace) => {\n          const authState = authStates[workspace.name]\n          // eslint-disable-next-line no-nested-ternary\n          const state = authState.authenticated\n            ? 'logged-in'\n            : workspace.auth.LoginComponent\n              ? 'logged-out'\n              : 'no-access'\n\n          const handleSelectWorkspace = () => {\n            if (state === 'logged-in' && workspace.name !== activeWorkspace.name) {\n              setActiveWorkspace(workspace.name)\n            }\n\n            if (state === 'logged-out') {\n              setSelectedWorkspaceName(workspace.name)\n            }\n          }\n\n          return (\n            <Card\n              as=\"button\"\n              radius={2}\n              key={workspace.name}\n              padding={2}\n              // eslint-disable-next-line react/jsx-no-bind\n              onClick={handleSelectWorkspace}\n            >\n              <WorkspacePreview\n                icon={workspace?.icon}\n                iconRight={ChevronRightIcon}\n                state={state}\n                subtitle={workspace?.subtitle}\n                title={workspace?.title || workspace.name}\n              />\n            </Card>\n          )\n        })}\n      </Stack>\n    </Layout>\n  )\n}\n","import {CheckmarkIcon, ChevronDownIcon} from '@sanity/icons'\nimport {\n  Box,\n  // eslint-disable-next-line no-restricted-imports\n  Button as UIButton,\n  Flex,\n  Menu,\n  Text,\n} from '@sanity/ui'\nimport {useRouter} from 'sanity/router'\nimport styled from 'styled-components'\n\nimport {MenuButton, type MenuButtonProps, MenuItem, Tooltip} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {useActiveWorkspace} from '../../../activeWorkspaceMatcher'\nimport {useWorkspaces} from '../../../workspaces'\nimport {useWorkspaceAuthStates} from './hooks'\nimport {STATE_TITLES, WorkspacePreviewIcon} from './WorkspacePreview'\n\nconst StyledMenu = styled(Menu)`\n  max-width: 350px;\n  min-width: 250px;\n`\n\nconst POPOVER_PROPS: MenuButtonProps['popover'] = {\n  constrainSize: true,\n  fallbackPlacements: ['bottom-end', 'bottom'],\n  placement: 'bottom-end',\n}\n\nexport function WorkspaceMenuButton() {\n  const workspaces = useWorkspaces()\n  const {activeWorkspace, setActiveWorkspace} = useActiveWorkspace()\n  const [authStates] = useWorkspaceAuthStates(workspaces)\n  const {navigateUrl} = useRouter()\n  const {t} = useTranslation()\n\n  const multipleWorkspaces = workspaces.length > 1\n\n  if (!multipleWorkspaces) {\n    return null\n  }\n\n  const disabled = !authStates\n\n  return (\n    <MenuButton\n      button={\n        <Flex>\n          <Tooltip content={t('workspaces.select-workspace-tooltip')} disabled={disabled} portal>\n            <UIButton disabled={disabled} mode=\"bleed\" padding={2} width=\"fill\">\n              <Flex align=\"center\" gap={2}>\n                <Box>\n                  <Text size={1} textOverflow=\"ellipsis\" weight=\"medium\">\n                    {activeWorkspace.title}\n                  </Text>\n                </Box>\n                <Text size={1}>\n                  <ChevronDownIcon />\n                </Text>\n              </Flex>\n            </UIButton>\n          </Tooltip>\n        </Flex>\n      }\n      id=\"workspace-menu\"\n      menu={\n        !disabled && authStates ? (\n          <StyledMenu>\n            {workspaces.map((workspace) => {\n              const authState = authStates[workspace.name]\n\n              // eslint-disable-next-line no-nested-ternary\n              const state = authState.authenticated\n                ? 'logged-in'\n                : workspace.auth.LoginComponent\n                  ? 'logged-out'\n                  : 'no-access'\n\n              const handleSelectWorkspace = () => {\n                if (state === 'logged-in' && workspace.name !== activeWorkspace.name) {\n                  setActiveWorkspace(workspace.name)\n                }\n\n                // Navigate to the base path of the workspace to authenticate\n                if (state === 'logged-out') {\n                  navigateUrl({path: workspace.basePath})\n                }\n              }\n              const isSelected = workspace.name === activeWorkspace.name\n              return (\n                <MenuItem\n                  badgeText={STATE_TITLES[state]}\n                  iconRight={isSelected ? CheckmarkIcon : undefined}\n                  key={workspace.name}\n                  // eslint-disable-next-line react/jsx-no-bind\n                  onClick={handleSelectWorkspace}\n                  pressed={isSelected}\n                  preview={<WorkspacePreviewIcon icon={workspace.icon} size=\"small\" />}\n                  selected={isSelected}\n                  __unstable_subtitle={workspace.subtitle}\n                  __unstable_space={1}\n                  text={workspace?.title || workspace.name}\n                />\n              )\n            })}\n          </StyledMenu>\n        ) : undefined\n      }\n      popover={POPOVER_PROPS}\n    />\n  )\n}\n","import {Card, Container, Flex} from '@sanity/ui'\n\nimport {WorkspaceAuth} from '../components/navbar/workspace'\n\nexport function AuthenticateScreen() {\n  return (\n    <Card height=\"fill\" overflow=\"auto\" paddingX={4}>\n      <Flex height=\"fill\" direction=\"column\" align=\"center\" justify=\"center\" paddingTop={4}>\n        <Container width={0}>\n          <WorkspaceAuth />\n        </Container>\n      </Flex>\n    </Card>\n  )\n}\n","export function ConfigErrorsScreen() {\n  /* This screen is not currently being used anywhere. We're keeping it as a basis for future work */\n  /* eslint-disable-next-line i18next/no-literal-string */\n  return <>TODO: implement config errors screen</>\n  // return (\n  //   <Root forwardedAs={Flex}>\n  //     <Content forwardedAs={Flex} direction=\"column\" gap={4}>\n  //       <Flex direction=\"column\" gap={2}>\n  //         <Box>\n  //           <Heading as=\"h1\">Configuration Error</Heading>\n  //         </Box>\n  //         <Box muted>\n  //           <Text>An error occurred while trying to resolve your Studio's configuration.</Text>\n  //         </Box>\n  //         <Box>\n  //           <Text size={1} muted>\n  //             Note: the design of this page may change.\n  //           </Text>\n  //         </Box>\n  //       </Flex>\n  //       <Card shadow={1}>\n  //         {errors.map((errorInfo, index) => (\n  //           // eslint-disable-next-line react/no-array-index-key\n  //           <ErrorMessage key={index} {...errorInfo} />\n  //         ))}\n  //       </Card>\n  //       <Button\n  //         tone=\"primary\"\n  //         // eslint-disable-next-line react/jsx-no-bind\n  //         onClick={() => window.location.reload()}\n  //         type=\"button\"\n  //         text=\"Retry\"\n  //       />\n  //     </Content>\n  //   </Root>\n  // )\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {LaunchIcon} from '@sanity/icons'\nimport {Card, Stack, Text, TextInput} from '@sanity/ui'\nimport {useEffect, useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {Dialog} from '../../../ui-components'\n\ninterface CorsOriginErrorScreenProps {\n  projectId?: string\n}\n\nexport const ScreenReaderLabel = styled.label`\n  clip: rect(0 0 0 0);\n  clip-path: inset(50%);\n  height: 1px;\n  overflow: hidden;\n  overflow: clip;\n  position: absolute;\n  white-space: nowrap;\n  width: 1px;\n`\n\nexport function CorsOriginErrorScreen(props: CorsOriginErrorScreenProps) {\n  const {projectId} = props\n\n  const origin = window.location.origin\n  const corsUrl = useMemo(() => {\n    const url = new URL(`https://sanity.io/manage/project/${projectId}/api`)\n    url.searchParams.set('cors', 'add')\n    url.searchParams.set('origin', origin)\n    url.searchParams.set('credentials', '')\n\n    return url.toString()\n  }, [origin, projectId])\n\n  useEffect(() => {\n    const handleFocus = () => {\n      window.location.reload()\n    }\n    window.addEventListener('focus', handleFocus)\n    return () => {\n      window.removeEventListener('focus', handleFocus)\n    }\n  }, [])\n\n  return (\n    <Card height=\"fill\">\n      <Dialog\n        id=\"cors-error-dialog\"\n        header=\"Before you continue...\"\n        width={1}\n        footer={{\n          confirmButton: {\n            text: 'Continue',\n            iconRight: LaunchIcon,\n            as: 'a',\n            href: corsUrl,\n            target: '_blank',\n            rel: 'noopener noreferrer',\n            tone: 'primary',\n          },\n        }}\n      >\n        <Stack space={4}>\n          <Text>\n            To access your content, you need to <b>add the following URL as a CORS origin</b> to\n            your Sanity project.\n          </Text>\n\n          {/* added for accessibility */}\n          <ScreenReaderLabel aria-hidden=\"true\">CORS URL to be added</ScreenReaderLabel>\n          <TextInput value={origin} readOnly />\n        </Stack>\n      </Dialog>\n    </Card>\n  )\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {type CurrentUser} from '@sanity/types'\nimport {Card, Stack, Text} from '@sanity/ui'\nimport {useCallback, useEffect, useState} from 'react'\n\nimport {Dialog} from '../../../ui-components'\nimport {getProviderTitle} from '../../store'\nimport {useActiveWorkspace} from '../activeWorkspaceMatcher'\n\nexport function NotAuthenticatedScreen() {\n  const [currentUser, setCurrentUser] = useState<CurrentUser | null>(null)\n  const [error, handleError] = useState<unknown>(null)\n\n  if (error) throw error\n\n  const {activeWorkspace} = useActiveWorkspace()\n\n  const handleLogout = useCallback(() => {\n    activeWorkspace.auth.logout?.()\n  }, [activeWorkspace])\n\n  useEffect(() => {\n    const subscription = activeWorkspace.auth.state.subscribe({\n      next: ({currentUser: user}) => {\n        setCurrentUser(user)\n      },\n      error: handleError,\n    })\n\n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [activeWorkspace])\n\n  const providerTitle = getProviderTitle(currentUser?.provider)\n  const providerHelp = providerTitle ? ` through ${providerTitle}` : ''\n\n  return (\n    <Card height=\"fill\">\n      <Dialog\n        id=\"not-authorized-dialog\"\n        header=\"Not authorized\"\n        width={1}\n        footer={{\n          confirmButton: {\n            text: 'Sign out',\n            onClick: handleLogout,\n            tone: 'default',\n          },\n        }}\n      >\n        <Stack space={4}>\n          <Text>\n            You are not authorized to access this studio. Maybe you could ask someone to invite you\n            to collaborate on this project?\n          </Text>\n\n          <Text>\n            If you think this is an error, verify that you are signed in with the correct account.\n            You are currently signed in as{' '}\n            <strong>\n              {currentUser?.name} ({currentUser?.email})\n            </strong>\n            {providerHelp}.\n          </Text>\n        </Stack>\n      </Dialog>\n    </Card>\n  )\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {Card, Flex, Heading, Inline, Stack} from '@sanity/ui'\n\nimport {Button} from '../../../ui-components'\n\nexport function NotFoundScreen(props: {onNavigateToDefaultWorkspace: () => void}) {\n  return (\n    <Card height=\"fill\" sizing=\"border\" tone=\"caution\" display=\"flex\">\n      <Flex direction=\"row\" justify=\"center\" flex={1} align=\"center\">\n        <Stack space={4}>\n          <Heading as=\"h1\">Workspace not found</Heading>\n          <Inline>\n            <Button\n              text=\"Go to default workspace\"\n              onClick={props.onNavigateToDefaultWorkspace}\n              mode=\"ghost\"\n            />\n          </Inline>\n        </Stack>\n      </Flex>\n    </Card>\n  )\n}\n","import {type SchemaValidationProblemPath} from '@sanity/types'\n\nexport function renderPath(path: SchemaValidationProblemPath) {\n  return path\n    .map((segment) => {\n      if (segment.kind === 'type') {\n        return `${segment.name || '<unnamed>'}(${segment.type})`\n      }\n\n      if (segment.kind === 'property') {\n        return segment.name\n      }\n\n      return null\n    })\n    .filter(Boolean)\n    .join(' > ')\n}\n","import {type Schema} from '@sanity/types'\n\nimport {renderPath} from './utils'\n\nexport function reportWarnings(schema: Schema) {\n  /* eslint-disable no-console */\n  const problemGroups = schema._validation\n\n  const groupsWithWarnings = problemGroups?.filter((group) =>\n    group.problems.some((problem) => problem.severity === 'warning'),\n  )\n  if (groupsWithWarnings?.length === 0) {\n    return\n  }\n  console.groupCollapsed(` Schema has ${groupsWithWarnings?.length} warnings`)\n  groupsWithWarnings?.forEach((group) => {\n    const path = renderPath(group.path)\n\n    console.group(`%cAt ${path}`, 'color: #FF7636')\n\n    group.problems.forEach((problem) => {\n      console.log(problem.message)\n    })\n\n    console.groupEnd()\n  })\n  console.groupEnd()\n  /* eslint-enable no-console */\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {generateHelpUrl} from '@sanity/generate-help-url'\nimport {ErrorOutlineIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {type SchemaValidationProblemGroup} from '@sanity/types'\nimport {Box, Breadcrumbs, Card, Flex, Stack, Text, type ThemeColorToneKey} from '@sanity/ui'\nimport {capitalize} from 'lodash'\nimport {useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {useTranslation} from '../../../i18n'\n\nconst TONES: Record<'error' | 'warning', ThemeColorToneKey> = {\n  error: 'critical',\n  warning: 'caution',\n}\n\nconst SegmentSpan = styled.code`\n  && {\n    background: none;\n    color: inherit;\n  }\n`\n\nconst ErrorMessageText = styled(Text)`\n  white-space: pre-line;\n`\n\nexport function SchemaProblemGroups(props: {problemGroups: SchemaValidationProblemGroup[]}) {\n  const {problemGroups} = props\n  const {t} = useTranslation()\n\n  const items = useMemo(() => {\n    const ret = []\n\n    for (const problemGroup of problemGroups) {\n      for (const problem of problemGroup.problems) {\n        ret.push({group: problemGroup, problem})\n      }\n    }\n\n    return ret\n  }, [problemGroups])\n\n  return (\n    <Stack as=\"ul\" space={4}>\n      {items.map(({group, problem}, i) => {\n        const isError = problem.severity === 'error'\n        const isWarning = problem.severity === 'warning'\n        const schemaType = getTypeInfo(group)\n        return (\n          <Card border key={i} padding={4} radius={2} tone={TONES[problem.severity]}>\n            <Flex>\n              <Box marginRight={3}>\n                <Text muted size={1}>\n                  {isError && <ErrorOutlineIcon />}\n                  {isWarning && <WarningOutlineIcon />}\n                </Text>\n              </Box>\n\n              <Box flex={1}>\n                <Text size={1} weight=\"medium\">\n                  {schemaType ? (\n                    <>\n                      {capitalize(schemaType.type)} type \"{schemaType.name}\"\n                    </>\n                  ) : null}\n                </Text>\n              </Box>\n            </Flex>\n            <Box marginTop={4}>\n              <Card border overflow=\"auto\" padding={2} tone=\"inherit\">\n                <Breadcrumbs\n                  separator={\n                    <Text muted size={1}>\n                      &rarr;\n                    </Text>\n                  }\n                >\n                  {group.path.map((segment, j) => {\n                    if (segment.kind === 'type') {\n                      const text = `${_renderSegmentName(\n                        segment.name || `<anonymous ${segment.type}>`,\n                      )}:${segment.type}`\n                      return (\n                        <Text title={text} key={j} size={1} textOverflow=\"ellipsis\">\n                          <SegmentSpan>{text}</SegmentSpan>\n                        </Text>\n                      )\n                    }\n\n                    if (segment.kind === 'property') {\n                      return (\n                        <Text title={segment.name} key={j} size={1} textOverflow=\"ellipsis\">\n                          <SegmentSpan>{segment.name}</SegmentSpan>\n                        </Text>\n                      )\n                    }\n\n                    return null\n                  })}\n                </Breadcrumbs>\n              </Card>\n            </Box>\n\n            <Box as=\"ul\" marginTop={4}>\n              <Box as=\"li\">\n                <Stack space={3}>\n                  <ErrorMessageText muted size={1}>\n                    {problem.message}\n                  </ErrorMessageText>\n\n                  {problem.helpId && (\n                    <Text muted size={1}>\n                      <a\n                        href={generateHelpUrl(problem.helpId)}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        View documentation &rarr;\n                      </a>\n                    </Text>\n                  )}\n                </Stack>\n              </Box>\n            </Box>\n          </Card>\n        )\n      })}\n    </Stack>\n  )\n}\n\nfunction getTypeInfo(problem: SchemaValidationProblemGroup): {name: string; type: string} | null {\n  // note: unsure if the first segment here can ever be anything else than a type\n  // a possible API improvement is to add schemaType info to the problem group interface itself\n  const first = problem.path[0]\n  if (first.kind === 'type') {\n    return {name: first.name || `<anonymous ${first.type}>`, type: first.type}\n  }\n  return null\n}\n\nfunction _renderSegmentName(str: string) {\n  if (str?.startsWith('<unnamed_type_@_index')) {\n    const parts = str.slice(1, -1).split('_')\n\n    return `[${parts[4]}]`\n  }\n\n  return str\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {type Schema} from '@sanity/types'\nimport {Card, Container, Heading, Stack} from '@sanity/ui'\nimport {useEffect} from 'react'\n\nimport {reportWarnings} from './reportWarnings'\nimport {SchemaProblemGroups} from './SchemaProblemGroups'\n\ninterface SchemaErrorsScreenProps {\n  schema: Schema\n}\n\nexport function SchemaErrorsScreen({schema}: SchemaErrorsScreenProps) {\n  const groupsWithErrors =\n    schema._validation?.filter((group) =>\n      group.problems.some((problem) => problem.severity === 'error'),\n    ) || []\n\n  useEffect(() => reportWarnings(schema), [schema])\n\n  return (\n    <Card height=\"fill\" overflow=\"auto\" paddingY={[4, 5, 6, 7]} paddingX={4} sizing=\"border\">\n      <Container width={1}>\n        <Stack space={5}>\n          <Heading as=\"h1\">Schema errors</Heading>\n          <SchemaProblemGroups problemGroups={groupsWithErrors} />\n        </Stack>\n      </Container>\n    </Card>\n  )\n}\n","/* eslint-disable i18next/no-literal-string */\n/* eslint-disable @sanity/i18n/no-attribute-string-literals */\nimport {Card, Code, Container, ErrorBoundary, Heading, Stack} from '@sanity/ui'\nimport {type ReactNode, useCallback, useState} from 'react'\nimport {useHotModuleReload} from 'use-hot-module-reload'\n\nimport {Button} from '../../ui-components'\nimport {SchemaError} from '../config'\nimport {CorsOriginError} from '../store'\nimport {isRecord} from '../util'\nimport {CorsOriginErrorScreen, SchemaErrorsScreen} from './screens'\n\ninterface StudioErrorBoundaryProps {\n  children: ReactNode\n  heading?: string\n}\n\nexport function StudioErrorBoundary({\n  children,\n  heading = 'An error occured',\n}: StudioErrorBoundaryProps) {\n  const [{error}, setError] = useState<{error: unknown}>({error: null})\n\n  const message = isRecord(error) && typeof error.message === 'string' && error.message\n  const stack = isRecord(error) && typeof error.stack === 'string' && error.stack\n\n  const handleResetError = useCallback(() => setError({error: null}), [setError])\n\n  useHotModuleReload(handleResetError)\n\n  if (error instanceof CorsOriginError) {\n    return <CorsOriginErrorScreen projectId={error?.projectId} />\n  }\n\n  if (error instanceof SchemaError) {\n    return <SchemaErrorsScreen schema={error.schema} />\n  }\n\n  if (!error) {\n    return <ErrorBoundary onCatch={setError}>{children}</ErrorBoundary>\n  }\n\n  return (\n    <Card\n      height=\"fill\"\n      overflow=\"auto\"\n      paddingY={[4, 5, 6, 7]}\n      paddingX={4}\n      sizing=\"border\"\n      tone=\"critical\"\n    >\n      <Container width={3}>\n        <Stack space={4}>\n          {/* TODO: better error boundary */}\n\n          <Heading>{heading}</Heading>\n\n          <div>\n            <Button onClick={handleResetError} text=\"Retry\" tone=\"default\" />\n          </div>\n\n          <Card border radius={2} overflow=\"auto\" padding={4} tone=\"inherit\">\n            <Stack space={4}>\n              {message && (\n                <Code size={1}>\n                  <strong>Error: {message}</strong>\n                </Code>\n              )}\n              {stack && <Code size={1}>{stack}</Code>}\n            </Stack>\n          </Card>\n        </Stack>\n      </Container>\n    </Card>\n  )\n}\n","/* eslint-disable i18next/no-literal-string, @sanity/i18n/no-attribute-template-literals */\nimport {Card, Flex} from '@sanity/ui'\nimport {startCase} from 'lodash'\nimport {createContext, Suspense, useCallback, useEffect, useMemo, useState} from 'react'\nimport {RouteScope, useRouter, useRouterState} from 'sanity/router'\nimport styled from 'styled-components'\n\nimport {LoadingBlock} from '../components/loadingBlock'\nimport {NoToolsScreen} from './screens/NoToolsScreen'\nimport {RedirectingScreen} from './screens/RedirectingScreen'\nimport {ToolNotFoundScreen} from './screens/ToolNotFoundScreen'\nimport {\n  useActiveToolLayoutComponent,\n  useLayoutComponent,\n  useNavbarComponent,\n} from './studio-components-hooks'\nimport {StudioErrorBoundary} from './StudioErrorBoundary'\nimport {useWorkspace} from './workspace'\n\nconst SearchFullscreenPortalCard = styled(Card)`\n  height: 100%;\n  left: 0;\n  overflow: hidden;\n  overflow: clip;\n  position: fixed;\n  top: 0;\n  width: 100%;\n  z-index: 200;\n`\n\n/** @internal */\nexport interface NavbarContextValue {\n  onSearchFullscreenOpenChange: (open: boolean) => void\n  onSearchOpenChange: (open: boolean) => void\n  searchFullscreenOpen: boolean\n  searchFullscreenPortalEl: HTMLElement | null\n  searchOpen: boolean\n}\n\n/** @internal */\nexport const NavbarContext = createContext<NavbarContextValue>({\n  onSearchFullscreenOpenChange: () => '',\n  onSearchOpenChange: () => '',\n  searchFullscreenOpen: false,\n  searchFullscreenPortalEl: null,\n  searchOpen: false,\n})\n\n/**\n * The Studio Layout component is the root component of the Sanity Studio UI.\n * It renders the navbar, the active tool, and the search modal as well as the error boundary.\n *\n * @public\n * @returns A Studio Layout element that renders the navbar, the active tool, and the search modal as well as the error boundary\n * @remarks This component should be used as a child component to the StudioProvider\n * @example Rendering a Studio Layout\n * ```ts\n * <StudioProvider\n *  basePath={basePath}\n *  config={config}\n *  onSchemeChange={onSchemeChange}\n *  scheme={scheme}\n *  unstable_history={unstable_history}\n *  unstable_noAuthBoundary={unstable_noAuthBoundary}\n * >\n *   <StudioLayout />\n *</StudioProvider>\n * ```\n */\nexport function StudioLayout() {\n  // Use the layout component that is resolved by the Components API (`studio.components.layout`).\n  // The default component is the `StudioLayoutComponent` defined below.\n  const Layout = useLayoutComponent()\n\n  return <Layout />\n}\n\n/**\n * @internal\n * The default Studio Layout component\n * */\nexport function StudioLayoutComponent() {\n  const {name, title, tools} = useWorkspace()\n  const router = useRouter()\n  const activeToolName = useRouterState(\n    useCallback(\n      (routerState) => (typeof routerState.tool === 'string' ? routerState.tool : undefined),\n      [],\n    ),\n  )\n  const activeTool = useMemo(\n    () => tools.find((tool) => tool.name === activeToolName),\n    [activeToolName, tools],\n  )\n  const [searchFullscreenOpen, setSearchFullscreenOpen] = useState<boolean>(false)\n  const [searchFullscreenPortalEl, setSearchFullscreenPortalEl] = useState<HTMLDivElement | null>(\n    null,\n  )\n  const [searchOpen, setSearchOpen] = useState<boolean>(false)\n\n  const documentTitle = useMemo(() => {\n    const mainTitle = title || startCase(name)\n\n    if (activeToolName) {\n      return `${startCase(activeToolName)} | ${mainTitle}`\n    }\n\n    return mainTitle\n  }, [activeToolName, name, title])\n  const toolControlsDocumentTitle = !!activeTool?.controlsDocumentTitle\n\n  useEffect(() => {\n    if (toolControlsDocumentTitle) {\n      return\n    }\n    document.title = documentTitle\n  }, [documentTitle, toolControlsDocumentTitle])\n\n  const handleSearchFullscreenOpenChange = useCallback((open: boolean) => {\n    setSearchFullscreenOpen(open)\n  }, [])\n\n  const handleSearchOpenChange = useCallback((open: boolean) => {\n    setSearchOpen(open)\n  }, [])\n\n  const navbarContextValue = useMemo(\n    () => ({\n      searchFullscreenOpen,\n      searchFullscreenPortalEl,\n      searchOpen,\n      onSearchFullscreenOpenChange: handleSearchFullscreenOpenChange,\n      onSearchOpenChange: handleSearchOpenChange,\n    }),\n    [\n      searchFullscreenOpen,\n      searchFullscreenPortalEl,\n      searchOpen,\n      handleSearchFullscreenOpenChange,\n      handleSearchOpenChange,\n    ],\n  )\n\n  const Navbar = useNavbarComponent()\n  const ActiveToolLayout = useActiveToolLayoutComponent()\n\n  /**\n   * Handle legacy URL redirects from `/desk` to `/structure`\n   */\n  const isLegacyDeskRedirect =\n    !activeTool &&\n    (activeToolName === 'desk' || !activeToolName) &&\n    typeof window !== 'undefined' &&\n    /\\/desk(\\/|$)/.test(window.location.pathname) &&\n    tools.some((tool) => tool.name === 'structure')\n\n  useEffect(() => {\n    if (!isLegacyDeskRedirect) {\n      return\n    }\n\n    router.navigateUrl({\n      path: window.location.pathname.replace(/\\/desk/, '/structure'),\n      replace: true,\n    })\n  }, [isLegacyDeskRedirect, router])\n\n  return (\n    <Flex data-ui=\"ToolScreen\" direction=\"column\" height=\"fill\" data-testid=\"studio-layout\">\n      <NavbarContext.Provider value={navbarContextValue}>\n        <Navbar />\n      </NavbarContext.Provider>\n      {isLegacyDeskRedirect && <RedirectingScreen />}\n      {tools.length === 0 && <NoToolsScreen />}\n      {tools.length > 0 && !activeTool && activeToolName && !isLegacyDeskRedirect && (\n        <ToolNotFoundScreen toolName={activeToolName} />\n      )}\n      {searchFullscreenOpen && (\n        <SearchFullscreenPortalCard ref={setSearchFullscreenPortalEl} overflow=\"auto\" />\n      )}\n      {/* By using the tool name as the key on the error boundary, we force it to re-render\n          when switching tools, which ensures we don't show the wrong tool having crashed */}\n      <StudioErrorBoundary key={activeTool?.name} heading={`The ${activeTool?.name} tool crashed`}>\n        <Card flex={1} hidden={searchFullscreenOpen}>\n          {activeTool && activeToolName && (\n            <RouteScope\n              scope={activeToolName}\n              __unsafe_disableScopedSearchParams={\n                activeTool.router?.__unsafe_disableScopedSearchParams\n              }\n            >\n              <Suspense fallback={<LoadingBlock showText />}>\n                <ActiveToolLayout activeTool={activeTool} />\n              </Suspense>\n            </RouteScope>\n          )}\n        </Card>\n      </StudioErrorBoundary>\n    </Flex>\n  )\n}\n","import {type ComponentType} from 'react'\n\nimport {\n  type ActiveToolLayoutProps,\n  type LayoutProps,\n  type LogoProps,\n  type NavbarProps,\n  type PluginOptions,\n  type ToolMenuProps,\n} from '../../config'\n\nexport function pickToolMenuComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<ToolMenuProps, 'renderDefault'>> {\n  return plugin.studio?.components?.toolMenu as ComponentType<Omit<ToolMenuProps, 'renderDefault'>>\n}\n\nexport function pickNavbarComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<NavbarProps, 'renderDefault'>> {\n  return plugin.studio?.components?.navbar as ComponentType<Omit<NavbarProps, 'renderDefault'>>\n}\n\nexport function pickLayoutComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<LayoutProps, 'renderDefault'>> {\n  return plugin.studio?.components?.layout as ComponentType<Omit<LayoutProps, 'renderDefault'>>\n}\n\nexport function pickLogoComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<LogoProps, 'renderDefault'>> {\n  return plugin.studio?.components?.logo as ComponentType<Omit<LogoProps, 'renderDefault'>>\n}\n\nexport function pickActiveToolLayoutComponent(\n  plugin: PluginOptions,\n): ComponentType<Omit<ActiveToolLayoutProps, 'renderDefault'>> {\n  return plugin.studio?.components?.activeToolLayout as ComponentType<\n    Omit<ActiveToolLayoutProps, 'renderDefault'>\n  >\n}\n","import {type ComponentType} from 'react'\n\nimport {useMiddlewareComponents} from '../../config'\nimport {\n  type ActiveToolLayoutProps,\n  type LayoutProps,\n  type LogoProps,\n  type NavbarProps,\n  type ToolMenuProps,\n} from '../../config/studio'\nimport {StudioLogo, StudioNavbar, StudioToolMenu} from '../components'\nimport {StudioActiveToolLayout} from '../components/navbar/StudioActiveToolLayout'\nimport {StudioLayoutComponent} from '../StudioLayout'\nimport {\n  pickActiveToolLayoutComponent,\n  pickLayoutComponent,\n  pickLogoComponent,\n  pickNavbarComponent,\n  pickToolMenuComponent,\n} from './picks'\n\n/**\n * @internal\n */\nexport function useToolMenuComponent(): ComponentType<Omit<ToolMenuProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: StudioToolMenu as ComponentType<Omit<ToolMenuProps, 'renderDefault'>>,\n    pick: pickToolMenuComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function useNavbarComponent(): ComponentType<Omit<NavbarProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: StudioNavbar as ComponentType<Omit<NavbarProps, 'renderDefault'>>,\n    pick: pickNavbarComponent,\n  })\n}\n\n/**\n * @internal\n * @deprecated Use `useLogoMarkComponent` instead.\n */\nexport function useLogoComponent(): ComponentType<Omit<LogoProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: StudioLogo as ComponentType<Omit<LogoProps, 'renderDefault'>>,\n    pick: pickLogoComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function useLayoutComponent(): ComponentType<Omit<LayoutProps, 'renderDefault'>> {\n  return useMiddlewareComponents({\n    defaultComponent: StudioLayoutComponent as ComponentType<Omit<LayoutProps, 'renderDefault'>>,\n    pick: pickLayoutComponent,\n  })\n}\n\n/**\n * @internal\n */\nexport function useActiveToolLayoutComponent(): ComponentType<\n  Omit<ActiveToolLayoutProps, 'renderDefault'>\n> {\n  return useMiddlewareComponents({\n    defaultComponent: StudioActiveToolLayout as ComponentType<\n      Omit<ActiveToolLayoutProps, 'renderDefault'>\n    >,\n    pick: pickActiveToolLayoutComponent,\n  })\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {WarningOutlineIcon} from '@sanity/icons'\nimport {Stack, Text} from '@sanity/ui'\nimport {useCallback, useId, useState} from 'react'\n\nimport {Dialog} from '../../../../../ui-components'\nimport {StatusButton} from '../../../../components'\nimport {useSchema} from '../../../../hooks'\nimport {useTranslation} from '../../../../i18n'\nimport {useColorScheme} from '../../../colorScheme'\nimport {SchemaProblemGroups} from '../../../screens/schemaErrors/SchemaProblemGroups'\n\nexport function ConfigIssuesButton() {\n  const schema = useSchema()\n  const groupsWithWarnings =\n    schema._validation?.filter((group) =>\n      group.problems.some((problem) => problem.severity === 'warning'),\n    ) || []\n\n  // get root scheme\n  const {scheme} = useColorScheme()\n  const {t} = useTranslation()\n\n  const dialogId = useId()\n\n  const [isDialogOpen, setDialogOpen] = useState(false)\n  const [buttonElement, setButtonElement] = useState<HTMLButtonElement | null>(null)\n  const handleOpen = useCallback(() => setDialogOpen(true), [])\n\n  const handleClose = useCallback(() => {\n    setDialogOpen(false)\n\n    if (buttonElement) {\n      buttonElement.focus()\n    }\n  }, [buttonElement])\n\n  if (groupsWithWarnings.length === 0) {\n    return null\n  }\n\n  return (\n    <>\n      <StatusButton\n        icon={WarningOutlineIcon}\n        mode=\"bleed\"\n        onClick={handleOpen}\n        ref={setButtonElement}\n        selected={isDialogOpen}\n        tone=\"caution\"\n        tooltipProps={{scheme, content: t('configuration-issues.button.tooltip')}}\n      />\n\n      {isDialogOpen && (\n        <Dialog\n          header=\"Configuration issues\"\n          width={2}\n          onClickOutside={handleClose}\n          onClose={handleClose}\n          // force root scheme here to \"break out\" of the navbar's dark scheme\n          scheme={scheme}\n          id={dialogId}\n        >\n          <Stack space={4}>\n            <Stack space={3}>\n              <Text as=\"h2\" size={1} weight=\"medium\">\n                Found {groupsWithWarnings.length} schema warnings\n              </Text>{' '}\n              <Text muted size={1}>\n                Configuration checks are only performed during development and will not be visible\n                in production builds\n              </Text>\n            </Stack>\n            <SchemaProblemGroups problemGroups={groupsWithWarnings} />\n          </Stack>\n        </Dialog>\n      )}\n    </>\n  )\n}\n","import {defineEvent} from '@sanity/telemetry'\n\ntype TrialStage = 'trialStarted' | 'trialActive' | 'trialEndingSoon' | 'trialEnded' | 'postTrial'\n\ntype BaseDialogEventAttributes = {\n  source: 'studio'\n  trialDaysLeft: number\n  dialogType: 'modal' | 'popover'\n  dialogId: string\n  dialogRevision: string\n  dialogTrialStage: TrialStage\n}\n\nexport interface TrialDialogViewedInfo extends BaseDialogEventAttributes {\n  dialogTrigger: 'fromClick' | 'auto'\n}\n\nexport const TrialDialogViewed = defineEvent<TrialDialogViewedInfo>({\n  name: 'Trial Dialog Viewed',\n  version: 1,\n  description: 'User viewed a dialog or popover related to free trial',\n})\n\nexport interface TrialDialogDismissedInfo extends BaseDialogEventAttributes {\n  dialogDismissAction: 'ctaClicked' | 'xClick' | 'outsideClick'\n}\n\nexport const TrialDialogDismissed = defineEvent<TrialDialogDismissedInfo>({\n  name: 'Trial Dialog Dismissed',\n  version: 1,\n  description: 'User dismissed a dialog or popover related to free trial',\n})\n\nexport interface TrialDialogCTAClickedInfo extends BaseDialogEventAttributes {\n  dialogCtaType: 'upgrade' | 'learnMore'\n}\n\nexport const TrialDialogCTAClicked = defineEvent<TrialDialogCTAClickedInfo>({\n  name: 'Trial Dialog CTA Clicked',\n  version: 1,\n  description: 'User clicked a CTA in a dialog or popover related to free trial',\n})\n\nexport function getTrialStage({\n  showOnLoad,\n  dialogId,\n}: {\n  showOnLoad: boolean\n  dialogId: string\n}): TrialStage {\n  // Note: some of the ids in the trial experience studio have uppercase letters\n  // so the toLowerCase is important here\n  if (showOnLoad && dialogId.toLowerCase() === 'free-upgrade-popover') return 'trialStarted'\n  if (showOnLoad && dialogId.toLowerCase() === 'trial-ending-popover') return 'trialEndingSoon'\n  if (showOnLoad && dialogId.toLowerCase() === 'project-downgraded-to-free') return 'trialEnded'\n  if (!showOnLoad && dialogId.toLowerCase() === 'after-trial-upgrade') return 'postTrial'\n  return 'trialActive'\n}\n","import {defineEvent} from '@sanity/telemetry'\n\ninterface UpsellDialogActionsInfo {\n  feature: 'comments' | 'scheduled_publishing' | 'ai_assist'\n  type: 'modal' | 'inspector'\n}\n\n/** @internal */\nexport interface UpsellDialogViewedInfo extends UpsellDialogActionsInfo {\n  source: 'field_action' | 'document_toolbar' | 'document_action' | 'navbar' | 'link' | 'pte'\n}\n\n/**\n * @internal\n */\nexport const UpsellDialogViewed = defineEvent<UpsellDialogViewedInfo>({\n  name: 'Upsell Dialog Viewed',\n  version: 1,\n  description: 'User viewed the upsell dialog',\n})\n\n/**\n * @internal\n */\nexport const UpsellDialogDismissed = defineEvent<UpsellDialogActionsInfo>({\n  name: 'Upsell Dialog Dismissed',\n  version: 1,\n  description: 'User dismissed the upsell dialog',\n})\n\n/**\n * @internal\n */\nexport const UpsellDialogUpgradeCtaClicked = defineEvent<UpsellDialogActionsInfo>({\n  name: 'Upsell Dialog Upgrade CTA Clicked',\n  version: 1,\n  description: 'User clicked the \"Upgrade\" CTA in the upsell dialog',\n})\n\n/**\n * @internal\n */\nexport const UpsellDialogLearnMoreCtaClicked = defineEvent<UpsellDialogActionsInfo>({\n  name: 'Upsell Dialog Learn More CTA Clicked',\n  version: 1,\n  description: 'User clicked the \"Learn More\" CTA in the upsell dialog',\n})\n","import {\n  isPortableTextTextBlock,\n  type PortableTextBlock,\n  type PortableTextObject,\n  type PortableTextSpan,\n} from '@sanity/types'\n\nconst TRANSFORMATIONS: {\n  [type: string]: (\n    child: PortableTextObject | PortableTextSpan,\n    idx: number,\n    block: PortableTextBlock,\n  ) => PortableTextObject\n} = {\n  inlineIcon: (child, idx, block) => {\n    if (!isPortableTextTextBlock(block)) return block\n    const hasTextLeft = Boolean(\n      block.children[idx - 1]?._type === 'span' && block.children[idx - 1]?.text,\n    )\n    const hasTextRight = Boolean(\n      block.children[idx + 1]?._type === 'span' && block.children[idx + 1]?.text,\n    )\n    return {\n      ...child,\n      hasTextRight,\n      hasTextLeft,\n    }\n  },\n}\n\nexport const transformBlocks = (blocks: PortableTextBlock[]): PortableTextBlock[] => {\n  return blocks.map((block) => {\n    if (isPortableTextTextBlock(block) && block._type === 'block') {\n      const children = block.children.map((child, idx) => {\n        if (TRANSFORMATIONS[child._type]) {\n          return TRANSFORMATIONS[child._type](child, idx, block)\n        }\n        return child\n      })\n\n      return {\n        ...block,\n        children,\n      }\n    }\n    return block\n  })\n}\n","import {PortableText, type PortableTextComponents} from '@portabletext/react'\nimport {Icon, LinkIcon} from '@sanity/icons'\nimport {type PortableTextBlock} from '@sanity/types'\nimport {Box, Card, Flex, Heading, Text} from '@sanity/ui'\nimport {type ReactNode, useEffect, useMemo, useState} from 'react'\nimport styled, {css} from 'styled-components'\n\nimport {ConditionalWrapper} from '../../../../ui-components/conditionalWrapper'\nimport {transformBlocks} from './helpers'\n\ninterface DescriptionSerializerProps {\n  blocks: PortableTextBlock[]\n}\nconst Divider = styled(Box)`\n  height: 1px;\n  background: var(--card-border-color);\n  width: 100%;\n`\n\nconst SerializerContainer = styled.div`\n  // Remove margin top of first element\n  > div:first-child {\n    margin-top: 0;\n  }\n  // Remove margin bottom to last box.\n  > [data-ui='Box']:last-child {\n    margin-bottom: 0;\n  }\n`\n\nconst IconTextContainer = styled(Text)((props) => {\n  if (props.accent) {\n    return `\n    --card-icon-color: var(--card-accent-fg-color);\n    `\n  }\n  return ``\n})\n\nconst AccentSpan = styled.span`\n  color: var(--card-accent-fg-color);\n  --card-icon-color: var(--card-accent-fg-color);\n`\n\nconst SemiboldSpan = styled.span(({theme}) => {\n  const {weights} = theme.sanity.fonts.text\n\n  return css`\n    font-weight: ${weights.semibold};\n  `\n})\n\ninterface InlineIconProps {\n  $hasTextLeft: boolean\n  $hasTextRight: boolean\n}\nconst InlineIcon = styled(Icon)<InlineIconProps>`\n  &[data-sanity-icon] {\n    /* Forces the icon to leave the necessary space to the right or left it has surrounding text */\n    margin-left: ${(props) => (props.$hasTextLeft ? '0' : '')};\n    margin-right: ${(props) => (props.$hasTextRight ? '0' : '')};\n  }\n`\n\nconst Link = styled.a<{useTextColor: boolean}>`\n  font-weight: 600;\n  color: ${(props) => (props.useTextColor ? 'var(--card-muted-fg-color) !important' : '')};\n`\n\nconst DynamicIconContainer = styled.span`\n  > svg {\n    display: inline;\n    font-size: calc(21 / 16 * 1rem) !important;\n    margin: -0.375rem 0 !important;\n    *[stroke] {\n      stroke: currentColor;\n    }\n  }\n`\n\nconst accentSpanWrapper = (children: ReactNode) => <AccentSpan>{children}</AccentSpan>\n\nconst DynamicIcon = (props: {icon: {url: string}}) => {\n  const [ref, setRef] = useState<HTMLSpanElement | null>(null)\n  useEffect(() => {\n    if (!ref) return\n\n    const controller = new AbortController()\n    const signal = controller.signal\n\n    fetch(props.icon.url, {signal})\n      .then((response) => {\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`)\n        }\n        return response.text()\n      })\n      .then((data) => {\n        if (!ref) return\n        ref.innerHTML = data\n      })\n      .catch((error) => {\n        if (error.name !== 'AbortError') {\n          console.error(error)\n        }\n      })\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      controller.abort()\n    }\n  }, [ref, props.icon.url])\n\n  return <DynamicIconContainer ref={setRef} />\n}\n\nfunction NormalBlock(props: {children: ReactNode}) {\n  const {children} = props\n\n  return (\n    <Box paddingX={2} marginBottom={4}>\n      <Text size={1} muted>\n        {children}\n      </Text>\n    </Box>\n  )\n}\n\nfunction HeadingBlock(props: {children: ReactNode}) {\n  const {children} = props\n  return (\n    <Box paddingX={2} marginY={4}>\n      <Heading size={2} as=\"h2\">\n        {children}\n      </Heading>\n    </Box>\n  )\n}\n\nconst components: PortableTextComponents = {\n  block: {\n    normal: ({children}) => <NormalBlock>{children}</NormalBlock>,\n    h2: ({children}) => <HeadingBlock>{children}</HeadingBlock>,\n  },\n  list: {\n    bullet: ({children}) => children,\n    number: ({children}) => <>{children}</>,\n    checkmarks: ({children}) => <>{children}</>,\n  },\n  listItem: {\n    bullet: ({children}) => <NormalBlock>{children}</NormalBlock>,\n    number: ({children}) => <NormalBlock>{children}</NormalBlock>,\n    checkmarks: ({children}) => <NormalBlock>{children}</NormalBlock>,\n  },\n\n  marks: {\n    strong: ({children}) => <strong>{children}</strong>,\n    semibold: ({children}) => <SemiboldSpan>{children}</SemiboldSpan>,\n    link: (props) => (\n      <Link\n        href={props.value.href}\n        rel=\"noopener noreferrer\"\n        target=\"_blank\"\n        useTextColor={props.value.useTextColor}\n      >\n        {props.children}\n        {props.value.showIcon && <LinkIcon style={{marginLeft: '2px'}} />}\n      </Link>\n    ),\n    accent: (props) => <AccentSpan>{props.children}</AccentSpan>,\n  },\n  types: {\n    inlineIcon: (props) => {\n      return (\n        <ConditionalWrapper condition={props.value.accent} wrapper={accentSpanWrapper}>\n          {props.value.sanityIcon ? (\n            <InlineIcon\n              symbol={props.value.sanityIcon}\n              $hasTextLeft={props.value.hasTextLeft}\n              $hasTextRight={props.value.hasTextRight}\n            />\n          ) : (\n            <DynamicIcon icon={props.value.icon} />\n          )}\n        </ConditionalWrapper>\n      )\n    },\n    divider: () => (\n      <Box marginY={3}>\n        <Box paddingY={3}>\n          <Divider />\n        </Box>\n      </Box>\n    ),\n    iconAndText: (props) => (\n      <Flex align=\"flex-start\" paddingX={2} paddingTop={1} paddingBottom={2} marginTop={2} gap={2}>\n        <Flex gap={2} style={{flexShrink: 0}}>\n          <IconTextContainer size={1} accent={props.value.accent}>\n            {props.value.sanityIcon ? (\n              <Icon symbol={props.value.sanityIcon} />\n            ) : (\n              <DynamicIcon icon={props.value.icon} />\n            )}\n          </IconTextContainer>\n          <Text size={1} weight=\"semibold\" accent={props.value.accent}>\n            {props.value.title}\n          </Text>\n        </Flex>\n\n        <Text size={1} muted accent={props.value.accent}>\n          {props.value.text}\n        </Text>\n      </Flex>\n    ),\n  },\n}\n\ninterface DescriptionSerializerProps {\n  blocks: PortableTextBlock[]\n}\n\n/**\n * Portable text serializer for the description text for upsell elements.\n * Not meant for public consumption.\n * @internal\n */\nexport function UpsellDescriptionSerializer(props: DescriptionSerializerProps) {\n  const value = useMemo(() => transformBlocks(props.blocks), [props.blocks])\n  return (\n    <Card tone=\"default\">\n      <SerializerContainer>\n        <PortableText\n          value={value}\n          components={components}\n          /* Disable warnings on missing components */\n          onMissingComponent={false}\n        />\n      </SerializerContainer>\n    </Card>\n  )\n}\n","import {CloseIcon} from '@sanity/icons'\nimport {Box, Flex, Heading} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {Button, Dialog} from '../../../../../ui-components'\nimport {useColorSchemeValue} from '../../../colorScheme'\nimport {UpsellDescriptionSerializer} from '../../../upsell'\nimport {type TrialDialogDismissedInfo} from './__telemetry__/trialDialogEvents.telemetry'\nimport {type FreeTrialDialog} from './types'\n\n/**\n * Absolute positioned button to close the dialog.\n */\nconst StyledButton = styled(Button)`\n  position: absolute;\n  top: 12px;\n  right: 12px;\n  z-index: 20;\n  background: transparent;\n  border-radius: 9999px;\n  box-shadow: none;\n  color: white;\n  --card-fg-color: white;\n  :hover {\n    --card-fg-color: white;\n  }\n`\n\nconst Image = styled.img`\n  object-fit: cover;\n  width: 100%;\n  height: 100%;\n  height: 196px;\n`\n\nconst StyledDialog = styled(Dialog)`\n  > [data-ui='DialogCard'] {\n    max-width: 22.5rem;\n  }\n`\ninterface ModalContentProps {\n  content: FreeTrialDialog\n  onClose: (action?: TrialDialogDismissedInfo['dialogDismissAction']) => void\n  onOpenNext: () => void\n  onOpenUrlCallback: () => void\n  open: boolean\n}\n\nexport function DialogContent({\n  onClose,\n  onOpenNext,\n  onOpenUrlCallback,\n  content,\n  open,\n}: ModalContentProps) {\n  function handleClose() {\n    onClose('xClick')\n  }\n  function handleClickOutside() {\n    onClose('outsideClick')\n  }\n  function handleCTAClose() {\n    onClose('ctaClicked')\n  }\n  const schemeValue = useColorSchemeValue()\n  if (!open) return null\n  return (\n    <StyledDialog\n      id=\"free-trial-modal\"\n      onClose={onClose}\n      onClickOutside={handleClickOutside}\n      padding={false}\n      __unstable_hideCloseButton\n      scheme={schemeValue}\n      footer={{\n        cancelButton: content.secondaryButton?.text\n          ? {\n              text: content.secondaryButton.text,\n              mode: 'bleed',\n              tone: 'default',\n              onClick: handleClose,\n            }\n          : undefined,\n        confirmButton: {\n          text: content.ctaButton?.text,\n          mode: 'default',\n          tone: 'primary',\n          ...(content.ctaButton?.action === 'openUrl'\n            ? {\n                href: content.ctaButton.url,\n                target: '_blank',\n                rel: 'noopener noreferrer',\n                as: 'a',\n                onClick: onOpenUrlCallback,\n              }\n            : {\n                onClick: content.ctaButton?.action === 'openNext' ? onOpenNext : handleCTAClose,\n              }),\n        },\n      }}\n    >\n      <StyledButton\n        icon={CloseIcon}\n        mode=\"bleed\"\n        tone=\"default\"\n        onClick={handleClose}\n        tabIndex={-1}\n        tooltipProps={null}\n      />\n      {content.image && (\n        <Image src={content.image.asset.url} alt={content.image.asset.altText ?? ''} />\n      )}\n      <Flex padding={3} direction={'column'}>\n        <Box paddingX={2} marginTop={3}>\n          <Heading size={2}>{content.headingText}</Heading>\n        </Box>\n        <Box marginTop={4} paddingBottom={3}>\n          <UpsellDescriptionSerializer blocks={content.descriptionText} />\n        </Box>\n      </Flex>\n    </StyledDialog>\n  )\n}\n","import {purple, yellow} from '@sanity/color'\nimport {BoltIcon} from '@sanity/icons'\nimport {Card, Text} from '@sanity/ui'\nimport {forwardRef, type Ref} from 'react'\nimport {useTranslation} from 'react-i18next'\nimport styled from 'styled-components'\n\nimport {Button} from '../../../../../ui-components'\n\nconst CenteredStroke = styled.div`\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n`\n\ninterface OutlineProps {\n  daysLeft: number\n  totalDays: number\n}\n\nconst SvgFilledOutline = ({daysLeft, totalDays}: OutlineProps) => {\n  const progress = totalDays - daysLeft\n\n  const percentage = Math.round((progress / totalDays) * 100)\n  const radius = 10\n  const strokeDasharray = 2 * Math.PI * radius\n  const strokeDashOffset = strokeDasharray * ((100 - percentage) / 100)\n  const strokeWidth = 1.2\n  const size = radius * 2 + strokeWidth\n\n  return (\n    <Card>\n      <CenteredStroke>\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width={size}\n          height={size}\n          viewBox={`0 0 ${size} ${size}`}\n          style={{transform: 'rotate(-90deg)'}}\n        >\n          <circle\n            r={radius}\n            cx={size / 2}\n            cy={size / 2}\n            fill=\"transparent\"\n            strokeWidth={strokeWidth}\n            stroke={percentage > 75 ? yellow['600'].hex : purple['400'].hex}\n          />\n          <circle\n            r={radius}\n            cx={size / 2}\n            cy={size / 2}\n            fill=\"transparent\"\n            strokeWidth={strokeWidth}\n            stroke=\"var(--card-border-color)\"\n            strokeDasharray={strokeDasharray}\n            strokeDashoffset={strokeDashOffset}\n          />\n        </svg>\n      </CenteredStroke>\n    </Card>\n  )\n}\n\ninterface FreeTrialButtonProps extends OutlineProps {\n  toggleShowContent: () => void\n}\n\nexport const FreeTrialButtonTopbar = forwardRef(function FreeTrialButtonTopbar(\n  {toggleShowContent, daysLeft, totalDays}: FreeTrialButtonProps,\n  ref: Ref<HTMLButtonElement>,\n) {\n  const {t} = useTranslation()\n\n  return (\n    <Button\n      mode=\"bleed\"\n      onClick={toggleShowContent}\n      ref={ref}\n      tooltipProps={{\n        content: daysLeft\n          ? t('free-trial.tooltip.days-count', {count: daysLeft})\n          : t('free-trial.tooltip.trial-finished'),\n      }}\n    >\n      <Text size={0}>\n        <BoltIcon />\n      </Text>\n      {daysLeft > 0 && <SvgFilledOutline daysLeft={daysLeft} totalDays={totalDays} />}\n    </Button>\n  )\n})\n\nexport const FreeTrialButtonSidebar = forwardRef(function FreeTrialButtonSidebar(\n  {toggleShowContent, daysLeft}: Omit<FreeTrialButtonProps, 'totalDays'>,\n  ref: Ref<HTMLButtonElement>,\n) {\n  const {t} = useTranslation()\n\n  return (\n    <Button\n      ref={ref}\n      icon={BoltIcon}\n      justify=\"flex-start\"\n      mode=\"bleed\"\n      size=\"large\"\n      onClick={toggleShowContent}\n      text={\n        daysLeft\n          ? t('user-menu.action.free-trial', {count: daysLeft})\n          : t('user-menu.action.free-trial-finished')\n      }\n    />\n  )\n})\n","import {createContext, useContext} from 'react'\n\nimport {type FreeTrialResponse} from './types'\n\n/**\n * @internal\n */\nexport interface FreeTrialContextProps {\n  data: FreeTrialResponse | null\n  showDialog: boolean\n  showOnLoad: boolean\n  /**\n   * If the user is seeing the `showOnLoad` popover or modal, and clicks on the pricing button the `showOnClick` modal should be triggered.\n   */\n  toggleShowContent: (closeAndReOpen?: boolean) => void\n}\n\n/**\n * @internal\n */\nexport const FreeTrialContext = createContext<FreeTrialContextProps | undefined>(undefined)\n\n/**\n * @internal\n */\nexport const useFreeTrialContext = (): FreeTrialContextProps => {\n  const context = useContext(FreeTrialContext)\n  if (!context) {\n    throw new Error('useFreeTrial must be used within a FreeTrialProvider')\n  }\n  return context\n}\n","import {Box, Card, Container, Flex, Heading} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {Button} from '../../../../../ui-components'\nimport {UpsellDescriptionSerializer} from '../../../upsell'\nimport {type TrialDialogDismissedInfo} from './__telemetry__/trialDialogEvents.telemetry'\nimport {type FreeTrialDialog} from './types'\n\nconst Image = styled.img`\n  object-fit: cover;\n  width: 100%;\n  height: 100%;\n  height: 180px;\n`\n\ninterface PopoverContentProps {\n  content: FreeTrialDialog\n  handleClose: (action?: TrialDialogDismissedInfo['dialogDismissAction']) => void\n  handleOpenNext: () => void\n}\n\nexport function PopoverContent({content, handleClose, handleOpenNext}: PopoverContentProps) {\n  return (\n    <Card radius={3} overflow={'hidden'} width={0}>\n      <Container width={0}>\n        {content.image && (\n          <Image src={content.image.asset.url} alt={content.image.asset.altText ?? ''} />\n        )}\n        <Flex padding={3} direction={'column'}>\n          <Box paddingX={2} marginTop={3}>\n            <Heading size={1}>{content.headingText}</Heading>\n          </Box>\n          <Box marginTop={4}>\n            <UpsellDescriptionSerializer blocks={content.descriptionText} />\n          </Box>\n        </Flex>\n        <Flex width=\"full\" gap={3} justify=\"flex-end\" padding={3}>\n          {content.secondaryButton?.text && (\n            <Button\n              mode=\"bleed\"\n              text={content.secondaryButton.text}\n              tone=\"default\"\n              onClick={() => handleClose('xClick')}\n            />\n          )}\n          <Button\n            mode=\"default\"\n            tooltipProps={null}\n            text={content.ctaButton?.text}\n            autoFocus\n            tone=\"primary\"\n            {...(content.ctaButton?.action === 'openUrl'\n              ? {\n                  href: content.ctaButton.url,\n                  target: '_blank',\n                  rel: 'noopener noreferrer',\n                  as: 'a',\n                }\n              : {\n                  onClick:\n                    content.ctaButton?.action === 'openNext'\n                      ? handleOpenNext\n                      : () => handleClose('ctaClicked'),\n                })}\n          />\n        </Flex>\n      </Container>\n    </Card>\n  )\n}\n","import {useTelemetry} from '@sanity/telemetry/react'\nimport {useCallback, useEffect, useState} from 'react'\n\nimport {Popover} from '../../../../../ui-components'\nimport {useColorSchemeValue} from '../../../colorScheme'\nimport {\n  getTrialStage,\n  TrialDialogCTAClicked,\n  TrialDialogDismissed,\n  type TrialDialogDismissedInfo,\n  TrialDialogViewed,\n} from './__telemetry__/trialDialogEvents.telemetry'\nimport {DialogContent} from './DialogContent'\nimport {FreeTrialButtonSidebar, FreeTrialButtonTopbar} from './FreeTrialButton'\nimport {useFreeTrialContext} from './FreeTrialContext'\nimport {PopoverContent} from './PopoverContent'\n\ninterface FreeTrialProps {\n  type: 'sidebar' | 'topbar'\n}\n\nexport function FreeTrial({type}: FreeTrialProps) {\n  const {data, showDialog, showOnLoad, toggleShowContent} = useFreeTrialContext()\n  const scheme = useColorSchemeValue()\n  const telemetry = useTelemetry()\n\n  // Use callback refs to get the element handle when it's ready/changed\n  const [ref, setRef] = useState<HTMLButtonElement | null>(null)\n\n  const [showPopover, setShowPopover] = useState(false)\n\n  useEffect(() => {\n    if (ref) {\n      // set popover visible when the ref has been set (i.e. the element is ready)\n      setShowPopover(true)\n    }\n  }, [ref])\n  const closeAndReOpen = useCallback(() => toggleShowContent(true), [toggleShowContent])\n  const toggleDialog = useCallback(() => {\n    ref?.focus()\n    toggleShowContent(false)\n  }, [toggleShowContent, ref])\n\n  const handleClose = useCallback(\n    (dialogType?: 'modal' | 'popover') => {\n      return (action?: TrialDialogDismissedInfo['dialogDismissAction']) => {\n        const dialog = data?.showOnLoad || data?.showOnClick\n\n        if (dialog)\n          telemetry.log(TrialDialogDismissed, {\n            dialogId: dialog.id,\n            dialogRevision: dialog._rev,\n            dialogType,\n            source: 'studio',\n            trialDaysLeft: data.daysLeft,\n            dialogTrialStage: getTrialStage({showOnLoad, dialogId: dialog.id}),\n            dialogDismissAction: action,\n          })\n\n        toggleDialog()\n      }\n    },\n    [data, toggleDialog, showOnLoad, telemetry],\n  )\n\n  const handleDialogCTAClick = useCallback(\n    (action?: 'openURL' | 'openNext') => {\n      return () => {\n        const dialog = data?.showOnLoad || data?.showOnClick\n        if (dialog)\n          telemetry.log(TrialDialogCTAClicked, {\n            dialogId: dialog.id,\n            dialogRevision: dialog._rev,\n            dialogType: 'modal',\n            source: 'studio',\n            trialDaysLeft: data.daysLeft,\n            dialogTrialStage: getTrialStage({showOnLoad, dialogId: dialog.id}),\n            dialogCtaType: action === 'openURL' ? 'upgrade' : 'learnMore',\n          })\n        closeAndReOpen()\n      }\n    },\n    [data, closeAndReOpen, telemetry, showOnLoad],\n  )\n\n  const handlePopoverCTAClick = useCallback(() => {\n    if (data?.showOnLoad)\n      telemetry.log(TrialDialogCTAClicked, {\n        dialogId: data.showOnLoad.id,\n        dialogRevision: data.showOnLoad._rev,\n        dialogType: 'popover',\n        source: 'studio',\n        trialDaysLeft: data.daysLeft,\n        dialogTrialStage: getTrialStage({showOnLoad: true, dialogId: data.showOnLoad.id}),\n        dialogCtaType: 'learnMore',\n      })\n    closeAndReOpen()\n  }, [data?.showOnLoad, data?.daysLeft, closeAndReOpen, telemetry])\n\n  const handleOnTrialButtonClick = useCallback(() => {\n    if (data?.showOnClick)\n      telemetry.log(TrialDialogViewed, {\n        dialogId: data.showOnClick.id,\n        dialogRevision: data.showOnClick._rev,\n        dialogTrigger: 'fromClick',\n        dialogType: 'modal',\n        source: 'studio',\n        trialDaysLeft: data.daysLeft,\n        dialogTrialStage: getTrialStage({showOnLoad: true, dialogId: data.showOnClick.id}),\n      })\n    closeAndReOpen()\n  }, [data?.showOnClick, data?.daysLeft, telemetry, closeAndReOpen])\n\n  if (!data?.id) return null\n  const dialogToRender = showOnLoad ? data.showOnLoad : data.showOnClick\n  if (!dialogToRender) return null\n\n  const button =\n    type === 'sidebar' ? (\n      <FreeTrialButtonSidebar\n        toggleShowContent={handleOnTrialButtonClick}\n        daysLeft={data.daysLeft}\n        ref={setRef}\n      />\n    ) : (\n      <FreeTrialButtonTopbar\n        toggleShowContent={handleOnTrialButtonClick}\n        daysLeft={data.daysLeft}\n        totalDays={data.totalDays}\n        ref={setRef}\n      />\n    )\n\n  if (dialogToRender?.dialogType === 'popover') {\n    return (\n      <Popover\n        open={showDialog && showPopover}\n        size={0}\n        scheme={scheme}\n        radius={3}\n        portal\n        placement={type === 'sidebar' ? 'top' : 'bottom-end'}\n        content={\n          <PopoverContent\n            content={dialogToRender}\n            handleClose={handleClose('popover')}\n            handleOpenNext={handlePopoverCTAClick}\n          />\n        }\n      >\n        {button}\n      </Popover>\n    )\n  }\n\n  return (\n    <>\n      {button}\n      <DialogContent\n        content={dialogToRender}\n        onClose={handleClose('modal')}\n        onOpenNext={handleDialogCTAClick('openNext')}\n        onOpenUrlCallback={handleDialogCTAClick('openURL')}\n        open={showDialog}\n      />\n    </>\n  )\n}\n","/**\n * This version is provided by `@sanity/pkg-utils` at build time\n * @hidden\n * @beta\n */\nexport const SANITY_VERSION = process.env.PKG_VERSION || ('0.0.0-development' as string)\n","import {useTelemetry} from '@sanity/telemetry/react'\nimport {type ReactNode, useCallback, useEffect, useState} from 'react'\nimport {useRouter} from 'sanity/router'\n\nimport {useClient} from '../../../../hooks'\nimport {SANITY_VERSION} from '../../../../version'\nimport {getTrialStage, TrialDialogViewed} from './__telemetry__/trialDialogEvents.telemetry'\nimport {FreeTrialContext} from './FreeTrialContext'\nimport {type FreeTrialResponse} from './types'\n/**\n * @internal\n */\nexport interface FreeTrialProviderProps {\n  children: ReactNode\n}\n\n/**\n * @internal\n */\nexport const FreeTrialProvider = ({children}: FreeTrialProviderProps) => {\n  const router = useRouter()\n  const [data, setData] = useState<FreeTrialResponse | null>(null)\n  const [showDialog, setShowDialog] = useState(false)\n  const [showOnLoad, setShowOnLoad] = useState(false)\n  const client = useClient({apiVersion: '2023-12-11'})\n  const telemetry = useTelemetry()\n\n  // Whenever showDialog changes, run effect to track\n  // the dialog view\n  useEffect(() => {\n    const dialog = data?.showOnLoad\n    if (showDialog && showOnLoad && dialog) {\n      telemetry.log(TrialDialogViewed, {\n        dialogId: dialog.id,\n        dialogRevision: dialog._rev,\n        dialogTrialStage: getTrialStage({showOnLoad, dialogId: dialog.id}),\n        dialogTrigger: showOnLoad ? 'auto' : 'fromClick',\n        dialogType: dialog.dialogType,\n        source: 'studio',\n        trialDaysLeft: data.daysLeft,\n      })\n    }\n  }, [showDialog, data, showOnLoad, telemetry])\n\n  // This is casted to a string to make it stable across renders so it doesn't trigger multiple times the effect.\n  const searchParamsAsString = new URLSearchParams(router.state._searchParams).toString()\n\n  useEffect(() => {\n    // See if we have any parameters from the current route\n    // to pass onto our query\n    const searchParams = new URLSearchParams(searchParamsAsString)\n\n    const queryParams = new URLSearchParams()\n    queryParams.append('studioVersion', SANITY_VERSION)\n    // Allows us to override the current state of the trial to\n    // get back certain modals based on the current experience\n    // can be 'growth-trial', 'growth-trial-ending', or 'post-growth-trial'\n    const trialState = searchParams.get('trialState')\n    if (trialState) queryParams.append('trialState', trialState)\n    // Allows us to set whether we've seen the modals before\n    // or whether this is our first time seeing them (i.e. show a popup)\n    const seenBefore = searchParams.get('seenBefore')\n    if (seenBefore) queryParams.append('seenBefore', seenBefore)\n    // If we have trialState, query the override endpoint so that we\n    // get back trial modals for that state\n    const queryURL = queryParams.get('trialState') ? `/journey/trial/override` : `/journey/trial`\n    const request = client.observable\n      .request<FreeTrialResponse | null>({\n        url: `${queryURL}?${queryParams.toString()}`,\n      })\n      .subscribe(\n        (response) => {\n          setData(response)\n          if (response?.showOnLoad) {\n            setShowOnLoad(true)\n            setShowDialog(true)\n          }\n        },\n        () => {\n          /* silently ignore any error */\n        },\n      )\n\n    return () => {\n      request.unsubscribe()\n    }\n  }, [client, searchParamsAsString])\n\n  const toggleShowContent = useCallback(\n    (closeAndReOpen = false) => {\n      if (showOnLoad) {\n        setShowOnLoad(false)\n        // If the user clicks on the button, while the show on load is open, we want to trigger the modal.\n        setShowDialog(closeAndReOpen)\n        if (data?.showOnLoad?.id) {\n          client.request({url: `/journey/trial/${data?.showOnLoad.id}`, method: 'POST'})\n        }\n      } else {\n        setShowDialog((p) => !p)\n      }\n    },\n    [client, showOnLoad, data?.showOnLoad?.id],\n  )\n\n  return (\n    <FreeTrialContext.Provider value={{data, showDialog, toggleShowContent, showOnLoad}}>\n      {children}\n    </FreeTrialContext.Provider>\n  )\n}\n","export function SanityLogo() {\n  return (\n    <svg\n      width=\"100%\"\n      height=\"100%\"\n      viewBox=\"0 0 33 33\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <rect width=\"100%\" height=\"100%\" fill=\"#EC5446\" />\n      <path\n        d=\"M10.1637 8.5498C10.1637 11.3854 11.9461 13.0725 15.5143 13.9622L19.2955 14.8235C22.6725 15.5855 24.729 17.4783 24.729 20.5619C24.7553 21.9053 24.3107 23.2168 23.4698 24.2765C23.4698 21.1999 21.8499 19.5376 17.9425 18.538L14.2299 17.7086C11.257 17.0423 8.9623 15.4863 8.9623 12.1368C8.94666 10.8433 9.36932 9.58143 10.1637 8.5498Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M21.1463 19.8069C22.7591 20.8206 23.4662 22.2384 23.4662 24.2729C22.1313 25.953 19.7861 26.8958 17.0297 26.8958C12.3899 26.8958 9.1427 24.6521 8.42111 20.7533H12.8769C13.4506 22.5432 14.9695 23.3726 16.9972 23.3726C19.4722 23.3726 21.1175 22.0753 21.1499 19.7998\"\n        fill=\"#F8B1AA\"\n      />\n      <path\n        d=\"M12.4801 12.7536C11.7436 12.3236 11.1394 11.7057 10.7316 10.9656C10.3238 10.2255 10.1276 9.3907 10.1638 8.54984C11.4518 6.88396 13.6923 5.8667 16.4235 5.8667C21.1499 5.8667 23.8848 8.31945 24.5595 11.7717H20.2732C19.8006 10.4107 18.6172 9.35089 16.4596 9.35089C14.1541 9.35089 12.5811 10.6694 12.4909 12.7536\"\n        fill=\"#F8B1AA\"\n      />\n    </svg>\n  )\n}\n","import {Box, Card, Flex, rem, Text} from '@sanity/ui'\nimport {useStateLink} from 'sanity/router'\nimport styled from 'styled-components'\n\nimport {focusRingStyle} from '../../../../form/components/withFocusRing/helpers'\nimport {useActiveWorkspace} from '../../../activeWorkspaceMatcher'\nimport {useWorkspaces} from '../../../workspaces'\nimport {SanityLogo} from '../SanityLogo'\nimport {WorkspacePreviewIcon} from '../workspace'\n\nconst LOGO_MARK_SIZE = 25 // width and height, px\nconst RADIUS = 2\n\nconst LogoMarkContainer = styled(Card).attrs({\n  overflow: 'hidden',\n  radius: RADIUS,\n})`\n  height: ${LOGO_MARK_SIZE}px;\n  width: ${LOGO_MARK_SIZE}px;\n`\n\nconst StyledCard = styled(Card)`\n  border-radius: ${({theme}) => rem(theme.sanity.radius[RADIUS])};\n  display: flex;\n  outline: none;\n  text-decoration: none;\n  &:focus-visible {\n    box-shadow: ${({theme}) =>\n      focusRingStyle({\n        base: theme.sanity.color.base,\n        focusRing: {...theme.sanity.focusRing, offset: 1},\n      })};\n  }\n`\n\n/**\n * Home button in the main navbar.\n *\n * If only one workspace is available:\n * - Displays the workspace icon (if defined), otherwise falls back to the Sanity logo.\n * - Displays the active workspace title.\n *\n * If multiple workspaces are available:\n * - Displays the workspace icon only.\n */\nexport function HomeButton() {\n  const workspaces = useWorkspaces()\n  const {activeWorkspace} = useActiveWorkspace()\n  const {href: rootHref, onClick: handleRootClick} = useStateLink({state: {}})\n\n  const multipleWorkspaces = workspaces.length > 1\n\n  return (\n    <StyledCard as=\"a\" href={rootHref} onClick={handleRootClick}>\n      <Flex align=\"center\">\n        <LogoMarkContainer>\n          <Flex align=\"center\" height=\"fill\" justify=\"center\">\n            {multipleWorkspaces || activeWorkspace.customIcon ? (\n              <WorkspacePreviewIcon icon={activeWorkspace.icon} size=\"small\" />\n            ) : (\n              <SanityLogo />\n            )}\n          </Flex>\n        </LogoMarkContainer>\n        {!multipleWorkspaces && (\n          <Box paddingX={2}>\n            <Text size={1} weight=\"medium\">\n              {activeWorkspace.title}\n            </Text>\n          </Box>\n        )}\n      </Flex>\n    </StyledCard>\n  )\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {Card, Stack} from '@sanity/ui'\n\nimport {Button} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {type StudioThemeColorSchemeKey} from '../../../../theme'\nimport {useColorSchemeOptions} from '../../../colorScheme'\n\nexport function AppearanceMenu({\n  setScheme,\n}: {\n  setScheme: (nextScheme: StudioThemeColorSchemeKey) => void\n}) {\n  const {t} = useTranslation()\n  // Subscribe to just what we need, if the menu isn't shown then we're not subscribed to these contexts\n  const options = useColorSchemeOptions(setScheme, t)\n\n  return (\n    <Card borderTop flex=\"none\" padding={2} overflow=\"auto\">\n      <Stack as=\"ul\" space={1}>\n        {options.map(({icon, label, name, onSelect, selected, title}) => (\n          <Stack as=\"li\" key={name}>\n            <Button\n              aria-label={label}\n              icon={icon}\n              iconRight={selected && <CheckmarkIcon />}\n              justify=\"flex-start\"\n              mode=\"bleed\"\n              onClick={onSelect}\n              selected={selected}\n              size=\"large\"\n              text={title}\n            />\n          </Stack>\n        ))}\n      </Stack>\n    </Card>\n  )\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {Card, Stack} from '@sanity/ui'\nimport {useCallback} from 'react'\n\nimport {Button} from '../../../../../ui-components'\nimport {useLocale} from '../../../../i18n/hooks/useLocale'\n\n// TODO: re-enable locale selection once schema localization is available\nconst LOCALE_SELECTION_DISABLED = true\n\nexport function LocaleMenu() {\n  const {changeLocale, currentLocale, locales} = useLocale()\n\n  if (LOCALE_SELECTION_DISABLED) {\n    return null\n  }\n\n  if (!locales || locales.length < 2) {\n    return null\n  }\n\n  return (\n    <Card borderTop flex=\"none\" padding={2} overflow=\"auto\">\n      <Stack as=\"ul\" space={1}>\n        {locales.map((item) => (\n          <LocaleItem\n            key={item.id}\n            locale={item}\n            changeLocale={changeLocale}\n            selectedLocale={currentLocale.id}\n          />\n        ))}\n      </Stack>\n    </Card>\n  )\n}\n\nfunction LocaleItem(props: {\n  locale: {id: string; title: string}\n  changeLocale: (lang: string) => void\n  selectedLocale: string\n}) {\n  const {locale, changeLocale, selectedLocale: selectedLang} = props\n  const localeId = locale.id\n  const onClick = useCallback(() => changeLocale(localeId), [localeId, changeLocale])\n  const selected = selectedLang == localeId\n\n  return (\n    <Button\n      aria-label={locale.title}\n      iconRight={selected && <CheckmarkIcon />}\n      justify=\"flex-start\"\n      mode=\"bleed\"\n      onClick={onClick}\n      selected={selected}\n      size=\"large\"\n      text={locale.title}\n    />\n  )\n}\n","import {CogIcon, UsersIcon} from '@sanity/icons'\nimport {Card, Stack} from '@sanity/ui'\n\nimport {Button} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {userHasRole} from '../../../../util'\nimport {useWorkspace} from '../../../workspace'\nimport {FreeTrial} from '../free-trial'\n\nexport function ManageMenu() {\n  const {currentUser, projectId} = useWorkspace()\n  const isAdmin = Boolean(currentUser && userHasRole(currentUser, 'administrator'))\n\n  const {t} = useTranslation()\n\n  return (\n    <Card borderTop flex=\"none\" padding={2}>\n      <Stack as=\"ul\" space={1}>\n        <Stack as=\"li\">\n          <FreeTrial type=\"sidebar\" />\n        </Stack>\n\n        <Stack as=\"li\">\n          <Button\n            aria-label={t('user-menu.action.manage-project-aria-label')}\n            as=\"a\"\n            href={`https://sanity.io/manage/project/${projectId}`}\n            icon={CogIcon}\n            justify=\"flex-start\"\n            mode=\"bleed\"\n            size=\"large\"\n            target=\"_blank\"\n            text={t('user-menu.action.manage-project')}\n          />\n        </Stack>\n\n        {isAdmin && (\n          <Stack as=\"li\">\n            <Button\n              aria-label={t('user-menu.action.invite-members-aria-label')}\n              as=\"a\"\n              href={`https://sanity.io/manage/project/${projectId}/members`}\n              icon={UsersIcon}\n              justify=\"flex-start\"\n              mode=\"bleed\"\n              size=\"large\"\n              target=\"_blank\"\n              text={t('user-menu.action.invite-members')}\n            />\n          </Stack>\n        )}\n      </Stack>\n    </Card>\n  )\n}\n","import {CloseIcon, LeaveIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Layer, Stack, Text} from '@sanity/ui'\nimport {AnimatePresence, motion, type Transition, type Variants} from 'framer-motion'\nimport {type KeyboardEvent, memo, useCallback, useMemo} from 'react'\nimport TrapFocus from 'react-focus-lock'\nimport styled from 'styled-components'\n\nimport {Button} from '../../../../../ui-components'\nimport {UserAvatar} from '../../../../components'\nimport {type NavbarAction, type Tool} from '../../../../config'\nimport {useTranslation} from '../../../../i18n'\nimport {useColorSchemeSetValue} from '../../../colorScheme'\nimport {useToolMenuComponent} from '../../../studio-components-hooks'\nimport {useWorkspace} from '../../../workspace'\nimport {useWorkspaces} from '../../../workspaces'\nimport {HomeButton} from '../home/HomeButton'\nimport {WorkspaceMenuButton} from '../workspace'\nimport {AppearanceMenu} from './ApperanceMenu'\nimport {LocaleMenu} from './LocaleMenu'\nimport {ManageMenu} from './ManageMenu'\n\nconst ANIMATION_TRANSITION: Transition = {\n  bounce: 0,\n  damping: 20,\n  mass: 0.5,\n  stiffness: 200,\n  type: 'spring',\n}\n\nconst BACKDROP_VARIANTS: Variants = {\n  open: {\n    opacity: 1,\n  },\n  closed: {\n    opacity: 0,\n  },\n}\n\nconst INNER_CARD_VARIANTS: Variants = {\n  open: {\n    x: '0%',\n  },\n  closed: {\n    x: '-100%',\n  },\n}\n\nconst Root = styled(Layer)`\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n`\n\nconst BackdropMotion = styled(motion(Card))`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: var(--card-shadow-penumbra-color);\n`\n\nconst InnerCardMotion = styled(motion(Card))`\n  position: relative;\n  pointer-events: all;\n  flex-direction: column;\n  height: 100%;\n  min-width: 200px;\n  max-width: 280px;\n  overflow: auto;\n`\n\ninterface NavDrawerProps {\n  __internal_actions?: NavbarAction[]\n  activeToolName?: string\n  isOpen: boolean\n  onClose: () => void\n  tools: Tool[]\n}\n\nexport const NavDrawer = memo(function NavDrawer(props: NavDrawerProps) {\n  const {__internal_actions: actions, activeToolName, isOpen, onClose, tools} = props\n\n  const setScheme = useColorSchemeSetValue()\n  const {auth, currentUser} = useWorkspace()\n  const workspaces = useWorkspaces()\n  const ToolMenu = useToolMenuComponent()\n\n  const {t} = useTranslation()\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLDivElement>) => {\n      if (event.key === 'Escape') {\n        onClose()\n      }\n    },\n    [onClose],\n  )\n\n  const handleActionClick = useCallback(\n    (action: () => void) => {\n      action?.()\n      onClose()\n    },\n    [onClose],\n  )\n\n  const actionNodes = useMemo(() => {\n    return actions\n      ?.filter((v) => v.location === 'sidebar')\n      ?.map((action) => {\n        return (\n          <Button\n            icon={action?.icon}\n            justify=\"flex-start\"\n            key={action.name}\n            mode=\"bleed\"\n            // eslint-disable-next-line react/jsx-no-bind\n            onClick={() => handleActionClick(action.onAction)}\n            selected={action.selected}\n            size=\"large\"\n            text={action.title}\n            width=\"fill\"\n          />\n        )\n      })\n  }, [actions, handleActionClick])\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <TrapFocus returnFocus>\n          <Root onKeyDown={handleKeyDown}>\n            <BackdropMotion\n              animate=\"open\"\n              data-open={isOpen}\n              exit=\"closed\"\n              initial=\"closed\"\n              onClick={onClose}\n              transition={ANIMATION_TRANSITION}\n              variants={BACKDROP_VARIANTS}\n            />\n            <InnerCardMotion\n              animate=\"open\"\n              data-open={isOpen}\n              display=\"flex\"\n              exit=\"closed\"\n              height=\"fill\"\n              initial=\"closed\"\n              shadow={1}\n              transition={ANIMATION_TRANSITION}\n              variants={INNER_CARD_VARIANTS}\n            >\n              <Card borderBottom>\n                <Stack space={3} padding={3}>\n                  <Flex align=\"center\">\n                    {/* Current user */}\n                    <Flex flex={1} align=\"center\" paddingRight={2}>\n                      <Flex flex={1} align=\"center\">\n                        <UserAvatar size={1} user=\"me\" />\n                        <Box\n                          flex={1}\n                          marginLeft={3}\n                          title={currentUser?.name || currentUser?.email}\n                        >\n                          <Text size={1} textOverflow=\"ellipsis\" weight=\"medium\">\n                            {currentUser?.name || currentUser?.email}\n                          </Text>\n                        </Box>\n                      </Flex>\n                    </Flex>\n\n                    <Button\n                      icon={CloseIcon}\n                      mode=\"bleed\"\n                      onClick={onClose}\n                      tooltipProps={{content: t('user-menu.close-menu')}}\n                    />\n                  </Flex>\n\n                  {workspaces.length > 1 && (\n                    <Flex flex={1} gap={1}>\n                      <HomeButton />\n                      <WorkspaceMenuButton />\n                    </Flex>\n                  )}\n                </Stack>\n              </Card>\n\n              <Flex direction=\"column\" flex={1} justify=\"space-between\" overflow=\"auto\">\n                {/* Tools */}\n                <Card flex=\"none\" padding={2}>\n                  <ToolMenu\n                    activeToolName={activeToolName}\n                    closeSidebar={onClose}\n                    context=\"sidebar\"\n                    isSidebarOpen={isOpen}\n                    tools={tools}\n                  />\n                </Card>\n\n                <Flex direction=\"column\">\n                  {actionNodes && (\n                    <Card flex=\"none\" padding={2}>\n                      <Stack space={1}>{actionNodes}</Stack>\n                    </Card>\n                  )}\n\n                  {setScheme && <AppearanceMenu setScheme={setScheme} />}\n                  <LocaleMenu />\n                  <ManageMenu />\n                </Flex>\n              </Flex>\n\n              {auth.logout && (\n                <Card flex=\"none\" padding={2} borderTop>\n                  <Stack>\n                    <Button\n                      iconRight={LeaveIcon}\n                      justify=\"flex-start\"\n                      mode=\"bleed\"\n                      // eslint-disable-next-line react/jsx-handler-names\n                      onClick={auth.logout}\n                      size=\"large\"\n                      text={t('user-menu.action.sign-out')}\n                    />\n                  </Stack>\n                </Card>\n              )}\n            </InnerCardMotion>\n          </Root>\n        </TrapFocus>\n      )}\n    </AnimatePresence>\n  )\n})\n","import {type NewDocumentOption} from './types'\n\nfunction isQueryMatch(query: string, option: NewDocumentOption): boolean {\n  const lowercaseTitle = option.title.toLowerCase()\n  const lowercaseQuery = query.trim().toLowerCase()\n\n  // Split the query into words (separated by spaces, dashes or underscores)\n  const words = lowercaseQuery.split(/[\\s\\-_]+/)\n\n  return words.every((word) => lowercaseTitle.includes(word))\n}\n\n// Sort the results based on relevance. The result should be sorted based on the following criteria:\n// 1. If the title starts with the query, it should be first\n// 2. If the title includes the query, it should be second\nfunction sortResultRelevance(query: string, a: NewDocumentOption, b: NewDocumentOption): number {\n  const titleA = a.title.toLowerCase()\n  const titleB = b.title.toLowerCase()\n  const lowercaseQuery = query.trim().toLowerCase()\n\n  if (titleA.startsWith(lowercaseQuery) && !titleB.startsWith(lowercaseQuery)) {\n    return -1\n  }\n\n  if (titleB.startsWith(lowercaseQuery) && !titleA.startsWith(lowercaseQuery)) {\n    return 1\n  }\n\n  if (titleA.includes(lowercaseQuery) && !titleB.includes(lowercaseQuery)) {\n    return -1\n  }\n\n  if (titleB.includes(lowercaseQuery) && !titleA.includes(lowercaseQuery)) {\n    return 1\n  }\n\n  return 0\n}\n\nexport function filterOptions(\n  options: NewDocumentOption[],\n  query: string,\n  getI18nText: (option: NewDocumentOption) => NewDocumentOption,\n): NewDocumentOption[] {\n  const optionsWithTitle = options.map((option) => ({\n    ...option,\n    title: getI18nText({...option, title: option?.title || option.id}).title,\n  }))\n\n  const alphabetized = optionsWithTitle.sort((a, b) => a.title.localeCompare(b.title))\n\n  return alphabetized\n    .filter((option) => isQueryMatch(query, option))\n    .sort((a, b) => sortResultRelevance(query, a, b))\n}\n","import {Card, Flex} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nimport {Dialog, Popover} from '../../../../../ui-components'\n\nexport const StyledPopover = styled(Popover)(() => {\n  return css`\n    [data-ui='Popover__wrapper'] {\n      width: 320px;\n      display: flex;\n      flex-direction: column;\n      border-radius: ${({theme}) => theme.sanity.radius[3]}px;\n      position: relative;\n      overflow: hidden;\n      overflow: clip;\n    }\n  `\n})\n\n// We are using `flex-start` to make sure that the dialogs doesn't jump around when\n// the content changes. This is because the dialog is centered by default, and\n// when the content changes, the dialog will jump to the center of the screen.\nexport const StyledDialog = styled(Dialog)(() => {\n  return css`\n    [data-ui='DialogCard'] {\n      justify-content: flex-start;\n    }\n  `\n})\n\nexport const RootFlex = styled(Flex)``\n\nexport const PopoverHeaderCard = styled(Card)`\n  min-height: max-content;\n`\n\nexport const DialogHeaderCard = styled(Card)`\n  min-height: max-content;\n`\n\nexport const PopoverListFlex = styled(Flex)<{\n  $maxDisplayedItems: number\n  $itemHeight: number\n}>((props) => {\n  const {$maxDisplayedItems, $itemHeight} = props\n\n  // Calculate the max height of the list.\n  // We want the max height to be the height of the list items multiplied by the max number of items.\n  return css`\n    --item-height: ${$itemHeight}px;\n    --max-items: ${$maxDisplayedItems};\n    --list-padding: 0.5rem;\n\n    position: relative;\n    max-height: calc(var(--item-height) * var(--max-items) + var(--list-padding));\n    min-height: calc((var(--item-height) * 1));\n  `\n})\n","import {type CurrentUser} from '@sanity/types'\nimport {Card, Text} from '@sanity/ui'\nimport {type MouseEvent, useCallback, useMemo} from 'react'\nimport {useIntentLink} from 'sanity/router'\n\nimport {Tooltip} from '../../../../../ui-components'\nimport {InsufficientPermissionsMessage} from '../../../../components'\nimport {useI18nText} from '../../../../i18n'\nimport {type NewDocumentOption, type PreviewLayout} from './types'\n\n// This value is used to calculate the max-height of the popover and for the virtual list item size.\n// This value is not used anywhere in this file, but it is exported\n// from here to make it easier to maintain the value in the future\n// if the design changes.\nexport const INLINE_PREVIEW_HEIGHT = 33\n\ninterface NewDocumentListOptionProps {\n  currentUser: CurrentUser | null\n  onClick: (option: NewDocumentOption) => void\n  option: NewDocumentOption\n  preview: PreviewLayout\n}\n\nexport function NewDocumentListOption(props: NewDocumentListOptionProps) {\n  const {option, currentUser, onClick, preview} = props\n  const params = useMemo(\n    () => ({template: option.templateId, type: option.schemaType}),\n    [option.schemaType, option.templateId],\n  )\n  const {onClick: onIntentClick, href} = useIntentLink({\n    intent: 'create',\n    params,\n  })\n\n  const handleDocumentClick = useCallback(\n    (event: MouseEvent<HTMLElement>) => {\n      onIntentClick(event)\n      onClick(option)\n    },\n    [onIntentClick, onClick, option],\n  )\n\n  const {title} = useI18nText(option)\n\n  return (\n    <Tooltip\n      disabled={option.hasPermission}\n      key={option.id}\n      portal\n      content={\n        <InsufficientPermissionsMessage currentUser={currentUser} context=\"create-document\" />\n      }\n    >\n      <div>\n        <Card\n          as={option.hasPermission ? 'a' : 'button'}\n          data-testid={`create-new-${option.templateId}`}\n          disabled={!option.hasPermission}\n          href={href}\n          marginBottom={1}\n          onClick={handleDocumentClick}\n          padding={preview === 'inline' ? 3 : 4}\n          radius={2}\n        >\n          <Text size={preview === 'inline' ? 1 : undefined}>{title}</Text>\n        </Card>\n      </div>\n    </Tooltip>\n  )\n}\n","import {type CurrentUser} from '@sanity/types'\nimport {Flex, Text} from '@sanity/ui'\nimport {useCallback} from 'react'\nimport styled from 'styled-components'\n\nimport {CommandList} from '../../../../components'\nimport {LoadingBlock} from '../../../../components/loadingBlock'\nimport {Translate, useTranslation} from '../../../../i18n'\nimport {supportsTouch} from '../../../../util'\nimport {INLINE_PREVIEW_HEIGHT, NewDocumentListOption} from './NewDocumentListOption'\nimport {type NewDocumentOption, type PreviewLayout} from './types'\n\nconst ContentFlex = styled(Flex)`\n  min-height: 100px;\n`\n\nexport interface NewDocumentListProps {\n  currentUser: CurrentUser | null\n  loading: boolean\n  onDocumentClick: () => void\n  options: NewDocumentOption[]\n  preview: PreviewLayout\n  searchQuery: string\n  textInputElement: HTMLInputElement | null\n}\n\nexport function NewDocumentList(props: NewDocumentListProps) {\n  const {currentUser, loading, onDocumentClick, options, preview, searchQuery, textInputElement} =\n    props\n  const {t} = useTranslation()\n  const hasOptions = options.length > 0 && !loading\n\n  const handleDocumentClick = useCallback(() => {\n    onDocumentClick()\n  }, [onDocumentClick])\n\n  const getItemDisabled = useCallback(\n    (index: number) => options[index]?.hasPermission === false,\n    [options],\n  )\n\n  const renderItem = useCallback(\n    (item: NewDocumentOption) => {\n      return (\n        <NewDocumentListOption\n          currentUser={currentUser}\n          key={item.id}\n          onClick={handleDocumentClick}\n          option={item}\n          preview={preview}\n        />\n      )\n    },\n    [currentUser, handleDocumentClick, preview],\n  )\n\n  // Render loading state\n  if (loading) {\n    return <LoadingBlock showText />\n  }\n\n  // Render no search results state\n  if (!hasOptions && searchQuery) {\n    return (\n      <ContentFlex\n        align=\"center\"\n        flex={1}\n        height=\"fill\"\n        justify=\"center\"\n        padding={4}\n        sizing=\"border\"\n      >\n        <Text align=\"center\" muted size={1}>\n          <Translate t={t} i18nKey=\"new-document.no-results\" values={{searchQuery}} />\n        </Text>\n      </ContentFlex>\n    )\n  }\n\n  // Render no options state\n  if (!hasOptions) {\n    return (\n      <ContentFlex\n        align=\"center\"\n        flex={1}\n        height=\"fill\"\n        justify=\"center\"\n        padding={4}\n        sizing=\"border\"\n      >\n        <Text align=\"center\" muted size={1}>\n          {t('new-document.no-document-types-found')}\n        </Text>\n      </ContentFlex>\n    )\n  }\n\n  return (\n    <CommandList\n      activeItemDataAttr=\"data-hovered\"\n      ariaLabel={t('new-document.new-document')}\n      autoFocus={supportsTouch ? undefined : 'input'}\n      getItemDisabled={getItemDisabled}\n      inputElement={textInputElement}\n      itemHeight={INLINE_PREVIEW_HEIGHT}\n      items={options}\n      overscan={5}\n      padding={preview === 'inline' ? 1 : 2}\n      paddingBottom={0}\n      renderItem={renderItem}\n    />\n  )\n}\n","import {AddIcon, SearchIcon} from '@sanity/icons'\nimport {isDeprecatedSchemaType} from '@sanity/types'\nimport {Card, Flex, Stack, Text, TextInput, type TextInputProps, useClickOutside} from '@sanity/ui'\nimport {type ChangeEvent, type KeyboardEvent, useCallback, useMemo, useState} from 'react'\nimport ReactFocusLock from 'react-focus-lock'\n\nimport {Button, type ButtonProps, Tooltip, type TooltipProps} from '../../../../../ui-components'\nimport {InsufficientPermissionsMessage} from '../../../../components'\nimport {useSchema} from '../../../../hooks'\nimport {useGetI18nText, useTranslation} from '../../../../i18n'\nimport {useCurrentUser} from '../../../../store'\nimport {useColorScheme} from '../../../colorScheme'\nimport {filterOptions} from './filter'\nimport {\n  DialogHeaderCard,\n  PopoverHeaderCard,\n  PopoverListFlex,\n  RootFlex,\n  StyledDialog,\n  StyledPopover,\n} from './NewDocumentButton.style'\nimport {NewDocumentList, type NewDocumentListProps} from './NewDocumentList'\nimport {INLINE_PREVIEW_HEIGHT} from './NewDocumentListOption'\nimport {type ModalType, type NewDocumentOption} from './types'\n\nconst MAX_DISPLAYED_ITEMS = 10\n\ninterface NewDocumentButtonProps {\n  canCreateDocument: boolean\n  loading: boolean\n  modal?: ModalType\n  options: NewDocumentOption[]\n}\n\n/**\n * @internal\n */\nexport function NewDocumentButton(props: NewDocumentButtonProps) {\n  const {canCreateDocument, modal = 'popover', loading, options} = props\n\n  const [open, setOpen] = useState<boolean>(false)\n  const [searchQuery, setSearchQuery] = useState<string>('')\n  const [popoverElement, setPopoverElement] = useState<HTMLDivElement | null>(null)\n  const [dialogElement, setDialogElement] = useState<HTMLDivElement | null>(null)\n  const [buttonElement, setButtonElement] = useState<HTMLButtonElement | null>(null)\n  const [searchInputElement, setSearchInputElement] = useState<HTMLInputElement | null>(null)\n  const {t} = useTranslation()\n  const getI18nText = useGetI18nText(options)\n\n  const {scheme} = useColorScheme()\n  const currentUser = useCurrentUser()\n  const schema = useSchema()\n\n  const hasNewDocumentOptions = options.length > 0\n  const disabled = !canCreateDocument || !hasNewDocumentOptions\n  const placeholder = t('new-document.filter-placeholder')\n  const title = t('new-document.title')\n  const openDialogAriaLabel = t('new-document.open-dialog-aria-label')\n\n  const validOptions = useMemo(\n    () =>\n      options.filter((option) => {\n        const optionSchema = schema.get(option.schemaType)\n        return optionSchema && !isDeprecatedSchemaType(optionSchema)\n      }),\n    [options, schema],\n  )\n\n  // Filter options based on search query\n  const filteredOptions = useMemo(\n    () => filterOptions(validOptions, searchQuery, getI18nText),\n    [validOptions, searchQuery, getI18nText],\n  )\n\n  const handleSearchChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    setSearchQuery(event.currentTarget.value)\n  }, [])\n\n  const handleToggleOpen = useCallback(() => setOpen((v) => !v), [])\n\n  const handleClose = useCallback(() => {\n    setOpen(false)\n    setSearchQuery('')\n    buttonElement?.focus()\n  }, [buttonElement])\n\n  // Open popover on arrow down\n  const handleOpenButtonKeyDown = useCallback(\n    (e: KeyboardEvent<HTMLButtonElement>) => {\n      if (e.key === 'ArrowDown' && !open) {\n        setOpen(true)\n      }\n    },\n    [open],\n  )\n\n  // Close popover on escape or tab\n  const handlePopoverKeyDown = useCallback(\n    (e: KeyboardEvent<HTMLDivElement>) => {\n      if ((e.key === 'Escape' || e.key === 'Tab') && open) {\n        handleClose()\n      }\n    },\n    [handleClose, open],\n  )\n\n  // Close popover on click outside\n  useClickOutside(() => {\n    if (open) {\n      handleClose()\n    }\n  }, [buttonElement, dialogElement, popoverElement])\n\n  const sharedListProps: NewDocumentListProps = useMemo(\n    () => ({\n      currentUser,\n      loading: loading,\n      onDocumentClick: handleToggleOpen,\n      options: filteredOptions,\n      searchQuery: searchQuery,\n      preview: modal === 'popover' ? 'inline' : 'default',\n      textInputElement: searchInputElement,\n    }),\n    [\n      currentUser,\n      filteredOptions,\n      handleToggleOpen,\n      loading,\n      modal,\n      searchInputElement,\n      searchQuery,\n    ],\n  )\n\n  // Shared text input props for the popover and dialog\n  const sharedTextInputProps: TextInputProps = useMemo(\n    () => ({\n      __unstable_disableFocusRing: true,\n      border: false,\n      'data-testid': 'new-document-button-search-input',\n      defaultValue: searchQuery,\n      disabled: loading,\n      icon: SearchIcon,\n      onChange: handleSearchChange,\n      placeholder: placeholder,\n      ref: setSearchInputElement,\n    }),\n    [handleSearchChange, loading, placeholder, searchQuery],\n  )\n\n  // Shared open button props for the popover and dialog\n  const sharedOpenButtonProps: ButtonProps = useMemo(\n    () => ({\n      'aria-label': openDialogAriaLabel,\n      'data-testid': 'new-document-button',\n      disabled: disabled || loading,\n      icon: AddIcon,\n      text: t('new-document.button'),\n      mode: 'ghost',\n      onClick: handleToggleOpen,\n      ref: setButtonElement,\n      selected: open,\n    }),\n    [disabled, handleToggleOpen, loading, open, openDialogAriaLabel, t],\n  )\n\n  // Tooltip content for the open button\n  const tooltipContent: TooltipProps['content'] = useMemo(() => {\n    if (!hasNewDocumentOptions) {\n      return <Text size={1}>{t('new-document.no-document-types-label')}</Text>\n    }\n\n    if (canCreateDocument) {\n      return <Text size={1}>{t('new-document.create-new-document-label')}</Text>\n    }\n\n    return (\n      <InsufficientPermissionsMessage currentUser={currentUser} context=\"create-any-document\" />\n    )\n  }, [canCreateDocument, currentUser, hasNewDocumentOptions, t])\n\n  // Shared tooltip props for the popover and dialog\n  const sharedTooltipProps: TooltipProps = useMemo(\n    () => ({\n      content: tooltipContent,\n      disabled: loading || open,\n      scheme: scheme,\n    }),\n    [loading, open, scheme, tooltipContent],\n  )\n\n  // Dialog\n  if (modal === 'dialog') {\n    return (\n      <>\n        <Tooltip {...sharedTooltipProps}>\n          <div>\n            <Button {...sharedOpenButtonProps} />\n          </div>\n        </Tooltip>\n\n        {open && (\n          <StyledDialog\n            header={title}\n            id=\"create-new-document-dialog\"\n            onClickOutside={handleClose}\n            onClose={handleClose}\n            ref={setDialogElement}\n            scheme={scheme}\n            width={1}\n          >\n            <RootFlex direction=\"column\" flex={1} height=\"fill\">\n              <DialogHeaderCard padding={2} borderBottom>\n                <TextInput\n                  data-testid=\"new-document-button-search-input\"\n                  {...sharedTextInputProps}\n                />\n              </DialogHeaderCard>\n\n              <Flex direction=\"column\" overflow=\"hidden\">\n                <NewDocumentList {...sharedListProps} />\n              </Flex>\n            </RootFlex>\n          </StyledDialog>\n        )}\n      </>\n    )\n  }\n\n  // Popover\n  return (\n    <StyledPopover\n      constrainSize\n      onKeyDown={handlePopoverKeyDown}\n      open={open}\n      portal\n      radius={3}\n      ref={setPopoverElement}\n      scheme={scheme}\n      content={\n        <RootFlex\n          direction=\"column\"\n          flex={1}\n          forwardedAs={ReactFocusLock}\n          height=\"fill\"\n          returnFocus\n        >\n          <PopoverHeaderCard sizing=\"border\">\n            <Stack>\n              <Card borderBottom padding={1}>\n                <TextInput {...sharedTextInputProps} fontSize={1} radius={1} />\n              </Card>\n            </Stack>\n          </PopoverHeaderCard>\n\n          <PopoverListFlex\n            $itemHeight={INLINE_PREVIEW_HEIGHT}\n            $maxDisplayedItems={MAX_DISPLAYED_ITEMS}\n            direction=\"column\"\n            overflow=\"hidden\"\n          >\n            <NewDocumentList {...sharedListProps} />\n          </PopoverListFlex>\n        </RootFlex>\n      }\n    >\n      <div>\n        <Tooltip {...sharedTooltipProps}>\n          <div>\n            <Button\n              {...sharedOpenButtonProps}\n              aria-expanded={open}\n              aria-haspopup=\"true\"\n              onKeyDown={handleOpenButtonKeyDown}\n            />\n          </div>\n        </Tooltip>\n      </div>\n    </StyledPopover>\n  )\n}\n","import {useMemo} from 'react'\n\nimport {useTemplatePermissions} from '../../../../store'\nimport {useSource} from '../../../source'\nimport {type NewDocumentOption} from './types'\n\ninterface NewDocumentOptionsValue {\n  canCreateDocument: boolean\n  loading: boolean\n  options: NewDocumentOption[]\n}\n\n/**\n * @internal\n */\nexport function useNewDocumentOptions(): NewDocumentOptionsValue {\n  const {\n    __internal: {staticInitialValueTemplateItems},\n  } = useSource()\n\n  const [permissions, loading] = useTemplatePermissions({\n    templateItems: staticInitialValueTemplateItems,\n  })\n\n  const canCreateDocument =\n    permissions?.some((p) => staticInitialValueTemplateItems.some((t) => t.id === p.id)) || false\n\n  const optionsWithPermissions = useMemo(() => {\n    return staticInitialValueTemplateItems.map((item) => {\n      return {\n        ...item,\n        title: item?.title || item.id,\n        hasPermission: permissions?.find((p) => p.id === item.id)?.granted || false,\n      }\n    })\n  }, [permissions, staticInitialValueTemplateItems])\n\n  return {\n    canCreateDocument,\n    loading,\n    options: optionsWithPermissions,\n  }\n}\n","import * as PathUtils from '@sanity/util/paths'\nimport {orderBy} from 'lodash'\nimport {type ForwardedRef, forwardRef, memo, useCallback, useEffect, useMemo, useState} from 'react'\nimport {IntentLink} from 'sanity/router'\n\nimport {MenuItem} from '../../../../../ui-components'\nimport {UserAvatar} from '../../../../components'\nimport {useTranslation} from '../../../../i18n'\nimport {type GlobalPresence} from '../../../../store'\n\ninterface PresenceListRowProps {\n  focused: boolean\n  onFocus: (id: string) => void\n  presence: GlobalPresence\n}\n\nexport const PresenceMenuItem = memo(function PresenceMenuItem(props: PresenceListRowProps) {\n  const {presence, focused, onFocus} = props\n  const [menuItemElement, setMenuItemElement] = useState<HTMLElement | null>(null)\n  const {t} = useTranslation()\n\n  const lastActiveLocation = orderBy(presence.locations || [], ['lastActiveAt'], ['desc']).find(\n    (location) => location.documentId,\n  )\n  const hasLink = Boolean(lastActiveLocation?.documentId)\n\n  /**\n   * This is a workaround to keep focus on the selected menu item\n   * when the list of users in the menu is updated\n   */\n  useEffect(() => {\n    if (focused && menuItemElement) {\n      menuItemElement.focus()\n      menuItemElement.setAttribute('data-selected', '')\n    }\n\n    if (!focused) {\n      menuItemElement?.removeAttribute('data-selected')\n    }\n  }, [menuItemElement, focused])\n\n  const handleFocus = useCallback(() => {\n    onFocus(presence.user.id)\n  }, [onFocus, presence.user.id])\n\n  const LinkComponent = useMemo(\n    () =>\n      // eslint-disable-next-line @typescript-eslint/no-shadow\n      forwardRef(function LinkComponent(linkProps, ref: ForwardedRef<HTMLAnchorElement>) {\n        if (!lastActiveLocation?.path) return null\n\n        return (\n          <IntentLink\n            {...linkProps}\n            intent=\"edit\"\n            params={{\n              id: lastActiveLocation?.documentId,\n              path: PathUtils.toString(lastActiveLocation?.path),\n            }}\n            ref={ref}\n          />\n        )\n      }),\n    [lastActiveLocation],\n  )\n\n  return (\n    <MenuItem\n      as={lastActiveLocation ? LinkComponent : 'div'}\n      data-as=\"a\"\n      disabled={!hasLink}\n      onFocus={handleFocus}\n      preview={<UserAvatar key={presence.user.id} size={1} user={presence.user} />}\n      ref={setMenuItemElement}\n      text={presence.user.displayName}\n      tooltipProps={\n        hasLink ? undefined : {content: t('presence.not-in-a-document'), placement: 'left'}\n      }\n    />\n  )\n})\n","import {CogIcon, UsersIcon} from '@sanity/icons'\nimport {Box, Menu, MenuDivider, Stack, Text} from '@sanity/ui'\nimport {useCallback, useMemo, useState} from 'react'\nimport styled from 'styled-components'\n\nimport {MenuButton, type MenuButtonProps, MenuItem} from '../../../../../ui-components'\nimport {StatusButton} from '../../../../components'\nimport {useTranslation} from '../../../../i18n'\nimport {useGlobalPresence} from '../../../../store'\nimport {useColorScheme} from '../../../colorScheme'\nimport {useWorkspace} from '../../../workspace'\nimport {PresenceMenuItem} from './PresenceMenuItem'\n\nconst StyledMenu = styled(Menu)`\n  max-width: 260px;\n`\n\nconst FooterStack = styled(Stack)`\n  position: sticky;\n  bottom: 0;\n  background-color: var(--card-bg-color);\n`\n\nexport function PresenceMenu() {\n  const presence = useGlobalPresence()\n  const {projectId} = useWorkspace()\n  const {scheme} = useColorScheme()\n  const {t} = useTranslation()\n  const hasPresence = presence.length > 0\n\n  /**\n   * This id is used as a workaround to keep focus on the selected menu item\n   * when the list of users in the menu is updated\n   */\n  const [focusedId, setFocusedId] = useState<string>()\n\n  const handleItemFocus = useCallback((id: string) => {\n    setFocusedId(id)\n  }, [])\n\n  const handleClearFocusedItem = useCallback(() => {\n    setFocusedId('')\n  }, [])\n\n  const handleClose = useCallback(() => {\n    setFocusedId('')\n  }, [])\n\n  const button = useMemo(() => {\n    return (\n      <StatusButton\n        icon={UsersIcon}\n        mode=\"bleed\"\n        tone={hasPresence ? 'positive' : undefined}\n        tooltipProps={{\n          content: t('presence.tooltip-content'),\n        }}\n      />\n    )\n  }, [hasPresence, t])\n\n  const popoverProps = useMemo(\n    (): MenuButtonProps['popover'] => ({\n      constrainSize: true,\n      fallbackPlacements: ['bottom'],\n      placement: 'bottom',\n      portal: true,\n      scheme: scheme,\n    }),\n    [scheme],\n  )\n\n  return (\n    <MenuButton\n      button={button}\n      aria-label={t('presence.aria-label')}\n      id=\"global-presence-menu\"\n      menu={\n        <StyledMenu>\n          {hasPresence &&\n            presence.map((item) => (\n              <PresenceMenuItem\n                focused={focusedId === item.user.id}\n                key={item.user.id}\n                onFocus={handleItemFocus}\n                presence={item}\n              />\n            ))}\n\n          {!hasPresence && (\n            <Box padding={3}>\n              <Stack space={3}>\n                <Text weight=\"medium\" size={1}>\n                  {t('presence.no-one-else-title')}\n                </Text>\n\n                <Text size={1} muted>\n                  {t('presence.no-one-else-description')}\n                </Text>\n              </Stack>\n            </Box>\n          )}\n\n          <FooterStack space={1}>\n            <MenuDivider />\n\n            <MenuItem\n              as=\"a\"\n              href={`https://sanity.io/manage/project/${projectId}`}\n              iconRight={CogIcon}\n              onFocus={handleClearFocusedItem}\n              rel=\"noopener noreferrer\"\n              target=\"_blank\"\n              text={t('presence.action.manage-members')}\n            />\n          </FooterStack>\n        </StyledMenu>\n      }\n      onClose={handleClose}\n      popover={popoverProps}\n    />\n  )\n}\n","import {type SanityClient} from '@sanity/client'\nimport {type Observable} from 'rxjs'\n\nimport {SANITY_VERSION} from '../../../../../version'\nimport {type ResourcesResponse} from './types'\n\n/**\n * @internal Not a stable API yet\n * @hidden\n */\nexport function getHelpResources(\n  client: SanityClient,\n  locale: string,\n): Observable<ResourcesResponse> {\n  return client.withConfig({apiVersion: '1'}).observable.request<ResourcesResponse>({\n    url: '/help',\n    /*\n      query and tag is used by analytics for tracking.\n      Builds to: `{m: ['sanity@3.0.2']}' and serializes to: `?m=sanity@3.0.2`.\n      Final format will be e.g. https://api.sanity.io/v1/help?tag=sanity.studio.module.version-check&m=sanity%403.0.2\n      */\n    query: {m: [`sanity@${SANITY_VERSION}`], locale},\n    tag: 'module.version-check',\n    json: true,\n  })\n}\n","import {useMemo} from 'react'\n\nimport {useClient} from '../../../../../hooks'\nimport {useCurrentLocale} from '../../../../../i18n/hooks/useLocale'\nimport {type LoadableState, useLoadable} from '../../../../../util'\nimport {getHelpResources} from './helpResources'\nimport {type ResourcesResponse} from './types'\n\n/**\n * Fetch help resources (content for the navbar help menu) from `/help`.\n *\n * @internal\n * @hidden\n */\nexport function useGetHelpResources(): LoadableState<ResourcesResponse | undefined> {\n  const client = useClient({apiVersion: '1'})\n  const locale = useCurrentLocale().id\n\n  const moduleStatus$ = useMemo(() => getHelpResources(client, locale), [client, locale])\n\n  return useLoadable(moduleStatus$)\n}\n","import {Box, MenuDivider, Text} from '@sanity/ui'\n\nimport {MenuItem} from '../../../../../ui-components'\nimport {LoadingBlock} from '../../../../components/loadingBlock'\nimport {useTranslation} from '../../../../i18n'\nimport {SANITY_VERSION} from '../../../../version'\nimport {type ResourcesResponse, type Section} from './helper-functions/types'\n\ninterface ResourcesMenuItemProps {\n  error: Error | null\n  isLoading: boolean\n  value?: ResourcesResponse\n}\n\nexport function ResourcesMenuItems({error, isLoading, value}: ResourcesMenuItemProps) {\n  const sections = value?.resources?.sectionArray\n  const latestStudioVersion = value?.latestVersion\n  const {t} = useTranslation()\n\n  if (isLoading) {\n    return <LoadingBlock showText />\n  }\n\n  const fallbackLinks = (\n    <>\n      <MenuItem\n        as=\"a\"\n        text={t('help-resources.action.join-our-community')}\n        href=\"https://www.sanity.io/exchange/community\"\n        target=\"_blank\"\n      />\n      <MenuItem\n        as=\"a\"\n        text={t('help-resources.action.help-and-support')}\n        href=\"https://www.sanity.io/contact/support\"\n        target=\"_blank\"\n      />\n      <MenuItem\n        as=\"a\"\n        text={t('help-resources.action.contact-sales')}\n        href=\"https://www.sanity.io/contact/sales?ref=studio\"\n        target=\"_blank\"\n      />\n      <MenuDivider />\n    </>\n  )\n\n  return (\n    <>\n      {/* Display fallback values on error / no response */}\n      {(value === undefined || error) && <div>{fallbackLinks}</div>}\n\n      {!error &&\n        sections?.map((subSection) => {\n          if (!subSection) return null\n          return <SubSection key={subSection._key} subSection={subSection} />\n        })}\n\n      {/* Studio version information */}\n      <Box padding={3}>\n        <Text size={1} muted weight=\"medium\" textOverflow=\"ellipsis\">\n          {t('help-resources.studio-version', {studioVersion: SANITY_VERSION})}\n        </Text>\n        {!error && latestStudioVersion && (\n          <Box paddingTop={2}>\n            <Text size={1} muted textOverflow=\"ellipsis\">\n              {t('help-resources.latest-sanity-version', {\n                latestVersion: latestStudioVersion,\n              })}\n            </Text>\n          </Box>\n        )}\n      </Box>\n    </>\n  )\n}\n\nfunction SubSection({subSection}: {subSection: Section}) {\n  return (\n    <>\n      {subSection?.items?.map((item) => {\n        if (!item || !item.title) return null\n        switch (item._type) {\n          case 'externalLink':\n            if (!item.url) return null\n            return (\n              <MenuItem\n                as=\"a\"\n                tone=\"default\"\n                key={item._key}\n                text={item.title}\n                href={item.url}\n                target=\"_blank\"\n              />\n            )\n          case 'internalAction': // TODO: Add support for internal actions (MVI-2)\n            if (!item.type) return null\n            return (\n              item.type === 'show-welcome-modal' && <MenuItem key={item._key} text={item.title} />\n            )\n\n          default:\n            return null\n        }\n      })}\n      <MenuDivider />\n    </>\n  )\n}\n","import {HelpCircleIcon} from '@sanity/icons'\nimport {Menu} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {Button, MenuButton} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {useGetHelpResources} from './helper-functions/hooks'\nimport {ResourcesMenuItems} from './ResourcesMenuItems'\n\nconst StyledMenu = styled(Menu)`\n  max-width: 300px;\n  min-width: 200px;\n`\n\nexport function ResourcesButton() {\n  const {t} = useTranslation()\n\n  const {value, error, isLoading} = useGetHelpResources()\n\n  return (\n    <MenuButton\n      button={\n        <Button\n          aria-label={t('help-resources.title')}\n          icon={HelpCircleIcon}\n          mode=\"bleed\"\n          tooltipProps={{content: t('help-resources.title')}}\n        />\n      }\n      id=\"menu-button-resources\"\n      menu={\n        <StyledMenu>\n          <ResourcesMenuItems error={error} isLoading={isLoading} value={value} />\n        </StyledMenu>\n      }\n      popover={{constrainSize: true}}\n    />\n  )\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {MenuDivider} from '@sanity/ui'\nimport {useCallback} from 'react'\n\nimport {MenuItem} from '../../../../../ui-components'\nimport {useLocale} from '../../../../i18n/hooks/useLocale'\n\n// TODO: re-enable locale selection once schema localization is available\nconst LOCALE_SELECTION_DISABLED = true\n\nexport function LocaleMenu() {\n  const {changeLocale, currentLocale, locales} = useLocale()\n\n  if (LOCALE_SELECTION_DISABLED) {\n    return null\n  }\n\n  if (!locales || locales.length < 2) {\n    return null\n  }\n\n  return (\n    <>\n      <MenuDivider />\n\n      {locales.map((item) => (\n        <LocaleItem\n          key={item.id}\n          locale={item}\n          changeLocale={changeLocale}\n          selectedLocale={currentLocale.id}\n        />\n      ))}\n    </>\n  )\n}\n\nfunction LocaleItem(props: {\n  locale: {id: string; title: string}\n  changeLocale: (lang: string) => void\n  selectedLocale: string\n}) {\n  const {locale, changeLocale, selectedLocale: selectedLang} = props\n  const localeId = locale.id\n  const onClick = useCallback(() => changeLocale(localeId), [localeId, changeLocale])\n  const selected = selectedLang == localeId\n\n  return (\n    <MenuItem\n      aria-label={locale.title}\n      pressed={selected}\n      iconRight={selected && <CheckmarkIcon />}\n      onClick={onClick}\n      text={locale.title}\n    />\n  )\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {MenuDivider} from '@sanity/ui'\n\nimport {MenuItem} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {type StudioThemeColorSchemeKey} from '../../../../theme'\nimport {useColorSchemeOptions} from '../../../colorScheme'\n\nexport function AppearanceMenu({\n  setScheme,\n}: {\n  setScheme: (nextScheme: StudioThemeColorSchemeKey) => void\n}) {\n  const {t} = useTranslation()\n  // Subscribe to just what we need, if the menu isn't shown then we're not subscribed to these contexts\n  const options = useColorSchemeOptions(setScheme, t)\n\n  return (\n    <>\n      <MenuDivider />\n\n      {options.map(({icon, label, name, onSelect, selected, title}) => (\n        <MenuItem\n          key={name}\n          aria-label={label}\n          icon={icon}\n          onClick={onSelect}\n          pressed={selected}\n          text={title}\n          iconRight={selected && <CheckmarkIcon />}\n        />\n      ))}\n    </>\n  )\n}\n","import {SanityMonogram} from '@sanity/logos'\nimport styled from 'styled-components'\n\nconst Root = styled.div`\n  position: absolute;\n  width: 18px;\n  height: 18px;\n  background: var(--card-bg-color);\n  bottom: -4px;\n  right: -4px;\n  border-radius: 50%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 1px solid var(--card-bg-color);\n  box-sizing: content-box;\n\n  svg {\n    box-sizing: content-box;\n    border: 1px solid var(--card-hairline-soft-color);\n    border-radius: 50%;\n    padding: 2px;\n    width: 12px;\n    height: 12px;\n  }\n\n  &[data-logo='github'] {\n    svg {\n      path {\n        fill: var(--card-fg-color);\n      }\n    }\n  }\n\n  &[data-logo='saml'] {\n    svg {\n      path {\n        fill: var(--card-fg-color);\n      }\n    }\n  }\n`\n\nconst Google = (\n  <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <g clipPath=\"url(#clip0)\">\n      <path\n        d=\"M12 6.13764C12 5.72977 11.9663 5.31971 11.8943 4.91846H6.12036V7.22895H9.42684C9.28963 7.97412 8.84876 8.63332 8.20322 9.05221V10.5514H10.1759C11.3342 9.50637 12 7.9631 12 6.13764Z\"\n        fill=\"#4285F4\"\n      />\n      <path\n        d=\"M6.12019 12.0002C7.77118 12.0002 9.16349 11.4688 10.1779 10.5517L8.20529 9.05253C7.65646 9.41851 6.94793 9.62574 6.12244 9.62574C4.52544 9.62574 3.17136 8.56971 2.68552 7.1499H0.649902V8.69537C1.68908 10.7215 3.80567 12.0002 6.12019 12.0002V12.0002Z\"\n        fill=\"#34A853\"\n      />\n      <path\n        d=\"M2.68332 7.14986C2.4269 6.40469 2.4269 5.59778 2.68332 4.8526V3.30713H0.649951C-0.218278 5.00252 -0.218278 6.99995 0.649951 8.69533L2.68332 7.14986V7.14986Z\"\n        fill=\"#FBBC04\"\n      />\n      <path\n        d=\"M6.12019 2.37483C6.99291 2.3616 7.8364 2.68348 8.46845 3.27433L10.2161 1.56131C9.1095 0.542752 7.64071 -0.017233 6.12019 0.000404333C3.80566 0.000404333 1.68908 1.27911 0.649902 3.3074L2.68326 4.85288C3.16686 3.43087 4.52319 2.37483 6.12019 2.37483V2.37483Z\"\n        fill=\"#EA4335\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0\">\n        <rect width=\"12\" height=\"12\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n)\n\nconst GitHub = (\n  <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <g clipPath=\"url(#clip0)\">\n      <path\n        d=\"M11.195 3.13503C10.6711 2.22838 9.91808 1.47537 9.01144 0.951471C8.09222 0.414976 7.08837 0.146729 5.99987 0.146729C4.91137 0.146729 3.90752 0.414976 2.98831 0.951471C2.08163 1.47534 1.32862 2.22836 0.804744 3.13503C0.268248 4.05497 0 5.05883 0 6.14659C0 7.45399 0.381531 8.62978 1.14459 9.67394C1.90765 10.7181 2.89327 11.4408 4.10143 11.8419C4.24208 11.868 4.34624 11.8497 4.41392 11.7872C4.44666 11.7577 4.47263 11.7215 4.49006 11.681C4.50749 11.6405 4.51595 11.5967 4.51488 11.5527C4.51488 11.537 4.51361 11.3963 4.51105 11.1307C4.5085 10.8651 4.50722 10.6334 4.50722 10.4355L4.32745 10.4666C4.18407 10.4895 4.03885 10.4986 3.89375 10.494C3.71159 10.4908 3.53001 10.4725 3.35087 10.4393C3.16049 10.4045 2.98119 10.3246 2.82796 10.2064C2.66705 10.0846 2.54715 9.91661 2.48428 9.72484L2.40602 9.54506C2.34022 9.40286 2.25754 9.2691 2.15976 9.14666C2.04775 9.00072 1.93447 8.90176 1.81991 8.84977L1.76518 8.81064C1.72769 8.78356 1.6936 8.75205 1.66367 8.71679C1.63479 8.6841 1.61108 8.64719 1.59334 8.60734C1.57766 8.57085 1.5907 8.54085 1.63247 8.51731C1.67461 8.49405 1.75123 8.48256 1.86068 8.48256L2.01692 8.50582C2.12108 8.52662 2.24996 8.5891 2.40356 8.69326C2.5585 8.79876 2.68797 8.93748 2.78254 9.09932C2.90239 9.31294 3.04695 9.47575 3.21624 9.58775C3.38552 9.69976 3.55609 9.75576 3.72793 9.75576C3.87725 9.7578 4.02641 9.74479 4.17312 9.7169C4.29459 9.69195 4.41264 9.65254 4.52473 9.59952C4.57162 9.25037 4.69931 8.98212 4.90782 8.79477C4.63684 8.76849 4.36827 8.72157 4.10444 8.6544C3.84797 8.58382 3.60133 8.48141 3.37029 8.34958C3.12825 8.218 2.91442 8.04015 2.74095 7.82613C2.57421 7.6178 2.4374 7.34417 2.3305 7.00524C2.2236 6.6663 2.1707 6.27584 2.1718 5.83383C2.1718 5.20357 2.37757 4.66708 2.7891 4.22435C2.59629 3.75006 2.61453 3.21885 2.84383 2.63073C2.99487 2.58385 3.21879 2.61897 3.51559 2.73608C3.81239 2.85319 4.02983 2.95352 4.16792 3.03707C4.30601 3.12025 4.41665 3.19058 4.49983 3.24804C5.48153 2.9773 6.51821 2.9773 7.49991 3.24804L7.79679 3.0606C8.0249 2.92356 8.26549 2.80849 8.51535 2.71693C8.79135 2.61276 9.00231 2.58412 9.14825 2.63101C9.38248 3.21949 9.40327 3.7507 9.21064 4.22462C9.62199 4.66735 9.82776 5.20385 9.82795 5.83411C9.82795 6.27684 9.77459 6.66904 9.66787 7.01071C9.56116 7.35238 9.42325 7.62601 9.25415 7.8316C9.07785 8.04326 8.86311 8.21966 8.62124 8.35149C8.39008 8.48329 8.14337 8.5857 7.88682 8.65632C7.62412 8.72277 7.35674 8.76915 7.087 8.79505C7.35698 9.02927 7.49206 9.3994 7.49225 9.90543V11.5527C7.49115 11.5964 7.49929 11.6398 7.51612 11.6802C7.53295 11.7206 7.5581 11.7569 7.58993 11.7869C7.65505 11.8493 7.75794 11.8675 7.89858 11.8416C9.10693 11.4403 10.0926 10.7177 10.8557 9.67367C11.6188 8.62968 12.0003 7.4539 12.0003 6.14632C11.9997 5.05873 11.7313 4.05497 11.195 3.13503V3.13503Z\"\n        fill=\"black\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0\">\n        <rect width=\"12\" height=\"12\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n)\n\nconst Saml = (\n  <svg width=\"17\" height=\"9\" viewBox=\"0 0 17 9\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M0.0691681 5.98162C0.115833 7.24157 1.07247 8.00221 2.59841 8.00221C4.17102 8.00221 5.12299 7.19957 5.12299 5.86962C5.12299 4.83832 4.55367 4.25501 3.25172 3.96569L2.56108 3.80703C1.8331 3.64837 1.53445 3.38704 1.53445 2.91106C1.53445 2.40708 1.94977 2.09442 2.61708 2.09442C3.27505 2.09442 3.6997 2.43508 3.75103 2.99039H5.00166C4.95966 1.78643 4.01236 0.997795 2.60308 0.997795C1.14713 0.997795 0.218496 1.79577 0.218496 3.05105C0.218496 4.04968 0.815808 4.69366 2.03376 4.96898L2.73374 5.13231C3.51304 5.30497 3.8117 5.54763 3.8117 6.00495C3.8117 6.55093 3.34972 6.90092 2.62174 6.90092C1.85644 6.90092 1.38045 6.56493 1.31979 5.98162H0.0691681Z\" />\n    <path d=\"M5.97695 5.98162C6.02362 7.24157 6.98025 8.00221 8.5062 8.00221C10.0788 8.00221 11.0308 7.19957 11.0308 5.86962C11.0308 4.83832 10.4615 4.25501 9.15951 3.96569L8.46886 3.80703C7.74089 3.64837 7.44223 3.38704 7.44223 2.91106C7.44223 2.40708 7.85755 2.09442 8.52486 2.09442C9.18284 2.09442 9.60749 2.43508 9.65882 2.99039H10.9094C10.8674 1.78643 9.92015 0.997795 8.51086 0.997795C7.05492 0.997795 6.12628 1.79577 6.12628 3.05105C6.12628 4.04968 6.72359 4.69366 7.94155 4.96898L8.64153 5.13231C9.42083 5.30497 9.71949 5.54763 9.71949 6.00495C9.71949 6.55093 9.2575 6.90092 8.52953 6.90092C7.76422 6.90092 7.28824 6.56493 7.22758 5.98162H5.97695Z\" />\n    <path d=\"M16.9852 5.01565V3.98435C16.9852 2.11309 16.0099 0.997795 14.3953 0.997795C12.7807 0.997795 11.8054 2.11309 11.8054 3.98435V5.01565C11.8054 6.88692 12.7807 8.00221 14.3953 8.00221C16.0099 8.00221 16.9852 6.88692 16.9852 5.01565ZM14.3953 6.82625C13.5833 6.82625 13.154 6.21494 13.154 5.00165V3.99835C13.154 2.78506 13.5833 2.17375 14.3953 2.17375C15.2073 2.17375 15.6366 2.78506 15.6366 3.99835V5.00165C15.6366 6.21494 15.2073 6.82625 14.3953 6.82625Z\" />\n  </svg>\n)\n\ninterface Props {\n  provider: string | undefined\n}\n\nexport const LoginProviderLogo = ({provider}: Props) => {\n  const isSaml = provider?.startsWith('saml-')\n  const logoName = isSaml ? 'saml' : provider\n\n  return (\n    <Root data-logo={logoName}>\n      {provider === 'google' && Google}\n      {provider === 'github' && GitHub}\n      {provider === 'sanity' && <SanityMonogram />}\n      {isSaml && Saml}\n    </Root>\n  )\n}\n","import {CogIcon, UsersIcon} from '@sanity/icons'\nimport {MenuDivider} from '@sanity/ui'\n\nimport {MenuItem} from '../../../../../ui-components'\nimport {useTranslation} from '../../../../i18n'\nimport {userHasRole} from '../../../../util'\nimport {useWorkspace} from '../../../workspace'\n\nexport function ManageMenu() {\n  const {currentUser, projectId} = useWorkspace()\n  const isAdmin = Boolean(currentUser && userHasRole(currentUser, 'administrator'))\n\n  const {t} = useTranslation()\n\n  return (\n    <>\n      <MenuDivider />\n      <MenuItem\n        as=\"a\"\n        aria-label={t('user-menu.action.manage-project-aria-label')}\n        href={`https://sanity.io/manage/project/${projectId}`}\n        target=\"_blank\"\n        text={t('user-menu.action.manage-project')}\n        icon={CogIcon}\n      />\n      {isAdmin && (\n        <MenuItem\n          as=\"a\"\n          aria-label={t('user-menu.action.invite-members-aria-label')}\n          href={`https://sanity.io/manage/project/${projectId}/members`}\n          target=\"_blank\"\n          text={t('user-menu.action.invite-members')}\n          icon={UsersIcon}\n        />\n      )}\n    </>\n  )\n}\n","import {LeaveIcon} from '@sanity/icons'\nimport {\n  Box,\n  // eslint-disable-next-line no-restricted-imports\n  Button, // Button with specific styling, user avatar .\n  Card,\n  Flex,\n  Menu,\n  MenuDivider,\n  Stack,\n  Text,\n} from '@sanity/ui'\nimport {useMemo} from 'react'\nimport styled from 'styled-components'\n\nimport {MenuButton, type MenuButtonProps, MenuItem, Tooltip} from '../../../../../ui-components'\nimport {UserAvatar} from '../../../../components'\nimport {useTranslation} from '../../../../i18n'\nimport {getProviderTitle} from '../../../../store'\nimport {useColorSchemeSetValue, useColorSchemeValue} from '../../../colorScheme'\nimport {useWorkspace} from '../../../workspace'\nimport {AppearanceMenu} from './ApperanceMenu'\nimport {LocaleMenu} from './LocaleMenu'\nimport {LoginProviderLogo} from './LoginProviderLogo'\nimport {ManageMenu} from './ManageMenu'\n\nconst StyledMenu = styled(Menu)`\n  min-width: 200px;\n  max-width: 300px;\n`\n\nconst AvatarBox = styled(Box)`\n  position: relative;\n  min-width: ${({theme}) => theme.sanity.avatar.sizes[2].size}px;\n  min-height: ${({theme}) => theme.sanity.avatar.sizes[2].size}px;\n`\n\nexport function UserMenu() {\n  const {currentUser, auth} = useWorkspace()\n  const scheme = useColorSchemeValue()\n  const setScheme = useColorSchemeSetValue()\n\n  const providerTitle = getProviderTitle(currentUser?.provider)\n\n  const {t} = useTranslation()\n\n  const popoverProps: MenuButtonProps['popover'] = useMemo(\n    () => ({\n      placement: 'bottom',\n      portal: true,\n      preventOverflow: true,\n      scheme: scheme,\n      constrainSize: true,\n    }),\n    [scheme],\n  )\n\n  return (\n    <MenuButton\n      button={\n        <Button mode=\"bleed\" padding={0} radius=\"full\">\n          <UserAvatar size={1} user=\"me\" />\n        </Button>\n      }\n      id=\"user-menu\"\n      menu={\n        <StyledMenu>\n          <Card padding={2}>\n            <Flex align=\"center\">\n              <Tooltip\n                disabled={!providerTitle}\n                portal\n                content={t('user-menu.login-provider', {providerTitle})}\n              >\n                <AvatarBox marginRight={3}>\n                  <UserAvatar size={2} user=\"me\" />\n                  {currentUser?.provider && <LoginProviderLogo provider={currentUser.provider} />}\n                </AvatarBox>\n              </Tooltip>\n\n              <Stack space={2} flex={1}>\n                <Text size={1} weight=\"medium\" textOverflow=\"ellipsis\">\n                  {currentUser?.name}\n                </Text>\n\n                <Text size={1} muted textOverflow=\"ellipsis\">\n                  {currentUser?.email}\n                </Text>\n              </Stack>\n            </Flex>\n          </Card>\n\n          {setScheme && <AppearanceMenu setScheme={setScheme} />}\n          <LocaleMenu />\n          <ManageMenu />\n\n          {auth.logout && (\n            <>\n              <MenuDivider />\n              <MenuItem\n                iconRight={LeaveIcon}\n                text={t('user-menu.action.sign-out')}\n                disabled={!auth.logout}\n                {...(auth.logout && {onClick: auth.logout})}\n              />\n            </>\n          )}\n        </StyledMenu>\n      }\n      popover={popoverProps}\n    />\n  )\n}\n","import {MenuIcon} from '@sanity/icons'\nimport {\n  BoundaryElementProvider,\n  Box,\n  Card,\n  Flex,\n  Grid,\n  Layer,\n  LayerProvider,\n  PortalProvider,\n  useMediaIndex,\n} from '@sanity/ui'\nimport {useCallback, useContext, useEffect, useMemo, useRef, useState} from 'react'\nimport {type RouterState, useRouterState} from 'sanity/router'\nimport styled from 'styled-components'\n\nimport {Button, TooltipDelayGroupProvider} from '../../../../ui-components'\nimport {type NavbarProps} from '../../../config/studio/types'\nimport {isDev} from '../../../environment'\nimport {useTranslation} from '../../../i18n'\nimport {useToolMenuComponent} from '../../studio-components-hooks'\nimport {NavbarContext} from '../../StudioLayout'\nimport {useWorkspace} from '../../workspace'\nimport {ConfigIssuesButton} from './configIssues/ConfigIssuesButton'\nimport {FreeTrial} from './free-trial'\nimport {FreeTrialProvider} from './free-trial/FreeTrialProvider'\nimport {HomeButton} from './home/HomeButton'\nimport {NavDrawer} from './navDrawer'\nimport {NewDocumentButton, useNewDocumentOptions} from './new-document'\nimport {PresenceMenu} from './presence'\nimport {ResourcesButton} from './resources/ResourcesButton'\nimport {SearchButton, SearchDialog} from './search'\nimport {SearchPopover} from './search/components/SearchPopover'\nimport {SearchProvider} from './search/contexts/search/SearchProvider'\nimport {UserMenu} from './userMenu'\nimport {WorkspaceMenuButton} from './workspace'\n\nconst EMPTY_ARRAY: [] = []\n\nconst RootLayer = styled(Layer)`\n  min-height: auto;\n  position: relative;\n\n  &[data-search-open='true'] {\n    top: 0;\n    position: sticky;\n  }\n`\n\nconst RootCard = styled(Card)`\n  line-height: 0;\n`\n\nconst NavGrid = styled(Grid)`\n  grid-template-columns: auto auto auto;\n  @media screen and (min-width: ${({theme}) => `${theme.sanity.media[3]}px`}) {\n    grid-template-columns: 1fr auto 1fr;\n  }\n`\n\n/**\n * @hidden\n * @beta */\nexport function StudioNavbar(props: Omit<NavbarProps, 'renderDefault'>) {\n  const {\n    // eslint-disable-next-line camelcase\n    __internal_actions: actions = EMPTY_ARRAY,\n  } = props\n\n  const {name, tools} = useWorkspace()\n  const routerState = useRouterState()\n  const mediaIndex = useMediaIndex()\n  const activeToolName = typeof routerState.tool === 'string' ? routerState.tool : undefined\n\n  const newDocumentOptions = useNewDocumentOptions()\n  const {t} = useTranslation()\n\n  const {\n    onSearchFullscreenOpenChange,\n    onSearchOpenChange,\n    searchFullscreenOpen,\n    searchFullscreenPortalEl,\n    searchOpen,\n  } = useContext(NavbarContext)\n\n  const ToolMenu = useToolMenuComponent()\n\n  const [drawerOpen, setDrawerOpen] = useState<boolean>(false)\n\n  const routerStateRef = useRef<RouterState>(routerState)\n  const workspaceNameRef = useRef<string>(name)\n\n  // Close the NavDrawer when changing tool or workspace\n  useEffect(() => {\n    if (routerStateRef.current.tool !== routerState.tool || name !== workspaceNameRef.current) {\n      setDrawerOpen(false)\n    }\n\n    routerStateRef.current = routerState\n    workspaceNameRef.current = name\n  }, [name, routerState])\n\n  const [drawerButtonEl, setDrawerButtonEl] = useState<HTMLButtonElement | null>(null)\n  const [searchOpenButtonEl, setSearchOpenButtonEl] = useState<HTMLButtonElement | null>(null)\n\n  const shouldRender = useMemo(\n    () => ({\n      resources: mediaIndex > 1,\n      collapsedPresenceMenu: mediaIndex <= 1,\n      loginStatus: mediaIndex > 1,\n      searchFullscreen: mediaIndex <= 1,\n      configIssues: mediaIndex > 1 && isDev,\n      newDocumentFullscreen: mediaIndex <= 1,\n      tools: mediaIndex >= 3,\n    }),\n    [mediaIndex],\n  )\n\n  useEffect(() => {\n    onSearchFullscreenOpenChange(searchFullscreenOpen)\n  }, [searchFullscreenOpen, onSearchFullscreenOpenChange])\n\n  // On desktop: force search dialog to be hidden\n  // On mobile: force search popover to be hidden\n  // This is a bit of a micro optimisation to prevent search surfaces from remaining open\n  // when jumping between both mobile / desktop breakpoints.\n  useEffect(() => {\n    if (shouldRender.searchFullscreen) {\n      onSearchOpenChange(false)\n    } else {\n      onSearchFullscreenOpenChange(false)\n    }\n  }, [onSearchFullscreenOpenChange, onSearchOpenChange, shouldRender.searchFullscreen])\n\n  const handleOpenSearch = useCallback(() => {\n    onSearchOpenChange(true)\n  }, [onSearchOpenChange])\n\n  const handleOpenSearchFullscreen = useCallback(() => {\n    onSearchFullscreenOpenChange(true)\n  }, [onSearchFullscreenOpenChange])\n\n  const handleCloseSearch = useCallback(() => {\n    onSearchOpenChange(false)\n  }, [onSearchOpenChange])\n\n  const handleCloseSearchFullscreen = useCallback(() => {\n    onSearchFullscreenOpenChange(false)\n    searchOpenButtonEl?.focus()\n  }, [onSearchFullscreenOpenChange, searchOpenButtonEl])\n\n  const handleCloseDrawer = useCallback(() => {\n    setDrawerOpen(false)\n    drawerButtonEl?.focus()\n  }, [drawerButtonEl])\n\n  const handleOpenDrawer = useCallback(() => {\n    setDrawerOpen(true)\n  }, [])\n\n  const actionNodes = useMemo(() => {\n    if (!shouldRender.tools) return null\n\n    return actions\n      ?.filter((v) => v.location === 'topbar')\n      ?.map((action) => {\n        return (\n          <Button\n            iconRight={action?.icon}\n            key={action.name}\n            mode=\"bleed\"\n            onClick={action?.onAction}\n            selected={action.selected}\n            text={action.title}\n          />\n        )\n      })\n  }, [actions, shouldRender.tools])\n\n  return (\n    <FreeTrialProvider>\n      <RootLayer zOffset={100} data-search-open={searchFullscreenOpen}>\n        <RootCard\n          borderBottom\n          data-testid=\"studio-navbar\"\n          data-ui=\"Navbar\"\n          padding={3}\n          sizing=\"border\"\n        >\n          <NavGrid gap={1}>\n            {/** Left flex */}\n            <TooltipDelayGroupProvider>\n              <Flex align=\"center\" gap={2} justify=\"flex-start\">\n                <Flex align=\"center\" gap={2}>\n                  {/* Menu button */}\n                  {!shouldRender.tools && (\n                    <Button\n                      mode=\"bleed\"\n                      icon={MenuIcon}\n                      onClick={handleOpenDrawer}\n                      ref={setDrawerButtonEl}\n                      tooltipProps={{content: t('user-menu.open-menu'), placement: 'bottom'}}\n                    />\n                  )}\n\n                  {/* Home + workspace menu buttons */}\n                  <Flex gap={1}>\n                    <HomeButton />\n                    <WorkspaceMenuButton />\n                  </Flex>\n                </Flex>\n                {/* New document button */}\n                <NewDocumentButton\n                  {...newDocumentOptions}\n                  modal={shouldRender.newDocumentFullscreen ? 'dialog' : 'popover'}\n                />\n                {/* Search button (desktop) */}\n                {!shouldRender.searchFullscreen && (\n                  <SearchButton onClick={handleOpenSearch} ref={setSearchOpenButtonEl} />\n                )}\n              </Flex>\n            </TooltipDelayGroupProvider>\n\n            {/** Center flex */}\n            <Flex align=\"center\" justify=\"center\">\n              {shouldRender.tools && (\n                <ToolMenu\n                  activeToolName={activeToolName}\n                  closeSidebar={handleCloseDrawer}\n                  context=\"topbar\"\n                  isSidebarOpen={false}\n                  tools={tools}\n                />\n              )}\n            </Flex>\n\n            {/** Right flex */}\n            <TooltipDelayGroupProvider>\n              <Flex align=\"center\" gap={1} justify=\"flex-end\">\n                <Flex gap={1}>\n                  {/* Search */}\n                  <LayerProvider>\n                    <SearchProvider fullscreen={shouldRender.searchFullscreen}>\n                      <BoundaryElementProvider element={document.body}>\n                        {shouldRender.searchFullscreen ? (\n                          <PortalProvider element={searchFullscreenPortalEl}>\n                            <SearchDialog\n                              onClose={handleCloseSearchFullscreen}\n                              onOpen={handleOpenSearchFullscreen}\n                              open={searchFullscreenOpen}\n                            />\n                          </PortalProvider>\n                        ) : (\n                          <SearchPopover\n                            onClose={handleCloseSearch}\n                            onOpen={handleOpenSearch}\n                            open={searchOpen}\n                          />\n                        )}\n                      </BoundaryElementProvider>\n                    </SearchProvider>\n                  </LayerProvider>\n\n                  {shouldRender.tools && <FreeTrial type=\"topbar\" />}\n                  {shouldRender.configIssues && <ConfigIssuesButton />}\n                  {shouldRender.resources && <ResourcesButton />}\n\n                  <PresenceMenu />\n\n                  {/* Search button (mobile) */}\n                  {shouldRender.searchFullscreen && (\n                    <SearchButton\n                      onClick={handleOpenSearchFullscreen}\n                      ref={setSearchOpenButtonEl}\n                    />\n                  )}\n\n                  {actionNodes}\n                </Flex>\n\n                {shouldRender.tools && (\n                  <Box flex=\"none\" marginLeft={1}>\n                    <UserMenu />\n                  </Box>\n                )}\n              </Flex>\n            </TooltipDelayGroupProvider>\n          </NavGrid>\n        </RootCard>\n\n        {!shouldRender.tools && (\n          <NavDrawer\n            __internal_actions={actions}\n            activeToolName={activeToolName}\n            isOpen={drawerOpen}\n            onClose={handleCloseDrawer}\n            tools={tools}\n          />\n        )}\n      </RootLayer>\n    </FreeTrialProvider>\n  )\n}\n","import {Flex} from '@sanity/ui'\nimport {\n  Children,\n  cloneElement,\n  type ForwardedRef,\n  forwardRef,\n  type ReactElement,\n  type ReactNode,\n  useCallback,\n  useMemo,\n  useState,\n} from 'react'\nimport styled from 'styled-components'\n\nimport {type MenuButtonProps} from '../../../ui-components'\nimport {CollapseOverflowMenu} from '../collapseMenu/CollapseOverflowMenu'\nimport {ObserveElement} from '../collapseMenu/ObserveElement'\nimport {ContextMenuButton} from '../contextMenuButton'\n\nfunction _isReactElement(node: unknown): node is ReactElement {\n  return Boolean(node)\n}\n\nconst OptionObserveElement = styled(ObserveElement)`\n  list-style: none;\n  white-space: nowrap;\n  flex-shrink: 0;\n  opacity: 0;\n  visibility: hidden;\n`\n\nconst HiddenRow = styled(Flex)`\n  opacity: 0;\n  height: 0.1px;\n  overflow: hidden;\n`\n\ninterface CollapseTabListProps {\n  children: ReactNode\n  gap?: number | number[]\n  menuButtonProps?: Omit<MenuButtonProps, 'id' | 'menu' | 'button'> & {\n    id?: string\n    button?: ReactElement\n  }\n  onMenuClose?: () => void\n  collapsed?: boolean\n  disableRestoreFocusOnClose?: boolean\n}\n\n/**\n * Similar to `<CollapseMenu />` but instead of collapsing the inner items by removing the text\n * it shows the items that fit, and the rest are rendered in a menu.\n * @internal */\nexport const CollapseTabList = forwardRef(function CollapseTabList(\n  props: CollapseTabListProps,\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const {\n    children: childrenProp,\n    gap,\n    menuButtonProps,\n    disableRestoreFocusOnClose,\n    onMenuClose,\n    collapsed,\n    ...rest\n  } = props\n  const [rootEl, setRootEl] = useState<HTMLDivElement | null>(null)\n  const [hiddenElements, setHiddenElements] = useState<ReactElement[]>([])\n  const [showChildren, setShowChildren] = useState(false)\n\n  const children = useMemo(\n    () => Children.toArray(childrenProp).filter(_isReactElement),\n    [childrenProp],\n  )\n\n  /**\n   * Keeps track of the children that will be shown in place and not in the menu.\n   */\n  const displayChildren = useMemo(() => {\n    if (collapsed) return null // If collapsed, we don't want to show any children\n    if (!showChildren) return null // If we haven't run the intersection observer yet, we don't want to show any children\n    // eslint-disable-next-line max-nested-callbacks\n    return children.filter((c) => !hiddenElements.some((h) => h.key === c.key))\n  }, [children, collapsed, hiddenElements, showChildren])\n\n  const intersectionOptions = useMemo(\n    () => ({\n      root: rootEl,\n      threshold: 1,\n      rootMargin: '1px',\n    }),\n    [rootEl],\n  )\n\n  const menuButton = useMemo(\n    () => menuButtonProps?.button || <ContextMenuButton />,\n    [menuButtonProps],\n  )\n\n  const menuOptionsArray = useMemo(\n    () =>\n      collapsed\n        ? children\n        : // eslint-disable-next-line max-nested-callbacks\n          children.filter(({key}) => hiddenElements.find((o: ReactElement) => o.key === key)),\n    [children, hiddenElements, collapsed],\n  )\n\n  const handleIntersection = useCallback(\n    (e: IntersectionObserverEntry, child: ReactElement) => {\n      const isHidden = hiddenElements.some((el) => el.key === child.key)\n\n      if (!showChildren) setShowChildren(true)\n      const isIntersecting = e.isIntersecting\n      if (!isHidden && !isIntersecting) setHiddenElements((prev) => [...prev, child])\n      if (isHidden && isIntersecting)\n        // eslint-disable-next-line max-nested-callbacks\n        setHiddenElements((prev) => prev.filter((el) => el.key !== child.key))\n    },\n    [hiddenElements, showChildren, setShowChildren, setHiddenElements],\n  )\n\n  return (\n    <Flex direction=\"column\" ref={ref} sizing=\"border\" style={{position: 'relative'}} {...rest}>\n      <Flex justify=\"center\" gap={gap} flex={1}>\n        {displayChildren}\n        {(hiddenElements.length > 0 || collapsed) && (\n          <CollapseOverflowMenu\n            disableRestoreFocusOnClose={disableRestoreFocusOnClose}\n            menuButton={menuButton}\n            menuButtonProps={menuButtonProps}\n            menuOptions={menuOptionsArray}\n            onMenuClose={onMenuClose}\n          />\n        )}\n      </Flex>\n\n      {/* Element that always render all the children to keep track of their position and if the available space to render them */}\n      <HiddenRow justify=\"flex-start\" gap={gap} ref={setRootEl} data-hidden aria-hidden=\"true\">\n        {cloneElement(menuButton, {\n          disabled: true,\n          'aria-hidden': true,\n        })}\n        {children?.map((child) => (\n          <OptionObserveElement\n            key={`${child.key}_observer`}\n            options={intersectionOptions}\n            // eslint-disable-next-line react/jsx-no-bind\n            onIntersectionChange={(e) => handleIntersection(e[0], child)}\n          >\n            {cloneElement(child, {\n              disabled: true,\n              'aria-hidden': true,\n              tabIndex: -1,\n            })}\n          </OptionObserveElement>\n        ))}\n      </HiddenRow>\n    </Flex>\n  )\n})\n","import {type ForwardedRef, forwardRef, type HTMLProps, type ReactNode, useCallback} from 'react'\nimport {StateLink, useRouterState} from 'sanity/router'\n\n/**\n * @hidden\n * @beta */\nexport interface ToolLinkProps {\n  children: ReactNode\n  name: string\n}\n\n/**\n * @hidden\n * @beta */\nexport const ToolLink = forwardRef(function ToolLink(\n  props: ToolLinkProps & Omit<HTMLProps<HTMLAnchorElement>, 'href' | 'name'>,\n  ref: ForwardedRef<HTMLAnchorElement>,\n) {\n  const {name, ...rest} = props\n  const state = useRouterState(\n    useCallback(\n      () => ({\n        tool: name,\n        // make sure to clear tool state when navigating to another tool\n        [name]: undefined,\n      }),\n      [name],\n    ),\n  )\n\n  return <StateLink state={state} {...rest} ref={ref} />\n})\n","import {Flex} from '@sanity/ui'\nimport {startCase} from 'lodash'\nimport {forwardRef, type Ref, useMemo, useState} from 'react'\n\nimport {Button} from '../../../../../ui-components'\nimport {useRovingFocus} from '../../../../components'\nimport {CollapseTabList} from '../../../../components/collapseTabList/CollapseTabList'\nimport {type Tool} from '../../../../config'\nimport {useColorScheme} from '../../../colorScheme'\nimport {ToolLink, type ToolLinkProps} from './ToolLink'\n\ninterface ToolCollapseMenuProps {\n  activeToolName?: string\n  tools: Tool[]\n}\n\nexport function ToolCollapseMenu(props: ToolCollapseMenuProps) {\n  const {activeToolName, tools} = props\n  const {scheme} = useColorScheme()\n  const [collapseMenuEl, setCollapseMenuEl] = useState<HTMLDivElement | null>(null)\n\n  useRovingFocus({\n    rootElement: collapseMenuEl,\n    navigation: ['arrows'],\n  })\n\n  const menuButtonProps = useMemo(\n    () => ({\n      popover: {\n        constrainSize: true,\n        portal: true,\n        scheme: scheme,\n      },\n    }),\n    [scheme],\n  )\n  const children = useMemo(\n    () =>\n      tools.map((tool, index) => {\n        const title = tool?.title || startCase(tool.name)\n\n        const Link = forwardRef(function Link(\n          linkProps: ToolLinkProps,\n          ref: Ref<HTMLAnchorElement>,\n        ) {\n          return (\n            <ToolLink {...linkProps} ref={ref} name={tool.name}>\n              {linkProps.children}\n            </ToolLink>\n          )\n        })\n\n        return (\n          <Button\n            as={Link}\n            data-as=\"a\"\n            // eslint-disable-next-line react/no-array-index-key\n            key={`${tool.name}-${index}`}\n            mode=\"bleed\"\n            selected={activeToolName === tool.name}\n            text={title}\n          />\n        )\n      }),\n    [activeToolName, tools],\n  )\n\n  return (\n    <Flex justify=\"center\" marginX={4}>\n      <CollapseTabList\n        data-testid=\"tool-collapse-menu\"\n        gap={1}\n        menuButtonProps={menuButtonProps}\n        ref={setCollapseMenuEl}\n      >\n        {children}\n      </CollapseTabList>\n    </Flex>\n  )\n}\n","import {Stack} from '@sanity/ui'\nimport {startCase} from 'lodash'\nimport {forwardRef, type Ref, useMemo} from 'react'\n\nimport {Button} from '../../../../../ui-components'\nimport {type Tool} from '../../../../config'\nimport {ToolLink, type ToolLinkProps} from './ToolLink'\n\ninterface ToolVerticalMenuProps {\n  activeToolName?: string\n  isVisible: boolean\n  tools: Tool[]\n}\n\nexport function ToolVerticalMenu(props: ToolVerticalMenuProps) {\n  const {activeToolName, isVisible, tools} = props\n\n  return useMemo(\n    () => (\n      <Stack as=\"ul\" space={1}>\n        {tools.map((tool) => {\n          const title = tool?.title || startCase(tool.name)\n\n          const Link = forwardRef(function Link(\n            linkProps: ToolLinkProps,\n            ref: Ref<HTMLAnchorElement>,\n          ) {\n            return (\n              <ToolLink {...linkProps} ref={ref} name={tool.name}>\n                {linkProps.children}\n              </ToolLink>\n            )\n          })\n\n          return (\n            <Stack as=\"li\" key={tool.name}>\n              <Button\n                as={Link}\n                justify=\"flex-start\"\n                mode=\"bleed\"\n                selected={activeToolName === tool.name}\n                size=\"large\"\n                tabIndex={isVisible ? 0 : -1}\n                text={title}\n              />\n            </Stack>\n          )\n        })}\n      </Stack>\n    ),\n    [activeToolName, isVisible, tools],\n  )\n}\n","import {type ToolMenuProps} from '../../../../config'\nimport {ToolCollapseMenu} from './ToolCollapseMenu'\nimport {ToolVerticalMenu} from './ToolVerticalMenu'\n\n/**\n * @hidden\n * @beta */\nexport function StudioToolMenu(props: ToolMenuProps) {\n  const {context, isSidebarOpen, tools, ...restProps} = props\n\n  if (tools.length <= 1) {\n    return null\n  }\n\n  if (context === 'sidebar') {\n    return <ToolVerticalMenu isVisible={isSidebarOpen} tools={tools} {...restProps} />\n  }\n\n  return <ToolCollapseMenu tools={tools} {...restProps} />\n}\n","/* eslint-disable camelcase */\n\nimport {getTheme_v2, rgba} from '@sanity/ui/theme'\nimport {createGlobalStyle, css} from 'styled-components'\n\nconst SCROLLBAR_SIZE = 12 // px\nconst SCROLLBAR_BORDER_SIZE = 4 // px\n\n// Construct a resize handle icon as a data URI, to be displayed in browsers that support the `::-webkit-resizer` selector.\nfunction buildResizeHandleDataUri(hexColor: string) {\n  const encodedStrokeColor = encodeURIComponent(hexColor)\n  const encodedSvg = `%3Csvg width='9' height='9' viewBox='0 0 9 9' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 8L8 1' stroke='${encodedStrokeColor}' stroke-linecap='round'/%3E%3Cpath d='M5 8L8 5' stroke='${encodedStrokeColor}' stroke-linecap='round'/%3E%3C/svg%3E%0A`\n  return `url(\"data:image/svg+xml,${encodedSvg}\")`\n}\n\nexport const GlobalStyle = createGlobalStyle((props) => {\n  const {color, font} = getTheme_v2(props.theme)\n\n  return css`\n    ::-webkit-resizer {\n      background-image: ${buildResizeHandleDataUri(color.icon)};\n      background-repeat: no-repeat;\n      background-position: bottom right;\n    }\n\n    ::-webkit-scrollbar {\n      width: ${SCROLLBAR_SIZE}px;\n      height: ${SCROLLBAR_SIZE}px;\n    }\n\n    ::-webkit-scrollbar-corner {\n      background-color: transparent;\n    }\n\n    ::-webkit-scrollbar-thumb {\n      background-clip: content-box;\n      background-color: var(--card-border-color, ${color.border});\n      border: ${SCROLLBAR_BORDER_SIZE}px solid transparent;\n    }\n\n    ::-webkit-scrollbar-thumb:hover {\n      background-color: var(--card-muted-fg-color, ${color.muted.fg});\n    }\n\n    ::-webkit-scrollbar-track {\n      background: transparent;\n    }\n\n    *::selection {\n      background-color: ${rgba(color.focusRing, 0.3)};\n    }\n\n    html {\n      background-color: ${color.bg};\n    }\n\n    body {\n      scrollbar-gutter: stable;\n    }\n\n    #sanity {\n      font-family: ${font.text.family};\n    }\n\n    b {\n      font-weight: ${font.text.weights.medium};\n    }\n\n    strong {\n      font-weight: ${font.text.weights.medium};\n    }\n  `\n})\n","import {useToast} from '@sanity/ui'\nimport {useEffect} from 'react'\n\nimport {ConfigResolutionError, SchemaError} from '../config'\nimport {CorsOriginError} from '../store'\nimport {globalScope} from '../util'\n\nconst errorChannel = globalScope.__sanityErrorChannel\n\n/**\n * Attaches a listener to the global error channel and displays a toast when a (unknown)\n * error occurs. Compares the last displayed error message with the current\n *\n * @internal\n */\nexport function ErrorLogger(): null {\n  const {push: pushToast} = useToast()\n\n  useEffect(() => {\n    if (!errorChannel) return undefined\n\n    // errorChannel.subscribe() returns a unsubscriber function.\n    // By returning it from this `useEffect`, it'll unsubscribe on unmount.\n    return errorChannel.subscribe((msg) => {\n      // NOTE: Certain errors (such as the `ResizeObserver loop limit exceeded` error) is thrown\n      // by the browser, and does not include an `error` property. We ignore these errors.\n      if (!msg.error) {\n        return\n      }\n\n      // For errors that we \"expect\", eg have specific error screens for, do not push a toast\n      if (isKnownError(msg.error)) {\n        return\n      }\n\n      console.error(msg.error)\n\n      pushToast({\n        // Use the error message as the ID in order to prevent duplicates from showing\n        // A bit of a hack, but serves\n        id: msg.error.message,\n        closable: true,\n        description: msg.error.message,\n        duration: 5000,\n        title: 'Uncaught error',\n        status: 'error',\n      })\n    })\n  }, [pushToast])\n\n  return null\n}\n\nfunction isKnownError(err: Error): boolean {\n  if (err instanceof SchemaError) {\n    return true\n  }\n\n  if (err instanceof CorsOriginError) {\n    return true\n  }\n\n  if (err instanceof ConfigResolutionError) {\n    return true\n  }\n\n  return false\n}\n","import {type ComponentType, type ReactNode, useEffect, useState} from 'react'\n\nimport {LoadingBlock} from '../components/loadingBlock'\nimport {useActiveWorkspace} from './activeWorkspaceMatcher'\nimport {AuthenticateScreen, NotAuthenticatedScreen} from './screens'\n\ninterface AuthBoundaryProps {\n  children: ReactNode\n  AuthenticateComponent?: ComponentType\n  LoadingComponent?: ComponentType\n  NotAuthenticatedComponent?: ComponentType\n}\n\nexport function AuthBoundary({\n  children,\n  AuthenticateComponent = AuthenticateScreen,\n  LoadingComponent = LoadingBlock,\n  NotAuthenticatedComponent = NotAuthenticatedScreen,\n}: AuthBoundaryProps) {\n  const [error, handleError] = useState<unknown>(null)\n  if (error) throw error\n\n  const [loggedIn, setLoggedIn] = useState<'logged-in' | 'logged-out' | 'loading' | 'unauthorized'>(\n    'loading',\n  )\n  const {activeWorkspace} = useActiveWorkspace()\n\n  useEffect(() => {\n    activeWorkspace.auth.handleCallbackUrl?.().catch(handleError)\n  }, [activeWorkspace.auth])\n\n  useEffect(() => {\n    const subscription = activeWorkspace.auth.state.subscribe({\n      next: ({authenticated, currentUser}) => {\n        if (currentUser?.roles?.length === 0) {\n          setLoggedIn('unauthorized')\n\n          return\n        }\n\n        setLoggedIn(authenticated ? 'logged-in' : 'logged-out')\n      },\n      error: handleError,\n    })\n\n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [activeWorkspace])\n\n  if (loggedIn === 'loading') return <LoadingComponent />\n\n  if (loggedIn === 'unauthorized') return <NotAuthenticatedComponent />\n\n  // NOTE: there is currently a bug where the `AuthenticateComponent` will\n  // flash after the first login with cookieless mode. See `createAuthStore`\n  // for details\n  if (loggedIn === 'logged-out') return <AuthenticateComponent />\n\n  return <>{children}</>\n}\n","export const Z_OFFSET = {\n  toast: [100, 11000],\n}\n","import {createBatchedStore, createSessionId} from '@sanity/telemetry'\nimport {TelemetryProvider} from '@sanity/telemetry/react'\nimport arrify from 'arrify'\nimport {type ReactNode, useEffect, useMemo} from 'react'\n\nimport {type Config} from '../config'\nimport {useClient} from '../hooks'\nimport {SANITY_VERSION} from '../version'\n\nconst sessionId = createSessionId()\n\n// Wrap the app in a TelemetryProvider\n// This will enable usage of the `useTelemetry()` hook\nexport function StudioTelemetryProvider(props: {children: ReactNode; config: Config}) {\n  const client = useClient({apiVersion: 'v2023-12-18'})\n\n  const projectId = client.config().projectId\n  const store = useMemo(() => {\n    return createBatchedStore(sessionId, {\n      // submit any pending events every <n> ms\n      flushInterval: 30000,\n\n      // implements user consent resolving\n      resolveConsent: () => client.request({uri: '/intake/telemetry-status'}),\n\n      // implements sending events to backend\n      sendEvents: (batch) =>\n        client.request({\n          uri: '/intake/batch',\n          method: 'POST',\n          json: true,\n          body: {projectId, batch},\n        }),\n      // opts into a different strategy for sending events when the browser close, reload or navigate away from the current page\n      sendBeacon: (batch) =>\n        navigator.sendBeacon(client.getUrl('/intake/batch'), JSON.stringify({projectId, batch})),\n    })\n  }, [client, projectId])\n\n  useEffect(() => {\n    store.logger.updateUserProperties({\n      userAgent: navigator.userAgent,\n      screen: {\n        density: window.devicePixelRatio,\n        height: window.screen.height,\n        width: window.screen.width,\n        innerHeight: window.innerHeight,\n        innerWidth: window.innerWidth,\n      },\n      studioVersion: SANITY_VERSION,\n      plugins: arrify(props.config).flatMap(\n        (config) =>\n          config.plugins?.flatMap((plugin) => ({\n            name: plugin.name || '<unnamed>',\n          })) || [],\n      ),\n    })\n  }, [props.config, store.logger])\n\n  return <TelemetryProvider store={store}>{props.children}</TelemetryProvider>\n}\n","import {buildTheme, type RootTheme} from '@sanity/ui/theme'\n\nexport * from './_legacy'\nexport * from './types'\n\n/** @internal */\nexport const defaultTheme: RootTheme = buildTheme()\n","/* eslint-disable no-nested-ternary */\n\nimport {LayerProvider, ThemeProvider} from '@sanity/ui'\nimport {type RootTheme} from '@sanity/ui/theme'\nimport {type ReactNode} from 'react'\n\nimport {defaultTheme, type StudioTheme} from '../theme'\nimport {useActiveWorkspace} from './activeWorkspaceMatcher'\nimport {ColorSchemeSetValueContext, ColorSchemeValueContext} from './colorScheme'\n\ninterface StudioThemeProviderProps {\n  children: ReactNode\n}\n\n// Temporary fix for fonts generated by Themer, once Themer is updated to use sanity v2 this can be removed\n// It won't work for locally imported themes from themer, as they won't be updated with a new api call.\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nconst isThemerTheme = (theme: StudioTheme): boolean => theme.__themer === true\n\nfunction getThemeValues(theme: StudioTheme): RootTheme {\n  return {\n    ...defaultTheme,\n    v2: theme.v2,\n    fonts: isThemerTheme(theme) ? defaultTheme.fonts : theme.fonts ?? defaultTheme.fonts,\n    color: theme.color ?? defaultTheme.color,\n  }\n}\n\n/** @internal */\nexport function StudioThemeProvider({children}: StudioThemeProviderProps) {\n  const theme = useActiveWorkspace().activeWorkspace.theme\n\n  if (theme.__legacy) {\n    const scheme = theme.__dark ? 'dark' : 'light'\n    return (\n      <ColorSchemeSetValueContext.Provider value={false}>\n        <ColorSchemeValueContext.Provider value={scheme}>\n          <ThemeProvider scheme={scheme} theme={getThemeValues(theme)}>\n            <LayerProvider>{children}</LayerProvider>\n          </ThemeProvider>\n        </ColorSchemeValueContext.Provider>\n      </ColorSchemeSetValueContext.Provider>\n    )\n  }\n\n  return (\n    <ThemeProvider theme={getThemeValues(theme)}>\n      <LayerProvider>{children}</LayerProvider>\n    </ThemeProvider>\n  )\n}\n","/* eslint-disable i18next/no-literal-string,@sanity/i18n/no-attribute-string-literals */\nimport {Box, Card, Code, Flex, Text} from '@sanity/ui'\nimport {startCase} from 'lodash'\nimport {useEffect} from 'react'\nimport styled from 'styled-components'\n\nconst ListItem = styled(Flex)``\n\nconst ErrorMessageRoot = styled(Box).attrs({padding: 4})``\n\n/**\n * @internal\n */\nexport interface ErrorMessageProps {\n  message: string\n  stack?: string\n  error: unknown\n  path: Array<{name: string; type: string}>\n}\n\n/**\n * @internal\n */\nexport function ErrorMessage({error, message, path, stack}: ErrorMessageProps) {\n  useEffect(() => {\n    console.error(error)\n  }, [error])\n\n  const last = path[path.length - 1]\n\n  return (\n    <ErrorMessageRoot forwardedAs={Flex} direction=\"column\" gap={4}>\n      <Flex direction=\"column\" gap={2}>\n        <Text weight=\"medium\" size={3}>\n          {startCase(last.type)} Error\n        </Text>\n      </Flex>\n\n      <Card tone=\"critical\" overflow=\"auto\" padding={4}>\n        <Code>{message}</Code>\n      </Card>\n\n      <Flex as=\"ul\" direction=\"column\" gap={2}>\n        {path.map(({name, type}, index) => (\n          <ListItem forwardedAs=\"li\" gap={2} align=\"center\" key={index}>\n            <Box>\n              <Code>{name}</Code>\n            </Box>\n            <Box>\n              <Text muted size={1}>\n                {type}\n              </Text>\n            </Box>\n          </ListItem>\n        ))}\n      </Flex>\n\n      {stack && (\n        <details>\n          <Text as=\"summary\">Stack Trace</Text>\n\n          <Box overflow=\"auto\" marginTop={4}>\n            <Code>{stack}</Code>\n          </Box>\n        </details>\n      )}\n    </ErrorMessageRoot>\n  )\n}\n","import {route, type Router} from 'sanity/router'\n\nimport {type Tool} from '../../config'\n\nexport function createRouter(opts: {basePath?: string; tools: Tool[]}): Router {\n  const {basePath = '/', tools} = opts\n\n  const toolRoute = route.create('/:tool', (toolParams) => {\n    let tool = tools.find((current) => current.name === toolParams.tool)\n\n    // If the URL is targeting the `desk` tool, but no such tool exists, check if we have a\n    // `structure` tool instead. If so, this is likely a legacy URL, so we'll redirect to\n    // the new one (structure). Note that this is not enough to make the legacy URL work,\n    // it will still trigger a \"Tool not found\" condition in the layout component, but it\n    // will be handled there with a redirect. Open to suggestions for better solutions.\n    if (!tool && toolParams.tool === 'desk') {\n      tool = tools.find((current) => current.name === 'structure')\n    }\n\n    return tool ? route.scope(tool.name, '/', tool.router) : route.create('/')\n  })\n\n  return route.create(basePath, [route.intents('/intent'), toolRoute])\n}\n","import {type Tool} from '../../../config'\n\nexport function getOrderedTools(tools: Tool[]): Tool[] {\n  const pluginConfig: {toolSwitcher?: {order?: string[]; hidden?: string[]}} = {}\n  const config = pluginConfig.toolSwitcher || {}\n  const order = config.order || []\n  const hidden = config.hidden || []\n\n  if (!order.length && !hidden.length) {\n    return tools\n  }\n\n  const keyed = tools.reduce<Record<string, {index: number; tool: Tool}>>((target, tool) => {\n    const title = tool.title || '<unknown>'\n\n    if (!tool.name) {\n      console.warn(`Tool \"${title}\" does not have the required \"name\" property`)\n      return target\n    }\n\n    if (target[tool.name]) {\n      const existing = target[tool.name].tool.title\n      console.warn(`Tools with duplicate name \"${tool.name}\" found (\"${title}\" and \"${existing}\")`)\n      return target\n    }\n\n    const toolIndex = order.indexOf(tool.name)\n\n    target[tool.name] = {\n      tool: tool,\n      index: toolIndex === -1 ? +Infinity : toolIndex,\n    }\n\n    return target\n  }, {})\n\n  const isVisible = (tool: Tool) => hidden.indexOf(tool.name) === -1\n\n  const ret = tools.filter(isVisible)\n\n  ret.sort((tool1, tool2) => {\n    const toolA = keyed[tool1.name]\n    const toolB = keyed[tool2.name]\n\n    const indexA = toolA ? toolA.index : +Infinity\n    const indexB = toolB ? toolB.index : +Infinity\n\n    if (indexA === indexB) {\n      return 0\n    }\n\n    return indexA - indexB\n  })\n\n  return ret\n}\n","import {type Router, type RouterState} from 'sanity/router'\n\nimport {type Tool} from '../../config'\nimport {isRecord} from '../../util/isRecord'\nimport {type RouterEvent, type RouterStateEvent} from './types'\nimport {getOrderedTools} from './util/getOrderedTools'\n\nconst WEIGHTED_CREATE_INTENT_PARAMS = ['template']\nconst WEIGHTED_EDIT_INTENT_PARAMS = ['mode']\n\nfunction resolveUrlStateWithDefaultTool(tools: Tool[], state: Record<string, unknown> | null) {\n  const orderedTools = getOrderedTools(tools)\n  const defaultTool = orderedTools[0]\n\n  if (!state || state.tool || !defaultTool) {\n    return state\n  }\n\n  return Object.assign({}, state, {\n    tool: defaultTool.name,\n  })\n}\n\nfunction makeBackwardsCompatible(\n  tools: Tool[],\n  state: Record<string, unknown> | null,\n): Record<string, unknown> | null {\n  if (!state) {\n    return state\n  }\n\n  if (getOrderedTools(tools).find((tool) => tool.name === state.space)) {\n    return {...state, tool: state.space, space: undefined}\n  }\n\n  return state\n}\n\nexport function resolveDefaultState(\n  tools: Tool[],\n  state: Record<string, unknown> | null,\n): RouterState | null {\n  const urlStateWithDefaultTool = resolveUrlStateWithDefaultTool(\n    tools,\n    makeBackwardsCompatible(tools, state),\n  )\n\n  return urlStateWithDefaultTool\n}\n\nexport function resolveIntentState(\n  tools: Tool[],\n  prevState: RouterState | null,\n  nextState: RouterState,\n): RouterEvent {\n  const {intent, params, payload} = nextState\n\n  if (typeof intent !== 'string') {\n    throw new Error('intent must be a string')\n  }\n\n  if (!isRecord(params)) {\n    throw new Error('intent params must be a string')\n  }\n\n  const orderedTools = getOrderedTools(tools)\n\n  const currentTool = prevState?.tool\n    ? orderedTools.find((tool) => tool.name === prevState.tool)\n    : null\n\n  const otherTools = currentTool\n    ? orderedTools.filter((tool) => tool !== currentTool)\n    : orderedTools\n\n  let weightedParams: string[] = []\n  if (intent === 'create') {\n    weightedParams = WEIGHTED_CREATE_INTENT_PARAMS\n  } else if (intent === 'edit') {\n    weightedParams = WEIGHTED_EDIT_INTENT_PARAMS\n  }\n\n  // Rank tools by how well they can handle the intent, based on the params they support.\n  // Only the ones defined in `WEIGHTED_*_INTENT_PARAMS` are considered, and on ties in score,\n  // the first tool wins. Any active tool is considered first, then the rest.\n  const initialMatch: {score: number; tool: Tool<any> | null} = {score: -1, tool: null}\n  const {tool: matchingTool} = (currentTool ? [currentTool, ...otherTools] : orderedTools).reduce(\n    (prev, tool) => {\n      if (!tool || typeof tool.canHandleIntent !== 'function') {\n        return prev\n      }\n\n      const canHandle = tool.canHandleIntent(intent, params, prevState && prevState[tool.name])\n      if (typeof canHandle === 'boolean') {\n        // Treat `true` as a score of `0`, since an empty object also has that score\n        return canHandle && prev.score < 0 ? {score: 0, tool} : prev\n      }\n\n      // Skip unknown return values\n      if (!isRecord(canHandle)) {\n        return prev\n      }\n\n      // Rank by number of supported, weighted values\n      const score = weightedParams.reduce((prevScore, weightedParam) => {\n        return weightedParam in params && canHandle[weightedParam] === true\n          ? prevScore + 1\n          : prevScore\n      }, 0)\n\n      return score > prev.score ? {score, tool} : prev\n    },\n    initialMatch,\n  )\n\n  if (matchingTool?.getIntentState) {\n    const _toolState = matchingTool.getIntentState(\n      intent,\n      params as any,\n      prevState && (prevState[matchingTool.name] as any),\n      payload,\n    ) as Record<string, unknown>\n\n    const {_searchParams, ...toolState} = _toolState\n\n    const nextUrlState: Record<string, unknown> = {\n      ...prevState,\n      tool: matchingTool.name,\n      [matchingTool.name]: toolState,\n    }\n    if (matchingTool.router?.__unsafe_disableScopedSearchParams) {\n      nextUrlState._searchParams = _searchParams\n    } else {\n      toolState._searchParams = _searchParams\n    }\n    return {\n      type: 'state',\n      isNotFound: false,\n      state: nextUrlState,\n    }\n  }\n\n  return {\n    type: 'intent',\n    isNotFound: true,\n    intent: {name: intent, params},\n  }\n}\n\nexport function decodeUrlState(rootRouter: Router, pathname: string): RouterStateEvent {\n  return {\n    type: 'state',\n    state: rootRouter.decode(pathname) || {},\n    isNotFound: rootRouter.isNotFound(pathname),\n  }\n}\n\nexport function isNonNullable<T>(value: T): value is NonNullable<T> {\n  return value !== null && value !== undefined\n}\n","import {escapeRegExp, isEqual} from 'lodash'\nimport {\n  type ComponentType,\n  type MutableRefObject,\n  type ReactNode,\n  useEffect,\n  useMemo,\n  useRef,\n} from 'react'\nimport {type Router, RouterProvider, type RouterState} from 'sanity/router'\nimport {useSyncExternalStoreWithSelector} from 'use-sync-external-store/with-selector'\n\nimport {type Tool, type Workspace} from '../../config'\nimport {createRouter, type RouterHistory, type RouterStateEvent} from '../router'\nimport {decodeUrlState, resolveDefaultState, resolveIntentState} from '../router/helpers'\nimport {useRouterHistory} from '../router/RouterHistoryContext'\n\ninterface WorkspaceRouterProviderProps {\n  children: ReactNode\n  LoadingComponent: ComponentType\n  workspace: Workspace\n}\n\nexport function WorkspaceRouterProvider({\n  children,\n  LoadingComponent,\n  workspace,\n}: WorkspaceRouterProviderProps) {\n  const {basePath, tools} = workspace\n  const history = useRouterHistory()\n  const router = useMemo(() => createRouter({basePath, tools}), [basePath, tools])\n  const [state, onNavigate] = useRouterFromWorkspaceHistory(history, router, tools)\n\n  // `state` is only null if the Studio is somehow rendering in SSR or using hydrateRoot in combination with `unstable_noAuthBoundary`.\n  // Which makes this loading condition extremely rare, most of the time it'll render `RouteProvider` right away.\n  if (!state) return <LoadingComponent />\n\n  return (\n    <RouterProvider onNavigate={onNavigate} router={router} state={state}>\n      {children}\n    </RouterProvider>\n  )\n}\n\ntype HandleNavigate = (opts: {path: string; replace?: boolean}) => void\n\n/**\n * @internal\n */\nfunction useRouterFromWorkspaceHistory(\n  history: RouterHistory,\n  router: Router,\n  tools: Tool[],\n): [RouterState | null, HandleNavigate] {\n  // React will only re-subscribe if store.subscribe changes identity, so by memoizing the whole store\n  // we ensure that if any of the dependencies used by store.selector changes, we'll re-subscribe.\n  // If we don't, we risk hot reload seeing stale workspace configs as the user is editing them.\n  const store = useMemo(() => {\n    const routerBasePath = router.getBasePath()\n    // this regex ends with a `(\\\\/|$)` (forward slash or end) to prevent false\n    // matches where the pathname is a false subset of the current pathname.\n    const routerBasePathRegex = new RegExp(`^${escapeRegExp(routerBasePath)}(\\\\/|$)`, 'i')\n    const shouldHandle = (pathname: string) =>\n      // this is necessary to prevent emissions intended for other workspaces.\n      routerBasePath === '/' ? true : routerBasePathRegex.test(pathname)\n    return {\n      subscribe: (onStoreChange: () => void) => history.listen(onStoreChange),\n      getSnapshot: () => `${history.location.pathname}${history.location.search || ''}`,\n      // Always return null for the server snapshot, as we can't know how to resolve intents until after authentication is done, which is browser-only\n      getServerSnapshot: () => null,\n      selector: (pathname: string | null) =>\n        typeof pathname === 'string' && shouldHandle(pathname)\n          ? decodeUrlState(router, pathname)\n          : null,\n    }\n  }, [history, router])\n\n  const event = useSyncExternalStoreWithSelector(\n    store.subscribe,\n    store.getSnapshot,\n    store.getServerSnapshot,\n    store.selector,\n    isEqual,\n  )\n  /**\n   * As `prevEvent` needs to be referenced in `onNavigate`, it's important to use a React Ref when reading from it.\n   * The `onNavigate` callback is the backbone which all the router operations are built upon, implemented in `RouterProvider`.\n   * This includes `navigateUrl`, 'mavigate' and 'navigateIntent'. If we didn't use a React Ref, for example maybe use `useState` instead, then this would mean that every time `prevEvent` got a new value\n   * it would trigger a React re-render, which would give `onNavigate` a new identity. Which means all components that use `useRouter` would re-render just so that\n   * the callback will \"see\" the latest `preEvent` value. This is a very expensive operation, and we want to avoid it.\n   */\n  const prevEvent = useRef(event)\n\n  // Handles redirects from the root base path to the default tool, e.g. `/` -> `/structure`\n  useEffect(() => {\n    if (event?.type === 'state' && !event.state?.intent) {\n      const defaultState = resolveDefaultState(tools, event.state)\n      if (defaultState && defaultState !== event.state) {\n        history.replace(router.encode(defaultState))\n      }\n    }\n  }, [event?.state, event?.type, history, router, tools])\n\n  // Handles redirects to intents, e.g. `/test/intent/create/template=codeTest;type=codeTest/` -> `/test/content/input-plugin;codeTest;c7e1aa3e-5555-40f5-b0af-c7309df6edcc%2Ctemplate%3DcodeTest`\n  // eslint-disable-next-line consistent-return\n  useEffect(() => {\n    const resolvedIntent = maybeResolveIntent(event, router, tools, prevEvent)\n    // If resolvedIntent is truthy then we have a redirect to perform. Most of the time it'll be `null`\n    if (resolvedIntent) {\n      // console.debug('useEffect about to resolve intent URL to %o', resolvedIntent)\n      history.replace(resolvedIntent)\n    } else {\n      // console.debug('Syncing prevEvent.current to %o', event)\n      /**\n       * Sync the prevEvent ref with the current event, in a way that ensures the above side-effect is idemptotent.\n       * Idempotent means that if this hook is called multiple times, before the `history` state updates with the result of calling `history.replace` above,\n       * then the `prevEvent` ref remains the same until the `history` state has updated.\n       */\n      prevEvent.current = event\n    }\n  }, [event, history, router, tools])\n\n  const handleNavigate = useMemo<HandleNavigate>(() => {\n    // This is using useMemo instead of useCallback just so we can track if it's called an abnormal amount of times\n    // console.debug('handleNavigate useMemo called (should optimally only happen once)')\n    // console.count('handleNavigate')\n    return ({path, replace}) => {\n      // Handle intent resolving early, so we avoid rendering intermediate states in the workspace root, as it otherwise resolves intents in useEffect handlers\n      const predictedEvent = store.selector(path)\n      const resolvedIntent = maybeResolveIntent(predictedEvent, router, tools, prevEvent)\n      const resolvedPath = typeof resolvedIntent === 'string' ? resolvedIntent : path\n\n      if (replace) {\n        history.replace(resolvedPath)\n      } else {\n        history.push(resolvedPath)\n      }\n    }\n  }, [history, router, store, tools])\n\n  return [event?.state ?? null, handleNavigate]\n}\n\n// Handles intent resolving, both on navigate events (onClick and such), as well as onLoad by useEffect\nfunction maybeResolveIntent(\n  event: RouterStateEvent | null,\n  router: Router,\n  tools: Tool[],\n  prevEvent: MutableRefObject<RouterStateEvent | null>,\n): string | null {\n  if (event?.type === 'state' && event.state?.intent) {\n    const redirectState = resolveIntentState(\n      tools,\n      prevEvent.current?.type === 'state' ? prevEvent.current.state : {},\n      event.state,\n    )\n\n    if (redirectState?.type === 'state') {\n      return router.encode(redirectState.state)\n    }\n  }\n\n  return null\n}\n","import {ErrorBoundary} from '@sanity/ui'\nimport {type ComponentType, type ReactNode, useEffect, useState} from 'react'\nimport {combineLatest, of} from 'rxjs'\nimport {catchError, map} from 'rxjs/operators'\n\nimport {\n  ConfigResolutionError,\n  type Source,\n  type Workspace,\n  type WorkspaceSummary,\n} from '../../config'\nimport {useActiveWorkspace} from '../activeWorkspaceMatcher'\nimport {SourceProvider} from '../source'\nimport {WorkspaceProvider} from '../workspace'\nimport {WorkspaceRouterProvider} from './WorkspaceRouterProvider'\n\n// TODO: work on error handler\n// import {flattenErrors} from './flattenErrors'\n\ninterface WorkspaceLoaderProps {\n  children: ReactNode\n  ConfigErrorsComponent: ComponentType\n  LoadingComponent: ComponentType\n}\n\n/**\n * @internal\n */\nexport function useWorkspaceLoader(activeWorkspace: WorkspaceSummary) {\n  const [error, handleError] = useState<unknown>(null)\n  if (error) throw error\n\n  const [workspace, setWorkspace] = useState<Workspace | null>(null)\n\n  useEffect(() => {\n    const subscription = combineLatest(\n      activeWorkspace.__internal.sources.map(({source}) =>\n        source.pipe(\n          catchError((err) => {\n            if (err instanceof ConfigResolutionError) return of(err)\n            throw err\n          }),\n        ),\n      ),\n    )\n      .pipe(\n        map((results): Source[] => {\n          const errors = results.filter((result) => result instanceof ConfigResolutionError)\n          if (errors.length) {\n            throw new ConfigResolutionError({\n              name: activeWorkspace.name,\n              causes: errors,\n              type: 'workspace',\n            })\n          }\n\n          return results as Source[]\n        }),\n        map(\n          ([rootSource, ...restOfSources]): Workspace => ({\n            ...activeWorkspace,\n            ...rootSource,\n            unstable_sources: [rootSource, ...restOfSources],\n            type: 'workspace',\n          }),\n        ),\n      )\n      .subscribe({\n        next: setWorkspace,\n        error: handleError,\n      })\n\n    return () => subscription.unsubscribe()\n  }, [activeWorkspace])\n\n  return workspace\n}\n\nfunction WorkspaceLoader({\n  children,\n  LoadingComponent,\n}: Omit<WorkspaceLoaderProps, 'ConfigErrorsComponent'>) {\n  const {activeWorkspace} = useActiveWorkspace()\n  const workspace = useWorkspaceLoader(activeWorkspace)\n  if (!workspace) return <LoadingComponent />\n\n  // TODO: may need a screen if one of the sources is not logged in. e.g. it\n  // is currently possible for the user to be logged into the current workspace\n  // but not all of its nested sources.\n  // if (!allSourcesLoggedIn) return <NotAllSourcesAuthenticatedComponent />\n\n  return (\n    <WorkspaceProvider workspace={workspace}>\n      <SourceProvider\n        // the first source is always the root source and is always present\n        source={workspace.unstable_sources[0]}\n      >\n        <WorkspaceRouterProvider LoadingComponent={LoadingComponent} workspace={workspace}>\n          {children}\n        </WorkspaceRouterProvider>\n      </SourceProvider>\n    </WorkspaceProvider>\n  )\n}\n\n/**\n * @internal\n */\nfunction WorkspaceLoaderBoundary({ConfigErrorsComponent, ...props}: WorkspaceLoaderProps) {\n  const [{error}, setError] = useState<{error: unknown}>({error: null})\n\n  // TODO: implement this\n  // const errors = useMemo(() => flattenErrors(error, []), [error])\n\n  //TODO: implement config error screen - a story has been created for this\n  // if (error instanceof ConfigResolutionError) return <ConfigErrorsComponent />\n\n  // otherwise hand off to other boundaries\n  if (error) throw error\n\n  return (\n    <ErrorBoundary onCatch={setError}>\n      <WorkspaceLoader {...props} />\n    </ErrorBoundary>\n  )\n}\n\nexport {WorkspaceLoaderBoundary as WorkspaceLoader}\n","import {ToastProvider} from '@sanity/ui'\nimport {type ReactNode} from 'react'\nimport Refractor from 'react-refractor'\nimport bash from 'refractor/lang/bash'\nimport javascript from 'refractor/lang/javascript'\nimport json from 'refractor/lang/json'\nimport jsx from 'refractor/lang/jsx'\nimport typescript from 'refractor/lang/typescript'\n\nimport {LoadingBlock} from '../components/loadingBlock'\nimport {ErrorLogger} from '../error/ErrorLogger'\nimport {LocaleProvider} from '../i18n'\nimport {ResourceCacheProvider} from '../store'\nimport {UserColorManagerProvider} from '../user-color'\nimport {ActiveWorkspaceMatcher} from './activeWorkspaceMatcher'\nimport {AuthBoundary} from './AuthBoundary'\nimport {ColorSchemeProvider} from './colorScheme'\nimport {Z_OFFSET} from './constants'\nimport {\n  AuthenticateScreen,\n  ConfigErrorsScreen,\n  NotAuthenticatedScreen,\n  NotFoundScreen,\n} from './screens'\nimport {type StudioProps} from './Studio'\nimport {StudioErrorBoundary} from './StudioErrorBoundary'\nimport {StudioTelemetryProvider} from './StudioTelemetryProvider'\nimport {StudioThemeProvider} from './StudioThemeProvider'\nimport {WorkspaceLoader} from './workspaceLoader'\nimport {WorkspacesProvider} from './workspaces'\n\nRefractor.registerLanguage(bash)\nRefractor.registerLanguage(javascript)\nRefractor.registerLanguage(json)\nRefractor.registerLanguage(jsx)\nRefractor.registerLanguage(typescript)\n\n/**\n * @hidden\n * @beta */\nexport interface StudioProviderProps extends StudioProps {\n  children: ReactNode\n}\n\n/**\n * @hidden\n * @beta */\nexport function StudioProvider({\n  children,\n  config,\n  basePath,\n  onSchemeChange,\n  scheme,\n  unstable_history: history,\n  unstable_noAuthBoundary: noAuthBoundary,\n}: StudioProviderProps) {\n  const _children = (\n    <WorkspaceLoader LoadingComponent={LoadingBlock} ConfigErrorsComponent={ConfigErrorsScreen}>\n      <StudioTelemetryProvider config={config}>\n        <LocaleProvider>\n          <ResourceCacheProvider>{children}</ResourceCacheProvider>\n        </LocaleProvider>\n      </StudioTelemetryProvider>\n    </WorkspaceLoader>\n  )\n\n  return (\n    <ColorSchemeProvider onSchemeChange={onSchemeChange} scheme={scheme}>\n      <ToastProvider paddingY={7} zOffset={Z_OFFSET.toast}>\n        <ErrorLogger />\n        <StudioErrorBoundary>\n          <WorkspacesProvider config={config} basePath={basePath}>\n            <ActiveWorkspaceMatcher\n              unstable_history={history}\n              NotFoundComponent={NotFoundScreen}\n              LoadingComponent={LoadingBlock}\n            >\n              <StudioThemeProvider>\n                <UserColorManagerProvider>\n                  {noAuthBoundary ? (\n                    _children\n                  ) : (\n                    <AuthBoundary\n                      LoadingComponent={LoadingBlock}\n                      AuthenticateComponent={AuthenticateScreen}\n                      NotAuthenticatedComponent={NotAuthenticatedScreen}\n                    >\n                      {_children}\n                    </AuthBoundary>\n                  )}\n                </UserColorManagerProvider>\n              </StudioThemeProvider>\n            </ActiveWorkspaceMatcher>\n          </WorkspacesProvider>\n        </StudioErrorBoundary>\n      </ToastProvider>\n    </ColorSchemeProvider>\n  )\n}\n","import {type SanityClient} from '@sanity/client'\n\nimport {type SourceClientOptions} from '../config'\nimport {useSource} from '../studio'\n\n/**\n * React hook that returns a configured Sanity client instance based on the given configuration.\n * Automatically uses the correct project and dataset based on the current active workspace.\n *\n * @public\n * @param clientOptions - Options for the client. Specifying\n *   {@link https://www.sanity.io/docs/api-versioning | apiVersion} is required in order to\n *   prevent breaking changes if studio changes the API version used in other places.\n *   See {@link SourceClientOptions}\n * @returns A configured Sanity client instance\n * @remarks The client instance is automatically memoized based on API version\n * @example Instantiating a client\n * ```ts\n * function MyComponent() {\n *   const client = useClient({apiVersion: '2021-06-07'})\n *   // ... do something with client instance ...\n * }\n * ```\n */\nexport function useClient(clientOptions?: SourceClientOptions): SanityClient {\n  const source = useSource()\n  if (!clientOptions) {\n    console.warn(\n      'Calling `useClient()` without specifying an API version is deprecated and will stop working in the next dev-preview release - please migrate to use `useClient({apiVersion: \"2021-06-07\"})`.',\n    )\n    return source.getClient({apiVersion: '2021-06-07'})\n  }\n\n  return source.getClient(clientOptions)\n}\n","import {useSource} from '../studio'\n\n/**\n * React hook that returns the name of the current dataset\n *\n * @public\n * @returns The name of the current dataset\n * @example Using the `useDataset` hook\n * ```ts\n * function MyComponent() {\n *   const dataset = useDataset()\n *   // ... do something with the dataset name ...\n * }\n * ```\n */\nexport function useDataset(): string {\n  return useSource().dataset\n}\n","import {useMemoObservable} from 'react-rx'\n\nimport {type OperationsAPI, useDocumentStore} from '../store'\n\n/** @internal */\nexport function useDocumentOperation(publishedDocId: string, docTypeName: string): OperationsAPI {\n  const documentStore = useDocumentStore()\n  return useMemoObservable(\n    () => documentStore.pair.editOperations(publishedDocId, docTypeName),\n    [docTypeName, documentStore.pair, publishedDocId],\n  )!\n}\n","import {type SanityClient} from '@sanity/client'\nimport {useMemoObservable} from 'react-rx'\nimport {type Observable, of} from 'rxjs'\nimport {catchError, map, shareReplay, startWith} from 'rxjs/operators'\n\nimport {useSource} from '../studio'\nimport {DEFAULT_STUDIO_CLIENT_OPTIONS} from '../studioClient'\nimport {useClient} from './useClient'\n\nconst EMPTY_ARRAY: [] = []\n\ninterface Features {\n  enabled: boolean\n  error: Error | null\n  features: string[]\n  isLoading: boolean\n}\n\nconst INITIAL_LOADING_STATE: Features = {\n  enabled: true,\n  error: null,\n  features: EMPTY_ARRAY,\n  isLoading: true,\n}\n\n/**\n * fetches all the enabled features for this project\n */\nfunction fetchFeatures({versionedClient}: {versionedClient: SanityClient}): Observable<string[]> {\n  return versionedClient.observable.request<string[]>({\n    uri: `/features`,\n    tag: 'features',\n  })\n}\n\nconst cachedFeatureRequest = new Map<string, Observable<string[]>>()\n\n/** @internal */\nexport function useFeatureEnabled(featureKey: string): Features {\n  const versionedClient = useClient(DEFAULT_STUDIO_CLIENT_OPTIONS)\n  const {projectId} = useSource()\n\n  if (!cachedFeatureRequest.get(projectId)) {\n    const features = fetchFeatures({versionedClient}).pipe(shareReplay())\n    cachedFeatureRequest.set(projectId, features)\n  }\n\n  const featureInfo = useMemoObservable(\n    () =>\n      (cachedFeatureRequest.get(projectId) || of(EMPTY_ARRAY)).pipe(\n        map((features = []) => ({\n          isLoading: false,\n          enabled: Boolean(features?.includes(featureKey)),\n          features,\n          error: null,\n        })),\n        startWith(INITIAL_LOADING_STATE),\n        catchError((error: Error) => {\n          return of({isLoading: false, enabled: false, features: EMPTY_ARRAY, error})\n        }),\n      ),\n    [featureKey, projectId],\n    INITIAL_LOADING_STATE,\n  )\n\n  return featureInfo\n}\n","import {useSource} from '../studio'\n\n/**\n * React hook that returns the current project id\n *\n * @public\n * @returns The current project id\n * @example Using the `useProjectId` hook\n * ```ts\n * function MyComponent() {\n *   const projectId = useProjectId()\n *   // ... do something with the project id ...\n * }\n * ```\n */\nexport function useProjectId(): string {\n  return useSource().projectId\n}\n","import {\n  differenceInDays,\n  differenceInHours,\n  differenceInMinutes,\n  differenceInMonths,\n  differenceInSeconds,\n  differenceInWeeks,\n  differenceInYears,\n} from 'date-fns'\nimport {useCallback, useEffect, useReducer} from 'react'\n\nimport {useCurrentLocale, useTranslation} from '../i18n'\nimport {intlCache} from '../i18n/intlCache'\n\ninterface TimeSpec {\n  timestamp: string\n  refreshInterval: number | null\n}\n\nconst FIVE_SECONDS = 1000 * 5\nconst TWENTY_SECONDS = 1000 * 20\nconst ONE_MINUTE = 1000 * 60\nconst ONE_HOUR = ONE_MINUTE * 60\n\nconst NO_YEAR_DATE_ONLY_FORMAT: Intl.DateTimeFormatOptions = {\n  month: 'short',\n  day: 'numeric',\n}\n\nconst DATE_ONLY_FORMAT: Intl.DateTimeFormatOptions = {\n  ...NO_YEAR_DATE_ONLY_FORMAT,\n  year: 'numeric',\n}\n\nconst FULL_DATE_FORMAT: Intl.DateTimeFormatOptions = {\n  ...DATE_ONLY_FORMAT,\n  hour: 'numeric',\n  minute: 'numeric',\n}\n\n/** @internal */\nexport interface RelativeTimeOptions {\n  minimal?: boolean\n  useTemporalPhrase?: boolean\n  relativeTo?: Date\n  timeZone?: string\n}\n\n/** @internal */\nexport function useRelativeTime(time: Date | string, options: RelativeTimeOptions = {}): string {\n  const resolved = useFormatRelativeTime(time, options)\n\n  const [, forceUpdate] = useReducer((x) => x + 1, 0)\n\n  useEffect(() => {\n    let timerId: number | null\n\n    function tick(interval: number) {\n      timerId = window.setTimeout(() => {\n        forceUpdate()\n        // avoid pile-up of setInterval callbacks,\n        // e.g. schedule the next update at `refreshInterval` *after* the previous one finishes\n        timerId = window.setTimeout(() => tick(interval), interval)\n      }, interval)\n    }\n\n    if (resolved.refreshInterval !== null) {\n      tick(resolved.refreshInterval)\n    }\n\n    return () => {\n      if (timerId !== null) {\n        clearTimeout(timerId)\n      }\n    }\n  }, [forceUpdate, resolved.refreshInterval])\n\n  return resolved.timestamp\n}\n\nfunction useFormatRelativeTime(date: Date | string, opts: RelativeTimeOptions = {}): TimeSpec {\n  const {t} = useTranslation()\n  const currentLocale = useCurrentLocale().id\n\n  const {timeZone, minimal} = opts\n  const parsedDate = date instanceof Date ? date : new Date(date)\n  const useTemporalPhrase = Boolean(opts.useTemporalPhrase)\n  const format = useCallback(\n    function formatWithUnit(count: number, unit: Intl.RelativeTimeFormatUnit): string {\n      const isNextOrPrevDay = unit === 'day' && Math.abs(count) === 1\n      const isNextOrPrevWeek = unit === 'week' && Math.abs(count) === 1\n\n      if (useTemporalPhrase || isNextOrPrevDay) {\n        return intlCache\n          .relativeTimeFormat(currentLocale, {\n            // Force 'long' formatting for dates within the next/previous week as `Intl.RelativeTimeFormat`\n            // will display these as `next wk.` or `last wk.`  which we don't want!\n            // Idiomatic dates should always be displayed in full. There may be a more elegant way to handle this.\n            style: minimal && !isNextOrPrevWeek ? 'short' : 'long',\n            numeric: 'auto',\n          })\n          .format(count, unit)\n      }\n\n      return intlCache\n        .numberFormat(currentLocale, {style: 'unit', unit, unitDisplay: minimal ? 'short' : 'long'})\n        .format(Math.abs(count))\n    },\n    [currentLocale, useTemporalPhrase, minimal],\n  )\n\n  // Invalid date? Return empty timestamp and `null` as refresh interval, to save us from\n  // continuously trying to format an invalid date. The `useEffect` calls in the hook will\n  // trigger a re-evaluation of the timestamp when the date changes, so this is safe.\n  if (!parsedDate.getTime()) {\n    return {\n      timestamp: '',\n      refreshInterval: null,\n    }\n  }\n\n  const now = opts.relativeTo || Date.now()\n  const diffMonths = differenceInMonths(now, parsedDate)\n  const diffYears = differenceInYears(now, parsedDate)\n\n  if (diffMonths || diffYears) {\n    if (opts.minimal && diffYears === 0) {\n      // same year\n      return {\n        timestamp: intlCache\n          .dateTimeFormat(currentLocale, {...NO_YEAR_DATE_ONLY_FORMAT, timeZone})\n          .format(parsedDate),\n        refreshInterval: null,\n      }\n    }\n\n    if (opts.minimal) {\n      return {\n        timestamp: intlCache\n          .dateTimeFormat(currentLocale, {...DATE_ONLY_FORMAT, timeZone})\n          .format(parsedDate),\n        refreshInterval: null,\n      }\n    }\n\n    return {\n      timestamp: intlCache\n        .dateTimeFormat(currentLocale, {...FULL_DATE_FORMAT, timeZone})\n        .format(parsedDate),\n      refreshInterval: null,\n    }\n  }\n\n  const diffWeeks = differenceInWeeks(parsedDate, now)\n  if (diffWeeks) {\n    return {\n      timestamp: format(diffWeeks, 'week'),\n      refreshInterval: ONE_HOUR,\n    }\n  }\n\n  const diffDays = differenceInDays(parsedDate, now)\n  if (diffDays) {\n    return {\n      timestamp: format(diffDays, 'day'),\n      refreshInterval: ONE_HOUR,\n    }\n  }\n\n  const diffHours = differenceInHours(parsedDate, now)\n  if (diffHours) {\n    return {\n      timestamp: format(diffHours, 'hour'),\n      refreshInterval: ONE_MINUTE,\n    }\n  }\n\n  const diffMins = differenceInMinutes(parsedDate, now)\n  if (diffMins) {\n    return {\n      timestamp: format(diffMins, 'minute'),\n      refreshInterval: TWENTY_SECONDS,\n    }\n  }\n\n  const diffSeconds = differenceInSeconds(parsedDate, now)\n  if (Math.abs(diffSeconds) > 10) {\n    return {\n      timestamp: format(diffSeconds, 'second'),\n      refreshInterval: FIVE_SECONDS,\n    }\n  }\n\n  return {timestamp: t('relative-time.just-now'), refreshInterval: FIVE_SECONDS}\n}\n","import {type Schema} from '@sanity/types'\n\nimport {useSource} from '../studio'\n\n/**\n * React hook that returns the schema registry for the current project\n *\n * @public\n * @returns The schema registry for the current project\n * @example Using the `useSchema` hook\n * ```ts\n * function MyComponent() {\n *   const schema = useSchema()\n *   // ... do something with the schema ...\n * }\n * ```\n */\nexport function useSchema(): Schema {\n  return useSource().schema\n}\n","import {useSource} from '../studio'\nimport {type Template} from '../templates'\n\n/**\n *\n * @hidden\n * @beta\n */\nexport function useTemplates(): Template[] {\n  return useSource().templates\n}\n","import {type PreviewValue, type SanityDocument} from '@sanity/types'\nimport {Flex, Text} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {useDateTimeFormat, useRelativeTime} from '../../hooks'\nimport {useTranslation} from '../../i18n'\n\ninterface DocumentStatusProps {\n  absoluteDate?: boolean\n  draft?: PreviewValue | Partial<SanityDocument> | null\n  published?: PreviewValue | Partial<SanityDocument> | null\n  singleLine?: boolean\n}\n\nconst StyledText = styled(Text)`\n  white-space: nowrap;\n`\n\n/**\n * Displays document status indicating both last published and edited dates in either relative (the default)\n * or absolute formats.\n *\n * These can be displayed in a single or multi-line (the default) lockups.\n *\n * Example: `**Published Oct 16 2023** Edited 8m ago`\n *\n * @internal\n */\nexport function DocumentStatus({absoluteDate, draft, published, singleLine}: DocumentStatusProps) {\n  const {t} = useTranslation()\n  const draftUpdatedAt = draft && '_updatedAt' in draft ? draft._updatedAt : ''\n  const publishedUpdatedAt = published && '_updatedAt' in published ? published._updatedAt : ''\n\n  const intlDateFormat = useDateTimeFormat({\n    dateStyle: 'medium',\n    timeStyle: 'short',\n  })\n\n  const draftDateAbsolute = draftUpdatedAt && intlDateFormat.format(new Date(draftUpdatedAt))\n  const publishedDateAbsolute =\n    publishedUpdatedAt && intlDateFormat.format(new Date(publishedUpdatedAt))\n\n  const draftUpdatedTimeAgo = useRelativeTime(draftUpdatedAt || '', {\n    minimal: true,\n    useTemporalPhrase: true,\n  })\n  const publishedUpdatedTimeAgo = useRelativeTime(publishedUpdatedAt || '', {\n    minimal: true,\n    useTemporalPhrase: true,\n  })\n\n  const publishedDate = absoluteDate ? publishedDateAbsolute : publishedUpdatedTimeAgo\n  const updatedDate = absoluteDate ? draftDateAbsolute : draftUpdatedTimeAgo\n\n  return (\n    <Flex\n      align={singleLine ? 'center' : 'flex-start'}\n      direction={singleLine ? 'row' : 'column'}\n      gap={2}\n      wrap=\"nowrap\"\n    >\n      {!publishedDate && (\n        <StyledText size={1} weight=\"medium\">\n          {t('document-status.not-published')}\n        </StyledText>\n      )}\n      {publishedDate && (\n        <StyledText size={1} weight=\"medium\">\n          {t('document-status.published', {date: publishedDate})}\n        </StyledText>\n      )}\n      {updatedDate && (\n        <StyledText muted size={1} wrap=\"nowrap\">\n          {t('document-status.edited', {date: updatedDate})}\n        </StyledText>\n      )}\n    </Flex>\n  )\n}\n","import {type EffectCallback, memo, useEffect, useRef} from 'react'\nimport shallowEquals from 'shallow-equals'\n\nfunction useShallowCompareMemoize<T>(value: T): Array<T | undefined> {\n  const ref = useRef<T | undefined>(undefined)\n\n  if (!shallowEquals(value, ref.current)) {\n    ref.current = value\n  }\n\n  return [ref.current]\n}\n\nfunction useShallowCompareEffect(callback: EffectCallback, dependencies: any) {\n  // eslint-disable-next-line react-hooks/exhaustive-deps -- the linter isn't able to see that deps are properly handled here\n  useEffect(callback, useShallowCompareMemoize(dependencies))\n}\n\n/** @internal */\nexport const HookStateContainer = memo(\n  function HookStateContainer(props: any) {\n    const {hook, args, id, onNext, onReset, onRequestUpdate} = props\n\n    const hookState = hook({\n      ...args,\n      onComplete: () => {\n        onReset(id)\n      },\n    })\n\n    useShallowCompareEffect(() => {\n      onNext(id, hookState)\n      onRequestUpdate()\n      return () => {\n        onNext(id, null)\n        onRequestUpdate()\n      }\n    }, hookState)\n\n    return null\n  },\n  (prev, next) => prev.args === next.args,\n)\n","import {AccessDeniedIcon} from '@sanity/icons'\nimport {type CurrentUser} from '@sanity/types'\nimport {Box, Inline, Text} from '@sanity/ui'\nimport {startCase} from 'lodash'\nimport {Fragment, useCallback} from 'react'\n\nimport {useListFormat} from '../hooks/useListFormat'\nimport {useTranslation} from '../i18n/hooks/useTranslation'\n// note: these are both available from the `../i18n` export but importing through\n// that export fails the build. may be due to a circular reference.\nimport {Translate} from '../i18n/Translate'\n\n/** @internal */\nexport interface InsufficientPermissionsMessageProps {\n  currentUser?: CurrentUser | null\n  context:\n    | 'create-new-reference'\n    | 'create-document-type'\n    | 'create-any-document'\n    | 'create-document'\n    | 'delete-document'\n    | 'discard-changes'\n    | 'duplicate-document'\n    | 'publish-document'\n    | 'unpublish-document'\n}\n\nconst EMPTY_ARRAY = [] as never[]\n\n/** @internal */\nexport function InsufficientPermissionsMessage({\n  currentUser,\n  context,\n}: InsufficientPermissionsMessageProps) {\n  const {t} = useTranslation()\n\n  const list = useListFormat({style: 'short', type: 'unit'})\n  const roles = currentUser?.roles || EMPTY_ARRAY\n\n  const Roles = useCallback(\n    () => (\n      <>\n        {list\n          .formatToParts(roles.map((role) => role.title || startCase(role.name)))\n          .map((i, index) =>\n            i.type === 'element' ? (\n              // eslint-disable-next-line react/no-array-index-key\n              <code key={`${i.value}-${index}`}>{i.value}</code>\n            ) : (\n              // eslint-disable-next-line react/no-array-index-key\n              <Fragment key={`${i.value}-${index}`}>{i.value}</Fragment>\n            ),\n          )}\n      </>\n    ),\n    [roles, list],\n  )\n\n  return (\n    <Box>\n      <Inline space={2}>\n        <Text size={0}>\n          <AccessDeniedIcon />\n        </Text>\n        <Text size={1} weight=\"medium\">\n          {t('insufficient-permissions-message.title')}\n        </Text>\n      </Inline>\n      <Inline marginTop={4}>\n        <Text size={1}>\n          <Translate\n            i18nKey=\"insufficient-permissions-message.not-authorized-explanation\"\n            t={t}\n            context={context}\n          />\n        </Text>\n      </Inline>\n      <Inline marginTop={4} marginBottom={1}>\n        <Text size={1}>\n          <Translate i18nKey=\"insufficient-permissions-message.roles\" t={t} components={{Roles}} />\n        </Text>\n      </Inline>\n    </Box>\n  )\n}\n","import {\n  _responsive,\n  Container,\n  type ContainerProps,\n  rem,\n  type ResponsiveWidthStyleProps,\n  useArrayProp,\n} from '@sanity/ui'\nimport {forwardRef, type ReactNode, type Ref} from 'react'\nimport styled from 'styled-components'\n\n// This is a workaround to make sure that the Container gets the correct width when used inside a popover.\n// The default Container uses `maxWidth` which doesn't work well with popovers because the popover\n// calculates its width based on the content width.\nconst StyledContainer = styled(Container)<ResponsiveWidthStyleProps>((props) => {\n  const {theme} = props\n  const {container, media} = theme.sanity\n\n  return _responsive(media, props.$width, (val) => ({\n    // Make sure that the Container gets the correct width when used inside a popover.\n    width: val === 'auto' ? 'none' : rem(container[val]),\n    // Make sure that the Container width is constrained by available space.\n    maxWidth: '100%',\n  }))\n})\n\ninterface PopoverContainerProps extends ContainerProps {\n  children: ReactNode\n}\n\nexport const PopoverContainer = forwardRef(function PopoverContainer(\n  props: PopoverContainerProps,\n  ref: Ref<HTMLDivElement>,\n) {\n  const {width, ...restProps} = props\n  const widthArr = useArrayProp(width)\n\n  return <StyledContainer {...restProps} data-ui=\"PopoverContainer\" $width={widthArr} ref={ref} />\n})\n","import {CloseIcon} from '@sanity/icons'\nimport {Box, Flex, Layer, type ResponsiveWidthProps, Stack, Text, type Theme} from '@sanity/ui'\nimport {type Dispatch, type ReactNode, type SetStateAction, useCallback} from 'react'\nimport TrapFocus from 'react-focus-lock'\nimport styled, {css} from 'styled-components'\n\nimport {Button, Popover, type PopoverProps} from '../../../ui-components'\nimport {PopoverContainer} from './PopoverContainer'\n\nconst StyledPopover = styled(Popover)(() => {\n  return css`\n    // Make the popover scrollable if it overflows the viewport\n    [data-ui='Popover__wrapper'] {\n      overflow: auto;\n    }\n  `\n})\n\n// This layer is sticky so that the header is always visible when scrolling\nconst StickyLayer = styled(Layer)((props: {theme: Theme}) => {\n  const radii = props.theme.sanity.radius[3]\n\n  return css`\n    position: sticky;\n    top: 0;\n    width: 100%;\n    background: var(--card-bg-color);\n    border-bottom: 1px solid var(--card-border-color);\n    border-top-left-radius: ${radii}px;\n    border-top-right-radius: ${radii}px;\n  `\n})\n\ninterface PopoverDialogProps {\n  children: ReactNode\n  header?: ReactNode\n  onClose: () => void\n  referenceElement: PopoverProps['referenceElement']\n  width: ResponsiveWidthProps['width']\n  containerRef?: Dispatch<SetStateAction<HTMLDivElement | null>>\n}\n\n/** @internal */\nexport function PopoverDialog(props: PopoverDialogProps) {\n  const {children, header, onClose, referenceElement, containerRef, width} = props\n\n  const handleClose = useCallback(() => {\n    onClose()\n\n    // Set focus to the reference element when closing\n    referenceElement?.focus()\n  }, [onClose, referenceElement])\n\n  // @todo: these use the same styles as dialogs, can this be shared?\n  const content = (\n    <PopoverContainer width={width}>\n      <TrapFocus autoFocus>\n        <Stack ref={containerRef}>\n          <StickyLayer>\n            <Box padding={2} paddingLeft={4}>\n              <Flex align=\"center\" gap={2}>\n                <Box flex={1}>\n                  <Text size={1} textOverflow=\"ellipsis\" weight=\"medium\">\n                    {header}\n                  </Text>\n                </Box>\n                <Button\n                  icon={CloseIcon}\n                  mode=\"bleed\"\n                  onClick={handleClose}\n                  tooltipProps={{content: 'Close'}}\n                />\n              </Flex>\n            </Box>\n          </StickyLayer>\n          <Box padding={4}>{children}</Box>\n        </Stack>\n      </TrapFocus>\n    </PopoverContainer>\n  )\n\n  // Note: if you come here to attempt to add support for Escape to close and/or clickOutside to close, please read this first:\n  //  - Escape must work with nested dialogs/popover. So if you have an array inside here that opens its items in another a popover,\n  //    hitting escape should only close the topmost dialog\n  //  - clickOutside needs to work through portals. So if you have an array inside here that opens its items in a dialog/portal,\n  //    any clicks inside such dialogs or portals should not cause _this_ popover to close\n  return (\n    <StyledPopover\n      portal\n      constrainSize\n      content={content}\n      open\n      referenceElement={referenceElement}\n    />\n  )\n}\n","import {Card, type CardProps} from '@sanity/ui'\nimport {createContext, type ForwardedRef, forwardRef, type HTMLProps, useContext} from 'react'\nimport styled, {css} from 'styled-components'\n\n/** @internal */\nconst StyledCard = styled(Card)(() => {\n  return css`\n    /* TextWithTone uses its own logic to set color, and we therefore need */\n    /* to override this logic in order to set the correct color in different states */\n    &[data-selected],\n    &[data-pressed],\n    &:active {\n      [data-ui='TextWithTone'] {\n        color: inherit;\n      }\n    }\n  `\n})\n\n/** @internal */\nexport interface PreviewCardContextValue {\n  selected?: boolean\n}\n\nconst PreviewCardContext = createContext<PreviewCardContextValue>({selected: false})\n\n/** @internal */\nexport function usePreviewCard(): PreviewCardContextValue {\n  const context = useContext(PreviewCardContext)\n\n  if (!context) {\n    throw new Error('PreviewCard: missing context value')\n  }\n\n  return context\n}\n\n/** @internal */\nexport const PreviewCard = forwardRef(function PreviewCard(\n  props: CardProps & Omit<HTMLProps<HTMLDivElement>, 'height'>,\n  ref: ForwardedRef<HTMLDivElement>,\n) {\n  const {children, selected, as, ...restProps} = props\n\n  return (\n    <StyledCard data-ui=\"PreviewCard\" {...restProps} forwardedAs={as} ref={ref} selected={selected}>\n      <PreviewCardContext.Provider value={{selected}}>{children}</PreviewCardContext.Provider>\n    </StyledCard>\n  )\n})\n","import {type PreviewLayoutKey} from './types'\n\nexport const PREVIEW_SIZES: Record<\n  PreviewLayoutKey,\n  {\n    icon: number\n    media: {height: number; width: number}\n  }\n> = {\n  block: {\n    icon: 25,\n    media: {width: 33, height: 33},\n  },\n  blockImage: {\n    icon: 25,\n    media: {width: 600, height: 400},\n  },\n  compact: {\n    icon: 21,\n    media: {width: 25, height: 25},\n  },\n  default: {\n    icon: 21,\n    media: {width: 33, height: 33},\n  },\n  detail: {\n    icon: 25,\n    media: {width: 73, height: 73},\n  },\n  inline: {\n    icon: 15,\n    media: {width: 15, height: 15},\n  },\n  media: {\n    icon: 25,\n    media: {width: 160, height: 160},\n  },\n}\n","import {rem} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nimport {PREVIEW_SIZES} from '../constants'\nimport {type PreviewLayoutKey, type PreviewMediaDimensions} from '../types'\n\nexport const MediaWrapper = styled.span<{\n  $dimensions: PreviewMediaDimensions\n  $layout: PreviewLayoutKey\n  $radius: number\n  $responsive: boolean\n}>((props) => {\n  const {$dimensions, $layout, $radius, $responsive} = props\n  const width = $dimensions.width || 0\n  const height = $dimensions.width || 0\n  const iconSize = PREVIEW_SIZES[$layout].icon\n\n  return css`\n    position: relative;\n    width: ${$responsive ? '100%' : rem(width)};\n    height: ${$responsive ? '100%' : rem(height)};\n    min-width: ${$responsive ? undefined : rem(width)};\n    border-radius: ${({theme}) => rem(theme.sanity.radius[$radius])};\n    display: flex;\n    overflow: hidden;\n    overflow: clip;\n    align-items: center;\n    justify-content: center;\n\n    & img {\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      object-fit: contain;\n      border-radius: inherit;\n    }\n\n    & svg {\n      // Shared styles for SVG icons\n      color: var(--card-icon-color);\n      display: block;\n      flex: 1;\n\n      // Specific styles for non Sanity icons\n      &:not([data-sanity-icon]) {\n        height: 1em;\n        width: 1em;\n        max-width: 1em;\n        max-height: 1em;\n      }\n\n      // Specific styles for Sanity icons\n      &[data-sanity-icon] {\n        display: block;\n        font-size: calc(${iconSize} / 16 * 1em);\n      }\n    }\n\n    & > span[data-border] {\n      display: block;\n      position: absolute;\n      left: 0;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      box-shadow: inset 0 0 0 1px var(--card-fg-color);\n      opacity: 0.1;\n      border-radius: inherit;\n      pointer-events: none;\n    }\n  `\n})\n\nMediaWrapper.displayName = 'MediaWrapper'\n","import {Text} from '@sanity/ui'\nimport {createElement, isValidElement, type ReactNode} from 'react'\nimport {isValidElementType} from 'react-is'\n\nimport {type PreviewLayoutKey, type PreviewMediaDimensions, type PreviewProps} from '../types'\nimport {MediaWrapper} from './Media.styled'\n\nexport interface MediaProps {\n  border?: boolean\n  dimensions: PreviewMediaDimensions\n  layout: PreviewLayoutKey\n  media: PreviewProps['media']\n  radius?: number\n  responsive?: boolean\n  styles?: {\n    media?: string\n    mediaString?: string\n  }\n}\n\nexport function Media(props: MediaProps) {\n  const {border = true, dimensions, layout, media, radius = 1, responsive = false, styles} = props\n\n  return (\n    <MediaWrapper\n      $dimensions={dimensions}\n      $layout={layout}\n      $radius={radius}\n      $responsive={responsive}\n      className={styles?.media}\n      data-testid=\"Media\"\n    >\n      {renderMedia({dimensions, layout, media})}\n      {border && <span data-border />}\n    </MediaWrapper>\n  )\n}\n\nfunction renderMedia(props: {\n  dimensions: PreviewMediaDimensions\n  layout: PreviewLayoutKey\n  media: PreviewProps['media']\n  styles?: {\n    media?: string\n    mediaString?: string\n  }\n}): ReactNode {\n  const {dimensions, layout, media, styles} = props\n\n  if (isValidElementType(media)) {\n    return createElement(media, {dimensions, layout})\n  }\n\n  if (typeof media === 'string') {\n    return (\n      <Text as=\"span\" className={styles?.mediaString} size={1}>\n        {media}\n      </Text>\n    )\n  }\n\n  if (isValidElement(media)) {\n    return media\n  }\n\n  return null\n}\n","import {createElement, type ElementType, type ReactNode} from 'react'\nimport {isValidElementType} from 'react-is'\n\nimport {type PreviewLayoutKey, type PreviewMediaDimensions} from './types'\n\nexport function renderPreviewMedia<Layout = PreviewLayoutKey>(\n  value: ReactNode | ElementType<{layout: Layout; dimensions: PreviewMediaDimensions}>,\n  layout: Layout,\n  dimensions: PreviewMediaDimensions,\n): ReactNode {\n  if (isValidElementType(value)) {\n    return createElement(value, {layout, dimensions})\n  }\n\n  if (typeof value === 'string') {\n    return <div>{value}</div>\n  }\n\n  // @todo: find out why `value` isn't infered as `ReactNode` here\n  return value as any\n}\n\nexport function renderPreviewNode<Layout = PreviewLayoutKey>(\n  value: ReactNode | ElementType<{layout: Layout}>,\n  layout: Layout,\n  fallbackNode?: ReactNode,\n): ReactNode {\n  if (typeof value === 'string') {\n    return value\n  }\n\n  if (isValidElementType(value)) {\n    return createElement(value, {layout})\n  }\n\n  // @todo: find out why `value` isn't infered as `ReactNode` here\n  return (value as any) || fallbackNode\n}\n","import {Box, Flex, rem, Skeleton, Stack, Text, TextSkeleton} from '@sanity/ui'\nimport styled from 'styled-components'\nimport {getDevicePixelRatio} from 'use-device-pixel-ratio'\n\nimport {useTranslation} from '../../../i18n'\nimport {Media} from '../_common/Media'\nimport {PREVIEW_SIZES} from '../constants'\nimport {renderPreviewNode} from '../helpers'\nimport {type PreviewMediaDimensions, type PreviewProps} from '../types'\n\n/**\n * @hidden\n * @beta */\nexport type CompactPreviewProps = Omit<PreviewProps<'compact'>, 'renderDefault'>\n\nconst DEFAULT_MEDIA_DIMENSIONS: PreviewMediaDimensions = {\n  ...PREVIEW_SIZES.compact.media,\n  aspect: 1,\n  fit: 'crop',\n  dpr: getDevicePixelRatio(),\n}\n\nconst Root = styled(Flex)`\n  height: ${rem(PREVIEW_SIZES.compact.media.height)};\n  box-sizing: content-box;\n`\n\nconst TitleSkeleton = styled(TextSkeleton).attrs({animated: true, radius: 1, size: 1})`\n  max-width: ${rem(160)};\n  width: 80%;\n`\n\n/**\n * @hidden\n * @beta */\nexport function CompactPreview(props: CompactPreviewProps) {\n  const {children, isPlaceholder, media, status, title} = props\n\n  const {t} = useTranslation()\n\n  const statusNode = status && (\n    <Box data-testid=\"compact-preview__status\" paddingLeft={4} paddingRight={1}>\n      {renderPreviewNode(status, 'compact')}\n    </Box>\n  )\n\n  if (isPlaceholder) {\n    return (\n      <Root\n        align=\"center\"\n        data-testid=\"default-preview\"\n        paddingLeft={media ? 1 : 2}\n        paddingRight={2}\n        paddingY={1}\n      >\n        <Flex align=\"center\" flex={1} gap={2}>\n          {media && <Skeleton animated radius={2} style={PREVIEW_SIZES.compact.media} />}\n\n          <Stack data-testid=\"compact-preview__heading\" flex={1} space={2}>\n            <TitleSkeleton />\n          </Stack>\n\n          {statusNode}\n        </Flex>\n      </Root>\n    )\n  }\n\n  return (\n    <Root\n      align=\"center\"\n      data-testid=\"compact-preview\"\n      paddingLeft={media ? 1 : 2}\n      paddingRight={2}\n      paddingY={1}\n    >\n      <Flex align=\"center\" flex={1} gap={2}>\n        {media && (\n          <Media\n            border={false}\n            dimensions={DEFAULT_MEDIA_DIMENSIONS}\n            layout=\"compact\"\n            media={media as any}\n          />\n        )}\n        <Stack data-testid=\"compact-preview__header\" flex={1} space={2}>\n          <Text size={1} style={{color: 'inherit'}} textOverflow=\"ellipsis\" weight=\"medium\">\n            {title && renderPreviewNode(title, 'compact')}\n            {!title && (\n              <span style={{color: 'var(--card-muted-fg-color)'}}>\n                {t('preview.default.title-fallback')}\n              </span>\n            )}\n          </Text>\n        </Stack>\n\n        {statusNode}\n      </Flex>\n\n      {children && <Box marginLeft={1}>{children}</Box>}\n    </Root>\n  )\n}\n","import {Box, Flex, rem, Skeleton, Stack, Text, TextSkeleton} from '@sanity/ui'\nimport classNames from 'classnames'\nimport styled from 'styled-components'\nimport {getDevicePixelRatio} from 'use-device-pixel-ratio'\n\nimport {useTranslation} from '../../../i18n'\nimport {Media} from '../_common/Media'\nimport {PREVIEW_SIZES} from '../constants'\nimport {renderPreviewNode} from '../helpers'\nimport {type PreviewMediaDimensions, type PreviewProps} from '../types'\n\n/**\n * @hidden\n * @beta */\nexport interface DefaultPreviewProps extends Omit<PreviewProps<'default'>, 'renderDefault'> {\n  styles?: {\n    root?: string\n    placeholder?: string\n    media?: string\n    heading?: string\n    title?: string\n    subtitle?: string\n    hasSubtitle?: string\n    mediaString?: string\n    status?: string\n    children?: string\n  }\n}\n\nconst DEFAULT_MEDIA_DIMENSIONS: PreviewMediaDimensions = {\n  ...PREVIEW_SIZES.default.media,\n  aspect: 1,\n  fit: 'crop',\n  dpr: getDevicePixelRatio(),\n}\n\nconst Root = styled(Flex)`\n  height: ${rem(PREVIEW_SIZES.default.media.height)};\n  box-sizing: content-box;\n`\n\nconst TitleSkeleton = styled(TextSkeleton).attrs({animated: true, radius: 1, size: 1})`\n  max-width: ${rem(160)};\n  width: 80%;\n`\n\nconst SubtitleSkeleton = styled(TextSkeleton).attrs({animated: true, radius: 1, size: 1})`\n  max-width: ${rem(120)};\n  width: 60%;\n`\n\n/**\n * @hidden\n * @beta */\nexport function DefaultPreview(props: DefaultPreviewProps) {\n  const {title, subtitle, media, status, isPlaceholder, children, styles} = props\n  const {t} = useTranslation()\n  const rootClassName = classNames(styles?.root, Boolean(subtitle) && styles?.hasSubtitle)\n\n  const statusNode = status && (\n    <Box className={styles?.status} data-testid=\"default-preview__status\">\n      {renderPreviewNode(status, 'default')}\n    </Box>\n  )\n\n  if (isPlaceholder) {\n    return (\n      <Root\n        align=\"center\"\n        className={styles?.placeholder}\n        data-testid=\"default-preview\"\n        padding={2}\n        paddingLeft={media ? 2 : 3}\n      >\n        <Flex align=\"center\" flex={1} gap={2}>\n          {media && (\n            <Box flex=\"none\">\n              <Skeleton animated radius={1} style={PREVIEW_SIZES.default.media} />\n            </Box>\n          )}\n\n          <Stack data-testid=\"default-preview__heading\" flex={1} space={2}>\n            <TitleSkeleton />\n            <SubtitleSkeleton />\n          </Stack>\n\n          <Box flex=\"none\" padding={1}>\n            {statusNode}\n          </Box>\n        </Flex>\n      </Root>\n    )\n  }\n\n  return (\n    <Root\n      align=\"center\"\n      className={rootClassName}\n      data-testid=\"default-preview\"\n      padding={2}\n      paddingLeft={media ? 2 : 3}\n    >\n      <Flex align=\"center\" flex={1} gap={2}>\n        {media && (\n          <Box flex=\"none\">\n            <Media\n              dimensions={DEFAULT_MEDIA_DIMENSIONS}\n              layout=\"default\"\n              media={media as any}\n              styles={styles}\n            />\n          </Box>\n        )}\n\n        <Stack className={styles?.heading} data-testid=\"default-preview__header\" flex={1} space={2}>\n          <Text\n            className={styles?.title}\n            size={1}\n            style={{color: 'inherit'}}\n            textOverflow=\"ellipsis\"\n            weight=\"medium\"\n          >\n            {title && renderPreviewNode(title, 'default')}\n            {!title && (\n              <span style={{color: 'var(--card-muted-fg-color)'}}>\n                {t('preview.default.title-fallback')}\n              </span>\n            )}\n          </Text>\n\n          {subtitle && (\n            <Text muted size={1} textOverflow=\"ellipsis\" className={styles?.subtitle}>\n              {renderPreviewNode(subtitle, 'default')}\n            </Text>\n          )}\n        </Stack>\n\n        <Box flex=\"none\" padding={1}>\n          {statusNode}\n        </Box>\n\n        {children && <div className={styles?.children}>{children}</div>}\n      </Flex>\n    </Root>\n  )\n}\n","import {Box, Flex, rem, Skeleton, Text, TextSkeleton} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nimport {PREVIEW_SIZES} from '../constants'\n\nexport const RootFlex = styled(Flex).attrs({align: 'center'})`\n  height: ${rem(PREVIEW_SIZES.detail.media.height)};\n`\n\nexport const StatusBox = styled(Box)`\n  white-space: nowrap;\n`\n\nexport const MediaSkeleton = styled(Skeleton).attrs({animated: true, radius: 2})`\n  width: ${rem(PREVIEW_SIZES.detail.media.width)};\n  height: ${rem(PREVIEW_SIZES.detail.media.height)};\n`\n\nexport const TitleSkeleton = styled(TextSkeleton).attrs({animated: true, radius: 1, size: 1})`\n  max-width: ${rem(160)}; /* 80% of 200px */\n  width: 80%;\n`\n\nexport const SubtitleSkeleton = styled(TextSkeleton).attrs({animated: true, radius: 1, size: 1})`\n  max-width: ${rem(120)}; /* 60% of 200px */\n  width: 60%;\n`\n\nexport const DescriptionSkeleton = styled(TextSkeleton).attrs({animated: true, radius: 1, size: 1})`\n  max-width: ${rem(180)}; /* 90% of 200px */\n  width: 90%;\n`\n\nexport const DescriptionText = styled(Text)(({theme}) => {\n  const {fonts} = theme.sanity\n  const textSize1 = fonts.text.sizes[1]\n  const maxLines = 2\n  const maxHeight = textSize1.lineHeight * maxLines\n\n  return css`\n    & > span {\n      max-height: ${rem(maxHeight)};\n\n      /* Multi-line text overflow */\n      display: -webkit-box;\n      overflow: hidden;\n      overflow: clip;\n      text-overflow: ellipsis;\n      -webkit-line-clamp: ${maxLines};\n      -webkit-box-orient: vertical;\n    }\n  `\n})\n","import {Box, Flex, Stack, Text} from '@sanity/ui'\nimport {getDevicePixelRatio} from 'use-device-pixel-ratio'\n\nimport {useTranslation} from '../../../i18n'\nimport {Media} from '../_common/Media'\nimport {PREVIEW_SIZES} from '../constants'\nimport {renderPreviewNode} from '../helpers'\nimport {type PreviewMediaDimensions, type PreviewProps} from '../types'\nimport {\n  DescriptionSkeleton,\n  DescriptionText,\n  MediaSkeleton,\n  RootFlex,\n  StatusBox,\n  SubtitleSkeleton,\n  TitleSkeleton,\n} from './DetailPreview.styled'\n\n/**\n * @hidden\n * @beta */\nexport type DetailPreviewProps = PreviewProps<'detail'>\n\nconst DEFAULT_MEDIA_DIMENSIONS: PreviewMediaDimensions = {\n  ...PREVIEW_SIZES.detail.media,\n  fit: 'crop',\n  aspect: 1,\n  dpr: getDevicePixelRatio(),\n}\n\n/**\n * @hidden\n * @beta */\nexport function DetailPreview(props: DetailPreviewProps) {\n  const {\n    title,\n    subtitle,\n    description,\n    mediaDimensions = DEFAULT_MEDIA_DIMENSIONS,\n    media,\n    status,\n    children,\n    isPlaceholder,\n  } = props\n  const {t} = useTranslation()\n\n  const statusNode = status && (\n    <StatusBox marginLeft={3} paddingRight={1}>\n      {renderPreviewNode(status, 'detail')}\n    </StatusBox>\n  )\n\n  if (isPlaceholder) {\n    return (\n      <RootFlex\n        data-testid=\"detail-preview\"\n        paddingLeft={media ? 2 : 3}\n        paddingRight={2}\n        paddingY={2}\n      >\n        <Flex align=\"center\" flex={1} gap={3}>\n          {media && <MediaSkeleton data-testid=\"detail-preview__media\" />}\n\n          <Flex align=\"center\" data-testid=\"detail-preview__header\" flex={1}>\n            <Stack flex={1} space={2}>\n              <TitleSkeleton />\n              <SubtitleSkeleton />\n              {description && (\n                <Box marginTop={1}>\n                  <DescriptionSkeleton />\n                </Box>\n              )}\n            </Stack>\n          </Flex>\n\n          {statusNode}\n        </Flex>\n      </RootFlex>\n    )\n  }\n\n  return (\n    <RootFlex\n      data-testid=\"detail-preview\"\n      paddingLeft={media ? 2 : 3}\n      paddingRight={2}\n      paddingY={2}\n    >\n      <Flex align=\"center\" flex={1} gap={3}>\n        {media && <Media dimensions={mediaDimensions} layout=\"detail\" media={media as any} />}\n\n        <Flex align=\"center\" data-testid=\"detail-preview__header\" flex={1}>\n          <Stack flex={1} space={2}>\n            <Text textOverflow=\"ellipsis\" size={1} style={{color: 'inherit'}} weight=\"medium\">\n              {title && renderPreviewNode(title, 'detail')}\n              {!title && <>{t('preview.default.title-fallback')}</>}\n            </Text>\n\n            {subtitle && (\n              <Text muted size={1} textOverflow=\"ellipsis\">\n                {renderPreviewNode(subtitle, 'detail')}\n              </Text>\n            )}\n\n            {description && (\n              <Box marginTop={1}>\n                <DescriptionText muted size={1}>\n                  {renderPreviewNode(description, 'detail')}\n                </DescriptionText>\n              </Box>\n            )}\n          </Stack>\n\n          {statusNode}\n        </Flex>\n\n        {children}\n      </Flex>\n    </RootFlex>\n  )\n}\n","import {hues} from '@sanity/color'\nimport {type Theme} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nconst SIZE = 43\nconst STROKE_WIDTH = 3\n\nconst Root = styled.svg`\n  width: ${SIZE}px;\n  height: ${SIZE}px;\n  transform: rotate(-90deg);\n`\n\nconst BgCircle = styled.circle(({theme}: {theme: Theme}) => {\n  const {color} = theme.sanity\n\n  return css`\n    fill: none;\n    stroke: ${hues.gray[color.dark ? 900 : 100].hex};\n    stroke-width: ${STROKE_WIDTH}px;\n  `\n})\n\nconst ProgressCircle = styled.circle(({theme}: {theme: Theme}) => {\n  const {color} = theme.sanity\n\n  return css`\n    fill: none;\n    stroke: ${hues.blue[color.dark ? 400 : 500].hex};\n    stroke-width: ${STROKE_WIDTH}px;\n    transition: stroke-dashoffset 75ms;\n  `\n})\n\n/**\n * @hidden\n * @beta */\nexport function CircularProgress(props: {\n  /** Percentage */\n  value: number\n}) {\n  const {value: valueProp} = props\n  const value = Math.min(Math.max(valueProp, 0), 100)\n  const radius = SIZE / 2 - STROKE_WIDTH / 2\n  const circ = 2 * Math.PI * radius\n  const offset = ((100 - value) / 100) * circ\n  const viewBox = `${SIZE / 2} ${SIZE / 2} ${SIZE} ${SIZE}`\n\n  return (\n    <Root viewBox={viewBox}>\n      <BgCircle cx={SIZE} cy={SIZE} r={radius} />\n      <ProgressCircle\n        cx={SIZE}\n        cy={SIZE}\n        r={radius}\n        style={{\n          strokeDasharray: circ,\n          strokeDashoffset: `${offset}px`,\n        }}\n      />\n    </Root>\n  )\n}\n","import {hues} from '@sanity/color'\nimport {Card, type Theme} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nconst STROKE_WIDTH = 0.5\n\nconst Root = styled(Card)`\n  overflow: hidden;\n  overflow: clip;\n`\n\nconst Bar = styled(Card)(({theme}: {theme: Theme}) => {\n  const {color} = theme.sanity\n\n  return css`\n    height: ${STROKE_WIDTH}rem;\n    background: ${hues.blue[color.dark ? 400 : 500].hex};\n    transition: transform 75ms;\n  `\n})\n\n/**\n * @hidden\n * @beta */\nexport function LinearProgress(props: {\n  /** Percentage */\n  value: number\n}) {\n  const {value} = props\n\n  return (\n    <Root radius={5}>\n      <Bar radius={5} style={{transform: `translate3d(${value - 100}%, 0, 0)`}} />\n    </Root>\n  )\n}\n","import {Box, Flex, rem, Skeleton, Stack} from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const RootBox = styled(Box)`\n  position: relative;\n`\n\nexport const MediaFlex = styled(Flex).attrs({align: 'center', justify: 'center'})`\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n`\n\nexport const MediaSkeleton = styled(Skeleton).attrs({animated: true, radius: 2})`\n  width: 100%;\n  height: 100%;\n`\n\nexport const ProgressFlex = styled(Flex).attrs({align: 'center', justify: 'center'})`\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n\n  &:before {\n    background-color: var(--card-bg-color);\n    opacity: 0.75;\n    content: '';\n    display: block;\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n  }\n\n  > svg {\n    position: relative;\n    z-index: 2;\n  }\n`\n\nexport const TooltipContentStack = styled(Stack).attrs({space: 2})`\n  max-width: ${rem(200)};\n`\n","import {Box, Text} from '@sanity/ui'\nimport {useMemo} from 'react'\nimport {getDevicePixelRatio} from 'use-device-pixel-ratio'\n\nimport {Tooltip} from '../../../../ui-components'\nimport {CircularProgress} from '../../progress'\nimport {Media} from '../_common/Media'\nimport {PREVIEW_SIZES} from '../constants'\nimport {renderPreviewNode} from '../helpers'\nimport {type PreviewMediaDimensions, type PreviewProps} from '../types'\nimport {\n  MediaFlex,\n  MediaSkeleton,\n  ProgressFlex,\n  RootBox,\n  TooltipContentStack,\n} from './MediaPreview.styled'\n\n/**\n * @hidden\n * @beta */\nexport type MediaPreviewProps = Omit<PreviewProps<'media'>, 'renderDefault'>\n\nconst DEFAULT_MEDIA_DIMENSIONS: PreviewMediaDimensions = {\n  ...PREVIEW_SIZES.media.media,\n  aspect: 1,\n  fit: 'crop',\n  dpr: getDevicePixelRatio(),\n}\n\n/**\n * @hidden\n * @beta */\nexport function MediaPreview(props: MediaPreviewProps) {\n  const {\n    media,\n    mediaDimensions = DEFAULT_MEDIA_DIMENSIONS,\n    children,\n    isPlaceholder,\n    progress = -1,\n    subtitle,\n    title,\n    withBorder = true,\n    withRadius = true,\n  } = props\n\n  const aspect = mediaDimensions.aspect || 1\n\n  const STYLES_PADDER = useMemo(() => ({paddingBottom: `${100 / aspect}%`}), [aspect])\n\n  const tooltipContent = useMemo(() => {\n    if (!title || !subtitle) {\n      return null\n    }\n\n    return (\n      <TooltipContentStack>\n        {title && (\n          <Text align=\"center\" size={1} weight=\"medium\">\n            {renderPreviewNode(title, 'media')}\n          </Text>\n        )}\n\n        {subtitle && (\n          <Text align=\"center\" muted size={1}>\n            {renderPreviewNode(subtitle, 'media')}\n          </Text>\n        )}\n      </TooltipContentStack>\n    )\n  }, [subtitle, title])\n\n  return (\n    <Box padding={2}>\n      <RootBox data-testid=\"media-preview\" flex={1} overflow=\"hidden\">\n        <div style={STYLES_PADDER} />\n\n        <Tooltip content={tooltipContent} disabled={!tooltipContent} placement=\"top\" portal>\n          <MediaFlex>\n            {isPlaceholder ? (\n              <MediaSkeleton />\n            ) : (\n              <Media\n                border={withBorder}\n                dimensions={mediaDimensions}\n                layout=\"media\"\n                media={media as any}\n                radius={withRadius ? 1 : 0}\n                responsive\n              />\n            )}\n\n            {typeof progress === 'number' && progress > -1 && (\n              <ProgressFlex>\n                <CircularProgress value={progress} />\n              </ProgressFlex>\n            )}\n          </MediaFlex>\n        </Tooltip>\n\n        {children}\n      </RootBox>\n    </Box>\n  )\n}\n","import {Box, Card, Flex, rem} from '@sanity/ui'\nimport styled from 'styled-components'\n\nimport {PREVIEW_SIZES} from '../constants'\n\nexport const HeaderFlex = styled(Flex).attrs({align: 'center'})`\n  height: ${rem(PREVIEW_SIZES.block.media.height)};\n  white-space: nowrap;\n  position: relative;\n  z-index: 1;\n`\n\nexport const MediaCard = styled(Card)<{$ratio: number}>`\n  overflow: hidden;\n  position: relative;\n  padding-bottom: ${({$ratio}) => $ratio}%;\n\n  & > span {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n  }\n`\n\nexport const RootBox = styled(Box).attrs({overflow: 'hidden'})`\n  border-radius: ${({theme}) => theme.sanity.radius[1]}px;\n`\n","import {Box, Flex, Stack, Text} from '@sanity/ui'\nimport {getDevicePixelRatio} from 'use-device-pixel-ratio'\n\nimport {Media} from '../_common/Media'\nimport {PREVIEW_SIZES} from '../constants'\nimport {renderPreviewNode} from '../helpers'\nimport {type PreviewMediaDimensions, type PreviewProps} from '../types'\nimport {HeaderFlex, MediaCard, RootBox} from './BlockImagePreview.styled'\n\n/**\n * @hidden\n * @beta */\nexport type BlockImagePreviewProps = Omit<PreviewProps<'blockImage'>, 'renderDefault'>\n\nconst DEFAULT_MEDIA_DIMENSIONS: PreviewMediaDimensions = {\n  ...PREVIEW_SIZES.blockImage.media,\n  fit: 'fillmax',\n  dpr: getDevicePixelRatio(),\n}\n\nconst getRatio = (dimensions: PreviewMediaDimensions) => {\n  const {height, width} = dimensions\n\n  if (!height || !width) {\n    return 1\n  }\n\n  return (height / width) * 100\n}\n\n/**\n * @hidden\n * @beta */\nexport function BlockImagePreview(props: BlockImagePreviewProps) {\n  const {\n    actions,\n    title,\n    subtitle,\n    description,\n    fallbackTitle = 'Untitled',\n    mediaDimensions = DEFAULT_MEDIA_DIMENSIONS,\n    media,\n    children,\n    status,\n  } = props\n\n  return (\n    <RootBox>\n      <Stack>\n        <HeaderFlex paddingBottom={3} paddingLeft={2} paddingRight={1} paddingTop={1}>\n          <Stack flex={1} space={2}>\n            {(title || fallbackTitle) && (\n              <Text size={1} textOverflow=\"ellipsis\" weight=\"medium\">\n                {title ? renderPreviewNode(title as any, 'block') : fallbackTitle}\n              </Text>\n            )}\n\n            {subtitle && (\n              <Text muted size={1} textOverflow=\"ellipsis\">\n                {renderPreviewNode(subtitle as any, 'block')}\n              </Text>\n            )}\n          </Stack>\n\n          <Flex gap={1} paddingLeft={1}>\n            {status && (\n              <Box paddingX={2} paddingY={3}>\n                {renderPreviewNode(status as any, 'block')}\n              </Box>\n            )}\n\n            {actions as any}\n          </Flex>\n        </HeaderFlex>\n\n        <MediaCard\n          $ratio={getRatio(mediaDimensions)}\n          __unstable_checkered\n          display=\"flex\"\n          sizing=\"border\"\n          radius={2}\n          tone=\"inherit\"\n        >\n          <Media\n            border={false}\n            dimensions={mediaDimensions}\n            layout=\"blockImage\"\n            media={media as any}\n            radius={0}\n            responsive\n          />\n        </MediaCard>\n      </Stack>\n\n      {description && (\n        <Box paddingX={2} paddingY={3}>\n          <Text muted size={1}>\n            {renderPreviewNode(description as any, 'block')}\n          </Text>\n        </Box>\n      )}\n\n      {children && <div>{children}</div>}\n    </RootBox>\n  )\n}\n","import {Box, Flex, rem, Stack, Text} from '@sanity/ui'\nimport styled from 'styled-components'\nimport {getDevicePixelRatio} from 'use-device-pixel-ratio'\n\nimport {Media} from '../_common/Media'\nimport {PREVIEW_SIZES} from '../constants'\nimport {renderPreviewNode} from '../helpers'\nimport {type PreviewMediaDimensions, type PreviewProps} from '../types'\n\nconst DEFAULT_MEDIA_DIMENSIONS: PreviewMediaDimensions = {\n  ...PREVIEW_SIZES.block.media,\n  aspect: 1,\n  fit: 'crop',\n  dpr: getDevicePixelRatio(),\n}\n\nconst HeaderFlex = styled(Flex).attrs({align: 'center'})`\n  min-height: ${rem(PREVIEW_SIZES.block.media.height)};\n`\n\n/**\n * @hidden\n * @beta */\nexport function BlockPreview(props: Omit<PreviewProps<'block'>, 'renderDefault'>) {\n  const {\n    actions,\n    title,\n    subtitle,\n    description,\n    mediaDimensions = DEFAULT_MEDIA_DIMENSIONS,\n    media,\n    status,\n    children,\n  } = props\n\n  return (\n    <Stack data-testid=\"block-preview\" space={1}>\n      <HeaderFlex data-testid=\"block-preview__header\">\n        {media && <Media dimensions={mediaDimensions} layout=\"block\" media={media as any} />}\n\n        <Box flex={1} paddingLeft={media ? 2 : 1}>\n          <Text size={1} textOverflow=\"ellipsis\" weight=\"medium\">\n            {title ? renderPreviewNode(title, 'block') : 'Untitled'}\n          </Text>\n\n          {subtitle && (\n            <Box marginTop={2}>\n              <Text muted size={1} textOverflow=\"ellipsis\">\n                {renderPreviewNode(subtitle, 'block')}\n              </Text>\n            </Box>\n          )}\n\n          {description && (\n            <Box marginTop={3}>\n              <Text muted size={1} textOverflow=\"ellipsis\">\n                {renderPreviewNode(description, 'block')}\n              </Text>\n            </Box>\n          )}\n        </Box>\n\n        <Flex gap={1} paddingLeft={1}>\n          {status && (\n            <Box paddingX={2} paddingY={3}>\n              {renderPreviewNode(status, 'block')}\n            </Box>\n          )}\n\n          {actions as any}\n        </Flex>\n      </HeaderFlex>\n\n      {children && <div data-testid=\"block-preview__children\">{children}</div>}\n    </Stack>\n  )\n}\n","import {rem, Text, type Theme} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nexport const RootSpan = styled.span`\n  display: inline-flex;\n  align-items: center;\n  vertical-align: top;\n  height: calc(1em - 1px);\n  max-width: 100%;\n`\n\nexport const MediaSpan = styled.span`\n  position: relative;\n  display: inline-block;\n  width: calc(1em - 1px);\n  height: calc(1em - 1px);\n  min-width: calc(1em - 1px);\n\n  & img {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    border-radius: ${({theme}) => rem(theme.sanity.radius[1])};\n  }\n\n  & img + span {\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    box-shadow: inset 0 0 0 1px var(--card-fg-color);\n    opacity: 0.2;\n    border-radius: ${({theme}) => rem(theme.sanity.radius[1])};\n  }\n\n  & svg {\n    display: block;\n    font-size: calc(14 / 16 * 1em);\n    margin: 1px 0;\n\n    &[data-sanity-icon] {\n      font-size: calc(18 / 16 * 1em);\n      margin: calc(1px + (2 / 18 * -1em)) 0;\n    }\n  }\n`\n\nexport const TextSpan = styled(Text).attrs({forwardedAs: 'span'})(({theme}: {theme: Theme}) => {\n  const textFont = theme.sanity.fonts.text\n  const textSize = textFont.sizes[1]\n\n  return css`\n    font-size: calc(${textSize.fontSize} / 16 * 1em);\n    font-weight: ${textFont.weights.medium};\n    box-sizing: border-box;\n    display: inline-block;\n    vertical-align: top;\n    line-height: ${textSize.lineHeight / textSize.fontSize};\n    padding-left: 0.5em;\n    padding-right: calc(0.5em - 2px);\n    min-width: 0;\n\n    & > span {\n      display: block;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      overflow: hidden;\n      overflow: clip;\n    }\n  `\n})\n","import {getDevicePixelRatio} from 'use-device-pixel-ratio'\n\nimport {PREVIEW_SIZES} from '../constants'\nimport {renderPreviewMedia, renderPreviewNode} from '../helpers'\nimport {type PreviewMediaDimensions, type PreviewProps} from '../types'\nimport {MediaSpan, RootSpan, TextSpan} from './InlinePreview.styled'\n\n/**\n * @hidden\n * @beta */\nexport type InlinePreviewProps = Omit<PreviewProps<'inline'>, 'renderDefault'>\n\nconst DEFAULT_MEDIA_DIMENSIONS: PreviewMediaDimensions = {\n  ...PREVIEW_SIZES.inline.media,\n  fit: 'crop',\n  aspect: 1,\n  dpr: getDevicePixelRatio(),\n}\n\n/**\n * @hidden\n * @beta */\nexport function InlinePreview(props: InlinePreviewProps) {\n  const {\n    title,\n    fallbackTitle = 'Untitled',\n    media,\n    mediaDimensions = DEFAULT_MEDIA_DIMENSIONS,\n  } = props\n\n  return (\n    <RootSpan data-testid=\"inline-preview\">\n      {media && (\n        <MediaSpan data-testid=\"inline-preview-media\">\n          {renderPreviewMedia(media, 'inline', mediaDimensions)}\n          <span />\n        </MediaSpan>\n      )}\n\n      <TextSpan data-testid=\"inline-preview-title\" size={1}>\n        {renderPreviewNode(title, 'inline', fallbackTitle)}\n      </TextSpan>\n    </RootSpan>\n  )\n}\n","import {Box, Flex, rem, Stack, Text, TextSkeleton} from '@sanity/ui'\nimport {createElement, type ElementType, isValidElement, type ReactNode} from 'react'\nimport {isValidElementType} from 'react-is'\nimport styled from 'styled-components'\nimport {getDevicePixelRatio} from 'use-device-pixel-ratio'\n\nimport {Media, type MediaProps} from '../_common/Media'\nimport {PREVIEW_SIZES} from '../constants'\nimport {type PreviewMediaDimensions} from '../types'\n\n/**\n * @hidden\n * @beta */\nexport interface TemplatePreviewProps {\n  description?: ReactNode\n  isPlaceholder?: boolean\n  media?: MediaProps['media']\n  mediaDimensions?: PreviewMediaDimensions\n  subtitle?: ElementType<{layout: 'default'}> | ReactNode\n  title?: ElementType<{layout: 'default'}> | ReactNode\n}\n\nconst DEFAULT_MEDIA_DIMENSION: PreviewMediaDimensions = {\n  ...PREVIEW_SIZES.default.media,\n  aspect: 1,\n  fit: 'crop',\n  dpr: getDevicePixelRatio(),\n}\n\nconst Root = styled(Box)`\n  height: 100%;\n\n  a {\n    color: currentColor;\n    text-decoration: none;\n  }\n\n  svg[data-sanity-icon] {\n    margin: 0;\n  }\n`\n\nconst HeaderFlex = styled(Flex).attrs({align: 'center'})`\n  height: ${rem(PREVIEW_SIZES.default.media.height)};\n`\n\nconst TitleSkeleton = styled(TextSkeleton).attrs({animated: true, radius: 1})`\n  max-width: ${rem(160)};\n  width: 80%;\n`\n\nconst SubtitleSkeleton = styled(TextSkeleton).attrs({animated: true, radius: 1, size: 1})`\n  max-width: ${rem(120)};\n  width: 60%;\n`\n\n/**\n * @hidden\n * @beta */\nexport function TemplatePreview(props: TemplatePreviewProps) {\n  const {\n    description,\n    isPlaceholder,\n    media,\n    mediaDimensions = DEFAULT_MEDIA_DIMENSION,\n    subtitle,\n    title = 'Untitled',\n  } = props\n\n  if (isPlaceholder) {\n    return (\n      <Root>\n        <HeaderFlex>\n          <Stack flex={1} space={2}>\n            <TitleSkeleton />\n            <SubtitleSkeleton />\n          </Stack>\n        </HeaderFlex>\n      </Root>\n    )\n  }\n\n  return (\n    <Root>\n      <HeaderFlex>\n        <Stack flex={1} space={2}>\n          {isValidElementType(title) && (\n            <Text textOverflow=\"ellipsis\">{createElement(title, {layout: 'default'})}</Text>\n          )}\n          {isValidElement(title) && <Text textOverflow=\"ellipsis\">{title}</Text>}\n\n          {isValidElementType(subtitle) && (\n            <Text muted size={1} textOverflow=\"ellipsis\">\n              {createElement(subtitle, {layout: 'default'})}\n            </Text>\n          )}\n          {isValidElement(subtitle) && (\n            <Text muted size={1} textOverflow=\"ellipsis\">\n              {subtitle}\n            </Text>\n          )}\n        </Stack>\n\n        {media && (\n          <Flex align=\"flex-start\" paddingLeft={2}>\n            <Media dimensions={mediaDimensions} layout=\"default\" media={media} />\n          </Flex>\n        )}\n      </HeaderFlex>\n\n      {description && (\n        <Box marginTop={3}>\n          <Text muted size={1} style={{whiteSpace: 'break-spaces'}}>\n            {description}\n          </Text>\n        </Box>\n      )}\n    </Root>\n  )\n}\n","import {useCallback, useEffect, useState} from 'react'\n\nimport {type RovingFocusProps} from './types'\n\nconst MUTATION_ATTRIBUTE_FILTER = ['aria-hidden', 'disabled', 'href']\n\nconst FOCUSABLE =\n  'a[href], button, input, textarea, select, details, [tabindex]:not([tabindex=\"-1\"])'\n\nfunction getFocusableElements(element: HTMLElement) {\n  return [...(element.querySelectorAll(FOCUSABLE) as any)].filter(\n    (el) => !el.hasAttribute('disabled') && el.getAttribute('aria-hidden') !== 'true',\n  ) as HTMLElement[]\n}\n\n/**\n * This hook handles focus with the keyboard arrows.\n *\n * @see {@link https://a11y-solutions.stevenwoodson.com/solutions/focus/roving-focus/ | Roving focus definition}\n *\n * @example\n * ```tsx\n * function MyComponent() {\n *   const [rootElement, setRootElement] = setRootElement(null)\n *\n *   useRovingFocus({\n *     rootElement: rootElement,\n *   })\n *\n *   return (\n *     <div ref={setRootElement}>\n *       <button>Button</button>\n *       <button>Button</button>\n *       <button>Button</button>\n *     </div>\n *   )\n * }\n * ```\n *\n *\n * @hidden\n * @beta\n */\nexport function useRovingFocus(props: RovingFocusProps): undefined {\n  const {\n    direction = 'horizontal',\n    initialFocus,\n    loop = true,\n    navigation = ['arrows'],\n    pause = false,\n    rootElement,\n  } = props\n  const [focusedIndex, setFocusedIndex] = useState<number>(-1)\n  const [focusableElements, setFocusableElements] = useState<HTMLElement[]>([])\n\n  const focusableLen = focusableElements.length\n  const lastFocusableIndex = focusableLen - 1\n\n  /**\n   * Determine what keys to listen to depending on direction\n   */\n  const nextKey = direction === 'horizontal' ? 'ArrowRight' : 'ArrowDown'\n  const prevKey = direction === 'horizontal' ? 'ArrowLeft' : 'ArrowUp'\n\n  /**\n   * Set focusable elements in state\n   */\n  const handleSetElements = useCallback(() => {\n    if (rootElement) {\n      const els = getFocusableElements(rootElement)\n\n      setFocusableElements(els)\n    }\n  }, [rootElement])\n\n  /**\n   * Set focused index\n   */\n  const handleFocus = useCallback((index: number) => {\n    setFocusedIndex(index)\n  }, [])\n\n  /**\n   * Handle increment/decrement of focusedIndex\n   */\n  const handleKeyDown = useCallback(\n    (event: any) => {\n      if (pause) {\n        return\n      }\n\n      const focusPrev = () => {\n        event.preventDefault()\n        setFocusedIndex((prevIndex) => {\n          const next = (prevIndex + lastFocusableIndex) % focusableLen\n\n          if (!loop && next === lastFocusableIndex) {\n            return prevIndex\n          }\n\n          return next\n        })\n      }\n\n      const focusNext = () => {\n        event.preventDefault()\n        setFocusedIndex((prevIndex) => {\n          const next = (prevIndex + 1) % focusableLen\n\n          if (!loop && next === 0) {\n            return prevIndex\n          }\n\n          return next\n        })\n      }\n\n      if (event.key === 'Tab' && navigation.includes('tab')) {\n        if (event.shiftKey) {\n          focusPrev()\n        } else {\n          focusNext()\n        }\n      }\n\n      if (navigation.includes('arrows')) {\n        if (event.key === prevKey) {\n          focusPrev()\n        }\n\n        if (event.key === nextKey) {\n          focusNext()\n        }\n      }\n    },\n    [pause, prevKey, navigation, nextKey, lastFocusableIndex, focusableLen, loop],\n  )\n\n  /**\n   * Set focusable elements on mount\n   */\n  useEffect(() => {\n    handleSetElements()\n  }, [handleSetElements, initialFocus, direction])\n\n  /**\n   * Listen to DOM mutations to update focusableElements with latest state\n   */\n  useEffect(() => {\n    const mo = new MutationObserver(handleSetElements)\n\n    if (rootElement) {\n      mo.observe(rootElement, {\n        childList: true,\n        subtree: true,\n        attributeFilter: MUTATION_ATTRIBUTE_FILTER,\n      })\n    }\n\n    return () => {\n      mo.disconnect()\n    }\n  }, [focusableElements, handleSetElements, rootElement])\n\n  /**\n   * Set focus on elements in focusableElements depending on focusedIndex\n   */\n  useEffect(() => {\n    focusableElements.forEach((el, index) => {\n      if (index === focusedIndex) {\n        el.setAttribute('tabIndex', '0')\n        el.setAttribute('aria-selected', 'true')\n        el.focus()\n        el.onfocus = () => handleFocus(index)\n        el.onblur = () => handleFocus(-1)\n      } else {\n        el.setAttribute('tabIndex', '-1')\n        el.setAttribute('aria-selected', 'false')\n        el.onfocus = () => handleFocus(index)\n      }\n    })\n\n    if (focusedIndex === -1 && focusableElements) {\n      const initialIndex = initialFocus === 'last' ? lastFocusableIndex : 0\n      focusableElements[initialIndex]?.setAttribute('tabIndex', '0')\n    }\n  }, [focusableElements, focusedIndex, handleFocus, initialFocus, lastFocusableIndex])\n\n  /**\n   * Listen to key down events on rootElement\n   */\n  useEffect(() => {\n    rootElement?.addEventListener('keydown', handleKeyDown)\n\n    return () => {\n      rootElement?.removeEventListener('keydown', handleKeyDown)\n    }\n  }, [handleKeyDown, rootElement])\n\n  return undefined\n}\n","import {useTheme} from '@sanity/ui'\nimport {type ForwardedRef, forwardRef, type HTMLProps, type ReactNode, useMemo} from 'react'\nimport {useTranslation} from 'react-i18next'\nimport styled from 'styled-components'\n\nimport {Button, type ButtonProps} from '../../ui-components'\n\n/** @hidden @beta */\nexport type StatusButtonProps = ButtonProps & {\n  forwardedAs?: string\n  disabled?: boolean | {reason: ReactNode}\n  mode?: ButtonProps['mode']\n  iconRight?: undefined\n}\n\nconst StyledButton = styled(Button)`\n  position: relative;\n  // The children in button is rendered inside a span, we need to absolutely position it.\n  & > span:nth-child(2) {\n    position: absolute;\n    top: 6px;\n    right: 6px;\n    padding: 0;\n  }\n`\n\nconst Dot = styled.div({\n  width: 4,\n  height: 4,\n  borderRadius: 3,\n  boxShadow: '0 0 0 1px var(--card-bg-color)',\n})\n\n/** @hidden @beta */\nexport const StatusButton = forwardRef(function StatusButton(\n  props: StatusButtonProps &\n    Omit<HTMLProps<HTMLButtonElement>, 'disabled' | 'ref' | 'size' | 'title'>,\n  ref: ForwardedRef<HTMLButtonElement>,\n) {\n  const {disabled: disabledProp, icon, label, mode = 'bleed', text, tone, ...restProps} = props\n  const theme = useTheme()\n  const {t} = useTranslation()\n  const toneColor = tone && theme.sanity.color.solid[tone]\n  const dotStyle = useMemo(() => ({backgroundColor: toneColor?.enabled.bg}), [toneColor])\n  const disabled = Boolean(disabledProp)\n\n  return (\n    <StyledButton\n      data-ui=\"StatusButton\"\n      {...restProps}\n      aria-label={label || t('status-button.aria-label')}\n      disabled={disabled}\n      mode={mode}\n      ref={ref}\n      text={text}\n      icon={icon}\n    >\n      {tone && <Dot style={dotStyle} />}\n    </StyledButton>\n  )\n})\n","import {forwardRef} from 'react'\n\nimport {Tooltip, type TooltipProps} from '../../ui-components'\n\n/** @internal */\nexport const TooltipOfDisabled = forwardRef<HTMLDivElement, TooltipProps>(function DisabledTooltip(\n  {children, content, disabled, ...restProps},\n  ref,\n) {\n  return (\n    <Tooltip {...restProps} content={content} disabled={disabled || !content} ref={ref}>\n      <div>{children}</div>\n    </Tooltip>\n  )\n})\n","import {useToast} from '@sanity/ui'\nimport {forwardRef, type ReactNode, useImperativeHandle} from 'react'\n\n/** @internal */\nexport interface ToastParams {\n  closable?: boolean\n  description?: ReactNode\n  duration?: number\n  onClose?: () => void\n  title?: ReactNode\n  status?: 'error' | 'warning' | 'success' | 'info'\n}\n\n/** @internal */\nexport const ImperativeToast = forwardRef((_, ref) => {\n  const {push} = useToast()\n\n  useImperativeHandle(ref, () => ({push}))\n\n  return null\n})\n\nImperativeToast.displayName = 'ImperativeToast'\n","import {type ZIndexContextValue} from './types'\n\n/**\n * @internal\n */\nexport const defaults: ZIndexContextValue = {\n  navbar: 200,\n  navbarPopover: 500000,\n  navbarDialog: 500001,\n\n  // pane\n  pane: 100,\n  paneHeader: [110, 15000],\n  paneFooter: [120, 20000],\n  paneResizer: [130, 25000],\n  paneDialog: [140, 5000],\n\n  //\n  popover: 200,\n  modal: 200,\n  movingItem: 10000,\n  drawershade: 1000000,\n  drawer: 1000001,\n  fullscreen: 1200000,\n  toast: [100, 11000],\n\n  // NOT IN USE\n  portal: 200,\n  dropdown: 200,\n  navbarFixed: 1010,\n  fullscreenEdit: 1050,\n  popoverBackground: 1060,\n  tooltip: 200,\n  modalBackground: 2000,\n  spinner: 3000,\n}\n","import {createContext} from 'react'\n\nimport {defaults} from './defaults'\nimport {type ZIndexContextValue} from './types'\n\n/**\n * TODO: Rename to `ZOffsetsContext`\n *\n * @internal\n */\nexport const ZIndexContext = createContext<ZIndexContextValue>(defaults)\n","import {useContext} from 'react'\n\nimport {type ZIndexContextValue} from './types'\nimport {ZIndexContext} from './ZIndexContext'\n\n/**\n * TODO: Rename to `useZOffsets`\n *\n * @internal\n */\nexport function useZIndex(): ZIndexContextValue {\n  return useContext(ZIndexContext)\n}\n","import {LayerProvider} from '@sanity/ui'\nimport {type ReactNode} from 'react'\n\nimport {type ZIndexContextValue} from '../zOffsets/types'\nimport {useZIndex} from '../zOffsets/useZIndex'\n\n/** @internal */\nexport type ZIndexContextValueKey = keyof ZIndexContextValue\n\n/**\n * This component should only be used by core Sanity packages.\n * @internal\n */\nexport function LegacyLayerProvider({\n  children,\n  zOffset: zOffsetKey,\n}: {\n  children: ReactNode\n  zOffset: ZIndexContextValueKey\n}) {\n  const zIndex = useZIndex()\n  const zOffset = zIndex[zOffsetKey]\n\n  return <LayerProvider zOffset={zOffset}>{children}</LayerProvider>\n}\n","import {memo, type ReactNode, useCallback, useMemo} from 'react'\n\nimport {type FormPatch, PatchEvent} from '../patch'\nimport {FormCallbacksContext, useFormCallbacks} from '../studio'\n\ntype PatchTransformer = (patches: FormPatch[]) => FormPatch[]\n\n/**\n * @hidden\n * @beta */\nexport const TransformPatches = memo(function OnChangeProvider(\n  props: {transform: PatchTransformer} & {children: ReactNode},\n) {\n  const {transform} = props\n  const callbacks = useFormCallbacks()\n\n  const handleChange = useCallback(\n    (patchEvent: PatchEvent) => {\n      const patches = patchEvent.patches\n      const transformedPatches = transform(patches)\n      callbacks.onChange(PatchEvent.from(transformedPatches))\n    },\n    [callbacks, transform],\n  )\n\n  const contextValue = useMemo(\n    () => ({...callbacks, onChange: handleChange}),\n    [callbacks, handleChange],\n  )\n  return (\n    <FormCallbacksContext.Provider value={contextValue}>\n      {props.children}\n    </FormCallbacksContext.Provider>\n  )\n})\n"],"names":["publish","createPubsub","read","id","remove","noop","Context","isEqual","useReportedValues","values","Tracker","props","useReporter","STROKE_WIDTH","DEBUG","isNonNullable","document","EMPTY_ARRAY","isRecord","Polyfill","resizeObserver","isTouchDevice","_a","DEBUG_MODE","t","useOriginalTranslation","ChangeBarWrapper","deepCompare","from","focusRingBorderStyle","AlignedBottomGrid","focusRingStyle","getItemKey","scrollIntoView","Fragment","pick","StyledCard","StyledText","Text","defaultValue","Component","format","map","catchError","storage.setItem","storage.removeItem","useClient","hash","sessionId","getSessionId","storage.getItem","createSanityClient","memoize","pathToString","isEmptyObject","get","listen","EMPTY_PATH","RoundedCard","didWarn","TextSymbols.DECORATOR_SYMBOLS","set","TextSymbols.ANNOTATION_SYMBOLS","TextSymbols.INLINE_SYMBOLS","TextSymbols.CHILD_SYMBOL","TextSymbols.SEGMENT_START_SYMBOL","dec","flatten","Preview","cardStyles","Image","ImagePreview","is","PreviewContainer","PopoverContainer","Annotation","Header","Decorator","InlineObject","PopoverContent","TextSymbols.EMPTY_BLOCK_SYMBOL","TextSymbols.TRAILING_SPACE_SYMBOL","ReferencePreview","StringWrapper","isPortableText","patch","isEmptyArray","ChangeListWrapper","CodeWrapper","align","Layout","Root","FieldWrapper","group","validation","POPOVER_PROPS","FlexWrapper","render","bottom","intersection","DEFAULT_MARGINS","Content","getMemberTypeOfItem","resolveTypeName","EMPTY","resolveInitialValue","PopoverCard","IncompatibleItemType","randomKey","move","findIndex","OPERATIONS","SUPPORTED_PATCH_TYPES","isString","observableFrom","observableOf","rotate","loadImage","is.type","resolveUploader","defaultResolveUploader","PrimitiveField","STATUS_TONES","CONVERTERS","converters","isObjectInputProps","FormInputInner","isObject","TooltipBox","POPOVER_FALLBACK_PLACEMENTS","range","editor","PreviewReferenceValue","refType","Icon","INITIAL_LOADING_STATE","EMPTY_STATE","useReferenceInfo","getReferenceInfo","getTypeChain","traverse","select","DEFAULT_LIMIT","orderBy","filter","selection","useValueRef","adapter.getReferenceInfo","getTone","MENU_POPOVER_PROPS","ReplaceIcon","OpenInNewTabIcon","hasListOptions","OptionPreview","StyledPopover","FALLBACK_PLACEMENTS","ReferenceAutocomplete","INITIAL_SEARCH_STATE","NO_FILTER","nonNullable","hits","_b","_c","_d","resolveUserDefinedFilter","adapter.referenceSearch","ListItem","Overlay","FileTarget","uploadFile","ErrorItem","isReference","ruleConstraintTypes","isDraft","slug","typeString","RuleClass","mergeMap","switchMap","toArray","isError","SchemaBuilder","inferValidation","InsertMenu","PreviewCard","DuplicateIcon","Checkbox","MENU_BUTTON_POPOVER_PROPS","nearestIndex","Switch","DateTimeInput","DatePicker","deserialize","serialize","TextInput","isValidDate","getValue","isValidElement","ReactIsValidElement","useProjectId","ClearIcon","AVAILABILITY_READABLE","AVAILABILITY_PERMISSION_DENIED","AVAILABILITY_NOT_FOUND","isImage","RootFlex","FileSkeleton","FlexContainer","passThrough","ASSET_FIELD_PATH","isEmpty","fileAsset","RatioBox","debug","Debug","image","maxHeight","maxWidth","getDevicePixelRatio","utils2d.isPointInEllipse","utils2d.isPointInCircle","utils2d.isPointInRect","utils2d.getPointAtCircumference","cursors.CLOSE_HAND","cursors.OPEN_HAND","INITIAL_STATE","Placeholder","imageUrlBuilder","imageAsset","DefaultComponent","rgba","BlockActionsOuter","BlockActionsInner","ChangeIndicatorWrapper","Container","FallbackComponent","OptionObserveElement","_isReactElement","CollapseMenuMemo","useTranslation","MenuItem","renderStyle","IS_MAC","resolveInitialValueForType","Button","RespondToInvalidContent","isArrayOfPrimitives","toSelectItem","sub","useValuePreview","DefaultBlockTextComponent","components","DefaultPreview","renderMedia","timer","observePaths","first","prepare","share","CACHE","isLiveEditEnabled","commit","restore","groupBy","reduceJSON","operationArgs","fetch","partition","grants.viewer","grants.editor","parse","identity","getAttrs","wrap","applyPatch","history","jsonReduce","CustomCard","search","createI18nInstance","filterDefinitions","defaultOptions","debounce","CustomMenuItem","handleSelectAssetFromSource","escapeRegExp","basePathRegex","isEscape","operatorDefinitions","POPOVER_STYLES","isValid","startCase","RECENT_SEARCH_VERSION","ANIMATION_TRANSITION","Media","SanityLogo","StyledMenu","UIButton","PortableText","StyledButton","StyledDialog","AppearanceMenu","LocaleMenu","ManageMenu","TrapFocus","ReactFocusLock","Link","last","jsx","WorkspaceLoader","DEFAULT_MEDIA_DIMENSIONS","TitleSkeleton","SubtitleSkeleton","MediaSkeleton","RootBox","HeaderFlex"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWO,MAAM,mBAAmB,cAAqC;AAAA,EACnE,qBAAqB;AAAA,EACrB,qBAAqB,MAAG;AAAA,EAAA;AAAA,EACxB,YAAY,MAAG;AAAA,EAAA;AACjB,CAA0B;ACVnB,SAAS,cAAqB;AAC7B,QAAA,iBAAqB,oBAAA,IACrB,GAAA,EAAC,SAAAA,UAAS,UAAS,IAAIC,aAAgC,GAEvD,mBAAmB,SAASD,UAAS,IAAI,EAAC,UAAU,GAAK,CAAA,GACzDE,QAAO,MAAM,MAAM,KAAK,eAAe,QAAA,CAAS;AAE7C,WAAA,IAAIC,KAAY,OAAc;AACjC,mBAAe,IAAIA,GAAE,GAQzB,eAAe,IAAIA,KAAI,KAAK,GAC5B,iBAAiBD,MAAM,CAAA;AAAA,EACzB;AAES,WAAA,OAAOC,KAAY,OAAc;AACnC,mBAAe,IAAIA,GAAE,GAG1B,eAAe,IAAIA,KAAI,KAAK,GAC5B,iBAAiBD,MAAM,CAAA;AAAA,EACzB;AAEA,WAASE,QAAOD,KAAY;AACrB,mBAAe,IAAIA,GAAE,GAG1B,eAAe,OAAOA,GAAE,GACxB,iBAAiBD,MAAA,CAAM;AAAA,EACzB;AAEO,SAAA;AAAA,IACL;AAAA,IACA,QAAAE;AAAA,IACA;AAAA,IACA,MAAAF;AAAA,IACA;AAAA,EAAA;AAEJ;ACrCA,SAAS,OAAU,OAAwC;AACzD,SAAO,OAAO,SAAU;AAC1B;AAEA,SAAS,KAAQ,OAAyB;AACxC,SAAO,OAAO,KAAK,IAAI,MAAA,IAAU;AACnC;AAGA,MAAMG,SAAO,MAAG;AAAA;AAMT,SAAS,kBACdC,UACqB;AACrB,SAAO,SAELH,KACA,OACAI,WAAkC,OAAO,IACzC;AACM,UAAA,EAAC,KAAK,QAAQ,QAAAH,YAAU,WAAWE,QAAO,GAC1C,WAAW;AAEjB,oBAAgB,MAAM;AACpB,UAAIH,QAAO;AACF,eAAAE;AAEH,YAAA,UAAU,KAAK,KAAK;AAC1B,aAAA,IAAIF,KAAI,OAAO,GACf,SAAS,UAAU,SACZ,MAAM;AACX,QAAAC,QAAOD,GAAE;AAAA,MAAA;AAAA,IACX,GACC,CAAC,KAAKA,KAAIC,SAAQ,KAAK,CAAC,GAE3B,gBAAgB,MAAM;AACd,YAAA,UAAU,KAAK,KAAK;AAExB,aAAO,SAAS,UAAY,OAC5B,CAACG,SAAQ,SAAS,SAAS,OAAO,KAClCJ,QAAO,QAEP,OAAOA,KAAI,OAAO,GAEpB,SAAS,UAAU;AAAA,IAAA,CACpB;AAAA,EAAA;AAEL;AC/CA,IAAI,UAAU;AACd,MAAM,mBAAmB,CAACA,QAAqB;AACxC,aAEH,QAAQ;AAAA,IACN,IAAI;AAAA,MACF,uFAAuFA,GAAE;AAAA,IAC3F;AAAA,EAAA,GAGJ,UAAU;AACZ;AAEA,SAAS,wBAA6C;AACpD,SAAK,WAEH,QAAQ;AAAA,IACN,IAAI;AAAA,MACF;AAAA,IACF;AAAA,EAAA,GAGJ,UAAU,IACH;AACT;AAEA,MAAM,oBAAoB,OACnB,WAEH,QAAQ;AAAA,EACN,IAAI;AAAA,IACF;AAAA,EACF;AACF,GAEF,UAAU,IAEH,MAAM;AAAC,IAGV,kBAA2C;AAAA,EAC/C,KAAK;AAAA,EACL,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,WAAW;AAAA,EACX,MAAM;AACR;AAEA,IAAIA,OAAK;AACT,MAAM,YAAY,MAAM,EAAEA;AAGnB,SAAS,qBAA4B;AACpC,QAAAG,WAAU,cAAc,eAAwC;AAEtE,WAASE,qBAAoB;AACrB,UAAA,UAAU,WAAWF,QAAO,GAC5B,CAACG,SAAQ,SAAS,IAAI,SAAS,QAAQ,KAAM,CAAA;AACnD,WAAA,gBAAgB,OACd,UAAU,QAAQ,KAAM,CAAA,GACjB,QAAQ,UAAU,SAAS,IACjC,CAAC,OAAO,CAAC,GACLA;AAAA,EACT;AAEA,WAASC,SAAQC,QAA8B;AAC7C,UAAM,QAAQ,QAAQ,MAAM,YAAmB,GAAG,CAAE,CAAA;AACpD,+BAAQL,SAAQ,UAAR,EAAiB,OAAO,OAAQ,iBAAM,SAAS,CAAA;AAAA,EACzD;AAEM,QAAAM,eAAc,kBAAkBN,QAAO;AAEtC,SAAA;AAAA,IACL,SAAAI;AAAA,IACA,mBAAAF;AAAA,IACA,aAAAI;AAAA,IACA,mBAAmB,CACjB,OACAL,WAAkC,OAAO,OACtCK,aAAY,WAAW,OAAO,WAAW,EAAE,OAAO,IAAI,OAAOL,QAAO;AAAA,EAAA;AAE7E;AC/Fa,MAEA,gBAAgB,GAEhB,2BAA2B,IAE3B,mBAAmB,GACnB,iBAAiB,GACjB,iBAAiB,GACjB,aAAa,GACb,kBAAkB,IAClBM,iBAAe,GAEfC,UAAQ,IACR,qBAA8B,ICMrC,eACF,mBAAgD,GAIvCJ,YAAU,aAAa,SAGvBF,sBAAoB,aAAa,mBAGjCI,gBAAc,aAAa;ACtBjC,SAAS,UAAqB,OAA6B;AAC1D,QAAA,WAAW,OAAkB,KAAK;AAEnC,SAAAL,UAAQ,SAAS,SAAS,KAAK,MAClC,SAAS,UAAU,QAGd,SAAS;AAClB;ACmBgB,SAAA,gCACd,mBACA,cAC8C;AACxC,QAAA,sBAAmD,CAAC,cAAc,EAAI,GACtE,gBAAgB,EAAC,MAAM,SAAS,OAAO,oBAAmB;AAEhE,SAAO,SAAuC,MAAY;AAExD,UAAM,UAAU,UAAU,IAAI,GACxB,SAAS;AAAA,MACb,MACE,GAAG,OAAO,EAAE;AAAA,QACV;AAAA,UAAU,CAAC,QACT;AAAA,YACE,GAAG,EAAC,MAAM,WAAmB;AAAA,YAC7B,kBAAkB,GAAG,EAAE,KAAK,IAAI,CAAC,WAAW,EAAC,MAAM,SAAS,MAAK,EAAW,CAAC;AAAA,UAC/E;AAAA,QACF;AAAA,QACA,KAAK,CAAC,CAAC,SAAS,GAAG,SACb,KAAK,SAAS,YAAkB,CAAC,WAAW,EAAI,IAC7C,CAAC,KAAK,OAAO,EAAK,GACxB,mBAAmB;AAAA,QACtB,qBAAqB,CAAC,CAAC,WAAW,aAAa,GAAG,CAAC,WAAW,aAAa,MACrE,EAAc,cAAA,aACd,kBAAkB,cAEvB;AAAA,QACD,IAAI,CAAC,WAAW,EAAC,MAAM,SAAS,QAAgB;AAAA,QAChD,WAAW,CAAC,UAAU,GAAG,EAAC,MAAM,SAAS,MAAK,CAAU,CAAC;AAAA,MAC3D;AAAA,MACF,CAAC,OAAO;AAAA,MACR;AAAA,IAAA;AAGF,QAAI,OAAO,SAAS;AAAS,YAAM,OAAO;AAE1C,WAAO,OAAO;AAAA,EAAA;AAElB;ACzEO,SAASQ,gBAAiB,OAAmC;AAClE,SAAO,SAAU;AACnB;ACUO,MAAM,gBAAgB,UACvB,gBAAgB,GAAG,aAAa;AA2BtB,SAAA,iBAAiB,YAAoB,kBAAmC;AACtF,SAAO,eAAe,UAAU,MAAM,eAAe,gBAAgB;AACvE;AAGO,SAAS,QAAQC,WAAuC;AACtD,SAAA,UAAUA,UAAS,GAAG;AAC/B;AAGO,SAAS,UAAUb,KAA2B;AAC5C,SAAAA,IAAG,WAAW,aAAa;AACpC;AAGO,SAAS,UAAUA,KAA0D;AAC3E,SAAA;AAAA,IACL,SAAS,WAAWA,GAAE;AAAA,IACtB,aAAa,eAAeA,GAAE;AAAA,EAAA;AAElC;AAGO,SAAS,cAAcA,KAA+B;AACpD,SAAA,CAAC,UAAUA,GAAE;AACtB;AAGO,SAAS,WAAWA,KAAqB;AAC9C,SAAO,UAAUA,GAAE,IAAIA,MAAO,gBAAgBA;AAChD;AAGO,SAAS,eAAeA,KAAyB;AACtD,SAAQ,UAAUA,GAAE,IAAIA,IAAG,MAAM,cAAc,MAAM,IAAIA;AAC3D;AAGO,SAAS,gBAAgBa,WAA0C;AACjE,SAAA;AAAA,IACL,GAAGA;AAAA,IACH,KAAK,WAAWA,UAAS,GAAG;AAAA,EAAA;AAEhC;AAGO,SAAS,aAAaA,WAA0C;AAC9D,SAAA;AAAA,IACL,GAAGA;AAAA,IACH,KAAK;AAAA,EAAA;AAET;AAGO,SAAS,oBAAoBA,WAA0C;AACrE,SAAA;AAAA,IACL,GAAGA;AAAA,IACH,KAAK,eAAeA,UAAS,GAAG;AAAA,EAAA;AAEpC;AAmBO,SAAS,QAAgD,WAAkC;AAChG,QAAM,OAAO,UAAU,OAAO,CAAC,KAAK,QAAQ;AACpC,UAAA,cAAc,eAAe,IAAI,GAAG;AACtC,QAAA,QAAQ,IAAI,IAAI,WAAW;AAC1B,WAAA,UACH,QAAQ,EAAC,IAAI,aAAa,MAAM,IAAI,OAAO,WAAW,QAAW,OAAO,OAAA,GACxE,IAAI,IAAI,aAAa,KAAK,IAG5B,MAAM,gBAAgB,IAAI,MAAM,cAAc,OAAO,IAAI,KAClD;AAAA,EAAA,GACF,oBAAA,IAAA,CAAK;AAEZ,SAAO,MAAM,KAAK,KAAK,OAAQ,CAAA;AACjC;AAIO,SAAS,YAAY,WAAuD;AACjF,SAAO,QAAQ,SAAS,EACrB,IAAI,CAAC,UAAU,MAAM,SAAS,MAAM,SAAS,EAC7C,OAAOD,eAAa;AACzB;AC9Ia,MAAA,eAAwC,OAAO,OAAO,CAAE,CAAA,GAGxDE,gBAAuB,OAAO,OAAO,CAAE,CAAA;ACOpD,SAAS,iBAAkF;AACzF,MAAI,OAAO,aAAe;AAAoB,WAAA;AAC9C,MAAI,OAAO,SAAW;AAAoB,WAAA;AAC1C,MAAI,OAAO,OAAS;AAAoB,WAAA;AACxC,MAAI,OAAO,SAAW;AAAoB,WAAA;AAEpC,QAAA,IAAI,MAAM,2CAA2C;AAC7D;AAGO,MAAM,cAAc,eAAe;AClBnC,SAASC,WAAS,OAAkD;AAClE,SAAA,CAAA,CAAQ,SAAU,OAAO,SAAU,YAAY,CAAC,MAAM,QAAQ,KAAK;AAC5E;ACJO,SAAS,SAAS,OAAiC;AACxD,SAAO,OAAO,SAAU;AAC1B;ACAA,MAAM,iBACJ,OAAO,YAAa,YAAY,OAAO,UAAW,YAAY,OAAO,iBACjE,OAAO,iBACPC,kBAaO,6BAA6B,MAA4B;AACpE,QAAM,QAAQ,gBAERC,kBAAiB,IAAI;AAAA,IAAe,CAAC,YACzC,MAAM,QAAQ,OAAO;AAAA,EAAA;AAGhB,SAAA;AAAA,IACL,SAAS,CACP,SACA,UACA,YACG;AACH,YAAM,cAAc,MAAM,UAAU,CAAC,YAAY;AAC/C,cAAM,QAAQ,QAAQ,KAAK,CAAC,MAAM,EAAE,WAAW,OAAO;AAClD,iBACF,SAAS,KAAK;AAAA,MAAA,CAEjB;AAED,aAAAA,gBAAe,QAAQ,SAAS,OAAO,GAEhC,MAAM;AACC,uBACZA,gBAAe,UAAU,OAAO;AAAA,MAAA;AAAA,IAEpC;AAAA,IACA,WAAW,CAAC,YAAqBA,gBAAe,UAAU,OAAO;AAAA,EAAA;AAErE,GAGa,iBAAiB,2BAA2B,GCjDnD,gBAAgB,CAAC,SAAS,MAAM,OAAO,QAAQ,QAAQ,SAAS,MAAM,GACtE,cAAc,4BAGP,mBAAmB,CAAC,cAC/B,CAAC,YAAY,KAAK,SAAS,KAAK,cAAc,SAAS,SAAS,GAGrD,cAAc,CAAC,cAA8B,KAAK,SAAS,MAElE,cAAc,CAAC,cAA8B,IAAI,YAAY,SAAS,CAAC,IAEvE,eAAe,CAAC,UAAgC,MAAM,QAAQ,KAAK,KAAK,MAAM,WAAW,GAGlF,WAAW,CAAC,cAA2C;AAClE,MAAI,OAAO;AACX,WAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACnC,UAAA,cAAc,UAAU,CAAC;AAC3B,QAAA,aAAa,WAAW,GAAG;AACrB,cAAA;AACR;AAAA,IACF;AAEI,QAAA,OAAO,eAAgB,UAAU;AACnC,cAAQ,IAAI,WAAW;AACvB;AAAA,IACF;AAEA,UAAM,UAAU,MAAM;AACF,qBAAiB,WAAW,IAG9C,OAAO,UAAU,YAAY,WAAW,IAAI,GAAG,IAAI,GAAG,YAAY,WAAW,CAAC,KAE9E,OAAO,UAAU,cAAc,GAAG,IAAI,IAAI,WAAW;AAAA,EAEzD;AAEO,SAAA;AACT,GCzCa,gBAAgBC,gBAAc;AAE3C,SAASA,kBAAgB;AACnB,SAAA,OAAO,SAAW,MAAoB,KAGxC,kBAAkB,UAClB,UAAU,iBAAiB,KAC1B,UAAkB,mBAAmB;AAE1C;ACXA,MAAM,YAAY,OAAO,QAAS,YAAY,eAAe,OAAO,IAAI,KAAK,cAAc;AAmB3E,SAAA,YAAY,KAAa,OAAe,KAAqB;AAC3E,MAAI,MAAM;AACR,UAAM,IAAI;AAAA,MACR;AAAA,IAAA;AAIJ,MAAI,CAAC;AACI,WAAA,IAAI,MAAM,OAAO,GAAG;AAGzB,MAAA,IAAI,GACJ,SAAS;AACb,aAAW,SAAS,UAAU,QAAQ,GAAG,GAAG;AAC1C,QAAI,MAAM;AACD,aAAA;AAGT,cAAU,MAAM,SAChB;AAAA,EACF;AAEO,SAAA;AACT;AAagB,SAAA,eAAe,KAAa,WAA2B;AACrE,QAAM,YAAY,YAAY,KAAK,GAAG,SAAS;AAC/C,SAAO,cAAc,MAAM,YAAY,GAAG,SAAS;AACrD;AC9BA,MAAM,gBAA8B;AAAA,EAClC,WAAW;AAAA,EACX,OAAO;AAAA,EACP,OAAO;AACT;AAOgB,SAAA,YACd,QACA,cAC8B;AAMvB,SAAA,kBAAkB,MAAM,OAAO,KAAK,YAAY,GAAG,CAAC,MAAM,GAJ/D,OAAO,eAAiB,MACpB,gBACA,EAAC,WAAW,IAAO,OAAO,cAAc,OAAO,KAAA,CAEsB;AAC7E;AAGO,SAAS,aAAuD;AAC9D,SAAA,CAAC,WACN,OAAO;AAAA,IACL,IAAI,CAAC,WAAW,EAAC,WAAW,IAAO,OAAO,OAAO,KAAA,EAAe;AAAA,IAChE;AAAA,MACE,CAAC,UAAkC,GAAG,EAAC,WAAW,IAAO,OAAO,QAAW,OAAM;AAAA,IACnF;AAAA,EAAA;AAEN;ACpCgB,SAAA,YACd,MACA,QACS;AACF,SAAA,SAAS,QAAQ,KAAK,MAAM,KAAK,CAAC,SAAS,KAAK,SAAS,MAAM;AACxE;AC7BA,IAAAC;AAMA,MAAMC,eAAa,OAAO,UAAY,MAAc,MAAQD,OAAA,WAAA,OAAA,SAAA,QAAS,QAAT,OAAc,SAAAA,KAAA,0BAQ7D,aAAa,CAAQ,CAAAC,cAM5B,gBAAgB;AAAA,EACpB,SAAS,CAAC,QAAgB,SAAI,GAAG;AAAA,EACjC,WAAW,CAAC,QAAgB,UAAK,GAAG;AACtC;AAWO,SAAS,WAAWC,IAAyB;AAClD,QAAM,UACJD,iBAAe,aAAaA,iBAAe,cAAc,cAAcA,YAAU,IAAI;AAEhF,SAAA,UAAY,IAAI,SAAc,QAAQC,GAAE,GAAG,IAAI,CAAC,IAA0BA;AACnF;ACRA,MAAM,6BAA6B;AAAA;AAAA;AAAA,EAGjC,UAAU;AACZ;AAUgB,SAAA,eAId,IACA,SACiD;AAC3C,QAAA,EAAC,GAAAA,OAAKC;AAAAA,IACV;AAAA,IACA,UACI,EAAC,WAAW,QAAQ,WAAW,KAAK,QAAQ,KAAK,GAAG,2BAAA,IACpD;AAAA,EAAA;AAGN,SAAO,EAAC,GAAG,WAAWD,EAAC,EAAC;AAC1B;AC/CA,MAAM,iBAAiB,KAEVE,qBAAmB,OAAO;AAAA,EACrC,CAAC,EAAC,UAAU,WAAW,WAAW,0BAC5B,YACK;AAAA,UACH,eAAe;AAAA;AAAA;AAAA,UAKd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAMH,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAOX,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOnB,aACF;AAAA,UACI,eAAe;AAAA;AAAA;AAAA,OAGlB;AAAA;AAAA;AAAA,QAGC,CAAC,YACH;AAAA,UACI,eAAe;AAAA;AAAA;AAAA;AAAA,OAIlB;AAAA;AAAA;AAAA,QAGC,uBACF;AAAA,UACI,eAAe;AAAA;AAAA;AAAA,OAGlB;AAAA;AAGP,GAEa,eAAe,OAAO;AAAA;AAAA;AAAA,GAKtB,YAAY,OAAO;AAAA;AAAA;AAAA;AAAA,aAInB,CAAC,EAAC,QAAO,MAAM,OAAO;AAAA,GAGtB,kBAAkB,OAAO,IAAI,CAACf,WAAU;AACnD,QAAM,EAAC,MAAS,IAAA,YAAYA,OAAM,KAAK;AAEhC,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAQgB,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBjC,CAAC,GAEY,kBAAkB,OAAO,OAAqC,CAACA,WAAU;AAC9E,QAAA,EAAC,iBAAoB,IAAAA;AAEpB,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAciB,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAYlC,oBACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMC;AAAA;AAEL,CAAC;ACxIM,SAAS,qBAAqBA,QAMlC;AACK,QAAA,EAAC,UAAU,UAAU,UAAU,WAAW,kBAAkB,GAAQ,IAAAA,QAEpE,EAAC,qBAAqB,wBAAuB,WAAW,gBAAgB,GACxE,EAAC,WAAU,YACX,EAAC,GAAAa,GAAC,IAAI,eAAe,GAErB,YAAY;AAAA,IAChB,MACE,YAAY,CAAC,YAAY,4BACtB,WAAU,EAAA,eAAY,cAAa,SAAS,QAC3C,UAAA;AAAA,MAAC,oBAAA,iBAAA,EAAgB,eAAY,qBAAqB,CAAA;AAAA,0BACjD,SAAQ,EAAA,SAASA,GAAE,+BAA+B,GAAG,QAAM,IAC1D,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,cAAYA,GAAE,+BAA+B;AAAA,UAC7C,eAAY;AAAA,UACZ,SAAS,sBAAsB,SAAY;AAAA,UAC3C,UAAU;AAAA,UACV,MAAK;AAAA,UACL,kBAAkB;AAAA,QAAA;AAAA,MAAA,GAEtB;AAAA,IAAA,GACF;AAAA,IAEJ,CAAC,UAAU,WAAW,qBAAqB,qBAAqBA,IAAG,iBAAiB,MAAM;AAAA,EAAA;AAI1F,SAAA;AAAA,IAACE;AAAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ,UAAU;AAAA,MACV,WAAW;AAAA,MACX,WAAW;AAAA,MACX,qBAAqB;AAAA,MAErB,UAAA;AAAA,QAAC,oBAAA,cAAA,EAAa,eAAY,6BAA6B,SAAS,CAAA;AAAA,QAC/D;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGP;ACzCA,MAAM,mBAAmB,KAAK,SAC5Bf,QAOA;AACM,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAc;AAAA,IACd,cAAc;AAAA,IACd,OAAOM;AAAAA,IACP;AAAA,IACA,GAAG;AAAA,EACD,IAAAN,QACE,QAAQ,SAAA,GACR,CAAC,UAAU,QAAQ,IAAI,SAAS,EAAK,GACrC,eAAe;AAAA,IACnB,CAAC,UAAsC;AAClB,0BAAA,QAAA,iBAAA,KAAA,GACnB,SAAS,EAAI;AAAA,IACf;AAAA,IACA,CAAC,gBAAgB;AAAA,KAEb,eAAe;AAAA,IACnB,CAAC,UAAsC;AAClB,0BAAA,QAAA,iBAAA,KAAA,GACnB,SAAS,EAAK;AAAA,IAChB;AAAA,IACA,CAAC,gBAAgB;AAAA,EAAA,GAEb,MAAM,OAA8B,IAAI;AAC9C,SAAAC;AAAAA,IACE,WAAW,OAAO,SAAS,UAAU,SAAS,IAAI,CAAC;AAAA,IACnD,OAAO;AAAA,MACL,SAAS,IAAI;AAAA,MACb;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,QAAQ,MAAM;AAAA,IAAA;AAAA,IAEhBe;AAAAA;AAAAA,EAAA,GAIC,oBAAA,OAAA,EAAK,GAAG,WAAW,KAAU,cAA4B,cACxD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MAEC;AAAA,IAAA;AAAA,EAEL,EAAA,CAAA;AAEJ,CAAC;AAWM,SAAS,gBACdhB,QACA;AACM,QAAA,EAAC,UAAU,UAAU,WAAW,MAAM,iBAAiB,GAAG,UAAa,IAAAA;AAG3E,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MAEC;AAAA,IAAA;AAAA,EAAA;AAGP;AC9FO,MAAM,yBAA+D,cAAc;AAAA,EACxF,MAAM,CAAC;AAAA,EACP,UAAU,CAAC;AAAA,EACX,WAAW,CAAC;AAAA,EACZ,WAAW;AACb,CAAgC,GCfnB,gBAAgB,cAAoC,IAAI,GCmB/DN,SAAO,MAAG;AAAA,GAWH,kBAAkB,WAAW,SACxCM,QACA,KACA;AACM,QAAA,EAAC,KAAK,OAAO,UAAU,GAAG,SAAQA,QAClC,eAAe,gBAAgB,GAAG,GAGlC,gBAAgB,WAAW,aAAa,GACxC,eAAe,QAAQ,MAAM,gBAAuB,CAAA,CAAE;AAElD,SAAA,UAAA,MACJ,WAEK,aAAa,UAAU,QAAQ,IAEjCN,QACN,CAAC,cAAc,QAAQ,CAAC,GAE3B,UAAU,MAEJ,gBACK,aAAa,UAAU,cAAc,OAAO,IAE9CA,QACN,CAAC,eAAe,YAAY,CAAC,GAEhC,UAAU,MAAM;AACR,UAAA,eAAe,CAAC,UAAiB;AACrC,mBAAa,QAAQ,KAAK;AAAA,IAAA,GAGtB,KAAK,aAAa;AAEnB,QAAA;AAIF,aAAA,GAAA,iBAAiB,UAAU,cAAc;AAAA,QAC1C,SAAS;AAAA,QACT,SAAS;AAAA,MACV,CAAA,GAEM,MAAM;AACR,WAAA,oBAAoB,UAAU,YAAY;AAAA,MAAA;AAAA,EAC/C,GACC,CAAC,cAAc,YAAY,CAAC,GAG7B,oBAAC,cAAc,UAAd,EAAuB,OAAO,cAC5B,UAAc,cAAA,IAAI,EAAC,KAAK,cAAc,eAAe,oBAAoB,GAAG,MAAK,EACpF,CAAA;AAEJ,CAAC;AClFM,SAAS,YACdM,QAIA;AACA,QAAM,EAAC,QAAQ,GAAG,KAAQ,IAAAA,QACpB,IAAI,KAAK,IAAI,OAAO,MAAMA,OAAM,IAAI,GACpC,IAAI,KAAK,IAAIA,OAAM,KAAK,OAAO,GAAG,GAClC,SAAS,KAAK,IAAI,GAAGA,OAAM,UAAU,IAAIA,OAAM,IAAI,GACnD,QAAQ,KAAK,IAAI,GAAGA,OAAM,SAAS,IAAIA,OAAM,KAAK;AAExD,6BAAQ,QAAM,EAAA,GAAG,MAAM,GAAM,GAAM,QAAgB,MAAc,CAAA;AACnE;ACXyB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAOnB,MAAA,gBAAgB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,GAOvB,kBAAkB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAczB,kBAAkB,OAAO,WAAW;AAAA;AAAA;AAAA;AAAA;ACzBjC,SAAA,UAAU,GAAW,GAAW,KAAqB;AAC5D,SAAA;AAAA,IACL,KAAK,IAAI,UAAU,IAAI,IAAI,aAAa,GAAG;AAAA,IAC3C,KAAK,CAAC,IAAI,CAAC;AAAA,IACX,KAAK,IAAI,UAAU,IAAI,IAAI,aAAa,GAAG;AAAA,EAAA,EAC3C,KAAK,EAAE;AACX;AAEA,SAAS,OAAO,GAAW,GAAW;AAC7B,SAAA,IAAI,CAAC,IAAI,CAAC;AACnB;AAEA,SAAS,OAAO,GAAW,GAAW;AAC7B,SAAA,IAAI,CAAC,IAAI,CAAC;AACnB;AAEA,SAAS,KAAK,SAAmB,QAAQ,IAAI;AACpC,SAAA,QAAQ,KAAK,KAAK;AAC3B;AAEA,SAAS,UAAU,IAAY,IAAY,GAAW,GAAW;AAC/D,SAAO,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC;AAC/B;AAEO,SAAS,sBAAsB,MAA6B;AACjE,QAAM,EAAC,MAAAiB,OAAM,GAAE,IAAI,MACb,EAAC,MAAM,OAAO,KAAK,MAAA,IAASA,OAC5B,EAAC,MAAM,KAAK,KAAK,IAAO,IAAA,IAExB,OAAiB,IAGjB,KAAK,KAAK,IAAI,eAAe,KAAK,IAAI,QAAQ,GAAG,IAAI,CAAC;AAGxD,SAAAA,MAAK,UACP,KAAK;AAAA,IACH,OAAO,QAAQ,gBAAgB,QAAQ,kBAAkB,cAAc;AAAA,IACvE,OAAO,QAAQ,gBAAgB,QAAQ,aAAa;AAAA,IACpD,UAAU,QAAQ,gBAAgB,OAAO,QAAQ,iBAAiB,eAAe,KAAK;AAAA,EAAA,IAE/EA,MAAK,UACd,KAAK;AAAA,IACH,OAAO,QAAQ,gBAAgB,QAAQ,kBAAkB,cAAc;AAAA,IACvE,OAAO,QAAQ,gBAAgB,QAAQ,aAAa;AAAA,IACpD,UAAU,QAAQ,gBAAgB,OAAO,QAAQ,iBAAiB,eAAe,KAAK;AAAA,EAGxF,IAAA,KAAK,KAAK,OAAO,OAAO,KAAK,CAAC,GAI5B,GAAG,UACD,QAAQ,GAAG,OAAO,MACpB,KAAK;AAAA,IACH,OAAO,GAAG,OAAO,OAAO,IAAI,IAAI,KAAK;AAAA,IACrC,UAAU,GAAG,OAAO,OAAO,GAAG,OAAO,GAAG,OAAO,OAAO,GAAG,QAAQ,EAAE;AAAA,IACnE,OAAO,GAAG,OAAO,OAAO,GAAG,MAAM,EAAE;AAAA,IACnC,UAAU,GAAG,OAAO,OAAO,GAAG,KAAK,GAAG,OAAO,OAAO,IAAI,IAAI,GAAG;AAAA,IAC/D,OAAO,GAAG,OAAO,OAAO,iBAAiB,eAAe,GAAG;AAAA,IAC3D;AAAA,MACE,GAAG,OAAO,OAAO;AAAA,MACjB;AAAA,MACA,GAAG,OAAO,OAAO;AAAA,MACjB,MAAM;AAAA,IACR;AAAA,IACA,OAAO,GAAG,OAAO,OAAO,gBAAgB,MAAM,kBAAkB,cAAc;AAAA,MAGhF,KAAK;AAAA,IACH,OAAO,GAAG,OAAO,OAAO,iBAAiB,eAAe,KAAK;AAAA,IAC7D;AAAA,MACE,GAAG,OAAO,OAAO;AAAA,MACjB;AAAA,MACA,GAAG,OAAO,OAAO;AAAA,MACjB,QAAQ;AAAA,IACV;AAAA,IACA,OAAO,GAAG,OAAO,OAAO,gBAAgB,MAAM,kBAAkB,cAAc;AAAA,EAChF,IAEO,GAAG,UACR,QAAQ,GAAG,OAAO,MAAM,GAAG,OAAO,SAEpC,KAAK;AAAA,IACH,OAAO,GAAG,OAAO,OAAO,iBAAiB,IAAI,KAAK;AAAA,IAClD;AAAA,MACE,GAAG,OAAO,OAAO;AAAA,MACjB;AAAA,MACA,GAAG,OAAO,OAAO;AAAA,MACjB,QAAQ;AAAA,IACV;AAAA,IACA,OAAO,GAAG,OAAO,OAAO,gBAAgB,MAAM,EAAE;AAAA,IAChD,UAAU,GAAG,OAAO,OAAO,gBAAgB,KAAK,GAAG,OAAO,OAAO,iBAAiB,IAAI,GAAG;AAAA,IACzF,OAAO,GAAG,OAAO,OAAO,iBAAiB,eAAe,GAAG;AAAA,IAC3D;AAAA,MACE,GAAG,OAAO,OAAO;AAAA,MACjB;AAAA,MACA,GAAG,OAAO,OAAO;AAAA,MACjB,MAAM;AAAA,IACR;AAAA,IACA,OAAO,GAAG,OAAO,OAAO,gBAAgB,MAAM,kBAAkB,cAAc;AAAA,MAGhF,KAAK;AAAA,IACH,OAAO,GAAG,OAAO,OAAO,iBAAiB,eAAe,KAAK;AAAA,IAC7D;AAAA,MACE,GAAG,OAAO,OAAO;AAAA,MACjB;AAAA,MACA,GAAG,OAAO,OAAO;AAAA,MACjB,QAAQ;AAAA,IACV;AAAA,IACA,OAAO,GAAG,OAAO,OAAO,gBAAgB,MAAM,kBAAkB,cAAc;AAAA,EAAA,IAGzE,QAAQ,MACjB,KAAK;AAAA,IACH,OAAO,GAAG,OAAO,OAAO,iBAAiB,IAAI,KAAK;AAAA,IAClD;AAAA,MACE,GAAG,OAAO,OAAO;AAAA,MACjB;AAAA,MACA,GAAG,OAAO,OAAO;AAAA,MACjB,QAAQ;AAAA,IACV;AAAA,IACA,OAAO,GAAG,OAAO,OAAO,gBAAgB,MAAM,EAAE;AAAA,IAChD,UAAU,GAAG,OAAO,OAAO,gBAAgB,KAAK,GAAG,OAAO,OAAO,iBAAiB,IAAI,GAAG;AAAA,IACzF,OAAO,KAAK,GAAG;AAAA,MAGjB,KAAK;AAAA,IACH,OAAO,GAAG,OAAO,OAAO,iBAAiB,IAAI,KAAK;AAAA,IAClD;AAAA,MACE,GAAG,OAAO,OAAO;AAAA,MACjB;AAAA,MACA,GAAG,OAAO,OAAO;AAAA,MACjB,QAAQ;AAAA,IACV;AAAA,IACA,OAAO,GAAG,OAAO,OAAO,gBAAgB,MAAM,EAAE;AAAA,IAChD,UAAU,GAAG,OAAO,OAAO,gBAAgB,KAAK,GAAG,OAAO,OAAO,iBAAiB,IAAI,GAAG;AAAA,IACzF,OAAO,KAAK,GAAG;AAAA,EAAA,GAIZ,KAAK,IAAI;AAClB;ACrJA,SAAS,sBAAsB,MAAY,QAAkC;AACrE,QAAA,UAAU,KAAK,MAAM,KAAK,SAAS,GACnC,UAAU,KAAK,MAAM,KAAK,SAAS,OAAO,MAAM,gBAChD,UAAU,KAAK,MAAM,OAAO,MAAM,OAAO,SAAS;AAEjD,SAAA;AAAA,IACL;AAAA,IACA,MAAM,KAAK;AAAA,IACX,KAAK;AAAA,IACL;AAAA,IACA,QAAQ,KAAK,MAAM;AAAA,IACnB,MAAM,KAAK,MAAM,KAAK,SAAS;AAAA,IAC/B;AAAA,IACA;AAAA,IACA,aAAa,WAAW;AAAA,EAAA;AAE5B;AAOO,SAAS,mBAAmB,WAGjC;AACA,QAAM,aAAa;AAAA,IACjB,KAAK,UAAU,KAAK,OAAO,MAAM;AAAA,IACjC,QAAQ,UAAU,KAAK,OAAO,MAAM,UAAU,KAAK,OAAO,SAAS;AAAA,IACnE,MAAM,UAAU,KAAK,OAAO;AAAA,IAC5B,OAAO,UAAU,KAAK,OAAO,OAAO,UAAU,KAAK,OAAO;AAAA,IAC1D,OAAO,UAAU,KAAK,OAAO;AAAA,IAC7B,QAAQ,UAAU,KAAK,OAAO,SAAS,kBAAkB;AAAA,EAAA,GAGrDA,QAAO,sBAAsB,UAAU,KAAK,MAAM,UAAU;AAC7D,EAAAA,MAAA,OAAO,UAAU,KAAK,KAAK,OAAO,UAAU,KAAK,KAAK,QAAQ;AAEnE,QAAM,WAAW;AAAA,IACf,KAAK,UAAU,GAAG,OAAO,MAAM;AAAA,IAC/B,QAAQ,UAAU,GAAG,OAAO,MAAM,UAAU,GAAG,OAAO,SAAS;AAAA,IAC/D,MAAM,UAAU,GAAG,OAAO;AAAA,IAC1B,OAAO,UAAU,GAAG,OAAO,OAAO,UAAU,GAAG,OAAO;AAAA,IACtD,OAAO,UAAU,GAAG,OAAO;AAAA,IAC3B,QAAQ,UAAU,GAAG,OAAO,SAAS,kBAAkB;AAAA,EAAA,GAGnD,KAAK,sBAAsB,UAAU,GAAG,MAAM,QAAQ,GAEtD,YAAY,KAAK,IAAI,GAAG,QAAQA,MAAK,MAAM;AAG5C,SAAAA,MAAA,MAAM,KAAK,IAAI,WAAWA,MAAK,IAAI,GACpCA,MAAK,MAAM,SAAS,MACtBA,MAAK,MAAM,KAAK,IAAI,SAAS,KAAKA,MAAK,IAAI,IAClCA,MAAK,MAAM,SAAS,WAC7BA,MAAK,MAAM,KAAK,IAAI,SAAS,QAAQA,MAAK,MAAM,IAElD,GAAG,MAAM,KAAK,IAAI,WAAW,GAAG,IAAI,GAChC,GAAG,MAAM,WAAW,MACtB,GAAG,MAAM,KAAK,IAAI,WAAW,KAAK,GAAG,IAAI,IAChC,GAAG,MAAM,WAAW,WAC7B,GAAG,MAAM,KAAK,IAAI,WAAW,QAAQ,GAAG,MAAM,IAIhDA,MAAK,MAAM,KAAK,IAAI,KAAK,IAAIA,MAAK,KAAK,WAAW,GAAG,GAAG,WAAW,MAAM,GACzE,GAAG,MAAM,KAAK,IAAI,KAAK,IAAI,GAAG,KAAK,SAAS,GAAG,GAAG,SAAS,MAAM,GAE1D,EAAC,MAAAA,OAAM,GAAE;AAClB;ACtDO,MAAM,YAAY,KAAK,SAAmB,EAAC,MAAAA,OAAM,MAAY;AAClE,QAAM,OAAO,mBAAmB,EAAC,MAAAA,OAAM,GAAG,CAAA;AAG1C,MAAI,KAAK,KAAK,eAAe,KAAK,GAAG;AAC5B,WAAA;AAGH,QAAA,sBAAsB,sBAAsB,IAAI;AAEtD,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,oBAAC,iBAAgB,EAAA,GAAG,qBAAqB,aAAa,0BAA0B;AAAA,IAE/E,oBAAA,eAAA,EAAc,GAAG,qBAAqB,aAAaf,gBAAc;AAAA,IAElE;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,KAAK,GAAG,KAAK;AAAA,QACb,MAAM,GAAG,KAAK,OAAO;AAAA,QACrB,QAAQ,GAAG,KAAK;AAAA,QAChB,OAAOA;AAAAA,QACP,QAAQ,GAAG;AAAA,MAAA;AAAA,IACb;AAAA,IAEC,KAAK,KAAK,WACT;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAG;AAAA,UACD,KAAK,KAAK,OAAO;AAAA,UACjB,KAAK,KAAK,OAAO,MAAM,kBAAkB;AAAA,UACzC;AAAA,QACF;AAAA,QACA,aAAaA;AAAAA,MAAA;AAAA,IACf;AAAA,IAGD,KAAK,KAAK,WACT;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAG;AAAA,UACD,KAAK,KAAK,OAAO;AAAA,UACjB,KAAK,KAAK,OAAO,MAAM,KAAK,KAAK,OAAO,SAAS,kBAAkB;AAAA,UACnE;AAAA,QACF;AAAA,QACA,aAAaA;AAAAA,MAAA;AAAA,IACf;AAAA,IAGD,KAAK,GAAG,WACP;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAG;AAAA,UACD,KAAK,GAAG,OAAO,OAAO;AAAA,UACtB,KAAK,GAAG,OAAO,MAAM,kBAAkB;AAAA,UACvC;AAAA,QACF;AAAA,QACA,aAAaA;AAAAA,MAAA;AAAA,IACf;AAAA,IAGD,KAAK,GAAG,WACP;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAG;AAAA,UACD,KAAK,GAAG,OAAO,OAAO;AAAA,UACtB,KAAK,GAAG,OAAO,MAAM,KAAK,GAAG,OAAO,SAAS,kBAAkB;AAAA,UAC/D;AAAA,QACF;AAAA,QACA,aAAaA;AAAAA,MAAA;AAAA,IACf;AAAA,IAGDC;AAAAA,EAyCH,EAAA,CAAA;AAEJ,CAAC,GCjIY,aAAa,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ACCjC,SAASe,uBAAqB,QAAgD;AAC5E,SAAO,eAAe,OAAO,KAAK,MAAM,OAAO,KAAK;AACtD;AAEa,MAAAC,sBAAoB,OAAO,IAAI;AAAA;AAAA;AAIrC,SAASC,iBAAe,MAIpB;AACT,QAAM,EAAC,MAAM,QAAQ,cAAa,MAC5B,uBAAuB,UAAU,SAAS,UAAU,OACpD,sBAAsB,IAAI,UAAU,QACpC,UAAU,OAAO,KAAK,KAAK;AAE1B,SAAA;AAAA,IACL,sBAAsB,KAAK,eAAe,mBAAmB;AAAA,IAC7D,UAAUF,uBAAqB,MAAM;AAAA,IACrC,sBAAsB,KAAK,SAAS,IAAI,mBAAmB,MAAM,OAAO;AAAA,IACxE,uBAAuB,KAAK,SAAS,oBAAoB;AAAA,EAExD,EAAA,OAAO,OAAO,EACd,KAAK,GAAG;AACb;ACRA,MAAM,6BAA6B,eAE7B,iCAAiC,YAKjC,kBAAkB,OAAO,IAAsB,CAAC,EAAC,OAAO,OAAA,MACrD;AAAA,cACK,CAAC,MAAM;AAAA,qBACA,IAAI,MAAM,OAAO,OAAO,CAAC,CAAC,CAAC;AAAA,YACpC,CAAC,MAAM;AAAA;AAAA;AAAA,aAGN,CAAC,MAAM;AAAA,WACT,CAAC,MAAM;AAAA;AAAA;AAAA,MAGZ,cAAc;AAAA,oBACAE,iBAAe;AAAA,EAC3B,MAAM,MAAM,OAAO,MAAM;AAAA,EACzB,WAAW,MAAM,OAAO;AAC1B,CAAC,CAAC;AAAA;AAAA,GAGP,GAMK,oBAAoB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAgB3B,iBAAiB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAY3B,sBAAsB,OAAO,GAAG,EACnC,MAAgC,CAAC,EAAC,eAAc;AAAA,EAC/C,OAAO,EAAC,QAAQ,GAAG,OAAO,KAAI;AAChC,EAAE;AAAA;AAAA;AAAA,GAeS,cAAc,WAAgD,SACzE;AAAA,EACE,qBAAqB;AAAA,EACrB;AAAA,EACA,sBAAsB;AAAA,EACtB;AAAA,EACA;AAAA,EACA;AAAA,EACA,kBAAkB;AAAA,EAClB;AAAA,EACA,YAAAC;AAAA,EACA;AAAA,EACA;AAAA,EACA,qBAAqB;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,0BAA0B;AAAA,EAC1B;AAAA,EACA;AAAA,EACA;AAAA,EACA,aAAa;AAAA,EACb,GAAG;AACL,GACA,KACA;AACA,QAAM,eAAe,OAAO,EAAK,GAC3B,gBAAgB,OAAO,OAAO,GAC9B,iBAAiB,OAAO,gBAAA,OAAA,eAAgB,CAAC,GAEzC,CAAC,uBAAuB,wBAAwB,IAAI,SAA6B,IAAI,GACrF,CAAC,SAAS,UAAU,IAAI,SAAS,EAAK,GACtC,CAAC,uBAAuB,wBAAwB,IAAI,SAAgC,IAAI,GACxF,CAAC,oBAAoB,qBAAqB,IAAI,SAA6B,IAAI,GAE/E,eAAe;AAAA,IACnB,CAAC,MAAyC;AACxC,UAAI,CAAC;AAAc;AAEb,YAAA,CAAC,QAAQ,IAAI,CAAC,GAAG,EAAE,gBAAiB,CAAA,EAAE;AAE5C,MAAK,YAEc,SAAS,SAAS,MAAM,SAAS,0BAA0B,KAG5D,aAAa,WAC7B;IAEJ;AAAA,IACA,CAAC,cAAc,MAAM,QAAQ,uBAAuB;AAAA,EAAA,GAIhD,cAAc,eAAe;AAAA,IACjC,OAAO,MAAM;AAAA,IACb,YAAAA;AAAA,IACA,kBAAkB,MAAM;AAAA,IACxB,cAAc,MAAM;AAAA,IACpB,UAAU;AAAA,IACV;AAAA,EAAA,CACD,GAgBK,cAAc,QAAQ,MAAM;AAChC,QAAI,IAAI;AACR,WAAO,MAAM,OAMX,CAAC,KAAK,GAAG,UAAU;AAxLzB,UAAAV,KAAA;AAyLY,YAAA,YAAWA,yDAAkB,KAAlB,MAAA,OAAAA,MAA4B,IACvC,YAAW,KAAA,mBAAA,OAAA,SAAA,gBAAkB,WAAlB,OAA4B,KAAA;AAC7C,aAAK,aACH,KAAK,IAEP,IAAI,KAAK,IAAI;AAAA,QACX,aAAa,WAAW,OAAO;AAAA,QAC/B;AAAA,QACA;AAAA,MAEK,GAAA;AAAA,IACT,GAAG,CAAE,CAAA;AAAA,EAAA,GACJ,CAAC,iBAAiB,iBAAiB,KAAK,CAAC,GAEtC,kBAAkB;AAAA,IACtB,MAAM,YAAY,OAAO,CAAC,MAAM,CAAC,EAAE,QAAQ,EAAE;AAAA,IAC7C,CAAC,WAAW;AAAA,KAMR,oCAAoC;AAAA,IACxC,CAAC,YACC,yBAAA,OAAA,SAAA,sBAAuB,aAAa,iBAAiB,CAAC,SAAS,SAAS,CAAA;AAAA,IAC1E,CAAC,qBAAqB;AAAA,KAGlB,uBAAuB;AAAA,IAC3B,CAAC,UAAkB,GAAG,cAAc,OAAO,SAAS,KAAK;AAAA,IACzD,CAAC;AAAA,EAGG,GAAA,2BAA2B,YAAY,MAAM,GAAG,cAAc,OAAO,aAAa,CAAE,CAAA,GAMpF,0BAA0B,YAAY,MAAM;AAC1C,UAAA,WAAW,CAAC,cAAc,kBAAkB,EAAE,KAAK,CAAC,OAAO,SAAS,kBAAkB,EAAE;AAC1F,QAAA,+BAA+B,CAAC,YAAY,CAAC;AAC/C;AAGF,UAAM,gBAAgB,MAAM,MAAK,yBAAuB,OAAA,SAAA,sBAAA,aAAY,CAAE,CAAA;AACvD,qBAAA,QAAA,cAAA,QAAQ,CAAC,UAAU;AAvOtC,UAAAA,KAAA,IAAA;AAwOY,YAAA,eAAe,QAAOA,MAAA,MAAM,YAAN,OAAA,SAAAA,IAAe,KAAK,GAC1C,eAAc,KAAA,YAAY,YAAY,MAAxB,OAA2B,SAAA,GAAA;AAC/C,OAAA,KAAA,MACG,cAAc,8BAA8B,MAD/C,WAEI,gBAAgB,oBAAoB,gBAAgB,eAAe,OAAA;AAAA,IAAA,CACzE;AAAA,EAAA,GACC;AAAA,IACD;AAAA,IACA,yBAAuB,OAAA,SAAA,sBAAA;AAAA,IACvB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD,GAKK,0BAA0B,YAAY,MAAM;AAChD,UAAM,gBAAgB,MAAM,MAAK,yBAAuB,OAAA,SAAA,sBAAA,aAAY,CAAE,CAAA;AACvD,qBAAA,QAAA,cAAA,QAAQ,CAAC,UAAU;AA7PtC,UAAAA;AA8PM,OAAAA,MAAA,MACG,cAAc,8BAA8B,MAD/C,QAAAA,IAEI,gBAAgB,oBAAoB,EAAA;AAAA,IAAA,CAC1C;AAAA,EAAA,GACC,CAAC,oBAAoB,yBAAA,OAAA,SAAA,sBAAuB,QAAQ,CAAC,GAKlD,sCAAsC,QAAQ,MAC3C,SAAS,yBAAyB,GAAG,GAC3C,CAAC,uBAAuB,CAAC,GAKtB,+BAA+B,YAAY,MAAM;AACrD,UAAM,cAAc,kBAAgB,OAAA,SAAA,eAAA;AAChC,UAAM,SAAS,KACjB,qCAAc,aAAa,yBAAyB,qBAAqB,WAAW,CAAA,GACpF,iDAAoB,aAAa,yBAAyB,qBAAqB,WAAW,CAAA,MAE1F,qCAAc,gBAAgB,uBAAA,GAC9B,iDAAoB,gBAAgB,uBAAA;AAAA,EAAA,GAErC,CAAC,sBAAsB,cAAc,MAAM,QAAQ,kBAAkB,CAAC,GAKnE,oBAAoB,YAAY,MAAM;AA5R9C,QAAAA,KAAA;AA6RI,UAAM,8BAA8B,yBAAuB,OAAA,SAAA,sBAAA;AAC3D,QAAI,yBAAyB,6BAA6B;AACxD,YAAM,SACJ,4BAA4B,wBAAwB,MACpD,sBAAsB,sBAAwB,EAAA;AAChD,cAAO,wBAAY,wBAAwB,MAAM,MAA1C,OAAA,SAAAA,IAA6C,UAA7C,OAAsD,KAAA;AAAA,IAC/D;AACO,WAAA;AAAA,KACN,CAAC,uBAAuB,WAAW,CAAC,GAKjC,iBAAiB;AAAA,IACrB,CAAC;AAAA,MACC;AAAA,MACA;AAAA,MACA,gBAAAW,kBAAiB;AAAA,IAAA,MAKb;AAKJ,UAJA,eAAe,UAAU,OACzB,gCACA,2BAEIA,iBAAgB;AAClB,cAAM,mBAAmB,YAAY,UAAU,CAAC,MAAM,EAAE,gBAAgB,KAAK;AACzE,2BAAmB,MACrB,YAAY,cAAc,kBAAkB,cAAc,EAAC,OAAO,YAAe,IAAA,CAAE,CAAA;AAAA,MAEvF;AAAA,IACF;AAAA,IACA,CAAC,8BAA8B,aAAa,yBAAyB,WAAW;AAAA,KAM5E,0BAA0B;AAAA,IAC9B,CAAC,cAAmC;AAClC,UAAI,YAAY;AAChB,YAAM,YAAY,kBAAkB;AAEpC,UAAI,cAAc,QAAQ;AAClB,cAAA,kBAAkB,aAAa,IAAI;AACzC,oBACE,eAAe,UAAU,kBAAkB,IACvC,eAAe,UAAU,IACzB;AAAA,MACR;AACA,UAAI,cAAc,YAAY;AACtB,cAAA,kBAAkB,aAAa,YAAY;AACjD,oBAAY,eAAe,UAAU,IAAI,eAAe,UAAU,IAAI;AAAA,MACxE;AACe,qBAAA,EAAC,OAAO,WAAW,gBAAgB,IAAK,GACvD,kCAAkC,EAAK;AAAA,IACzC;AAAA,IACA,CAAC,iBAAiB,mCAAmC,gBAAgB,UAAU;AAAA,KAG3E,eAAe;AAAA,IACnB,CAAC,SAAiC;AAChC,cAAQ,MAAM;AAAA,QACZ,KAAK;AACW,0BAAA,QAAA,aAAA;AACd;AAAA,QACF,KAAK;AACiB,gCAAA,QAAA,mBAAA;AACpB;AAAA,MAGJ;AAAA,IACF;AAAA,IACA,CAAC,cAAc,kBAAkB;AAAA,EAAA,GAG7B,oBAAoB,YAAY,MAAM;AAC5B,oBAAA,QAAA,aAAA;KACb,CAAC,YAAY,CAAC,GAEX,mBAAmB,YAAY,MAAM;AACrB,0BAAA,QAAA,mBAAA;EACnB,GAAA,CAAC,kBAAkB,CAAC,GAKjB,wBAAwB;AAAA,IAC5B,CAAC,UAAkB,MAAM;AACvB,qBAAe,EAAC,OAAO,gBAAgB,GAAM,CAAA;AAAA,IAC/C;AAAA,IACA,CAAC,cAAc;AAAA,EAAA,GAGX,cAAc,YAAY,MAAM;AACZ;EACvB,GAAA,CAAC,uBAAuB,CAAC,GAOtB,gBAAgB;AAAA,IACpB,CAAC,SAAiC,CAAC,UAAyB;AAC1D,YAAM,gBAAgB,MAAM,MAAK,yBAAuB,OAAA,SAAA,sBAAA,aAAY,CAAE,CAAA;AACtE,UAAK,cAAc,WAIf,MAAM,QAAQ,gBAChB,MAAM,eAAe,GACrB,aAAa,IAAI,GACjB,wBAAwB,MAAM,IAE5B,MAAM,QAAQ,cAChB,MAAM,eAAe,GACrB,aAAa,IAAI,GACjB,wBAAwB,UAAU,IAGhC,MAAM,QAAQ,UAAS;AACnB,cAAA,eAAA,GACN,aAAa,IAAI;AACjB,cAAM,iBAAiB,cAAc;AAAA,UACnC,CAAC,OACC,OAAO,GAAG,QAAQ,KAAK,MACvB,YAAY,UAAU,CAAC,MAAM,EAAE,gBAAgB,eAAe,OAAO;AAAA,QAAA;AAGzE,YAAI,gBAAgB;AAClB,gBAAM,mBAAmB,kBAAgB,OAAA,SAAA,eAAA;AAAA,YACvC;AAAA,UAAA;AAEgB,8BAAA,QAAA,iBAAA;QACpB;AAAA,MACF;AAAA,IACF;AAAA,IACA,CAAC,yBAAA,OAAA,SAAA,sBAAuB,UAAU,cAAc,aAAa,uBAAuB;AAAA,KAEhF,qBAAqB;AAAA,IACzB,CAAC,UAAyB,cAAc,OAAO,EAAE,KAAK;AAAA,IACtD,CAAC,aAAa;AAAA,KAEV,oBAAoB;AAAA,IACxB,CAAC,UAAyB,cAAc,MAAM,EAAE,KAAK;AAAA,IACrD,CAAC,aAAa;AAAA,EAAA,GAGV,8BAA8B,YAAY,MAAM;AAChD,oCACF,wBACA,GAAA,WAAW,EAAI;AAAA,EAAA,GAEhB,CAAC,6BAA6B,uBAAuB,CAAC,GACnD,8BAA8B,YAAY,MAAM;AAChD,oCACF,wBACA,GAAA,WAAW,EAAK;AAAA,EAAA,GAEjB,CAAC,yBAAyB,2BAA2B,CAAC;AAEzD;AAAA,IACE;AAAA,IACA,OACS;AAAA,MACL,oBAAoB;AACA;MACpB;AAAA,MACA,mBAAmB;AACA;MACnB;AAAA,MACA,cAAc;AACZ,eAAO,kBAAkB;AAAA,MAC3B;AAAA,MACA,cAAc,OAAe;AAC3B,uBAAe,EAAC,MAAM,CAAA,GACtB,kCAAkC,EAAI;AAAA,MACxC;AAAA,IAAA;AAAA,IAGJ;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF,GAKA,UAAU,MAAM;AACV,WAAO,eAAiB,OAAe,CAAC,aAAa,WACvD,eAAe;AAAA,MACb,OAAO;AAAA,MACP,aAAa;AAAA,MACb,gBAAgB;AAAA,IACjB,CAAA,GAEH,aAAa,UAAU;AAAA,EAAA,GACtB,CAAC,cAAc,oBAAoB,6BAA6B,cAAc,CAAC,GAKlF,UAAU,MAAM;AACd,aAAS,mBAAmB;AAC1B,wCAAkC,EAAI;AAAA,IACxC;AACoB,WAAA,sBAAA,QAAA,mBAAA,iBAAiB,aAAa,gBAAA,GAClD,sBAAoB,QAAA,mBAAA,iBAAiB,SAAS,kBAAkB,EAAC,SAAS,GAAI,CAAA,GACvE,MAAM;AACX,4BAAA,QAAA,mBAAoB,oBAAoB,aAAa,gBACrD,GAAA,sBAAA,QAAA,mBAAoB,oBAAoB,SAAS,gBAAA;AAAA,IAAA;AAAA,EACnD,GACC,CAAC,mCAAmC,kBAAkB,CAAC,GAK1D,UAAU,OACR,gBAAc,QAAA,aAAA,iBAAiB,SAAS,WAAA,GACxC,qCAAc,iBAAiB,WAAW,kBAC1C,GAAA,sBAAA,QAAA,mBAAoB,iBAAiB,SAAS,cAC9C,sBAAoB,QAAA,mBAAA,iBAAiB,WAAW,iBAAA,GACzC,MAAM;AACX,oBAAA,QAAA,aAAc,oBAAoB,SAAS,WAC3C,GAAA,gBAAA,QAAA,aAAc,oBAAoB,WAAW,kBAC7C,GAAA,sBAAA,QAAA,mBAAoB,oBAAoB,SAAS,WACjD,GAAA,sBAAA,QAAA,mBAAoB,oBAAoB,WAAW,iBAAA;AAAA,EAAA,IAEpD;AAAA,IACD;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD,GAMD,UAAU,MAAM;AACe;KAC5B,CAAC,8BAA8B,KAAK,CAAC,GAWxC,UAAU,MAAM;AACR,UAAA,mBAAmB,IAAI,iBAAiB,mCAAmC;AAE7E,WAAA,yBACF,iBAAiB,QAAQ,uBAAuB;AAAA,MAC9C,WAAW;AAAA,MACX,SAAS;AAAA,IACV,CAAA,GAGI,MAAM;AACX,uBAAiB,WAAW;AAAA,IAAA;AAAA,KAE7B,CAAC,uBAAuB,mCAAmC,CAAC,GAK/D,UAAU,MAAM;AACd,oBAAA,QAAA,aAAc,aAAa,qBAAqB,MAChD,GAAA,gBAAA,QAAA,aAAc,aAAa,iBAAiB,MAAA,GAC5C,gBAAc,QAAA,aAAA,aAAa,iBAAiB,yBAAA,CAC5C,GAAA,gBAAA,QAAA,aAAc,aAAa,QAAQ,UAAA;AAAA,KAClC,CAAC,0BAA0B,YAAY,CAAC,GAK3C,UAAU,MAAM;AACV,iBACF,aAAa,SAAS;AAAA,EAAA,GAEvB,CAAC,WAAW,iBAAiB,kBAAkB,mBAAmB,YAAY,CAAC;AAE5E,QAAA,eAAe,kBAAkB,IAAI;AAGzC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,IAAI,yBAAyB;AAAA,MAC7B,cAAc;AAAA,MACd,cAAc;AAAA,MACd,KAAK;AAAA,MACL,QAAO;AAAA,MACP,UAAU;AAAA,MACT,GAAG;AAAA,MAEH,UAAA;AAAA,QAAmB,mBAAA,oBAAC,iBAAgB,EAAA,QAAQ,gBAAiB,CAAA;AAAA,4BAC7D,mBAAkB,EAAA,eAAY,QAAO,gBAAY,IAAC,KAAK,0BAA0B;AAAA,QACjF,eACC;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,aAAY;AAAA,YACZ,SAAS,YAAY,aAAa;AAAA,YAClC,cAAY;AAAA,YACZ,wBAAsB;AAAA,YACtB,MAAM;AAAA,YACN,KAAK;AAAA,YACL,MAAK;AAAA,YAEJ,UAAY,YAAA,gBAAkB,EAAA,IAAI,CAAC,eAAe;AACjD,oBAAM,eAAe,WAAW,OAC1B,EAAC,aAAa,UAAU,SAAA,IAAY,YAAY,YAAY,GAE5D,eAAe,WAAW,MAAM,YAAY,GAAG;AAAA,gBACnD;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA;AAAA,cAAA,CACD,GAEK,aAAa,aAAa,cAAc;AAAA,gBAC5C,UAAU;AAAA,cACX,CAAA,GAEK,uBACJ,OAAO,eAAgB,YAAY,CAAC,WAChC;AAAA,gBACE,iBAAiB,cAAc;AAAA,gBAC/B,GAAI,sBAAsB,EAAC,iBAAiB,SAAS,SAAS,MAAK,CAAC;AAAA,gBACpE,gBAAgB;AAAA,gBAChB,IAAI,qBAAqB,WAAW;AAAA,gBACpC,MAAM;AAAA,gBACN,cAAc,sBAAsB,WAAW;AAAA,kBAEjD;AAGJ,qBAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,IAAG;AAAA,kBACH,cAAY;AAAA,kBAEZ,KAAK,cAAc,SAAY,YAAY;AAAA,kBAC3C,OAAO;AAAA,oBACL,MAAM;AAAA,oBACN,GAAI,cAAc,EAAC,QAAQ,GAAG,WAAW,IAAI,KAAI,IAAI,CAAC;AAAA,oBACtD,MAAM;AAAA,oBACN,UAAU;AAAA,oBACV,KAAK;AAAA,oBACL,WAAW,cAAc,WAAW,KAAK;AAAA,oBACzC,OAAO;AAAA,kBACT;AAAA,kBACA,UAAU;AAAA,kBACT,GAAG;AAAA,kBAEH,UAAA;AAAA,gBAAA;AAAA,gBAdI,WAAW;AAAA,cAAA;AAAA,YAelB,CAEH;AAAA,UAAA;AAAA,QACH;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAIR,CAAC,GCpoBY,oBAAoB,WAAW,SAC1CtB,QAEA,KACA;AACA,QAAM,EAAC,OAAO,SAAS,cAAc,MAAM,GAAG,KAAI,IAAIA,QAEhD,EAAC,GAAAa,GAAC,IAAI,eAAe;AAGzB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,MAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA;AAAA,MACA,cAAc;AAAA,QACZ,GAAG;AAAA,QACH,UAAS,gBAAA,OAAA,SAAA,aAAc,YAAWA,GAAE,oCAAoC;AAAA,MAC1E;AAAA,IAAA;AAAA,EAAA;AAGN,CAAC;AC3BM,SAAS,uBAAuB,EAAC,MAAM,MAAA,GAAuB,OAAuB;AACtF,SAAA,OAAO,QAAS,YAAY,KAAK,KAAO,EAAA,SAAS,IAC5C,OAGF,+BAA+B,OAAO,KAAK;AACpD;AAGgB,SAAA,+BAA+B,OAA2B,OAAuB;AACzF,QAAA,YACJ,OAAO,SAAU,YAAY,MAAM,KAAK,EAAE,SAAS,IAAI,aAAa,KAAK,OAAO;AAC3E,SAAA,YAAY,KAAK,GAAG,SAAS;AACtC;AChBa,MAAA,oBAAoB,cAA6C,IAAI;ACF3E,SAAS,gBAAoC;AAC5C,QAAA,aAAa,WAAW,iBAAiB;AAC/C,MAAI,CAAC;AAAkB,UAAA,IAAI,MAAM,qCAAqC;AAC/D,SAAA;AACT;ACEO,MAAM,iCAAiC,MAAM;AAAA,EAIlD,YAAY,SAAiB,SAA2C;AACtE,UAAM,OAAO,GACb,KAAK,QAAQ,mCAAS,OACtB,KAAK,cAAa,WAAA,OAAA,SAAA,QAAS,cAAa,uBAAuB,QAAQ,WAAW,QAAQ,KAAK;AAAA,EACjG;AACF;ACHgB,SAAA,mBAAmB,EAAC,cAA6C;AAC/E,MAAI,WAAW,WAAW;AAClB,UAAA,IAAI,yBAAyB,qCAAqC;AAG5D,gBAAA,UAAU,GACxB,kBAAkB,UAAU;AAC9B;AASO,SAAS,cAAc,YAAmC;AAC/D,QAAM,oBAAoB,WAAW,WAAW,GAC1C,4BAAY;AACP,aAAA,QAAQ,CAAC,WAAW,UAAU;AACjC,UAAA,EAAC,MAAM,SAAS,UAAS,WACzB,iBAAiB,+BAA+B,OAAO,KAAK;AAE9D,QAAA,CAAC,WAAW,CAAC;AACf,YAAM,IAAI;AAAA,QACR,6FACe,cAAc;AAAA,QAC7B,EAAC,WAAW,MAAK;AAAA,MAAA;AAIrB,UAAM,OAAO,qBAAqB,OAAO,UAAY,MAAc,YAAY;AAE/E,QAAI,OAAO,QAAS;AAClB,YAAM,IAAI;AAAA,QACR,sBAAsB,KAAK;AAAA,QAC3B,EAAC,WAAW,MAAK;AAAA,MAAA;AAIrB,UAAM,aAAa,KAAK,eAClB,oBAAoB,MAAM,IAAI,UAAU;AAE9C,QAAI,mBAAmB;AACrB,YAAM,iBAAiB;AAAA,QACrB,kBAAkB,UAAU;AAAA,QAC5B,kBAAkB;AAAA,MAAA;AAEpB,YAAM,IAAI;AAAA,QACR,uCAAuC,cAAc,kBACtC,cAAc,6BAA6B,IAAI;AAAA,QAC9D,EAAC,WAAW,MAAK;AAAA,MAAA;AAAA,IAErB;AAEA,QAAA,MAAM,IAAI,YAAY,EAAC,OAAO,UAAU,CAAA,GAEpC,CAAC,yBAAyB,KAAK,IAAI;AACrC,YAAM,IAAI;AAAA,QACR,wIAEe,cAAc,2BAA2B,IAAI;AAAA,QAC5D,EAAC,WAAW,MAAK;AAAA,MAAA;AAAA,EACnB,CAEH;AACH;AASO,SAAS,kBAAkB,YAAmC;AAE/D,aAAW,SAAS,KACtB,WAAW,MAAM,WAAW,GAG9B,WAAW,MAAM,gBAAgB;AAEjC,QAAM,CAAC,gBAAgB,GAAG,gBAAgB,IAAI,YACxC,8BAA8B,eAAe,YAAY,KAE5D,UAAU,CAAC,EACX,MAAM,GAAG,EACT,OAAO,OAAO,EAAE;AAEF,mBAAA,QAAQ,CAAC,WAAW,UAAU;AACvC,UAAA,yBAAyB,UAAU,YAAY,KAElD,UAAU,CAAC,EACX,MAAM,GAAG,EAAE;AAEd,QAAI,+BAA+B;AACjC,YAAM,IAAI;AAAA,QACR,kFAAkF;AAAA,UAChF;AAAA,UACA;AAAA,QACD,CAAA,UAAU,0BAA0B,WACnC,+BAA+B,IAAI,KAAK,GAC1C,MAAM,eAAe,QAAQ,sBAAsB;AAAA,UACjD;AAAA,UACA;AAAA,QACD,CAAA,UAAU,qBAAqB,WAAW,0BAA0B,IAAI,KAAK,GAAG,MAC/E,UAAU,QACZ;AAAA,QACA,EAAC,WAAW,MAAK;AAAA,MAAA;AAAA,EACnB,CAEH;AAEK,QAAA,gCAAgB;AACX,aAAA,QAAQ,CAAC,WAAW,UAAU;AACjC,UAAA,YAAY,UAAU,YAAY,IAAI,YAEtC,GAAA,oBAAoB,UAAU,IAAI,QAAQ;AAC5C,QAAA;AACF,YAAM,IAAI;AAAA,QACR,8CAA8C,iBAAiB,YACxD;AAAA,UACH;AAAA,UACA;AAAA,QAAA,CACD,mCAAmC,QAAQ;AAAA,QAC9C,EAAC,WAAW,MAAK;AAAA,MAAA;AAIrB,cAAU,IAAI,UAAU,uBAAuB,WAAW,KAAK,CAAC;AAAA,EAAA,CACjE;AACH;AAEA,SAAS,YAAY,WAA0B,OAAe;AACtD,QAAA,EAAC,MAAM,SAAY,IAAA;AACrB,MAAA,YAAY,OAAO,YAAa;AAC3B,WAAA;AAGL,QAAA,OAAO,WAAa,MAChB,IAAI;AAAA,IACR,wGACiB,IAAI;AAAA,IACrB,EAAC,WAAW,MAAK;AAAA,MAIf,IAAI;AAAA,IACR,wGACiB,IAAI;AAAA,IACrB,EAAC,WAAW,MAAK;AAAA,EAAA;AAErB;AAEA,SAAS,iBAAiB,WAA0B,OAAe;AAC3D,QAAA,EAAC,MAAM,SAAY,IAAA;AAIzB,MAAI,GAAC,YAAY,aAAa,QAI1B,CAAC,+BAA+B,KAAK,QAAQ;AAC/C,UAAM,IAAI;AAAA,MACR,uJAGiB,IAAI,sBAAsB,QAAQ;AAAA,MACnD,EAAC,WAAW,MAAK;AAAA,IAAA;AAGvB;ACxLA,MAAM,cAAc,MAAM,cAAcU,UAAQ;AAEhD,SAAS,2BACP,kBACA,sBACkB;AAClB,SAAO,CAAC,eAAkB;AAGxB,QAAI,OAAO,CAACvB,WAAa,cAAc,kBAAkBA,MAAK;AAE9D,eAAW,cAAc,sBAAsB;AAG7C,YAAM,gBAAgB;AAGf,aAAA,CAACA,WAAU,cAAc,YAAY,EAAC,GAAGA,QAAO,eAAc;AAAA,IACvE;AAEA,WAAO,KAAK;AAAA,MACV,GAAG;AAAA;AAAA;AAAA;AAAA,MAIH,eAAe;AAAA,IAAA,CAChB;AAAA,EAAA;AAEL;AAuBO,SAAS,wBAAsCA,QAGjC;AACb,QAAA,EAAC,QAAW,IAAA,YAAY,YACxB,EAAC,kBAAkB,MAAAwB,MAAQ,IAAAxB;AAEjC,SAAO,QAAQ,MAAM;AAEnB,UAAM,YAAY,CAAC,GAAG,cAAc,SAAS,CAAA,CAAE,CAAC;AAIhD,cAAU,QAAQ;AAOlB,UAAM,SAJmB,UAAU,IAAI,CAAC,EAAC,OAAA,MAAYwB,MAAK,MAAM,CAAC,EAIjC,OAAO,OAAO;AAGvC,WAAA,2BAA2B,kBAAkB,MAAM;AAAA,EACzD,GAAA,CAAC,kBAAkB,SAASA,KAAI,CAAC;AACtC;ACzEO,MAAM,4BAA4B,MAAM;AAAA,EAK7C,YAAY,EAAC,cAAc,MAAM,SAAoC;AAC7D,UAAA,UACJjB,WAAS,KAAK,KAAK,QAAO,SAAO,OAAA,SAAA,MAAA,YAAY,WAAW,KAAK,MAAM,OAAO,KAAK;AAEjF;AAAA,MACE,uCAAuC,YAAY,WAAW,KAAK,KAAK,KAAK,CAAC,GAAG,OAAO;AAAA,IAAA,GAG1F,KAAK,eAAe,cACpB,KAAK,QAAQ,OACb,KAAK,OAAO;AAAA,EACd;AACF;ACjBO,MAAM,8BAA8B,MAAM;AAAA,EAK/C,YAAY,EAAC,QAAQ,MAAM,QAAqC;AAC9D,UAAM,WAAW,OACd,OAAO,OAAO,EACd;AAAA,MAAI,CAAC,UACJA,WAAS,KAAK,KAAK,QAAO,SAAO,OAAA,SAAA,MAAA,YAAY,WAAW,MAAM,UAAU,OAAO,KAAK;AAAA,IAAA;AAGxF;AAAA,MACE,qBAAqB,IAAI,GAAG,OAAO,MAAM,IAAI,OAAO,EAAE;AAAA,EAAM,SACzD,IAAI,CAAC,YAAY,MAAO,OAAO,EAAE,EACjC,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA;AAAA,IAAA,GAGf,KAAK,OAAO,MACZ,KAAK,SAAS,QACd,KAAK,OAAO;AAAA,EACd;AACF;AC5BO,MAAM,8BAGT,CAAC,MAAM,EAAC,UAAAF,UAAA,GAAW,YAAY;AACjC,QAAM,uBAAuBA,aAAU,OAAA,SAAAA,UAAA;AACvC,MAAI,CAAC;AAA6B,WAAA;AAElC,MAAI,OAAO,wBAAyB;AAAmB,WAAA,qBAAqB,MAAM,OAAO;AACrF,MAAA,MAAM,QAAQ,oBAAoB;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,oBAAoB;AAEjF,QAAM,IAAI;AAAA,IACR,0FAA0F,OAAO,oBAAoB;AAAA,EAAA;AAEzH,GCVa,8BAAqD,CAAA,GCArD,gBAAgB,CAC3B,EAAC,UAAU,CAAI,GAAA,GAAG,cAAa,GAC/B,SACmD;AAEnD,QAAM,aAAa,EAAC,QAAQ,eAAe,MAAM,CAAC,GAAG,MAAM,cAAc,IAAI,EAAC,GAGxE,aAAa,QAAQ;AAAA,IAAQ,CAAC,WAClC,cAAc,QAAQ,CAAC,GAAG,MAAM,cAAc,IAAI,CAAC;AAAA,EACrD,GAGM,cAAc,WAAW,KAAK,CAAC,WAAW,OAAO,OAAO,SAAS,cAAc,GAE/E,WAAW;AAAA,IACf,GAAG,WAAW,OAAO,CAAC,WAAW,OAAO,OAAO,SAAS,cAAc;AAAA,IACtE;AAAA,EAAA;AAGF,SAAI,eACF,SAAS,KAAK,WAAW,GAEpB;AACT,GCzBMO,eAAa,IAGb,gBAAgB,KAGhB,aAAa,KAgBba,eAAa,OAAO,IAAI,EAAqB,CAAC,EAAC,YAC5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOH,QACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YASA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAMC;AAAA;AAAA,MAEHb,YAOD;AAAA;AAAA;AAAA;AAAA;AAAA,GAMJ,GAEK,gBAAgB,OAAO,OAAO,EAA+B,CAAC,EAAC,mBAAmB,GAC/E,MAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAiBQ,mBACT,kBAAkB,aAAa,mDAAmD,UAAU,qCAC5F,kBAAkB,aAAa,iCAAiC;AAAA,GAEvE,GAEKc,eAAa,OAAOC,MAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAkBR,UAAU;AAAA,qBACX,UAAU;AAAA;AASxB,SAAS,aAAa,EAAC,MAAM,UAAU,SAA0B;AACtE,8BACGF,cAAW,EAAA,OAAO,MAAM,IAAI,OAAO,QAAQ,OAC1C,UAAA;AAAA,IAAA,oBAAC,iBAAc,kBAAkB,CAAC,CAAC,UAAU,OAAK,IAAC;AAAA,IAClD,YAAa,oBAAA,aAAA,EAAY,MAAc,CAAA;AAAA,EAC1C,EAAA,CAAA;AAEJ;AAEA,SAAS,YAAY,EAAC,SAAiC;AAC/C,QAAA,EAAC,GAAAZ,OAAK;AAGV,SAAA,oBAACa,gBAAW,OAAK,IAAC,MAAM,GACrB,UAAA,SAASb,GAAE,gBAAgB,EAC9B,CAAA;AAEJ;AC5HO,SAAS,2BAA2B,QAAoD;AACtF,SAAA;AACT;AASO,SAAS,aAAa,QAA4C;AAChE,SAAA;AACT;AAUO,SAAS,uBACd,QACsC;AACtC,SAAO,EAAE,UAAU,OAAO,aAAa,OAAO,OAAO,UAAU,QAAS;AAC1E;AAcgB,SAAA,uBACd,WACA,WACG;AACI,SAAA;AACT;AAaO,SAAS,+BACd,WAC4C;AAC5C,QAAM,SAAqB,CAAA;AAE3B,aAAW,OAAO;AACZ,WAAO,UAAU,GAAG,IAAM,QAC5B,OAAO,GAAG,IAAI,UAAU,GAAG;AAIxB,SAAA;AACT;AC/Ea,MAAA,wBAAwB,UAQxB,4BAA4B,cCJ5B,sBAAsB,uBAAuB,UAAU;AAAA;AAAA,EAElE,uCAAuC;AAAA;AAAA,EAEvC,2CAA2C;AAAA;AAAA,EAE3C,+CAA+C;AAAA;AAAA,EAE/C,gDAAgD;AAAA;AAAA,EAEhD,2CAA2C;AAAA;AAAA,EAE3C,4CAA4C;AAAA;AAAA,EAE5C,4CAA4C;AAAA;AAAA,EAE5C,0CAA0C;AAAA;AAAA,EAE1C,2CAA2C;AAAA;AAAA,EAE3C,sCAAsC;AAAA;AAAA,EAEtC,mEACE;AAAA;AAAA,EAEF,qEACE;AAAA;AAAA,EAEF,oEACE;AAAA;AAAA,EAEF,sEACE;AAAA;AAAA,EAEF,2DAA2D;AAAA;AAAA,EAE3D,sEACE;AAAA;AAAA,EAEF,wEACE;AAAA;AAAA,EAEF,uEACE;AAAA;AAAA,EAEF,yEACE;AAAA;AAAA,EAEF,sCACE;AAAA;AAAA;AAAA,EAGF,0CAA0C;AAAA;AAAA,EAE1C,2CAA2C;AAAA;AAAA,EAE3C,iCAAiC;AAAA;AAAA,EAEjC,sCAAsC;AAAA;AAAA,EAEtC,uCAAuC;AAAA,EACvC,kFACE;AAAA,EACF,mDAAmD;AAAA,EACnD,oDAAoD;AAAA,EACpD,yDAAyD;AAAA,EACzD,wDAAwD;AAAA,EACxD,8CAA8C;AAAA,EAC9C,kDAAkD;AAAA,EAClD,kDAAkD;AAAA;AAAA,EAElD,gDAAgD;AAAA,EAChD,4CAA4C;AAAA,EAC5C,4CAA4C;AAAA;AAAA,EAE5C,2BAA2B;AAAA,EAC3B,+CAA+C;AAAA;AAAA,EAE/C,mDAAmD;AAAA;AAAA,EAEnD,4BAA4B;AAAA,EAC5B,0DACE;AAAA,EACF,4DACE;AAAA;AAAA,EAEF,2DACE;AAAA,EACF,4DAA4D;AAAA,EAC5D,8DACE;AAAA;AAAA,EAEF,6DAA6D;AAAA,EAC7D,2DACE;AAAA,EACF,6DACE;AAAA;AAAA,EAEF,4DACE;AAAA,EACF,6DAA6D;AAAA,EAC7D,+DACE;AAAA;AAAA,EAEF,8DAA8D;AAAA;AAAA,EAG9D,oCAAoC;AAAA;AAAA,EAEpC,mCAAmC;AAAA;AAAA,EAEnC,wCAAwC;AAAA;AAAA,EAExC,uCAAuC;AAAA;AAAA,EAEvC,+BAA+B;AAAA;AAAA,EAE/B,0CAA0C;AAAA;AAAA,EAE1C,kCAAkC;AAAA;AAAA,EAElC,mCAAmC;AAAA;AAAA,EAEnC,sCAAsC;AAAA;AAAA,EAEtC,+BAA+B;AAAA;AAAA,EAE/B,iCAAiC;AAAA;AAAA,EAEjC,uCAAuC;AAAA;AAAA,EAEvC,sCAAsC;AAAA;AAAA,EAEtC,oCAAoC;AAAA;AAAA,EAEpC,8BAA8B;AAAA;AAAA,EAE9B,+BAA+B;AAAA;AAAA,EAE/B,iCAAiC;AAAA;AAAA,EAEjC,iCAAiC;AAAA;AAAA,EAEjC,gCAAgC;AAAA;AAAA,EAEhC,6BAA6B;AAAA;AAAA,EAE7B,6BAA6B;AAAA;AAAA,EAE7B,8BAA8B;AAAA;AAAA,EAE9B,4BAA4B;AAAA;AAAA,EAE5B,iCAAiC;AAAA;AAAA,EAEjC,gCAAgC;AAAA;AAAA,EAEhC,kCAAkC;AAAA;AAAA,EAElC,uCAAuC;AAAA;AAAA,EAEvC,uCAAuC;AAAA;AAAA,EAEvC,yCAAyC;AAAA;AAAA,EAEzC,uCAAuC;AAAA;AAAA,EAEvC,yCAAyC;AAAA;AAAA,EAEzC,wCAAwC;AAAA;AAAA,EAExC,0CAA0C;AAAA;AAAA,EAG1C,8BAA8B;AAAA;AAAA,EAE9B,oCAAoC;AAAA;AAAA,EAEpC,qCAAqC;AAAA;AAAA,EAErC,yCAAyC;AAAA;AAAA,EAEzC,oDAAoD;AAAA;AAAA,EAEpD,sDAAsD;AAAA;AAAA,EAEtD,6CAA6C;AAAA;AAAA,EAE7C,iDAAiD;AAAA;AAAA,EAEjD,uBAAuB;AAAA;AAAA,EAEvB,wCAAwC;AAAA,EACxC,qCAAqC;AAAA,EACrC,uCAAuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMvC,mCAAmC;AAAA,EACnC,qCAAqC;AAAA;AAAA,EAErC,4CAA4C;AAAA;AAAA,EAE5C,iCAAiC;AAAA;AAAA,EAEjC,yBAAyB;AAAA;AAAA,EAEzB,6BAA6B;AAAA;AAAA,EAE7B,yCAAyC;AAAA;AAAA,EAEzC,gCAAgC;AAAA;AAAA,EAEhC,wCACE;AAAA;AAAA,EAEF,yCAAyC;AAAA;AAAA,EAEzC,8BAA8B;AAAA;AAAA,EAE9B,yBAAyB;AAAA;AAAA,EAEzB,qCAAqC;AAAA;AAAA,EAErC,iCAAiC;AAAA;AAAA,EAEjC,0CAA0C;AAAA;AAAA,EAE1C,8BAA8B;AAAA;AAAA,EAE9B,sCAAsC;AAAA;AAAA,EAEtC,gCAAgC;AAAA;AAAA,EAEhC,gCAAgC;AAAA;AAAA,EAEhC,8BAA8B;AAAA;AAAA,EAE9B,0BAA0B;AAAA;AAAA,EAE1B,2BAA2B;AAAA;AAAA,EAE3B,kCACE;AAAA;AAAA,EAEF,4BAA4B;AAAA;AAAA,EAE5B,0CAA0C;AAAA;AAAA,EAE1C,4CAA4C;AAAA;AAAA,EAE5C,4CAA4C;AAAA;AAAA,EAE5C,8CAA8C;AAAA;AAAA,EAE9C,6CACE;AAAA;AAAA,EAEF,4CAA4C;AAAA;AAAA,EAE5C,6CAA6C;AAAA;AAAA,EAE7C,iDAAiD;AAAA;AAAA,EAEjD,0CAA0C;AAAA;AAAA,EAE1C,4CAA4C;AAAA;AAAA,EAE5C,4CAA4C;AAAA;AAAA,EAE5C,6CAA6C;AAAA;AAAA,EAE7C,+CAA+C;AAAA;AAAA,EAE/C,+CAA+C;AAAA;AAAA,EAE/C,iDAAiD;AAAA;AAAA,EAEjD,oCAAoC;AAAA;AAAA,EAEpC,sCAAsC;AAAA;AAAA,EAEtC,wDAAwD;AAAA;AAAA,EAExD,2DAA2D;AAAA;AAAA,EAE3D,yBAAyB;AAAA;AAAA,EAEzB,iBAAiB;AAAA;AAAA;AAAA,EAIjB,sCAAsC;AAAA;AAAA,EAGtC,oCAAoC;AAAA;AAAA,EAGpC,qCAAqC;AAAA;AAAA,EAGrC,kBAAkB;AAAA;AAAA;AAAA,EAKlB,uCAAuC;AAAA;AAAA,EAGvC,oCAAoC;AAAA;AAAA,EAGpC,6BAA6B;AAAA;AAAA,EAE7B,iCAAiC;AAAA;AAAA,EAEjC,4BAA4B;AAAA;AAAA,EAE5B,6BAA6B;AAAA;AAAA,EAE7B,2BAA2B;AAAA;AAAA,EAE3B,0BAA0B;AAAA;AAAA,EAE1B,2BAA2B;AAAA;AAAA,EAG3B,0BAA0B;AAAA;AAAA,EAE1B,iCAAiC;AAAA;AAAA,EAEjC,6BAA6B;AAAA;AAAA,EAG7B,kEACE;AAAA;AAAA,EAEF,uDACE;AAAA;AAAA,EAEF,iDAAiD;AAAA;AAAA,EAEjD,wDAAwD;AAAA;AAAA,EAExD,2CACE;AAAA;AAAA,EAEF,yCAAyC;AAAA;AAAA,EAEzC,8BACE;AAAA;AAAA,EAEF,iDAAiD;AAAA;AAAA,EAEjD,gEACE;AAAA;AAAA,EAEF,qDACE;AAAA;AAAA,EAEF,+CAA+C;AAAA;AAAA,EAE/C,yCACE;AAAA;AAAA,EAEF,uCAAuC;AAAA;AAAA,EAEvC,oDACE;AAAA;AAAA,EAEF,8CAA8C;AAAA;AAAA,EAE9C,mDAAmD;AAAA;AAAA,EAEnD,wCACE;AAAA;AAAA,EAEF,sCAAsC;AAAA;AAAA,EAEtC,qCACE;AAAA;AAAA,EAEF,mCACE;AAAA;AAAA,EAEF,+BAA+B;AAAA;AAAA,EAE/B,mCAAmC;AAAA;AAAA,EAEnC,sCAAsC;AAAA;AAAA,EAEtC,wCAAwC;AAAA;AAAA,EAExC,uCAAuC;AAAA;AAAA,EAEvC,0CAA0C;AAAA;AAAA,EAE1C,4CAA4C;AAAA,EAC5C,8CAA8C;AAAA;AAAA,EAE9C,8CAA8C;AAAA,EAC9C,gDAAgD;AAAA;AAAA,EAGhD,qCAAqC;AAAA,EACrC,uCAAuC;AAAA;AAAA,EAEvC,qCAAqC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMrC,uCAAuC;AAAA;AAAA;AAAA;AAAA;AAAA,EAKvC,0CAA0C;AAAA;AAAA;AAAA;AAAA;AAAA,EAK1C,4CAA4C;AAAA;AAAA,EAE5C,wCAAwC;AAAA;AAAA,EAExC,iCAAiC;AAAA;AAAA,EAEjC,wBAAwB;AAAA;AAAA,EAGxB,oCAAoC;AAAA;AAAA,EAEpC,gEAAgE;AAAA;AAAA,EAEhE,sCAAsC;AAAA;AAAA,EAEtC,mEACE;AAAA;AAAA,EAEF,iCAAiC;AAAA;AAAA,EAEjC,kCAAkC;AAAA;AAAA,EAElC,gCAAgC;AAAA;AAAA;AAAA;AAAA;AAAA,EAKhC,4CAA4C;AAAA;AAAA,EAE5C,oCAAoC;AAAA;AAAA,EAEpC,iCAAiC;AAAA;AAAA,EAEjC,4BAA4B;AAAA;AAAA,EAE5B,8BAA8B;AAAA;AAAA,EAE9B,2CAA2C;AAAA;AAAA,EAE3C,4BAA4B;AAAA;AAAA,EAE5B,yDACE;AAAA;AAAA,EAEF,yDACE;AAAA;AAAA,EAEF,0DACE;AAAA;AAAA,EAEF,4DACE;AAAA;AAAA,EAEF,6DACE;AAAA;AAAA,EAEF,sDAAsD;AAAA;AAAA,EAEtD,kDACE;AAAA;AAAA,EAEF,iDAAiD;AAAA;AAAA,EAEjD,uCAAuC;AAAA;AAAA,EAEvC,+BAA+B;AAAA;AAAA,EAE/B,gCAAgC;AAAA;AAAA,EAEhC,wCAAwC;AAAA;AAAA,EAExC,+BAA+B;AAAA;AAAA,EAE/B,oDAAoD;AAAA;AAAA,EAEpD,kCAAkC;AAAA;AAAA,EAElC,4BAA4B;AAAA;AAAA,EAE5B,yCAAyC;AAAA;AAAA,EAEzC,gDACE;AAAA;AAAA,EAEF,sDAAsD;AAAA;AAAA,EAEtD,0CAA0C;AAAA;AAAA,EAE1C,wCAAwC;AAAA;AAAA,EAExC,yCAAyC;AAAA;AAAA,EAEzC,mCAAmC;AAAA;AAAA,EAEnC,sDAAsD;AAAA;AAAA,EAEtD,mDAAmD;AAAA;AAAA,EAEnD,mDAAmD;AAAA;AAAA,EAEnD,4DAA4D;AAAA;AAAA,EAE5D,kDAAkD;AAAA;AAAA,EAElD,iDAAiD;AAAA;AAAA,EAEjD,mDAAmD;AAAA;AAAA,EAEnD,6DAA6D;AAAA;AAAA,EAE7D,+DAA+D;AAAA;AAAA,EAE/D,gFACE;AAAA;AAAA,EAEF,kFACE;AAAA;AAAA,EAEF,6EACE;AAAA;AAAA,EAEF,+EACE;AAAA;AAAA,EAEF,gEAAgE;AAAA,EAChE,kEAAkE;AAAA;AAAA,EAElE,gEAAgE;AAAA;AAAA,EAEhE,iEAAiE;AAAA;AAAA,EAEjE,uDAAuD;AAAA;AAAA,EAEvD,wDAAwD;AAAA;AAAA,EAExD,6CAA6C;AAAA;AAAA,EAE7C,wDAAwD;AAAA;AAAA,EAExD,kDAAkD;AAAA;AAAA,EAElD,wDACE;AAAA;AAAA,EAEF,kDAAkD;AAAA;AAAA,EAElD,gDAAgD;AAAA;AAAA,EAEhD,qDAAqD;AAAA;AAAA,EAErD,gDAAgD;AAAA;AAAA,EAEhD,iCAAiC;AAAA;AAAA,EAEjC,gDAAgD;AAAA;AAAA,EAEhD,kDAAkD;AAAA;AAAA,EAElD,qDAAqD;AAAA;AAAA,EAErD,0CAA0C;AAAA;AAAA,EAE1C,qCAAqC;AAAA;AAAA,EAErC,kDACE;AAAA;AAAA,EAEF,wDAAwD;AAAA;AAAA,EAExD,4CAA4C;AAAA;AAAA,EAE5C,uCAAuC;AAAA;AAAA,EAEvC,yCAAyC;AAAA;AAAA,EAEzC,mCAAmC;AAAA;AAAA,EAEnC,gCACE;AAAA;AAAA,EAEF,+BAA+B;AAAA;AAAA,EAE/B,0BAA0B;AAAA;AAAA,EAE1B,4CAA4C;AAAA;AAAA,EAE5C,qCAAqC;AAAA;AAAA,EAErC,oCACE;AAAA;AAAA,EAEF,4CACE;AAAA;AAAA,EAEF,uDACE;AAAA;AAAA,EAEF,gDACE;AAAA;AAAA,EAEF,sCAAsC;AAAA;AAAA;AAAA,EAGtC,0CAA0C;AAAA;AAAA,EAE1C,8BAA8B;AAAA;AAAA,EAE9B,6CAA6C;AAAA;AAAA,EAE7C,sDACE;AAAA;AAAA,EAEF,yDAAyD;AAAA;AAAA,EAEzD,wDACE;AAAA,EACF,0DACE;AAAA;AAAA,EAEF,gEACE;AAAA,EACF,kEACE;AAAA;AAAA,EAEF,sDAAsD;AAAA;AAAA,EAEtD,kDAAkD;AAAA,EAClD,oDAAoD;AAAA;AAAA,EAEpD,+CAA+C;AAAA;AAAA,EAE/C,0DAA0D;AAAA;AAAA,EAE1D,6CAA6C;AAAA;AAAA,EAE7C,4CAA4C;AAAA;AAAA,EAE5C,uDAAuD;AAAA;AAAA,EAEvD,oDAAoD;AAAA;AAAA,EAEpD,+DAA+D;AAAA;AAAA,EAE/D,4DAA4D;AAAA;AAAA,EAE5D,wDAAwD;AAAA;AAAA,EAExD,gEACE;AAAA;AAAA,EAEF,sDAAsD;AAAA;AAAA,EAEtD,8CAA8C;AAAA;AAAA,EAE9C,gDAAgD;AAAA;AAAA,EAEhD,wCAAwC;AAAA;AAAA,EAExC,yCAAyC;AAAA;AAAA,EAEzC,mCAAmC;AAAA;AAAA,EAEnC,mDAAmD;AAAA;AAAA,EAEnD,6CAA6C;AAAA;AAAA,EAE7C,qCAAqC;AAAA;AAAA,EAErC,mCAAmC;AAAA;AAAA,EAEnC,uCAAuC;AAAA;AAAA,EAEvC,2CAA2C;AAAA;AAAA,EAE3C,iDAAiD;AAAA;AAAA,EAEjD,yCAAyC;AAAA;AAAA,EAEzC,4CAA4C;AAAA;AAAA,EAE5C,0CAA0C;AAAA;AAAA,EAE1C,gDAAgD;AAAA;AAAA,EAEhD,2CAA2C;AAAA;AAAA,EAE3C,sDAAsD;AAAA;AAAA,EAEtD,6CAA6C;AAAA;AAAA,EAE7C,wDAAwD;AAAA;AAAA,EAExD,wDACE;AAAA;AAAA,EAEF,mEAAmE;AAAA;AAAA,EAEnE,wEACE;AAAA;AAAA,EAEF,6DAA6D;AAAA;AAAA,EAE7D,kEACE;AAAA;AAAA,EAEF,4DAA4D;AAAA;AAAA,EAE5D,iEACE;AAAA;AAAA,EAEF,yDAAyD;AAAA;AAAA,EAEzD,kEACE;AAAA;AAAA,EAEF,uEACE;AAAA;AAAA,EAEF,+DAA+D;AAAA;AAAA,EAE/D,oEACE;AAAA;AAAA,EAEF,gEACE;AAAA;AAAA,EAEF,qEACE;AAAA;AAAA,EAEF,+DAA+D;AAAA;AAAA,EAE/D,oEACE;AAAA;AAAA,EAEF,gEAAgE;AAAA;AAAA,EAEhE,qEACE;AAAA;AAAA,EAEF,yDAAyD;AAAA;AAAA,EAEzD,8DACE;AAAA;AAAA,EAEF,yEAAyE;AAAA;AAAA,EAEzE,8EACE;AAAA;AAAA,EAEF,yEAAyE;AAAA;AAAA,EAEzE,8EACE;AAAA;AAAA,EAEF,0DAA0D;AAAA;AAAA,EAE1D,+DACE;AAAA;AAAA,EAEF,8DAA8D;AAAA;AAAA,EAE9D,mEACE;AAAA;AAAA,EAEF,0DAA0D;AAAA;AAAA,EAE1D,+DACE;AAAA;AAAA,EAEF,2DAA2D;AAAA;AAAA,EAE3D,gEACE;AAAA;AAAA,EAEF,4DAA4D;AAAA;AAAA,EAE5D,iEACE;AAAA;AAAA,EAEF,4CAA4C;AAAA;AAAA,EAE5C,yCAAyC;AAAA;AAAA,EAEzC,yCAAyC;AAAA;AAAA,EAEzC,iCAAiC;AAAA;AAAA,EAEjC,iCAAiC;AAAA;AAAA,EAEjC,iCAAiC;AAAA;AAAA,EAEjC,iCAAiC;AAAA;AAAA,EAEjC,iCAAiC;AAAA;AAAA,EAEjC,iCAAiC;AAAA;AAAA,EAEjC,uCAAuC;AAAA;AAAA,EAEvC,mCAAmC;AAAA;AAAA,EAEnC,qCAAqC;AAAA;AAAA,EAErC,oCAAoC;AAAA;AAAA,EAEpC,iCAAiC;AAAA;AAAA,EAEjC,+CAA+C;AAAA;AAAA,EAE/C,sDAAsD;AAAA;AAAA,EAEtD,qCAAqC;AAAA;AAAA,EAErC,2CAA2C;AAAA;AAAA,EAE3C,kCAAkC;AAAA;AAAA,EAElC,mCAAmC;AAAA;AAAA,EAEnC,0CAA0C;AAAA;AAAA,EAE1C,2DACE;AAAA;AAAA,EAEF,+DACE;AAAA;AAAA,EAEF,4DACE;AAAA;AAAA,EAEF,+CACE;AAAA;AAAA,EAEF,8CAA8C;AAAA;AAAA,EAE9C,qDAAqD;AAAA;AAAA,EAErD,wDAAwD;AAAA;AAAA,EAExD,2DACE;AAAA;AAAA,EAEF,mDACE;AAAA;AAAA,EAEF,6CAA6C;AAAA;AAAA,EAE7C,+DACE;AAAA;AAAA,EAEF,yDAAyD;AAAA;AAAA,EAEzD,2DACE;AAAA;AAAA,EAEF,qDAAqD;AAAA;AAAA,EAErD,kEAAkE;AAAA;AAAA,EAElE,8CAA8C;AAAA;AAAA,EAE9C,2CAA2C;AAAA;AAAA,EAE3C,qEACE;AAAA;AAAA,EAEF,+DAA+D;AAAA;AAAA,EAE/D,uEACE;AAAA;AAAA,EAEF,iEAAiE;AAAA;AAAA,EAEjE,iEAAiE;AAAA;AAAA,EAEjE,sDAAsD;AAAA;AAAA,EAEtD,yCAAyC;AAAA;AAAA,EAEzC,yCAAyC;AAAA;AAAA,EAEzC,2CAA2C;AAAA;AAAA,EAE3C,kEAAkE;AAAA;AAAA,EAElE,+DAA+D;AAAA;AAAA,EAE/D,wDAAwD;AAAA;AAAA,EAExD,oDAAoD;AAAA;AAAA,EAEpD,iDAAiD;AAAA;AAAA,EAEjD,0CAA0C;AAAA;AAAA,EAE1C,8CAA8C;AAAA;AAAA,EAE9C,uDACE;AAAA;AAAA,EAEF,iEACE;AAAA;AAAA,EAEF,4CAA4C;AAAA;AAAA,EAE5C,uCAAuC;AAAA;AAAA,EAEvC,4DACE;AAAA;AAAA,EAEF,4DACE;AAAA;AAAA,EAEF,0DACE;AAAA;AAAA,EAEF,0DACE;AAAA;AAAA,EAEF,8DAA8D;AAAA;AAAA,EAE9D,4CAA4C;AAAA;AAAA,EAE5C,0DAA0D;AAAA;AAAA,EAE1D,+BAA+B;AAAA;AAAA,EAE/B,iCAAiC;AAAA;AAAA,EAEjC,oCACE;AAAA;AAAA,EAEF,2BAA2B;AAAA;AAAA,EAE3B,iCAAiC;AAAA;AAAA,EAEjC,4CAA4C;AAAA;AAAA,EAE5C,oCACE;AAAA;AAAA,EAEF,4CACE;AAAA;AAAA,EAEF,iDAAiD;AAAA;AAAA,EAEjD,uDACE;AAAA;AAAA,EAEF,sCAAsC;AAAA;AAAA,EAEtC,8BAA8B;AAAA;AAAA,EAE9B,+CAA+C;AAAA;AAAA,EAG/C,+DACE;AAAA;AAAA,EAEF,mFACE;AAAA;AAAA,EAEF,+EACE;AAAA;AAAA,EAEF,oFACE;AAAA;AAAA,EAEF,oFACE;AAAA;AAAA,EAEF,+EACE;AAAA;AAAA,EAEF,+EACE;AAAA;AAAA,EAEF,kFACE;AAAA;AAAA,EAEF,gFACE;AAAA;AAAA,EAEF,kFACE;AAAA;AAAA,EAEF,0CAA0C;AAAA;AAAA,EAE1C,0CAA0C;AAAA;AAAA,EAG1C,uCAAuC;AAAA;AAAA,EAGvC,uBAAuB;AAAA;AAAA;AAAA;AAAA;AAAA,EAKvB,0CAA0C;AAAA;AAAA,EAE1C,mCAAmC;AAAA;AAAA,EAEnC,wBAAwB;AAAA;AAAA,EAExB,wCAAwC;AAAA;AAAA,EAExC,wCAAwC;AAAA;AAAA;AAAA;AAAA;AAAA,EAKxC,wCAAwC;AAAA;AAAA,EAExC,2BAA2B;AAAA;AAAA,EAE3B,uCAAuC;AAAA;AAAA,EAEvC,sBAAsB;AAAA;AAAA,EAGtB,kCAAkC;AAAA;AAAA,EAElC,uBAAuB;AAAA;AAAA,EAEvB,oCAAoC;AAAA;AAAA,EAEpC,8BAA8B;AAAA;AAAA,EAE9B,8BAA8B;AAAA;AAAA,EAE9B,4BAA4B;AAAA;AAAA,EAG5B,kCAAkC;AAAA;AAAA,EAElC,6BAA6B;AAAA;AAAA,EAE7B,iDAAiD;AAAA;AAAA,EAGjD,0BAA0B;AAAA;AAAA,EAG1B,iCAAiC;AAAA;AAAA,EAEjC,4BAA4B;AAAA;AAAA,EAE5B,+BAA+B;AAAA;AAAA,EAE/B,uCAAuC;AAAA;AAAA,EAEvC,+CAA+C;AAAA;AAAA,EAE/C,0CAA0C;AAAA;AAAA,EAE1C,yCAAyC;AAAA;AAAA,EAEzC,oDAAoD;AAAA;AAAA,EAEpD,0CAA0C;AAAA;AAAA;AAAA;AAAA;AAAA,EAK1C,kCAAkC;AAAA;AAAA;AAAA;AAAA;AAAA,EAKlC,uCAAuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMvC,iDAAiD;AAAA;AAAA,EAEjD,8BAA8B;AAAA;AAAA,EAE9B,mCAAmC;AAAA;AAAA,EAEnC,oCAAoC;AAAA;AAAA,EAEpC,gDAAgD;AAAA;AAAA,EAEhD,gDAAgD;AAAA;AAAA,EAEhD,2CAA2C;AAAA;AAAA,EAE3C,2CAA2C;AAAA;AAAA,EAG3C,yBAAyB;AAAA;AAAA;AAAA;AAAA,EAKzB,6BAA6B;AAAA;AAAA;AAAA;AAAA;AAAA,EAK7B,uCAAuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMvC,uCAAuC;AAAA;AAAA,EAEvC,oCAAoC;AAAA;AAAA,EAEpC,0CAA0C;AAAA;AAAA,EAE1C,2CACE;AAAA;AAAA,EAEF,qCAAqC;AAAA;AAAA,EAErC,+DACE;AAAA;AAAA,EAEF,+DACE;AAAA;AAAA,EAEF,4CAA4C;AAAA;AAAA,EAE5C,mDAAmD;AAAA;AAAA,EAEnD,wCAAwC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMxC,mCAAmC;AAAA;AAAA,EAEnC,mCAAmC;AAAA;AAAA,EAEnC,oCAAoC;AAAA;AAAA,EAEpC,6BAA6B;AAAA;AAAA,EAE7B,mCAAmC;AAAA;AAAA,EAEnC,oCAAoC;AAAA;AAAA,EAEpC,+BAA+B;AAAA;AAAA,EAE/B,8BAA8B;AAAA;AAAA,EAE9B,qCAAqC;AAAA;AAAA,EAErC,iCAAiC;AAAA;AAAA,EAEjC,gDAAgD;AAAA;AAAA,EAEhD,kDAAkD;AAAA;AAAA,EAElD,sCAAsC;AAAA;AAAA;AAAA;AAAA;AAAA,EAKtC,gCAAgC;AAAA,EAChC,kCAAkC;AAAA,EAClC,iCAAiC;AAAA;AAAA,EAEjC,uCAAuC;AAAA;AAAA,EAEvC,2CAA2C;AAAA;AAAA,EAE3C,oCAAoC;AAAA;AAAA,EAEpC,sDAAsD;AAAA;AAAA,EAEtD,kCAAkC;AAAA;AAAA,EAElC,8CAA8C;AAAA;AAAA,EAE9C,8CAA8C;AAAA;AAAA,EAE9C,0CAA0C;AAAA;AAAA,EAE1C,6BAA6B;AAAA;AAAA,EAE7B,iCAAiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMjC,sCAAsC;AAAA;AAAA,EAEtC,0CAA0C;AAAA;AAAA,EAE1C,sDAAsD;AAAA;AAAA,EAEtD,iCAAiC;AAAA;AAAA,EAEjC,mCAAmC;AAAA;AAAA,EAEnC,uBAAuB;AAAA;AAAA,EAEvB,sCAAsC;AAAA;AAAA,EAEtC,2BAA2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA0B3B,qDACE;AAAA,EACF,uDACE;AAAA,EACF,0CAA0C;AAAA;AAAA,EAE1C,kDACE;AAAA,EACF,oDACE;AAAA,EACF,uCAAuC;AAAA;AAAA,EAEvC,mDACE;AAAA,EACF,qDACE;AAAA,EACF,wCAAwC;AAAA;AAAA,EAExC,kDACE;AAAA,EACF,oDACE;AAAA,EACF,uCAAuC;AAAA;AAAA,EAEvC,mDACE;AAAA,EACF,qDACE;AAAA,EACF,wCAAwC;AAAA;AAAA,EAExC,yDACE;AAAA,EACF,2DACE;AAAA,EACF,8CAA8C;AAAA;AAAA;AAAA;AAAA;AAAA,EAK9C,iDACE;AAAA,EACF,0CAA0C;AAAA;AAAA,EAE1C,mDACE;AAAA,EACF,4CAA4C;AAAA;AAAA,EAE5C,uDACE;AAAA,EACF,gDAAgD;AAAA;AAAA,EAEhD,wDACE;AAAA,EACF,iDAAiD;AAAA;AAAA,EAEjD,4DACE;AAAA,EACF,qDAAqD;AAAA;AAAA,EAErD,gDACE;AAAA,EACF,yCAAyC;AAAA;AAAA,EAEzC,oDACE;AAAA,EACF,6CAA6C;AAAA;AAAA,EAE7C,iDACE;AAAA,EACF,0CAA0C;AAAA;AAAA,EAE1C,qDACE;AAAA,EACF,8CAA8C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAO9C,6CACE;AAAA,EACF,sCAAsC;AAAA;AAAA,EAEtC,0CACE;AAAA,EACF,mCAAmC;AAAA;AAAA,EAEnC,2CACE;AAAA,EACF,oCAAoC;AAAA;AAAA,EAEpC,0CACE;AAAA,EACF,mCAAmC;AAAA;AAAA,EAEnC,yCACE;AAAA,EACF,kCAAkC;AAAA;AAAA,EAElC,8CACE;AAAA,EACF,uCAAuC;AAAA;AAAA,EAEvC,0CAA0C;AAAA,EAC1C,mCAAmC;AAAA;AAAA,EAEnC,+CACE;AAAA,EACF,wCAAwC;AAAA;AAAA,EAExC,gDACE;AAAA,EACF,yCAAyC;AAAA;AAAA,EAEzC,+CACE;AAAA,EACF,wCAAwC;AAAA;AAAA,EAExC,8CACE;AAAA,EACF,uCAAuC;AAAA;AAAA,EAEvC,mDACE;AAAA,EACF,4CAA4C;AAAA;AAAA,EAE5C,+CACE;AAAA,EACF,wCAAwC;AAAA;AAAA,EAExC,uCACE;AAAA,EACF,gCAAgC;AAAA;AAAA,EAEhC,2CACE;AAAA,EACF,oCAAoC;AAAA;AAAA,EAEpC,4CACE;AAAA,EACF,qCAAqC;AAAA;AAAA,EAErC,yCACE;AAAA,EACF,kCAAkC;AAAA;AAAA,EAElC,0CACE;AAAA,EACF,mCAAmC;AAAA;AAAA,EAEnC,yCACE;AAAA,EACF,kCAAkC;AAAA;AAAA,EAElC,0CACE;AAAA,EACF,mCAAmC;AAAA;AAAA,EAEnC,gDACE;AAAA,EACF,yCAAyC;AAAA;AAAA,EAEzC,4CACE;AAAA,EACF,qCAAqC;AAAA;AAAA,EAErC,sDACE;AAAA,EACF,+CAA+C;AAAA;AAAA,EAE/C,mDACE;AAAA,EACF,4CAA4C;AAAA;AAAA,EAE5C,0DACE;AAAA,EACF,mDAAmD;AAAA;AAAA,EAEnD,uDACE;AAAA,EACF,gDAAgD;AAAA;AAAA,EAEhD,oDACE;AAAA,EACF,6CAA6C;AAAA;AAAA,EAE7C,qDACE;AAAA,EACF,8CAA8C;AAAA;AAAA,EAE9C,kDACE;AAAA,EACF,2CAA2C;AAAA;AAAA,EAE3C,+CACE;AAAA,EACF,wCAAwC;AAAA;AAAA,EAExC,mDACE;AAAA,EACF,4CAA4C;AAAA;AAAA,EAE5C,6CACE;AAAA,EACF,sCAAsC;AAAA;AAAA,EAEtC,0CACE;AAAA,EACF,mCAAmC;AAAA;AAAA,EAEnC,iDACE;AAAA,EACF,0CAA0C;AAAA;AAAA,EAE1C,8CACE;AAAA,EACF,uCAAuC;AAAA;AAAA,EAEvC,+CACE;AAAA,EACF,wCAAwC;AAAA;AAAA,EAExC,4CACE;AAAA,EACF,qCAAqC;AAAA;AAAA,EAErC,iDACE;AAAA,EACF,0CAA0C;AAAA;AAAA,EAE1C,qDACE;AAAA,EACF,8CAA8C;AAAA;AAAA,EAE9C,mDACE;AAAA,EACF,4CAA4C;AAAA;AAAA,EAE5C,gDACE;AAAA,EACF,yCAAyC;AAAA;AAAA,EAEzC,oCAAoC;AAAA;AAAA,EAEpC,2CAA2C;AAAA;AAAA,EAE3C,4CAA4C;AAAA;AAAA,EAE5C,2CAA2C;AAAA;AAAA,EAE3C,4CAA4C;AAAA;AAAA,EAE5C,sBAAsB;AAAA;AAAA,EAEtB,qCAAqC;AAAA;AAAA,EAErC,gCAAgC;AAAA;AAAA,EAEhC,oCAAoC;AAAA;AAAA,EAEpC,4BAA4B;AAAA;AAAA,EAG5B,oDACE;AAAA;AAAA,EAEF,8CACE;AAAA;AAAA,EAEF,kDACE;AAAA;AAAA,EAEF,4CAA4C;AAAA;AAAA,EAE5C,0CAA0C;AAAA;AAAA,EAE1C,mBAAmB;AAAA;AAAA,EAEnB,2BAA2B;AAAA;AAAA,EAE3B,4BAA4B;AAAA;AAAA,EAE5B,4BAA4B;AAAA;AAAA,EAE5B,8BAA8B;AAAA;AAAA,EAE9B,sCAAsC;AAAA;AAAA,EAEtC,gDAAgD;AAAA;AAAA,EAEhD,wCAAwC;AAAA;AAAA,EAExC,8BAA8B;AAAA;AAAA,EAE9B,wCAAwC;AAAA;AAAA,EAExC,sCAAsC;AAAA;AAAA,EAEtC,gDAAgD;AAAA;AAAA,EAEhD,mCAAmC;AAAA;AAAA,EAEnC,6CAA6C;AAAA;AAAA,EAE7C,kCAAkC;AAAA;AAAA,EAElC,4CAA4C;AAAA;AAAA,EAE5C,gCAAgC;AAAA;AAAA,EAEhC,0CAA0C;AAAA;AAAA,EAE1C,kCAAkC;AAAA;AAAA,EAElC,4CAA4C;AAAA;AAAA;AAAA;AAAA;AAAA,EAK5C,kBAAkB;AAAA;AAAA,EAElB,kCAAkC;AAAA;AAAA,EAElC,kDAAkD;AAAA;AAAA,EAElD,wCAAwC;AAAA;AAAA,EAExC,mCAAmC;AAAA,EACnC,qCAAqC;AAAA;AAAA,EAErC,mCAAmC;AAAA;AAAA,EAEnC,8CAA8C;AAAA;AAAA,EAE9C,mCAAmC;AAAA;AAAA,EAEnC,8CAA8C;AAAA;AAAA,EAE9C,kEACE;AAAA;AAAA,EAEF,sEACE;AAAA;AAAA,EAEF,6BAA6B;AAAA;AAAA,EAE7B,8BAA8B;AAAA;AAAA,EAE9B,wBAAwB;AAAA;AAAA,EAExB,2CAA2C;AAAA;AAAA,EAE3C,qCAAqC;AAAA;AAAA,EAErC,4CAA4C;AAAA;AAAA,EAE5C,sCAAsC;AAAA;AAAA,EAEtC,6CAA6C;AAAA;AAAA,EAE7C,uCAAuC;AAAA;AAAA,EAEvC,0BAA0B;AAAA;AAAA,EAE1B,4BAA4B;AAAA;AAAA,EAE5B,uBAAuB;AAAA;AAAA;AAAA;AAAA;AAAA,EAKvB,mCAAmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOnC,8CAA8C;AAAA;AAAA,EAE9C,0CAA0C;AAAA;AAAA,EAE1C,0CAA0C;AAAA;AAAA,EAE1C,qCAAqC;AAAA;AAAA,EAErC,uCAAuC;AAAA;AAAA,EAEvC,oBAAoB;AACtB,CAAC,GAgBY,+BAA0D;AAAA,EACrE,QAAQ;AAAA,EACR,WAAW;AAAA,EACX,WAAW;AACb,GCpoDM,0BAA0B,uBAAuB,cAAc;AAAA;AAAA,EAEnE,sBAAsB;AAAA;AAAA,EAEtB,6BAA6B;AAAA;AAAA,EAE7B,wBAAwB;AAAA;AAAA,EAExB,wBAAwB;AAAA;AAAA,EAExB,+BAA+B;AAAA;AAAA,EAE/B,wBAAwB;AAAA;AAAA,EAExB,+BAA+B;AAAA;AAAA,EAE/B,uBAAuB;AAAA;AAAA,EAEvB,gBAAgB;AAAA;AAAA,EAEhB,gBAAgB;AAAA;AAAA,EAEhB,0BAA0B;AAAA;AAAA,EAE1B,uBAAuB;AAAA;AAAA,EAEvB,4BAA4B;AAAA;AAAA,EAE5B,oBAAoB;AAAA;AAAA,EAEpB,uBAAuB;AAAA;AAAA,EAEvB,oBAAoB;AAAA;AAAA,EAEpB,kBAAkB;AAAA;AAAA,EAElB,4BAA4B;AAAA;AAAA,EAE5B,kBAAkB;AAAA;AAAA,EAElB,sBAAsB;AAAA;AAAA,EAEtB,yBAAyB;AAAA;AAAA,EAEzB,8BAA8B;AAAA;AAAA,EAE9B,+BAA+B;AAAA;AAAA,EAE/B,wBAAwB;AAAA;AAAA,EAExB,kCAAkC;AAAA;AAAA,EAElC,iCAAiC;AAAA;AAAA,EAEjC,2BAA2B;AAAA;AAAA,EAE3B,eAAe;AAAA;AAAA,EAEf,wBAAwB;AAAA;AAAA,EAExB,mBAAmB;AAAA;AAAA,EAEnB,mBAAmB;AAAA;AAAA,EAEnB,gBAAgB;AAAA;AAAA,EAEhB,uBAAuB;AAAA;AAAA,EAEvB,oBAAoB;AAAA;AAAA,EAEpB,yBAAyB;AAAA;AAAA,EAEzB,yBAAyB;AAAA;AAAA,EAEzB,+BAA+B;AAAA;AAAA,EAE/B,sBAAsB;AAAA;AAAA,EAEtB,oBAAoB;AAAA;AAAA,EAEpB,gCAAgC;AAAA;AAAA,EAEhC,mCAAmC;AAAA;AAAA,EAEnC,sBAAsB;AAAA;AAAA,EAEtB,2BAA2B;AAAA;AAAA,EAE3B,2BAA2B;AAC7B,CAAU,GAgBG,4BAAuD;AAAA,EAClE,QAAQ;AAAA,EACR,WAAW;AAAA,EACX,WAAW;AACb,GC7Ga,kBAA+B;AAAA,EAC1C,IAAI;AAAA,EACJ,OAAO;AAAA,EACP,SAAS,CAAC,8BAA8B,yBAAyB;AAAA,EAEjE,UAAU;AAAA,IACR,UAAU;AAAA;AAAA,IACV,SAAS,CAAC,GAAG,CAAC;AAAA;AAAA,IACd,aAAa;AAAA,EACf;AACF,GAQa,gBAAgB,iBCtBhB,wBAAwB,MAAM;AACzC,QAAM,MAAM;AAER,MAAA;AACF,WAAI,OAAO,eAAiB,MACnB,MAGT,aAAa,QAAQ,KAAK,KAAK,GAC/B,aAAa,WAAW,GAAG,GACpB;AAAA,EAAA,QACK;AACL,WAAA;AAAA,EACT;AACF,GAAG,GCdG,uBAAuB;AAWb,SAAA,mBAAmB,WAAmB,UAAsC;AAC1F,MAAI,CAAC;AACH;AAEF,QAAM,SAAS,aAAa,QAAQQ,aAAW,WAAW,QAAQ,CAAC;AACnE,SAAO,UAAU,OAAA,SAAA;AACnB;AAYgB,SAAA,qBAAqB,WAAmB,UAAkB,QAAsB;AACzF,0BAGL,aAAa,QAAQA,aAAW,WAAW,QAAQ,GAAG,MAAM;AAC9D;AAUA,SAASA,aAAW,WAAmB,UAAkB;AACvD,SAAO,CAAC,sBAAsB,WAAW,QAAQ,EAAE,KAAK,GAAG;AAC7D;ACrCO,SAAS,eAAerB,QAA0B;AACjD,QAAA;AAAA,IACJ;AAAA,IACA,MAAM;AAAA,IAEN,MAAM,EAAC,QAAO;AAAA,IACd,YAAY,EAAC,QAAO;AAAA,MAClB,UAAU;AAGZ,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAGA;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA;AAGN;AAMO,SAAS,mBAAmB;AAAA,EACjC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAKI;AACF,QAAM,YAAY;AAAA,IAChB,CAAC,cACC,QAAQ,GAAG,mBAAmB,QAAQ,GAC/B,MAAM,QAAQ,IAAI,mBAAmB,QAAQ;AAAA,IAEtD,CAAC,OAAO;AAAA,KAEJ,gBAAgB;AAAA,IACpB;AAAA,IACA,MAAM,QAAQ,KAAK,CAAC,cAAc,QAAQ,aAAa,UAAU,EAAE,KAAK;AAAA,KAGpE,UAAU;AAAA,IACd,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA,YAAY,EAAC,QAAO;AAAA,MACpB,cAAc,OAAO,cAAsB;AACzC,6BAAqB,WAAW,UAAU,SAAS,GACnD,MAAM,QAAQ,eAAe,SAAS;AAAA,MACxC;AAAA,IAAA;AAAA,IAEF,CAAC,eAAe,SAAS,SAAS,WAAW,QAAQ;AAAA,EAAA;AAIrD,SAAA,oBAAC,YAAS,UAAU,oBAAC,eAAa,CAAA,GAChC,UAAA,oBAAC,mBAAgB,MAAM,SAErB,8BAAC,cAAc,UAAd,EAAuB,OAAO,SAC5B,YAD0C,cAAc,EAE3D,EACF,CAAA,EACF,CAAA;AAEJ;AC3EO,SAAS,eACd,OACwB;AAClB,QAAA,QAAQ,MAAM,QAAQ,KAAK,IAAI,QAAQ,CAAC,KAAK,GAC7C,mBAAmB,KAAK;AAAA,IAC5B,MACG,QAAQ,CAAC,SAAU,QAAA,QAAA,KAAM,OAAO,OAAO,OAAO,KAAK,IAAI,EAAE,IAAI,CAAC,EAAC,GAAA,MAAQ,EAAE,IAAI,CAAG,CAAA,EAChF,OAAOI,eAAa,EACpB,KAAK;AAAA,KAEJ,aAAa,QAAQ,MAAM,KAAK,MAAM,gBAAgB,GAAG,CAAC,gBAAgB,CAAC,GAC3E,EAAC,GAAAS,GAAC,IAAI,eAAe,UAAU;AAE9B,SAAA;AAAA,IACL,SAAqB,MAAa;AAC1B,YAAA,EAAC,KAAQ,IAAA;AACV,aAAA,OAEE,IAAI,MAAM,MAAM;AAAA,QACrB,KAAK,CAAC,QAAQ,aAAa;AACnB,gBAAAe,gBAAe,OAAO,QAAuB;AAEnD,cAAI,OAAO,YAAa,YAAY,YAAY,MAAM;AACpD,kBAAM,EAAC,KAAK,GAAE,IAAI,KAAK,QAA+B;AACtD,mBAAOf,GAAE,KAAK;AAAA,cACZ;AAAA;AAAA;AAAA;AAAA;AAAA,cAKA,GAAI,OAAOe,iBAAiB,YAAY,EAAC,cAAAA,cAAY;AAAA,YAAA,CACtD;AAAA,UACH;AAEO,iBAAAA;AAAA,QACT;AAAA,MACD,CAAA,IApBiB;AAAA,IAqBpB;AAAA,IACA,CAACf,EAAC;AAAA,EAAA;AAEN;ACfO,SAAS,YAA2C,MAAoB;AAC7E,QAAM,aAAa,QAAQ,MACpB,KAAK,OACH,MAAM,KAAK,IAAI,IAAI,OAAO,OAAO,KAAK,IAAI,EAAE,IAAI,CAAC,EAAC,GAAA,MAAQ,EAAE,CAAC,CAAC,EAAE,KAAK,IADrD,CAAA,GAEtB,CAAC,KAAK,IAAI,CAAC,GAER,EAAC,GAAAA,GAAC,IAAI,eAAe,UAAU;AAErC,SAAO,QAAQ,MAAM;AACb,UAAA,EAAC,KAAQ,IAAA;AACV,WAAA,OAEE,IAAI,MAAM,MAAM;AAAA,MACrB,KAAK,CAAC,QAAQ,aAAa;AACnB,cAAAe,gBAAe,OAAO,QAAuB;AAEnD,YAAI,OAAO,YAAa,YAAY,YAAY,MAAM;AACpD,gBAAM,EAAC,KAAK,GAAE,IAAI,KAAK,QAA+B;AACtD,iBAAOf,GAAE,KAAK;AAAA,YACZ;AAAA;AAAA;AAAA;AAAA;AAAA,YAKA,GAAI,OAAOe,iBAAiB,YAAY,EAAC,cAAAA,cAAY;AAAA,UAAA,CACtD;AAAA,QACH;AAEO,eAAAA;AAAA,MACT;AAAA,IACD,CAAA,IApBiB;AAAA,EAAA,GAqBjB,CAAC,MAAMf,EAAC,CAAC;AACd;AC3DO,MAAM,aAAa,MAAM;AAC9B,QAAM,SAAS;AAAA,IACb,gBAAgB,YAAiC;AAAA,IACjD,YAAY,YAA6B;AAAA,IACzC,cAAc,YAA+B;AAAA,IAC7C,oBAAoB,YAAqC;AAAA,EAAA;AAGlD,WAAA,eAAe,QAAgB,SAAqC;AACrE,UAAA,MAAM,WAAW,QAAQ,OAAO;AAClC,QAAA,WAAW,OAAO,eAAe,GAAG;AACxC,WAAI,aAIJ,WAAW,IAAI,KAAK,eAAe,QAAQ,OAAO,GAClD,OAAO,eAAe,GAAG,IAAI,UACtB;AAAA,EACT;AAES,WAAA,WAAW,QAAgB,SAAiC;AAC7D,UAAA,MAAM,WAAW,QAAQ,OAAO;AAClC,QAAA,WAAW,OAAO,WAAW,GAAG;AACpC,WAAI,aAIJ,WAAW,IAAI,KAAK,WAAW,QAAQ,OAAO,GAC9C,OAAO,WAAW,GAAG,IAAI,UAClB;AAAA,EACT;AAES,WAAA,aAAa,QAAgB,SAAmC;AACjE,UAAA,MAAM,WAAW,QAAQ,OAAO;AAClC,QAAA,WAAW,OAAO,aAAa,GAAG;AACtC,WAAI,aAIJ,WAAW,IAAI,KAAK,aAAa,QAAQ,OAAO,GAChD,OAAO,aAAa,GAAG,IAAI,UACpB;AAAA,EACT;AAES,WAAA,mBAAmB,QAAgB,SAAyC;AAC7E,UAAA,MAAM,WAAW,QAAQ,OAAO;AAClC,QAAA,WAAW,OAAO,mBAAmB,GAAG;AAC5C,WAAI,aAIJ,WAAW,IAAI,KAAK,mBAAmB,QAAQ,OAAO,GACtD,OAAO,mBAAmB,GAAG,IAAI,UAC1B;AAAA,EACT;AAEO,SAAA;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ,GAAG;AAEH,SAAS,cAAgD;AAChD,SAAA,uBAAO,OAAO,IAAI;AAC3B;AAEA,SAAS,WAAW,QAAgB,SAAyB;AACpD,SAAA,GAAG,MAAM,IAAI,KAAK,UAAU,aAAa,OAAO,CAAC,CAAC;AAC3D;AAEA,SAAS,aAAa,KAAqB;AACzC,QAAM,WAAqB,CAAA;AAC3B,aAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,GAAG;AAClC,aAAA,KAAK,GAAG,GAAG,IAAI,KAAK,UAAU,KAAK,CAAC,EAAE;AAE1C,SAAA,SAAS,OAAO,KAAK;AAAA,CAAI;AAClC;ACpDgB,SAAA,cAAc,UAAgC,IAAqB;AAM7E,MAAA;AACI,UAAA,gBAAgB,iBAAmB,EAAA;AAClC,WAAA,UAAU,WAAW,eAAe,OAAO;AAAA,EAAA,QAC5C;AACC,WAAA,UAAU,WAAW,SAAS,EAAC,GAAG,SAAS,OAAO,UAAS;AAAA,EACpE;AACF;ACHA,MAAM,cAAc,kCACd,eAAe,qBACf,kBAAkB,aAClB,0BAA0B,uBAC1B,yBAAyB,YACzB,cAAc;AAUb,SAAS,aAAa,OAAwB;AACnD,QAAM,SAAkB,CAAA;AACxB,MAAI,OAAO,IACP,UAAU,IACV,YAAY;AAChB,SAAO,UAAU,SAAS;AACxB,QAAI,CAAC,WAAW,UAAU,CAAC,MAAM,KAAK;AAC9B,YAAA,QAAQ,aAAa,SAAS;AACpC,UAAI,OAAO;AACH,cAAA,UAAU,MAAM,OAAQ;AACd,wBAAA,OAAO,GACnB,SACF,OAAO,KAAK,GAAG,2BAA2B,IAAI,CAAC,GAC/C,OAAO,KAEL,cAAc,MAAM,CAAC,CAAC,IACxB,OAAO,KAAK,EAAC,MAAM,WAAW,aAAa,IAAM,MAAM,QAAQ,CAAA,KAE/D,OAAO,KAAK,EAAC,MAAM,WAAW,MAAM,SAAQ,GAC5C,UAAU,UAEZ,YAAY,UAAU,UAAU,MAAM,CAAC,EAAE,MAAM;AAAA,MACjD;AAEE,gBAAQ,UAAU,CAAC,GACnB,YAAY,UAAU,UAAU,CAAC;AAAA,IAAA,WAE1B,WAAW,UAAU,CAAC,MAAM,OAAO,UAAU,CAAC,MAAM,KAAK;AAC5D,YAAA,QAAQ,cAAc,SAAS;AACrC,UAAI,OAAO;AACH,cAAA,UAAU,MAAM,OAAQ;AAC1B,YAAA,UAAU,CAAC,MAAM;AACnB,gBAAM,IAAI;AAAA,YACR,6BAA6B,OAAO,iCAAiC,OAAO;AAAA,UAAA;AAGhF,YAAI,YAAY;AACd,gBAAM,IAAI;AAAA,YACR,6BAA6B,OAAO,8BAA8B,OAAO;AAAA,UAAA;AAGzE,iBACF,OAAO,KAAK,GAAG,2BAA2B,IAAI,CAAC,GAC/C,OAAO,KAET,OAAO,KAAK,EAAC,MAAM,YAAY,MAAM,QAAA,CAAQ,GAC7C,UAAU,IACV,YAAY,UAAU,UAAU,MAAM,CAAC,EAAE,MAAM;AAAA,MACjD;AAEE,gBAAQ,UAAU,CAAC,GACnB,YAAY,UAAU,UAAU,CAAC;AAAA,IAErC;AAEE,cAAQ,UAAU,CAAC,GACnB,YAAY,UAAU,UAAU,CAAC;AAGjC,MAAA;AACF,UAAM,IAAI;AAAA,MACR,gCAAgC,OAAO,gDAAgD,OAAO,2BAA2B,OAAO,SAAS,OAAO;AAAA,IAAA;AAGpJ,SAAI,QACF,OAAO,KAAK,GAAG,2BAA2B,IAAI,CAAC,GAE1C;AACT;AAEA,SAAS,2BAA2B,MAAuB;AACzD,QAAM,SAAkB,CAAA,GAElB,iBAAiB,KAAK,SAAS,WAAW;AAChD,MAAI,YAAY;AAChB,aAAW,SAAS,gBAAgB;AAC9B,QAAA,OAAO,MAAM,QAAU;AACzB;AAGF,UAAM,MAAM,KAAK,MAAM,WAAW,MAAM,KAAK;AACzC,QAAI,SAAS,KACf,OAAO,KAAK,EAAC,MAAM,QAAQ,MAAM,IAAA,CAAI,GAGvC,OAAO,KAAK,mBAAmB,MAAM,CAAC,CAAC,CAAC,GAExC,aAAa,IAAI,SAAS,MAAM,CAAC,EAAE;AAAA,EACrC;AAEA,SAAI,YAAY,KAAK,UACnB,OAAO,KAAK,EAAC,MAAM,QAAQ,MAAM,KAAK,MAAM,SAAS,EAAE,CAAA,GAGlD;AACT;AAEA,SAAS,mBAAmB,eAA2C;AACrE,QAAM,CAAC,UAAU,GAAG,UAAU,IAAI,cAC/B,QAAQ,gBAAgB,EAAE,EAC1B,KAAK,EACL,MAAM,SAAS;AAKlB,MAAI,WAAW,WAAW,KAAK,WAAW,CAAC,MAAM;AAC/C,WAAO,EAAC,MAAM,iBAAiB,UAAU,WAAU;AAGrD,MAAI,WAAW,SAAS;AACtB,UAAM,IAAI;AAAA,MACR,mFAAmF,aAAa;AAAA,IAAA;AAI7F,SAAA,EAAC,MAAM,iBAAiB;AACjC;AAEA,SAAS,cAAc,KAAa;AAC3B,SAAA,gBAAgB,KAAK,GAAG;AACjC;AACA,SAAS,aAAa,OAAe;AAC5B,SAAA,MAAM,MAAM,WAAW;AAChC;AACA,SAAS,cAAc,OAAe;AAC7B,SAAA,MAAM,MAAM,YAAY;AACjC;AAEA,SAAS,gBAAgB,SAAiB;AAOxC,MAN6B,0BAAwB,KAAK,OAAO,KAKtC,uBAAuB,KAAK,OAAO;AAK9D,UAAM,IAAI;AAAA,MACR,QAAQ,WAAW,UACf,iBAAiB,OAAO,0HACxB,iBAAiB,OAAO;AAAA,IAAA;AAEhC;ACtMA,MAAM,oBAAoB,UACpB,uBAAuB;AAAA,EAC3B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAkEO,SAAS,UAAUb,QAAyB;AAcjD,QAAM,aAAaA,OAAM,EAAEA,OAAM,SAAS;AAAA,IACxC,SAASA,OAAM;AAAA,IACf,mBAAmB;AAAA,IACnB,OACEA,OAAM,UAAU,WAAWA,OAAM,UAAU,OAAOA,OAAM,OAAO,SAAU,WACrEA,OAAM,OAAO,QACb;AAAA,EACP,CAAA,GAEK,SAAS,QAAQ,MAAM,aAAa,UAAU,GAAG,CAAC,UAAU,CAAC,GAC7D,aAAa,cAAA,GACb,aAA2B;AAAA,IAC/B,MAAM,CAAC,eAAe,WAAW,OAAO,UAAU;AAAA,EAAA;AAE7C,SAAA,oBAAA,UAAA,EAAG,UAAO,OAAA,QAAQA,OAAM,QAAQA,OAAM,cAAc,CAAI,GAAA,UAAU,EAAE,CAAA;AAC7E;AAEA,SAAS,OACP,QACAF,SACA,cACA,YACW;AACX,QAAM,CAAC,MAAM,GAAG,IAAI,IAAI;AACxB,MAAI,CAAC;AACI,WAAA;AAEL,MAAA,KAAK,SAAS,iBAAiB;AACjC,UAAM,QAAQA,UAASA,QAAO,KAAK,QAAQ,IAAI;AAC/C,QAAI,OAAO,QAAU;AACZ,aAAA,KAAK,KAAK,QAAQ;AAG3B,UAAM,iBAAiB,gBAAgB,OAAO,KAAK,cAAc,CAAA,GAAI,UAAU;AAE/E,WAEK,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAA;AAAA,MACA,OAAO,MAAMA,SAAQ,cAAc,UAAU;AAAA,IAChD,EAAA,CAAA;AAAA,EAEJ;AACA,MAAI,KAAK,SAAS;AAChB,WAEK,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAK,KAAA;AAAA,MACL,OAAO,MAAMA,SAAQ,cAAc,UAAU;AAAA,IAChD,EAAA,CAAA;AAGJ,MAAI,KAAK,SAAS,aAAa,KAAK,aAAa;AACzC,UAAA+B,aAAY,aAAa,KAAK,IAAI;AAExC,QAAI,CAACA;AACH,YAAM,IAAI,MAAM,wBAAwB,KAAK,IAAI,EAAE;AAErD,WAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAA,oBAACA,YAAU,EAAA;AAAA,MACV,OAAO,MAAM/B,SAAQ,cAAc,UAAU;AAAA,IAChD,EAAA,CAAA;AAAA,EAEJ;AACA,MAAI,KAAK,SAAS,aAAa,CAAC,KAAK,aAAa;AAC1C,UAAA,eAAe,KAAK,UAAU,CAAC,UAAU,MAAM,SAAS,UAAU,GAClE,YAAY,KAAK,YAAY;AAC/B,QAAA,aACE,KAAK,SAAU,UAA4B;AACvC,YAAA,IAAI,MAAM,4BAA4B;AAG1C,UAAA+B,aAAY,aAAa,KAAK,IAAI;AACxC,QAAI,CAACA,cAAa,kBAAkB,KAAK,KAAK,IAAI;AAChD,YAAM,IAAI,MAAM,0BAA0B,KAAK,IAAI,EAAE;AAGvD,QAAI,CAACA,cAAa,CAAC,qBAAqB,SAAS,KAAK,IAAI;AACxD,YAAM,IAAI,MAAM,aAAa,KAAK,IAAI,kBAAkB;AAGpD,UAAA,WAAW,KAAK,MAAM,GAAG,YAAY,GACrC,YAAY,KAAK,MAAM,eAAe,CAAC;AAE7C,WAAOA,aAEH,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAA,oBAACA,cAAW,UAAO,OAAA,UAAU/B,SAAQ,cAAc,UAAU,GAAE;AAAA,MAC9D,OAAO,WAAWA,SAAQ,cAAc,UAAU;AAAA,IAAA,EAAA,CACrD,IAGG,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAc,cAAA,KAAK,MAAM,IAAI,OAAO,UAAUA,SAAQ,cAAc,UAAU,CAAC;AAAA,MAC/E,OAAO,WAAWA,SAAQ,cAAc,UAAU;AAAA,IACrD,EAAA,CAAA;AAAA,EAEJ;AACO,SAAA;AACT;AAEA,SAAS,gBACP,OACA,YACA,cACQ;AACR,MAAI,iBAAiB;AACrB,aAAW,aAAa;AACtB,QAAI,cAAc;AACZ,UAAA,MAAM,QAAQ,KAAK;AACJ,yBAAA,aAAa,KAAK,KAAK;AAAA;AAElC,cAAA,IAAI,MAAM,wCAAwC;AAI9D,SAAO,GAAG,cAAc;AAC1B;AC5MO,MAAM,gCAAqD;AAAA,EAChE,YAAY;AACd;ACHgB,SAAA,YAAY,MAA0B,MAAkC;AAClF,MAAA,CAAC,QAAQ,CAAC;AACL,WAAA;AAGT,QAAM,WAAW,OAAO;AAGxB,SAFY,KAAK,MAAO,WAAW,OAAQ,GAAG;AAGhD;AAUgB,SAAA,sBAAsB,OAAegC,SAA+B;AAClF,SAAI,QAAQ,MACHA,QAAO,OAAO,MAAM,IAGzB,QAAQ,MAAO,MACVA,QAAO,QAAQ,KAAM,UAAU,IAGpC,QAAQ,MAAO,MAAO,MACjBA,QAAO,SAAS,MAAO,MAAO,UAAU,IAG7C,QAAQ,MAAO,MAAO,MAAO,MACxBA,QAAO,SAAS,MAAO,MAAO,MAAO,UAAU,IAGjDA,QAAO,SAAS,MAAO,MAAO,MAAO,MAAO,UAAU;AAC/D;AC7BO,SAAS,cAAc,EAAC,QAAQ,WAAyC;AACxE,QAAA,SAAS,QAAQ,WAAW,6BAA6B,GAEzD,iBAAiB,IAAI,WAA8C,OAAO,SAAS;AAWjF,UAAA,iBAVQ,MAAM,OACjB,QAAwB;AAAA,MACvB,KAAK,sBAAsB,KAAK,KAAK,GAAG,CAAC;AAAA,MACzC,iBAAiB;AAAA,IAAA,CAClB,EACA,MAAM,CAAC,WACN,QAAQ,MAAM,wBAAwB,KAAK,GACpC,MAAM,KAAK,MAAM,EAAE,KAAK,IAAI,EACpC,GAEyB;AAAA,MAC1B,CAAC,KAAK,UACA,QAAM,QAAA,KAAA,QACR,IAAI,KAAK,GAAG,IAAI,KAAK,QAEhB;AAAA,MAET,CAAC;AAAA,IAAA;AAIH,WADe,KAAK,IAAI,CAAC,QAAQ,cAAc,GAAG,KAAK,IAAI;AAAA,EAE5D,CAAA,GAEK,UAAU,CAAC,SACR,KAAK,eAAe,SAAS,IAAI,CAAC,GAGrC,UAAU,CAAC,kBACR;AAAA,IACL,OAAO,QAAwB;AAAA,MAC7B,QAAQ;AAAA,MACR,KAAK;AAAA,MACL,MAAM;AAAA,MACN,iBAAiB;AAAA,IAAA,CAClB;AAAA,EAAA,EACD;AAAA,IACAC,MAAI,CAAC,aACI,SAAS,IAAI,CAAC,UACnB,eAAe,MAAM,KAAK,GAAG,GAC7B,eAAe,MAAM,KAAK,KAAK,KAAK,KAAK,GAElC,KAAK,MACb,CACF;AAAA,IACDC,aAAW,CAAC,WACV,QAAQ,MAAM,uBAAuB,KAAK,GACnC,GAAG,MAAM,cAAc,MAAM,EAAE,KAAK,IAAI,CAAC,EACjD;AAAA,EAAA;AAYE,SAAA;AAAA,IACL,QATa,CAAC,QACP,QAAQ,CAAC,GAAG,CAAC,EAAE,KAAKD,MAAI,CAACjC,YAAWA,QAAO,CAAC,CAAC,CAAC;AAAA,IASrD,QANa,CAAC,KAAa,cACpB,QAAQ,CAAC,EAAC,KAAK,OAAO,UAAgC,CAAA,CAAC,EAAE,KAAKiC,MAAI,CAACjC,YAAWA,QAAO,CAAC,CAAC,CAAC;AAAA,IAM/F;AAAA,IACA;AAAA,EAAA;AAEJ;AChFgB,SAAA,oBAAoB,EAAC,UAAgD;AAC7E,QAAA,iBAAiB,cAAc,EAAC,QAAO,GAEvC,UAAU,IAAI,QAEd,GAAA,WAAW,QAAQ;AAAA,IACvB,UAAU,CAAC,UACF,eAAe,OAAO,MAAM,KAAK,MAAM,KAAK,EAAE;AAAA,MACnD,IAAI,CAAC,eAAe;AAAA,QAClB,KAAK,MAAM;AAAA,QACX,OAAO;AAAA,MAAA,EACP;AAAA,IAAA,CAEL;AAAA,IACD,YAAY,CAAC;AAAA,EAAA;AA4BR,SAAA,EAAC,QAzBO,CAAC,QACP;AAAA,IACL,eAAe,OAAO,GAAG;AAAA,IACzB,SAAS;AAAA,MACP,OAAO,CAAC,WAAW,OAAO,QAAQ,GAAG;AAAA,MACrC,IAAI,CAAC,WAAW,OAAO,KAAK;AAAA,IAC9B;AAAA,EAmBY,GAAA,QAfD,CAAC,KAAa,WAC3B,QAAQ,KAAK,EAAC,KAAK,OAAM,GAOlB,SAAS;AAAA,IACd,OAAO,CAAC,WAAW,OAAO,QAAQ,GAAG;AAAA,IACrC,IAAI,CAAC,WAAW,OAAO,KAA2B;AAAA,IAClD,KAAK,CAAC;AAAA,EAIY;AACxB;AC7CO,MAAM,wBAAwB,MAAM;AAAA,EAGzC,YAAY,EAAC,aAAoC;AACzC,UAAA,iBAAiB,GACvB,KAAK,YAAY;AAAA,EACnB;AACF;ACXA,MAAM,WAAmC,CAAA;AAEzB,SAAA,QAAQ,KAAa,OAAqB;AACpD,yBACF,aAAa,GAAG,IAAI,QAEpB,SAAS,GAAG,IAAI;AAEpB;AAEO,SAAS,QAAQ,KAAiC;AACvD,SAAO,uBAAuB,aAAa,GAAG,IAAI,SAAS,GAAG;AAChE;AAEO,SAAS,WAAW,KAAmB;AACxC,yBACF,aAAa,WAAW,GAAG,IAE3B,OAAO,SAAS,GAAG;AAEvB;ACXO,SAAS,uBAA0B,WAAwC;AAChF,QAAM,iBACJ,OAAO,SAAW,MACd,OACA,UAAwB,QAAQ,SAAS,GAEzC,aAAa,oCAAoC,SAAS,IAK1D,uBAAuB,IAAI,QAAA,GAE3B,YAAY;AAAA,IAChB;AAAA,IACA,eAAe;AAAA,MACb,OAAO,CAAC,UAAU,MAAM,QAAQ,UAAU;AAAA,MAC1C,IAAI,CAAC,UAAU,MAAM,QAAQ;AAAA,MAC7B,OAAOM,eAAa;AAAA,MACpB,IAAI,CAAC,aAAa,KAAK,MAAM,QAAQ,CAAC;AAAA,IACxC;AAAA,EAAA,EACA;AAAA;AAAA,IAEA,YAAY,CAAC;AAAA,EAAA;AAGf,WAAS,UAAU,SAAY;AACzB,QAAA;AACF6B,cAAgB,YAAY,KAAK,UAAU,OAAO,CAAC,GAGnDC,WAAmB,UAAU,GAE7B,qBAAqB,KAAK,OAAO;AAAA,IAAA,QACrB;AAAA,IAEd;AAAA,EACF;AAEO,SAAA,EAAC,UAAU,WAAW;AAC/B;AC7CA,MAAM,gBAAgB,OAAO,IAAI,CAAC,EAAC,YAA2B;AAC5D,QAAM,EAAC,GAAA,IAAM,MAAM,OAAO,MAAM;AAEzB,SAAA;AAAA,YACG,EAAE;AAAA;AAEd,CAAC,GAEK,cAAc,OAAO;AAAA;AAAA;AAAA;AAAA,GAMrB,aAAa,MACjB;AAAA,EAAC;AAAA,EAAA;AAAA,IAEC,OAAM;AAAA,IACN,QAAO;AAAA,IACP,OAAM;AAAA,IACN,SAAQ;AAAA,IAER,UAAA,oBAAC,QAAK,EAAA,GAAE,gwCAAgwC,CAAA;AAAA,EAAA;AAC1wC,GAGI,aAAa,MACjB;AAAA,EAAC;AAAA,EAAA;AAAA,IAEC,OAAM;AAAA,IACN,QAAO;AAAA,IACP,OAAM;AAAA,IACN,SAAQ;AAAA,IAER,UAAA;AAAA,MAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,GAAE;AAAA,UACF,MAAK;AAAA,QAAA;AAAA,MACP;AAAA,MACA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,GAAE;AAAA,UACF,MAAK;AAAA,QAAA;AAAA,MACP;AAAA,MACA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,GAAE;AAAA,UACF,MAAK;AAAA,QAAA;AAAA,MACP;AAAA,MACA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,GAAE;AAAA,UACF,MAAK;AAAA,QAAA;AAAA,MACP;AAAA,IAAA;AAAA,EAAA;AACF;AAGK,SAAS,WAAWlC,QAAiC;AACpD,QAAA,EAAC,SAAY,IAAAA;AAEnB,SAAO,SAAS,OACb,oBAAA,aAAA,EAAY,KAAK,SAAS,MAAM,KAAK,YAAY,SAAS,IAAI,GAAI,CAAA,IACjE;AACN;AAEO,MAAM,gBAAyE;AAAA,EACpF,QAAQ;AAAA,EACR,QAAQ;AAAA;AAEV;ACtDA,eAAe,aAAa;AAAA,EAC1B;AAAA,EACA;AAAA,EACA,WAAW,kBAAkB,CAAC;AAChC,GAAiD;AAE/C,MAAI,SAAS,aAAa,MAAM,QAAQ,eAAe;AAC9C,WAAA;AAGT,QAAM,EAAC,UAAA,IAAa,MAAM,OAAO,QAA8B;AAAA,IAC7D,KAAK;AAAA,EAAA,CACN;AAID,SAAI,OAAO,mBAAoB,aACtB,gBAAgB,SAAS,IAI9B,gBAAgB,WAAW,IACtB,YAKL,SAAS,YACJ,kBAMF,UACJ,OAAO,CAAC,aAAa,gBAAgB,KAAK,CAAC,aAAa,SAAS,QAAQ,SAAS,GAAG,CAAC,EACtF,OAAO,eAAe;AAC3B;AAaA,SAAS,sBAAsB;AAAA,EAC7B,cAAc;AAAA,EACd;AAAA,EACA;AAAA,EACA;AACF,GAAiC;AACzB,QAAA,SAAS,IAAI;AACnB,SAAA,OAAO,IAAI,UAAU,GAAG,OAAO,SAAS,MAAM,GAAG,YAAY,EAAE,GAC/D,OAAO,IAAI,aAAa,SAAS,GAO7B,gBAAgB,UAClB,OAAO,IAAI,WAAW,MAAM,IAE5B,OAAO,IAAI,QAAQ,WAAW,GAEzB,GAAG,GAAG,IAAI,MAAM;AACzB;AAEO,SAAS,qBAAqB;AAAA,EACnC;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAAgC;AACxB,QAAAmC,aAAY,gCAAgC,SAAS;AAE3D,WAAS,eAAe,EAAC,WAAW,GAAGnC,UAA6B;AAClE,UAAM,eAAeA,OAAM,gBAAgBA,OAAM,YAAY,KAEvD,CAAC,WAAW,YAAY,IAAI,SAAgC,IAAI,GAChE,CAAC,OAAO,QAAQ,IAAI,SAAkB,IAAI;AAC5C,QAAA;AAAa,YAAA;AAEX,UAAA,CAAC,MAAM,IAAImC;AAEjB,cAAU,MAAM;AACT,gBAEL,aAAa,EAAC,QAAQ,GAAG,gBAAA,CAAgB,EACtC,KAAK,YAAY,EACjB,MAAM,QAAQ;AAAA,IAAA,GAChB,CAAC,MAAM,CAAC;AAIX,UAAM,iCACJ,qBACA,aAAA,OAAA,SAAA,UAAW,YAAW,MACtB,aAAA,OAAA,SAAA,UAAY,OACZ,sBAAsB;AAAA,MACpB;AAAA,MACA;AAAA,MACA,KAAK,UAAU,CAAC,EAAE;AAAA,MAClB;AAAA,IACD,CAAA,GAEG,UAAU,CAAC,aAAa;AAQ9B,WANA,UAAU,MAAM;AACV,yCACF,OAAO,SAAS,OAAO;AAAA,IAAA,GAExB,CAAC,8BAA8B,CAAC,GAE/B,UACK,oBAAC,cAAa,EAAA,UAAQ,GAAC,CAAA,IAI7B,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,MAAA,oBAAC,SAAQ,EAAA,OAAM,UAAS,MAAM,GAAG,UAEjC,yBAAA;AAAA,MAEA,oBAAC,SAAM,OAAO,GACX,oBAAU,IAAI,CAAC,UAAU,UACxB;AAAA,QAAC;AAAA,QAAA;AAAA,UAGC,IAAG;AAAA,UACH,MAAM,cAAc,SAAS,IAAI,KAAK,oBAAC,cAAW,UAAoB;AAAA,UACtE,MAAM,sBAAsB;AAAA,YAC1B;AAAA,YACA;AAAA,YACA,KAAK,SAAS;AAAA,YACd;AAAA,UAAA,CACD;AAAA,UACD,MAAK;AAAA,UACL,MAAK;AAAA,UACL,MAAM,SAAS;AAAA,QAAA;AAAA,QAXV,GAAG,SAAS,GAAG,IAAI,KAAK;AAAA,MAahC,CAAA,GACH;AAAA,IACF,EAAA,CAAA;AAAA,EAEJ;AAEO,SAAA;AACT;ACzKA,MAAM,aAAa;AAEnB,SAAS,mBAAkC;AAEzC,MAAI,OAAO,SAAW,OAAe,OAAO,OAAO,YAAa;AACvD,WAAA;AAIT,QAAMC,QAAO,OAAO,SAAS,MAIvB,CAAA,EAAG,QAAQ,IAAIA,MAAK,MAAM,UAAU,KAAK,CAAA;AAC/C,MAAI,CAAC;AACI,WAAA;AAIH,QAAA,UAAUA,MAAK,QAAQ,YAAY,EAAE,GACrC,SAAS,IAAI,IAAI,OAAO,SAAS,IAAI;AACpC,SAAA,OAAA,OAAO,QAAQ,SAAS,IAAI,UAAU,IAC7C,QAAQ,aAAa,MAAM,IAAI,MAAM,GAE9B;AACT;AAMA,IAAIC,cAAY,iBAAiB;AAC1B,MAAMC,iBAAe,MAAqB;AAC/C,QAAM9C,MAAK6C;AACP,SAAA7C,QACF6C,cAAY,OAEP7C;AACT;AC5BO,SAAS,YAAY,YAA8C;AACxE,SACEe,WAAS,UAAU,KACnB,WAAW,cACXA,WAAS,WAAW,KAAK,KACzB,eAAe,WAAW,SAC1B,OAAO,WAAW,MAAM,aAAc;AAE1C;AAQO,SAAS,kCACd,aACgD;AAEhD,SADyC,CAAC,QAAQ,OAAO,EACjB,SAAS,WAA8C;AACjG;ACPA,MAAM,gBAAgB,CAAC,cAAsB;AAG3C,MAAI,CAAC;AAAiB,UAAA,IAAI,MAAM,oBAAoB;AACpD,SAAO,uBAAuB,SAAS;AACzC,GAEM,WAAW,CAAC,cAAqC;AACjD,MAAA;AACF,UAAM,OAAOgC,QAAgB,cAAc,SAAS,CAAC;AACrD,QAAI,MAAM;AACR,YAAM,EAAC,MAAS,IAAA,KAAK,MAAM,IAAI;AAC3B,UAAA,SAAS,OAAO,SAAU;AACrB,eAAA;AAAA,IAEX;AAAA,WACO,KAAK;AACZ,YAAQ,MAAM,GAAG;AAAA,EACnB;AACO,SAAA;AACT,GAEM,aAAa,CAAC,cAA4B;AAC1C,MAAA;AACML,eAAW,cAAc,SAAS,CAAC;AAAA,WACpC,KAAK;AACZ,YAAQ,MAAM,GAAG;AAAA,EACnB;AACF,GAEM,YAAY,CAAC,EAAC,OAAO,gBAAyD;AAC9E,MAAA;AACMD;AAAAA,MACN,cAAc,SAAS;AAAA,MACvB,KAAK,UAAU,EAAC,OAAO,2BAAU,KAAK,GAAE,YAAY,GAAE;AAAA,IAAA;AAAA,WAEjD,KAAK;AACZ,YAAQ,MAAM,GAAG;AAAA,EACnB;AACF,GAEM,iBAAiB,OACrB,QACA,mBACG;AArEL,MAAAtB;AAsEM,MAAA;AACI,UAAA,OAAO,MAAM,OAAO,QAAQ;AAAA,MAChC,KAAK;AAAA,MACL,iBAAiB;AAAA,MACjB,KAAK;AAAA,IAAA,CACN;AAGD,WAAO,QAAO,QAAA,OAAA,SAAA,KAAM,OAAO,WAAW,OAAO;AAAA,WACtC,KAAK;AAIZ,QAAI,IAAI,eAAe;AACV,aAAA,WAAA,OAAO,SAAS,aAAa,EAAE,GAC1C,eAAe,IAAI,GACZ;AAKiB,QAAA,MAAM,OAC7B,QAAQ,EAAC,KAAK,SAAS,iBAAiB,IAAO,KAAK,aAAY,CAAC,EACjE;AAAA,MACC,MAAM;AAAA;AAAA,MACN,MAAM;AAAA;AAAA,IACR;AAIM,YAAA,IAAI,gBAAgB,EAAC,YAAWA,aAAO,OAAO,MAAd,OAAiB,SAAAA,IAAA,UAAU,CAAA;AAI/D,QAAA,IAAI,kBAAkB,CAAC,IAAI,WAAW,IAAI,WAAW,IAAI,QAAQ,KAAK;AACxE,YAAM,OAAO,IAAI,IAAI,IAAI,QAAQ,GAAG,EAAE;AACtC,YAAM,IAAI,MAAM,6CAA6C,IAAI,EAAE;AAAA,IACrE;AAGM,UAAA;AAAA,EACR;AACF;AAKO,SAAS,iBAAiB;AAAA,EAC/B,eAAe;AAAA,EACf;AAAA,EACA;AAAA,EACA;AAAA,EACA,cAAc;AAAA,EACd,GAAG;AACL,GAAgC;AAI9B,QAAM,EAAC,WAAW,SAAQ,IAAI,uBAAsC,kBAAkB,SAAS,EAAE,GAE3F,gBAAgB,uBAAuB,OAAA,sBAAA6B,cAQvC,SAAS,SAAS;AAAA,IACtB,UAAU,kCAAkC,WAAW,IAAI,SAAS,SAAS,IAAI,IAAI;AAAA,EAAA,GAIjF,cAAkC,CAAA;AACpC,YACF,YAAY,UAAU,UAEb,OAAO,qBAAuB,OAAe,uBAAuB,OAE7E,YAAY,UAAU;AAGxB,QAAM,SAAS,OAAO;AAAA;AAAA;AAAA,IAGpB;AAAA,MAAI,CAAC,UACH,cAAc;AAAA,QACZ;AAAA,QACA;AAAA,QACA,YAAY;AAAA,QACZ,QAAQ;AAAA,QACR,GAAI,SAAS,EAAC,MAAK;AAAA,QACnB,iBAAiB;AAAA,QACjB,kBAAkB;AAAA,QAClB,2BAA2B;AAAA,QAC3B,kBAAkB;AAAA,QAClB,GAAG;AAAA,MAAA,CACJ;AAAA,IACH;AAAA,IACA;AAAA,MAAU,CAAC,WACT,MAAM,YAAgC;AACpC,cAAM,cAAc,MAAM,eAAe,QAAQ,SAAS;AAEnD,eAAA;AAAA,UACL;AAAA,UACA;AAAA,UACA,eAAe,CAAC,CAAC;AAAA,QAAA;AAAA,MACnB,CACD;AAAA,IACH;AAAA,IACA;AAAA,MAAqB,CAAC,MAAM;AAAA;AAAA;AAAA,QAG1B5C,UAAQ,KAAK,aAAa,KAAK,WAAW;AAAA;AAAA,IAC5C;AAAA,IACA,YAAY,CAAC;AAAA,EAAA;AAGf,iBAAe,oBAAoB;AACjC,UAAMyC,aAAYC;AAElB,QAAI,CAACD,YAAW;AACd,gBAAU,gBAAgB,WAAW,OAAO,SAAS,SAAS,CAAC;AAC/D;AAAA,IACF;AAEA,UAAM,gBAAgB,cAAc;AAAA,MAClC;AAAA,MACA;AAAA,MACA,QAAQ;AAAA,MACR,iBAAiB;AAAA,MACjB,YAAY;AAAA,MACZ,kBAAkB;AAAA,MAClB,GAAG;AAAA,IAAA,CACJ;AAEG,QAAA;AAQJ,SAPI,gBAAgB,UAAU,gBAAgB,cAE5C,cAAc,MAAM,eAAe,eAAe,SAAS,IAKzD,eAAe,gBAAgB,UAAU;AAE3C,gBAAU,IAAI;AACd;AAAA,IACF;AAIA,UAAM,QAAQ,MAAM,qBAAqB,eAAeA,UAAS;AACjE,cAAU,wBAAS,IAAI;AAAA,EACzB;AAEe,iBAAA,qBAAqB,QAAsBA,YAAoC;AAC5F,UAAM,EAAC,MAAA,IAAS,MAAM,OAAO,QAAyB;AAAA,MACpD,QAAQ;AAAA,MACR,KAAK;AAAA,MACL,OAAO,EAAC,KAAKA,WAAS;AAAA,MACtB,KAAK;AAAA,IAAA,CACN;AAED,WAAA,UAAU,EAAC,OAAO,UAAU,CAAA,GACrB;AAAA,EACT;AAEA,iBAAe,SAAS;AA9O1B,QAAA1B;AA+OI,UAAM,gBAAgB,cAAc;AAAA,MAClC;AAAA,MACA;AAAA,MACA,QAAQ;AAAA,MACR,iBAAiB;AAAA,MACjB,QAAOA,MAAA,SAAS,SAAS,MAAlB,OAAuBA,MAAA;AAAA,MAC9B,YAAY;AAAA,MACZ,kBAAkB;AAAA,MAClB,GAAG;AAAA,IAAA,CACJ;AAED,eAAW,SAAS,GACpB,MAAM,cAAc,QAAc,EAAC,KAAK,gBAAgB,QAAQ,OAAA,CAAO,GACvE,UAAU,IAAI;AAAA,EAChB;AAEA,QAAM,iBAAiB,qBAAqB;AAAA,IAC1C,GAAG;AAAA,IACH,WAAW,MAAM,OAAO,KAAK,IAAI,CAAC,UAAU,MAAM,MAAM,CAAC;AAAA,IACzD;AAAA,EAAA,CACD;AAEM,SAAA;AAAA,IACL;AAAA,IACA,OAAO;AAAA,IACP,OAAO;AAAA,IACP;AAAA,IACA;AAAA,EAAA;AAEJ;AAEA,SAAS,KAAK,OAAwB;AAChC,SAAA,OAAO,SAAU,YAAY,UAAU,OAAa,GAAG,KAAK,KAGzD,KAAK;AAAA,IACV,OAAO;AAAA,MACL,OAAO,QAAQ,KAAK,EACjB,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,cAAc,GAAG,IAAI,CAAC,EAC3C,IAAI,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;AAAA,IACjC;AAAA,EAAA;AAEJ;AAKa,MAAA,kBAAkB8B,UAAQ,kBAAkB,IAAI;AC7RtD,SAAS,iBAAiB,UAAuC;AACtE,MAAI,aAAa;AACR,WAAA;AAGT,MAAI,aAAa;AACR,WAAA;AAGT,MAAI,aAAa;AACR,WAAA;AAGT,MAAI,6BAAU,WAAW,OAAA;AAChB,WAAA;AAIX;ACZO,SAAS,eAAyB,UAA0B;AACjE,SAAO,CAAC,WAA0B;AAChC,QAAI,SAAgB,CAAA;AAEpB,UAAM,UAAsC,WAAW,CAAC,KAAK,YAC3D,OAAO,KAAK,GAAG,GACR,SAAS,KAAK,OAAO,QAAQ,MAAM,EAAE,KAAK,OAAO,EACzD;AACD,WAAO,OAAO;AAAA,MACZ,IAAI,MAAM;AACR,iBAAS,CAAA;AAAA,MAAC,CACX;AAAA,MACD;AAAA,IAAA;AAAA,EACF;AAEJ;ACVA,MAAM,YAAY,OAAO,SAAW,MAAc,GAAG,CAAA,CAAE,IAAI,UAAU,QAAQ,QAAQ,GAC/E,aAAa,OAAO,SAAW,MAAc,GAAG,CAAA,CAAE,IAAI,UAAU,QAAQ,SAAS,GAEjF,aAAa,CAAC,eAAuB,KAAK,IAAI,GAAG,UAAU,IAAI,KAyBxD,aAA+B,EAAC,MAAM,aAAY,GAKzD,YAAY,mBAEZ,GAAA,WAAW,UAAU,CAAC,GAGf,UAAU,UAAU,CAAC,GAE5B,oBAAoB,CAAC;AAAA,EACzB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,OAKoB;AAAA,EAClB,MAAM;AAAA,EACN;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAYO,SAAS,4BAA4B;AAAA,EAC1C;AACF,GAAwD;AA2BtD,SAAO,EAAC,mBA1BgD;AAAA,IACtD,MAAM;AAAA,IACN,WAAW,KAAK,WAAW,WAAW,IAAI,MAAM,0BAA0B,CAAC,CAAC,CAAC;AAAA,EAAA,EAC7E;AAAA,IACA,IAAI,CAAC,QAA0B,EAAC,MAAM,aAAa,eAAe,KAAI;AAAA,IACtE,eAAe,CAAC,OAAO,uBAAuB,WAAW;AACjD,YAAA,iBAAiB,KAAK,IAAI,MAAY,WAAW,qBAAqB,CAAC,GACvE,UAAU,IAAI,MAAS,oBAAA,KAAA,GAAO,QAAA,IAAY,cAAc,GACxD,UAAU,MAAM,OAAO,GACvB,YAAY,CAAC,UAAU,QACvB,qBAAqB,kBAAkB;AAAA,QAC3C;AAAA,QACA;AAAA,QACA;AAAA,QACA,WAAW;AAAA,MAAA,CACZ,GAEK,gBAAgB,MAAM;AAAA,QAC1B,UAAU,YAAY,YAAY,MAAM,SAAS,WAAW,QAAQ,CAAC;AAAA,MAAA;AAGhE,aAAA,OAAO,GAAG,kBAAkB,GAAG,cAAc,KAAK,KAAK,CAAC,CAAC,GAAG,MAAM;AAAA,IAAA,CAC1E;AAAA,IACD,UAAU,UAAU;AAAA,EAAA;AAIxB;ACvGO,SAAS,YAAY,MAA2B;AACrD,SAAI,KAAK,OACA,YAAY,KAAK,IAAI,IAGvB,KAAK,SAAS;AACvB;AAcO,SAAS,4BACd,QAC+C;AAC/C,SAAO,OAAO,SAAS,WAAW,OAAO,MAAM,WAAW,aAAa;AACzE;AClBA,MAAM,aACJ,oGACI,eAAe;AAGd,SAASC,eAAa,MAAoB;AAC3C,MAAA,CAAC,MAAM,QAAQ,IAAI;AACf,UAAA,IAAI,MAAM,sBAAsB;AAGxC,SAAO,KAAK,OAAe,CAAC,QAAQ,SAAS,MAAM;AACjD,QAAI,eAAe,OAAO;AACjB,aAAA,GAAG,MAAM,IAAI,OAAO;AAGzB,QAAA,aAAa,OAAO,KAAK,QAAQ;AACnC,aAAO,GAAG,MAAM,WAAW,QAAQ,IAAI;AAGrC,QAAA,aAAa,OAAO,GAAG;AACnB,YAAA,CAACzB,OAAM,EAAE,IAAI;AACnB,aAAO,GAAG,MAAM,IAAIA,KAAI,IAAI,EAAE;AAAA,IAChC;AAEA,QAAI,OAAO,WAAY;AAEd,aAAA,GAAG,MAAM,GADE,MAAM,IAAI,KAAK,GACL,GAAG,OAAO;AAGxC,UAAM,IAAI,MAAM,8BAA8B,KAAK,UAAU,OAAO,CAAC,IAAI;AAAA,KACxE,EAAE;AACP;AAGgB,SAAA,eAAe,WAAoB,MAAqB;AAChE,QAAA,UAAU,KAAK,CAAC;AACtB,MAAI,CAAC;AACI,WAAA;AAGH,QAAA,OAAO,KAAK,MAAM,CAAC;AACzB,MAAI,eAAe,OAAO;AACjB,WAAA,eAAe,MAAM,QAAQ,SAAS,IAAI,UAAU,OAAO,IAAI,QAAW,IAAI;AAGvF,MAAI,aAAa,OAAO;AACf,WAAA;AAAA,MACL,MAAM,QAAQ,SAAS,IAAI,UAAU,KAAK,CAAC,SAAS,KAAK,SAAS,QAAQ,IAAI,IAAI;AAAA,MAClF;AAAA,IAAA;AAIJ,MAAI,OAAO,WAAY;AACd,WAAA,eAAeV,WAAS,SAAS,IAAI,UAAU,OAAO,IAAI,QAAW,IAAI;AAGlF,QAAM,IAAI,MAAM,wBAAwB,KAAK,UAAU,OAAO,CAAC,EAAE;AACnE;AAGgB,SAAA,UAAU,OAAkB,SAA8B;AACpE,SAAA,OAAO,WAAY,YAAY,CAAC,aAAa,OAAO,IAC/C,KAGF,OAAO,WAAY,WACtB,UACA,MAAM,UAAU,CAAC,SAAS,cAAc,IAAI,KAAK,KAAK,SAAS,QAAQ,IAAI;AACjF;AAGO,SAAS,aAAa,MAAoB;AACzC,QAAA,WAAW,KAAK,MAAM,UAAU;AACtC,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,qBAAqB;AAGhC,SAAA,SAAS,IAAI,oBAAoB;AAC1C;AAGO,SAAS,qBAAqB,SAA8B;AACjE,SAAI,eAAe,OAAO,IACjB,sBAAsB,OAAO,IAGlC,aAAa,OAAO,IACf,oBAAoB,OAAO,IAGhC,aAAa,OAAO,IACf,2BAA2B,OAAO,IAGpC;AACT;AAGO,SAAS,sBAAsB,SAA8B;AAClE,SAAO,OAAO,QAAQ,QAAQ,UAAU,EAAE,CAAC;AAC7C;AAGO,SAAS,oBAAoB,SAA+B;AAC3D,QAAA,WAAW,QAAQ,MAAM,YAAY;AAC3C,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,qBAAqB;AAGvC,SAAO,EAAC,MAAM,SAAS,CAAC,EAAC;AAC3B;AAGO,SAAS,2BAA2B,SAA6B;AACtE,QAAM,CAACU,OAAM,EAAE,IAAI,QAAQ,MAAM,GAAG,EAAE,IAAI,CAAC,QAAS,QAAQ,KAAK,MAAM,OAAO,GAAG,CAAE;AAC5E,SAAA,CAACA,OAAM,EAAE;AAClB;AAGgB,SAAA,cAAc,OAAa,OAAsB;AAC3D,SAAA,MAAM,WAAW,MAAM,SAClB,KAGF,MAAM,MAAM,CAAC,UAAU,UAAU;AAChC,UAAA,WAAW,MAAM,KAAK;AAC5B,WAAI,aAAa,QAAQ,KAAK,aAAa,QAAQ,IAC1C,SAAS,SAAS,SAAS,OAGhC,eAAe,QAAQ,IAClB,OAAO,QAAQ,MAAM,OAAO,QAAQ,IAGzC,aAAa,QAAQ,KAAK,aAAa,QAAQ,IAC1C,SAAS,CAAC,MAAM,SAAS,CAAC,KAAK,SAAS,CAAC,MAAM,SAAS,CAAC,IAG3D,aAAa;AAAA,EAAA,CACrB;AACH;AAGO,SAAS,WAAW,WAAwC;AACjE,SAAO,cAAc,SAAS,IAAI,UAAU,OAAO;AACrD;AAGO,SAAS,kBAAkB,WAA8C;AACxE,QAAA,MAAM,WAAW,SAAS;AAChC,SAAO,MAAM,EAAC,MAAM,IAAO,IAAA;AAC7B;AAGO,SAAS0B,gBAAc,MAAwB;AAC7C,SAAA,OAAO,QAAS,YAAY,SAAS,QAAQ,OAAO,KAAK,IAAI,EAAE,UAAU;AAClF;ACpJgB,SAAA,mBACd,cACA,YACW;AACX,SAAO,aAAa,KAAI,cAAY,OAAA,SAAA,WAAA,WAAU,IAAI;AACpD;AAGgB,SAAA,oBAAoB,MAAY,UAAiD;AAC/F,QAAM,OAAa,MAAM,QAAQ,QAAQ,IAAI,WAAW,aAAa,QAAQ;AAEtE,SAAA,gBAAgB,MAAM,IAAI;AACnC;AAGgB,SAAA,cAAc,MAAY,UAA2C;AACnF,QAAM,OAAa,MAAM,QAAQ,QAAQ,IAAI,WAAW,aAAa,QAAQ;AACtE,SAAA,UAAU,MAAM,IAAI;AAC7B;AAEA,SAAS,gBAAgB,MAAY,MAAoC;AACjE,QAAA,SAAS,UAAU,MAAM,IAAI;AAC9B,MAAA,UAID,OAAO,WAAW;AAItB,WAAO,OAAO,cAAc;AAC9B;AAGA,SAAS,UAAU,MAAY,MAAY,aAAmB,CAAA,GAAsB;AAClF,MAAI,KAAK,WAAW;AACX,WAAA;AAGT,QAAM,UAAU,KAAK,CAAC,GAChB,OAAO,KAAK,MAAM,CAAC;AAEzB,MAAI,aAAa,OAAO;AAChB,UAAA,IAAI,MAAM,8CAA8C;AAGhE,MAAI,eAAe,OAAO,KAAK,aAAa,OAAO,GAAG;AAC9C,UAAA,WAAW,eAAe,OAAO,IAAI,YAAY,OAAO,KAAK,YAAY,QAAQ,IAAI;AACvF,QAAA,KAAK,SAAS,SAAS;AACE,MAtEjC,cAsEqDD,eAAa,UAAU;AACtE;AAAA,IACF;AAEM,UAAA,WAAW,KAAK,MAAM;AAAA,MAC1B,eAAe,OAAO,IAClB,CAAC,SAAS,KAAK,YAAY,UAC3B,CAAC,SAAS,eAAe,MAAM,OAAO;AAAA,IAAA;AAG5C,QAAI,CAAC,UAAU;AACc,MAjFjC,cAiFqDA,eAAa,UAAU;AACtE;AAAA,IACF;AAEA,WAAO,UAAU,SAAS,MAAM,MAAM,WAAW,OAAO,OAAO,CAAC;AAAA,EAClE;AAEI,MAAA,KAAK,SAAS,UAAU;AACK,IAzFnC,aAyFsDA,eAAa,UAAU;AACzE;AAAA,EACF;AAEM,QAAA,YAAY,KAAK,OAAO,OAAO;AACjC,MAAA,OAAO,YAAc,KAAa;AAER,IAhGhC,aAgGmDA,eAAa,UAAU;AAEtE;AAAA,EACF;AAEA,SAAO,UAAU,WAAW,MAAM,WAAW,OAAO,OAAO,CAAC;AAC9D;AAQA,SAAS,eAAe,MAAgB,KAAmB;AACzD,QAAM,WAAW,KAAK;AACf,SAAA,SAAS,SAAS,YAAY,CAAC,SAAS,UAAU,KAAQ,SAAS,QAAQ,SAAS;AAC7F;AAaO,SAAS,UACd,MACA,SACA,OAAa,CAAA,GACP;AACD,MAAA,QAAQ,MAAM,IAAI,GAIvB;AAAI,QAAA,KAAK,SAAS,SAAS;AACV,qBAAA,MAAM,SAAS,IAAI;AAClC;AAAA,IACF;AAEI,QAAA,KAAK,SAAS,UAAU;AACV,sBAAA,MAAM,SAAS,IAAI;AACnC;AAAA,IACF;AAEI,SAAK,SAAS,YAChB,gBAAgB,MAAM,SAAS,IAAI;AAAA,EAAA;AAEvC;AAEA,SAAS,eAAe,MAAiB,SAAsB,MAAY;AACrE,OAAK,WAAW,eAIpB,KAAK,MAAM,QAAQ,CAAC,aAAa;AA3JnC,QAAA/B;AA4JI,UAAM,OAAO,SAAS,KAAK,SAAS,cAAaA,eAAS,KAAK,YAAd,OAAuB,SAAAA,IAAA,OAClE,UAAU,OAAO,EAAC,KAAI,IAAI,iBAAiB,QAAQ;AACzD,cAAU,SAAS,MAAM,SAAS,KAAK,OAAO,OAAO,CAAC;AAAA,EAAA,CACvD;AACH;AAEA,SAAS,gBAAgB,MAAkB,SAAsB,MAAY;AACvE,OAAK,WAAW,eAIpB,OAAO,KAAK,KAAK,MAAM,EAAE,QAAQ,CAAC,cAAc;AACxC,UAAA,YAAY,KAAK,OAAO,SAAS;AACvC,cAAU,WAAW,SAAS,KAAK,OAAO,SAAS,CAAC;AAAA,EAAA,CACrD;AACH;AAEA,SAAS,gBAAgB,MAAkB,SAAsB,MAAY;AACvE,OAAK,WAAW,eAIpB,KAAK,SAAS,QAAQ,CAAC,YAAY;AACvB,cAAA,SAAS,SAAS,IAAI;AAAA,EAAA,CACjC;AACH;AAEA,SAAS,iBAAiB,UAA4B;AACpD,SAAO,OAAO,SAAS,UAAY,MAAc,SAAS,aAAa,IAAI,SAAS;AACtF;ACrLa,MAAA,0BAA0B,cAAuC,IAAI;ACI3E,SAAS,sBAAwC;AAChD,QAAA,mBAAmB,WAAW,uBAAuB;AAE3D,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,yCAAyC;AAGpD,SAAA;AACT;AAGO,SAAS,aAAa,QAAkC;AAC7D,QAAM,UAAU;AAGhB,SAAO,kBAAkB,SAAS,QAAQ,OAAO,MAAM,IAAI,SAAS,CAAC,MAAM,GAAG,QAAQ,IAAI,IAAI,CAAC;AACjG;ACRA,MAAM,2BAAwC,UAIxC,0BAA0B,CAAC,SAAS,OAAO,MAAM,GAEjD,cAA6B,WAAW;AAAA,EAC5C,CAAC,QAAQ,CAAC,wBAAwB,SAAS,GAAG;AAChD,GAEM,WAAW,CAAC,WAA8D;AAC9E,QAAM,eAAe,WAAW;AAEzB,SAAA;AAAA,IACL,YAAY,eAAe,QAAQ;AAAA,IACnC,QAAQ,eAAe,QAAQ;AAAA,IAC/B,MAAM,eAAe,QAAQ;AAAA,EAAA;AAEjC,GAEM,mBAAmB,CAAC,WAA2D;AACnF,QAAM,EAAC,YAAY,QAAQ,KAAI,IAAI,SAAS,MAAM;AAElD,SAAO,YAAY;AAAA,IACjB,CAAC,QAAQ,SACP,OAAO,GAAG,IAAI;AAAA,MACZ,MAAM;AAAA,MACN,YAAY,KAAK,GAAG,EAAE,UAAU,EAAE;AAAA,MAClC,QAAQ,KAAK,GAAG,EAAE,MAAM,EAAE;AAAA,MAC1B,MAAM,KAAK,GAAG,EAAE,IAAI,EAAE;AAAA,MACtB,OAAO,KAAK,GAAG;AAAA,IAEV,GAAA;AAAA,IAET,CAAC;AAAA,EAAA;AAEL,GAEM,oBAAoB,CAAC,WAA2C;AACpE,QAAM,EAAC,YAAY,QAAQ,KAAI,IAAI,SAAS,MAAM;AAE3C,SAAA;AAAA,IACL,MAAM;AAAA,IACN,YAAY,KAAK,KAAK,UAAU,EAAE;AAAA,IAClC,QAAQ,KAAK,KAAK,MAAM,EAAE;AAAA,IAC1B,MAAM,KAAK,KAAK,IAAI,EAAE;AAAA,IACtB,OAAO,KAAK;AAAA,EAAA;AAEhB;AAGO,SAAS,uBAAuB,SAAoD;AACnF,QAAA;AAAA,IACJ,gBAAgB;AAAA,IAChB;AAAA,IACA,kBAAkB;AAAA,IAClB;AAAA,EACE,IAAA,SAEE,aAAa,UAAU,iBAAiB,MAAM,GAC9C,iBAAiB,sBAAsB,kBAAkB,MAAM,GAC/D,mBAAmB,wBAAwB;AAE7C,MAAA,CAAC,WAAW,eAAe,gBAAgB;AAC7C,UAAM,IAAI,MAAM,6CAA6C,gBAAgB,GAAG;AAGlF,QAAM,gBAAgC,OAAO,KAAK,UAAU,GACtD,gBAAgB,oBAAI,IAAmC,GACvD,qBAAqB,oBAAI,IAA0B,GACnD,iBAA+C,cAAc;AAAA,IACjE,CAAC,QAAQ,WACP,OAAO,KAAK,IAAI,GACT;AAAA,IAET,CAAC;AAAA,EAAA,GAKG,WAAW,oBAAI;AAEjB,MAAA;AAEJ,SAAI,2BAAS,aACX,QAAQ,UAAU,GAAG,UAAU,CAAC,SAAS,eAAe,OAAO,KAAK,KAAK,IAAI,CAAC,GAGzE,EAAC,KAAAiC,MAAK,QAAAC;AAEb,WAASD,KAAI,QAAkC;AAC7C,WAAK,SAIE,WAAW,WAAW,MAAM,CAAC,IAH3B;AAAA,EAIX;AAEA,WAAS,WAAW,QAA8B;AAChD,QAAI,WAAW;AACN,aAAA;AAGH,UAAA,cAAc,SAAS,IAAI,MAAM;AACnC,QAAA;AACK,aAAA;AAKH,UAAA,UAAU,mBAAmB,IAAI,MAAM;AAC7C,QAAI,YAAY,eAAe,OAAO,MAAM,KAAK,CAAC;AACzC,aAAA,UAAU,QAAQ,OAAO;AAI5B,UAAA,eAAe,gBAAgB,MAAM;AAC3C,WAAI,eAAe,YAAY,MAAM,IAC5B,UAAU,QAAQ,YAAY,IAKhC,UAAU,QAAQ,gBAAgB,OAAO,CAAC;AAAA,EACnD;AAEA,WAASC,QAAO,QAAuC;AACjD,QAAA,eAAe,cAAc,IAAI,MAAM;AACvC,QAAA;AACK,aAAA;AAGH,UAAA,MAAM,WAAW,MAAM;AACd,WAAA,eAAA,mBAAmB,QAAQ,GAAG,GAC7C,cAAc,IAAI,QAAQ,YAAY,GAC/B;AAAA,EACT;AAES,WAAA,UAAU,QAAgB,KAAiC;AACzD,WAAA,SAAA,IAAI,QAAQ,GAAG,GACxB,mBAAmB,IAAI,QAAQ,GAAG,GAClC,eAAe,GAAG,KACX;AAAA,EACT;AAES,WAAA,YAAY,QAAgB,KAAmB;AACtD,aAAS,OAAO,MAAM,GACtB,eAAe,GAAG;AAAA,EACpB;AAEA,WAAS,iBAA2C;AAClD,WAAO,cAAc,KAAK,CAAC,aAAa,eAAe,QAAQ,MAAM,CAAC;AAAA,EACxE;AAEA,WAAS,iBAA0B;AACjC,WAAO,EAAQ;EACjB;AAEA,WAAS,gBAAgB,sBAAmD;AACtE,QAAA,YAAY,OACZ,YAA4B,CAAA;AAElB,WAAA,cAAA,QAAQ,CAAC,aAAa;AAC5B,YAAA,OAAO,eAAe,QAAQ;AAChC,eAAS,YACX,UAAU,KAAK,QAAQ,IACd,OAAO,cAChB,YAAY,MACZ,YAAY,CAAC,QAAQ;AAAA,IAAA,CAExB,GAEM,wBAAwB,UAAU,SAAS,oBAAoB,IAClE,uBACA,UAAU,CAAC;AAAA,EACjB;AAES,WAAA,mBAAmB,QAAgB,KAA0C;AAC7E,WAAA,IAAI,WAAsB,CAAC,eAAe;AACzC,YAAA,YAAY,WAAW,GAAG;AACrB,aAAA,WAAA,KAAK,SAAS,GAClB,MAAM;AACX,sBAAc,OAAO,MAAM,GAC3B,YAAY,QAAQ,GAAG;AAAA,MAAA;AAAA,IACzB,CACD,EAAE,KAAK,YAAY,EAAC,UAAU,GAAK,CAAA,CAAC;AAAA,EACvC;AAEA,WAAS,eAAe,QAAuB;AAC7C,oBAAgB,QAChB,eAAe,gBAAgB,KAAK,SAAS,IAAI;AAAA,EACnD;AAEA,WAAS,gBAAgB,QAA8B;AACrD,QAAIT,QAAO;AACX,aAAS,IAAI,GAAG,IAAI,OAAO,QAAQ;AAEjC,MAAAA,SAASA,SAAQ,KAAKA,QAAO,OAAO,WAAW,CAAC,IAAK;AAEvD,WAAO,cAAc,KAAK,IAAIA,KAAI,IAAI,cAAc,MAAM;AAAA,EAC5D;AACF;AC3MO,SAAS,yBAAyB;AAAA,EACvC;AAAA,EACA,SAAS;AACX,GAAgD;AAC9C,QAAM,EAAC,OAAM,IAAI,eAAe,GAE1B,UAAU,QAAQ,MACf,oBAAoB,uBAAuB,EAAC,OAAM,CAAC,GACzD,CAAC,kBAAkB,MAAM,CAAC;AAE7B,6BACG,wBAAwB,UAAxB,EAAiC,OAAO,SAAU,SAAS,CAAA;AAEhE;ACnBO,SAAS,mBAAmB,YAA2C;AAC5E,QAAM,mBAAmB;AAElB,SAAA,mBAAmB,kBAAkB,UAAU;AACxD;AAGO,SAAS,uBAAuB,MAAY,OAAsB,IAAe;AACtF,QAAM,mBAAmB,oBAAA,GACnB,aAAa,QAAQ,MAAM,oBAAoB,MAAM,IAAI,GAAG,CAAC,MAAM,IAAI,CAAC;AAEvE,SAAA;AAAA,IACL,MAAM,mBAAmB,kBAAkB,UAAU;AAAA,IACrD,CAAC,YAAY,gBAAgB;AAAA,EAAA;AAEjC;ACKO,SAAS,YAAYpC,QAA2D;AACrF,MAAI,EAAE,UAAUA;AACP,WAAA,oBAAC,2BAA2B,EAAA,GAAGA,OAAO,CAAA;AAG/C,QAAM,EAAC,MAAM,OAAO,CAAA,GAAI,GAAG,UAAS,IAAIA,QAClC,aAAa,oBAAoB,MAAM,IAAI;AAE1C,SAAA,oBAAC,2BAA2B,EAAA,GAAG,WAAW,aAAa,aAAa,CAAC,UAAU,IAAI,CAAI,EAAA,CAAA;AAChG;AAEA,SAAS,0BAA0BA,QAAwC;AACnE,QAAA,EAAC,aAAa,UAAU,aAAa,GAAG,cAAaA,QACrD,EAAC,GAAAa,OAAK;AAEZ,MAAI,CAAC;AACI,WAAA;AAGT,QAAM,UACJ,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,IAAC,oBAAAc,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAA,eAAed,GAAE,uBAAuB,EAC3C,CAAA;AAAA,IACC,oBAAA,OAAA,EAAM,OAAO,GACX,sBAAY,IAAI,CAAC,YAAY,QAC3B,oBAAA,gBAAA,EAAe,WAA6B,GAAA,GAAK,CACnD,GACH;AAAA,EACF,EAAA,CAAA;AAGF,SACG,oBAAA,qBAAA,EAAoB,SAAQ,cAC3B,UAAC,oBAAA,SAAA,EAAQ,SAAkB,QAAM,IAAE,GAAG,WACnC,SAAA,CACH,EACF,CAAA;AAEJ;AAEA,SAAS,eAAe,EAAC,cAA8C;AAC/D,QAAA,EAAC,QAAQ,UAAa,IAAA,YACtB,CAAC,IAAI,IAAI,QAAQ,MAAM,GACvB,QAAQ,mBAAmB,UAAU,GACrC,UAAU,gBAAgB,WAAW,EAAC,SAAS,GAAI,CAAC,GACpD,EAAC,GAAAA,GAAC,IAAI,eAAe;AAGzB,SAAA,qBAAC,QAAO,EAAA,OAAO,GACb,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAM;AAAA,QACN,cAAc;AAAA,QACd,OAAO;AAAA,UACL,iBAAiB,MAAM;AAAA,UACvB,OAAO,MAAM;AAAA,UACb,cAAc;AAAA,QAChB;AAAA,QAEA,UAAA;AAAA,UAAC,oBAAA,YAAA,EAAW,MAAM,OAAQ,CAAA;AAAA,UAC1B,oBAAC,UAAO,aAAa,GACnB,8BAACc,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,OAAO,EAAC,OAAO,MAAM,QACvC,UAAA,OAAO,KAAK,cAAcd,GAAE,wBAAwB,EAAA,CACvD,EACF,CAAA;AAAA,QAAA;AAAA,MAAA;AAAA,IACF;AAAA,IACA,oBAACc,QAAK,EAAA,IAAG,QAAO,OAAK,IAAC,MAAM,GAAG,UAAU,WACtC,UACH,QAAA,CAAA;AAAA,EACF,EAAA,CAAA;AAEJ;AChFA,MAAMF,eAAa,OAAO,IAAI;AAAA,wBACN,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,OAAO,CAAC,CAAC,CAAC;AAAA,0BACtC,CAAC,EAAC,MAAK,MAAM,MAAM,OAAO,MAAM,KAAK,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAgDnEqB,eAAmB,CAAA,GAGZ,WAAW,WAAW,SACjC9C,QACA,KACA;AACM,QAAA;AAAA,IACJ,YAAY;AAAA,IACZ,KAAK;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,OAAO8C;AAAAA,IACP,QAAQ,CAAC;AAAA,IACT;AAAA,IACA,GAAG;AAAA,EAAA,IACD9C,QAEE,aAAa;AAAA,IACjB,MAAM,kBAAkB,oBAAoB,MAAO,IAAI;AAAA,IACvD,CAAC,gBAAgB,MAAM,IAAI;AAAA,EAGvB,GAAA,QAAQ,mBAAmB,UAAU,GAErC,UACJ;AAAA,IAACyB;AAAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ;AAAA,MACA;AAAA,MACA,cAAY,sBAAsB,CAAC,aAAa,SAAY;AAAA,MAC5D;AAAA,MACA,QAAQ;AAAA,MACR,OAAO;AAAA,QACL,GAAG;AAAA,QACH,iBAAiB,MAAM;AAAA,QACvB,OAAO,MAAM;AAAA,MACf;AAAA,MAEC;AAAA,IAAA;AAAA,EAAA;AAIL,SAAI,WAAW,aAEX;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,aAAa,CAAC,UAAU;AAAA,MACxB,aAAa,WAAW,OAAO,WAAY,YAAY,QAAQ;AAAA,MAE9D,UAAA;AAAA,IAAA;AAAA,EAKA,IAAA;AACT,CAAC,GCtHKsB,gBAAc,OAAO;AAAA,mBACR,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,OAAO,CAAC,CAAC,CAAC;AAAA,aAC9C,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,CAAC;AAAA,GAG9C,iBAAiB,OAAOpB,MAAI;AAAA;AAAA;AAAA;AAAA;AAO3B,SAAS,mBAAmB3B,QAGhC;AACK,QAAA,EAAC,QAAQ,QAAW,IAAAA;AAE1B,MAAI,OAAO,WAAY;AACrB,WACG,oBAAA,KAAA,EACC,UAAC,oBAAA2B,QAAA,EAAK,OAAO,SAAS,MAAM,GAAG,QAAO,UAAS,cAAa,YACzD,mBACH,EACF,CAAA;AAIJ,QAAM,EAAC,UAAU,WAAW,SAAS,WAAU,IAAI,SAC7C,UAAU,OAAO,YAAc,KAC/B,UAAU,OAAO,UAAY;AAC/B,MAAA;AAEF,WAAQ,oBAAA,qBAAA,EAAoB,YAAwB,QAAgB,QAAkB,CAAA;AAGpF,MAAA;AAEK,WAAA,oBAAC,qBAAoB,EAAA,YAAwB,UAAsB,CAAA;AAG5E,MAAI,YAAY,OAAO,UAAY,OAAe,OAAO,YAAc;AAErE,WAAQ,oBAAA,mBAAA,EAAkB,YAAwB,WAAsB,QAAkB,CAAA;AAItF,QAAA,iBAAiB,WAAW,KAAK;AAErC,SAAA,oBAAC,OAAI,SAAS,GACZ,+BAACA,QAAK,EAAA,MAAM,GAAG,QAAO,UAAS,UAAA;AAAA,IAAA;AAAA,IAC3B;AAAA,EAAA,EACJ,CAAA,EACF,CAAA;AAEJ;AAEA,SAAS,oBAAoB3B,QAI1B;AACK,QAAA,EAAC,YAAY,gBAAgB,QAAQ,UAAU,MAAKA,QACpD,EAAC,GAAAa,OAAK,kBACN,gBAAgB,UAAU,GAC1B,cAAcA,GAAE,wCAAwC,EAAC,UAAU,cAAc,CAAA,GACjF,UAAY,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA;AAAA,IAAE;AAAA,EAAc,EAAA,CAAA,GAE5B,cADiB,UAAA,QAAA,OAAQ,OAAO,oBAAoB,OAAO,MAAM,CAAA,CAAE,IAAI,WACxC;AAErC,SAAI,aAEA,oBAAC,UAAS,EAAA,YAAwB,SAAS,EAAC,eAAc,IAAIkC,eAC5D,UAAA,oBAAC,gBAAe,EAAA,MAAM,GAAG,QAAO,UAAS,aAAY,OAAM,OAAO,EAAC,gBAAgB,UAChF,UACH,QAAA,CAAA,GACF,IAKF,oBAACpB,QAAK,EAAA,MAAM,GAAG,QAAO,UACnB,UACH,QAAA,CAAA;AAEJ;AAEA,SAAS,oBAAoB3B,QAAiE;AACtF,QAAA,EAAC,YAAY,YAAY,EAAA,IAAKA,QAC9B,EAAC,GAAAa,GAAK,IAAA,kBACN,gBAAgB,YAAY,GAC5B,cAAcA,GAAE,4CAA4C,EAAC,UAAU,eAAc;AAC3F,6BACG,UAAS,EAAA,YAAY,cAAc,MAAM,IAAIkC,eAAa,SAAS,EAAC,YAAW,GAC9E,+BAAC,gBAAe,EAAA,MAAM,GAAG,QAAO,UAAS,aAAY,OAAM,UAAA;AAAA,IAAA;AAAA,IACvD;AAAA,EAAA,EACJ,CAAA,EACF,CAAA;AAEJ;AAEA,SAAS,kBAAkB/C,QAIxB;AACD,QAAM,EAAC,YAAY,WAAW,QAAW,IAAAA,QACnC,EAAC,GAAAa,GAAK,IAAA,eAAA,GACN,YAAY,UAAU,WACtB,cAAc,YAAY,IAAI,WAAM,UACpC,YAAY,KAAK,IAAI,SAAS,GAC9B,YAAY,YAAY,IAAI,OAAO,QACnC,cAAcA,GAAE,4BAA4B;AAAA,IAChD,OAAO;AAAA,IACP,SAAS;AAAA,EAAA,CACV;AAED,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAC,oBAAA,KAAA,EAAI,SAAS,GACZ,UAAA,qBAAC,kBAAe,MAAM,GAAG,QAAO,UAAS,UAAA;AAAA,MAAA;AAAA,MACrC,UAAU;AAAA,IAAA,EAAA,CACd,EACF,CAAA;AAAA,IACC,oBAAA,UAAA,EAAS,YAAwB,IAAIkC,eAAa,SAAS,EAAC,YAAW,GACtE,UAAC,qBAAA,gBAAA,EAAe,MAAM,GAAG,QAAO,UAC7B,UAAA;AAAA,MAAA;AAAA,MACA,KAAK,IAAI,SAAS;AAAA,IAAA,EAAA,CACrB,EACF,CAAA;AAAA,EACF,EAAA,CAAA;AAEJ;ACrIO,SAAS,iBAAiB/C,QAA+D;AACxF,QAAA,EAAC,QAAQ,UAAa,IAAAA;AAG1B,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,WAAW;AAAA,MACX,+BACG2B,QAAK,EAAA,OAAK,IAAC,MAAM,GAChB,UAAC,oBAAA,kBAAA,CAAA,CAAiB,EACpB,CAAA;AAAA,MAGD,oBAAU,IAAI,CAAC,cAAc,QACR,OAAO,gBAAiB,YAAY,CAAC,UAAU,OAAO,gCAMlE,oBAAmB,EAAA,QAA0B,SAAS,aAAd,GAAA,GAA4B,IAHnE,IAIV;AAAA,IAAA;AAAA,EAAA;AAGP;ACpBO,SAAS,WAAW,OAA2C;AACpE,SAAOpB,WAAS,KAAK,KAAK,QAAO,+BAAO,SAAS;AACnD;AAMgB,SAAA,kBACd,eACA,mBACA,SACS;AACH,QAAA,EAAC,aAAa,UAAAF,WAAU,QAAQ,UAAS,SAEzC2C,WAAU,OAAO,EAAK;AAE5B,SAAO,QAAQ,MAAM;AACnB,QAAI,YAAY;AAEZ,QAAA,OAAO,iBAAkB,aAAa,kBAAkB;AAC1D,aAAO,iBAAiB;AAGtB,QAAA;AACF,kBAAY,cAAc;AAAA,QACxB,UAAA3C;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA,CACD;AAAA,aACM,KAAK;AACJ,aAAA,QAAA;AAAA,QACN,uDAAuD,iBAAiB,OAAO,IAAI,OAAO;AAAA,MAErF,GAAA;AAAA,IACT;AAEA,WAAI,WAAW,SAAS,KAAK,CAAC2C,SAAQ,WACpC,QAAQ;AAAA,MACN,SAAS,iBAAiB,wFAAwF,iBAAiB;AAAA,IAE9H,GAAA,OAGL,OAAO,YAAc,OACvB,QAAQ;AAAA,MACN,SAAS,iBAAiB,6CAA6C,iBAAiB;AAAA,IAIrF,GAAA;AAAA,EAAA,GACN,CAAC,eAAe3C,WAAU,QAAQ,OAAO,aAAa,iBAAiB,CAAC;AAC7E;ACzCA,MAAM,yBAAyB,CAACL,WAA6C;AAC3E,QAAM,EAAC,gBAAgB,IAAO,kBAAkB,UAAAK,WAAU,QAAQ,OAAO,UAAS,IAAIL,QAChF,QAAQ,UAAU,SAAS,GAC3B,cAAc;AAEK,SAAA,kBAAkB,eAAe,kBAAkB;AAAA,IAC1E;AAAA,IACA,UAAAK;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAGH;AC/BO,SAAS,gBAAgB,OAAwB;AACtD,SAAO,cAAc,KAAK,IAAI,MAAM,QAAQ,cAAc,KAAK;AACjE;AAEgB,SAAA,qBACd,MACA,YAC8C;AAC1C,SAAA,KAAK,WAAW,UACX;AAAA,IACL,QAAQ,uBAAuB,YAAY,KAAK,OAAO;AAAA,EAAA,IAIvD,KAAK,WAAW,YACX;AAAA,IACL,UAAU,uBAAuB,YAAY,KAAK,SAAS;AAAA,IAC3D,QAAQ,uBAAuB,YAAY,KAAK,OAAO;AAAA,EAAA,IAIvD,KAAK,WAAW,YACX;AAAA,IACL,UAAU,uBAAuB,YAAY,KAAK,SAAS;AAAA,EAAA,IAKxD;AAAA,IACL,QAAQ,uBAAuB,YAAY,KAAK,OAAO;AAAA,EAAA;AAE3D;AAEA,SAAS,uBACP,YACA,OACwB;AACxB,QAAM,WAAW,gBAAgB,KAAK;AAElC,SADa,WAAW,GAAG,KAAK,CAAC,cAAc,UAAU,SAAS,QAAQ,MAKtE,WAAW,GAAG,WAAW,IAAI,WAAW,GAAG,CAAC,IAAI;AAC1D;AAEA,SAAS,cAAc,KAAc;AAC/B,SAAA,MAAM,QAAQ,GAAG,IACZ,UAGL,QAAQ,OACH,SAGF,OAAO;AAChB;AC5DO,MAAM,qBAAqB;AAAA;AAAA,EAEhC,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AACrB,GAEa,eAAe,UAEf,oBAAoB;AAAA;AAAA,EAE/B,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AAAA,EACnB,CAAC,UAAU,QAAQ;AACrB,GAEa,qBAAqB,UAErB,iBAAiB;AAAA,EAC5B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAEa,wBAAwB,UAExB,uBAAuB;AC9E7B,SAAS,gBAAgB,YAAsC;AAC7D,SAAA,WAAW,GAAG,KAAK,cAAc;AAC1C;AAEA,MAAM,mBAAmB4C,kBAA8B,IAAI,CAACC,SAAQA,KAAI,CAAC,CAAC,EAAE;AAAA,EAC1EC,mBAA+B,IAAI,CAACD,SAAQA,KAAI,CAAC,CAAC;AACpD,GACM,iBAAiBD,kBAA8B,IAAI,CAACC,SAAQA,KAAI,CAAC,CAAC,EAAE;AAAA,EACxEC,mBAA+B,IAAI,CAACD,SAAQA,KAAI,CAAC,CAAC;AACpD,GACM,aAAa,iBAChB,OAAO,cAAc,EACrB,OAAOE,cAA0B,EACjC,OAAOC,YAAwB,EAC/B,OAAOC,oBAAgC,GACpC,cAAc,IAAI,OAAO,GAAG,WAAW,KAAK,GAAG,CAAC,IAAI,GAAG,GACvD,eAAe,IAAI,OAAO,GAAG,WAAW,KAAK,GAAG,CAAC;AAAA,GAAO,GAAG;AAQ1D,SAAS,eAAe,YAAuD;AACpF,SAAO,WAAW,aAAa,YAAY,WAAW,SAAS;AACjE;AAEO,SAAS,SAAS,MAAkC;AACzD,SACE,wBAAwB,IAAI,KAC5B,CAAC,CAAC,KAAK,SACP,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,IAAI,EAAE,SAAS,KAAK,KAAK;AAE5D;AAEgB,SAAA,cAAc,MAAkB,OAAsC;AAC/D,SAAA,KAAK,OAAO,SACb,MACjB;AAAA,IACC,CAAC,SACC,KAAK,KAAK,cAAc,KAAK,KAAK,YAAY,SAAS,KAAK,KAAK,cAAc;AAAA,EAElF,EAAA,IAAI,CAAC,SAAc,KAAK,IAAI,EAC5B,IAAI,CAAC,cAAmB,SAAuB,EAAE,CAAC;AACvD;AAEgB,SAAA,mBACd,QACA,OAC8B;AAC9B,QAAM,gBAAgB,OAAO,KAAK,CAAC,MAAM,EAAE,SAAS,UAAU;AAO9D,SALG,iBACC,cAAc,QACd,cAAc,KAAK,aAAa,WAC/B,cAAc,KAAK,GAAG,KAAK,CAAC,SAAS,KAAK,SAAS,MAAM,KAAK,KACjE;AAEJ;AAEO,SAAS,cAAc,gBAAkE;AAC9F,SAAI,eAAe,aACV,QAAQ,eAAe,YAAY,CAAC,OAAO,GAAG,CAAC,KAAK,CAAC,IAEvD,CAAA;AACT;AASgB,SAAA,YAAY,MAAc,YAAqC;AACtE,SAAA,cAAc,UAAU,EAAE,KAAK,CAACC,SAAQA,KAAI,UAAU,IAAI;AACnE;AAEO,SAAS,sBACd,MACA,OACA,cACA,eACA,WACQ;AACR,SAAK,QAGE,MAAM,SACV,IAAI,CAAC,UAAU;AA5HpB,QAAA5C;AA6HU,QAAA,WAAW,mBAAmB,KAAK,KAAIA,YAAM,SAAN,OAAA,SAAAA,IAAY,QAAQ,aAAa,EAAM,IAAA;AAC9E,QAAA,mBAAmB,KAAK,GAAG;AAE7B,YAAM,WAAW,sBAAsB,MAAM,KAAK,GAC5C,WAAW,qCAAU,OAAO;AAEhC,kBACA,SAAS,YAAY,MAAM,QAC3B,SAAS,SAAS,YAClB,SAAS,WAAW,gBAEpB,WAAW,SAAS,SACjB,OAAO,CAAC,QAAQ,IAAI,WAAW,SAAS,EACxC,IAAI,CAAC,QAAQ,IAAI,KAAK,QAAQ,aAAa,EAAE,CAAC,EAC9C,KAAK2C,oBAAgC,IAEtC,MAAM,SACR,MAAM,MAAM,QAAQ,CAAC,SAAS;AACP,QAAE,aAAa,IAAI,IAEtC,WAAW,GAAG,aAAa,IAAI,EAAE,CAAC,CAAC,GAAG,QAAQ,GAAG,aAAa,IAAI,EAAE,CAAC,CAAC,KAC7D,cAAc,IAAI,MAC3B,WAAW,GAAG,cAAc,IAAI,EAAE,CAAC,CAAC,GAAG,QAAQ,GAAG,cAAc,IAAI,EAAE,CAAC,CAAC;AAAA,MAAA,CAE3E;AAAA,IAEL;AACa,iBAAA,UAAU,MAAM,IAAI;AAEjC,WAAO,GAAGD,YAAwB,GAAG,QAAQ;AAAA,EAC9C,CAAA,EACA,KAAK,EAAE,IAnCD;AAoCX;AAEgB,SAAA,uBACd,MACA,YACkB;AACZ,QAAA,eACJ,KAAK,WAAW,YACX,KAAK,YACL,KAAK,SACN,QAA0B;AAAA,IAC9B,GAAG;AAAA,IACH,QAAQ;AAAA,IACR;AAAA,EAAA;AAGF,MAAI,cAAc;AAChB,UAAM,gBAA+B,CAAA,GAC/B,eAA8B,IAC9B,YAA6B,CAC7B,GAAA,iBAAiB,mBAAmB,WAAW,QAAQ;AAAA,MAC3D,MAAM;AAAA,MACN,OAAO;AAAA,IAAA,CACR;AACG,sBACF,cAAc,cAAc,EAAE,QAAQ,CAACE,MAAK,UAAU;AACpD,mBAAaA,KAAI,KAAK,IAAIN,kBAA8B,KAAK;AAAA,IAAA,CAC9D,GAEiB,eAAe,MAAM,MAAM,EACnC,QAAQ,CAAC,SAAS,UAAU;AACtC,oBAAc,QAAQ,IAAI,IAAIE,mBAA+B,KAAK;AAAA,IAAA,CACnE,GACe,iBAAiB,MAAM,MAAM,EACrC,QAAQ,CAAC,QAAQ,UAAU;AACjC,gBAAU,OAAO,IAAI,IAAIC,eAA2B,KAAK;AAAA,IAAA,CAC1D;AACD,UAAM,WAAW;AAAA,MACf,MAAM;AAAA,MACN,MAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA;AAAA,OAEI,SAAS;AAAA,MACb,MAAM;AAAA,MACN,MAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA;AAAA,OAEI,gBAAgB;AAAA,MACpB,GAAG;AAAA,MACH,UAAU;AAAA,QACR;AAAA,UACE,OAAO;AAAA,UACP,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO,CAAC;AAAA,QACV;AAAA,MACF;AAAA,OAEI,kBAAkB;AAAA,MACtB;AAAA,MACA,UAAU;AAAA,QACR;AAAA,UACE,OAAO;AAAA,UACP,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO,CAAC;AAAA,QACV;AAAA,MACF;AAAA,IAAA;AAEiB,WAAA;AAAA,MACjB,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,cAAc;AAAA,MACd,WAAW;AAAA,MACX,SAAS;AAAA,MACT,WAAW;AAAA,MACX,QAAQ;AAAA,QACN,UAAU;AAAA,UACR,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,WAAW;AAAA,UACX,OAAO;AAAA,YACL;AAAA,cACE,MAAM;AAAA,gBACJ,QAAQ;AAAA,gBACR,MAAM;AAAA,gBACN,WAAW;AAAA,gBACX,QAAQ;AAAA,kBACN,MAAM;AAAA,oBACJ,MAAM;AAAA,oBACN,QAAQ;AAAA,oBACR,WAAW;AAAA,oBACX,WAAW;AAAA,oBACX,SAAS;AAAA,oBACT,UAAU,cAAc,UAAU,MAAM,EAAE,IAAI,CAAC,SAAS;AAAA,sBACtD,GAAG;AAAA,sBACH,GAAI,MAAM,WAAW,eAAe,MAAM,aACtC,EAAC,YAAY,MAAM,WAAU,IAC7B,CAAC;AAAA,oBAAA,EACL;AAAA,kBACJ;AAAA,gBACF;AAAA,gBACA,WAAW,gBAAgB,SAAS,CAAC;AAAA,gBACrC,SAAS,cAAc,SAAS,CAAC;AAAA,cACnC;AAAA,cACA,YAAY;AAAA,cACZ,WAAW;AAAA,cACX,SAAS;AAAA,cACT,UAAU;AAAA,YACZ;AAAA,UACF;AAAA,UACA,WAAW,gBAAgB;AAAA,UAC3B,SAAS,cAAc;AAAA,QACzB;AAAA,MACF;AAAA,IAAA;AAAA,EAGJ;AACM,QAAA,IAAI,MAAM,2BAA2B;AAC7C;AAEA,SAAS,cAAc,WAAmB,SAAsC;AACxE,QAAA,WAAgC,CAChC,GAAA,WAAW,kBAAkB,SAAS,WAAW,OAAO,CAAC;AAE3D,MAAA,UAAU,GACV,QAAQ;AACD,aAAA,CAAC,IAAI,IAAI,KAAK;AACvB,YAAQ,IAAI;AAAA,MACV,KAAK;AACH,iBAAS,KAAK;AAAA,UACZ,MAAM;AAAA,UACN,QAAQ;AAAA,UACR;AAAA,QAAA,CACD,GACD,WAAW,KAAK,QAChB,SAAS,KAAK;AACd;AAAA,MACF,KAAK;AACH,iBAAS,KAAK;AAAA,UACZ,MAAM;AAAA,UACN,QAAQ;AAAA,UACR,MAAM,UAAU,UAAU,SAAS,UAAU,KAAK,MAAM;AAAA,UACxD,YAAY;AAAA,QAAA,CACb,GACD,WAAW,KAAK;AAChB;AAAA,MACF,KAAK;AACH,iBAAS,KAAK;AAAA,UACZ,MAAM;AAAA,UACN,QAAQ;AAAA,UACR,MAAM,QAAQ,UAAU,OAAO,QAAQ,KAAK,MAAM;AAAA,UAClD,YAAY;AAAA,QAAA,CACb,GACD,SAAS,KAAK;AACd;AAAA,IAGJ;AAGK,SAAAI;AAAAA,IACL,SAAS,IAAI,CAAC,QAAQ;AACpB,YAAM,cAAmC,CAAA;AACrC,UAAA,IAAI,KAAK,SAAS,GAAG;AACvB,cAAM,cAAc,CAAC,GAAG,IAAI,KAAK,SAAS,YAAY,CAAC;AACvD,YAAI,YAAY;AACJ,oBAAA,QAAQ,CAAC,UAAU;AACvB,gBAAA,QAAQ,MAAM,SAAS;AACzB,kBAAQ,cACV,YAAY,KAAK,EAAC,GAAG,KAAK,MAAM,IAAI,KAAK,UAAU,YAAY,GAAG,KAAK,EAAE,CAAA,GACzE,YAAY,KAAK,EAAC,GAAG,KAAK,MAAM,MAAM,CAAC,EAAC,CAAC,IAEvC,UAAU,YAAY,YAAY,SAAS,CAAC,KAC9C,YAAY,KAAK,EAAC,GAAG,KAAK,MAAM,IAAI,KAAK,UAAU,QAAQ,CAAC,EAAE,CAAA,GAEhE,YAAY;AAAA,QAAA,CACb,GACG,YAAY,WAAW,KACzB,YAAY,KAAK,GAAG;AAAA,MAExB;AACE,oBAAY,KAAK,GAAG;AAEf,aAAA;AAAA,IAAA,CACR;AAAA,EAAA;AAEL;AAEO,SAAS,iBAAiB,MAAwC;AACvE,QAAM,cAAc;AAAA,IAClB,GAAI,KAAK,UAAU,KAAK,QAAQ,SAAS,OAAO,CAAC,QAAa,IAAI,UAAU,MAAM,IAAI,CAAC;AAAA,EAAA;AAKzF,UAHyB,KAAK,YAC1B,KAAK,UAAU,SAAS,OAAO,CAAC,QAAa,IAAI,UAAU,MAAM,IACjE,CAAA,GACa,QAAQ,CAAC,SAAc;AACjC,gBAAY,KAAK,CAAC,QAAQ,KAAK,SAAS,IAAI,IAAI,KACnD,YAAY,KAAK,IAAI;AAAA,EAAA,CAExB,GACM,QAAQ,aAAa,CAAC,MAAM,GAAG,CAAC,KAAK,CAAC;AAC/C;AAEgB,SAAA,sBACd,MACA,OACwB;AAExB,QAAM,YACJ,KAAK,OAAO,YACZ,KAAK,OAAO,SAAS,WAAW,eAChC,KAAK,OAAO,SAAS,SAAS,WAC9B,KAAK,OAAO,SAAS,MAAM;AAAA,IACzB,CAAC,SACC,KAAK,QACL,KAAK,KAAK,SAAS,aAClB,KAAK,KAAK,WAAW,YAClB,KAAK,KAAK,aAAa,KAAK,KAAK,UAAU,SAAS,MAAM,QACzD,KAAK,KAAK,WAAW,KAAK,KAAK,QAAQ,UAAU,MAAM;AAAA,EAAA;AAE9D,MAAA;AACF,WAAO,UAAU;AAGrB;AAEgB,SAAA,mBAAmB,MAAkB,YAA4C;AArYjG,MAAA7C;AAsYE,SACI,KAAK,OAAO,YACZ,KAAK,OAAO,SAAS,aACrB,KAAK,OAAO,SAAS,SAAS,aAC9BA,MAAK,KAAA,OAAO,SAAS,MAAM;AAAA,IACzB,CAAC,SACC,KAAK,QACL,KAAK,KAAK,SAAS,aACjB,KAAK,KAAK,WAAW,KAAK,KAAK,QAAQ,QAAQ,KAAK,KAAK,QAAQ,SAAS,cACzE,KAAK,KAAK,aACT,KAAK,KAAK,UAAU,QACpB,KAAK,KAAK,UAAU,SAAS;AAAA,EAAA,MAPrC,oBAQG,SAAwB;AAEjC;AAEO,SAAS,cAAc,QAAoC;AACxD,SAAA,UAAUf,UAAQ,OAAO,KAAK,MAAM,GAAG,CAAC,QAAQ,OAAO,CAAC,KAAM;AACxE;AAEO,SAAS,aAAa,MAAsB;AAC1C,SAAA,KAAK,QAAQ,4BAA4B,MAAM;AACxD;AAEO,SAAS,eAAe,MAAuC;AACpE,QAAM,UAA+B;AAAA,IACnC,GAAI,KAAK,WAAW,KAAK,QAAQ,WAAW,KAAK,QAAQ,WAAW,CAAC;AAAA,EAAA;AAIvE,UADE,KAAK,aAAa,KAAK,UAAU,WAAW,KAAK,UAAU,WAAW,CAAA,GAChE,QAAQ,CAAC,SAAS;AACnB,YAAQ,KAAK,CAAC,QAAQ,KAAK,SAAS,IAAI,IAAI,KAC/C,QAAQ,KAAK,IAAI;AAAA,EAAA,CAEpB,GACM,QAAQ,SAAS,CAAC,MAAM,GAAG,CAAC,KAAK,CAAC;AAC3C;AChaO,SAAS,iBAAiB,OAAwB;AACvD,QAAM,aAAa,OAAO;AAE1B,MAAI,eAAe,UAAU;AAC3B,QAAI,UAAU;AAAa,aAAA;AACvB,QAAA,MAAM,QAAQ,KAAK;AAAU,aAAA;AACjC,QAAI,iBAAiB,UAAU,MAAM,YAAY,SAAS;AACxD,aAAO,MAAM,YAAY;AAAA,EAE7B;AAEO,SAAA;AACT;ACOgB,SAAA,cAAc,OAAgB,YAAqD;AAC3F,QAAA,EAAC,SAAQ,IAAI,YACb,YAAY,MAAM,QAAQ,KAAK,IAAI,UAAU,OAAO;AAEtD,MAAA,EAAA,UAAU,QAAQ,cAAc,cAIpC;AAAA,QAAI,cAAc;AACT,aAAA;AAAA,QACL,YAAY;AAAA,QACZ;AAAA,QACA,cAAc;AAAA,QACd,YAAY,iBAAiB,KAAK;AAAA,MAAA;AAItC,QAAI,aAAa,UAAU,KAAK,cAAc,KAAK;AACtC,iBAAA,SAAS,WAAW,QAAQ;AACrC,cAAM,aAAa,cAAc,MAAM,MAAM,IAAI,GAAG,MAAM,IAAkB;AACxE,YAAA;AACK,iBAAA;AAAA,MAEX;AAAA,EAAA;AAIJ;AAEA,SAAS,aAAa,YAAwD;AAC5E,SAAO,WAAW,aAAa;AACjC;AAEA,SAAS,cAAc,OAAkD;AAChE,SAAA,UAAU,QAAQ,CAAC,MAAM,QAAQ,KAAK,KAAK,OAAO,SAAU;AACrE;ACtDO,SAASF,SAAa;AAAC;AAGvB,SAAS,cAAc,QAA+C;AAC3E,SAAO,OAAO,SAAS;AACzB;AAGO,SAAS,cAAc,QAA+C;AAC3E,SAAO,OAAO,SAAS;AACzB;AAGO,SAAS,gBACd,MACqD;AAC9C,SAAA,KAAK,KAAK,WAAW;AAC9B;AAGO,SAAS,kBACd,MACuD;AAChD,SAAA,KAAK,KAAK,WAAW;AAC9B;AAGO,SAAS,gBAAgB,MAAkD;AAChF,SAAO,KAAK,WAAW;AACzB;ACpCO,MAAM,gBAAyC,CAAC;ACchD,SAAS,SAAS,EAAC,SAAS,SAAsB;AAErD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,QAAO;AAAA,MACP,SAAQ;AAAA,MACR,OAAM;AAAA,MACN,MAAM,SAAO,OAAA,SAAA,MAAA;AAAA,MAEb,UAAA;AAAA,QAAC,oBAAA,QAAA,EAAK,GAAE,KAAI,GAAE,KAAI,OAAM,MAAK,QAAO,MAAK,IAAG,MAAM,CAAA;AAAA,QACjD,OAAO,UAAY,OACjB,oBAAA,QAAA,EAAK,GAAE,sBAAqB,QAAQ,SAAA,OAAA,SAAA,MAAO,MAAM,aAAY,KAAI;AAAA,QAEnE,+BAAY,QAAK,EAAA,GAAE,wBAAuB,QAAQ,SAAA,OAAA,SAAA,MAAO,MAAM,aAAY,IAAI,CAAA;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGtF;AAEO,SAAS,OAAO,EAAC,SAAS,SAAsB;AAEnD,SAAA,qBAAC,SAAI,OAAM,MAAK,QAAO,MAAK,SAAQ,aAAY,OAAM,8BACpD,UAAA;AAAA,IAAA,oBAAC,QAAK,EAAA,OAAM,MAAK,QAAO,MAAK,IAAG,MAAK,MAAM,UAAU,SAAA,OAAA,SAAA,MAAO,SAAS,SAAA,OAAA,SAAA,MAAO,YAAY;AAAA,IACvF,OAAO,UAAY,OACjB,oBAAA,QAAA,EAAK,GAAE,MAAK,GAAE,KAAI,OAAM,MAAK,QAAO,MAAK,IAAG,KAAI,MAAK,SAAQ;AAAA,IAE/D,WAAW,oBAAC,QAAK,EAAA,GAAE,MAAK,GAAE,KAAI,OAAM,MAAK,QAAO,MAAK,IAAG,KAAI,MAAK,SAAQ;AAAA,IACzE,OAAO,WAAY,aAAa,CAAC,WAChC,oBAAC,UAAK,GAAE,KAAI,GAAE,KAAI,OAAM,MAAK,QAAO,MAAK,IAAG,KAAI,MAAK,SAAQ;AAAA,EAEjE,EAAA,CAAA;AAEJ;AC1CO,MAAM,mBAA+C,CAAC,EAAC,MAAM,iBAAgB;AAC5E,QAAA,EAAC,WAAW,QAAO,IAAI,MACvB,EAAC,OAAO,QAAO,IAAI,YACnB+D,YAAU,mCAAS,YAAW,aAAa,WAAW,QACtD,YAAY,uBAAuB,MAAM,CAAA,CAAE,GAE3C,cAAuC,WAAY;AAGvD,SAAA,qBAAC,MAAK,EAAA,OAAM,UACV,UAAA;AAAA,IAAA,oBAAC,aAAY,EAAA,MACX,UAAC,qBAAA,MAAA,EAAK,OAAM,UACV,UAAA;AAAA,MAAA,oBAACA,UAAQ,EAAA,SAAS,WAAW,OAAO,WAAW;AAAA,MAE9C,eAEG,qBAAA,UAAA,EAAA,UAAA;AAAA,QAAA,oBAAC,KAAI,EAAA,SAAS,GACZ,UAAA,oBAAC,cAAY,CAAA,GACf;AAAA,QACC,oBAAAA,UAAA,EAAQ,SAAS,SAAS,OAAO,WAAW;AAAA,MAAA,GAC/C;AAAA,IAAA,EAAA,CAEJ,EACF,CAAA;AAAA,IAEC,eAAe,SACb,oBAAA,KAAA,EAAI,YAAY,GACf,UAAC,oBAAA9B,QAAA,EAAK,MAAM,GAAG,QAAO,UACnB,gBACH,CAAA,GACF;AAAA,EAEJ,EAAA,CAAA;AAEJ,GCjCM,kBAAkB,OAAO;AAAA;AAAA;AAAA,GAKlB,kBAAiD,SAAyB;AAAA,EACrF;AAAA,EACA;AACF,GAAG;AAEC,SAAA,oBAAC,KAAI,EAAA,IAAI,iBAAiB,UAAU,GAAG,UAAU,GAC9C,UAAA,eAAe,OAAO,UAAU,EACnC,CAAA;AAEJ;AAEA,SAAS,eAAe,OAAe,YAAsC;AAC3E,QAAM,EAAC,SAAS,KAAI,IAAI,YAClB,cAAa,WAAS,OAAA,SAAA,QAAA,eAAc,iBAAiB,qBACrD,cAAa,WAAA,OAAA,SAAA,QAAS,eAAc,iBAAiB;AAE3D,SAAO,iBAAiB;AAAA,IACtB,IAAI,KAAK,KAAK;AAAA,IACd,SAAS,SAAS,aAAa,GAAG,UAAU,IAAI,UAAU;AAAA,EAAA;AAE9D;AC5BO,MAAM,oBAA+C,CAAC,EAAC,MAAM,WAEhE,MAAA;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,OAAM;AAAA,IACN;AAAA,IACA,QAAO;AAAA,IACP,kBAAkB;AAAA,IAClB;AAAA,EAAA;AACF,GCIS,wBAAwB,cAAoD,IAAI;ACRtF,SAAS,oBAAmD;AAC3D,QAAA,iBAAiB,WAAW,qBAAqB;AAEvD,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,uCAAuC;AAGlD,SAAA;AACT;ACXO,SAAS,YACd,OACe;AACT,QAAA,CAAC,OAAO,QAAQ,IAAI,SAAwB,MAAS,GACrD,SAAS,UAAU,6BAA6B;AAEtD,SAAA,UAAU,MAAM;AACd,QAAI,CAAC;AACH;AAGF,UAAM,eAAe,OAAO,WAAW,YAAe,KAAK,EAAE,UAAU,QAAQ;AAE/E,WAAO,MAAM;AACX,mBAAa,YAAY;AAAA,IAAA;AAAA,EAC3B,GACC,CAAC,QAAQ,KAAK,CAAC,GAIX,QAAQ,QAAQ;AACzB;ACbA,MAAM,WAAW,OAAO;AAAA,IACpB,CAAC,EAAC,MAAA,MAAW;AAAA,4BACW,MAAM,OAAO,MAAM,MAAM,SAAS,QAAQ,EAAE;AAAA,4BAC5C,MAAM,OAAO,MAAM,MAAM,SAAS,QAAQ,EAAE;AAAA,GACrE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAcU,gBAAiD,CAAC,EAAC,MAAM,iBAAgB;AACpF,QAAM,EAAC,WAAW,SAAS,OAAU,IAAA,MAC/B,YAAY,aAAA,OAAA,SAAA,UAAW,OACvB,UAAU,WAAS,OAAA,SAAA,QAAA,OACnB,EAAC,GAAAd,GAAA,IAAK,eAAA,GACN,OAAO,YAAuB,aAAA,OAAA,SAAA,UAAW,IAAI,GAC7C,OAAO,YAAuB,WAAS,OAAA,SAAA,QAAA,IAAI,GAC3C,aAAa,iBAAiB,EAAC,aAAa,SAAS,uBAAuB,EAAC,CAAC,GAE9E,gBAAgB,OAAO,QAAQ,MAAM,EACxC,OAAO,CAAC,CAAC,MAAM,KAAK,MAAM,MAAM,aAAa,SAAS,OAAO,EAC7D,IAAI,CAAC,CAAC,IAAI,MAAM,IAAI,GAEjB,iBAAiB,cAAc,SAAS,OAAO,GAE/C,eAAe,WAAW,OAC7B,OAAO,CAAC,UAAU,MAAM,SAAS,WAAW,cAAc,SAAS,MAAM,IAAI,CAAC,EAC9E,IAAI,CAAC,UAAU,MAAM,IAAI,GAEtB,UAAU,YAAY,QAAM,OAAA,SAAA,KAAA,MAAM,QAAM,OAAA,SAAA,KAAA,IAAI,GAC5C,YAAW,QAAM,OAAA,SAAA,KAAA,SAAQ,sBAAsB,KAAK,MAAM,UAAU,GACpE,YAAW,QAAA,OAAA,SAAA,KAAM,SAAQ,sBAAsB,KAAK,MAAM,UAAU,GAEpE6C,cAAa,QAAQ,OAAO,EAAC,SAAS,SAAS,MAAM,EAAC,IAAI,CAAE,CAAA,GAE5DzC,QAAO,QACX,oBAAC,UAAS,EAAA,IAAG,OAAM,MAAY,MAAK,cAAa,OAAOyC,aACtD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAO,KAAK,oBAAoB7C,GAAE,uCAAuC;AAAA,MACzE,MAAM;AAAA,MAEN,UAAA,oBAACc,UAAK,MAAM,GAAG,OAAO,EAAC,OAAO,UAAS,GACpC,UACH,SAAA,CAAA;AAAA,IAAA;AAAA,EAAA,EAEJ,CAAA,GAGI,KAAK,QACR,oBAAA,UAAA,EAAS,IAAG,OAAM,MAAY,MAAK,cAAa,OAAO+B,aACtD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAO,KAAK,oBAAoB7C,GAAE,uCAAuC;AAAA,MACzE,MAAM;AAAA,MAEN,UAAA,qBAAC,MAAK,EAAA,OAAM,UACV,UAAA;AAAA,QAAC,oBAAAc,QAAA,EAAK,MAAM,GAAG,OAAO,EAAC,OAAO,UAAA,GAC3B,UACH,SAAA,CAAA;AAAA,QACC,YAAY,KACV,oBAAA,MAAA,EAAK,QAAQ,GAAG,SAAS,GAAG,IAAI,UAAU,YAAY,GACrD,UAAA,qBAACA,UAAK,MAAM,GAAG,eAAa,UAAU,IAAI,aAAa,YACpD,UAAA;AAAA,UAAA,UAAU,IAAI,MAAM;AAAA,UACpB;AAAA,UAAQ;AAAA,QAAA,EAAA,CACX,EACF,CAAA;AAAA,MAAA,GAEJ;AAAA,IAAA;AAAA,EACF,EAAA,CACF,GAGI,kBAGD,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAQV,SAAA,CAAC,MACR,oBAAC,aAAY,EAAA,MAAY,MAAK,cAAa,aAAaJ,GAAE,uBAAuB,GAC9E,UACHI,MAAA,CAAA;AAAA,IAIDA,SAAQ,MACN,oBAAA,aAAA,EAAY,MAAY,MAAK,cAC5B,UAAA,oBAAC,QAAO,EAAA,MAAAA,OAAY,QAAO,QAAO,GAAQ,CAAA,GAC5C;AAAA,IAID,CAACA,SAAQ,MACR,oBAAC,aAAY,EAAA,MAAY,MAAK,cAAa,aAAaJ,GAAE,qBAAqB,GAC5E,UACH,GAAA,CAAA;AAAA,EAEJ,EAAA,CAAA;AAGF,SAEK,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAkB,kBAAA;AAAA,IAClB,aAAa,SAAS,KACrB,oBAAC,OAAI,WAAW,iBAAiB,IAAI,GACnC,8BAAC,YAAW,EAAA,MAAY,YAAwB,QAAQ,aAAc,CAAA,GACxE;AAAA,EAEJ,EAAA,CAAA;AAEJ;AC9HgB,SAAA,UAAU,KAAa,SAAyB;AAKvD,SAAA,SAJO,4CAA4C,KAAK,GAAG,KAAM,CAAA,GACrE,MAAM,CAAC,EACP,IAAI,CAAC,QAAQ,SAAS,KAAK,EAAE,CAAC,EAC9B,OAAO,OAAO,EACG,KAAK,IAAI,CAAC;AAChC;AAGO,SAAS,WAAW,KAAqB;AAC9C,MAAIuB,QAAO;AAEX,MAAI,IAAI,UAAU;AAChB,WAAOA,MAAK;AAGd,WAAS,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAK;AAC7B,UAAA,OAAO,IAAI,WAAW,CAAC;AAG7B,IAAAA,SAAQA,SAAQ,KAAKA,QAAO,MAG5BA,SAAQA;AAAA,EACV;AAEA,SAAOA,MAAK;AACd;AAEO,SAAS,eAAuB;AACrC,QAAM,OAAO,KAAK,KAAK,OAAO,oBAAoB,CAAC;AACnD,SAAO,KAAK,IAAI,GAAG,KAAK,IAAI,GAAG,IAAI,CAAC;AACtC;AChBO,SAAS,eACdpC,QACA;AACM,QAAA,EAAC,MAAM,MAAM,MAAAoC,OAAM,SAAS,QAAQ,KAAK,SAAS,KAAK,GAAG,UAAa,IAAApC,QACvE,EAAC,GAAAa,GAAC,IAAI,eAAe,GACrB,YAAY,uBAAuB,MAAM,MAAM,GAC/C,eAAe,uBAAuB,MAAM,SAAS;AAGzD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,MAAK;AAAA,MACL;AAAA,MACA;AAAA,MACA,SAAS,OAAO,KAAK,IAAI,MAAM;AAAA,MAE/B,UAAA;AAAA,QAAC,oBAAA,QAAA,EACE,kBAAQ,WACP,qBAAC,UAAK,IAAI,gBAAgBuB,KAAI,IAC5B,UAAA;AAAA,UAAC,oBAAA,QAAA,EAAK,GAAG,GAAG,GAAG,GAAG,OAAc,QAAgB,MAAK,OAAO,CAAA;AAAA,UAC5D;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA,MAAK;AAAA,cACL,QAAQ;AAAA,cACR;AAAA,cACA;AAAA,cACA,QAAO;AAAA,cACP,aAAa;AAAA,YAAA;AAAA,UACf;AAAA,QAAA,EAAA,CACF,EAEJ,CAAA;AAAA,QAEC,QACE,oBAAA,aAAA,EAAY,MAAY,MAAK,QAAO,aAAavB,GAAE,4BAA4B,GAC9E,UAAA,oBAAC,KACC,EAAA,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA,MAAM,UAAU,UAAU,QAAQ,IAAI;AAAA,YACtC,MAAM,UAAU,qBAAqBuB,KAAI,MAAM;AAAA,YAC/C,QAAQ,UAAU;AAAA,YAClB,aAAa;AAAA,YACb;AAAA,YACA;AAAA,UAAA;AAAA,WAEJ,EACF,CAAA;AAAA,QAGD,WACE,oBAAA,aAAA,EAAY,MAAY,MAAK,WAAU,aAAavB,GAAE,4BAA4B,GACjF,UAAA,oBAAC,KACC,EAAA,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA,MAAM,UAAU,aAAa,QAAQ,IAAI;AAAA,YACzC,QAAQ,aAAa;AAAA,YACrB,aAAa;AAAA,YACb;AAAA,YACA;AAAA,UAAA;AAAA,WAEJ,EACF,CAAA;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAIR;AAEA,SAAS,QAAQ;AAAA,EACf;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAGG;AACD,QAAM,YAAY;AAAA,IAChB,GAAG,KAAK,OAAO;AAAA,IACf,GAAG,KAAK,MAAM;AAAA,IACd,QAAQ,IAAI,KAAK,QAAQ,KAAK,QAAQ;AAAA,IACtC,SAAS,IAAI,KAAK,SAAS,KAAK,OAAO;AAAA,EAAA;AAGlC,SAAA,oBAAC,QAAM,EAAA,GAAG,WAAY,GAAG,WAAW,OAAO,EAAC,cAAc,qBAAA,EAAuB,CAAA;AAC1F;AAEA,SAAS,WAAW;AAAA,EAClB;AAAA,EACA,SAAS;AAAA,EACT;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAGG;AACD,QAAM,eAAe;AAAA,IACnB,IAAI,QAAQ,IAAI;AAAA,IAChB,IAAI,QAAQ,IAAI;AAAA,IAChB,IAAK,QAAQ,QAAQ,IAAK,QAAQ;AAAA,IAClC,IAAK,QAAQ,SAAS,IAAK,SAAS;AAAA,EAAA;AAG/B,SAAA,oBAAC,WAAS,EAAA,GAAG,WAAY,GAAG,cAAc,OAAO,EAAC,cAAc,qBAAA,EAAuB,CAAA;AAChG;ACxGA,MAAM,eAAe,CAAC,kBAAkB,GAQ3B,iBAAiB,MAAM;AAC5B,QAAA,EAAC,GAAAA,OAAK;AACZ,SACG,oBAAA,MAAA,EAAK,MAAM,GAAG,MAAK,eAAc,SAAS,GAAG,QAAQ,GAAG,QAAO,WAC9D,8BAAC,MAAK,EAAA,OAAM,UAAS,SAAQ,UAAS,QAAO,QAC3C,UAAA,oBAACc,QAAK,EAAA,MAAM,GAAG,OAAK,IACjB,UAAAd,GAAE,oCAAoC,GACzC,GACF,EACF,CAAA;AAEJ,GAEM,eAAe,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAMN,KAAK,KAAK,GAAG,EAAE,GAAG;AAAA,6CACK,KAAK,KAAK,EAAE,EAAE,GAAG;AAAA,8BAChC,KAAK,KAAK,EAAE,EAAE,GAAG;AAAA,8CACD,KAAK,KAAK,EAAE,EAAE,GAAG;AAAA,+CAChB,KAAK,KAAK,EAAE,EAAE,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAyB1D8C,UAAQ,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAaf,cAAc,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWpB,SAASC,eAAa5D,QAAwC;AAjGrE,MAAAW,KAAA,IAAA,IAAA;AAkGE,QAAM,EAAC,IAAAnB,KAAI,QAAQ,MAAM,SAAS,MAAM,IAAAqE,IAAE,IAAI7D,QACxC,EAAC,GAAAa,OAAK,kBACN,SAAS,UAAU,6BAA6B,GAChD,CAAC,YAAY,aAAa,IAAI,SAAA,GAC9B,EAAC,OAAO,UAAS,kBAAgCrB,KAAI,YAAY,GACjE,aAAa,mBAAmBA,GAAE,GAClC,eAAe,QAAQ,MAAM,gBAAgB,MAAM,GAAG,CAAC,MAAM,CAAC,GAG9D,iBAAiB,UAAU,MAE3B,QAAQ,SAAS,MAAM,kBACvB,cAAc,aACjB,MAAMA,GAAE,EACR,OAAO,GAAG,EACV,IAAI,aAAc,CAAA,EAClB,IAAI,KAAK,GAEN,iBAAe,MAAAmB,MAAA,KAAK,cAAL,OAAA,SAAAA,IAAgB,UAAhB,OAAuB,SAAA,GAAA,YAAS,gBAAK,YAAL,OAAA,SAAA,GAAc,UAAd,OAAqB,SAAA,GAAA;AAEtE,MAAA;AACA,YAAU,WAAW,cACvB,cAAcE,GAAE,WAAW,UAAU,wBAAwB,uBAAuB;AAGhF,QAAA,aAAa,WAAW,YAAY,SAAY;AAEtD,8BACG,MAAK,EAAA,WAAU,UAAS,QAAO,QAAO,MAAM,GAC3C,UAAA;AAAA,IAAA,oBAAC,OAAI,MAAM,GAAG,SAAS,GAAG,eAAe,GACvC,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAI;AAAA,QACJ,WAAU;AAAA,QACV,gBAAcgD,QAAO,UAAU,eAAe,KAAK;AAAA,QACnD,cAAY,aAAa,KAAK;AAAA,QAE7B,UAAA;AAAA,UAAC,CAAA,kBAAkB,CAAC,cACnB;AAAA,YAACF;AAAAA,YAAA;AAAA,cACC,KAAK,YAAY,SAAA,KAAc;AAAA,cAC/B,KAAK;AAAA,cACL,eAAa;AAAA,cACb,SAAS;AAAA,cACT,OAAO,WAAW;AAAA,cAClB,QAAQ,WAAW;AAAA,YAAA;AAAA,UACrB;AAAA,WAGA,kBAAkB,eAClB,oBAAC,OAAI,UAAU,GACb,8BAAChC,QAAK,EAAA,MAAM,GAAG,OAAK,IAAC,OAAM,UACxB,UAAAd,GAAE,iBAAiB,0BAA0B,mCAAmC,GACnF,EACF,CAAA;AAAA,8BAGD,aACC,EAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAM,QAAQ,CAAC,cAAc,IAAI,IAAI,OAAO;AAAA,cAC5C;AAAA,cACA,MAAM,WAAW,GAAG,YAAY,SAAc,KAAA,EAAE,IAAIgD,GAAE,EAAE;AAAA,cACxD,SAAS,WAAW,CAAC,iBAAiB,OAAO,IAAI,UAAU;AAAA,cAC3D,OAAO,WAAW;AAAA,cAClB,QAAQ,WAAW;AAAA,YAAA;AAAA,UAAA,GAEvB;AAAA,QAAA;AAAA,MAAA;AAAA,IAAA,GAEJ;AAAA,IAEA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAO,SAAShD,GAAE,wCAAwC;AAAA,QAC1D,MAAM;AAAA,QACN,aAAa,gBAAgBgD,QAAO;AAAA,QAEnC,wBACE,oBAAA,OAAA,EAAK,UAAY,YAAA,CAAA,yBAEjB,OACE,EAAA,UAAA;AAAA,UAAW,WAAA;AAAA,UAAM;AAAA,UAAI,WAAW;AAAA,QAAA,GACnC;AAAA,MAAA;AAAA,IAEJ;AAAA,EACF,EAAA,CAAA;AAEJ;AC5KA,MAAM,oBAAoB,CAAC,QAAQ,SAAS,GACtC,oBAAoB,CAAC,SAAS,GAAG,iBAAiB,GAElD,cAAc;AAAA,EAClB,MAAM;AACR,GAEa,iBAAmD,CAAC,EAAC,MAAM,iBAAgB;AAhBxF,MAAAlD,KAAA;AAiBE,QAAM,EAAC,GAAAE,GAAA,IAAK,eAAA,GAEN,EAAC,WAAW,SAAS,QAAQ,cAAa,MAC1C,WAAUF,MAAA,aAAA,OAAA,SAAA,UAAW,UAAX,OAAkB,SAAAA,IAAA,MAC5B,SAAQ,KAAA,WAAA,OAAA,SAAA,QAAS,UAAT,OAAA,SAAA,GAAgB,MACxB,kBAAkB,oBAAoB,MAAM,CAAC,SAAS,MAAM,CAAC,GAG7D,gBAAgB,OAAO,KAAK,MAAM,EAAE;AAAA,IACxC,CAAC,SAAS,OAAO,IAAI,EAAE,aAAa,SAAS;AAAA,EAAA,GAGzC,eAAe,WAAW,OAC7B;AAAA,IACC,CAAC,UAAU,CAAC,kBAAkB,SAAS,MAAM,IAAI,KAAK,cAAc,SAAS,MAAM,IAAI;AAAA,EAExF,EAAA,IAAI,CAAC,UAAU,MAAM,IAAI;AAE5B,MAAI,cAA+C;AAC/C,GAAC,WAAW,QACd,cAAc,UACL,CAAC,SAAS,YACnB,cAAc;AAGhB,QAAM,iBAAiB,cAAc,SAAS,OAAO,GAC/C,gBAAgB,cAAc,SAAS,MAAM,GAC7C,mBAAmB,cAAc,SAAS,SAAS,GACnD,gBAAgB,iBAAiB,kBACjC,gBAAgB,kBAAkB,eAClC,iBAAiB,iBAAiB,CAAC,gBAEnCM,QACJ,aAAa,UACV,oBAAA,UAAA,EAAS,YAAY,iBAAiB,OAAO,aAC5C,UAAA;AAAA,IAAC2C;AAAAA,IAAA;AAAA,MACC,IAAG;AAAA,MACH,IAAI;AAAA,MACJ;AAAA,MACA,QAAQ;AAAA,MACR,SAAS,kBAAkB,mBAAmB,UAAU,UAAU;AAAA,MAClE,MAAM,kBAAkB,gBAAgB,UAAU,OAAO;AAAA,IAAA;AAAA,EAAA,EAE7D,CAAA,IAEC,oBAAA,gBAAA,CAAA,CAAe,GAGd,KACJ,WAAW,QACR,oBAAA,UAAA,EAAS,YAAY,iBAAiB,OAAO,aAC5C,UAAA;AAAA,IAACA;AAAAA,IAAA;AAAA,MACC,IAAG;AAAA,MACH,IAAI;AAAA,MACJ;AAAA,MACA,SAAS,kBAAkB,mBAAmB,QAAQ,UAAU;AAAA,MAChE,MAAM,kBAAkB,gBAAgB,QAAQ,OAAO;AAAA,IAAA;AAAA,EACzD,EAAA,CACF,IAEA,oBAAC,gBAAe,CAAA,CAAA;AAGhB,MAAA,CAAC3C,SAAQ,CAAC;AACZ,+BACG,MAAK,EAAA,SAAS,GAAG,QAAQ,GAAG,MAAK,eAChC,UAAA,oBAACU,UAAK,OAAK,IAAC,MAAM,GAAG,OAAM,UACxB,UAAEd,GAAA,4BAA4B,EACjC,CAAA,EACF,CAAA;AAIJ,MAAI,CAAC;AACH,WAAO,QACL,oBAAC,UAAS,EAAA,YAAY,iBAAiB,OAAO,aAC5C,UAAC,oBAAA+C,gBAAA,EAAa,IAAI,OAAO,IAAG,MAAK,KAAY,CAAA,GAC/C,IACE;AAGA,QAAA,gCAAa,QAAO,EAAA,OAAM,UAAS,MAAA3C,OAAY,QAAO,QAAO,GAAQ,CAAA;AAE3E,SAEK,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,kBACE,iBACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,aAAa,kBAAkB,CAAC,eAAe,IAAI,CAAC;AAAA,QACpD,aAAa,qBAAqB,aAAaJ,EAAC;AAAA,QAE/C,UAAA;AAAA,MAAA;AAAA,IAGH,IAAA;AAAA,IAEH,aAAa,SAAS,KACrB,oBAAC,OAAI,WAAW,gBAAgB,IAAI,GAClC,8BAAC,YAAW,EAAA,MAAY,YAAwB,QAAQ,aAAc,CAAA,GACxE;AAAA,EAEJ,EAAA,CAAA;AAEJ;AAEA,SAAS,qBAAqB,QAAyCA,IAAsB;AAC3F,UAAQ,QAAQ;AAAA,IACd,KAAK;AACH,aAAOA,GAAE,uBAAuB;AAAA,IAClC,KAAK;AACH,aAAOA,GAAE,qBAAqB;AAAA,IAChC,KAAK;AACH,aAAOA,GAAE,uBAAuB;AAAA,IAClC;AAES,aAAA;AAAA,EACX;AACF;ACjIA,MAAM,gBAAgB,OAAO;AAAA;AAAA;AAAA,GAKhB,gBAA+C,CAACb,WAAU;AAC/D,QAAA,EAAC,MAAS,IAAAA;AAGd,SAAA,oBAAC,OAAI,IAAI,eAAe,UAAU,GAAG,UAAU,GAC5C,UACH,MAAA,CAAA;AAEJ,GCda,kBAA6C,CAAC,EAAC,MAAM,WAE9D,MAAA;AAAA,EAAC;AAAA,EAAA;AAAA,IACC;AAAA,IACA;AAAA,IACA,kBAAkB;AAAA,IAClB,QAAO;AAAA,EAAA;AACT,GCRS,YAAY,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAWtB,aAAa,OAAO2B,MAAI;AAAA;AAAA;AAAA;AAAA;AAAA,GAOxBmC,qBAAmB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA,MAKpC,SAAS;AAAA;AAAA;AAAA;AAAA,GAMFC,qBAAmB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA,GCDpC,oBAAoB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAoBrBD,kBAAgB;AAAA;AAAA;AAAA;AAKrB,SAASE,aAAW;AAAA,EACzB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAAoB;AACZ,QAAA,EAAC,GAAAnD,OAAK;AACZ,SAAK,aAOD,QAAQ,KAAK,WAAW,cAExB;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MAEC;AAAA,IAAA;AAAA,EACH,IAGI,oBAAA,mBAAA,EAAmB,SAAS,CAAA,IAlB/B,oBAAA,mBAAA,EAAmB,GAAG,WACpB,UAAEA,GAAA,sDAAsD,EAC3D,CAAA;AAiBN;AAUA,SAAS,oBAAoB;AAAA,EAC3B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAA6B;AAC3B,QAAM,EAAC,WAAA,IAAc,WAAW,gBAAgB,GAC1C,EAAC,MAAM,SAAQ,IAAI,WAAW,WAAW,GACzC,CAAC,gBAAgB,iBAAiB,IAAI,SAAgC,IAAI,GAC1E,EAAC,GAAAA,GAAK,IAAA,eAAA,GACN,QAAQ,uBAAuB,MAAM,EAAE,GACvC,QAAQ;AAAA,IACZ,MAAO,QAAQ,EAAC,YAAY,MAAM,YAAY,OAAO,MAAM,KAAI,IAAI,CAAC;AAAA,IACpE,CAAC,KAAK;AAAA,EAAA,GAEF,YAAY,KAAK,WAAW,WAC5B,CAAC,MAAM,OAAO,IAAI,SAAS,EAAK,GAChC,cAAc,UAAU,cAAc,MAAM,GAC5C,cAAc;AAAA,IAClB,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC,YAAY,EAAC,MAAM,OAAO,KAAK,CAAA,CAAC;AAAA,IACxD,CAAC,OAAO,MAAM,IAAI;AAAA,KAEd,SAAS;AAAA,IACb,MACE,SAAS;AAAA,MACP;AAAA,MACA,SAAS,UAAU,CAAC,QAAQ,aAAa,GAAG,KAAK,IAAI,SAAS,OAAO,IAAI;AAAA,IAC3E;AAAA,IACF,CAAC,UAAU,OAAO,IAAI;AAAA,EAElB,GAAA,iBAAiB,QAAQ,MAAM,OAAO,OAAO,IAAI,GAAG,CAAC,MAAM,MAAM,CAAC,GAClE,SAAS,QAAQ,MAAM,OAAO,OAAO,WAAW,GAAG,CAAC,aAAa,MAAM,CAAC,GACxE,UAAU,SAAS,SAAS,MAAM,CAAC,IACnCf,UAASD,uBACT,YAAY;AAAA,IAChB,MAAMC,QAAO,OAAO,CAAC,CAAC,CAAC,MAAM,EAAE,WAAW,OAAO,CAAC,EAAE,SAAS;AAAA,IAC7D,CAAC,SAASA,OAAM;AAAA,EAAA;AAGlB,YAAU,MAAM;AACV,KAAC,QAAQ,cACX,QAAQ,EAAI,GACZ,WAAW,MAAM;AAAA,KAElB,CAAC,WAAW,QAAQ,YAAY,IAAI,CAAC;AAExC,QAAM,kBAAkB;AAAA,IACtB,CAAC,UAA6D;AAC5D,YAAM,mBACN,QAAQ,EAAI,GACP,cACH,MAAM,eAAA,GACN,WAAW,cAAc,GACzB,WAAW,MAAM,WAAW,MAAM,GAAG,EAAE;AAAA,IAE3C;AAAA,IACA,CAAC,gBAAgB,WAAW,QAAQ,UAAU;AAAA,EAAA,GAG1C,qBAAqB,YAAY,MAAM;AACtC,iBACH,QAAQ,EAAK;AAAA,EAAA,GAEd,CAAC,SAAS,CAAC;AAEE,kBAAA,oBAAoB,CAAC,cAAc,CAAC;AAEpD,QAAM,aAAc,KAAK,WAAW,eAAe,KAAK,cAAe,MACjE,cAAc,QAAQ,MAAO,aAAa,CAAC,UAAU,IAAI,CAAA,GAAK,CAAC,UAAU,CAAC,GAE1E,iBACJ,oBAAC,YAAY,UAAZ,EAAqB,OAAO,EAAC,MAAM,OAAA,GAClC,UAAC,oBAAAiE,oBAAA,EAAiB,SAAS,GACzB,+BAAC,OACE,EAAA,UAAA;AAAA,IACC,eAAA,oBAACpC,UAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAAd,GAAE,iDAAiD;AAAA,MAClD,gBAAgB,WAAW,SAAS,WAAW;AAAA,IAChD,CAAA,GACH;AAAA,IAED,CAAC,eAAgB,oBAAA,YAAA,EAAW,MAAY,WAAwB,CAAA;AAAA,EAAA,GACnE,GACF,EACF,CAAA;AAIA,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,SAAS;AAAA,MACT;AAAA,MACA,gBAAa;AAAA,MACb,gBAAc,KAAK,WAAW,YAAY,KAAK;AAAA,MAE/C,UAAC,oBAAA,SAAA,EAAQ,SAAS,gBAAgB,MAAY,KAAK,mBAAmB,QAAM,IAC1E,UAAA,oBAACiD,oBAAiB,EAAA,aAAa,GAC7B,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA,aAAajD,GAAE,oCAAoC,EAAC,SAAS,KAAK,QAAO;AAAA,UAEzE,+BAAC,WAAU,EAAA,OAAO,EAAC,SAAS,cAC1B,GAAA,UAAA;AAAA,YAAA,oBAAC,UAAM,UAAS;AAAA,YACf,oBAAA,MAAA,EAAK,OAAM,UAAS,UAAU,GAC7B,UAAC,oBAAA,YAAA,EAAW,MAAM,GAChB,UAAC,oBAAA,iBAAA,CAAgB,CAAA,EACnB,CAAA,GACF;AAAA,UAAA,GACF;AAAA,QAAA;AAAA,SAEJ,EACF,CAAA;AAAA,IAAA;AAAA,EAAA;AAGN;ACjNA,MAAM,QAAQ,OAAO;AAAA;AAAA;AAIL,SAAA,WAAW,EAAC,YAA+C;AACzE,SACG,oBAAA,OAAA,EACC,UAAC,oBAAA,OAAA,EAAO,UAAS,EACnB,CAAA;AAEJ;ACTA,MAAM,eAAmD;AAAA,EACvD,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AACN,GAEM,gBAAgB,OAAO,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAa7B,SAASoD,SAAO,EAAC,OAAO,YAA8D;AAC3F,6BAAQ,eAAc,EAAA,MAAM,aAAa,KAAK,GAAI,SAAS,CAAA;AAC7D;ACxBA,MAAM,kBAAkB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAOf,SAAA,UAAU,EAAC,YAA+C;AACjE,SAAA,oBAAC,mBAAiB,SAAS,CAAA;AACpC;ACAA,MAAM,aAAmB,CAAA;AAElB,SAAS,MAAMjE,QAIN;AAnBhB,MAAAW,KAAA,IAAA;AAoBE,QAAM,EAAC,MAAM,OAAO,SAAA,IAAYX,QAC1B,QAAQ,uBAAuB,MAAM,UAAU,GAC/C,EAAC,MAAM,SAAQ,IAAI,WAAW,WAAW,GACzC,EAAC,WAAU,IAAI,WAAW,gBAAgB,GAC1C,EAAC,GAAAa,GAAK,IAAA,eAAA,GACN,YAAY,KAAK,WAAW;AAClC,MAAI,WAAW;AAEf,QAAM,cAAc;AAAA,IAClB,CAAC,UAA6D;AAC5D,YAAM,gBAAgB,GAEjB,aACH,WAAW,QAAQ;AAAA,IAEvB;AAAA,IACA,CAAC,UAAU,WAAW,UAAU;AAAA,EAAA;AAG9B,QAAM,UAAU,eAClB,WAAW,oBAAC,cAAY,UAAS,SAAA,CAAA,IACxB,MAAM,SAAS,SAAS,KAAK,IACtC,WAAW,oBAACoD,UAAO,EAAA,OAAO,MAAM,OAAQ,oBAAS,IAEjD,WAAY,oBAAA,WAAA,EAAW,UAAS,SAAA,CAAA;AAG9B,MAAA;AAEJ,MACE,KAAK,OAAO,WAAW,aACvB,KAAK,OAAO,OAAO,SACnB,KAAK,OAAO,OAAO,MAAM,WAAW,aACpC,KAAK,OAAO,OAAO,MAAM,YACzB;AACA,iBAAY,MAAMtD,MAAA,QAAA,OAAA,SAAA,KAAA,WAAN,OAAc,SAAAA,IAAA,cAAd,OAAyB,SAAA,GAAA;AAE/B,UAAA,QAAQ,QAAQ,EAAC,YAAY,MAAM,YAAY,OAAO,MAAM,KAAI,IAAI;AAGxE,eAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,QAAM;AAAA,QACN,QAAQ;AAAA,QACR,OAAO,EAAC,aAAa,SAAQ;AAAA,QAC7B,qBAAmB,KAAK;AAAA,QACxB,mBAAiB,sBAAsB,aAAa,WAAW;AAAA,QAE/D,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,aAAa,EAAC,KAAA,KAAK,OAAO,OAAO,UAAnB,mBAA0B,UAAU;AAAA,cAClD,MAAM,KAAK,OAAO,OAAO;AAAA,cAEzB,UAAC,oBAAAgB,QAAA,EAAK,MAAM,GACT,UAAEd,GAAA,6CAA6C,EAAC,WAAW,SAAS,MAAM,MAAK,CAAC,EACnF,CAAA;AAAA,YAAA;AAAA,UACF;AAAA,UACA,oBAAC,KAAI,EAAA,OAAe,UAAS,SAAA,CAAA;AAAA,QAAA,GAC/B;AAAA,MAAA;AAAA,IAAA;AAAA,EAGN;AAGE,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,0BAAwB,KAAK;AAAA,MAC7B,mBAAiB,sBAAsB,aAAa,WAAW;AAAA,MAE9D,UAAA;AAAA,IAAA;AAAA,EAAA;AAGP;AC1FA,MAAM,mBAAmB,OAAO;AAAA;AAAA,IAE5B,CAAC,EAAC,OAAO,iBAAgB;AACzB,UAAQ,YAAY;AAAA,IAClB,KAAK;AACI,aAAA;AAAA,IACT,KAAK;AACI,aAAA;AAAA,IACT,KAAK;AACI,aAAA;AAAA,IACT,KAAK;AACI,aAAA;AAAA,IACT,KAAK;AACI,aAAA;AAAA,IACT,KAAK;AACI,aAAA;AAAA,yBACU,MAAM,OAAO,MAAM,KAAK,MAAM;AAAA,wBAC/B,MAAM,OAAO,MAAM,MAAM,QAAQ,QAAQ,EAAE;AAAA;AAAA,IAE7D;AACS,aAAA;AAAA,EACX;AACF,CAAC;AAAA;AAGI,SAASqD,YAAU,EAAC,MAAM,YAAkD;AACjF,SAAQ,oBAAA,kBAAA,EAAiB,YAAY,MAAO,SAAS,CAAA;AACvD;ACAA,MAAM,sBAAsB,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAWjC,SAAS;AAAA;AAAA;AAAA;AAAA;AAMR,SAASC,eAAa,EAAC,MAAM,QAAQ,YAAY,GAAG,aAA+B;AAClF,QAAA,EAAC,GAAAtD,OAAK;AACZ,SAAK,aAQD,OAEA,oBAAC,sBAAsB,EAAA,GAAG,WAAW,MAAY,QAAgB,WAAwB,CAAA,wBAK1F,qBACC,EAAA,UAAA,oBAAC,SAAQ,EAAA,YAAwB,OAAO,QAAQ,QAAO,UAAS,EAAA,CAClE,IAfG,oBAAA,qBAAA,EAAqB,GAAG,WAAW,QAAM,IAAC,QAAQ,GAChD,UAAAA,GAAE,2DAA2D,EAAC,YAAY,OAAO,OAAM,EAC1F,CAAA;AAeN;AASA,SAAS,qBAAqB;AAAA,EAC5B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAA8B;AACtB,QAAA,EAAC,MAAM,aAAY,WAAW,WAAW,GACzC,EAAC,WAAU,IAAI,WAAW,gBAAgB,GAC1C,EAAC,GAAAA,GAAA,IAAK,eAAA,GACN,QAAQ,uBAAuB,MAAM,CAAA,CAAE,GACvC,QAAQ;AAAA,IACZ,MAAO,QAAQ,EAAC,YAAY,MAAM,YAAY,OAAO,MAAM,KAAI,IAAI,CAAC;AAAA,IACpE,CAAC,KAAK;AAAA,EAAA,GAEF,CAAC,MAAM,OAAO,IAAI,SAAS,EAAK,GAChC,cAAc,UAAU,cAAc,MAAM,GAC5C,YAAY,KAAK,WAAW,WAK5B,SAJS,SAAS;AAAA,IACtB;AAAA,IACA,SAAS,UAAU,CAAC,QAAQ,aAAa,GAAG,KAAK,IAAI,SAAS,OAAO,IAAI;AAAA,EAAA,EAErD,OAAO,IAAI,GAC3B,UAAU,SAAS,SAAS,MAAM,CAAC,IAEnC,YADShB,oBAAkB,EACR,OAAO,CAAC,CAAC,CAAC,MAAM,EAAE,WAAW,OAAO,CAAC,EAAE,SAAS,GAEnE,YAAY,SAAS,MAAM,GAAG,EAAE,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,gBAAgB,CAAC;AAE9E,YAAU,MAAM;AACV,kBACF,QAAQ,EAAI,GACZ,WAAW,SAAS;AAAA,EAErB,GAAA,CAAC,WAAW,WAAW,UAAU,CAAC;AAErC,QAAM,kBAAkB;AAAA,IACtB,CAAC,UAA6D;AAG5D,UAFA,MAAM,mBACN,QAAQ,EAAI,GACR,CAAC,WAAW;AACd,mBAAW,SAAS;AACpB;AAAA,MACF;AACA,YAAM,eAAe;AAAA,IACvB;AAAA,IACA,CAAC,WAAW,WAAW,UAAU;AAAA,EAAA,GAG7B,cAAc,YAAY,MAAM;AACpC,YAAQ,EAAK;AAAA,EACZ,GAAA,EAAE,GAEC,iBACJ,oBAAC,YAAY,UAAZ,EAAqB,OAAO,EAAC,MAAM,OAClC,GAAA,UAAA;AAAA,IAACuE;AAAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA,SAAS;AAAA,MACT;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA,GAGI,aAAc,KAAK,WAAW,eAAe,KAAK,cAAe,MACjE,cAAc,aAAa,CAAC,UAAU,IAAI,CAAA;AAG9C,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,SAAS;AAAA,MACT;AAAA,MACA,gBAAc,KAAK,WAAW,YAAY,KAAK;AAAA,MAC/C,QAAM;AAAA,MACN,QAAQ;AAAA,MAER,UAAA,oBAAC,WAAQ,SAAS,gBAAgB,MAAY,QAAM,IAClD,8BAACN,oBACC,EAAA,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA,aAAajD,GAAE,uCAAuC,EAAC,SAAS,KAAK,QAAO;AAAA,UAE5E,+BAAC,WACC,EAAA,UAAA;AAAA,YAAA,oBAAC,SAAQ,EAAA,YAAwB,OAAO,QAAQ,QAAO,UAAS;AAAA,YAC/D,oBAAA,MAAA,EAAK,OAAM,UAAS,UAAU,GAC7B,UAAC,oBAAA,YAAA,EAAW,MAAM,GAChB,UAAC,oBAAA,iBAAA,CAAgB,CAAA,EACnB,CAAA,GACF;AAAA,UAAA,GACF;AAAA,QAAA;AAAA,SAEJ,EACF,CAAA;AAAA,IAAA;AAAA,EAAA;AAGN;AAEA,SAASuD,iBAAe;AAAA,EACtB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAKG;AACK,QAAA,EAAC,GAAAvD,OAAK,kBACN,CAAC,gBAAgB,iBAAiB,IAAI,SAAgC,IAAI;AAEhE,SAAA,gBAAA,SAAS,CAAC,cAAc,CAAC,wBAGtCkD,oBAAiB,EAAA,KAAK,mBAAmB,SAAS,GAChD,UAAA;AAAA,IACC,eAAA,oBAACpC,UAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAAd,GAAE,6CAA6C;AAAA,MAC9C,kBAAkB,WAAW,SAAS,WAAW;AAAA,IAClD,CAAA,GACH;AAAA,IAED,CAAC,eAAgB,oBAAA,YAAA,EAAW,MAAY,WAAwB,CAAA;AAAA,EACnE,EAAA,CAAA;AAEJ;ACxLO,SAAS,KAAK;AAAA,EACnB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAA4D;AAC1D,QAAM,mBAAmB,QAAQ;AAGjC,SADE,oBAAoB,iBAAiB,WAAW,eAAe,QAAQ,WAAW,cAG/E,oBAAA,cAAA,EAAc,GAAG,WAAW,WAAsB,MAAY,SAAkB,MAC9E,UACH,IAGG,oBAAC,aAAW,SAAS,CAAA;AAC9B;AAEgB,SAAA,aAAa,EAAC,MAAM,WAAW,UAAU,MAAM,SAAS,GAAG,aAAuB;AAChG,QAAM,EAAC,WAAU,IAAI,WAAW,gBAAgB,GAC1C,EAAC,MAAM,SAAQ,IAAI,WAAW,WAAW,GACzC,cAAc,QAAQ,MAAM,KAAK,MAAM,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,GACxD,EAAC,GAAAA,OAAK,kBACN,YAAY,QAAQ,KAAK,WAAW,WAOpC,YANS,SAAS;AAAA,IACtB;AAAA,IACA,SAAS;AAAA,MACP,CAAC,QAAQ,aAAa,GAAG,KAAK,aAAa,WAAW,KAAK,IAAI,SAAS,YAAY;AAAA,IACtF;AAAA,EAEuB,EAAA,OAAO,IAAI,GAE9B,cAAc;AAAA,IAClB,CAAC,UAA0B;AACzB,YAAM,gBACD,GAAA,cACH,MAAM,kBACN,WAAW,SAAS;AAAA,IAExB;AAAA,IACA,CAAC,WAAW,WAAW,UAAU;AAAA,EACnC,GAGM,mBAFU,QAAQ,KAAK,SAAS,KAAK,CAAC,SAAS,KAAK,SAAS,QAAQ,IAAI,KAE3C,QAAQ,WACtC,aACH,oBAAoB,iBAAiB,WAAW,eAAe,iBAAiB,cACjF,MAEI,WACJ,cAAc,QAAQ,WAAW,cAC/B;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,IAAI,QAAQ,WAAW,YAAY,QAAQ;AAAA,MAC3C,SAAS,EAAC,aAAaA,GAAE,8BAA8B,EAAC,SAAS,QAAQ,OAAM,CAAC,EAAC;AAAA,MAEhF;AAAA,IAAA;AAAA,EAED,IAAA;AAEN,SACG,oBAAA,WAAA,EAAW,GAAG,WAAW,SAAS,aAAa,gBAAa,IAC3D,UAAA,oBAAC,QACC,EAAA,UAAA,oBAAA,UAAA,EAAG,UAAY,YAAA,SAAS,CAAA,GAC1B,EACF,CAAA;AAEJ;AClDA,MAAM,wBAAwBoC,kBAA8B,IAAI,CAACC,SAAQA,KAAI,CAAC,CAAC,GACzE,sBAAsBD,kBAA8B,IAAI,CAACC,SAAQA,KAAI,CAAC,CAAC,GACvE,yBAAyBC,mBAA+B,IAAI,CAACD,SAAQA,KAAI,CAAC,CAAC,GAC3E,uBAAuBC,mBAA+B,IAAI,CAACD,SAAQA,KAAI,CAAC,CAAC,GAEzE,kBAAkB,sBAAsB,OAAO,sBAAsB,GACrE,gBAAgB,oBAAoB,OAAO,oBAAoB,GAE/D,sBAAsB,sBAAsB,OAAO,mBAAmB,GACtE,YAAY,IAAI,OAAO,GAAG,oBAAoB,OAAO,aAAa,EAAE,KAAK,GAAG,CAAC,IAAI,GAAG;AAOnF,SAAS,aAAalD,QAA2B;AACtD,QAAM,EAAC,MAAM,WAAc,IAAAA,QACrB,QAAS,KAAK,OAAO,WAAW,KAAK,OAAO,WAC5C,EAAC,GAAAa,GAAK,IAAA,eAAA,GAEN,gBAAgB;AAAA,IACpB,MAAO,KAAK,OAAO,UAAU,iBAAiB,KAAK,MAAM,IAAI,CAAC;AAAA,IAC9D,CAAC,KAAK,MAAM;AAAA,KAGR,cAAc;AAAA,IAClB,CAAC,gBAAmC;AAClC,YAAM,iBAAiB,mBAAmB,WAAW,QAAQ,WAAW;AACxE,UAAI,iBAAmD,CAAA;AACvD,UAAI,gBAAgB;AAClB,yBAAiB,cAAc,cAAc;AAC7C,cAAM,eAAe,KAAK,OAAO,UAC3B,WACH,aAAa,MAAM,CAAC,EAAE,QACrB,aAAa,MAAM,CAAC,EAAE,KAAK,SAAS,YACpC,aAAa,MAAM,CAAC,EAAE,KAAK,OAAO,KAAK,SAAS,YAChD,aAAa,MAAM,CAAC,EAAE,KAAK,OAAO,KAAK,YACzC,CAAA,GACI,mBAAgC,CAAC,GACjC,qBAAkD;AAGtD,YAAA,kBAAkB,OAAO,IAAI,MAC5B,KAAK,OAAO,WAAW,WAAW,KAAK,OAAO,WAAW,YAC1D;AACM,gBAAA,WAAW,cAAc,KAAK,QAAQ,MAAM,SAAS,CAAC,CAAC,KAAK,KAAK;AACnE,cAAA,YAAY,SAAS,WAAW;AAEhC,mBAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,YAAY,SAAS;AAAA,gBACrB,IAAI,SAAS,WAAW,YAAY,QAAQ;AAAA,gBAE5C,SAAS;AAAA,kBACP,aAAaA,GAAE,oCAAoC,EAAC,SAAS,SAAS,QAAO;AAAA,gBAC/E;AAAA,gBAEA,UAAA,oBAAC,QAAM,EAAA,UAAAwD,mBAA+B,CAAA;AAAA,cAAA;AAAA,cALjC,eAAe,MAAM,IAAI;AAAA,YAAA;AAAA,QAStC;AAEI,YAAA,eAAe,IACf,WAAW;AACf,cAAM,oBAAoF,CAAA;AACtF,YAAA;AAGE,cAAA,cAAc,eAAe,KAAK,MAAM;AACrC,eAAA,SAAA,QAAQ,CAAC,QAAQ;AA3GlC,cAAA1D,KAAA,IAAA;AA4GU;AACM,gBAAA,WAAWyC,eAA2B,SAAS,IAAI,IAAI,GACvD,cAAc,gBAAgB,SAAS,IAAI,IAAI,GAC/C,YAAY,cAAc,SAAS,IAAI,IAAI,GAC3C,eAAe,IAAI,SAASC,cAC5B,YAAY,IAAI,WAAW;AAC7B,cAAA;AACG,yBACH;AAAA,mBAGO,eAAe,WAAW;AACnC,gBAAI,eAAe,uBAAuB,SAAS,IAAI,IAAI,GAAG;AAC5D,oBAAM,SAAS,YAAY,uBAAuB,QAAQ,IAAI,IAAI,CAAC;AAC/D,wBACF,kBAAkB,KAAK;AAAA,gBACrB,MAAM,OAAO;AAAA,gBACb,SAAS;AAAA,kBACP,IAAI;AAAA,kBACJ,qBAAqB,uBAAuB,QAAQ,IAAI,IAAI,CAAC;AAAA,gBAC/D;AAAA,gBACA;AAAA,cAAA,CACD;AAAA,YAEL;AACI,yBAAa,qBAAqB,SAAS,IAAI,IAAI,MACrD,kBAAkB,kBAAkB,IAAI;AAAA,qBAGjC,UAAU;AAEnB,kBAAM,gBAAgBD,eAA2B,UAAU,CAAC,QAAQ,QAAQ,IAAI,IAAI,GAC9E,OAAMzC,oBAAc,aAAa,MAA3B,oBAA8B,MACpC,cAAc,cAAc,aAAa;AAC/C,gBAAI,KAAK;AACD,oBAAA,mBAAmB,mBAAmB,WAAW,QAAQ,WAAW,GACpE,aAAa,cAAc,KAAK,QAAQ,WAAW;AACxC,+BAAA;AAAA,gBACf;AAAA,kBAACwD;AAAAA,kBAAA;AAAA,oBAEC,QAAQ;AAAA,oBACR,MAAM,CAAC,EAAC,MAAM,MAAM,KAAA,GAAO,YAAY,EAAC,MAAM,YAAY,MAAK;AAAA,oBAC/D,MAAM;AAAA,oBACN,YAAY;AAAA,kBAAA;AAAA,kBAJP,iBAAiB,YAAY,IAAI;AAAA,gBAKxC;AAAA,cAAA;AAAA,YAEJ;AAAA,UAAA,WACS,IAAI,MAAM;AAEnB,kBAAM,wBAAwB,MAAG;AA7J7CxD,kBAAAA;AA8Jc,sBAAAA,OAAA,KAAK,OAAO,cAAZ,OAAA,SAAAA,KAAuB,SAAS;AAAA,gBAC9B,CAAC,QAAa,IAAI,QAAQ,IAAI,KAAK,MAAM,aAAa,IAAI,IAAI,CAAC;AAAA,cAAA;AAAA,YAAA,GAE7D,QAAQ,MAAM,SAAS,YAAY,KAAK,sBAAA,GACxC,YAAY,SAAS,sBAAsB,KAAK,QAAQ,KAAK;AACnE,gBAAI,CAAC;AACG,oBAAA,IAAI,MAAM,sBAAsB;AAElC,kBAAA,YAAW,KAAW,aAAA,OAAA,SAAA,UAAA,WAAX,QAAmB,GAAA,QAC/B,4CAAW,WAAX,OAAA,SAAA,GAAmB,OACpB,QACE,OACJ;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAM;AAAA,gBAEN,MAAM,CAAC,EAAC,MAAM,MAAM,KAAA,GAAO,YAAY,EAAC,MAAM,MAAM,MAAK;AAAA,gBACzD;AAAA,gBACA,SAAS;AAAA,gBAER,UAAkB,kBAAA;AAAA,kBACjB;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA,GAAAE;AAAA,gBAAA,CACD;AAAA,cAAA;AAAA,cAbI,QAAQ,MAAM,IAAI,IAAI,QAAQ;AAAA,YAAA;AAwBvC,gBANI,kBAAkB,SAAS,KAC7B,kBAAkB,QAAQ,CAAC,WAAW;AACpC,iCAAmB,OAAO,IAAI,IAAI,mBAAmB,OAAO,IAAI,KAAK,CAAA,GACrE,mBAAmB,OAAO,IAAI,EAAE,KAAK,IAAI;AAAA,YAC1C,CAAA,GAEC,iBAAiB;AACb,oBAAA,MAAM,cAAc,gBAAgB,OAAO,IAAI,IAC/C,YAAY,iBAAiB,iBAAiB,SAAS,CAAC;AAC1D,kBAAA,aAAa,UAAU,QAAQ,KAAK;AACtC,sBAAM,iBAAiB,mBAAmB,KAAK,QAAQ,gBAAgB,IAAI,GACrE,mBACJ,mBACA,eAAe,eACf,eAAe,YAAY;AAAA,kBACzB,CAAC,SACC,mBACA,gBAAgB,UAChB,KAAK,SAAS,gBAAgB,OAAO;AAAA,gBAAA;AAE1B,iCAAA;AAAA,kBACf;AAAA,oBAACmD;AAAAA,oBAAA;AAAA,sBACC,QAAQ,gBAAgB;AAAA,sBACxB,MAAM;AAAA,sBACN,MAAM,CAAC,EAAC,MAAM,MAAM,KAAA,GAAO,YAAY,EAAC,MAAM,MAAM,MAAK;AAAA,sBACzD,YAAY;AAAA,sBAGZ,UAAG,oBAAA,UAAA,EAAA,UAAA,mBAAmB,gBAAgB,IAAI,GAAE;AAAA,oBAAA;AAAA,oBAFvC;AAAA,kBAGP;AAAA,gBAAA;AAAA,cAEJ;AAEkB,gCAAA;AAAA,YACpB;AACI,8BAAkB,WAAW,KAC/B,iBAAiB,KAAK,IAAI;AAAA,UAE9B;AAAA,QAAA,CACD,GACM,cAAc,OAAO,EAAC,KAAK,MAAM,KAAA,GAAO,GAAG,gBAAgB;AAAA,MACpE;AACM,YAAA,IAAI,MAAM,6BAA6B;AAAA,IAC/C;AAAA,IACA,CAAC,OAAO,MAAM,eAAe,YAAYnD,EAAC;AAAA,EAAA;AAG5C,6BACG,OAAM,EAAA,OAAO,KAAK,cAAc,MAC9B,0CAAI,WAAK,KAAA,aAAa,YAAY,CAAC,GAAG,IAAI,CAAC,UAAU,YAAY,KAAK,CAAC,EAAE,CAAA,EAC5E,CAAA;AAEJ;AAEA,SAAS,kBAAkB;AAAA,EACzB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAAA;AACF,GAQgB;AAEd,MAAI,IAAI,SAAS;AAAA;AACf,+BAAQ,MAAG,CAAA,CAAA;AAGb,MAAI,WACF,oBAAC,QACE,EAAA,UAAA,IAAI,KAAK,QAAQ,MAAMyD,qBAAiC,EAAA,GADhD,QAAQ,QAAQ,EAE3B;AAEF,QAAM,WAAW,SAAS,sBAAsB,KAAK,QAAQ,KAAK,GAE5D,cAAc,mBAAmB,KAAK,IAAI,MAAM,SAAS,CAAA,IAAK,CAAA;AAChE,SAAA,aACF,WAAW,iBAAiB;AAAA,IAC1B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAAzD;AAAA,EAAA,CACD,IAGC,eAAe,YAAY,SAAS,KACtC,YAAY,QAAQ,CAAC,SAAS;AACxB,gBAAY,MAAM,cAAc,MAClC;AAAA,IAEE,oBAACqD,aAAU,EAAA,MACR,SADyB,GAAA,aAAa,IAAI,IAAI,MAAM,IAAI,IAAI,QAAQ,EAEvE;AAAA,EAGL,CAAA,GAEI;AACT;AAEA,SAAS,iBAAiB;AAAA,EACxB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAArD;AACF,GAUgB;AAnUhB,MAAAF;AAoUE,MAAI,WAAY,oBAAA,QAAA,EAAuC,SAA7B,GAAA,gBAAgB,QAAQ,EAAc;AAChE,QAAM,iBACH,KAAK,OAAO,aAAa,KAAK,aAAa,KAAK,UAAU,SAAS,CAAC,EAAE,QAAS,IAO5E,0BACH,YAAY,SAAS,WAAW,eAAe,SAAS,cAAe,QAEpE,aAAYA,2CAAU,WAAV,OAAA,SAAAA,IAAkB,OAC9B,kBACH,aAAa,UAAU,WAAW,eAAe,UAAU,cAC5D;AAEF,MAAI,eAAyB,CAAA;AAK7B,QAAM,oBAJiB,eACpB,MAAM0C,YAAwB,EAC9B,OAAO,CAAC,SAAS,CAAC,CAAC,IAAI,EACvB,KAAK,EAAE,GAEJ,gBAAgB,kBAAkB;AAAA,IACtC;AAAA,IACA,kBAAkB,QAAQ,IAAI,IAAI,IAAI,IAAI,KAAK;AAAA,EAE3C,GAAA,SAAS,cAAc,UAAU,GAAG,cAAc,QAAQ,IAAI,IAAI,CAAC,GACnE,QAAkB,CAAA;AACR,SAAA,CAAC,GAAG,OAAO,SAAS,SAAS,CAAC,EACtC,QAAQ,CAAC,UAAU;AAlW7B1C,QAAAA;AAmWU,UAAA,MAAM,MAAM,CAAC,GACbuC,OAAMD,kBAA8B,OAAOE,kBAA8B,EAAE;AAAA,MAC/E,CAAC,SAAS,KAAK,QAAQ,GAAG,IAAI;AAAA,IAAA;AAEhC,QAAID,MAAK;AACD,YAAA,cAAc,QAAQA,KAAI,CAAC,GAC3B,SACJvC,OAAA,eACE,cAAc,sBAAsB,QAAQ,GAAG,IAAI,oBAAoB,QAAQ,GAAG,CACpF,MAFA,OAAA,SAAAA,KAEG,UAAS;AACI,aAAO,YAAY,GAAG,IAAI,OAAO,YAAYuC,KAAI,CAAC,CAAC,KAEnE,MAAM,KAAK,IAAI;AAAA,IAEnB;AAAA,EAAA,CACD,GACD,eAAe,IAAI,aAAa,KAAK,KAAK,CAAC,GAGzC,mBACA,aAAa,SAAS,KACtB,aAAa,KAAK,CAAC,MAAM,YAAY,GAAG,cAAc,CAAC,MAEvD,WACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,YAAY;AAAA,MAEZ,IAAI;AAAA,MACJ,SAAS;AAAA,QACP,aAAarC,GAAE,0CAA0C;AAAA,MAC3D;AAAA,MAEC,UAAA;AAAA,IAAA;AAAA,IANI,uBAAuB,QAAQ,IAAI,aAAa,KAAK,GAAG,CAAC;AAAA,EAU7D,IAAA;AACT;AAEA,SAAS,kBAAkB,OAA8B,MAAwB;AAE7E,SAAA,MAAM,SAAS,WAAW,KAC1B,MAAM,SAAS,CAAC,EAAE,UAAU,UAC5B,OAAO,MAAM,SAAS,CAAC,EAAE,QAAS,YAClC,MAAM,SAAS,CAAC,EAAE,SAAS,MAC3B,KAAK,OAAO,WAAW;AAE3B;AC5Ya,MAAA,SAAoC,CAACb,WAAU;AAC1D,QAAM,EAAC,MAAM,WAAU,IAAIA,QAErB,SAAS,QAAQ,MAAM,uBAAuB,MAAM,UAAU,GAAG,CAAC,MAAM,UAAU,CAAC;AAGvF,SAAA,oBAAC,OAAI,EAAA,oBAAkB,KAAK,QAC1B,8BAAC,cAAa,EAAA,MAAM,QAAQ,WAAwB,CAAA,EACtD,CAAA;AAEJ,GCTM,mBAAmB,OAAO;AAAA;AAAA,GAInBuE,qBAAqD,CAAC,EAAC,OAAO,WAAU,0BAClF,KAAI,EAAA,IAAI,kBAAkB,SAAS,GAClC,UAAC,oBAAA,SAAA,EAAQ,YAAwB,OAAc,QAAO,UAAU,CAAA,GAClE,GCVW,qBAAmD,CAAC,EAAC,MAAM,WAEpE,MAAA;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,OAAM;AAAA,IACN;AAAA,IACA,QAAO;AAAA,IACP,MAAK;AAAA,IACL,kBAAkBA;AAAAA,IAClB;AAAA,EAAA;AACF,GCREC,kBAAgB,OAAO;AAAA;AAAA;AAAA;AAAA,GAMhB,gBAA+C,CAACxE,WAAU;AAC/D,QAAA,EAAC,MAAS,IAAAA;AAGd,SAAA,oBAAC,OAAI,IAAIwE,iBAAe,UAAU,GAAG,UAAU,GAC5C,UACH,MAAA,CAAA;AAEJ,GCbM,gBAAgB,OAAO;AAAA;AAAA;AAAA,GAKhB,kBAA6C,CAAC,EAAC,MAAM,iBAAgB;AAC1E,QAAA,EAAC,QAAW,IAAA;AAElB,SAAI,WAAS,QAAA,QAAA,OAGH,oBAAA,YAAA,EAAW,MAAY,kBAAkB,eAAe,WAAwB,CAAA,IAIvF,oBAAA,eAAA,EACC,UAAC,oBAAA,YAAA,EAAW,MAAY,EAC1B,CAAA;AAEJ,GCfa,oBAGT;AAAA,EACF,OAAO;AAAA,EACP,SAAS,EAAC,WAAW,kBAAkB,YAAY,GAAK;AAAA,EACxD,MAAM;AAAA,EACN,UAAU;AAAA,EACV,MAAM;AAAA,EACN,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,WAAW;AAAA,EACX,QAAQ;AACV;ACfgB,SAAA,qBACd,MACA,kBACqD;AAXvD,MAAA7D;AAYE,MAAI,SAAiC;AAErC,SAAO,UAAQ;AACP,UAAA,aACJA,MAAQ,UAAA,OAAA,SAAA,OAAA,eAAR,OAAoB,SAAAA,IAAA,SACpB,WAAW,QAAQ,gBAAgB,KACnC,kBAAkB,OAAO,IAAI;AAE3B,QAAA;AACK,aAAA;AAGT,aAAS,OAAO;AAAA,EAClB;AAOM,QAAA,sBALa,CAAC,QAAQ,UAAU,EAAE,SAAS,KAAK,IAAI,IAKjB,KAAK,OAAO,KAAK;AAE1D,SAAO,kBAAkB,mBAAmB;AAC9C;AAEA,SAAS,WACP,YACA,kBACuD;AACvD,QAAM,YAAY;AAEd,MAAA;AAEJ,aAAW,YAAY,WAAW;AAC5B,QAAA,OAAO,YAAa,YAAY;AAE1B,cAAA,MAAM,+CAA+C,QAAQ;AACrE;AAAA,IACF;AAIA,QAFA,WAAW,SAAS,EAAC,YAAY,iBAAA,CAAiB,GAE9C;AACK,aAAA;AAAA,EAEX;AAEF;AC1BgB,SAAA,gBACd,YACA,MACA,OAAa,CACb,GAAA,YAA6B,CAAA,GAC7B,UAAuB,IACT;AAGd,MAAI,CAFkB,qBAAqB,YAAY,QAAQ,YAAY,GAEvD;AAClB,QAAI,WAAW,aAAa,YAAY,KAAK,SAAS;AACpD,aAAO,sBAAsB,YAAgC,MAAM,MAAM,WAAW,OAAO;AAG7F,QAAI,WAAW,aAAa,WAAW,KAAK,SAAS;AACnD,aAAO,qBAAqB,YAAY,MAAM,MAAM,SAAS;AAAA,EAEjE;AAEA,SAAO,eAAe,YAAY,MAAM,MAAM,WAAW,OAAO;AAClE;AAEgB,SAAA,sBACd,YACA,MACA,OAAa,CACb,GAAA,YAA6B,CAAA,GAC7B,cAA2B,IACb;AACR,QAAA,UAAwB,IAExB,eAA4B,EAAC,GAAG,aAAa,cAAc,cAC3D,YACJ,WAAW,aAAa,WAAW,OAAO,IAAI,CAAC,WAAW,EAAC,QAAQ,IAAM,MAAO,EAAA;AAClF,aAAW,YAAY;AACjB,aAAS,SACX,QAAQ,KAAK,GAAG,iBAAiB,SAAS,OAAO,MAAM,MAAM,WAAW,YAAY,CAAC,IAErF,QAAQ;AAAA,MACN,GAAG,wBAAwB,UAA2B,MAAM,MAAM,WAAW,YAAY;AAAA,IAAA;AAK3F,SAAA,QAAQ,SAAS,IACZ,UAGF;AAAA,IACL;AAAA,MACE,MAAM;AAAA,MACN,KAAK+B,eAAa,IAAI,KAAK;AAAA,MAC3B;AAAA,MACA;AAAA,MACA,SAAS,iBAAiB,SAAS,UAAU,MAAM;AAAA,MACnD;AAAA,IACF;AAAA,EAAA;AAEJ;AAEO,SAAS,iBACd,OACA,MACA,MACA,WACA,cAAsD,IACxC;AACR,QAAA,EAAC,aAAa,GAAG,QAAO,IAAI,aAC5B,YAAY,KAAK,OAAO,MAAM,IAAI;AACpC,MAAA,CAAC,aAAa,CAAC,UAAU,aAAc,eAAe,CAAC,YAAY,SAAS,MAAM,IAAI;AACxF,WAAO;AAGT,QAAM,YAAY,KAAK,OAAO,CAAC,MAAM,IAAI,CAAC,GACpC,iBAAiB,UAAU,OAAO,CAAC,MAAM,KAAK,SAAS,MAAM,IAAI,CAAC;AACxE,SAAO,gBAAgB,MAAM,MAAa,WAAW,WAAW,gBAAgB,OAAO;AACzF;AAEO,SAAS,wBACd,UACA,MACA,MACA,WACA,cAAsD,IACxC;AACR,QAAA,EAAC,QAAQ,MAAM,OAAO,UAAU,WAAU,UAC1C,EAAC,aAAa,GAAG,QAAO,IAAI,aAE5B,iBAAiB,QACjB,mBAAmB,UAEnB,oBAAoB,UAAU,OAAO,CAAC,SAAS,IAAI,CAAC,GACpD,UAAwB,CAAA;AAE9B,aAAW,SAAS,QAAQ;AAC1B,UAAM,YAAY,KAAK,OAAO,MAAM,IAAI;AACpC,QAAA,CAAC,aAAa,CAAC,UAAU,aAAc,eAAe,CAAC,YAAY,SAAS,MAAM,IAAI;AACxF;AAGF,UAAM,YAAY,KAAK,OAAO,CAAC,MAAM,IAAI,CAAC,GACpC,iBAAiB,kBAAkB,OAAO,CAAC,MAAM,KAAK,SAAS,MAAM,IAAI,CAAC;AACxE,YAAA;AAAA,MACN,GAAG;AAAA,QACD;AAAA,UACE,UAAU;AAAA,UACV,QAAQ;AAAA,UACR,GAAG,MAAM;AAAA,QACX;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,IAAA;AAAA,EAEJ;AAEI,SAAA,QAAQ,SAAS,IACZ,UAGF;AAAA,IACL;AAAA,MACE,MAAM;AAAA,MACN,KAAKA,eAAa,IAAI,KAAK;AAAA,MAC3B,cAAc;AAAA,MACd;AAAA,MACA,WAAW;AAAA,MACX,SAAS,iBAAiB,SAAS,kBAAkB,MAAM;AAAA,MAC3D,UAAU;AAAA,MACV,QAAQ;AAAA,IACV;AAAA,EAAA;AAEJ;AAEgB,SAAA,qBACd,YACA,MACA,OAAa,CACb,GAAA,YAA6B,IACf;AACR,QAAA,iBAAiB,KAAK,MAAM;AAAA,IAChC,CAAC,SACE,KAAK,YAAY,KAAK,cAAc,KAAK,WAAY,KAAK,KAAK,WAAW;AAAA,EAAA;AAG/E,MAAI,eAAe,WAAW;AAC5B,WAAO;AAGT,QAAM+B,kBAAiB,gBAAgB,UAAU,GAC3C,OAAqB,CAAA,GACrB,UAAU,eAAe,OAAO,CAAC,KAAK,aAAa;AACjD,UAAA,cAAc,qBAAqB,SAAS,MAAM,UAAU,GAC5D,aAAa,YAAY,UAAU,YAAY;AACrD,QAAI,CAAC;AAEH,aAAA,QAAQ,KAAK,kDAAkD/B,eAAa,IAAI,CAAC,GAC1E;AAGT,UAAM,UACJ,kBAAkB,SAAS,KAAK,SAAS,KACzC,kBAAkB,SAAS,KAAK,OAAO,KACvC,KAAK,MAAM,QAAQ,QAAQ,GAEvB,WAAW,KAAK,OAAO,OAAO,GAC9B,cAA2B,EAAC,UAAU,YAAY,MAAM,cAAc,WAAA,GACtE,gBAAgB,UAAU,OAAO;AAAA,MACrC,UAAU,SAAS;AAAA,MACnB,SAAS,SAAS;AAAA,MAClB,WAAW,SAAS;AAAA,MACpB,YACE,SAAS,KAAK,WAAW,cAAc,SAAS,aAAa,SAAS,KAAK;AAAA,IAAA,CAC9E,GAEK,iBAAiB,CAAC,YAClB,OAAO,SAAS,WAAW,cAAc,UAAU,OAAO,IAAI,MAChE,OAAO,WAAW,WAGb,SAGH,WAAW;AAAA,MACf;AAAA,MACA,SAAS;AAAA,MACT;AAAA,MACA;AAAA,MACA;AAAA,IAAA,EACA,IAAI,cAAc;AAEhB,WAAA+B,mBACF,SAAS,OAAO,aAAa,EAAE,QAAQ,CAAC,OAAO,OAAO,aAAa;AAC3D,YAAA,aAAa,SAAS,WAAW,GACvC,MAAM,YAAY,SAAS,cAAc,SAAS,WAAW,SAAS;AAAA,IAAA,CACvE,GAGC,SAAS,WAAW,IAEtB,IAAI,KAAK,GAAG,eAAe,YAAY,SAAS,MAAM,UAAU,eAAe,WAAW,CAAC,IAE3F,IAAI,KAAK,GAAG,QAAQ,GAGf;AAAA,KACN,IAAI;AAEH,SAAA,QAAQ,SAAS,IACZ;AAAA,IACL;AAAA,MACE,MAAM;AAAA,MACN,KAAK/B,eAAa,IAAI,KAAK;AAAA,MAC3B;AAAA,MACA;AAAA,MACA,SAAS,iBAAiB,SAAS,UAAU,MAAM;AAAA,MACnD;AAAA,IACF;AAAA,EAIG,IAAA;AACT;AAEA,SAAS,eACP,YACA,MACA,MACA,WACA,EAAC,UAAU,YAAY,aAA6B,IAAA,IACjC;AACnB,QAAM,EAAC,WAAW,SAAS,KAAA,IAAQ;AAGnC,MAAI,SAAS,WAAW,QAAQ,SAAS,KAAK,QAAQ,OAAO;AAC3D,WAAO;AAGL,MAAA;AACA,SAAO,YAAc,QACvB,QAAQ,cAAc,WAAW,UAAU,IAGzC,CAAC,SAAS,OAAO,UAAY,QAC/B,QAAQ,cAAc,SAAS,UAAU;AAG3C,MAAI,aAAa,IACb;AAEE,QAAA,gBAAgB,qBAAqB,YAAY,YAAY;AACnE,SAAI,iBAAiB,OAAO,iBAAkB,aAE5C,YAAY,gBACH,kBAET,YAAa,cAAsB,WACnC,aACE,OAAQ,cAAsB,aAAe,MACzC,aACC,cAAsB,aAGxB;AAAA,IACL;AAAA,MACE,MAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,WAAW;AAAA,MACX,KAAKA,eAAa,IAAI,KAAK;AAAA,MAC3B,eAAe,QAAQ,SAAY;AAAA,MACnC;AAAA,IACF;AAAA,EAAA;AAEJ;AAEA,SAAS,iBAAiB,SAAuB,WAAW,GAAiB;AACpE,SAAA,QAAQ,IAAI,CAAC,YAClB,OAAO,YAAY,OAAO,UAAU,MAAM,QAAQ,GAC3C,OACR;AACH;AAEA,SAAS,QAAQ,MAAwB;AAC/B,SAAA,MAAM,QAAQ,IAAI,KAAK,KAAK,WAAW,KAAM,SAAS,QAAQ,OAAO,OAAS;AACxF;AChUA,MAAM,gBAAgB,CAAC,WACd,OAAO,SAAS,WAAW,OAAO,KAAK,WAAW,SAGrD,oBAAoB,CAAC,eAA8C;AACvE,MAAI,WAAW,SAAS;AACtB,WAAO,CAAC,UAAU;AAGpB,QAAM,gBAAmC,CAAA;AAE9B,SAAA,WAAA,QAAQ,QAAQ,CAAC,YAAY;AACtC,kBAAc,KAAK,GAAG,kBAAkB,OAAO,CAAC;AAAA,EACjD,CAAA,GAEM;AACT,GAKM,cAAc,CAAC,SAAe,eAA8B;AAC5D,MAAA,WAAW,UAAU,QAAQ;AACxB,WAAA;AAGT,WAAS,IAAI,GAAG,IAAI,WAAW,QAAQ;AACrC,QAAI,WAAW,CAAC,MAAM,QAAQ,CAAC;AACtB,aAAA;AAIJ,SAAA;AACT,GAEM,2BAA2B,CAAC,MAA+B,UAA+B;AAC9F,QAAM,WAAW,KAAK,KAAK,GAErB,MAAM,WAAW,QAAQ;AAE/B,SAAI,MACK,EAAC,MAAM,IAAA,IAGA,MAAM,QAAQ,IAAI,IAGzB,SAAS,OAAO,EAAE,IAGpB;AACT,GCtBM,cAA2B;AAAA,EAC/B,gBAAgB,EAAC,SAAS,IAAO,yBAAyB,IAAI,yBAAyB,IAAG;AAC5F;AAEgB,SAAA,WACd,QACA,UACA,oBACM;AACN,MAAI,CAAC;AACH;AAGF,QAAM,UAA6B,CAAA;AAE/B,MAAA,OAAO,SAAS,SAAS;AAC3B,UAAM,aAAa,kBAAkB,MAAM,GAErC,eAAe,WAAW,OAAO,aAAa;AAEpD,eACG,OAAO,CAAC,UAAU,CAAC,cAAc,KAAK,CAAC,EACvC,QAAQ,CAAC,UAAU,WAAW,OAAO,UAAU,kBAAkB,CAAC,GAErE,QAAQ;AAAA,MACN,GAAG,kBAAkB,UAAU,aAAa,IAAI,CAAC,gBAAgB,YAAY,IAAI,EAAE,SAAS;AAAA,IAAA;AAAA,EAEhG;AAAW,WAAO,KAAK,WAAW,UAGhC,QAAQ,KAAK,GAAG,kBAAkB,UAAU,CAAC,OAAO,IAAI,CAAC,CAAC,IAE1D,OAAO,SAAS,WAChB,OAAO,YACP,OAAO,cACP,OAAO,WAAW,SAAS,WAC3B,OAAO,SAAS,WAIhB,QAAQ,KAAK,GAAG,iBAAiB,OAAO,UAAU,OAAO,YAAY,OAAO,IAAI,CAAC,IAGjF,QAAQ,KAAK,GAAG,iBAAiB,OAAO,MAAM,UAAU,OAAO,IAAI,CAAC;AAGnD,qBAAA,MAAM,QAAQ,OAAO;AAC1C;AAEA,SAAS,gBAAgB,UAAsB,MAAY,sBAAoC;AAC7F,QAAM,gBAAgB,SAAS;AAExB,SAAA,sBAAsB,eAAe,MAAM,oBAAoB;AACxE;AAEA,SAAS,kBAAkB,UAAsB,OAAkC;AACjF,QAAM,UAAkB,CAAA;AAExB,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ;AACJ,YAAQ,KAAK,CAACgC,WAAU,YAAY,MAAM,CAAC,GAAGA,MAAK,CAAC,KAMhF,QAAQ,KAAK,gBAAgB,UAAU,MAAM,CAAC,GAAG,KAAK,CAAC;AAGzD,SAAO,CAAC,EAAC,OAAO,CAAC,GAAG,IAAI,IAAI,QAAQ,IAAIhC,cAAY,CAAC,CAAC,GAAE;AAC1D;AAOA,SAAS,sBAIP,eAIA,aAIA,cAAsB,CAAA,GAItB,aACM;AACF,MAAA,YAAY,UAAU,GAAG;AAK3B,QAAI,CAAC;AAIG,YAAA,IAAI,MAAM,sBAAsB;AAGjC,WAAA;AAAA,EACT;AAEM,QAAA,eAAe,YAAY,MAAM,GAAG,EAAE,GACtC,gBAAgB,eAAe,eAAe,YAAY,GAO1D,qBAAqB;AAAA,IACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA,GAAG,YAAY,OAAO,CAAC,SAAS,CAAC,YAAY,MAAM,YAAY,CAAC;AAAA,EAAA;AAG3D,SAAA,OAAO,eAAe,cAAc,WAAW,IAClD,sBAAsB,eAAe,cAAc,oBAAoB,WAAW,IAClF;AACN;AAEA,SAAS,iBACP,UACA,YACA,MACmB;AACnB,QAAM,WAAW,KAAK,MAAM,GAAG,EAAE,GAC3B,EAAC,aAAa,WAAW,UAAa,IAAA,YAAY,YAAY,QAAQ;AAExE,MAAA;AACJ,MAAI,cAAc;AAEC,qBAAA,EAAC,QAAQA,eAAa,CAAC,GAAG,UAAU,CAAC,CAAC;OAClD;AAEC,UAAA,YAAY,YAAY,GAExB,cADc,kBAAkB,YAAY,SAAS,CAAC,KACzB;AAClB,qBAAA,EAAC,OAAOA,eAAa,CAAC,GAAG,UAAU,WAAW,CAAC;EAClE;AAEO,SAAA;AAAA,IACL;AAAA,MACE,OAAO,CAACA,eAAa,IAAI,CAAC;AAAA,IAC5B;AAAA,IACA;AAAA,MACE,QAAQ,EAAC,GAAG,gBAAgB,OAAO,CAAC,SAAS,EAAC;AAAA,IAChD;AAAA,EAAA;AAEJ;AAEA,SAAS,iBAAiB,MAAY,UAAsB,MAA+B;AACzF,QAAM,UAAU,SAAS,KAAK,SAAS,KAAK,WAAW,aAAa,IAAI,GAElE,UAAU,QACb,OAAO,CAACgC,WAAqCA,OAAM,OAAO,QAAQ,EAClE,IAAI,CAAC,EAAC,OAAO,MAAK,OAAO,EAAC,QAAQ,EAAC,OAAOhC,eAAa,KAAK,GAAG,MAAK,EAAU,EAAA,GAE3E,SAAS,QACZ,OAAO,CAACgC,WAA+BA,OAAM,OAAO,OAAO,EAC3D,OAAO,CAAC,KAAKA,WAAU,IAAI,OAAOhC,eAAagC,OAAM,IAAI,CAAC,GAAG,EAAc,GAExE,eAAe,oBAAI,OACnB,QAA2B,CAAA;AAEjC,MAAI,UAAU;AACR,QAAA,OAAO,QACV,OAAO,CAACA,WAA6BA,OAAM,OAAO,KAAK,EACvD;AAAA,IACC,CAAC,KAAKA,YACJ,UAAU,IACV,MAAM,KAAK,GAAG,eAAeA,OAAM,MAAM,UAAU,YAAY,CAAC,GAChE,IAAIhC,eAAagC,OAAM,IAAI,CAAC,IAAIA,OAAM,OAC/B;AAAA,IAET,CAAC;AAAA,EAAA;AAGE,SAAA;AAAA,IACL,GAAG;AAAA,IACH,GAAG;AAAA,IACH,GAAI,OAAO,SAAS,IAAI,CAAC,EAAC,OAAO,OAAO,CAAA,IAAI,CAAC;AAAA,IAC7C,GAAI,UAAU,CAAC,EAAC,KAAK,KAAI,CAAC,IAAI,CAAC;AAAA,EAAA;AAEnC;AAEA,SAAS,eAAe,MAAY,UAAsB,SAAyC;AACjG,QAAM,QAAQ,SAAS,WACjB,YAAY,SAAS,SACrB,QAA2B;AAEjC,WAAS,IAAI,GAAG,KAAK,KAAK,QAAQ,KAAK;AAC/B,UAAA,UAAU,KAAK,MAAM,GAAG,CAAC,GACzB,UAAUhC,eAAa,OAAO;AAChC,QAAA,QAAQ,IAAI,OAAO;AACrB;AAGF,UAAM,cAAc,KAAK,CAAC,GACpB,qBAAqB,aAAa,WAAW,KAAK,eAAe,WAAW,GAC5E,YAAY,eAAe,OAAO,OAAO,GACzC,OAAO,aAAa,SAAS;AAGnC,QACE,sBACA,MAAM,QAAQ,SAAS,KACvB,CAAC,eAAe,WAAW,KAAK,MAAM,GAAG,IAAI,CAAC,CAAC,GAC/C;AACA,YAAM,cAAc,UAAU,WAAW,WAAW,GAC9C,WAAW,UAAU,cAAc,CAAC,GACpC,WAAW,eAAe,OAAO,QAAQ,OAAO,WAAW,CAAC,GAC5D,UAAU,cAAc,QAAQ,IAAI,EAAC,MAAM,SAAS,SAAQ,cAAc,GAC1E,QAAQA,eAAa,QAAQ,OAAO,cAAc,IAAI,IAAI,OAAO,CAAC;AAClE,YAAA,KAAK,EAAC,cAAc,EAAC,CAAC,OAAO,GAAG,GAAG,EAAA,CAAC,GAC1C,MAAM,KAAK,EAAC,QAAQ,EAAC,OAAO,OAAO,CAAC,aAAa,QAAQ,CAAC,EAAS,EAAA,CAAC,GAEpE;AACA;AAAA,IACF;AAEI,WAAO,OAAS,QAIpB,QAAQ,IAAI,OAAO,GACnB,MAAM,KAAK,EAAC,cAAc,EAAC,CAAC,OAAO,GAAG,QAAiC;AAAA,EACzE;AACO,SAAA;AACT;AAKA,SAAS,kBAIP,MAIA,MAIA,aACS;AAMT,MAAI,CAACnC,WAAS,IAAI,KAAK,CAAC,MAAM,QAAQ,IAAI;AACjC,WAAA;AAGT,aAAW,SAAS,MAAM;AACpB,QAAA,CAAC,OAAO,UAAU,eAAe,KAAK,MAAM,KAAK,KAQjD,UAAU,WAAW,UAAU;AACjC;AAGF,UAAM,WAAW,CAAC,GAAG,MAAM,yBAAyB,MAAiC,KAAK,CAAC;AAE3F,QAAI,CAAC,OAAO,KAAK,KAAK,GAAG,UAAU,WAAW;AACrC,aAAA;AAAA,EAEX;AAEO,SAAA;AACT;AAEA,SAAS,OAAO,MAAe,MAAY,aAA+B;AACxE,QAAM,gBAAgB,eAAa,OAAA,SAAA,YAAA;AAAA,IACjC,CAAC,eAAemC,eAAa,UAAU,MAAMA,eAAa,IAAI;AAAA,EAAA,GAG1DiC,gBAAe,MAAM,QAAQ,IAAI,KAAK,KAAK,UAAU;AAE3D,SACE,iBACA,SAAS,UACT,SAAS,QACTA,iBACAhC,gBAAc,IAAI,KAClB,kBAAkB,MAAM,MAAM,WAAW;AAE7C;AAEA,SAAS,aAAa,MAAwB;AACxC,MAAA,MAAM,QAAQ,IAAI;AACpB,WAAO;AAGL,MAAA,OAAO,QAAS,YAAY,SAAS;AACvC;AAGF,QAAM3C,SAAiC,CAAA;AAEvC,SAAI,cAAc,IAAI,MACpBA,OAAM,OAAO,KAAK,OAGhB,cAAc,IAAI,MACpBA,OAAM,QAAQ,KAAK,QAGdA;AACT;AAEA,SAAS,YAAY,YAAuB,UAAoB;AAC9D,MAAI,WAAW,aAAa,OAAO,SAAS,aAAc,UAAU;AAClE,UAAM,YAAY,WAAW,UAAU,SAAS,SAAS;AAClD,WAAA;AAAA,MACL,aAAa,WAAW;AAAA,MACxB,WAAW,SAAS;AAAA,MACpB;AAAA,IAAA;AAAA,EAEJ;AAGA,QAAM,IAAI,MAAM,gCAAgC,SAAS,SAAS,EAAE;AACtE;ACrXO,MAAM,cAAc,cAA4B,EAAC,MAAM,GAAG,CAAA,GCFpD4E,sBAAoB,OAAO;AAAA;AAAA;AAAA,GCA3B,QAAQ,QAAQ,IAAI,aAAa,cAGjC,SAAS,CAAC;ACchB,MAAM,0BAA0B,UAA0D;AAAA,EAA1F,cAAA;AAAA,UAAA,GAAA,SAAA,GAKL,KAAA,QAAgC;EAAC;AAAA,EAJjC,OAAO,yBAAyB,OAAc;AAC5C,WAAO,EAAC,MAAK;AAAA,EACf;AAAA;AAAA,EAKA,kBAAkB,OAAc;AAC9B,YAAQ,MAAM,kCAAkC,GAChD,QAAQ,MAAM,KAAK;AAAA,EACrB;AAAA,EAEA,SAAS;AACD,UAAA,EAAC,GAAA/D,GAAK,IAAA,KAAK,OACX,EAAC,UAAS,KAAK;AAEhB,WAAA,QAKF,oBAAA,MAAA,EAAK,SAAS,GAAG,QAAQ,GAAG,MAAK,YAChC,UAAA,qBAAC,MACC,EAAA,UAAA;AAAA,MAAA,oBAACc,QAAK,EAAA,MAAM,GACV,UAAA,oBAAC,mBAAiB,CAAA,GACpB;AAAA,MAEA,qBAAC,KAAI,EAAA,aAAa,GAChB,UAAA;AAAA,QAAC,oBAAAA,QAAA,EAAK,IAAG,MAAK,MAAM,GAAG,QAAO,UAC3B,UAAEd,GAAA,8BAA8B,EACnC,CAAA;AAAA,QAEC,SACC,oBAAC,KAAI,EAAA,WAAW,GACd,UAAC,oBAAAc,QAAA,EAAK,IAAG,KAAI,MAAM,GAChB,UAAEd,GAAA,uCAAuC,EAC5C,CAAA,GACF;AAAA,MAAA,GAEJ;AAAA,IACF,EAAA,CAAA,EAAA,CACF,IAxBO,KAAK,MAAM;AAAA,EA0BtB;AACF;ACzDA,MAAM,kBAAkB;AAAA,EACtB,MAAM;AAAA,EACN,OAAO;AACT;AAGO,SAAS,YACdb,QAEA;AACM,QAAA,EAAC,YAAY,SAAS,GAAG,cAAaA,QACtC,iBAAiB,gBAAgB,SAAS;AAG9C,SAAA,oBAAC2B,QAAK,EAAA,OAAK,IAAC,MAAM,GAAI,GAAG,WACtB,UAAc,cAAA,cAAc,EAC/B,CAAA;AAEJ;ACTA,MAAMkD,gBAAc,OAAO;AAAA;AAAA;AAAA,GAKrB,OAAO,OAAO;AAAA;AAAA;AAAA;AAAA;AAOb,SAAS,mBAAmB7E,QAAyD;AACpF,QAAA,EAAC,UAAU,IAAI,QAAQ,GAAG,UAAS,IAAIA,QACvC,aAAa,OAAO,EAAK,GACzB,CAAC,cAAc,eAAe,IAAI,SAAS,EAAK,GAEhD,gBAAgB,YAAY,MAAM,gBAAgB,CAAC,UAAU,CAAC,KAAK,GAAG,CAAC,eAAe,CAAC,GACvF,mBAAmB,YAAY,MAAO,WAAW,UAAU,IAAO,CAAA,CAAE,GACpE,mBAAmB,YAAY,MAAO,WAAW,UAAU,IAAQ,CAAC,UAAU,CAAC;AAErF,SAAA,UAAU,MAAM;AACd,aAAS,UAAU,KAAoB;AAC/B,YAAA,EAAC,SAAS,IAAO,IAAA;AACnB,iBAAW,QAAQ,OAAO,WAAW,WACvC,cAAc;AAAA,IAElB;AAEO,WAAA,OAAA,iBAAiB,WAAW,WAAW,EAAK,GAC5C,MAAM,OAAO,oBAAoB,WAAW,WAAW,EAAK;AAAA,EAAA,GAClE,CAAC,aAAa,CAAC,GAGhB,oBAAC,OAAI,IAAQ,cAAc,kBAAkB,cAAc,kBAAmB,GAAG,WAC9E,UAAA,mCAAgB,eAAc,EAAA,OAAgB,CAAA,IAAK,SACtD,CAAA;AAEJ;AAEA,MAAM,YAAY,CAAC,EAAC,YACjB,oBAAA,KAAA,EAAI,SAAS,GAAG,SAAQ,gBAAe,IAAI,MAC1C,UAAA,oBAAC2B,UAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAA,MACH,CAAA,EACF,CAAA;AAGF,SAAS,cAAc,EAAC,UAAyD;AAhEjF,MAAAhB,KAAA,IAAA;AAiEQ,QAAA,EAAC,GAAAE,OAAK;AAEV,SAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,IAAC,qBAAA,MAAA,EAAK,SAAS,GAAG,MAAK,eAAc,IAAIgE,eAAa,QAAQ,GAC5D,UAAA;AAAA,MAAA,oBAAC,WAAU,EAAA,OAAOhE,GAAE,8BAA8B,EAAG,CAAA;AAAA,0BACpD,MAAK,EAAA,UAAS,QAAO,MAAM,GACzB,UAAU,UAAA;AAAA,QACT,MAAM6B,eAAa,OAAO,IAAI;AAAA,QAC9B,YAAW/B,MAAO,OAAA,aAAP,OAAiB,SAAAA,IAAA;AAAA,QAC5B,UAAS,KAAO,OAAA,aAAP,OAAiB,SAAA,GAAA;AAAA,QAC1B,WAAU,KAAO,OAAA,aAAP,OAAiB,SAAA,GAAA;AAAA,QAC3B,QAAQ,OAAO,KAAK;AAAA,QACpB,WAAW,OAAO,KAAK;AAAA,MACxB,CAAA,GACH;AAAA,IAAA,GACF;AAAA,IACA,qBAAC,QAAK,IAAIkE,eAAa,MAAK,YAAW,SAAS,GAAG,QAAQ,GACzD,UAAA;AAAA,MAAA,oBAAC,WAAU,EAAA,OAAOhE,GAAE,8BAA8B,EAAG,CAAA;AAAA,MACrD,oBAAC,MAAK,EAAA,UAAS,QAAO,MAAM,GACzB,UAAQ,QAAA,OAAO,KAAK,SAAS,EAChC,CAAA;AAAA,IAAA,GACF;AAAA,IACA,oBAAC,QACC,UAAC,oBAAA,aAAA,EAAY,WAAU,QAAO,OAAM,UAAS,EAC/C,CAAA;AAAA,IACA,qBAAC,QAAK,IAAIgE,eAAa,MAAK,YAAW,SAAS,GAAG,QAAQ,GACzD,UAAA;AAAA,MAAA,oBAAC,WAAU,EAAA,OAAOhE,GAAE,4BAA4B,EAAG,CAAA;AAAA,MACnD,oBAAC,MAAK,EAAA,UAAS,QAAO,MAAM,GACzB,UAAQ,QAAA,OAAO,KAAK,OAAO,EAC9B,CAAA;AAAA,IAAA,GACF;AAAA,EACF,EAAA,CAAA;AAEJ;AAEA,SAAS,QAAQ,OAAgB;AAC3B,SAAA,OAAO,QAAU,MACZ,cAGF,KAAK,UAAU,OAAO,MAAM,CAAC;AACtC;AAEA,SAAS,UAAU,MAA+B;AAChD,QAAM,QAAkB,CAAA;AAEjB,SAAA,OAAA,QAAQ,IAAI,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AACzC,WAAO,QAAU,OAAe,UAAU,QAC5C,MAAM,KAAK,GAAG,GAAG,KAAK,KAAK,EAAE;AAAA,EAAA,CAEhC,GAEM,MAAM,KAAK;AAAA,CAAI;AACxB;AClHO,SAAS,cAAc,MAAoB;AAChD,QAAM,EAAC,GAAAA,GAAK,IAAA,eACN,GAAA,eAAe,SAAS,KAAK,SAAS,GACtC,eAAe,SAAS,KAAK,OAAO;AAEjC,SAAAA,GADL,CAAC,gBAAgB,eACV,wBAGP,CAAC,gBAAgB,eACV,0BAGF,uBAPuB;AAQlC;AAGA,SAAS,SAAS,OAAgB;AAChC,SAAO,UAAU,QAAQ,OAAO,QAAU,OAAe,UAAU;AACrE;ACTA,MAAM,uBAAuB,EAAC,YAAY,EAAC,GACrC,sBAAsB,EAAC,YAAY,UAAS,GAE5C,aAAmE;AAAA,EACvE,KAAK;AAAA,EACL,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,SAAS;AACX,GAGa,SAAS,WAAwC,SAAgBb,QAAO,KAAK;AAClF,QAAA,EAAC,OAAA8E,SAAQ,OAAO,SAAS,UAAU,MAAA7D,OAAM,IAAI,OAAO,GAAG,UAAA,IAAajB,QACpE,QAAQ,SAER,GAAA+E,UAAS,WAAW,WAAW,OAAO,MACtC,eAAe;AAAA,IACnB,OAAO;AAAA,MACL,GAAG;AAAA,MACH,GAAI,WAAW,WACX,EAAC,UAAU,QAAQ,SAAS,cAAa,IACzC,EAAC,qBAAqB,kBAAkB,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,CAAC,kBAAiB;AAAA,IAAA;AAAA,IAEzF,CAAC,QAAQ,OAAO,KAAK;AAAA,EAGjB,GAAA,eAAe,WAAW,WAAW,uBAAuB;AAGhE,SAAA,qBAACA,WAAQ,GAAG,WAAW,KAAU,OAAO,cAAc,uBAAmB,IACtE,UAAA;AAAA,IAAA9D,SAEG,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAA,oBAAC,QAAK,OAAO,WAAW6D,MAAK,GAAG,OAAO,cACpC,UACH7D,OAAA;AAAA,MACA,oBAAC,MAAK,EAAA,OAAM,UAAS,SAAQ,UAAS,SAAS,GAC7C,UAAC,oBAAA,aAAA,CAAA,CAAY,EACf,CAAA;AAAA,IAAA,GACF;AAAA,IAEF,oBAAC,QAAK,OAAO,WAAW6D,MAAK,GAAG,OAAO,cACpC,UACH,IAAA;AAAA,EACF,EAAA,CAAA;AAEJ,CAAC,GCrCK,aAA4B;AAAA,EAChC,MAAM;AAAA,EACN,UAAU;AAAA,EACV,SAAS;AAAA,EACT,YAAY;AACd;AAGO,SAAS,WAAW9E,QAAwB;AACjD,QAAM,EAAC,OAAA8E,QAAO,eAAe,MAAM,QAAQ,MAAM,kBAAkB,WAAc,IAAA9E,QAC3E,EAAC,WAAU,MACX,aAAa,cAAc,IAAI;AAErC,MAAI,WAAW;AACb,WACG,oBAAA,UAAA,EAAS,WAAW,eAAe,OAAO,YACxC,UAAA,cAAc,kBAAkB,EAAC,YAAY,OAAO,KAAK,QAAA,CAAQ,EACpE,CAAA;AAIE,QAAAiB,QAAO,KAAK,cAAc,UAAa,KAAK,cAAc,QAC9D,oBAAC,UAAS,EAAA,IAAG,OAAM,WAAW,eAAe,MAAY,MAAY,OAAO,YACzE,UAAc,cAAA,kBAAkB,EAAC,YAAY,OAAO,KAAK,UAAU,CAAA,EACtE,CAAA,GAGI,KAAK,KAAK,YAAY,UAAa,KAAK,YAAY,QACvD,oBAAA,UAAA,EAAS,IAAG,OAAM,WAAW,eAAe,MAAY,MAAY,OAAO,YACzE,UAAA,cAAc,kBAAkB,EAAC,YAAY,OAAO,KAAK,QAAQ,CAAA,EACpE,CAAA;AAGF,SAAIA,SAAQ,CAAC,KAET,oBAAC,eAAY,aAAa,YAAY,MAAY,MAC/C,gBACH,CAAA,IAIA,CAACA,SAAQ,yBAER,aAAY,EAAA,aAAa,YAAY,MAAY,MAC/C,UAAA,GAAA,CACH,IAKF,oBAAC,eAAY,aAAa,YAAY,MAAY,MAChD,8BAAC,QAAO,EAAA,OAAA6D,QAAc,MAAA7D,OAAY,QAAgB,IAAQ,EAC5D,CAAA;AAEJ;ACnEA,MAAM,kBAAoD,CAAC,EAAC,OAAO,WAAA,MAE9D,oBAAA,KAAA,EAAI,SAAS,GACZ,8BAAC,SAAQ,EAAA,YAAwB,OAAqB,QAAO,WAAU,EACzE,CAAA,GAKS,eAAsE,CAACjB,WAAU;AACtF,QAAA,EAAC,MAAM,WAAc,IAAAA;AAGzB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA,kBAAkB;AAAA,MAClB,QAAO;AAAA,IAAA;AAAA,EAAA;AAGb,GCzBa,uBAAuB,OAAO;AAAA,0BACjB,CAAC,EAAC,MAAW,MAAA,MAAM,OAAO,MAAM,MAAM,SAAS,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,GAMtE,aAAa,OAAO;AAAA,0BACP,CAAC,EAAC,MAAW,MAAA,MAAM,OAAO,MAAM,MAAM,SAAS,QAAQ,EAAE;AAAA,mCAChD,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,CAAC;AAAA,kCACxC,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GCNnEgF,SAAO,OAAO,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAWH,CAAC,EAAC,MAAW,MAAA,MAAM,OAAO,MAAM,MAAM,SAAS,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAWnE,sBAAsB,WAAW,SAC5ChF,QAEA,KACc;AACR,QAAA,EAAC,UAAU,aAAa,GAAG,UAAA,IAAaA,QACxC,EAAC,GAAAa,OAAK;AAGV,SAAA;AAAA,IAACmE;AAAAA,IAAA;AAAA,MACC,MAAM;AAAA,MACN;AAAA,MACA,MAAMnE,GAAE,gDAAgD,EAAC,OAAO,aAAY;AAAA,MAC5E,MAAK;AAAA,MACL;AAAA,MACA,cAAc;AAAA,MACb,GAAG;AAAA,IAAA;AAAA,EAAA;AAGV,CAAC;ACzCe,SAAA,WAAW,EAAC,SAAkC;AACtD,QAAA,EAAC,GAAAA,OAAK;AAEV,SAAA,oBAAC,QAAK,MAAK,YAAW,SAAS,GAC7B,UAAA,qBAAC,MAAK,EAAA,OAAM,cACV,UAAA;AAAA,IAAA,oBAAC,OACC,UAAC,oBAAAc,QAAA,EACC,UAAC,oBAAA,kBAAA,EAAiB,GACpB,EACF,CAAA;AAAA,IACC,oBAAA,KAAA,EAAI,MAAM,GAAG,aAAa,GACzB,UAAA,oBAACA,QAAK,EAAA,MAAM,GAAG,IAAG,KACf,UAAAd,GAAE,MAAM,YAAY;AAAA,MACnB,cAAc,MAAM;AAAA,MACpB,YAAY,MAAM;AAAA,IAAA,CACnB,GACH,EACF,CAAA;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACPO,SAAS,YACdb,QAKA;AA3BF,MAAAW;AA4BQ,QAAA,EAAC,QAAQ,QAAQ,aAAYX,QAC7B,gBAAgB,OAAO,iBAAiB,cACxC;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAAiF,gBAAe1D;AAAAA,EAAA,IACb,kBAAkB,GAChB,MAAM,qBAAqB,YAAY,WAAW,IAAI,GACtD,CAAC,mBAAmB,oBAAoB,IAAI,SAAS,EAAK,GAC1D,CAAC,eAAe,gBAAgB,IAAI,SAAS,EAAK,GAClD,CAAC,qBAAqB,sBAAsB,IAAI,SAAgC,IAAI,GACpF,EAAC,GAAAV,GAAA,IAAK,eAAe,GAErB,CAAC,aAAa,oBAAoB,IAAI,2BAA2B;AAAA,IACrE,IAAI;AAAA,IACJ,MAAM,WAAW;AAAA,IACjB,YAAY;AAAA,EAAA,CACb,GAEK,sBAAsB,YAAY,MAAM;AACjC,eAAA,QAAQ,UAAU,GAAG;AAAA,EAAA,GAC/B,CAAC,QAAQ,UAAU,GAAG,CAAC,GAEpB,6BAA6B,YAAY,MAAM;AACnD,yBAAqB,EAAI;AAAA,KACxB,EAAE,GAEC,kCAAkC,YAAY,MAAM;AACxD,yBAAqB,EAAK;AAAA,KACzB,EAAE,GAEC,+BAA+B,YAAY,MAAM;AACrD,qBAAiB,EAAI;AAAA,KACpB,EAAE,GAEC,+BAA+B,YAAY,MAAM;AACrD,qBAAiB,EAAK;AAAA,EAAA,GACrB,CAAE,CAAA,GAEC,qBAAqB,YAAY,MAAM,qBAAqB,EAAK,GAAG,CAAA,CAAE;AAE5D,kBAAA,oBAAoB,CAAC,mBAAmB,CAAC;AASzD,QAAM,cAPUF,MAAA,OAAO,iBAAP,OAAA,SAAAA,IAAqB,cAAa,UAOtB,OAAO,KAAK,MAAM,GAAG,EAAE,IAAI,OAAO;AAE9C,SAAA;AAAA,IACd,MACE,SAAS,OACP,qBAAC,SAAM,OAAO,GAAG,IAAI,sBAClB,UAAA;AAAA,MAAA,OAAO,cAAe,oBAAA,kBAAA,EAAiB,QAAgB,WAAW,OAAO,WAAW;AAAA,MAEpF,oBAAAsE,eAAA,EAAa,MAAM,WAAW,UAAU,eACvC,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA,IAAI;AAAA,UACJ,2BAAyB,gBAAgB,KAAK;AAAA,UAC9C,cAAY,OAAO,QAAQ,KAAK;AAAA,UAChC,yBAAqB;AAAA,UAEpB,UAAA;AAAA,YAAA,OAAO,QACL,oBAAA,YAAA,EAAW,OAAO,OAAO,MAAO,CAAA,IAEhC,oBAAA,mBAAA,EAAkB,GAAApE,IACjB,UAAC,oBAAA,YAAY,UAAZ,EAAqB,OAAO,EAAC,MAAM,OAAO,KACzC,GAAA,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAM,OAAO;AAAA,gBACb,YAAY,OAAO;AAAA,cAAA;AAAA,eAEvB,EACF,CAAA;AAAA,YAGD,sBAAsB,CAAC,yBAAwB,eAAA,OAAA,SAAA,YAAa,YAC3D;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,SACE,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,kBAAA,oBAAC,KAAI,EAAA,UAAU,GACb,UAAA,oBAACc,UAAK,MAAM,GACT,UAAEd,GAAA,6CAA6C,EAAC,OAAO,EAAE,CAAA,EAC5D,CAAA,GACF;AAAA,kBACC,qBAAA,MAAA,EAAK,KAAK,GAAG,SAAQ,YACpB,UAAA;AAAA,oBAAA;AAAA,sBAAC;AAAA,sBAAA;AAAA,wBACC,MAAK;AAAA,wBACL,SAAS;AAAA,wBACT,MAAMA,GAAE,kCAAkC;AAAA,sBAAA;AAAA,oBAC5C;AAAA,oBACA;AAAA,sBAAC;AAAA,sBAAA;AAAA,wBACC,MAAK;AAAA,wBACL,SAAS;AAAA,wBACT,MAAMA,GAAE,gDAAgD,EAAC,OAAO,GAAE;AAAA,sBAAA;AAAA,oBACpE;AAAA,kBAAA,GACF;AAAA,gBAAA,GACF;AAAA,gBAEF,MAAM;AAAA,gBACN,SAAS;AAAA,gBACT,QAAM;AAAA,gBACN,WAAU;AAAA,gBACV,KAAK;AAAA,gBAEL,UAAA;AAAA,kBAAC;AAAA,kBAAA;AAAA,oBACC,aAAa;AAAA,oBACb,SAAS;AAAA,oBACT,cAAc;AAAA,oBACd,cAAc;AAAA,oBACd,UAAU;AAAA,oBACV,UAAU;AAAA,oBACV,eAAa,+BAA+B,UAAA,OAAA,SAAA,OAAQ,GAAG;AAAA,kBAAA;AAAA,gBACzD;AAAA,cAAA;AAAA,YACF;AAAA,UAAA;AAAA,QAAA;AAAA,MAAA,GAGN;AAAA,IAAA,GACF;AAAA,IAEJ;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACAoE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,eAAa,OAAA,SAAA,YAAA;AAAA,MACb;AAAA,MACA;AAAA,MACApE;AAAA,IACF;AAAA,EAAA;AAIJ;AC7KO,SAAS,WAAyE;AACjF,QAAA,MAAM,OAAiB,IAAI,GAC3B,CAAC,OAAO,QAAQ,IAAI,SAAS,EAAK;AAExC,SAAA,UAAU,MAAM;AACd,UAAM,OAAO,IAAI;AAEjB,QAAI,CAAC;AACH,aAAO,MAAG;AAAA,MAAA;AAGN,UAAA,kBAAkB,MAAM,SAAS,EAAI,GACrC,iBAAiB,MAAM,SAAS,EAAK;AAEtC,WAAA,KAAA,iBAAiB,aAAa,eAAe,GAClD,KAAK,iBAAiB,YAAY,cAAc,GAEzC,MAAM;AACX,WAAK,oBAAoB,aAAa,eAAe,GACrD,KAAK,oBAAoB,YAAY,cAAc;AAAA,IAAA;AAAA,KAEpD,EAAE,GAEE,CAAC,KAAK,KAAK;AACpB;ACvBO,MAAM,oBAAoB,OAAO;AAAA;AAAA;AAAA,GAK3B,uBAAuB,OAAO;AAAA,0BACjB,CAAC,EAAC,MAAW,MAAA,MAAM,OAAO,MAAM,MAAM,SAAS,QAAQ,EAAE;AAAA,mCAChD,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,CAAC;AAAA,kCACxC,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ACiBlE,SAAS,YACdb,QAKqB;AACrB,QAAM,EAAC,QAAQkF,QAAO,UAAU,QAAQ,GAAG,cAAalF,QAClD,EAAC,WAAW,SAAS,MAAM,cAAakF,QACxC,EAAC,MAAM,SAAY,IAAA,WAAW,WAAW,GACzC,EAAC,YAAY,YAAY,cAAAD,eAAc,UAAU,mBAAsB,IAAA,kBAAA,GACvE,EAAC,GAAApE,OAAK,eAAe,GAErB4D,kBAAiB,QAAQ;AAAA,IAC7B,CAAC,WAAW,cAAc,MAAM,KAAK,eAAe,OAAO,UAAU;AAAA,EAAA,GAGjE,iBAAiB,cAAc,UAAU,SAAS,GAClD,CAAC,iBAAiB,qBAAqB,IAAI,YAE3C,gBAAgB,qBAAqB,YAAY,WAAW,IAAI,GAChE,CAAC,mBAAmB,oBAAoB,IAAI,SAAS,EAAK,GAC1D,CAAC,sBAAsB,uBAAuB,IAAI,SAAgC,IAAI,GAEtF,CAAC,aAAa,oBAAoB,IAAI,2BAA2B;AAAA,IACrE,IAAI;AAAA,IACJ,MAAM,WAAW;AAAA,IACjB,YAAY;AAAA,EAAA,CACb,GAEK,sBAAsB;AAAA,IAC1B,MAAM,WAAWS,QAAO,UAAU,aAAa;AAAA,IAC/C,CAACA,QAAO,UAAU,aAAa;AAAA,EAAA,GAG3B,6BAA6B,YAAY,MAAM;AACnD,yBAAqB,EAAI;AAAA,KACxB,EAAE,GAEC,kCAAkC,YAAY,MAAM;AACxD,yBAAqB,EAAK;AAAA,EAC5B,GAAG,CAAE,CAAA;AAEL,kBAAgB,MAAM,qBAAqB,EAAK,GAAG,CAAC,oBAAoB,CAAC;AAEzE,QAAM,UAAU;AAAA,IACd,MACE,SAAS,OACP;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAO;AAAA,QACP,IAAI;AAAA,QACJ,2BAAyB,wBAAwB,KAAK;AAAA,QACtD,sBAAoBT,kBAAiB,KAAK;AAAA,QAE1C,UAAA;AAAA,UAAC,oBAAA,OAAA,EAAM,IAAI,mBAAmB,OAAO,GAClC,UAAQ,QAAA,IAAI,CAAC,WACZ;AAAA,YAAC;AAAA,YAAA;AAAA,cAEC;AAAA,cACA;AAAA,cACA;AAAA,YAAA;AAAA,YAHK,OAAO;AAAA,UAKf,CAAA,GACH;AAAA,UACC,sBAAsB,CAAC,yBAAwB,eAAA,OAAA,SAAA,YAAa,YAC3D;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,SACE,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,gBAAA,oBAAC,KAAI,EAAA,UAAU,GACb,UAAA,oBAAC9C,UAAK,MAAM,GACT,UAAEd,GAAA,6CAA6C,EAAC,OAAO,QAAQ,OAAM,CAAC,EACzE,CAAA,GACF;AAAA,gBACC,qBAAA,MAAA,EAAK,KAAK,GAAG,SAAQ,YACpB,UAAA;AAAA,kBAAA;AAAA,oBAAC;AAAA,oBAAA;AAAA,sBACC,MAAK;AAAA,sBACL,SAAS;AAAA,sBACT,MAAMA,GAAE,kCAAkC;AAAA,oBAAA;AAAA,kBAC5C;AAAA,kBACA;AAAA,oBAAC;AAAA,oBAAA;AAAA,sBACC,MAAK;AAAA,sBACL,SAAS;AAAA,sBACT,MAAMA,GAAE,gDAAgD,EAAC,OAAO,GAAE;AAAA,oBAAA;AAAA,kBACpE;AAAA,gBAAA,GACF;AAAA,cAAA,GACF;AAAA,cAEF,SAAS;AAAA,cACT,QAAM;AAAA,cACN,WAAU;AAAA,cACV,MAAM;AAAA,cACN,KAAK;AAAA,cAEL,8BAAC,KACC,EAAA,UAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,aAAa,QAAQ;AAAA,kBACrB,SAAS;AAAA,kBACT,KAAK;AAAA,kBACL,UAAU;AAAA,kBACV,UAAU;AAAA,kBACV,eAAa,8BAA8BqE,OAAM,YAAY;AAAA,gBAAA;AAAA,cAAA,GAEjE;AAAA,YAAA;AAAA,UACF;AAAA,QAAA;AAAA,MAAA;AAAA,IAEJ;AAAA,IAEJ;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACAA,OAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACAT;AAAA,MACA;AAAA,MACA,eAAa,OAAA,SAAA,YAAA;AAAA,MACb;AAAA,MACA;AAAA,MACA5D;AAAA,IACF;AAAA,EAAA;AAGF,SAAO,SAAS,OACd,qBAAC,SAAM,OAAO,GAAI,GAAG,WACnB,UAAA;AAAA,IAAA,oBAAC,oBAAiB,WAAsB;AAAA,IACvC,kBAAkB,CAACoE,gBAClB,UAEA,oBAACA,eAAa,EAAA,UAAU,uBAAuB,MAAMC,OAAM,MACxD,UACH,QAAA,CAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACrJO,SAAS,eAAelF,QAA4B;AAjB3D,MAAAW,KAAA;AAkBE,QAAM,EAAC,QAAQ,QAAQ,aAAYX,QAC7B,EAAC,UAAS,qBAEV,WAAW,uBAAuB;AAAA;AAAA,IAEtC,UAAU;AAAA,IACV,eAAe,YAAUW,MAAO,OAAA,eAAP,OAAmB,SAAAA,IAAA;AAAA,IAC5C,kBAAkB;AAAA,IAClB,OAAO,OAAO,SAAS,UAAU,OAAO,KAAK,UAAU;AAAA,EAAA,CACxD,GAEK,aAAa,uBAAuB;AAAA;AAAA,IAExC,UAAU;AAAA,IACV,eAAe,cAAY,KAAO,OAAA,eAAP,OAAmB,SAAA,GAAA;AAAA,IAC9C,kBAAkB;AAAA,IAClB,OAAO,OAAO,SAAS,UAAU,OAAO,KAAK,UAAU;AAAA,EAAA,CACxD;AAED,SAAI,WAAiB,OAEjB,OAAO,SAAS,UACX,oBAAC,aAAY,EAAA,QAAgB,UAAU,WAAY,CAAA,IAGxD,OAAO,SAAS,UAEhB;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,eAAa,gBAAgB,OAAO,YAAY;AAAA,MAChD,UAAU;AAAA,IAAA;AAAA,EACZ;AAAA;AAAA,yBAMDgB,QAAK,EAAA,UAAA;AAAA,MAAA;AAAA,MACkB,oBAAA,QAAA,EAAO,UAAe,OAAA,QAAQ,aAAY;AAAA,IAAA,GAClE;AAAA;AAEJ;ACtDO,SAAS,YAAY;AACpB,QAAA,EAAC,GAAAd,OAAK;AAEV,SAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,IAAC,oBAAAc,QAAA,EAAK,MAAM,GAAG,QAAO,UAAS,IAAG,MAC/B,UAAEd,GAAA,0BAA0B,EAC/B,CAAA;AAAA,IACA,oBAACc,QAAK,EAAA,IAAG,KAAI,MAAM,GAAG,OAAK,IACxB,UAAEd,GAAA,gCAAgC,EACrC,CAAA;AAAA,EACF,EAAA,CAAA;AAEJ;ACWO,SAAS,WAAW,EAAC,MAAM,QAAQ,cAAmD;AAC3F,QAAM,EAAC,YAAY,oBAAoB,MAAS,IAAA,qBAC1C,gBAAgB,qBAAqB,YAAY,WAAW,IAAI,GAChE,EAAC,SAAQ,WAAW,WAAW,GAC/B,SAAS,KAAK,WAAW,GACzB,CAAC,sBAAsB,uBAAuB,IAAI,SAAS,EAAK,GAChE,CAAC,uBAAuB,wBAAwB,IAAI,SAAS,EAAK,GAClE,EAAC,GAAAA,OAAK,eAAe,GAErB,aAAa,uBAAuB;AAAA,IACxC,UAAU;AAAA,IACV,OAAO;AAAA,IACP,eAAe,WAAW;AAAA,IAC1B,kBAAkB;AAAA,EAAA,CACnB;AAED,MAAI,WAAW,aAAa;AACpB,UAAA,IAAI,MAAM,oDAAoD;AAGtE,QAAM,CAAC,aAAa,oBAAoB,IAAI,2BAA2B;AAAA,IACrE,IAAI;AAAA,IACJ,MAAM,WAAW;AAAA,IACjB,YAAY;AAAA,EAAA,CACb,GAEK,aAAa;AAAA,IACjB,MAAM,sBAAsB,YAAY,MAAM,MAAM,CAAA,GAAI,EAAC,aAAa,QAAO;AAAA,IAC7E,CAAC,YAAY,QAAQ,MAAM,IAAI;AAAA,KAG3B,UAAU;AAAA,IACd,MAAO,UAAU,OAAO,WAAW,IAAI,CAAC,IAAI,aAAa,UAAU;AAAA,IACnE,CAAC,YAAY,MAAM;AAAA,EAAA,GAGf,aAAa,WAAW,CAAC,GAEzB,mBAAmB,YAAY,MAAM;AACzC,eAAW,YAAY,MAAM,aAAa,GAC1C,wBAAwB,EAAK;AAAA,EAAA,GAC5B,CAAC,YAAY,MAAM,aAAa,CAAC,GAE9B,8BAA8B,YAAY,MAAM;AACpD,4BAAwB,EAAI;AAAA,KAC3B,EAAE,GAEC,mCAAmC,YAAY,MAAM;AACzD,6BAAyB,EAAI;AAAA,KAC5B,EAAE,GAEC,mCAAmC,YAAY,MAAM;AACzD,6BAAyB,EAAK;AAAA,KAC7B,EAAE,GAEC,qCAAqC,YAAY,MAAM;AAC3D,4BAAwB,EAAK;AAAA,KAC5B,CAAE,CAAA,GAEC,CAAC,2BAA2B,4BAA4B,IAAI;AAAA,IAChE;AAAA,EAAA,GAGI,qBAAqB,YAAY,MAAM,wBAAwB,EAAK,GAAG,CAAA,CAAE;AAI/E,MAFA,gBAAgB,oBAAoB,CAAC,yBAAyB,CAAC,GAE3D,QAAQ,WAAW;AACd,WAAA,SAAU,oBAAA,WAAA,CAAU,CAAA,IAAK;AAG5B,QAAA,aAAa,UAAU,QAAQ,SAAS;AAE9C,SACG,oBAAA,MAAA,EACC,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,IAAC,oBAAA,OAAA,EAAM,IAAI+D,qBAAmB,OAAO,GAClC,kBAAQ,IAAI,CAAC,WACZ,oBAAC,OACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QAEA,iCAA+B,wBAAwB,KAAK;AAAA,QAC5D,UAAU,eAAc,UAAQ,OAAA,SAAA,OAAA;AAAA,QAChC,QAAQ,UAAQ,OAAA,SAAA,OAAA;AAAA,MAAA;AAAA,MAHX,OAAO;AAAA,IAHN,EAAA,GAAA,OAAO,GAQjB,CACD,GACH;AAAA,IAEC,cAAc,sBAAsB,CAAC,yBAAwB,2CAAa,YACzE;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SACE,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAC,oBAAA,KAAA,EAAI,UAAU,GACb,UAAA,oBAACjD,UAAK,MAAM,GACT,aAAE,yCAAyC;AAAA,YAC1C,OAAO,QAAQ;AAAA,UAAA,CAChB,GACH,EACF,CAAA;AAAA,UACC,qBAAA,MAAA,EAAK,KAAK,GAAG,SAAQ,YACpB,UAAA;AAAA,YAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAK;AAAA,gBACL,MAAMd,GAAE,kCAAkC;AAAA,gBAC1C,SAAS;AAAA,cAAA;AAAA,YACX;AAAA,YACA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAK;AAAA,gBACL,MAAMA,GAAE,mCAAmC;AAAA,gBAC3C,SAAS;AAAA,cAAA;AAAA,YACX;AAAA,UAAA,GACF;AAAA,QAAA,GACF;AAAA,QAEF,MAAM;AAAA,QACN,SAAS;AAAA,QACT,WAAW;AAAA,QACX,QAAM;AAAA,QACN,KAAK;AAAA,QAEL,8BAAC,OACC,EAAA,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,MAAK;AAAA,YACL,MAAMA,GAAE,mCAAmC;AAAA,YAC3C,MAAM;AAAA,YACN,SAAS;AAAA,YACT,cAAc;AAAA,YACd,cAAc;AAAA,YACd,UAAU;AAAA,YACV,MAAK;AAAA,UAAA;AAAA,QAAA,GAET;AAAA,MAAA;AAAA,IACF;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ;AAEA,SAAS,aAAa,SAAuB;AAC3C,SAAO,QAAQ,WAAW,KAAK,QAAQ,CAAC,EAAE,SAAS,WAAW,QAAQ,CAAC,EAAE,KAAK,WAAW,IACrF,QAAQ,CAAC,EAAE,UACX;AACN;ACrKA,MAAM,cAAc,OAAO;AAAA,mBACR,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,OAAO,CAAC,CAAC,CAAC;AAAA,GAGrD,gBAAgB,OAAOc,MAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyB1B,SAAS,kBAAkB3B,QAAmD;AAC7E,QAAA,EAAC,YAAWA,QACZ,EAAC,SAAQ,SACT,EAAC,GAAAa,OAAK;AAER,SAAA,QAAQ,WAAW,UAEnB;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,YAAY,QAAQ;AAAA,MACpB,oBAAkB;AAAA,MAClB,SAAS,EAAC,aAAaA,GAAE,qBAAqB,EAAC;AAAA,MAC/C,IAAI;AAAA,MAEJ,UAAA,oBAAC,iBAAc,IAAG,OAAM,OAAO,EAAC,gBAAgB,OAAM,GACnD,UACH,KAAA,CAAA;AAAA,IAAA;AAAA,EAAA,IAKF,QAAQ,WAAW,YAEnB;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,YAAY,QAAQ;AAAA,MACpB,IAAI;AAAA,MACJ,oBAAkB;AAAA,MAClB,SAAS,EAAC,aAAaA,GAAE,uBAAuB,EAAC;AAAA,MAEjD,UAAC,oBAAA,eAAA,EAAc,IAAG,OAAO,UAAK,MAAA;AAAA,IAAA;AAAA,EAMlC,IAAA,oBAAC,MAAK,EAAA,IAAG,QAAO,QAAQ,GAAG,OAAO,EAAC,SAAS,SAAQ,GACjD,UACH,KAAA,CAAA;AAEJ;AAGO,SAAS,WAAWb,QAA2B;AAC9C,QAAA,EAAC,KAAQ,IAAAA;AAGb,SAAA,oBAAA,UAAA,EACI,gBAAK,YAAY,CAAA,GAAI,IAAI,CAAC,SAAS,iBACnC;AAAA,IAAC;AAAA,IAAA;AAAA,MAGC;AAAA,IAAA;AAAA,IADK;AAAA,EAGR,CAAA,EACH,CAAA;AAEJ;AC/EA,MAAM,WAAW,OAAO2B,MAAI;AAAA;AAAA;AAKrB,SAAS,SAAS3B,QAAsB;AAC7C,QAAM,EAAC,OAAO,QAAQ,MAAM,UAAU,YAAe,IAAAA;AAErD,SACG,qBAAA,MAAA,EAAK,SAAS,GAAG,OAAM,UACrB,UAAA;AAAA,IAAA,QACE,oBAAA,KAAA,EAAI,SAAS,GACZ,8BAAC,UAAS,EAAA,MAAM,GAAG,aAAa,cAAc,QAAQ,OACnD,UAAc,cAAA,IAAI,EACrB,CAAA,GACF;AAAA,IAGD,qBAAA,OAAA,EAAM,OAAO,GAAG,aAAa,GAC5B,UAAA;AAAA,MAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM;AAAA,UACN,QAAO;AAAA,UACP,aAAa,cAAc,QAAQ;AAAA,UACnC,cAAa;AAAA,UAEZ,UAAA;AAAA,QAAA;AAAA,MACH;AAAA,MAEC,UAAW,oBAAA,OAAA,EAAK,UAAO,OAAA,CAAA;AAAA,0BAEvB,UAAS,EAAA,MAAM,GAAG,cAAa,YAC7B,UACH;AAAA,IAAA,GACF;AAAA,EACF,EAAA,CAAA;AAEJ;AC3CA,MAAM,cAAc,OAAO;AAAA;AAAA;AAAA;AAAA,GAMd,cAA2C,CAACA,WAAU;AAC3D,QAAA,EAAC,MAAS,IAAAA;AAGd,SAAA,oBAAC,OAAI,IAAI,aAAa,UAAU,GAAG,UAAU,GAC1C,UAAA,MAAM,QACT,CAAA;AAEJ;ACdgB,SAAA,mBAAsB,UAAmB,MAAY;AACnE,SAAO,oBAAoB,UAAU,MAAM,oBAAI,QAAS,CAAA;AAC1D;AAEA,SAAS,oBACP,UACA,MAIA,SACG;AACH,MAAI,aAAa;AAAa,WAAA;AAE1B,MAAA,QAAQ,IAAI,IAAI,KAKhB,YAAY,QAAQ,QAAQ,QAEf,OAAO,YACP,OAAO;AAGU,WAAA;AAE9B,MAAA,MAAM,QAAQ,IAAI,GAAG;AACvB,YAAQ,IAAI,IAAI;AAKZ,QAAA,WAAW,SAAS,WAAW,KAAK;AACxC,UAAM,SAAS,CAAA;AACf,aAAS,QAAQ,GAAG,QAAQ,KAAK,QAAQ,SAAS;AAC1C,YAAA,WAAW,oBAAoB,SAAS,KAAK,GAAG,KAAK,KAAK,GAAG,OAAO;AAEtE,mBAAa,SAAS,KAAK,MAC7B,WAAW,KAEb,OAAO,KAAK,IAAI;AAAA,IAClB;AACA,WAAA,QAAQ,OAAO,IAAI,GACX,WAAW,WAAW;AAAA,EAChC;AAEI,MAAA,OAAO,QAAS,UAAU;AAC5B,YAAQ,IAAI,IAAI;AAIV,UAAA,WAAW,OAAO,KAAK,IAAI;AACjC,QAAI,WAAW,OAAO,KAAK,QAAQ,EAAE,WAAW,SAAS;AACzD,UAAM,SAAkC,CAAA;AACxC,eAAW,OAAO,UAAU;AACpB,YAAA,YAAY,oBAAoB,SAAS,GAAG,GAAG,KAAK,GAAG,GAAI,OAAO;AACpE,oBAAc,SAAS,GAAG,MAC5B,WAAW,KAEb,OAAO,GAAG,IAAI;AAAA,IAChB;AACA,WAAA,QAAQ,OAAO,IAAI,GACX,WAAW,WAAW;AAAA,EAChC;AACO,SAAA;AACT;AC/DA,MAAM,kBAAkB,cAAkC,CAAA,CAAE;AAErD,SAAS,iBAAiBA,QAA4D;AAEzF,SAAA,oBAAC,gBAAgB,UAAhB,EAAyB,OAAOA,OAAM,UAAW,iBAAM,SAAS,CAAA;AAErE;AAEO,SAAS,uBAA2C;AACnD,QAAA,MAAM,WAAW,eAAe;AACtC,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,2BAA2B;AAEtC,SAAA;AACT;AAOgB,SAAA,iBAAiB,MAAY,WAAyC;AACpF,QAAM,WAAW,wBACX,OAAO,OAAO,QAAQ,GACtB,OAAO;AAAA,IACX,KAAK;AAAA,IACL,SAAS;AAAA,MACP,CAAC,SAAS,WAAW,MAAM,KAAK,IAAI,MAAM,aAAa,CAACJ,UAAQ,MAAM,KAAK,IAAI;AAAA,IACjF;AAAA,EAAA;AAEF,SAAA,KAAK,UAAU,MACR;AACT;ACyBa,MAAA,qBAAqB,cAA8C,IAAI;ACzD7E,SAAS,iBAA0C;AAClD,QAAA,cAAc,WAAW,kBAAkB;AAEjD,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,oCAAoC;AAG/C,SAAA;AACT;ACHA,MAAM,UAAU,CAAC,UACX,UAAU,UACJ,oBAAA,kBAAA,EAAiB,IAGvB,UAAU,YACL,oBAAC,qBAAmB,CAAA,IAGtB,oBAAC,iBAAgB,CAAA,CAAA,GAGpB,WAAW,OAAO+B,MAAI,EAAE,CAAC,EAAC,MAAA,MACvB;AAAA;AAAA,eAEM,MAAM,OAAO,MAAM,MAAM,QAAQ,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,eAI3C,MAAM,OAAO,MAAM,MAAM,QAAQ,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,eAI3C,MAAM,OAAO,MAAM,MAAM,SAAS,QAAQ,EAAE;AAAA;AAAA,GAG1D;AAEM,SAAS,eAAe3B,QAAqB;AAC5C,QAAA,EAAC,SAAS,YAAAmF,aAAY,wBAAuBnF,QAC7C,EAAC,kBAAiB,iBAAiB,WAAW;AAEhD,SAAA,QAAQ,WAAW,KAAKmF,YAAW,WAAW,IACzC,OAIP,qBAAC,OAAM,EAAA,OAAO,GACX,UAAA;AAAA,IAAWA,YAAA,SAAS,KACnBA,YAAW,IAAI,CAAC,EAAC,SAAS,SAAQ;AAAA;AAAA,2BAE/B,MACC,EAAA,UAAA;AAAA,QAAC,oBAAA,KAAA,EAAI,aAAa,GAAG,cAAc,QAAQ,MAAMA,YAAW,SAAS,IAAI,GACvE,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAM;AAAA,YACN,cAAY,UAAU,UAAU,KAAK;AAAA,YACrC,gBAAc,UAAU,YAAY,KAAK;AAAA,YACzC,aAAW,UAAU,SAAS,KAAK;AAAA,YAElC,kBAAQ,KAAK;AAAA,UAAA;AAAA,QAAA,GAElB;AAAA,QACA,oBAAC,OACC,UAAC,oBAAAxD,QAAA,EAAK,MAAM,GAAI,UAAA,WAAW,SAAQ,EACrC,CAAA;AAAA,MAbS,EAAA,GAAA,kBAAkB,KAAK,EAclC;AAAA,KACD;AAAA,IAEF,QAAQ,SAAS,KACf,qBAAA,KAAA,EAAI,WAAWwD,YAAW,SAAS,IAAI,IAAI,GACzC,UAAA;AAAA,MAAA,uBAAuB,oBAAoB,OAAO;AAAA,MAClD,CAAC,uBAAwB,oBAAA,eAAA,EAAc,QAAkB,CAAA;AAAA,IAAA,GAC5D;AAAA,EAEJ,EAAA,CAAA;AAEJ;AC1EA,MAAM,oBAAoB,cAAkC,CAAA,CAAE;AAEvD,SAAS,mBAAmBnF,QAA8D;AAE7F,SAAA,oBAAC,kBAAkB,UAAlB,EAA2B,OAAOA,OAAM,YACtC,iBAAM,SACT,CAAA;AAEJ;AAEO,SAAS,uBAA2C;AACnD,QAAA,MAAM,WAAW,iBAAiB;AACxC,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,2BAA2B;AAEtC,SAAA;AACT;AAOgB,SAAA,mBAAmB,MAAY,YAAY,IAA6B;AACtF,QAAMmF,cAAa;AACZ,SAAA;AAAA,IACL,MACEA,YACG,OAAO,CAAC,SAAS,WAAW,MAAM,KAAK,IAAI,MAAM,aAAa,CAACvF,UAAQ,MAAM,KAAK,IAAI,EAAE,EACxF,IAAI,CAAC,YAAY;AAAA,MAChB,SAAS,OAAO;AAAA,MAChB,OAAO,OAAO;AAAA,MACd,MAAM,OAAO;AAAA,IAAA,EACb;AAAA,IACN,CAAC,WAAW,MAAMuF,WAAU;AAAA,EAAA;AAEhC;ACjCA,MAAM,mBAAmB,CAAC,wBAAwB;AAG3C,SAAS,oBAAoB,QAAkC;AAC9D,QAAA,OAAO,OAAoC,IAAI,GAC/C,mBACJ,UAAQ,QAAA,OAAA,cAAc,OAAO,WAAW,SAAS,IAAI,OAAO,aAAa7E,eACrE,kBAAkB,oBAAmB,iCAAQ,SAAQ,gBAAgB,GAErE6E,cAAa;AAAA,IACjB,MACE,UAAQ,QAAA,OAAA,cAAc,YAAY,UAAA,OAAA,SAAA,OAAQ,UAAU,IAChD,mBACA,iBAAiB,OAAO,eAAe;AAAA,IAC7C,CAAC,iBAAiB,QAAQ,gBAAgB;AAAA,EAGtC,GAAA,CAAC,UAAU,YAAY,OAAO,IAAI;AAAA,IACtC,MAAM;AAAA,MACJA,YAAW,OAAO,CAAC,MAAM,EAAE,UAAU,OAAO,EAAE,SAAS;AAAA,MACvDA,YAAW,OAAO,CAAC,MAAM,EAAE,UAAU,SAAS,EAAE,SAAS;AAAA,MACzDA,YAAW,OAAO,CAAC,MAAM,EAAE,UAAU,MAAM,EAAE,SAAS;AAAA,IACxD;AAAA,IACA,CAACA,WAAU;AAAA,EAGP,GAAA,aAAa,mBAAmB,KAAK,SAASA,WAAU;AACzD,SAAA,KAAA,UAAU,YAER,QAAQ,OACN;AAAA,IACL,YAAY;AAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IAED,CAAC,YAAY,UAAU,YAAY,OAAO,CAAC;AAChD;AC1Ca,MAAA,6BAA6B,cAAoC,CAAA,CAAE;AAEzE,SAAS,4BAA4BnF,QAGzC;AAEC,SAAA,oBAAC,2BAA2B,UAA3B,EAAoC,OAAOA,OAAM,SAC/C,iBAAM,SACT,CAAA;AAEJ;ACRO,SAAS,uBAAuB,MAAkC;AACjE,QAAA,MAAM,WAAW,0BAA0B;AACjD,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,2BAA2B;AAG7C,SADgB,QAAQ,MAAM,IAAI,OAAO,CAAC,MAAMJ,UAAQ,EAAE,MAAM,IAAI,CAAC,GAAG,CAAC,KAAK,IAAI,CAAC;AAErF;ACPA,MAAMwF,kBAA2C;AAAA,EAC/C,WAAW;AAAA,EACX,oBAAoB,CAAC,OAAO,QAAQ;AACtC;AAEO,SAAS,qBAAqBpF,QAA0C;AACvE,QAAA,EAAC,OAAAkF,WAASlF,QACV,EAAC,UAAS,YAAYkF,MAAK;AAE7B,SAAAA,OAAM,WAGJ,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,oBAAC,KAAI,EAAA,SAAS,GAAG,YAAY,GAC3B,UAAC,oBAAAvD,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,gBACH,CAAA,GACF;AAAA,IAECuD,OAAM,SAAS,IAAI,CAAC,MAAM,QAAK;AAzBxC,UAAAvE;AA0BU,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAQ;AAAA,UACR,SAAS,QAAQ;AAAA,UAGjB,eAAaA,MAAMuE,OAAA,SAAS,MAAM,CAAC,MAAtB,oBAAyB,UAAS;AAAA,QAAA;AAAA,QAD1C;AAAA,MAAA;AAAA,IAEP,CACD;AAAA,EAAA,GACH,IAKD,oBAAA,WAAA,EAAU,MAAMA,OAAM,MAAM,SAASE,iBAAe,MAAM,OAAO,MAAMF,OAAM,MAC3E,UAAAA,OAAM,SAAS,IAAI,CAAC,MAAM,QAAK;AAxCtC,QAAAvE;AAyCQ,WAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ;AAAA,QACR,SAAS,QAAQ;AAAA,QAGjB,eAAaA,MAAMuE,OAAA,SAAS,MAAM,CAAC,MAAtB,oBAAyB,UAAS;AAAA,MAAA;AAAA,MAD1C;AAAA,IAAA;AAAA,EAGR,CAAA,EACH,CAAA;AAEJ;AC1CO,SAAS,oBAAoBlF,QAA0C;AAC5E,QAAM,EAAC,OAAA,IAAUA,QAEX,EAAC,MAAA,IAAS,YAAY,MAAM,GAE5B,cAAc,YAAY,MAAM;AACpC,WAAO,SAAS;AAAA,EAAA,GACf,CAAC,MAAM,CAAC,GAEL,yBAAyB,OAAO,OAAO,YAAa,gCACvD2B,QAAK,EAAA,MAAM,GAAI,UAAA,OAAO,SAAS,OAAO,CAAA;AAGzC,SACG,oBAAA,mBAAA,EAAkB,SAAS,wBAAwB,WAAU,QAC5D,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,UAAU,EAAQ,OAAO;AAAA,MACzB,MAAM,OAAO;AAAA,MACb,WAAW,OAAO,cAAc,OAAO,WAAW,gBAAgB;AAAA,MAClE,SAAS;AAAA,MACT,SAAS,OAAO;AAAA,MAChB,MAAM;AAAA,MACN,MAAM,OAAO;AAAA,IAAA;AAAA,EAEjB,EAAA,CAAA;AAEJ;ACvBO,SAAS,oBAAoB3B,QAAiC;AACnE,QAAM,EAAC,QAAQ,SAAS,YAAA,IAAeA;AAEnC,SAAA,OAAO,SAAS,YACX,oBAAC,cAAY,CAAA,IAGlB,OAAO,SAAS,UAGb,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAC,CAAA,+BAAY,aAAY,EAAA;AAAA,IAC1B,oBAAC,sBAAqB,EAAA,OAAO,OAAQ,CAAA;AAAA,EAAA,EAAA,CACvC,IAMC,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,mCAAgB,aAAY,EAAA;AAAA,IAC7B,oBAAC,uBAAoB,QAAgB;AAAA,EACvC,EAAA,CAAA;AAEJ;ACjBA,MAAM,8BAA2D;AAAA,EAC/D,WAAW;AACb;AAEA,SAAS,eAAe,MAA+B;AAC9C,SAAA,oBAAoB,QAAQ,KAAK;AAC1C;AAGa,MAAA,kBAAkB,KAAK,SAAyBA,QAA6B;AACxF,QAAM,EAAC,OAAO,qBAAoBA,QAC5B,CAAC,MAAM,OAAO,IAAI,SAAS,EAAK,GAEhC,aAAa,YAAY,MAAM;AAClB,qBAAA,EAAI,GACrB,QAAQ,EAAI;AAAA,KACX,CAAC,gBAAgB,CAAC,GACf,cAAc,YAAY,MAAM;AACnB,qBAAA,EAAK,GACtB,QAAQ,EAAK;AAAA,EACZ,GAAA,CAAC,gBAAgB,CAAC,GAEf,cAAc,QAAQ,MAAM,MAAM,OAAO,cAAc,GAAG,CAAC,KAAK,CAAC,GACjE,gBAAgB,QAAQ,MAAM,MAAM,OAAO,CAAC,SAAS,CAAC,eAAe,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAGpF,YAAY,QAAQ,MAAM;AAC9B,UAAM,MAAM,cAAc;AAEtB,QAAA,QAAQ,KAAK,MAAM;AAAU,aAAA;AAE3B,UAAA,OAAO,cAAc,CAAC;AAExB,WAAA,KAAK,SAAS,UACT,CAAC,EAAC,GAAG,MAAM,UAAU,IAAK,IAG5B;AAAA,EACN,GAAA,CAAC,aAAa,CAAC,GAEZ,YAAuC;AAAA,IAC3C,MAAM;AAAA,MACJ,GAAI,UAAU,SACT;AAAA,QACC;AAAA,UACE,MAAM;AAAA,UACN,UAAU;AAAA,UACV,MAAM;AAAA,UACN,OAAO;AAAA,QACT;AAAA,MAAA,IAEF,CAAC;AAAA,MACL,GAAG;AAAA,IACL;AAAA,IACA,CAAC,aAAa,SAAS;AAAA,EAAA;AAGzB,SAEK,oBAAA,UAAA,EAAA,UAAA,UAAU,IAAI,CAAC,MAAM,QACpB;AAAA,IAAC;AAAA,IAAA;AAAA,MAGC;AAAA,MACA,QAAQ;AAAA,MACR,SAAS;AAAA,MACT;AAAA,IAAA;AAAA,IAJK;AAAA,EAMR,CAAA,EACH,CAAA;AAEJ,CAAC,GAEK,0BAA0B,KAAK,SAAiCA,QAKnE;AACD,QAAM,EAAC,MAAM,QAAQ,SAAS,SAAQA;AAEtC,SAAI,KAAK,SAAS,YACT,oBAAC,MAAK,EAAA,YAAU,IAAC,MAAK,OAAO,CAAA,IAGlC,KAAK,SAAS,WAEd;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAM,KAAK;AAAA,MACX,MAAK;AAAA,MACL,SAAS,KAAK;AAAA,MACd,cAAc;AAAA,QACZ,GAAG;AAAA,QACH,SAAS,KAAK;AAAA,MAChB;AAAA,IAAA;AAAA,EAAA,IAKE,oBAAA,0BAAA,EAAyB,MAAY,QAAgB,SAAkB,KAAY,CAAA;AAC7F,CAAC,GAEK,iCAA6D;AAAA,EACjE,eAAe;AAAA,EACf,WAAW;AAAA,EACX,QAAQ;AAAA,EACR,oBAAoB,CAAC,OAAO,QAAQ;AACtC;AAEA,SAAS,yBAAyBA,QAK/B;AACK,QAAA,EAAC,MAAM,QAAQ,SAAS,KAAA,IAAQA,QAChC,EAAC,MAAA,IAAS,YAAY,IAAI;AAG9B,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM,KAAK;AAAA,UACX,OAAO,OAAO,SAAY;AAAA,UAC1B,MAAK;AAAA,UACL,cAAc;AAAA,YACZ,GAAG;AAAA,YACH,SAAS,KAAK;AAAA,UAChB;AAAA,QAAA;AAAA,MACF;AAAA,MAEF,IAAI,MAAM;AAAA,MACV,0BACG,MACE,EAAA,UAAA,KAAK,SAAS,IAAI,CAAC,QAAQ,QAAQ;AAvJ9C,YAAAW;AAyJc,eAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA,SAAS,QAAQ;AAAA,YAGjB,eAAaA,MAAK,KAAA,SAAS,MAAM,CAAC,MAArB,oBAAwB,UAAS;AAAA,UAAA;AAAA,UADzC;AAAA,QAAA;AAAA,MAIV,CAAA,GACH;AAAA,MAEF;AAAA,MACA;AAAA,MACA,SAAS;AAAA,IAAA;AAAA,EAAA;AAGf;AC9JO,MAAM,sBAAsB,cAAwC;AAAA,EACzE,cAAc,CAAC;AAAA,EACf,cAAc,MAAG;AAAA,EAAA;AAAA,EACjB,cAAc,MAAG;AAAA,EAAA;AACnB,CAAC;ACVM,SAAS,kBAA4C;AAC1D,SAAO,WAAW,mBAAmB;AACvC;ACOO,MAAM,sBAAsB,cAAwC;AAAA,EACzE,SAAS,CAAC;AAAA,EACV,SAAS;AAAA,EACT,SAAS;AAAA,EACT,cAAc,MAAG;AAAA,EAAA;AAAA,EACjB,cAAc,MAAG;AAAA,EAAA;AACnB,CAAC;ACJM,SAAS,qBAAqBX,QAAkC;AACrE,QAAM,EAAC,SAAS,UAAU,MAAM,QAAO,IAAIA,QACrC,EAAC,cAAc,mBAAmB,cAAc,kBAAA,IAAqB,gBAAgB,GAErF,cAAc,gBAAkB,EAAA,aAAa,CAAC,GAC9C,UAAU,kBAAkB,cAAc0C,eAAa,IAAI,MAAM,cAAc,KAE/E,mBAAmB,YAAY,MAAM;AACzC,sBAAkB,IAAI;AAAA,EAAA,GACrB,CAAC,mBAAmB,IAAI,CAAC,GAEtB,mBAAmB,YAAY,MAAM;AACzC,sBAAkB,IAAI;AAAA,KACrB,CAAC,mBAAmB,IAAI,CAAC,GAEtB,UAAoC;AAAA,IACxC,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA,cAAc;AAAA,MACd,cAAc;AAAA,IAAA;AAAA,IAEhB,CAAC,SAAS,SAAS,kBAAkB,kBAAkB,OAAO;AAAA,EAAA;AAGhE,6BAAQ,oBAAoB,UAApB,EAA6B,OAAO,SAAU,SAAS,CAAA;AACjE;ACzCO,SAAS,cAAc,SAA+D;AAC3F,SAAO,QACJ,OAAO,OAAO,EACd,OAAO,CAAC,SACH,YAAY,OAAa,KAAK,WAAW,KACtC,EACR,EACA,IAAI,CAAC,SACA,KAAK,SAAS,UACT;AAAA,IACL,GAAG;AAAA,IACH,UAAU,cAAc,KAAK,QAAQ;AAAA,MAIlC,IACR;AACL;ACiBa,MAAA,uBAAuB,KAAK,SAAsB1C,QAA0B;AACvF,QAAM,EAAC,SAAS,YAAY,cAAc,WAAW,MAAM,WAAc,IAAAA,QAEnE,MAAM,QAAQ,QACd,SAAS,OAAO,GAAG,GAEnB,CAAC,cAAc,eAAe,IAAI;AAAA,IAAoC,MAC1E,MAAM,KAAK,IAAI,MAAM,GAAG,CAAC;AAAA,EAAA,GAGrB,kBAAkB,OAAO,YAAY,GAErC,iBAAiB,YAAY,CAAC,OAAe,SAAkC;AACnF,oBAAgB,CAAC,SAAS;AAClB,YAAA,OAAO,CAAC,GAAG,IAAI;AAChB,aAAA,KAAA,KAAK,IAAI,MACP;AAAA,IAAA,CACR;AAAA,EACH,GAAG,CAAE,CAAA;AAEL,SAAA,UAAU,MAAM;AACV,oBAAgB,YAAY,iBAC9B,gBAAgB,UAAU,cAC1B,UAAU,cAAc,YAAY,CAAC;AAAA,KAEtC,CAAC,cAAc,SAAS,CAAC,GAE5B,UAAU,MAAM;AACV,QAAA,OAAO,YAAY,KAAK;AAC1B,YAAM,kBAAkB,MAAM,KAAK,IAAI,MAAM,GAAG,CAAC;AAExC,eAAA,IAAI,GAAG,IAAI,KAAK;AACvB,wBAAgB,CAAC,IAAI,gBAAgB,QAAQ,CAAC;AAGhD,aAAO,UAAU,KAEjB,gBAAgB,eAAe,GAC/B,gBAAgB,UAAU;AAAA,IAC5B;AAAA,EACF,GAAG,CAAC,GAAG,CAAC,mCAIH,UAAQ,QAAA,IAAI,CAAC,GAAG,SACf;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAQ;AAAA,MACR,OAAO;AAAA,MAGP;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,IALK;AAAA,EAOR,CAAA,EACH,CAAA;AAEJ,CAAC,GAYK,cAAc,KAAK,SAAqBA,QAAyB;AAC/D,QAAA,EAAC,QAAQ,YAAY,cAAc,OAAO,MAAM,YAAY,eAAA,IAAkBA,QAE9E,OAAO;AAAA,IACX,OAAO,UAAU;AAAA,MACf;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA,CACD;AAAA,EAAA;AAGH,SAAA,UAAU,MAAM;AACd,mBAAe,OAAO,IAAI;AAAA,KACzB,CAAC,OAAO,MAAM,cAAc,CAAC,GAEzB;AACT,CAAC;ACvHM,SAAS,kBAA4C;AAC1D,SAAO,WAAW,mBAAmB;AACvC;ACFa,MAAA,2BAA2B,cAAkC,CAAE,CAAA,GCYtE,8BAA4C;AAAA,EAChD,QAAQ;AACV,GAEM,iBAAiB,OAAO,IAAI,CAACA,WAAU;AAC3C,QAAM,EAAC,MAAS,IAAA,YAAYA,OAAM,KAAK;AAEhC,SAAA;AAAA,cACK,IAAI,MAAM,CAAC,CAAC;AAAA;AAE1B,CAAC,GAEK,iBAAiB,CAAC,aAA+C;AACrE,MAAI,SAAS,WAAW;AACtB,WAAO,GAAG,SAAS,CAAC,EAAE,KAAK,WAAW;AAGxC,MAAI,SAAS,SAAS;AACb,WAAA,GAAG,SAAS,MAAM;AAI7B;AAGO,SAAS,wBAAwBA,QAAqC;AAC3E,QAAM,EAAC,SAAA,IAAYA,QAEb,cAAc;AAAA,IAClB,MACE,MAAM,KAAK,IAAI,IAAI,SAAS,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC,EAC/C,IAAI,CAACR,QACG,SAAS,KAAK,CAAC,MAAM,EAAE,KAAK,OAAOA,GAAE,CAC7C,EACA,OAAOY,eAAa;AAAA,IACzB,CAAC,QAAQ;AAAA,EAAA,GAGL,iBAAiB,QAAQ,MAAM,eAAe,WAAW,GAAG,CAAC,WAAW,CAAC;AAE/E,SACG,oBAAA,SAAA,EAAQ,SAAS,gBAAiB,GAAG,6BACpC,UAAA,oBAAC,gBACC,EAAA,UAAA,oBAAC,eAAY,WAAW,GAAG,cAAY,eAAe,WAAW,GAAG,MAAM,GACvE,UAAA,YAAY,IAAI,CAAC,SACf,oBAAA,YAAA,EAA8B,MAAM,GAAG,MAAM,KAAK,KAAA,GAAlC,KAAK,KAAK,EAA8B,CAC1D,EACH,CAAA,GACF,EACF,CAAA;AAEJ;ACvCA,MAAM,UAAU,iCACV,aAAa,WAAC,qBAAiB,GAAC,GAEhC,4BAAqE;AAAA,EACzE,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,OAAO;AACT;AAEA,SAAS,eAAe,UAAkB;AACxC,QAAM,aAAa,SAAS,QAAQ,SAAS,EAAE,EAAE,MAAM,UAAU;AAEjE,SAAI,WAAW,WAAW,IACjB,GAAG,WAAW,CAAC,EAAE,OAAO,CAAC,CAAC,GAAG,YAG/B,IAAA,GAAG,WAAW,CAAC,EAAE,OAAO,CAAC,CAAC,GAAG,WAAW,WAAW,SAAS,CAAC,EAAE,OAAO,CAAC,CAAC;AACjF;AAKO,SAAS,WAAWJ,QAAwB;AACjD,QAAM,EAAC,MAAM,GAAG,UAAA,IAAaA;AAEzB,SAAAO,WAAS,IAAI,IACX,UAAU,cACJ,oBAAA,mBAAA,EAAmB,GAAG,WAAW,MAAoB,IAGvD,oBAAA,kBAAA,EAAkB,GAAG,WAAW,MAAoB,IAGtD,oBAAA,kBAAA,EAAkB,GAAGP,QAAO,KAAsB,CAAA;AAC5D;AAEA,SAAS,kBAAkBA,QAAqD;AACxE,QAAA;AAAA,IACJ,MAAM,EAAC,YAAW;AAAA,EAChB,IAAAA;AAGF,SAAA,oBAAC,WAAQ,SAAS,aAAa,WAAU,OAAM,QAAM,IACnD,UAAC,oBAAA,OAAA,EAAI,OAAO,EAAC,SAAS,kBACpB,UAAA,oBAAC,oBAAkB,GAAGA,OAAA,CAAO,EAC/B,CAAA,EACF,CAAA;AAEJ;AAEA,MAAM,mBAAmB,WAAW,SAClCA,QACA,KACA;AACM,QAAA,EAAC,MAAM,kBAAkB,UAAU,MAAM,QAAQ,MAAM,GAAG,UAAA,IAAaA,QACvE,CAAC,gBAAgB,iBAAiB,IAAI,SAAuB,IAAI,GACjE,YAAY,aAAa,KAAK,EAAE,GAChC,WAAW,kBAA6B,QAAZ,OAAA,SAAY,KAAM;AAGlD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,4BAA0B;AAAA,MAC1B;AAAA,MACA,eAAe;AAAA,MACf,OAAO,UAAU;AAAA,MACjB,oBAAkB;AAAA,MAClB,WAAU,QAAA,OAAA,SAAA,KAAM,gBAAe,eAAe,KAAK,WAAW;AAAA,MAC9D,KAAK;AAAA,MACL,kBAAkB;AAAA,MAClB;AAAA,MACA,MAAM,OAAO,QAAS,WAAW,0BAA0B,IAAI,IAAI;AAAA,MACnE;AAAA,MACA,OAAO,QAAM,OAAA,SAAA,KAAA;AAAA,MACZ,GAAG;AAAA,IAAA;AAAA,EAAA;AAGV,CAAC;AAED,SAAS,iBAAiB,EAAC,MAAM,GAAG,eAA8D;AAChG,QAAM,CAAC,KAAK,IAAI,QAAQ,IAAI;AAE5B,SAAK,QAKG,oBAAA,YAAA,EAAY,GAAG,aAAa,MAAM,OAAO,IAHxC;AAIX;ACnHO,MAGM,mBAAmB,GAEnB,6BAA6B,GAG7B,kBAAkB,IAGlB,cAAc,IAEd,sBAAsB,GAItB,0BAA0B,CAAC,GAAG,MAAM,MAAM,CAAC,GAG3C,+BAA+B,IAG/B,4BAA4B,GAG5B,+BAA+B,GAG/B,4BAA4B,IAG5B,+BAA+B,IAG/B,QAAQ,IC/BRqF,gBAAc,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,GAOzB,WAAW,OAAO,IAAI;AAAA,YACvB,WAAW;AAAA;AAAA;AAAA,GCRjB,EAAC,SAAS,aAAa,kBAAA,IAAqB,mBAAsC;ACajF,SAAS,gBAAgBrF,QAA6B;AAC3D,QAAM,EAAC,UAAU,MAAK,IAAIA,QAEpB,UAAU;AAAA,IACd,MACE,oBAAC,OAAM,EAAA,QAAO,UACX,UAAM,MAAA,IAAI,CAAC,SACT,qBAAA,MAAA,EAAK,OAAM,UAAS,KAAK,GACxB,UAAA;AAAA,MAAC,oBAAA,OAAA,EACC,8BAAC,YAAW,EAAA,MAAM,KAAK,MAAM,QAAO,UAAS,EAC/C,CAAA;AAAA,0BAEC2B,QAAK,EAAA,MAAM,GAAI,UAAA,KAAK,KAAK,aAAY;AAAA,IAAA,EAAA,GALN,KAAK,KAAK,EAM5C,CACD,EACH,CAAA;AAAA,IAEF,CAAC,KAAK;AAAA,EAAA;AAGR,6BACG,SAAQ,EAAA,SAAkB,WAAU,OAAM,QAAO,yBAC/C,SACH,CAAA;AAEJ;ACzCa,MAAA,aAAa,CAAI,OAAY,QAA4B;AACpE,QAAM,eAAe,MAAM,SAAS,MAAM,MAAM,IAAI,KAC9C,MAAM,KAAK,IAAI,GAAG,MAAM,SAAS,YAAY;AAC5C,SAAA,CAAC,MAAM,MAAM,GAAG,GAAG,GAAG,MAAM,MAAM,GAAG,CAAC;AAC/C;AAaO,SAAS,qBAAqB,KAAqB;AACjD,SAAA,CAAC,mBAAmB,cAAc,mBAAmB;AAC9D;ACOa,MAAA,qBAAqB,KAAK,SAA4B;AAAA,EACjE;AAAA,EACA,WAAW;AAAA,EACX,mBAAmB;AAAA,EACnB,aAAa;AAAA,EACb,QAAQ;AACV,GAA4B;AAC1B,QAAM,iBAAiB,OAAO,YAAY,CAAA,GAAI,CAAC,SAAS,KAAK,KAAK,EAAE,GAC9D,SAAS,OAAO,gBAAgB,CAAC,cAAc,UAAU,YAAY,GACrE,CAAC,QAAQ,OAAO,IAAI,QAAQ,WAAW,QAAQ,UAAU,IAAI,CAAC,CAAI,GAAA,MAAM,GAExE,UAAU;AAAA,IACd,GAAG,QAAQ,QAAA,EAAU,IAAI,CAAC,cAAc;AAAA,MACtC,KAAK,SAAS,KAAK;AAAA,MACnB,SACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA;AAAA,UACA,QAAO;AAAA,UACP,MAAM,SAAS;AAAA,QAAA;AAAA,MACjB;AAAA,IAAA,EAEF;AAAA,IACF,OAAO,UAAU,IACb;AAAA,MACE,KAAK;AAAA,MACL,SAAS,oBAAC,eAAc,EAAA,OAAO,OAAO,QAAQ;AAAA,IAAA,IAEhD;AAAA,EAAA,EACJ,OAAO,OAAO;AAEhB,8BACG0D,eACC,EAAA,UAAA;AAAA,IAAA,oBAAC,OAAI,EAAA;AAAA,IAEJ,oBAAA,UAAA,EAAS,WAAU,eACjB,UAAQ,QAAA;AAAA,MACP,CAAC,IAAI,MACH,MACE;AAAA,QAAC;AAAA,QAAA;AAAA,UAEC,OAAO;AAAA,YACL,UAAU;AAAA,YACV,WAAW,eAAe,CAAC,KAAK,cAAc,gBAAgB;AAAA,YAC9D,oBAAoB;AAAA,YACpB,oBAAoB;AAAA,YACpB,0BAA0B;AAAA,YAC1B,QAAQ,MAAM;AAAA,UAChB;AAAA,UAEC,UAAG,GAAA;AAAA,QAAA;AAAA,QAVC,GAAG;AAAA,MAWV;AAAA,IAAA,GAGR;AAAA,EACF,EAAA,CAAA;AAEJ,CAAC;AASM,SAAS,yBAAyBrF,QAA2B;AAClE,QAAM,kBAAkB,WAAW,wBAAwB,GACrD,EAAC,WAAW,iBAAiB,aAAa,2BAA0B,IAAIA,QACxE,MAAM,OAAO,IAAI;AAEX,cAAA,SAAS,OAAO,EAAC,UAAU,SAAS,IAAI,SAAU,WAAwB,EAAA;AAEtF,QAAM,iBAAiB,QAAQ,MAAM,OAAO,YAAY,CAAA,GAAI,CAAC,SAAS,KAAK,KAAK,EAAE,GAAG,CAAC,QAAQ,CAAC;AAE/F,SACG,oBAAA,iBAAA,EAAgB,OAAO,gBACtB,8BAACqF,eAAY,EAAA,KAAU,OAAO,EAAC,WAAW,aAAa,UAAU,eAAc,EACjF,CAAA;AAEJ;AAGO,SAAS,4BAA4BrF,QAA2B;AAC/D,QAAA,kBAAkB,WAAW,wBAAwB,GACrD,EAAC,WAAW,iBAAiB,aAAa,2BAA8B,IAAAA;AAE9E,SAAK,SAAS,SAIP,oBAAC,oBAAmB,EAAA,UAAoB,YAAwB,IAH9D;AAIX;AAGa,MAAA,gBAET,0BCtHS,6BAA6B,CACxC,YACmC;AAC7B,QAAA,WAAW,IAAI,QAAmC,GAClD,uBAAuB,IAAI,qBAAqB,CAAC,YAAY;AACzD,YAAA,QAAQ,CAAC,UAAU;AACzB,eAAS,KAAK,KAAK;AAAA,IAAA,CACpB;AAAA,KACA,OAAO;AACH,SAAA;AAAA,IACL,SAAS,CAAC,YACD,IAAI,WAAsC,CAAC,eAAe;AAC/D,YAAM,eAAe,SAClB,KAAK,OAAO,CAAC,UAAU,MAAM,WAAW,OAAO,CAAC,EAChD,UAAU,UAAU;AACF,aAAA,qBAAA,QAAQ,OAAO,GAC7B,MAAM;AACX,qBAAa,YAAY,GACzB,qBAAqB,UAAU,OAAO;AAAA,MAAA;AAAA,IACxC,CACD;AAAA,EAAA;AAGP,GCnBa,mBAAmB,CAACA,WAA6D;AACtF,QAAA,EAAC,gBAAgB,IAAI,IAAAR,KAAI,GAAG,SAAQQ,QACpC,UAAU,OAA8B,IAAI;AAClD,SAAA,UAAU,MAAM;AACd,UAAM,KAAK,QAAQ;AACnB,QAAI,CAAC;AAAI;AACT,UAAM,eAAe,GAClB,QAAQ,EAAE,EACV,KAAK,IAAI,CAAC,UAAU,eAAeR,KAAI,KAAK,CAAC,CAAC,EAC9C,UAAU;AACN,WAAA,MAAM,aAAa;EACzB,GAAA,CAAC,IAAIA,KAAI,cAAc,CAAC,GACpB,oBAAC,OAAI,EAAA,KAAK,SAAU,GAAG,KAAM,CAAA;AACtC,GCfa,cAAc,OAAO;AAAA;AAAA,GAIrB,iBAAiB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAUxB,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,GAOhB,mBAAmB,OAAO,gBAAgB,EAAc,CAAC,EAAC,QAAQ,QACtE,MAAA;AAAA,MACH,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA,WAKR,UAAU,GAAG,QAAQ,CAAC,IAAI,CAAC,OAAO,MAAS;AAAA,wBAC9B,SAAS,QAAQ,MAAM;AAAA,GAE9C,GAEY,sBAAsB,OAAO,gBAAgB,EAAc,CAAC,EAAC,OACjE,MAAA;AAAA,MACH,aAAa;AAAA;AAAA;AAAA;AAAA,MAIb,UACF;AAAA;AAAA;AAAA;AAAA,KAIC;AAAA,GAEJ,GAEY,sBAAsB,OAAO,gBAAgB,EAAc,CAAC,EAAC,OACjE,MAAA;AAAA,MACH,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA,wBAKK,SAAS,SAAS,aAAa;AAAA,GAEtD,GCzBK,OAAO,CAAC,QAAgB,GAAG,GAAG,MAC9B,SAAS,CAAC,QAAgB,IAAI,KAEvB,2BAA2B,WAAW,SACjDQ,QACA,KACA;AACM,QAAA,EAAC,SAAS,QAAAsF,SAAQ,UAAU,SAAS,gBAAetF,QAEpD,aAAa,OAA8B,IAAI,GAI/C,UAAU,QAAQ,MAAM,aAAa,CAAC,KAAK,UAAU,WAAW,CAAC,CAAC,GAElE,KAAK;AAAA,IACT,MACE,2BAA2B;AAAA,MACzB,YAAY,QAAQ,IAAI,MAAM,EAAE,IAAI,IAAI,EAAE,KAAK,GAAG;AAAA,MAClD,WAAW;AAAA,IAAA,CACZ;AAAA,IACH,CAAC,OAAO;AAAA,EAGJ,GAAA,CAAC,eAAe,gBAAgB,IAAI,SAUxC,CAAA,CAAE,GAEE,iBAAiB,YAAY,CAACR,KAAS,UAAe;AACzC,qBAAA,CAAC,aAAa,EAAC,GAAG,SAAS,CAACA,GAAE,GAAG,MAAO,EAAA;AAAA,EACxD,GAAA,EAAE,GAEC,MAAM,cAAc,OAAO,GAC3B+F,UAAS,cAAc,UAAU,GACjC,iCAAkE;AAAA,IACtE,MACG,OAAOA,UACJ,QACG,OAAO,CAAC,WAAQ;AAvF7B,UAAA5E;AAuFuC,eAAAA,MAAA,OAAA,aAAP,oBAAiB,UAAS;AAAA,IAAA,CAAC,EAC9C,IAAI,CAAC,WAAiD;AAC/C,YAAA6E,gBAAe,cAAc,OAAO,EAAE;AAE5C,UAAI,CAACA;AACI,eAAA;AAGH,YAAA,EAAC,QAAQ,cAAc,KAAK,UAAA,IAAaA,cAAa,oBAEtD,WAAWA,cAAa,mBAAmB,MAAM,IAAI,mBAAmB,QACxE,cACJA,cAAa,mBAAmB,MAAMD,QAAO,mBAAmB,KAG5D,cAAcC,cAAa,iBAC7B,aAAaA,cAAa,iBAAiB,MAAM,gCACjD,WACE,CAAC,IAAI,mBAAmB,SACxBD,QAAO,mBAAmB,KAG1B,iBAAiBC,cAAa,iBAChC,EACE,gBACCA,cAAa,iBAAiB,SAAS,iCAE1C,cACED,QAAO,mBAAmB,MAC1B,CAAC,IAAI,mBAAmB,QAExB;AAAA;AAAA,QAEJ,eAAe,4BACX,QACA,kBAAkB,+BAChB,WACA;AAAA;AAED,aAAA;AAAA,QACL;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,IACF,CACD,EACA,OAAO,OAAO,IACjB,CAAC;AAAA,IACP,CAACA,SAAQ,eAAe,SAAS,GAAG;AAAA,EAAA;AAIpC,SAAA,qBAAC,eAAY,KACX,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ;AAAA,QACR;AAAA,QACA,IAAG;AAAA,QACH;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,IACA,oBAAC,SAAK,UAAS;AAAA,IACf,oBAAC,gBAAe,EAAA,KAAK,YAClB,UAAA,WAAW,WACVD,QAAO,gCAAgC,WAAW,QAAQ,WAAW,EACzE,CAAA;AAAA,IACC,QAAQ,IAAI,CAAC,WAAW;AACjB,YAAA,aAAa,OAAO,KAAK,UAAU;AAEvC,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAQ;AAAA,UACR;AAAA,UACA;AAAA,UAEA,IAAI,OAAO;AAAA,UACX,OAAO;AAAA,YACL,OAAO,aAAa,IAAI,OAAO,KAAK;AAAA,YACpC,MAAM,OAAO,KAAK,QAAQ,aAAa,IAAI;AAAA,YAC3C,KAAK,OAAO,KAAK,MAAM;AAAA,YACvB,QAAQ,OAAO,KAAK,SAAS,+BAA+B;AAAA,UAC9D;AAAA,QAAA;AAAA,QAPK,OAAO;AAAA,MAAA;AAAA,IAQd,CAEH;AAAA,wBACA,qBAAoB,EAAA,QAAQ,OAAO,IAAG,YAAW,IAAQ,gBAAgC;AAAA,EAC5F,EAAA,CAAA;AAEJ,CAAC,GC5IK,kBAAiC;AAAA,EACrC,oBAAoB;AAAA,EACpB,oBAAoB;AAAA,EACpB,0BAA0B;AAC5B,GAEM,SAAS,CAAC,SAAwC,KAAK,MAAM,KAAK;AAMxE,SAAS,iBACP,gCAC0B;AAC1B,SAAO,+BAA+B;AAAA,IACpC,CAAC,kBAAkB,KAAK,oCAAoC;AAjDhE,UAAA3E;AAkDM,YAAM,YAAWA,MAAA,gCAAgC,MAAM,CAAC,MAAvC,OAAA,SAAAA,IAA0C,OAAO,MAC5D,aAAa,WAAW,OAAO,QAAQ,IAAI;AAC1C,aAAA,EAAC,GAAG,kBAAkB,cAAc,iBAAiB,OAAO,KAAK,MAAM;IAChF;AAAA,EAAA;AAEJ;AAEA,MAAM,aAAa,CAAC,mCAClB,QAAQ,gCAAgC,CAAC,qBAAqB,iBAAiB,OAAO,KAAK,GAAG,GAE1F,OAAO,CAAC,GAAW,MAAc,IAAI,GACrC,MAAM,CAAC,UAAoB,MAAM,OAAO,MAAM,CAAC;AAKrD,SAAS,MAAM,gCAIb;AACA,QAAM,0BAA0B,iBAAiB,WAAW,8BAA8B,CAAC,GACrF,UAIF;AAAA,IACF,KAAK,CAAC;AAAA,IACN,QAAQ,CAAC;AAAA,IACT,QAAQ,CAAC;AAAA,IACT,GAAG,QAAQ,yBAAyB,CAAC,sBAAsB,kBAAkB,QAAQ;AAAA,EAAA;AAGhF,SAAA;AAAA,IACL,KAAK,WAAW,QAAQ,GAAG,EAAE;AAAA,MAC3B,CAAC,kBAAkB,GAAG,SAA0C;AAAA,QAC9D,GAAI;AAAA,QACJ,QAAQ,IACL,MAAM,IAAI,CAAC,EACX,OAAO,CAAC,GAAG,sBAAsB,IAAI,kBAAkB,OAAO,KAAK,OAAO,CAAC;AAAA,MAAA;AAAA,IAElF;AAAA,IACA,QAAQ,WAAW,QAAQ,MAAM,EAAE;AAAA,MACjC,CAAC,sBAAuD;AAAA,QACtD,GAAI;AAAA,QACJ,QAAQ;AAAA,MAAA;AAAA,IAEZ;AAAA,IACA,QAAQ,WAAW,QAAQ,MAAM,EAAE;AAAA,MACjC,CAAC,kBAAkB,GAAG,SAA0C;AAAA,QAC9D,GAAI;AAAA,QACJ,QAAQ,IACL,MAAM,GAAG,CAAC,EACV,OAAO,CAAC,GAAG,sBAAsB,IAAI,kBAAkB,OAAO,KAAK,OAAO,CAAC;AAAA,MAAA;AAAA,IAElF;AAAA,EAAA;AAEJ;AAEA,MAAM,SAAS,CAAC,EAAC,QAAQ,GAAG,KAAI,MAC7B,oBAAA,OAAA,EAAI,OAAO,EAAC,QAAQ,KAAK,IAAI,GAAG,MAAM,GAAG,GAAG,QAAM,OAAA,SAAA,KAAA,MAAA,EAAQ,CAAA,GAGvD8E,oBAA2B,CAAC,GAAG,GAAG,GAAG,CAAC,GAEtC,eAAe,CAAC,QAAqB,WAAwB;AACjE,MAAI,KAAyB,QACzB,MAAM,CAAC,GAAG,WACV,OAAO;AACX,SAAO,MAAM,OAAO;AAClB,WAAO,GAAG,YAAY,GAAG,WACzB,QAAQ,GAAG,YACX,KAAK,GAAG,wBAAwB,cAAc,GAAG,eAAe;AAE3D,SAAA,EAAC,KAAK;AACf;AAEA,SAAS,gBAAgB,SAAsB,QAA2B;AACjE,SAAA;AAAA,IACL,GAAG,aAAa,SAAS,MAAM;AAAA,IAC/B,OAAO,QAAQ;AAAA,IACf,QAAQ,QAAQ;AAAA,EAAA;AAEpB;AAEA,SAAS,yBACP,SACA,QAC6C;AAC7C,SAAO,QAAQ,IAAI,CAAC,CAACjG,KAAI,MAAM,OAAO;AAAA,IACpC,GAAG;AAAA,IACH,IAAAA;AAAA,IACA,MAAM,gBAAgB,OAAO,SAAS,MAAM;AAAA,EAC5C,EAAA;AACJ;AAGO,SAAS,cAAcQ,QAAc;AAC1C,QAAM,EAAC,UAAU,UAAUyF,kBAAA,IAAmBzF,QACxC,iBAAiB,kBAAA,GACjB,MAAM,OAA8B,IAAI,GACxC,UAAU;AAAA,IACd,MAAO,IAAI,UAAU,yBAAyB,gBAAgB,IAAI,OAAO,IAAIM;AAAAA,IAC7E,CAAC,cAAc;AAAA,KAGX,iBAAiB;AAAA,IACrB,CAAC,gCAAiE,mBAAwB;AACxF,YAAM,UAAU;AAAA,QACd,+BAA+B,OAAO,CAAC,SAAS,KAAK,OAAO,SAAS,SAAS,CAAC;AAAA,MAAA,GAE3E,aAAa,IAAI,QAAQ,IAAI,IAAI,CAAC,MAAM,EAAE,OAAO,KAAK,SAAS,EAAE,YAAY,CAAC,GAC9E,gBAAgB;AAAA,QACpB,CAAC,GAAG,QAAQ,QAAQ,GAAG,QAAQ,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,OAAO,KAAK,SAAS,EAAE,YAAY;AAAA,MAAA,GAInF,SAAS,QAAQ,OAAO;AAAA,QAC5B,CAAC,SAAS,qBAAqB;AACvB,gBAAA,EAAC,aAAa,eAAc,IAAI,kBAEhC,UAAU,eAAe,2BACzB,aAAa,kBAAkB;AAC9B,iBAAA;AAAA,YACL,SAAS,QAAQ,WAAW,UAAU,iBAAiB,OAAO,SAAS,SAAS;AAAA,YAChF,YACE,QAAQ,cAAc,aAAa,iBAAiB,OAAO,SAAS,SAAS;AAAA,UAAA;AAAA,QAEnF;AAAA,QACA,EAAC,SAAS,GAAG,YAAY,EAAC;AAAA,MAAA;AAG5B,aAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,YAAY,OAAO;AAAA,YACnB;AAAA,YACA,UAAS;AAAA,YACT,gCAAgC,QAAQ;AAAA,UAAA;AAAA,QAC1C;AAAA,QACA,oBAAC,QAAO,EAAA,QAAQ,WAAY,CAAA;AAAA,QAC5B;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA,gCAAgC,QAAQ;AAAA,UAAA;AAAA,QAC1C;AAAA,QACA,oBAAC,QAAO,EAAA,QAAQ,cAAe,CAAA;AAAA,QAC/B;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,YAAY,OAAO;AAAA,YACnB;AAAA,YACA,UAAS;AAAA,YACT,gCAAgC,QAAQ;AAAA,UAAA;AAAA,QAC1C;AAAA,MACF,EAAA,CAAA;AAAA,IAEJ;AAAA,IACA,CAAC,OAAO;AAAA,EAAA;AAGV,6BACG,0BAAyB,EAAA,KAAU,SAAkB,SAAkB,QAAQ,gBAC7E,SACH,CAAA;AAEJ;AAEA,MAAMA,gBAAuB,CAAA,GAEvB,eAAe,KAAK,SAAsBN,QAK7C;AACD,QAAM,EAAC,YAAY,SAAS,UAAU,mCAAkCA,QAClE,MAAM,aAAa,QAAQ,IAAI,IAC/B,mBAAmB,QAAQ,MAC1B,+BAA+B,SAI7BwD;AAAAA,IACL,OAAO,gCAAgC,CAAC,MAAM,EAAE,OAAO,KAAK,MAAM,GAAG,EAAE;AAAA,MACrE,CAAC,qBAAqB,iBAAiB,OAAO,YAAYlD;AAAAA,IAC5D;AAAA,EAAA,IANOA,eAQR,CAAC,KAAK,8BAA8B,CAAC,GAClC,CAAC,WAAW,aAAa,cAAc,UAAU,IAAI,SACrD,cACH,cAAc,MACd,iBAAiB,SAAS,IAAI,CAAC,cAAc,cAAc,mBAAmB,KAC/E,aAEI,SAAS,aAAa,QAAQ,YAAY,cAE1C,QAAuB;AAAA,IAC3B,OAAO;AAAA,MACL,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,SAAS;AAAA,MACT,eAAe;AAAA,MACf,YAAY;AAAA,MACZ,GAAG;AAAA,MACH,WAAW,eAAe,UAAU;AAAA,MACpC,KAAK,sBAAsB,IAAI;AAAA,MAC/B,QAAQ,sBAAsB,IAAI;AAAA,IAAA;AAAA,IAEpC,CAAC,YAAY,MAAM;AAAA,EAAA;AAGrB,SACG,oBAAA,OAAA,EAAI,aAAW,UAAqC,OACnD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,YAAY;AAAA,MACZ,UAAU;AAAA,IAAA;AAAA,EACZ,EAAA,GAL6B,UAAU,QAAQ,EAMjD;AAEJ,CAAC;AAED,SAAS,eAAeN,QAGrB;AACK,QAAA,EAAC,gCAAgC,eAAkB,IAAAA;AAEzD,SAEK,oBAAA,UAAA,EAAA,UAAA,+BAA+B,IAAI,CAAC,qBAAqB;AAClD,UAAA,eAAe,iBAAiB,OAAO,KAAK,MAC5C,EAAC,aAAa,eAAc,IAAI,kBAEhC,UAAU,eAAe,2BACzB,aAAa,kBAAkB,8BAE/B,YAAY,iBAAiB,eAAe,iBAAiB,OAAO,KAAK,OAEzE,EAAC,UAAU,WAAU,IAAI,iBAAiB;AAE9C,WAAA,oBAACuB,YAAA,EACC,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAO;AAAA,UACL,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,GAAG;AAAA,UACH,MAAM;AAAA,UACN,WAAW,eAAe,WAAW,aAAa,YAAY,CAAC;AAAA,UAC/D,QAAQ,iBAAiB,OAAO,KAAK;AAAA,UACrC,KAAK,iBAAiB,OAAO,KAAK;AAAA,QACpC;AAAA,QAEA,UAAA,oBAAC,cAAW,OAAO,MAAM,SAAI,WAAW,MAAM,cAAc,UAC1D,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,OAAO,CAAC,WAAW,CAAC;AAAA,YAEpB,UAAU,UAAU,QAAQ,aAAa,WAAW;AAAA,YACpD;AAAA,YACA;AAAA,UAAA;AAAA,QAAA,GAEJ;AAAA,MAAA;AAAA,IACF,EAAA,GArBa,iBAAiB,OAAO,EAsBvC;AAAA,EAEH,CAAA,EACH,CAAA;AAEJ;AAEA,MAAM,cAAc,CAACvB,WAAyDA,OAAM,UAE9E,aAwBF,aC5UE,kBAAoD,CAAC,GAAG,GAAG,GAAG,CAAC;AAErE,SAAS,eAAe,EAAC,UAAU,WAAgC;AAE/D,SAAA,oBAAC,WACC,UAAC,oBAAA,eAAA,EAAc,SAAS,WAAW,iBAAkB,SAAS,CAAA,EAChE,CAAA;AAEJ;AAGO,SAAS,gBAAgBA,QAA6B;AAC3D,SAAOA,OAAM;AACf;AAGa,MAAA,kBAAsD,gBCjB7DgF,SAAO,OAAO,IAAI,EAIrB,CAAC,EAAC,OAAO,oBAAoB,YAAY,2BAA0B;AAC9D,QAAA,EAAC,MAAK,IAAI,MAAM;AACf,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAUM,aAAa,qBAAqB,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAOxC,cAAc,uBAAuB,qBAAqB,KAAK,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAIxF,CAAC,GAEK,aAAa,OAAO,GAAG,EAE1B,CAAC,EAAC,OAAO,wBAAuB;AAC3B,QAAA,EAAC,MAAK,IAAI,MAAM;AACf,SAAA;AAAA,6BACoB,oBAAoB,MAAM,CAAC,CAAC;AAAA;AAAA;AAGzD,CAAC,GAEK,UAAU,OAAO,GAAG,EAGvB,CAAC,EAAC,OAAO,QAAQ,2BAA0B;AACtC,QAAA,EAAC,MAAK,IAAI,MAAM,QAChB,QAAQ,uBAAuB,SAAS,MAAM,CAAC,IAAI;AAClD,SAAA;AAAA;AAAA;AAAA,aAGI,KAAK;AAAA;AAElB,CAAC,GAEK,2BAA2B,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GA8DtC,mBAAmB,OAAO,IAAI;AAAA;AAAA;AAAA,GAK9B,cAAc;AAYb,SAAS,oBAAoBhF,QAAiC;AAC7D,QAAA;AAAA,IACJ,qBAAqB;AAAA,IACrB,iBAAiB;AAAA,IACjB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QACE,CAAC,SAAS,UAAU,IAAI,SAAkB,EAAK,GAE/C,CAAC,UAAU,WAAW,IAAI,SAAkB,EAAK,GAGjD,CAAC,qBAAqB,sBAAsB,IAAI,SAAgC,IAAI,GACpF,CAAC,mBAAmB,oBAAoB,IAAI,SAAiB,CAAC,GAG9D,CAAC,aAAa,cAAc,IAAI,SAAgC,IAAI,GACpE,CAAC,WAAW,YAAY,IAAI,SAAiB,CAAC,GAG9C;AAAA,IACJ,cAAc;AAAA,IACd,QAAQ,gBAAgB;AAAA,IACxB,kBAAkB;AAAA,EACpB,IAAI,YAAY,CAEV,GAAA,aAAa,WAAW,QAAQ,SAAS,GACzC,mBAAmB,gBAAgB,gBAAgB,YAAY,iBAK/D,8BAA6B,YAAU,OAAA,SAAA,SAAA,WAAU,YAGjD,yBAAyB,WAAW,oBAAoB,aAExD,oCAAoC,YAAY,MAAM;AAC1D,QAAI,qBAAqB;AACvB,YAAM,EAAC,MAAA,IAAS,oBAAoB,sBAAsB;AAC1D,2BAAqB,SAAS,CAAC;AAAA,IACjC;AAAA,KACC,CAAC,mBAAmB,CAAC,GAMlB,qBAAqB,YAAY,MAAM;AACT,yCAClC,WAAW,EAAI;AAAA,KACd,CAAC,iCAAiC,CAAC,GAEhC,oBAAoB,YAAY,MAAM;AACR,yCAClC,WAAW,EAAK;AAAA,EAAA,GACf,CAAC,iCAAiC,CAAC;AAGtC,YAAU,MAAM;AACoB;KACjC,CAAC,mCAAmC,gBAAgB,CAAC,GAGxD,UAAU,MAAM;AACd,QAAI,aAAa;AACf,YAAM,EAAC,MAAA,IAAS,YAAY,sBAAsB;AAClD,mBAAa,SAAS,CAAC;AAAA,IACzB;AAAA,EAAA,GACC,CAAC,WAAW,CAAC;AAGV,QAAA,SAAS,QAAQ,MAChB,OAGH;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,sBAAsB,CAAQ,CAAA;AAAA,MAC9B,QAAQ;AAAA,MACR,KAAK;AAAA,MAEJ,UAAA;AAAA,IAAA;AAAA,MARa,MAWjB,CAAC,mBAAmB,kBAAkB,IAAI,CAAC;AAG5C,SAAA;AAAA,IAACgF;AAAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,SAAQ;AAAA,MACR,sBAAsB;AAAA,MACtB,oBAAoB;AAAA,MACpB,YAAY;AAAA,MAEZ,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,WAAQ;AAAA,YACR,MAAM;AAAA,YACN,UAAU;AAAA,YACV,mBAAmB,qBAAqB,WAAW;AAAA,YAElD,UAAA;AAAA,UAAA;AAAA,QACH;AAAA,QAEC,YAAY,SAAS,SAAS,yBAC5B,KAAI,EAAA,WAAQ,eAAc,MAAK,QAC9B,UAAC,oBAAA,eAAA,EAAc,YAAY,aAAa,SAAoB,CAAA,GAC9D;AAAA,QAGD;AAAA,SAEC,8BAA8B,gBAC9B,oBAAC,2BACC,EAAA,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,wBAAsB,mBAAmB,SAAS;AAAA,YAClD,oBAAkB,aAAa,SAAS;AAAA,YACxC,qBAAmB,cAAc,SAAS;AAAA,YAC1C,gBAAc,yBAAyB,SAAS;AAAA,YAChD,SAAQ;AAAA,YACR,eAAe;AAAA,YACf,gBAAgB;AAAA,YAChB,KAAK;AAAA,YACL,QAAO;AAAA,YAEN,UAAA;AAAA,cAAA,cACE,oBAAA,kBAAA,EAAiB,OAAM,UAAS,WAAQ,oBACvC,UAAC,oBAAA,iBAAA,EAAgB,OAAO,SAAS,kBAAkB,YAAa,CAAA,GAClE;AAAA,cAGD;AAAA,YAAA;AAAA,UAAA;AAAA,QAAA,GAEL;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAIR;AClRgB,SAAA,oBACdxF,KACA,aACoB;AAChB,MAAA,EAAA,CAAC,eAAe,CAACA;AACrB,WAAO,QAAQA,GAAE;AACnB;ACcA,MAAMc,gBAAuB,CAAC,GAExB,mBAAmB;AAAA,EACvB,OAAO;AAAA,EACP,SAAS;AAAA,EACT,MAAM;AACR,GAEM,cAAc,OAAO,KAAK;AAAA;AAAA,GAI1B,aAAa,OAAOqB,MAAI,EAA2C,CAAC,EAAC,QACrE,MAAA,YAAY,UACP,EAAC,qBAAqB,wCAAA,IAG3B,YAAY,YACP,EAAC,qBAAqB,2CAG3B,YAAY,SACP,EAAC,qBAAqB,uCAGxB,IAAA,CACR,CAAA;AAGM,SAAS,0BAA0B3B,QAAuC;AAC/E,QAAM,EAAC,YAAAmF,cAAa7E,eAAa,wBAAwB,aAAa,UAAU,UAAa,IAAAN,QAEvF,YAAYmF,YAAW,KAAK,CAAC,MAAM,EAAE,UAAU,OAAO,GACtD,cAAcA,YAAW,KAAK,CAAC,MAAM,EAAE,UAAU,SAAS,GAG1D,SAAS,YAAY,UAAU,cAAc,YAAY,QACzD,aAAa,iBAAiB,MAAM;AAGxC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SACE,qBAAC,aAAY,EAAA,OAAO,GACjB,UAAA;AAAA,QAAe,eAAA,oBAAC,8BAA2B,YAAAA,YAAwB,CAAA;AAAA,QAEnE,CAAC,eACA,oBAAA,UAAA,EACG,UAAWA,YAAA,IAAI,CAAC,MAAM;AAAA;AAAA,UAEpB,oBAAA,+BAAA,EAA8B,YAAY,KAAA,GAAW,SAAW;AAAA,SAClE,GACH;AAAA,MAAA,GAEJ;AAAA,MAEF,QAAM;AAAA,MACN;AAAA,MACA,oBAAoB,CAAC,UAAU,SAAS,MAAM;AAAA,MAE9C,UAAC,oBAAA,OAAA,EACC,UAAC,oBAAA,YAAA,EAAW,SAAS,QAAQ,MAAM,UAAU,QAAO,UACjD,UAAA,cAAe,oBAAA,YAAA,CAAA,CAAW,EAC7B,CAAA,GACF;AAAA,IAAA;AAAA,EAAA;AAGN;AAEA,SAAS,8BAA8BnF,QAAyC;AAC9E,QAAM,EAAC,YAAAmF,YAAU,IAAInF,QAEf,aAAa,iBAAiBmF,YAAW,KAAK;AAEpD,8BACG,MACC,EAAA,UAAA;AAAA,IAAA,oBAAC,KAAI,EAAA,aAAa,GAChB,UAAA,oBAAC,cAAW,SAASA,YAAW,OAAO,MAAM,GAC1C,UAAA,cAAe,oBAAA,YAAA,CAAA,CAAW,EAC7B,CAAA,GACF;AAAA,IACA,oBAAC,KAAI,EAAA,MAAM,GACT,UAAA,oBAACxD,UAAK,MAAM,GAAI,UAAWwD,YAAA,QAAA,CAAQ,EACrC,CAAA;AAAA,EACF,EAAA,CAAA;AAEJ;AAEA,SAAS,2BAA2B,EAAC,YAAAA,eAAiD;AAC9E,QAAA,EAAC,GAAAtE,GAAK,IAAA,kBACN,gBAAgB,cAEhB,GAAA,aAAasE,YAAW;AAAA,IAC5B,CAAC,OAAO,SAAU,KAAK,UAAU,UAAU,QAAQ,IAAI;AAAA,IACvD;AAAA,EAAA,GAEI,eAAeA,YAAW;AAAA,IAC9B,CAAC,OAAO,SAAU,KAAK,UAAU,YAAY,QAAQ,IAAI;AAAA,IACzD;AAAA,EAAA,GAGI,YAAY,aAAa,GACzB,cAAc,eAAe;AAE/B,MAAA,CAAC,aAAa,CAAC;AACV,WAAA;AAGT,QAAM,YAAY,aAAatE,GAAE,wCAAwC,EAAC,OAAO,WAAW,CAAA,GACtF,cACJ,eAAeA,GAAE,0CAA0C,EAAC,OAAO,cAAa;AAElF,SAAO,aAAa,cAClB,oBAACc,UAAK,MAAM,GAAI,wBAAc,OAAO,CAAC,WAAW,WAAW,CAAC,EAAE,CAAA,IAE/D,oBAACA,UAAK,MAAM,GAAI,uBAAa,YAAY,CAAA;AAE7C;AAEA,SAAS,sBAAsB;AACvB,QAAA,EAAC,GAAAd,OAAK;AAEV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ,cAAYA,GAAE,sCAAsC;AAAA,MACpD,eAAW;AAAA,MACX,MAAK;AAAA,IAAA;AAAA,EAAA;AAGX;AAEA,SAAS,wBAAwB;AACzB,QAAA,EAAC,GAAAA,OAAK;AAEV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ,cAAYA,GAAE,wCAAwC;AAAA,MACtD,eAAW;AAAA,MACX,MAAK;AAAA,IAAA;AAAA,EAAA;AAGX;AAEA,SAAS,qBAAqB;AACtB,QAAA,EAAC,GAAAA,OAAK;AAEV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ,cAAYA,GAAE,qCAAqC;AAAA,MACnD,eAAW;AAAA,MACX,MAAK;AAAA,IAAA;AAAA,EAAA;AAGX;ACzKA,MAAM,cAAc,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAyBzBP,gBAAuB,CAAA,GAGhB,sBAAsB,KAAK,SACtCN,QACA;AACA,QAAM,EAAC,aAAa,SAAS,OAAO,YAAY,YAAAmF,cAAa7E,cAAe,IAAAN,QACtE,EAAC,GAAAa,GAAC,IAAI,kBACN,iBAAiBsE,YAAW,SAAS,GACrC,iBAAiB,cAAc;AAGnC,SAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,IAAA,qBAAC,MAAK,EAAA,OAAM,UAAS,UAAU,GAC7B,UAAA;AAAA,MAAC,oBAAAxD,QAAA,EAAK,IAAG,SAAQ,SAAS,SAAS,QAAO,UAAS,MAAM,GACtD,UAAA,6BACE,QAAK,EAAA,OAAO,EAAC,OAAO,gCAClB,UAAEd,GAAA,iCAAiC,GACtC,EAEJ,CAAA;AAAA,MAEC,kBACE,qBAAA,aAAA,EAAY,OAAM,UAAS,MAAM,GAC/B,UAAA;AAAA,QAAA,cACE,oBAAA,KAAA,EAAI,YAAY,GACf,8BAAC,OAAM,EAAA,eAAa,oBAAoB,KAAK,IAAI,MAAK,WACnD,UAAEA,GAAA,6BAA6B,EAClC,CAAA,GACF;AAAA,QAGD,kBACC,oBAAC,KAAI,EAAA,YAAY,GACf,UAAA,oBAAC,2BAA0B,EAAA,UAAU,GAAG,WAAU,OAAM,YAAAsE,YAAwB,CAAA,GAClF;AAAA,MAAA,GAEJ;AAAA,IAAA,GAEJ;AAAA,IAEC,cACC,oBAAC,cAAa,EAAA,eAAa,sBAAsB,KAAK,IAAI,MAAK,WAAU,MAAM,GAC5E,UAAA,WAAW,QACd;AAAA,IAGD,eACC,oBAACxD,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,IAAI,oBAAoB,SAAS,WAAW,GAC9D,UACH,aAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ,CAAC,GC9EKrB,gBAAuB,CAAA,GAqChB,YAAY,KAAK,SAC5BN,QACA;AACM,QAAA;AAAA,IACJ,0BAA0B,UAAUM;AAAAA,IACpC,qBAAqB,WAAWA;AAAAA,IAChC,iBAAiB,OAAO;AAAA,IACxB,qBAAqB;AAAA,IACrB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAA6E;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EAAA,IACDnF,QACE,EAAC,SAAS,SAAS,cAAc,aAAA,IAAgB;AAGrD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,cAAY;AAAA,MACZ;AAAA,MACA;AAAA,MACA,OAAO;AAAA,MAMN,UAAA;AAAA,QACC,SAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,qBAAqB;AAAA,YACrB,iBAAiB;AAAA,YACjB;AAAA,YACA,cAAc,CAAQ,CAAA;AAAA,YACtB,cAAc;AAAA,YACd;AAAA,YACA,SACE;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA,YAAAmF;AAAA,gBACA;AAAA,cAAA;AAAA,YACF;AAAA,UAAA;AAAA,QAEJ;AAAA,QAEF,oBAAC,SAAK,UAAS;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGrB,CAAC,GCtFKH,SAAO,OAAO;AAAA;AAAA;AAAA;AAAA,GAMd,eAAe,OAAO,IAAI,EAAE,MAAM,EAAC,aAAa,SAAQ,CAAC,EAAE,CAAChF,WAA0B;AAC1F,QAAM,EAAC,MAAS,IAAAA,QACV,EAAC,WAAW,OAAU,IAAA,MAAM,QAC5B,EAAC,KAAI,IAAI,MAAM,OAAO;AAErB,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAQY,IAAI,OAAO,CAAC,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAQfoB,iBAAe,EAAC,MAAM,UAAU,CAAA,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiBrD,CAAC,GAEK,gBAAgB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAUnB,qBAAqB,KAAK,SAA4BpB,QAAgC;AACjG,QAAM,EAAC,WAAW,aAAa,SAAS,MAAK,IAAIA,QAC3C,EAAC,GAAAa,GAAC,IAAI,eAAe,GAErB,OACH,oBAAAc,QAAA,EAAK,QAAO,UAAS,MAAM,GACzB,UACC,SAAA,oBAAC,QAAK,EAAA,OAAO,EAAC,OAAO,6BAA4B,GAC9C,UAAEd,GAAA,oCAAoC,GACzC,EAEJ,CAAA;AAGF,SAAK,cAKF,oBAAAmE,QAAA,EACC,+BAAC,cAAa,EAAA,MAAK,UAAS,SAC1B,UAAA;AAAA,IAAA,oBAAC,iBACC,UAAC,oBAAArD,QAAA,EAAK,OAAK,IAAC,MAAM,GAChB,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAO;AAAA,UACL,WAAW,UAAU,YAAY,MAAM,OAAO;AAAA,QAChD;AAAA,MAAA;AAAA,OAEJ,EACF,CAAA;AAAA,IAEC;AAAA,EAAA,EACH,CAAA,EACF,CAAA,IAlBQ,oBAAAqD,QAAA,EAAM,UAAK,KAAA,CAAA;AAoBvB,CAAC;AC1CD,SAAS,YAAY,UAAoD;AACvE,SAAO,OAAO,YAAa,aAAa,SAAA,IAAa;AACvD;AAEA,MAAMA,SAAO,OAAO,KAAK,EAAE,MAAM,EAAC,aAAa,YAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GASpDU,YAAU,OAAO,GAAG,EAQvB,CAAC1F,WAAU;AACZ,QAAM,EAAC,aAAa,MAAK,IAAIA,QACvB,EAAC,UAAa,IAAA,MAAM,QACpB,EAAC,KAAI,IAAI,MAAM,OAAO;AAErB,SAAA;AAAA;AAAA,mBAEU,cAAc,uCAAuC,MAAS;AAAA;AAAA;AAAA,oBAG7DoB,iBAAe,EAAC,MAAM,WAAW,EAAC,GAAG,WAAW,QAAQ,EAAE,EAAA,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOhF,CAAC,GAEKd,gBAAuB,IAGhB,eAAe,WAAW,SACrCN,QACA,KACA;AACM,QAAA;AAAA,IACJ,qBAAqB;AAAA,IACrB,iBAAiB,OAAO;AAAA,IACxB,0BAA0B,UAAUM;AAAAA,IACpC,qBAAqB,WAAWA;AAAAA,IAChC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAA6E,cAAa7E;AAAAA,IACb;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EAAA,IACDN,QAEE,EAAC,SAAS,SAAS,cAAc,iBAAgB,mBAEjD,uBAAuBmF,YAAW,SAAS,GAC3C,eAAe,gBAAgB,GAAG,GAClC,EAAC,GAAAtE,OAAK,kBAEN,cAAc;AAAA,IAClB,CAAC,UAAsC;AACrB,mBAAa,YAEb,MAAM,UAChB,WAAS,QAAQ,KAAK;AAAA,IAE9B;AAAA,IACA,CAAC,cAAc,OAAO;AAAA,KAGlB,eAAe;AAAA,IACnB,MAAO,YAAY,YAAe,OAAA,SAAA,SAAA,IAAA,cAAA,OAAA,SAAA,WAAA;AAAA,IAClC,CAAC,WAAW,YAAY,QAAQ;AAAA,EAAA,GAG5B,UAAU,QAAQ,MAClB,YACK,OAGP,oBAACM,uBAAkB,SAAkB,MAAM,GAAG,MAAM,GACjD,sBAAY,QAAQ,EAAA,CACvB,GAED,CAAC,UAAU,WAAW,OAAO,CAAC;AAG/B,SAAA;AAAA,IAAC6D;AAAAA,IAAA;AAAA,MACC,cAAY;AAAA,MACX,GAAG;AAAA,MACJ;AAAA,MACA;AAAA,MACA,OAAO;AAAA,MAEP,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,qBAAqB;AAAA,YACrB,iBAAiB;AAAA,YACjB;AAAA,YACA,cAAc,CAAQ,CAAA;AAAA,YACtB,cAAc;AAAA,YACd;AAAA,YACA,SACE,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,cAAC,qBAAA,MAAA,EAAK,OAAM,UACV,UAAA;AAAA,gBAAA;AAAA,kBAAC;AAAA,kBAAA;AAAA,oBACC,WAAW,CAAQ,CAAA;AAAA,oBACnB;AAAA,oBACA,SAAS,cAAc,eAAe;AAAA,oBACtC;AAAA,kBAAA;AAAA,gBACF;AAAA,gBACC,cACE,oBAAA,KAAA,EAAI,YAAY,GACf,8BAAC,OAAM,EAAA,eAAa,oBAAoB,KAAK,IAAI,MAAK,WACnD,UAAEnE,GAAA,6BAA6B,EAClC,CAAA,GACF;AAAA,gBAED,wBACC,oBAAC,KAAI,EAAA,YAAY,GACf,UAAA,oBAAC,2BAA0B,EAAA,UAAU,GAAG,WAAU,OAAM,YAAAsE,YAAwB,CAAA,GAClF;AAAA,cAAA,GAEJ;AAAA,cAEC,cACC,oBAAC,cAAa,EAAA,eAAa,sBAAsB,KAAK,IAAI,MAAK,WAAU,MAAM,GAC5E,UAAA,WAAW,QACd;AAAA,cAGD,eACC,oBAACxD,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,IAAI,oBAAoB,SAAS,WAAW,GAC9D,UACH,aAAA;AAAA,YAAA,GAEJ;AAAA,UAAA;AAAA,QAEJ;AAAA,QAEA;AAAA,UAAC+D;AAAAA,UAAA;AAAA,YACC,aAAa,QAAQ;AAAA,YACrB,QAAQ;AAAA,YACR,aAAa,UAAU,IAAI,IAAI;AAAA,YAC/B,SAAS,OAAO,YAAa,YAAY,WAAW,KAAK,cAAc;AAAA,YACvE,KAAK;AAAA,YACL;AAAA,YAEC,WAAC,aAAa;AAAA,UAAA;AAAA,QACjB;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN,CAAC,GC7NKV,SAAO,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAsBb,SAAS,gBAAgB,EAAC,UAAU,YAAY,WAAW,YAA6B;AAC7F,6BACGA,QAAK,EAAA,oBAAkB,YAAY,iBAAe,UAChD,SACH,CAAA;AAEJ;ACvBgB,SAAA,YAAe,OAAU,SAAuB;AACxD,QAAA,MAAM,OAAiB,WAAW,IAAI;AAC5C,SAAA,UAAU,MAAM;AACd,QAAI,UAAU;AAAA,EACb,GAAA,CAAC,KAAK,CAAC,GACH,IAAI;AACb;ACMO,SAAS,aACd,SACA,WACA,UAA4D,eACtD;AACA,QAAA,WAAW,YAA2B,OAAO;AACnD,YAAU,MAAM;AACT,YAAQ,UAAU,OAAO,KAC5B,UAAU,UAAU,OAAO;AAAA,KAE5B,CAAC,WAAW,SAAS,UAAU,OAAO,CAAC;AAC5C;ACxBa,MAAA,oBAAoB,OAAO,IAAI,cAAc;AAKnD,SAAS,aAAa,OAAY,OAAa,IAA2B;AACxE,SAAA;AAAA,IACL,WAAW;AAAA,IACX,MAAM;AAAA,IACN;AAAA,IACA;AAAA,EAAA;AAEJ;AAKO,SAAS,OACd,OACA,UACA,OAAa,CAAA,GACI;AACV,SAAA;AAAA,IACL,WAAW;AAAA,IACX,MAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;AAKO,SAAS,IAAI,OAAY,OAAa,IAAkB;AAC7D,SAAO,EAAC,WAAW,mBAAmB,MAAM,OAAO,MAAM;AAC3D;AAKgB,SAAA,MAAM,OAAa,IAAoB;AACrD,SAAO,EAAC,WAAW,mBAAmB,MAAM,SAAS,KAAI;AAC3D;AAKO,SAAS,eAAe,OAAe,OAAa,IAAwB;AACjF,SAAO,EAAC,WAAW,mBAAmB,MAAM,kBAAkB,MAAM;AACtE;AAKO,SAAS,IAAI,SAAS,GAAG,OAAa,CAAA,GAAkB;AAC7D,SAAO,EAAC,WAAW,mBAAmB,MAAM,OAAO,MAAM,OAAO;AAClE;AAKO,SAAS,IAAI,SAAS,GAAG,OAAa,CAAA,GAAkB;AAC7D,SAAO,EAAC,WAAW,mBAAmB,MAAM,OAAO,MAAM,OAAO;AAClE;AAGgB,SAAA,WAAmCN,QAAU,SAAyB;AAC7E,SAAA;AAAA,IACL,GAAGA;AAAA,IACH,MAAM,CAAC,SAAS,GAAGA,OAAM,IAAI;AAAA,EAAA;AAEjC;AC3EO,MAAM,WAAW;AAAA,EACtB,OAAO,KAAK,OAA0C;AACpD,WAAI,iBAAiB,aACZ,QAEF,IAAI,WAAW,MAAM,QAAQ,KAAK,IAAIlB,UAAQ,KAAK,IAAI,CAAC,KAAK,CAAC;AAAA,EACvE;AAAA,EAIA,YAAY,SAA2B;AACrC,SAAK,UAAU;AAAA,EACjB;AAAA,EAEA,WAAW,SAAiC;AACnC,WAAA,WAAW,KAAK,CAAC,GAAGA,UAAQ,OAAO,GAAG,GAAG,KAAK,OAAO,CAAC;AAAA,EAC/D;AAAA,EAEA,UAAU,SAAiC;AAClC,WAAA,WAAW,KAAK,CAAC,GAAG,KAAK,SAAS,GAAGA,UAAQ,OAAO,CAAC,CAAC;AAAA,EAC/D;AAAA,EAEA,UAAU,SAAkC;AACnC,WAAA,WAAW,KAAK,KAAK,QAAQ,IAAI,CAACkB,WAAU,WAAWA,QAAO,OAAO,CAAC,CAAC;AAAA,EAChF;AACF;ACpCA,MAAM,cAAc,CAAC,QAAQ,SAAS,OAAO;AAEtC,SAAS,YAAY,OAA+D;AAClF,SAAA,OAAO,KAAK,KAAK,EAAE,MAAM,CAAC,QAAQ,YAAY,SAAS,GAAG,CAAC;AACpE;ACiBO,MAAM,uBAAuB,cAAyC,IAAI,GAGpE,wBAAwB,KAAK,SACxC1E,QACA;AACM,QAAA,MAAM,OAA2BA,MAAK;AAC5C,MAAI,UAAUA;AAEd,QAAM,mBAAmB;AAAA,IACvB,CAAC,YAAyB;AA/B9B,UAAAW,KAAA,IAAA;AAgCM,cAAO,sBAAI,YAAJ,OAAA,SAAAA,IAAa,qBAAb,OAAgC,SAAA,GAAA,KAAAA,KAAA,OAAA,MAAhC,YAA4C;IACrD;AAAA,IACA,CAAC,GAAG;AAAA,EAAA,GAGA,WAAW,YAAY,CAAC,eAA2B;AACnD,QAAA,QAAQ,SAAS,UAAU;AAAA,KAC9B,CAAE,CAAA,GAEC,cAAc,YAAY,CAAC,SAAe;AAC1C,QAAA,QAAQ,YAAY,IAAI;AAAA,KAC3B,CAAE,CAAA,GACC,aAAa,YAAY,CAAC,SAAe;AACzC,QAAA,QAAQ,WAAW,IAAI;AAAA,KAC1B,CAAE,CAAA,GACC,aAAa,YAAY,CAAC,SAAe;AACzC,QAAA,QAAQ,WAAW,IAAI;AAAA,EAAA,GAC1B,CAAA,CAAE,GACC,qBAAqB,YAAY,CAAC,MAAY,cAAuB;AACrE,QAAA,QAAQ,mBAAmB,MAAM,SAAS;AAAA,EAAA,GAC7C,CAAA,CAAE,GACC,yBAAyB,YAAY,CAAC,MAAY,cAAuB;AACzE,QAAA,QAAQ,uBAAuB,MAAM,SAAS;AAAA,EAAA,GACjD,CAAA,CAAE,GACC,qBAAqB,YAAY,CAAC,MAAY,mBAA2B;AACzE,QAAA,QAAQ,mBAAmB,MAAM,cAAc;AAAA,EAAA,GAClD,CAAE,CAAA,GAEC,eAAmC;AAAA,IACvC,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAGF,6BACG,qBAAqB,UAArB,EAA8B,OAAO,cACnC,iBAAM,SACT,CAAA;AAEJ,CAAC;AAGM,SAAS,mBAAuC;AAC/C,QAAA,MAAM,WAAW,oBAAoB;AAC3C,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,2BAA2B;AAEtC,SAAA;AACT;AC/FO,SAAS,iBAAiB,MAAuB;AACtD,MAAI,mBAAmB,IAAI;AAClB,WAAA,KAAK,SAAS,WAAW,CAAA,IAAK,EAAC,OAAO,KAAK;AAEpD,MAAI,kBAAkB,IAAI;AACxB,WAAO;AAET,MAAI,KAAK,aAAa;AACb,WAAA;AAET,MAAI,KAAK,aAAa;AACb,WAAA;AAET,MAAI,KAAK,aAAa;AACb,WAAA;AAGX;AChBA,SAAS,UAAU,SAAS,IAAI;AACxB,QAAA,QAAQ,IAAI,WAAW,MAAM;AACnC,SAAA,gBAAgB,KAAK,GACd;AACT;AAEA,MAAM,kBAAyB,uBAAA;AACzB,MAAA;AACJ,SAAO,MAAM;AACP,QAAA;AACK,aAAA;AAET,YAAQ,CAAA;AACR,aAAS,IAAI,GAAG,IAAI,KAAK,EAAE;AACnB,YAAA,CAAC,KAAK,IAAI,KAAO,SAAS,EAAE,EAAE,UAAU,CAAC;AAE1C,WAAA;AAAA,EAAA;AAEX;AAEO,SAAS,UAAU,QAAiB;AACzC,QAAM,QAAQ;AACd,SAAO,UAAU,MAAM,EACpB,OAAO,CAAC,KAAK,MAAM,MAAM,MAAM,CAAC,GAAG,EAAE,EACrC,MAAM,GAAG,MAAM;AACpB;AC1BA,SAAS,OAAkC,MAAqC;AAC9E,SAAO,KAAK,SAAS;AACvB;AAEO,SAAS,UAAqC,MAA6B;AACzE,SAAA,OAAO,IAAI,IAAI,OAAO,EAAC,GAAG,MAAM,MAAM,UAAU,EAAE;AAC3D;ACEA,MAAMgF,wBAAsB,CAAC,YAA6B,SAAsC;AACxF,QAAA,eAAeC,kBAAgB,IAAI;AACzC,SAAO,WAAW,GAAG,KAAK,CAAC,eAAe,WAAW,SAAS,YAAY;AAC5E;AAMA,SAAS,OAAO9F,SAAiC,MAAY;AAC3D,SAAO,OAAO,QAAQA,OAAM,EAAE,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,IAAI,OAAO,CAAC,GAAG,MAAM,GAAG,CAAC,CAAC;AAChF;AAEgB,SAAA,0BACd,OACA,YACA,UAIA;AACO,SAAA,KAAK,KAAK,EAAE;AAAA,IACjB,SAAS,CAAC,SAAS;AACjB,YAAM,kBAAkB,EAAC,MAAM,KAAK,KAAI;AACxC,aAAO,GAAG6F,sBAAoB,YAAY,IAAI,CAAC,EAAE;AAAA,QAC/C,SAAS,CAAC,eAAgB,aAAa,GAAG,UAAU,IAAIE,OAAM;AAAA,QAC9D,SAAS,CAAC,eACJ,CAAC,YAAY,IAAI,KAAK,CAAC,WAClBA,UAEF;AAAA,UACL,GAAG;AAAA,YACD,MAAM;AAAA,YACN,SAAS,CAAC,IAAI,IAAM,CAAC,iBAAiB,wBAAwB,CAAC,CAAC;AAAA,UAAA,CACjE;AAAA,UACD,MAAM,MAAM,SAAS,YAAY,IAAI,CAAC,EAAE;AAAA,YACtC,OAAOzF,eAAa;AAAA,YACpB,IAAI,CAAC,aAAa;AAAA,cAChB,MAAM;AAAA,cACN,SAAS,OAAO,SAAS,CAAC,eAAe,CAAC;AAAA,YAAA,EAC1C;AAAA,YACF;AAAA,cAAW,CAAC,UACV,GAAG,EAAC,MAAM,SAAkB,OAAO,MAAM,YAAY,YAAW;AAAA,YAClE;AAAA,UACF;AAAA,UACA,GAAG;AAAA,YACD,MAAM;AAAA,YACN,SAAS,CAAC,MAAM,CAAC,iBAAiB,wBAAwB,CAAC,CAAC;AAAA,UAAA,CAC7D;AAAA,QAAA,CAEJ;AAAA,MAAA;AAAA,IACH,CACD;AAAA,EAAA;AAEL;ACdO,SAAS,mBAAmBJ,QAAwB;AACnD,QAAA,WAAW,UACX;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,MACEA,QACE,EAAC,GAAAa,GAAC,IAAI,kBAEN;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAA,iBACE,GAAAiF,uBAAsB;AAE5B,eAAa,OAAO,KAAK,SAAS,CAAC,UAAU,aAAa;AA3E5D,QAAAnF;AA4EQ,KAAC,YAAY,cACfA,MAAA,SAAS,YAAT,QAAkBA,IAAA,MAAA;AAAA,EAAA,CAErB;AAEK,QAAA,WAAW,YAAY,MAAM;AACjC,aAAS,WAAW,KAAK,CAAC,MAAM,CAAC,EAAC,MAAM,OAAO,IAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AAAA,EAAA,GACtD,CAAC,OAAO,KAAK,QAAQ,CAAC,GAEnB,iBAAiB;AAAA,IACrB,CAAC,SAAe;AACd,iBAAW,IAAI,GACf,mBAAmB,MAAM,EAAK;AAAA,IAChC;AAAA,IACA,CAAC,YAAY,kBAAkB;AAAA,EAE3B,GAAA,QAAQ,YAGR,eAAe;AAAA,IACnB,CAAC,UAAoE;AAC/D,UAAA,MAAM,MAAM,WAAW;AACnB,cAAA,IAAI,MAAM,+CAA+C;AAE3D,YAAA,gBAAgB,MAAM,MAAM,IAAI,CAAC,SAAS,UAAU,IAAI,CAAC;AAE/D,eAAS,WAAW,KAAK,CAAC,OAAO,eAAe,MAAM,UAAU,CAAC,EAAC,MAAM,OAAO,IAAI,CAAA,CAAC,CAAC,CAAC,CAAC;AAEvF,YAAM,eAAe,cAAc,CAAC,EAAE,MAEhC,WAAW,CAAC,GADC,OAAO,KAAK,KAAK,MAAM,GAAG,EAAE,GACd,EAAC,MAAM,cAAa;AAGrD,kBAAY,QAAQ;AAEd,YAAA,aAAa,MAAM,SAAS;AAC9B,YAAM,mBACJ,cACF,eAAe,QAAQ,IAGzB,0BAA0B,eAAe,OAAO,kBAAkBmF,oBAAmB,EAClF;AAAA,QACC,IAAI,CAAC,WAAW;AACV,iBAAO,SAAS,UAClB,SAAS,WAAW,KAAK,OAAO,OAAO,CAAC,IAExC,MAAM,KAAK;AAAA,YACT,OAAOjF,GAAE,uDAAuD;AAAA,YAChE,aAAaA,GAAE,+DAA+D;AAAA,cAC5E,iBAAiB,OAAO,WAAW;AAAA,cACnC,cAAc,OAAO,MAAM;AAAA,YAAA,CAC5B;AAAA,YACD,QAAQ;AAAA,UAAA,CACT;AAAA,QAAA,CAEJ;AAAA,QAEF,UAAU;AAAA,QACT,UAAU,MAAM;AACV,wBACF,eAAe,QAAQ;AAAA,QAE3B;AAAA,MAAA,CACD;AAAA,IAEP;AAAA,IACA;AAAA,MACE;AAAA,MACA,OAAO,KAAK;AAAA,MACZ,OAAO;AAAA,MACP,OAAO;AAAA,MACP;AAAA,MACA;AAAA,MACAiF;AAAA,MACA;AAAA,MACAjF;AAAA,IACF;AAAA,EAAA,GAGI,aAAa,YAAY,MAAM;AACxB,eAAA,OAAO,KAAK,IAAI;AAAA,EAAA,GAC1B,CAAC,OAAO,KAAK,MAAM,UAAU,CAAC,GAE3B,cAAc,YAAY,MAAM;AACxB,gBAAA,OAAO,KAAK,IAAI;AAAA,EAAA,GAC3B,CAAC,OAAO,KAAK,MAAM,WAAW,CAAC,GAE5B,uBAAuB;AAAA,IAC3B,CAAC,SAAe;AACd,kBAAY,OAAO,KAAK,KAAK,OAAO,IAAI,CAAC;AAAA,IAC3C;AAAA,IACA,CAAC,OAAO,KAAK,MAAM,WAAW;AAAA,KAG1B,eAAe;AAAA,IACnB,CAAC,UAAiC;AAChC;AAAA,QACE,WAAW,KAAK,KAAK,EAClB,QAAQ,aAAa,iBAAiB,OAAO,KAAK,UAAU,CAAC,CAAC,EAC9D,UAAU,EAAC,MAAM,OAAO,KAAI;AAAA,MAAA;AAAA,IAEnC;AAAA,IACA,CAAC,UAAU,OAAO,KAAK,YAAY,OAAO,GAAG;AAAA,EAAA,GAEzC,iBAAiB,YAAY,MAAM;AACpB,uBAAA,OAAO,KAAK,MAAM,EAAI;AAAA,EAAA,GACxC,CAAC,oBAAoB,OAAO,KAAK,IAAI,CAAC,GAEnC,eAAe,YAAY,MAAM;AAClB,uBAAA,OAAO,KAAK,MAAM,EAAK;AAAA,EAAA,GACzC,CAAC,oBAAoB,OAAO,KAAK,IAAI,CAAC,GAEnC,sBAAsB;AAAA,IAC1B,CAAC,cAAsB;AACrB,yBAAmB,OAAO,KAAK,KAAK,OAAO,SAAS,GAAG,EAAI;AAAA,IAC7D;AAAA,IACA,CAAC,oBAAoB,OAAO,KAAK,IAAI;AAAA,KAEjC,oBAAoB;AAAA,IACxB,CAAC,cAAsB;AACrB,yBAAmB,OAAO,KAAK,KAAK,OAAO,SAAS,GAAG,EAAK;AAAA,IAC9D;AAAA,IACA,CAAC,oBAAoB,OAAO,KAAK,IAAI;AAAA,EAAA,GAEjC,mBAAmB,YAAY,MAAM;AAC9B,eAAA,OAAO,KAAK,IAAI;AAAA,EAAA,GAC1B,CAAC,YAAY,OAAO,KAAK,IAAI,CAAC,GAC3B,kBAAkB;AAAA,IACtB,CAAC,cAAsB;AACrB,iBAAW,OAAO,KAAK,KAAK,OAAO,SAAS,CAAC;AAAA,IAC/C;AAAA,IACA,CAAC,YAAY,OAAO,KAAK,IAAI;AAAA,KAEzB,uBAAuB;AAAA,IAC3B,CAAC,iBAAyB;AACxB,6BAAuB,OAAO,KAAK,KAAK,OAAO,YAAY,GAAG,EAAK;AAAA,IACrE;AAAA,IACA,CAAC,wBAAwB,OAAO,KAAK,IAAI;AAAA,KAErC,yBAAyB;AAAA,IAC7B,CAAC,iBAAyB;AACxB,6BAAuB,OAAO,KAAK,KAAK,OAAO,YAAY,GAAG,EAAI;AAAA,IACpE;AAAA,IACA,CAAC,wBAAwB,OAAO,KAAK,IAAI;AAAA,EAAA,GAGrC,aAAa,YAAY,MAAM;AACxB,eAAA,OAAO,KAAK,IAAI;AAAA,EAAA,GAC1B,CAAC,YAAY,OAAO,KAAK,IAAI,CAAC,GAE3B,eAAe,CAAC,OAAO,KAAK,SAAS,YAAY,OAAO,KAAK,KAAK,GAClE,cAAc,YAAY,MAAM;AAChC,oBACF,SAAS;AAGX,UAAM,aAAa,OAAO,KAAK,KAAK,MAAM,GAAG,EAAE;AACpC,eAAA,UAAU,GAErB,YAAY,UAAU;AAAA,EACxB,GAAG,CAAC,cAAc,YAAY,OAAO,KAAK,MAAM,aAAa,QAAQ,CAAC,GAEhE,yBAAyB;AAAA,IAC7B,CAAC,cAAsB;AACF,yBAAA,OAAO,KAAK,MAAM,SAAS;AAAA,IAChD;AAAA,IACA,CAAC,oBAAoB,OAAO,KAAK,IAAI;AAAA,KAGjC,eAAe;AAAA,IACnB,OAAyC;AAAA,MACvC,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,IAAI,OAAO,KAAK;AAAA,MAChB,KAAK;AAAA,MACL,oBAAoB,oBAAoB,OAAO,KAAK,IAAI,OAAO,KAAK,WAAW,WAAW;AAAA,IAAA;AAAA,IAE5F,CAAC,YAAY,aAAa,OAAO,KAAK,IAAI,OAAO,KAAK,WAAW,WAAW;AAAA,EAAA,GAGxE,aAAa,QAAQ,OAClB;AAAA,IACL,SAAS,OAAO,KAAK;AAAA,IACrB,WAAW,OAAO,KAAK;AAAA,IACvB,SAAS,OAAO,KAAK;AAAA,IACrB,QAAQ,OAAO,KAAK;AAAA,IACpB,IAAI,OAAO,KAAK;AAAA,IAChB,OAAO,OAAO,KAAK;AAAA,IACnB,SAAS,OAAO,KAAK;AAAA,IACrB,UAAU;AAAA,IACV,cAAc;AAAA,IACd,iBAAiB;AAAA,IACjB,oBAAoB;AAAA,IACpB,eAAe;AAAA,IACf,kBAAkB;AAAA,IAClB,oBAAoB;AAAA,IACpB,aAAa;AAAA,IACb,aAAa;AAAA,IACb,MAAM,OAAO,KAAK;AAAA,IAClB,UAAU,OAAO,KAAK;AAAA,IACtB,UAAU,OAAO,KAAK;AAAA,IACtB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAY,OAAO,KAAK;AAAA,IACxB,YAAY,OAAO,KAAK;AAAA,IACxB,OAAO,OAAO,KAAK;AAAA,IACnB;AAAA,EAAA,IAED;AAAA,IACD;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD,CAAA,GAEK,gBAAgB,QAAQ,MAAM,YAAY,UAAU,GAAG,CAAC,YAAY,WAAW,CAAC,GAEhF,YAAY,QAAQ,OACjB;AAAA,IACL,KAAK,OAAO;AAAA,IACZ,OAAO,OAAO;AAAA,IACd,OAAO,OAAO,KAAK;AAAA,IACnB,OAAO,OAAO,KAAK;AAAA,IACnB,OAAO,OAAO,KAAK,WAAW;AAAA,IAC9B,aAAa,OAAO,KAAK,WAAW;AAAA,IACpC,aAAa,OAAO;AAAA,IACpB,WAAW,OAAO;AAAA,IAClB,YAAY,OAAO,KAAK;AAAA,IACxB,kBAAkB,OAAO;AAAA,IACzB,UAAU;AAAA,IACV;AAAA,IACA,UAAU,OAAO,KAAK;AAAA,IACtB,YAAY,OAAO,KAAK;AAAA,IACxB,MAAM,OAAO;AAAA,IACb,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,UAAU,OAAO,KAAK;AAAA,IACtB,SAAS,OAAO,KAAK;AAAA,IACrB,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS,OAAO,KAAK;AAAA,IACrB,MAAM,OAAO,KAAK;AAAA,IAClB,UAAU;AAAA,IACV,SAAS,OAAO,KAAK;AAAA,IACrB;AAAA,EAAA,IAED;AAAA,IACD,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO;AAAA,IACP,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAGC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,UAAU;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MAEC,UAAA,QAAQ,MAAM,WAAW,SAAS,GAAG,CAAC,WAAW,UAAU,CAAC;AAAA,IAAA;AAAA,EAAA;AAGnE;ACrYA,MAAMkF,gBAAc,OAAO,IAAI;AAAA,eAChB,CAAC,EAAC,YAA2B,MAAM,OAAO,UAAU,CAAC,CAAC;AAAA;AAS9D,SAASC,uBAAqBhG,QAAc;AAC3C,QAAA,EAAC,OAAO,SAAS,UAAU,GAAG,KAAQ,IAAAA,QACtC,CAAC,aAAa,cAAc,IAAI,SAAS,EAAK,GAC9C,CAAC,YAAY,aAAa,IAAI,SAA6B,IAAI,GAE/D,EAAC,GAAAa,OAAK;AAEZ,kBAAgB,MAAM,eAAe,EAAK,GAAG,CAAC,UAAU,CAAC;AAEnD,QAAA,gBAAgB,YAAY,CAAC,MAAW;AAC5C,KAAI,EAAE,QAAQ,YAAY,EAAE,QAAQ,UAClC,eAAe,EAAK;AAAA,KAErB,EAAE,GAEC,oBAAoB,YAAY,MAAM;AAC3B,mBAAA,CAAC,MAAM,CAAC,CAAC;AAAA,KACvB,CAAE,CAAA,GAEC,WAAW+E,kBAAgB,KAAK;AAEpC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAM;AAAA,MACN,KAAK;AAAA,MACL,WAAW;AAAA,MACX,QAAM;AAAA,MACN,eAAa;AAAA,MACb,MAAK;AAAA,MACL,SACG,oBAAAG,eAAA,EAAY,QAAQ,GAAG,SAAS,GAAG,WAAW,eAAe,UAAU,GAAG,UAAS,QAClF,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,QAAC,oBAAApE,QAAA,EAAK,QAAO,UACX,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAd;AAAA,YACA,SAAQ;AAAA,YACR,QAAQ,EAAC,SAAQ;AAAA,UAAA;AAAA,QAAA,GAErB;AAAA,QACA,oBAACc,UAAK,MAAM,GAAG,QAAO,UACnB,UAAAd,GAAE,+CAA+C,GACpD;AAAA,QACA,oBAACc,QAAK,EAAA,MAAM,GACV,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAd;AAAA,YACA,SAAQ;AAAA,YACR,QAAQ,EAAC,SAAQ;AAAA,UAAA;AAAA,QAAA,GAErB;AAAA,QACC,oBAAA,KAAA,EACC,UAAC,qBAAAc,QAAA,EAAK,MAAM,GACV,UAAA;AAAA,UAAA,oBAAC,iBAAgB,EAAA;AAAA,UAAE;AAAA,UAAEd,GAAE,uDAAuD;AAAA,QAAA,EAAA,CAChF,EACF,CAAA;AAAA,QACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAA,oBAACc,UAAK,MAAM,GAAG,QAAO,UACnB,UAAAd,GAAE,oDAAoD,GACzD;AAAA,UACA,oBAAC,QAAK,SAAS,GAAG,UAAS,QAAO,QAAM,IACtC,UAAA,oBAAC,MAAK,EAAA,MAAM,GAAG,IAAG,OAAM,UAAS,QAC9B,UAAA,KAAK,UAAU,OAAO,MAAM,CAAC,EAAA,CAChC,EACF,CAAA;AAAA,QAAA,GACF;AAAA,MAAA,EAAA,CACF,EACF,CAAA;AAAA,MAGF,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAG;AAAA,UACH,MAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAK;AAAA,UACL,UAAU;AAAA,UACV,UAAU;AAAA,UACV,MAAM;AAAA,UACN;AAAA,UACA,SAAS;AAAA,UACT,WAAW;AAAA,UACX,sBAAoB;AAAA,UACnB,GAAG;AAAA,UAEJ,UAAA,qBAAC,MAAK,EAAA,OAAM,UACV,UAAA;AAAA,YAAC,oBAAA,KAAA,EAAI,aAAa,GAChB,UAAA,oBAACc,UACC,UAAC,oBAAA,aAAA,CAAA,CAAY,GACf,EACF,CAAA;AAAA,YAEA,oBAAC,OAAI,MAAM,GACT,8BAACA,QAAK,EAAA,MAAM,GAAG,cAAa,YAC1B,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,GAAAd;AAAA,gBACA,SAAQ;AAAA,gBACR,QAAQ,EAAC,SAAkB;AAAA,cAAA;AAAA,eAE/B,EACF,CAAA;AAAA,UAAA,GACF;AAAA,QAAA;AAAA,MACF;AAAA,IAAA;AAAA,EAAA;AAGN;ACnHO,SAAS,gBAAgBb,QAAiC;AAC/D,QAAM,EAAC,OAAM,IAAIA,QACX,EAAC,GAAAa,GAAA,IAAK;AAER,SAAA,OAAO,MAAM,SAAS,0CAChBmF,wBAAqB,EAAA,OAAO,OAAO,MAAM,MAAO,CAAA,IAElD,oBAAA,OAAA,EAAK,aAAE,uCAAuC,EAAC,OAAO,OAAO,MAAM,KAAK,CAAA,EAAE,CAAA;AACpF;ACXO,SAAS,cAAc,MAA6C;AACzE,UAAQ,KAAK,UAAU;AAAA,IACrB,KAAK;AACI,aAAA;AAAA,IAET,KAAK;AACI,aAAA;AAAA,IAET,KAAK;AACI,aAAA;AAAA,IAET;AACE,YAAM,IAAI,MAAM,qCAAqC,KAAK,QAAQ,GAAG;AAAA,EACzE;AACF;ACdgB,SAAA,8BACd,YACA,OACA,YACQ;AACR,SACE,mBAAmB,UAAU,KAC7B,OAAO,cAAe,YACtB,OAAO,UAAU,MAAM,QAEhB,aAEF,OAAO,wBAAS,EAAE;AAC3B;ACmBO,SAAS,sBAAsBhG,QAAiC;AAC/D,QAAA,WAAW,UACX,EAAC,QAAQ,YAAY,gBAAeA,QAEpC,CAAC,YAAY,aAAa,IAAI,YAE9B,EAAC,YAAY,aAAa,SAAA,IAAY;AAE5C,eAAa,OAAO,KAAK,SAAS,CAAC,UAAU,aAAa;AA1C5D,QAAAW;AA2CQ,KAAC,YAAY,cACfA,MAAA,SAAS,YAAT,QAAkBA,IAAA,MAAA;AAAA,EAAA,CAErB;AAED,QAAM,aAAa;AAAA,IACjB,CAAC,UAAsB;AACV,iBAAA,OAAO,KAAK,IAAI;AAAA,IAC7B;AAAA,IACA,CAAC,OAAO,KAAK,MAAM,UAAU;AAAA,KAGzB,cAAc;AAAA,IAClB,CAAC,UAAsB;AACT,kBAAA,OAAO,KAAK,IAAI;AAAA,IAC9B;AAAA,IACA,CAAC,OAAO,KAAK,MAAM,WAAW;AAAA,KAG1B,eAAe;AAAA,IACnB,CAAC,UAAiC;AAChC,eAAS,WAAW,KAAK,KAAK,EAAE,UAAU,OAAO,KAAK,CAAC;AAAA,IACzD;AAAA,IACA,CAAC,UAAU,OAAO,KAAK;AAAA,KAEnB,qBAAqB;AAAA,IACzB,CAAC,UAAyC;AACpC,UAAA,aAAwC,MAAM,cAAc;AAC5D,UAAA,mBAAmB,OAAO,KAAK,UAAU;AAC3C,YAAA,aAAa,MAAM,cAAc,eAC7B,aAAa,OAAO,oBAAoB,aAAa,OAAO;AAC9D;AAAA;AAEO,4BAAoB,OAAO,KAAK,UAAU,MACnD,aAAa,MAAM,cAAc;AAInC,YAAM,gBACJ,eAAe,MAAO,OAAO,cAAe,YAAY,MAAM,UAAU;AAEtE,yBAAmB,OAAO,KAAK,UAAU,KAK3C,cAAc,gBAAgB,SAAY,MAAM,cAAc,KAAK,GAGrE;AAAA,QACE;AAAA,UACE;AAAA;AAAA;AAAA,YAGI,cAAc,OAAO,KAAK,UAAU;AAAA,cACpC;AAAA,QACN;AAAA,MAAA;AAAA,IAEJ;AAAA,IACA,CAAC,cAAc,OAAO,KAAK,UAAU;AAAA,KAGjC,eAAe;AAAA,IACnB,OAA4C;AAAA,MAC1C,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,IAAI,OAAO,KAAK;AAAA,MAChB,KAAK;AAAA,MACL,UAAU;AAAA,MACV,OAAO,wBAAwB,OAAO,KAAK,YAAY,OAAO,KAAK,OAAO,UAAU;AAAA,MACpF,UAAU,CAAQ,CAAA,OAAO,KAAK;AAAA,MAC9B,aAAa,OAAO,KAAK,WAAW;AAAA,MACpC,oBAAoB,oBAAoB,OAAO,KAAK,IAAI,OAAO,KAAK,WAAW,WAAW;AAAA,IAAA;AAAA,IAE5F;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA,OAAO,KAAK;AAAA,MACZ,OAAO,KAAK;AAAA,MACZ,OAAO,KAAK;AAAA,MACZ,OAAO,KAAK;AAAA,MACZ;AAAA,IACF;AAAA,EAAA,GAEI,aAAa,QAAQ,OAClB;AAAA,IACL,SAAS,OAAO,KAAK;AAAA,IACrB,OAAO,OAAO,KAAK;AAAA,IACnB,OAAO,OAAO,KAAK;AAAA,IACnB,UAAU,OAAO,KAAK;AAAA,IACtB,YAAY,OAAO,KAAK;AAAA,IACxB,IAAI,OAAO,KAAK;AAAA,IAChB,MAAM,OAAO,KAAK;AAAA,IAClB,SAAS,OAAO,KAAK;AAAA,IACrB,UAAU;AAAA,IACV,YAAY,OAAO,KAAK;AAAA,IACxB,UAAU,OAAO,KAAK;AAAA,IACtB;AAAA,EAAA,IAED;AAAA,IACD,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ;AAAA,IACA;AAAA,EACD,CAAA,GAEK,gBAAgB,QAAQ,MAAM,YAAY,UAAU,GAAG,CAAC,YAAY,WAAW,CAAC,GAEhF,WAAW,YAAY,MAAM;AACxB,aAAA,WAAW,KAAK,CAAC,MAAM,CAAC,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC;AAAA,EAAA,GAChD,CAAC,OAAO,OAAO,QAAQ,CAAC,GAErB,WAAW;AAAA,IACf,CAAC,UAA4D;AAC3D,eAAS,WAAW,KAAK,CAAC,OAAO,MAAM,OAAO,MAAM,UAAU,CAAC,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC;AAAA,IACjF;AAAA,IACA,CAAC,OAAO,OAAO,QAAQ;AAAA,EAAA,GAGnB,YAAY,QAAQ,OACjB;AAAA,IACL,KAAK,OAAO;AAAA,IACZ,OAAO,OAAO;AAAA,IACd,OAAO,OAAO,KAAK;AAAA,IACnB,OAAO,OAAO,KAAK;AAAA,IACnB,OAAO,OAAO,KAAK,WAAW;AAAA,IAC9B,aAAa,OAAO,KAAK,WAAW;AAAA,IACpC,YAAY,OAAO,KAAK;AAAA,IACxB,kBAAkB,OAAO;AAAA,IACzB;AAAA,IACA;AAAA,IACA,UAAU,OAAO,KAAK;AAAA,IACtB,YAAY,OAAO,KAAK;AAAA,IACxB,UAAU,OAAO,KAAK;AAAA,IACtB,SAAS,OAAO,KAAK;AAAA,IACrB,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS,OAAO,KAAK;AAAA,IACrB,MAAM,OAAO,KAAK;AAAA,IAClB,UAAU;AAAA,EAAA,IAEX;AAAA,IACD,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO,KAAK;AAAA,IACZ,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAEM,SAAA,oBAAA,UAAA,EAAG,UAAQ,QAAA,MAAM,WAAW,SAA+B,GAAG,CAAC,WAAW,UAAU,CAAC,EAAE,CAAA;AAChG;AAEA,SAAS,wBACP,YACA,OACA,YACQ;AAKJ,SAAA,OAAO,GAAG,OAAO,EAAE,IACd,KAEF,8BAA8B,YAAY,OAAO,UAAU;AACpE;AC/NO,SAAS,sBAA+C,MAAwB;AACjF,MAAA,CAAC,mBAAmB,IAAI;AAC1B,UAAM,IAAI;AAAA,MACR,uBAAuB,KAAK,IAAI;AAAA,IAAA;AAI7B,SAAA,EAAC,GAAG,iBAAiB,IAAI,GAAG,MAAMsF,YAAU,EAAE;AACvD;ACda,MAAA,SAAS,UACT,QAAQ;AAEd,SAAS,YACd,OACA,UACA,UACG,MACH;AACI,MAAA,aAAa,UAAU,aAAa;AAChC,UAAA,IAAI,MAAM,qBAAqB,QAAQ,qBAAqB,MAAM,OAAO,KAAK,EAAE;AAGlF,QAAA,QAAQ,QAAQ,GAAG,IAAI;AAE7B,MAAI,MAAM,WAAW;AACZ,WAAA;AAGT,QAAM,MAAM,MAAM,QACZ,MAAM,KAAK,KAAK,MAAM,SAAS,GAAG,IAAI,KAEtC,gBAAgB,aAAa,UAAU,MAAM,IAAI,KAEjD,OAAO,MAAM;AACnB,SAAA,KAAK,OAAO,eAAe,GAAG,GAAG,QAAQ,KAAK,CAAC,GACxC;AACT;AAEA,SAAS,WAAWnG,SAAqB;AAChC,SAAAA,QAAO,OAAO,CAAC,MAAM,SAAS,KAAK,OAAO,IAAI,GAAG,CAAA,CAAE;AAC5D;ACzBA,MAAM,SAAS,CAAC,KAA8B,aAC5C,OAAO,UAAU,eAAe,KAAK,KAAK,QAAQ;AAEpD,SAASoG,OAAK,KAAgBjF,OAAc,IAAY;AACtD,QAAM,YAAY,IAAI,MAAA,GAChB,MAAM,UAAUA,KAAI;AAChB,SAAA,UAAA,OAAOA,OAAM,CAAC,GACxB,UAAU,OAAO,IAAI,GAAG,GAAG,GACpB;AACT;AAEA,SAAS,gBAAgB,OAAkB,aAAoB;AAC7D,MAAI,OAAO,eAAgB;AAClB,WAAA;AAEH,QAAA,QAAQkF,YAAU,OAAO,WAAW;AACnC,SAAA,UAAU,KAAK,KAAQ;AAChC;AAEgB,SAAA,YAAY,OAAczB,QAAc;AAChD,QAAA,YAAY,MAAM;AAEpB,MAAAA,OAAM,KAAK,WAAW,GAAG;AAEvB,QAAAA,OAAM,SAAS,gBAAgB;AACjC,UAAI,CAAC,MAAM,QAAQA,OAAM,KAAK;AAEtB,cAAA,IAAI,MAAM,6CAA6C;AAExD,aAAA,UAAU,SAAYA,OAAM,QAAQ;AAAA,IAAA,WAClCA,OAAM,SAAS,OAAO;AAC/B,UAAI,CAAC,MAAM,QAAQA,OAAM,KAAK;AAEtB,cAAA,IAAI,MAAM,6CAA6C;AAE/D,aAAOA,OAAM;AAAA,IAAA,OACR;AAAA,UAAIA,OAAM,SAAS;AACxB;AACS,UAAAA,OAAM,SAAS,QAAQ;AAChC,YAAI,CAACA,OAAM,SAAS,CAAC,OAAOA,OAAM,OAAO,MAAM,KAAK,CAAC,OAAOA,OAAM,OAAO,IAAI;AAE3E,gBAAM,IAAI;AAAA,YACR,8FAA8F,KAAK;AAAA,cACjGA,OAAM;AAAA,YAAA,CACP;AAAA,UAAA;AAGL,eAAOwB,OAAK,WAAWxB,OAAM,MAAM,MAAMA,OAAM,MAAM,EAAE;AAAA,MACzD;AAAA,IAAA;AACA,UAAM,IAAI,MAAM,4BAA4BA,OAAM,IAAI,EAAE;AAAA,EAC1D;AAEM,QAAA,CAAC,MAAM,GAAG,IAAI,IAAIA,OAAM,MAExB,QAAQ,gBAAgB,OAAO,IAAI;AAGzC,MAAI,UAAU;AACL,WAAA;AAGT,MAAI,KAAK,WAAW;AACd,QAAAA,OAAM,SAAS,UAAU;AACrB,YAAA,EAAC,UAAU,MAAS,IAAAA;AAC1B,aAAO,YAAY,OAAO,UAAU,OAAO,KAAK;AAAA,IAAA,WACvCA,OAAM,SAAS,SAAS;AACjC,UAAI,OAAO,SAAU;AACnB,cAAM,IAAI,MAAM,qDAAqD,KAAK,GAAG;AAErE,aAAA,UAAA,OAAO,OAAO,CAAC,GAClB;AAAA,IACT;AAAA;AAIF,SAAA,UAAU,KAAK,IAAI,WAAW,UAAU,KAAK,GAAG;AAAA,IAC9C,GAAGA;AAAA,IACH,MAAM;AAAA,EACP,CAAA,GACM;AACT;ACjFgB,SAAA,aAAa,OAAcA,QAAc;AACjD,QAAA,YAAY,MAAM,KAAK;AACzB,MAAAA,OAAM,KAAK,WAAW,GAAG;AAEvB,QAAAA,OAAM,SAAS,OAAO;AACpB,UAAA,CAAC,SAASA,OAAM,KAAK;AAEjB,cAAA,IAAI,MAAM,+CAA+C;AAEjE,aAAOA,OAAM;AAAA,IAAA,OACR;AAAA,UAAIA,OAAM,SAAS;AACxB;AACK,UAAIA,OAAM,SAAS;AAEjB,eAAA,UAAU,SAAYA,OAAM,QAAQ;AAAA,IAAA;AAE7C,UAAM,IAAI,MAAM,6BAA6BA,OAAM,IAAI,EAAE;AAAA,EAC3D;AAGA,QAAM,CAAC,MAAM,GAAG,IAAI,IAAIA,OAAM;AAC9B,MAAI,OAAO,QAAS;AAClB,UAAM,IAAI,MAAM,mDAAmD,IAAI,EAAE;AAG3E,SAAI,KAAK,WAAW,KAAKA,OAAM,SAAS,UAC/B,KAAK,WAAW,IAAI,KAG7B,UAAU,IAAI,IAAI,WAAW,UAAU,IAAI,GAAG;AAAA,IAC5C,GAAGA;AAAA,IACH,MAAM;AAAA,EAAA,CACP,GACM;AACT;ACrCA,MAAM0B,eAAa;AAAA,EACjB,QAAQ,cAAqB,WAAkB;AACtC,WAAA;AAAA,EACT;AAAA,EACA,IAAI,cAAqB,WAAkB;AAClC,WAAA;AAAA,EACT;AAAA,EACA,aAAa,cAAqB,WAAkB;AAC3C,WAAA,iBAAiB,SAAY,YAAY;AAAA,EAClD;AAAA,EACA,MAAM,cAAqB,WAAkB;AAAA,EAE7C;AAAA,EACA,IAAI,cAAqB,WAAkB;AACzC,WAAO,eAAe;AAAA,EACxB;AAAA,EACA,IAAI,cAAqB,WAAkB;AACzC,WAAO,eAAe;AAAA,EACxB;AACF,GAEMC,0BAAwB,OAAO,KAAKD,YAAU;AAEpC,SAAA,gBAAgB,OAAc1B,QAAc;AAC1D,MAAI,CAAC2B,wBAAsB,SAAS3B,OAAM,IAAI;AAC5C,UAAM,IAAI;AAAA,MACR,uCAAuCA,OAAM,IAAI;AAAA,IAAA;AAIjD,MAAAA,OAAM,KAAK,SAAS;AACtB,UAAM,IAAI;AAAA,MACR,+EACEA,OAAM,IACR,eAAeA,OAAM,KAClB,IAAI,CAAC,SAAgB,KAAK,UAAU,IAAI,CAAC,EACzC,KAAK,GAAG,CAAC,6BAA6B,KAAK,UAAU,KAAK,CAAC;AAAA,IAAA;AAIlE,SAAQ0B,aAAqB1B,OAAM,IAAI,EAAE,OAAOA,OAAM,KAAK;AAC7D;ACtCA,MAAM,aAAa;AAAA,EACjB,QAAQ,cAAuB,WAAoB;AAC1C,WAAA;AAAA,EACT;AAAA,EACA,IAAI,cAAuB,WAAoB;AACtC,WAAA;AAAA,EACT;AAAA,EACA,aAAa,cAAuB,WAAoB;AAC/C,WAAA,iBAAiB,SAAY,YAAY;AAAA,EAClD;AAAA,EACA,MAAM,cAAuB,WAAoB;AAAA,EAEjD;AAAA,EACA,eAAe,cAAsB,UAAkB;AAC/C,UAAA,CAAC,MAAM,IAAI,aAAa,WAAW,QAAQ,GAAG,cAAc,EAAC,uBAAuB,GAAK,CAAA;AACxF,WAAA;AAAA,EACT;AACF,GAEM,wBAAwB,OAAO,KAAK,UAAU;AAEpC,SAAA,aAAa,OAAgBA,QAAkB;AAC7D,MAAI,CAAC,sBAAsB,SAASA,OAAM,IAAI;AAC5C,UAAM,IAAI;AAAA,MACR,wCAAwC,KAAK;AAAA,QAC3CA,OAAM;AAAA,MACP,CAAA;AAAA,IAAA;AAID,MAAAA,OAAM,KAAK,SAAS;AACtB,UAAM,IAAI;AAAA,MACR,4EACEA,OAAM,IACR,eAAeA,OAAM,KAAK,KAAK,GAAG,CAAC,6BAA6B,KAAK,UAAU,KAAK,CAAC;AAAA,IAAA;AAIzF,SAAQ,WAAqBA,OAAM,IAAI,EAAE,OAAQA,OAAgB,KAAK;AACxE;ACnCgB,SAAA,SAAS,OAAc,SAAqB;AACnD,SAAA,QAAQ,OAAO,YAAY,KAAK;AACzC;AAEA,SAAS,YAAY,OAAcA,QAAc;AAC3C,SAAA,MAAM,QAAQ,KAAK,IACd,YAAY,OAAOA,MAAK,IAE7B4B,WAAS,KAAK,IACT,aAAa,OAAO5B,MAAK,IAE9B,SAAS,KAAK,IACT,aAAa,OAAOA,MAAK,IAE3B,gBAAgB,OAAOA,MAAK;AACrC;AAEgB,SAAA,WAAW,OAAcA,QAAc;AACzC,SAAA,YAAY,OAAOA,MAAK;AAGtC;ACrBA,MAAM,8BAA8B,cAAuD,IAAI;AAExF,SAAS,6BAA6B1E,QAG1C;AACD,QAAM,QAAQ,QAAQ,OAAO,EAAC,SAASA,OAAM,WAAWM,cAAe,IAAA,CAACN,OAAM,OAAO,CAAC;AACtF,6BACG,4BAA4B,UAA5B,EAAqC,OACnC,iBAAM,SACT,CAAA;AAEJ;AAEO,SAAS,0BAA0B;AAClC,QAAA,UAAU,WAAW,2BAA2B;AACtD,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,4EAA4E;AAE9F,SAAO,QAAQ;AACjB;ACzBgB,SAAA6D,KAAG,UAAkB,MAA2B;AACvD,SAAA,KAAK,SAAS,YAAY,CAAA,EAAQ,KAAK,QAAQA,KAAG,UAAU,KAAK,IAAI;AAC9E;ACOgB,SAAA,QAAQ,MAAgB,eAA2C;AAC7E,MAAA,CAAC,QAAQ,CAAC;AACL,WAAA;AAGH,QAAA,qBAAqB,MAAM,QAAQ,aAAa,IAClD,gBACA,cAAc,MAAM,GAAG,GAErB,WAAW,KAAK,QAAQ,IACxB,YAAY,KAAK,QAAQ,IAAI,eAC7B,eAAe,SAAS,QAAQ,SAAS,EAAE;AAE1C,SAAA,mBAAmB,KAAK,CAAC,SAAS;AACvC,UAAM,YAAY,KAAK,KAAK,EAAE,YAAY;AAEtC,WAAA,UAAU,OAAO,CAAC,MAAM,MACtB,WACK,SAAS,YAAY,EAAE,SAAS,SAAS,IAM3C,KAGL,UAAU,SAAS,IAAI,IAElB,iBAAiB,UAAU,QAAQ,SAAS,EAAE,IAGhD,aAAa;AAAA,EAAA,CACrB;AACH;ACxCA,MAAM,sBAAsB;AAE5B,SAAS,OAAU,OAAiB,MAAmB;AAC/C,QAAA,QAAQ,MAAM,QAAQ,IAAI;AAChC,SAAI,QAAQ,MACV,MAAM,OAAO,OAAO,CAAC,GAEhB;AACT;AAEgB,SAAA,mBACd,MACA,cAAsB,qBACtB;AACM,QAAA,YAAY,gBAAgB,WAAW;AACtC,SAAA,IAAI,SAAe0C,KAAe,UAAU,KAAK,GAAG,IAAI,CAAC,CAAC;AACnE;AAEgB,SAAA,gBAAgB,cAAsB,qBAAqB;AACnE,QAAA,uBAA4C,CAAA,GAC5C,qBAA6C,CAC7C,GAAA,SAAS,IAAI;AAEZ,SAAA;AAEP,WAAS,QAAQ,YAAsD;AAC9D,WAAA,IAAI,WAAW,CAAC,aAAa;AAClC,UAAI,qBAAqB,UAAU;AAC1B,eAAA,gBAAgB,UAAU,EAC9B,KAAK,SAAS,OAAO,CAAU,EAC/B,UAAU,QAAQ;AAEjB,YAAA,eAAe,WAAW,UAAU,QAAQ;AAC7B,aAAA,qBAAA,KAAK,YAAY,GAC/B,MAAM;AACJ,eAAA,sBAAsB,YAAY,GACzC,OAAO,oBAAoB,UAAU,GACrC,aAAa,YAAY,GACzB,MAAM;AAAA,MAAA;AAAA,IACR,CACD;AAAA,EACH;AAEA,WAAS,gBAAgB,YAAiC;AACxD,WAAA,mBAAmB,KAAK,UAAU,GAC3B,OAAO,aAAa,EAAE,KAAK,MAAM,CAAC,QAAQ,QAAQ,UAAU,CAAC;AAAA,EACtE;AAEA,WAAS,QAAQ;AACf,WAAO,mBAAmB,SAAS,KAAK,qBAAqB,SAAS;AAC7D,aAAA,KAAK,mBAAmB,MAAO,CAAA;AAAA,EAE1C;AACF;ACnDA,MAAM,yBAAyB;AAI/B,SAAS,kBACP,QACA,WACA,MACA,UAAyB,CAAA,GACA;AACzB,QAAM,UAAU,QAAQ,UAClB,mBAAmB,QAAQ,uBAC3B,EAAC,OAAO,OAAO,aAAa,YAAY,OAAA,IAAU;AACjD,SAAA,SAAS,IAAI,EAAE;AAAA,IACpB;AAAA,MAAW;AAAA;AAAA,QAETC,GAAa,IAAI;AAAA;AAAA,IACnB;AAAA,IAEA;AAAA,MAAS,CAACpE;AAAA;AAAA,QAERA,QAAO,cAAc,QAAQ,UAAU,SAAS,SAASA,KAAI,IAAIoE,GAAa,IAAI;AAAA;AAAA,IACpF;AAAA,IAEA,SAAS,CAAC,aACJ,WACKA,GAAa;AAAA;AAAA,MAElB,MAAM;AAAA,MACN,IAAI,SAAS;AAAA,MACb,OAAO;AAAA,IAAA,CACR,IAEI,OAAO,WAAW,OACtB,OAAO,WAAW,MAAM;AAAA,MACvB,KAAK;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD,CAAA,EACA;AAAA,MACC;AAAA,QAAI,CAAC,UACH,MAAM,SAAS,aACX;AAAA;AAAA,UAEE,MAAM;AAAA,UACN,IAAI,MAAM,KAAK,SAAS;AAAA,UACxB,OAAO,MAAM,KAAK;AAAA,QAAA,IAEpB;AAAA,MACN;AAAA,IAAA,CAEL;AAAA,EAAA;AAEL;AAEA,MAAM,cAAc,mBAAmB,mBAAmB,sBAAsB,GAEnE,mBAAmB,CAC9B,QACA,MACA,YACG,YAAY,QAAQ,SAAS,MAAM,OAAO,GAElC,kBAAkB,CAAC,QAAsB,MAAmB,YACvE,YAAY,QAAQ,QAAQ,MAAM,OAAO;AAG3C,SAAS,gBAAgB,sBAA4ChH,KAAY;AAC/E,SAAO,qBAAqB,aAAa,EAAC,OAAO,aAAa,MAAMA,OAAK;AAAA,IACvE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AACH;AAEgB,SAAA,kBAAkB,sBAA4CA,KAAY;AACjF,SAAA,gBAAgB,sBAAsBA,GAAE;AACjD;AAEgB,SAAA,iBAAiB,sBAA4CA,KAAY;AAChF,SAAA,gBAAgB,sBAAsBA,GAAE;AACjD;AAEA,SAAS,cACP,QACA,MACA4C,OAC2C;AAC3C,SAAO,OAAO,WAAW;AAAA,IACvB;AAAA,IACA,EAAC,cAAc,MAAM,MAAAA,MAAI;AAAA,IACzB,EAAC,KAAK,uBAAsB;AAAA,EAAA;AAEhC;AAEA,SAAS,SAAS,MAA4C;AACrD,SAAA,IAAI,WAAW,CAAC,eAAe;AAC9B,UAAA,SAAS,IAAI;AACnB,WAAA,OAAO,SAAS,MAAM;AACpB,iBAAW,KAAK,OAAO,MAAqB,GAC5C,WAAW;IAAS,GAEtB,OAAO,UAAU,CAAC,QAAQ;AACxB,iBAAW,MAAM,GAAG;AAAA,IAEtB,GAAA,OAAO,kBAAkB,IAAI,GACtB,MAAM;AACX,aAAO,MAAM;AAAA,IAAA;AAAA,EACf,CACD;AACH;AAEA,SAAS,SAAS,MAA8C;AAC9D,SAAI,CAAC,OAAO,UAAU,CAAC,OAAO,OAAO,UAAU,CAAC,OAAO,aAC9CoE,GAAa,IAAI,IAEnB,SAAS,IAAI,EAAE;AAAA,IACpB,SAAS,CAAC,gBAAgB,OAAO,OAAO,OAAO,SAAS,WAAW,CAAC;AAAA,IACpE,IAAI,aAAa;AAAA,EAAA;AAErB;AAEA,SAAS,cAAc,QAA6B;AAC3C,SAAA,MAAM,UAAU,IACpB,KAAK,IAAI,WAAW,MAAM,GAAG,CAAC,MAAM,KAAK,EAAE,SAAS,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EACnE,KAAK,EAAE;AACZ;AClJO,MAAM,oBAAoB,WCI3B,qBAAqB,MAAM,CAAC,iBAAiB,CAAC;AAEpC,SAAA,kBAAkB,UAAuB,IAAyB;AACzE,SAAA;AAAA,IACL,MAAM;AAAA,IACN;AAAA,EAAA;AAEJ;AAEO,MAAM,gBAAgB,kBAAkB,CAAC,kBAAkB,CAAC;AAE5D,SAAS,yBAAyB,MAAY;AACnD,QAAM,OAAU,oBAAA,KAAO,GAAA,YAAA,GACjB,QAAQ;AAAA,IACZ,UAAU;AAAA,IACV,WAAW;AAAA,IACX,WAAW;AAAA,IACX,MAAM,EAAC,MAAM,KAAK,MAAM,MAAM,KAAK,KAAI;AAAA,EAAA;AAGlC,SAAA,kBAAkB,CAAC,IAAI,OAAO,CAAC,iBAAiB,CAAC,CAAC,CAAC;AAC5D;ACfgB,SAAA,WACd,QACA,MACA,SACiC;AACjC,QAAM,UAAU,gBAAgB,QAAQ,MAAM,OAAO,EAAE;AAAA,IACrD,IAAI,CAAC,UACC,MAAM,SAAS,aACV,kBAAkB;AAAA,MACvB,IAAI,EAAC,OAAO,aAAa,MAAM,MAAM,MAAM,IAAG,GAAG,CAAC,OAAO,CAAC;AAAA,MAC1D,IAAI,KAAK,CAAC,mBAAmB,UAAU,CAAC;AAAA,MACxC,yBAAQ,KAAK,GAAE,eAAe,CAAC,mBAAmB,SAAS,CAAC;AAAA,IAC7D,CAAA,IAEI,kBAAkB;AAAA,MACvB,IAAI,MAAM,SAAS,CAAC,mBAAmB,UAAU,CAAC;AAAA,MAClD,yBAAQ,KAAK,GAAE,eAAe,CAAC,mBAAmB,SAAS,CAAC;AAAA,IAAA,CAC7D,CACF;AAAA,EAAA;AAGI,SAAA,OAAO,GAAG,yBAAyB,IAAI,CAAC,GAAG,SAAS,GAAG,aAAa,CAAC;AAC9E;ACzBA,SAAS,QAAQ,GAAW;AACnB,SAAA,CAAC,GAAG,GAAG,GAAG,CAAC,EAAE,QAAQ,CAAC,IAAI;AACnC;AASA,SAASC,SAAO,KAAsC,SAAqB;AACnE,QAAA,IAAI,QAAQ,GACZ,IAAI,QAAQ,GAEZ,WAAW,QAAQ,WAAW,MAAM,KAAK,KAAK;AAE/C,SAAA,QAAA,IAAA,UAAU,GAAG,CAAA,GAClB,OAAK,QAAA,IAAA,OAAO,UACZ,OAAK,QAAA,IAAA,UAAU,CAAC,GAAG,CAAC,CAAA;AACtB;AAGA,SAAS,KAAK,QAA2B,GAAY,GAAY;AACzD,QAAA,MAAM,OAAO,WAAW,IAAI;AAClC,SAAA,QAAA,IAAK,UAAU,IAAI,OAAO,QAAQ,GAAG,IAAI,OAAO,SAAS,CAAA,GACzD,mBAAK,MAAM,IAAI,KAAK,GAAG,IAAI,KAAK,CAAA;AAClC;AAEA,MAAM,kBAAkB;AAAA,EACtB,EAAC,IAAI,QAAQ,SAAS,EAAC;AAAA,EACvB,EAAC,IAAI,UAAU,SAAS,EAAC;AAAA,EACzB;AAAA,IACE,IAAI;AAAA,IACJ,SAAS;AAAA,EACX;AAAA,EACA,EAAC,IAAI,UAAU,SAAS,EAAC;AAAA,EACzB,EAAC,IAAI,UAAU,SAAS,GAAE;AAAA,EAC1B,EAAC,IAAI,QAAQ,SAAS,GAAE;AAAA,EACxB;AAAA,IACE,IAAI;AAAA,IACJ,SAAS;AAAA,EACX;AAAA,EACA,EAAC,IAAI,QAAQ,SAAS,IAAG;AAC3B,GAYM,eAAmC;AAAA,EACvC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAEa,sBAAmC,YAE1C,aAAa;AAGnB,SAAS,QAAQ,KAAuB,mBAA8C;AAC9E,QAAA,cAAc,gBAAgB,oBAAoB,CAAC,GAEnD,QAAQ,IAAI,SAAS,IAAI;AAC/B,MAAI,QAAQ,aAAa,OACzB,IAAI,SAAS,IAAI,QAAQ;AAGnB,QAAA,SAAS,SAAS,cAAc,QAAQ,GACxC,MAAM,OAAO,WAAW,IAAI;AAoBlC,MAjBI,QAAQ,iBAAiB,KAC3B,OAAO,SAAS,IAAI,OACpB,OAAO,QAAQ,IAAI,WAEnB,OAAO,QAAQ,IAAI,OACnB,OAAO,SAAS,IAAI,SAIlB,YAAY,OAAO,YACrB,KAAK,QAAQ,IAAM,EAAK,GAEtB,YAAY,OAAO,YACrB,KAAK,QAAQ,IAAO,EAAI,GAItB,YAAY,YACdA,SAAO,KAAK;AAAA,IACV,SAAS,YAAY;AAAA,IACrB,GAAG,OAAO,QAAQ;AAAA,IAClB,GAAG,OAAO,SAAS;AAAA,EAAA,CACpB,GAEG,QAAQ,iBAAiB,IAAG;AACxB,UAAA,IAAI,OAAO,QAAQ,OAAO;AAChC,WAAA,QAAA,IAAK,UAAU,IAAI,GAAG,CAAC,IAAI,CAAA;AAAA,EAC7B;AAGF,SAAA,OAAA,QAAA,IAAK,UAAU,KAAK,GAAG,GAAG,IAAI,OAAO,IAAI,MAClC,GAAA;AACT;AAGgB,SAAA,OAAO,OAAyB,eAA4B;AACnE,SAAA,IAAI,WAAW,CAAC,aAAa;AAE5B,UAAA,cAAc,aAAa,QAAQ,aAAa,IAAI,GACpD,SAAS,QAAQ,OAAO,WAAW;AAChC,aAAA,KAAK,OAAO,UAAU,cAAc,GAAG,CAAC,GACjD,SAAS;EAAS,CACnB;AACH;AClIA,SAAS,sBACP,MACA,QACyC;AAClC,SAAA,IAAI,WAAW,CAAC,aAAa;AAC5B,UAAA,SAAS,IAAI,OAAO;AACnB,WAAA,OAAA,UAAU,CAAC,QAAQ,SAAS,MAAM,GAAG,GAC5C,OAAO,SAAS,MAAM;AACpB,eAAS,KAAK,OAAO,MAAM,GAC3B,SAAS;IAEX,GAAA,OAAO,kBAAkB,WAAW,SAAY,OAAO,KAAK,MAAM,GAAG,MAAM,CAAC,GACrE,MAAM,OAAO,MAAM;AAAA,EAAA,CAC3B;AACH;AAEA,MAAM,qBAAqB,0CAGrB,qBAAqB;AAEpB,SAAS,SAAS,MAAY;AACnC,SAAOF,KAAe,sBAAsB,MAAM,kBAAkB,CAAC,EAAE;AAAA,IACrE,IAAI,CAAC,QAAQ,KAAK,GAAG,CAAC;AAAA,IACtB,WAAW,CAAC,WACL,mBAAmB,KAAK,MAAM,OAAO,KAExC,QAAQ,KAAK,wCAAwC,MAAM,OAAO,EAAE,GAE/DC,GAAa,CAAE,CAAA,EACvB;AAAA,EAAA;AAEL;AC/BA,SAASE,YAAU,KAA2C;AACrD,SAAA,IAAI,WAAW,CAAC,aAAa;AAC5B,UAAA,QAAQ,IAAI,OAAO;AAEzB,WAAA,MAAM,UAAU,MAAM;AACX,eAAA;AAAA,QACP,IAAI,MAAM,kCAAkC,GAAG,0CAA0C;AAAA,MAAA;AAAA,IAC3F,GAEF,MAAM,SAAS,MAAM;AAEnB,eAAS,KAAK,KAAK,GACnB,SAAS,SAAS;AAAA,IAAA,GAEpB,MAAM,MAAM,KACL,MAAM;AAAA,IAAA;AAAA,EAEb,CACD;AACH;AAEgB,SAAA,YAAY,MAAY,aAA0B;AAChE,SAAOA,YAAU,OAAO,IAAI,gBAAgB,IAAI,CAAC,EAAE;AAAA,IACjD,SAAS,CAAC,UAAU,OAAO,OAAO,WAAW,CAAC;AAAA,EAAA;AAElD;ACbgB,SAAA,YACd,QACA,MACA,SACiC;AACjC,QAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,EAAE;AAAA,IACtD,OAAO,CAAC,UAAe,MAAM,UAAU,UAAU;AAAA,IACjD,IAAI,CAAC,WAAW;AAAA,MACd,GAAG;AAAA,MACH,UAAU,IAAK,MAAM,UAAU,MAAO;AAAA,IAAA,EACtC;AAAA,IAEF,IAAI,CAAC,UACC,MAAM,SAAS,aACV,kBAAkB;AAAA,MACvB,IAAI,EAAC,OAAO,aAAa,MAAM,MAAM,MAAM,IAAG,GAAG,CAAC,OAAO,CAAC;AAAA,MAC1D,IAAI,KAAK,CAAC,mBAAmB,UAAU,CAAC;AAAA,MACxC,yBAAQ,KAAK,GAAE,eAAe,CAAC,mBAAmB,WAAW,CAAC;AAAA,IAC/D,CAAA,IAEI,kBAAkB;AAAA,MACvB,IAAI,MAAM,SAAS,CAAC,mBAAmB,UAAU,CAAC;AAAA,MAClD,yBAAQ,KAAK,GAAE,eAAe,CAAC,mBAAmB,WAAW,CAAC;AAAA,IAAA,CAC/D,CACF;AAAA,EAGG,GAAA,iBAAiB,SAAS,IAAI,EAAE;AAAA,IACpC;AAAA,MAAS,CAAC,aACR,YAAY,MAAO,SAAkB,eAAe,mBAAmB;AAAA,IACzE;AAAA,IACA,WAAW,CAAC,WAEV,QAAQ;AAAA,MACN;AAAA,MACA,KAAK;AAAA,MACL,MAAM;AAAA,IAAA,GAID,GAAG,IAAI,EACf;AAAA,IACD,OAAO,OAAO;AAAA,IACd,IAAI,CAAC,aAAa,kBAAkB,CAAC,IAAI,UAAU,CAAC,mBAAmB,cAAc,CAAC,CAAC,CAAC,CAAC;AAAA,EAAA;AAGpF,SAAA;AAAA,IACL,GAAG,yBAAyB,IAAI,CAAC;AAAA,IACjC,MAAM,SAAS,cAAc;AAAA,IAC7B,GAAG,aAAa;AAAA,EAAA;AAEpB;AC3DA,MAAM,eAA4B;AAAA,EAChC,MAAM;AAAA,EACN,SAAS;AAAA,EACT,QAAQ,CAAC,QAAsB,MAAY,MAAmB,YAC5D,YAAY,QAAQ,MAAM,OAAO;AACrC,GAEM,cAA2B;AAAA,EAC/B,MAAM;AAAA,EACN,SAAS;AAAA,EACT,QAAQ,CAAC,QAAsB,MAAY,MAAkB,YAC3D,WAAW,QAAQ,MAAM,OAAO;AACpC,GAEM,cAA2B;AAAA,EAC/B,MAAM;AAAA,EACN,SAAS;AAAA,EACT,QAAQ,CAAC,QAAsB,MAAY,MAAkB,YAC3D,WAAW,QAAQ,MAAM,OAAO,EAAE;AAAA,IAChC,IAAI,CAAC,aAAa;AAAA,MAChB,MAAM;AAAA,MACN,SAAS,CAAC,IAAI,OAAO,CAAC;AAAA,IAAA,EACtB;AAAA,EACJ;AAAA;AAAA;AAIJ,GAEa,YAA6B,CAAC,cAAc,aAAa,WAAW,EAAE;AAAA,EACjF,CAAC,UAAU,OAAO;AAAA,IAChB,GAAG;AAAA,IACH,UAAU;AAAA,EAAA;AAEd;ACnCgB,SAAA,gBAAgB,MAAkB,MAAiC;AAE/E,SAAA,UAAU,KAAK,CAAC,aAAa;AAVjC,QAAA/F;AAWM,WACEgG,KAAQ,SAAS,MAAM,IAAI,KAC3B,QAAQ,MAAM,SAAS,OAAO,KAC9B,QAAQ,QAAOhG,WAAK,YAAL,OAAA,SAAAA,IAAwB,WAAU,EAAE;AAAA,EAEtD,CAAA,KAAK;AAEV;ACyBO,SAAS,oBAAoBX,QASjC;AACK,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,IAAI,oBAEE;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QAEE,eAAe,2BAEf,WAAW,OAAA,GACX,sBAAsB,OAAqC,CAAA,CAAE;AAEnE,eAAa,OAAO,MAAM,SAAS,CAAC,UAAU,aAAa;AA/E7D,QAAAW;AAgFQ,KAAC,YAAY,cACfA,MAAA,SAAS,YAAT,QAAkBA,IAAA,MAAA;AAAA,EAAA,CAErB;AAED,QAAM,cAAc;AAAA,IAClB,CAAC,UAAsB;AAKjB,YAAM,kBAAkB,MAAM,UAAU,MAAM,kBAAkB,SAAS,WAC3E,YAAY,OAAO,MAAM,IAAI;AAAA,IAEjC;AAAA,IACA,CAAC,OAAO,MAAM,MAAM,WAAW;AAAA,KAG3B,aAAa;AAAA,IACjB,CAAC,UAAsB;AAMnB,YAAM,kBAAkB,MAAM,WAC7B,MAAM,kBAAkB,SAAS;AAAA,MAEhC,EAAE,SAAS,mBAAmB,iBAEhC,WAAW,OAAO,MAAM,IAAI;AAAA,IAEhC;AAAA,IACA,CAAC,OAAO,MAAM,MAAM,UAAU;AAAA,EAG1B,GAAA,WAAW,OAAO,OAAO,MAAM,KAAK;AAC1C,YAAU,MAAM;AACL,aAAA,UAAU,OAAO,MAAM;AAAA,EAC/B,GAAA,CAAC,OAAO,MAAM,KAAK,CAAC;AAEvB,QAAM,eAAe;AAAA,IACnB,CAAC,UAAiC;AAChC,YAAM,UAAU,WAAW,KAAK,KAAK,EAAE;AAMvC,UAJ2B,QAAQ;AAAA,QACjC,CAAC+D,WAAUA,OAAM,SAAS,WAAWA,OAAM,KAAK,WAAW;AAAA,MAAA,MAK3D,SAAS,UAAU,SAAS,SAAS,WAAW,CAAI,GAAA,OAAO,GAGvD,MAAM,QAAQ,SAAS,OAAO,KAAK,CAAC,SAAS,QAAQ,SAAQ;AAEtD,iBAAA,WAAW,KAAK,MAAM,CAAC,OAAO,IAAI,CAAC,CAAC,CAAC;AAC9C;AAAA,MACF;AAGF,eAAS,WAAW,KAAK,KAAK,EAAE,QAAQ,aAAa,CAAE,CAAA,CAAC,EAAE,UAAU,OAAO,IAAI,CAAC;AAAA,IAClF;AAAA,IACA,CAAC,UAAU,OAAO,MAAM,QAAQ;AAAA,EAAA,GAE5BoB,uBAAsB,iCAEtB,QAAQ,YAER,iBAAiB,YAAY,MAAM;AACpB,uBAAA,OAAO,MAAM,MAAM,EAAI;AAAA,EAAA,GACzC,CAAC,oBAAoB,OAAO,MAAM,IAAI,CAAC,GAEpC,eAAe,YAAY,MAAM;AAClB,uBAAA,OAAO,MAAM,MAAM,EAAK;AAAA,EAAA,GAC1C,CAAC,oBAAoB,OAAO,MAAM,IAAI,CAAC,GAEpC,qBAAqB;AAAA,IACzB,CAAC,YAAoB;AACA,yBAAA,OAAO,MAAM,KAAK,OAAO,EAAC,MAAM,QAAQ,CAAA,GAAG,EAAI;AAAA,IACpE;AAAA,IACA,CAAC,oBAAoB,OAAO,MAAM,IAAI;AAAA,KAGlC,mBAAmB;AAAA,IACvB,CAAC,YAAoB;AACA,yBAAA,OAAO,MAAM,KAAK,OAAO,EAAC,MAAM,QAAQ,CAAA,GAAG,EAAK;AAAA,IACrE;AAAA,IACA,CAAC,oBAAoB,OAAO,MAAM,IAAI;AAAA,KAGlC,iBAAiB;AAAA,IACrB,CAAC,SAAe;AACd,iBAAW,IAAI,GACf,mBAAmB,MAAM,EAAK;AAAA,IAChC;AAAA,IACA,CAAC,YAAY,kBAAkB;AAAA,EAAA,GAG3B,kBAAkB,YAAY,MAAM;AAC7B,eAAA,OAAO,MAAM,IAAI,GAC5B,mBAAmB,OAAO,MAAM,MAAM,EAAI;AAAA,EAAA,GACzC,CAAC,YAAY,OAAO,MAAM,MAAM,kBAAkB,CAAC,GAEhD,eAAe;AAAA,IACnB,CAAC,UAA6C;AACxC,UAAA,MAAM,MAAM,WAAW;AACnB,cAAA,IAAI,MAAM,+CAA+C;AAE3D,YAAA,gBAAgB,MAAM,MAAM,IAAI,CAAC,SAAS,UAAU,IAAI,CAAC;AAE/D,mBAAa,WAAW,KAAK,CAAC,OAAO,eAAe,MAAM,UAAU,CAAC,MAAM,aAAa,CAAC,CAAC,CAAC,CAAC;AAE5F,YAAM,eAAe,cAAc,CAAC,EAAE,MAChC,WAAW,CAAC,GAAG,OAAO,MAAM,MAAM,EAAC,MAAM,aAAa,CAAA;AAE5D,kBAAY,QAAQ;AAEd,YAAA,aAAa,MAAM,SAAS;AAE9B,YAAM,mBACJ,cACF,eAAe,QAAQ,IAGzB,0BAA0B,eAAe,OAAO,MAAM,YAAYA,oBAAmB,EAClF;AAAA,QACC,IAAI,CAAC,WAAW;AACV,iBAAO,SAAS,UAClB,aAAa,OAAO,OAAO,IAE3B,MAAM,KAAK;AAAA,YACT,OAAO;AAAA,YACP,aAAa,6CAA6C,OAAO,WAAW,KAAK,KAAK,OAAO,MAAM,OAAO;AAAA,YAC1G,QAAQ;AAAA,UAAA,CACT;AAAA,QAAA,CAEJ;AAAA,QAEF,UAAU;AAAA,QACT,UAAU,MAAM;AACV,wBACF,eAAe,QAAQ;AAAA,QAE3B;AAAA,MAAA,CACD;AAAA,IAEP;AAAA,IACA;AAAA,MACE;AAAA,MACA;AAAA,MACA,OAAO,MAAM;AAAA,MACb,OAAO,MAAM;AAAA,MACb;AAAA,MACAA;AAAA,MACA;AAAA,IACF;AAAA,KAGI,iBAAiB;AAAA,IACrB,CAAC,UAAmC;AAC5B,YAAA,QAAQ,OAAO,MAAM,OACrB,OAAO,+BAAQ,MAAM,SAAA,GACrB,UAAU,SAAA,OAAA,SAAA,MAAQ,MAAM,OAAA;AAC1B,UAAA,MAAM,cAAc,MAAM,SAI9B;AAAA,YAAI,EAAE,QAAA,QAAA,KAAc,SAAQ,EAAE,2BAAiB,OAAM;AAE3C,kBAAA;AAAA,YACN;AAAA,UAAA;AAGF;AAAA,QACF;AAEa,qBAAA;AAAA,UACX,MAAM,CAAC,EAAC,MAAM,KAAK,KAAK,CAAA,CAAC;AAAA,UACzB,OAAO,CAAC,IAAI,GAAG,MAAM,YAAY,MAAM,UAAU,WAAW,SAAS;AAAA,YACnE,EAAC,MAAM,QAAQ,KAAI;AAAA,UAAA,CACpB;AAAA,QAAA,CACF;AAAA,MAAA;AAAA,IACH;AAAA,IACA,CAAC,cAAc,OAAO,MAAM,KAAK;AAAA,KAG7B,oBAAoB;AAAA,IACxB,CAAC,SAAc;AACb,mBAAa,CAAC,aAAa,EAAE,GAAG,OAAO,CAAC,UAAU,IAAI,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;AAAA,IAC3E;AAAA,IACA,CAAC,YAAY;AAAA,KAET,mBAAmB;AAAA,IACvB,CAAC,SAAc;AACb,mBAAa,CAAC,aAAa,CAAE,CAAA,GAAG,OAAO,CAAC,UAAU,IAAI,CAAC,GAAG,SAAS,CAAC,EAAE,CAAC,CAAC,CAAC;AAAA,IAC3E;AAAA,IACA,CAAC,YAAY;AAAA,KAGT,mBAAmB;AAAA,IACvB,CAAC,YAAoB;AACf,0BAAoB,QAAQ,OAAO,MACrC,oBAAoB,QAAQ,OAAO,EAAE,YAAY,GACjD,OAAO,oBAAoB,QAAQ,OAAO,IAE5C,aAAa,CAAC,MAAM,CAAC,EAAC,MAAM,QAAO,CAAC,CAAC,CAAC,CAAC;AAAA,IACzC;AAAA,IACA,CAAC,YAAY;AAAA,KAGT,uBAAuB;AAAA,IAC3B,CAAC,SAAe;AACd,kBAAY,OAAO,MAAM,KAAK,OAAO,IAAI,CAAC;AAAA,IAC5C;AAAA,IACA,CAAC,OAAO,MAAM,MAAM,WAAW;AAAA,KAG3B,eAAe;AAAA,IACnB,OAAiD;AAAA,MAC/C,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,IAAI,OAAO,MAAM;AAAA,MACjB,KAAK;AAAA,MACL,oBAAoB,oBAAoB,OAAO,MAAM,IAAI,OAAO,MAAM,WAAW,WAAW;AAAA,IAAA;AAAA,IAE9F,CAAC,YAAY,aAAa,OAAO,MAAM,IAAI,OAAO,MAAM,WAAW,WAAW;AAAA,EAAA,GAG1E,SAAS,UAAU,6BAA6B,GAChD,cAAc,kBAEd,uBAAuB,YAAY,WAAW,MAAM,eACpD,sBAAsB,YAAY,WAAW,KAAK,eAElDc,oBAAkB;AAAA,IACtB,CAAC,MAAkB,SACbD,KAAQ,SAAS,IAAI,KAAK,CAAC,wBAG3BA,KAAQ,QAAQ,IAAI,KAAK,CAAC,sBACrB,OAGFE,gBAAuB,MAAM,IAAI;AAAA,IAE1C,CAAC,qBAAqB,oBAAoB;AAAA,KAGtC,eAAe;AAAA,IACnB,CAAC,EAAC,MAAM,YAAY,eAA2B;AAC7C,YAAM,OAAO,sBAAsB,UAAU,GACvC,MAAM,KAAK;AAEJ,mBAAA;AAAA,QACX,OAAO,CAAC,IAAI;AAAA,QACZ,UAAU;AAAA,QACV,eAAe;AAAA,QACf,MAAM;AAAA,MAAA,CACP;AAED,YAAM,UAAU,SAAS,OAAO,QAAQ,MAAM,UAAU,EAAE;AAAA,QACxD;AAAA,UAAI,CAAC,wBACH,WAAW,KAAK,oBAAoB,WAAW,CAAE,CAAA,EAAE,UAAU,EAAC,MAAM,KAAI;AAAA,QAC1E;AAAA,QACA,IAAI,CAAC,UAAU,aAAa,MAAM,OAAO,CAAC;AAAA,MAAA;AAG5C,0BAAoB,UAAU;AAAA,QAC5B,GAAG,oBAAoB;AAAA,QACvB,CAAC,GAAG,GAAG,QAAQ,UAAU;AAAA,MAAA;AAAA,IAE7B;AAAA,IACA,CAAC,QAAQ,cAAc,YAAY;AAAA,EAAA,GAG/B,aAAa,QAAQ,OAClB;AAAA,IACL,OAAO,OAAO,MAAM;AAAA,IACpB,SAAS,OAAO,MAAM;AAAA,IACtB,OAAO,OAAO,MAAM;AAAA,IACpB,UAAU,OAAO,MAAM;AAAA,IACvB,YAAY,OAAO,MAAM;AAAA,IACzB,SAAS,OAAO,MAAM;AAAA,IACtB,IAAI,OAAO,MAAM;AAAA,IACjB,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb,YAAY;AAAA,IAEZ,WAAW,OAAO,MAAM;AAAA,IACxB,SAAS,OAAO,MAAM;AAAA,IAEtB,MAAM,OAAO,MAAM;AAAA,IAEnB,UAAU;AAAA,IACV,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,cAAc;AAAA,IACd,cAAc;AAAA,IACd,eAAe;AAAA,IACf,aAAa;AAAA,IACb,qBAAAf;AAAA,IACA,UAAU;AAAA,IAAA,iBACVc;AAAAA,IACA,YAAY,OAAO,MAAM;AAAA,IACzB,UAAU,OAAO,MAAM;AAAA,IACvB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IAED;AAAA,IACD,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACAd;AAAA,IACA;AAAA,IACAc;AAAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD,CAAA,GAEK,gBAAgB,QAAQ,MAAM,YAAY,UAAU,GAAG,CAAC,YAAY,WAAW,CAAC,GAEhF,aAAa,QAAQ,OAClB;AAAA,IACL,SAAS;AAAA,IACT,MAAM,OAAO;AAAA,IACb,OAAO,OAAO;AAAA,IACd,OAAO,OAAO,MAAM;AAAA,IACpB,OAAO,OAAO,MAAM;AAAA,IACpB,OAAO,OAAO,MAAM,WAAW;AAAA,IAC/B,aAAa,OAAO,MAAM,WAAW;AAAA,IACrC,aAAa,OAAO;AAAA,IACpB,WAAW,OAAO;AAAA,IAClB,SAAS,OAAO,MAAM;AAAA,IACtB,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,YAAY,OAAO,MAAM;AAAA,IACzB,SAAS,OAAO,MAAM;AAAA,IACtB,MAAM,OAAO,MAAM;AAAA,IACnB,UAAU,OAAO,MAAM;AAAA,IACvB,YAAY,OAAO,MAAM;AAAA,IACzB,UAAU;AAAA,IACV;AAAA,EAAA,IAED;AAAA,IACD;AAAA,IACA,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO;AAAA,IACP,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAGC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,UAAU;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MAEC,UAAA,QAAQ,MAAM,YAAY,UAAU,GAAG,CAAC,YAAY,WAAW,CAAC;AAAA,IAAA;AAAA,EAAA;AAGvE;ACxegB,SAAA,WAAW,MAAY,UAAmB;AACjD,SAAA,IAAI,WAA0B,CAAC,aAAa;AAC3C,UAAA,SAAS,IAAI;AACZ,WAAA,OAAA,UAAU,CAAC,UAAU,SAAS,MAAM,KAAK,GAChD,OAAO,SAAS,MAAM;AACpB,eAAS,KAAK,OAAO,MAAuB,GAC5C,SAAS;OAEX,OAAO,WAAW,MAAM,QAAQ,GACzB,MAAM;AACX,aAAO,MAAM;AAAA,IAAA;AAAA,EACf,CACD;AACH;AC0BA,SAAS,KAAQ,KAAU3F,OAAc,IAAiB;AACxD,QAAM,OAAO,IAAI,MAAA,GACX,MAAM,KAAKA,KAAI;AAChB,SAAA,KAAA,OAAOA,OAAM,CAAC,GACnB,KAAK,OAAO,IAAI,GAAG,GAAG,GACf;AACT;AAUA,SAAS,YAIP,OAIA,KAIA,OACK;AACC,QAAA,OAAO,IAAI;AACjB,SAAA,KAAK,OAAO,QAAQ,GAAG,GAAG,GAAG,KAAK,GAC3B;AACT;AACA,SAAS,gBAAgB,OAAe;AAC/B,SAAA,QAAQ,KAAK,KAAK;AAC3B;AAIA,SAAS,oBAAoB,MAAc,YAA0B;AACnE,MAAI,kBAAkB,IAClB,iBAAiB,IACjB,iBAAiB;AACrB,SAAA,WAAW,QAAQ,CAAC,cAAc;AAC5B,wBAAoB,SAAS,MAC/B,kBAAkB,KAEhB,mBAAmB,SAAS,MAC9B,iBAAiB,KAEf,mBAAmB,SAAS,MAC9B,iBAAiB;AAAA,EAAA,CAEpB,GAEG,oBAAoB,SAAS,UAAU,SAAS,WAAiB,SAAS,SAC1E,kBAAkB,gBAAgB,IAAI,IAAU,OAAO,IAAI,IACxD,iBAAiB,OAAO;AACjC;AAEA,SAAS,wBAAwB,WAAiE;AACzF,SAAA;AAAA,IACL,UAAU;AAAA,IACV,SAAS;AAAA,IACT,MAAM;AAAA,IACN,OAAO,QAAQ,MAAM;AACZ,aAAA,WAAW,MAAM,OAAO,EAAE;AAAA,QAC/B;AAAA,UAAI,CAAC,gBACH,eACI,OAAA,SAAA,YAAA,MAAM,UACP,IAAI,CAAC,UAAU,oBAAoB,OAAO,SAAS,CAAA,EACnD,OAAO,CAAC,MAAM,MAAM,MAAA;AAAA,QACzB;AAAA,QACA,OAAO,CAAC,MAA6C,MAAM,QAAQ,CAAC,CAAC;AAAA,QACrE,IAAI,CAAC,WAAsB;AAAA,UACzB,MAAM;AAAA,UACN,SAAS,CAAC,OAAO,OAAO,SAAS,CAAC,EAAE,CAAC,CAAC;AAAA,QAAA,EACtC;AAAA,MAAA;AAAA,IAEN;AAAA,EAAA;AAEJ;AAOO,SAAS,uBAAuBjB,QASpC;AACK,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,IAAI,oBACE;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAAA,QACE,eAAe,wBAEf,GAAA,WAAW,OAAsC,GACjD,sBAAsB,OAAA,GACtB,SAAS,UAAU,6BAA6B;AAEtD,eAAa,OAAO,MAAM,SAAS,CAAC,UAAU,aAAa;AArK7D,QAAAW;AAsKQ,KAAC,YAAY,cACfA,MAAA,SAAS,YAAT,QAAkBA,IAAA,MAAA;AAAA,EAAA,CAErB;AAED,QAAM,cAAc;AAAA,IAClB,CAAC,UAAsB;AAKjB,YAAM,kBAAkB,MAAM,UAAU,MAAM,kBAAkB,SAAS,WAC3E,YAAY,OAAO,MAAM,IAAI;AAAA,IAEjC;AAAA,IACA,CAAC,OAAO,MAAM,MAAM,WAAW;AAAA,KAG3B,aAAa;AAAA,IACjB,CAAC,UAAsB;AAKjB,YAAM,kBAAkB,MAAM,UAAU,MAAM,kBAAkB,SAAS,WAC3E,WAAW,OAAO,MAAM,IAAI;AAAA,IAEhC;AAAA,IACA,CAAC,OAAO,MAAM,MAAM,UAAU;AAAA,KAG1B,eAAe;AAAA,IACnB,CAAC,UAAiC;AAChC,YAAM,UAAU,WAAW,KAAK,KAAK,EAAE;AAMvC,UAJ2B,QAAQ;AAAA,QACjC,CAAC+D,WAAUA,OAAM,SAAS,WAAWA,OAAM,KAAK,WAAW;AAAA,MAAA,GAGrC;AAEtB,cAAM,SAAS,SAAS,OAAO,MAAM,SAAS,CAAA,GAAI,OAAO;AAGzD,YAAI,MAAM,QAAQ,MAAM,KAAK,CAAC,OAAO,QAAQ;AAElC,mBAAA,WAAW,KAAK,MAAM,CAAC,OAAO,IAAI,CAAC,CAAC,CAAC;AAC9C;AAAA,QACF;AAAA,MACF;AAEA,eAAS,WAAW,KAAK,KAAK,EAAE,QAAQ,aAAa,CAAE,CAAA,CAAC,EAAE,UAAU,OAAO,IAAI,CAAC;AAAA,IAClF;AAAA,IACA,CAAC,UAAU,OAAO,MAAM,OAAO,MAAM,KAAK;AAAA,KAGtC,qBAAqB;AAAA,IACzB,CAAC,cAAuB;AACH,yBAAA,OAAO,MAAM,MAAM,SAAS;AAAA,IACjD;AAAA,IACA,CAAC,oBAAoB,OAAO,MAAM,IAAI;AAAA,EAAA,GAGlC,iBAAiB,YAAY,MAAM;AACpB,uBAAA,OAAO,MAAM,MAAM,EAAI;AAAA,EAAA,GACzC,CAAC,oBAAoB,OAAO,MAAM,IAAI,CAAC,GACpC,eAAe,YAAY,MAAM;AAClB,uBAAA,OAAO,MAAM,MAAM,EAAK;AAAA,EAAA,GAC1C,CAAC,oBAAoB,OAAO,MAAM,IAAI,CAAC,GAEpC,WAAW;AAAA,IACf,CAAC,cAAgC;AAC/B,mBAAa,UAAU,WAAW,IAAI,UAAU,IAAI,SAAS,CAAC;AAAA,IAChE;AAAA,IACA,CAAC,YAAY;AAAA,KAGT,iBAAiB;AAAA,IACrB,CAAC,UAAmC;AAClC,YAAM,EAAC,QAAQ,CAAA,MAAM,OAAO;AACxB,YAAM,cAAc,MAAM,WAI9B,SAAS,KAAK,OAAO,MAAM,WAAW,MAAM,OAAO,CAAC;AAAA,IACtD;AAAA,IACA,CAAC,OAAO,OAAO,QAAQ;AAAA,KAGnB,eAAe;AAAA,IACnB,CAAC,cAA8B;AAC7B,YAAM,EAAC,QAAQ,CAAA,MAAM,OAAO;AACnB,eAAA,MAAM,OAAO,SAAS,CAAC;AAAA,IAClC;AAAA,IACA,CAAC,OAAO,OAAO,QAAQ;AAAA,KAGnB,gBAAgB;AAAA,IACpB,CAAC,cAA8B;AAC7B,YAAM,EAAC,QAAQ,CAAA,MAAM,OAAO;AAC5B,eAAS,CAAC,SAAS,EAAE,OAAO,SAAS,CAAE,CAAA,CAAC;AAAA,IAC1C;AAAA,IACA,CAAC,OAAO,OAAO,QAAQ;AAAA,KAGnB,eAAe;AAAA,IACnB,CAAC,UAA2F;AAC1F,YAAM,EAAC,QAAQ,CAAC,EAAA,IAAK,OAAO,OAEtB,cAAc,MAAM,kBAAkB,MAAM,aAAa,WAAW,KAAK;AAC/E,eAAS,YAAY,aAAa,OAAO,MAAM,KAAK,CAAC;AAAA,IACvD;AAAA,IACA,CAAC,OAAO,OAAO,QAAQ;AAAA,KAGnB,mBAAmB;AAAA,IACvB,CAAC,UAAkB;AACjB,mBAAa,MAAM,CAAC,KAAK,CAAC,CAAC;AAAA,IAC7B;AAAA,IACA,CAAC,YAAY;AAAA,KAGT,mBAAmB;AAAA,IACvB,CAAC,UAAkB;AACjB,kBAAY,OAAO,MAAM,KAAK,OAAO,CAAC,KAAK,CAAC,CAAC;AAAA,IAC/C;AAAA,IACA,CAAC,OAAO,MAAM,MAAM,WAAW;AAAA,KAG3B,eAAe;AAAA,IACnB,OAAiD;AAAA,MAC/C,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,IAAI,OAAO,MAAM;AAAA,MACjB,KAAK;AAAA,MACL,oBAAoB,oBAAoB,OAAO,MAAM,IAAI,OAAO,MAAM,WAAW,WAAW;AAAA,IAAA;AAAA,IAE9F,CAAC,YAAY,aAAa,OAAO,MAAM,IAAI,OAAO,MAAM,WAAW,WAAW;AAAA,KAG1E,oBAAoB;AAAA,IACxB,MAAM,wBAAwB,OAAO,MAAM,WAAW,EAA2B;AAAA,IACjF,CAAC,OAAO,MAAM,WAAW,EAAE;AAAA,KAGvBkC,mBAAyD;AAAA,IAC7D,CAAC,YAAY,SAAU,QAAQ,MAAM,QAAQ,IAAI,oBAAoB;AAAA,IACrE,CAAC,iBAAiB;AAAA,KAGd,eAAe;AAAA,IACnB,CAAC,EAAC,MAAM,YAAY,eAA2B;AAC7C,YAAM,UAAU,SAAS,OAAO,QAAQ,MAAM,UAAU,EAAE;AAAA,QACxD;AAAA,UAAI,CAAC,wBACH,WAAW,KAAK,oBAAoB,WAAW,CAAA,CAAE;AAAA,QACnD;AAAA,QACA,IAAI,CAAC,UAAU,aAAa,MAAM,OAAO,CAAC;AAAA,MAAA;AAGxC,0BAAoB,WACtB,oBAAoB,QAAQ,eAE9B,oBAAoB,UAAU,QAAQ;IACxC;AAAA,IACA,CAAC,QAAQ,YAAY;AAAA,EAAA,GAGjB,aAAa,QAAQ,OAClB;AAAA,IACL,OAAO,OAAO,MAAM;AAAA,IACpB,SAAS,OAAO,MAAM;AAAA,IACtB,OAAO,OAAO,MAAM;AAAA,IACpB,UAAU,OAAO,MAAM;AAAA,IACvB,gBAAgB;AAAA,IAChB,YAAY,OAAO,MAAM;AAAA,IACzB,SAAS,OAAO,MAAM;AAAA,IACtB,IAAI,OAAO,MAAM;AAAA,IACjB;AAAA,IACA,MAAM,OAAO,MAAM;AAAA,IACnB,WAAW,OAAO,MAAM;AAAA,IACxB,SAAS,OAAO,MAAM;AAAA,IACtB,UAAU;AAAA,IACV,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,cAAc;AAAA,IACd,cAAc;AAAA,IACd,eAAe;AAAA,IACf,YAAY,OAAO,MAAM;AAAA,IACzB,UAAU,OAAO,MAAM;AAAA,IACvB,iBAAAA;AAAA,IACA,UAAU;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAc;AAAA,IACd;AAAA,EAAA,IAED;AAAA,IACD,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACAA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD,CAAA,GAEK,gBAAgB,QAAQ,MAAM,YAAY,UAAU,GAAG,CAAC,YAAY,WAAW,CAAC,GAEhF,aAAiE,QAAQ,OACtE;AAAA,IACL,SAAS;AAAA,IACT,MAAM,OAAO;AAAA,IACb,OAAO,OAAO;AAAA,IACd,OAAO,OAAO,MAAM;AAAA,IACpB,OAAO,OAAO,MAAM;AAAA,IACpB,OAAO,OAAO,MAAM,WAAW;AAAA,IAC/B,aAAa,OAAO,MAAM,WAAW;AAAA,IACrC,aAAa,OAAO;AAAA,IACpB,WAAW,OAAO;AAAA,IAClB,UAAU;AAAA,IACV,SAAS,OAAO,MAAM;AAAA,IACtB,YAAY;AAAA,IACZ,YAAY,OAAO,MAAM;AAAA,IACzB,SAAS,OAAO,MAAM;AAAA,IACtB,MAAM,OAAO,MAAM;AAAA,IACnB,UAAU,OAAO,MAAM;AAAA,IACvB,YAAY,OAAO,MAAM;AAAA,IACzB,UAAU;AAAA,IACV;AAAA,EAAA,IAED;AAAA,IACD;AAAA,IACA,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO;AAAA,IACP,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAGC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,UAAU;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MAEC,UAAA,QAAQ,MAAM,YAAY,UAAmB,GAAG,CAAC,YAAY,WAAW,CAAC;AAAA,IAAA;AAAA,EAAA;AAGhF;AC7bO,SAAS,eAAe,QAA4D;AAClF,SAAA,mBAAmB,OAAO,MAAM,UAAU;AACnD;AAEO,SAAS,0BACd,QACkD;AAClD,SACE,kBAAkB,OAAO,MAAM,UAAU,KACzC,OAAO,MAAM,WAAW,GAAG,MAAM,CAAC,WAAW,sBAAsB,MAAM,CAAC;AAE9E;AAEO,SAAS,uBACd,QAC+C;AAC/C,SACE,kBAAkB,OAAO,MAAM,UAAU,KACzC,OAAO,MAAM,WAAW,GAAG,MAAM,CAAC,WAAW,mBAAmB,MAAM,CAAC;AAE3E;ACAa,MAAA,cAAc,SAAqB5G,QAS7C;AACK,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,IAAI,oBAEE;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAAA,QACE,eAAe,wBAAA,GACf,WAAW,UAEX,eAAe,OAAO,OAAO,MAAM,KAAK;AAE9C,YAAU,MAAM;AAED,iBAAA,UAAU,OAAO,MAAM;AAAA,EACnC,GAAA,CAAC,OAAO,MAAM,KAAK,CAAC,GAEvB,aAAa,OAAO,MAAM,SAAS,CAAC,UAAU,aAAa;AArE7D,QAAAW;AAsEQ,KAAC,YAAY,cACfA,MAAA,SAAS,YAAT,QAAkBA,IAAA,MAAA;AAAA,EAAA,CAErB;AAEK,QAAA,aAAa,YAAY,MAAM;AACxB,eAAA,OAAO,MAAM,IAAI;AAAA,EAAA,GAC3B,CAAC,OAAO,MAAM,MAAM,UAAU,CAAC,GAE5B,cAAc,YAAY,MAAM;AACxB,gBAAA,OAAO,MAAM,IAAI;AAAA,EAAA,GAC5B,CAAC,OAAO,MAAM,MAAM,WAAW,CAAC,GAE7B,uBAAuB;AAAA,IAC3B,CAAC,SAAe;AACd,kBAAY,OAAO,MAAM,KAAK,OAAO,IAAI,CAAC;AAAA,IAC5C;AAAA,IACA,CAAC,OAAO,MAAM,MAAM,WAAW;AAAA,KAG3B,eAAe;AAAA,IACnB,CAAC,UAAiC;AAKhC,UAJe,OAAO,MAAM,KAAK,WAAW,GAI/B;AACX,cAAM,UAAU,WAAW,KAAK,KAAK,EAAE;AAQvC,YAHA,aAAa,UAAU,SAAS,aAAa,WAAW,CAAC,GAAG,OAAO,GAG/D,aAAa,WAAW,qBAAqB,aAAa,OAAO,GAAG;AAC7D,mBAAA,WAAW,KAAK,MAAM,CAAC,OAAO,IAAI,CAAC,CAAC,CAAC;AAC9C;AAAA,QACF;AAAA,MACF;AAEA;AAAA,QACE,WAAW,KAAK,KAAK,EAClB,QAAQ,aAAa,iBAAiB,OAAO,MAAM,UAAU,CAAC,CAAC,EAC/D,UAAU,OAAO,IAAI;AAAA,MAAA;AAAA,IAE5B;AAAA,IACA,CAAC,UAAU,QAAQ,YAAY;AAAA,EAAA,GAG3B,iBAAiB,YAAY,MAAM;AACpB,uBAAA,OAAO,MAAM,MAAM,EAAI;AAAA,EAAA,GACzC,CAAC,oBAAoB,OAAO,MAAM,IAAI,CAAC,GAEpC,eAAe,YAAY,MAAM;AAClB,uBAAA,OAAO,MAAM,MAAM,EAAK;AAAA,EAAA,GAC1C,CAAC,oBAAoB,OAAO,MAAM,IAAI,CAAC,GAEpC,sBAAsB;AAAA,IAC1B,CAAC,cAAsB;AACrB,yBAAmB,OAAO,MAAM,KAAK,OAAO,SAAS,GAAG,EAAI;AAAA,IAC9D;AAAA,IACA,CAAC,oBAAoB,OAAO,MAAM,IAAI;AAAA,KAElC,oBAAoB;AAAA,IACxB,CAAC,cAAsB;AACrB,yBAAmB,OAAO,MAAM,KAAK,OAAO,SAAS,GAAG,EAAK;AAAA,IAC/D;AAAA,IACA,CAAC,oBAAoB,OAAO,MAAM,IAAI;AAAA,KAElC,kBAAkB;AAAA,IACtB,CAAC,cAAsB;AACrB,iBAAW,OAAO,MAAM,KAAK,OAAO,SAAS,CAAC;AAAA,IAChD;AAAA,IACA,CAAC,YAAY,OAAO,MAAM,IAAI;AAAA,EAAA,GAE1B,mBAAmB,YAAY,MAAM;AAC9B,eAAA,OAAO,MAAM,IAAI;AAAA,EAAA,GAC3B,CAAC,YAAY,OAAO,MAAM,IAAI,CAAC,GAC5B,uBAAuB;AAAA,IAC3B,CAAC,iBAAyB;AACxB,6BAAuB,OAAO,MAAM,KAAK,OAAO,YAAY,GAAG,EAAK;AAAA,IACtE;AAAA,IACA,CAAC,wBAAwB,OAAO,MAAM,IAAI;AAAA,KAEtC,yBAAyB;AAAA,IAC7B,CAAC,iBAAyB;AACxB,6BAAuB,OAAO,MAAM,KAAK,OAAO,YAAY,GAAG,EAAI;AAAA,IACrE;AAAA,IACA,CAAC,wBAAwB,OAAO,MAAM,IAAI;AAAA,EAAA,GAGtC,aAAa,YAAY,MAAM;AACxB,eAAA,OAAO,MAAM,IAAI;AAAA,EAAA,GAC3B,CAAC,YAAY,OAAO,MAAM,IAAI,CAAC,GAE5B,cAAc,YAAY,MAAM;AACpC,eAAW,OAAO,MAAM,KAAK,MAAM,GAAG,EAAE,CAAC;AAAA,EAAA,GACxC,CAAC,YAAY,OAAO,MAAM,IAAI,CAAC,GAE5B,yBAAyB;AAAA,IAC7B,CAAC,cAAsB;AACF,yBAAA,OAAO,MAAM,MAAM,SAAS;AAAA,IACjD;AAAA,IACA,CAAC,oBAAoB,OAAO,MAAM,IAAI;AAAA,KAGlC,eAAe;AAAA,IACnB,OAAiD;AAAA,MAC/C,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,IAAI,OAAO,MAAM;AAAA,MACjB,KAAK;AAAA,MACL,oBAAoB,oBAAoB,OAAO,MAAM,IAAI,OAAO,MAAM,WAAW,WAAW;AAAA,IAAA;AAAA,IAE9F,CAAC,YAAY,aAAa,OAAO,MAAM,IAAI,OAAO,MAAM,WAAW,WAAW;AAAA,EAAA,GAG1E,aAAa,QAAQ,OAClB;AAAA,IACL;AAAA,IACA,OAAO,OAAO,MAAM;AAAA,IACpB,SAAS,OAAO,MAAM;AAAA,IACtB,OAAO,OAAO,MAAM;AAAA,IACpB,UAAU,OAAO,MAAM;AAAA,IACvB,YAAY,OAAO,MAAM;AAAA,IACzB,UAAU,OAAO,MAAM;AAAA,IACvB,YAAY,OAAO,MAAM;AAAA,IACzB,SAAS,OAAO,MAAM;AAAA,IACtB,IAAI,OAAO,MAAM;AAAA,IACjB,oBAAoB;AAAA,IACpB,aAAa;AAAA,IACb,cAAc;AAAA,IACd,iBAAiB;AAAA,IACjB,eAAe;AAAA,IACf,kBAAkB;AAAA,IAClB,oBAAoB;AAAA,IACpB,aAAa;AAAA,IACb,MAAM,OAAO,MAAM;AAAA,IACnB,WAAW,OAAO,MAAM;AAAA,IACxB,SAAS,OAAO,MAAM;AAAA,IACtB,QAAQ,OAAO,MAAM;AAAA,IACrB,UAAU;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IAED;AAAA,IACD;AAAA,IACA,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD,CAAA,GAEK,gBAAgB,QAAQ,MAAM,YAAY,UAAU,GAAG,CAAC,YAAY,WAAW,CAAC,GAEhF,aAAa,QAAQ,OAClB;AAAA,IACL,SAAS;AAAA,IACT,MAAM,OAAO;AAAA,IACb,OAAO,OAAO;AAAA,IACd,OAAO,OAAO,MAAM;AAAA,IACpB,OAAO,OAAO,MAAM;AAAA,IACpB,YAAY,OAAO,MAAM;AAAA,IACzB,UAAU,OAAO,MAAM;AAAA,IACvB,OAAO,OAAO,MAAM,WAAW;AAAA,IAC/B,aAAa,OAAO,MAAM,WAAW;AAAA,IAErC,aAAa,OAAO;AAAA,IACpB,WAAW,OAAO;AAAA,IAClB,YAAY;AAAA,IACZ,UAAU;AAAA,IAEV,MAAM,OAAO;AAAA,IACb,SAAS,OAAO,MAAM;AAAA,IAEtB,QAAQ;AAAA,IACR,SAAS;AAAA,IAET,YAAY,OAAO,MAAM;AAAA,IACzB,SAAS,OAAO,MAAM;AAAA,IACtB,MAAM,OAAO,MAAM;AAAA,IACnB,UAAU;AAAA,IACV;AAAA,EAAA,IAED;AAAA,IACD;AAAA,IACA,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAGC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,UAAU;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MAEC,UAAA,QAAQ,MAAM,YAAY,UAAU,GAAG,CAAC,YAAY,WAAW,CAAC;AAAA,IAAA;AAAA,EAAA;AAGvE;AC3SO,SAASmG,iBAAe9G,QAI5B;AACK,QAAA,EAAC,QAAQ,aAAa,gBAAeA,QAErC,eAAe,2BAEf,WAAW,OAAA,GAEX,CAAC,YAAY,aAAa,IAAI,YAE9B,EAAC,YAAY,aAAa,aAAY;AAE5C,YAAU,MAAM;AArClB,QAAAW;AAsCQ,WAAO,MAAM,aACfA,MAAA,SAAS,YAAT,QAAkBA,IAAA,MAAA;AAAA,EAEnB,GAAA,CAAC,OAAO,MAAM,OAAO,CAAC;AAEnB,QAAA,aAAa,YAAY,MAAM;AACxB,eAAA,OAAO,MAAM,IAAI;AAAA,EAAA,GAC3B,CAAC,OAAO,MAAM,MAAM,UAAU,CAAC,GAE5B,cAAc,YAAY,MAAM;AACxB,gBAAA,OAAO,MAAM,IAAI;AAAA,EAAA,GAC5B,CAAC,OAAO,MAAM,MAAM,WAAW,CAAC,GAE7B,eAAe;AAAA,IACnB,CAAC,UAAgD;AAC/C,eAAS,WAAW,KAAK,KAAK,EAAE,UAAU,OAAO,IAAI,CAAC;AAAA,IACxD;AAAA,IACA,CAAC,UAAU,OAAO,IAAI;AAAA,KAGlB,qBAAqB;AAAA,IACzB,CAAC,UAAyC;AACpC,UAAA,aAAwC,MAAM,cAAc;AAC5D,UAAA,mBAAmB,OAAO,MAAM,UAAU;AAC5C,YAAA,aAAa,MAAM,cAAc,eAC7B,aAAa,OAAO,oBAAoB,aAAa,OAAO;AAC9D;AAAA;AAEO,4BAAoB,OAAO,MAAM,UAAU,MACpD,aAAa,MAAM,cAAc;AAInC,YAAM,gBACJ,eAAe,MAAO,OAAO,cAAe,YAAY,MAAM,UAAU;AAEtE,yBAAmB,OAAO,MAAM,UAAU,KAK5C,cAAc,gBAAgB,SAAY,MAAM,cAAc,KAAK,GAGrE,SAAS,WAAW,KAAK,gBAAgB,MAAU,IAAA,IAAI,UAAU,CAAC,EAAE,UAAU,OAAO,IAAI,CAAC;AAAA,IAC5F;AAAA,IACA,CAAC,OAAO,MAAM,OAAO,MAAM,YAAY,QAAQ;AAAA,KAG3C,kBACJ;AAAA,IACE,MACE,OAAO,MAAM,WACV,OAAO,CAAC,SAAS,KAAK,UAAU,OAAO,EACvC,IAAI,CAAC,SAAS,KAAK,OAAO,EAC1B,KAAK;AAAA,CAAI;AAAA,IACd,CAAC,OAAO,MAAM,UAAU;AAAA,EAAA,KACrB,QAED,eAAe;AAAA,IACnB,OAA4C;AAAA,MAC1C,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,IAAI,OAAO,MAAM;AAAA,MACjB,KAAK;AAAA,MACL,UAAU;AAAA,MACV,OAAO,8BAA8B,OAAO,MAAM,YAAY,OAAO,MAAM,OAAO,UAAU;AAAA,MAC5F,UAAU,CAAQ,CAAA,OAAO,MAAM;AAAA,MAC/B,aAAa,OAAO,MAAM,WAAW;AAAA,MACrC,oBAAoB,oBAAoB,OAAO,MAAM,IAAI,OAAO,MAAM,WAAW,WAAW;AAAA,IAAA;AAAA,IAE9F;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA,OAAO,MAAM;AAAA,MACb,OAAO,MAAM;AAAA,MACb,OAAO,MAAM;AAAA,MACb,OAAO,MAAM;AAAA,MACb;AAAA,IACF;AAAA,EAAA,GAGI,aAAa,QAAQ,OAClB;AAAA,IACL,OAAO,OAAO,MAAM;AAAA,IACpB,UAAU,OAAO,MAAM;AAAA,IACvB,YAAY,OAAO,MAAM;AAAA,IACzB,SAAS,OAAO,MAAM;AAAA,IACtB,IAAI,OAAO,MAAM;AAAA,IACjB,MAAM,OAAO,MAAM;AAAA,IACnB,SAAS,OAAO,MAAM;AAAA,IACtB,OAAO,OAAO,MAAM;AAAA,IACpB,UAAU;AAAA,IACV,YAAY,OAAO,MAAM;AAAA,IACzB,UAAU,OAAO,MAAM;AAAA,IACvB;AAAA,IACA;AAAA,EAAA,IAED;AAAA,IACD,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb;AAAA,IACA;AAAA,IACA;AAAA,EACD,CAAA,GAEK,gBAAgB,QAAQ,MAAM,YAAY,UAAU,GAAG,CAAC,YAAY,WAAW,CAAC,GAEhF,aAAa,QAAQ,OAClB;AAAA,IACL,SAAS;AAAA,IACT,SAAS,OAAO,MAAM;AAAA,IACtB,UAAU;AAAA,IACV,aAAa,OAAO,MAAM,WAAW;AAAA,IACrC,OAAO,OAAO;AAAA,IACd,SAAS,OAAO,MAAM;AAAA,IACtB;AAAA,IACA,OAAO,OAAO,MAAM;AAAA,IACpB,MAAM,OAAO;AAAA,IACb,MAAM,OAAO,MAAM;AAAA,IACnB,UAAU,OAAO,MAAM;AAAA,IACvB,YAAY,OAAO,MAAM;AAAA,IACzB,OAAO,OAAO,MAAM,WAAW;AAAA,IAC/B,YAAY,OAAO,MAAM;AAAA,IACzB,OAAO,OAAO,MAAM;AAAA,EAAA,IAErB;AAAA,IACD;AAAA,IACA,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO,MAAM;AAAA,IACb,OAAO;AAAA,IACP,OAAO;AAAA,IACP;AAAA,IACA;AAAA,EAAA,CACD;AAEM,SAAA,oBAAA,UAAA,EAAG,UAAY,YAAA,UAAU,EAAE,CAAA;AACpC;AC/Ja,MAAA,cAAc,KAAK,SAAqBX,QAAyB;AACtE,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAAA;AAEA,SAAA,eAAe,MAAM,IAGrB;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA,IAKF,0BAA0B,MAAM,IAEhC;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MAEA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA,IAKF,uBAAuB,MAAM,IAE7B;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA,IAKC,oBAAC8G,kBAAe,EAAA,QAAgB,aAA0B,YAA0B,CAAA;AAC7F,CAAC,GChFKC,iBAAe;AAAA,EACnB,SAAS;AAAA,EACT,OAAO;AACT,GAEM,YAAY,OAAO,GAAG;AAAA;AAAA;AAIrB,SAAS,MAAM/G,QAAmB;AACjC,QAAA,EAAC,UAAU,SAAS,WAAW,QAAQ,OAAO,GAAG,KAAQ,IAAAA;AAG7D,SAAA,qBAAC,MAAK,EAAA,QAAQ,GAAG,MAAM+G,eAAa,MAAM,GAAI,GAAG,MAAM,WAAQ,SAC7D,UAAA;AAAA,IAAC,qBAAA,MAAA,EAAK,SAAS,GACb,UAAA;AAAA,MAAA,oBAAC,KACC,EAAA,UAAA,qBAACpF,QAAK,EAAA,MAAM,GACT,UAAA;AAAA,QAAW,WAAA,iCAAc,oBAAmB,CAAA,CAAA;AAAA,QAC5C,WAAW,WAAW,oBAAC,kBAAiB,CAAA,CAAA;AAAA,MAAA,EAAA,CAC3C,EACF,CAAA;AAAA,MAEC,qBAAA,KAAA,EAAI,MAAM,GAAG,YAAY,GACxB,UAAA;AAAA,QAAA,oBAACA,QAAK,EAAA,MAAM,GAAG,QAAO,UACnB,UACH,OAAA;AAAA,QAEC,YAAY,oBAAC,KAAI,EAAA,WAAW,GAAI,UAAS;AAAA,MAAA,GAC5C;AAAA,IAAA,GACF;AAAA,IAEC,UAAW,oBAAA,WAAA,EAAW,UAAO,OAAA,CAAA;AAAA,EAChC,EAAA,CAAA;AAEJ;AC1BA,MAAM,eAAe,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GActB,cAAc,OAAO,oBAAoB;AAAA,eAChC,CAAC3B,WAAWA,OAAM,OAAO,kBAAkB,EAAG;AAAA,GAGvD,SAAS,OAAO,IAAI;AAAA;AAAA,GAIpB,UAAU,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWnB,SAAS,QAAQA,QAAqB;AAC3C,QAAM,EAAC,UAAU,MAAM,UAAU,MAAM,QAAQ,WAAW,GAAG,UAAS,IAAIA,QACpE,CAAC,MAAM,OAAO,IAAI,SAAS,YAAY,EAAK,GAE5C,eAAe,YAAY,MAAM,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,CAAE,CAAA;AAE7D,SAAA,UAAU,MAAM,QAAQ,YAAY,EAAK,GAAG,CAAC,QAAQ,CAAC,GAGpD,qBAAC,KAAK,EAAA,GAAG,WACP,UAAA;AAAA,IAAC,oBAAA,cAAA,EAAa,MAAK,UAAS,SAAS,cACnC,8BAAC,QAAO,EAAA,OAAM,UACZ,UAAA,qBAAC,QACC,EAAA,UAAA;AAAA,MAAA,oBAAC,SAAQ,EAAA,aAAW,OAAO,KAAK,QAC9B,UAAA,oBAAC2B,QAAK,EAAA,MAAM,GACV,UAAA,oBAAC,aAAY,EAAA,KAAA,CAAY,EAC3B,CAAA,GACF;AAAA,MACC,QAAQ,oBAAC,KAAI,EAAA,YAAY,GAAI,UAAK,MAAA;AAAA,MAClC,oBAAA,KAAA,EAAI,MAAM,GAAG,YAAY,GACxB,UAAC,oBAAAA,QAAA,EAAK,MAAM,GAAG,QAAO,UACnB,gBACH,CAAA,GACF;AAAA,IAAA,EACF,CAAA,EACF,CAAA,GACF;AAAA,wBAEC,KAAI,EAAA,QAAQ,CAAC,MAAM,WAAW,GAC5B,UACH;AAAA,EACF,EAAA,CAAA;AAEJ;ACnFA,MAAM,iBAAiB,CAAC,OAAO,QAAQ,GAAG,GACpC,iBAAiB,CAAC,SAAS,MAAM,SAAS,KAAK,MAAM,GACrD,eAAe,eAAe,OAAO,cAAc,GAEnD,OAAO,MAAY,IAEnB,MAAM,CAAC,SAAiB,CAAC,QAA8B,OAAO,IAAI,IAAI,GACtE,KAAK,CAAC,aAAqB,CAAC,SAA+B,OAAO,IAAI,WAAW;AAEvF,SAAS,YAAY,OAAa;AAChC,QAAM,UAAU,IAAI,KAAK,MAAM,QAAQ,IAAI,MAAM,kBAAkB,IAAI,KAAK,GAAI,GAC1E,SAAS,MAAM,sBAAsB,IACrC,QAAQ,MAAM;AACZ,SAAA,QAAA,SAAS,QAAQ,MAAM,GACxB;AACT;AAEA,SAAS,YAAY;AACf,MAAA;AACF,WAAO,KAAK,eAAA,EAAiB,gBAAA,EAAkB;AAAA,EAAA,QACrC;AAAA,EAAC;AACN,SAAA;AACT;AAUO,MAAM,aAAuE;AAAA,EAClF,QAAQ;AAAA,IACN,QAAQ;AAAA,MACN,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IACA,SAAS;AAAA,MACP,MAAM,CAAC,UAAe,aAAa,SAAS,MAAM,aAAa;AAAA,MAC/D,SAAS,CAAC,UACR,eAAe,SAAS,MAAM,aAAa,KAC3C,CAAC,eAAe,SAAS,MAAM,aAAa;AAAA,IAChD;AAAA,IACA,UAAU;AAAA,MACR,MAAM,CAAC,UAAe,YAAY,KAAK;AAAA,MACvC,SAAS,CAAC,WACD;AAAA,QACL,OAAO;AAAA,QACP,OAAO,YAAY,IAAI,KAAK,KAAK,CAAC,EAAE,OAAO;AAAA,QAC3C,KAAK,IAAI,KAAK,KAAK,EAAE,OAAO;AAAA,QAC5B,UAAU,UAAU;AAAA,QACpB,SAAQ,oBAAI,KAAK,GAAE,kBAAkB;AAAA,MAAA;AAAA,IAG3C;AAAA,EACF;AAAA,EACA,MAAM;AAAA,IACJ,UAAU;AAAA,MACR,MAAM,GAAG,MAAM;AAAA,MACf,SAAS,CAAC,UAAe,OAAO,OAAO,CAAC,GAAG,OAAO,EAAC,OAAO,YAAW;AAAA,IACvE;AAAA,EACF;AAAA,EACA,UAAU;AAAA,IACR,UAAU;AAAA,MACR,MAAM,IAAI,KAAK;AAAA,MACf,SAAS,CAAC,UAAe,MAAM;AAAA,IACjC;AAAA,EACF;AAAA,EACA,QAAQ;AAAA,IACN,QAAQ;AAAA,MACN,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IACA,SAAS;AAAA,MACP,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,EACF;AAAA,EACA,SAAS;AAAA,IACP,QAAQ;AAAA,MACN,MAAM;AAAA,MACN,SAAS,CAAC,UAAgB,QAAQ,QAAQ;AAAA,IAC5C;AAAA,IACA,QAAQ;AAAA,MACN,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,EACF;AACF;AC1EA,SAAS,qBAAqB;AAAA,EAC5B;AAAA,EACA;AAAA,EACA;AACF,GAIG;AACD,QAAM,YAAY,QAAQ,OAAO,EAAC,GAAG,OAAO,OAAO,WAAU,IAAI,CAAC,YAAY,KAAK,CAAC,GAE9E,cAAc;AAAA,IAClB,MAAM,SAAS,WAAW,KAAK,aAAa,YAAY,CAAC,OAAO,CAAC,CAAC,GAAG,SAAS;AAAA,IAC9E,CAAC,WAAW,UAAU,UAAU;AAAA,EAAA,GAG5B,EAAC,GAAAd,OAAK;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,MAAMA,GAAE,4CAA4C;AAAA,QAClD;AAAA,MAAA,CACD;AAAA,IAAA;AAAA,EAAA;AAGP;AAEA,SAAS,gBAAgB;AAAA,EACvB;AAAA,EACA;AAAA,EACA;AACF,GAIG;AAED,QAAM,YAAY,QAAQ,OAAO,EAAC,GAAG,OAAO,OAAO,WAAW,CAAC,MAAK,CAAC,YAAY,KAAK,CAAC,GAEjF,cAAc;AAAA,IAClB,MAAM,SAAS,WAAW,KAAK,MAAO,CAAA,GAAG,SAAS;AAAA,IAClD,CAAC,WAAW,QAAQ;AAAA,EAAA,GAGhB,EAAC,GAAAA,OAAK;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,MAAK;AAAA,MACL,MAAMA,GAAE,6CAA6C;AAAA,IAAA;AAAA,EAAA;AAG3D;AAMO,SAAS,kBAAkB,EAAC,YAAY,OAAO,YAAmC;AACvF,QAAM,SAAS,aACT,oBAAoB,WAAW,WAAW,GAC1C,gBAAgB,OAAO,IAAI,WAAW,CAAC,CAAC,GAExC,EAAC,GAAAA,GAAA,IAAK;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAO;AAAA,MACP,OAEI,oBAAA,UAAA,EAAA,UAAA,oBAAC,aAAU,GAAAA,IAAM,SAAQ,8BAA6B,EACxD,CAAA;AAAA,MAGF,UAAA,oBAAC,SAAQ,EAAA,MAAM,OAAO,OAAOA,GAAE,oCAAoC,GACjE,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,oBAACc,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAA,oBAAC,WAAU,EAAA,GAAAd,IAAM,SAAQ,mCAAmC,CAAA,GAC9D;AAAA,QAEC,qBAAqB,CAAC,iBACpB,oBAAAc,QAAA,EAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAC,oBAAA,WAAA,EAAU,GAAAd,IAAM,SAAQ,2CAA2C,CAAA,GACtE;AAAA,QAGD,CAAC,qBACC,oBAAAc,QAAA,EAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAEd,GAAA,qDAAqD,EAC1D,CAAA;AAAA,QAGD,CAAC,qBACA,oBAAC,OAAM,EAAA,IAAG,MAAK,OAAO,GACnB,UAAA,WAAW,IAAI,CAAC,cACf,oBAACc,UAAK,IAAG,MAAqB,OAAK,IAAC,MAAM,GACxC,UAAC,oBAAA,QAAA,EAAM,UAAU,UAAA,CAAA,EAAA,GADA,SAEnB,CACD,GACH;AAAA,QAGF,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAC,oBAAAA,QAAA,EAAK,IAAG,MAAK,QAAO,UAAS,MAAM,GACjC,UAAEd,GAAA,+CAA+C,EACpD,CAAA;AAAA,UAEA,oBAAC,QAAK,QAAM,IAAC,UAAS,QAAO,SAAS,GAAG,QAAQ,GAAG,MAAK,WACvD,UAAC,oBAAA,MAAA,EAAK,UAAS,QAAQ,UAAA,KAAK,UAAU,OAAO,MAAM,CAAC,EAAA,CAAE,EACxD,CAAA;AAAA,QAAA,GACF;AAAA,QAEA,qBAAC,QAAK,SAAS,CAAC,GAAG,GAAG,CAAC,GAAG,KAAK,GAC5B,UAAA;AAAA,UAAA,yCACE,sBAAqB,EAAA,UAAoB,YAAY,WAAW,CAAC,GAAG,OAAc;AAAA,UAGpF,oBAAA,iBAAA,EAAgB,UAAoB,YAAwB,MAAc,CAAA;AAAA,QAAA,GAC7E;AAAA,MAAA,EAAA,CACF,EACF,CAAA;AAAA,IAAA;AAAA,EAAA;AAGN;AC5HA,SAAS,cAAc,OAAgB,YAAoB,YAAmC;AAC5F,SAAM,cAAcmG,aAIb,OAAO,KAAKA,WAAW,UAAU,CAAC,EACtC,OAAO,CAAC,eAAe,WAAW,SAAS,UAAU,CAAC,EACtD,IAAI,CAAC,gBAAgB;AAAA,IACpB,MAAM;AAAA,IACN,IAAI;AAAA,IACJ,GAAGA,WAAW,UAAU,EAAE,UAAU;AAAA,EAAA,EACpC,EACD,OAAO,CAAC,cAAc,UAAU,KAAK,KAAK,CAAC,IAVrC;AAWX;AASO,MAAM,oBAAoB;AAAA,EAC/B,CAAChH,QAA0B,QAAkC;AAC3D,UAAM,EAAC,OAAO,YAAY,YAAY,aAAYA;AAElD,wBAAoB,KAAK,OAAO;AAAA;AAAA,MAE9B,OAAO,MAAG;AAAA,MAAA;AAAA,IACV,EAAA;AAEI,UAAA,mBAAmB,YAAY,MAAM;AACzC,eAAS,WAAW,KAAK,MAAM,CAAC,CAAC;AAAA,IAChC,GAAA,CAAC,QAAQ,CAAC,GAEP,kBAAkB;AAAA,MACtB,CAAC,cAAmB;AAClB,iBAAS,WAAW,KAAK,IAAI,SAAS,CAAC,CAAC;AAAA,MAC1C;AAAA,MACA,CAAC,QAAQ;AAAA,OAGLiH,cAAa;AAAA,MACjB,MAAM,cAAc,OAAO,YAAY,UAAU;AAAA,MACjD,CAAC,OAAO,YAAY,UAAU;AAAA,IAAA,GAG1B,EAAC,GAAApG,OAAK;AAEZ,QAAI,cAAc,KAAK,KAAK,EAAE,WAAY;AAEtC,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA;AAAA,UACA;AAAA,QAAA;AAAA,MAAA;AAKN,UAAM,SACJ,oBAAC,OAAM,EAAA,SAAS,GACd,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,MAAK;AAAA,QACL,MAAMA,GAAE,wCAAwC;AAAA,MAAA;AAAA,IAEpD,EAAA,CAAA;AAIA,WAAA,qBAAC,SAAM,QAAO,SAAQ,QAAgB,OAAOA,GAAE,4BAA4B,GACzE,UAAA;AAAA,MAAC,oBAAAc,QAAA,EAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAEd,GAAA,kCAAkC,EACvC,CAAA;AAAA,MAEC,oBAAA,SAAA,EAAQ,WAAW,GAAG,MAAM,OAAO,OAAOA,GAAE,oCAAoC,GAC/E,UAAC,qBAAA,OAAA,EAAM,OAAO,GACX,UAAA;AAAA,QAAW,WAAA,WAAW,KACpB,oBAAAc,QAAA,EAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAd;AAAA,YACA,SAAQ;AAAA,YACR,QAAQ;AAAA,cACN,WAAW,WAAW,CAAC;AAAA,YACzB;AAAA,UAAA;AAAA,QAAA,GAEJ;AAAA,QAGD,WAAW,WAAW,KACrB,oBAACc,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAAd,GAAE,8CAA8C,GACnD;AAAA,QAGD,WAAW,WAAW,KACrB,oBAACc,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAAd,GAAE,qDAAqD,GAC1D;AAAA,QAGD,WAAW,WAAW,KACrB,oBAAC,SAAM,IAAG,MAAK,OAAO,GACnB,UAAW,WAAA,IAAI,CAAC,cACf,oBAACc,QAAK,EAAA,IAAG,MACP,UAAA,oBAAC,UAAM,UAAU,UAAA,CAAA,EAAA,GADA,SAEnB,CACD,EACH,CAAA;AAAA,QAGD,qBAAA,OAAA,EAAM,WAAW,GAAG,OAAO,GAC1B,UAAA;AAAA,UAAA,oBAACA,QAAK,EAAA,MAAM,GAAG,QAAO,UACpB,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,GAAAd;AAAA,cACA,SAAQ;AAAA,cACR,QAAQ;AAAA,gBACN;AAAA,cACF;AAAA,YAAA;AAAA,UAAA,GAEJ;AAAA,UAEA,oBAAC,QAAK,QAAM,IAAC,SAAS,GAAG,QAAQ,GAAG,MAAK,WACvC,UAAA,oBAAC,QAAK,UAAS,QAAO,MAAM,GACzB,UAAA,KAAK,UAAU,OAAO,MAAM,CAAC,EAAA,CAChC,EACF,CAAA;AAAA,QAAA,GACF;AAAA,QAECoG,YAAW,SAAS,KAClB,oBAAA,OAAA,EAAM,OAAO,GACX,UAAAA,YAAW,IAAI,CAAC,cACf;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YAEA,WAAW;AAAA,YACX;AAAA,UAAA;AAAA,UAFK,GAAG,UAAU,IAAI,IAAI,UAAU,EAAE;AAAA,QAIzC,CAAA,GACH;AAAA,MAAA,EAAA,CAEJ,EACF,CAAA;AAAA,IACF,EAAA,CAAA;AAAA,EAEJ;AACF;AAEA,kBAAkB,cAAc;AAEhC,SAAS,cAAc;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AACF,GAIG;AACD,QAAM,cAAc;AAAA,IAClB,MAAM,UAAU,UAAU,QAAQ,KAAK,CAAC;AAAA,IACxC,CAAC,WAAW,WAAW,KAAK;AAAA,EAAA,GAGxB,EAAC,GAAApG,OAAK;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,MAAMA,GAAE,4CAA4C,EAAC,YAAY,UAAU,IAAG;AAAA,IAAA;AAAA,EAAA;AAGpF;AC7KO,SAAS,mBAAmBb,QAAc;AAC/C,QAAM,EAAC,OAAO,SAAA,IAAYA,QAEpB,yBAAyB,YAAY,MAAM;AAC/C;AAAA,MACE,WAAW;AAAA,SACR,MAAM,cAAc,CAAA,GAAI;AAAA,UAAI,CAAC,CAAC,OAAO,GAAG,MACvC,IAAI,GAAG,GAAG,YAAY,KAAK,IAAI,CAAC,OAAO,MAAM,CAAC;AAAA,QAChD;AAAA,MACF;AAAA,IAAA;AAAA,EACF,GACC,CAAC,MAAM,YAAY,QAAQ,CAAC,GAEzB,EAAC,GAAAa,GAAC,IAAI;AAGV,SAAA,oBAAC,aAAU,OAAO,MAAM,WAAW,OAAO,aAAa,MAAM,WAAW,aACtE,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAO;AAAA,MACP,QACE,oBAAC,OAAM,EAAA,SAAS,GACd,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,SAAS;AAAA,UACT,MAAMA,GAAE,sDAAsD;AAAA,UAC9D,MAAK;AAAA,QAAA;AAAA,MAAA,GAET;AAAA,MAEF,OAAOA,GAAE,uCAAuC;AAAA,MAEhD,UAAA;AAAA,QAAC,oBAAAc,QAAA,EAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAEd,GAAA,yCAAyC,EAC9C,CAAA;AAAA,QAEA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,WAAW;AAAA,YACX,MAAM;AAAA,YACN,OAAOA,GAAE,+CAA+C;AAAA,YAExD,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,cAAA,oBAACc,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAA,oBAAC,WAAU,EAAA,GAAAd,IAAM,SAAQ,sDAAsD,CAAA,GACjF;AAAA,kCAECc,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,GAAAd;AAAA,kBACA,SAAQ;AAAA,gBAAA;AAAA,cAAA,GAEZ;AAAA,YAAA,GACF;AAAA,UAAA;AAAA,QAEF;AAAA,MAAA;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACvDO,SAAS,iBAAiBb,QAAc;AAC7C,QAAM,EAAC,OAAO,SAAA,IAAYA,QACpB,uBAAuB,YAAY,MAAM;AAC7C;AAAA,MACE,WAAW,MAAM,MAAM,SAAS,CAAA,GAAI,IAAI,CAAC,KAAK,MAAM,aAAaiG,YAAa,GAAA,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;AAAA,IAAA;AAAA,EAC7F,GACC,CAAC,MAAM,OAAO,QAAQ,CAAC,GAEpB,EAAC,GAAApF,GAAC,IAAI;AAGV,SAAA,oBAAC,aAAU,OAAO,MAAM,WAAW,OAAO,aAAa,MAAM,WAAW,aACtE,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAO;AAAA,MACP,QACE,oBAAC,OAAM,EAAA,SAAS,GACd,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,SAAS;AAAA,UACT,MAAMA,GAAE,+CAA+C;AAAA,UACvD,MAAK;AAAA,QAAA;AAAA,MAAA,GAET;AAAA,MAEF,OAAOA,GAAE,qCAAqC;AAAA,MAE9C,UAAA;AAAA,QAAC,oBAAAc,QAAA,EAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAEd,GAAA,uCAAuC,EAC5C,CAAA;AAAA,QAEA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,WAAW;AAAA,YACX,MAAM;AAAA,YACN,OAAOA,GAAE,6CAA6C;AAAA,YAEtD,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,cAAA,oBAACc,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAA,oBAAC,WAAU,EAAA,GAAAd,IAAM,SAAQ,oDAAoD,CAAA,GAC/E;AAAA,kCAECc,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,GAAAd;AAAA,kBACA,SAAQ;AAAA,gBAAA;AAAA,cAAA,GAEZ;AAAA,YAAA,GACF;AAAA,UAAA;AAAA,QACF;AAAA,MAAA;AAAA,IAAA;AAAA,EAGJ,EAAA,CAAA;AAEJ;ACrDO,SAAS,gBAAgBb,QAAc;AAC5C,QAAM,EAAC,OAAO,SAAY,IAAAA,QAEpB,8BAA8B,MAAM;AAKlC,UAAA,WAJoB,MAAM,SAAS,CAAC,GACvC,QAAQ,CAAC,MAAM,UAAW,cAAc,IAAI,IAAI,KAAK,CAAC,KAAK,CAAE,EAC7D,QAAA,EAE8B,IAAI,CAAC,UAAU,MAAM,CAAC,KAAK,CAAC,CAAC;AAErD,aAAA,WAAW,KAAK,OAAO,CAAC;AAAA,EAAA,GAG7B,EAAC,GAAAa,OAAK;AAGV,SAAA,oBAAC,aAAU,OAAO,MAAM,WAAW,OAAO,aAAa,MAAM,WAAW,aACtE,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAO;AAAA,MACP,QACE,oBAAC,OAAM,EAAA,SAAS,GACd,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,SAAS;AAAA,UACT,MAAMA,GAAE,iDAAiD;AAAA,UACzD,MAAK;AAAA,QAAA;AAAA,MAAA,GAET;AAAA,MAEF,OAAOA,GAAE,oCAAoC;AAAA,MAE7C,UAAA;AAAA,QAAC,oBAAAc,QAAA,EAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAEd,GAAA,sCAAsC,EAC3C,CAAA;AAAA,QAEA,oBAAC,SAAQ,EAAA,WAAW,GAAG,MAAM,OAAO,OAAOA,GAAE,4CAA4C,GACvF,UAAA,oBAAC,OAAM,EAAA,OAAO,GACZ,UAAC,oBAAAc,QAAA,EAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAEd,GAAA,kDAAkD,EACvD,CAAA,EACF,CAAA,GAEF;AAAA,MAAA;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;AChDO,SAAS,iBAAiBb,QAA6B;AACtD,QAAA,EAAC,OAAU,IAAAA,QACX,EAAC,SAAQ,IAAI,iBAAiB,GAE9B,eAAe;AAAA,IACnB,CAAC,UAAsB;AACrB,eAAS,WAAW,KAAK,KAAK,EAAE,UAAU,OAAO,SAAS,CAAC;AAAA,IAC7D;AAAA,IACA,CAAC,UAAU,OAAO,SAAS;AAAA,EAAA,GAGvB,EAAC,GAAAa,OAAK;AAER,SAAA,OAAO,MAAM,SAAS,sBAEtB;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAO,OAAO,MAAM;AAAA,MACpB,UAAU;AAAA,MACV,YAAY,OAAO,MAAM;AAAA,MACzB,YAAY,CAAC,OAAO,MAAM,mBAAmB,IAAI;AAAA,IAAA;AAAA,EACnD,IAGA,OAAO,MAAM,SAAS,iBAChB,oBAAA,kBAAA,EAAiB,OAAO,OAAO,OAAO,UAAU,cAAc,IAEpE,OAAO,MAAM,SAAS,uCAChB,oBAAmB,EAAA,OAAO,OAAO,OAAO,UAAU,aAAc,CAAA,IAEtE,OAAO,MAAM,SAAS,gBACjB,oBAAC,mBAAgB,UAAU,cAAc,OAAO,OAAO,MAAO,CAAA,wBAE/D,KAAK,EAAA,UAAAA,GAAE,uCAAuC,EAAC,OAAOb,OAAM,OAAO,MAAM,KAAK,CAAA,EAAE,CAAA;AAC1F;AC5Ba,MAAA,iBAAiB,KAAK,SAAwBA,QASxD;AA3BH,MAAAW;AA4BQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEX,QAEE,EAAC,2BAA0B,iBAAiB,GAE5C,iBAAiB,YAAY,MAAM;AAChB,2BAAA,OAAO,SAAS,MAAM,EAAI;AAAA,EAAA,GAChD,CAAC,OAAO,SAAS,MAAM,sBAAsB,CAAC,GAE3C,eAAe,YAAY,MAAM;AACd,2BAAA,OAAO,SAAS,MAAM,EAAK;AAAA,KACjD,CAAC,OAAO,SAAS,MAAM,sBAAsB,CAAC;AAG/C,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAO,OAAO,SAAS,SAAS,WAAW,OAAO,SAAS,IAAI;AAAA,MAC/D,aAAa,OAAO,SAAS;AAAA,MAC7B,OAAO,OAAO,SAAS;AAAA,MACvB,aAAa,OAAO,SAAS;AAAA,MAC7B,WAAW,OAAO,SAAS;AAAA,MAC3B,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,UAASW,MAAQ,UAAA,OAAA,SAAA,OAAA,aAAR,OAAkB,SAAAA,IAAA;AAAA,MAC3B,eAAa,YAAY,OAAO,SAAS,IAAI;AAAA,MAC7C,SAAS,OAAO,SAAS;AAAA,MAExB,UAAO,OAAA,SAAS,QAAQ,IAAI,CAAC,mBACxB,eAAe,SAAS,8BAClB,kBAAkC,EAAA,QAAQ,eAApB,GAAA,OAAO,GAA6B,IAGlE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAQ;AAAA,UACR;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QAAA;AAAA,QACK,eAAe;AAAA,MAAA,CAGzB;AAAA,IAAA;AAAA,EAAA;AAGP,CAAC,GCtDY,oBAAoB,KAAK,SAA2BX,QAA+B;AACxF,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAAA;AAEA,SAAA,OAAO,SAAS,UAEhB;AAAA,IAAC;AAAA,IAAA;AAAA,MAEC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,IARK,OAAO;AAAA,EAYd,IAAA,OAAO,SAAS,UACV,oBAAA,kBAAA,EAAkC,UAAZ,OAAO,GAAqB,IAExD,OAAO,SAAS,aAEhB;AAAA,IAAC;AAAA,IAAA;AAAA,MAEC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,IARK,OAAO;AAAA,EASd,KAIJ,QAAQ,KAAK,IAAI,MAAM,yBAAyB,OAAO,IAAI,EAAE,CAAC,GACvD;AACT,CAAC;AC/CM,SAAS,mBAAmBA,QAA2B;AACtD,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QAEE,gBAAgB;AAAA,IACpB,MACE,QAAQ,IAAI,CAAC,WACX;AAAA,MAAC;AAAA,MAAA;AAAA,QAEC;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,MARK,OAAO;AAAA,IAAA,CAUf;AAAA,IACH;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAGF,yCAAU,UAAc,cAAA,CAAA;AAC1B;AAMO,MAAM,gBAAgB;AC3DtB,SAASkH,qBACd,YACgC;AACzB,SAAA,mBAAmB,WAAW,UAAU;AACjD;AAEO,SAAS,kBACd,YACwC;AACjC,SAAA,kBAAkB,WAAW,UAAU;AAChD;ACNA,MAAM,OAAO,CAAC,EAAC,SAAqC,MAAA;AAQpD,SAAS,gBACP,GAC+B;AAC/B,SAAO,kBAAkB;AAC3B;AAGa,MAAA,YAAY,KAAK,SAC5BlH,QAOA;AACM,QAAA,eAAe,QAAQ,MACpB,gBAAgBA,MAAK,IAAIA,OAAM,eAAeA,OAAM,KAAK,OAAOA,OAAM,YAAY,GACxF,CAACA,MAAK,CAAC,GAUJ,aAAa,YAAY,MAAQ,oBAAA,UAAA,EAAA,UAAA,uCAAmC,GAAK,CAAE,CAAA;AAG/E,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAGA;AAAA,MACJ;AAAA,MACA,6BAA6BA,OAAM,oBAAoB;AAAA,MACvD,wBAAwBA,OAAM,eAAe;AAAA,MAC7C,wBAAwBA,OAAM;AAAA,MAC9B,8BAA8BA,OAAM,qBAAqB;AAAA,MACzD,wBAAwBA,OAAM;AAAA,MAC9B,uBAAuBA,OAAM;AAAA,MAC7B,0BAA0BA,OAAM;AAAA,IAAA;AAAA,EAAA;AAGtC,CAAC,GAKK,iBAAiB,KAAK,SAASmH,gBACnCnH,QAYA;AACM,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QAEE,EAAC,GAAAa,OAAK,kBAEN,cAAmC;AAAA,IACvC,CAAC,eAAe;AAEZ,UAAAjB,UAAQ,WAAW,MAAM,YAAY,KAAK,WAAW,cAAc,WAAW,IAAI;AAGlF,eAAO,uBAAuB,UAAU;AAE1C,UAAI,CAACsH,qBAAmB,UAAU,KAAK,CAAC,kBAAkB,UAAU;AAClE,cAAM,IAAI;AAAA,UACR,gEAAgE,KAAK;AAAA,YACnE,WAAW;AAAA,UAAA,CACZ;AAAA,QAAA;AAKH,aAAA;AAAA,QAACC;AAAAA,QAAA;AAAA,UACE,GAAG;AAAA,UACJ;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QAAA;AAAA,MAAA;AAAA,IAGN;AAAA,IACA;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,KAGI,cAAmC;AAAA,IACvC,CAAC,eAKG,WAAW,cAAc,WAAW,IAAI,MACvCnH,OAAM,gBAAgB,CAACJ,UAAQ,cAAc,WAAW,IAAI,KACpC,uBAAuB,UAAU,IAAI,KAAK,UAAU;AAAA,IAEjF,CAAC,cAAc,wBAAwBI,OAAM,YAAY;AAAA,KAGrD,aAA+C;AAAA,IACnD,CAAC,cAKG,WAAW,cAAc,UAAU,IAAI,MACtCA,OAAM,eAAe,CAACJ,UAAQ,cAAc,UAAU,IAAI,KAClC,sBAAsB,SAAS,IAAI,KAAK,SAAS;AAAA,IAE9E,CAAC,cAAc,uBAAuBI,OAAM,WAAW;AAAA,KAGnD,cAAmC;AAAA,IACvC,CAAC,eAEG,WAAW,cAAc,WAAW,IAAI,MACvCA,OAAM,eAAe,CAACJ,UAAQ,cAAc,WAAW,IAAI,KACnC,uBAAuB,UAAU,IAAI,KAAK,UAAU;AAAA,IAEjF,CAAC,cAAc,wBAAwBI,OAAM,WAAW;AAAA,KAGpD,oBAAyC;AAAA,IAC7C,CAAC,eAEG,WAAW,cAAc,WAAW,IAAI,MACvCA,OAAM,eAAe,CAACJ,UAAQ,cAAc,WAAW,IAAI,KAC7B,6BAA6B,UAAU,IAAI,KAAK,UAAU;AAAA,IAE7F,CAAC,cAAc,8BAA8BI,OAAM,WAAW;AAAA,KAG1D,mBAA6C;AAAA,IACjD,CAAC,oBAEG,WAAW,cAAc,gBAAgB,IAAI,MAC5CA,OAAM,eAAe,CAACJ,UAAQ,cAAc,gBAAgB,IAAI,KAE/D,4BAA4B,eAAe,IAC3C,KAAK,eAAe;AAAA,IAE1B,CAAC,cAAc,6BAA6BI,OAAM,WAAW;AAAA,EAAA;AAG3D,MAAA,kBAAkBA,MAAK,GAAG;AACtB,UAAA,YAAY,SAASA,OAAM,MAAM,YAAY,GAE7C,aAAaA,OAAM,QAAQ;AAAA,MAC/B,CAAC,WACC,OAAO,QAAQ,UAAU,aAAa,UAAU,CAAC,CAAC,KAAK,OAAO,QAAQ,UAAU,CAAC,EAAE;AAAA,IAAA;AAGvF,QAAI,CAAC,YAAY;AACT,YAAA,OAAO0C,eAAa1C,OAAM,IAAI,GAC9B,eAAe,SAASA,OAAM,MAAM,YAAY;AACtD,UAAI,aAAa,aAAa,CAAC,CAAC,GAAG;AAC3B,cAAA,MAAM,aAAa,CAAC,EAAE;AAC5B,eACG,oBAAA,OAAA,EACC,UAAC,oBAAA,WAAA,EAAU,GAAAa,IAAM,SAAQ,mCAAkC,QAAQ,EAAC,KAAK,KAAI,EAAA,CAAG,EAClF,CAAA;AAAA,MAEJ;AAEA,YAAM,QAAQ,eAAe,aAAa,CAAC,CAAC,IAAI,aAAa,CAAC,IAAI,aAAa,CAAC,EAAE,CAAC;AACnF,aACG,oBAAA,OAAA,EACC,UAAC,oBAAA,WAAA,EAAU,GAAAA,IAAM,SAAQ,qCAAoC,QAAQ,EAAC,OAAO,KAAI,EAAA,CAAG,EACtF,CAAA;AAAA,IAEJ;AAEA,WAAI,WAAW,SAAS,8BACd,iBAAgB,EAAA,QAAQ,WAAY,CAAA,IAI5C;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ;AAAA,QACR;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,eAAe;AAAA,MAAA;AAAA,IAAA;AAAA,EAGrB;AAEI,MAAAqG,qBAAmBlH,MAAK,GAAG;AACvB,UAAA,YAAY,SAASA,OAAM,MAAM,YAAY,GAC7C,cAAcA,OAAM,QAAQ;AAAA,MAChC,CAAC,WAAkC,OAAO,QAAQ,WAAW,UAAU,CAAC,MAAM,OAAO;AAAA,IAAA;AAGvF,QAAI,CAAC,aAAa;AAChB,YAAM,YACJ,OAAO,UAAU,CAAC,KAAM,WAAW,UAAU,CAAC,IAAI,KAAK,UAAU,UAAU,CAAC,CAAC;AAE/E,iCAAQ,OAAK,EAAA,UAAAa,GAAE,8BAA8B,EAAC,WAAU,EAAE,CAAA;AAAA,IAC5D;AAGE,WAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ;AAAA,QACR;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,eAAe;AAAA,MAAA;AAAA,IAAA;AAAA,EAGrB;AAEM,QAAA,IAAI,MAAM,mDAAmD;AACrE,CAAC,GCjRY,iCAAiC,cAAwC,CAAA,CAAE;AAEjF,SAAS,gCAAgCb,QAG7C;AAEC,SAAA,oBAAC,+BAA+B,UAA/B,EAAwC,OAAOA,OAAM,aACnD,iBAAM,SACT,CAAA;AAEJ;ACDO,SAAS,0BAA0B,KAAiD;AACnF,QAAA,MAAM,WAAW,8BAA8B;AACrD,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,2BAA2B;AAE7C,SAAO,IAAI,KAAK,CAAC,MAAM,EAAE,QAAQ,GAAG;AACtC;AAEO,SAAS,6BAAuD;AAC/D,QAAA,MAAM,WAAW,8BAA8B;AACrD,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,2BAA2B;AAEtC,SAAA;AACT;AAQO,SAAS,oCACdA,QAC0B;AACpB,QAAA,6BAAyE,OAAO,CAAA,CAAE;AACxF,SAAA,6BAA6B,EAAC,OAAAA,QAAO,KAAK,4BAA2B,GAC9D,2BAA2B;AACpC;AAEA,MAAM,+BAA+B,CAAC;AAAA,EACpC,OAAAA;AAAA,EACA;AACF,MAGM;AAlDN,MAAAW;AAmDQ,QAAA,SAIA,CAAA,GACA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAAX;AACJ,aAAW,UAAU;AACnB,QAAI,OAAO,SAAS;AAElB,UADsB,CAAC,YAAY,OAAO,KAAK,UAAU;AAEhD,eAAA,KAAK,EAAC,MAAM,eAAe,QAAQ,MAAM,OAAO,MAAK;AAAA,WACvD;AAIL,SACE,OAAO,KAAK,WAAW,SAAS,KAChC,OAAO,KAAK,YACZW,MAAO,OAAA,KAAK,aAAZ,QAAAA,IAAsB,UACtB,OAAO,QACP,OAAO,KAAK,UAAU,WAEtB,OAAO,KAAK,EAAC,MAAM,aAAa,QAAQ,MAAM,OAAO,KAAA,CAAK;AAGtD,cAAA,gBAAgB,OAAO,KAAK,QAAQ;AAAA,UACxC,CAAC,MAAM,EAAE,SAAS,WAAW,EAAE,SAAS;AAAA,QAAA;AAE1C,YACE,iBACA,cAAc,SAAS,WACvB,uBAAuB,aAAa;AAGzB,qBAAA,SAAS,cAAc,MAAM;AAElC,kBAAM,SAAS,UAAU,MAAM,KAAK,WAAW,SAAS,UAC1D,OAAO,KAAK,EAAC,MAAM,gBAAgB,QAAQ,OAAO,MAAM,MAAM,MAAK;AAKzE,cAAM,qBAAqB,OAAO,KAAK,QACpC,OAAO,2BAA2B,EAClC,KAAK,CAAC,MAAM,EAAE,SAAS,UAAU;AAChC,YAAA;AAES,qBAAA,SAAS,mBAAmB,MAAM;AAEvC,kBAAM,SAAS,UAAU,MAAM,KAAK,WAAW,aAAa,YAC9D,OAAO,KAAK;AAAA,cACV,MAAM;AAAA,cACN,QAAQ;AAAA,cACR,MAAM,MAAM;AAAA,YAAA,CACb;AAAA,MAIT;AAIJ,QAAM,QAAkC,OAAO,IAAI,CAAC,SAAS;AAC3D,UAAM,MAAM+B,eAAa,KAAK,KAAK,IAAI,GACjC,eAAe,IAAI,QAAQ,KAAK,CAAC,YAAY,QAAQ,QAAQ,GAAG,GAChE0E,YAAW,KAAK,SAAS;AAC/B,QAAI,QAAmB;AAElB,QAAAA,aAAY,KAAK,YAAW,gBAAA,OAAA,SAAA,aAAc,WAAW,KAAK,UAAS,6CAAc,OAAM;AAC1F,YAAM,aAAa;AAAA,QACjB,cAAc,QAAQ,KAAK,KAAK,IAAI;AAAA,QACpC,cAAc;AAAA,QACd;AAAA,QACA,MAAM,QAAQ,IAAI;AAAA,QAClB;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAEM,cAAA,oBAAC,WAAW,EAAA,GAAI,WAAsB,CAAA;AAAA,IAChD;AAGA,WAAI,gBACF,aAAa,SAAS,KAAK,QAC3B,aAAa,OAAO,KAAK,MACzB,aAAa,QAAQ,SAAS,aAAa,OACpC,gBAGF;AAAA,MACL,MAAM,KAAK;AAAA,MACX;AAAA,MACA,QAAQ,KAAK;AAAA,MACb,MAAM,KAAK;AAAA,MACX,YAAY,UAA4C;AAAA,MACxD;AAAA,IAAA;AAAA,EACF,CACD;AAED,SAAA,IAAI,UAAU,OAEP;AACT,GCrKapC,SAAO,OAAO;AAAA,EACzB,CAAChF,WAAgF;AALnF,QAAAW,KAAA,IAAA,IAAA;AAMI,UAAM,EAAC,WAAW,WAAW,MAAA,IAASX;AAE/B,WAAA;AAAA;AAAA;AAAA,2BAGeW,YAAM,OAAO,MAAM,eAAnB,OAAgC,SAAAA,IAAA,QAAA,EAAU,QAAQ,EAAE;AAAA,mCAC5C,WAAM,OAAO,MAAM,eAAnB,OAAgC,SAAA,GAAA,QAAA,EAAU,QAAQ,EAAE;AAAA,gBACvE,WAAM,OAAO,MAAM,eAAnB,OAAgC,SAAA,GAAA,QAAA,EAAU,QAAQ,EAAE;AAAA;AAAA;AAAA,oCAGhC,WAAM,OAAO,MAAM,eAAnB,OAAgC,SAAA,GAAA,QAAA,EAAU,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,4BAI3D,MAAM,OAAO,MAAM,OAAO,KAAK,OAAO,GAAG,EAAE,MAAM,KAAK,OAAO,EAAE,EAAE,GAAG;AAAA;AAAA;AAAA;AAAA,4BAIpE,MAAM,OAAO,MAAM,MAAM,QAAQ,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,4BAI3C,MAAM,OAAO,MAAM,MAAM,SAAS,QAAQ,EAAE;AAAA;AAAA;AAAA,EAGtE;AACF,GAEa0G,eAAa,OAAO,GAAG,EAAE,MAAM,EAAC,aAAa,QAAO;AAAA;AAAA,GC3B3DC,gCAAkE,CAAC,OAAO,QAAQ;AAajF,SAAS,yBAAyBtH,QAAsC;AACvE,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QACE,CAAC,eAAe,gBAAgB,IAAI,SAAkB,EAAK,GAC3D,CAAC,aAAa,cAAc,IAAI,SAAkB,EAAK,GACvD,CAAC,YAAY,aAAa,IAAI,SAAyB,IAAI,GAC3D,WAAW,OAAqB,IAAI,GACpC,EAAC,WAAU,YACX,EAAC,GAAAa,GAAA,IAAK,eAAA,GACN,aAAa,OAA8B,IAAI,GAC/C,gBAAgB,OAAO,MAAM,OAAO,UAAU,QAI9C,oBAAoB,YAAY,CAAC,SAAkB;AACvD,qBAAiB,IAAI,GACjB,OACF,gBAAgB,MAAM;AACpB,qBAAe,IAAI;AAAA,IAAA,CACpB,IAED,eAAe,IAAI;AAAA,KAEpB,CAAE,CAAA,GAGC,gBAAgB,QAAQ,MACvB,aAGE;AAAA,IACL,uBAAuB,MACd;AAAA,EAAA,IAJF,MAOR,CAAC,UAAU,CAAC;AAGf;AAAA,IACE;AAAA,MACE,CAAC,UAAU;AACJ,uBAGD,MAAM,QAAQ,YAChB,kBAAkB,EAAK;AAAA,MAE3B;AAAA,MACA,CAAC,mBAAmB,WAAW;AAAA,IACjC;AAAA,EAAA;AAII,QAAA,wBAAwB,YAAY,MAAM;AAC9C,QAAI,gBAAgB;AACA,wBAAA,EAAK,GACvB,cAAc,IAAI;AAClB;AAAA,IACF;AAEM,UAAA,MAAM,OAAO;AAEf,QAAA,CAAC,OAAO,IAAI,eAAe;AAAG;AAE5B,UAAA0G,SAAQ,IAAI,WAAW,CAAC;AAG9B,QAAI,EAFiB,oBAAA,QAAA,iBAAkB,SAASA,OAAM,uBAEnC,IAAA;AACC,wBAAA,EAAK,GACvB,cAAc,IAAI;AAClB;AAAA,IACF;AACA,UAAM,OAAOA,UAAO,OAAA,SAAAA,OAAA;AAChB,aACF,cAAc,IAAI,GAClB,kBAAkB,EAAI;AAAA,EAEvB,GAAA,CAAC,gBAAgB,kBAAkB,iBAAiB,CAAC;AAG9C,YAAA,OACR,SAAS,iBAAiB,mBAAmB,uBAAuB,EAAC,SAAS,GAAK,CAAA,GAC5E,MAAM;AACF,aAAA,oBAAoB,mBAAmB,qBAAqB;AAAA,EAAA,IAEtE,CAAC,qBAAqB,CAAC;AAEpB,QAAA,0BAA0B,YAAY,MAAM;AAC9B,sBAAA,EAAK,GACvB;EAAO,GACN,CAAC,QAAQ,iBAAiB,CAAC;AAG9B,YAAU,MAAM;AACV,KAAC,kBAAkB,YAAY,cACjC,kBAAkB,EAAI,GAEpB,kBACF,kBAAkB,EAAK;AAAA,KAExB,CAAC,gBAAgB,UAAU,YAAY,iBAAiB,CAAC;AAEtD,QAAA,4BAA4B,YAAY,MAAM;AAChC,sBAAA,EAAK,GACvB;EAAS,GACR,CAAC,UAAU,iBAAiB,CAAC,GAE1B,eAAe,YAAY,MAAM;AACjC,aAAS,WACX,cAAc,SAAS,QAAQ,uBAAuB;AAAA,EAE1D,GAAG,CAAE,CAAA;AA2BL,SAzBA,UAAU,MAAM;AACR,UAAA,MAAM,OAAO;AACf,WAAO,IAAI,aAAa,MAC1B,SAAS,UAAU,IAAI,WAAW,CAAC;AAAA,KAEpC,CAAC,WAAW,CAAC,GAEhB,UAAU,MAAM;AAEd,QAAI,eAAe;AACC,aAAA,kBAAA,iBAAiB,UAAU,YAAY,GAClD,MAAM,kBAAkB,oBAAoB,UAAU,YAAY;AAGtE,QAAA;AAIc,aAAA,qBAAA,QAAA,kBAAA,iBAAiB,UAAU,YAAA,GAEvC,MAAM;AACX,6BAAA,QAAA,kBAAmB,oBAAoB,UAAU,YAAA;AAAA,MAAA;AAAA,EACnD,GACC,CAAC,aAAa,mBAAmB,YAAY,CAAC,GAE5C,gBAKH;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAM;AAAA,MACN;AAAA,MACA,eAAa;AAAA,MACb,SACG,oBAAA,KAAA,EAAI,SAAS,GAAG,eAAY,8BAC3B,UAAA,qBAAC,MAAK,EAAA,KAAK,GACT,UAAA;AAAA,QAAC,oBAAA,KAAA,EAAI,SAAS,GACZ,UAAC,oBAAA5F,QAAA,EAAK,QAAO,UAAS,MAAM,GACzB,UAAA,MACH,CAAA,GACF;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,cAAYd,GAAE,wDAAwD;AAAA,YACtE,MAAM;AAAA,YACN,MAAK;AAAA,YACL,SAAS;AAAA,YACT,UAAU;AAAA,YACV,cAAc;AAAA,UAAA;AAAA,QAChB;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,cAAYA,GAAE,0DAA0D;AAAA,YACxE,MAAM;AAAA,YACN,MAAK;AAAA,YACL,SAAS;AAAA,YACT,UAAU;AAAA,YACV,MAAK;AAAA,YACL,cAAc;AAAA,UAAA;AAAA,QAChB;AAAA,MAAA,EAAA,CACF,EACF,CAAA;AAAA,MAEF,oBAAoByG;AAAAA,MACpB,WAAU;AAAA,MACV,QAAM;AAAA,MACN,iBAAe;AAAA,MACf,KAAK;AAAA,MACL;AAAA,MACA,kBAAkB;AAAA,MAClB,QAAQ;AAAA,IAAA;AAAA,EA3CH,IAAA;AA8CX;ACnNA,MAAM,uBAAuB,CAAC,UACxB,MAAM,QAAQ,KAAK,IACd,MAAM,QAAQ,oBAAoB,IAEvC,OAAO,SAAU,WACZ,CAAC,KAAK,IAER,UAAU,SAAS,CAAC,MAAM,IAAI,CAAC,GAElC,iBAAiB,CAAC,UACf,UAAU,YAAY,UAAU,YAAY,QAAQ;AAGtD,SAAS,gBACd,YACuE;AAjBzE,MAAA3G;AAkBQ,QAAA,OAAMA,MAAW,WAAA,YAAX,OAAoB,SAAAA,IAAA;AAChC,SAAO,OAAO,OAAQ,YAAY,QAAQ,OACtC;AAAA,IACE,MAAM,eAAe,IAAI,IAAI;AAAA,IAC7B,OAAO,qBAAqB,IAAI,KAAK;AAAA,EAEvC,IAAA;AACN;ACLO,MAAM,mCAAmC;AAAA,EAC9C;AACF;AAKO,SAAS,+BAA0D;AAClE,QAAA,MAAM,WAAW,gCAAgC;AACvD,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,kDAAkD;AAE7D,SAAA;AACT;ACfO,SAAS,kCAAkCX,QAA+C;AACzF,QAAA,EAAC,eAAe,iBAAoB,IAAAA;AAGxC,SAAA;AAAA,IAAC,iCAAiC;AAAA,IAAjC;AAAA,MACC,OAAO,EAAC,eAAe,iBAAkC;AAAA,MAExD,UAAMA,OAAA;AAAA,IAAA;AAAA,EAAA;AAGb;ACZO,SAAS,kBAAkBA,QAA+B;AACzD,QAAA,EAAC,SAAS,UAAU,OAAO,QAAQ,GAAG,cAAaA,QACnD,WAAW,SAEX,CAAC,gBAAgB,iBAAiB,IAAI,SAAgC,IAAI,GAC1E,mBAAmB,OAA8B,IAAI;AAGzD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAQ;AAAA,MACR,IAAI;AAAA,MACJ,gBAAgB;AAAA,MAChB;AAAA,MACA,QAAO;AAAA,MACP;AAAA,MACA,YAAY;AAAA,MACZ,eAAY;AAAA,MACZ,sBAAsB;AAAA,MAEtB,UAAA,oBAAC,mBAAgB,SAAS,CAAC,GAAG,GAAG,GAAG,CAAC,GACnC,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,eAAe;AAAA,UACf;AAAA,UAEA,UAAC,oBAAA,KAAA,EAAI,KAAK,kBAAmB,UAAS;AAAA,QAAA;AAAA,MAAA,GAE1C;AAAA,IAAA;AAAA,EAAA;AAGN;ACxCa,MAAA,cAAc,OAAO,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,GAO5B,qBAAqB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA,GAM/B,mBAAmB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA,GCMpCsH,gCAAkE,CAAC,OAAO,QAAQ;AAEjF,SAAS,kBAAkBtH,QAA+B;AAC/D,QAAM,EAAC,kBAAkB,mBAAmB,kBAAkB,QAAQ,EAAK,IAAAA,QACrE,CAAC,MAAM,OAAO,IAAI,SAAS,EAAK;AAMtC,SAAA,UAAU,MAAM;AACd,YAAQ,EAAI;AAAA,EAAA,GACX,CAAA,CAAE,GAGH;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS,oBAAC,SAAS,EAAA,GAAGA,OAAO,CAAA;AAAA,MAC7B,eAAa;AAAA,MACb,eAAY;AAAA,MACZ,WAAQ;AAAA,MACR,oBAAoBsH;AAAAA,MACpB;AAAA,MACA;AAAA,MACA,UAAS;AAAA,MACT,WAAU;AAAA,MACV,QAAO;AAAA,MACP,iBAAe;AAAA,MACf;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA;AAGN;AAEA,SAAS,QAAQtH,QAA+B;AAC9C,QAAM,EAAC,SAAS,mBAAmB,kBAAkB,OAAO,UAAa,IAAAA;AAEzE;AAAA,IACE;AAAA,MACE,CAAC,UAAyB;AACpB,cAAM,QAAQ,YAChB;MAEJ;AAAA,MACA,CAAC,OAAO;AAAA,IACV;AAAA,EAAA,GAGF,gBAAgB,SAAS,mBAAmB,CAAC,gBAAgB,IAAI,CAAA,GAAI,iBAAiB;AAGhF,QAAA,CAAC,gBAAgB,iBAAiB,IAAI,SAAgC,IAAI,GAC1E,mBAAmB,OAA8B,IAAI;AAGzD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAe;AAAA,MACf;AAAA,MAEA,+BAAC,MAAK,EAAA,KAAK,kBAAkB,WAAU,UAAS,QAAO,QACrD,UAAA;AAAA,QAAC,oBAAA,kBAAA,EAAiB,MAAK,QAAO,SAAS,GACrC,UAAC,qBAAA,MAAA,EAAK,OAAM,UACV,UAAA;AAAA,UAAC,oBAAA,KAAA,EAAI,MAAM,GAAG,SAAS,GACrB,8BAAC2B,QAAK,EAAA,QAAO,UAAU,UAAA,MAAM,CAAA,GAC/B;AAAA,UAEA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,WAAW,CAAQ,CAAA;AAAA,cACnB,MAAM;AAAA,cACN,MAAK;AAAA,cACL,SAAS;AAAA,cACT,cAAc,EAAC,SAAS,QAAO;AAAA,YAAA;AAAA,UACjC;AAAA,QAAA,EAAA,CACF,EACF,CAAA;AAAA,QACA,oBAAC,sBAAmB,MAAM,GACxB,8BAAC,iBAAgB,EAAA,SAAS,CAAC,GAAG,GAAG,GAAG,CAAC,GACnC,UAAA,oBAAC,OAAI,SAAS,GAAG,KAAK,mBACnB,UAAA3B,OAAM,SACT,CAAA,EAAA,CACF,EACF,CAAA;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAAA;AAGN;ACrGO,SAAS,gBAAgBA,QAS7B;AACK,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QAEE,EAAC,GAAAa,GAAA,IAAK,eAAe,GACrB,oBAAoB,QAAQ,MAAM,gBAAgB,UAAU,GAAG,CAAC,UAAU,CAAC,GAC3E,aAAY,qBAAA,OAAA,SAAA,kBAAmB,SAAQ,aAEvC,kBAAkB,WAAW,eAC/BA,GAAE,WAAW,YAAY,IACzB,WAAW,SAAS,WAAW,MAE7B,aAAaA,GAAE,gDAAgD;AAAA,IACnE,YAAY;AAAA,EAAA,CACb,GAEK,cAAc,YAAY,MAAM;AAC5B;EAAA,GACP,CAAC,OAAO,CAAC,GAEN,aAAa,qBAAmB,OAAA,SAAA,kBAAA;AAEtC,SAAI,cAAc,YAEd;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA,SAAS;AAAA,MACT;AAAA,MACA;AAAA,MACA,uCAAU,UAAW,WAAA,CAAA;AAAA,MACrB,OAAO;AAAA,MAEN,UAAMb,OAAA;AAAA,IAAA;AAAA,EAAA,IAMX;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,OAAO;AAAA,MACP,OAAO;AAAA,MACP;AAAA,MAEC,UAAMA,OAAA;AAAA,IAAA;AAAA,EAAA;AAGb;AClBO,SAAS,WAAWA,QAAwB;AAtDnD,MAAAW;AAuDQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAAX,QACE,EAAC,UAAU,eAAc,IAAI,eAAe,EAAE,WAAW,YACzDwH,UAAS,yBACT,cAAoB;AAAA,IACxB,MAAM,KAAK,MAAM,GAAG,KAAK,SAAS,CAAC,EAAE,OAAO,CAAC,YAAY,EAAC,MAAM,MAAM,KAAK,CAAA,CAAC;AAAA,IAC5E,CAAC,MAAM,MAAM,IAAI;AAAA,EACnB,GACM,CAAC,aAAa,cAAc,IAAI,SAAiC,IAAI,GACrE,WAAiB,QAAQ,MAAM,KAAK,MAAM,KAAK,SAAS,GAAG,KAAK,MAAM,GAAG,CAAC,IAAI,CAAC,GAC/E,aAAa,0BAA0B9E,eAAa,WAAW,CAAC,GAChE,EAAC,YAAAyC,gBAAc,oBAAoB,cAAA,OAAA,SAAA,WAAY,IAAI,GACnD,UAAU,uBAAuB,IAAI,GAErC,OAAO,QAAQ,MAAO,oBAAA,QAAA,EAAK,mBAAgB,IAAI,SAAS,CAAA,GAAS,CAAC,QAAQ,CAAC,GAE3E,SAAS,YAAY,MAAM;AAC3B,mBAEF,mBAAmB,KAAKqC,OAAM,GAC9B,YAAY,WAAW,KAAK,SAAS,GACrC,WAAW,WAAW,KAAK,IAAI;AAAA,EAAA,GAEhC,CAACA,SAAQ,YAAY,YAAY,WAAW,CAAC,GAE1C,UAAU,YAAY,MAAM;AACpB;AAEZ,UAAM,MAAM,mBAAmB,aAAaA,OAAM,GAC5C,eAAc,OAAK,OAAA,SAAA,IAAA,MAAM,SAAQ5H,UAAQ,IAAI,MAAM,MAAM,QAAQ,KAAK,IAAI,MAAM,QAChF,gBAAe,OAAA,OAAA,SAAA,IAAK,OAAO,SAAQA,UAAQ,IAAI,OAAO,MAAM,QAAQ,KAAK,IAAI,OAAO;AAC1F,uBAAmB,OAAO4H,SAAQ;AAAA,MAChC,QAAQ,EAAC,MAAM,UAAU,QAAQ,gBAAgB,EAAC;AAAA,MAClD,OAAO,EAAC,MAAM,UAAU,QAAQ,eAAe,EAAC;AAAA,IACjD,CAAA,GACD,mBAAmB,MAAMA,OAAM;AAAA,EAAA,GAC9B,CAACA,SAAQ,UAAU,WAAW,CAAC,GAE5B,WAAW,YAAY,MAAM;AACjC,uBAAmB,iBAAiBA,SAAQ,UAAU,GACtD,mBAAmB,MAAMA,OAAM;AAAA,KAC9B,CAACA,SAAQ,UAAU,CAAC,GAEjB,iBAAiB;AAAA,IACrB,MACErC,YAAW,SAAS,KAAK,QAAQ,SAAS,IACxC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,WAAU;AAAA,QACV,QAAO;AAAA,QACP,6BACGkC,cACC,EAAA,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA;AAAA,YACA,YAAAlC;AAAA,UAAA;AAAA,QAAA,GAEJ;AAAA,QAGD,UAAA;AAAA,MAAA;AAAA,IAED,IAAA;AAAA,IACN,CAAC,SAAS,SAAS,qBAAqB,MAAMA,WAAU;AAAA,EAAA,GAGpD,WAAW,iBAAiB,MAAM,EAAI,GACtC,eAAe;AAAA,IACnB,MAAM,SAAS,OAAO,CAAC,MAAMvF,UAAQ,EAAE,MAAM,IAAI,CAAC;AAAA,IAClD,CAAC,MAAM,QAAQ;AAAA,KAGX,SAAS,CAAA,EAAQ,cAAY,QAAA,WAAA,OAAO,OACpC,QAAQ,cAAA,OAAA,SAAA,WAAY,OACpB,YAAW,yCAAY,KAAK,SAAQU,eACpC,mBAAmB,aAEnB,iBAAiB;AAAA,IACrB,OAA6B;AAAA,MAC3B,6BAA6B;AAAA,MAC7B,8BAA8B;AAAA,MAC9B,6BAA6B;AAAA,MAC7B,6BAA6B;AAAA;AAAA,MAC7B,UAAU;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAM;AAAA,MACN,kBAAkBkH,QAAO,YAAY;AAAA,MACrC,MAAM;AAAA,MACN,UAAU;AAAA,MACV,UAAU,CAAQ,CAAA;AAAA,MAClB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,eAAe;AAAA,MACf;AAAA,MACA;AAAA,MACA,aAAa,kBAAkB;AAAA,MAC/B,YAAArC;AAAA,MACA;AAAA,IAAA;AAAA,IAEF;AAAA,MACEqC,QAAO,YAAY;AAAA,MACnB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACArC;AAAA,MACA;AAAA,IACF;AAAA,KAGI,mBAAkBxE,MAAA,WAAW,eAAX,OAAA,SAAAA,IAAuB,YAIzC,SAAS;AAAA,IACb,CAAC,QAAyB;AACpB,uCAAY,eACd,WAAW,WAAW,UAAU,MAElC,eAAe,GAAG;AAAA,IACpB;AAAA,IACA,CAAC,UAAU;AAAA,EAAA;AAGN,SAAA;AAAA,IACL,MACG,oBAAA,QAAA,EAAK,KAAK,QAAQ,OAAO,QACvB,UAAA,kBACE,oBAAA,iBAAA,EAAiB,GAAG,eAAgB,CAAA,wBAEpC,4BAA4B,EAAA,GAAG,eAAgB,CAAA,GAEpD;AAAA,IAEF,CAAC,iBAAiB,gBAAgB,MAAM;AAAA,EAAA;AAE5C;AAEa,MAAA,6BAA6B,CAACX,WAAgC;AACnE,QAAA;AAAA,IACJ,6BAA6B;AAAA,IAC7B,8BAA8B;AAAA,IAC9B,6BAA6B;AAAA,IAC7B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAAmF;AAAA,EAAA,IACEnF,QACE,SAAS,WAAW,SAAS,QAC7B,WAAWmF,YAAW,KAAK,CAAC,MAAM,EAAE,UAAU,OAAO,GACrD,aAAaA,YAAW,KAAK,CAAC,MAAM,EAAE,UAAU,SAAS,GACzD,aAAa,QAAQ,SAAS,GAE9B,EAAC,GAAAtE,GAAK,IAAA,eACN,GAAA,UAAU,QAAQ,MAClB,WACK,aAGL,aACK,YAGL,SACK,YAEF,WACN,CAAC,QAAQ,UAAU,UAAU,CAAC;AAG/B,SAAA;AAAA,IAACmE;AAAAA,IAAA;AAAA,MACC,UAAU;AAAA,MACV,cAAYnE,GAAE,4CAA4C;AAAA,MAC1D,aAAW,SAAS,KAAK;AAAA,MACzB,cAAY,WAAW,KAAK;AAAA,MAC5B,gBAAc,aAAa,KAAK;AAAA,MAChC,gBAAc,cAAc;AAAA,MAC5B,SAAS,WAAW,SAAS;AAAA,MAE5B,UAAA;AAAA,QAAA;AAAA,QACD;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,gBAAgB;AAAA,YAChB;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA,OACE,WAAW,eAAeA,GAAE,WAAW,YAAY,IAAI,WAAW,SAAS,WAAW;AAAA,UAAA;AAAA,QAE1F;AAAA,QACC,QACC;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,aAAY;AAAA,YACZ;AAAA,YACA;AAAA,YACA,WAAW;AAAA,YACX;AAAA,YACA;AAAA,YACA;AAAA,YAEC;AAAA,UAAA;AAAA,QACH;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAIR,GCtTM,UAAU,cAAqC,CAAA,CAAE;AAuDhD,SAAS,2BAA2B;AACzC,SAAO,WAAW,OAAO;AAC3B;AAKO,SAAS,8BACdb,QACA;AACM,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QAEE,eAAe;AAAA,IACnB,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,IAEF,CAAC,YAAY,4BAA4B,iBAAiB,yBAAyB;AAAA,EAAA;AAGrF,6BAAQ,QAAQ,UAAR,EAAiB,OAAO,cAAe,SAAS,CAAA;AAC1D;ACzFa,MAAA,uBAAuB,cAAgD,IAAI,GCClF,oBAAoB,cAA6C,IAAI;AAEpE,SAAS,mBAAmBA,QAA0C;AACrE,QAAA,QAAQ,QAAQ,OAAO,EAAC,IAAIA,OAAM,GAAA,IAAM,CAACA,OAAM,EAAE,CAAC;AACxD,6BAAQ,kBAAkB,UAAlB,EAA2B,OAAe,iBAAM,SAAS,CAAA;AACnE;AAEA,SAAS,qBAA6B;AAC9B,QAAA,MAAM,WAAW,iBAAiB;AACxC,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,wDAAwD;AAE1E,SAAO,IAAI;AACb;AAmBO,SAAS,iBAAqC;AAC5C,SAAA,eAAe,oBAAoB;AAC5C;AC/BgB,SAAA,+BACd,YACA,gBACM;AACC,SAAA;AAAA,IACL;AAAA,IACA;AAAA,MACE,CAAC,UAAU,aAAa;AAClB,mBAAW,WAAW,CAAC,YAAY,YACrC,eAAe,WAAW,SAAS,EAAC,YAAY,SAAS,CAAA;AAAA,MAE7D;AAAA,MACA,CAAC,UAAU;AAAA,IACb;AAAA,EAAA;AAEJ;ACfA,MAAMgF,SAAO,OAAOrD,MAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoBjB,SAAS,wBAAwB,EAAC,OAAO,aAAiC;AAC/E,QAAM,SAAS,CAAC,CAAC,OACX,aAAa,CAAC,CAAC,WAEf,SAAS,QAAQ,MACjB,UAAU,CAAC,aAAmB,gBAC3B,UACN,CAAC,QAAQ,UAAU,CAAC;AAKvB,SAAK,CAAC,UAAU,CAAC,cAAgB,CAAC,UAAU,aACnC,OAIN,oBAAAqD,QAAA,EAAK,eAAa,QAAQ,MAAM,GAC/B,UAAA,oBAAC,WAAQ,EACX,CAAA;AAEJ;ACpCO,SAAS,iBAAiBhF,QAO9B;AAvBH,MAAAW,KAAA;AAwBQ,QAAA,EAAC,IAAAnB,KAAI,QAAQ,SAAS,SAAS,eAAe,kBAAiBQ,QAE/D,mBAAmB,oBAAoBR,GAAE,GAEzC,cACJmB,MAAQ,QAAA,UAAR,oBAAe,UACf,KAAA,QAAQ,cAAR,OAAmB,SAAA,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMnBnB,KAKI,cAAc;AAAA,IAClB,OAAO,EAAC,KAAK,WAAW,OAAO,QAAQ,KAAI;AAAA,IAC3C,CAAC,WAAW,QAAQ,IAAI;AAAA,KAGpB,EAAC,OAAO,UAAS,IAAI,SAErB,eAAe;AAAA,IACnB,OAAO;AAAA,MACL,8BACG,KAAI,EAAA,aAAa,GAChB,UAAC,qBAAA,QAAA,EAAO,OAAO,GACZ,UAAA;AAAA,QAAA,iBAAkB,oBAAA,OAAA,EAAM,MAAK,WAAW,kBAAQ,OAAM;AAAA,QAEtD,oBAAoB,iBAAiB,SAAS,KAC5C,oBAAA,yBAAA,EAAwB,UAAU,kBAAkB;AAAA,4BAGtD,yBAAwB,EAAA,OAAO,QAAQ,OAAO,WAAW,QAAQ,WAAW;AAAA,MAAA,EAAA,CAC/E,EACF,CAAA;AAAA,MAEF;AAAA,MACA,YAAY;AAAA,MACZ,SAAS,oBAAC,gBAAe,EAAA,OAAc,UAAsB,CAAA;AAAA,MAC7D,OAAO;AAAA,IAAA;AAAA,IAET;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAGF,SAAO,cAAc,YAAY;AACnC;ACnEO,SAASiI,wBAAsBzH,QAOnC;AAtBH,MAAAW,KAAA,IAAA,IAAA,IAAA,IAAA;AAuBE,QAAM,EAAC,SAAS,WAAW,eAAe,eAAe,MAAM,OAAO,cAAiB,IAAAX,QACjF,EAAC,GAAAa,OAAK,eAAe;AAEvB,MAAA,cAAc,aAAa,cAAc;AAC3C,WAAQ,oBAAA,sBAAA,EAAqB,eAAa,IAAC,OAAgB,CAAA;AAM7D,QAAIF,oBAAc,WAAd,OAAA,SAAAA,IAAsB,aAAa,YAAW,eAAe,MAAM,sBAAsB;AAC3F,UAAM+G,WAAU,KAAK,GAAG,KAAK,CAAC,WAAQ;AAlC1C/G,UAAAA;AAkC6C,aAAA,OAAO,WAASA,OAAA,SAAO,OAAA,SAAA,MAAA,yBAAP,gBAAAA,KAA6B;AAAA,IAAA,CAAI;AAC1F,QAAI,CAAC+G;AAID,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,YAAY,MAAM;AAAA,UAClB,aAAY,KAAM,MAAA,yBAAN,OAA4B,SAAA,GAAA;AAAA,UACxC,eAAe,KAAK,GAAG,IAAI,CAAC,WAAW,OAAO,IAAI;AAAA,QAAA;AAAA,MAAA;AAMxD,UAAM,QAAO,KAAA,MAAM,yBAAN,QAAA,GAA4B,OACrC;AAAA,MACE,KAAK,MAAM;AAAA,MACX,QAAO,KAAM,MAAA,yBAAN,OAA4B,SAAA,GAAA;AAAA,IAErC,IAAA;AAGF,WAAA,qBAAC,MAAK,EAAA,OAAM,UACV,UAAA;AAAA,MAAC,oBAAA,KAAA,EAAI,MAAM,GACR,UAAc,cAAA;AAAA,QACb;AAAA,QACA,YAAYA;AAAAA,QACZ,OAAO;AAAA,QACP,qBAAqB;AAAA,MACtB,CAAA,GACH;AAAA,MACC,oBAAA,KAAA,EACC,UAAC,oBAAA,QAAA,EAAO,OAAO,GACZ,UAAA,iBAAkB,oBAAA,OAAA,EAAM,MAAK,WAAW,UAAAA,SAAQ,MAAA,CAAM,EACzD,CAAA,GACF;AAAA,IACF,EAAA,CAAA;AAAA,EAEJ;AAEM,QAAA,eAAe,cAAc,OAAO,cAEpC,WAAW,aAAa,WAAW,aACnC,0BAA0B,aAAa,WAAW;AACxD,MAAI,2BAA2B;AAE3B,WAAA,qBAAC,QAAO,EAAA,OAAO,GACb,UAAA;AAAA,MAAC,oBAAA,KAAA,EAAI,SAAS,GACZ,UAAA,oBAAC,QAAK,OAAM,UACV,UAAC,oBAAA,KAAA,EAAI,MAAM,GAAG,UAAU,GACtB,UAAA,oBAAC/F,UAAK,OAAK,IAAE,aAAE,mDAAmD,EAAA,CAAE,EACtE,CAAA,EAAA,CACF,EACF,CAAA;AAAA,MACC,2BAA2B,WAC1B,oBAAC,KACC,EAAA,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAM;AAAA,UACN,SACE,WACE;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,OAAOd,GAAE,mDAAmD;AAAA,cAC5D,MAAM;AAAA,cAEN,UAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,SAAQ;AAAA,kBACR,GAAAA;AAAA,kBACA,QAAQ,EAAC,YAAY,MAAM,KAAI;AAAA,gBAAA;AAAA,cACjC;AAAA,YAAA;AAAA,UAAA,IAGF;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,OAAOA,GAAE,uDAAuD;AAAA,cAChE,MAAM;AAAA,cAEL,aAAE,6DAA6D;AAAA,YAAA;AAAA,UAClE;AAAA,UAIJ,8BAAC,cAAa,EAAA,MAAK,WACjB,UAAA,oBAAC,iBAAe,CAAA,GAClB;AAAA,QAAA;AAAA,SAEJ,IACE;AAAA,IACN,EAAA,CAAA;AAIJ,QAAM,eAAc,KAAA,cAAc,WAAd,OAAA,SAAA,GAAsB,MACpC,UAAU,KAAK,GAAG,KAAK,CAAC,WAAW,OAAO,SAAS,WAAW;AAEpE,SAAK,UAcH;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,IAAI,MAAM;AAAA,MACV;AAAA,MACA,UAAS,KAAc,cAAA,WAAd,OAAsB,SAAA,GAAA;AAAA,MAC/B;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA,IAlBA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,YAAY,MAAM;AAAA,MAIlB,YAAY,eAAe;AAAA,MAC3B,eAAe,KAAK,GAAG,IAAI,CAAC,WAAW,OAAO,IAAI;AAAA,IAAA;AAAA,EAAA;AAe1D;AAEA,SAAS,mBAAmBb,QAAqE;AAC/F,QAAM2H,QAAO3H,OAAM;AACnB,8BACG,MACC,EAAA,UAAA;AAAA,IAAA,oBAAC2B,QAAK,EAAA,MAAM,GACV,UAAA,oBAACgG,QAAK,CAAA,GACR;AAAA,IACC,qBAAA,KAAA,EAAI,MAAM,GAAG,YAAY,GACxB,UAAA;AAAA,MAAA,oBAAChG,UAAK,MAAM,GAAG,QAAO,UACnB,iBAAM,OACT;AAAA,MAEC,oBAAA,KAAA,EAAI,WAAW,GACd,8BAACA,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAA3B,OAAM,SACT,CAAA,GACF;AAAA,IAAA,GACF;AAAA,EACF,EAAA,CAAA;AAEJ;AAEA,SAAS,YAAY;AAAA,EACnB;AAAA,EACA;AAAA,EACA;AACF,GAIG;AACK,QAAA,EAAC,GAAAa,OAAK;AAEZ,SACG,qBAAA,MAAA,EAAK,OAAM,UAAS,SAAQ,cAC3B,UAAA;AAAA,IAAC,oBAAA,KAAA,EAAI,SAAS,GACZ,UAAA,oBAAC,QAAK,OAAM,UACV,UAAC,oBAAA,KAAA,EAAI,MAAM,GAAG,UAAU,GACtB,UAAA,oBAACc,UAAK,OAAK,IAAE,aAAE,2CAA2C,EAAA,CAAE,EAC9D,CAAA,EAAA,CACF,EACF,CAAA;AAAA,wBACC,KACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAM;AAAA,QACN,6BACG,OAAM,EAAA,OAAO,GACZ,UAAC,oBAAAA,QAAA,EAAK,MAAM,GACV,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAd;AAAA,YACA,SAAQ;AAAA,YACR,QAAQ,EAAC,YAAY,WAAU;AAAA,YAC/B,YAAY;AAAA,cACV,cAAc,MAAO,oBAAA,eAAA,EAAc,QAAQ,cAAe,CAAA;AAAA,YAC5D;AAAA,UAAA;AAAA,WAEJ,EACF,CAAA;AAAA,QAGF,UAAA,oBAAC,KAAI,EAAA,SAAS,GACZ,UAAA,oBAAC,cAAa,EAAA,MAAK,WACjB,UAAA,oBAAC,gBAAe,CAAA,CAAA,EAClB,CAAA,GACF;AAAA,MAAA;AAAA,IAAA,GAEJ;AAAA,EACF,EAAA,CAAA;AAEJ;AAEA,SAAS,cAAcb,QAA2B;AAE1C,QAAA,QADa,cAAc,EAAC,MAAM,cAAc,CAAA,EAC7B,cAAcA,OAAM,MAAM;AAEjD,SAAA,oBAACuB,cACE,UAAM,MAAA;AAAA,IAAI,CAAC,YACV,QAAQ,SAAS,YACf,oBAAC,QAA0B,EAAA,UAAA,QAAQ,MAAxB,GAAA,QAAQ,KAAsB,IAEzC,QAAQ;AAAA,EAGd,EAAA,CAAA;AAEJ;AClOA,MAAM,eAAe;AAAA,EACnB,SAAS;AAAA,EACT,OAAO;AAAA,EACP,MAAM;AACR,GAEM,eAAe;AAAA,EACnB,6BAAU,oBAAmB,EAAA;AAAA,EAC7B,2BAAQ,kBAAiB,EAAA;AAAA,EACzB,0BAAO,iBAAgB,EAAA;AACzB;AAEO,SAAS,WAAWvB,QAA4D;AACrF,QAAM,EAAC,UAAU,SAAS,WAAW,OAAO,GAAG,KAAQ,IAAAA;AAEvD,6BACG,MAAK,EAAA,QAAQ,GAAG,MAAM,aAAa,MAAM,GAAI,GAAG,MAAM,WAAQ,SAC7D,UAAA,oBAAC,QAAK,SAAS,GACZ,sBACE,oBAAA,KAAA,EAAI,MAAM,GACT,8BAAC,SAAQ,EAAA,MAAM,aAAa,MAAM,GAAG,OACnC,UAAA,oBAAC,KAAI,EAAA,YAAY,GAAG,WAAW,GAC5B,UACH,EACF,CAAA,EACF,CAAA,GAEJ,EACF,CAAA;AAEJ;AC5BO,SAAS,4BAA4B;AAAA,EAC1C;AAAA,EACA;AACF,GAGG;AACK,QAAA,EAAC,GAAAa,OAAK;AAEV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,OAAOA;AAAA,QACL,WAAW,OACP,gEACA;AAAA,MACN;AAAA,MACA,QAAO;AAAA,MACP,eAAY;AAAA,MAEZ,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,oBAACc,UAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAd;AAAA,YACA,SACE,WAAW,OACP,sEACA;AAAA,UAAA;AAAA,QAAA,GAGV;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,SAAS;AAAA,YACT,MAAK;AAAA,YACL,MAAMA,GAAE,+DAA+D;AAAA,YACvE,MAAK;AAAA,UAAA;AAAA,QACP;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAAA;AAGN;ACjDa,MAAAY,eAAa,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAuBxB,oBAAoB,WAAW,SAC1CzB,QACA,KACA;AACA,QAAM,EAAC,IAAI,YAAY,cAAc,GAAG,UAAa,IAAAA;AAgBnD,SAAA;AAAA,IAACyB;AAAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACH,GAba,cAChB,gBAAgB;AAAA;AAAA,QAEd,WAAW;AAAA;AAAA,QAEX,aAAa;AAAA,QACb;AAAA,QACA;AAAA,MACF;AAAA,MAME,WAAQ;AAAA,MACR;AAAA,IAAA;AAAA,EAAA;AAGN,CAAC;AC1CM,SAAS,qCAAqC;AAAA,EACnD;AAAA,EACA;AACF,GAGG;AACK,QAAA,EAAC,GAAAZ,OAAK;AAEV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,OAAOA,GAAE,uCAAuC;AAAA,MAChD,QAAO;AAAA,MACP,eAAY;AAAA,MAEZ,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,oBAACc,UAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UACH,aAAA,CAAA;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,SAAS;AAAA,YACT,MAAK;AAAA,YACL,MAAMd,GAAE,oDAAoD;AAAA,YAC5D,MAAK;AAAA,UAAA;AAAA,QACP;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAAA;AAGN;AC5BO,SAAS,oCAAoC;AAAA,EAClD;AAAA,EACA;AACF,GAGG;AACK,QAAA,WAAW,mBAAmB,SAAS,WAAW,QAClD,EAAC,GAAAA,OAAK;AAEV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,OAAOA,GAAE,0CAA0C;AAAA,MACnD,QAAO;AAAA,MACP,eAAY;AAAA,MAEZ,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,oBAACc,UAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAd;AAAA,YACA,SACE,mBAAmB,SACf,2DACA;AAAA,UAAA;AAAA,QAAA,GAGV;AAAA,4BAECc,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAAd;AAAA,UACC,aAAa,SACT,6DACA;AAAA,QAAA,GAER;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,SAAS;AAAA,YACT,MAAK;AAAA,YACL,MAAMA;AAAA,cACJ,aAAa,SACT,2DACA;AAAA,YACN;AAAA,YACA,MAAK;AAAA,UAAA;AAAA,QACP;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAAA;AAGN;ACtDA,MAAMnB,SAAO,MAAG;AAAA,GAEVkI,0BAAiD;AAAA,EACrD,WAAW;AAAA,EACX,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,OAAOlI;AACT,GAEMmI,gBAA6B;AAAA,EACjC,WAAW;AAAA,EACX,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,OAAOnI;AACT;AASgB,SAAAoI,mBACdtI,KACAuI,mBACyB;AAEnB,QAAA,aAAa,QAAQ,MAAM,IAAI,WAA4B,CAAA,CAAE,GAC7D,OAAO,QAAQ,MAAM,WAAW,gBAAgB,CAAC,UAAU,CAAC,GAE5D,QAAQ,YAAY,MAAM;AAC9B,eAAW,KAAK,EAAC,MAAM,QAAQ,CAAA;AAAA,EAC9B,GAAA,CAAC,UAAU,CAAC,GAET,gBAAgB;AAAA,IACpB,MACE,OAAO,GAAG,IAAI,GAAG,IAAI,EAAE;AAAA,MACrB,IAAI,MAAMvI,GAAE;AAAA,MACZ;AAAA,QAAU,CAAC,UACT,QACIuI,kBAAiB,KAAK,EAAE;AAAA,UACtB,IAAI,CAAC,YACI;AAAA,YACL,WAAW;AAAA,YACX;AAAA,YACA,OAAO;AAAA,YACP;AAAA,UAAA,EAEH;AAAA,UACD,UAAUH,uBAAqB;AAAA,UAC/B,WAAW,CAAC,SACV,QAAQ,MAAM,GAAG,GACV,GAAG,EAAC,WAAW,IAAO,QAAQ,QAAW,OAAO,KAAK,MAAe,CAAA,EAC5E;AAAA,QAAA,IAEH,GAAGC,aAAW;AAAA,MACpB;AAAA,IACF;AAAA,IACF,CAACE,mBAAkBvI,KAAI,MAAM,KAAK;AAAA,IAClCoI;AAAAA,EAMI,GAAA,aAAa,YAAYpI,KAAIA,GAAE;AACjC,SAAAA,OAAM,eAAeA,MAChBoI,0BAEF;AACT;AChEA,MAAM,mBAAmB,cAA4C,IAAI;AAOlE,SAAS,kBAAkB5H,QAG/B;AACK,QAAA,QAAQ,QAAQ,OAAO,EAAC,OAAOA,OAAM,MAAA,IAAS,CAACA,OAAM,KAAK,CAAC;AACjE,6BAAQ,iBAAiB,UAAjB,EAA0B,OAAe,iBAAM,SAAS,CAAA;AAClE;AAwBO,SAAS,aAAa,MAAqB;AAChD,QAAM,aAAa,QAAQ,IAAI,GACzB,MAAM,WAAW,gBAAgB;AACvC,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,sDAAsD;AAGjE,SAAA,eAAe,OAAK,OAAA,SAAA,IAAA,OAAO,UAAU;AAC9C;AChDA,MAAM,QAAQ,oBAAI,QAAmD,GAC/D,2BAA2B;AAAA,EAC/B,OAAO;AAAA,EACP,UAAU;AAAA,EACV,aAAa;AACf,GACM,eAAgE;AAAA,EACpE,KAAK,EAAC,QAAQ,GAAG,MAAM,SAAQ;AAAA,EAC/B,OAAO,EAAC,QAAQ,GAAG,MAAM,SAAQ;AACnC,GACM,qBAAqB,CAAC,aAAa,uBAAuB,GAE1DgI,iBAAe,CAAC,SACpB,OAAO,CAAC,MAAM,GAAGA,eAAa,KAAK,IAAI,CAAC,IAAI,IAExC,YAAY,CAAC,UACjB,QAAA,OAAA,SAAA,KAAM,cAAa,WACnB,KAAK,GAAG,KAAK,CAAC,YAAYA,eAAa,OAAO,EAAE,KAAK,CAAC,EAAC,KAAI,MAAM,SAAS,OAAO,CAAC,GAE9E,gBAAgB,CAAC,eACrBA,eAAa,UAAU,EAAE,KAAK,CAAC,SAAS,KAAK,SAAS,QAAQ,GAE1D,wBAAwB,CAAC,YAC7BzH,WAAS,OAAO,KAAK,YAAY,WAAWA,WAAS,QAAQ,MAAM;AAErE,SAAS,aAAa,OAAuE;AACpF,SAAA,OAAO,QAAU,OAAe,UAAU;AACnD;AAEA,SAAS,eACP,YACA,UACA,WACmC;AAC1B,WAAA0H,UACP,MACA,MACA,OACqB;AACrB,QAAI,CAAC;AAAM,aAAO;AAClB,QAAI,QAAQ;AAAU,aAAO;AAEvB,UAAA,YAAYD,eAAa,IAAI;AAEnC,QAAI,cAAc,IAAI,KAAK,UAAU,IAAI,GAAG;AACpC,YAAA,SAAS,UAAU,MAAM,IAAI;AAEnC,aAAI,OAAO,UAAW,WAAiB,CAAA,IAChC,CAAC,EAAC,MAAM,QAAQ,MAAM,UAAU,IAAI,IAAI,OAAO,SAAS,CAAA;AAAA,IACjE;AAEA,UAAM,UAA+B,CAAA,GAC/B,cAAc,UAAU;AAAA,MAC5B,CAACnH,OAAmD;AAjE1D,YAAAF;AAkEQ,eAAAE,GAAE,aAAa,YAAY,CAAC,GAACF,MAAEE,GAAA,WAAF,QAAUF,IAAA,WAAU,CAAC,mBAAmB,SAASE,GAAE,IAAI;AAAA,MAAA;AAAA,IAAA;AAExF,eAAW,cAAc;AACZ,iBAAA,SAAS,WAAW,QAAQ;AAC/B,cAAA,WAAW6B,SAAa,CAAC,MAAM,MAAM,IAAI,EAAE,OAAO,OAAO,CAAC;AACxD,gBAAA,KAAK,GAAGuF,UAAS,MAAM,MAAM,UAAU,QAAQ,CAAC,CAAC;AAAA,MAC3D;AAGF,UAAM,aAAa,UAAU;AAAA,MAC3B,CAACpH,OAAkD;AA5EzD,YAAAF;AA6EQ,eAAAE,GAAE,aAAa,WAAW,CAAC,GAACF,MAAAE,GAAE,OAAF,QAAMF,IAAA;AAAA,MAAA;AAAA,IAAA;AAEtC,eAAW,aAAa;AACX,iBAAA,iBAAiB,UAAU,IAAI;AAClC,cAAA,WAAW,GAAG,IAAI;AACxB,gBAAQ,KAAK,GAAGsH,UAAS,eAAe,UAAU,QAAQ,CAAC,CAAC;AAAA,MAC9D;AAGK,WAAA;AAAA,EACT;AAGA,SAAK,aAAa,UAAU,IAIrBA,UAAS,YAAY,IAAI,CAAC,EAAE;AAAA,IACjC,CAAC,KAAK,EAAC,MAAM,QAAQ,KAAI,OACvB,IAAI,IAAI,IAAI,EAAC,QAAQ,MAAM,QACpB;AAAA,IAET,CAAC;AAAA,MARM;AAUX;AAEA,MAAM,mBAAmB,CAAC,eAA2B;AAvGrD,MAAAtH;AAwGQ,QAAA,gBAAgBqH,eAAa,UAAU,EAC1C,IAAI,CAAC,SAAS,KAAK,OAAO,EAC1B,KAAK,qBAAqB;AAEtB,SAAA,SAAOrH,qDAAe,WAAf,OAAA,SAAAA,IAAuB,WAAW,WAAW,cAAc,OAAO,SAAS;AAC3F,GAEM,kBAAkB,CAAC,eACRqH,eAAa,UAAU,EAAE,KAAK,CAAC,SAAS,KAAK,MAAM,IAClD,IAAI,MAGhB,oBAAoB,CAAC,eAA2B;AApHtD,MAAArH;AAwHS,SAAA,SADQA,uBAAiB,UAAU,MAA3B,aAAgC,gBAAgB,UAAU,MAChD,WAAW,OAAO;AAC7C,GAEM,oBAAoB,CACxB,YACA,UACA,mBAC6C;AA/H/C,MAAAA;AAgIQ,QAAAuH,WAASvH,MAAY,cAAA,OAAA,SAAA,WAAA,YAAZ,OAAqB,SAAAA,IAAA;AACpC,MAAI,CAACuH;AAAe,WAAA;AAEpB,QAAM,+BAA+B,OAAO;AAAA,IAC1C,OAAO,QAAQA,OAAM,EAAE,IAAI,CAAC,CAAC,cAAc,aAAa,MAAM;AAAA;AAAA;AAAA,MAG5D,cAAc,QAAQ,UAAU,IAAI;AAAA,MACpC;AAAA,IAAA,CACD;AAAA,EAAA,GAGG,iBAAiB,eAAe,YAAY,UAAU,iBAAiB,GACvE,+BAA+B,OAAO;AAAA,IAC1C,OAAO,QAAQ,cAAc,EAC1B,IAAI,CAAC,CAAC,MAAM,EAAC,KAAA,CAAK,OAAO,EAAC,MAAM,KAAA,EAAM,EACtC,OAAO,CAAC,EAAC,KAAA,MAAU,6BAA6B,IAAI,CAAC,EACrD,IAAI,CAAC,EAAC,MAAM,WAAU;AAAA,MACrB;AAAA,MACA;AAAA,QACE;AAAA,QACA,QACE,yBACE,6BAA6B,IAAI,CACnC;AAAA,MACJ;AAAA,IAAA,CACD;AAAA,EAAA;AAGL,SAAI,iBACK,OAAO;AAAA,IACZ,OAAO,OAAO,4BAA4B,EAAE,IAAI,CAAC,SACxC;AAAA,MACL;AAAA,MACA;AAAA,QACE;AAAA,QACA,MAAM;AAAA,QACN,QAAQ,yBAAyB,IAA6C;AAAA,MAChF;AAAA,IAAA,CAEH;AAAA,MAIE,eAAe,YAAY,UAAU,CAAC,GAAG,SAAS;AACjD,UAAA,SAAS,6BAA6B,IAAI;AACzC,WAAA,SAAS,OAAO,SAAS;AAAA,EAAA,CACjC;AACH;AASO,SAAS,4BAA4B;AAAA,EAC1C;AAAA,EACA;AAAA,EACA;AAAA,EACA,eAAe,CAAC,UAAU;AAC5B,GAAmD;AAC3C,QAAA,SAAS,MAAM,IAAI,UAAU;AAC/B,MAAA;AAAe,WAAA;AAEb,QAAA,iBAAiB,eAAe,YAAY,UAAU,gBAAgB,GACtE,gBAAgB,eAAe,YAAY,UAAU,eAAe,GACpE,iBAAiB,eAAe,YAAY,UAAU,iBAAiB,GACvE,iBAAiB,kBAAkB,YAAY,UAAU,cAAc,GAEvE,UAA2D;AAAA,IAC/D,GAAG;AAAA,IACH,GAAG;AAAA,IACH,GAAG;AAAA,IACH,GAAG;AAAA,IACH,GAAG;AAAA,KAGC,SAAS;AAAA,IACb,UAAU,aAAa,UAAU,IAAI,WAAW,OAAO,WAAW;AAAA,IAClE,OAAO;AAAA,MACL,OAAO,QAAQ,OAAO,EAAE,IAAI,CAAC,CAAC,MAAM,EAAC,MAAM,OAAM,CAAC,OAAO;AAAA,QACvD;AAAA,QACA;AAAA,QACA,GAAI,SAAS,QAAQ,EAAC,SAAS,WAAU;AAAA,MAAA,EACzC;AAAA,IACJ;AAAA,EAAA;AAGI,SAAA,MAAA,IAAI,YAAY,MAAM,GACrB;AACT;ACxNA,MAAM,iBAAiB,CAAC,SACtB,GAAQ,KAAK,QAAQ,KAAK,KAAK,SAAS,aAEpC,gBAAgB,CAAC,SACrB,KAAK,KAAK,WAAW,SAAS,KAAK,KAAK,SAAS,2BAKtC,qBAAqB,CAAC,WACjC,OACG,aAAA,EACA,IAAI,CAAC,aAAa,OAAO,IAAI,QAAQ,CAAC,EACtC,OAAO9H,eAAa,EACpB,OAAO,cAAc,EACrB,OAAO,CAAC,SAAS,CAAC,cAAc,IAAI,CAAC,GCApC+H,kBAAgB;AAEtB,SAAS,qBACP,cACA,eACA;AACI,SAAA,OAAO,gBAAiB,WACnB;AAAA,IACL,OAAO;AAAA,IACP,OAAO;AAAA,EAAA,IAIJ;AAAA,IACL,GAAG;AAAA,IACH,OAAO,aAAa,MAAM,SAAS,aAAa,QAAQ;AAAA,EAAA;AAE5D;AAEA,SAAS,sBAAsB,OAAmC;AAChE,SAAO,MAAM,OAAO,CAAC,SAAS,KAAK,WAAW,CAAC;AACjD;AAEgB,SAAA,6BACd,eACA,aACqD;AAWrD,SAVc,YAAY,MACvB;AAAA,IAAI,CAAC,eACJ,4BAA4B;AAAA,MAC1B;AAAA,MACA,UAAU,cAAc,YAAY;AAAA,MACpC,cAAc;AAAA,IAAA,CACf;AAAA,EAAA,EAEF,OAAO,CAAC,EAAC,YAAW,MAAM,MAAM,EAEtB,OAA4D,CAAC,WAAW,UAC5E;AAAA,IACL,GAAG;AAAA,IACH,CAAC,KAAK,QAAQ,GAAG,KAAK,MAAM;AAAA,MAC1B,CAAC,UAAU,EAAC,MAAM,cACT;AAAA,QACL,GAAG;AAAA,QACH,SAAS;AAAA,UACP,GAAG,SAAS;AAAA,UACZ,CAAC,IAAI,GAAG;AAAA,QACV;AAAA,MAAA;AAAA,MAGJ,CAAC;AAAA,IACH;AAAA,EAAA,IAED,CAAE,CAAA;AACP;AAEgB,SAAA,SAAS,OAAqB,IAAuB;AACnE,SAAO,KAAK;AAAA,IACV,CAAC,EAAC,OAAO,iBAAgB;AAAA,MACvB,WAAW;AAAA,MACX;AAAA,IAAA;AAAA,IAEF,CAAC;AAAA,EAAA;AAEL;AAKa,MAAA,mBAA6D,CACxE,kBACA,QACA,mBAIO,SAAgB,cAAc,gBAAgB,IAAI;AA/F3D,MAAAxH;AAgGI,QAAM,cAAc,qBAAqB,cAAc,gBAAgB,GAGjE,UAAU;AAAA,IACd;AAAA,IACA,cAAc,kBAAkB,MAAS;AAAA,IACzC,eAAe,SAAS,IAAI,eAAe,MAAM,MAAM;AAAA,IACvD,YAAY,SAAS,IAAI,YAAY,MAAM,MAAM;AAAA,EAAA,EACjD,OAAO,CAAC,eAAqC,CAAQ,CAAA,UAAW,GAE5D,mBAAqC;AAAA,IACzC,OAAO,EAAC,QAAQ,YAAY,MAAK;AAAA,IACjC,QAAQ,QAAQ,KAAK,MAAM;AAAA,IAC3B,QAAQ;AAAA,MACN,SAAS,YAAY,MAAM,IAAI,CAAC,SAAU,UAAU,OAAO,KAAK,OAAO,KAAK,IAAK;AAAA,MACjF,GAAG,eAAe;AAAA,MAClB,GAAG,YAAY;AAAA,IACjB;AAAA,IACA,OAAO,6BAA6B,eAAe,WAAW;AAAA,IAC9D,OAAO,SAAS,cAAc,IAAI;AAAA,IAClC,mBAAmB,CAAC,OAAO,OAAO;AAAA,IAClC,YAAY,cAAc;AAAA,IAC1B,QAAOA,MAAc,cAAA,UAAd,OAAuBA,MAAAwH;AAAAA,EAAA;AAGzB,SAAA,OAAO,WACX,QAAgD;AAAA,IAC/C,KAAK,oBAAoB,OAAO,SAAS,OAAO;AAAA,IAChD,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,MAAM;AAAA,IACN,KAAK,eAAe;AAAA,EACrB,CAAA,EACA;AAAA,IACC,IAAI,CAAC,aAAa;AAChB,UAAI,YAAY,SAAS,KAAK,IAAI,CAAC,QAAQ,IAAI,UAAU;AACzD,aAAI,eAAe,WACjB,YAAY,YAAY,SAAS,IAG5B;AAAA,QACL,MAAM;AAAA,QACN,MAAM,UAAU,IAAI,CAAC,SAAS,EAAC,MAAK;AAAA,QACpC,YAAY,SAAS;AAAA,MAAA;AAAA,IACvB,CACD;AAAA,EAAA;AAEP,GCnIW,iBAAiB,CAAC,aAAuB,UAA+B;AAE7E,QAAA,EAAC,SAAS,qBAAqB,OAAO,kBAC1C,IAAA,gCAAgC,WAAW,GAGvC,CAAC,aAAa,SAAS,IAAI,qBAAqB,qBAAqB,KAAK,GAC1E,CAAC,WAAW,OAAO,IAAI,mBAAmB,mBAAmB,KAAK;AACjE,SAAA,CAAC,cAAc,WAAW,CAAC,SAAS,SAAS,EAAE,KAAK,IAAI,CAAC;AAClE,GAEM,YAAY,CAAC,UACjB,OAAO,SAAU,WAAW,QAAQ,KAAK,UAAU,KAAK;AAKnD,SAAS,aACd,YACA,MACA,QAAkB,CAAA,GACH;AACf,QAAM,aAAa,MAAM,YAAY,CAAC,SAAS,KAAK,QAAQ;AAC5D,SAAO,KAAK,IAAI,CAAC,KAAK,UAAU;AAnClC,QAAAxH;AAqCI,UAAM,WAAWA,MADA,WAAW,IAAI,KAAK,EACX,SAAS,CAAlB,MAAA,OAAA,SAAAA,IAAuB,IAAI,CAAC,UAAU,QAAQ;AAC7D,YAAM,QAAQ,UAAU,IAAI,IAAI,GAAG,EAAE,CAAC;AACtC,UAAI,CAAC;AACH,eAAO,EAAC,MAAM,SAAS,MAAM,OAAO,GAAG,KAAK;AAE9C,YAAM,CAAC,OAAO,GAAG,IAAI,eAAe,OAAO,KAAK;AACzC,aAAA;AAAA,QACL,MAAM,SAAS;AAAA,QACf,OAAO,QAAQ,SAAS;AAAA,QACxB,KAAK,GAAG,GAAG,MAAM,SAAS,MAAM;AAAA,MAAA;AAAA,IAEpC,CAAA,GAEM,aAAa,QAAQ,OAAO,CAAC,KAAK,SAAS,MAAM,KAAK,OAAO,CAAC;AAE7D,WAAA,EAAC,KAAK,aAAa,KAAK,SAAS,OAAO,OAAO,YAAY;EAAgB,CACnF;AACH;AAWgB,SAAA,qBAAqB,qBAA+B,OAA4B;AAC9F,QAAM,iBAAiB,MAAM,YAAY,EAAE,KAAK;AAE5C,MAAA,aAAa,GACb,aAAa;AACG,SAAA,oBAAA,QAAQ,CAAC,SAAS;AAChC,mBAAe,SAAS,IAAI,MAC9B,cAAc,KAAK,SAAS,eAAe,QAC3C,cAAc,KAAK;AAAA,EAAA,CAEtB,GAEM,eAAe,IAClB,CAAC,GAAG,sBAAsB,IAC1B,CAAC,aAAa,GAAG,oBAAoB,UAAU,OAAO,eAAe,MAAM,aAAa;AAC9F;AAWgB,SAAA,mBAAmB,mBAA6B,OAA4B;AACpF,QAAA,mBAAmB,KAAK,QAAQ,MAAM,QAAQ,KAAK,CAAC,CAAC,CAAC,GAEtD,UAAU,aAAa,mBAAmB,gBAAgB,GAC1D,MAAM,MAAM,kBAAkB,iBAAiB,GAC/C,aAAa,QAAQ,SAAS,IAAI;AACxC,SAAO,eAAe,IAClB,CAAC,GAAG,oBAAoB,IACxB;AAAA,IACE,aAAa;AAAA,IACb,kBAAkB,QAAQ,MAAM,OAAO,IAAI,MAAM,YAAY,QAAQ,KAAK,IAAI,CAAC;AAAA,EAAA;AAEvF;AAKO,SAAS,gCAAgC,aAG9C;AACA,QAAM,oBAAoB,KAAK,YAAY,IAAI,OAAO,CAAC,GAEjD,CAAC,eAAe,WAAW,IAAI,UAAU,mBAAmB,CAAC,SAAS,SAAS,KAAK,IAAI,CAAC;AACxF,SAAA;AAAA,IACL,SAAS,KAAK,aAAa,EAAE,IAAI,OAAO,EAAE,IAAI,mBAAmB;AAAA;AAAA,IACjE,OAAO,KAAK,YAAY,IAAI,OAAO,CAAC;AAAA,EAAA;AAExC;AAEA,SAAS,oBAAoB,KAAa;AACjC,SAAA,IAAI,QAAQ,YAAY,IAAI;AACrC;AC1HO,MAAM,kBAAkB,GC4BlB,gBAAgB,KAEvB,eAAgD,KAAK,CAAC6C,WAAS,OAAO,OAAO,CAAC,GAE9E,iBAAiB,CAAC,EAAC,SAAS,WAChC,UAAU,GAAG,OAAO,IAAI,IAAI,MAAM;AAMpC,SAAS,kBAAkB,OAAiB,OAAqB;AAC/D,QAAM,sBAAsB;AAAA,IAC1B,MAAM,IAAI,CAAC,mBAAmB,cAAc,SAAS,IAAI,IAAI,CAAC,QAAQ,eAAe,GAAG,CAAC,CAAC;AAAA,EAAA;AAO5F,SAJoB,MACjB,IAAI,CAAC,OAAO,MAAM,oBAAoB,IAAI,CAAC,eAAe,GAAG,UAAU,YAAY,CAAC,EAAE,CAAC,EACvF,OAAO,CAAC,eAAe,WAAW,SAAS,CAAC,EAE5B,IAAI,CAAC,eAAe,IAAI,WAAW,KAAK,MAAM,CAAC,GAAG;AACvE;AAEA,MAAM,gBAAgB,yCAChB,mBAAmB;AAElB,SAAS,SAAS,QAA0B;AACjD,UAAQ,OAAO,MAAM,aAAa,KAAK,CAAA,GAAI,IAAI,CAAC,UAAU,MAAM,QAAQ,kBAAkB,EAAE,CAAC;AAC/F;AAaO,SAAS,sBAAsB,OAAyB;AAC7D,QAAM,gBAAgB,CAAA,GAChB,gBAAgB,MAAM,QAAQ,cAAc,CAAC,UAC7C,MAAM,KAAK,EAAE,SAAS,KACxB,cAAc,KAAK,KAAK,GACjB,MAEF,KACR,GAGK,cAAc,cAAc,IAAI,CAAC,QAAQ,KAAK,QAAQ,GAAG,CAAC,CAAC,GAO3D,iBAAiB,KAAK,QAAQ,SAAS,QAAQ,aAAa,CAAC,CAAC,CAAC;AAErE,SAAO,CAAC,GAAG,aAAa,GAAG,cAAc;AAC3C;AAEA,SAAS,cAAc4E,UAA+B;AACpD,WAAS,gBAAgB,UAA8B;AAC9C,WAAA,SAAS,UAAU,GAAG,SAAS,OAAO,IAAI,SAAS,KAAK,MAAM,SAAS;AAAA,EAChF;AAEQ,UAAAA,YAAW,CAAA,GAChB;AAAA,IAAI,CAAC,aACJ,CAAC,gBAAgB,QAAQ,IAAI,SAAS,aAAa,IAAI,YAAa,CAAA,EACjE,IAAI,CAAC,QAAQ,IAAI,KAAM,CAAA,EACvB,OAAO,OAAO,EACd,KAAK,GAAG;AAAA,EAAA,EAEZ,KAAK,GAAG;AACb;AAKO,SAAS,kBACd,aACA,aAAmD,IACtC;AAlHf,MAAAzH;AAmHQ,QAAA,EAAC,QAAA0H,SAAQ,QAAQ,IAAA,IAAO,YAExB,QAAQ,YAAY,MACvB;AAAA,IAAI,CAAC,eACJ,4BAA4B;AAAA,MAC1B;AAAA,MACA,UAAU,WAAW,YAAY;AAAA,MACjC,gBAAgB,WAAW;AAAA,IAAA,CAC5B;AAAA,EAEF,EAAA,OAAO,CAAC,EAAC,YAAW,MAAM,MAAM,GAG7B,QAAQ,sBAAsB,YAAY,KAAK,GAG/C,UAAU;AAAA,IACd;AAAA,IACA,WAAW,kBAAkB,MAAS;AAAA,IACtC,GAAG,kBAAkB,OAAO,KAAK;AAAA,IACjCA,UAAS,IAAIA,OAAM,MAAM;AAAA,IACzB,YAAY,SAAS,IAAI,YAAY,MAAM,MAAM;AAAA,EAAA,EACjD,OAAO,OAAO,GAEV,aAAa,MAAM,IAAI,CAAC,SAAS;AAC/B,UAAA,aAAa,aAAa,KAAK,QAAQ,SACvCC,aAAY,KAAK,KAAK,MAAM,IAAI,CAAC,KAAK,MAAM,KAAK,CAAC,MAAM,eAAe,GAAG,CAAC,EAAE,CAAC;AAC7E,WAAA,GAAG,UAAU,GAAGA,UAAS;AAAA,EACjC,CAAA,GAGK,YAAY,eAAc,cAAA,OAAA,SAAA,WAAY,SAAQ,CAAC,EAAC,OAAO,OAAO,WAAW,OAAM,CAAC,GAEhF,mBAAmB,CAAC,SAAS,KAAK,GAClC,YAAY,WAAW,SAAS,IAAI,aAAa,WAAW,KAAK;AAAA,CAAK,CAAC,MAAM,IAC7E,kBAAkB,iBAAiB,KAAK,IAAI,KAAK,YAAY,KAAK,SAAS,KAAK;AAElF,MAAA,QACF,KAAK,QAAQ,KAAK,MAAM,CAAC,YACd,SAAS,mBAEhB,eAAe;AAKrB,MAAI,iCAAY,+BAA+B;AACvC,UAAA,qBAAqB,yCAAY,+BACjC,kBAAkB,iBAAiB,OAAO,kBAAkB,EAAE,KAAK,IAAI;AAErE,YAAA;AAAA,MACN,KAAK,QAAQ,KAAK,MAAM,CAAC,KAAK,eAAe;AAAA,MAC7C,SAAS,SAAS,mBAAmB,eAAe;AAAA,IAAA,EACpD,KAAK,GAAG;AAAA,EACZ;AAGA,QAAM,eAAe,CAAC,mBAAmB,eAAe,EAAE,EACvD,QAAO,cAAY,OAAA,SAAA,WAAA,aAAY,CAAE,CAAA,EACjC,IAAI,CAAC,MAAM,MAAM,CAAC,EAAE,EACpB,KAAK;AAAA,CAAI,GACN,eAAe,eAAe,GAAG,YAAY;AAAA,EAAK,KAAK,KAAK,OAE5D,SAAQ3H,MAAA,cAAA,OAAA,SAAA,WAAY,UAAZ,OAAqBA,MAAA;AAE5B,SAAA;AAAA,IACL,OAAO;AAAA,IACP,QAAQ;AAAA,MACN,GAAG,aAAa,KAAK;AAAA,MACrB,SAAS,MAAM,IAAI,CAAC,SAAS,KAAK,QAAQ;AAAA,MAC1C,SAAS;AAAA,MACT,GAAI,UAAU,CAAC;AAAA,IACjB;AAAA,IACA,SAAS,EAAC,IAAG;AAAA,IACb,YAAY;AAAA,IACZ;AAAA,EAAA;AAEJ;AAEA,MAAM,eAAe,CAAC,UAA4C;AAChE,QAAM,SAAiC,CAAA;AACvC,SAAO,MAAM,OAAO,CAAC,KAAK,MAAM,OAC9B,IAAI,IAAI,CAAC,EAAE,IAAI,GAAG,IAAI,KACf,MACN,MAAM;AACX;AC/LA,SAAS,eACP,cACA,OACA;AACI,SAAA,OAAO,gBAAiB,WACnB;AAAA,IACL,OAAO;AAAA,IACP;AAAA,EAAA,IAGG,aAAa,MAAM,SAAS,eAAe,EAAC,GAAG,cAAc;AACtE;AAKa,MAAA,uBAAqE,CAChF,OACA,QACA,mBAIO,SAAgB,cAAc,gBAAgB,IAAI;AACvD,QAAM,cAAc,eAAe,cAAc,KAAK,GAEhD,EAAC,OAAO,QAAQ,SAAS,YAAY,MAAK,IAAI,kBAAkB,aAAa;AAAA,IACjF,GAAG;AAAA,IACH,GAAG;AAAA,EAAA,CACJ;AAED,SAAO,OAAO,WAAW,MAA4B,OAAO,QAAQ,OAAO,EAAE;AAAA,IAC3E,eAAe,SAAS,IAAI,WAAW,IAAI,IAAI;AAAA;AAAA;AAAA,IAG/C,IAAI,CAAC,SAAS,aAAa,YAAY,MAAM,KAAK,CAAC;AAAA;AAAA;AAAA,IAGnD,iBAAe,QAAA,cAAA,kBAAkB,IAAI,IAAI,IAAI,CAAC,SAAS,OAAO,MAAM,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC;AAAA,IACxF,IAAI,CAAC,UAAU,EAAC,MAAM,YAAY,OAAM;AAAA,EAAA;AAE5C,GCzCW,eAAiF,CAC5F,iBACA,QACA,aAEgB,QAAQ,2BAA2B,mBAAmB,sBACvD,iBAAiB,QAAQ,OAAO,GCJ3C,WAAW;AAAA,EACf,WAAW;AAAA,EACX,QAAQ;AACV,GAEM,oBAAoB;AAAA,EACxB,WAAW;AAAA,EACX,QAAQ;AACV,GAEM,YAAY;AAAA,EAChB,WAAW;AAAA,EACX,QAAQ;AACV;AAKgB,SAAA,iBACd,sBACAnB,KACA,eAC2B;AAC3B,QAAM,EAAC,aAAa,QAAO,IAAI,UAAUA,GAAE;AAEjB,SAAA,qBAAqB,yCAAyCA,GAAE,EAEjE;AAAA,IACvB,UAAU,CAAC,qBAAqB;AAC9B,UAAI,CAAC,iBAAiB,MAAM,aAAa,CAAC,iBAAiB,UAAU,WAAW;AAExE,cAAA,eACJ,iBAAiB,MAAM,WAAW,uBAClC,iBAAiB,UAAU,WAAW,sBAClC,oBACA;AAGN,eAAO,GAAG;AAAA,UACR,IAAAA;AAAA,UACA,MAAM;AAAA,UACN;AAAA,UACA,SAAS;AAAA,YACP,OAAO;AAAA,YACP,WAAW;AAAA,UACb;AAAA,QAAA,CACQ;AAAA,MACZ;AAEA,YAAM,WAAW,EAAC,OAAO,aAAa,MAAM,QAAA,GACtC,eAAe,EAAC,OAAO,aAAa,MAAM,YAAW;AAU3D,aARkB,cAAc;AAAA,QAC9B,qBAAqB,0BAA0B,OAAO;AAAA,QACtD,qBAAqB,0BAA0B,WAAW;AAAA,MAC3D,CAAA,EAAE;AAAA;AAAA,QAED,IAAI,CAAC,CAAC,eAAe,iBAAiB,MAAM,iBAAiB,iBAAiB;AAAA,MAAA,EAG/D;AAAA,QACf,UAAU,CAAC,aAAa;AACtB,cAAI,CAAC;AAKH,mBAAO,GAAG;AAAA,cACR,IAAAA;AAAA,cACA,MAAM;AAAA,cACN,cAAc,EAAC,WAAW,IAAM,QAAQ,WAAU;AAAA,cAClD,SAAS;AAAA,gBACP,OAAO;AAAA,gBACP,WAAW;AAAA,cACb;AAAA,YAAA,CACQ;AAIN,gBAAA,gBAAgB,cAAc,GAAG,KAAK,CAAC,eAAe,WAAW,SAAS,QAAQ;AAExF,cAAI,CAAC;AACH,mBAAO,GAAG;AAAA,cACR,IAAAA;AAAA,cACA,MAAM;AAAA,cACN,cAAc,EAAC,WAAW,IAAM,QAAQ,WAAU;AAAA,cAClD,SAAS;AAAA,gBACP,OAAO;AAAA,gBACP,WAAW;AAAA,cACb;AAAA,YAAA,CACQ;AAGZ,gBAAM,eAAe,gBAAgB,iBAAe,OAAA,SAAA,cAAA,OAAO,KAAK,CAE1D,GAAA,gBAAgB,qBAAqB,aAAa,UAAU,YAAY,EAAE;AAAA,YAC9E;AAAA,cAAI,CAAC,WACH,SACI;AAAA,gBACE,KAAK;AAAA,gBACL,GAAG,kBAAkB,QAAQ,aAAa;AAAA,cAE5C,IAAA;AAAA,YACN;AAAA,YACA,UAAU,MAAS;AAAA,UAAA,GAGf,oBAAoB,qBACvB,aAAa,cAAc,YAAY,EACvC;AAAA,YACC;AAAA,cAAI,CAAC,WACH,SACI;AAAA,gBACE,KAAK;AAAA,gBACL,GAAG,kBAAkB,QAAQ,aAAa;AAAA,cAE5C,IAAA;AAAA,YACN;AAAA,YACA,UAAU,MAAS;AAAA,UAAA;AAOvB,iBAJe,cAAc,CAAC,eAAe,iBAAiB,CAAC,EAAE;AAAA,YAC/D,IAAI,CAAC,CAAC,OAAO,SAAS,OAAO,EAAC,OAAO,UAAA,EAAW;AAAA,UAAA,EAGpC;AAAA,YACZ,IAAI,CAAC,UAAyB;AACtB,oBAAA;AAAA;AAAA,gBAEJ,iBAAiB,MAAM,aAAa,iBAAiB,UAAU,YAC3D,WACA,iBAAiB,MAAM,WAAW,uBAChC,iBAAiB,UAAU,WAAW,sBACtC,oBACA;AAAA;AAED,qBAAA;AAAA,gBACL,MAAM;AAAA,gBACN,IAAI;AAAA,gBACJ;AAAA,gBACA,SAAS;AAAA,kBACP,OAAOe,WAAS,MAAM,KAAK,IAAI,MAAM,QAAQ;AAAA,kBAC7C,WAAWA,WAAS,MAAM,SAAS,IAAI,MAAM,YAAY;AAAA,gBAC3D;AAAA,cAAA;AAAA,YACF,CACD;AAAA,UAAA;AAAA,QACH,CACD;AAAA,MAAA;AAAA,IACH,CACD;AAAA,EAAA;AAEL;AAQA,SAAS,kBAAkB,cAAuC;AAChE,SAAO,aACJ;AAAA,IACC,CAAC;AAAA;AAAA,MAEC,CAAC,YAAY,SAAS,CAAC,YAAY;AAAA;AAAA,EAAA,EAEtC;AAAA,IAAI,CAAC;AAAA;AAAA,MAEJ,YAAY,QAAQ,YAAY,KAAK,WAAW,YAAY,EAAE;AAAA;AAAA,EAAA;AAEpE;AAEA,SAAS,wBAAwB,QAAsB,KAAe;AACpE,SAAO,IAAI,WAAW,IAClB,GAAG,CAAA,CAAE,IACL,OAAO,WAAW,MAAM,sBAAsB,EAAC,IAAA,GAAM,EAAC,KAAK,uBAAsB;AACvF;AAEO,SAAS,gBACd,QACA,UACA,MACA,SACA,0BACkC;AACnB,SAAA,aAAa,KAAK,IAAI,QAAQ;AAAA,IAC3C,GAAG;AAAA,IACH;AAAA,IACA,UAAU,QAAQ,iBAAiB;AAAA,EAAA,CACpC,EACa,UAAU,EAAC,eAAe,GAAA,CAAK,EAAE;AAAA,IAC7C,IAAI,CAAC,EAAC,KAAA,MAAU,KAAK,IAAI,CAAC,EAAC,UAAS,GAAG,CAAC;AAAA,IACxC,IAAI,OAAO;AAAA;AAAA,IAEX,IAAI,CAAC,aAAa,SAAS,MAAM,GAAG,GAAG,CAAC;AAAA,IACxC,SAAS,CAAC,aAUD,wBAAwB,QAAQ,kBAAkB,QAAQ,CAAC,EAAE;AAAA,MAClE,IAAI,CAAC,2BACI,SAAS,IAAI,CAAC,UAAU;AACvB,cAAA,UAAU,WAAW,MAAM,EAAE;AAC5B,eAAA;AAAA,UACL,IAAI,MAAM;AAAA,UACV,MAAM,MAAM;AAAA,UACZ,OACE,MAAM,SAAS,uBAAuB,SAAS,OAAO,IAClD,EAAC,KAAK,SAAS,OAAO,MAAM,SAC5B;AAAA,UACN,WACE,MAAM,aAAa,uBAAuB,SAAS,MAAM,EAAE,IACvD,EAAC,KAAK,MAAM,IAAI,OAAO,MAAM,KAC7B,IAAA;AAAA,QAAA;AAAA,MACR,CACD,CACF;AAAA,IAAA,CAEJ;AAAA,EAAA;AAEL;ACzNA,SAASgI,cAAe,OAAwB;AACxC,QAAA,MAAM,OAAO,KAAK;AACxB,SAAA,IAAI,UAAU,OACP;AACT;AAQO,SAAS,kBAAkB,SAAkB;AAhCpD,MAAA5H,KAAA,IAAA,IAAA;AAiCE,QAAM,EAAC,MAAM,WAAU,IAAI,SACrB,SAAS,aACT,uBAAuB,wBACvB,GAAA,EAAC,4BAA4B,iBAAiB,YAAY,0BAAyB,IACvF,yBAAyB,GAErB,gBAAgB,aAAa,CAAE,CAAA,GAG/B,oBAAmBA,MAFL4H,cAAY,aAAa,EAER,YAAZ,OAAA,SAAA5H,IAAqB,OAExC,4BAA4B,QAAQ,MAAM;AA5ClDA,QAAAA;AA6CI,YAAOA,OAAA,OAAO,IAAI,gBAAgB,MAA3B,gBAAAA,KAA8B;AAAA,EAAA,GACpC,CAAC,kBAAkB,MAAM,CAAC,GAEvB,eAAa,KAAW,WAAA,YAAX,mBAAoB,gBAAe,IAEhD,YAAW,MAAQ,KAAA,QAAA,UAAR,mBAAe,yBAAf,OAAA,SAAA,GAAqC,UAChD,oBAAoB;AAAA,IACxB,MACE,WAAW,SACT,QACA,cACA;AACA,aAAO,6BACL;AAAA,QAAC;AAAA,QAAA;AAAA,UACE,GAAG;AAAA,UACJ,KAAK;AAAA,UACL,eAAe;AAAA,UACf;AAAA,QAAA;AAAA,MAEA,IAAA;AAAA,IAAA,CACL;AAAA,IACH,CAAC,4BAA4B,MAAM,QAAQ;AAAA,KAGvC,sBAAsB;AAAA,IAC1B,CAAC,UAA8B;AACX,yBAAA,QAAA,gBAAA;AAAA,QAChB,eAAe;AAAA,QACf,IAAI,MAAM;AAAA,QACV,MAAM,MAAM;AAAA,QACZ,UAAU,MAAM;AAAA,MAAA,CAClB;AAAA,IACF;AAAA,IACA,CAAC,iBAAiB,IAAI;AAAA,EAAA,GAGlB,gBAAgB,UAAU,WAAW,OAAM,cAAA,OAAA,SAAA,WAAY,SAAQ,CAAE,CAAA,IACnE,cAAY,OAAA,SAAA,WAAA,QACZ,QAEE,gBAAgB,QAAQ,MACxB,aACK,CAGN,KAAA,6BAA6B,CAAC,GAE5B,OAAO,CAAC,MAAM,WAAW,GAAG,KAAK,CAAC,YAAS;AA5FpDA,QAAAA;AA4FuD,WAAA,QAAQ,WAASA,OAAA,EAAE,aAAF,gBAAAA,KAAY;AAAA,EAAU,CAAA,CAAC,EACtF;AAAA,IAAI,CAAC,SAAM;AA7FpBA,UAAAA;AA8FU,cAAAA,OAAA,KAAK,aAAL,QAAAA,KAAe,aACX;AAAA,QACE,IAAI,KAAK;AAAA,QACT,OACE,KAAK,SAAS,GAAG,KAAK,SAAS,UAAU,kBAAkB,KAAK,SAAS,EAAE;AAAA,QAC7E,MAAM,KAAK,SAAS;AAAA,QACpB,MAAM,KAAK;AAAA,QACX,UAAU;AAAA,UACR,IAAI,KAAK,SAAS;AAAA,UAClB,QAAQ,KAAK;AAAA,QACf;AAAA,QAEA,YAAY,EAAC,SAAS,KAAK,SAAS,QAAQ,KAAK,OAAM;AAAA,MAEzD,IAAA;AAAA,IAAA;AAAA,EAAA,EAEL,OAAOP,eAAa,GAExB,CAAC,YAAY,2BAA2B,WAAW,EAAE,CAAC,GAEnD2H,qBAAmB;AAAA,IACvB,CAACvI,QAAegJ,iBAAyB,sBAAsBhJ,KAAI,UAAU;AAAA,IAC7E,CAAC,sBAAsB,UAAU;AAAA,EAAA;AAG5B,SAAA;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IAAA,kBACAuI;AAAAA,EAAA;AAEJ;ACzFA,SAASU,UAAQ;AAAA,EACf;AAAA,EACA;AAAA,EACA;AACF,GAIa;AACX,SAAI,WACK,gBAEL,YACK,aAEF,cAAc,YAAY;AACnC;AACA,MAAMC,uBAAqB,EAAC,QAAQ,IAAM,MAAM,UAAS;AAElD,SAAS,eAAe1I,QAA4B;AAzD3D,MAAAW,KAAA,IAAA,IAAA,IAAA,IAAA;AA0DQ,QAAA,aAAa,OAA8B,IAAI,GAC/C,EAAC,YAAY,MAAM,MAAM,SAAS,UAAU,WAAU,IAAIX,QAC1D,EAAC,UAAU,SAAS,eAAe,aAAYA,OAAM,YAErD,CAAC,mBAAmB,mBAAmB,IAAI,SAAoC,EAAE,GACjF,aAAa,kBAEb,cAAc,YAAY,MAAM,WAAW,SAAS,OAAO,GAAG,CAAC,UAAU,CAAC,GAC1E,QAA+BA,OAAM,OAErC,EAAC,mBAAmB,kBAAA+H,mBAAkB,eAAe,0BAAyB,IAClF,kBAAkB;AAAA,IAChB;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAGH,iCAA+B,YAAY,IAAI,GAE/C,aAAa,SAAS,CAAC,UAAU,aAAa;AACxC,KAAC,YAAY,YAAY,WAAW,WAEtC,WAAW,QAAQ;EAAM,CAE5B;AAED,QAAM,YAAY/H,OAAM,WAAW,KAAK,CAAC,MAAM,EAAE,UAAU,OAAO,GAC5D,cAAcA,OAAM,WAAW,KAAK,CAAC,MAAM,EAAE,UAAU,SAAS,GAEhE,wBAAwB8H,mBAAiB,+BAAO,MAAMC,iBAAgB,GAEtE,gBAAcpH,MAAsB,sBAAA,WAAtB,OAA8B,SAAAA,IAAA,WAAQ,oCAAO,yBAAP,OAAA,SAAA,GAA6B,OAEjF,UAAU,cACZ,WAAW,GAAG,KAAK,CAAC,WAAW,OAAO,SAAS,WAAW,IAC1D,QACE,UAAU,kBAAkB,WAC5B,WAAW,kBAAkB,YAE7B,SAAS,SAAO,OAAA,SAAA,MAAA,MAChB,2BAA2B,YAAU,uCAAsB,WAAtB,OAAA,SAAA,GAA8B,YAA9B,OAAA,SAAA,GAAuC,cAAvC,OAAA,SAAA,GAAkD,MAEvF,kCAAkC,YAAY,MAAM;AAC/C,aAAA;AAAA,MACP,WAAW,SAAS,KAAO,IAAI,IAAM,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC;AAAA,MACjE,MAAM,CAAC,sBAAsB,CAAC;AAAA,IAAA,CAC/B;AAAA,EAAA,GACA,CAAC,UAAU,WAAW,IAAI,CAAC,GAExB,4BAA4B,YAAY,MAAM;AAClD,aAAS,WAAW,SAAS,KAAO,IAAI,IAAM,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC;AAAA,EAAA,GAC1E,CAAC,UAAU,UAAU,CAAC,GAEnB,gBAAgB,YAAY,MAAM;AAC3B,eAAA,YAAY,CAAC,MAAM,CAAC;AAAA,EAAA,GAC9B,CAAC,UAAU,CAAC,GAET,iBAAiB,SAAO,QAAA,MAAA,QAAQ,SAAS,UACzC,eAAe,WAAW,SAAS,KAAO,SAAS,UAKnD,sBACJ,UAAU,CAAC,sBAAsB,cAAa,SAAA,OAAA,SAAA,MAAO,uBAEjD,sBACJ,CAAC,sBAAsB,eACvB,KAAA,sBAAsB,WAAtB,OAAA,SAAA,GAA8B,aAAa,cAC3C,UACA,mBAAmB,gBACnB,CAAC,qBAEG,OAAO8H,UAAQ,EAAC,UAAU,WAAW,YAAY,CAAA,GACjD,YAAY,EAAC,SAAA,QAAA,MAAO,SAAQ,WAAW,UAAU,CAAC,MAAM,QAExD,EAAC,GAAA5H,GAAA,IAAK,kBAEN,SAED,qBAAA,UAAA,EAAA,UAAA;AAAA,IAA6B,6BAAA,4BAA4B,MAAM,wBAC9D;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,IAED,uBACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,IAED,sBAAsB,SACrB;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAc,sBAAsB,MAAM;AAAA,QAC1C,eAAe,sBAAsB;AAAA,MAAA;AAAA,IACvC;AAAA,EAAA,EAEJ,CAAA,GAGI,WAAW;AAAA,IACf;AAAA;AAAA,MAEE,WAAW,SACT,WACA,MACA;AAEE,eAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACE,GAAG;AAAA,YACJ,QAAO;AAAA,YACP,QAAQ,EAAC,IAAI,+BAAO,MAAM,MAAM,mCAAS,KAAI;AAAA,YAC7C,QAAO;AAAA,YACP,KAAI;AAAA,YACJ,KAAK;AAAA,UAAA;AAAA,QAAA;AAAA,MACP,CAEH;AAAA;AAAA,IACH,CAAC,WAAA,OAAA,SAAA,QAAS,MAAM,SAAA,OAAA,SAAA,MAAO,IAAI;AAAA,KAGvB,OAAO;AAAA,IACX,MACE,WAAW,OACR,oBAAA,KAAA,EAAI,MAAK,QACR,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ,oBAAC,mBAAkB,EAAA,UAAU,EAAG,CAAA;AAAA,QACxC,IAAI,GAAG,OAAO;AAAA,QACd,2BACG,MACE,EAAA,UAAA;AAAA,UAAA,CAAC,YAEE,qBAAA,UAAA,EAAA,UAAA;AAAA,YAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAMA,GAAE,+BAA+B;AAAA,gBACvC,MAAK;AAAA,gBACL,MAAM;AAAA,gBACN,SAAS;AAAA,cAAA;AAAA,YACX;AAAA,YACA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAMA,GAAE,iCAAiC;AAAA,gBACzC,MAAM8H;AAAAA,gBACN,SAAS;AAAA,cAAA;AAAA,YACX;AAAA,UAAA,GACF;AAAA,UAGD,CAAC,aAAY,SAAO,OAAA,SAAA,MAAA,6BAAS,aAAY,EAAA;AAAA,WACzC,+BAAO,SACN;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,IAAI;AAAA,cACJ,WAAQ;AAAA,cACR,MAAM9H,GAAE,yCAAyC;AAAA,cACjD,MAAM+H;AAAAA,YAAA;AAAA,UACR;AAAA,QAAA,GAEJ;AAAA,QAEF,SAASF;AAAAA,MAAA;AAAA,IAAA,GAEb;AAAA,IAEJ,CAAC,aAAa,eAAe,SAAS,UAAU,UAAU7H,IAAG,+BAAO,IAAI;AAAA,EAAA;AAG1E,SAEK,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,cAAcb,OAAM,WAAWA,OAAM,QAAQ,SAAS,KACrD;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAASA,OAAM;AAAA,QACf;AAAA,QACA,cAAc,WAAW;AAAA,QACzB,WAAW;AAAA,QACX;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,IAGF;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,SAAS,CAAQ,CAAAA,OAAM,WAAW;AAAA,QAClC;AAAA,QAEA,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,qBAAqBA,OAAM;AAAA,YAC3B,iBAAiBA,OAAM;AAAA,YACvB,0BAA0B;AAAA,YAC1B,qBAAqBA,OAAM;AAAA,YAC3B,aAAaA,OAAM;AAAA,YACnB,OAAOA,OAAM;AAAA,YACb,OAAOA,OAAM;AAAA,YACb,YAAYA,OAAM;AAAA,YAClB,YAAYA,OAAM,WAAW;AAAA,YAE5B,sBACE,oBAAA,KAAA,EAAK,UAAS,wBAEd,MAAK,EAAA,QAAM,IAAC,QAAQ,GAAG,SAAS,GAAG,MAClC,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,cAAC,oBAAA,MAAA,EAAK,KAAK,GAAG,OAAM,UAAS,OAAO,EAAC,YAAY,EAAA,GAC/C,UAAA,qBAAC,2BACC,EAAA,UAAA;AAAA,gBAAA;AAAA,kBAAC;AAAA,kBAAA;AAAA,oBACC,sBAAoB;AAAA,oBACpB,IAAI;AAAA,oBACJ,gBAAc,UAAU,KAAO;AAAA,oBAC/B,iBAAe,WAAW,KAAO;AAAA,oBACjC,YAAY,SAAO,OAAA,SAAA,MAAA;AAAA,oBACnB,cAAc,WAAS,OAAA,SAAA,QAAA;AAAA,oBACvB,MAAM;AAAA,oBACN;AAAA,oBACA,QAAQ;AAAA,oBACR,KAAK;AAAA,oBACL;AAAA,oBACA,MAAK;AAAA,oBAEL,UAAA;AAAA,sBAACyH;AAAAA,sBAAA;AAAA,wBACC;AAAA,wBACA,eAAe;AAAA,wBACf;AAAA,wBACA,MAAM;AAAA,sBAAA;AAAA,oBACR;AAAA,kBAAA;AAAA,gBACF;AAAA,gBACA,oBAAC,OAAK,UAAK,KAAA,CAAA;AAAA,cAAA,EAAA,CACb,EACF,CAAA;AAAA,cACC;AAAA,YAAA,EAAA,CACH,EACF,CAAA;AAAA,UAAA;AAAA,QAEJ;AAAA,MAAA;AAAA,IACF;AAAA,EACF,EAAA,CAAA;AAEJ;ACjSgB,SAAA,UAAU,MAAkB,YAAoB;AACvD,SAAA,IAAI,KAAK,SAAS,UAAU;AACrC;AAEA,MAAM,iBAAiB,CAAC,SAAS,QAAQ,SAAS,aAAa,MAAM,GAC/D,gBAAgB,CAAC,SAAS,QAAQ,WAAW,QAAQ,OAAO,GAC5D,mBAAmB,CAAC,MAAM,GAC1B,iBAAiB,CAAC,MAAM;AAEd,SAAAO,eAAa,MAA8B,SAAwC;AACjG,MAAI,CAAC;AAAM,WAAO;AACd,MAAA,QAAQ,IAAI,IAAI;AAAG,WAAO;AAE9B,UAAQ,IAAI,IAAI;AAEV,QAAA,OAAO,KAAK,OAAOA,eAAa,KAAK,MAAM,OAAO,IAAI;AACrD,SAAA,CAAC,MAAM,GAAG,IAAI;AACvB;AAEgB,SAAA,cAAc,YAAwB,cAAsB;AACnE,SAAA,kBAAkB,UAAU,IAC/B,mBAAmB,YAAY,YAAY,IAC3C,oBAAoB,YAAY,YAAY;AAClD;AAEA,SAAS,oBAAoB,YAAwB,cAA8B;AA5BnF,MAAArH,KAAA,IAAA;AA6BE,QAAM,EAAC,MAAM,YAAW,YAClB,iBAAiB,OAAO,MAAM,cAAc,GAC5C,UAAS,cAAA,OAAA,SAAA,WAAY,cAAa,WAAW,WAAW,SAAS,QAEjE,YAAW,iDAAgB,SAAQ;AAErC,MAAA,eAAe,SAAS,QAAQ;AAC3B,WAAA;AAGH,QAAA,iBAAiB,eAAe,SAAS,QAAQ,GACjD,qBAAoBA,MAAA,UAAA,OAAA,SAAA,OAAQ,OAAO,CAAC,MAAM,CAAC,cAAc,SAAS,EAAE,IAAI,CAAA,EAAG,WAAvD,OAAAA,MAAiE,KAAK,GAC1FkI,oBAAkB,MAAA,KAAA,WAAA,OAAA,SAAA,QAAS,SAAT,OAAA,SAAA,GAAe,WAAf,OAAA,KAAyB,KAAK;AAEtD,SAAI,oBAAoBA,mBAAkB,CAAC,iBAClC,eAGF;AACT;AAEA,SAAS,mBAAmB,YAAwB,cAA8B;AAlDlF,MAAAlI;AAmDE,QAAM,EAAC,QAAO,IAAI,YAEZkI,oBAAkBlI,0CAAS,SAAQ,CAAjB,MAAA,OAAA,SAAAA,IAAsB,UAAS,GACjD,kBAAkB,iBAAiB,UAAS,WAAA,OAAA,SAAA,QAAS,WAAU,EAAE;AAEnE,SAAAkI,mBAAkB,CAAC,kBACd,eAGF;AACT;AAEA,SAAS,OACP,YACA,cACwB;AACxB,MAAI,cAAY,QAAA,WAAA,QAAQ,aAAa,SAAS,yCAAY,IAAI;AACrD,WAAA;AAEJ,MAAA;AAGE,WAAA,OAAO,WAAW,MAAM,YAAY;AAC7C;ACvDA,MAAMvI,gBAAuB,CAAA;AAE7B,SAAS,aAAa,OAAmB;AAErC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,UAAU,CAAQ,CAAA,MAAM,WAAW;AAAA,MACnC,WAAW,MAAM,WAAW;AAAA,MAC5B,MAAM,MAAM;AAAA,MAEX,UAAM,MAAA;AAAA,IAAA;AAAA,EAAA;AAGb;AAEA,SAAS,eAAe,OAAmB;AACzC,QAAM,CAAC,mBAAmB,mBAAmB,IAAI,SAAoCA,aAAW,GAC1F,aAAa,eAAe,GAC5B,UAAU,CAAA,CAAQ,MAAM,WAAW;AAEzC,SAEK,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,cAAc,MAAM,WAAW,MAAM,QAAQ,SAAS,KACrD;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS,MAAM;AAAA,QACf;AAAA,QACA,cAAc,MAAM,WAAW;AAAA,QAC/B,WAAW;AAAA,QACX,MAAM,MAAM;AAAA,QACZ,YAAY,MAAM;AAAA,MAAA;AAAA,IACpB;AAAA,wBAGD,sBAAqB,EAAA,SAAS,mBAAmB,SAAkB,MAAM,MAAM,MAC9E,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,iBAAiB,MAAM;AAAA,QACvB,qBAAqB,MAAM;AAAA,QAC3B,0BAA0B;AAAA,QAC1B,qBAAqB,MAAM;AAAA,QAC3B,eAAa,SAAS,MAAM,OAAO;AAAA,QACnC,aAAa,MAAM;AAAA,QACnB,SAAS,MAAM;AAAA,QACf,OAAO,MAAM;AAAA,QACb,OAAO,MAAM;AAAA,QACb,YAAY,MAAM;AAAA,QAClB,YAAY,MAAM,WAAW;AAAA,QAE7B,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,UAAU;AAAA,YACV,WAAW,MAAM,WAAW;AAAA,YAC5B,MAAM,MAAM;AAAA,YAEX,UAAM,MAAA;AAAA,UAAA;AAAA,QACT;AAAA,MAAA;AAAA,IAAA,GAEJ;AAAA,EACF,EAAA,CAAA;AAEJ;AAEA,SAAS,mBAAmB,OAA2C;AACrE,QAAM,CAAC,mBAAmB,mBAAmB,IAAI,SAAoCA,aAAW,GAC1F,aAAa,eAAe,GAC5B,UAAU,CAAA,CAAQ,MAAM,WAAW;AAEzC,SAEK,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,cAAc,MAAM,WAAW,MAAM,QAAQ,SAAS,KACrD;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS,MAAM;AAAA,QACf;AAAA,QACA,cAAc,MAAM,WAAW;AAAA,QAC/B,WAAW;AAAA,QACX,MAAM,MAAM;AAAA,QACZ,YAAY,MAAM;AAAA,MAAA;AAAA,IACpB;AAAA,wBAGD,sBAAqB,EAAA,SAAS,mBAAmB,SAAkB,MAAM,MAAM,MAC9E,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,qBAAqB,MAAM;AAAA,QAC3B,iBAAiB,MAAM;AAAA,QACvB,0BAA0B;AAAA,QAC1B,qBAAqB,MAAM;AAAA,QAC3B,WAAW,MAAM;AAAA,QACjB,aAAa,MAAM;AAAA,QACnB,eAAa,SAAS,MAAM,OAAO;AAAA,QACnC,aAAa,MAAM;AAAA,QACnB,OAAO,MAAM;AAAA,QACb,YAAY,MAAM;AAAA,QAClB,UAAU,MAAM;AAAA,QAChB,OAAO,MAAM;AAAA,QACb,YAAY,MAAM;AAAA,QAClB,SAAS,MAAM;AAAA,QACf,YAAY,MAAM,WAAW;AAAA,QAE5B,UAAM,MAAA;AAAA,MAAA;AAAA,IAAA,GAEX;AAAA,EACF,EAAA,CAAA;AAEJ;AAEA,SAAS,iBAAiB,OAAyB;AACjD,QAAM,CAAC,mBAAmB,mBAAmB,IAAI,SAAoCA,aAAW,GAC1F,aAAa,eACb,GAAA,UAAU,EAAQ,MAAM,WAAW,SAGnC,eAAe,MAAM,WAAW,QAAQ;AAAA,IAC5C,CAAC,WAAkC,OAAO,SAAS,WAAW,OAAO,SAAS;AAAA,EAAA,GAE1E,WAAW,gBAAc,QAAA,aAAA,OAC3B,MAAM,WACN,MAAM,SAAS,QAAO,gBAAA,OAAA,SAAA,aAAc,MAAM,aAAYA,aAAW;AAErE,SAEK,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,cAAc,MAAM,WAAW,MAAM,QAAQ,SAAS,KACrD;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS,MAAM;AAAA,QACf;AAAA,QACA,cAAc,MAAM,WAAW;AAAA,QAC/B,WAAW;AAAA,QACX,MAAM,MAAM;AAAA,QACZ,YAAY,MAAM;AAAA,MAAA;AAAA,IACpB;AAAA,wBAGD,sBAAqB,EAAA,SAAS,mBAAmB,SAAkB,MAAM,MAAM,MAC9E,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,qBAAqB,MAAM;AAAA,QAC3B,iBAAiB,MAAM;AAAA,QACvB,0BAA0B;AAAA,QAC1B,qBAAqB;AAAA,QACrB,WAAW,MAAM;AAAA,QACjB,aAAa,MAAM;AAAA,QACnB,aAAa,MAAM;AAAA,QACnB,OAAO,MAAM;AAAA,QACb,YAAY,MAAM;AAAA,QAClB,UAAU,MAAM;AAAA,QAChB,OAAO,MAAM;AAAA,QACb,YAAY,MAAM;AAAA,QAClB,SAAS,MAAM;AAAA,QACf,YAAY,MAAM,WAAW;AAAA,QAE5B,UAAM,MAAA;AAAA,MAAA;AAAA,IAAA,GAEX;AAAA,EACF,EAAA,CAAA;AAEJ;AAEO,SAAS,6BACd,YACkD;AA7KpD,MAAAK;AA8KM,OAAAA,MAAA,WAAW,eAAX,QAAuBA,IAAA;AAAO,WAAO,WAAW,WAAW;AAE/D,MAAI,oBAAoB,UAAU;AACzB,WAAA;AAGT,QAAM,YAAYqH,eAAa,YAAY,oBAAI,IAAK,CAAA;AAEhD,SAAA,UAAU,KAAK,CAACnH,OAAMA,GAAE,SAAS,WAAWA,GAAE,SAAS,MAAM,IACxD,mBAGL,UAAU,KAAK,CAACA,OAAM,kCAAkCA,EAAC,CAAC,KAI1D,UAAU,KAAK,CAACA,OAAMA,GAAE,SAAS,MAAM,IAClC,iBAGL,UAAU,KAAK,CAACA,OAAM,sBAAsBA,EAAC,CAAC,IACzC,iBAGL,WAAW,aAAa,YAAY,WAAW,aAAa,UACvD,iBAGF;AACT;AClMA,MAAM,mBAAmB,cAAgC,IAAI;AAGtD,SAAS,kBAAkB,EAAC,UAAU,aAAoC;AAC/E,6BAAQ,iBAAiB,UAAjB,EAA0B,OAAO,WAAY,SAAS,CAAA;AAChE;AAKO,SAAS,eAA0B;AAClC,QAAA,YAAY,WAAW,gBAAgB;AAE7C,MAAI,CAAC;AAAiB,UAAA,IAAI,MAAM,kCAAkC;AAE3D,SAAA;AACT;ACZA,MAAM,0BAA0B,GAa1B+G,0BAAkC;AAAA,EACtC,WAAW;AAAA,EACX,UAAU;AAAA,IACR,sBAAsB;AAAA,MACpB,eAAe;AAAA,IACjB;AAAA,EACF;AACF;AAKA,SAAS,cAAc,EAAC,UAAmE;AACzF,QAAM,EAAC,WAAW,QAAO,IAAI,OAAO,OAAO;AACpC,SAAA,OAAO,WAAW,QAA8B;AAAA,IACrD,KAAK,aAAa,SAAS,aAAa,OAAO;AAAA,IAC/C,KAAK;AAAA,EAAA,CACN;AACH;AAEA,MAAM,qCAAoE;AAGnE,SAAS,uBAAuB,gBAAuC;AAjD9E,MAAAjH,KAAA,IAAA,IAAA;AAkDE,QAAM,aAAY,MAAAA,MAAA,aAAA,EAAe,WAAf,OAAuB,SAAAA,IAAA,6BAAvB,OAAiD,SAAA,GAAA,SAC7D,kBAAkB,UAAU,6BAA6B,GACzD,SAAS,QAAQ,MAAM,kBAAkB,iBAAiB,CAAC,gBAAgB,eAAe,CAAC,GAC3F,UAAU,QAAQ,MAAM,OAAO,OAAO,EAAE,SAAS,CAAC,MAAM,CAAC;AAE1D,eACH,eAAe,IAAI,SAAS,GAAGiH,wBAAsB,QAAQ,CAAC,GAG3D,eAAe,IAAI,OAAO,KAC7B,eAAe,IAAI,SAAS,cAAc,EAAC,OAAO,CAAA,EAAE,KAAK,YAAa,CAAA,CAAC;AAGzE,QAAM,gBAAgB;AAAA,IACpB,MACE,eAAe,IAAI,OAAO,EAAG;AAAA,MAC3B,IAAI,CAAC,cAAc;AAAA,QACjB,WAAW;AAAA,QACX;AAAA,MAAA,EACA;AAAA,MACF,UAAUA,uBAAqB;AAAA,MAC/B,WAAW,CAAC,SACV,QAAQ,MAAM,GAAG,GACV,GAAG;AAAA,QACR,WAAW;AAAA,QACX,SAAS;AAAA,QACT,UAAU,EAAC,sBAAsB,EAAC,eAAe,0BAAwB;AAAA,MAC1E,CAAA,EACF;AAAA,IACH;AAAA,IACF,CAAC,OAAO;AAAA,IACRA;AAAAA,EAAA,GAGI,iBAAgB,MAAA,KAAA,iBAAA,OAAA,SAAA,cAAe,aAAf,OAAA,SAAA,GAAyB,yBAAzB,OAA+C,SAAA,GAAA;AAErE,SAAK,SAAS,aAAa,IAIpB,KAAK,IAAI,eAAe,uBAAuB,IAH7C;AAIX;ACrFgB,SAAA,kBACd,MACA,SACM;AACN,YAAU,MAAM;AACR,UAAA,WAAW,CAAC,UAAiB;AACjC,YAAM,SAAS,MAAM;AACrB,UAAI,kBAAkB,aAAa;AAC7B,YAAA,KAAK,KAAK,CAAC,QAAK;AAd5B,cAAAjH;AAcmC,kBAAAA,MAAA,IAAA,YAAJ,oBAAa,SAAS,MAAA;AAAA,QAAA,CAAO;AAClD;AAEF,gBAAQ,KAAK;AAAA,MACf;AAAA,IAAA;AAEO,WAAA,SAAA,iBAAiB,aAAa,QAAQ,GAC/C,SAAS,iBAAiB,cAAc,QAAQ,GACzC,MAAM;AACX,eAAS,oBAAoB,aAAa,QAAQ,GAClD,SAAS,oBAAoB,cAAc,QAAQ;AAAA,IAAA;AAAA,EACrD,GACC,CAAC,MAAM,OAAO,CAAC;AACpB;ACvBA,MAAM,gBAAgB;AAAA;AAAA,GAIhB,cAAc;AAAA;AAAA,GAIdqE,SAAO,OAAO,IAAI;AAAA,EAAsB,CAAChF,WAC7CA,OAAM,UAAU,gBAAgB;AAClC,GAEa,wBAAwB,WAAW,SAC9CA,QAGA,cACA;AACA,QAAM,CAAC,aAAa,cAAc,IAAI,SAAgC,IAAI,GAEpE,eAAe;AAAA,IACnB,CAAC,YAA4B;AAG3B,sBAAgB,cAAc,OAAO,GACrC,eAAe,OAAO;AAAA,IACxB;AAAA,IACA,CAAC,YAAY;AAAA,EAAA,GAGT,mBAAmB,eAAe,WAAW;AAEnD,SACG,oBAAAgF,QAAA,EAAK,KAAK,cAAc,KAAK,GAAG,WAAU,oBAAA,OAAA,SAAA,iBAAkB,UAAS,KAAK,KACxE,UAAAhF,OAAM,SACT,CAAA;AAEJ,CAAC;AAED,SAAS,gBAAmB,KAAsB,UAAa;AACzD,SAAO,OAAQ,aACjB,IAAI,QAAQ,IACH,QACT,IAAI,UAAU;AAElB;ACxBA,MAAM,qBAAqB,EAAC,SAAS,cAAa,GAC5C,aAAa,EAAC,OAAO,OAAM,GAE3BoF,kBAA4C;AAAA,EAChD,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,eAAe;AAAA,EACf,oBAAoB,CAAC,UAAU,QAAQ,KAAK;AAAA,EAC5C,WAAW;AAAA,EACX,iBAAiB;AACnB;AAEO,SAAS,aAAapF,QAAc;AACzC,QAAM,EAAC,eAAe,UAAU,IAAAR,KAAI,SAAS,GAAG,KAAQ,IAAAQ,QAClD,cAAc,eAAe,GAE7B,EAAC,GAAAa,OAAK,eACN,GAAA,cAAc,eAAe,aAAa;AAE3B,SAAA,cAAc,KAAK,CAAC,WAAW,OAAO,WAAW,OAAO,IAyBtE,cAAc,SAAS,IAC5B;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACE,GAAG;AAAA,UACJ,UAAUb,OAAM;AAAA,UAChB,MAAMa,GAAE,oDAAoD;AAAA,UAC5D,MAAK;AAAA,UACL,MAAM;AAAA,UACN,MAAK;AAAA,QAAA;AAAA,MACP;AAAA,MAEF,IAAArB;AAAA,MACA,0BACG,MAAK,EAAA,KAAK,SACR,UAAc,cAAA,IAAI,CAAC,iBAClB;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,UAAU,aAAa,WAAW;AAAA,UAElC,SACE;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA,SAAQ;AAAA,YAAA;AAAA,UACV;AAAA,UAEF,QAAM;AAAA,UAGN,8BAAC,OACC,EAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,UAAU,CAAC,aAAa,WAAW;AAAA,cACnC,MAAM,aAAa;AAAA,cACnB,MAAM,YAAY,YAAY,EAAE;AAAA,cAEhC,SAAS,MAAM,SAAS,YAAY;AAAA,YAAA;AAAA,UAAA,GAExC;AAAA,QAAA;AAAA,QAlBK,aAAa;AAAA,MAoBrB,CAAA,GACH;AAAA,MAEF,SAAS4F;AAAAA,IAAA;AAAA,EAAA,IAGX;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,MAAMvE,GAAE,oDAAoD;AAAA,MAC5D,MAAK;AAAA,MACL,UAAU,CAAC,cAAc,CAAC,EAAE,WAAW,WAAWb,OAAM;AAAA,MAExD,SAAS,MAAM,SAAS,cAAc,CAAC,CAAC;AAAA,MACxC,MAAM;AAAA,MACN,MAAK;AAAA,IAAA;AAAA,EAAA,IA1EL;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA,SAAQ;AAAA,QAAA;AAAA,MACV;AAAA,MAIF,UAAA,oBAAC,OAAI,EAAA,OAAO,oBACV,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAMa,GAAE,6CAA6C;AAAA,UACrD,MAAK;AAAA,UACL,UAAQ;AAAA,UACR,MAAM;AAAA,UACN,OAAO;AAAA,QAAA;AAAA,MAAA,GAEX;AAAA,IAAA;AAAA,EAAA;AA4DR;AC3GO,SAASiI,gBAAc9I,QAK3B;AACK,QAAA,EAAC,kBAAA+H,mBAAkB,IAAI,YAAY,kBAAiB/H,QACpD,EAAC,WAAW,QAAQ,eAAe,MAAK,IAAI8H,mBAAiB,YAAYC,iBAAgB,GACzF,EAAC,GAAAlH,GAAA,IAAK;AAER,MAAA;AACF,WACG,qBAAA,OAAA,EAAM,OAAO,GAAG,SAAS,GACxB,UAAA;AAAA,MAAC,oBAAA,cAAA,EAAa,OAAO,EAAC,UAAU,OAAM,QAAQ,GAAG,UAAQ,GAAC,CAAA;AAAA,MACzD,oBAAA,cAAA,EAAa,OAAO,EAAC,UAAU,IAAM,GAAA,QAAQ,GAAG,MAAM,GAAG,UAAQ,GAAC,CAAA;AAAA,IACrE,EAAA,CAAA;AAIA,MAAA;AAEA,WAAA,oBAAC,SAAM,OAAO,GAAG,SAAS,GACxB,UAAA,oBAAC,SAAM,OAAOA,GAAE,sDAAsD,GACpE,UAAA,oBAACc,UAAK,OAAK,IAAC,MAAM,GACf,UAAA,MAAM,QACT,CAAA,EACF,CAAA,EACF,CAAA;AAIJ,MAAI,CAAC;AACI,WAAA;AAGL,MAAA,cAAc,aAAa,WAAW;AAEtC,WAAA,oBAAC,SAAM,OAAO,GAAG,SAAS,GACvB,UAAAd,GAAE,6DAA6D,EAClE,CAAA;AAIE,QAAA,UAAUb,OAAM,KAAK,GAAG,KAAK,CAAC,WAAW,OAAO,SAAS,cAAc,IAAI;AAE5E,SAAA,UAWH,iBACA,WACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,IAAI,cAAc;AAAA,MAClB,QAAO;AAAA,MACP,SAAS,cAAc;AAAA,MACvB;AAAA,MACA;AAAA,MACA,eAAeA,OAAM,KAAK,GAAG,SAAS;AAAA,IAAA;AAAA,EAAA,wBAjBvC,OAAM,EAAA,OAAO,GAAG,SAAS,GACvB,aAAE,2DAA2D;AAAA,IAC5D,cAAc,cAAc;AAAA,EAC7B,CAAA,EACH,CAAA;AAiBN;ACtEA,MAAM+I,kBAAgB,OAAO,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,GAO9BrH,eAAa,OAAOC,MAAI;AAAA;AAAA,GAIxBqH,wBAAmC,CAAC,aAAa,cAAc,GAExDC,0BAAwB,WAAW,SAC9CjJ,QAKA,KACA;AACM,QAAA,EAAC,cAAc,SAAS,WAAW,kBAAkB,GAAG,UAAA,IAAaA,QACrE,EAAC,GAAAa,OAAK,kBACN,aAAab,OAAM,WAAWA,OAAM,QAAQ,SAAS,GACrD,gBAAgB;AAAA,IACpB,CACE;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,OAQF,eAEA;AAAA,MAAC+I;AAAAA,MAAA;AAAA,QACC,WAAU;AAAA,QACV,oBAAoBC;AAAAA,QACpB,OAAO;AAAA,QACP,eAAa;AAAA,QACb;AAAA,QACA;AAAA,QACA,SACG,oBAAA,OAAA,EAAI,KAAK,YACP,uBACC,UAEA,oBAAC,KAAI,EAAA,SAAS,GACZ,UAAA,oBAAC,QAAK,OAAM,UAAS,QAAO,QAAO,SAAQ,UACzC,8BAACtH,cAAW,EAAA,OAAM,UAAS,OAAK,IAC9B,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAb;AAAA,YACA,SAAQ;AAAA,YACR,QAAQ,EAAC,YAAY,gBAAgB,GAAE;AAAA,UAAA;AAAA,QAAA,GAE3C,EACF,CAAA,EACF,CAAA,GAEJ;AAAA,QAEF,MAAM,CAAC,WAAW,CAAC;AAAA,QACnB,KAAK;AAAA,QACL,QAAM;AAAA,QACN,kBAAkB,oBAAoB;AAAA,QACtC,qBAAmB;AAAA,MAAA;AAAA,IACrB;AAAA,IAEF,CAAC,YAAYA,IAAG,cAAc,SAAS,WAAW,gBAAgB;AAAA,EAAA;AAEpE,6BAAQ,cAAc,EAAA,GAAG,WAAW,SAAkB,KAAU,cAA8B,CAAA;AAChG,CAAC,GC7EY,0BAA0B,cAAuC,IAAI;AAK3E,SAAS,sBAAwC;AAEjD,SADO,WAAW,uBAAuB,KAKrC,EAAC,SAAS,EAAC,SAAS,QAAO,cAAc,EAAC,SAAS,KAAA;AAG9D;ACaA,IAAI;AACJ,MAAM,oBAAwC,WAAW,SAA2Bb,QAAO,KAAK;AACzF,SAAA,0BACH,wBAAwB,OAAO,WAAW;AAAA;AAAA;AAAA;AAAA,QAMpC,oBAAA,uBAAA,EAAsB,KAAW,GAAGA,OAAO,CAAA;AACrD,CAAC,GAEKkJ,yBAA6C;AAAA,EACjD,MAAM,CAAC;AAAA,EACP,WAAW;AACb,GAEMC,cAAY,MAAM;AAExB,SAASC,cAAe,GAA2B;AACjD,SAAO,MAAM;AACf;AAMO,SAAS,eAAepJ,QAA4B;AArE3D,MAAAW,KAAA,IAAA,IAAA,IAAA,IAAA;AAsEQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,IAAAnB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAAQ,QAEE,EAAC,kBAAA+H,sBAAoB,kBAAkB;AAAA,IAC3C;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD,GAEK,CAAC,aAAa,cAAc,IAAI,SAA+BmB,sBAAoB,GAEnF,kBAAkB;AAAA,IACtB,CAAC,WAAkC;AAC3B,YAAA,gBAAgB,KAAK,GAErB,UAAU;AAAA,QACd,aAAa,CAAA,CAAE;AAAA,QACf,IAAI,WAAW,MAAM,CAAC,OAAO,CAAC;AAAA,QAC9B,IAAI,eAAe,CAAC,MAAM,CAAC;AAAA,QAC3B,IAAI,IAAM,CAAC,OAAO,CAAC;AAAA,QACnB,IAAI,EAAC,MAAM,OAAO,MAAM,MAAM,WAAW,MAAM,UAAU,OAAO,SAAA,GAAW;AAAA,UACzE;AAAA,QAAA,CACD;AAAA,MAAA,EACD,OAAO9I,eAAa;AAEtB,eAAS,OAAO,GAEhB,gBAAgB,EAAC,IAAI,eAAe,MAAM,OAAO,MAAM,UAAU,OAAO,SAAS,CAAA,GACjF,YAAY,CAAA,CAAE;AAAA,IAChB;AAAA,IACA,CAAC,UAAU,iBAAiB,aAAa,UAAU;AAAA,KAG/C,eAAe;AAAA,IACnB,CAAC,WAAmB;AAClB,UAAI,CAAC,QAAQ;AACX,iBAAS,MAAO,CAAA,GAChB,YAAY,CAAE,CAAA;AACd;AAAA,MACF;AAEM,YAAA,MAAM,YAAY,KAAK,KAAK,CAAC,MAAM,EAAE,OAAO,MAAM;AAExD,UAAI,CAAC;AACG,cAAA,IAAI,MAAM,oDAAoD;AAItE,YAAM,UAAU;AAAA,QACd,aAAa,CAAA,CAAE;AAAA,QACf,IAAI,WAAW,MAAM,CAAC,OAAO,CAAC;AAAA,QAC9B,IAAI,eAAe,MAAM,GAAG,CAAC,MAAM,CAAC;AAAA,QACpC,IAAI,aAAa,CAAC,WAAW,OAAO,MAAM,CAAC,OAAO,CAAC,IAAI,IAAI,IAAM,CAAC,OAAO,CAAC;AAAA,QAC1E,IAAI,YACA,MAAM,CAAC,sBAAsB,CAAC,IAC9B,IAAI,EAAC,MAAM,OAAA,OAAA,SAAA,IAAK,MAAM,MAAM,WAAW,QAAO,CAAC,sBAAsB,CAAC;AAAA,MAAA,EAC1E,OAAOA,eAAa;AAEtB,eAAS,OAAO,GAEhB,YAAY,CAAE,CAAA;AAAA,IAChB;AAAA,IACA,CAAC,UAAU,aAAa,WAAW,MAAM,WAAW,MAAM,YAAY,IAAI;AAAA,EAAA,GAGtE,cAAc,YAAY,MAAM;AACpC,aAAS,OAAO;AAAA,KACf,CAAC,QAAQ,CAAC,GAEP,mBAAmB,YAAY,MAAM;AACpC,aAAA,QAAA,MAAO,QACV,YAAY;AAAA,EAAA,GAEb,CAAC,aAAa,+BAAO,IAAI,CAAC,GAEvB,4BAA4B;AAAA,IAChC,CAAC,UAAyB;AACpB,YAAM,QAAQ,YAChB,YAAY,CAAE,CAAA;AAAA,IAElB;AAAA,IACA,CAAC,WAAW;AAAA,EAAA,GAGR,wBAAwB0H,mBAAiB,SAAA,OAAA,SAAA,MAAO,MAAMC,iBAAgB,GAEtE,yCAAyC,OAA8B,IAAI,GAE3E,EAAC,KAAA,IAAQ,SAAS,GAClB,EAAC,GAAAlH,OAAK,kBAEN,oBAAoB;AAAA,IACxB,CAAC,gBACQ,YAAY;AAAA,MACjB,OAAOuI,aAAW;AAAA,MAClB;AAAA,QAAU,CAAC,iBACT;AAAA,UACE,GAAG,EAAC,WAAW,IAAK;AAAA,UACpB,SAAS,YAAY,EAAE;AAAA,YACrB,IAAI,CAACC,WAAU,EAAC,MAAAA,OAAM,cAAc,WAAW,GAAA,EAAO;AAAA,YACtD,WAAW,CAAC,WACV,KAAK;AAAA,cACH,OAAOxI,GAAE,4CAA4C;AAAA,cACrD,aAAa,MAAM;AAAA,cACnB,QAAQ;AAAA,cACR,IAAI,yBAAyBrB,GAAE;AAAA,YAAA,CAChC,GAED,QAAQ,MAAM,KAAK,GACZ,GAAG,EAAC,MAAM,GAAG,CAAA,EACrB;AAAA,UACH;AAAA,QACF;AAAA,MACF;AAAA,MAEA;AAAA,QACE,CAAC,WAAW,eAAqC,EAAC,GAAG,WAAW,GAAG,UAAS;AAAA,QAC5E0J;AAAAA,MACF;AAAA,MAEA,IAAI,cAAc;AAAA,IACpB;AAAA,IAEF,CAAC1J,KAAI,UAAU,MAAMqB,EAAC;AAAA,EAAA,GAGlB,oCAAoC,YAAY,MAAM;AAC1D,sBAAkB,EAAE;AAAA,EACnB,GAAA,CAAC,iBAAiB,CAAC,GAEhB,4BAA4B;AAAA,IAChC,CAAC,MAAqB;AAChB,QAAE,QAAQ,YACZ,YAAY,CAAE,CAAA;AAAA,IAElB;AAAA,IACA,CAAC,WAAW;AAAA,KAGR,eAAe;AAAA,IACnB,CAAC,WAA+B;AA/NpC,UAAAF,MAAA2I;AAgOM,YAAM,eAAa3I,OAAA,OAAO,IAAI,UAAX,OAAAA,SAAAA,KAAkB,UAAO2I,MAAA,OAAO,IAAI,cAAX,OAAAA,SAAAA,IAAsB,QAAO,OAAO;AAG9E,aAAA,oBAAC,qBAAkB,aAAY,UAAS,MAAK,UAAS,QAAQ,GAAG,MAAK,WACpE,UAAA;AAAA,QAACR;AAAAA,QAAA;AAAA,UACC,kBAAAf;AAAA,UACA,IAAI;AAAA,UACJ;AAAA,UACA,MAAM;AAAA,QAAA;AAAA,MAEV,EAAA,CAAA;AAAA,IAEJ;AAAA,IACA,CAAC,YAAYA,mBAAkB,aAAa;AAAA,EAAA,GAGxC,cAAc,YAAY,MAAM;AAhPxCpH,QAAAA,MAAA2I,KAAAC,KAAAC;AAkPMF,aAAAA,OAAA3I,OAAA,sBAAsB,WAAtB,gBAAAA,KAA8B,QAAQ,UAAtC,OAAA2I,SAAAA,IAA6C,YAC7CE,OAAAD,MAAA,sBAAsB,WAAtB,OAAA,SAAAA,IAA8B,QAAQ,cAAtC,OAAAC,SAAAA,IAAiD,UACjD;AAAA,EAAA,GAED;AAAA,KACD,MAAsB7I,MAAA,sBAAA,WAAtB,OAA8B,SAAAA,IAAA,QAAQ,UAAtC,OAA6C,SAAA,GAAA;AAAA,KAC7C,MAAsB,KAAA,sBAAA,WAAtB,OAA8B,SAAA,GAAA,QAAQ,cAAtC,OAAiD,SAAA,GAAA;AAAA,EAClD,CAAA,GAEK,cAAc,YAAY,MAAM,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,GACpE,aAAa;AAAA,IACjB,CAAC,UAAsB;AA7P3BA,UAAAA;AA8PWA,OAAAA,OAAA,uCAAuC,YAAvC,QAAAA,KAAgD,SAAS,MAAM,aAClE,KAAAX,OAAM,aAAa,OAAO,KAAK;AAAA,IAEnC;AAAA,IACA,CAACA,OAAM,YAAY;AAAA,EAAA,GAGf,2BACJ,MAAuB,KAAA,yBAAA,OAAA,SAAA,sBAAA,WAAvB,OAA+B,SAAA,GAAA,iBAA/B,OAA6C,SAAA,GAAA,YAAW,eACxD,EAAC,SAAO,QAAA,MAAA,0BACR,SAAO,OAAA,SAAA,MAAA;AAET,gBAAa,aAAY,OAAA,SAAA,UAAA,CAAA,OAAO,QAAQ,CAAC,eAAe,kBAAkB;AA1Q5EW,QAAAA;AA2QQ,KAAC,iBAAiB,mBACpBA,OAAA,aAAa,IAAI,YAAjB,QAAAA,KAA0B,MAAA;AAAA,EAAA,CAE7B;AACD,QAAM,OAA6B;AAAA,IACjC,MACE,YAAY,KAAK,IAAI,CAAC,SAAS;AAAA,MAC7B,OAAO,IAAI;AAAA,MACX;AAAA,IAAA,EACA;AAAA,IACJ,CAAC,YAAY,IAAI;AAAA,EACnB,GAEM,YAAY,UAAU,WAAW,KAAK,UAAU,CAAC,MAAM,QAGvD,EAAC,SAAS,iBAAgB,oBAAoB,GAC9C,0BAA0B,OAAuB,IAAI,GACrD,wBAAwB,OAAuB,IAAI,GACnD,4BAA4B,OAAuB,IAAI;AAC7D,SAAA;AAAA,IACE;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,IACA,MAAM;AACA,mBACF,iBAAiB;AAAA,IAErB;AAAA,EAAA,GAIA,oBAAC,OAAM,EAAA,OAAO,GAAG,eAAY,mBAAkB,KAAK,yBAClD,UAAA,qBAAC,OAAM,EAAA,OAAO,GACX,UAAA;AAAA,IACC,yBAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,eAAY;AAAA,QACZ,OAAOE,GAAE,mDAAmD;AAAA,QAC5D,QACE,oBAAC,OAAM,EAAA,SAAS,GACd,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAMA,GAAE,gEAAgE;AAAA,YACxE,SAAS;AAAA,UAAA;AAAA,QAAA,GAEb;AAAA,QAGF,UAAA,oBAACc,QAAK,EAAA,MAAM,GACV,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,SAAQ;AAAA,YACR,GAAAd;AAAA,YACA,QAAQ,EAAC,YAAY,MAAM,KAAI;AAAA,UAAA;AAAA,QAAA,GAEnC;AAAA,MAAA;AAAA,IAAA,IAEA;AAAA,IACJ,qBAAC,uBAAsB,EAAA,KAAK,wCAC1B,UAAA;AAAA,MAAA;AAAA,QAACoI;AAAAA,QAAA;AAAA,UACE,GAAG;AAAA,UACJ,SAAS;AAAA,UACT,QAAQ;AAAA,UACR,eAAY;AAAA,UACZ,SAAS,YAAY;AAAA,UACrB,kBAAkB,uCAAuC;AAAA,UACzD,SAAS;AAAA,UACT,QAAQ;AAAA,UACR,aAAapI,GAAE,qCAAqC;AAAA,UACpD,WAAW;AAAA,UACX,UAAU,sBAAsB,aAAa;AAAA,UAC7C,eAAe;AAAA,UACf,cAAc,YAAY;AAAA,UAC1B,UAAU;AAAA,UACV,cAAcsI;AAAAA,UACd;AAAA,UACA;AAAA,UACA,YAAY,EAAC,SAAS,kCAAiC;AAAA,UACvD,WAAW;AAAA,UACX,OAAO,SAAO,OAAA,SAAA,MAAA;AAAA,QAAA;AAAA,MAChB;AAAA,MAEC,cAAc,SAAS,KACtB;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAI,GAAG3J,GAAE;AAAA,UACT;AAAA,UACA;AAAA,UACA,UAAU;AAAA,UACV,WAAW;AAAA,UACX,SAAS;AAAA,QAAA;AAAA,MACX;AAAA,IAAA,GAEJ;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACtUA,eAAeiK,2BACb,SACApJ,WACA,WACA,WACuC;AACvC,MAAI,CAAC;AACH,WAAO;AAGL,MAAA,OAAO,QAAQ,UAAW,YAAY;AAClC,UAAA,aAAa,UAAU,MAAM,GAAG,EAAE,GAClC,SAASuC,MAAIvC,WAAU,UAAU;AAChB,WAAA,MAAM,QAAQ,OAAO,EAAC,UAAAA,WAAU,YAAY,QAAQ,WAAU;AAAA,EAEvF;AAEO,SAAA;AAAA,IACL,QAAQ,QAAQ;AAAA,IAChB,QAAQ,kBAAkB,UAAU,QAAQ,eAAe;AAAA,EAAA;AAE/D;AASA,SAASkI,cAAe,OAAwB;AACxC,QAAA,MAAM,OAAO,KAAK;AACxB,SAAA,IAAI,UAAU,OACP;AACT;AAeO,SAAS,qBAAqBvI,QAAkC;AAxFvE,MAAAW,KAAA,IAAA,IAAA;AAyFE,QAAM,SAAS,aACT,eAAe,OAAO,UAAU,6BAA6B,GAC7D,SAAS,aACT,gBAAgB,uBAAuB,GACvC,uBAAuB,wBAAwB,GAC/C,EAAC,MAAM,eAAcX,QACrB,EAAC,4BAA4B,iBAAiB,YAAY,0BAAyB,IACvF,4BACI,EAAC,2BAA2B,GAAA,IAAS,OAAO,QAE5C,gBAAgB,aAAa,CAAA,CAAE,GAC/B,cAAcuI,cAAY,aAAa,GACvC,oBAAmB5H,MAAA,YAAY,YAAZ,OAAqB,SAAAA,IAAA,OACxC,UAAU,OAAO,IAAI,gBAAgB,GAErC,qBAAqB,QAAQ,MAAM,WAAS,OAAA,SAAA,QAAA,UAAU,CAAC,OAAO,CAAC,GAE/D,eAAa,KAAW,WAAA,YAAX,mBAAoB,gBAAe,IAChD,YAAY,OAAO,WAEnB,eAAe;AAAA,IACnB,CAAC,iBACC,KAAK8I,2BAAyB,WAAW,SAAS,YAAY,SAAS,MAAM,SAAS,CAAC,EAAE;AAAA,MACvF;AAAA,QAAS,CAAC,EAAC,QAAApB,SAAQ,OAAA,MACjBqB;AAAAA,UACE;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,YACE,GAAG,WAAW;AAAA,YACd,QAAArB;AAAA,YACA;AAAA,YACA,KAAK;AAAA,YACL;AAAA,UACF;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,MAEA,WAAW,CAAC,QAAqB;AAhIzC1H,YAAAA;AAiIU,cAAM,eAAe,IAAI,WAAW,IAAI,QAAQ,SAAS;AACrDA,gBAAAA,OAAA,WAAW,YAAX,QAAAA,KAAoB,UAAU,iBAChC,IAAI,UAAU,sEAET,WAAW,GAAG;AAAA,MAAA,CACtB;AAAA,IACH;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA,GAGI,YAAW,MAAM,KAAAX,OAAA,UAAN,mBAAa,yBAAb,OAAA,SAAA,GAAmC,UAC9C,oBAAoB;AAAA,IACxB,MACE,WAAW,SACT,QACA,cACA;AACA,aAAO,6BACL;AAAA,QAAC;AAAA,QAAA;AAAA,UACE,GAAG;AAAA,UACJ,KAAK;AAAA,UACL,eAAe;AAAA,UACf;AAAA,QAAA;AAAA,MAEA,IAAA;AAAA,IAAA,CACL;AAAA,IACH,CAAC,4BAA4B,MAAM,QAAQ;AAAA,KAGvC,sBAAsB;AAAA,IAC1B,CAAC,UAA8B;AACX,yBAAA,QAAA,gBAAA;AAAA,QAChB,eAAe;AAAA,QACf,IAAI,MAAM;AAAA,QACV,MAAM,MAAM;AAAA,QACZ,UAAU,MAAM;AAAA,MAAA,CAClB;AAAA,IACF;AAAA,IACA,CAAC,iBAAiB,IAAI;AAAA,EAAA,GAGlB,gBAAgB,UAAU,WAAW,OAAM,cAAA,OAAA,SAAA,WAAY,SAAQ,CAAE,CAAA,IACnE,cAAY,OAAA,SAAA,WAAA,QACZ,QAEE,gBAAgB,QAAQ,MACxB,aACK,CAGN,KAAA,6BAA6B,CAAC,GAE5B,OAAO,CAAC,MACA,WAAW,GAAG,KAAK,CAAC,aAAa;AA/LlDW,QAAAA;AAgMY,WAAO,SAAS,WAASA,OAAA,EAAE,aAAF,gBAAAA,KAAY;AAAA,EACtC,CAAA,CACF,EACA;AAAA,IAAI,CAAC,SAAyC;AAnMvD,UAAAA,MAAA2I,KAAAC;AAoMU,cAAA5I,OAAA,KAAK,aAAL,QAAAA,KAAe,aACX;AAAA,QACE,IAAI,KAAK;AAAA,QACT,OACE,KAAK,SAAS,GAAG,KAAK,SAAS,UAAU,mBAAkB2I,MAAA,KAAK,aAAL,OAAA,SAAAA,IAAe,EAAE;AAAA,QAC9E,MAAM,KAAK;AAAA,QACX,MAAM,KAAK,SAAS;AAAA,QACpB,MAAM,KAAK;AAAA,QACX,UAAU;AAAA,UACR,KAAIC,MAAA,KAAK,aAAL,gBAAAA,IAAe;AAAA,UACnB,QAAQ,KAAK;AAAA,QACf;AAAA,QAEA,YAAY,EAAC,SAAS,KAAK,SAAS,QAAQ,KAAK,OAAM;AAAA,MAEzD,IAAA;AAAA,IAAA;AAAA,EAAA,EAEL,OAAOnJ,eAAa,GAExB,CAAC,YAAY,2BAA2B,WAAW,EAAE,CAAC,GAEnD2H,qBAAmB;AAAA,IACvB,CAACvI,KAAY,UACXgJ,iBAAyB,sBAAsBhJ,KAAI,KAAK;AAAA,IAC1D,CAAC,oBAAoB;AAAA,EAAA;AAIrB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAGQ;AAAA,MACJ,UAAU;AAAA,MACV,UAAU;AAAA,MAAA,kBACV+H;AAAAA,MACA;AAAA,MACA,4BAA4B;AAAA,MAC5B;AAAA,MACA,iBAAiB;AAAA,IAAA;AAAA,EAAA;AAGvB;ACnNO,SAAS,kBACd,MACyB;AAClB,SAAA,mBAAmB,KAAK,UAAU;AAC3C;AAKO,SAAS,mBACd,YACgC;AACzB,SAAA,mBAAmB,WAAW,UAAU;AACjD;AAKO,SAAS,mBACd,YACgC;AACzB,SAAA,mBAAmB,WAAW,UAAU;AACjD;AAKO,SAAS,mBACd,YACgC;AACzB,SAAA,mBAAmB,WAAW,UAAU;AACjD;AAKO,SAAS,oBACd,YACiC;AAC1B,SAAA,oBAAoB,WAAW,UAAU;AAClD;AAKO,SAAS,2BACd,YACwC;AACjC,SAAA,2BAA2B,WAAW,UAAU;AACzD;AAKO,SAAS,0BACd,YACwC;AACjC,SAAA,0BAA0B,WAAW,UAAU;AACxD;AAKO,SAAS,8BACd,YAC2C;AACpC,SAAA,8BAA8B,WAAW,UAAU;AAC5D;ACxFA,SAAS,uBACP,WACA,MACA,cACA,SACW;AACX,QAAM,QAAQ;AAAA,IACZ,GAAG;AAAA,EAAA,GAGC,UAAU,QAAQ,KAAK,GACvB,UAAU,QAAQ,KAAK;AAE7B,SAAI,KAAK,MAAM,MAAM,KAAK,aAAa,MAAM,UAC3C,MAAM,IAAI,aAAa,MAAM,KAAK,MAAM,UAC/B,KAAK,SAAS,MAAM,KAAK,aAAa,MAAM,aAAa,SAAS,YAC3E,MAAM,IAAI,aAAa,MAAM,aAAa,SAAS,KAAK,SAAS,UAG/D,KAAK,OAAO,MAAM,KAAK,aAAa,OAAO,UAC7C,MAAM,IAAI,aAAa,OAAO,KAAK,OAAO,UACjC,KAAK,QAAQ,MAAM,KAAK,aAAa,OAAO,aAAa,QAAQ,YAC1E,MAAM,IAAI,aAAa,OAAO,aAAa,QAAQ,KAAK,QAAQ,UAG3D;AACT;AAOO,MAAM,qCACX,CAAC,YACD,CAAC,EAAC,mBAAmB,kBAAkB,gBACjC,CAAC,oBAAoB,CAAC,oBACjB,YAGF,uBAAuB,WAAW,kBAAkB,mBAAmB,OAAO,GCnCnF,mBAAmB,OAAO,MAAM;AAAA,YAC1B,CAAC/H,WAAWA,OAAM,QAAQ,SAAS,WAAY;AAAA,GAG9C,wBAAwB,cAA6B,IAAI,GASzD,aAAa,SAAoBA,QAAwB;AAC9D,QAAAR,MAAK,WAAW,qBAAqB,GACrC,EAAC,WAAW,WAAA,IAAc,YAAY,EAAC,IAAAA,IAAA,CAAG,GAC1C,EAAC,GAAAqB,GAAC,IAAI,kBACN,EAAC,OAAO,SAAS,GAAG,KAAQ,IAAAb;AAGhC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAM;AAAA,MACN,cAAc;AAAA,QACZ,SAASa,GAAE,kCAAkC;AAAA,QAC7C,OAAO,EAAC,MAAM,IAAI;AAAA,MACpB;AAAA,MACA;AAAA,MACA,WAAQ;AAAA,MACP,GAAG;AAAA,MACH,GAAG;AAAA,MACH,GAAG;AAAA,IAAA;AAAA,EAAA;AAGV,GCLa,yBAAyB,UAEhC8I,aAAW,OAAO,GAAG;AAAA,IACvB,CAAC3J,WACDA,OAAM,WACN;AAAA;AAAA;AAAA;AAAA,KAIC;AAAA,GAGC,sBAAyC;AAAA,EAC7C,WAAW;AAAA,IACT,GAAG;AAAA,IACH,GAAG;AAAA,EACL;AACF,GACM,iBAAgC;AAAA,EACpC,kBAAkB;AACpB,GAEM,aAAa;AAAA,EACjB,UAAU;AAAA,EACV,QAAQ;AACV;AAIA,SAAS,eAAe,MAAY;AAC3B,SAAA,SAAS,MAAM,2BAA2B;AACnD;AACA,SAAS,gBAAgB,MAAY;AAC5B,SAAA,SAAS,MAAM,gCAAgC;AACxD;AAEA,MAAM,eAAe,KAAK,SAAsBA,QAAkB;AAC1D,QAAA,EAAC,OAAO,MAAM,YAAY,iBAAiB,eAAe,UAAU,GAAG,SAAQA,QAE/E,UAAU,WAAW,UAAU,aAAa,GAAG,UAAU,gBAAgB,cAAc,CAAC,GAExF,gBAAgB;AAAA,IACpB,CAAC,UAAwB;AA9E7B,UAAAW,KAAA,IAAA,IAAA;AA+EY,YAAA,EAAC,QAAQ,KAAQ,IAAA;AAEnB,aAAO,QAAO,QAAM,OAAA,SAAA,KAAA,QACtB,cAAa,QAAA,WAAA;AAAA,QACX,YAAW,MAAOA,MAAA,OAAA,KAAK,YAAZ,OAAA,SAAAA,IAAqB,aAArB,OAA+B,SAAA,GAAA;AAAA,QAC1C,UAAS,MAAM,KAAA,QAAA,OAAA,SAAA,KAAA,KAAK,YAAX,OAAA,SAAA,GAAoB,aAApB,OAA8B,SAAA,GAAA;AAAA,MAI3C,CAAA,IAAA,iBAAA,QAAA,cAAA;AAAA,IACF;AAAA,IACA,CAAC,YAAY,aAAa;AAAA,KAEtB,YAAY;AAAA,IAChB,MAAM,CAAC,mCAAmC,EAAC,GAAG,GAAE,GAAG,GAAI,OAAO,CAAC,eAAe,IAAI,CAAC,IAAI,CAAA,CAAG;AAAA,IAC1F,CAAC,IAAI;AAAA,EAAA;AAIL,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,YAAY;AAAA,MACZ;AAAA,MACA,oBAAoB;AAAA,MACpB,WAAW;AAAA,MACX,aAAa;AAAA,MAEb,UAAC,oBAAA,iBAAA,EAAgB,OAAc,UAAU,OAAO,gBAAgB,IAAI,IAAI,QACtE,UAAC,oBAAA,MAAA,EAAM,GAAG,MAAO,SAAS,CAAA,GAC5B;AAAA,IAAA;AAAA,EAAA;AAGN,CAAC,GAEK,mBAAmB;AAAA,EACvB,SAA0BX,QAAO,KAAK;AACpC,UAAM,EAAC,IAAAR,KAAI,UAAU,kBAAqB,IAAAQ,QACpC,EAAC,YAAY,WAAW,YAAY,OAAM,IAAI,YAAY;AAAA,MAC9D,IAAAR;AAAA,MACA,YAAY,oBAAoB,OAAO;AAAA,IACxC,CAAA,GAEK,WAAWA,SAAO,UAAA,OAAA,SAAA,OAAQ,KAE1B,QAAQ;AAAA,MACZ,OACG;AAAA,QACC,WAAW,IAAI,UAAU,SAAS,SAAS;AAAA,QAC3C;AAAA,QACA,eAAe,SAAS,SAAS;AAAA,MAAA;AAAA,MAErC,CAAC,WAAW,YAAY,MAAM;AAAA,OAI1B,SAAS;AAAA,MACb,CAAC,SAAgC;AACpB,mBAAA,IAAI,GACX,OAAO,OAAQ,aACjB,IAAI,IAAI,IACC,QACT,IAAI,UAAU;AAAA,MAElB;AAAA,MACA,CAAC,KAAK,UAAU;AAAA,IAAA;AAIhB,WAAA;AAAA,MAACmK;AAAAA,MAAA;AAAA,QACC,KAAK;AAAA,QACL;AAAA,QACA,SAAS;AAAA,QACT,WAAW,WAAW,yBAAyB;AAAA,QAC/C,cAAY3J,OAAM,YAAY;AAAA,QAE7B;AAAA,MAAA;AAAA,IAAA;AAAA,EAGP;AACF;AAYO,SAAS,KAAKA,QAAkB;AAC/B,QAAA,EAAC,YAAY,eAAe,iBAAiB,UAAU,GAAG,KAAQ,IAAAA,QAGlE,gBAAgB;AAAA,IACpB,CAAC,UAAgD;AAClC,oBAAA,QAAA,WAAA,KAAA;AAAA,IACf;AAAA,IACA,CAAC,UAAU;AAAA,EAAA;AAGb,SAAO,WACL;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,YAAY;AAAA,MACZ;AAAA,MACA;AAAA,MACC,GAAG;AAAA,IAAA;AAAA,EAGN,IAAA,oBAAC,MAAM,EAAA,GAAG,KAAM,CAAA;AAEpB;AAaO,MAAM,OAAO,WAAW,SAC7BA,QACA,KACA;AACA,QAAM,EAAC,UAAU,GAAG,KAAA,IAAQA;AAC5B,6BACG,sBAAsB,UAAtB,EAA+B,OAAOA,OAAM,IAC1C,UAAW,WAAA,oBAAC,oBAAiB,KAAW,GAAG,MAAM,IAAK,oBAAC2J,cAAS,KAAW,GAAG,MAAM,EACvF,CAAA;AAEJ,CAAC;ACrNM,SAASzI,uBAAqB,QAAgD;AACnF,SAAO,eAAe,OAAO,KAAK,MAAM,OAAO,KAAK;AACtD;AAEO,SAASE,iBAAe,MAIpB;AACT,QAAM,EAAC,MAAM,QAAQ,cAAa,MAC5B,uBAAuB,UAAU,SAAS,UAAU,OACpD,sBAAsB,IAAI,UAAU,QACpC,UAAU,OAAO,KAAK,KAAK;AAE1B,SAAA;AAAA,IACL,sBAAsB,KAAK,eAAe,mBAAmB;AAAA,IAC7D,UAAUF,uBAAqB,MAAM;AAAA,IACrC,sBAAsB,KAAK,SAAS,IAAI,mBAAmB,MAAM,OAAO;AAAA,IACxE,uBAAuB,KAAK,SAAS,oBAAoB;AAAA,EAExD,EAAA,OAAO,OAAO,EACd,KAAK,GAAG;AACb;ACdO,SAAS,cAAqB,WAAiC;AACpE,SAAO,OAAO,SAAS;AAAA,IACrB,CAAClB,WAA+D;AACxD,YAAA,EAAC,SAAS,YAAWA,QACrB,EAAC,MAAM,OAAO,OAAM,IAAI,YAAYA,OAAM,KAAK,GAE/C,SAAS,EAAC,OAAO,UAAU,IAAI,GAAG,OAAO;AAExC,aAAA;AAAA,mCACsBkB,uBAAqB,MAAM,CAAC;AAAA;AAAA,yBAEtC,IAAI,OAAO,WAAW,OAAA,UAAA,CAAC,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,qCAKbE,iBAAe;AAAA,QACxC;AAAA,QACA,MAAM;AAAA,QACN,WAAW;AAAA,UACT,GAAG,KAAK;AAAA;AAAA;AAAA,UAGR,QAAQ;AAAA,QACV;AAAA,MAAA,CACD,CAAC;AAAA;AAAA;AAAA,IAGR;AAAA,EAAA;AAEJ;AC7BO,SAAS,mBAAmB,cAA6C;AAC1E,SAAA,aAAa,SAAS,aAAa,MAAM,SAAS,IAC7C,QAAQ,QAAQ,MAAM,KAAK,aAAa,SAAS,CAAA,CAAE,CAAC,IAEtD,eAAe,MAAM,KAAK,aAAa,SAAS,EAAE,CAAC,EAAE,KAAKoC,SAAO;AAC1E;AAEO,SAAS,oBAAoB,cAA4B;AAC9D,QAAM,QAAgB,MAAM,KAAK,aAAa,SAAS,CAAE,CAAA,GACnD,QAA4B,MAAM,KAAK,aAAa,SAAS,CAAE,CAAA;AACrE,SAAI,SAAS,MAAM,SAAS,IACnB,QAAQ,QAAQ,KAAK,IAEvB,eAAe,KAAK,EAAE,KAAKA,SAAO;AAC3C;AAEA,SAAS,QAAW,GAAkB;AACpC,SAAO,MAAM,OAAO,KAAK,CAAC,CAAC;AAC7B;AAEA,SAAS,eAAe,OAA2B;AACjD,SAAO,QAAQ;AAAA,IACb,MAAM,IAAI,CAAC,SAAS;AAElB,UAAI,KAAK,SAAS,UAAU,KAAK,kBAAkB;AAC7C,YAAA;AAEA,YAAA;AACF,kBAAQ,KAAK;QAAiB,QAClB;AACL,iBAAA,QAAQ,KAAK,UAAA,CAAW;AAAA,QACjC;AACK,eAAA,QAGE,MAAM,cAAc,KAAK,KAAc,IAAI,QAAQ,KAAK,UAAW,CAAA,IAFjE,CAAA;AAAA,MAGX;AAEI,UAAA,KAAK,SAAS,QAAQ;AAClB,cAAA,OAAO,KAAK;AAClB,eAAO,QAAQ,QAAQ,OAAO,CAAC,IAAI,IAAI,CAAA,CAAE;AAAA,MAC3C;AAEI,aAAA,KAAK,SAAS,YAIhB,QAAQ,KAAK,4DAA4D,GAClE,QAAQ,QAAQ,CAAA,CAAE,MAG3B,QAAQ,KAAK,qCAAqC,KAAK,IAAI,GACpD,QAAQ,QAAQ,CAAE,CAAA;AAAA,IAAA,CAC1B;AAAA,EAAA;AAEL;AA4BA,SAAS,KAAK,OAA+B;AAC3C,MAAI,MAAM;AACD,WAAA,IAAI,QAAc,CAAC,SAAS,WAAW,MAAM,KAAK,SAAS,MAAM,CAAC,EAAE;AAAA,MACzE,CAAC,SAAe,CAAC,IAAI;AAAA,IAAA;AAIzB,MAAI,MAAM,aAAa;AACf,UAAA,MAAM,MAAM;AAClB,WAAO,IAAI,QAAiB,CAAC,SAAS,WAAW,IAAI,YAAY,SAAS,MAAM,CAAC,EAC9E,KAAK,CAAC,YAAY,QAAQ,OAAO,CAAC,SAAS,CAAC,KAAK,KAAK,WAAW,GAAG,CAAC,CAAC,EACtE,KAAK,CAAC,YAAY,QAAQ,IAAI,QAAQ,IAAI,IAAI,CAAC,EAAE,KAAKA,SAAO,CAAC;AAAA,EACnE;AACO,SAAA,QAAQ,QAAQ,CAAA,CAAE;AAC3B;AC3GO,SAAS,eACd,UACA1B,UAAS,cACT,UAAU,GACY;AACtB,SAAI,SAAS,MAAM,uBAAuB,IACjC,QAAQ,OAAO,IAAI,MAAM,iDAAiD,CAAC,IAE7E,IAAI,QAAQ,CAAC,SAAS,WAAW;AAChC,UAAA,SAAS,IAAI;AACnB,WAAO,cAAc,aACrB,OAAO,iBAAiB,mCACxB,OAAO,SAAS,MAAM;AACd,YAAA,SAAS,SAAS,cAAc,QAAQ;AAC9C,aAAO,QAAQ,OAAO,OACtB,OAAO,SAAS,OAAO;AACjB,YAAA,MAAM,OAAO,WAAW,IAAI;AAClC,aAAA,QAAA,IAAK,UAAU,QAAQ,GAAG,GAAG,OAAO,OAAO,OAAO,MAAA;AAC9C,UAAA;AACK,eAAA,OAAO,SAASA,SAAQ,OAAO;AAAA,eAC/B,OAAO;AACd,eAAO,KAAK;AAAA,MACd;AAAA,IAAA,GAEF,OAAO,MAAM;AAAA,EAAA,CACd;AACH;ACmBA,MAAM,oBAAoB,EAAC,SAAS,GAAG,UAAU,WAAU;AAMpD,SAAS,WAA2BD,YAA0C;AAC5E,SAAA,WAAW,SAChB7B,QACA,KACA;AACA,UAAM,EAAC,SAAS,aAAa,YAAY,UAAU,GAAG,KAAI,IAAIA,QAExD,CAAC,gBAAgB,iBAAiB,IAAI,SAAS,EAAK,GAEpD,aAAa,OAA8B,IAAI,GAC/C,eAAe,gBAAgB,GAAG,GAElC,kBAAkB,OAAkB,EAAE,GAEtC,YAAY;AAAA,MAChB,CAAC,UAAkB;AACP,mBAAA,QAAA,QAAA,KAAA;AAAA,MACZ;AAAA,MACA,CAAC,OAAO;AAAA,OAGJ,gBAAgB;AAAA,MACpB,CAAC,UAAyB;AAEtB,cAAM,WAAW,aAAa,YAC7B,MAAM,WAAW,MAAM,YACxB,MAAM,QAAQ,OAEd,kBAAkB,EAAI;AAAA,MAE1B;AAAA,MACA,CAAC,YAAY;AAAA,OAET,cAAc;AAAA,MAClB,CAAC,UAA0B;AACN,2BAAA,MAAM,aAAa,EACnC,KAAK,CAAC,UACA,WAAW,UAGT,MAAM,SAAS,IAClB;AAAA;AAAA,UAEA,4CAA4C,WAAW,SAAS,YAAY;AAAA,YALvE,EAMV,EACA,KAAK,CAAC,UAAU;AAhG3B,cAAAW;AAiGY,oBAAU,KAAK,GACf,kBAAkB,EAAK,IACvBA,MAAA,aAAa,YAAb,QAAsBA,IAAA,MAAA;AAAA,QAAA,CACvB;AAAA,MACL;AAAA,MACA,CAAC,WAAW,YAAY;AAAA,OAEpB,aAAa;AAAA,MACjB,CAAC,UAAqB;AACpB,wBAAgB,UAAU,IAC1B,MAAM,kBACN,MAAM;AACA,cAAA,eAAe,MAAM,YAAY;AACnC,mBAAW,gBACb,oBAAoB,YAAY,EAAE,KAAK,CAAC,UAAU;AAC5C,mBACF,UAAU,KAAK;AAAA,QAElB,CAAA,GAEH,cAAA,QAAA;MACF;AAAA,MACA,CAAC,WAAW,SAAS,UAAU;AAAA,OAG3B,iBAAiB;AAAA,MACrB,CAAC,UAAqB;AAChB,oBACF,MAAM,eAAe,GACrB,MAAM,gBAAgB;AAAA,MAE1B;AAAA,MACA,CAAC,OAAO;AAAA,OAGJ,kBAAkB;AAAA,MACtB,CAAC,UAAqB;AAGpB,YAFA,MAAM,mBAEF,eAAe,aAAa,YAAY,MAAM,eAAe;AAK/C,0BAAA,UAAU,CAAC,GAAG,IAAI,IAAI,gBAAgB,OAAO,GAAG,MAAM,aAAa;AAE7E,gBAAA,YAAY,MAAM,KAAK,MAAM,aAAa,KAAK,EAAE,IAAI,CAAC,UAAU;AAAA,YACpE,MAAM,KAAK;AAAA,YACX,MAAM,KAAK;AAAA,UACX,EAAA;AACF,sBAAY,SAAS;AAAA,QACvB;AAAA,MACF;AAAA,MACA,CAAC,aAAa,YAAY;AAAA,OAGtB,kBAAkB;AAAA,MACtB,CAAC,UAAqB;AACpB,cAAM,gBAAgB;AACtB,cAAM,MAAM,gBAAgB,QAAQ,QAAQ,MAAM,aAAa;AAC3D,cAAM,MACR,gBAAgB,QAAQ,OAAO,KAAK,CAAC,GAEnC,gBAAgB,QAAQ,WAAW,MACrC,cAAA,QAAA,WAAA;AAAA,MAEJ;AAAA,MACA,CAAC,UAAU;AAAA,IACb,GAEM,qBAAqB,OAAO,EAAK;AACvC,WAAA,UAAU,MAAM;AAxKpB,UAAAA;AAyKU,OAAC,mBAAmB,WAAW,kBAAkB,WAAW,WAC9D,WAAW,QAAQ,MAAA,GACnB,OAAO,WAAW,OAAO,KAChB,mBAAmB,WAAW,CAAC,oBACxCA,iBAAW,YAAX,QAAAA,IAAoB,MAEtB,IAAA,mBAAmB,UAAU;AAAA,IAAA,GAC5B,CAAC,cAAc,CAAC,GAIf,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAA;AAAA,QAACkB;AAAA,QAAA;AAAA,UACE,GAAI;AAAA,UACL,KAAK;AAAA,UACL,WAAW,WAAW,SAAY;AAAA,UAClC,YAAY,WAAW,SAAY;AAAA,UACnC,aAAa,WAAW,SAAY;AAAA,UACpC,aAAa,WAAW,SAAY;AAAA,UACpC,QAAQ,WAAW,SAAY;AAAA,QAAA;AAAA,MACjC;AAAA,MACC,CAAC,YAAY,kBACZ,oBAAC,OAAI,EAAA,iBAAe,IAAC,SAAS,aAAa,KAAK,YAAY,OAAO,kBAAmB,CAAA;AAAA,IAE1F,EAAA,CAAA;AAAA,EAAA,CAEH;AACH;AAGA,SAAS,4CACP,SACA,eAAe,cACE;AACZ,SAAA,QAAQ,oBAON,IAAI,QAAQ,CAAC,YAAY,WAAW,SAAS,EAAE,CAAC,EACpD,KAAK,MAAM,MAAM,KAAK,QAAQ,iBAAiB,KAAK,CAAC,CAAC,EACtD,KAAK,CAAC,mBACL,QAAQ,YAAY,IACb,cACR,EACA,KAAK,CAAC,WAAW,QAAQ,IAAI,OAAO,IAAI,CAAC,QAAQ,eAAe,IAAI,GAAG,CAAC,CAAC,CAAC,EAC1E;AAAA,IAAK,CAAC,eACL,WAAW,IAAI,CAAC,SAAS,IAAI,KAAK,CAAC,IAAK,GAAG,oBAAoB,EAAC,MAAM,aAAa,CAAA,CAAC;AAAA,MAd/E,QAAQ;AAAA,IACb,IAAI;AAAA,MACF,sFAAsF,QAAQ,OAAO;AAAA,IACvG;AAAA,EAAA;AAaN;AAGA,SAAS,OAAO,IAAa;AACrB,QAAA0F,SAAQ,SAAS;AACvB,EAAAA,OAAM,mBAAmB,EAAE;AACrB,QAAA,MAAM,OAAO;AACd,SAAA,QAAA,IAAA,gBAAA,GACL,mBAAK,SAASA,MAAA;AAChB;ACvNO,SAAS,YAAYvH,QAAc;AACxC,QAAM,EAAC,eAAe,OAAO,iBAAA4G,iBAAmB,IAAA5G,QAC1C,gBAAgB,cAAc;AAAA,IAAO,CAAC,SAC1C,MAAM,KAAK,CAAC,SAAS4G,iBAAgB,MAAM,IAAI,CAAC;AAAA,EAE5C,GAAA,qBAAqB,cAAc,SAAS,cAAc,QAC1D,WAAW,MAAM,SAAS,GAC1B,EAAC,GAAA/F,OAAK,eAAe;AAC3B,SAEK,oBAAA,UAAA,EAAA,UAAA,cAAc,SAAS,IAEpB,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAC,qBAAA,QAAA,EAAO,OAAO,GACb,UAAA;AAAA,MAAC,oBAAAc,QAAA,EACC,UAAC,oBAAA,YAAA,CAAW,CAAA,GACd;AAAA,MACC,WACGd,GAAE,yDAAyD;AAAA,QACzD,OAAO,cAAc;AAAA,MAAA,CACtB,IACDA,GAAE,iDAAiD;AAAA,0BACtDc,QAAK,EAAA;AAAA,IAAA,GACR;AAAA,IACC,qBAAqB,KACnB,oBAAA,KAAA,EAAI,WAAW,GACd,UAAA,qBAAC,QAAO,EAAA,OAAO,GACb,UAAA;AAAA,MAAA,oBAACA,UAAK,OAAK,IAAC,MAAM,GAChB,UAAA,oBAAC,oBAAiB,EACpB,CAAA;AAAA,0BACCA,QAAK,EAAA,OAAK,IAAC,MAAM,GACf,aAAE,yEAAyE;AAAA,QAC1E,OAAO;AAAA,MACR,CAAA,GACH;AAAA,IAAA,EAAA,CACF,EACF,CAAA;AAAA,EAAA,EAEJ,CAAA,IAEA,qBAAC,QAAO,EAAA,OAAO,GACb,UAAA;AAAA,IAAC,oBAAAA,QAAA,EACC,UAAC,oBAAA,kBAAA,CAAiB,CAAA,GACpB;AAAA,IACA,oBAACA,QACE,EAAA,UAAAd,GAAE,4EAA4E;AAAA,MAC7E,OAAO,cAAc;AAAA,IACtB,CAAA,GACH;AAAA,EAAA,EACF,CAAA,EAEJ,CAAA;AAEJ;AC9Da,MAAA+I,YAAU,OAAO,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GCmC7B5E,SAAO,OAAO;AAAA;AAAA;AAIpB,SAAS,oBACP,OACA4B,kBACA,MACA;AACO,SAAA,MACJ,IAAI,CAAC,gBAAgB;AAAA,IACpB,MAAM;AAAA,IACN,UAAUA,iBAAgB,YAAY,IAAI;AAAA,EAAA,EAC1C,EACD,OAAO,CAAC,WAAW,OAAO,QAAQ;AACvC;AACO,SAAS,aAAoB/E,YAAiC;AAC7D,QAAAgI,cAAa,WAAkBhI,UAAS;AAEvC,SAAA,WAAW,SAChB7B,QACA,cACA;AACM,UAAA,EAAC,UAAU,iBAAA4G,kBAAiB,UAAU,OAAO,GAAG,SAAQ5G,QACxD,EAAC,MAAM,UAAS,IAAI,YACpB,EAAC,GAAAa,OAAK,eAAA,GAENiJ,cAAa;AAAA,MACjB,CAAC,MAAY,qBAAuC;AAC5C,cAAA,EAAC,MAAM,SAAY,IAAA;AACzB,oBAAA,QAAA,SAAW,EAAC,MAAM,YAAY,MAAM,SAAQ,CAAA;AAAA,MAC9C;AAAA,MACA,CAAC,QAAQ;AAAA,OAGL,cAAc;AAAA,MAClB,CAAC,UAAkB;AACjB,YAAI,CAAClD;AACH;AAEF,cAAM,QAAsB,MAAM,IAAI,CAAC,UAAU;AAAA,UAC/C;AAAA,UACA,oBAAoB,oBAAoB,OAAOA,kBAAiB,IAAI;AAAA,QAAA,EACpE,GACI,QAAQ,MAAM,OAAO,CAAC,SAAS,KAAK,mBAAmB,SAAS,CAAC,GACjE,WAAyB,MAAM,OAAO,CAAC,SAAS,KAAK,mBAAmB,WAAW,CAAC;AAEtF,iBAAS,SAAS,KACpB,UAAU;AAAA,UACR,UAAU;AAAA,UACV,QAAQ;AAAA,UACR,OAAO/F,GAAE,sDAAsD;AAAA,YAC7D,OAAO,SAAS;AAAA,UAAA,CACjB;AAAA,UACD,aAAa,SAAS,IAAI,CAAC,MAAM,MAC/B,qBAAC,MAAa,EAAA,KAAK,GAAG,SAAS,GAC7B,UAAA;AAAA,YAAC,oBAAA,KAAA,EACC,8BAACc,QAAK,EAAA,QAAO,UAAU,UAAK,KAAA,KAAK,MAAK,EACxC,CAAA;AAAA,YACC,oBAAA,KAAA,EACC,UAAC,qBAAAA,QAAA,EAAK,MAAM,GAAG,UAAA;AAAA,cAAA;AAAA,cAAE,KAAK,KAAK;AAAA,cAAK;AAAA,YAAA,EAAA,CAAC,EACnC,CAAA;AAAA,UAAA,EAAA,GANS,CAOX,CACD;AAAA,QACF,CAAA,GAOH,MAAM,QAAQ,CAAC,SAAS;AACtB,UAAAmI;AAAA,YACE,KAAK;AAAA;AAAA,YAEL,OAAO,KAAK,oBAAoB,CAAC,cAAc,UAAU,SAAS,QAAQ,EAAE,CAAC;AAAA,UAAA;AAAA,QAC/E,CACD;AAAA,MACH;AAAA,MACA,CAAC,WAAWlD,kBAAiB,OAAOkD,aAAYjJ,EAAC;AAAA,OAG7C,CAAC,eAAe,gBAAgB,IAAI,SAAqB,CAAA,CAAE,GAC3D,iBAAiB,YAAY,MAAM,iBAAiB,EAAE,GAAG,CAAE,CAAA;AAEjE,+BACGmE,QACC,EAAA,UAAA;AAAA,MAAC6E;AAAA,MAAA;AAAA,QACE,GAAG;AAAA,QACJ,KAAK;AAAA,QACL,SAAS;AAAA,QACT,aAAa;AAAA,QACb,YAAY;AAAA,QAEX,UAAA;AAAA,UAAAjD,oBAAmB,cAAc,SAAS,KACxC,oBAAAgD,WAAA,EAAQ,SAAS,IAChB,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA;AAAA,cACA,iBAAAhD;AAAA,YAAA;AAAA,UAAA,GAEJ;AAAA,UAED;AAAA,QAAA;AAAA,MAAA;AAAA,IAEL,EAAA,CAAA;AAAA,EAAA,CAEH;AACH;AC7IO,MAAM,mBAAmB,cAAc,aAAa,IAAI,CAAC,GCU1DxB,kBAA4C;AAAA,EAChD,eAAe;AAAA,EACf,QAAQ;AAAA,EACR,oBAAoB,CAAC,OAAO,QAAQ;AACtC;AAKO,SAAS,wBAGdpF,QAAmD;AACnD,QAAM,EAAC,YAAY,UAAU,UAAU,eAAe,iBAAgBA,QAChE,eAAe,SACf,EAAC,GAAAa,GAAK,IAAA,eAAA,GAEN,aAAa;AAAA,IACjB,CAAC,aAAkB;AACX,YAAA,OAAO,cAAc,QAAQ;AAEnC,mBAAa,IAAI;AAAA,IACnB;AAAA,IACA,CAAC,eAAe,YAAY;AAAA,EAAA,GAGxB,oBAAoB,YAAY,MAAM;AAC/B,eAAA,WAAW,GAAG,CAAC,CAAC;AAAA,EAC7B,GAAG,CAAC,YAAY,UAAU,CAAC,GAIrB,iBACJ,WAAW,GAAG,SAAS,IACnB,6CACA;AAEN,SAAI,WAEC,oBAAA,SAAA,EAAQ,QAAM,IAAC,SAASA,GAAE,8BAA8B,GACvD,UAAA,oBAAC,QACC,UAAC,oBAAA,QAAA,EAAO,MAAM,SAAS,MAAK,SAAQ,UAAQ,IAAC,MAAK,SAAQ,MAAMA,GAAE,cAAc,EAAG,CAAA,GACrF,EACF,CAAA,IAKD,qBAAA,MAAA,EAAK,KAAK,GAAG,OAAO,EAAC,qBAAqB,uCACxC,GAAA,UAAA;AAAA,IAAW,WAAA,GAAG,WAAW,IACxB;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAK;AAAA,QACL,MAAMA,GAAE,cAAc;AAAA,MAAA;AAAA,IAAA,IAGxB;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ,oBAAC,QAAO,EAAA,MAAM,SAAS,MAAK,SAAQ,MAAK,SAAQ,MAAMA,GAAE,cAAc,EAAG,CAAA;AAAA,QAClF,IAAI,gBAAgB;AAAA,QACpB,0BACG,MACE,EAAA,UAAA,WAAW,GAAG,IAAI,CAAC,WAAW,MAAM;AA9EnD,cAAAF,KAAA;AAgFsB,gBAAA,gBACJ,sBAAsB,SAAS,MAC9B,UAAU,MAAM,IAAI,WAAW,KAChC,UAAU,GAAG,CAAC,EAAE,MAEZ,OAAO,UAAU,UAAQA,MAAA,UAAU,SAAV,OAAA,SAAAA,IAAgB,SAAQ;AAErD,iBAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cAEC,MAAM,UAAU,WAAS,KAAA,UAAU,SAAV,OAAgB,SAAA,GAAA;AAAA,cACzC,SAAS,MAAM,WAAW,SAAS;AAAA,cACnC;AAAA,YAAA;AAAA,YAHK;AAAA,UAAA;AAAA,QAMV,CAAA,GACH;AAAA,QAEF,SAASyE;AAAAA,MAAA;AAAA,IACX;AAAA,IAGD;AAAA,EACH,EAAA,CAAA;AAEJ;ACtFA,MAAM,aAAa,OAAO,IAAI;AAAA;AAAA,GAGxB,eAAe,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,GAO1B,iBAAiB,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA,GAK5BJ,SAAO,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAMlB,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAMZ,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMjB,sBAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBpB,SAAS,WAAWhF,QAAqD;AACxE,QAAA,EAAC,YAAAmF,aAAY,UAAU,MAAM,UAAU,UAAU,YAAY,MAAM,QAAQ,GAAG,KAAA,IAAQnF;AAG1F,SAAA;AAAA,IAACgF;AAAAA,IAAA;AAAA,MACC,aAAa;AAAA,MACb,WAAU;AAAA,MACV,QAAM;AAAA,MACN;AAAA,MACA,iBAAe;AAAA,MACf,QAAQ;AAAA,MACR;AAAA,MACC,GAAG;AAAA,MAEH,UAAA;AAAA,QAAA;AAAA,QAEA,cACC;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,QAAQ;AAAA,YACR,QAAQ;AAAA,YACR,SAAQ;AAAA,YACR,MAAK;AAAA,YACL,WAAQ;AAAA,YAER,UAAC,oBAAA,YAAA,EAAW,OAAK,IAAC,MAAK,SAAQ;AAAA,UAAA;AAAA,QACjC;AAAA,QAGD,YACE,oBAAA,cAAA,EAAa,OAAM,UAAS,SAAS,GACnC,UACH,UAAA;AAAA,QAGF,qBAAC,cAAW,OAAM,UAAS,UAAU,GAAG,QAAO,UAAS,SAAQ,iBAC9D,UAAA;AAAA,UAAA,oBAAC,QAAM,UAAWG,YAAA,CAAA;AAAA,UAClB,oBAAC,OAAK,UAAO,OAAA,CAAA;AAAA,UACZ;AAAA,QAAA,GACH;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;ACnGA,MAAMY,gBAAc,OAAO,IAAI;AAAA,eAChB,CAAC,EAAC,YAA2B,MAAM,OAAO,UAAU,CAAC,CAAC;AAAA;AAS9D,SAASC,uBAAqBhG,QAAc;AAC3C,QAAA,EAAC,OAAO,SAAS,UAAU,GAAG,KAAQ,IAAAA,QACtC,CAAC,aAAa,cAAc,IAAI,SAAS,EAAK,GAC9C,CAAC,YAAY,aAAa,IAAI,SAA6B,IAAI,GAE/D,EAAC,GAAAa,OAAK;AAEZ,kBAAgB,MAAM,eAAe,EAAK,GAAG,CAAC,UAAU,CAAC;AAEnD,QAAA,gBAAgB,YAAY,CAAC,MAAW;AAC5C,KAAI,EAAE,QAAQ,YAAY,EAAE,QAAQ,UAClC,eAAe,EAAK;AAAA,KAErB,EAAE,GAEC,oBAAoB,YAAY,MAAM;AAC3B,mBAAA,CAAC,MAAM,CAAC,CAAC;AAAA,KACvB,CAAE,CAAA,GAEC,WAAW+E,kBAAgB,KAAK;AAEpC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAM;AAAA,MACN,KAAK;AAAA,MACL,WAAW;AAAA,MACX,QAAM;AAAA,MACN,eAAa;AAAA,MACb,MAAK;AAAA,MACL,SACG,oBAAAG,eAAA,EAAY,QAAQ,GAAG,SAAS,GAAG,WAAW,eAAe,UAAU,GAAG,UAAS,QAClF,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,QAAC,oBAAA,KAAA,EACC,8BAACpE,QAAK,EAAA,QAAO,UAAU,UAAEd,GAAA,+CAA+C,GAAE,EAC5E,CAAA;AAAA,QACA,oBAACc,QAAK,EAAA,MAAM,GACV,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAd;AAAA,YACA,SAAQ;AAAA,YACR,QAAQ,EAAC,SAAQ;AAAA,UAAA;AAAA,QAAA,GAErB;AAAA,QACC,oBAAA,KAAA,EACC,UAAC,qBAAAc,QAAA,EAAK,MAAM,GACV,UAAA;AAAA,UAAA,oBAAC,iBAAgB,EAAA;AAAA,UAAE;AAAA,UAAEd,GAAE,uDAAuD;AAAA,QAAA,EAAA,CAChF,EACF,CAAA;AAAA,QACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAA,oBAACc,UAAK,MAAM,GAAG,QAAO,UACnB,UAAAd,GAAE,oDAAoD,GACzD;AAAA,UACA,oBAAC,QAAK,SAAS,GAAG,UAAS,QAAO,QAAM,IACtC,UAAA,oBAAC,MAAK,EAAA,MAAM,GAAG,IAAG,OAAM,UAAS,QAC9B,UAAA,KAAK,UAAU,OAAO,MAAM,CAAC,EAAA,CAChC,EACF,CAAA;AAAA,QAAA,GACF;AAAA,MAAA,EAAA,CACF,EACF,CAAA;AAAA,MAGF,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAG;AAAA,UACH,MAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAK;AAAA,UACL,UAAU;AAAA,UACV,UAAU;AAAA,UACV,OAAO,EAAC,QAAQ,OAAM;AAAA,UACtB;AAAA,UACA,SAAS;AAAA,UACT,WAAW;AAAA,UACX,sBAAoB;AAAA,UACnB,GAAG;AAAA,UAEJ,UAAC,qBAAA,OAAA,EAAM,OAAO,GAAG,WAAW,GAC1B,UAAA;AAAA,YAAA,oBAAC,KAAI,EAAA,QAAQ,GACX,UAAA,oBAACc,QAAK,EAAA,OAAM,UAAS,MAAM,GACzB,UAAA,oBAAC,aAAY,CAAA,CAAA,EACf,CAAA,GACF;AAAA,YACC,oBAAAA,QAAA,EAAK,OAAM,UAAS,MAAM,GACzB,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,GAAAd;AAAA,gBACA,SAAQ;AAAA,gBACR,QAAQ,EAAC,SAAQ;AAAA,cAAA;AAAA,YAAA,GAErB;AAAA,UAAA,GACF;AAAA,QAAA;AAAA,MACF;AAAA,IAAA;AAAA,EAAA;AAGN;ACjGA,MAAM6H,uBAAqB,EAAC,QAAQ,IAAM,MAAM,UAAS;AAElD,SAASqB,YAAU/J,QAAqD;AACvE,QAAA,EAAC,QAAQ,SAAQ,IAAIA,QACrBR,MAAK,MAAA,GACL,EAAC,aAAY,iBAAiB,GAC9B,EAAC,GAAAqB,GAAC,IAAI,kBAEN,eAAe,YAAY,MAAM;AACrC,aAAS,WAAW,KAAK,CAAC,MAAM,CAAC,EAAC,MAAM,OAAO,IAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AAAA,EACtD,GAAA,CAAC,UAAU,OAAO,GAAG,CAAC;AAGvB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,YAAY;AAAA,MACZ,MAAK;AAAA,MACL,OAAO,EAAC,QAAQ,OAAM;AAAA,MACtB,MACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAQ,oBAAC,mBAAkB,EAAA,UAAU,EAAG,CAAA;AAAA,UACxC,IAAI,GAAGrB,GAAE;AAAA,UACT,0BACG,MACC,EAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAMqB,GAAE,yCAAyC;AAAA,cACjD,MAAK;AAAA,cACL,MAAM;AAAA,cACN,SAAS;AAAA,YAAA;AAAA,UAAA,GAEb;AAAA,UAEF,SAAS6H;AAAAA,QAAA;AAAA,MACX;AAAA,MAGD,UAAA,OAAO,MAAM,SAAS,0CACpB1C,wBAAqB,EAAA,OAAO,OAAO,MAAM,OAAO,UAAQ,GAAC,CAAA,IAE1D,oBAAC,OAAK,EAAA,UAAAnF,GAAE,uCAAuC,EAAC,OAAO,OAAO,MAAM,KAAI,CAAC,EAAE,CAAA;AAAA,IAAA;AAAA,EAAA;AAInF;ACrDgB,SAAA,aAAa,OAAyB,IAAY;AAChE,SAAO,KAAK,OAAe,CAAC,QAAQ,SAAS,MAAM;AACjD,UAAM,cAAc,OAAO;AAC3B,QAAI,gBAAgB;AACX,aAAA,GAAG,MAAM,IAAI,OAAO;AAG7B,QAAI,gBAAgB;AAEX,aAAA,GAAG,MAAM,GADE,MAAM,IAAI,KAAK,GACL,GAAG,OAAO;AAGxC,QAAI,cAAc,OAAO;AACvB,aAAO,GAAG,MAAM,WAAW,QAAQ,IAAI;AAGzC,UAAM,IAAI,MAAM,6BAA6B,OAAO,GAAG;AAAA,KACtD,EAAE;AACP;ACfO,SAAST,gBAAiBS,IAA2B;AACnD,SAAAA,OAAM,QAAQA,OAAM;AAC7B;AAEgB,SAAA,0BACd,iBACA,OACA,SACoB;AACpB,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,iBAAiB;AAGnC,MAAI,oBAAoB;AAAM,WAAO;AAEjC,MAAA,MAAM,QAAQ,eAAe;AACxB,WAAA,gBACJ,QAAQ,CAAC,UAAU,0BAA0B,OAAO,OAAO,OAAO,CAAC,EACnE,OAAOT,eAAa;AAGzB,MAAI,OAAO,mBAAoB;AAC7B,WAAO,0BAA0B,EAAC,SAAS,gBAAe,GAAG,OAAO,OAAO;AAGzE,MAAA,OAAO,gBAAgB,WAAY;AAGrC,UAAM,IAAI;AAAA,MACR,GAAG;AAAA,QACD,QAAQ;AAAA,MACT,CAAA;AAAA,IAAA;AAIL,QAAM,EAAC,QAAW,IAAA,iBAEZ,kBAA0B,CAAA;AAC5B,kBAAgB,QAClB,gBAAgB,KAAK,gBAAgB,IAAI;AAIhC,aAAA,QAAQ,gBAAgB,SAAS,CAAC;AAC3C,oBAAgB,KAAK,IAAI;AAK3B,SAAK,gBAAgB,SAcd,gBAAgB,IAAI,CAAC,UAAU;AAAA,IACpC,OAAO,QAAQ,QAAQ,CAAA,GAAI,OAAO,IAAI;AAAA,IACtC,OAAO,SAAS;AAAA,IAChB,MAAM,EAAC,QAAO;AAAA,IACd;AAAA,IACA,IAlBO;AAAA,IACL;AAAA,MACE,OAAO,SAAS;AAAA,MAChB,MAAM,EAAC,QAAO;AAAA,MACd;AAAA,MACA,MAAM,QAAQ,QAAQ,CAAC;AAAA,IACzB;AAAA,EAAA;AAaN;ACzEO,SAAS,YAAY,QAAwB;AAE3C,SAAA,OAAO,QAAQ,+CAA+C,MAAM;AAC7E;ACSgB,SAAA,gBAAgB,SAAsC,MAA4B;AAChG,QAAM,EAAC,cAAA,IAAiB,MAClB,SAAS,cAAc;AAG7B,MAAI,QAAQ,MAAM;AAChB,WAAO,QAAQ,MAAM;AAInB,MAAA,OAAO,SAAS,GAAG,GAAG;AACxB,UAAM,WAAW,OAAO,MAAM,KAAK,CAAC,EAAE,CAAC;AACvC,QAAI,QAAQ,QAAQ;AAClB,aAAO,QAAQ,QAAQ;AAAA,EAE3B;AAGA,SACE,QAAQ,OAAO,KAAK,QAAQ,OAAO,KAAK,QAAQ,MAAM;AAE1D;AASO,SAAS,oBACd,SACwC;AACxC,SACE,YAAY,MACZ,OAAO,UAAY,OACnB,OAAO,WAAY,YACnB,cAAc,OAAO,KACrB,EAAE,aAAa;AAEnB;AC3CgB,SAAA,WAAW,GAAY,GAAqB;AAC1D,MAAI,MAAM;AACD,WAAA;AAGT,MAAI,MAAM,QAAQ,CAAC,KAAK,MAAM,QAAQ,CAAC,GAAG;AACpC,QAAA,EAAE,UAAU,EAAE;AAAe,aAAA;AACjC,aAAS,IAAI,GAAG,IAAI,EAAE,QAAQ;AAC5B,UAAI,CAAC,WAAW,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;AACjB,eAAA;AAGJ,WAAA;AAAA,EACT;AAEA,MAAI,MAAM,QAAQ,CAAC,KAAK,MAAM,QAAQ,CAAC;AAC9B,WAAA;AAGT,MAAI,KAAK,KAAK,OAAO,KAAM,YAAY,OAAO,KAAM,UAAU;AACtD,UAAA,OAAO,OAAO,KAAK,CAAC;AAC1B,QAAI,KAAK,WAAW,OAAO,KAAK,CAAC,EAAE;AAC1B,aAAA;AAGL,QAAA,aAAa,QAAQ,aAAa;AACpC,aAAO,EAAE,QAAA,MAAc,EAAE,QAAQ;AAG/B,QAAA,aAAa,QAAQ,aAAa;AAC7B,aAAA;AAGL,QAAA,aAAa,UAAU,aAAa;AACtC,aAAO,EAAE,SAAA,KAAc,EAAE,SAAS;AAGhC,QAAA,aAAa,UAAU,aAAa;AAC/B,aAAA;AAGT,aAAS,IAAI,GAAG,IAAI,KAAK,QAAQ;AAC/B,UAAI,KAAK,CAAC,MAAM,UAIZ,CAAC,OAAO,UAAU,eAAe,KAAK,GAAG,KAAK,CAAC,CAAC;AAC3C,eAAA;AAIX,aAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AAC9B,YAAA,MAAM,KAAK,CAAC;AACd,UAAA,QAAQ,UAIR,CAAC,WAAW,EAAE,GAAG,GAAG,EAAE,GAAG,CAAC;AACrB,eAAA;AAAA,IAEX;AAEO,WAAA;AAAA,EACT;AAEO,SAAA;AACT;AC1EA,MAAM,YAAY,CAAA,EAAG,UAEf,WAAW,CAAC,QAAQ,UAAU,OAAO,QAAQ,SAAS,QAAQ,MAAM,QAAQ,KAAK;AAEvF,SAAS,UAAU,cAAuB;AACxC,WAAS,IAAI,GAAG,IAAI,SAAS,QAAQ;AAC/B,QAAA,SAAS,CAAC,MAAM;AAAqB,aAAA;AAEpC,SAAA;AACT;AAEO,SAAS,WAAW,KAAsB;AAE/C,QAAM,aAAa,UAAU,KAAK,GAAG,EAAE,MAAM,GAAG,EAAE;AAClD,MAAI,OAAQ;AAA2B,WAAO,WAAW;AAGzD,QAAM,kBAAmB,IAAe;AACxC,SAAI,mBAAmB,CAAC,UAAU,eAAe,IAAU,gBAAgB,OACpE;AACT;ACdA,MAAM,yBAAyB,KAEzB,yBAAyB,CAAC,YAK1B;AAfN,MAAAO;AAgBE,SAAI,QAAQ,UAAgB,QAAQ,UAChC,QAAQ,QAAQ,WAAW,KAAUA,MAAQ,QAAA,QAAQ,CAAC,MAAjB,OAAA,SAAAA,IAAoB,UAGtD,QAAQ,KAAK,EAAE,sBAAsB;AAAA,IAC1C,UAAU,QAAQ,QAAQ,IAAI,CAAC,QAAK;AArBxCA,UAAAA;AAqB2C,aAAA,IAAI,aAAWA,OAAA,IAAI,SAAJ,gBAAAA,KAAU;AAAA,IAAA,CAAO;AAAA,IACvE,cAAc,EAAC,UAAU,EAAC,OAAO,QAAQ,MAAM,QAAQ,YAAU;AAAA,EAAA,CAClE;AACH,GAEa,oBAAgC;AAAA,EAC3C,MAAM,CAAC,cAAc,OAAO,SAAS,EAAC,WAAU;AACxC,UAAA,aAAa,WAAW,KAAK;AACnC,WAAI,eAAe,gBAAgB,eAAe,cACzC,WAAW,KAAK,EAAE,qCAAqC,EAAC,YAAY,aAAY,CAAC,IAGnF;AAAA,EACT;AAAA,EAEA,UAAU,CAAC,UAAU,OAAO,SAAS,EAAC,KAAI,MACpC,UAAU,UAAa,aAAa,aAC/B,WAAW,KAAK,EAAE,6BAA6B,IAGjD;AAAA,EAGT,KAAK,OAAO,UAAU,OAAO,SAAS,YAAY;AAEhD,UAAM,WADW,MAAM,QAAQ,IAAI,SAAS,IAAI,CAAC,UAAU,MAAM,SAAS,OAAO,OAAO,CAAC,CAAC,GACjE;AAEzB,WAAI,QAAQ,WAAW,IACd,KAGF,uBAAuB;AAAA,MAC5B;AAAA,MACA;AAAA,MACA,WAAW;AAAA,MACX,MAAM,QAAQ;AAAA,IAAA,CACf;AAAA,EACH;AAAA,EAEA,QAAQ,OAAO,UAAU,OAAO,SAAS,YAAY;AACnD,UAAM,WAAW,MAAM,QAAQ,IAAI,SAAS,IAAI,CAAC,UAAU,MAAM,SAAS,OAAO,OAAO,CAAC,CAAC,GACpF,UAAU,SAAS;AAGrB,WAAA,SAAS,KAAK,CAAC,WAAW,CAAC,OAAO,MAAM,IACnC,KAGF,uBAAuB;AAAA,MAC5B;AAAA,MACA;AAAA,MACA,WAAW;AAAA,MACX,MAAM,QAAQ;AAAA,IAAA,CACf;AAAA,EACH;AAAA,EAEA,OAAO,CAAC,eAAe,QAAQ,SAAS,EAAC,WAAU;AACjD,UAAM,YAAY,OAAO;AACzB,QAAI,cAAc;AACT,aAAA;AAGT,UAAM,SAAS,cAAc,YAAY,cAAc,aAAa,GAAG,MAAM,IACvE,WAAW,SAAS,MAAM,SAAS,KAAK,GAAG,MAAM,MAAM,GAAG,EAAE,CAAC,WAAM;AAElE,WAAA,cAAc,KAAK,CAAC,aAAa,WAAW,UAAU,MAAM,CAAC,IAChE,KACA,WACE,KAAK;AAAA,MACH;AAAA,MACA,QAAQ,EAAC,SAAS,QAAQ,SAAS,EAAC,MAAM,SAAS,EAAA,IAAI,CAAC;AAAA,IAAA;AAAA,EAElE;AAAA,EAEA,QAAQ,OAAO,IAAI,OAAO,SAAS,YAAY;AACvC,UAAA,YAAY,WAAW,MAAM;AAE7B,cAAQ,gBAAgB,YAG5B,QAAQ;AAAA,QACN,uBAAuB;AAAA,UACrB,QAAQ;AAAA,QAAA,CACT,wBAAwB,sBAAsB;AAAA,MAAA;AAAA,OAEhD,sBAAsB;AAErB,QAAA;AACA,QAAA;AACO,eAAA,MAAM,GAAG,OAAO,OAAO;AAAA,IAAA,UAChC;AACA,mBAAa,SAAS;AAAA,IACxB;AAEI,WAAA,oBAAoB,MAAM,IACrB,gBAAgB,QAAQ,QAAQ,IAAI,IAGzC,OAAO,UAAW,YACb,WAAW;AAAA,EAItB;AACF,GCnHa,kBAA8B;AAAA,EACzC,GAAG;AAAA,EAEH,KAAK,CAAC,WAAW,OAAO,SAAS,EAAC,MAAM,WAAU;AAC5C,QAAA,CAAC,SAAS,MAAM,UAAU;AACrB,aAAA;AAGT,UAAM,UAAU,0BAA0B,IAAI,IAAI,WAAW;AAC7D,WAAO,WAAW,KAAK,EAAE,mCAAmC,EAAC,WAAW,SAAQ;AAAA,EAClF;AAAA,EAEA,KAAK,CAAC,WAAW,OAAO,SAAS,EAAC,MAAM,WAAU;AAC5C,QAAA,CAAC,SAAS,MAAM,UAAU;AACrB,aAAA;AAGT,UAAM,UAAU,0BAA0B,IAAI,IAAI,WAAW;AAC7D,WAAO,WAAW,KAAK,EAAE,mCAAmC,EAAC,WAAW,SAAQ;AAAA,EAClF;AAAA,EAEA,QAAQ,CAAC,cAAc,OAAO,SAAS,EAAC,MAAM,WAAU;AAClD,QAAA,CAAC,SAAS,MAAM,WAAW;AACtB,aAAA;AAGT,UAAM,UAAU,0BAA0B,IAAI,IAAI,WAAW;AAC7D,WAAO,WAAW,KAAK,EAAE,iCAAiC,EAAC,cAAc,SAAQ;AAAA,EACnF;AAAA,EAEA,UAAU,CAAC,MAAM,OAAO,SAAS,EAAC,WAC5B,SAAS,cAAc,CAAC,QACnB,WAAW,KAAK,EAAE,+BAA+B,EAAC,SAAS,QAAA,CAAQ,IAGrE;AAAA,EAGT,OAAO,CAAC,eAAeb,SAAQ,SAAS,EAAC,WAAU;AAEjD,QADkB,OAAOA,UACP;AACT,aAAA;AAGT,UAAM,QAAgB,CAAA;AACtB,aAAS,IAAI,GAAG,IAAIA,QAAO,QAAQ,KAAK;AAChC,YAAA,QAAQA,QAAO,CAAC;AACtB,UAAI,cAAc,KAAK,CAAC,aAAa,WAAW,UAAU,KAAK,CAAC;AAC9D;AAGI,YAAA,cAA2B,SAAS,MAAM,OAAO,EAAC,MAAM,MAAM,KAAQ,IAAA;AACtE,YAAA,KAAK,CAAC,WAAW,CAAC;AAAA,IAC1B;AAGA,UAAM,gBAAgB,WAAW,KAAK,EAAE,gCAAgC;AAEjE,WAAA,MAAM,IAAI,CAAC,UAAU,EAAC,SAAS,eAAe,KAAM,EAAA;AAAA,EAC7D;AAAA,EAEA,QAAQ,CAAC,SAAS,OAAO,SAAS,EAAC,WAAU;AAC3C,UAAM,cAAc,CAAA;AACpB,QAAI,CAAC;AACI,aAAA;AAGT,aAAS,IAAI,GAAG,IAAI,MAAM,QAAQ;AAChC,eAAS,IAAI,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACzC,cAAM,QAAQ,MAAM,CAAC,GACf,QAAQ,MAAM,CAAC;AAEhB,mBAAW,OAAO,KAAK,MAIxB,YAAY,QAAQ,CAAC,MAAM,MAC7B,YAAY,KAAK,CAAC,GAGhB,YAAY,QAAQ,CAAC,MAAM,MAC7B,YAAY,KAAK,CAAC;AAAA,MAEtB;AAGF,UAAM,QAAQ,YAAY,IAAI,CAAC,QAAQ;AAC/B,YAAA,OAAO,MAAM,GAAG;AAEf,aAAA,CADa,QAAQ,KAAK,OAAO,EAAC,MAAM,KAAK,SAAQ,GACzC;AAAA,IAAA,CACpB,GAGK,gBAAgB,WAAW,KAAK,EAAE,iCAAiC;AAElE,WAAA,MAAM,IAAI,CAAC,UAAU,EAAC,SAAS,eAAe,KAAM,EAAA;AAAA,EAC7D;AACF,GCvGa,oBAAgC;AAAA,EAC3C,GAAG;AAAA,EAEH,UAAU,CAAC,MAAM,OAAO,SAAS,EAAC,WAC5B,SAAS,cAAc,OAAO,SAAU,YACnC,WAAW,KAAK,EAAE,+BAA+B,EAAC,SAAS,WAAU,IAGvE;AAEX;ACTA,SAASS,WAAS,KAA8C;AACvD,SAAA,OAAO,OAAQ,YAAY,QAAQ,QAAQ,CAAC,MAAM,QAAQ,GAAG;AACtE;AAEA,MAAM,UACJ,+VAUI,mBAAmB,CAAC,OAAO,IAAI,OAAa,YAA8B;AACxE,QAAA,cAAa,mCAAS,eAAc,iBAAiB,qBACrD,cAAa,WAAA,OAAA,SAAA,QAAS,eAAc,iBAAiB;AAK3D,SAAO,iBAAiB;AAAA,IACtB;AAAA,IACA,SAAS,SAAS,aAAa,GAAG,UAAU,IAAI,UAAU;AAAA,IAC1D,SAAS;AAAA,EAAA;AAEb;AAIA,SAAS,UAAU,MAAe,eAAe,IAAoB;AACnE,MAAI,CAAC;AAAa,WAAA;AAClB,MAAI,SAAS;AAAO,+BAAW,KAAK;AAG9B,QAAA,SAAS,IAAI,KAAK,IAAW,GAC7B,YAAY,MAAM,OAAO,QAAA,CAAS;AACxC,MAAI,aAAa;AACf,UAAM,IAAI,MAAM,oBAAoB,IAAI,aAAa;AAGvD,SAAO,YAAY,OAAO;AAC5B;AAEO,MAAM,iBAA6B;AAAA,EACxC,GAAG;AAAA,EAEH,MAAM,CAAC,SAAS,OAAO,SAAS,EAAC,WAC3B,OAAO,QAAU,OAAe,QAAQ,KAAK,GAAG,KAAK,EAAE,IAClD,KAGF,WAAW,KAAK,EAAE,gCAAgC;AAAA,EAG3D,KAAK,CAAC,SAAS,OAAO,SAAS,EAAC,MAAM,WAAU;AAC9C,UAAM,UAAU,UAAU,KAAK,GACzB,aAAa,UAAU,SAAS,EAAI;AAM1C,QAJI,CAAC,WAID,CAAC,SAAS,WAAW;AAChB,aAAA;AAGT,QAAI,CAAC;AACG,YAAA,IAAI,MAAM,gDAAkD;AAGpE,UAAM,kBAAmCA,WAAS,KAAK,OAAO,IACzD,KAAK,UACN;AAGF,WAAA;AAAA;AAAA;AAAA,IAIA,KAAK,EAAE,2BAA2B;AAAA,MAChC,SAAS,iBAAiB,KAAK,MAAM,YAAY,eAAe;AAAA,MAChE,iBAAiB;AAAA,IAAA,CAClB;AAAA,EAEL;AAAA,EAEA,KAAK,CAAC,SAAS,OAAO,SAAS,EAAC,MAAM,WAAU;AAC9C,UAAM,UAAU,UAAU,KAAK,GACzB,aAAa,UAAU,SAAS,EAAI;AAM1C,QAJI,CAAC,WAID,CAAC,SAAS,WAAW;AAChB,aAAA;AAGT,QAAI,CAAC;AACG,YAAA,IAAI,MAAM,gDAAkD;AAGpE,UAAM,kBAAmCA,WAAS,KAAK,OAAO,IACzD,KAAK,UACN;AAGF,WAAA;AAAA;AAAA;AAAA,IAIA,KAAK,EAAE,2BAA2B;AAAA,MAChC,SAAS,iBAAiB,KAAK,MAAM,YAAY,eAAe;AAAA,MAChE,iBAAiB;AAAA,IAAA,CAClB;AAAA,EAEL;AACF,GCxHM,cAAc,oCAEP,mBAA+B;AAAA,EAC1C,GAAG;AAAA,EAEH,SAAS,CAAC,SAAS,OAAO,SAAS,EAAC,KAAI,MACjC,OAAO,UAAU,KAAK,IAIpB,KAHE,WAAW,KAAK,EAAE,+BAA+B;AAAA,EAM5D,WAAW,CAAC,OAAO,OAAO,SAAS,EAAC,WAAU;AAC5C,QAAI,UAAU;AAAkB,aAAA;AAEhC,UAAM,SAAS,MAAM,SAAS,EAAE,MAAM,WAAW;AAMjD,WALiB,KAAK;AAAA,OACnB,OAAO,CAAC,IAAI,OAAO,CAAC,EAAE,SAAS,MAAM,OAAO,CAAC,IAAI,SAAS,OAAO,CAAC,GAAG,EAAE,IAAI;AAAA,MAC5E;AAAA,IAAA,IAGa,QACN,WAAW,KAAK,EAAE,uCAAuC,EAAC,MAAK,CAAC,IAGlE;AAAA,EACT;AAAA,EAEA,KAAK,CAAC,WAAW,OAAO,SAAS,EAAC,KAAI,MAChC,SAAS,YACJ,KAGF,WAAW,KAAK,EAAE,6BAA6B,EAAC,WAAU;AAAA,EAGnE,KAAK,CAAC,WAAW,OAAO,SAAS,EAAC,KAAI,MAChC,SAAS,YACJ,KAGF,WAAW,KAAK,EAAE,6BAA6B,EAAC,WAAU;AAAA,EAGnE,aAAa,CAAC,WAAW,OAAO,SAAS,EAAC,KAAI,MACxC,QAAQ,YACH,KAGF,WAAW,KAAK,EAAE,kCAAkC,EAAC,WAAU;AAAA,EAGxE,UAAU,CAAC,WAAW,OAAO,SAAS,EAAC,KAAI,MACrC,QAAQ,YACH,KAGF,WAAW,KAAK,EAAE,+BAA+B,EAAC,WAAU;AAEvE,GC5DM,WAAW,CAAC,QAAQ,SAAS,OAAO,GAE7B,mBAA+B;AAAA,EAC1C,GAAG;AAAA,EAEH,UAAU,CAAC,UAAU,OAAO,SAAS,EAAC,WAAU;AAC9C,QAAI,aAAa;AACR,aAAA;AAGT,UAAM,OAAO,SAAS,OAAO,KAAK,KAAK,EAAE,OAAO,CAAC,QAAQ,CAAC,SAAS,SAAS,GAAG,CAAC;AAEhF,WAAI,UAAU,UAAc,QAAQ,KAAK,WAAW,IAC3C,WAAW,KAAK,EAAE,+BAA+B,EAAC,SAAS,SAAS,CAAA,IAGtE;AAAA,EACT;AAAA,EAEA,WAAW,OAAO,SAAS,OAAgB,SAAS,YAAY;AAC9D,QAAI,CAAC;AACI,aAAA;AAGT,UAAM,EAAC,MAAM,mBAAmB,KAAA,IAAQ;AAEpC,QAAA,CAACyJ,cAAY,KAAK;AACb,aAAA,WAAW,KAAK,EAAE,iCAAiC;AAG5D,QAAI,CAAC;AACG,YAAA,IAAI,MAAM,+CAAiD;AAG/D,QAAA,UAAU,QAAQ,KAAK;AAClB,aAAA;AAGT,QAAI,CAAC;AACG,YAAA,IAAI,MAAM,4DAA8D;AAIhF,WADe,MAAM,kBAAkB,EAAC,IAAI,MAAM,KAAK,CAAA,IAKhD,KAHE,KAAK,EAAE,6CAA6C,EAAC,YAAY,MAAM,MAAK;AAAA,EAIvF;AAAA,EAEA,eAAe,CAAC,MAAM,OAAO,SAAS,EAAC,WACjC,CAAC,SAAS,CAAC,MAAM,SAAS,CAAC,MAAM,MAAM,OAClC,WAAW,KAAK,EAAE,oCAAoC,EAAC,SAAS,KAAK,aAAa,GAAG,CAAA,IAGvF;AAEX,GCzDM,eAAe,iBACf,gBAAgB,CAAC,QAAgB,SAAS,KAAK,GAAG,GAClD,aACJ,wJAEW,mBAA+B;AAAA,EAC1C,GAAG;AAAA,EAEH,KAAK,CAAC,WAAW,OAAO,SAAS,EAAC,WAC5B,CAAC,SAAS,MAAM,UAAU,YACrB,KAGF,WAAW,KAAK,EAAE,oCAAoC,EAAC,WAAU;AAAA,EAG1E,KAAK,CAAC,WAAW,OAAO,SAAS,EAAC,WAC5B,CAAC,SAAS,MAAM,UAAU,YACrB,KAGF,WAAW,KAAK,EAAE,oCAAoC,EAAC,WAAU;AAAA,EAG1E,QAAQ,CAAC,cAAc,OAAO,SAAS,EAAC,KACrB,OAAA,SAAS,IACb,WAAW,eACf,KAGF,WAAW,KAAK,EAAE,kCAAkC,EAAC,cAAa;AAAA,EAG3E,KAAK,CAAC,aAAa,OAAO,SAAS,EAAC,WAAU;AAC5C,UAAM,WAAW,SAAS;AAC1B,QAAI,CAAC;AACI,aAAA;AAGH,UAAA,EAAC,QAAO,IAAI,aACZ,EAAC,kBAAkB,iBAAgB,SACnC,gBAAgB,QAAQ,iBAAiB;AAE3C,QAAA;AACA,QAAA;AAGI,YAAA,gBAAgB,IAAI,IAAI,UAAU,YAAY,IAAI,IAAI,IAAI,QAAQ;AAAA,IAAA,QAC5D;AACL,aAAA,WAAW,KAAK,EAAE,+BAA+B;AAAA,IAC1D;AAEI,QAAA,gBAAgB,IAAI,WAAW;AAC1B,aAAA,WAAW,KAAK,EAAE,oCAAoC;AAG/D,QAAI,CAAC,iBAAiB,IAAI,WAAW,gBAAgB,cAAc,QAAQ;AAClE,aAAA,WAAW,KAAK,EAAE,oCAAoC;AAG/D,QAAI,CAAC,qBAAqB,IAAI,YAAY,IAAI;AACrC,aAAA,WAAW,KAAK,EAAE,4CAA4C;AAGvE,UAAM,YAAY,IAAI,SAAS,QAAQ,MAAM,EAAE;AAE/C,WAD6B,QAAQ,OAAO,KAAK,CAAC,WAAW,OAAO,KAAK,SAAS,CAAC,IAK5E,KAHE,WAAW,KAAK,EAAE,2CAA2C,EAAC,QAAQ,WAAU;AAAA,EAI3F;AAAA,EAEA,cAAc,CAAC,QAAQ,OAAO,SAAS,EAAC,WAAU;AAChD,UAAM,WAAW,SAAS;AACtB,WAAA,WAAW,eAAe,aAAa,SAAS,kBAC3C,IAAA,WAAW,KAAK,EAAE,6BAA6B,IAGpD,WAAW,eAAe,aAAa,SAAS,sBAC3C,WAAW,KAAK,EAAE,6BAA6B,IAGjD;AAAA,EACT;AAAA,EAEA,UAAU,CAAC,MAAM,OAAO,SAAS,EAAC,WAC5B,SAAS,cAAc,CAAC,QACnB,WAAW,KAAK,EAAE,+BAA+B,EAAC,SAAS,SAAA,CAAS,IAGtE;AAAA,EAGT,OAAO,CAAC,SAAS,OAAO,SAAS,EAAC,WAAU;AAC1C,UAAM,EAAC,SAAS,MAAM,OAAA,IAAU,SAC1B,UAAU,QAAQ,GAAG,QAAQ,SAAU,CAAA,IACvC,WAAW,SAAS;AAG1B,YAAQ,YAAY;AACd,UAAA,UAAU,QAAQ,KAAK,QAAQ;AAChC,WAAA,CAAC,UAAU,CAAC,WAAa,UAAU,UAClC,YAIG,SACH,KAAK,EAAE,iCAAiC,EAAC,MAAM,SAAQ,IACvD,KAAK,EAAE,0CAA0C,EAAC,MAAM,QAAQ,CAAA,KAG/D;AAAA,EACT;AAAA,EAEA,OAAO,CAAC,SAAS,OAAO,SAAS,EAAC,WAAU;AAC1C,UAAM,WAAW,GAAG,SAAS,EAAE,GAAG;AAC9B,WAAA,CAAC,YAAY,WAAW,KAAK,QAAQ,IAChC,KAGF,WAAW,KAAK,EAAE,yBAAyB;AAAA,EACpD;AACF,GCpGM,iBAAiB;AAAA,EACrB,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,MAAM;AACR,GAEM,cAAc,CAAC,SACZ,QAAQ,KAAK,OAAO,YAAY,KAAK,IAAI,IAAI,MAGhD,aAAa,CAAC,eACd,OAAO,cAAe,YAAY,CAAC,aAAmB,KAClD,WAAuC,SAAS,KAAK,WAGzD1J,gBAAyB,CACzB,GAAA,YAAY,OAAO,WAAW,GAC9B2J,wBAA4C;AAAA,EAChD;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAtDA,IAAA;AAuEO,MAAM,QAAkB,KAA4B,MAAA;AAAA,EAqBzD,YAAY,SAAsB;AARM,SAAA,QAAA,QACW,KAAA,SAAA,QACF,KAAA,YAAA,QACd,KAAA,WAAA,QAC0B,KAAA,WAAA,QAC7D,KAAA,SAAqB,IACiB,KAAA,cAAA,QAcvB,KAAA,eAAA,GAAK,aAAa,KAAK,EAAI,GAXnC,KAAA,WAAW,SAChB,KAAK,MAAM;AAAA,EACb;AAAA,EAEQ,eAAe,MAAY;AACjC,QAAI,KAAK,cAAc,cAAc,KAAK,cAAc;AAAmB,aAAA;AAC3E,QAAI,KAAK,cAAc,cAAc,KAAK,cAAc;AAAmB,aAAA;AAAA,EAE7E;AAAA,EAKA,MAAM,SAAsD;AACpD,UAAA,OAAO,KAAK;AAClB,WAAA,KAAK,SAAS,SACd,KAAK,WAAW,WAAW,QACpB;AAAA,EACT;AAAA,EAEA,QAAQ,SAAsD;AACtD,UAAA,OAAO,KAAK;AAClB,WAAA,KAAK,SAAS,WACd,KAAK,WAAW,WAAW,QACpB;AAAA,EACT;AAAA,EAEA,KAAK,SAAsD;AACnD,UAAA,OAAO,KAAK;AAClB,WAAA,KAAK,SAAS,QACd,KAAK,WAAW,WAAW,QACpB;AAAA,EACT;AAAA,EAEA,QAAc;AACZ,WAAA,KAAK,QAAQ,KAAK,SAAS,QAC3B,KAAK,UAAU,KAAK,UAAU,CAAA,GAAI,OAAO,CAAC,SAAS,KAAK,SAAS,MAAM,GACvE,KAAK,WAAW,QAChB,KAAK,YAAY,QACjB,KAAK,SAAS,SACd,KAAK,cAAc,QACZ;AAAA,EACT;AAAA,EAEA,aAAsB;AACpB,WAAO,KAAK,cAAc;AAAA,EAC5B;AAAA,EAEA,QAAc;AACN,UAAA,OAAO,IAAI;AACjB,WAAA,KAAK,QAAQ,KAAK,OAClB,KAAK,WAAW,KAAK,UACrB,KAAK,YAAY,KAAK,WACtB,KAAK,SAAS,UAAU,KAAK,MAAM,GACnC,KAAK,SAAS,KAAK,QACnB,KAAK,cAAc,KAAK,aACxB,KAAK,WAAW,KAAK,UACd;AAAA,EACT;AAAA,EAEA,eAAe,OAAyB;AACtC,UAAM,OAAO,KAAK,MACZ,GAAA,+BAAe;AACf,WAAA,MAAA,QAAQ,CAAC,SAAS;AAClB,WAAK,SAAS,WAChB,KAAK,QAAQ,KAAK,aAGpB,SAAS,IAAI,KAAK,IAAI;AAAA,IAAA,CACvB,GAED,KAAK,SAAS,KAAK,OAChB,OAAO,CAAC,SAAS;AAChB,YAAM,oBAAoB,CAAC,QAAQ,OAAO,OAAO,EAAE,SAAS,KAAK,IAAI,GAC/D,cAAc,SAAS,IAAI,KAAK,IAAI;AAC1C,aAAO,EAAE,qBAAqB;AAAA,IAC/B,CAAA,EACA,OAAO,KAAK,GAER;AAAA,EACT;AAAA,EAEA,MAAM,MAAkB;AACtB,QAAI,KAAK,SAAS,KAAK,SAAS,KAAK,UAAU,KAAK;AAC5C,YAAA,IAAI,MAAM,mCAAmC;AAGrD,UAAM,UAAU,KAAK,eAAe,KAAK,MAAM;AACvC,WAAA,QAAA,QAAQ,KAAK,SAAS,KAAK,OACnC,QAAQ,WAAW,KAAK,YAAY,KAAK,UACzC,QAAQ,YAAY,KAAK,eAAe,IAAI,GAC5C,QAAQ,SAAS,KAAK,WAAW,UAAU,KAAK,SAAS,KAAK,QACvD;AAAA,EACT;AAAA;AAAA,EAGA,KAAK,YAAsE;AACzE,UAAM,OAAO,GAAG,WAAW,MAAM,GAAG,CAAC,EAAE,YAAA,CAAa,GAAG,WAAW,MAAM,CAAC,CAAC;AAItE,QAAA,CAACA,sBAAoB,SAAS,IAAI;AACpC,YAAM,IAAI,MAAM,iBAAiB,UAAU,GAAG;AAG1C,UAAA,OAAO,KAAK,eAAe,CAAC,EAAC,MAAM,QAAQ,YAAY,KAAK,CAAA,CAAC;AACnE,WAAA,KAAK,QAAQ,MACN;AAAA,EACT;AAAA,EAEA,IAAI,UAAwB;AACnB,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,OAAO,YAAY,SAAS,CAAA,CAAC;AAAA,EAClE;AAAA,EAEA,OAAO,UAAwB;AACtB,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,UAAU,YAAY,SAAS,CAAA,CAAC;AAAA,EACrE;AAAA;AAAA,EAGA,WAAiB;AACT,UAAA,OAAO,KAAK,eAAe,CAAC,EAAC,MAAM,YAAY,YAAY,WAAW,CAAA,CAAC;AAC7E,WAAA,KAAK,YAAY,YACV;AAAA,EACT;AAAA,EAEA,WAAiB;AACT,UAAA,OAAO,KAAK,eAAe,CAAC,EAAC,MAAM,YAAY,YAAY,WAAW,CAAA,CAAC;AAC7E,WAAA,KAAK,YAAY,YACV;AAAA,EACT;AAAA,EAEA,OACE,IACA,UAA8C,IACxC;AACN,WAAI,QAAQ,0BACV,OAAO,OAAO,IAAI,EAAC,wBAAwB,GAAI,CAAC,GAE3C,KAAK,eAAe,CAAC,EAAC,MAAM,UAAU,YAAY,GAAsB,CAAA,CAAC;AAAA,EAClF;AAAA,EAEA,IAAI,KAA4B;AACvB,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,OAAO,YAAY,IAAI,CAAA,CAAC;AAAA,EAC7D;AAAA,EAEA,IAAI,KAA4B;AACvB,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,OAAO,YAAY,IAAI,CAAA,CAAC;AAAA,EAC7D;AAAA,EAEA,OAAO,KAAmB;AACjB,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,UAAU,YAAY,IAAI,CAAA,CAAC;AAAA,EAChE;AAAA,EAEA,MAAM,OAAkC;AACtC,UAAMnK,UAAS,MAAM,QAAQ,KAAK,IAAI,QAAQ,CAAC,KAAK;AAC7C,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,SAAS,YAAYA,QAAO,CAAA,CAAC;AAAA,EAClE;AAAA;AAAA,EAGA,UAAgB;AACd,WAAO,KAAK,eAAe,CAAC,EAAC,MAAM,UAAU,CAAA,CAAC;AAAA,EAChD;AAAA,EAEA,UAAU,OAAqB;AACtB,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,aAAa,YAAY,MAAM,CAAA,CAAC;AAAA,EACrE;AAAA,EAEA,WAAiB;AACR,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,OAAO,YAAY,EAAE,CAAA,CAAC;AAAA,EAC3D;AAAA,EAEA,WAAiB;AACR,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,YAAY,YAAY,EAAE,CAAA,CAAC;AAAA,EAChE;AAAA,EAEA,YAAY,KAAmB;AACtB,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,eAAe,YAAY,IAAI,CAAA,CAAC;AAAA,EACrE;AAAA,EAEA,SAAS,KAAmB;AACnB,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,YAAY,YAAY,IAAI,CAAA,CAAC;AAAA,EAClE;AAAA;AAAA,EAGA,YAAkB;AACT,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,gBAAgB,YAAY,YAAY,CAAA,CAAC;AAAA,EAC9E;AAAA,EAEA,YAAkB;AACT,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,gBAAgB,YAAY,YAAY,CAAA,CAAC;AAAA,EAC9E;AAAA,EAMA,MACE,SACA,GACA,GACM;AArSV,QAAAa,KAAA;AAsSU,UAAA,OAAO,OAAO,KAAM,WAAW,KAAIA,MAAA,KAAA,OAAA,SAAA,EAAG,SAAH,OAAAA,MAAW,KAAA,OAAA,SAAA,EAAG,MACjD,SAAS,OAAO,KAAM,WAAW,MAAQ,4BAAG,WAAH,OAAA,KAAa,KAAG,OAAA,SAAA,EAAA,QAEzD,aAA0C;AAAA,MAC9C;AAAA,MACA;AAAA,MACA,QAAQ,UAAU;AAAA,IAAA;AAGb,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,SAAS,WAAW,CAAA,CAAC;AAAA,EAC1D;AAAA,EAEA,QAAc;AACZ,WAAO,KAAK,eAAe,CAAC,EAAC,MAAM,QAAQ,CAAA,CAAC;AAAA,EAC9C;AAAA,EAEA,IAAI,MAKK;AACP,UAAM,cAAa,QAAA,OAAA,SAAA,KAAM,WAAU,CAAC,QAAQ,OAAO,GAC7C,UAAU,MAAM,QAAQ,UAAU,IAAI,aAAa,CAAC,UAAU;AAEpE,QAAI,CAAC,QAAQ;AACL,YAAA,IAAI,MAAM,8CAA8C;AAGhE,UAAM,aAAwC;AAAA,MAC5C,SAAS;AAAA,QACP,QAAQ,QAAQ,IAAI,CAAC,WAAW;AAC9B,cAAI,EAAE,kBAAkB,WAAW,OAAO,UAAW;AAC7C,kBAAA,IAAI,MAAM,qCAAqC;AAGhD,iBAAA,OAAO,UAAW,WAAW,IAAI,OAAO,IAAI,YAAY,MAAM,CAAC,GAAG,IAAI;AAAA,QAAA,CAC9E;AAAA,QACD,gBAAe,6BAAM,kBAAiB;AAAA,QACtC,eAAc,6BAAM,iBAAgB;AAAA,QACpC,mBAAkB,6BAAM,qBAAoB;AAAA,MAC9C;AAAA,IAAA;AAGK,WAAA,KAAK,eAAe,CAAC,EAAC,MAAM,OAAO,WAAW,CAAA,CAAC;AAAA,EACxD;AAAA;AAAA,EAGA,SAAe;AACb,WAAO,KAAK,eAAe,CAAC,EAAC,MAAM,SAAS,CAAA,CAAC;AAAA,EAC/C;AAAA;AAAA,EAGA,YAAkB;AAChB,WAAO,KAAK,eAAe,CAAC,EAAC,MAAM,YAAY,CAAA,CAAC;AAAA,EAClD;AAAA,EAEA,OAAO,OAAyB;AAC9B,QAAI,KAAK,UAAU;AACX,YAAA,IAAI,MAAM,+CAA+C;AAGjE,UAAM,OAAO,KAAK,eAAe,CAAE,CAAA;AACnC,WAAA,KAAK,cAAc,OACZ;AAAA,EACT;AAAA,EAEA,gBAAsB;AACd,UAAA,OAAO,YAAY,KAAK,QAAQ;AAClC,QAAA;AACJ,WAAI,QAAQ,CAAC,SAAS,MAAM,EAAE,SAAS,KAAK,IAAI,IAC9C,YAAY,KAAK,SAAS,UAAU,UAAU,SAE9C,YAAY,SAGP,KAAK,eAAe,CAAC,EAAC,MAAM,iBAAiB,YAAY,EAAC,UAAU,EAAA,CAAC,CAAC;AAAA,EAC/E;AAAA,EAEA,MAAM,SACJ,OACA,EAAC,aAAa,CAAC,GAAG,GAAG,WACQ;AAC7B,UAAM,EAAC,mCAAA,IAAsC,YAEvC,eAAe,SAAU;AAG3B,QAAA,gBAAgB,KAAK,cAAc;AAC9B,aAAAL;AAGH,UAAA;AAAA;AAAA,MAEJ,KAAK,cAAc,UAAa,eAC5B,KAAK,OAAO,OAAO,CAAC,SAAS,KAAK,SAAS,QAAQ,IACnD,KAAK;AAAA,OAEL,aAAc,KAAK,SAAS,eAAe,KAAK,KAAK,KAAM;AAoDjE,YAlDgB,MAAM,QAAQ;AAAA,MAC5B,MAAM,IAAI,OAAO,SAAS;AACxB,YAAI,KAAK,SAAS;AACV,gBAAA,IAAI,MAAM,+CAA+C;AAG3D,cAAA,YAAmC,WAAW,KAAK,IAAI;AAC7D,YAAI,CAAC,WAAW;AACd,gBAAM,UAAU,KAAK,QAAQ,SAAS,KAAK,KAAK,MAAM;AACtD,gBAAM,IAAI,MAAM,uBAAuB,KAAK,IAAI,mBAAmB,OAAO,EAAE;AAAA,QAC9E;AAEA,YAAI,iBAAiB,gBAAgB,OAAO,KAAK,aAAa;AAK9D,YAJI,WAAW,cAAc,MAC3B,iBAAiB,IAAI,QAAQ,QAAQ,eAAe,IAAI,IAIxD,KAAK,SAAS,YACd,sCACA,EAAE,yCAAoC,yBACtC;AACA,gBAAM,kBAAkB;AACxB,2BAAiB,UAAU,SAAsC;AAC/D,kBAAM,mCAAmC;AACrC,gBAAA;AACK,qBAAA,MAAM,gBAAgB,GAAG,IAAI;AAAA,YAAA,UACpC;AACA,iDAAmC,QAAQ;AAAA,YAC7C;AAAA,UAAA;AAAA,QAEJ;AAEM,cAAA,UAAU,oBAAoB,KAAK,QAAQ,IAC7C,gBAAgB,KAAK,UAAU,QAAQ,IAAI,IAC3C,KAAK;AAEL,YAAA;AACF,gBAAM,SAAS,MAAM,UAAU,gBAAgB,OAAO,SAAS,OAAO;AACtE,iBAAO,0BAA0B,QAAQ,KAAK,QAAQ,OAAO;AAAA,iBACtD,KAAK;AACZ,gBAAM,eAAe,GAAG;AAAA,YACtB,QAAQ;AAAA,UACT,CAAA,gDAAgD,IAAI,OAAO;AAE5D,iBAAO,0BAA0B,EAAC,SAAS,aAAY,GAAG,SAAS,OAAO;AAAA,QAC5E;AAAA,MAAA,CACD;AAAA,OAGY,KAAK;AAAA,EACtB;AACF,GAvX+B,GACb,YAAY,WADC,GAEtB,QAAQ,CAAC,QAA2B,IAAI,GAAK,GAAG,EAAE,KAAK,OAAO,GAFxC,GAGtB,SAAS,CAAC,QAA2B,IAAI,GAAK,GAAG,EAAE,KAAK,QAAQ,GAH1C,GAItB,SAAS,CAAC,QAA2B,IAAI,GAAK,GAAG,EAAE,KAAK,QAAQ,GAJ1C,GAKtB,SAAS,CAAC,QAA2B,IAAI,GAAK,GAAG,EAAE,KAAK,QAAQ,GAL1C,GAMtB,UAAU,CAAC,QAA2B,IAAI,GAAK,GAAG,EAAE,KAAK,SAAS,GAN5C,GAOtB,WAAW,CAAC,QAA2B,IAAI,GAAK,GAAG,EAAE,KAAK,MAAM,GAP1C,GAQtB,eAAe,CAAC,UAAsE;AAAA,EAC3F,MAAM;AAAA,EACN;AACF,IAX6B,KC3DzB,0BAA0BmC,UAAQ,eAAe;AAEvD,SAAS,eAAejD,KAAY;AAClC,QAAM0K,WAAU1K,IAAG,QAAQ,SAAS,MAAM;AACnC,SAAA;AAAA,IACL,WAAW0K,WAAU1K,IAAG,MAAM,CAAgB,IAAIA;AAAA,IAClD,OAAO0K,WAAU1K,MAAK,UAAUA,GAAE;AAAA,EAAA;AAEtC;AAEA,SAAS,cAAc,MAAoB;AACzC,SAAO,KAAK,OAAe,CAAC,QAAQ,MAAM,MAAM;AAC9C,UAAM,UAAU,OAAO,QAAS,UAC1B,QAAQ,cAAc,IAAI,GAE1B,MAAM,WAAW,QAAQ,OAAO,GADpB,MAAM,IAAI,KAAK,GACiB,GAAG,IAAI;AAClD,WAAA,GAAG,MAAM,GAAG,GAAG;AAAA,KACrB,EAAE;AACP;AAEA,MAAM,kBAAyC,CAAC2K,OAAM,YAAY;AAC1D,QAAA,EAAC,WAAW,UAAA9J,WAAU,MAAM,SAAQ,SACpC,gBAAgB,QAAM,OAAA,SAAA,KAAA;AAE5B,MAAI,CAACA;AACG,UAAA,IAAI,MAAM,oDAAsD;AAExE,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,gDAAkD;AAG9D,QAAA,uBAAsB,+CAAe,wBAAuB,IAC5D,EAAC,WAAW,UAAS,eAAeA,UAAS,GAAG,GAChD,UAAUA,UAAS,OACnB,SAAS,cAAc,KAAK,OAAO,SAAS,CAAC;AAE/C,GAAC,uBAAuB,OAAO,SAAS,IAAI,KAAK,QAAQ,gBAAgB,YAC3E,wBAAwB,cAAc,IAAI,CAAC;AAG7C,QAAM,cAAc;AAAA,IAClB;AAAA,IACA;AAAA,IACA,GAAG,MAAM;AAAA,EAAA,EACT,KAAK,MAAM;AAEb,SAAO,UAAU,EAAC,YAAY,aAAA,CAAa,EAAE;AAAA,IAC3C,cAAc,WAAW;AAAA,IACzB;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAA8J;AAAA,IACF;AAAA,IACA,EAAC,KAAK,4BAA2B;AAAA,EAAA;AAErC;AAEA,SAAS,gBAAgB,gBAAwB;AAEvC,UAAA;AAAA,IACN;AAAA,MACE,sBAAsB,cAAc;AAAA,MACpC;AAAA,MACA;AAAA,MACA,KAAK;AAAA,CAAI;AAAA,EAAA;AAGf;AAQa,MAAA,gBAAiC,OAAO,OAAO,YAAY;AAxFxE,MAAAxJ;AAyFE,MAAI,CAAC;AACI,WAAA;AAGH,QAAA,EAAC,KAAQ,IAAA;AAEf,MAAI,OAAO,SAAU,YAAY,MAAM,QAAQ,KAAK;AAC3C,WAAA,KAAK,EAAE,4BAA4B;AAGxC,MAAA,CAAC,OAAO,KAAK,KAAK,MAAM,QAAQ,KAAA,EAAO,WAAW;AAC7C,WAAA,KAAK,EAAE,iCAAiC;AAG3C,QAAA,WAAUA,yCAAS,SAAT,OAAA,SAAAA,IAAe,SACzB,YAAW,WAAA,OAAA,SAAA,QAAS,aAAY,iBAEhC,cAAqC;AAAA,IACzC,GAAG;AAAA,IACH,QAAQ,QAAQ;AAAA,IAChB,MAAM,QAAQ;AAAA,IACd;AAAA,EAAA;AAIF,SADkB,MAAM,SAAS,MAAM,SAAS,WAAW,IAElD,KAGF,KAAK,EAAE,8BAA8B,EAAC,MAAM,MAAM,QAAQ,CAAA;AACnE,GClHM,sBAAoE;AAAA,EACxE,OAAO;AAAA,EACP,SAAS;AAAA,EACT,MAAM;AAAA,EACN,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,QAAQ;AACV,GAEM,mBAAmB,CAACyJ,gBACxBA,eAAc;AAET,SAAS,aACd,MACA,UAA2B,oBAAI,OACjB;AACT,SAAA,OACD,QAAQ,IAAI,IAAI,IAAU,CAAA,KAE9B,QAAQ,IAAI,IAAI,GAGT,CAAC,GADK,KAAK,OAAO,aAAa,KAAK,MAAM,OAAO,IAAI,IAC3C,IAAI,KANH;AAOpB;AAEA,SAAS,gBAAgB,WAAiB,MAAkB;AAC1D,MAAI,WAAW;AAEX,mBAAiB,KAAK,QAAQ,MAChC,WAAW,SAAS,KAAK,KAAK,QAAQ;AAGlC,QAAA;AAAA;AAAA,KAEJ,QAAM,OAAA,SAAA,KAAA;AAAA,IAEN,OAAO,KAAK,WAAY;AAAA,IAExB,UAAU,KAAK;AAAA,IAEf,KAAK,QAAQ;AAAA;AASf,SAPI,MAAM,QAAQ,eAAe,MAC/B,WAAW,SAAS;AAAA,IAClB,gBAAgB,IAAI,CAAC,WAAW,2BAA2B,QAAQ,IAAI,CAAC;AAAA,EAAA,IAIxE,KAAK,SAAS,cACd,KAAK,SAAS,SAAe,SAAS,KAAK,MAAM,IACjD,KAAK,SAAS,QAAc,SAAS,QACrC,KAAK,SAAS,SAAe,SAAS,OAAO,eAAe,EAAC,wBAAwB,IAAK,IAC1F,KAAK,SAAS,cAAoB,SAAS,cAC3C,KAAK,SAAS,UAAgB,SAAS,MACpC,IAAA;AACT;AAEA,SAAS,cAAc,SAA0C;AAC/D,SAAK,UACD,EAAE,YAAY,YAAY,QAAQ,OAAa,cAAc,QAAQ,IAAI,IACzE,EAAE,YAAY,YACd,CAAC,MAAM,QAAQ,QAAQ,MAAM,IAAU,KACpC,QAAQ,OAAO,KAAK,CAAC,UAAU,MAAM,SAAS,OAAO,IAJvC;AAKvB;AAEA,SAAS,2BAA2B,QAAiB,SAA8B;AAI7E,SAAA,QAAQ,aAAa,YAAY,cAAc,OAAO,KAElD,OAAmC,UAAU,SAFe,SAI/D,OAAmC;AAC1C;AAKO,SAAS,yBAAyB,SAAyC;AAChF,MAAI,CAAC;AACH,WAAO;AAGT,QAAMjF,cAAa,QAAQ;AAEvB,MAAA,MAAM,QAAQA,WAAU;AAC1B,WAAOA,YAAW;AAAA,MAAQ,CAAC,MACzB,yBAAyB;AAAA,QACvB,GAAG;AAAA,QACH,YAAY;AAAA,MAAA,CACb;AAAA,IAAA;AAID,MAAAA,eAAc,OAAOA,eAAe;AACtC,WAAO,CAACA,WAAU;AAGd,QAAA;AAAA;AAAA,IAEJ,OAAO;AAAA,MACL,aAAa,OAAO,EAAE,OAAmC,CAAC,KAAK,UAC7D,IAAI,KAAK,IAAI,IAAI,MACV,MACN,CAAA,CAAE;AAAA,MACL,OAAO,iBAAiB,IAAIkF,KAAU,OAAO,CAAC;AAAA;AAElD,SAAKlF,cAIE,yBAAyB;AAAA,IAC9B,GAAG;AAAA,IACH,YAAYA,YAAW,QAAQ;AAAA,EAAA,CAChC,IANQ,CAAC,QAAQ;AAOpB;AC5GO,SAAS,oBAAoB,SAAiC;AACnE,SAAA,SAAS,SAAS,oBAAI,IAAK,CAAA,GACpB;AACT;AAEA,SAAS,SAAS,SAAqB,SAA0B;AAC3D,MAAA,CAAA,QAAQ,IAAI,OAAO,GAQvB;AAJA,QAAA,QAAQ,IAAI,OAAO,GAEnB,QAAQ,aAAa,yBAAyB,OAAO,GAEjD,YAAY;AACd,iBAAW,SAAS,QAAQ;AACjB,iBAAA,MAAM,MAAM,OAAO;AAIhC,QAAI,QAAQ;AACV,iBAAW,aAAa,QAAQ;AAC9B,iBAAS,WAAW,OAAO;AAM/B,QAAI,QAAQ;AAGV,iBAAW,cAAc,QAAQ;AAC/B,iBAAS,YAAY,OAAO;AAAA,EAAA;AAGlC;AC3CO,SAAS,gBAAgB,QAAwB;AAGtD,SAFkB,OAAO,aAAA,EAEf,QAAQ,CAAC,aAAa;AACxB,UAAA,aAAa,OAAO,IAAI,QAAQ;AAElC,kBACF,oBAAoB,UAAU;AAAA,EAEjC,CAAA,GAEM;AACT;ACTA,MAAM,eAAe,OAAO,SAAW,OAAe,OAAO,WAAa,KACpE,kBAA2C,CAAC,aAAa,GAclD,0BAA8C1C;AAAAA,EACzD,WAAiD;AAC/C,UAAM,OAAO;AACb,WAAA,KAAK,QACE;AAAA,MACL,eAAe;AAAA,MACf,SAAS;AAAA,MACT,gBAAgB,KAAK;AAAA,MACrB,GAAG,KAAK;AAAA,IAAA;AAAA,EAEZ;AACF;AAEA,SAAS,0BAA0B;AApCnC,MAAA9B;AAsCE,QAAM,kBAA4B,EAAC,CAAC,cAAc,EAAE,GAAG,CAAE,EAAA,GACnD,kBAAgBA,MAAgB,gBAAA,YAAhB,oBAAyB,OAAO,sBAAA,MAA2B,IAC3E,iCAAiB;AACvB,aAAW,UAAU;AACH,oBAAA,cAAc,EAAE,EAAE,OAAO,SAAS,IAAI,OAAO,WAC7D,WAAW,IAAI,OAAO,SAAS;AAGjC,SAAO,eAAe;AAAA,IACpB,IAAI,MAAM,KAAK,UAAU;AAAA,IACzB,WAAW;AAAA,IACX,eAAe;AAAA,IACf,yBAAyB;AAAA,IACzB,aAAa,cAAc;AAAA,IAC3B,KAAK,cAAc;AAAA,IACnB,eAAe,CAAC,cAAc,EAAE;AAAA,IAChC,OAAO;AAAA,IACP,MAAM;AAAA,IACN,WAAW;AAAA,IACX,eAAe;AAAA;AAAA;AAAA,MAGb,aAAa;AAAA,IACf;AAAA,EAAA,CACD;AACH;AC3CA,MAAM,cAAc,KAKP,kBAAkB,KAUlB,0BAA0B;AAEhC,SAAS,+BACd,QAC6C;AACvC,QAAA,MAAM,IAAI,QAAA,GACV,UAAU,IAAI,mBAAmB,uBAAuB,GAExD,aAAa,IAAI;AAAA,IACrB,WAAW,aAAa,MAAM,eAAe;AAAA,IAC7CoB,MAAI,CAAC,QAAQ,MAAM,KAAK,IAAI,IAAI,GAAG,CAAC,CAAC;AAAA,IACrCuI;AAAAA,MAAS,CAAC,QACR,KAAK,QAAQ,MAAA,CAAO,EAAE;AAAA,QACpBC;AAAAA,UAAU,MACR,OAAO,WACJ,QAA8B;AAAA,YAC7B,KAAK,OAAO,WAAW,OAAO,IAAI,KAAK,GAAG,CAAC;AAAA,YAC3C,MAAM;AAAA,YACN,OAAO,EAAC,gBAAgB,OAAM;AAAA,YAC9B,KAAK;AAAA,UAAA,CACN,EACA,KAAKxI,MAAI,CAAC,kBAAkB,EAAC,cAAc,IAAG,EAAE,CAAC;AAAA,QACtD;AAAA,QACA,SAAS,QAAQ,OAAO;AAAA,MAC1B;AAAA,IACF;AAAA,IACAuI;AAAAA,MAAS,CAAC,EAAC,cAAc,IAAA,MACvB,IAAI,IAAI,CAAC9K,QAAO;AACR,cAAA,aAAa,aAAa,QAAQ;AAAA,UACtC,CAAC,KAAK,UACJ,IAAI,KAAK,EAAE,IAAI,KAAK,QACb;AAAA,UAET,CAAC;AAAA,QAAA;AAIE,eAAA,WAAWA,GAAE,IAEd,WAAWA,GAAE,MAAM,cAAoB,EAAC,IAAAA,KAAI,QAAQ,OAEjD,EAAC,IAAAA,KAAI,QAAQ,GAAA,IAJQ,EAAC,IAAAA,KAAI,QAAQ;MAAI,CAK9C;AAAA,IACH;AAAA,IACA,MAAM;AAAA,EAAA;AAGR,SAAO,eAAiC,SAAS;AAE/C,UAAM,SAAS,eAAe,WAAW,KAAK6I,SAAO,CAAC,EAAC,IAAA7I,IAAA,MAAQA,QAAO,QAAQ,EAAE,CAAC,CAAC;AAE9E,QAAA,KAAK,QAAQ,EAAE;AAEb,UAAA,EAAC,WAAU,MAAM;AAChB,WAAA;AAAA,EAAA;AAEX;ACrFA,MAAM,0BAA6D,SACjE,UACA,SACQ;AACF,QAAA,QAAQ,KAAK;AACZ,SAAA,OAAO,WAAW,MAAM;AACpB,aAAA;AAAA,MACP,YAAY;AAAA,MACZ,gBAAgB;AACd,eAAO,KAAK,IAAI,GAAG,KAAK,IAAA,IAAQ,KAAK;AAAA,MACvC;AAAA,IAAA,CACD;AAAA,KACA,CAAC;AACN,GAEM,yBAA2D,SAC/D,QACM;AACC,SAAA,OAAO,aAAa,MAAM;AACnC,GAEM,MAAM,OAAO,SAAW,MAAc,SAAY,QAE3C,uBAAsB,OAAK,OAAA,SAAA,IAAA,wBAAuB,yBAClD,sBAAqB,2BAAK,uBAAsB,wBCxBhD,yBACX,CAAC,SACD,CAAC,UAAU;AARb,MAAAmB;AASQ,MAAA,OAAO,SAAU,YACjB,CAAC;AAAc,WAAA;AAEb,QAAA,aAAa,IAAI,KAAIA,MAAK,KAAA,WAAL,oBAAa,IAAI,CAAC,UAAU,MAAM,IAAK,CAAA;AAE5C,SAAA,OAAO,KAAK,KAAK,EACpC,OAAO,CAAC,QAAQ,CAAC,IAAI,WAAW,GAAG,CAAC,EACpC,OAAO,CAAC,QAAQ,CAAC,WAAW,IAAI,GAAG,CAAC,EAElB,IAAI,CAAC,kBAAkB;AAAA,IAC1C,SAAS,UAAU,YAAY,6BAA6B,KAAK,IAAI;AAAA,IACrE,MAAM,CAAC,YAAY;AAAA,EACnB,EAAA;AACJ,GCKI,wBAAwB,IAExB,mBAAmB,+BAA+B,qBAAqB,GAEvEJ,aAAW,CAAC,gBAChB,OAAO,eAAgB,YAAY,gBAAgB,QAAQ,CAAC,MAAM,QAAQ,WAAW,GAEjF,gBAAgB,CAAI,UACxB,SAAU;AAKI,SAAA,wBACd,MACA,YACwB;AAExB,MAAI,WAAW,WAAW;AAAG,WAAO,WAAW,CAAC;AAEhD,QAAM,WAAW,cAAc,IAAI,KAAK,KAAK,OACvC,YACkB,QAAS,QAAS,CAAC,YAAY,WAAW,IAAI,EAAE,YAAY;AAEpF,SAAI,aAAa,cAAc,WACtB,WAAW,KAAK,CAAC,cAAc,UAAU,aAAa,SAAS,IAItE,WAAW,KAAK,CAAC,cAAW;AAxDhC,QAAAI;AAwD6C,aAAAA,MAAA,UAAA,SAAV,oBAAgB,UAAS;AAAA,EAAA,CAAQ,KAChE,WAAW,KAAK,CAAC,cAAc,UAAU,SAAS,QAAQ,KAC1D,WAAW,KAAK,CAAC,cAAc,UAAU,SAAS,YAAY,cAAc,QAAQ;AAExF;AAwDO,SAAS,iBAAiB;AAAA,EAC/B,UAAAN;AAAA,EACA;AAAA,EACA,cAAc;AAAA,EACd,GAAG;AACL,GAAyD;AACjD,QAAA,YAAY,QAAQ,aAAa,UAAU;AAI1C,SAAA;AAAA,IACL,2BAA2B;AAAA,MACzB,UAAAA;AAAA,MACA,WANgC,CAAC,kBACnC,iBAAiB,UAAU,aAAa,CAAC;AAAA,MAMvC,MAAM,UAAU;AAAA,MAChB,QAAQ,UAAU;AAAA,MAClB,mBACE,QAAQ,qBACR,+BAA+B,UAAU,EAAC,YAAY,cAAa,CAAC,CAAC;AAAA,MACvE;AAAA,IAAA,CACD;AAAA,EAAA;AAEL;AAcA,MAAM,0DAA0C;AAMzC,SAAS,2BAA2B;AAAA,EACzC,UAAAA;AAAA,EACA;AAAA,EACA,OAAO,wBAAwB;AAAA,EAC/B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAsE;AAChE,MAAA,QAAOA,uCAAU,UAAU;AACvB,UAAA,IAAI,MAAM,8CAA8C;AAGhE,QAAM,eAAe,OAAO,IAAIA,UAAS,KAAK;AAE9C,MAAI,CAAC;AACC,WAAA,gBAAgB,YAClB,QAAQ;AAAA,MACN;AAAA,MACAA,UAAS;AAAA,IAAA,GAEJ,GAAG,EAAE,KAGP,GAAG;AAAA,MACR;AAAA,QACE,OAAO;AAAA,QACP,SAAS,wCAAwCA,UAAS,KAAK;AAAA,QAC/D,MAAM,CAAC;AAAA,MACT;AAAA,IAAA,CACD;AAGC,MAAA,qCAAqC,oCAAoC,IAAI,MAAM;AACnF,GAAC,sCAAsC,mCACzC,qCAAqC,IAAI,mBAAmB,8BAA8B,GAC1F,oCAAoC,IAAI,QAAQ,kCAAkC;AAGpF,QAAM,oBAAyC;AAAA,IAC7C;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,IACR,OAAOA;AAAA,IACP,MAAM,CAAC;AAAA,IACP,UAAAA;AAAA,IACA,MAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAGF,SAAO,KAAK,KAAK,eAAe,CAAC,YAAY,CAAC,CAAC,EAAE;AAAA,IAC/C,UAAU,MAAM,uBAAuB,iBAAiB,CAAC;AAAA,IACzD,WAAW,CAAC,QAAQ;AAClB,cAAQ,MAAM,GAAG;AAEX,YAAA,WAAU,2BAAK,YAAW;AAQhC,aAAO,GAAG,CAP4B;AAAA,QACpC,OAAO;AAAA,QACP;AAAA,QACA,MAAM,EAAC,QAAO;AAAA,QACd,MAAM,CAAC;AAAA,MAGa,CAAA,CAAC;AAAA,IAAA,CACxB;AAAA,EAAA;AAEL;AAsBA,SAAS,uBAAuB;AAAA,EAC9B;AAAA,EACA;AAAA,EACA,OAAO,CAAC;AAAA,EACR;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAAwD;AAGtD,QAAM,4BAA4B,CAAC;AAAA;AAAA,KAG/B,6BAAM,cAAa;AAAA,IAEnB,aAAa,IAAI,EAAE,KAAK,CAACQ,OAAM,CAAC,UAAU,YAAY,QAAQ,OAAO,EAAE,SAASA,GAAE,IAAI,CAAC;AAAA,IAEvF,gBAAgB,WAGT,KAAK,OAAO,uBAAuB,IAAI,GAAG,EAAC,wBAAwB,GAAA,CAAK,EAAE,QAI5E,IAAA;AAAA,KAGH,QAAQ,yBAAyB,IAAI,GAErC,aAAa,MAAM,IAAI,yBAAyB,EAAE;AAAA,IAAI,CAAC,SAC3D;AAAA,MAAM,MACJ,KAAK,SAAS,OAAO;AAAA,QACnB,GAAG;AAAA,QACH;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,YAAY,EAAC,mCAAkC;AAAA,MAAA,CAChD;AAAA,IACH;AAAA,EAAA;AAIF,MAAI,eAAsD,CAAA;AAE1D,QAAM,iBAAiB,MAAM,KAAK,CAAC,SAAS,KAAK,YAAY;AAS7D;AAAA;AAAA,KANE,6BAAM,cAAa;AAAA,KAEhB;AAAA;AAAA,IAEC,SAAU,QAAgC;AAAA,IAEX;AACnC,UAAM,aAAa,KAAK,OAAO,OAAmC,CAAC,KAAK,WACtE,IAAI,MAAM,IAAI,IAAI,MAAM,MACjB,MACN,CAAA,CAAE;AAGL,mBAAe,aAAa;AAAA,MAC1B,MACG,IAAI,CAAC,SAAS,KAAK,WAAW,EAC9B,OAAO,aAAa,EACpB,QAAQ,CAAC,iBAAiB,OAAO,QAAQ,YAAY,CAAC,EACtD,QAAQ,CAAC,CAAC,MAAMsE,WAAU,MAAM;AACzB,cAAA,YAAY,WAAW,IAAI;AACjC,eAAO,yBAAyB,EAAC,GAAG,WAAW,YAAAA,YAAW,CAAA,EACvD,IAAI,yBAAyB,EAC7B,IAAI,CAAC,YAAY;AAChB,gBAAM,cAAc5E,WAAS,KAAK,IAAI,MAAM,IAAI,IAAI;AAC7C,iBAAA;AAAA,YAAM,MACX,QAAQ,SAAS,aAAa;AAAA,cAC5B,GAAG;AAAA,cACH,QAAQ;AAAA,cACR,MAAM,KAAK,OAAO,IAAI;AAAA,cACtB,MAAM;AAAA,cACN;AAAA,cACA,YAAY,EAAC,mCAAkC;AAAA,YAAA,CAChD;AAAA,UAAA;AAAA,QACH,CACD;AAAA,MAAA,CACJ;AAAA,IAAA,GAIL,eAAe,aAAa;AAAA,MAC1B,KAAK,OAAO;AAAA,QAAI,CAAC,UACf,uBAAuB;AAAA,UACrB,GAAG;AAAA,UACH,QAAQ;AAAA,UACR,OAAOA,WAAS,KAAK,IAAI,MAAM,MAAM,IAAI,IAAI;AAAA,UAC7C,MAAM,KAAK,OAAO,MAAM,IAAI;AAAA,UAC5B,MAAM,MAAM;AAAA,UACZ;AAAA,UACA;AAAA,QAAA,CACD;AAAA,MACH;AAAA,IAAA;AAAA,EAEJ;AAM2C,UAAA,QAAA,OAAA,SAAA,KAAM,cAAa,WAAW,MAAM,QAAQ,KAAK,MAG1F,eAAe,aAAa;AAAA,IAC1B,MAAM;AAAA,MAAI,CAAC,MAAM,UACf,uBAAuB;AAAA,QACrB,GAAG;AAAA,QACH,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,MAAM,KAAK,OAAO,cAAc,IAAI,IAAI,EAAC,MAAM,KAAK,KAAI,IAAI,KAAK;AAAA,QACjE,MAAM,wBAAwB,MAAM,KAAK,EAAE;AAAA,QAC3C;AAAA,QACA;AAAA,MAAA,CACD;AAAA,IACH;AAAA,EAAA,IAIG,MAAM,MAAM,MAAM,CAAC,GAAG,YAAY,GAAG,YAAY,CAAC,CAAC,EAAE;AAAA,IAC1D,SAAS,CAAC,iBAAiB,OAAO,QAAQ,YAAY,GAAG,EAAE;AAAA,IAC3D,SAAS;AAAA,IACTiK,UAAQ;AAAA,IACR,IAAIhH,SAAO;AAAA,IACX,IAAI,CAAC,YAGC,MAAM,KAAK,CAAC,SAAS,KAAK,WAAW,IAChC,OAAO,SAAS,CAAC,SAAS,KAAK,UAAU,IAAI,CAAC,IAEhD,OACR;AAAA,EAAA;AAEL;AAEA,SAAS,KAAK,SAAqC;AAC1C,SAAA,IAAI,WAAkB,CAAC,aAAa;AACzC,UAAM,SAAS;AAAA,MACb,MAAM;AACJ,iBAAS,SAAS;AAAA,MACpB;AAAA,MACA,UAAU,EAAC,QAAW,IAAA;AAAA,IAAA;AAGjB,WAAA,MAAM,mBAAmB,MAAM;AAAA,EAAA,CACvC;AACH;ACjZA,IAAe,kBAAA;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,aAAa;AAAA,MACb,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,aACE;AAAA,MACF,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,aAAa;AAAA,MACb,MAAM;AAAA,IACR;AAAA,EACF;AACF,GCvBe,YAAA;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,WAAW;AAAA,IACT;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,aAAa;AAAA,IACf;AAAA,EACF;AAAA,EACA,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,EACF;AAAA,EACA,SAAS;AAAA,IACP,QAAQ;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,MACN,UAAU;AAAA,MACV,MAAM;AAAA,IACR;AAAA,IACA,QAAQ,KAA8B;AAC7B,aAAA;AAAA,QACL,OAAO,IAAI,SAAS,IAAI,KAAK,MAAM,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC;AAAA,QACnD,UAAU,GAAG,IAAI,QAAQ,MAAM,IAAI,OAAO,OAAO,MAAM,QAAQ,CAAC,CAAC;AAAA,MAAA;AAAA,IAErE;AAAA,EACF;AAAA,EACA,WAAW;AAAA,IACT;AAAA,MACE,OAAO;AAAA,MACP,MAAM;AAAA,MACN,IAAI,CAAC,EAAC,OAAO,QAAQ,WAAW,QAAO;AAAA,IACzC;AAAA,EACF;AACF,GC7He,WAAA;AAAA,EACb,OAAO;AAAA,EACP,MAAM;AAAA,EACN,MAAM;AAAA,EACN,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,EACF;AACF,GCnBe,aAAA;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,WAAW;AAAA,IACT;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,aAAa;AAAA,IACf;AAAA,EACF;AAAA,EACA,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,OAAO;AAAA,MACP,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,OAAO;AAAA,MACP,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,IACT;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU;AAAA,IACZ;AAAA,EACF;AAAA,EACA,SAAS;AAAA,IACP,QAAQ;AAAA,MACN,IAAI;AAAA,MACJ,OAAO;AAAA,MACP,UAAU;AAAA,MACV,MAAM;AAAA,IACR;AAAA,IACA,QAAQ,KAA8B;AAC7B,aAAA;AAAA,QACL,OAAO,IAAI,SAAU,OAAO,IAAI,QAAS,YAAY,IAAI,KAAK,MAAM,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC;AAAA,QACpF,OAAO,EAAC,OAAO,EAAC,MAAM,IAAI,KAAG;AAAA,QAC7B,UAAU,GAAG,IAAI,QAAQ,MAAM,OAAO,IAAI,IAAI,IAAI,OAAO,MAAM,QAAQ,CAAC,CAAC;AAAA,MAAA;AAAA,IAE7E;AAAA,EACF;AAAA,EACA,WAAW;AAAA,IACT;AAAA,MACE,OAAO;AAAA,MACP,MAAM;AAAA,MACN,IAAI,CAAC,EAAC,OAAO,QAAQ,WAAW,QAAO;AAAA,IACzC;AAAA,EACF;AACF,GCnIe,YAAA;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,EACF;AACF,GCtBe,kBAAA;AAAA,EACb,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,QAAQ;AAAA,IACN,EAAC,MAAM,UAAU,MAAM,UAAU,OAAO,UAAU,UAAU,GAAI;AAAA,IAChE,EAAC,MAAM,SAAS,MAAM,UAAU,OAAO,SAAS,UAAU,GAAI;AAAA,IAC9D,EAAC,MAAM,eAAe,MAAM,UAAU,OAAO,gBAAgB,UAAU,GAAI;AAAA,EAC7E;AACF,GCTe,eAAA;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,EACF;AACF,GCtBe,gBAAA;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,WAAW;AAAA,IACT;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,SAAS;AAAA,QACP,aAAa;AAAA,MACf;AAAA,IACF;AAAA,EACF;AAAA,EACA,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,MACN,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,MACN,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,MACN,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,MACN,UAAU;AAAA,IACZ;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,MACN,UAAU;AAAA,IACZ;AAAA,EACF;AACF,GCvDe,eAAA;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,QAAQ;AAAA,IACN,EAAC,MAAM,aAAa,MAAM,6BAA6B,OAAO,aAAY;AAAA,IAC1E,EAAC,MAAM,gBAAgB,MAAM,6BAA6B,OAAO,gBAAe;AAAA,IAChF,EAAC,MAAM,eAAe,MAAM,6BAA6B,OAAO,eAAc;AAAA,IAC9E,EAAC,MAAM,WAAW,MAAM,6BAA6B,OAAO,UAAS;AAAA,IACrE,EAAC,MAAM,YAAY,MAAM,6BAA6B,OAAO,WAAU;AAAA,IACvE,EAAC,MAAM,cAAc,MAAM,6BAA6B,OAAO,cAAa;AAAA,IAC5E,EAAC,MAAM,SAAS,MAAM,6BAA6B,OAAO,QAAO;AAAA,EACnE;AACF,GCbe,qBAAA;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,QAAQ;AAAA,IACN,EAAC,MAAM,cAAc,MAAM,UAAU,OAAO,cAAc,UAAU,GAAI;AAAA,IACxE,EAAC,MAAM,cAAc,MAAM,UAAU,OAAO,cAAc,UAAU,GAAI;AAAA,IACxE,EAAC,MAAM,cAAc,MAAM,UAAU,OAAO,cAAc,UAAU,GAAI;AAAA,IACxE,EAAC,MAAM,SAAS,MAAM,UAAU,OAAO,UAAU,UAAU,GAAI;AAAA,EACjE;AACF,GCVe,OAAA;AAAA,EACb,OAAO;AAAA,EACP,MAAM;AAAA,EACN,MAAM;AAAA,EACN,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,IACR;AAAA,IACA;AAAA;AAAA;AAAA,MAGE,MAAM;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,MACN,QAAQ;AAAA,IACV;AAAA,EACF;AACF;ACFA,MAAMiH,YAAU,CAAC,YAAoC,QAAQ,aAAa,SAEpE,eAAe;AAAA,EACnB;AAAA,EACA;AAAA,EACA;AAAA;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAKO,SAAS,aAAa,WAAiD;AACtE,QAAA,YAAY,eAAe,UAAU,KAAK,EAAE,SAC5C,GAAAtF,cAAa,cAAc,SAAS,GACpC,YAAYA,YAAW,KAAK,CAACD,WAAUA,OAAM,SAAS,KAAKuF,SAAO,CAAC,GAEnE,WAAWC,OAAc,QAAQ;AAAA,IACrC,MAAM,UAAU;AAAA,IAChB,OAAO,YAAY,CAAC,IAAI,CAAC,GAAG,UAAU,OAAO,GAAG,YAAY,EAAE,OAAO,OAAO;AAAA,EAAA,CAC7E;AAGA,SAAC,SAAiB,cAAcvF,aAE1BwF,gBAAgB,QAAkB;AAC3C;ACxCO,SAAS,mBAAmB,MAA0B;AAC3D,SAAI,OAAO,KAAK,SAAU,WACjB,KAAK,QAGV,KAAK,OACA,mBAAmB,KAAK,IAAI,IAG9B,KAAK,QAAQ,KAAK;AAC3B;ACbA,MAAM,mBAAqD,CAAC,GAAG,GAAG,GAAG,CAAC;AActE,SAAS,YAAY,OAAkC;AACrD,SAAO,MAAM;AACf;AAEA,SAAS,OAAO,OAAkC;AAChD,SAAO,MAAM;AACf;AAEO,SAAS,WAAW3K,QAA4B;AAC/C,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA,IAAAR;AAAA,IACA,yBAAyB;AAAA,IACzB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,IAAIQ,QACE,CAAC,uBAAuB,wBAAwB,IAAI,SAAgC,IAAI,GACxF,mBAAmB,OAA8B,IAAI,GAErD,WACH,oBAAA,iBAAA,EAAgB,SAAS,kBACxB,8BAAC,KAAI,EAAA,KAAK,kBAAmB,SAAS,CAAA,EACxC,CAAA;AAGF,SAAI,SAAS,WAET;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAe;AAAA,MACf;AAAA,MAEA,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA,IAAIR,OAAM;AAAA,UACV,gBAAgB;AAAA,UAChB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,YAAY;AAAA,UACZ,sBAAsB;AAAA,UAErB,UAAA;AAAA,QAAA;AAAA,MACH;AAAA,IAAA;AAAA,EAAA,IAMJ;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,cAAc;AAAA,MAEd,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,eAAe;AAAA,UACf;AAAA,UAEC,UAAA;AAAA,QAAA;AAAA,MACH;AAAA,IAAA;AAAA,EAAA;AAGN;AC5EA,MAAMkJ,uBAAmC;AAAA,EACvC,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,WAAW;AAAA,EACX,eAAe;AACjB,GAEakC,eAAa,KAAK,SAAoB5K,QAAc;AACzD,QAAA,EAAC,OAAO,SAAQ,IAAIA,QACpB,EAAC,GAAAa,GAAA,IAAK;AACZ,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,KAAI;AAAA,QACJ;AAAA,QACA;AAAA,QACA,MAAMA,GAAE,gCAAgC;AAAA,QACxC,MAAM;AAAA,MAAA;AAAA,IACR;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,KAAI;AAAA,QACJ;AAAA,QACA;AAAA,QACA,MAAMA,GAAE,+BAA+B;AAAA,QACvC,MAAM;AAAA,MAAA;AAAA,IACR;AAAA,EACF,EAAA,CAAA;AAEJ,CAAC;AAED,SAAS,gBACPb,QAKA;AACA,QAAM,EAAC,OAAO,UAAU,KAAK,MAAM,KAAQ,IAAAA;AAEvC,UAAA,SAAA,OAAA,SAAA,MAAO,YAAW,IACZ,oBAAA,UAAA,EAAmB,MAAY,MAAY,SAAS,MAAM,SAAS,KAAK,MAAM,CAAC,CAAC,EAAA,GAAlE,GAAqE,IAG1F,oBAAA,WAAA,EAAU,MAAsB,SAAS0I,sBACvC,UAAA,SAAA,OAAA,SAAA,MAAO,IAAI,CAAC,mBACX;AAAA,IAAC;AAAA,IAAA;AAAA,MAEC,MAAM,eAAe;AAAA,MACrB,MAAM,eAAe;AAAA,MACrB,SAAS,MAAM,SAAS,KAAK,cAAc;AAAA,IAAA;AAAA,IAHtC,eAAe;AAAA,EAAA,MAHE,GAS5B;AAEJ;ACvCA,MAAMmC,gBAAc,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiB/B,SAASpC,UAAQ;AAAA,EACf;AAAA,EACA;AAAA,EACA;AACF,GAIa;AACX,SAAI,WACK,gBAEL,YACK,aAEF,cAAc,YAAY;AACnC;AACA,MAAMC,uBAAqB,EAAC,QAAQ,IAAM,MAAM,UAAS;AAElD,SAAS,SAA+C1I,QAA4B;AAhE3F,MAAAW,KAAA,IAAA,IAAA,IAAA,IAAA;AAiEQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAY,EAAC,cAAa;AAAA,EAC5B,IAAIX,QACE,EAAC,GAAAa,OAAK,eAAe,GAErB,WAAW,CAAC,cAAYF,uBAAiB,YAAjB,OAAA,SAAAA,IAA0B,cAAa,IAC/D,kBAAkB,iBAAiB,IAEnC,iBAAiB,OAAqB,IAAI;AAGhD,iCAA+B,gBAAgB,IAAI,GAEnD,aAAa,SAAS,CAAC,UAAU,aAAa;AA5FhDA,QAAAA;AA6FQ,KAAC,YAAY,YAAY,eAAe,aAE1CA,OAAA,eAAe,YAAf,QAAAA,KAAwB,MAAA;AAAA,EAAA,CAE3B;AAED,QAAM,wBAAyB,MAAc,wBAEvC,kBAAkB,YAAY,MAAM;AAC/B,aAAA;AAAA,MACP,OAAO,CAAC,EAAC,GAAG,OAAO,MAAM,aAAY;AAAA,MACrC,UAAU;AAAA,IAAA,CACX;AAAA,KACA,CAAC,UAAU,KAAK,CAAC,GAEd,eAAe;AAAA,IACnB,CAAC,KAAyB,eAA2B;AAC1C,eAAA;AAAA,QACP,OAAO,CAAC,sBAAsB,UAAU,CAAC;AAAA,QACzC,UAAU;AAAA,MAAA,CACX;AAAA,IACH;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA,GAGL,gBAAgB,iBAAiB,MAAM,EAAI,GAC3C,WAAW,QAAQ,MAChB,cAAc,WAAW,IAAI,OAClC,oBAAC,iBAAc,UAAU,eAAe,YAAY,EAAA,CAAG,GAExD,CAAC,aAAa,CAAC,GAEZ,kBAAkB,mBAAmB,MAAM,EAAI,GAC/CwE,cAAa,QAAQ,MAClB,gBAAgB,WAAW,IAAI,OACnC,oBAAA,KAAA,EAAI,UAAU,GAAG,UAAU,GAC1B,8BAAC,2BAA0B,EAAA,YAAY,iBAAiB,wBAAsB,IAAC,EACjF,CAAA,GAED,CAAC,eAAe,CAAC,GAEd,YAAY,gBAAgB,KAAK,CAAC,MAAM,EAAE,UAAU,OAAO,GAC3D,cAAc,gBAAgB,KAAK,CAAC,MAAM,EAAE,UAAU,SAAS,GAE/D,OAAO;AAAA,IACX,MACE,WAAW,OACT;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ,oBAAC,mBAAkB,EAAA,UAAU,EAAG,CAAA;AAAA,QACxC,IAAI,GAAGnF,OAAM,OAAO;AAAA,QACpB,2BACG,MACC,EAAA,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAMa,GAAE,4BAA4B;AAAA,cACpC,MAAK;AAAA,cACL,MAAM;AAAA,cACN,SAAS;AAAA,YAAA;AAAA,UACX;AAAA,UACA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAMA,GAAE,+BAA+B;AAAA,cACvC,MAAMiK;AAAAA,cACN,SAAS;AAAA,YAAA;AAAA,UACX;AAAA,UACC,oBAAAF,cAAA,EAAW,OAAO,iBAAiB,UAAU,cAAc;AAAA,QAAA,GAC9D;AAAA,QAEF,SAASlC;AAAAA,MAAA;AAAA,IACX;AAAA,IAEJ,CAAC,iBAAiB,cAAc,UAAU,iBAAiB1I,OAAM,SAAS,UAAUa,EAAC;AAAA,EAAA,GAGjF,OAAO4H,UAAQ,EAAC,UAAU,WAAW,YAAY,CAAA,GAEjD,OACJ;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA,YAAAtD;AAAA,MACA;AAAA,MACA,QAAQ;AAAA,MACR,QAAM;AAAA,MACN,YAAY;AAAA,MACZ,UAAU;AAAA,MAEV,UAAA;AAAA,QAAC0F;AAAAA,QAAA;AAAA,UACC,MAAK;AAAA,UACL,UAAS;AAAA,UACT,aAAY;AAAA,UACZ,WAAQ;AAAA,UACR,WAAQ;AAAA,UACR,MAAK;AAAA,UACL,MAAM;AAAA,UACN,UAAU;AAAA,UACV,UAAU;AAAA,UACV,SAAS;AAAA,UACT,KAAK;AAAA,UACL;AAAA,UACA,sBAAoB;AAAA,UAEnB,UAAA;AAAA,YAAc,cAAA;AAAA,cACb;AAAA,cACA;AAAA,cACA,QAAQ;AAAA,cACR,YAAY;AAAA,cACZ,YAAY;AAAA,YAAA,CACb;AAAA,YAEA,yBAAyB,oBAAC,cAAa,EAAA,MAAI,GAAC,CAAA;AAAA,UAAA;AAAA,QAAA;AAAA,MAC/C;AAAA,IAAA;AAAA,EAAA,GAIE,gBAAgB,mBAAmB,UAAU;AACnD,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,oBAAC,mBAAgB,MAAY,WAAW,SAAS,UAAU,CAAA,CAAQ,SAChE,UACH,KAAA,CAAA;AAAA,IACC,QACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QACE,WACIhK,GAAE,4BAA4B,EAAC,eAAc,IAC7CA,GAAE,4BAA4B,EAAC,eAAc;AAAA,QAEnD,QAAM,MAAkB,KAAA,oBAAA,OAAA,SAAA,iBAAA,YAAlB,OAA2B,SAAA,GAAA,UAA3B,mBAAkC,SAAQ;AAAA,QAChD,QAAO,MAAkB,MAAA,KAAA,oBAAA,OAAA,SAAA,iBAAA,YAAlB,mBAA2B,UAA3B,OAAA,SAAA,GAAkC,UAAlC,OAA2C,KAAA;AAAA,QAClD,IAAI,MAAM;AAAA,QACV;AAAA,QACA,WAAW;AAAA,QACX,yBAAyB,eAAe;AAAA,QAEvC;AAAA,MAAA;AAAA,IACH;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACrNA,MAAMgF,UAAY,CAAA;AAEX,SAAS,eAAwC7F,QAAuC;AApB/F,MAAAW;AAqBQ,QAAA;AAAA,IACJ,gBAAgB,iBAAiB;AAAA,IACjC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,iBAAAiG;AAAA,IACA;AAAA,IACA,QAAQf;AAAAA,EAAA,IACN7F,QACE,EAAC,GAAAa,OAAK,kBAEN,gBAAgB;AAAA,IACpB,CAAC,SAAe;AACL,eAAA,EAAC,OAAO,CAAC,IAAI,GAAG,UAAU,UAAU,eAAe,EAAA,CAAE;AAAA,IAChE;AAAA,IACA,CAAC,QAAQ;AAAA,KAGL,eAAe;AAAA,IACnB,CAAC,SAAe;AACL,eAAA,EAAC,OAAO,CAAC,IAAI,GAAG,UAAU,SAAS,eAAe,GAAA,CAAG;AAAA,IAChE;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA,GAGL,aAAWF,MAAW,WAAA,YAAX,OAAoB,SAAAA,IAAA,cAAa,IAE5C,aAAa,YAAY,CAAC,cAEvB,oBAAC,YAAU,GAAG,UAAA,CAAW,GAC/B,CAAE,CAAA,GAEC,aAAa,QAAQ,MAAM,QAAQ,IAAI,CAAC,WAAW,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC;AAG7E,SAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAO,WAAW;AAAA,QAClB,iBAAAiG;AAAA,QACA;AAAA,QACC,GAAG;AAAA,QACJ,UAAU;AAAA,QAEV,UAAC,qBAAA,OAAA,EAAM,WAAQ,uBAAsB,OAAO,GACzC,UAAA;AAAA,WAAS,WAAA,OAAA,SAAA,QAAA,YAAW,KACnB,oBAAC,MAAK,EAAA,SAAS,GAAG,QAAM,IAAC,QAAQ,GAC/B,UAAC,oBAAAjF,QAAA,EAAK,OAAM,UAAS,OAAK,IAAC,MAAM,GAC9B,UAAA,WAAW,eAAe,oBAAA,UAAA,EAAG,UAAEd,GAAA,6BAA6B,EAAE,CAAA,EACjE,CAAA,GACF;AAAA,WAED,WAAA,OAAA,SAAA,QAAS,UAAS,KACjB,oBAAC,QAAK,QAAM,IAAC,QAAQ,GACnB,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,SAAS,CAAC,GAAG,GAAG,CAAC;AAAA,cACjB,KAAK;AAAA,cACL,SAAS;AAAA,cACT,QAAQ;AAAA,cACR,OAAO;AAAA,cACP;AAAA,cACA;AAAA,cAEC,UAAA,QAAQ,IAAI,CAAC,WACZ,qBAAC,MAAsB,EAAA,UAAoB,IAAI,OAAO,KAAK,MAAM,GAC9D,UAAA;AAAA,gBAAA,OAAO,SAAS,UACf;AAAA,kBAAC;AAAA,kBAAA;AAAA,oBACC;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,oBACA;AAAA,kBAAA;AAAA,gBACF;AAAA,gBAED,OAAO,SAAS,WAAY,oBAAAkJ,aAAA,EAAU,UAAoB,QAAgB;AAAA,cAAA,KAblE,OAAO,GAclB,CACD;AAAA,YAAA;AAAA,UAAA,GAEL;AAAA,QAAA,GAEJ;AAAA,MAAA;AAAA,IACF;AAAA,IAEA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,cAAc;AAAA,QACd,eAAe;AAAA,QACf,eAAe;AAAA,QACf;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,EACF,EAAA,CAAA;AAEJ;AC3GA,MAAM/E,SAAO,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,KAKnB,sBAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkBpB,SAAS,UAAUhF,QAAuB;AAC/C,QAAM,EAAC,YAAAmF,aAAY,UAAU,MAAM,UAAU,SAAS,UAAU,YAAY,MAAM,OAAM,IAAInF,QAEtF,aAAa,OAA8B,IAAI;AAExC,SAAA,aAAA,SAAS,CAAC,UAAU,aAAa;AAhDhD,QAAAW;AAiDQ,KAAC,YAAY,cACfA,MAAA,WAAW,YAAX,QAAoBA,IAAA,MAAA;AAAA,EAEvB,CAAA,GAGC;AAAA,IAACqE;AAAAA,IAAA;AAAA,MACC,KAAK;AAAA,MACL;AAAA,MACA,iBAAe;AAAA,MACf,QAAQ;AAAA,MACR,SAAS;AAAA,MACT;AAAA,MAEA,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,qBAAC,MAAK,EAAA,OAAM,UAAS,KAAK,GACvB,UAAA;AAAA,UAAc,cAAA,oBAAC,YAAW,EAAA,UAAU,EAAG,CAAA;AAAA,UAEvC,oBAAA,KAAA,EAAI,MAAM,GAAI,SAAS,CAAA;AAAA,WAEtB,YAAYG,eAAc,SAC1B,qBAAC,QAAK,OAAM,UAAS,MAAK,QAAO,KAAK,GAAG,OAAO,EAAC,YAAY,EAC1D,GAAA,UAAA;AAAA,YAAA,YAAa,oBAAA,KAAA,EAAI,MAAK,QAAQ,UAAS,UAAA;AAAA,YACvCA,eAAc,oBAAC,KAAI,EAAA,MAAK,QAAQ,UAAWA,aAAA;AAAA,YAC3C;AAAA,UAAA,GACH;AAAA,QAAA,GAEJ;AAAA,QACC;AAAA,MAAA,GACH;AAAA,IAAA;AAAA,EAAA;AAGN;ACxEA,MAAM,cAAc,OAAO,IAAI;AAAA,eAChB,CAAC,EAAC,YAA2B,MAAM,OAAO,UAAU,CAAC,CAAC;AAAA;AAS9D,SAAS,qBAAqBnF,QAAc;AAC3C,QAAA,EAAC,OAAO,SAAS,UAAU,GAAG,KAAQ,IAAAA,QACtC,CAAC,aAAa,cAAc,IAAI,SAAS,EAAK,GAC9C,CAAC,YAAY,aAAa,IAAI,SAA6B,IAAI,GAE/D,EAAC,GAAAa,OAAK;AAEZ,kBAAgB,MAAM,eAAe,EAAK,GAAG,CAAC,UAAU,CAAC;AAEnD,QAAA,gBAAgB,YAAY,CAAC,MAAW;AAC5C,KAAI,EAAE,QAAQ,YAAY,EAAE,QAAQ,UAClC,eAAe,EAAK;AAAA,KAErB,EAAE,GAEC,oBAAoB,YAAY,MAAM;AAC3B,mBAAA,CAAC,MAAM,CAAC,CAAC;AAAA,KACvB,CAAE,CAAA,GAEC,WAAW+E,kBAAgB,KAAK;AAEpC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAM;AAAA,MACN,KAAK;AAAA,MACL,WAAW;AAAA,MACX,QAAM;AAAA,MACN,eAAa;AAAA,MACb,MAAK;AAAA,MACL,SACG,oBAAA,aAAA,EAAY,QAAQ,GAAG,SAAS,GAAG,WAAW,eAAe,UAAU,GAAG,UAAS,QAClF,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,QAAC,oBAAA,KAAA,EACC,8BAACjE,QAAK,EAAA,QAAO,UAAU,UAAEd,GAAA,+CAA+C,GAAE,EAC5E,CAAA;AAAA,QACA,oBAACc,QAAK,EAAA,MAAM,GACV,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAd;AAAA,YACA,SAAQ;AAAA,YACR,QAAQ,EAAC,SAAQ;AAAA,UAAA;AAAA,QAAA,GAErB;AAAA,QACC,oBAAA,KAAA,EACC,UAAC,qBAAAc,QAAA,EAAK,MAAM,GACV,UAAA;AAAA,UAAA,oBAAC,iBAAgB,EAAA;AAAA,UAAE;AAAA,UAAEd,GAAE,uDAAuD;AAAA,QAAA,EAAA,CAChF,EACF,CAAA;AAAA,QACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAA,oBAACc,UAAK,MAAM,GAAG,QAAO,UACnB,UAAAd,GAAE,oDAAoD,GACzD;AAAA,UACA,oBAAC,QAAK,SAAS,GAAG,UAAS,QAAO,QAAM,IACtC,UAAA,oBAAC,MAAK,EAAA,MAAM,GAAG,IAAG,OAAM,UAAS,QAC9B,UAAA,KAAK,UAAU,OAAO,MAAM,CAAC,EAAA,CAChC,EACF,CAAA;AAAA,QAAA,GACF;AAAA,MAAA,EAAA,CACF,EACF,CAAA;AAAA,MAGF,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAG;AAAA,UACH,MAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAK;AAAA,UACL,UAAU;AAAA,UACV,UAAU;AAAA,UACV,MAAM;AAAA,UACN;AAAA,UACA,SAAS;AAAA,UACT,WAAW;AAAA,UACX,sBAAoB;AAAA,UACnB,GAAG;AAAA,UAEJ,UAAA,qBAAC,MAAK,EAAA,OAAM,UACV,UAAA;AAAA,YAAC,oBAAA,KAAA,EAAI,aAAa,GAChB,UAAA,oBAACc,UACC,UAAC,oBAAA,aAAA,CAAA,CAAY,GACf,EACF,CAAA;AAAA,YAEA,oBAAC,OAAI,MAAM,GACT,8BAACA,QAAK,EAAA,MAAM,GAAG,cAAa,YAC1B,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,GAAAd;AAAA,gBACA,SAAQ;AAAA,gBACR,QAAQ,EAAC,SAAQ;AAAA,cAAA;AAAA,eAErB,EACF,CAAA;AAAA,UAAA,GACF;AAAA,QAAA;AAAA,MACF;AAAA,IAAA;AAAA,EAAA;AAGN;ACtGA,MAAM6H,uBAAqB,EAAC,QAAQ,IAAM,MAAM,UAAS;AAElD,SAAS,UAAU1I,QAIvB;AACD,QAAM,EAAC,QAAQ,UAAU,SAAY,IAAAA,QAC/BR,MAAK,SAEL,EAAC,GAAAqB,GAAC,IAAI,eAAe;AAGzB,SAAA,oBAAC,KAAI,EAAA,UAAU,GACb,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,YAAY;AAAA,MACZ,MAAK;AAAA,MACL,MACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAQ,oBAAC,mBAAkB,EAAA,UAAU,EAAG,CAAA;AAAA,UACxC,IAAI,GAAGrB,GAAE;AAAA,UACT,0BACG,MACC,EAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAMqB,GAAE,yCAAyC;AAAA,cACjD,MAAK;AAAA,cACL,MAAM;AAAA,cACN,SAAS;AAAA,YAAA;AAAA,UAAA,GAEb;AAAA,UAEF,SAAS6H;AAAAA,QAAA;AAAA,MACX;AAAA,MAGD,UAAA,OAAO,MAAM,SAAS,0CACpB,sBAAqB,EAAA,OAAO,OAAO,MAAM,MAAA,CAAO,IAEhD,oBAAA,OAAA,EAAK,aAAE,uCAAuC,EAAC,OAAO,OAAO,MAAM,KAAI,CAAC,EAAE,CAAA;AAAA,IAAA;AAAA,EAGjF,EAAA,CAAA;AAEJ;ACpDgB,SAAA,eAAkB,MAAS,SAA2C;AAE9E,QAAA,cAAc,OAAU,IAAI,GAC5B,WAAW,YAAY,SAGvB9I,WAAU,QAAQ,UAAU,IAAI;AAItC,SAAA,UAAU,MAAM;AACT,IAAAA,aACH,YAAY,UAAU;AAAA,EAAA,CAEzB,GAEMA,WAAU,WAAW;AAC9B;ACKA,MAAMiG,UAAY,CAAA;AAEX,SAAS,eAAwC7F,QAAuC;AA1B/F,MAAAW;AA2BQ,QAAA;AAAA,IACJ,gBAAgB,iBAAiB;AAAA,IACjC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,iBAAAiG;AAAA,IACA;AAAA,IACA,QAAQf;AAAAA,EAAA,IACN7F,QACE,EAAC,GAAAa,OAAK,eAAe,GAGrB,CAAC,qBAAqB,sBAAsB,IAAI,SAAwB,IAAI,GAC5E,EAAC,UAAS,SAAS,EAAE,QAErB,gBAAgB;AAAA,IACpB,CAAC,SAAe;AACL,eAAA,EAAC,OAAO,CAAC,IAAI,GAAG,UAAU,UAAU,eAAe,EAAA,CAAE;AAAA,IAChE;AAAA,IACA,CAAC,QAAQ;AAAA,KAGL,eAAe;AAAA,IACnB,CAAC,SAAe;AACL,eAAA,EAAC,OAAO,CAAC,IAAI,GAAG,UAAU,SAAS,eAAe,GAAA,CAAG;AAAA,IAChE;AAAA,IACA,CAAC,QAAQ;AAAA,KAGL,aAAa;AAAA,IACjB,QAAQ,MAAM,QAAQ,IAAI,CAAC,WAAW,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC;AAAA,IAC5D;AAAA,EAGI,GAAA,EAAC,eAAe,iBAAoB,IAAA,6BAAA,GACpC,YAAY,OAAuB,IAAI,GAEvC,eAAe,QAAQ,MACpB,aAAa,UAAU,CAAC,CAAC,IAAI,UAAU,CAAC,EAAE,OAAO,UAAU,CAAC,GAClE,CAAC,SAAS,CAAC,GAOR,iBAAiB;AAAA,IACrB,CAAC0G,WAAiB;AACV,YAAA,WAAW,EAAC,GAAGA;AASrB,UANI,wBAAwB,SAC1B,SAAS,aAAa,KAAK,IAAIA,OAAM,YAAY,mBAAmB,GACpE,SAAS,WAAW,KAAK,IAAIA,OAAM,UAAU,mBAAmB,IAI9D,cAAc;AAChB,cAAM,QAAQ,WAAW,UAAU,CAAC,QAAQ,QAAQ,YAAY;AAC5D,kBAAU,OACZ,SAAS,aAAa,KAAK,IAAI,SAAS,YAAY,KAAK,GACzD,SAAS,WAAW,KAAK,IAAI,SAAS,UAAU,KAAK;AAAA,MAEzD;AAEA,aAAO,sBAAsB,QAAQ;AAAA,IACvC;AAAA,IACA,CAAC,qBAAqB,cAAc,UAAU;AAAA,KAQ1C,uBAAuB;AAAA,IAG3B,CAAC,UAAU,aAAa;AACtB,UAAI,CAAC,SAAS;AACZ;AAGF,YAAM,SAAS,SAAS,eAElB,eAAe,MAAM;AA5HjC,YAAA5G,MAAA,IAAA,IAAA;AA6Hc,cAAA,uBAAsB,MAAAA,OAAA,iBAAiB,YAAjB,OAAAA,SAAAA,KAA0B,sBAAwB,EAAA,QAAlD,OAAyD,KAAA,GAC/E,oBAAmB,MAAU,KAAA,UAAA,YAAV,OAAmB,SAAA,GAAA,wBAAwB,QAA3C,OAAA,KAAkD,GAKrE,aAAa,KAAK,MAAM,mBAAmB,mBAAmB;AAE3D,iBAAA,OAAO,YAAY,UAAU;AAAA,MAAA;AAGxC,aAAA,aAEA,GAAA,SAAS,cAAc,iBAAiB,UAAU,cAAc;AAAA,QAC9D,SAAS;AAAA,QACT,SAAS;AAAA,MACV,CAAA,GAEM,MAAM;AACJ,eAAA,oBAAoB,UAAU,YAAY;AAAA,MAAA;AAAA,IAErD;AAAA,IACA,CAAC,gBAAgB;AAAA,EAAA,GAKb,eAAe,YAAY,MAAM,IAAI,CAAA,CAAE,GAEvC,cAAc,eAAe;AAAA,IACjC,OAAO,QAAQ;AAAA,IACf;AAAA,IACA,kBAAkB,YAAY,MAAM,eAAe,CAAC,aAAa,CAAC;AAAA,IAClE;AAAA,IACA;AAAA,IACA,YAAY,YAAY,CAAC,UAAkB,WAAW,KAAK,GAAG,CAAC,UAAU,CAAC;AAAA,IAC1E,YAAY,CAAC,QAAQ,SAAS,aAAa;AAIrC,iBAAW,SAAS,gBAGxB,cAAc,QAAQ,SAAS,QAAQ;AAAA,IACzC;AAAA,EAAA,CACD,GAEK,QAAQ,YAAY,gBAEpB,GAAA,sBAAsB,YAAY,CAAC,UAA0B;AA9KrE,QAAAA,MAAA;AA+KU,UAAA,EAAC,OAAU,IAAA;AACM,4BAAA,MAAAA,OAAA,OAAO,KAAK,YAAZ,OAAAA,SAAAA,KAAqB,aAArB,OAAA,SAAA,GAA+B,KAAK;AAAA,KAC1D,EAAE,GAEC,oBAAoB,YAAY,MAAM;AAC1C,2BAAuB,IAAI;AAAA,EAAA,GAC1B,CAAE,CAAA,GAEC,aAAWA,MAAW,WAAA,YAAX,OAAoB,SAAAA,IAAA,cAAa,IAE5C,cAAc,GACd,WAAW,GACX,SAAS;AAEf,SACG,qBAAA,OAAA,EAAM,OAAO,GAAG,KAAK,WACpB,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,OAAO,WAAW;AAAA,QAClB,iBAAAiG;AAAA,QACA;AAAA,QACC,GAAG;AAAA,QACJ,UAAU;AAAA,QAEV,UAAC,oBAAA,OAAA,EAAM,WAAQ,uBAAsB,OAAO,GACzC,UAAA,QAAQ,WAAW,IACjB,oBAAA,MAAA,EAAK,SAAS,GAAG,QAAM,IAAC,QAAQ,GAC/B,UAAA,oBAACjF,QAAK,EAAA,OAAM,UAAS,OAAK,IAAC,MAAM,GAC9B,UAAW,WAAA,+CAAkB,UAAEd,GAAA,6BAA6B,GAAE,EAAA,CACjE,EACF,CAAA,IAEA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,QAAM;AAAA,YACN;AAAA,YACA,OAAO;AAAA;AAAA;AAAA,cAGL,WAAW;AAAA,cACX,QAAQ,GACN,YAAY,aAAA,IAAiB,MAAM,SAAS,MAAM,WAAW,IAAI,MAAM,QAAQ,CACjF;AAAA,cACA,OAAO;AAAA,cACP,UAAU;AAAA,YACZ;AAAA,YAEA,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAK;AAAA,gBACL,KAAK;AAAA,gBACL;AAAA,gBACA,OAAO;AAAA,gBACP;AAAA,gBACA,iBAAiB;AAAA,gBACjB,eAAe;AAAA,gBACf;AAAA,gBACA,OAAO;AAAA;AAAA,kBAEL,UAAU;AAAA,kBACV,KAAK;AAAA,kBACL,MAAM;AAAA,kBACN,OAAO;AAAA,kBACP,WAAW,cAAc,MAAM,CAAC,EAAE,KAAK;AAAA,gBACzC;AAAA,gBAEC,UAAA,MAAM,IAAI,CAAC,eAAe;AACnB,wBAAA,SAAS,QAAQ,WAAW,KAAK;AAErC,yBAAA;AAAA,oBAAC;AAAA,oBAAA;AAAA,sBACC,KAAK,YAAY;AAAA,sBAEjB;AAAA,sBACA,cAAY,WAAW;AAAA,sBACvB,IAAI,OAAO;AAAA,sBAEV,UAAA;AAAA,wBAAA,OAAO,SAAS,UACf;AAAA,0BAAC;AAAA,0BAAA;AAAA,4BACC;AAAA,4BACA;AAAA,4BACA;AAAA,4BACA;AAAA,4BACA;AAAA,4BACA;AAAA,4BACA;AAAA,4BACA;AAAA,0BAAA;AAAA,wBACF;AAAA,wBAED,OAAO,SAAS,WACf;AAAA,0BAAC;AAAA,0BAAA;AAAA,4BACC;AAAA,4BACA;AAAA,4BACA,UAAU,MAAMb,OAAM,aAAa,OAAO,GAAG;AAAA,0BAAA;AAAA,wBAC/C;AAAA,sBAAA;AAAA,oBAAA;AAAA,oBAtBG,WAAW;AAAA,kBAAA;AAAA,gBAwBlB,CAEH;AAAA,cAAA;AAAA,YACH;AAAA,UAAA;AAAA,QAAA,GAGN;AAAA,MAAA;AAAA,IACF;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,cAAc;AAAA,QACd,eAAe;AAAA,QACf,eAAe;AAAA,QACf;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,EACF,EAAA,CAAA;AAEJ;ACtRO,SAAS,oBAAoBA,QAAiC;AATrE,MAAAW;AAWE,WADeA,MAAMX,OAAA,WAAW,YAAjB,OAAA,SAAAW,IAA0B,YAAW,SACpC,oBAAC,gBAAgB,EAAA,GAAGX,OAAO,CAAA,IAAM,oBAAA,gBAAA,EAAgB,GAAGA,OAAO,CAAA;AAC7E;ACFA,SAAS,QAAQ,MAAW,WAAyB;AACnD,MAAI,SAAS;AACJ,WAAA;AAEL,MAAA,OAAO,QAAS,OAAO;AAClB,WAAA;AAET,MAAI,OAAO,QAAS,YAAY,CAAC,MAAM,QAAQ,IAAI;AACjD,WAAO,SAAS;AAElB,MAAI,KAAK,QAAQ,KAAK,SAAS,UAAU;AAChC,WAAA;AAEL,MAAA,MAAM,QAAQ,IAAI;AACpB,WAAI,CAAC,KAAK,WAAW,UAAU,SACtB,KAEF,KAAK,MAAM,CAAC,IAAI,MAAM,QAAQ,KAAK,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC;AAEvD,QAAA,OAAO,OAAO,KAAK,IAAI,GACvB,YAAY,OAAO,KAAK,IAAI;AAClC,SAAI,KAAK,WAAW,UAAU,SACrB,KAEF,KAAK,MAAM,CAAC,YAAY,QAAQ,KAAK,OAAO,GAAG,UAAU,OAAO,CAAC,CAAC;AAC3E;AAEA,SAAS,QAAQ,OAAkB,WAAoB;AAC9C,SAAA,QAAQ,MAAM,KAAK,CAAC,SAAS,QAAQ,MAAM,SAAS,CAAC,IAAI;AAClE;AAEA,SAAS2F,sBAAoB,YAA6B,MAAe;AAChE,SAAA,WAAW,GAAG,KAAK,CAAC,eAAe,WAAW,SAASC,kBAAgB,IAAI,CAAC;AACrF;AAEA,MAAMtF,gBAAyB,CAAA;AAexB,SAAS,0BAA0BN,QAAiC;AA5D3E,MAAAW,KAAA;AA6DQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,QAAQ,CAAC;AAAA,IACT;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEX,QAEE,UAAU;AAAA,IACd,MAAG;AA1EPW,UAAAA;AA2EQ,gBAAAA,OAAA,WAAW,YAAX,OAAAA,SAAAA,KAAoB,SAAQL,eAAgC;AAAA,QAAI,CAAC,QAAQ,UACzE,cAAc,MAAM,IAAI,SAAS,EAAC,GAAG,QAAQ,MAAM,kBAAkB,KAAK,GAAE;AAAA,MAAA;AAAA,IAC9E;AAAA,IACF,EAACK,MAAA,WAAW,YAAX,OAAA,SAAAA,IAAoB,IAAI;AAAA,KAGrB,eAAe;AAAA,IACnB,CAAC,WAAoB,kBAAgC;AACnD,UAAI,CAAC,aAAa,cAAc,aAAa,GAAG;AAErC,iBAAA,MAAM,CAAC,EAAC,MAAM,cAAc,KAAI,CAAC,CAAC,CAAC;AAC5C;AAAA,MACF;AAEA,YAAM,YAAY,QAAQ;AAAA,QAAO,CAAC,WAChC,QAAQ,eAAe,MAAM,IAAI,YAAY,QAAQ,OAAO,MAAM;AAAA,MAAA;AAGpE,eAAS,UAAU,SAAS,IAAI,IAAI,SAAS,IAAI,OAAO;AAAA,IAC1D;AAAA,IACA,CAAC,UAAU,SAAS,KAAK;AAAA,KAGrB,kBAAkB;AAAA,IACtB,CAAC,UAAkB;AACL,kBAAA,CAAC,KAAK,CAAC;AAAA,IACrB;AAAA,IACA,CAAC,WAAW;AAAA,EAGR,GAAA,WAAS,KAAW,WAAA,YAAX,mBAAoB,YAAW;AAE9C,6BACG,iBAAgB,EAAA,MAAY,WAAW,SAAS,UAAU,IACzD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,KAAK;AAAA,MACL,SAAS,SAAS,KAAK,IAAI,QAAQ,QAAQ,CAAC,IAAI;AAAA,MAChD,UAAU;AAAA,MACT,GAAG;AAAA,MAEH,UAAQ,QAAA,IAAI,CAAC,QAAQ,UAAU;AACxB,cAAA,aAAagF,sBAAoB,YAAY,MAAM,GACnD,UAAU,QAAQ,OAAO,MAAM,GAC/B,WAAW,CAAC;AAElB,oCACG,MAAiB,EAAA,OAAM,UAAS,IAAG,SAAQ,OAAO,UACjD,UAAA;AAAA,UAAA;AAAA,YAACoF;AAAAA,YAAA;AAAA,cACC;AAAA,cACA;AAAA,cACA,UAAU,CAAC,MAAM,aAAa,EAAE,cAAc,SAAS,MAAM;AAAA,cAC7D,SAAS,MAAM,gBAAgB,KAAK;AAAA,cACpC;AAAA,YAAA;AAAA,UACF;AAAA,8BACC,KAAI,EAAA,MAAM,GAAG,YAAY,GACvB,uBACC,cAAc;AAAA,YACZ,QAAQ;AAAA,YACR,YAAY;AAAA,YACZ,OAAO;AAAA,UAAA,CACR,IAED,oBAAC,QAAK,MAAK,WAAU,QAAQ,GAC3B,UAAA,oBAAC/E,wBAAqB,EAAA,OAAO,QAAQ,SAAS,MAAM,gBAAgB,KAAK,EAAA,CAAG,EAC9E,CAAA,GAEJ;AAAA,QAAA,EAAA,GApBS,KAqBX;AAAA,MAAA,CAEH;AAAA,IAAA;AAAA,EAEL,EAAA,CAAA;AAEJ;ACzIA,SAAS,kBAAkB,QAAsD;AAC/E,SAAO,GAAQ,UAAU,OAAO,UAAW,YAAY,WAAW,UAAU,WAAW;AACzF;AAEA,SAAS,iBAAiB,SAAoB;AAC5C,SAAO,QAAQ,IAAI,CAAC,WACd,kBAAkB,MAAM,IACnB;AAAA,IACL,OAAO,OAAO,SAAS,UAAU,OAAO,OAAO,KAAK,CAAC;AAAA,IACrD,OAAO,OAAO;AAAA,EAAA,IAGX;AAAA,IACL,OAAO,UAAU,OAAO,MAAM,CAAC;AAAA,IAC/B,OAAO;AAAA,EAAA,CAEV;AACH;AAOA,SAAS,oBAAoB,YAA6B,QAAmC;AACpF,SAAA,WAAW,GAAG,KAAK,CAAC,eAAe,WAAW,SAASJ,kBAAgB,OAAO,KAAK,CAAC;AAC7F;AAUO,SAAS,6BAA6B5F,QAAoC;AA/CjF,MAAAW,KAAA;AAgDQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA,QAAQ,CAAC;AAAA,IACT;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEX,QAEE,UAAU;AAAA,IACd,MAAG;AA5DPW,UAAAA;AA4DU,aAAA,mBAAiBA,OAAA,WAAW,YAAX,gBAAAA,KAAoB,SAAQ,CAAE,CAAA;AAAA,IAAA;AAAA,IACrD,EAACA,MAAA,WAAW,YAAX,OAAA,SAAAA,IAAoB,IAAI;AAAA,EAAA,GAGrB,eAAe,CAAC,WAAoB,iBAA4C;AACpF,UAAM,YAAY,QACf,IAAI,CAAC,WAAW,OAAO,KAAK,EAC5B;AAAA,MAAO,CAAC;AAAA;AAAA,QAEP,gBAAgB,eAAe,YAAY,MAAM,SAAS,WAAW;AAAA;AAAA,IAAA;AAGzE,aAAS,UAAU,SAAS,IAAI,IAAI,SAAS,IAAI,OAAO;AAAA,EAGpD,GAAA,WAAS,KAAW,WAAA,YAAX,mBAAoB,YAAW;AAG5C,SAAA,oBAAC,iBAAgB,EAAA,MAAY,WAAW,SAAS,UAAU,IACzD,UAAC,oBAAA,MAAA,EAAK,KAAK,GAAG,SAAS,SAAS,KAAK,IAAI,QAAQ,QAAQ,CAAC,IAAI,GAAI,GAAG,cAClE,UAAQ,QAAA,IAAI,CAAC,QAAQ,UAAU;AAC9B,UAAM,aAAa,oBAAoB,YAAY,MAAM,GACnD,UAAU,MAAM,SAAS,OAAO,KAAK,GAErC,WAAW,CAAC;AAElB,gCACG,MAAiB,EAAA,OAAM,UAAS,IAAG,SAAQ,OAAO,UACjD,UAAA;AAAA,MAAA;AAAA,QAACoK;AAAAA,QAAA;AAAA,UACC;AAAA,UACA;AAAA,UACA,UAAU,CAAC,MAAM,aAAa,EAAE,cAAc,SAAS,OAAO,KAAK;AAAA,UACnE,SAAS,MAAM,aAAa,KAAK;AAAA,UACjC;AAAA,QAAA;AAAA,MACF;AAAA,MAEA,oBAAC,OAAI,SAAS,GACZ,8BAACpJ,QAAM,EAAA,UAAA,OAAO,OAAM,EACtB,CAAA;AAAA,MAEC,CAAC,cACA,oBAAC,sBAAqB,EAAA,OAAO,QAAQ,SAAS,MAAM,aAAa,KAAK,GAAG;AAAA,IAAA,EAAA,GAdlE,KAgBX;AAAA,EAAA,CAEH,GACH,EACF,CAAA;AAEJ;AChGO,SAAS,oBAAoB3B,QAA+D;AAC1F,SAAA,2BAA2BA,MAAK,IACpC,oBAAA,2BAAA,EAA2B,GAAGA,OAAO,CAAA,IAEtC,oBAAC,8BAA8B,EAAA,GAAGA,OAAO,CAAA;AAE7C;ACNO,SAAS,2BAGdA,QAAyD;AACzD,QAAM,EAAC,YAAY,UAAU,UAAU,eAAe,iBAAgBA,QAChE,eAAe,SACf,EAAC,GAAAa,GAAK,IAAA,eAAA,GAEN,aAAa;AAAA,IACjB,CAAC,aAAkB;AACJ,mBAAA,cAAc,QAAQ,CAAC;AAAA,IACtC;AAAA,IACA,CAAC,eAAe,YAAY;AAAA,EAAA,GAGxB,oBAAoB,YAAY,MAAM;AAC/B,eAAA,WAAW,GAAG,CAAC,CAAC;AAAA,EAAA,GAC1B,CAAC,YAAY,UAAU,CAAC,GAErB,eAAe,QAAQ,OAAO,EAAC,eAAe,IAAM,QAAQ,OAAQ,EAAE,GAItE,iBACJ,WAAW,GAAG,SAAS,IACnB,6CACA;AAEN,SAAI,WAEC,oBAAA,SAAA,EAAQ,QAAM,IAAC,SAASA,GAAE,8BAA8B,GACvD,UAAA,oBAAC,QACC,UAAC,oBAAA,QAAA,EAAO,MAAM,SAAS,MAAK,SAAQ,UAAQ,IAAC,MAAK,SAAQ,MAAMA,GAAE,cAAc,EAAG,CAAA,GACrF,EACF,CAAA,IAKD,qBAAA,MAAA,EAAK,KAAK,GAAG,OAAO,EAAC,qBAAqB,uCACxC,GAAA,UAAA;AAAA,IAAW,WAAA,GAAG,WAAW,IACxB;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAK;AAAA,QACL,MAAMA,GAAE,cAAc;AAAA,MAAA;AAAA,IAAA,IAGxB;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ,oBAAC,QAAO,EAAA,MAAM,SAAS,MAAK,SAAQ,MAAK,SAAQ,MAAMA,GAAE,cAAc,EAAG,CAAA;AAAA,QAClF,IAAI,gBAAgB;AAAA,QACpB,0BACG,MACE,EAAA,UAAA,WAAW,GAAG,IAAI,CAAC,WAAW,MAAM;AAnEnD,cAAAF,KAAA;AAqEsB,gBAAA,gBACJ,sBAAsB,SAAS,MAC9B,UAAU,MAAM,IAAI,WAAW,KAChC,UAAU,GAAG,CAAC,EAAE,MAEZ,OAAO,UAAU,UAAQA,MAAA,UAAU,SAAV,OAAA,SAAAA,IAAgB,SAAQ;AAErD,iBAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cAEC,MAAM,UAAU,WAAS,KAAA,UAAU,SAAV,OAAgB,SAAA,GAAA;AAAA,cACzC,SAAS,MAAM,WAAW,SAAS;AAAA,cACnC;AAAA,YAAA;AAAA,YAHK;AAAA,UAAA;AAAA,QAMV,CAAA,GACH;AAAA,QAEF,SAAS;AAAA,MAAA;AAAA,IACX;AAAA,IAGD;AAAA,EACH,EAAA,CAAA;AAEJ;ACzEA,MAAMqK,8BAA4B,EAAC,QAAQ,IAAM,MAAM,UAAS,GAEnD,UAAU,WAAW,SAChChL,QACA,KACA;AACM,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAAmF;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,IAAInF,QAEE,WAAWmF,YAAW,OAAO,CAAC,SAAS,KAAK,UAAU,OAAO,EAAE,SAAS,GACxE,aAAaA,YAAW,OAAO,CAAC,SAAS,KAAK,UAAU,SAAS,EAAE,SAAS,GAE5E,eAAe;AAAA,IACnB,CAAC,KAAyB,eAA2B;AAC1C,eAAA,EAAC,UAAU,KAAK,OAAO,CAAC,cAAc,UAAU,CAAC,EAAA,CAAE;AAAA,IAC9D;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA,GAGL,kBAAkB,YAAY,MAAM;AACpC,aAAO,SAAS,EAAC,UAAU,SAAS,OAAO,CAAC,KAAK,EAAA,CAAE;AAAA,EAAA,GACtD,CAAC,UAAU,KAAK,CAAC,GAEd,OAAO,QAAQ,MAAM;AACrB,QAAA;AACK,aAAA;AAEL,QAAA;AACK,aAAA;AAAA,EAAA,GAIR,CAAC,UAAU,UAAU,CAAC,GAEnB,EAAC,GAAAtE,OAAK,kBAEN,OACJ;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAQ,oBAAC,mBAAkB,EAAA,UAAU,EAAG,CAAA;AAAA,MACxC,IAAI,GAAG,OAAO;AAAA,MACd,SAASmK;AAAAA,MACT,2BACG,MACC,EAAA,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAMnK,GAAE,4BAA4B;AAAA,YACpC,MAAK;AAAA,YACL,MAAM;AAAA,YACN,SAAS;AAAA,UAAA;AAAA,QACX;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAMA,GAAE,+BAA+B;AAAA,YACvC,MAAMiK;AAAAA,YACN,SAAS;AAAA,UAAA;AAAA,QACX;AAAA,QACC,oBAAAF,cAAA,EAAW,OAAO,iBAAiB,UAAU,cAAc;AAAA,MAAA,GAC9D;AAAA,IAAA;AAAA,EAAA;AAMJ,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,MAAM,CAAC,YAAY;AAAA,MACnB,YAAY,CAAC,YAAY;AAAA,MACzB,UAAU,SAAS,WAAW,IAAI,OAAQ,oBAAA,eAAA,EAAc,UAAoB,YAAY,EAAG,CAAA;AAAA,MAC3F,YACEzF,YAAW,SAAS,wBACjB,KAAI,EAAA,UAAU,GAAG,UAAU,GAC1B,UAAA,oBAAC,2BAA0B,EAAA,YAAAA,YAAwB,CAAA,EACrD,CAAA,IACE;AAAA,MAGN,UAAA,oBAAC,QAAK,OAAO,aAAa,aAAa,UAAU,KAC/C,8BAAC,MAAK,EAAA,OAAM,YAAW,MAAM,GAC3B,8BAAC,KAAI,EAAA,MAAM,GAAG,aAAa,GACxB,SACH,CAAA,EAAA,CACF,EACF,CAAA;AAAA,IAAA;AAAA,EAAA;AAGN,CAAC;ACxGe,SAAA,mBAAmB,EAAC,cAA4C;AACxE,QAAA,EAAC,GAAAtE,OAAK;AAEV,SAAA,oBAAC,QAAK,SAAS,GAAG,QAAM,IAAC,QAAQ,GAC/B,UAAC,oBAAAc,QAAA,EAAK,OAAM,UAAS,OAAK,IAAC,MAAM,GAC9B,qBAAW,eAAed,GAAE,6BAA6B,EAC5D,CAAA,EACF,CAAA;AAEJ;ACdgB,SAAA,eAAkB,OAAY,UAAkB,eAAkB;AAChF,SAAO,aAAa,OAAO,UAAU,CAAC,YAAY,YAAY,aAAa;AAC7E;AAOgB,SAAA,aACd,OACA,UACA,WACA;AACI,MAAA,WAAW,WAAW,GACtB,WAAW;AACf,QAAM,MAAM,MAAM;AACX,SAAA,WAAW,MAAM,WAAW,OAAK;AAChC,UAAA,QAAQ,MAAM,QAAQ;AAC5B,QAAI,WAAW,OAAO,UAAU,OAAO,QAAQ;AACtC,aAAA;AAEH,UAAA,QAAQ,MAAM,QAAQ;AAC5B,QAAI,WAAW,MAAM,UAAU,OAAO,QAAQ;AACrC,aAAA;AAGT,gBAAA;AAAA,EACF;AACO,SAAA;AACT;ACPO,MAAM,+BAA+B,cAAkD;AAAA,EAG5F,YAAYb,QAAoC;AAC9C,UAAMA,MAAK,GAHkB,KAAA,WAAA,MAU/B,KAAA,eAAe,CAAC,cAA8B;AAC5C,YAAM,EAAC,QAAQ,IAAI,cAAc,iBAAgB,KAAK;AACtD,mBAAa,SAAS,GACtB,aAAa,MAAM,MAAM;AAAA,IAAA,GAG3B,KAAA,gBAAgB,CAAC,cAA8B;AAC7C,YAAM,EAAC,cAAc,QAAQ,CAAA,GAAI,kBAAiB,KAAK;AACvD,oBAAc,SAAS,GACvB,aAAa,MAAM,MAAM;AAAA,IAAA,GAG3B,KAAA,gBAAgB,CAAC,UAAgD;AAC/D,YAAM,EAAC,cAAc,YAAY,MAAA,IAAS,KAAK;AAE3C,eAAO,WAAW,KAAK,GAC3B,aAAa,MAAM,OAAO;AAAA,IAAA,GAI5B,KAAA,sBAAsB,MAAM;AAC1B,WAAK,SAAS,EAAC,mBAAmB,GAAM,CAAA;AAAA,IAAA,GAM1C,KAAA,oBAAoB,MAAM;AACxB,WAAK,SAAS,EAAC,mBAAmB,GAAK,CAAA;AAAA,IAAA,GAyEzC,KAAA,kBAAkB,CAACA,WAAqD;AA5I1E,UAAAW;AA6IU,YAAA,EAAC,eAAc,KAAK,OACpB,aAAWA,MAAA,WAAW,YAAX,OAAA,SAAAA,IAAoB,cAAa;AAClD,iCAAQ,SAAS,EAAA,GAAGX,QAAO,UAAoB,iBAAiB,WAAW,GAAI,CAAA;AAAA,IAAA,GA7G/E,KAAK,QAAQ;AAAA,MACX,mBAAmB;AAAA,IAAA;AAAA,EAEvB;AAAA,EAiCA,QAAQ;AACF,SAAK,YACP,KAAK,SAAS,MAAM;AAAA,EAExB;AAAA,EAEA,wBAAwB,WAAwC;AA5ElE,QAAAW;AA6EI,UAAM,EAAC,WAAW,gBAAgB,CAAI,GAAA,OAAO,YAAY,OAAM,WACzD,EAAC,YAAY,CAAA,GAAI,QAAQ,CAAA,MAAM,KAAK;AACtC,QAAA,cAAc,CAAC,MAAM,UAAU,CAAC,KAAK,UAAU,WAAW,MAAM,QAAQ;AAE1E,YAAM,aAAa,UAAU,CAAC,GAExB,YAAY,OAAO;AACrB,UAAA,GAAE,uCAAW,sBAAqB;AAC7B,eAAA;AAGT,YAAM,SAAQA,MAAA,UAAU,cAAV,OAAA,SAAAA,IAAqB,cAAc,gBAAA;AAEjD,aAAO,iBAAiB,mBACpB;AAAA,QACE,kBAAkB;AAAA,QAClB,kBAAkB;AAAA,UAChB,MAAM,UAAU,SAAS;AAAA,UACzB,OAAO,MAAM;AAAA,UACb,KAAK,MAAM;AAAA,UACX,OAAO,MAAM;AAAA,QACf;AAAA,UAEF;IACN;AAEO,WAAA;AAAA,EACT;AAAA,EAEA,mBACE,WACA,WACA,UACA;AA9GJ,QAAAA;AA+GU,UAAA,EAAC,aAAY,IAAI,KAAK;AACxB,QAAA,YAAA,QAAA,SAAU,oBAAoB,UAAU,OAAO;AACjD,YAAM,mBAAmB,UAAU,MAAM,SAAS,gBAAgB,GAE5DsK,gBAAe;AAAA,QACnB,KAAK,MAAM,SAAS,CAAC;AAAA,QACrB,SAAS;AAAA,QACT;AAAA,MAAA;AAGF,UAAIA,kBAAiB;AACnB;AAEI,YAAA,YAAWtK,MAAK,KAAA,aAAL,OAAe,SAAAA,IAAA;AAAA,QAC9B,qBAAqBsK,aAAY;AAAA,MAAA;AAGnC,UAAI,oBAAoB,kBAAkB;AACxC,iBAAS,MAAM;AACX,YAAA;AACF,mBAAS,kBAAkB,SAAS,iBAAiB,OAAO,SAAS,iBAAiB,GAAG;AAAA,QAAA,QACnF;AAAA,QAER;AAAA,MACF;AACA,mBAAaA,aAAY;AAAA,IAC3B;AAAA,EACF;AAAA,EAQA,SAAS;AACD,UAAA;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,iBAAArE;AAAA,MACA;AAAA,MACA,gBAAgB,iBAAiB;AAAA,MACjC;AAAA,IAAA,IACE,KAAK,OAEH,aAAa,CAAC,YAAY,IAAI,YAAY,kBAAkB,MAAM,IAIlE,qBAAqB,QAAQ,IAAI,CAAC,YAAY;AAAA,MAClD,IAAI,GAAG,OAAO,GAAG,IAAI,OAAO,SAAS,SAAS,OAAO,KAAK,QAAQ,OAAO;AAAA,MACzE;AAAA,IACA,EAAA;AAEF,WACG,qBAAA,OAAA,EAAM,OAAO,GAAG,eAAY,0BAC3B,UAAA;AAAA,MAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,OAAO,WAAW;AAAA,UAClB,iBAAAA;AAAA,UACA;AAAA,UACC,GAAG;AAAA,UACJ,UAAU;AAAA,UAEV,8BAAC,OAAM,EAAA,OAAO,GACX,UAAA,mBAAmB,WAAW,IAC7B,oBAAC,oBAAmB,EAAA,YAAwB,IAE3C,oBAAA,MAAA,EAAK,SAAS,GAAG,QAAM,IACtB,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,YAAY,KAAK;AAAA,cACjB,iBAAiB,KAAK;AAAA,cACtB,eAAe,KAAK;AAAA,cACpB,OAAO,mBAAmB,IAAI,CAAC,MAAM,EAAE,EAAE;AAAA,cACzC,UAAU;AAAA,cACV,KAAK;AAAA,cAEJ,6BAAmB,IAAI,CAAC,EAAC,QAAQ,IAAApH,IAAA,GAAK,UAEnC;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBAEC,IAAAA;AAAA,kBACA,UAAU;AAAA,kBACV,mBAAmB,KAAK,MAAM;AAAA,kBAE7B,UAAA;AAAA,oBAAA,OAAO,SAAS,UACf;AAAA,sBAAC;AAAA,sBAAA;AAAA,wBACC,MAAM,OAAO,KAAK;AAAA,wBAClB,WAAW;AAAA,wBACX,UAAU;AAAA,wBAEV,UAAA;AAAA,0BAAC;AAAA,0BAAA;AAAA,4BACC;AAAA,4BACA,YAAY,KAAK;AAAA,4BACjB;AAAA,0BAAA;AAAA,wBACF;AAAA,sBAAA;AAAA,oBACF;AAAA,oBAED,OAAO,SAAS,WACf;AAAA,sBAAC;AAAA,sBAAA;AAAA,wBACC,UAAU;AAAA,wBACV;AAAA,wBACA,UAAU,MAAM,aAAa,KAAK;AAAA,sBAAA;AAAA,oBACpC;AAAA,kBAAA;AAAA,gBAAA;AAAA,gBAvBG,OAAO;AAAA,cAAA,CA2BjB;AAAA,YAAA;AAAA,aAEL,EAEJ,CAAA;AAAA,QAAA;AAAA,MACF;AAAA,MAEA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,UAAU,KAAK,MAAM;AAAA,UACrB,cAAc,KAAK;AAAA,UACnB,eAAe,KAAK;AAAA,UACpB,eAAe;AAAA,UACf,UAAU,KAAK,MAAM;AAAA,UACrB,YAAY,KAAK,MAAM;AAAA,UACvB,OAAO,KAAK,MAAM;AAAA,QAAA;AAAA,MACpB;AAAA,IACF,EAAA,CAAA;AAAA,EAEJ;AACF;AC7NO,SAAS,oBAAoBQ,QAA+D;AACnE,SAAA;AAAA,IAC5B,MAAG;AArBP,UAAAW;AAqBU,aAAA,MAAM,SAAQA,MAAAX,OAAM,WAAW,YAAjB,oBAA0B,IAAI;AAAA,IAAA;AAAA,IAClD,CAACA,OAAM,UAAU;AAAA,EAAA,IAIT,oBAAA,qBAAA,EAAqB,GAAGA,OAAA,CAAO,IAGlC,8BAA8BA,MAAK,IACxC,oBAAC,0BAAwB,GAAGA,OAAA,CAAO,IAElC,oBAAA,qBAAA,EAAqB,GAAGA,OAAO,CAAA;AAEpC;AC3BA,MAAMgF,SAAO,OAAO,IAAI;AAAA;AAAA,GAIlB,mBAAmB,OAAO,GAAG;AAAA;AAAA,GAI7B,oBAAoB,OAAO,GAAG;AAAA;AAAA;AAS7B,SAAS,aAAahF,QAA0B;AAxBvD,MAAAW;AAyBQ,QAAA,EAAC,IAAAnB,KAAI,OAAO,YAAY,UAAU,cAAc,YAAA2F,YAAA,IAAcnF,QAC9D,WAASW,iBAAW,YAAX,OAAA,SAAAA,IAAoB,WAAU,UAEvC,gBAAgB,OAAO,SAAU,WACjC,UAAU,SAAS;AAMzB,SACG,oBAAAqE,QAAA,EAAK,QAAM,IAAC,eAAY,iBAAgB,QAAQ,GAAG,MAHnB,WAAW,gBAAgB,QAI1D,+BAAC,MACC,EAAA,UAAA;AAAA,IAAC,oBAAA,mBAAA,EAAkB,SAAS,GAC1B,UAAA;AAAA,MARoB,WAAW,aAAa+F,aAAWG;AAAAA,MAQtD;AAAA,QACC,OAAO,WAAW;AAAA,QACjB,GAAG;AAAA,QACJ;AAAA,QACA,UAAU;AAAA,QACV;AAAA,QACA,OAAO,EAAC,QAAQ,GAAE;AAAA,MAAA;AAAA,IAAA,GAEtB;AAAA,IACC,oBAAA,KAAA,EAAI,MAAM,GAAG,UAAU,GACtB,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,YAAY,WAAW;AAAA,QACvB,aAAa,WAAW;AAAA,QACxB,SAAS1L;AAAA,QACT,YAAA2F;AAAA,QACA,OAAO,WAAW;AAAA,MAAA;AAAA,IAAA,GAEtB;AAAA,IACC,oBAAA,kBAAA,EAAiB,UAAU,GAAG,UAAU,GACvC,UAAC,oBAAA,iBAAA,EAAgB,YAAY,GAAG,UAAS,MAEzC,CAAA,GACF;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACjCO,MAAMgG,kBAAgB,WAAW,SACtCnL,QACA,KACA;AACM,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EAAA,IACDA,QACE,CAAC,YAAY,aAAa,IAAI,SAA6B,IAAI,GAC/D,eAAe,gBAAgB,GAAG,GAClC,YAAY,OAAO,IAAI,GAEvB,CAAC,cAAc,aAAa,IAAI,SAAS,EAAK;AAEpD,kBAAgB,MAAM,cAAc,EAAK,GAAG,CAAC,UAAU,CAAC;AAElD,QAAA,qBAAqB,YAAY,MAAM;AAtD/C,QAAAW,KAAA;AAuDI,KAAAA,MAAA,aAAa,YAAb,QAAAA,IAAsB,MACtB,IAAA,KAAA,aAAa,YAAb,QAAsB,GAAA,OAAA;AAAA,EAAA,GACrB,CAAC,YAAY,CAAC,GAEX,cAAc,YAAY,CAAC,MAAqC;AAChE,MAAE,QAAQ,YACZ,cAAc,EAAK;AAAA,EAAA,GAEpB,CAAA,CAAE,GAEC,cAAc,YAAY,MAAM,cAAc,EAAI,GAAG,CAAE,CAAA,GAEvD,SACH,oBAAA,MAAA,EAAK,OAAO,EAAC,SAAS,SACrB,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,KAAK;AAAA,MACL,MAAM;AAAA,MACN,MAAK;AAAA,MACL,SAAS;AAAA,MACT,OAAO,EAAC,SAAS,QAAO;AAAA,MACxB,eAAY;AAAA,MACZ,cAAc,EAAC,SAAS,cAAa;AAAA,IAAA;AAAA,EAEzC,EAAA,CAAA;AAIA,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,KAAK;AAAA,MACJ,GAAG;AAAA,MACJ,OAAO;AAAA,MACP,UAAU;AAAA,MACV,QACE;AAAA;AAAA;AAAA;AAAA,QAIE,oBAAC,eAAc,EAAA,SAAS,KACtB,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,eAAa;AAAA,YACb,eAAY;AAAA,YACZ,QAAM;AAAA,YACN,6BACG,KAAI,EAAA,UAAS,QACZ,UAAC,oBAAA,WAAA,EAAU,gBAAgB,oBACzB,UAAA;AAAA,cAACyK;AAAAA,cAAA;AAAA,gBACC;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA,SAAS;AAAA,gBACT;AAAA,gBACA;AAAA,cAAA;AAAA,eAEJ,EACF,CAAA;AAAA,YAEF,MAAI;AAAA,YACJ,WAAU;AAAA,YACV,KAAK;AAAA,YAEJ,UAAA;AAAA,UAAA;AAAA,QAAA,GAEL;AAAA,UAEA;AAAA,IAAA;AAAA,EAAA;AAKV,CAAC,GC5FK,+CAA+B,QAExB,sBAAsB,WAAW,SAC5CpL,QACA,KACA;AACM,QAAA;AAAA,IACJ,IAAAR;AAAA,IACA,aAAA6L;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,WAAAC;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EACD,IAAAtL,QAEE,CAAC,YAAY,aAAa,IAAI,SAAwB,IAAI,GAE1D,EAAC,GAAAa,OAAK;AAEZ,YAAU,MAAM;AACd,kBAAc,IAAI;AAAA,EAAA,GACjB,CAAC,KAAK,CAAC;AAEV,QAAM,8BAA8B;AAAA,IAClC,CAAC,UAAwC;AACjC,YAAA,iBAAiB,MAAM,cAAc,OACrC,SAAS,mBAAmB,KAAK,OAAO,gBAAgB,cAAc;AAExE,iBAAW,QACb,SAAS,IAAI,GAIT,OAAO,QAAU,OAAe,cAClC,cAAc,IAAI,KAEX,OAAO,UAChB,SAASyK,WAAU,OAAO,IAAI,CAAC,IAE/B,cAAc,cAAc;AAAA,IAEhC;AAAA,IACA,CAAC,iBAAiB,UAAU,OAAO,YAAYA,UAAS;AAAA,KAGpD,yBAAyB;AAAA,IAC7B,CAAC,aAA0B;AACzB,eAAS,WAAWA,WAAU,QAAQ,IAAI,IAAI;AAAA,IAChD;AAAA,IACA,CAACA,YAAW,QAAQ;AAAA,EACtB,GAEM,eAAe,gBAAgB,GAAG,GAElC,cAAc,aAAa,gBAAgB,UAAU,IAAI,QAAQD,aAAY,KAAK,IAAI,MAEtF,aAAa,eAEf,mCAAa,UACX,iBAAiB,YAAY,IAAI,IACjC;AAEN,SAAO,WACJ,oBAAAE,aAAA,EAAU,OAAO,YAAY,UAAQ,GAAC,CAAA,IAEvC;AAAA,IAACJ;AAAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,gBAAgBnL,OAAM;AAAA,MACtB,IAAAR;AAAA,MACA;AAAA,MACA;AAAA,MACA,aACE,eACAqB,GAAE,+BAA+B;AAAA,QAC/B,SAAS,iBAAiB,wBAAwB;AAAA,MAAA,CACnD;AAAA,MAEH,KAAK;AAAA,MACL,OAAO,eAAa,OAAA,SAAA,YAAA;AAAA,MACpB,YAAY,cAAc;AAAA,MAC1B,UAAU,CAAQ,CAAA;AAAA,MAClB,eAAe;AAAA,MACf,UAAU;AAAA,MACV,gBAAgB,eAAa,OAAA,SAAA,YAAA;AAAA,IAAA;AAAA,EAAA;AAGnC,CAAC,GC7GKwK,gBAAc,CAAC,UAAkB,MAAM,OAAO,mBAAmB,GACjEC,cAAY,CAAC,SAAe,OAAO,MAAM,mBAAmB;AAK3D,SAAS,UAAUtL,QAAuB;AArBjD,MAAAW;AAsBE,QAAM,EAAC,UAAU,UAAU,YAAY,cAAc,UAASX,QACxD,eAAaW,iBAAW,YAAX,OAAA,SAAAA,IAAoB,eAAc,qBAC/C,EAAC,GAAAE,GAAK,IAAA,kBAEN,eAAe;AAAA,IACnB,CAAC,aAA4B;AAC3B,eAAS,aAAa,OAAO,MAAU,IAAA,IAAI,QAAQ,CAAC;AAAA,IACtD;AAAA,IACA,CAAC,QAAQ;AAAA,EAGL,GAAA,mBAAmB,YAAY,CAAC,SAAe,OAAO,MAAM,UAAU,GAAG,CAAC,UAAU,CAAC,GAErF,kBAAkB;AAAA,IACtB,CAAC,eAAuB,MAAM,YAAY,UAAU;AAAA,IACpD,CAAC,UAAU;AAAA,EAAA,GAGP,iBAAiC,QAAQ,MAAM,kBAAkBA,EAAC,GAAG,CAACA,EAAC,CAAC;AAE5E,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MAAA,aACJwK;AAAAA,MACA;AAAA,MACA,UAAU;AAAA,MACV;AAAA,MACA,aAAa,WAAW;AAAA,MACxB;AAAA,MACA;AAAA,MACA,YAAY;AAAA,MAAA,WACZC;AAAAA,MACA;AAAA,IAAA;AAAA,EAAA;AAGN;ACtBA,SAAS,aAAa,UAAyB,IAAmB;AACzD,SAAA;AAAA,IACL,YAAY,QAAQ,cAAc;AAAA,IAClC,YAAY,QAAQ,cAAc;AAAA,IAClC,UAAW,cAAc,WAAW,OAAO,QAAQ,QAAQ,KAAM;AAAA,EAAA;AAErE;AAEA,SAASA,YAAU,MAAY;AAC7B,SAAO,KAAK;AACd;AACA,SAAS,YAAY,WAAgC;AAC7C,QAAA,eAAe,IAAI,KAAK,SAAS;AACvC,SAAIE,cAAY,YAAY,IACnB,EAAC,SAAS,IAAM,MAAM,aAAY,IAEpC,EAAC,SAAS,IAAO,OAAO,wBAAwB,SAAS;AAClE;AAIA,SAAS,gBAAgB,YAAoB,UAAkB;AACzD,MAAA,CAAC,YAAY,aAAa;AACrB,WAAA;AAGH,QAAA,OAAO,SAAS,UAAU,GAC1B,UAAU,WAAW,IAAI,GACzB,WAAW,UAAU;AAElB,SAAAF,YADL,aAAa,IACE,WAAW,MAAM,UAAU,QAAQ,IAGrC,IAHsC;AAIzD;AAKO,SAAS,cAActL,QAA2B;AACjD,QAAA,EAAC,UAAU,YAAY,OAAO,iBAAgBA,QAE9C,EAAC,YAAY,YAAY,aAAY,aAAa,WAAW,OAAO,GACpE,EAAC,GAAAa,OAAK,kBAEN,eAAe;AAAA,IACnB,CAAC,aAA4B;AAC3B,UAAI,OAAO;AACP,eAAS,QAAQ,WAAW,MAC9B,OAAO,gBAAgB,MAAM,QAAQ,IAGvC,SAAS,SAAS,OAAO,MAAU,IAAA,IAAI,IAAI,CAAC;AAAA,IAC9C;AAAA,IACA,CAAC,UAAU,QAAQ;AAAA,KAGf,mBAAmB;AAAA,IACvB,CAAC,SAAe,OAAO,MAAM,GAAG,UAAU,IAAI,UAAU,EAAE;AAAA,IAC1D,CAAC,YAAY,UAAU;AAAA,KAGnB,kBAAkB;AAAA,IACtB,CAAC,eAAuB,MAAM,YAAY,GAAG,UAAU,IAAI,UAAU,EAAE;AAAA,IACvE,CAAC,YAAY,UAAU;AAAA,EAAA,GAEnB,iBAAiC,QAAQ,MAAM,kBAAkBA,EAAC,GAAG,CAACA,EAAC,CAAC;AAE5E,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ;AAAA,MACA,UAAU;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA,aAAa,WAAW;AAAA,MACxB,YAAU;AAAA,MAAA,WACVyK;AAAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA;AAGN;ACpGO,SAAS,WAAWtL,QAAwB;AAC3C,QAAA,EAAC,iBAAiB,aAAgB,IAAAA;AAEtC,SAAA,oBAACuL,eAAW,GAAG,cAAc,MAAK,SAAQ,WAAU,SAAQ,gBAAgB,gBAAiB,CAAA;AAEjG;ACnBA,MAAM,iBAAiB,CACrBpG,aACA,SACW;AACX,MAAI,OAAOA,eAAe;AACxB,UAAM,IAAI;AAAA,MACR,iBACE,QAAM,OAAA,SAAA,KAAA,SAAQ,aAChB;AAAA,IAAA;AAGC,SAAAA,cACD,MAAM,QAAQA,WAAU,IAAUA,cAC/B,CAACA,WAAU,IAFM;AAG1B;AAQgB,SAAA,kBACd,MACA,UAC4C;AAC5C,aAAW,QAAQ,eAAe,QAAM,OAAA,SAAA,KAAA,YAAY,IAAI;AACtD,eAAW,YAAY,KAAK;AAC1B,UAAI,SAAS,SAAS;AACb,eAAA;AAKN,SAAA;AACT;AC3BO,SAAS,YAAYnF,QAAyB;AACnD,QAAM,EAAC,YAAY,iBAAiB,iBAAgBA,QAG9C,UAAU,kBAAkB,YAAY,KAAK,GAC7C,cAAc,kBAAkB,YAAY,SAAS,GACrD,gBAAgB,kBAAkB,YAAY,WAAW,GACzD,qBAAqB,QAAO,WAAS,OAAA,SAAA,QAAA,eAAe,aAAY,WAAA,OAAA,SAAA,QAAS,eAAc,GACvF,eAAe,gBAAe,+CAAe,gBAAe;AAMhE,SAAA;AAAA,IAACuL;AAAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,MAAK;AAAA,MACL,MAAK;AAAA,MACL,WAPc,qBAAsB,eAAe,YAAY,YAAa;AAAA,MAQ5E,gBAAgB;AAAA,MAChB,aAAa,WAAW;AAAA,MACxB,SAAS,qBAAqB,SAAS;AAAA,MACvC,KAAK,OAAO;AAAA,MACZ,KAAK,OAAO;AAAA,MACZ,eAAY;AAAA,IAAA;AAAA,EAAA;AAGlB;ACtBO,MAAM,WAAW,WAAW,SACjCvL,QACA,KACA;AAEA,QAAM,EAAC,QAAO,IAAIA,QAGZ,cAAc,YAAY,MAAM;AACpC,eAAA,QAAA,QAAUA,OAAM,IAAA;AAAA,EACf,GAAA,CAACA,OAAM,MAAM,OAAO,CAAC;AAGtB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAa,aAAaA,OAAM,IAAI;AAAA,MACpC,IAAI,GAAGA,OAAM,IAAI;AAAA,MACjB,OAAOA,OAAM;AAAA,MACb;AAAA,MACC,GAAGA;AAAA,MACJ,SAAS;AAAA,IAAA;AAAA,EAAA;AAGf,CAAC,GAEY,cAAc,CAACA,WAAoD;AACxE,QAAA,EAAC,MAAM,OAAO,GAAG,KAAQ,IAAAA,QACzB,EAAC,SAAY,IAAAA;AAGjB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,OAAO;AAAA,MACP,IAAI,GAAG,IAAI;AAAA,MACX,iBAAe,KAAK,eAAe;AAAA,MACnC,eAAa,gBAAgB,IAAI;AAAA,MACjC,iBAAe,WAAW,SAAS;AAAA,MAElC,UAAS,SAAA;AAAA,IAAA;AAAA,EAAA;AAGhB,GCvCMgF,SAAO,OAAO,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAkB1B,YAAY,CAAC;AAAA,EACjB;AAAA,EACA;AAAA,EACA;AAAA,EACA,kBAAkB;AAAA,EAClB;AACF,MACE,oBAAC,WAAQ,OAAO,GAAG,eAAY,oBAC5B,UAAA,OAAO,IAAI,CAACE,WAET;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,iBAAe,GAAG,OAAO;AAAA,IACzB,WAAW,mBAAmBA,OAAM;AAAA,IACpC,UAAU,YAAYA,OAAM;AAAA,IAC5B,MAAMA,UAAO,OAAA,SAAAA,OAAA;AAAA,IAEb,MAAMA,OAAM;AAAA,IACZ;AAAA,IACA,UAAU,EAAQA,OAAM;AAAA,IACxB,OAAOA,OAAM,SAASA,OAAM;AAAA,EAAA;AAAA,EAJvB,GAAG,OAAO,IAAIA,OAAM,IAAI;AAK/B,CAEH,EACH,CAAA,GAII,cAAc,CAAC;AAAA,EACnB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,kBAAkB;AACpB,MAAiF;AAnEjF,MAAAvE;AAoEE,QAAM,eAAe;AAAA,IACnB,CAAC,UAA0C;AAChC,eAAA,MAAM,cAAc,KAAK;AAAA,IACpC;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA,GAGL,EAAC,GAAAE,OAAK;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,cAAYA,GAAE,2CAA2C;AAAA,MACzD,WAAW;AAAA,MACX,eAAY;AAAA,MACZ;AAAA,MACA,UAAU;AAAA,MACV,OAAK;AAAA,MACL,UAAU;AAAA,MACV,QAAOF,aAAO,KAAK,CAAC,MAAM,EAAE,QAAQ,MAA7B,OAAgC,SAAAA,IAAA;AAAA,MAEtC,UAAA,OAAO,IAAI,CAACuE,WAGT;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,iBAAe,GAAG,OAAO;AAAA,UACzB,UAAUA,OAAM;AAAA,UAEhB,MAAMA,OAAM;AAAA,UACZ,UAAU,EAAQA,OAAM;AAAA,UACxB,OAAOA,OAAM,SAASA,OAAM;AAAA,QAAA;AAAA,QAHvB,GAAG,OAAO,IAAIA,OAAM,IAAI;AAAA,MAAA,CAMlC;AAAA,IAAA;AAAA,EAAA;AAGP,GAEa,iBAAiB,KAAK,SAAwB;AAAA,EACzD,WAAW;AAAA,EACX;AAAA,EACA,GAAGlF;AACL,GAAwB;AACtB,QAAM,cAAc;AAAA,IAClB,CAAC,cAAmB;AACR,iBAAA,QAAA,QAAA,SAAA;AAAA,IACZ;AAAA,IACA,CAAC,OAAO;AAAA,EAAA;AAIR,SAAA,qBAACgF,QAAK,EAAA,eAAY,oBAChB,UAAA;AAAA,IAAA,oBAAC,WAAW,EAAA,GAAGhF,QAAO,UAAoB,SAAS,aAAa;AAAA,wBAC/D,aAAa,EAAA,GAAGA,QAAO,UAAoB,UAAU,aAAa;AAAA,EACrE,EAAA,CAAA;AAEJ,CAAC,GCvHY,wBAAwB,OAAO,IAAI;AAAA,mBAC7B,CAAC,EAAC,QAAQ,MAAY,MAAA,WAAW,IAAI,IAAI,MAAM,OAAO,MAAM,CAAC,IAAI,EAAG;AAAA,oBACnE,CAAC,EAAC,QAAQ,YACX,MAAM,OAAO,MAAM,CAAC,CAAyB;AAAA,GAEnD,oBAAoB,OAAO,IAAI;AAAA;AAAA;ACWrC,SAAS,cAAcA,QAAc;AACpC,QAAA,EAAC,YAAY,UAAU,UAAU,MAAA,IAASA,QAC1C,YAAY,WAAW,QAEvB,mBAAmB;AAAA,IACvB,CAAC,cAAmB;AAClB,eAAS,MAAM,CAAC,SAAS,CAAC,CAAC;AAAA,IAC7B;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA,GAGL,EAAC,GAAAa,OAAK;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAO;AAAA,MACP,uCAAU,UAAEA,GAAA,8CAA8C,EAAC,OAAO,UAAU,CAAA,GAAE;AAAA,MAE9E,UAAA;AAAA,QAAA,oBAACc,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAG,oBAAA,UAAA,EAAA,UAAAd,GAAE,oDAAoD,EAAC,OAAO,UAAS,CAAC,EAAE,CAAA,GAC/E;AAAA,QAEA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,WAAW;AAAA,YACX,MAAM;AAAA,YACN,OAAOA,GAAE,oDAAoD;AAAA,YAE7D,UAAA;AAAA,cAAC,oBAAA,KAAA,EAAI,cAAc,GACjB,UAAA,oBAACc,UAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAG,oBAAA,UAAA,EAAA,UAAAd,GAAE,4DAA4D,EAAC,OAAO,WAAU,EAAA,CAAE,GACvF,EACF,CAAA;AAAA,cAEA,oBAAC,SAAM,IAAG,MAAK,OAAO,GACnB,UAAA,WAAW,IAAI,CAAC,cAEb;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBAEC;AAAA,kBACA,cAAc;AAAA,kBACd;AAAA,kBACA,OAAO,SAAQ,OAAA,SAAA,MAAA,SAAA;AAAA,gBAAA;AAAA,gBAJV;AAAA,cAOV,CAAA,GACH;AAAA,YAAA;AAAA,UAAA;AAAA,QACF;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;AAEA,SAAS,aAAa;AAAA,EACpB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAKG;AACK,QAAA,mBAAmB,YAAY,MAAM;AACzC,iBAAa,SAAS;AAAA,EAAA,GACrB,CAAC,WAAW,YAAY,CAAC,GAEtB,EAAC,GAAAA,GAAC,IAAI;AAGV,SAAA,qBAAC,MAAK,EAAA,IAAG,MAAK,UAAS,UAAS,QAAQ,GAAG,QAAQ,GAAG,MAAK,WACzD,UAAA;AAAA,IAAA,oBAAC,MAAK,EAAA,SAAS,GAAG,QAAQ,GAAG,MAAK,WAChC,UAAA,oBAAC,MAAK,EAAA,MAAM,GAAI,UAAA,UAAU,CAAA,GAC5B;AAAA,wBAEC,KAAI,EAAA,UAAS,QAAO,SAAS,GAC5B,8BAAC,MAAK,EAAA,UAAS,QAAO,MAAM,GACzB,UAAK,KAAA,UAAU,OAAO,MAAM,CAAC,EAChC,CAAA,GACF;AAAA,IAEC,YACE,oBAAA,KAAA,EAAI,SAAS,GACZ,UAAA,oBAACc,UAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAC,oBAAA,WAAA,EAAU,GAAAd,IAAM,SAAQ,sDAAqD,GAChF,EACF,CAAA;AAAA,IAGD,CAAC,YACC,oBAAA,MAAA,EAAK,SAAS,GAAG,QAAQ,GAAG,MAAK,WAChC,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAK;AAAA,QACL,MAAK;AAAA,QACL,MAAMA,GAAE,uDAAuD;AAAA,MAAA;AAAA,IAAA,GAEnE;AAAA,EAEJ,EAAA,CAAA;AAEJ;AC9Ga,MAAA,cAAc,KAAK,SAAqBb,QAAyB;AACtE,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,IAAAR;AAAA,IACA;AAAA,EAAA,IACEQ,QAEE,EAAC,YAAW,WAAW,WAAW,CAAC,GAEnC,wBAAwB,QAAQ,MAAM;AAC1C,QAAI,CAAC,WAAW;AACP,aAAA;AAGT,UAAM,kBAAkB,WAAW,OAAO,IAAI,CAAC,UAAU,MAAM,IAAI,GAC7D,gBAAgB,OAAO,KAAK,SAAS,CAAA,CAAE,EAAE;AAAA,MAC7C,CAAC,QAAQ,CAAC,IAAI,WAAW,GAAG,KAAK,CAAC,gBAAgB,SAAS,GAAG;AAAA,IAAA;AAG5D,WAAA,cAAc,WAAW,IACpB,2BAGD,eAAc,EAAA,YAAY,eAAe,OAAc,SAAoB,CAAA;AAAA,EAAA,GAClF,CAAC,UAAU,WAAW,QAAQ,KAAK,CAAC,GAEjC,gBAAgB,QAAQ,MAAM,OAAO,KAAK,CAAC,EAAC,SAAA,MAAc,QAAQ,GAAG,CAAC,MAAM,CAAC,GAE7E,sBAAsB;AAAA,IAC1B,MACE;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAGF,SAAI,QAAQ,WAAW,IACd,OAGN,qBAAA,OAAA,EAAM,OAAO,GACX,UAAA;AAAA,IAAA,OAAO,SAAS,IACf,oBAAC,yBAAsB,QAAQ,OAAO,eAAY,gBAChD,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,SAASR;AAAA,QACT,SAAS;AAAA,QAET,iBAAiB;AAAA,MAAA;AAAA,OAErB,IACE;AAAA,IAEJ;AAAA,MAAC+B;AAAAA,MAAA;AAAA,QAKE,UAAA,UACE,oBAAA,mBAAA,EAAkB,SAAkB,KAAK,GAAG,WAAW,GACrD,UAAA,oBAAA,EACH,CAAA,IAEA,oBAAoB;AAAA,MAAA;AAAA,MAPjB,iBAAe,OAAA,SAAA,cAAA;AAAA,IAStB;AAAA,IAEC;AAAA,EACH,EAAA,CAAA;AAEJ,CAAC,GCnGK,sBAAsB,cAA+C,IAAI;AAOxE,SAAS,qBAAqBvB,QAGlC;AACK,QAAA,WAAW,OAAOA,OAAM,KAAK;AACnC,WAAS,UAAUA,OAAM;AAEnB,QAAAyL,YAAW,YAAY,CAAC,SAAe,eAAe,SAAS,SAAS,IAAI,GAAG,CAAC,QAAQ,CAAC;AAC/F,6BACG,oBAAoB,UAApB,EAA6B,OAAOA,WAAW,iBAAM,SAAS,CAAA;AAEnE;AAwBO,SAAS,kBAAkB;AAC1B,QAAA,MAAM,WAAW,mBAAmB;AAC1C,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,sDAAsD;AAEjE,SAAA;AACT;ACtDA,MAAM,iBAAiB,CAAC,OAAc,SAAiC;AANvE,MAAA9K;AAOQ,QAAA,aAAYA,MAAK,KAAA,YAAL,OAAc,SAAAA,IAAA;AAEhC,SAAO,QAAQ,YAAY,OADP,EAAC,UAAU,OAAO,aAAc,WAAW,YAAY,KAAK,SAAS,GAC5C,CAAA,IAAI;AACnD;AAGsB,eAAA,QACpB,aACA,MACA,SACiB;AAjBnB,MAAAA;AAkBO,SAAA,kBAIaA,WAAK,YAAL,OAAA,SAAAA,IAAc,YAAW,gBAC1B,aAAa,MAAM,OAAO;AAC7C;ACDgB,SAAA,SACd,IACA,cAC0C;AACpC,QAAA,CAAC,OAAO,QAAQ,IAAI,SAA+B,IAAI,GAEvD,SAAS,OAAO,CAAC,GAEjB,kBAAkB;AAAA,IACtB,CAAC,QAAW;AACJ,YAAA,UAAU,EAAE,OAAO;AACzB,eAAS,EAAC,QAAQ,UAAS,CAAC,GAE5B,QAAQ,QAAQ,EACb,KAAK,MAAM,GAAG,GAAG,CAAC,EAClB;AAAA,QACC,CAAC,QAAQ;AACH,sBAAY,OAAO,WACrB,SAAS,EAAC,QAAQ,YAAY,QAAQ,IAAA,CAAI;AAAA,QAE9C;AAAA,QACA,CAAC,QAAQ;AACH,sBAAY,OAAO,WACrB,SAAS,EAAC,QAAQ,SAAS,OAAO,IAAA,CAAI;AAAA,QAE1C;AAAA,MAAA;AAAA,IAEN;AAAA;AAAA,IAEA,CAAC,IAAI,GAAG,YAAY;AAAA,EAAA;AAGf,SAAA,CAAC,OAAO,eAAe;AAChC;AC3CO,SAAS,iBAA8B;AAC5C,QAAM,EAAC,UAAa,IAAA,UAAA,GACd,SAAS,UACT,GAAA,cAAc,kBACd,YAAY,aAAa,GACzB,UAAU,WAAW;AAE3B,SAAO,QAAQ,OACN;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IAED,CAAC,WAAW,QAAQ,aAAa,WAAW,OAAO,CAAC;AACzD;ACAA,SAAS,qBACP,WACAN,WACA,SACmB;AACb,QAAA,aAAa,UAAU,MAAM,GAAG,EAAE,GAClC,SAAS,UAAU,IAAIA,WAAU,UAAU;AACjD,SAAO,EAAC,YAAY,QAAQ,GAAG,QAAO;AACxC;AAGA,eAAe,iBACb,QACAA,WACA,SAC6B;AACtB,SAAA,OAAO,UAAW,aACrB,OAAOA,WAAU,OAAO,IACvB,UAAU,IAAIA,WAAU,MAAM;AACrC;AAOO,SAAS,UAAUL,QAAuB;AAvDjD,MAAAW;AAwDE,QAAM,eAAe,gBAAgB,GAC/B,EAAC,MAAM,OAAO,YAAY,YAAAwE,aAAY,UAAU,UAAU,aAAA,IAAgBnF,QAC1E,eAAcW,iBAAW,YAAX,OAAA,SAAAA,IAAoB,QAClC,SAAS,QAAQ,MAAMwE,YAAW,OAAO,CAAC,SAAS,KAAK,UAAU,OAAO,GAAG,CAACA,WAAU,CAAC,GAExF,cAAc,eAEd,GAAA,EAAC,GAAAtE,OAAK,kBAEN,aAAa;AAAA,IACjB,CAAC,aAAqB;AACpB,UAAI,CAAC,UAAU;AACb,iBAAS,WAAW,KAAK,MAAM,CAAE,CAAA,CAAC,CAAC;AACnC;AAAA,MACF;AAEA;AAAA,QACE,WAAW,KAAK,CAAC,aAAa,EAAC,OAAO,WAAW,KAAK,CAAA,GAAG,IAAI,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC;AAAA,MAAA;AAAA,IAExF;AAAA,IACA,CAAC,UAAU,WAAW,IAAI;AAAA,KAGtB,CAAC,eAAe,kBAAkB,IAAI,SAAS,MAAM;AACzD,QAAI,CAAC;AACH,aAAO,QAAQ;AAAA,QACb,IAAI,MAAMA,GAAE,oCAAoC,EAAC,YAAY,WAAW,KAAI,CAAC,CAAC;AAAA,MAAA;AAIlF,UAAM,MAAO,aAAa,CAAE,CAAA,KAAyB,EAAC,OAAO,WAAW,KAClE,GAAA,gBAAgB,qBAAqB,MAAM,KAAK,WAAW;AAC1D,WAAA,iBAAiB,aAAa,KAAK,aAAa,EACpD,KAAK,CAAC,kBAAkB,QAAQ,iBAAiB,IAAI,YAAY,aAAa,CAAC,EAC/E,KAAK,CAAC,YAAY,WAAW,OAAO,CAAC;AAAA,EAAA,GACvC,CAAC,aAAa,cAAc,YAAY,MAAM,aAAa,YAAYA,EAAC,CAAC,GAEtE,cAAa,iBAAe,OAAA,SAAA,cAAA,YAAW,WAEvC,eAAe;AAAA,IACnB,CAAC,UAAuC,WAAW,MAAM,cAAc,KAAK;AAAA,IAC5E,CAAC,UAAU;AAAA,EAAA;AAGb,6BACG,OAAM,EAAA,OAAO,GACZ,UAAC,qBAAA,MAAA,EAAK,KAAK,GACT,UAAA;AAAA,IAAC,qBAAA,KAAA,EAAI,MAAM,GACT,UAAA;AAAA,MAAA;AAAA,QAAC0K;AAAAA,QAAA;AAAA,UACC,gBAAgB,OAAO,SAAS,IAAI,OAAO,CAAC,EAAE,UAAU;AAAA,UACxD,UAAU;AAAA,UACV,UAAU;AAAA,UACV,QAAO,+BAAO,YAAW;AAAA,UACzB;AAAA,UACC,GAAG;AAAA,QAAA;AAAA,MACN;AAAA,OAEC,iBAAA,OAAA,SAAA,cAAe,YAAW,WACxB,oBAAA,MAAA,EAAK,SAAS,GAAG,MAAK,YACpB,UAAc,cAAA,MAAM,SACvB;AAAA,IAAA,GAEJ;AAAA,IACC,eACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAK;AAAA,QACL,MAAK;AAAA,QACL,UAAU,YAAY;AAAA,QACtB,SAAS;AAAA,QACT,MAAK;AAAA,QACL,OACE,+CAAe,YAAW,YACtB1K,GAAE,+BAA+B,IACjCA,GAAE,6BAA6B;AAAA,MAAA;AAAA,IAEvC;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ;AC/HO,SAAS,YAAYb,QAAyB;AAC7C,QAAA,EAAC,iBAAiB,aAAgB,IAAAA;AACxC,6BAAQuL,aAAW,EAAA,GAAG,cAAc,gBAAgB,iBAAiB,eAAY,eAAe,CAAA;AAClG;ACCA,MAAM,iBAAiB,OAAO,QAAQ;AAAA;AAAA;AAAA;AAAA;AAW/B,SAAS,UAAUvL,QAAuB;AAC/C,QAAM,EAAC,YAAY,iBAAiB,OAAO,iBAAgBA;AAGzD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,gBAAgB;AAAA,MAChB,OAAO,SAAS;AAAA,MAChB,aAAa,WAAW;AAAA,MACxB,MAAM,OAAO,WAAW,QAAS,WAAW,WAAW,OAAO;AAAA,MAC7D,GAAG;AAAA,IAAA;AAAA,EAAA;AAGV;ACnBO,SAAS,SAASA,QAAsB;AAjB/C,MAAAW,KAAA;AAkBE,QAAM,EAAC,YAAY,iBAAiB,aAAgB,IAAAX,QAE9C,UAAU,kBAAkB,YAAY,KAAK,GAC7C,aAAY,MAASW,MAAA,WAAA,OAAA,SAAA,QAAA,eAAT,oBAAqB,YAArB,QAAA,GAA8B,gBAAgB,SAAS;AAEvE,SAAA;AAAA,IAAC4K;AAAAA,IAAA;AAAA,MACC,MAAM;AAAA,MACN,WAAU;AAAA,MACV,gBAAgB;AAAA,MACf,GAAG;AAAA,IAAA;AAAA,EAAA;AAGV;ACjBO,SAAS,uBAAuB,EAAC,OAAO,gBAAsB;AACnE,QAAM,SAAS,QAAQ,MAAM,CAAQ,EAAA,SAAA,QAAA,MAAO,OAAO,CAAC,SAAA,OAAA,SAAA,MAAO,IAAI,CAAC,GAC1D,EAAC,GAAA1K,OAAK,kBAEN,cACJ;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,GAAAA;AAAA,MACA,SAAQ;AAAA,MACR,YAAY;AAAA,QACV,mBAAmB,CAAC,EAAC,SAAA,MACnB;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,QAAO;AAAA,YACP,KAAI;AAAA,YAEH;AAAA,UAAA;AAAA,QACH;AAAA,MAEJ;AAAA,IAAA;AAAA,EAAA;AAKF,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAK;AAAA,MACL,SAAS;AAAA,MACT,QAAM;AAAA,MACN,QAAQ;AAAA,MACR,eAAY;AAAA,MAEZ,UAAA;AAAA,QAAA,qBAAC,QAAK,KAAK,GAAG,cAAc,SAAS,IAAI,QACvC,UAAA;AAAA,UAAC,oBAAA,KAAA,EACC,8BAACc,QAAK,EAAA,MAAM,GACV,UAAC,oBAAA,oBAAA,CAAA,CAAmB,GACtB,EACF,CAAA;AAAA,UACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,YAAC,oBAAAA,QAAA,EAAK,IAAG,MAAK,MAAM,GAAG,QAAO,UAC3B,UAAEd,GAAA,0DAA0D,EAC/D,CAAA;AAAA,YACC,UACC,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,cAAA,oBAACc,QAAK,EAAA,IAAG,KAAI,MAAM,GAChB,UACH,aAAA;AAAA,cACA,oBAACA,UAAK,IAAG,KAAI,MAAM,GAChB,UAAAd,GAAE,yDAAyD,GAC9D;AAAA,YAAA,GACF;AAAA,YAED,CAAC,UACC,oBAAAc,QAAA,EAAK,IAAG,KAAI,MAAM,GAChB,UACH,aAAA;AAAA,UAAA,GAEJ;AAAA,QAAA,GACF;AAAA,QACC,gBAAgB,UACf;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAM;AAAA,YACN,MAAK;AAAA,YACL,SAAS;AAAA,YACT,MAAMd,GAAE,+BAA+B;AAAA,YACvC,OAAM;AAAA,UAAA;AAAA,QACR;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAIR;AC9Ea,MAAA,oBAAoB,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;ACiBrC,SAAS,6BAA6Bb,QAU1C;AA9BH,MAAAW,KAAA,IAAA;AA+BQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,IAAAnB;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEQ,QACE,YAAW,gBAAA,OAAA,SAAA,aAAc,YAAW,aACpC,2BAA0B,gBAAc,OAAA,SAAA,aAAA,YAAW,qBAEnD,gBAAeW,cAAQ,cAAR,OAAA,SAAAA,IAAmB,OAClC,EAAC,GAAAE,OAAK,eAAe,GAErB,QAAQ,QAAQ,MAAM;AAC1B,QAAI,cAAc;AACV,YAAA,oBACJ,QAAQ,gBAAA,OAAA,SAAA,aAAwB,SAAU,OAAe,cAAc,YAAY,GAC/E6K,mBAAiBC,eAAoB,YAAY;AAEnD,aAAA,CAAC,qBAAqB,CAACD,mBAClB,OAGF,SAAsB,EAAC,cAAmD;AAC/E,eAAOA,mBACL,eAEA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,KAAK,gBAAgB,EAAC,SAAS,UAAS,CAAC,EACtC,MAAM,YAAqB,EAC3B,YAAY,UAAU,EACtB,IAAI;AAAA,YACP,KAAK7K,GAAE,yCAAyC;AAAA,YAChD,gBAAe;AAAA,UAAA;AAAA,QAAA;AAAA,MACjB;AAAA,IAGN;AACA,WAAO,WAAS,QAAA,QAAA,OAAO,cAAc,QAAQ,IAAI,IAAI;AAAA,EACvD,GAAG,CAAC,cAAc,SAAS,WAAW,WAAS,OAAA,SAAA,QAAA,MAAMA,EAAC,CAAC;AAGrD,SAAA,qBAAC,qBAAkB,OAAM,UAAS,SAAQ,UAAS,MAAM,GAAG,eAAY,WACrE,UAAA;AAAA,IAAA,gBAAA,QAAA,aAAc,YACb,oBAAC,KAAI,EAAA,MAAM,GACT,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAO,KAAQ,QAAA,cAAR,OAAmB,SAAA,GAAA;AAAA,QAC1B,WAAU,KAAQ,QAAA,cAAR,OAAmB,SAAA,GAAA;AAAA,QAC7B,OAAO,SAAS;AAAA,MAAA;AAAA,IAAA,EAEpB,CAAA,IAEA,oBAAC,KAAI,EAAA,MAAM,GACT,UAAC,oBAAA,MAAA,EAAK,OAAM,UACV,UAAC,oBAAA,KAAA,EAAI,MAAM,GAAG,UAAU,GACtB,UAAA,oBAACc,QAAK,EAAA,OAAK,IAAE,UAAAd,GAAE,mDAAmD,EAAE,CAAA,EACtE,CAAA,EACF,CAAA,GACF;AAAA,wBAGD,KAAI,EAAA,aAAa,GAChB,UAAC,qBAAA,QAAA,EAAO,OAAO,GACZ,UAAA;AAAA,MAAW,WAAA,qCACT,OAAM,EAAA,MAAK,WAAW,UAAQ,QAAA,SAAS,QAAQ,KAAK,CAAA;AAAA,OAGrD,2BAA2B,aAC3B,oBAAC,KACC,EAAA,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAM;AAAA,UACN,SAASA;AAAA,YACP,WACI,wDACA;AAAA,YACJ,EAAC,YAAYrB,IAAE;AAAA,UACjB;AAAA,UAEA,UAAA,oBAAC,cAAa,EAAA,MAAK,WAChB,UAAA,8CAA2B,kBAAiB,CAAA,CAAA,IAAM,oBAAA,gBAAA,CAAe,CAAA,GACpE;AAAA,QAAA;AAAA,MAAA,GAEJ;AAAA,MAGD,EAAE,YAAY,4BAA4B,yCACxC,KACC,EAAA,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAM;AAAA,UACN,SAASqB;AAAA,YACP,eACI,+CACA;AAAA,UACN;AAAA,UAEA,UAAA,oBAAC,cAAa,EAAA,MAAM,GAAG,MAAK,WAAU,OAAO,CAAC,cAC5C,UAAC,oBAAA,YAAA,CAAW,CAAA,GACd;AAAA,QAAA;AAAA,MAAA,GAEJ;AAAA,IAAA,EAAA,CAEJ,EACF,CAAA;AAAA,EACF,EAAA,CAAA;AAEJ;ACnIA,MAAM,OAAO,MAAM;AAAC,GAEd+G,0BAA6D;AAAA,EACjE,WAAW;AAAA,EACX,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,OAAO;AACT,GAEM,cAA6B;AAAA,EACjC,WAAW;AAAA,EACX,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,OAAO;AACT;AAYgB,SAAA,iBACd,KACAG,mBACqC;AAC/B,QAAA,CAAC,cAAc,eAAe,IAAI,SAAiB,CAAC,GAEpD,QAAQ,YAAY,MAAM;AACd,oBAAA,CAAC,YAAY,UAAU,CAAC;AAAA,EAAA,GACvC,CAAE,CAAA,GAEC,UAAU,QAAQ,OAAO,EAAC,KAAK,IAAI,KAAK,OAAO,IAAI,UAAS,CAAC,IAAI,KAAK,IAAI,KAAK,CAAC,GAChF,gBAAgB;AAAA,IACpB,MACE,QAAQ,MACJA,kBAAiB,OAAO,EAAE;AAAA,MACxB;AAAA,QACE,CAAC,YACE;AAAA,UACC,WAAW;AAAA,UACX;AAAA,UACA,OAAO;AAAA,UACP;AAAA,UACA;AAAA,QAAA;AAAA,MAEN;AAAA,MACA,UAAUH,uBAAqB;AAAA,MAC/B,WAAW,CAAC,SACV,QAAQ,MAAM,GAAG,GACV,GAAG;AAAA,QACR,WAAW;AAAA,QACX,QAAQ;AAAA,QACR,OAAO;AAAA,QACP;AAAA,QACA;AAAA,MACQ,CAAA,EACX;AAAA,IAAA,IAEH,GAAG,WAAW;AAAA,IACpB,CAAC,SAASG,mBAAkB,OAAO,YAAY;AAAA,IAC/CH;AAAAA,EAAA,GAKI,aAAa,YAAY,IAAI,KAAK,IAAI,GAAG;AAC/C,SAAI,IAAI,OAAO,eAAe,IAAI,MACzBA,0BAEF;AACT;ACjFO,SAASgE,iBAAuB;AAGrC,SAFe,UAAU,6BAA6B,EAExC,OAAA,EAAS;AACzB;ACWO,SAAS,cAAc5L,QAI3B;AAtBH,MAAAW;AAuBQ,QAAA;AAAA,IACJ;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EACE,IAAA,iBAAiBX,OAAM,UAAUA,OAAM,gBAAgB,GACrD,EAAC,GAAAa,GAAC,IAAI,eAAe,GACrB,YAAY+K,eAAa;AAE3B,MAAA;AACF,WACG,qBAAA,OAAA,EAAM,OAAO,GAAG,SAAS,GACxB,UAAA;AAAA,MAAC,oBAAA,cAAA,EAAa,OAAO,EAAC,UAAU,OAAM,QAAQ,GAAG,UAAQ,GAAC,CAAA;AAAA,MACzD,oBAAA,cAAA,EAAa,OAAO,EAAC,UAAU,IAAM,GAAA,QAAQ,GAAG,MAAM,GAAG,UAAQ,GAAC,CAAA;AAAA,IACrE,EAAA,CAAA;AAIA,MAAA;AAEA,WAAA,oBAAC,SAAM,OAAO,GAAG,SAAS,GACxB,UAAA,oBAAC,SAAM,OAAO/K,GAAE,sDAAsD,GACpE,UAAA,oBAACc,UAAK,OAAK,IAAC,MAAM,GACf,UAAA,MAAM,QACT,CAAA,EACF,CAAA,EACF,CAAA;AAIJ,MAAI,CAAC;AACI,WAAA;AAGL,QAAAhB,MAAA,cAAc,iBAAd,OAAA,SAAAA,IAA4B,YAAW;AAEvC,WAAA,oBAAC,SAAM,OAAO,GAAG,SAAS,GACvB,UAAAE,GAAE,6DAA6D,EAClE,CAAA;AAIE,QAAA,UAAUb,OAAM,cAAc,GAAG,KAAK,CAAC,YAAY,QAAQ,SAAS,cAAc,IAAI;AACvF,SAAA,UAUH,iBACA,WACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,IAAI,cAAc;AAAA,MAClB,cAAc,cAAc;AAAA,MAC5B,SAAS,cAAc;AAAA,MACvB;AAAA,MACA,SAASA,OAAM,cAAc;AAAA,MAC7B;AAAA,MACA,eAAeA,OAAM,cAAc,GAAG,SAAS;AAAA,IAAA;AAAA,EAAA,wBAjBhD,OAAM,EAAA,OAAO,GAAG,SAAS,GACvB,aAAE,2DAA2D;AAAA,IAC5D,cAAc,cAAc;AAAA,EAC7B,CAAA,EACH,CAAA;AAiBN;AC/EO,SAAS,sBAAsBA,QAMnC;AAfH,MAAAW,KAAA;AAgBE,QAAM,EAAC,OAAO,MAAM,mBAAmB,cAAc,cAAa,IAAIX,QAChE,EAAC,GAAAa,GAAC,IAAI,eAAe,GACrB,YAAY+K,eAAa;AAE3B,MAAA,cAAc,aAAa,cAAc;AAC3C,WACG,qBAAA,OAAA,EAAM,OAAO,GAAG,SAAS,GACxB,UAAA;AAAA,MAAC,oBAAA,cAAA,EAAa,OAAO,EAAC,UAAU,IAAA,GAAM,QAAQ,GAAG,UAAU,CAAC,cAAc,MAAO,CAAA;AAAA,MAChF,oBAAA,cAAA,EAAa,OAAO,EAAC,UAAU,IAAG,GAAG,QAAQ,GAAG,MAAM,GAAG,UAAU,CAAC,cAAc,MAAO,CAAA;AAAA,IAC5F,EAAA,CAAA;AAGJ,QAAM,gBAAgB,KAAK,GAAG,SAAS,GAEjC,eAAcjL,oBAAc,WAAd,OAAA,SAAAA,IAAsB,MACpC,UAAU,KAAK,GAAG,KAAK,CAAC,WAAW,OAAO,SAAS,WAAW;AAEpE,UAAI,mBAAc,OAAO,iBAArB,QAAmC,GAAA,aAAa,CAAC,UAEjD,oBAAC,OAAM,EAAA,OAAO,GAAG,SAAS,GACxB,UAAC,oBAAAgB,QAAA,EAAK,IAAG,KACP,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,GAAAd;AAAA,MACA,SAAQ;AAAA,MACR,QAAQ,EAAC,UAAU,eAAe,UAAS;AAAA,MAC3C,YAAY,EAAC,WAAW,MAAO,oBAAA,OAAA,EAAK,UAAK,KAAA,UAAU,OAAO,MAAM,CAAC,EAAE,CAAA,EAAM;AAAA,IAAA;AAAA,EAAA,EAE7E,CAAA,EACF,CAAA,IAKF;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,cAAc,cAAc,OAAO;AAAA,MACnC;AAAA,MACA;AAAA,MACA,SAAS,cAAc,OAAO;AAAA,MAC9B;AAAA,MACA;AAAA,MACA,SAAS,KAAK;AAAA,MACd,IAAI,MAAM;AAAA,MACV;AAAA,IAAA;AAAA,EAAA;AAGN;AC9CA,MAAMkI,kBAAgB,OAAO,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,GAO9BrH,eAAa,OAAOC,MAAI;AAAA;AAAA,GAIxBqH,wBAAmC,CAAC,aAAa,cAAc,GAExDC,0BAAwB,WAAW,SAC9CjJ,QAKA,KACA;AACM,QAAA,EAAC,cAAc,SAAS,WAAW,kBAAkB,GAAG,UAAA,IAAaA,QACrE,EAAC,GAAAa,OAAK,kBACN,aAAab,OAAM,WAAWA,OAAM,QAAQ,SAAS,GACrD,gBAAgB;AAAA,IACpB,CACE;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,OAQF,eAEA;AAAA,MAAC+I;AAAAA,MAAA;AAAA,QACC,eAAY;AAAA,QACZ,WAAU;AAAA,QACV,oBAAoBC;AAAAA,QACpB,OAAO;AAAA,QACP,eAAa;AAAA,QACb;AAAA,QACA;AAAA,QACA,SACG,oBAAA,OAAA,EAAI,KAAK,YACP,uBACC,UAEA,oBAAC,KAAI,EAAA,SAAS,GACZ,UAAA,oBAAC,QAAK,OAAM,UAAS,QAAO,QAAO,SAAQ,UACzC,8BAACtH,cAAW,EAAA,OAAM,UAAS,OAAK,IAC9B,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAAb;AAAA,YACA,SAAQ;AAAA,YACR,QAAQ,EAAC,YAAY,gBAAgB,GAAE;AAAA,UAAA;AAAA,QAAA,GAE3C,EACF,CAAA,EACF,CAAA,GAEJ;AAAA,QAEF,MAAM,CAAC,WAAW,CAAC;AAAA,QACnB,KAAK;AAAA,QACL,QAAM;AAAA,QACN,kBAAkB,oBAAoB;AAAA,QACtC,qBAAmB;AAAA,MAAA;AAAA,IACrB;AAAA,IAEF,CAAC,YAAYA,IAAG,cAAc,SAAS,WAAW,gBAAgB;AAAA,EAAA;AAEpE,SAAQ,oBAAA,cAAA,EAAc,GAAG,WAAW,KAAU,cAA8B,CAAA;AAC9E,CAAC,GCrDKqI,yBAAoC;AAAA,EACxC,MAAM,CAAC;AAAA,EACP,WAAW;AACb,GAYMC,cAAY,MAAM,IAElB,WAAW,CAAC,MAAM,GAClB,2BAA2B;AAG1B,SAAS,2BAA2BnJ,QAAwC;AA7DnF,MAAAW,KAAA;AA8DQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,kBAAAoH;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAA5C;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEnF,QAEE,EAAC,GAAAa,GAAC,IAAI,eACN,GAAA,YAAY+K,eAAa,GAEzB,CAAC,aAAa,cAAc,IAAI,SAAsB1C,sBAAoB,GAE1E,eAAe;AAAA,IACnB,CAAC1J,QAAe;AACd,UAAI,CAACA,KAAI;AACP,iBAAS,MAAO,CAAA,GAChB,YAAY,CAAE,CAAA;AACd;AAAA,MACF;AAII,UAAA,CAFQ,YAAY,KAAK,KAAK,CAAC,MAAM,EAAE,OAAOA,GAAE;AAG5C,cAAA,IAAI,MAAM,oDAAoD;AAGtE;AAAA,QACE,IAAI;AAAA,UACF,OAAO,WAAW;AAAA,UAClB,MAAM,eAAeA,GAAE;AAAA,UACvB,YAAY;AAAA,UACZ,UAAU,WAAW;AAAA,UACrB,OAAO,WAAW;AAAA;AAAA,UAElB,MAAM,SAAO,OAAA,SAAA,MAAA;AAAA,QAAA,CACd;AAAA,MAAA,GAGH,YAAY,CAAA,CAAE;AAAA,IAChB;AAAA,IACA;AAAA,MACE,SAAO,OAAA,SAAA,MAAA;AAAA,MACP,YAAY;AAAA,MACZ,WAAW;AAAA,MACX,WAAW;AAAA,MACX,WAAW;AAAA,MACX;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA,GAGI,cAAc,YAAY,MAAM;AACpC,aAAS,OAAO;AAAA,EACf,GAAA,CAAC,QAAQ,CAAC,GAEP,4BAA4B;AAAA,IAChC,CAAC,UAA2C;AACtC,YAAM,QAAQ,aAChB,eAAA,QAAA,YAAc,CAAC,CAAA;AAAA,IAEnB;AAAA,IACA,CAAC,WAAW;AAAA,KAGR,uBAA2C;AAAA,IAC/C,CAAC,QAAQuI,kBAAiB,KAAK,UAAU;AAAA,IACzC,CAACA,mBAAkB,UAAU;AAAA,EAAA,GAGzB,SAAS,QAAQ,OAAO,EAAC,KAAK,SAAO,OAAA,SAAA,MAAA,KAAA,IAAQ,CAAC,+BAAO,IAAI,CAAC,GAE1D,wBAAwB,iBAAiB,QAAiB,oBAAoB,GAC9E,cAAc,kBAAkB,wBAAwB,GAExD,yCAAyC,OAA8B,IAAI,GAE3E,gBAAgB,UAAU,WAAW,KAAK,UAAU,CAAC,MAAM,QAG3D,kBAAkB,aAAa;AACxB,eAAA,EAAC,YAAY,eAAe,KAAK,+BAAO,KAAI,GAAG,CAAC,MAAM,YAAY;AAxJjFpH,QAAAA;AAyJU,UAAA,cAAa,QAAM,OAAA,SAAA,KAAA,SAAQ,QAAQ;AAClB,MAAA,QAAA,OAAA,SAAA,KAAM,gBAAe,QAAQ,cAE7B,eAAe,QAAQ,gBAG5CA,OAAA,gBAAgB,YAAhB,QAAAA,KAAyB,MAAA;AAAA,EAAA,CAE5B;AAED,QAAM,iBAAiB,SAAO,QAAA,MAAA,QAAQ,SAAS,UACzC,eAAe,WAAW,SAAS,KAAO,SAAS,UAEnD,SAAS,CAAA,EAAQ,uBAAO,OAExB,4BAA4B,YAAY,MAAM;AAClD,aAAS,WAAW,SAAS,KAAO,IAAI,IAAM,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC;AAAA,EAAA,GAC1E,CAAC,UAAU,UAAU,CAAC,GAEnB,EAAC,KAAI,IAAI,SAAS,GAElB,SAAS,QAAQ,MAAMwE,YAAW,OAAO,CAAC,SAAS,KAAK,UAAU,OAAO,GAAG,CAACA,WAAU,CAAC,GAExF,cAAc;AAAA,IAClB,CAAC,UAAsC;AACjC,YAAM,kBAAkB,aAAa,IAAI,YAC3C,eAAA,QAAA,YAAc,CAAC,gBAAgB,CAAA;AAAA,IAEnC;AAAA,IACA,CAAC,aAAa,KAAK,WAAW;AAAA,KAG1B,0BAA0B;AAAA,IAC9B,CAAC,UAAwC;AACnC,YAAM,kBAAkB,aAAa,IAAI,YAC3C,eAAc,QAAA,YAAA,QAAA;AAAA,IAElB;AAAA,IACA,CAAC,aAAa,KAAK,WAAW;AAAA,EAAA,GAE1B,gBAAgB,YAAY,MAAM;AACxB,mBAAA,QAAA,YAAA,QAAA;AAAA,EAAA,GACb,CAAC,WAAW,CAAC,GAEV,UAAU,MAAA,GAEV,oBAAoB;AAAA,IACxB,CAAC,gBACQ,YAAY;AAAA,MACjB,OAAO/E,eAAa;AAAA,MACpB,qBAAqB;AAAA,MACrB;AAAA,QAAU,CAAC,iBACT;AAAA,UACE,GAAG,EAAC,WAAW,IAAK;AAAA,UACpB,SAAS,YAAY,EAAE;AAAA,YACrB,IAAI,CAAC,UAAU,EAAC,MAAM,cAAc,WAAW,KAAO;AAAA,YACtD,WAAW,CAAC,WACV,KAAK;AAAA,cACH,OAAO;AAAA,cACP,aAAa,MAAM;AAAA,cACnB,QAAQ;AAAA,cACR,IAAI,yBAAyB,OAAO;AAAA,YAAA,CACrC,GAED,QAAQ,MAAM,KAAK,GACZ,GAAG,EAAC,MAAM,GAAG,CAAA,EACrB;AAAA,UACH;AAAA,QACF;AAAA,MACF;AAAA,MAEA;AAAA,QACE,CAAC,WAAW,eAA4B,EAAC,GAAG,WAAW,GAAG,UAAS;AAAA,QACnE8I;AAAAA,MACF;AAAA,MAEA,IAAI,cAAc;AAAA,IACpB;AAAA,IAEF,CAAC,SAAS,UAAU,IAAI;AAAA,EAAA,GAGpB,oCAAoC,YAAY,MAAM;AAC1D,sBAAkB,EAAE;AAAA,KACnB,CAAC,iBAAiB,CAAC,GAEhB,sBACJ,CAAC,sBAAsB,aAAa,UAAU,mBAAmB,cAE7D,aACH,+BAAO,WACN,KAAA,WAAW,cAAX,OAAuB,SAAA,GAAA,KAAA,YAAA;AAAA,IACrB,IAAI,SAAO,OAAA,SAAA,MAAA;AAAA,IACX,OAAMvI,MAAuB,yBAAA,OAAA,SAAA,sBAAA,WAAvB,OAA+B,SAAAA,IAAA;AAAA,EAAA,CACvC,MACF,MAEI,eAAe;AAAA,IACnB,CAAC,WAEI,oBAAA,aAAA,EAAY,IAAG,UAAS,MAAK,UAAS,QAAQ,GAC7C,UAAC,oBAAA,KAAA,EAAI,UAAU,GAAG,UAAU,GAC1B,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,eAAe;AAAA,QACf,UAAU,OAAO,IAAI;AAAA,QACrB,kBAAkB;AAAA,MAAA;AAAA,OAEtB,EACF,CAAA;AAAA,IAGJ,CAAC,YAAY,oBAAoB;AAAA,EAAA,GAG7B,YAAY,iBAAiB,EAAC,SAAA,QAAA,MAAO,OAGrC,0BAA0B,OAA8B,IAAI,GAC5D,wBAAwB,OAA8B,IAAI,GAC1D,4BAA4B,OAA8B,IAAI;AACpE,SAAA;AAAA,IACE,CAAC,yBAAyB,uBAAuB,yBAAyB;AAAA,IAC1E,MAAM;AACA,uBACF,YAAY,CAAA,CAAE;AAAA,IAElB;AAAA,EAAA,GAKG,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAC,CAAA,YAAY,aAAa,CAAC,YAAY,WACrC,oBAAA,wBAAA,EAAuB,OAAc,cAAc,YAAa,CAAA;AAAA,KAEjE,YAAY,aAAa,YAAY,YACrC,oBAAC,OAAM,EAAA,OAAO,GACX,UAAA,YACE,oBAAA,OAAA,EAAM,OAAO,GAAG,KAAK,yBACpB,UAAC,oBAAA,iBAAA,EAAgB,MAAY,WAAW,SAAS,UAAU,CAAC,CAAC,SAC3D,UAAA,oBAAC,OAAI,EAAA,KAAK,wCACR,UAAA;AAAA,MAACsI;AAAAA,MAAA;AAAA,QACE,GAAG;AAAA,QACJ,eAAY;AAAA,QACZ,SAAS,YAAY;AAAA,QACrB,kBAAkB,uCAAuC;AAAA,QACzD,WAAW;AAAA,QACX,IAAI,WAAW;AAAA,QACf,SAAS,YAAY,KAAK,IAAI,CAAC,SAAS;AAAA,UACtC,OAAO,IAAI;AAAA,UACX;AAAA,QAAA,EACA;AAAA,QACF,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,aAAapI,GAAE,qCAAqC;AAAA,QACpD,WAAW;AAAA,QACX;AAAA,QACA,UAAU,sBAAsB;AAAA,QAChC,eAAe;AAAA,QACf,cAAc,YAAY;AAAA,QAC1B,UAAU;AAAA,QACV,cAAcsI;AAAAA,QACd;AAAA,QACA,YAAY,EAAC,SAAS,kCAAiC;AAAA,MAAA;AAAA,IAE3D,EAAA,CAAA,EAAA,CACF,EACF,CAAA,IAEC,oBAAA,iBAAA,EAAgB,MAAY,WAAW,SAAS,UAAU,CAAC,CAAC,SAC3D,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,QAAM;AAAA,QACN,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,MACE,WACI,gBACA,sBAAsB,SAAS,OAAO,SAAS,IAC7C,aACA;AAAA,QAGR,UAAA;AAAA,UAAA,qBAAC,MAAK,EAAA,OAAM,UAAS,SAAS,GAC3B,UAAA;AAAA,YACC,YAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,IAAG;AAAA,gBACH,QAAO;AAAA,gBACP,KAAI;AAAA,gBACJ,MAAM;AAAA,gBACN,WAAQ;AAAA,gBACR,MAAM;AAAA,gBACN,SAAS;AAAA,gBACT,cAAc;AAAA,gBACd,QAAQ;AAAA,gBACR,MAAK;AAAA,gBACL,sBAAoB;AAAA,gBACpB,UAAU;AAAA,gBACV,SAAS;AAAA,gBACT,KAAK,aAAa;AAAA,gBAElB,UAAA;AAAA,kBAAC;AAAA,kBAAA;AAAA,oBACC;AAAA,oBACA,eAAe;AAAA,oBACf,mBAAiB;AAAA,oBACjB,cAAc,CAAC,CAAC;AAAA,oBAChB,MAAM;AAAA,kBAAA;AAAA,gBACR;AAAA,cAAA;AAAA,YAAA,IAGF;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAM;AAAA,gBACN,SAAS;AAAA,gBACT,cAAc;AAAA,gBACd,QAAQ;AAAA,gBACR,MAAK;AAAA,gBACL,sBAAoB;AAAA,gBACpB,UAAU;AAAA,gBACV,SAAS;AAAA,gBACT,KAAK,aAAa;AAAA,gBAElB,UAAA;AAAA,kBAAC;AAAA,kBAAA;AAAA,oBACC;AAAA,oBACA,eAAe;AAAA,oBACf,mBAAiB;AAAA,oBACjB,MAAM;AAAA,kBAAA;AAAA,gBACR;AAAA,cAAA;AAAA,YACF;AAAA,YAGF,oBAAC,QAAO,EAAA,UAAU,GAChB,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,QAAQ,oBAAC,mBAAkB,EAAA,eAAY,cAAc,CAAA;AAAA,gBACrD,IAAI,GAAG,OAAO;AAAA,gBACd,MACE,oBAAC,MACE,EAAA,UAAA,CAAC,YAEE,qBAAA,UAAA,EAAA,UAAA;AAAA,kBAAA;AAAA,oBAAC;AAAA,oBAAA;AAAA,sBACC,MAAMtI,GAAE,+BAA+B;AAAA,sBACvC,MAAK;AAAA,sBACL,MAAMgL;AAAAA,sBACN,eAAY;AAAA,sBACZ,SAAS;AAAA,oBAAA;AAAA,kBACX;AAAA,kBAEA;AAAA,oBAAC;AAAA,oBAAA;AAAA,sBACC,MAAMhL,GAAE,iCAAiC;AAAA,sBACzC,MAAM8H;AAAAA,sBACN,eAAY;AAAA,sBACZ,SAAS;AAAA,oBAAA;AAAA,kBACX;AAAA,gBAAA,EAAA,CACF,EAEJ,CAAA;AAAA,gBAEF,WAAU;AAAA,gBACV,SAAS,EAAC,QAAQ,IAAM,MAAM,UAAS;AAAA,cAAA;AAAA,YAAA,GAE3C;AAAA,UAAA,GACF;AAAA,UACC,uBACC;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA;AAAA,YAAA;AAAA,UACF;AAAA,UAGD,sBAAsB,SACrB;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,cAAc,sBAAsB,MAAM;AAAA,cAC1C,eAAe,sBAAsB;AAAA,YAAA;AAAA,UACvC;AAAA,QAAA;AAAA,MAAA;AAAA,OAGN,EAEJ,CAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;AChaA,MAAM,mBAAmB,sBAEnBmD,0BAAwB;AAAA,EAC5B,WAAW;AAAA,EACX,QAAQ;AACV,GAEMC,mCAAiC;AAAA,EACrC,WAAW;AAAA,EACX,QAAQ;AACV,GAEMC,2BAAyB;AAAA,EAC7B,WAAW;AAAA,EACX,QAAQ;AACV;AAKO,SAAS,uBAAuB,SAGpC;AACD,QAAM,EAAC,QAAQ,yBAAwB,SACjC,EAAC,SAAS,UAAS,IAAI,OAAO,OAAA,GAC9B,YAAY,WAAW,YAAY,EAAC,SAAS,cAAa;AAMzD,SAAA,SACL,KACA,eACuC;AAErC,YAAA,IAAI,QACA,GAAG,GAAG,IACN,qBACG,0BAA0B,IAAI,KAAK,SAAS,EAC5C,KAAK,IAAI,CAAC,aAA4C,EAAC,KAAK,IAAI,KAAK,OAAO,QAAA,EAAS,CAAC,GAC7F;AAAA,MACA,UAAU,CAAC,gBAAgB;AACzB,YAAI,CAAC,YAAY;AAGf,iBAAO,0BAA0B,QAAQ,IAAI,GAAG,EAAE;AAAA,YAChD,IAAI,CAAC,kBAAkB;AAAA,cACrB,IAAI,IAAI;AAAA,cACR,MAAM;AAAA,cACN;AAAA,cACA,SAAS,EAAC,WAAW,OAAS;AAAA,YAAA,EAC9B;AAAA,UAAA;AAGA,cAAA,gBAAgB,cAAc,GAAG;AAAA,UACrC,CAAC,cAAc,UAAU,SAAS,YAAY;AAAA,QAAA,GAG1C,eAAe,gBAAgB,iBAAA,OAAA,SAAA,cAAe,OAAO,KAAK,CAAA,GAE1D,oBAAoB,qBACvB,aAAa,KAAoB,cAAc,SAAS,EACxD;AAAA,UACC,IAAI,CAAC,WAAY,UAAS,kBAAkB,QAAQ,aAAsB,CAAW;AAAA,QAAA;AAGzF,eAAO,cAAc,CAAC,iBAAiB,CAAC,EAAE;AAAA,UACxC,IAAI,CAAC,CAAC,gBAAgB,OACb;AAAA,YACL,MAAM,YAAY;AAAA,YAClB,IAAI,IAAI;AAAA,YACR,cAAcF;AAAAA,YACd,SAAS;AAAA,cACP,WAAWvL,WAAS,gBAAgB,IAAI,mBAAmB;AAAA,YAC7D;AAAA,UAAA,EAEH;AAAA,QAAA;AAAA,MACH,CACD;AAAA,IAAA;AAAA,EACH;AAEJ;AAEA,SAAS,0BACP,QACAf,KACyC;AACzC,QAAM,iBAAiB;AAAA,IACrB,KAAK,OAAO,WAAW,OAAOA,GAAE;AAAA,IAChC,MAAM;AAAA,IACN,OAAO,EAAC,gBAAgB,OAAM;AAAA,IAC9B,KAAK,GAAG,gBAAgB;AAAA,EAAA;AAG1B,SAAO,OAAO,WAAW,QAAQ,cAAc,EAAE;AAAA,IAC/C,IAAI,CAAC,aAAa;AAEV,YAAA,eADU,MAAM,SAAS,WAAW,CAAA,GAAI,CAAC,UAAU,MAAM,EAAE,EACpCA,GAAE;AAC1B,aAAA,eAKD,aAAa,WAAW,cACnBwM,2BAEL,aAAa,WAAW,eAEnBD,mCAEF,OAVED;AAAAA,IAAA,CAWV;AAAA,EAAA;AAEL;ACnHO,SAAS,OACd,QACA,UACA,MACA,SACyB;AACF,SAAA,aAAa,KAAK,IAAI,QAAQ;AAAA,IACnD,GAAG;AAAA,IACH,UAAU,QAAQ;AAAA,EACnB,CAAA,EAEqB,UAAU;AAAA,IAC9B,eAAe;AAAA,IACf,gBAAgB;AAAA,EACjB,CAAA,EAAE;AAAA,IACD,IAAI,CAAC,EAAC,KAAA,MAAU,KAAK,IAAI,CAAC,EAAC,UAAS,GAAG,CAAC;AAAA,IACxC,IAAI,OAAO;AAAA,IACX;AAAA,MAAI,CAAC,aACH,SAAS,IAAI,CAAC,WAAW;AAAA,QACvB,IAAI,MAAM;AAAA,QACV,MAAM,MAAM;AAAA,QACZ,WAAW,MAAM;AAAA,MAAA,EACjB;AAAA,IACJ;AAAA,EAAA;AAEJ;ACjBA,eAAe,yBACb,SACAzL,WACA,WACA,WACuC;AACvC,MAAI,CAAC;AACH,WAAO;AAGL,MAAA,OAAO,QAAQ,UAAW,YAAY;AAClC,UAAA,aAAa,UAAU,MAAM,GAAG,EAAE,GAClC,SAASuC,MAAIvC,WAAU,UAAU;AAChB,WAAA,MAAM,QAAQ,OAAO,EAAC,UAAAA,WAAU,YAAY,QAAQ,WAAU;AAAA,EAEvF;AAEO,SAAA;AAAA,IACL,QAAQ,QAAQ;AAAA,IAChB,QAAQ,kBAAkB,UAAU,QAAQ,eAAe;AAAA,EAAA;AAE/D;AAYA,SAAS,YAAe,OAAwB;AACxC,QAAA,MAAM,OAAO,KAAK;AACxB,SAAA,IAAI,UAAU,OACP;AACT;AAeO,SAAS,iCAAiCL,QAA8C;AAC7F,QAAM,EAAC,MAAM,eAAcA,QACrB,SAAS,aACT,SAAS,OAAO,UAAU,6BAA6B,GACvD,uBAAuB,2BACvB,YAAY,OAAO,WACnB,EAAC,2BAA2B,GAAA,IAAS,OAAO,QAE5C,qBAAqB,QAAQ,MAE/B,OACG,WAAW;AAAA,IACV,SAAS,WAAW;AAAA,IACpB,YAAY;AAAA,IACZ,2BAA2B;AAAA,EAAA,CAC5B,EAGA,MAAM,GAEV,CAAC,QAAQ,WAAW,OAAO,CAAC,GACzB,gBAAgB,uBAAuB,kBAAkB,GACzD,gBAAgB,aAAa,EAAE,GAC/B,cAAc,YAAY,aAAa,GAEvC,eAAe;AAAA,IACnB,CAAC,iBACC,KAAK,yBAAyB,WAAW,SAAS,YAAY,SAAS,MAAM,SAAS,CAAC,EAAE;AAAA,MACvF;AAAA,QAAS,CAAC,EAAC,QAAAqI,SAAQ,aACjB,OAAO,oBAAoB,cAAc,YAAY;AAAA,UACnD,GAAG,WAAW;AAAA,UACd,QAAAA;AAAA,UACA;AAAA,UACA,KAAK;AAAA,UACL;AAAA,UACA;AAAA,QAAA,CACD;AAAA,MACH;AAAA,MAEA,WAAW,CAAC,QAAqB;AApHzC,YAAA1H;AAqHU,cAAM,eAAe,IAAI,WAAW,IAAI,QAAQ,SAAS;AACrD,gBAAAA,MAAA,WAAW,YAAX,QAAoBA,IAAA,UAAU,iBAChC,IAAI,UAAU,sEAET,WAAW,GAAG;AAAA,MAAA,CACtB;AAAA,IACH;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,KAGIoH,oBAAmB;AAAA,IACvB,MAAM,uBAAuB,EAAC,QAAQ,oBAAoB,sBAAqB;AAAA,IAC/E,CAAC,oBAAoB,oBAAoB;AAAA,EAAA;AAIzC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG/H;AAAA,MACJ,kBAAA+H;AAAA,MACA,UAAU;AAAA,IAAA;AAAA,EAAA;AAGhB;ACxIO,SAAS,oBAA2B/H,QAAqB;AAC9D,QAAM,EAAC,WAAW,UAAU,cAAc,oBAAmBA,QACvD,aAAa,aAAA,OAAA,SAAA,UAAW,MACxB,QAAQ,kBAAkB,MAAM,aAAa,UAAU,GAAG,CAAC,YAAY,YAAY,CAAC;AAC1F,yCAAU,UAAc,cAAA,QAAQ,SAAS,KAAK,IAAI,gBAAgB,CAAA;AACpE;ACba,MAAA,eAAe,OAAO,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GCgB9B,oBAAoB,WAAW,SAC1CA,QAEA,cACA;AACM,QAAA,EAAC,MAAM,IAAI,QAAQ,QAAQ,SAAS,UAAU,UAAU,MAAM,UAAU,GAAG,KAAQ,IAAAA,QACnFR,MAAK,GAAG,UAAU,EAAE,IAAI,MAAO,CAAA,IAE/B,eAAe;AAAA,IACnB,CAAC,UAAyC;AACpC,kBAAY,MAAM,OAAO,SAC3B,SAAS,MAAM,KAAK,MAAM,OAAO,KAAK,CAAC;AAAA,IAE3C;AAAA,IACA,CAAC,QAAQ;AAAA,KAGL,iBAAiB;AAAA,IACrB,CAAC,SACC,qBAAC,OACE,EAAA,UAAA;AAAA,MAAA;AAAA,MAED;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,eAAY;AAAA,UACZ;AAAA,UACA;AAAA,UACA,IAAAA;AAAA,UACA;AAAA,UACA,UAAU;AAAA,UACV,MAAK;AAAA,UACL,OAAM;AAAA,UACN;AAAA,QAAA;AAAA,MACF;AAAA,IAAA,GACF;AAAA,IAEF,CAAC,QAAQ,SAAS,UAAU,cAAcA,KAAI,QAAQ;AAAA,EAAA;AAGtD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,SAASA;AAAA,MACT;AAAA,MACA,KAAK;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA;AAGN,CAAC;ACjDM,SAAS,YAAYQ,QAAc;AAClC,QAAA,EAAC,UAAU,SAAS,UAAU,QAAQ,eAAe,QAAQ,aAAa,YAAWA,QAErF,EAAC,MAAM,cAAa,YACpB,EAAC,GAAAa,OAAK,eAAe,GAErB,gBAAgB,YAAY,MAAM;AACtC,cAAU,UAAU,UAAU,WAAW,EAAE,GAC3C,UAAU;AAAA,MACR,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,OAAOA,GAAE,0DAA0D;AAAA,IAAA,CACpE;AAAA,EACA,GAAA,CAAC,SAAS,WAAWA,EAAC,CAAC;AAE1B,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,UAAU;AAAA,QACV;AAAA,QACA,MAAMA,GAAE,+CAA+C;AAAA,QACvD,eAAY;AAAA,QACZ,UAAU,YAAY,CAAC;AAAA,MAAA;AAAA,IACzB;AAAA,IACC;AAAA,KAEC,eAAe,YAAY,oBAAC,aAAY,CAAA,CAAA;AAAA,IACzC,eACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAG;AAAA,QACH,MAAM;AAAA,QACN,MAAMA,GAAE,iDAAiD;AAAA,QACzD,MAAM;AAAA,MAAA;AAAA,IACR;AAAA,IAED,WACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAMA,GAAE,iDAAiD;AAAA,QACzD,SAAS;AAAA,MAAA;AAAA,IACX;AAAA,wBAGD,aAAY,EAAA;AAAA,IACb;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAK;AAAA,QACL,MAAM;AAAA,QACN,MAAMA,GAAE,oDAAoD;AAAA,QAC5D,SAAS;AAAA,QACT,UAAU;AAAA,QACV,eAAY;AAAA,MAAA;AAAA,IACd;AAAA,EACF,EAAA,CAAA;AAEJ;ACtEgB,SAAA,UAAU,KAAa,UAAkC;AACvE,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAChC,UAAA,MAAM,IAAI;AAChB,QAAI,SAAS,MAAM;AACX,YAAA,SAAS,IAAI;AACnB,aAAO,YAAY,MAAM;AAT/B,YAAAF;AAUc,cAAA,UAASA,MAAO,OAAA,WAAP,OAAe,SAAAA,IAAA,YACxB,MAAM,UAAA,OAAA,SAAA,OAAQ,UAAU,IAAsB,OAAO,QAAQ,SAAS,CAAA;AACxE,YAAA,CAAC,OAAO,CAAC,UAAU;AACd,iBAAA,IAAI,MAAM,oCAAoC,CAAC;AACtD;AAAA,QACF;AACQ,gBAAA,cAAc,OAAO,QAAiB,YAAY,GAAG,MAAM,IAAI,GAAG,EAAE,CAAC;AAAA,MAE/E,GAAA,OAAO,cAAc,IAAI,QAAQ;AAAA,IAAA,GAEnC,IAAI,UAAU,CAAC,UAAU;AACvB,aAAO,KAAK;AAAA,IACd,GACA,IAAI,KAAK,OAAO,GAAG,GACnB,IAAI,eAAe,QACnB,IAAI;EAAK,CACV;AACH;AAEgB,SAAA,aAAa,YAAkC,UAAkC;AAC/F,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAChC,UAAA,SAAS,WAAW,SAAA,GACpB,MAAM,OAAO,UAAU,IAAsB,OAAO,QAAQ,SAAS,CAAC;AACxE,QAAA,CAAC,OAAO,CAAC,UAAU;AACd,aAAA,IAAI,MAAM,oCAAoC,CAAC;AACtD;AAAA,IACF;AACQ,YAAA,cAAc,YAAqB,YAAY,GAAG,KAAM,CAAA,IAAI,GAAG,EAAE,CAAC;AAAA,EAAA,CAC3E;AACH;AAEA,SAAS,cAAc,SAAiB,UAAkB;AAzC1D,MAAAA;AA0CE,QAAM,MAAM,QAAQ,MAAM,GAAG,GACvB,QAAOA,UAAI,CAAC,EAAE,MAAM,SAAS,MAAtB,OAA0B,SAAAA,IAAA,CAAA,GACjC,OAAO,KAAK,IAAI,CAAC,CAAC;AACxB,MAAI,IAAI,KAAK;AACP,QAAA,QAAQ,IAAI,WAAW,CAAC;AACvB,SAAA;AACL,UAAM,CAAC,IAAI,KAAK,WAAW,CAAC;AAEvB,SAAA,IAAI,KAAK,CAAC,KAAK,GAAG,UAAU,EAAC,MAAM,KAAA,CAAK;AACjD;AC5BO,SAAS,4BAA4B;AAAA,EAC1C;AAAA,EACA;AAAA,EACA;AAAA,EACA,iBAAAiG;AAAA,EACA;AAAA,EACA,SAAAqF;AACF,GAAgB;AAEd,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,gBAAgB;AAElC,MAAI,CAAC,MAAM,QAAQ,eAAe,KAAK,gBAAgB,WAAW;AAC1D,UAAA,IAAI,MAAM,gEAAgE;AAElF,QAAM,aAAa,gBAAgB,CAAC,GAC9B,aAAa,WAAW,oBACxB,mBAAmB,cAAY,OAAA,SAAA,WAAA,kBAC/B,QAAQ,cAAY,OAAA,SAAA,WAAA,OACpB,QAAQ,cAAY,OAAA,SAAA,WAAA,OACpB,cAAc,cAAY,OAAA,SAAA,WAAA,aAC1B,aAAa,cAAA,OAAA,SAAA,WAAY,YACzB,SAAS,cAAA,OAAA,SAAA,WAAY,QACrB,eAAeA,WAAU,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAA;AACvE,UAAQ,WAAW,MAAM;AAAA,IACvB,KAAK;AACM,eAAA;AAAA,QACP,aAAa;AAAA,UACX,OAAO,KAAK;AAAA,QAAA,CACb;AAAA,QACD,GAAG;AAAA,QACH;AAAA,UACE;AAAA,YACE,OAAO;AAAA,YACP,MAAM,WAAW;AAAA,UACnB;AAAA,UAEA,CAAC,OAAO;AAAA,QACV;AAAA,MAAA,CACD;AAED;AAAA,IACF,KAAK,QAAQ;AACX,YAAM,WAAWrF,iBAAgB,MAAM,WAAW,KAAc;AAC5D,kBACF,WAAW,UAAU,WAAW,OAAgB;AAAA,QAC9C;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA,CACD;AAEH;AAAA,IACF;AAAA,IACA,KAAK;AACH,mBAAa,WAAW,OAAgB,gBAAgB,EAAE,KAAK,CAAC,SAAS;AACjE,cAAA,WAAWA,iBAAgB,MAAM,IAAI;AACvC,oBACF,WAAW,UAAU,MAAM,EAAC,OAAO,OAAO,aAAa,YAAY,OAAA,CAAO;AAAA,MAAA,CAE7E;AACD;AAAA,IACF,KAAK;AACH,gBAAU,WAAW,OAAgB,gBAAgB,EAAE,KAAK,CAAC,SAAS;AAC9D,cAAA,WAAWA,iBAAgB,MAAM,IAAI;AACvC,oBACF,WAAW,UAAU,MAAM,EAAC,OAAO,OAAO,aAAa,YAAY,OAAA,CAAO;AAAA,MAAA,CAE7E;AACD;AAAA,IACF;AACQ,YAAA,IAAI,MAAM,iDAAiD;AAAA,EAErE;AACF;ACjFA,MAAMsF,aAAW,OAAO,IAAI;AAAA;AAAA;AAIrB,SAAS,gBAAgBlM,QAAc;AACtC,QAAA,EAAC,eAAe,MAAM,UAAU,eAAe,oBAAoB,kBAAiBA,QACpF,aAAa,SAAS,QAEtB,EAAC,GAAAa,OAAK,kBAEN,cAAc,QAAQ,MACtB,WACK,oBAAC,cAAa,CAAA,CAAA,IAGlB,iBAAiB,qBAAqB,KAAM,CAAC,gBACzC,oBAAC,oBAAiB,IAGpB,aAAc,oBAAA,oBAAA,CAAA,CAAmB,IAAK,oBAAC,aAAU,GACvD,CAAC,eAAe,eAAe,YAAY,UAAU,kBAAkB,CAAC,GAErE,cAAc,QAAQ,MAAM;AAChC,QAAI,CAAC;AACH,aAAOA,GAAE,sDAAsD;AAG7D,QAAA;AACF,aAAOA,GAAE,2CAA2C;AAGlD,QAAA,iBAAiB,iBAAiB,CAAC,UAAU;AAC/C,UAAI,cAAc,SAAS;AACzB,eAAOA,GAAE,kDAAkD,EAAC,SAAS,KAAK,CAAA;AAE5E,UAAI,qBAAqB;AACvB,eAAOA,GAAE,4DAA4D;AAAA,UACnE,OAAO;AAAA,QAAA,CACR;AAAA,IAEL;AAEA,WAAOA,GAAE,2DAA2D,EAAC,SAAS,KAAK,CAAA;AAAA,EAAA,GAClF,CAAC,cAAc,QAAQ,eAAe,eAAe,UAAU,oBAAoBA,IAAG,IAAI,CAAC;AAG5F,SAAA,qBAACqL,cAAS,OAAM,UAAS,KAAK,GAAG,SAAQ,UAAS,aAAa,GAC7D,UAAA;AAAA,IAAA,oBAACvK,QAAK,EAAA,OAAK,IAAC,MAAM,GACf,UACH,aAAA;AAAA,wBAECA,QAAK,EAAA,MAAM,GAAG,OAAK,IACjB,UACH,aAAA;AAAA,EACF,EAAA,CAAA;AAEJ;AC/DO,MAAM,aAAa,cAAc,WAAW,IAAI,CAAC,GCJ3C,aAAa,OAAO,MAAM,EAAE,MAAM,EAAC,aAAa,SAAQ;AAAA,EACnE,CAAC,EAAC,MAAA,MAA2B;AACrB,UAAA,EAAC,cAAa,MAAM,QACpB,OAAO,MAAM,OAAO,MAAM;AAGzB,WAAA;AAAA;AAAA;AAAA,wBAGaP,iBAAe,EAAC,MAAM,QAL3B,EAAC,OAAO,GAAG,OAAO,8BAKiB,UAAU,CAAA,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAyB/D;AACF,GCrBa,kBAAkB,WAAW,SACxCpB,QAEA,cACA;AACM,QAAA,EAAC,MAAM,IAAI,QAAQ,QAAQ,SAAS,UAAU,UAAU,MAAM,UAAU,GAAG,KAAQ,IAAAA,QACnFR,MAAK,GAAG,UAAU,EAAE,IAAI,MAAO,CAAA,IAE/B,eAAe;AAAA,IACnB,CAAC,UAAyC;AACpC,kBAAY,MAAM,OAAO,SAC3B,SAAS,MAAM,KAAK,MAAM,OAAO,KAAK,CAAC;AAAA,IAE3C;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA;AAIT,SAAA,oBAAC,cAAY,GAAG,MAAM,MAAY,MAAY,SAASA,KAAI,UAEzD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ;AAAA,MACA;AAAA,MACA,IAAAA;AAAA,MACA;AAAA,MACA,UAAU;AAAA,MACV,KAAK;AAAA,MACL,MAAK;AAAA,MACL,OAAM;AAAA,MACN;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ,CAAC;ACjCD,SAAS,2BAA2BQ,QAA+B;AAC3D,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,IAAIA,QAEE,CAAC,aAAa,cAAc,IAAI,SAAgC,IAAI,GACpE,OAAO,eAAe,WAAW,GAGjC,aAAY,QAAM,OAAA,SAAA,KAAA,WAAU,KAAK,OAAO,QAAQ,KAChD,EAAC,GAAAa,GAAC,IAAI,eAAe;AAGzB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAO,YAAY,SAAY;AAAA,MAC/B,WAAW,YAAY,WAAW;AAAA,MAClC,KAAK;AAAA,MACL,SAAQ;AAAA,MACR,UAAU,YAAY,IAAI;AAAA,MAC1B,KAAK;AAAA,MAEL,UAAA;AAAA,QAAC,oBAAA,MAAA,EAAK,MAAM,GACV,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UAAA;AAAA,QAAA,GAEJ;AAAA,QAEA,qBAAC,QAAK,OAAM,UAAS,KAAK,GAAG,SAAQ,UAAS,MAAK,QACjD,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA,eAAY;AAAA,cACZ,UAAU,YAAY,CAAC;AAAA,cACvB,MAAM;AAAA,cACN,MAAK;AAAA,cACL,UAAU;AAAA,cACV,MAAMA,GAAE,8DAA8D;AAAA,YAAA;AAAA,UACxE;AAAA,UAEC;AAAA,QAAA,GACH;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;AAEa,MAAA,oBAAoB,KAAK,0BAA0B,GCzEnD,kBAAkB,MCFlB,cAAc,OAAO,IAAI;AAAA;AAAA;AAAA,GAKzB,cAAc,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA,GAMzB,cAAc,OAAO,KAAK;AAAA;AAAA;AAAA,GAK1B,cAAc,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GCHhC,YAAY,CAAC,UAAyB,oBAAI,KAAK,GAAE,QAAQ,IAAI,IAAI,KAAK,IAAI,EAAE,QAAQ;AAEnF,SAAS,eAAe,EAAC,aAAa,UAAU,SAAS,UAAgB;AACxE,QAAA,WAAW,YAAY,KAAK;AAElC,YAAU,MAAM;AACV,cAAU,YAAY,SAAS,IAAI,oBACrC,WAAA,QAAA,QAAA;AAAA,EAED,GAAA,CAAC,YAAY,WAAW,OAAO,CAAC;AAE7B,QAAA,EAAC,GAAAA,OAAK;AAEV,SAAA,oBAAC,aAAY,EAAA,MAAK,WAAU,SAAS,GAAG,QAAM,IAAC,OAAO,EAAC,QAAQ,GAAG,MAAM,KACtE,GAAA,UAAA,qBAAC,aAAY,EAAA,OAAM,UAAS,SAAQ,iBAAgB,QAAO,QAAO,WAAU,OAAM,KAAK,GACrF,UAAA;AAAA,IAAA,qBAAC,aACC,EAAA,UAAA;AAAA,MAAC,oBAAA,MAAA,EAAK,SAAQ,UAAS,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,WAAW,CAAC,UAAU,UAAU,KAAK,GAC7E,UAAC,oBAAAc,QAAA,EAAK,MAAM,GACV,UAAA,oBAAC,QAAO,EAAA,OAAO,GACb,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,GAAAd;AAAA,UACA,SAAQ;AAAA,UACR,YAAY;AAAA,YACV,UAAU,MAAM,oBAAC,eAAY,MAAM,GAAI,sBAAsB,UAAI;AAAA,UACnE;AAAA,QAAA;AAAA,MAAA,EAEJ,CAAA,EACF,CAAA,GACF;AAAA,MAEC,oBAAA,MAAA,EAAK,QAAM,IAAC,WAAW,GAAG,QAAQ,GACjC,UAAC,oBAAA,gBAAA,EAAe,OAAO,YAAY,SAAU,CAAA,GAC/C;AAAA,IAAA,GACF;AAAA,IAEC,WACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAMA,GAAE,kCAAkC;AAAA,QAC1C,MAAK;AAAA,MAAA;AAAA,IAAA,IAEL;AAAA,EAAA,EACN,CAAA,EACF,CAAA;AAEJ;ACnDgB,SAAA,cAAc,EAAC,gBAAsB;AAC7C,QAAA,EAAC,GAAAA,OAAK;AAGV,SAAA,qBAAC,QAAK,MAAK,WAAU,SAAS,GAAG,QAAM,IAAC,QAAQ,GAC9C,UAAA;AAAA,IAAA,qBAAC,MAAK,EAAA,KAAK,GAAG,cAAc,GAC1B,UAAA;AAAA,MAAC,oBAAA,KAAA,EACC,8BAACc,QAAK,EAAA,MAAM,GACV,UAAC,oBAAA,oBAAA,CAAA,CAAmB,GACtB,EACF,CAAA;AAAA,MACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,oBAACA,UAAK,MAAM,GAAG,QAAO,UACnB,UAAAd,GAAE,gDAAgD,GACrD;AAAA,QACC,oBAAAc,QAAA,EAAK,MAAM,GACT,aAAE,wDAAwD;AAAA,UACzD,uBAAuB,KAAK,KAAK,kBAAkB,MAAO,EAAE;AAAA,QAC7D,CAAA,GACH;AAAA,MAAA,GACF;AAAA,IAAA,GACF;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAMd,GAAE,gDAAgD;AAAA,QACxD,OAAM;AAAA,MAAA;AAAA,IACR;AAAA,EACF,EAAA,CAAA;AAEJ;ACzCgB,SAAA,YAAY,OAAe,WAAW,GAAG;AACvD,MAAI,UAAU;AAAU,WAAA;AAExB,QAAM,IAAI,MACJ,KAAK,WAAW,IAAI,IAAI,UACxB,QAAQ,CAAC,SAAS,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAAI,GAEhE,IAAI,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,CAAC,CAAC;AAElD,SAAO,GAAG,YAAY,QAAQ,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,EAAE,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC;AACxE;ACUO,SAAS,gBAAgBb,QAAc;AACtC,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QACE,CAAC,aAAa,cAAc,IAAI,SAAgC,IAAI,GACpE,CAAC,eAAe,gBAAgB,IAAI,SAAmC,IAAI,GAE3E,cAAc,YAAY,MAAM,WAAW,EAAI,GAAG,CAAC,UAAU,CAAC;AAEpE;AAAA,IACE;AAAA,MACE,CAAC,UAAU;AACL,uBAAe,MAAM,QAAQ,YAAY,MAAM,QAAQ,WACzD,WAAW,EAAK,GAChB,iBAAe,QAAA,cAAA,MAAA;AAAA,MAEnB;AAAA,MACA,CAAC,YAAY,YAAY,aAAa;AAAA,IACxC;AAAA,EAAA,GAKF;AAAA,IACE;AAAA,MACE,CAAC,UAAU;AACJ,yBAAe,QAAA,cAAA,SAAS,MAAM,MAAA,KACjC,WAAW,EAAK;AAAA,MAEpB;AAAA,MACA,CAAC,eAAe,UAAU;AAAA,IAC5B;AAAA,IACA,CAAC,WAAW;AAAA,EAAA;AAGd,QAAM,sBAAsB;AAAA,IAC1B,CAAC,OAAiC;AAEX,2BAAA,EAAE,GAGvB,iBAAiB,EAAE;AAAA,IACrB;AAAA,IACA,CAAC,oBAAoB;AAAA,EAAA;AAIvB,YAAU,MAAM;AACV,mBACF,eAAa,QAAA,YAAA,MAAA;AAAA,EAAA,GAEd,CAAC,YAAY,WAAW,CAAC;AAEtB,QAAA,EAAC,GAAAa,OAAK;AAEZ,8BACG,MAAK,EAAA,MAAK,UAAS,SAAQ,iBAAgB,OAAM,UAChD,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAI,SAAS,WAAW,SAAY;AAAA,QACpC,QAAQ;AAAA,QACR,SAAS;AAAA,QACT,MAAK;AAAA,QACL;AAAA,QACA,MAAM;AAAA,QAGN,UAAC,qBAAA,MAAA,EAAK,MAAK,UAAS,OAAM,UACxB,UAAA;AAAA,UAAA,oBAAC,MAAK,EAAA,SAAS,GAAG,MAAK,eAAc,QAAQ,GAAG,QAAQ,GACtD,8BAACc,QAAK,EAAA,OACJ,UAAC,oBAAA,oBAAA,CAAA,CAAmB,EACtB,CAAA,GACF;AAAA,+BACC,OAAM,EAAA,MAAM,GAAG,OAAO,GAAG,YAAY,GACpC,UAAA;AAAA,YAAA;AAAA,cAACA;AAAAA,cAAA;AAAA,gBACC,MAAM;AAAA,gBACN,cAAa;AAAA,gBACb;AAAA,gBACA,eAAY;AAAA,gBACZ,QAAO;AAAA,gBAEN,UAAA;AAAA,cAAA;AAAA,YACH;AAAA,YACA,oBAACA,QAAK,EAAA,MAAM,GAAG,OAAK,IAAC,eAAY,aAC9B,UAAY,YAAA,IAAI,EACnB,CAAA;AAAA,UAAA,GACF;AAAA,QAAA,GACF;AAAA,MAAA;AAAA,IACF;AAAA,wBAEC,KAAI,EAAA,SAAS,GACZ,UAAC,oBAAA,MAAA,EAAK,SAAQ,UAGZ,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS,oBAAC,MAAK,EAAA,KAAK,gBAAiB,UAAS;AAAA,QAC9C,IAAG;AAAA,QACH,QAAM;AAAA,QACN,MAAM;AAAA,QACN,eAAa;AAAA,QAEb,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,cAAYd,GAAE,kDAAkD;AAAA,YAChE,eAAY;AAAA,YACZ,SAAS;AAAA,YACT,UAAU;AAAA,YACV,KAAK;AAAA,UAAA;AAAA,QACP;AAAA,MAAA;AAAA,OAEJ,EACF,CAAA;AAAA,EACF,EAAA,CAAA;AAEJ;AC3IO,SAASsL,iBAAe;AAC7B,8BACG,MAAK,EAAA,OAAM,UAAS,SAAQ,cAAa,SAAS,GACjD,UAAA;AAAA,IAAA,oBAAC,YAAS,SAAS,GAAG,QAAQ,GAAG,UAAQ,IAAC;AAAA,yBACzC,OAAM,EAAA,MAAM,GAAG,OAAO,GAAG,YAAY,GACpC,UAAA;AAAA,MAAC,oBAAA,cAAA,EAAa,OAAO,EAAC,OAAO,UAAS,QAAQ,GAAG,UAAQ,GAAC,CAAA;AAAA,MAC1D,oBAAC,cAAa,EAAA,OAAO,EAAC,OAAO,UAAS,QAAQ,GAAG,UAAQ,GAAC,CAAA;AAAA,IAAA,GAC5D;AAAA,EACF,EAAA,CAAA;AAEJ;ACFgB,SAAA,mBAAmB,EAAC,gBAAsB;AAClD,QAAA,EAAC,GAAAtL,OAAK;AAEV,SAAA,qBAAC,QAAK,MAAK,WAAU,SAAS,GAAG,QAAM,IAAC,QAAQ,GAC9C,UAAA;AAAA,IAAA,qBAAC,MAAK,EAAA,KAAK,GAAG,cAAc,GAC1B,UAAA;AAAA,MAAC,oBAAA,KAAA,EACC,8BAACc,QAAK,EAAA,MAAM,GACV,UAAC,oBAAA,oBAAA,CAAA,CAAmB,GACtB,EACF,CAAA;AAAA,MACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,oBAACA,UAAK,MAAM,GAAG,QAAO,UACnB,UAAAd,GAAE,wCAAwC,GAC7C;AAAA,4BACCc,QAAK,EAAA,MAAM,GAAI,UAAAd,GAAE,8CAA8C,GAAE;AAAA,MAAA,GACpE;AAAA,IAAA,GACF;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAMA,GAAE,oDAAoD;AAAA,QAC5D,OAAM;AAAA,MAAA;AAAA,IACR;AAAA,EACF,EAAA,CAAA;AAEJ;ACjCa,MAAA,cAAc,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQzBuL,kBAAgB,OAAO,IAAI;AAAA;AAAA;ACuCxC,SAASC,cAAY,EAAC,YAAyC;AACtD,SAAA;AACT;AAuBA,MAAMC,qBAAmB,CAAC,OAAO;AAG1B,MAAM,sBAAsB,cAAsD;AAAA,EAavF,YAAYtM,QAA2B;AACrC,UAAMA,MAAK,GAZ6B,KAAA,qBAAA,MACM,KAAA,sBAAA,MAEpB,KAAA,QAAA;AAAA,MAC1B,aAAa;AAAA,MACb,qBAAqB;AAAA,MACrB,eAAe,CAAC;AAAA,MAChB,SAAS;AAAA,MACT,YAAY;AAAA,IAAA,GAQwC,KAAA,QAAA,MAEtD,KAAA,0BAA0B,MAAM;AACxB,YAAA,EAAC,MAAM,MAAK,IAAI,KAAK,OAKrB,iBAAiB,OAJG,KAAK,MAAM,EAAE,EAAE,CAAC,KAIU,UAS9C,UAAU,OAAO,KAAK,SAAS,EAAE,GAKjCuM,WAJgB,QAAQ;AAAA,QAC5B,CAAC,QAAQ,CAAC,CAAC,SAAS,QAAQ,WAAW,OAAO,EAAE,SAAS,GAAG;AAAA,MAAA,EAGhC,WAAW,GACnC,aAAa,CAAC,OAAO,EACxB,OAAO,QAAQ,OAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,SAAS,GAAG,CAAC,CAAC,EACzD,IAAI,CAAC,QAAQ,MAAM,CAAC,GAAG,CAAC,CAAC;AAEvB,WAAA,MAAM,SAAS,WAAW,KAAKA,YAAW,CAAC,iBAAiB,UAAU,UAAU,CAAC;AAAA,IAAA,GAiBxF,KAAA,qBAAqB,MAAM;AACzB,WAAK,aAAa;AAAA,IAAA,GAGpB,KAAA,yBAAyB,MAAM;AAC7B,WAAK,SAAS,EAAC,SAAS,IAAM,GAC9B,KAAK;IAAkB,GAGzB,KAAA,oBAAoB,MAAM;AACxB,WAAK,SAAS,EAAC,SAAS,GAAK,CAAA;AAAA,IAAA,GAG/B,KAAA,mBAAmB,MAAM;AACvB,WAAK,MAAM,SAAS,MAAM,CAAC,OAAO,CAAC,CAAC;AAAA,IAAA,GAGtC,KAAA,oBAAoB,CAAC,UAA6B;AAC1C,YAAA,EAAC,eAAe,SAAQ,IAAI,KAAK,OACjC,EAAC,cAAa,IAAI,KAAK;AACzB,uBAAiB,CAAC,WACpB,KAAK,oBAAoB,KAAK,IACrB,cAAc,SAAS,KAChC,KAAK,eAAe;AAAA,IAAA,GAIxB,KAAA,kCAAkC,CAAC,WAAwB;AACzD,WAAK,SAAS,EAAC,qBAAqB,OAAO,CAAA;AAAA,IAAA,GAG7C,KAAA,0BAA0B,MAAM;AA3KlC,UAAA5L;AA4KS,WAAA,SAAS,EAAC,qBAAqB,KAAK,CAAA,IAGzCA,MAAA,KAAK,wBAAL,QAA0BA,IAAA,MAAA;AAAA,IAAA,GAG5B,KAAA,yBAAyB,CAAC,OAAiC;AACzD,WAAK,sBAAsB;AAAA,IAAA,GAiB7B,KAAA,aAAa,CACX,UACA,MACA,qBAAoC,CAAA,MACjC;AACH,YAAM,EAAC,YAAY,UAAU,QAAQ,GAAAE,GAAC,IAAI,KAAK,OACzC,EAAC,WAAU,oBACX,UAAU;AAAA,QACd,UAAU,IAAI,YAAY,kBAAkB;AAAA,QAC5C,uBAAuB,IAAI,YAAY,+BAA+B;AAAA,QACtE;AAAA,MAAA;AAEF,WAAK,aAAa,GAClB,KAAK,SAAS,EAAC,aAAa,GAAK,CAAA,GACjC,SAAS,WAAW,KAAK,CAAC,aAAa,EAAC,OAAO,WAAW,KAAA,CAAK,CAAC,CAAC,CAAC,GAClE,KAAK,qBAAqB,SAAS,OAAO,QAAQ,MAAM,YAAY,OAAO,EAAE,UAAU;AAAA,QACrF,MAAM,CAAC,gBAAgB;AACjB,sBAAY,WACd,SAAS,WAAW,KAAK,YAAY,OAAO,CAAC;AAAA,QAEjD;AAAA,QACA,OAAO,CAAC,QAAQ;AAzNtB,cAAAF;AA2NQ,kBAAQ,MAAM,GAAG,IACjBA,MAAK,KAAA,UAAL,YAAY,KAAK;AAAA,YACf,QAAQ;AAAA,YACR,aAAaE,GAAE,uCAAuC;AAAA,YACtD,OAAOA,GAAE,iCAAiC;AAAA,UAAA,CAC5C,GACA,KAAK;QACP;AAAA,QACA,UAAU,MAAM;AACd,eAAK,SAAS,EAAC,aAAa,GAAM,CAAA;AAAA,QACpC;AAAA,MAAA,CACD;AAAA,IAAA,GA0DH,KAAA,8BAA8B,CAAC,oBAAuC;AACpE,YAAM,EAAC,UAAU,YAAY,iBAAA+F,iBAAA,IAAmB,KAAK;AACzB,kCAAA;AAAA,QAC1B;AAAA,QACA;AAAA,QACA,MAAM;AAAA,QACN,iBAAAA;AAAA,QACA,YAAY,KAAK;AAAA,MAAA,CAClB,GACD,KAAK,SAAS,EAAC,qBAAqB,KAAK,CAAA;AAAA,IAAA,GAG3C,KAAA,wBAAwB,CAAC,UAA4B;AA5SvD,UAAAjG;AAkTM,YAAM,kBAAkB,MAAM,UAC9B,MAAM,oBAAkBA,MAAK,KAAA,MAAM,aAAa,QAAxB,oBAA6B,YAErD,KAAK,MAAM,aAAa,QAAQ,KAAK;AAAA,IAAA,GAIzC,KAAA,kBAAkB,CAAC,aAAyB;AAC1C,WAAK,SAAS;AAAA,QACZ,eAAe;AAAA,MAAA,CAChB;AAAA,IAAA,GAEH,KAAA,iBAAiB,MAAM;AACrB,WAAK,SAAS;AAAA,QACZ,eAAe,CAAC;AAAA,MAAA,CACjB;AAAA,IAAA,GAyQH,KAAA,eAAe,CAAC,EAAC,MAAM,SAAA,MAA2D;AAC3E,WAAA,WAAW,UAAU,IAAI;AAAA,IAAA,GAGhC,KAAA,WAAW,CAAC,UAAiD;AAC3D,WAAK,QAAQ;AAAA,IAAA,GAlfb,KAAK,kBAAkBX,OAAM,KAAK,OAAOsM,kBAAgB;AAAA,EAC3D;AAAA,EAgCA,oBAAoB;AA9HtB,QAAA3L;AAgII,KAAIA,WAAK,MAAM,UAAX,QAAkBA,IAAA,WACpB,KAAK,MAAM,SAAS,WAAW,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;AAAA,EAE7D;AAAA,EAEA,eAAe;AACT,SAAK,uBACP,KAAK,mBAAmB,YAAY,GACpC,KAAK,kBAAkB;AAAA,EAE3B;AAAA,EA4CA,oBAAoB,OAA0B;AACtC,UAAA,EAAC,WAAc,IAAA,KAAK,OAEpB,QAAQ,MACX,IAAI,CAAC,SAAM;AA1LlB,UAAAA,KAAA;AA0LsB,aAAA,EAAC,MAAM,WAAU,MAAAA,MAAA,KAAK,OAAM,oBAAX,OAAA,SAAA,GAAA,KAAAA,KAA6B,YAAY,IAAK;IAAE,CAAA,EAChF,KAAK,CAAC,WAAW,OAAO,QAAQ;AAE/B,aACF,KAAK,WAAW,MAAM,UAAW,MAAM,IAAI,GAG7C,KAAK,SAAS,EAAC,YAAY,GAAM,CAAA;AAAA,EACnC;AAAA,EAuCA,kBAAkB,aAA0B;AACpC,UAAA,EAAC,YAAW,IAAI,KAAK;AAGzB,WAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,UAAU,cAAc,KAAK,qBAAqB;AAAA,QAClD,SAAS,KAAK;AAAA,MAAA;AAAA,IAAA;AAAA,EAGpB;AAAA,EAEA,oBAAoB;AACZ,UAAA,EAAC,oBAAmB,IAAI,KAAK,OAC7B,EAAC,OAAO,YAAY,cAAc,GAAAE,OAAK,KAAK;AAClD,QAAI,CAAC;AACI,aAAA;AAET,UAAM,SAAS,IAAI,YAAY,kBAAkB,EAAE,GAE7CgB,aAAY,oBAAoB;AAClC,WAAA,SAAS,MAAM,QAEf;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,WAAW,MAAM;AAAA,QACjB,qCAAkBsK,gBAAa,EAAA;AAAA,QAE9B,WAACK,eACA;AAAA,UAAC3K;AAAA,UAAA;AAAA,YACC,gBAAgB,CAAC2K,UAAS;AAAA,YAC1B,eAAc;AAAA,YACd,WAAU;AAAA,YACV;AAAA,YACA,mBAAmB3L,GAAE,0BAA0B;AAAA,YAC/C,SAAS,KAAK;AAAA,YACd,UAAU,KAAK;AAAA,UAAA;AAAA,QACjB;AAAA,MAAA;AAAA,IAAA,IAMN;AAAA,MAACgB;AAAA,MAAA;AAAA,QACC,gBAAgB,CAAC;AAAA,QACjB,eAAc;AAAA,QACd,WAAU;AAAA,QACV;AAAA,QACA,mBAAmBhB,GAAE,0BAA0B;AAAA,QAC/C,SAAS,KAAK;AAAA,QACd,UAAU,KAAK;AAAA,MAAA;AAAA,IAAA;AAAA,EAGrB;AAAA,EAsCA,cAAc;AACZ,UAAM,EAAC,OAAO,SAAS,UAAU,aAAY,IAAI,KAAK,OAChD,EAAC,eAAe,YAAW,KAAK,OAChC,mBAAmB,CAAQ,EAAA,SAAA,QAAA,MAAO,WAAW,SAAO,QAAA,MAAA;AAEtD,WAAA,SAAS,OAAO,MAAM,QAAU,OAAe,EAAC,SAAA,QAAA,MAAO,YAAW,CAAC,aAAa,KAAK,IAChF,0BAAO,oBAAmB,EAAA,cAAc,KAAK,kBAAkB,IAKjE,CAAC,eAEH,qBAAA,UAAA,EAAA,UAAA;AAAA,MACC,WAAA,oBAAC,OAAI,cAAc,GACjB,8BAAC,eAAc,EAAA,cAAc,KAAK,uBAAA,CAAwB,EAC5D,CAAA;AAAA,MAEF;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM,KAAK;AAAA,UACX,UAAU,CAAC,CAAC,WAAW;AAAA,UACvB,WAAW;AAAA,UAGV,iCAAO,UACN,KAAK,kBAAkB,MAAM,OAAO,IAEpC;AAAA,YAAC;AAAA,YAAA;AAAA,cACE,GAAG;AAAA,cACJ,SAAS,KAAK;AAAA,cACd,UAAU;AAAA,cACV,UAAU,CAAQ,CAAA;AAAA,cAClB,SAAS,KAAK;AAAA,cACd,aAAa,KAAK;AAAA,cAClB,YAAY,KAAK;AAAA,cACjB,MAAM,KAAK,YAAY;AAAA,cACvB,SAAS,oBAAoB,cAAc,SAAS;AAAA,cACpD,OAAO,EAAC,SAAS,EAAC;AAAA,cAClB,QAAO;AAAA,cACP,QAAQ;AAAA,cAER,+BAAC,OAAI,EAAA,OAAO,EAAC,UAAU,WACpB,GAAA,UAAA;AAAA,gBAAC,EAAA,SAAA,QAAA,MAAO,UAAS,KAAK,wBAAwB;AAAA,gBAC9C,SAAA,QAAA,MAAO,SAAS,cAAc,SAAS,IACpC,KAAK,gBAAgB,KAAK,YAAY,CAAC,IACvC;AAAA,gBACH,EAAC,SAAO,QAAA,MAAA,aAAW,SAAO,OAAA,SAAA,MAAA,UAAS,KAAK,cAAc;AAAA,cAAA,GACzD;AAAA,YAAA;AAAA,UACF;AAAA,QAAA;AAAA,MAEJ;AAAA,IACF,EAAA,CAAA;AAAA,EAEJ;AAAA,EAEA,gBAAgB;AACd,UAAM,EAAC,OAAO,UAAU,cAAc,YAAY,eAAe,cAAc,GAAAA,GAAK,IAAA,KAAK,OACnF,EAAC,eAAc,KAAK,OACpB,QAAQ,SAAO,OAAA,SAAA,MAAA;AACrB,QAAI,CAAC;AACI,aAAA;AAGT,UAAM,SAAS,IAAI,YAAY,kBAAkB,EAAE;AAEnD,QAAI,iBACF,iBAAgB,gBAAc,OAAA,SAAA,aAAA,YAAW,IAAI,OAC3C;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAMA,GAAE,gCAAgC;AAAA,QACxC,SAAS,MAAM;AACR,eAAA,SAAS,EAAC,YAAY,GAAK,CAAC,GACjC,KAAK,gCAAgC,aAAa,CAAC,CAAC;AAAA,QACtD;AAAA,QACA,UAAU;AAAA,QACV,eAAY;AAAA,MAAA;AAAA,IAAA;AAIlB,WAAI,aAAa,SAAS,MACxB,iBAAiB,aAAa,IAAI,CAAC,gBAE/B;AAAA,MAAC;AAAA,MAAA;AAAA,QAEC,OACG,YAAY,UAAUA,GAAE,YAAY,OAAO,IAAI,YAAY,UAC5D,UAAU,YAAY,IAAI;AAAA,QAE5B,SAAS,MAAM;AACR,eAAA,SAAS,EAAC,YAAY,GAAM,CAAA,GACjC,KAAK,gCAAgC,WAAW;AAAA,QAClD;AAAA,QACA,MAAM,YAAY,QAAQ;AAAA,QAC1B,UAAU;AAAA,QACV,eAAa,4BAA4B,YAAY,IAAI;AAAA,MAAA;AAAA,MAXpD,YAAY;AAAA,IActB,CAAA,IAID;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,WAAW;AAAA,QACX;AAAA,QACA,qCAAkBsL,gBAAa,EAAA;AAAA,QAE9B,WAAC,EAAC,kBAAkB,WAAW,KAAK,WAAU;AACvC,gBAAA,WAAW,oBAAoB,YAAY,SAAS;AAC1D,cAAI,SACA;AAEA,iBAAA,aAAa,KAAK,MACpB,cAAc,GAAG,GAAG,OACpB,UAAU,MAIV;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA,kBAAkB;AAAA,cAClB,OAAO,CAAC;AAAA,cACR,YAAY,CAAC,WAAW,KAAK,SAAS,EAAC,YAAY,QAAO;AAAA,cAC1D;AAAA,cACA,sBAAsB,KAAK;AAAA,cAE3B,UAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,UAAU,KAAK;AAAA,kBACf,QAAQ;AAAA,kBACR,SAAS,KAAK;AAAA,kBACd;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA;AAAA,kBACA;AAAA,gBAAA;AAAA,cACF;AAAA,YAAA;AAAA,UAAA;AAAA,QAGN;AAAA,MAAA;AAAA,IAAA;AAAA,EAGN;AAAA,EAEA,gBAAgB,MAAyB;AACjC,UAAA,EAAC,YAAY,UAAU,eAAe,iBAAAvF,qBAAmB,KAAK,OAC9D,EAAC,cAAA,IAAiB,KAAK,OAEvB,gBAAgB,cAAc,OAAO,CAAC,SAASA,oBAAA,OAAA,SAAAA,iBAAkB,YAAY,IAAA,CAAK,GAClF,qBAAqB,cAAc,SAAS,cAAc;AAEhE,WACG,oBAAA,aAAA,EAAY,QAAQ,GAAG,MACtB,UAAC,oBAAAwF,iBAAA,EAAc,OAAM,UAAS,SAAQ,UAAS,KAAK,GAAG,MAAM,GAC3D,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,MAAK;AAAA,MAAA;AAAA,IAAA,EAET,CAAA,EACF,CAAA;AAAA,EAEJ;AAAA,EAEA,gBAAgB;AACd,UAAM,EAAC,cAAc,UAAU,eAAe,IAAA5M,KAAI,GAAAqB,OAAK,KAAK;AAExD,WAAA,aAAa,WAAW,IAAU,OAElC,aAAa,SAAS,KAAK,CAAC,YAAY,gBAExC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAI,GAAGrB,GAAE;AAAA,QACT,KAAK,KAAK;AAAA,QACV,QACE;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,MAAMqB,GAAE,sCAAsC;AAAA,YAC9C,eAAY;AAAA,YACZ,MAAM;AAAA,UAAA;AAAA,QACR;AAAA,QAEF,eAAY;AAAA,QACZ,MACG,oBAAA,MAAA,EACE,UAAa,aAAA,IAAI,CAAC,gBAEf;AAAA,UAAC;AAAA,UAAA;AAAA,YAEC,MAAM,YAAY;AAAA,YAClB,SAAS,MAAM;AACR,mBAAA,SAAS,EAAC,YAAY,GAAM,CAAA,GACjC,KAAK,gCAAgC,WAAW;AAAA,YAClD;AAAA,YACA,MAAM,YAAY,QAAQ;AAAA,YAC1B,UAAU;AAAA,YACV,eAAa,4BAA4B,YAAY,IAAI;AAAA,UAAA;AAAA,UARpD,YAAY;AAAA,QAWtB,CAAA,GACH;AAAA,MAAA;AAAA,IAAA,IAON;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAMA,GAAE,gCAAgC;AAAA,QACxC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS,MAAM;AACR,eAAA,SAAS,EAAC,YAAY,GAAK,CAAC,GACjC,KAAK,gCAAgC,aAAa,CAAC,CAAC;AAAA,QACtD;AAAA,QACA,eAAY;AAAA,QACZ,UAAU;AAAA,QACV,KAAK,KAAK;AAAA,MAAA;AAAA,IAAA;AAAA,EAGhB;AAAA,EAEA,0BAA0B;AACxB,UAAM,EAAC,UAAU,YAAY,eAAe,iBAAA+F,iBAAe,IAAI,KAAK,OAC9D,EAAC,cAAiB,IAAA,KAAK,OAEvB,gBAAgB,cAAc,OAAO,CAAC,SAASA,oBAAA,OAAA,SAAAA,iBAAkB,YAAY,IAAA,CAAK,GAClF,qBAAqB,cAAc,SAAS,cAAc,QAE1D,SAAS,IAAI,YAAY,kBAAkB,EAAE;AAEnD,WAEI,oBAAA,UAAA,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM,WAAW,gBAAgB;AAAA,QACjC,QAAM;AAAA,QACN,UAAU;AAAA,QACV,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,OACE,cAAc,WAAW,IACrB,EAAC,aAAa,SAAQ,IACtB,EAAC,aAAa,UAAU,aAAa,cAAa;AAAA,QAGxD,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,QAAQ,KAAK,cAAc;AAAA,YAC3B,UAAU,KAAK;AAAA,YACf;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA,MAAK;AAAA,YACL;AAAA,YACA;AAAA,UAAA;AAAA,QACF;AAAA,MAAA;AAAA,IAEJ,EAAA,CAAA;AAAA,EAEJ;AAAA,EASA,cAAc;AACN,UAAA,EAAC,eAAe,YAAY,OAAO,UAAU,iBAAAA,iBAAe,IAAI,KAAK,OACrE,EAAC,cAAiB,IAAA,KAAK,OAEvB,gBAAgB,cAAc,OAAO,CAAC,SAASA,oBAAA,OAAA,SAAAA,iBAAkB,YAAY,IAAA,CAAK,GAClF,qBAAqB,cAAc,SAAS,cAAc;AAE5D,WAAA,cAAc,SAAS,MACrB,qBAAqB,KAAK,CAAC,iBACtB,aAIP,EAAC,SAAO,QAAA,MAAA,YAAW,CAAC,YAAY,cAAc,SAAS,IAClD,YAEF,uBAAO,WAAW,SAAA,QAAA,MAAO,SAAS,WAAW,gBAAgB;AAAA,EACtE;AAAA,EAEA,SAAS;AACD,UAAA;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,GAAA/F;AAAA,IAAA,IACE,KAAK,OACH,EAAC,oBAAA,IAAuB,KAAK;AAEnC,WAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAC,oBAAA,iBAAA,EAAgB,KAAK,KAAK,SAAU,CAAA;AAAA,MAEpC,QAAQ,IAAI,CAAC,WACR,OAAO,SAAS,YAAY,OAAO,SAAS,UAAU,OAAO,SAAS,aAEjE,OAGL,OAAO,SAAS,UAEhB;AAAA,QAAC;AAAA,QAAA;AAAA,UAEC;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,aAAa,OAAO,SAAS,UAAU,KAAK,gBAAgB;AAAA,UAC5D,aAAa,OAAO,SAAS,UAAUwL,gBAAc;AAAA,UACrD;AAAA,UACA;AAAA,QAAA;AAAA,QARK,OAAO;AAAA,MAAA,IAYd,OAAO,SAAS,aAEhB;AAAA,QAAC;AAAA,QAAA;AAAA,UAEC;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QAAA;AAAA,QARK,OAAO;AAAA,MAAA,IAYd,OAAO,SAAS,UACV,oBAAA,kBAAA,EAAkC,UAAZ,OAAO,GAAqB,IAGlD,oBAAA,UAAA,EAAA,UAAAxL,GAAE,yCAAyC,EAAC,MAAM,OAAO,MAAK,GAAE,CAC3E;AAAA,MACA,uBAAuB,KAAK,kBAAkB;AAAA,IACjD,EAAA,CAAA;AAAA,EAEJ;AACF;AC5oBO,SAAS,gBAAgBb,QAAuB;AAxBvD,MAAAW;AAyBQ,QAAA,qBAAoBA,MAAMX,OAAA,WAAW,YAAjB,OAAA,SAAAW,IAA0B,SAC9C,uBAAuB,wBACvB,GAAA,EAAC,MAAM,WAAA,IAAc,iBAAiB,YACtC,SAAS,UAAU,6BAA6B,GAChD,EAAC,GAAAE,GAAC,IAAI,eAAe,GAErB+F,oBAAkB;AAAA,IACtB,CAAC,MAAkB,SACZ,WAAW,gBAGTC,gBAAuB,MAAM,IAAI,IAF/B;AAAA,IAIX,CAAC,WAAW,aAAa;AAAA,KAIrB,eAAe;AAAA,IACnB,MAAM,qBAAqB,WAAW;AAAA,IACtC,CAAC,YAAY,iBAAiB;AAAA,KAG1B,eAAe;AAAA,IACnB,CAACrH,QAAe,iBAAiB,sBAAsBA,GAAE;AAAA,IACzD,CAAC,oBAAoB;AAAA,EAAA;AAIrB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAGQ;AAAA,MACJ,GAAAa;AAAA,MACA;AAAA,MACA;AAAA,MACA,eAAe,WAAW;AAAA,MAC1B;AAAA,MAAA,iBACA+F;AAAAA,IAAA;AAAA,EAAA;AAGN;AC5Da,MAAA6F,aAAW,OAAO,GAAG;AAAA;AAAA,yBAET,CAAC,EAAC,QAAQ,IAAI,EAAC,MAAM,IAAI,KAAK;AAAA;AAAA;AAAA;AAAA,WAI5C,CAAC,EAAC,UAAU,EAAA,MAAO,OAAO;AAAA,YACzB,CAAC,EAAC,UAAU,EAAA,MAAO,OAAO;AAAA,aACzB,CAAC,EAAC,UAAU,EAAA,MAAO,OAAO;AAAA,cACzB,CAAC,EAAC,UAAU,EAAA,MAAO,OAAO;AAAA;AAAA,GCV3B,kBAA2B;AAAA,EACtC,GAAG;AAAA,EACH,GAAG;AAAA,EACH,QAAQ;AAAA,EACR,OAAO;AACT,GAEa,eAAqB;AAAA,EAChC,KAAK;AAAA,EACL,MAAM;AAAA,EACN,OAAO;AAAA,EACP,QAAQ;AACV;AC2BgB,SAAA,gBAAgB,UAAmB,IAAsB;AACvE,QAAM,cAAc,gBAAgB,QAAQ,KAAK,KAAK,GAEhD,UAAU,QAAQ,WAAW,iBAC7B,OAAO,QAAQ,QAAQ,cACvB,kBAAkB,gBAAgB,QAAQ,SAAS,KAAK,cAAc,eAAe,IAAI,GAEzF3H,SAAQ,QAAQ,SAAS,EAAC,GAAG,UAAU,GAAG,SAAA,GAE1C,SAAS;AAAA,IACb;AAAA,IACA,EAAC,SAAS,KAAI;AAAA,IACd,EAAC,QAAQ,iBAAiB,OAAAA,OAAK;AAAA,EAAA,GAG3B,kBAAkB,YAAY,MAAM,MAAM,eAAe,CAAC;AAEzD,SAAA;AAAA,IACL,OAAO;AAAA,MACL;AAAA,IACF;AAAA,IACA,WAAW;AAAA;AAAA,MAET,UAAU;AAAA,MACV,UAAU;AAAA,MACV,OAAO;AAAA,MACP,QAAQ;AAAA,IACV;AAAA,IACA,SAAS;AAAA,MACP,WAAW;AAAA,IACb;AAAA,IACA,MAAM;AAAA,MACJ,UAAU;AAAA,MACV,UAAU;AAAA,MACV,QAAQ,kBAAkB,OAAO,KAAK,MAAM;AAAA,MAC5C,OAAO,kBAAkB,OAAO,KAAK,KAAK;AAAA,MAC1C,KAAK,kBAAkB,OAAO,KAAK,GAAG;AAAA,MACtC,MAAM,kBAAkB,OAAO,KAAK,IAAI;AAAA,IAC1C;AAAA,IACA,OAAO;AAAA,MACL,UAAU;AAAA,MACV,QAAQ,kBAAkB,OAAO,MAAM,MAAM;AAAA,MAC7C,OAAO,kBAAkB,OAAO,MAAM,KAAK;AAAA,MAC3C,KAAK,kBAAkB,OAAO,MAAM,GAAG;AAAA,MACvC,MAAM,kBAAkB,OAAO,MAAM,IAAI;AAAA,IAC3C;AAAA,EAAA;AAEJ;AAEA,SAAS,gBAAgB,MAAuC;AAC9D,MAAI,CAAC;AACI,WAAA;AAGT,MAAI,iBAAiB;AACnB,WAAO,KAAK;AAGV,MAAA,YAAY,QAAQ,WAAW,MAAM;AACvC,QAAI,OAAO,KAAK,UAAW,YAAY,OAAO,KAAK,SAAU;AAC3D,YAAM,IAAI,MAAM,yCAAyC,KAAK,UAAU,IAAI,CAAC,EAAE;AAG1E,WAAA,KAAK,QAAQ,KAAK;AAAA,EAC3B;AAEO,SAAA;AACT;AAEA,SAAS,MAAM,KAAa,WAAW,GAAW;AAChD,QAAM,aAAa,KAAK,IAAI,IAAI,QAAQ;AACxC,SAAO,KAAK,MAAM,MAAM,UAAU,IAAI;AACxC;AAEA,SAAS,qBACP,cACA,YACA,MACwB;AAClB,QAAA,OAAO,WAAW,MAClB,iBAAiB,KAAK,QACtB,YAAY,KAAK,OAGjB,WAAW,IAAM,KAAK,OAAO,KAAK,OAClC,YAAY,IAAM,KAAK,MAAM,KAAK,QAGlC,SAAS;AAAA,IACb,KAAK,CAAC,KAAK,MAAM;AAAA,IACjB,MAAM,CAAC,KAAK,OAAO;AAAA,IACnB,OAAO,IAAI;AAAA,IACX,QAAQ,IAAI;AAAA,EAQR,GAAA,aAHqB,WAAW,YAGE,cAIlC,UAAU;AAAA,IACd,IAAI,WAAW,QAAQ,IAAI,KAAK,QAAQ;AAAA,IACxC,IAAI,WAAW,QAAQ,IAAI,KAAK,OAAO;AAAA,IACvC,QAAQ,WAAW,QAAQ,SAAS;AAAA,IACpC,OAAO,WAAW,QAAQ,QAAQ;AAAA,EAAA,GAO9B,mBAAmB,IAAM,QAAQ,OAEjC,mBAAqB,IAAM,QAAQ,SAAU,aAAc,gBAE3D,WAAW,KAAK,IAAI,kBAAkB,gBAAgB;AAGxD,MAAA;AACJ,QAAM,eAAe,cAAc;AAC/B,iBAEF,oBAAoB,IAGpB,oBAAoB,aAAa;AAGnC,MAAI,QACA;AAGJ,MAAI,oBAAoB,UAAU;AAEvB,aAAA;AACL,QAAA;AACJ,UAAM,OAAO,oBAAoB;AAG7B,mBACF,iBAAiB,IAAM,OAEvB,iBAAiB,UAGnB,UAAU;AAAA,MACR,OAAO;AAAA,MACP,QAAS,iBAAiB,aAAc;AAAA;AAAA,MAGxC,MAAM;AAAA,MACN,KAAK;AAAA,IAAA;AAGD,UAAA,cAAc,QAAQ,IAAI,QAAQ,QAAS,QAAQ,QAAQ,QAAQ,QAAS;AAClF,YAAQ,UAAU,GAAG;AAAA,MACnB,KAAK;AACK,gBAAA,OAAO,eAAe,IAAI,CAAC;AACnC;AAAA,MACF,KAAK;AAEH,gBAAQ,OAAO,eAAe,IAAI,QAAQ,QAAQ;AAClD;AAAA,MACF,KAAK;AACH,gBAAQ,OAAO,gBAAgB,IAAI,QAAQ,SAAS,IAAI,CAAC;AACzD;AAAA,MACF;AACE,cAAM,IAAI;AAAA,UACR,yBAAyB,UAAU,CAAC;AAAA,QAAA;AAAA,IAE1C;AACM,UAAA,aAAa,QAAQ,IAAI,QAAQ,SAAU,QAAQ,SAAS,QAAQ,SAAU;AACpF,YAAQ,UAAU,GAAG;AAAA,MACnB,KAAK;AACK,gBAAA,MAAM,eAAe,CAAC,aAAa;AAC3C;AAAA,MACF,KAAK;AAEH,gBAAQ,MAAM;AACd;AAAA,MACF,KAAK;AACH,gBAAQ,MAAM,eAAe,CAAC,cAAc,IAAI,QAAQ,UAAU;AAClE;AAAA,MACF;AACE,cAAM,IAAI;AAAA,UACR,yBAAyB,UAAU,CAAC;AAAA,QAAA;AAAA,IAE1C;AAAA,aACS,cAAc;AAEd,aAAA;AAET,QAAI,MAAO,CAAC,QAAQ,IAAI,aAAc,iBAAiB;AACjD,UAAA,SAAU,oBAAoB,aAAc;AAE9C,UAAM,IACR,MAAM,IACG,CAAC,MAAM,SAAS,MACzB,MAAM,EAAE,SAAS,KAGnB,UAAU;AAAA,MACR,OAAO;AAAA,MACP;AAAA,MACA,MAAM;AAAA;AAAA,MAEN;AAAA,IAAA;AAAA,EACF,OACK;AAEI,aAAA;AAET,UAAM,QAAQ;AACV,QAAA,OAAO,MAAM,QAAQ,IAAI;AACzB,WAAO,IACT,OAAO,IACE,CAAC,OAAO,QAAQ,MACzB,OAAO,EAAE,QAAQ,KAGnB,UAAU;AAAA,MACR;AAAA,MACA,QAAS,oBAAoB,aAAc;AAAA,MAC3C,KAAK;AAAA;AAAA,MAEL;AAAA,IAAA;AAAA,EAEJ;AAEO,SAAA;AAAA,IACL;AAAA,IACA,MAAM;AAAA,IACN,OAAO;AAAA,EAAA;AAEX;AAEA,SAAS,eAAe,MAAY;AAClC,QAAM,SAAS,IAAI,KAAK,MAAM,KAAK;AAEnC,UADc,IAAI,KAAK,OAAO,KAAK,SACpB;AACjB;AAEA,SAAS,YAAY,KAAa;AAChC,SAAO,QAAQ,IAAI,IAAI,GAAG,GAAG;AAC/B;AAEA,SAAS,kBAAkB,KAAa;AACtC,SAAO,YAAY,MAAM,MAAM,GAAG,CAAC;AACrC;ACnSO,MAAM,wBAAwB,OAAO;AAAA;AAAA;AAAA,GCgBtC4H,UAAQC,QAAM,kBAAkB;AAEtC,SAAS,cAAc,MAAY,WAAmB;AACpD,QAAM,aAAa,IAAI,WACjB,YAAY,YAAY,YACxB,YAAY,aAAa,KAAK,OAAO,KAAK,SAAS,WACnD,aAAa,cAAc,KAAK,MAAM,KAAK,UAAU;AAC3D,SAAO,YAAY;AACrB;AAkBa,MAAA,eAAe,KAAK,SAAsB3M,QAA0B;AACzE,QAAA;AAAA,IACJ,SAAS;AAAA,IACT,SAAS;AAAA,IACT;AAAA,IACA,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,UAAU;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QACE,CAAC,iBAAiB,kBAAkB,IAAI,SAAwB,IAAI,GACpE,sBAAsB,OAA8B,IAAI,GACxD,kBAAkB,OAAgC,IAAI,GAEtD,wBAAwB,YAAY,MAAM;AAC9C,QAAK,oBAAoB;AACzB,UAAI,gBAAgB,QAAQ;AACpB,cAAA,aAAa,oBAAoB,QAAQ;AAC/C,wBAAgB,MAAM,mBAAmB,WAAW,cAAc,WAAW,YAAY,CAAC;AAAA,MAC5F;AACE,2BAAmB,IAAI;AAAA,EAAA,GAExB,CAAC,WAAW,CAAC;AAEhB,YAAU,MAAM;AACd,UAAM,eAAe,gBAAgB;AAMnC,WAAA,gBACA,aAAa,OACb,aAAa,YACb,aAAa,iBAAiB,WAG9B0M,QAAM,kFAAkF,GAAG,GAE3F,aAAa,MAAM,aAAa,MAGlC,yBAEA,OAAO,iBAAiB,UAAU,qBAAqB,GAEhD,MAAM;AACJ,aAAA,oBAAoB,UAAU,qBAAqB;AAAA,IAAA;AAAA,EAC5D,GACC,CAAC,KAAK,qBAAqB,CAAC;AAEzB,QAAA,eAAe,QAAQ,MACvB,gBAAgB,SACX,OAAO,cAAc,MAAM,cAAc,IAAI,iBAGlD,gBAAgB,SACX,kBAGF,eAAe,MACrB,CAAC,aAAa,iBAAiB,MAAM,cAAc,CAAC,GAEjD,eAAe;AAAA,IACnB,MACE,gBAAgB;AAAA,MACd,WAAW,EAAC,aAAa,gBAAgB,eAAc;AAAA,MACvD,OAAO,EAAC,aAAa,eAAc;AAAA,MACnC;AAAA,MACA;AAAA,MACA,OAAO;AAAA,QACL,GAAG;AAAA,QACH,GAAG;AAAA,MACL;AAAA,IAAA,CACD;AAAA,IACH,CAAC,QAAQ,QAAQ,MAAM,SAAS,gBAAgB,YAAY;AAAA,EAAA;AAG9D,SACG,oBAAA,uBAAA,EAAsB,WAAW,GAAG,SAAS,IAAI,OAAc,KAAK,qBACnE,UAAA,qBAAC,OAAI,EAAA,OAAO,aAAa,WACvB,UAAA;AAAA,IAAC,oBAAA,OAAA,EAAI,OAAO,aAAa,QAAS,CAAA;AAAA,IACjC,oBAAA,OAAA,EAAI,OAAO,aAAa,MACvB,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,KAAK;AAAA,QACL;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,OAAO,aAAa;AAAA,MAAA;AAAA,IAAA,GAExB;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ,CAAC;ACtIM,SAAS,YAAY1M,QAAyB;AAC7C,QAAA,EAAC,KAAK,SAAA,IAAYA,QAClB,CAAC,WAAW,YAAY,IAAI,SAAS,EAAI,GACzC,CAAC,OAAO,QAAQ,IAAI,SAAkC,IAAI,GAC1D,CAAC,OAAO,QAAQ,IAAI,SAAuB,IAAI;AAErD,SAAA,UAAU,MAAM;AACd,aAAS,IAAI,GACb,SAAS,IAAI,GACb,aAAa,EAAI;AAEX4M,UAAAA,SAAQ,IAAI;AAElBA,WAAM,SAAS,MAAM;AACnB,eAASA,MAAK,GACd,SAAS,IAAI,GACb,aAAa,EAAK;AAAA,IAAA,GAGpBA,OAAM,UAAU,MAAM;AACX,eAAA,IAAI,MAAM,6BAA6B,KAAK,UAAU,GAAG,CAAC,EAAE,CAAC,GACtE,aAAa,EAAK;AAAA,IAAA,GAGpBA,OAAM,iBAAiB,mCACvBA,OAAM,MAAM;AAAA,EAAA,GACX,CAAC,GAAG,CAAC,GAED,SAAS,EAAC,OAAO,OAAO,UAAA,CAAU;AAC3C;AC/BO,SAAS,OAAO5M,QAAyB;AACxC,QAAA,EAAC,OAAO,WAAW,UAAU,aAAYA,QAEzC,CAAC,MAAM,IAAI,SAA4B,MAAM;AAC3C,UAAA,gBAAgB,SAAS,cAAc,QAAQ;AACvC,WAAA,cAAA,MAAM,UAAU,QACvB;AAAA,EAAA,CACR;AACD,YAAU,OACR,SAAS,KAAK,YAAY,MAAM,GACzB,MAAM;AACF,aAAA,KAAK,YAAY,MAAM;AAAA,EAAA,IAEjC,CAAC,MAAM,CAAC;AAEX,QAAM,SAAS;AAAA,IACb,CAAC4M,QAAyBC,YAAmBC,cAAqB;AAChE,YAAM,QAAQF,OAAM,QAAQA,OAAM,QAC5B,QAAQ,KAAK,IAAIA,OAAM,OAAOE,SAAQ,GACtC,SAAS,KAAK,IAAIF,OAAM,QAAQC,UAAS,GAEzC,YAAYD,OAAM,QAAQA,OAAM,QAChC,cAAc,YAAY,QAAQ,SAAS,OAC3C,eAAe,YAAY,QAAQ,QAAQ;AAE1C,aAAA,QAAQ,aACf,OAAO,SAAS;AAEV,YAAA,MAAM,OAAO,WAAW,IAAI;AAClC,aAAI,OACF,IAAI,UAAUA,QAAO,GAAG,GAAGA,OAAM,OAAOA,OAAM,QAAQ,GAAG,GAAG,aAAa,YAAY,GAGhF;AAAA,IACT;AAAA,IACA,CAAC,MAAM;AAAA,EAAA;AAGT,SAAO,SAAS,OAAO,OAAO,WAAW,QAAQ,CAAC;AACpD;ACvCO,MAAM,MAAM;AAAA,EAGjB,YAAY,GAAW,GAAW;AAC3B,SAAA,IAAI,GACT,KAAK,IAAI;AAAA,EACX;AACF;AAEA,MAAM,MAAM;AAAA,EAIV,YAAY,GAAW,MAAc,OAAe;AAClD,SAAK,IAAI,GACT,KAAK,QAAQ,MACb,KAAK,SAAS;AAAA,EAChB;AAAA,EAEA,IAAI,QAAQ;AACV,WAAO,IAAI,MAAM,KAAK,QAAQ,KAAK,CAAC;AAAA,EACtC;AAAA,EAEA,IAAI,OAAO;AACT,WAAO,IAAI,MAAM,KAAK,OAAO,KAAK,CAAC;AAAA,EACrC;AAAA,EAEA,IAAI,SAAS;AACJ,WAAA,KAAK,SAAS,KAAK;AAAA,EAC5B;AACF;AAEA,MAAM,QAAQ;AAAA,EAEZ,YAAY,MAAY;AACtB,SAAK,OAAO;AAAA,EACd;AAAA,EAEA,IAAI,MAAM;AACD,WAAA,IAAI,MAAM,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,KAAK,KAAK,KAAK;AAAA,EACjE;AAAA,EAEA,IAAI,SAAS;AACJ,WAAA,IAAI,MAAM,KAAK,KAAK,QAAQ,KAAK,KAAK,MAAM,KAAK,KAAK,KAAK;AAAA,EACpE;AACF;AAEO,MAAM,KAAK;AAAA;AAAA,EAMhB,OAAO,UAAU,EAAC,MAAM,OAAO,KAAK,QAAArH,WAAe;AAC1C,WAAA,IAAI,KAAK,MAAM,KAAK,IAAI,OAAO,OAAO,IAAI,MAAMA,OAAM;AAAA,EAC/D;AAAA,EAEA,YAAY,OAAO,GAAG,MAAM,GAAG,QAAQ,GAAG,SAAS,GAAG;AAC/C,SAAA,OAAO,MACZ,KAAK,MAAM,KACX,KAAK,QAAQ,OACb,KAAK,SAAS;AAAA,EAChB;AAAA,EAEA,WAAW,MAA0B,KAA+B;AAC3D,WAAA,IAAI,KAAK,MAAM,KAAK,KAAK,SAAS,GAAG,KAAK,UAAU,CAAC;AAAA,EAC9D;AAAA,EAEA,QAAQ,OAA2B,QAAkC;AAC5D,WAAA,IAAI,KAAK,KAAK,QAAQ,GAAG,KAAK,OAAO,GAAG,OAAO,MAAM;AAAA,EAC9D;AAAA,EAEA,UAAU,GAAW,GAAiB;AACpC,UAAM,QAAQ,KAAK,SAAS,GACtB,SAAS,KAAK,UAAU;AACvB,WAAA,IAAI,KAAK,IAAI,QAAQ,GAAG,IAAI,SAAS,GAAG,SAAS,GAAG,UAAU,CAAC;AAAA,EACxE;AAAA,EAEA,IAAI,SAAgB;AACX,WAAA,IAAI,MAAM,KAAK,OAAO,KAAK,QAAQ,GAAG,KAAK,MAAM,KAAK,SAAS,CAAC;AAAA,EACzE;AAAA,EAEA,IAAI,UAAmB;AACd,WAAA,IAAI,QAAQ,IAAI;AAAA,EACzB;AAAA,EAEA,IAAI,QAAgB;AACX,WAAA,KAAK,OAAO,KAAK;AAAA,EAC1B;AAAA,EAEA,IAAI,SAAiB;AACZ,WAAA,KAAK,MAAM,KAAK;AAAA,EACzB;AAAA,EAEA,SAAS,MAAkB;AACzB,WAAO,IAAI;AAAA,OACR,KAAK,QAAQ,KAAK,KAAK,QAAQ,KAAK;AAAA,OACpC,KAAK,OAAO,KAAK,KAAK,SAAS,KAAK;AAAA,MACrC,KAAK,QAAQ,KAAK;AAAA,MAClB,KAAK,SAAS,KAAK;AAAA,IAAA;AAAA,EAEvB;AAAA,EAEA,KAAK,OAAqB;AACxB,WAAO,IAAI;AAAA,MACT,KAAK,OAAO;AAAA,MACZ,KAAK,MAAM;AAAA,MACX,KAAK,QAAQ,QAAQ;AAAA,MACrB,KAAK,SAAS,QAAQ;AAAA,IAAA;AAAA,EAE1B;AAAA,EAEA,OAAO,OAAqB;AACnB,WAAA,KAAK,KAAK,CAAC,KAAK;AAAA,EACzB;AAAA,EAEA,aAAa,MAAkB;AACvB,UAAA,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK,QACjC,OAAO,KAAK,OAAO,KAAK,OAAO,KAAK,OACpC,SAAS,KAAK,SAAS,KAAK,QAC5B,QAAQ,KAAK,QAAQ,KAAK;AAChC,WAAO,IAAI,KAAK,MAAM,KAAK,OAAO,MAAM;AAAA,EAC1C;AAAA,EAEA,MAAM,QAAoB;AAGxB,QAAI,EAAC,MAAM,KAAK,OAAO,WAAU;AAC7B,WAAA,OAAO,QAAQ,UACjB,QAAQ,OAAO,OACf,OAAO,OAAO,OAEZ,OAAO,SAAS,WAClB,SAAS,OAAO,QAChB,MAAM,OAAO,MAGX,OAAO,QAAQ,OAAO,OAAO,OAAO,UACtC,OAAO,OAAO,QAAQ,QAGpB,MAAM,SAAS,OAAO,MAAM,OAAO,WACrC,MAAM,OAAO,SAAS,SAGjB,IAAI,KAAK,KAAK,IAAI,MAAM,OAAO,IAAI,GAAG,KAAK,IAAI,KAAK,OAAO,GAAG,GAAG,OAAO,MAAM;AAAA,EACvF;AACF;AC1JgB,SAAA,iBAAiB,OAAmB,SAAwB;AAC1E,QAAM,SAAS,EAAC,GAAG,QAAQ,OAAO,GAAG,GAAG,QAAQ,OAAO,EAAA,GACjD,UAAU,QAAQ,QAAQ,GAC1B,UAAU,QAAQ,SAAS;AAE7B,MAAA,WAAW,KAAK,WAAW;AACtB,WAAA;AAGH,QAAA,aAAa,EAAC,GAAG,MAAM,IAAI,OAAO,GAAG,GAAG,MAAM,IAAI,OAAO,EAAC;AAG9D,SAAA,KAAK,IAAI,WAAW,GAAG,CAAC,IAAI,KAAK,IAAI,SAAS,CAAC,IAC7C,KAAK,IAAI,WAAW,GAAG,CAAC,IAAI,KAAK,IAAI,SAAS,CAAC,KACjD;AAEJ;AAEO,SAAS,gBACd,EAAC,GAAG,EAAA,GACJ,QACS;AACT,SAAO,KAAK,IAAI,IAAI,OAAO,GAAG,CAAC,IAAI,KAAK,IAAI,IAAI,OAAO,GAAG,CAAC,IAAI,KAAK,IAAI,OAAO,QAAQ,CAAC;AAC1F;AAEgB,SAAA,cAAc,OAAmB,MAAqB;AACpE,SACE,MAAM,KAAK,KAAK,QAChB,MAAM,KAAK,KAAK,OAAO,KAAK,SAC5B,MAAM,KAAK,KAAK,OAChB,MAAM,KAAK,KAAK,MAAM,KAAK;AAE/B;AAEgB,SAAA,wBAAwB,SAAiB,SAA2B;AAC3E,SAAA;AAAA,IACL,GAAG,QAAQ,OAAO,IAAK,QAAQ,QAAQ,IAAK,KAAK,IAAI,OAAO;AAAA,IAC5D,GAAG,QAAQ,OAAO,IAAK,QAAQ,SAAS,IAAK,KAAK,IAAI,OAAO;AAAA,EAAA;AAEjE;ACxCa,MAAA,YACX,8cAEW,aACX,0cCNI,iBAAiB,CAAC,IAAI,UAAU,OAAO,MAAM,GAAG,EAAE;AAAA,EACtD,CAAC,WAAW,GAAG,MAAM;AACvB;AACA,IAAI,gBAA6C;AAG1C,SAAS,qBAAqB,SAAmC;AACtE,SAAI,kBAAkB,OACpB,gBAAgB,eAAe,KAAK,CAAC,iBAAiB,gBAAgB,OAAO,IAIxE,iBAAiB,QAAQ,aAAa;AAC/C;ACRA,MAAMmH,UAAQC,QAAM,kBAAkB;AAgB/B,SAAS,cAAc9K,YAAqB;AACjD,SAAO,cAAwB,cAA8B;AAAA,IAAtD,cAAA;AAAA,YAAA,GAAA,SAAA,GAC+B,KAAA,UAAA,MACJ,KAAA,aAAA,MACnB,KAAA,aAAA,IAgBb,KAAA,kBAAkB,CAAC,UAA6B;AAC9C,cAAM,EAAC,aAAa,aAAY,KAAK;AAEjC,YAAA,YAAY,CAAC,KAAK;AACpB;AAGF,YAAI,KAAK,YAAY;AACnB6K,kBAAM,6CAA6C;AACnD;AAAA,QACF;AAEA,aAAK,aAAa;AACZ,cAAA,UAAU,OAAO,KAAK;AACtBA,gBAAA,mBAAmB,OAAO,GAChC;AAAA,UACE,0BAA0B,QAAQ,GAAG,QAAQ,GAAG,KAAK,QAAQ,uBAAuB;AAAA,QAAA,GAGtF,KAAK,aAAa;AAAA,MAAA,GAGpB,KAAA,aAAa,CAAC,UAA6B;AACzC,YAAI,CAAC,KAAK,cAAc,KAAK,MAAM,YAAY,CAAC,KAAK;AACnD;AAGF,cAAM,EAAC,OAAU,IAAA,KAAK,OAChB,UAAU,OAAO,KAAK,GACtB,OAAO,QAAQ,SAAS,KAAK,UAAU;AAC7C,eAAO,IAAI,GACXA,QAAM,gBAAgB,IAAI,GAC1B,KAAK,aAAa;AAAA,MAAA,GAGpB,KAAA,gBAAgB,CAAC,UAA6B;AAC5C,cAAM,EAAC,WAAW,aAAY,KAAK;AACnC,YAAI,CAAC,KAAK,cAAc,YAAY,CAAC,KAAK;AACxC;AAEI,cAAA,UAAU,OAAO,KAAK;AAC5B;AAAA,UACE,0BAA0B,QAAQ,GAAG,QAAQ,GAAG,KAAK,QAAQ,uBAAuB;AAAA,QACtF,GACA,KAAK,aAAa,IAClB,KAAK,aAAa,MAClBA,QAAM,kBAAkB,OAAO;AAAA,MAAA,GAGjC,KAAA,mBAAmB,MAAM;AACnB,YAAA,CAAC,KAAK,cAAc,KAAK,MAAM,YAAY,CAAC,KAAK,cAAc,CAAC,KAAK;AACvE;AAGI,cAAA,EAAC,UAAS,IAAI,KAAK;AACzB,aAAK,aAAa,IAClB;AAAA,UACE;AAAA,YACE,KAAK,WAAW;AAAA,YAChB,KAAK,WAAW;AAAA,YAChB,KAAK,QAAQ,sBAAsB;AAAA,UACrC;AAAA,QAAA,GAGF,KAAK,aAAa;AAAA,MAAA,GAGpB,KAAA,aAAa,CAAC,SAA4B;AACxC,aAAK,UAAU;AAAA,MAAA;AAAA,IACjB;AAAA,IAnFA,oBAAoB;AACT,eAAA,KAAK,iBAAiB,eAAe,KAAK,UAAU,GAC7D,SAAS,KAAK,iBAAiB,aAAa,KAAK,aAAa,GAC9D,SAAS,KAAK,iBAAiB,gBAAgB,KAAK,gBAAgB,GACpE,SAAS,KAAK,iBAAiB,iBAAiB,KAAK,gBAAgB;AAAA,IACvE;AAAA,IAEA,uBAAuB;AACZ,eAAA,KAAK,oBAAoB,eAAe,KAAK,UAAU,GAChE,SAAS,KAAK,oBAAoB,aAAa,KAAK,aAAa,GACjE,SAAS,KAAK,oBAAoB,gBAAgB,KAAK,gBAAgB,GACvE,SAAS,KAAK,oBAAoB,iBAAiB,KAAK,gBAAgB;AAAA,IAC1E;AAAA,IAyEA,SAAS;AACD,YAAA,EAAC,UAAU,aAAa,WAAW,QAAQ,GAAG,KAAA,IAAQ,KAAK;AAE/D,aAAA;AAAA,QAAC7K;AAAA,QAAA;AAAA,UACC,KAAK,KAAK;AAAA,UACV,eAAe,WAAW,SAAY,KAAK;AAAA,UAC3C,eAAe,WAAW,SAAY,KAAK;AAAA,UAC1C,GAAG;AAAA,QAAA;AAAA,MAAA;AAAA,IAGV;AAAA,EAAA;AAEJ;AAEA,SAAS,0BAA0B,GAAW,GAAW,MAAmC;AACnF,SAAA;AAAA,IACL,GAAG,IAAI,KAAK;AAAA,IACZ,GAAG,IAAI,KAAK;AAAA,EAAA;AAEhB;AAEA,SAAS,OAAO,OAAsC;AAC7C,SAAA;AAAA,IACL,GAAG,MAAM;AAAA,IACT,GAAG,MAAM;AAAA,EAAA;AAEb;AAEA,SAAS,QAAQ,KAAiB,UAAkC;AAC3D,SAAA;AAAA,IACL,GAAG,IAAI,IAAI,SAAS;AAAA,IACpB,GAAG,IAAI,IAAI,SAAS;AAAA,EAAA;AAExB;AC7IO,MAAM,kBAAkB,cAAc,QAAQ,GAExC,gBAAgB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GASvB,kBAAkB,OAAO,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GCO/C,YAAY,GACZ,mBAAmB,IACnB,sBAAsB;AAE5B,SAAS,cAAc,MAAY;AAC3B,QAAA,WAAW,KAAK,MAAM,KAAK,QAC3B,WAAW,KAAK,OAAO,KAAK;AAC3B,SAAA;AAAA,IACL,KAAK,WAAW,KAAK,SAAS,KAAK;AAAA,IACnC,QAAQ,WAAW,KAAK,MAAM,KAAK;AAAA,IACnC,MAAM,WAAW,KAAK,QAAQ,KAAK;AAAA,IACnC,OAAO,WAAW,KAAK,OAAO,KAAK;AAAA,EAAA;AAEvC;AAEA,SAAS,oBAAoB,OAAgC,OAAgB;AAGzE,SAAA,EAAA,CAAC,SACD,CAAC,MAAM,QACP,MAAM,KAAK,MAAM,MAAM,MAAM,KAC7B,MAAM,KAAK,OAAO,MAAM,OAAO,KAC/B,MAAM,KAAK,QAAQ,MAAM,QAAQ,KACjC,MAAM,KAAK,SAAS,MAAM,SAAS;AAKvC;AAEA,SAAS,kBAAkB,OAAgC,OAAgB;AACnE,QAAA,EAAC,KAAK,OAAO,QAAA0D,SAAQ,KAAQ,IAAA,MAAM,QAAQ,cAE3C,WAAW;AAAA,IACf,SAAS,MAAM;AAAA,IACf,MAAM;AAAA,MACJ,KAAK,OAAO,MAAM,OAAO,KAAK,IAAI,MAAM;AAAA,MACxC,OAAO,SAAS,MAAM,SAAS,KAAK,IAAI,QAAQ;AAAA,MAChD,QAAQA,WAAU,MAAM,UAAU,KAAK,IAAIA,UAAS;AAAA,MACpD,MAAM,QAAQ,MAAM,QAAQ,KAAK,IAAI,OAAO;AAAA,IAC9C;AAAA,KAGI,WAAW;AAAA,IACf,KAAK,OAAO,MAAM,OAAO,KAAK,KAAI,MAAM,OAAO;AAAA,IAC/C,OAAO,SAAS,MAAM,SAAS,KAAK,KAAI,MAAM,SAAS;AAAA,IACvD,QAAQA,WAAU,MAAM,UAAU,KAAK,KAAI,MAAM,UAAU;AAAA,IAC3D,MAAM,QAAQ,MAAM,QAAQ,KAAK,KAAI,MAAM,QAAQ;AAAA,EAAA;AAGrD,SAAO,EAAC,OAAO,UAAU,OAAO,SAAQ;AAC1C;AAEA,SAAS,uBAAuB,QAAqC;AACnE,UAAQ,QAAQ;AAAA,IACd,KAAK;AAAA,IACL,KAAK;AACI,aAAA;AAAA,IAET,KAAK;AAAA,IACL,KAAK;AACI,aAAA;AAAA,IAET,KAAK;AAAA,IACL,KAAK;AACI,aAAA;AAAA,IAET,KAAK;AAAA,IACL,KAAK;AACI,aAAA;AAAA,IACT;AACS,aAAA;AAAA,EACX;AACF;AAEA,MAAMwH,wBAAsBtK,UAAQ,MAAM;AACxC,QAAM,mBAAmB,OAAO,oBAAoB,GAC9C,MAAM,SAAS,cAAc,QAAQ,EAAE,WAAW,IAAI,GACtD,oBAAqB,OAAO,qBAAqB,GAAG,KAAM;AAChE,SAAO,mBAAmB;AAC5B,CAAC,GAEK,iBAAwC;AAAA,EAC5C;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAEO,MAAM,mBAAmB,cAAgD;AAAA,EAAzE,cAAA;AAAA,UAAA,GAAA,SAAA,GACoB,KAAA,QAAA;AAAA,MACvB,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,iBAAiB;AAAA,IAAA,GAugBnB,KAAA,kBAAkB,CAAC,EAAC,GAAG,EAAA,MAAmB;AACxC,YAAM,kBAAkB,EAAC,GAAG,IAAI,KAAK,SAAA,GAAY,GAAG,IAAI,KAAK,SAAA,KAEvD,YAAYuK,iBAAyB,iBAAiB,KAAK,eAAe,CAAC,GAE3E,eAAeC,gBAAwB,iBAAiB,KAAK,oBAAqB,CAAA,GAElF,mBAAmB,KAAK,uBAAuB,eAAe,GAE9D,aAAaC,cAAsB,iBAAiB,KAAK,aAAa;AAExE,yBACF,KAAK,SAAS,EAAC,UAAU,iBAAiB,CAAA,IACjC,eACT,KAAK,SAAS,EAAC,UAAU,GAAI,CAAC,IACrB,YACT,KAAK,SAAS,EAAC,QAAQ,GAAI,CAAC,IACnB,cACT,KAAK,SAAS,EAAC,YAAY,GAAK,CAAA;AAAA,IAAA,GAIpC,KAAA,aAAa,CAAC,QAAoB;AAC5B,WAAK,MAAM,WACb,KAAK,SAAS,KAAK,MAAM,UAAU,GAAG,IAC7B,KAAK,MAAM,aACpB,KAAK,aAAa,GAAG,IACZ,KAAK,MAAM,SACpB,KAAK,SAAS,GAAG,IACR,KAAK,MAAM,YACpB,KAAK,WAAW,GAAG;AAAA,IAAA,GAIvB,KAAA,gBAAgB,MAAM;AACpB,YAAM,EAAC,UAAU,gBAAe,KAAK;AAChC,WAAA,SAAS,EAAC,QAAQ,IAAO,UAAU,IAAO,UAAU,IAAO,YAAY,GAAM,CAAA;AAClF,YAAM,EAAC,SAAS,MAAM,QAAW,IAAA,KAAK,gBAAgB,GAEhD,OAAO,cAAc,OAAO,GAE5B,aAAa;AAAA,QACjB,MAAM;AAAA,UACJ,KAAK,KAAK;AAAA,UACV,QAAQ,IAAI,KAAK;AAAA,UACjB,MAAM,KAAK;AAAA,UACX,OAAO,IAAI,KAAK;AAAA,QAClB;AAAA,QACA,SAAS;AAAA,UACP,GAAG,QAAQ,OAAO;AAAA,UAClB,GAAG,QAAQ,OAAO;AAAA,UAClB,QAAQ,KAAK,IAAI,QAAQ,MAAM;AAAA,UAC/B,OAAO,KAAK,IAAI,QAAQ,KAAK;AAAA,QAC/B;AAAA,MAAA;AAEF,eAAS,UAAU,GACf,eACF,YAAY,UAAU;AAAA,IAAA,GAI1B,KAAA,mBAAmB,MAAM;AACvB,WAAK,SAAS,EAAC,iBAAiB,KAAK,CAAA;AAAA,IAAA,GAGvC,KAAA,oBAAoB,CAAC,UAA2C;AACxD,YAAA,aAAa,MAAM,cAAc,sBAAsB;AAC7D,WAAK,SAAS;AAAA,QACZ,iBAAiB;AAAA,UACf,IAAI,MAAM,UAAU,WAAW,QAAQ,KAAK,SAAS;AAAA,UACrD,IAAI,MAAM,UAAU,WAAW,OAAO,KAAK,SAAS;AAAA,QACtD;AAAA,MAAA,CACD;AAAA,IAAA,GAGH,KAAA,YAAY,CAAC,SAAuC;AAClD,WAAK,SAAS;AAAA,IAAA;AAAA,EAChB;AAAA,EA/kBA,iBAAiB;AACT,UAAA,EAAC,OAAO,MAAS,IAAA,KAAK,OAEtB,UAAmB,MAAM,WAAW,iBACpC,cAAc,IAAI,OACrB,QAAQ,QAAQ,OAAO,QAAQ,MAAM,EACrC,UAAU,QAAQ,GAAG,QAAQ,CAAC;AAEjC,WAAO,IAAI,KAAK,EACb,QAAQ,MAAM,OAAO,MAAM,MAAM,EACjC,OAAO,YAAY,KAAK,SAAU,CAAA,EAClC,SAAS,WAAW;AAAA,EACzB;AAAA,EAEA,cAAc;AACZ,UAAM,EAAC,OAAO,UAAS,KAAK;AAE5B,WAAO,IAAI,KACR,EAAA,QAAQ,MAAM,OAAO,MAAM,MAAM,EACjC,OAAO,YAAY,KAAK,SAAU,CAAA,EAClC,aAAa,KAAK,UAAU,MAAM,QAAQ,YAAY,EAAE,MAAM,IAAI,KAAK,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC;AAAA,EACxF;AAAA,EAEA,iBAA8B;AAC5B,UAAM,QAAQ,KAAK,eAEb,aAAa,mBAAmB,KAAK,YAErC,qBAAqB,aAAa,GAElC,aAAa,IAAI,KAAK,GAAG,GAAG,YAAY,UAAU;AACjD,WAAA;AAAA,MACL,MAAM,WAAW;AAAA,QACf,MAAM,OAAO;AAAA,QACb,MAAM,OAAO,IAAI;AAAA,MACnB;AAAA,MACA,OAAO,WAAW;AAAA,QAChB,MAAM,QAAQ;AAAA,QACd,MAAM,OAAO,IAAI;AAAA,MACnB;AAAA,MAEA,KAAK,WAAW;AAAA,QACd,MAAM,OAAO,IAAI;AAAA,QACjB,MAAM,MAAM;AAAA,MACd;AAAA,MACA,SAAS,WAAW;AAAA,QAClB,MAAM,OAAO;AAAA,QACb,MAAM,MAAM;AAAA,MACd;AAAA,MACA,UAAU,WAAW;AAAA,QACnB,MAAM,QAAQ;AAAA,QACd,MAAM,MAAM;AAAA,MACd;AAAA,MAEA,QAAQ,WAAW;AAAA,QACjB,MAAM,OAAO,IAAI;AAAA,QACjB,MAAM,SAAS;AAAA,MACjB;AAAA,MACA,YAAY,WAAW;AAAA,QACrB,MAAM,OAAO;AAAA,QACb,MAAM,SAAS;AAAA,MACjB;AAAA,MACA,aAAa,WAAW;AAAA,QACtB,MAAM,QAAQ;AAAA,QACd,MAAM,SAAS;AAAA,MACjB;AAAA,IAAA;AAAA,EAEJ;AAAA,EAEA,uBAAuB,EAAC,GAAG,KAAgB;AACnC,UAAA,cAAc,KAAK;AACzB,eAAW,YAAY;AACjB,UAAAA,cAAsB,EAAC,GAAG,KAAI,YAAY,QAAQ,CAAC;AAC9C,eAAA;AAGJ,WAAA;AAAA,EACT;AAAA,EAEA,SAAS,KAAiB;AAClB,UAAA,EAAC,OAAO,OAAO,aAAY,KAAK,OAChC,QAAQ,KAAK,SAAS,GACtB,QAAQ;AAAA,MACZ,GAAI,IAAI,IAAI,QAAS,MAAM;AAAA,MAC3B,GAAI,IAAI,IAAI,QAAS,MAAM;AAAA,IAAA;AAGpB,aAAA,mBAAmB,OAAO,KAAK,CAAC;AAAA,EAC3C;AAAA,EAEA,aAAa,KAAiB;AAC5B,UAAM,EAAC,OAAO,UAAU,UAAS,KAAK,OAChC,QAAQ,KAAK,YACb,OAAQ,IAAI,IAAI,QAAS,MAAM,OAC/B,QAAS,CAAC,IAAI,IAAI,QAAS,MAAM,OACjC,MAAO,IAAI,IAAI,QAAS,MAAM,QAC9B3H,UAAU,CAAC,IAAI,IAAI,QAAS,MAAM,QAClC,QAAQ,EAAC,MAAM,OAAO,KAAK,QAAAA;AAE7B,wBAAoB,OAAO,KAAK,KAClC,SAAS,gBAAgB,OAAO,KAAK,CAAC;AAAA,EAE1C;AAAA,EAEA,SAAS,MAAwB,KAAiB;AAC1C,UAAA,EAAC,OAAO,UAAU,UAAS,KAAK,OAChC,QAAQ,KAAK;AACnB,QAAI,OAAO,GACP,QAAQ,GACR,MAAM,GACNA,UAAS;AAET,YAAQ,UAAU,SAAS,aAAa,SAAS,eACnD,OAAQ,IAAI,IAAI,QAAS,MAAM,SACtB,QAAQ,WAAW,SAAS,cAAc,SAAS,mBAC5D,QAAS,CAAC,IAAI,IAAI,QAAS,MAAM,QAG/B,QAAQ,SAAS,SAAS,aAAa,SAAS,aAClD,MAAO,IAAI,IAAI,QAAS,MAAM,UACrB,QAAQ,YAAY,SAAS,gBAAgB,SAAS,mBAC/DA,UAAU,CAAC,IAAI,IAAI,QAAS,MAAM;AAGpC,UAAM,QAAQ,EAAC,MAAM,OAAO,KAAK,QAAAA,WAC3B,WAAW,kBAAkB,OAAO,KAAK,EAAE,OAC3C,WAAW,kBAAkB,OAAO,KAAK,EAAE;AAExC,aAAA,gBAAgB,UAAU,QAAQ,CAAC;AAAA,EAC9C;AAAA,EAEA,WAAW,KAAiB;AACpB,UAAA,EAAC,OAAO,UAAU,UAAS,KAAK,OAChC,QAAQ,KAAK,SAAS,GAEtB,QAAQ;AAAA,MACZ,GAAI,IAAI,IAAI,QAAQ,IAAK,MAAM;AAAA,MAC/B,GAAI,IAAI,IAAI,QAAQ,IAAK,MAAM;AAAA,IAAA;AAExB,aAAA,qBAAqB,OAAO,EAAC,QAAQ,MAAM,GAAG,OAAO,MAAM,EAAC,CAAC,CAAC;AAAA,EACzE;AAAA,EAEA,kBAAkB;AACV,UAAA,QAAQ,KAAK,MAAM,OAEnB,OAAO,KAAK,UAAU,MAAM,QAAQ,YAAY,EAAE,MAAM,IAAI,KAAK,GAAG,GAAG,GAAG,CAAC,CAAC,GAE5E,UAAU,MAAM,WAAW,iBAC3B,cAAc,IAAI,KAAK,GAAG,GAAG,GAAG,CAAC,EACpC,QAAQ,QAAQ,OAAO,QAAQ,MAAM,EACrC,UAAU,QAAQ,GAAG,QAAQ,CAAC,EAC9B,MAAM,IAAI;AAEN,WAAA,EAAC,MAAY,SAAS;EAC/B;AAAA,EAEA,aAAa,SAAmC,SAAiB;AAC/D,UAAM,EAAC,OAAO,SAAQ,IAAI,KAAK,OAEzB,YAAY,IAAI,KAAK,EAAE,QAAQ,MAAM,OAAO,MAAM,MAAM,GAExD,EAAC,SAAS,SAAQ,KAAK,gBAEvB,GAAA,QAAQ,KAAK,SACb,GAAA,SAAS,YAAY;AAE3B,YAAQ,QACR,aAAA,GACA,eACA,QAAQ,QACR,SAAS,GACT,QAAQ,QAAQ,GACX,YACH,eAAe,KAAK,KAAK,IAAI;AAG/B,aAAS,cAAc;AACrB,cAAQ,KAAK;AAEP,YAAA,OAAO,UAAU,OAAO,MAAM,EAAE,SAAS,OAAO,GAEhD,SAAS,KAAK,SAAS,KAAK;AAE1B,cAAA,MAAM,GAAG,MAAM,GACvB,QAAQ,UACR,GAAA,QAAQ,cAAc,SACtB,QAAQ;AAAA,QACN,KAAK,OAAO;AAAA,QACZ,KAAK,OAAO,IAAI;AAAA,QAChB,KAAK,IAAI,KAAK,QAAQ,CAAC;AAAA,QACvB;AAAA,QACA,IAAI,KAAK;AAAA,QACT;AAAA,MAAA,GAEF,QAAQ,cAAc,SACtB,QAAQ,YAAY,MAAM,OAC1B,QAAQ,OACR,GAAA,QAAQ,UAAU,GAElB,QAAQ;IACV;AAGS,aAAA,UACP,SACA,QACA,UACA,WACA,UACA,SACA,WACA,YACA;AACQ,cAAA,QACR,QAAQ;AAAA,QACN;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA,GAEF,QAAQ;IACV;AAEA,aAAS,WAAW;AACZ,YAAA,MAAM,UAAU,SAAS,OAAO,GAEhC,OAAO,UAAU,OAAO,MAAM,EAAE,SAAS,OAAO;AAEtD;AAAA,QACE,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,MAAA;AAAA,IAET;AAEA,aAAS,eAAe;AAChB,YAAA,MAAM,UAAU,aAAa,IAAI,GAEjC,OAAO,UAAU,OAAO,MAAM,EAAE,aAAa,IAAI;AAEvD,cAAQ,QACR;AAAA,QACE,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,MAAA,GAEP,QAAQ,cAAc,KACtB,QAAQ,YAAY,SACpB,QAAQ,SAAS,KAAK,MAAM,KAAK,KAAK,KAAK,OAAO,KAAK,MAAM,GAC7D,QAAQ;IACV;AAEA,aAAS,eAAe,SAAiB;AACvC,cAAQ,KAAK;AAEb,YAAM,SAAS,sBAAsB,OAC/B,OAAO,UAAU,OAAO,MAAM,EAAE,SAAS,OAAO,GAEhD,QAAQ4H,wBAAgC,SAAS,IAAI;AAEnD,cAAA,UAAA,GACR,QAAQ,IAAI,MAAM,GAAG,MAAM,GAAG,QAAQ,GAAG,IAAI,KAAK,IAAI,EAAK,GAC3D,QAAQ,YAAY,oBACpB,QAAQ,KAAK,GACb,QAAQ,UAAA,GACR,QAAQ,QAAQ,GAEhB,QAAQ,UAAU,GAClB,QAAQ,IAAI,MAAM,GAAG,MAAM,GAAG,QAAQ,GAAG,IAAI,KAAK,IAAI,EAAK,GAC3D,QAAQ,cAAc,gBACtB,QAAQ,YAAY,MAAM,OAC1B,QAAQ,OAAA,GACR,QAAQ,UAAU;AAAA,IACpB;AAAA,EACF;AAAA,EAEA,gBAAgB;AAjalB,QAAAxM;AAkaU,UAAA,QAAOA,MAAK,KAAA,WAAL,OAAa,SAAAA,IAAA;AAC1B,WAAO,OAAO,EAAC,QAAQ,KAAK,cAAc,OAAO,KAAK,YAAA,IAAe,EAAC,QAAQ,GAAG,OAAO,EAAC;AAAA,EAC3F;AAAA,EAEA,sBAAsB;AACd,UAAA,OAAO,KAAK,eAAA,GACZ,QAAQwM,wBAAgC,KAAK,KAAK,MAAM,IAAI;AAC3D,WAAA;AAAA,MACL,GAAG,MAAM;AAAA,MACT,GAAG,MAAM;AAAA,MACT,QAAQ,IAAI,KAAK,SAAS;AAAA,IAAA;AAAA,EAE9B;AAAA,EAEA,MAAM,SAAmC;AACvC,YAAQ,KAAK;AAEb,UAAM,EAAC,MAAA,IAAS,KAAK,OAEf,OAAO,KAAK,eAAe,GAC3B,QAAQ,KAAK,SAAS,GACtB,SAAS,YAAY;AAGvB,YAAQ,eACV,QAAQ,YAAY,CAAC,IAAI,OAAO,IAAI,KAAK,CAAC,GAE5C,QAAQ,YAAY,MAAM,OAE1B,QAAQ,cAAc,4BAGtB,MAAM,KAAK,OAAO,CAAC,GAEnB,MAAM,KAAK,OAAO,CAAC,GAEnB,QAAQ,cAAc,4BAEtB,MAAM,KAAK,GAAG,GAGd,MAAM,KAAK,MAAM,GAGjB,MAAM,KAAK,IAAI,GAEf,MAAM,KAAK,KAAK,GAEhB,QAAQ;AAER,aAAS,MAAM,GAAW;AACxB,WAAK,GAAG,QAAQ,GAAG,MAAM,SAAS,MAAM;AAAA,IAC1C;AAEA,aAAS,MAAM,GAAW;AACxB,WAAK,QAAQ,GAAG,MAAM,QAAQ,QAAQ,CAAC;AAAA,IACzC;AAEA,aAAS,KAAK,IAAY,IAAY,IAAY,IAAY;AAC5D,cAAQ,aACR,QAAQ,OAAO,IAAI,EAAE,GACrB,QAAQ,OAAO,IAAI,EAAE,GACrB,QAAQ,OAAO,GACf,QAAQ;IACV;AAAA,EACF;AAAA,EAEA,gBAAgB,SAAmC;AACjD,UAAM,EAAC,MAAK,IAAI,KAAK,OACf,QAAQ,IAAI,KAAK,EAAE,QAAQ,MAAM,OAAO,MAAM,MAAM,EAAE,OAAO,YAAY,KAAK,UAAU;AAE9F,YAAQ,KAAK,GACb,QAAQ,YAAY,SACpB,QAAQ,UAAU,GAAG,GAAG,MAAM,OAAO,MAAM,MAAM,GAEjD,QAAQ,cAAc,KAGtB,QAAQ,UAAU,OAAO,MAAM,MAAM,MAAM,KAAK,MAAM,OAAO,MAAM,MAAM,GACzE,QAAQ;EACV;AAAA,EAEA,MAAM,SAAmC;AACjC,UAAA,EAAC,SAAQ,IAAI,KAAK;AACxB,YAAQ,KAAK;AAEb,UAAM,UAAUJ;AACR,YAAA,MAAM,SAAS,OAAO;AAE9B,UAAM,UAAU,CAAC,YAAY,KAAK,MAAM,kBAAkB,MAAM;AAE3D,SAAA,gBAAgB,OAAO,GAE5B,KAAK,aAAa,SAAS,OAAO,GAElC,KAAK,MAAM,OAAO,GAClB,KAAK,gBAAgB,OAAO,GAEvB,YACH,KAAK,qBAAqB,SAAS,OAAO,GAO5C,QAAQ,QAAQ;AAAA,EAClB;AAAA,EAEA,qBAAqB,SAAmC;AAClD,QAAA,CAAC,KAAK,MAAM;AACd;AAGF,UAAM,EAAC,GAAG,EAAC,IAAI,KAAK,MAAM;AAClB,YAAA,UAAA,GACR,QAAQ,IAAI,GAAG,GAAG,KAAK,KAAK,SAAA,GAAY,GAAG,IAAI,KAAK,IAAI,EAAK,GAC7D,QAAQ,YAAY,aACpB,QAAQ,KAAA,GACR,QAAQ,QAAQ;AAAA,EAClB;AAAA,EAEA,gBAAgB,SAAmC;AAC3C,UAAA,WAAW,KAAK;AACtB,YAAQ,KAAK,GACb,QAAQ,UAAA,GACR,QAAQ,YAAY,yBACpB,QAAQ,YAAY,GACpB,QAAQ,KAAK,SAAS,MAAM,SAAS,KAAK,SAAS,OAAO,SAAS,MAAM,GACzE,QAAQ,OAAA,GACR,QAAQ,UAAU,GAClB,QAAQ,QAAQ;AAAA,EAClB;AAAA,EAEA,qBAAqB,SAAmC,SAAiB;AACvE,YAAQ,KAAK;AACP,UAAA,cAAc,KAAK;AAIV,mBAAA,QAAQ,CAAC,WAAW;AACzB,cAAA,YACN,KAAK,MAAM,aAAa,SACpB,qBAAqB,OAAO,MAC5B,uBAAuB,UAAU,GAAG;AAC1C,YAAM,EAAC,MAAM,KAAK,QAAQ,UAAS,YAAY,MAAM;AAC7C,cAAA,SAAS,MAAM,KAAK,OAAO,MAAM,GACzC,QAAQ,UAAA,GACR,QAAQ,YAAY,oBAAoB,OAAO,KAC/C,QAAQ,KAAK,MAAM,KAAK,OAAO,MAAM,GACrC,QAAQ,UAAA,GACR,QAAQ,OAAO;AAAA,IAAA,CAChB,GACD,QAAQ;EACV;AAAA,EAEA,WAAW;AACH,UAAA,aAAa,KAAK;AACxB,WAAO,KAAK,MAAM,MAAM,QAAQ,WAAW;AAAA,EAC7C;AAAA,EAEA,YAAY;AACJ,UAAA,EAAC,gBAAmB,IAAA,KAAK,OACzB,EAAC,aAAY,KAAK;AACxB,QAAI,CAAC,mBAAmB;AACf,aAAA;AAGT,UAAM,iBAAiB,KAAK,MAAM,YAAY,KAAK,uBAAuB,eAAe;AACrF,QAAA;AACK,aAAA,uBAAuB,cAAc,KAAK;AAGnD,UAAM,wBAAwBE;AAAAA,MAC5B;AAAA,MACA,KAAK,oBAAoB;AAAA,IAAA;AAGvB,QAAA,KAAK,MAAM,YAAY;AAClB,aAAA;AAGT,QAAI,KAAK,MAAM,UAAU,KAAK,MAAM;AAC3B,aAAA,OAAOG,UAAkB;AAGlC,UAAM,qBAAqBJ,iBAAyB,iBAAiB,KAAK,eAAgB,CAAA,GACpF,sBAAsBE,cAAsB,iBAAiB,KAAK,YAAa,CAAA;AACrF,WAAI,sBAAsB,sBACjB,OAAOG,SAAiB,YAG1B;AAAA,EACT;AAAA,EAEA,oBAAoB;AAClB,SAAK,KAAK;AAAA,EACZ;AAAA,EAEA,qBAAqB;AACnB,SAAK,KAAK;AAAA,EACZ;AAAA,EAEA,OAAO;AACL,QAAI,CAAC,KAAK;AACR;AAGF,UAAM,UAAU,KAAK,OAAO,SACtB,UAAU,QAAQ,WAAW,IAAI;AACvC,QAAI,CAAC;AACH;AAGF,SAAK,MAAM,OAAO;AAClB,UAAM,gBAAgB,QAAQ,MAAM,QAC9B,YAAY,KAAK;AACnB,sBAAkB,cACpB,QAAQ,MAAM,SAAS;AAAA,EAE3B;AAAA,EAiFA,SAAS;AACP,UAAM,EAAC,OAAO,aAAY,KAAK,OACzB,QAAQN;AACd,+BACG,eACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,KAAK,KAAK;AAAA,QACV,QAAQ,KAAK;AAAA,QACb,aAAa,KAAK;AAAA,QAClB,WAAW,KAAK;AAAA,QAChB,eAAe,KAAK;AAAA,QACpB,cAAc,KAAK;AAAA,QACnB,QAAQ,MAAM,SAAS;AAAA,QACvB,OAAO,MAAM,QAAQ;AAAA,MAAA;AAAA,IAEzB,EAAA,CAAA;AAAA,EAEJ;AACF;AAEA,SAAS,mBAAmB,OAAgC,OAAuC;AAC3F,QAAA,iBAAkB,SAAS,MAAM,WAAY;AAE5C,SAAA;AAAA,IACL,GAAG;AAAA,IACH,SAAS;AAAA,MACP,GAAG;AAAA,MACH,GAAG,eAAe,IAAI,MAAM;AAAA,MAC5B,GAAG,eAAe,IAAI,MAAM;AAAA,IAC9B;AAAA,EAAA;AAEJ;AAEA,SAAS,qBACP,OACA,OACoB;AACd,QAAA,iBAAkB,SAAS,MAAM,WAAY;AAC5C,SAAA;AAAA,IACL,GAAG;AAAA,IACH,SAAS;AAAA,MACP,GAAG;AAAA,MACH,QAAQ,eAAe,SAAS,MAAM;AAAA,MACtC,OAAO,eAAe,QAAQ,MAAM;AAAA,IACtC;AAAA,EAAA;AAEJ;AAEA,SAAS,gBAAgB,OAAgC,OAA8B;AAC/E,QAAA,cAAe,SAAS,MAAM,QAAS;AACtC,SAAA;AAAA,IACL,GAAG;AAAA,IACH,MAAM;AAAA,MACJ,MAAM,YAAY,QAAQ,MAAM,QAAQ;AAAA,MACxC,OAAO,YAAY,SAAS,MAAM,SAAS;AAAA,MAC3C,KAAK,YAAY,OAAO,MAAM,OAAO;AAAA,MACrC,QAAQ,YAAY,UAAU,MAAM,UAAU;AAAA,IAChD;AAAA,EAAA;AAEJ;AChwBO,SAAS,UAAU/M,QAAuB;AAC/C,6BACG,aAAY,EAAA,KAAKA,OAAM,KACrB,UAAA,CAAC,EAAC,WAAW,OAAO,MACf,MAAA,gCACM,cAAa,EAAA,UAAQ,IAAC,IAE5B,4BACM,OAAK,EAAA,UAAA,MAAM,QAAQ,CAAA,IAEzB,4BAEC,QAAO,EAAA,OAAc,WAAW,UAAU,WAAW,UAAU,UAAU,UACvE,WAAC,WAAW,oBAAC,cAAW,OAAO,QAAS,GAAGA,QAAO,EAAA,CACrD,IAGG,KAEX,CAAA;AAEJ;AAEA,UAAU,YAAY;AACtB,UAAU,WAAW;AC/BrB,MAAM,gCAAgC;AAEtC,SAAS,OAAO,KAAa;AACpB,SAAA,IAAI,WAAW,OAAO;AAC/B;AAEO,SAAS,UAAU,KAA2C;AAC5D,SAAA,IAAI,WAAW,CAAC,eAAe;AAC9B,UAAA,QAAQ,SAAS,cAAc,KAAK;AAE1C,QAAI,YAAY;AAChB,UAAM,SAAS,MAAM;AACnB,kBAAY,IACZ,WAAW,KAAK,KAAK,GACrB,WAAW;IACb,GAEM,UAAU,MAAM;AACpB,kBAAY,IACZ,WAAW,MAAM,IAAI,MAAM,6BAA6B,OAAO,GAAG,IAAI,SAAS,GAAG,EAAE,CAAC;AAAA,IAAA;AAGjF,WAAA,MAAA,SAAS,QACf,MAAM,UAAU,SAChB,MAAM,MAAM,KAEL,MAAM;AACX,YAAM,SAAS,MACf,MAAM,UAAU,MAEX,cAEH,MAAM,MAAM;AAAA,IAAA;AAAA,EAEhB,CACD;AACH;AAQA,MAAMsN,kBAAgB,EAAC,WAAW;AAE3B,SAAS,aAAa,KAA6B;AACxD,QAAM,CAAC,OAAO,QAAQ,IAAI,SAAyBA,eAAa;AAEhE,SAAA,UAAU,MAAM;AACd,aAASA,eAAa;AACtB,UAAM,eAAe,UAAU,GAAG,EAE/B,UAAU;AAAA,MACT,OAAO,CAAC,QAAQ;AACd,iBAAS,EAAC,WAAW,IAAO,OAAO,KAAI;AAAA,MACzC;AAAA,MACA,MAAM,CAAC,UAAU;AACf,iBAAS,EAAC,OAAO,WAAW,GAAM,CAAA;AAAA,MACpC;AAAA,IAAA,CACD;AACH,WAAO,MAAM;AACX,mBAAa,YAAY;AAAA,IAAA;AAAA,EAC3B,GACC,CAAC,GAAG,CAAC,GAED;AACT;ACjDA,MAAM,eAAe,CAAC,SAAS,GAEzB,wBAAwB;AAAA,EAC5B,CAAC,OAAO,IAAI,CAAC;AAAA,EACb,CAAC,UAAU,IAAI,CAAC;AAAA,EAChB,CAAC,QAAQ,KAAK,CAAC;AAAA,EACf,CAAC,YAAY,IAAI,CAAC;AACpB,GAEM,gBAAgC;AAAA,EACpC,MAAM;AAAA,EACN,SAAS;AACX,GAEMC,gBAAc,OAAO;AAAA;AAAA;AAI3B,SAAS,WAAWvN,QAA8B;AAChD,SACG,oBAAA,MAAA,EAAK,OAAM,UAAS,SAAQ,UAAS,SAAS,GAAG,OAAO,EAAC,cAAc,aAAY,GACjF,iBAAM,SACT,CAAA;AAEJ;AAEO,SAAS,eAAeA,QAA4B;AACnD,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAYM;AAAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEN,QAEE,CAAC,YAAY,aAAa,IAAI,SAAS,SAAS,aAAa,GAE7D,EAAC,OAAO,WAAW,gBAAgB,OAAO,eAAc,IAAI,aAAa,QAAQ,GAEjF,cAAc,YAAY,MAAM;AACpC,gBAAY,YAAY;AAAA,EAAA,GACvB,CAAC,WAAW,CAAC;AAEhB,YAAU,MAAM;AACd,kBAAc,SAAS,aAAa;AAAA,EAAA,GACnC,CAAC,KAAK,CAAC;AAEJ,QAAA,WAAW,UAAU,CAAC,MAAM;AAErB,eAAA,UAAU,CAAC,aAAa;AA9EvC,QAAAW;AA+EQ,KAAC,YAAY,cACfA,MAAa,aAAA,IAAI,YAAjB,QAA0BA,IAAA,MAAA;AAAA,EAAA,CAE7B;AAED,QAAM,kBAAkB;AAAA,IACtB,CAAC,eAAoB;AACf,UAAA;AACF;AAGI,YAAA,YAAY,WAAW,OAAO;AAAA,QAClC,CAAC,UAAU,MAAM,SAAS,UAAU,MAAM,KAAK,SAAS;AAAA,MAAA,GAGpD,eAAe,WAAW,OAAO;AAAA,QACrC,CAAC,UAAU,MAAM,KAAK,SAAS,YAAY,MAAM,SAAS;AAAA,MAC5D,GAIM,OAAO,YACT,EAAC,OAAO,UAAU,KAAK,MAAM,GAAI,WAAW,QAAQ,aAAa,IACjE,WAAW,MAET,UAAU,eACZ,EAAC,OAAO,aAAa,KAAK,MAAM,GAAI,WAAW,WAAW,oBAC1D,WAAW;AAEf,eAAS,CAAC,IAAI,MAAM,CAAC,MAAM,CAAC,GAAG,IAAI,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC;AAAA,IAC3D;AAAA,IACA,CAAC,UAAU,UAAU,WAAW,MAAM;AAAA,EAAA,GAGlC,EAAC,GAAAE,OAAK;AAEV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAOA,GAAE,wBAAwB;AAAA,MACjC;AAAA,MACA,aAAaA,GAAE,8BAA8B;AAAA,MAC7C,YAAY,WAAW;AAAA,MACvB,qBAAqB;AAAA,MAErB,+BAAC,OACC,EAAA,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,sBAAoB;AAAA,YACpB,sBAAoB;AAAA,YACpB,UAAU;AAAA,YACV,KAAK,aAAa;AAAA,YAClB,SAAS;AAAA,YAET,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAM,KAAK,OAAO,YAAY;AAAA,gBAC9B,UAAU,UAAU,CAAC,MAAM;AAAA,gBAC3B,WAAW;AAAA,gBAEX,UAAC,qBAAA4L,YAAA,EAAS,OAAO,IAAI,GACjB,UAAA;AAAA,mBAAA,kBAAkB,mBACjB,oBAAA,YAAA,EACE,UACC,iBAAA,oBAAC,QAAK,SAAS,GAAG,QAAQ,GAAG,MAAK,YAAW,QAAM,IACjD,UAAC,oBAAA9K,QAAA,EACE,aAAE,+BAA+B;AAAA,oBAChC,cAAc,eAAe;AAAA,kBAAA,CAC9B,EACH,CAAA,GACF,wBAEC,cAAa,EAAA,UAAQ,GAAC,CAAA,GAE3B;AAAA,kBAED,CAAC,kBAAkB,SACjB,oBAAA,KAAA,EAAI,QAAQ,GACX,UAAA;AAAA,oBAAC;AAAA,oBAAA;AAAA,sBACC,OAAO;AAAA,sBACP,KAAK,MAAM;AAAA,sBACX,UAAU,CAAQ,CAAA;AAAA,sBAClB,aAAa;AAAA,sBACb,UAAU;AAAA,oBAAA;AAAA,kBAAA,GAEd;AAAA,gBAAA,GAEJ;AAAA,cAAA;AAAA,YACF;AAAA,UAAA;AAAA,QACF;AAAA,4BACC,KAAI,EAAA,WAAW,GACd,UAAC,oBAAA,MAAA,EAAK,SAAS,sBAAsB,QAAQ,KAAK,GAC/C,UAAA,sBAAsB,IAAI,CAAC,CAAC,OAAO,KAAK,2BACtC,OACC,EAAA,UAAA;AAAA,UAAA,oBAAC,SAAQ,EAAA,IAAG,MAAK,MAAM,GACpB,UACH,OAAA;AAAA,UACC,oBAAA,KAAA,EAAI,WAAW,GACd,UAAC,oBAAA8K,YAAA,EAAS,OACR,UAAA,oBAAC,MAAK,EAAA,sBAAoB,IACvB,UAAA,CAAC,kBAAkB,QAClB;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,aAAa;AAAA,cACb,KAAK,MAAM;AAAA,cACX,gBAAgB,MAAM,QAAQ,MAAM;AAAA,cACpC,SAAS,WAAW,WAAW;AAAA,cAC/B,MAAM,WAAW,QAAQ;AAAA,YAAA;AAAA,UAAA,IAG3B,oBAACc,eAAY,CAAA,CAAA,EAAA,CAEjB,GACF,EACF,CAAA;AAAA,QApBQ,EAAA,GAAA,KAqBV,CACD,EACH,CAAA,GACF;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAAA;AAGN;AC3La,MAAA,qBAAqB,OAAO,MAAM;AAAA;AAAA;AAAA;AAAA;AAgBxC,SAAS,iBAAiBvN,QAA8B;AACvD,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QAEE,CAAC,aAAa,cAAc,IAAI,SAAgC,IAAI,GACpE,CAAC,eAAe,gBAAgB,IAAI,SAAmC,IAAI,GAE3E,cAAc,YAAY,MAAM,WAAW,CAAC,UAAU,GAAG,CAAC,YAAY,UAAU,CAAC;AAEvF;AAAA,IACE;AAAA,MACE,CAAC,UAAU;AACL,uBAAe,MAAM,QAAQ,YAAY,MAAM,QAAQ,WACzD,WAAW,EAAK,GAChB,iBAAe,QAAA,cAAA,MAAA;AAAA,MAEnB;AAAA,MACA,CAAC,YAAY,YAAY,aAAa;AAAA,IACxC;AAAA,EAAA,GAKF;AAAA,IACE;AAAA,MACE,CAAC,UAAU;AACJ,yBAAe,QAAA,cAAA,SAAS,MAAM,MAAA,KACjC,WAAW,EAAK;AAAA,MAEpB;AAAA,MACA,CAAC,eAAe,UAAU;AAAA,IAC5B;AAAA,IACA,CAAC,WAAW;AAAA,EAAA;AAGd,QAAM,sBAAsB;AAAA,IAC1B,CAAC,OAAiC;AAEX,2BAAA,EAAE,GAGvB,iBAAiB,EAAE;AAAA,IACrB;AAAA,IACA,CAAC,oBAAoB;AAAA,EAAA;AAIvB,YAAU,MAAM;AACV,mBACF,eAAa,QAAA,YAAA,MAAA;AAAA,EAAA,GAEd,CAAC,YAAY,WAAW,CAAC;AAEtB,QAAA,EAAC,GAAAa,OAAK;AAEV,SAAA,oBAAC,6BACC,UAAC,qBAAA,oBAAA,EAAmB,gBAAY,IAAC,OAAO,GAAG,SAAS,GACjD,UAAA;AAAA,IACC,YAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAYA,GAAE,mDAAmD;AAAA,QACjE,eAAY;AAAA,QACZ,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,KAAK;AAAA,QACL,cAAc,EAAC,SAASA,GAAE,8CAA8C,EAAC;AAAA,MAAA;AAAA,IAC3E;AAAA,IAIF;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAG;AAAA,QACH,SAAS,oBAAC,MAAK,EAAA,KAAK,gBAAiB,UAAS;AAAA,QAC9C,QAAM;AAAA,QACN,MAAM;AAAA,QACN,eAAa;AAAA,QAEb,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,cAAYA,GAAE,8CAA8C;AAAA,YAC5D,eAAY;AAAA,YACZ,MAAK;AAAA,YACL,SAAS;AAAA,YACT,KAAK;AAAA,UAAA;AAAA,QACP;AAAA,MAAA;AAAA,IACF;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACrHO,MAAM,qBAAqB,IAErB,WAAW,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAwBtB,UAAU,OAAO,IAAI,EAG/B,CAAC,EAAC,OAAO,YAAW;AACrB,QAAM,YAAY,YAAY,MAAM,MAAM,KAAK,EAAE,KAAK,QAAQ,IACxD,kBAAkB,KAAK,YAAY,MAAM,MAAM,KAAK,EAAE,KAAK,QAAQ,IAAI,GAAG;AAEzE,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAMc,QAAQ,eAAe,EAAE;AAAA,aACnC,QAAQ,YAAY,EAAE;AAAA,wBACX,QAAQ,kBAAkB,aAAa;AAAA;AAE/D,CAAC,GAEY,cAAc,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GC5BhC,eAAe,CAAC,QAA0B;AAExC,QAAA,OADiB,IAAI,gBAAgB,IAAI,MAAM,GAAG,EAAE,CAAC,CAAC,EAChC,IAAI,MAAM;AAEtC,SAAI,OACK,CAAC,KAAK,MAAM,GAAG,EAAE,CAAC,GAAG,KAAK,MAAM,GAAG,EAAE,CAAC,CAAC,EAAE,IAAI,MAAM,IAGrD,IAAI,MAAM,GAAG,EAAE,CAAC,EAAE,MAAM,GAAG,EAAE,CAAC,EAAE,MAAM,GAAG,EAAE,IAAI,MAAM;AAC9D;AAEO,SAAS+C,eAAa5D,QAA4C;AACvE,QAAM,EAAC,MAAM,UAAU,YAAY,KAAK,GAAG,KAAI,IAAIA,QAC7C,CAAC,UAAU,SAAS,IAAI,SAAS,EAAK,GACtC,CAAC,aAAa,cAAc,IAAI,SAAgC,IAAI,GACpE,WAAW,eAAe,WAAW,GACrC,aAAY,qCAAU,UAAS,GAE/B,OAAO,OADM,cAAc,WAAW,aAAa,YACxB,WAE3B,gBAAiB,qBAAqB,SAAS,gBAAgB,eAAgB,KAE/E,CAAC,YAAY,WAAW,IAAI,aAAa,GAAG,GAE5C,aAAa,aAAa,aAS1B,cANsB,aAAa,YAAY,YAAY,aAAa,eAMrC,gBAAgB,OAAO,GAAG,kBAAkB;AAErF,YAAU,MAAM;AAGd,cAAU,EAAK;AAAA,EAAA,GACd,CAAC,GAAG,CAAC;AAEF,QAAA,eAAe,YAAY,MAAM;AACrC,cAAU,EAAI;AAAA,KACb,CAAE,CAAA,GAEC,EAAC,GAAAa,OAAK,eAAe;AAC3B,SACG,qBAAA,UAAA,EAAU,GAAG,MAAM,KAAK,gBAAgB,OAAO,EAAC,QAAQ,WAAA,GAAa,MAAK,eACzE,UAAA;AAAA,IAAA,qBAAC,MAAK,EAAA,kBAAc,IAAC,MAAK,WACvB,UAAA;AAAA,MAAA,CAAC,YACA,oBAAC,kBAAiB,EAAA,UAAS,eAAc,MAAI,IAAC,SAAU,oBAAA,cAAA,EAAa,UAAQ,GAAC,CAAA,GAAI;AAAA,MAEpF;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA,eAAY;AAAA,UACZ,KAAKb,OAAM;AAAA,UACX,QAAQ;AAAA,UACR,gBAAe;AAAA,QAAA;AAAA,MACjB;AAAA,IAAA,GACF;AAAA,IAEC,QACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,UAAU;AAAA,QACV;AAAA,QACA,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,UAAC,oBAAA,KAAA,EAAI,cAAc,GACjB,UAAC,oBAAA,SAAA,EACC,8BAAC,WAAU,EAAA,YAAwB,SAAoB,CAAA,EACzD,CAAA,GACF;AAAA,UACA,oBAAC2B,QAAK,EAAA,MAAM,GAAI,UAAAd,GAAE,2BAA2B,EAAC,YAAY,SAAS,CAAA,CAAC,EAAE,CAAA;AAAA,QAAA,GACxE;AAAA,MAAA;AAAA,IAEJ;AAAA,EAEJ,EAAA,CAAA;AAEJ;AAEA,SAAS,UAAU,EAAC,YAAY,YAAsD;AAChF,SAAA,iCACM,kBAAiB,CAAA,CAAA,IAEvB,WACM,oBAAA,cAAA,CAAA,CAAa,IAEhB,oBAAC,WAAU,CAAA,CAAA;AACpB;AAEA,SAAS,2BAA2B;AAAA,EAClC;AAAA,EACA;AACF,GAGG;AACG,SAAA,aACK,sDAEF,WACH,iDACA;AACN;AAEA,SAAS,iBAAiB;AAAA,EACxB;AAAA,EACA;AAAA,EACA;AACF,GAIG;AACD,6BACG,SAAQ,EAAA,SAAQ,YAAW,SAAS,GAAG,OAAO,MAAM,OAAO,UAC1D,UAAC,oBAAA,aAAA,EAAY,WAAU,UAAS,OAAM,UAAS,SAAQ,UACpD,kBACH,CAAA,EACF,CAAA;AAEJ;ACpIgB,SAAA,oBAAoB,EAAC,gBAAsB;AACnD,QAAA,EAAC,GAAAA,OAAK;AAEV,SAAA,qBAAC,QAAK,MAAK,WAAU,SAAS,GAAG,QAAM,IAAC,QAAQ,GAC9C,UAAA;AAAA,IAAA,qBAAC,MAAK,EAAA,KAAK,GAAG,cAAc,GAC1B,UAAA;AAAA,MAAC,oBAAA,KAAA,EACC,8BAACc,QAAK,EAAA,MAAM,GACV,UAAC,oBAAA,oBAAA,CAAA,CAAmB,GACtB,EACF,CAAA;AAAA,MACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,oBAACA,UAAK,MAAM,GAAG,QAAO,UACnB,UAAAd,GAAE,0CAA0C,GAC/C;AAAA,4BACCc,QAAK,EAAA,MAAM,GAAI,UAAAd,GAAE,gDAAgD,GAAE;AAAA,MAAA,GACtE;AAAA,IAAA,GACF;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAMA,GAAE,sDAAsD;AAAA,QAC9D,OAAM;AAAA,MAAA;AAAA,IACR;AAAA,EACF,EAAA,CAAA;AAEJ;ACwCA,MAAM,sBAAsB,MACtB,OAAO,SAAW,OAAe,CAAC,OAAO,mBACpC,IAEF,KAAK,MAAM,KAAK,IAAI,GAAG,OAAO,gBAAgB,CAAC;AAmBxD,SAAS,YAAY,EAAC,YAAmC;AAChD,SAAA;AACT;AAEA,MAAM,mBAAmB,CAAC,OAAO,GAE3B,2BAAuD,EAAC,QAAQ;AAG/D,MAAM,uBAAuB,cAAwD;AAAA,EAe1F,YAAYb,QAA4B;AACtC,UAAMA,MAAK,GAf4B,KAAA,kBAAA,MAEC,KAAA,qBAAA,MAEb,KAAA,QAAA;AAAA,MAC3B,aAAa;AAAA,MACb,qBAAqB;AAAA,MACrB,eAAe,CAAC;AAAA,MAChB,SAAS;AAAA,MACT,sBAAsB;AAAA,MACtB,mBAAmB;AAAA,MACnB,YAAY;AAAA,IAAA,GAQwC,KAAA,QAAA,MAEtD,KAAA,oBAAoB,CAAC,OAA8B;AACjD,WAAK,kBAAkB;AAAA,IAAA,GAGzB,KAAA,0BAA0B,CAAC,OAAiC;AAC1D,WAAK,SAAS,EAAC,sBAAsB,GAAG,CAAA;AAAA,IAAA,GAK1C,KAAA,uBAAuB,CAAC,OAAiC;AACvD,WAAK,SAAS,EAAC,mBAAmB,GAAG,CAAA;AAAA,IAAA,GAoBvC,KAAA,mBAAmB,CAAC,SAAmC;AAC/C,YAAA,EAAC,YAAY,iBAAA4G,iBAAmB,IAAA,KAAK,OACrC,WAAWA,oBAAmBA,iBAAgB,YAAY,IAAI;AAC7D,aAAA,WAAW,CAAC,EAAC,MAAM,YAAY,SAAQ,CAAC,IAAI;IAAC,GAiBtD,KAAA,aAAa,CAAC,UAAoB,MAAY,qBAAoC,CAAA,MAAO;AACvF,YAAM,EAAC,YAAY,UAAU,QAAQ,GAAA/F,GAAK,IAAA,KAAK,OACzC,EAAC,OAAO,OAAO,aAAa,YAAY,OAAM,IAAI,oBAClD,UAAU;AAAA,QACd,UAAU,IAAI,YAAY,kBAAkB;AAAA,QAC5C,uBAAuB,IAAI,YAAY,+BAA+B;AAAA,QACtE;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAGG,WAAA,aAAA,GACL,KAAK,SAAS,EAAC,aAAa,IAAK,GACjC,SAAS,aAAa,EAAC,OAAO,WAAW,MAAK,CAAC,GAC/C,KAAK,qBAAqB,SAAS,OAAO,QAAQ,MAAM,YAAY,OAAO,EAAE,UAAU;AAAA,QACrF,MAAM,CAAC,gBAAgB;AACjB,sBAAY,WACd,SAAS,YAAY,OAAO;AAAA,QAEhC;AAAA,QACA,OAAO,CAAC,QAAQ;AA3MtB,cAAAF;AA6MQ,kBAAQ,MAAM,GAAG,IACjBA,MAAK,KAAA,UAAL,YAAY,KAAK;AAAA,YACf,QAAQ;AAAA,YACR,aAAaE,GAAE,uCAAuC;AAAA,YACtD,OAAOA,GAAE,iCAAiC;AAAA,UAAA,CAC5C,GAEA,KAAK;QACP;AAAA,QACA,UAAU,MAAM;AACd,mBAAS,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,GAC9C,KAAK,SAAS,EAAC,aAAa,IAAM;AAAA,QAKpC;AAAA,MAAA,CACD;AAAA,IAAA,GAGH,KAAA,0BAA0B,MAAM;AAC9B,YAAM,EAAC,MAAS,IAAA,KAAK,OASf,UAAU,OAAO,KAAK,SAAS,CAAE,CAAA,GAKjC0L,WAJgB,QAAQ;AAAA,QAC5B,CAAC,QAAQ,CAAC,CAAC,SAAS,QAAQ,WAAW,SAAS,QAAQ,SAAS,EAAE,SAAS,GAAG;AAAA,MAGnD,EAAA,WAAW,GACnC,aAAa,CAAC,OAAO,EACxB,OAAO,QAAQ,OAAO,CAAC,QAAQ,CAAC,QAAQ,WAAW,SAAS,EAAE,SAAS,GAAG,CAAC,CAAC,EAC5E,IAAI,CAAC,QAAQ,MAAM,CAAC,GAAG,CAAC,CAAC;AAEvB,WAAA,MAAM,SAASA,YAAW,CAAC,KAAK,wBAAwB,UAAU,UAAU;AAAA,IAAA,GAGnF,KAAA,oBAAoB,CAAC,UAAsB;AACzC,YAAM,EAAC,UAAU,eAAc,KAAK;AAcpC,UAAI,CAAC,KAAK,oBAAA,KAAyB,KAAK,gCAAgC,KAAK,GAAG;AAC9E,iBAAS,OAAO;AAChB;AAAA,MACF;AAEA;AAAA,QACE,MAAM;AAAA,UACJ,aAAa;AAAA,YACX,OAAO,WAAW;AAAA,UAAA,CACnB;AAAA,QAAA,EACD;AAAA,MAAA;AAAA,IACJ,GAGF,KAAA,kCAAkC,CAAC,UAA+B;AAC1D,YAAA7H,SAAQ,MAAM,QAAQ,CAAC;AAC7B,UAAI,MAAM,QAAQ,WAAW,KAAKA,OAAM,SAAS;AACxC,eAAA;AAIH,YAAA,gBADU,OAAO,KAAK,KAAK,MAAM,SAAS,CAAE,CAAA,EACpB;AAAA,QAC5B,CAAC,QAAQ,CAAC,CAAC,SAAS,QAAQ,QAAQ,SAAS,EAAE,SAAS,GAAG;AAAA,MAAA;AAQ7D,aAJE,MAAM,QAAQ,CAAC,EAAE,KAAK,WAAW,KACjC,cAAc,WAAW,KACzB,cAAc,CAAC,MAAM,MAAM,QAAQ,CAAC,EAAE,KAAK,CAAC;AAAA,IAAA,GAKhD,KAAA,sBAAsB,MAAM;AACpB,YAAA,EAAC,KAAI,IAAI,KAAK;AAKpB,aAAO,OAJmB,KAAK,MAAM,EAAE,EAAE,CAAC,KAIN;AAAA,IAAA,GAGtC,KAAA,mBAAmB,MAAM;AACvB,WAAK,MAAM,YAAY,CAAC,SAAS,CAAC;AAAA,IAAA,GAGpC,KAAA,oBAAoB,MAAM;AArT5B,UAAA/D;AAsTS,WAAA,MAAM,YAAY,CAAE,CAAA,IAGzBA,MAAK,KAAA,MAAM,yBAAX,QAAiCA,IAAA,MAAA;AAAA,IAAA,GAGnC,KAAA,8BAA8B,CAAC,oBAAuC;AACpE,YAAM,EAAC,UAAU,YAAY,iBAAAiG,iBAAA,IAAmB,KAAK;AACzB,kCAAA;AAAA,QAC1B;AAAA,QACA;AAAA,QACA,MAAM;AAAA,QACN,iBAAAA;AAAA,QACA,YAAY,KAAK;AAAA,QACjB,SAAS;AAAA,MAAA,CACV,GAED,KAAK,SAAS,EAAC,qBAAqB,KAAK,CAAA;AAAA,IAAA,GAG3C,KAAA,wBAAwB,CAAC,UAAsB;AA1UjD,UAAAjG;AAgVM,YAAM,kBAAkB,MAAM,UAC9B,MAAM,oBAAkBA,MAAK,KAAA,MAAM,aAAa,QAAxB,oBAA6B,YAErD,KAAK,MAAM,aAAa,QAAQ,KAAK;AAAA,IAAA,GAIzC,KAAA,kBAAkB,CAAC,kBAA8B;AAC/C,WAAK,SAAS;AAAA,QACZ,eAAe,cAAc,OAAO,CAAC,SAAS,KAAK,SAAS,QAAQ;AAAA,MAAA,CACrE;AAAA,IAAA,GAEH,KAAA,iBAAiB,MAAM;AACrB,WAAK,SAAS;AAAA,QACZ,eAAe,CAAC;AAAA,MAAA,CACjB;AAAA,IAAA,GAGH,KAAA,qBAAqB,MAAM;AACzB,WAAK,aAAa;AAAA,IAAA,GAGpB,KAAA,yBAAyB,MAAM;AAC7B,WAAK,SAAS,EAAC,SAAS,IAAM,GAC9B,KAAK;IAAkB,GAGzB,KAAA,oBAAoB,MAAM;AACxB,WAAK,SAAS,EAAC,SAAS,GAAK,CAAA;AAAA,IAAA,GAG/B,KAAA,mBAAmB,MAAM;AACvB,WAAK,MAAM,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;AAAA,IAAA,GAG7E,KAAA,oBAAoB,CAAC,UAAkB;AAC/B,YAAA,EAAC,eAAe,SAAQ,IAAI,KAAK,OACjC,EAAC,cAAa,IAAI,KAAK;AACzB,uBAAiB,CAAC,WACpB,KAAK,oBAAoB,KAAK,IACrB,cAAc,SAAS,KAChC,KAAK,eAAe;AAAA,IAAA,GAIxB,KAAA,mCAAmC,CAAC,WAAwB;AAC1D,WAAK,SAAS,EAAC,qBAAqB,OAAO,CAAA;AAAA,IAAA,GAG7C,KAAA,0BAA0B,MAAM;AAjYlC,UAAAA;AAkYS,WAAA,SAAS,EAAC,qBAAqB,KAAA,CAAK,IAGzCA,MAAA,KAAK,MAAM,sBAAX,QAA8BA,IAAA,MAAA;AAAA,IAAA,GAGhC,KAAA,qBAAqB,CAAC,sBAAyD;AAC7E,YAAM,EAAC,OAAO,SAAS,IAAAnB,KAAI,iBAAAgO,kBAAiB,GAAA3M,GAAK,IAAA,KAAK,OAEhD,gBAAgB,KAAK,mBAAmB,KAAK,SAAS,MAAM;AAGhE,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,sBAAsB;AAAA,UACtB,QAAQA,GAAE,mCAAmC;AAAA,UAC7C,IAAI,GAAGrB,GAAE;AAAA,UACT,gBAAgB,KAAK;AAAA,UACrB,SAAS,KAAK;AAAA,UACd,OAAO;AAAA,UAEP,UAAA,oBAAC,mBACC,UAAC,oBAAA,OAAA,EAAM,OAAO,GACX,UAAA,kBAAiB,+BAAO,UACvB;AAAA,YAAC;AAAA,YAAA;AAAA,cACE,GAAG,KAAK;AAAA,cACT,UAAUgO,iBAAgB,MAAM,MAAM,KAAK,EAAE,IAAI;AAAA,cACjD;AAAA,cACA,UAAU,kBAAkB;AAAA,cAC5B;AAAA,YAAA;AAAA,aAGN,EACF,CAAA;AAAA,QAAA;AAAA,MAAA;AAAA,IACF,GAIJ,KAAA,gBAAgB,MAAM;AACd,YAAA,EAAC,OAAO,YAAY,UAAU,eAAe,iBAAAA,kBAAiB,GAAA3M,IAAG,iBAAA+F,qBACrE,KAAK;AAEP,UAAI,CAAC,SAAS,CAAC,cAAc,KAAK;AACzB,eAAA;AAGT,YAAM,EAAC,cAAa,IAAI,KAAK,OAEvB,gBAAgB,cAAc,OAAO,CAAC,SAASA,iBAAgB,YAAY,IAAI,CAAC,GAEhF,qBAAqB,cAAc,SAAS,cAAc,QAC1D,WAAW4G,iBACd,MAAM,GAAI,EACV,IAAI,KAAK,EACT,MAAM,KAAK,EACX,IAAI,qBAAqB,EACzB,KAAK,QAAQ,EACb;AAGD,aAAA;AAAA,QAAC5J;AAAAA,QAAA;AAAA,UACC,eAAe,KAAK;AAAA,UACpB,MAAM,EAAC,SAAO,QAAA,MAAA,YAAW,cAAc,SAAS;AAAA,UAChD,YAAY,qBAAqB,KAAK,CAAC;AAAA,UACvC;AAAA,UACA,KAAK;AAAA,UACL,KAAK/C,GAAE,qCAAqC;AAAA,QAAA;AAAA,MAAA;AAAA,IAC9C,GAuPJ,KAAA,WAAW,CAAC,UAAiD;AAC3D,WAAK,QAAQ;AAAA,IAAA,GA/jBb,KAAK,aAAab,OAAM,KAAK,OAAO,gBAAgB;AAAA,EACtD;AAAA,EAkBA,qBAAqB;AACnB,WAAO,IAAI,KAAK,MAAM,YAAY,iBAAiB,MAAM;AAAA,EAC3D;AAAA,EAEA,oBAAoB;AApJtB,QAAAW;AAqJI,KAAIA,MAAK,KAAA,MAAM,UAAX,QAAAA,IAAkB,WACpB,KAAK,MAAM,SAAS,MAAM,CAAC,SAAS,CAAC,CAAC;AAAA,EAE1C;AAAA,EAEA,eAAe;AACT,SAAK,uBACP,KAAK,mBAAmB,YAAY,GACpC,KAAK,kBAAkB;AAAA,EAE3B;AAAA,EAQA,oBAAoB,OAAe;AAC3B,UAAA,EAAC,YAAY,iBAAAiG,iBAAmB,IAAA,KAAK,OAErC,QAAQ,MACX,IAAI,CAAC,UAAU,EAAC,MAAM,UAAUA,iBAAgB,YAAY,IAAI,IAAG,EACnE,KAAK,CAAC,WAAW,OAAO,QAAQ;AAE/B,aACF,KAAK,WAAW,MAAM,UAAW,MAAM,IAAI,GAG7C,KAAK,SAAS,EAAC,YAAY,GAAM,CAAA;AAAA,EACnC;AAAA,EAqRA,kBAAkB;AACV,UAAA;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,iBAAA4G;AAAA,MACA;AAAA,MACA,GAAA3M;AAAAA,IAAA,IACE,KAAK,OAEH,QAAQ,SAAO,OAAA,SAAA,MAAA;AACrB,QAAI,CAAC;AACI,aAAA;AAGH,UAAA,SAAS,IAAI,YAAY,kBAAkB,SAAS,GAEpD,yBAAyB,SAAS,SAAS,KAAK,mBAAmB;AAEzE,QAAI,iBACF,gBAAgB,aAAa,WAAW,IAAI,OAC1C;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAMA,GAAE,+BAA+B;AAAA,QACvC,SAAS,MAAM;AACR,eAAA,SAAS,EAAC,YAAY,GAAK,CAAC,GACjC,KAAK,iCAAiC,aAAa,CAAC,CAAC;AAAA,QACvD;AAAA,QACA,UAAU;AAAA,QACV,eAAY;AAAA,MAAA;AAAA,IAAA;AAGd,WAAA,gBAAgB,aAAa,SAAS,MACxC,iBAAiB,aAAa,IAAI,CAAC,gBAE/B;AAAA,MAAC;AAAA,MAAA;AAAA,QAEC,OACG,YAAY,UAAUA,GAAE,YAAY,OAAO,IAAI,YAAY,UAC5D,UAAU,YAAY,IAAI;AAAA,QAE5B,SAAS,MAAM;AACR,eAAA,SAAS,EAAC,YAAY,GAAM,CAAA,GACjC,KAAK,iCAAiC,WAAW;AAAA,QACnD;AAAA,QACA,MAAM,YAAY,QAAQ;AAAA,QAC1B,eAAa,4BAA4B,YAAY,IAAI;AAAA,QACzD,UAAU;AAAA,MAAA;AAAA,MAXL,YAAY;AAAA,IActB,CAAA,IAIA,oBAAA,qBAAA,EAAoB,cAA4B,WAAW,OACzD,UAAA,CAAC,EAAC,KAAK,kBAAkB,UAAA,MAAe;AACvC,UAAI,SACA;AAEA,UAAA,cAAc,KAAK,GAAG;AAClB,cAAA,WAAW,oBAAoB,YAAY,SAAS;AAC1D,sBAAc2M,iBAAgB,MAAM,GAAG,EAAE,cAAc,QAAQ,EAAE,IAAI,GACrE,UAAUA,iBAAgB,MAAM,GAAG,EAAE,IAAI;AAAA,MAC3C;AAGE,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,YAAY,KAAK,MAAM;AAAA,UACvB,QAAQ,KAAK;AAAA,UACb,YAAY,CAAC,WAAW,KAAK,SAAS,EAAC,YAAY,QAAO;AAAA,UAC1D,yBAAyB,KAAK;AAAA,UAC9B,sBAAsB,KAAK;AAAA,UAC3B,UAAU;AAAA,UAEV,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,UAAU,KAAK;AAAA,cACf,QAAQ;AAAA,cACR,SAAS,KAAK;AAAA,cACd;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,YAAA;AAAA,UACF;AAAA,QAAA;AAAA,MAAA;AAAA,IAIR,EAAA,CAAA;AAAA,EAEJ;AAAA,EAEA,gBAAgB;AACR,UAAA,EAAC,cAAc,UAAU,eAAe,IAAAhO,KAAI,GAAAqB,GAAAA,IAAK,KAAK;AAExD,WAAA,gBAAgB,aAAa,WAAW,IAAU,OAElD,gBAAgB,aAAa,SAAS,KAAK,CAAC,YAAY,gBAExD;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAI,GAAGrB,GAAE;AAAA,QACT,KAAK,KAAK;AAAA,QACV,QACE;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,eAAY;AAAA,YACZ,MAAM;AAAA,YACN,WAAW;AAAA,YACX,MAAK;AAAA,YACL,MAAMqB,GAAE,+BAA+B;AAAA,UAAA;AAAA,QACzC;AAAA,QAEF,MACG,oBAAA,MAAA,EACE,UAAa,aAAA,IAAI,CAAC,gBAEf;AAAA,UAAC;AAAA,UAAA;AAAA,YAEC,OACG,YAAY,UAAUA,GAAE,YAAY,OAAO,IAAI,YAAY,UAC5D,UAAU,YAAY,IAAI;AAAA,YAE5B,SAAS,MAAM;AACR,mBAAA,SAAS,EAAC,YAAY,GAAM,CAAA,GACjC,KAAK,iCAAiC,WAAW;AAAA,YACnD;AAAA,YACA,MAAM,YAAY,QAAQ;AAAA,YAC1B,UAAU;AAAA,YACV,eAAa,4BAA4B,YAAY,IAAI;AAAA,UAAA;AAAA,UAXpD,YAAY;AAAA,QActB,CAAA,GACH;AAAA,QAEF,SAAS;AAAA,MAAA;AAAA,IAAA,IAMb;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAMA,GAAE,+BAA+B;AAAA,QACvC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS,MAAM;AACR,eAAA,SAAS,EAAC,YAAY,GAAK,CAAC,GACjC,KAAK,iCAAiC,aAAa,CAAC,CAAC;AAAA,QACvD;AAAA,QACA,eAAY;AAAA,QACZ,UAAU;AAAA,MAAA;AAAA,IAAA;AAAA,EAGhB;AAAA,EAEA,0BAA0B;AACxB,UAAM,EAAC,YAAY,UAAU,eAAe,iBAAA+F,qBAAmB,KAAK,OAE9D,EAAC,cAAa,IAAI,KAAK,OAEvB,gBAAgB,cAAc,OAAO,CAAC,SAASA,iBAAgB,YAAY,IAAI,CAAC,GAChF,qBAAqB,cAAc,SAAS,cAAc,QAE1D,SAAS,IAAI,YAAY,kBAAkB,SAAS;AAE1D,+BACG,OAAI,EAAA,OAAO,EAAC,SAAS,KACpB,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM,WAAW,gBAAgB;AAAA,QACjC,QAAM;AAAA,QACN,UAAU;AAAA,QACV,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,OAAO,cAAc,WAAW,IAAI,CAAA,IAAK,EAAC,aAAa,cAAa;AAAA,QAEpE,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,QAAQ,KAAK,cAAc;AAAA,YAC3B,UAAU,KAAK;AAAA,YACf;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA,MAAK;AAAA,YACL;AAAA,YACA;AAAA,UAAA;AAAA,QACF;AAAA,MAAA;AAAA,IAEJ,EAAA,CAAA;AAAA,EAEJ;AAAA,EAEA,kBAAkB,aAA0B;AAtoB9C,QAAAjG;AAuoBU,UAAA,EAAC,YAAe,IAAA,KAAK,OAGrB,UAASA,MAAA,KAAK,oBAAL,OAAsB,SAAAA,IAAA;AAEnC,WAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,UAAU,cAAc,KAAK,qBAAqB;AAAA,QAClD,SAAS,KAAK;AAAA,QACd;AAAA,MAAA;AAAA,IAAA;AAAA,EAGN;AAAA,EAEA,oBAAoB;AAClB,UAAM,EAAC,oBAAmB,IAAI,KAAK,OAC7B,EAAC,OAAO,YAAY,aAAY,IAAI,KAAK,OACzC,SAAS,IAAI,YAAY,kBAAkB,SAAS;AAE1D,QAAI,CAAC;AACI,aAAA;AAET,UAAMkB,aAAY,oBAAoB;AAElC,WAAA,SAAS,MAAM,QAEd,oBAAA,qBAAA,EAAoB,cAA4B,WAAW,MAAM,OAC/D,UAAA,CAAC4L,gBACA;AAAA,MAAC5L;AAAA,MAAA;AAAA,QACC,gBAAgB,CAAC4L,WAAU;AAAA,QAC3B,WAAU;AAAA,QACV;AAAA,QACA,eAAc;AAAA,QACd,SAAS,KAAK;AAAA,QACd,UAAU,KAAK;AAAA,MAAA;AAAA,OAGrB,IAIF;AAAA,MAAC5L;AAAA,MAAA;AAAA,QACC,gBAAgB,CAAC;AAAA,QACjB,eAAc;AAAA,QACd,WAAU;AAAA,QACV;AAAA,QACA,SAAS,KAAK;AAAA,QACd,UAAU,KAAK;AAAA,MAAA;AAAA,IAAA;AAAA,EAGrB;AAAA,EAMA,cAAc;AACN,UAAA,EAAC,YAAY,OAAO,UAAU,eAAe,iBAAA+E,qBAAmB,KAAK,OAErE,EAAC,cAAiB,IAAA,KAAK,OAEvB,gBAAgB,cAAc,OAAO,CAAC,SAASA,iBAAgB,YAAY,IAAI,CAAC,GAChF,qBAAqB,cAAc,SAAS,cAAc;AAE5D,WAAA,cAAc,SAAS,MACrB,qBAAqB,KAAK,CAAC,iBACtB,aAIP,EAAC,SAAO,QAAA,MAAA,YAAW,CAAC,YAAY,cAAc,SAAS,IAClD,YAGL,YAIG,SAAO,QAAA,MAAA,WAAW,SAAO,QAAA,MAAA,QAHvB,gBAG+C;AAAA,EAC1D;AAAA,EAEA,cAAc;AACZ,UAAM,EAAC,OAAO,UAAU,aAAY,IAAI,KAAK,OAEvC,EAAC,eAAe,QAAA,IAAW,KAAK,OAEhC,mBAAmB,CAAQ,EAAA,SAAA,QAAA,MAAO,WAAW,SAAO,QAAA,MAAA;AAEtD,WAAA,SAAS,OAAO,MAAM,QAAU,OAAe,EAAC,SAAA,QAAA,MAAO,YAAW,CAAC,cAAc,KAAK,IACjF,0BAAO,qBAAoB,EAAA,cAAc,KAAK,kBAAkB,IAKlE,CAAC,eAEH,qBAAA,UAAA,EAAA,UAAA;AAAA,MACC,WAAA,oBAAC,OAAI,cAAc,GACjB,8BAAC,eAAc,EAAA,cAAc,KAAK,uBAAA,CAAwB,EAC5D,CAAA;AAAA,MAGF;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM,WAAW,KAAK,OAAO,gBAAgB;AAAA,UAC7C,UAAU,CAAC,CAAC,WAAW;AAAA,UACvB,WAAW,WAAW;AAAA,UAErB,iCAAO,UACN,KAAK,kBAAkB,MAAM,OAAO,IAEpC;AAAA,YAAC;AAAA,YAAA;AAAA,cACE,GAAG;AAAA,cACJ,SAAS,KAAK;AAAA,cACd,UAAU;AAAA,cACV,UAAU,CAAQ,CAAA;AAAA,cAClB,SAAS,KAAK;AAAA,cACd,aAAa,KAAK;AAAA,cAClB,YAAY,KAAK;AAAA,cACjB,MAAM,KAAK,YAAY;AAAA,cACvB,SAAS,oBAAoB,cAAc,SAAS;AAAA,cACpD,QAAO;AAAA,cACP,QAAQ;AAAA,cAEP,UAAA;AAAA,gBAAC,EAAA,SAAA,QAAA,MAAO,UAAS,KAAK,wBAAwB;AAAA,gBAC9C,EAAC,SAAA,QAAA,MAAO,aAAW,SAAA,OAAA,SAAA,MAAO,UACxB,qBAAA,OAAA,EAAI,OAAO,EAAC,UAAU,WAAa,GAAA,KAAK,KAAK,mBAC3C,UAAA;AAAA,kBAAA,KAAK,cAAc;AAAA,kBACnB,KAAK,gBAAgB;AAAA,gBAAA,GACxB;AAAA,cAAA;AAAA,YAAA;AAAA,UAEJ;AAAA,QAAA;AAAA,MAEJ;AAAA,IACF,EAAA,CAAA;AAAA,EAEJ;AAAA,EAEA,SAAS;AACD,UAAA;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA,IACE,KAAK,OAEH,EAAC,wBAAuB,KAAK,OAG7B,eAAe,QAAQ;AAAA,MAC3B,CAAC,WAAkC,OAAO,SAAS,WAAW,OAAO,SAAS;AAAA,IAAA;AAGhF;AAAA;AAAA,MAEG,qBAAA,OAAA,EAAM,OAAO,GAAG,eAAY,eAC3B,UAAA;AAAA,QAAC,oBAAA,iBAAA,EAAgB,KAAK,KAAK,SAAU,CAAA;AAAA,QACpC,QAAQ,IAAI,CAAC,WACR,OAAO,SAAS,YAAY,OAAO,SAAS,UAAU,OAAO,SAAS,aAEjE,OAGL,OAAO,SAAS,UAEhB;AAAA,UAAC;AAAA,UAAA;AAAA,YAEC;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA,aAAa,OAAO,SAAS,UAAU,KAAK,gBAAgB;AAAA,YAC5D,aAAa,OAAO,SAAS,UAAU,cAAc;AAAA,YACrD;AAAA,YACA;AAAA,UAAA;AAAA,UARK,OAAO;AAAA,QAAA,IAad,OAAO,SAAS,aAEhB;AAAA,UAAC;AAAA,UAAA;AAAA,YAEC;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UAAA;AAAA,UARK,OAAO;AAAA,QAAA,IAYd,OAAO,SAAS,UACV,oBAAA,kBAAA,EAAkC,UAAZ,OAAO,GAAqB,IAGlD,oBAAA,UAAA,EAAA,UAAA,EAAE,0CAA0C,EAAC,MAAM,OAAO,MAAK,GAAE,CAC5E;AAAA,QAEA,gBAAgB,UAAU,CAAC,MAAM,aAChC;AAAA,UAAC;AAAA,UAAA;AAAA,YACE,GAAG,KAAK;AAAA,YACT,cAAc,aAAa,MAAM;AAAA,YACjC,aAAa,KAAK;AAAA,UAAA;AAAA,QACpB;AAAA,QAED,uBAAuB,KAAK,kBAAkB;AAAA,MAAA,GACjD;AAAA;AAAA,EAEJ;AACF;ACj0BO,SAAS,iBAAiB5G,QAAwB;AA9BzD,MAAAW;AA+BQ,QAAA,qBAAoBA,aAAM,WAAW,YAAjB,oBAA0B,SAC9C,EAAC,MAAK,IAAI,eAAe,EAAE,YAC3B,uBAAuB,wBAAA,GACvB,SAAS,UAAU,6BAA6B,GAChD,uBAAuB,MAAM,eAE7BiG,oBAAkB;AAAA,IACtB,CAAC,MAAkB,SACZ,uBAGEC,gBAAuB,MAAM,IAAI,IAF/B;AAAA,IAIX,CAAC,oBAAoB;AAAA,KAKjB,eAAe;AAAA,IACnB,MAAM,qBAAqB,MAAM;AAAA,IACjC,CAAC,OAAO,iBAAiB;AAAA,EAAA,GAGrB,UAAU,QAAQ,MAAM,gBAAgB,MAAM,GAAG,CAAC,MAAM,CAAC,GAEzD,eAAe;AAAA,IACnB,CAACrH,QAAe,kBAAkB,sBAAsBA,GAAE;AAAA,IAC1D,CAAC,oBAAoB;AAAA,EAAA,GAGjB,EAAC,GAAAqB,OAAK;AAEV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAGb;AAAA,MACJ,GAAAa;AAAA,MACA;AAAA,MACA;AAAA,MACA,eAAe;AAAA,MACf,iBAAiB;AAAA,MACjB;AAAA,MAAA,iBACA+F;AAAAA,IAAA;AAAA,EAAA;AAGN;ACzDO,MAAM,gBAAsD;AAAA,EACjE,UAAU;AAAA,EACV,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,OAAO;AAAA,EACP,UAAU;AAAA,EACV,MAAM;AAAA,EACN,KAAK;AAAA,EACL,OAAO;AAAA,EACP,MAAM;AAAA,EACN,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,uBAAuB;AACzB,GC/Ba,4BAA4B,YAAY;AAAA,EACnD,SAAS;AAAA,EACT,MAAM;AAAA,EACN,aAAa;AACf,CAAC,GAEY,6BAA6B,YAAY;AAAA,EACpD,SAAS;AAAA,EACT,MAAM;AAAA,EACN,aAAa;AACf,CAAC,GAEY,iCAAiC,YAAY;AAAA,EACxD,SAAS;AAAA,EACT,MAAM;AAAA,EACN,aACE;AACJ,CAAC,GAEY,kCAAkC,YAG5C;AAAA,EACD,SAAS;AAAA,EACT,MAAM;AAAA,EACN,aACE;AACJ,CAAC,GC1BY,mBAAmB,OAAO;AAAA;AAAA,GAI1B,mBAAmB,OAAO;AAAA;AAAA;AAAA;AAAA,GAM1B,gBAAgB,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAa3B,gBAAgB,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAShC,aAAa;AAAA;AAAA;AAAA;AAAA,QAIb,gBAAgB;AAAA;AAAA;AAAA;AAAA,GC3BlB,gBAAgB,MACnB,OAAO,SAAW,OAAe,kBAAkB,UACnD,OAAO,YAAc,OAAe,UAAU,iBAAiB;AAgB3D,SAAS,gBAAgB5G,QAA6B;AACrD,QAAA,EAAC,UAAU,SAAS,YAAY,oBAAmBA,QACnD,CAAC,SAAS,UAAU,IAAI,SAAS,EAAK,GACtC,EAAC,GAAAa,GAAA,IAAK,kBAEN,cAAc,YAAY,MAAM;AAChC,kBACF,WAAW;AAAA,EAEZ,GAAA,CAAC,UAAU,CAAC,GAET,gBAAgB;AAAA,IACpB,CAAC,UAAyC;AACnC,yBAGD,MAAM,SAAS,WAAW,eAC5B,MAAM,eAAA,GACN,WAAW;AAAA,IAEf;AAAA,IACA,CAAC,iBAAiB,UAAU;AAAA,EAAA,GAGxB,gBAAgB,YAAY,MAAM;AACtC,eAAW,EAAI;AAAA,KACd,EAAE,GAEC,aAAa,YAAY,MAAM;AACnC,eAAW,EAAK;AAAA,KACf,EAAE,GAEC,MAAM,QAAQ,MAAM;AACxB,UAAM,UAAU;AACZ,QAAA;AAEA,cACF,iBAAiB,QACR,UACT,iBAAiB,kBAEjB,iBAAiB;AAGb,UAAA,OACJ,WACAA,GAAE,kDAAkD;AAAA,MAClD,SAAS;AAAA,IAAA,CACV;AACH,WAAQ,oBAAAc,QAAA,EAAK,QAAO,UAAU,UAAK,KAAA,CAAA;AAAA,EAClC,GAAA,CAAC,SAAS,SAASd,EAAC,CAAC;AAGtB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,SAAS;AAAA,MACT,WAAW;AAAA,MAEV,UAAA;AAAA,QACC,mBAAA,qBAAC,iBAAc,eAAY,oBAAmB,UAAU,GAAG,OAAM,UAAS,SAAQ,UAChF,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cAIC,QAAQ;AAAA,YAAA;AAAA,UACV;AAAA,UACA,oBAAC,oBAAkB,UAAI,IAAA,CAAA;AAAA,QAAA,GACzB;AAAA,QAED;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGP;AC/FO,MAAMmE,SAAO,OAAO,IAAI,CAAChF,WAAU;AAClC,QAAA,EAAC,OAAO,OAAO,OAAA,IAAU,YAAYA,OAAM,KAAK,GAEhD,SAAS;AAAA,IACb,OAAO,MAAM,MAAM,QAAQ,QAAQ;AAAA,IACnC,OAAO,MAAM,OAAO;AAAA,EAAA;AAGf,SAAA;AAAA,0BACiBkB,uBAAqB,MAAM,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBASrC,MAAM,OAAO,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAWZ,OAAO,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,4BAKJE,iBAAe;AAAA,IACnC,MAAM;AAAA,IACN;AAAA,IACA,WAAW,MAAM,KAAK;AAAA,EAAA,CACvB,CAAC;AAAA;AAAA;AAGR,CAAC,GAGY,gBAAgB,OAAO,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GCjD5B,cAAc,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC,GAExC,sBAAsB,CAAC,UAAK,UAAK,QAAG,GAEpC,sBAAsB,CAAC,UAAU,eAAe,aAAa,GAE7D,sBAAmD;AAAA,EAC9D,IAAI;AAAA,EACJ,kBAAkB;AAAA,EAClB,WAAW;AAAA,EACX,QAAQ;AAAA,EACR,MAAM;AACR,GAEa,qBAA6D;AAAA,EACxE,IAAI;AAAA,IACF,YAAY;AAAA,IACZ,eAAe;AAAA,EACjB;AAAA,EACA,IAAI;AAAA,IACF,YAAY;AAAA,IACZ,eAAe;AAAA,EACjB;AAAA,EACA,IAAI;AAAA,IACF,YAAY;AAAA,IACZ,eAAe;AAAA,EACjB;AAAA,EACA,IAAI;AAAA,IACF,YAAY;AAAA,IACZ,eAAe;AAAA,EACjB;AAAA,EACA,IAAI;AAAA,IACF,YAAY;AAAA,IACZ,eAAe;AAAA,EACjB;AAAA,EACA,IAAI;AAAA,IACF,YAAY;AAAA,IACZ,eAAe;AAAA,EACjB;AAAA,EACA,QAAQ;AAAA,IACN,YAAY;AAAA,IACZ,eAAe;AAAA,EACjB;AAAA,EACA,YAAY;AAAA,IACV,YAAY;AAAA,IACZ,eAAe;AAAA,EACjB;AACF,GC3CM4D,SAAO,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQb,SAAS,UAAUhF,QAAkC;AAC1D,QAAM,EAAC,OAAO,SAAS,UAAU,UAAU,WAAU,IAAIA,QACnD,MAAM,oBAAoB,KAAK,GAC/B,kBAAkB,WAAW,WAC7B0N,oBAAmB;AAAA,IACvB,CAAC,0BAEI,oBAAA1I,QAAA,EAAK,IAAI,KAAK,aAAW,OACvB,UAAA,sBAAsB,SACzB,CAAA;AAAA,IAGJ,CAAC,KAAK,KAAK;AAAA,EAAA;AAEb,SAAO,QAAQ,MAAM;AACnB,UAAM,iBAAiB;AAAA,MACrB;AAAA,MACA,eAAe0I;AAAA,MACf;AAAA,MACA;AAAA,MACA,OAAO,WAAW;AAAA,MAClB;AAAA,IAAA;AAEK,WAAA,kBACJ,oBAAA,iBAAA,EAAiB,GAAG,gBAAiB,SAAS,CAAA,IAE9C,oBAAAA,mBAAA,EAAkB,GAAG,gBAAiB,SAAS,CAAA;AAAA,EAAA,GAEjD,CAAC,iBAAiBA,mBAAkB,UAAU,SAAS,YAAY,UAAU,KAAK,CAAC;AACxF;AC5CO,SAAS,eAAe,OAAuB;AACpD,SAAO,cAAc,KAAK;AAC5B;ACCO,MAAM,8BAA8B,OAAO,IAAI,CAAC,EAAC,YAAW;AACjE,QAAM,EAAC,QAAQ,OAAO,MAAA,IAAS,MAAM,QAC/B,KAAK,KAAK,MAAM,KAAK,QAAQ,GAAG;AAE/B,SAAA;AAAA;AAAA,qBAEY,OAAO,CAAC,CAAC;AAAA,YAClB,MAAM,CAAC,CAAC;AAAA,eACL,MAAM,CAAC,IAAI,MAAM,CAAC,CAAC;AAAA,YACtB,MAAM,CAAC,IAAI,MAAM,CAAC,CAAC;AAAA;AAAA,wBAEP,EAAE;AAAA;AAE1B,CAAC,GCZY,4CAA4C,OAAO,eAAe,EAAE,MACxE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQR;ACPM,SAAS,qBAAqB,SAIlB;AACjB,QAAM,EAAC,mBAAmB,OAAO,SAAA,IAAY;AAEzC,MAAA;AAEJ,SAAO,CAAC,eAA8D;AACzD,eAAA,MAAM,QAAQ,UAAU,IAAI,aAAa,CAAC,UAAU,GAC/D,WAAW,SAAS;AAAA,MAAI,CAAC,QACvB,eAAe,KAAK;AAAA,QAClB;AAAA,MAAA,CACD;AAAA,IAAA;AAGH,UAAM,UAAU,CAAC,OAAO,UAAU,SAAS,CAAC,EAAC,MAAM,MAAM,KAAK,CAAA,CAAC,CAAC;AAEhE,WAAO,SAAS,WAAW,KAAK,OAAO,CAAC;AAAA,EAAA;AAE5C;ACrBO,SAAS,kBAAkB,SAIlB;AACd,QAAM,EAAC,mBAAmB,OAAO,SAAA,IAAY;AAE7C,SAAO,CAAC,eAAwC;AAC9C,UAAM,UAAU;AAAA,MACd;AAAA,QACE,eAAe,YAAY;AAAA,UACzB;AAAA,QAAA,CACD;AAAA,QAED,CAAC,EAAC,MAAM,MAAM,MAAK;AAAA,MACrB;AAAA,IAAA;AAGF,WAAO,SAAS,WAAW,KAAK,OAAO,CAAC;AAAA,EAAA;AAE5C;ACrBO,SAAS,oBAAoB,SAGlB;AACV,QAAA,EAAC,OAAO,SAAY,IAAA;AAE1B,SAAO,MAAY;AACX,UAAA,UAAU,CAAC,MAAM,CAAC,EAAC,MAAM,MAAM,MAAK,CAAC,CAAC;AAE5C,WAAO,SAAS,WAAW,KAAK,OAAO,CAAC;AAAA,EAAA;AAE5C;ACEA,MAAM1I,SAAO,OAAO;AAAA;AAAA;AAAA;AAKb,SAAS,aAAahF,QAA0B;AAC/C,QAAAwH,UAAS,yBACT,EAAC,OAAO,UAAU,mBAAA,IAAsBxH,QACxC,kBAAkB,QAAQ,MAAMwH,QAAO,YAAY,WAAW,IAAI,CAAC,MAAM,EAAE,KAAK,GAAG,CAACA,OAAM,CAAC,GAE3F,eAAe,QAAQ,MAAM;AACjC,QAAI,oBAAoB;AACtB,YAAM,mBAA4C;AAAA,QAChD;AAAA,QACA,OAAO,mBAAmB,SAASA,OAAM;AAAA,QACzC,KAAK,kBAAkB,EAAC,mBAAmB,iBAAiB,OAAO,UAAS;AAAA,QAC5E,OAAO,oBAAoB,EAAC,OAAO,UAAS;AAAA,QAC5C,QAAQ,qBAAqB,EAAC,mBAAmB,iBAAiB,OAAO,UAAS;AAAA,MAAA;AAEpF,aAAO,mBAAmB,gBAAgB;AAAA,IAC5C;AAAA,EAAA,GAEC,CAAC,oBAAoB,OAAOA,SAAQ,UAAU,eAAe,CAAC;AAIjE,SAAK,eAEG,oBAAAxC,QAAA,EAAK,iBAAiB,IAAQ,wBAAa,IAFzB;AAG5B;ACjCA,SAAS,eAAehF,QAA6C;AAC7D,QAAA,EAAC,OAAM,IAAIA,QACX,EAAC,OAAO,MAAM,QAAQ,MAAA,IAAS,YAAYA,OAAM,KAAK,GAEtD,eAAe,qBAAqB,SAAS,KAAK,oBAAoB,MAAM,GAC5E,eAAe,qBAAqB,SAAS,KAAK,oBAAoB,MAAM;AAE3E,SAAA;AAAA;AAAA;AAAA,sBAGa,MAAM,QAAQ,WAAW,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAW3C,MAAM,CAAC,CAAC;AAAA,iBACL,MAAM,CAAC,CAAC;AAAA,eACV,MAAM,CAAC,CAAC;AAAA,gBACP,MAAM,CAAC,CAAC;AAAA,uBACD,OAAO,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAOL,MAAM,QAAQ,KAAK,OAAO,GAAG,EAAE,MAAM,KAAK,OAAO,EAAE,EAAE,GAAG;AAAA;AAAA;AAAA;AAAA,6BAItD,MAAM,OAAO,MAAM,QAAQ,QAAQ,MAAM;AAAA,2BAC3C,MAAM,OAAO,MAAM,QAAQ,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,6BAInC,MAAM,OAAO,MAAM,SAAS,QAAQ,MAAM;AAAA,2BAC5C,MAAM,OAAO,MAAM,SAAS,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAetC,eAAe,MAAM,CAAC;AAAA,2BACtB,eAAe,MAAM,CAAC,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAU5C,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAUb,KAAK,KAAK,MAAM;AAAA;AAAA;AAAA;AAAA,4BAIT2N,OAAK,MAAM,WAAW,GAAG,CAAC;AAAA;AAAA;AAAA;AAItD;AAEO,MAAM,WAAW,OAAO,IAAyB,cAAc,GAKzD,uBAAuB,OAAO,GAAG;AAAA;AAAA;AAAA,GAKjC,oBAAoB,OAAO;AAAA;AAAA;AAAA,GAK3B,uBAAuB,OAAO,GAAG;AAAA;AAAA,GAIjCC,sBAAoB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA,GAM9BC,sBAAoB,OAAO,IAAI,EAAE,CAAC,EAAC,YAA2B;AACzE,QAAM,EAAC,OAAO,UAAS,MAAM,QACvB,YAAY,MAAM,KAAK,MAAM,CAAC,GAC9B,YAAY,MAAM,KAAK,MAAM,CAAC,GAC9B,aAAa,UAAU,aAAa,UAAU,iBAAiB,UAAU,iBACzE,aAAa,UAAU,aAAa,UAAU,iBAAiB,UAAU,iBAOzE,cAAc,KANC,aAAa,MAAM,CAAC,IAAI,MAAM,CAAC,IAMZ,cAAc;AAE/C,SAAA;AAAA;AAAA;AAAA;AAAA,WAIE,WAAW;AAAA;AAEtB,CAAC,GAEYxG,eAAa,OAAO,GAAG;AAAA;AAAA,GAIvB,WAAW,OAAO,IAAI;AAAA;AAAA,kBAEjB,CAAC,EAAC,aAAa,SAAS,SAAS,KAAK,CAAE;AAAA,GAG7CyG,2BAAyB,OAAO;AAAA,EAC3C,CAAC,EAAC,OAAO,kBAAuD;AACxD,UAAA,EAAC,MAAK,IAAI,MAAM;AAEf,WAAA;AAAA;AAAA,eAEI,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,sBAID,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA,QAGtB,CAAC,eACH;AAAA;AAAA,OAEC;AAAA;AAAA,EAEL;AACF,GCvKa,gBAAgB,OAAO;AAAA;AAAA,GAOvB,SAAS,CAAC,EAAC,UAAU,GAAG,KAAI,MACtC,oBAAAnM,QAAA,EAAK,eAAY,sBAAsB,GAAG,MACzC,UAAA,oBAAC,iBAAe,SAAS,CAAA,EAC3B,CAAA,GAMW,WAAW,CAAC,EAAC,UAAU,GAAG,KACrC,MAAA,oBAAC,SAAQ,EAAA,IAAG,MAAK,eAAY,kBAAiB,MAAM,GAAI,GAAG,MACzD,UAAA,oBAAC,eAAe,EAAA,SAAS,CAAA,EAC3B,CAAA,GAMW,WAAW,CAAC,EAAC,UAAU,GAAG,+BACpC,SAAQ,EAAA,IAAG,MAAK,eAAY,kBAAiB,MAAM,GAAI,GAAG,MACzD,UAAC,oBAAA,eAAA,EAAe,SAAS,CAAA,EAAA,CAC3B,GAMW,WAAW,CAAC,EAAC,UAAU,GAAG,KAAI,MACxC,oBAAA,SAAA,EAAQ,IAAG,MAAK,eAAY,kBAAiB,MAAM,GAAI,GAAG,MACzD,UAAA,oBAAC,iBAAe,SAAS,CAAA,EAC3B,CAAA,GAMW,WAAW,CAAC,EAAC,UAAU,GAAG,WACpC,oBAAA,SAAA,EAAQ,IAAG,MAAK,eAAY,kBAAiB,MAAM,GAAI,GAAG,MACzD,UAAA,oBAAC,eAAe,EAAA,SAAS,CAAA,EAC3B,CAAA,GAMW,WAAW,CAAC,EAAC,UAAU,GAAG,KAAA,MACrC,oBAAC,SAAQ,EAAA,IAAG,MAAK,eAAY,kBAAiB,MAAM,GAAI,GAAG,MACzD,8BAAC,eAAe,EAAA,SAAA,CAAS,EAC3B,CAAA,GAMW,WAAW,CAAC,EAAC,UAAU,GAAG,KAAI,MACxC,oBAAA,SAAA,EAAQ,IAAG,MAAK,eAAY,kBAAiB,MAAM,GAAI,GAAG,MACzD,UAAC,oBAAA,eAAA,EAAe,UAAS,EAC3B,CAAA,GAGI,iBAAiB,OAAO;AAAA;AAAA;AAAA;AAAA,kBAIZ,CAAC,EAAC,YAAW,MAAM,OAAO,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAgBvC,aAAa,CAAC,EAAC,UAAU,GAAG,KAAI,0BAC1C,gBAAe,EAAA,eAAY,0BAA0B,GAAI,MACxD,8BAACA,QAAK,EAAA,IAAG,KAAK,SAAS,CAAA,GACzB,GAMW,cAA6D;AAAA,EACxE,QAAQ;AAAA,EACR,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,IAAI;AAAA,EACJ,YAAY;AACd;ACzCO,SAAS,UAAU3B,QAAuB;AACzC,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QACE,EAAC,QAAW,IAAA,eAAA,EAAiB,WAAW,YACxC,CAAC,sBAAsB,uBAAuB,IAAI,SAAkB,EAAK,GACzE,UAAU,uBAAuB,IAAI,GACrC,aAAa,0BAA0B0C,eAAa,IAAI,CAAC,GACzD8E,UAAS,sBAAsB,GAC/B,EAAC,SAAQ,IAAI,iBAEb,GAAA,WAAW,iBAAiB,MAAM,EAAI,GAGtC,eAAe,QAAQ,MACpB,SAAS;AAAA,IACd,CAAC,MACC5H,UAAQ,EAAE,MAAM,IAAI,KACnB,EAAE,KAAK,MAAM,EAAE,EAAE,CAAC,MAAM,cAAc,EAAE,KAAK,SAAS,KAAK,WAAW;AAAA,EAAA,GAE1E,CAAC,MAAM,QAAQ,CAAC,GAEb,kCAAkC,YAAY,MAAM,wBAAwB,EAAI,GAAG,CAAA,CAAE,GACrF,kCAAkC,YAAY,MAAM,wBAAwB,EAAK,GAAG,CAAA,CAAE,GAEtF,EAAC,YAAAuF,aAAY,UAAU,YAAY,QAAA,IAAW,oBAAoB,cAAA,OAAA,SAAA,WAAY,IAAI,GAElF,aAAa,CAAA,CAAQ,uBAAwB,QAAQ,SAAS,GAE9D,iBAAiB,YAAY,cAAc,cAAc,SAEzD,SAAS,YAAY,MAAM;AAC3B,kBACF,WAAW,WAAW,KAAK,IAAI;AAAA,EAAA,GAEhC,CAAC,YAAY,UAAU,CAAC,GAErB,WAAW,YAAY,MAAM;AAC3B,UAAA,QAAQ,EAAC,MAAM,KAAK,MAAM,EAAE,GAAG,QAAQ,EAAC,GACxC,MAAuB;AAAA,MAC3B,OAAO;AAAA,MACP,QAAQ;AAAA,IAAA;AAES,uBAAA,OAAOqC,SAAQ,KAAK,EAAC,MAAM,UAAS,GACvD,mBAAmB,MAAMA,OAAM;AAAA,EAAA,GAC9B,CAAC,MAAMA,OAAM,CAAC,GAEX,OAAO,QAAQ,2BAEhB,UAAS,EAAA,OAAM,cAAa,QAAQ,+BAAO,OACzC,UAAA;AAAA,IAAA,MAAM,YACL,oBAAC,mBAAkB,EAAA,iBAAiB,IAClC,UAAA,oBAAC7F,QAAK,EAAA,oBAAiB,IACrB,UAAA,oBAAC,eAAc,CAAA,CAAA,EACjB,CAAA,GACF;AAAA,wBAED,OAAI,EAAA,aAAU,IAAG,OAAO,QACtB,UACH;AAAA,EACF,EAAA,CAAA,GAED,CAAC,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,GAEpC,oBAA4C,QAAQ,MACpD,gBAAgB,CAAC,qBACZ,EAAC,UAAU,EAAC,IAGjB,gBAAgB,qBACX,EAAC,aAAa,GAAG,cAAc,EAAC,IAGrC,qBACK;AAAA,IACL,aAAa;AAAA,IACb,cAAc;AAAA,EAAA,IAIX,EAAC,UAAU,EACjB,GAAA,CAAC,cAAc,kBAAkB,CAAC,GAE/B,oBAA4C,QAAQ,MACpD,MAAM,WACD,EAAC,UAAU,EAGb,IAAA,mBAAmB,MAAM,SAAS,QAAQ,KAAK,EAAC,UAAU,EAAC,GACjE,CAAC,KAAK,CAAC,GAEJ,SAAS,CAAA,EAAQ,iCAAY,OAAO,OACpC,mBAAmB6F,QAAO,YAAY,cAEtC,iBAA6B;AAAA,IACjC,MAAG;AA/LP,UAAA7G;AA+LW,aAAA;AAAA,QACL,6BAA6B;AAAA,QAC7B,8BAA8B;AAAA,QAC9B,+BAA8BA,MAAA,cAAA,OAAA,SAAA,WAAY,eAAZ,OAAA,SAAAA,IAAwB,YAAW;AAAA,QACjE,UAAU;AAAA,QACV;AAAA,QACA;AAAA,QACA,SAAS;AAAA,QACT;AAAA,QACA;AAAA,QACA;AAAA,QACA,MAAM;AAAA,QACN;AAAA,QACA,OAAM,cAAY,OAAA,SAAA,WAAA,KAAK,SAAQL;AAAAA,QAC/B,UAAU;AAAA,QACV,UAAU,CAAQ,CAAA;AAAA,QAClB;AAAA,QACA;AAAA,QACA,eAAeoN;AAAAA,QACf;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,YAAAvI;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,IACA;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,cAAY,OAAA,SAAA,WAAA;AAAA,MACZ,yCAAY,KAAK;AAAA,MACjB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACAA;AAAA,MACA;AAAA,IACF;AAAA,KAGI,iBAAiB;AAAA,IACrB,MACG,kBACC,oBAACkC,cACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA;AAAA,QACA,YAAAlC;AAAA,MAAA;AAAA,OAEJ,KAEF;AAAA,IACF,CAAC,SAAS,SAAS,qBAAqB,gBAAgBA,WAAU;AAAA,EAAA;AAG7D,SAAA;AAAA,IACL,MACE;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,eAAY;AAAA,QACX,GAAG;AAAA,QACJ,OAAO;AAAA,QACP,KAAK,cAAY,OAAA,SAAA,WAAA;AAAA,QAEjB,UAAA,oBAAC,wBAAqB,eAAY,uBAChC,+BAAC,MAAK,EAAA,MAAM,GAAI,GAAG,mBACjB,UAAA;AAAA,UAAC,oBAAA,KAAA,EAAI,MAAM,GACT,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,SAAS;AAAA,cACT,UAAU,CAAC;AAAA,cACX,WAAU;AAAA,cACV,QAAO;AAAA,cAEP,UAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,QAAQ,MAAM,SAAS;AAAA,kBACvB,cAAY,WAAW,KAAK;AAAA,kBAC5B,kBAAgB,MAAM;AAAA,kBACtB,gBAAc,aAAa,KAAK;AAAA,kBAChC,kBAAgB;AAAA,kBAChB,eAAY;AAAA,kBACZ,gBAAc,aAAa,KAAK;AAAA,kBAChC;AAAA,kBAEC,UAAA,eAAe,YAAY,cAAc;AAAA,gBAAA;AAAA,cAC5C;AAAA,YAAA;AAAA,UAAA,GAEJ;AAAA,UAEA,qBAAC,sBAAqB,EAAA,iBAAiB,IACrC,UAAA;AAAA,YAAC,oBAAAyI,qBAAA,EAAkB,aAAa,GAC9B,UAAA,oBAACC,uBACE,UAAsB,sBAAA,WAAW,CAAC,YACjC;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC;AAAA,gBACA,OAAO;AAAA,gBACP;AAAA,cAAA;AAAA,eAGN,EACF,CAAA;AAAA,YAEC,gBAAgB,cACf;AAAA,cAACC;AAAAA,cAAA;AAAA,gBACC,aAAa,WAAW,OAAO,KAAK;AAAA,gBACpC,cAAc;AAAA,gBACd,cAAc;AAAA,gBAEd,UAAA;AAAA,kBAAC;AAAA,kBAAA;AAAA,oBACC,UAAU;AAAA,oBACV,WAAW,WAAW,OAAO,KAAK;AAAA,oBAClC,MAAM,WAAW,OAAO,KAAK;AAAA,oBAC7B,iBAAiB;AAAA,kBAAA;AAAA,gBACnB;AAAA,cAAA;AAAA,YACF;AAAA,UAAA,GAEJ;AAAA,UACC,4CAAyB,6BAA4B,EAAA;AAAA,QAAA,EAAA,CACxD,EACF,CAAA;AAAA,MAAA;AAAA,IACF;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAEJ;AAEO,MAAMJ,qBAAmB,CAAC1N,WACxB,oBAAA,UAAA,EAAG,iBAAM,UAAS,GC3VdgF,SAAO,OAAO,IAAI;AAAA,YACnB,CAAC,EAAC,YAAA,MAAkB,cAAc,SAAS,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GASjD,cAAc,OAAO,IAAI;AAAA;AAAA;AAAA,GAKzB,eAAe,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAwB1B,WAAW,OAAO,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAajC,oBAAoB,OAAO+I,WAAS;AAAA;AAAA;AAAA,GAKpC,kBAAkB,OAAO,IAAI;AAAA;AAAA;AAAA,mBAGvB,YAAY,IAAI,CAAC,MAAM,eAAe,CAAC,CAAC,EAAE,KAAK,GAAG,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAahE,YAAY,IAAI,CAAC,MACV;AAAA,8DACiD,CAAC;AAAA,+BAChC,eAAe,CAAC,CAAC;AAAA;AAAA,OAG3C,CAAC;AAAA;AAAA;AAAA;AAAA,oBAIc,CAAC,EAAC,YAAW,MAAM,OAAO,MAAM,CAAC,CAAC;AAAA,uBAC/B,YAAY,IAAI,CAAC,MAAM,eAAe,CAAC,CAAC,EAAE,KAAK,GAAG,CAAC;AAAA;AAAA;AAAA;AAAA,oBAItD,CAAC,EAAC,YAAW,MAAM,OAAO,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,uBAK/B,YAAY,IAAI,CAAC,MAAM,eAAe,CAAC,CAAC,EAAE,KAAK,GAAG,CAAC;AAAA;AAAA;AAAA,MAGpE,YAAY,MAAM,CAAC,EAAE,IAAI,CAAC,MACnB;AAAA,kCACqB,CAAC,0BAA0B,IAAI,CAAC;AAAA,2BACvC,eAAe,CAAC,CAAC;AAAA;AAAA,OAGvC,CAAC;AAAA;AAAA;AAAA,oBAGc,CAAC,EAAC,YAAW,MAAM,OAAO,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,qBAIjC,CAAC,EAAC,eAAe,MAAK,MAAM,MAAM,OAAO,MAAM,gBAAgB,IAAI,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,wBAIlE,CAAC,EAAC,eAAe,MAAK,MAAM,MAAM,OAAO,MAAM,gBAAgB,IAAI,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAYtE,CAAC/N,WAAU,YAAYA,OAAM,KAAK,EAAE,OAAO,CAAC,CAAC;AAAA;AAAA;AAAA,UAG1D,CAAC,EAAC,eAAe,YACf,gBAAgB,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,IAAI,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,CAAC;AAAA;AAAA;AAAA,UAGzE,CAAC,EAAC,eAAe,YACf,gBAAgB,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,IAAI,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,YAIvE,CAAC,EAAC,eAAe,YACjB,gBAAgB,IAAI,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AC9IpF,SAAS,2BAA2B,eAAmC;AACrE,SAAA;AAAA,IACL,MACE,CAACwH,SAA4B,aAA0B;AACnC,UAAA,mBAAmB,aAAaA,OAAM,GACzC;AACP,cAAA,SAAS,SAAS,eAAe;AACvC,YAAI,CAAC;AACH;AAEF,uBAAe,QAAQ;AAAA,UACrB,YAAY;AAAA,UACZ,UAAU;AAAA,UACV,OAAO;AAAA,UACP,QAAQ;AAAA,QAAA,CACT;AAAA,MACH;AAAA,IACF;AAAA,IACF,CAAC,aAAa;AAAA,EAAA;AAElB;ACtBO,SAAS,gBAAyB;AACvC,QAAMA,UAAS;AACf,SAAO,QAAQ,MAAM;AALvB,QAAA7G;AASI,UAAM,oBAAmBA,MAAA6G,QAAO,YAAY,MAAM,YAAzB,OAAkC,SAAA7G,IAAA,YACrD,aACJ,OAAO,YAAc,MAAc,KAAQ,aAAa,KAAK,UAAU,SAAS;AAClF,WAAO,qBAAqB,UAAa,eAAe,KAAO,KAAQ;AAAA,EAAA,GACtE,CAAC6G,OAAM,CAAC;AACb;ACTA,MAAM,mBAAmB,CAAC,WACjB,oBAAA,UAAA,EAAG,iBAAO,SAAS,CAAA,GAGfmC,aAAW,CAAC3J,WAAoC;AAC3D,QAAM,EAAC,OAAO,UAAU,YAAY,UAAU,SAAS,OAAO,MAAK,IAAIA,QACjE,EAAC,OAAO,WAAW,oBAAmB;AAC5C,SAAO,QAAQ,MAAM;AACnB,UAAM,iBAAiB;AAAA,MACrB;AAAA,MACA;AAAA,MACA;AAAA,MACA,eAAe;AAAA,MACf;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAEK,WAAA,kBACJ,oBAAA,iBAAA,EAAiB,GAAG,gBAAiB,SAAS,CAAA,IAE9C,oBAAA,kBAAA,EAAkB,GAAG,gBAAiB,SAAS,CAAA;AAAA,EAEpD,GAAG,CAAC,iBAAiB,OAAO,UAAU,SAAS,OAAO,YAAY,UAAU,OAAO,KAAK,CAAC;AAC3F,GCvBa,QAAQ,CAACA,WAAiC;AAC/C,QAAA,EAAC,OAAO,SAAS,UAAU,UAAU,WAAU,IAAIA,QACnD,+BAA+B;AAAA,IACnC,OACG,MAAM,SAAS,YAAY,MAAM,KAAK,IAAI,YAAY,MAAM,KAAK,IAAI,YAAY,CAAC,MACnFgO;AAAAA,IACF,CAAC,MAAM,KAAK;AAAA,KAGRN,oBAAmB;AAAA,IACvB,CAAC,0BAEI,oBAAA,8BAAA,EACC,UAAC,oBAAA,eAAA,EAAc,eAAa,eAAe,MAAM,KAAK,IACnD,UAAA,sBAAsB,SACzB,CAAA,GACF;AAAA,IAGJ,CAAC,8BAA8B,MAAM,KAAK;AAAA,EAAA;AAG5C,SAAO,QAAQ,MAAM;AACb,UAAA,kBAAkB,WAAW,WAC7B,EAAC,OAAO,MAAK,IAAI,YACjB,iBAAiB;AAAA,MACrB;AAAA,MACA;AAAA,MACA,eAAeA;AAAA,MACf;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAEK,WAAA,kBACJ,oBAAA,iBAAA,EAAiB,GAAG,gBAAiB,SAAS,CAAA,IAE9C,oBAAAA,mBAAA,EAAkB,GAAG,gBAAiB,SAAS,CAAA;AAAA,EAAA,GAEjD,CAACA,mBAAkB,OAAO,UAAU,SAAS,YAAY,QAAQ,CAAC;AACvE,GC5CM,aAAa,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAanB,SAAS,oBAAoB1N,QAAiC;AACnE,QAAM,EAAC,QAAQ,GAAG,KAAA,IAAQA;AAGxB,SAAA,oBAAC,cAAW,WAAQ,uBAAsB,eAAa,SAAS,KAAK,QAAY,GAAG,KAAM,CAAA;AAE9F;ACfA,MAAM,4BAAwD;AAAA,EAC5D,QAAQ;AAAA,EACR,eAAe;AACjB,GAEa,uBAAuB,WAAW,SAC7CA,QAIA,cACA;AACA,QAAM,EAAC,4BAA4B,YAAY,iBAAiB,aAAa,YAAe,IAAAA;AAG1F,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,uCAAuC;AAAA,MACvC,IAAG;AAAA,MACH,KAAK;AAAA,MACL,SAAS;AAAA,MACT,SAAS;AAAA,MACR,GAAG;AAAA,MACJ,QAAQ;AAAA,MACR,MACG,oBAAA,MAAA,EACE,sBAAY,IAAI,CAAC,GAAG,UAAU;AACvB,cAAA;AAAA;AAAA,UAEJ,iBAAiB,CAAC;AAAA;AAAA,UAElB,gBAAgB,CAAC;AAAA;AAAA,UAEjB,eAAe,CAAC;AAAA;AAAA,UAEhB;AAAA;AAAA,UAEA;AAAA;AAAA,UAEA;AAAA;AAAA,UAEA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,GAAG;AAAA,QAAA,IACD,EAAE;AAEN,oCACGuB,YACE,EAAA,UAAA;AAAA,UAAiB,iBAAA,UAAU,KAAK,oBAAC,aAAY,CAAA,CAAA;AAAA,8BAC7C,UAAS,EAAA,MAAY,MAAY,SAAS,UAAW,GAAG,MAAM;AAAA,QAAA,KAFlD,EAAE,GAGjB;AAAA,MAEH,CAAA,GACH;AAAA,IAAA;AAAA,EAAA;AAIR,CAAC;ACvDM,SAAS,eAAevB,QAA4B;AACzD,QAAM,EAAC,sBAAsB,UAAU,SAAS,GAAG,KAAQ,IAAAA,QACrD,CAAC,IAAI,KAAK,IAAI,SAAgC,IAAI;AAExD,SAAA,UAAU,MAAM;AACd,QAAI,CAAC;AAAI;AAET,UAAM,KAAK,IAAI,qBAAqB,sBAAsB,OAAO;AAC9D,WAAA,GAAA,QAAQ,EAAE,GAEN,MAAM;AACX,SAAG,UAAU,EAAE,GACf,GAAG,WAAW;AAAA,IAAA;AAAA,EAEf,GAAA,CAAC,IAAI,sBAAsB,OAAO,CAAC,GAGpC,oBAAC,MAAK,EAAA,KAAK,OAAQ,GAAG,MACnB,SACH,CAAA;AAEJ;ACOA,MAAM,qBAAqB,GAErB,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAWf,YAAY,OAAO,IAAI;AAAA,aAChB,kBAAkB;AAAA,aAClB,kBAAkB;AAAA;AAAA,GAIzBkM,aAAW,OAAO,IAAI;AAAA;AAAA;AAAA,GAKtB,UAAU,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAUrB+B,yBAAuB,OAAO,cAAc;AAAA,IAC9C,YAAY;AAAA;AAGhB,SAASC,kBAAgB,MAAqC;AAC5D,SAAO,CAAQ,CAAA;AACjB;AAWO,MAAM,eAAe,WAAW,SACrClO,QACA,KACA;AACM,QAAA,EAAC,UAAU,WAAW,4BAA4B,aAAa,iBAAiB,GAAG,KAAA,IACvFA,QAEI,cAAc,QAAQ,MAAM,SAAS,QAAQ,QAAQ,EAAE,OAAOkO,iBAAe,GAAG,CAAC,QAAQ,CAAC,GAC1F,aAAa;AAAA,IACjB,OAAM,mBAAA,OAAA,SAAA,gBAAiB,WAAU,oBAAC,mBAAkB,EAAA;AAAA,IACpD,CAAC,eAAe;AAAA,EAAA;AAGlB,SAAI,YAGA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA,IAKJ;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA;AAGN,CAAC,GAGY,mBAAmB,WAAW,SACzClO,QACA,KACA;AACM,QAAA;AAAA,IACJ,eAAe;AAAA,IACf;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EAAA,IACDA,QAEE,CAAC,QAAQ,SAAS,IAAI,SAAgC,IAAI,GAG1D,CAAC,uBAAuB,wBAAwB,IAAI,SAA+B,CAAE,CAAA,GAGrF,CAAC,wBAAwB,yBAAyB,IAAI,SAA+B,CAAA,CAAE,GAEvF,sBAAsB;AAAA,IAC1B,OAAO;AAAA,MACL,MAAM;AAAA;AAAA,MAEN,WAAW;AAAA,MACX,YAAY;AAAA,IAAA;AAAA,IAEd,CAAC,MAAM;AAAA,EAIH,GAAA,iBAAiB,QAAQ,MAAM,YAAY,IAAI,CAAC,UAAU,MAAM,GAAG,GAAG,CAAC,WAAW,CAAC,GAGnF,uBAAuB;AAAA,IAC3B,MAAM;AAAA,MACJ,GAAG,WAAW,gBAAgB,OAAO,KAAK,qBAAqB,CAAC;AAAA,MAChE,GAAG,WAAW,gBAAgB,OAAO,KAAK,sBAAsB,CAAC;AAAA,IACnE;AAAA,IACA,CAAC,gBAAgB,uBAAuB,sBAAsB;AAAA,KAI1D,8BAA8B;AAAA,IAClC,MACE,YAAY,OAAO,CAAC,kBAAkB;AAC9B,YAAA,QAAQ,sBAAsB,cAAc,GAAa;AACxD,aAAA,SAAS,CAAC,MAAM;AAAA,IAAA,CACxB;AAAA,IACH,CAAC,uBAAuB,WAAW;AAAA,KAG/B,6BAA6B;AAAA,IACjC,CAAC,GAA8B,YAA0B;AACvD,+BAAyB,CAAC,YAAY;AACpC,cAAM,MAAM,QAAQ;AACpB,YAAI,QAAQ;AACJ,gBAAA,IAAI,MAAM,yCAAyC;AAE3D,cAAM,YAAY;AAAA,UAChB,YAAY,EAAE;AAAA,UACd;AAAA,QAAA,GAGI,eAAe,QAAQ,GAAG;AAChC,eAAI,CAAC,gBAAgB,aAAa,eAAe,UAAU,aAClD;AAAA,UACL,GAAG;AAAA,UACH,CAAC,GAAG,GAAG;AAAA,QAGJ,IAAA;AAAA,MAAA,CACR;AAAA,IACH;AAAA,IACA,CAAC;AAAA,KAGG,8BAA8B;AAAA,IAClC,CAAC,GAA8B,YAA0B;AACvD,gCAA0B,CAAC,YAAY;AACrC,cAAM,MAAM,QAAQ;AACpB,YAAI,QAAQ;AACJ,gBAAA,IAAI,MAAM,+CAA+C;AAEjE,cAAM,6BAA6B,QAAQ,GAAG,GAExC,0BAA0B;AAAA,UAC9B,YAAY,EAAE;AAAA,UACd;AAAA,QAAA;AAEF,gBAAO,8BAA4B,OAAA,SAAA,2BAAA,gBAAe,wBAAwB,aACtE,UACA;AAAA,UACE,GAAG;AAAA,UACH,CAAC,GAAG,GAAG;AAAA,QAAA;AAAA,MACT,CACL;AAAA,IACH;AAAA,IACA,CAAC;AAAA,KAIG,oBAAoB;AAAA,IACxB,MACE,YAAY,IAAI,CAAC,kBAAkB;AAC3B,YAAA,EAAC,eAAc,IAAI,cAAc,OACjC,YAAY,gBACZ,OAAO,eAAe,SAAY,cAAc,MAAM;AAE5D,aAAO,aAAa,eAAe;AAAA,QACjC,GAAG;AAAA,QACH;AAAA,MAAA,CACD;AAAA,IAAA,CACF;AAAA,IACH,CAAC,aAAa,YAAY;AAAA,KAKtB,qCAAqC;AAAA,IACzC,MACE,YAAY,OAAO,CAAC,kBAAkB;AAC9B,YAAAwF,gBAAe,uBAAuB,cAAc,GAAa;AACvE,cAAOA,+CAAc,gBAAe;AAAA,IAAA,CACrC;AAAA,IACH,CAAC,aAAa,sBAAsB;AAAA,EAAA,GAIhC,qBADiB,4BAA4B,SAAS,IAExD,kBAAkB,OAAO,CAAC,kBAAkB;AACpC,UAAAA,gBAAe,uBAAuB,cAAc,GAAa;AACvE,YAAOA,+CAAc,gBAAe;AAAA,EAAA,CACrC,IACD,aAEE,aAAa;AAAA,IACjB,OAAM,mBAAA,OAAA,SAAA,gBAAiB,WAAU,oBAAC,mBAAkB,EAAA;AAAA,IACpD,CAAC,eAAe;AAAA,EAAA;AAIhB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,WAAQ;AAAA,MACR,UAAS;AAAA,MACT,QAAO;AAAA,MACP;AAAA,MACC,GAAG;AAAA,MAEJ,UAAA;AAAA,QAAC,qBAAA0G,YAAA,EAAS,WAAU,UAAS,MAAM,GAAG,SAAQ,UAAS,KAAK,WAE1D,UAAA;AAAA,UAAC,oBAAA,SAAA,EAAQ,KACN,UAAqB,qBAAA,WAAW,KAC/B,mBAAmB,IAAI,CAAC,eAAe,UAAU;AACzC,kBAAA,EAAC,eAAe,cAAc,IAAI,eAAe,OAAM,cAAc,OACrE,SACJ,CAAC,cAAc,OACf,EAAE,cAAc,OAAO,0BACvB,mCAAmC,SAAS,aAAa;AAC3D,wCACG3K,YACE,EAAA,UAAA;AAAA,cAAA,iBAAiB,UAAU,KAAM,oBAAA,qBAAA,EAAoB,QAAgB;AAAA,cACrE,oBAAA,SAAA,EAAQ,QAAM,IAAC,UAAU,CAAC,aAAa,SAAS,aAAc,GAAG,cAChE,UAAC,oBAAA,MAAA,EACE,uBAAa,eAAe;AAAA,gBAC3B,UAAU,cAAc,MAAM,YAAY;AAAA,gBAC1C,eAAe;AAAA,cAAA,CAChB,GACH,EACF,CAAA;AAAA,YAAA,KATa,cAAc,GAU7B;AAAA,UAEH,CAAA,GACL;AAAA,UAEA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA,UAAU;AAAA,cACV;AAAA,cACA,sBAAsB;AAAA,YAAA;AAAA,UACxB;AAAA,UAEA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA,UAAU;AAAA,cACV;AAAA,cACA,sBAAsB;AAAA,YAAA;AAAA,UACxB;AAAA,QAAA,GACF;AAAA,QAGC,mCAAmC,SAAS,KAC1C,oBAAA,MAAA,EAAK,YAAY,KAChB,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA;AAAA,YACA;AAAA,YACA,aAAa;AAAA,YACb;AAAA,UAAA;AAAA,QAAA,GAEJ;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAIR,CAAC,GAEK,eAAe,KAAK,SAAsBvB,QAK7C;AACD,QAAM,EAAC,UAAU,KAAK,qBAAqB,yBAAwBA;AACnE,SACG,oBAAA,SAAA,EAAQ,eAAW,IAAC,eAAY,QAAO,KAAU,UAAS,UACxD,UAAA,SAAS,IAAI,CAAC,SAAS,UAAU;AAC1B,UAAA,EAAC,cAAa,IAAI,QAAQ;AAChC,gCACGuB,YACE,EAAA,UAAA;AAAA,MAAA,iBAAiB,UAAU,KAAM,oBAAA,qBAAA,EAAoB,QAAM,IAAC;AAAA,MAE7D;AAAA,QAAC0M;AAAAA,QAAA;AAAA,UACC,SAAS;AAAA,UAET,sBAAsB,CAAC,MAAM,qBAAqB,EAAE,CAAC,GAAG,OAAO;AAAA,UAE/D,UAAA,oBAAC,MACE,EAAA,UAAA,aAAa,SAAS;AAAA,YACrB,UAAU;AAAA,YACV,eAAe;AAAA,UAChB,CAAA,GACH;AAAA,QAAA;AAAA,MACF;AAAA,IAAA,KAda,QAAQ,GAevB;AAAA,EAEH,CAAA,EACH,CAAA;AAEJ,CAAC,GCrVY,qBAAqB,WAAW,SAC3CjO,QACA,KACA;AACM,QAAA;AAAA;AAAA,IAEJ,iBAAiB,CAAC;AAAA;AAAA,IAElB,gBAAgB,CAAC;AAAA;AAAA,IAEjB,eAAe,CAAC;AAAA;AAAA,IAEhB;AAAA;AAAA,IAEA;AAAA;AAAA,IAEA,GAAG;AAAA,EACD,IAAAA;AAEJ,6BAAQ,QAAO,EAAA,WAAQ,sBAAsB,GAAG,MAAM,IAAU,CAAA;AAClE,CAAC,GCvCK,gBAAgB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWtB,SAAS,WAAWA,QAAc;AACvC,QAAM,EAAC,MAAM,OAAM,IAAIA,QAEjB,cAAc;AAAA,IAClB,OAAO;AAAA,MACL,iBAAiB,OAAO,IAAI;AAAA,MAC5B,QAAQ,SAAS,iBAAiB;AAAA,IAAA;AAAA,IAEpC,CAAC,QAAQ,IAAI;AAAA,EAAA;AAGR,SAAA,oBAAC,eAAc,EAAA,OAAO,YAAa,CAAA;AAC5C;ACDA,SAAS,oBACPwH,SACA,UACA,YACA3G,IACoB;AAEpB,SADc2G,QAAO,YACR,WAAW,IAAI,CAAC,cAAc;AACzC,UAAM,cAAc,OAAO,KAAK,WAAW,SAAS,CAAE,CAAA,EAAE;AAAA,MACtD,CAAC,QAAK;AAvCZ,YAAA7G;AAuC0B,iBAAAA,MAAA,WAAA,UAAX,OAAmB,SAAAA,IAAA,GAAA,OAAS,UAAU;AAAA,MAAA;AAAA,IAAA;AAGjD,QAAI,UAAoB,CAAA;AACxB,WAAI,gBACF,UAAU,CAAC,WAAW,IAGjB;AAAA,MACL,MAAM;AAAA,MACN;AAAA,MACA,MAAM,aAAW,OAAA,SAAA,UAAA;AAAA,MACjB,KAAK,UAAU;AAAA,MACf,QAAQ,MAAY;AAClB,2BAAmB,WAAW6G,SAAQ,UAAU,KAAK,GACrD,mBAAmB,MAAMA,OAAM;AAAA,MACjC;AAAA,MACA;AAAA,MACA,OAAO,UAAU,gBAAgB3G,KAAIA,GAAE,UAAU,YAAY,IAAI,UAAU;AAAA,IAAA;AAAA,EAC7E,CACD;AACH;AAEA,SAAS,kBACP2G,SACA,UACA3G,IACoB;AAEpB,SADc2G,QAAO,YACR,MAAM,IAAI,CAAC,cACf;AAAA,IACL,MAAM;AAAA,IACN,KAAK,SAAS;AAAA,IACd;AAAA,IACA,MAAM,YAAU,OAAA,SAAA,SAAA;AAAA,IAChB,QAAQ,MAAY;AACC,yBAAA,WAAWA,SAAQ,SAAS,KAAK;AAAA,IACtD;AAAA,IACA,OAAO,SAAS,gBAAgB3G,KAAIA,GAAE,SAAS,YAAY,IAAI,SAAS;AAAA,EAE3E,EAAA;AACH;AAEA,SAAS,kBAAkB,MAA4D;AACrF,SACE,IAAI,MAAM,MAAM,KAChB,IAAI,MAAM,WAAW,KACrB,IAAI,MAAM,cAAc,KACxB,IAAI,MAAM,iBAAiB;AAE/B;AAEA,SAAS,wBACP2G,SACA,UACA,UACA3G,IACoB;AACd,QAAA,QAAQ2G,QAAO,aACf,aAAa,mBAAmB,WAAWA,OAAM,GACjD,UAAU,cAAc,WAAW;AACzC,SAAO,MAAM,YAAY,IAAI,CAAC,WACrB;AAAA,IACL,MAAM;AAAA,IACN,UAAU,CAAC,WAAW;AAAA,IACtB,MAAM,kBAAkB,KAAK;AAAA,IAC7B,KAAK,MAAM;AAAA,IACX,QAAQ,CAAC,WAA2B;AAC9B,gBACF,mBAAmB,iBAAiBA,SAAQ,KAAK,GACjD,mBAAmB,MAAMA,OAAM,KAE/B,SAAS,KAAK;AAAA,IAElB;AAAA,IACA,OACE,MAAM,gBAAgB3G,KAAIA,GAAE,MAAM,YAAY,IAAI,MAAM,SAAS,WAAW,MAAM,IAAI;AAAA,EAE3F,EAAA;AACH;AAKO,SAAS,0BACd2G,SACA,UACA,oBACA,YACA3G,IACyB;AAClB,SAAA;AAAA,IACL,EAAC,MAAM,UAAU,SAAS,oBAAoB2G,SAAQ,UAAU,YAAY3G,EAAC,EAAC;AAAA,IAC9E,EAAC,MAAM,QAAQ,SAAS,kBAAkB2G,SAAQ,UAAU3G,EAAC,EAAC;AAAA,IAC9D,EAAC,MAAM,cAAc,SAAS,wBAAwB2G,SAAQ,UAAU,oBAAoB3G,EAAC,EAAC;AAAA,EAAA;AAElG;AAEO,SAAS,eAAe,OAAwD;AACrF,SAAO,MAAM,OAAO,IAAI,CAAC,WAChB;AAAA,IACL,KAAK,SAAS,MAAM,KAAK;AAAA,IACzB,OAAO,MAAM;AAAA,IACb,gBAAgB,SAAS,MAAM;AAAA,IAC/B,OAAO,MAAM;AAAA,IACb,cAAc,MAAM;AAAA,EAEvB,EAAA;AACH;AAEA,SAAS,kBAAkB,MAAwB,cAA4C;AACvF,QAAA,gBAAgB,IAAI,MAAM,YAAY;AAE5C,SAAO,KAAK,QAAS,KAAK,QAAQ,KAAK,KAAK,QAAS,iBAAiB;AACxE;AAEO,SAAS,mBACd,OACA,UACA,eACA,gBACa;AACP,QAAA,aAAa,MAAM,aAAa;AAAA,IACpC,CAAC,MAAM,WAAsB;AAAA,MAC3B,QAAQ,MAAM,cAAc,IAAI;AAAA,MAChC,MAAM,kBAAkB,MAAM,gBAAgB;AAAA,MAC9C,QAAQ;AAAA,MACR,KAAK,SAAS,KAAK;AAAA,MACnB;AAAA,IAAA;AAAA,EACF,GAGI,cAAc,MAAM,cAAc;AAAA,IACtC,CAAC,MAAM,WAAsB;AAAA,MAC3B,QAAQ,MAAM,eAAe,IAAI;AAAA,MACjC,MAAM,kBAAkB,MAAM,iBAAiB;AAAA,MAC/C,QAAQ;AAAA,MACR,KAAK,UAAU,KAAK;AAAA,MACpB;AAAA,IAAA;AAAA,EACF;AAMF,SAF2B,WAAW,OAAO,WAAW,EAAE,OAAO,CAAC,SAAM;AAtL1E,QAAAF;AAsL8E,WAAA,GAAAA,MAAA,KAAK,SAAL,QAAWA,IAAA;AAAA,EAAA,CAAM;AAG/F;AAEA,MAAM,kBAAiD;AAAA,EACrD,MAAM;AACR,GAEM,cAA6C;AAAA,EACjD,QAAQ;AAAA,EACR,IAAI;AAAA,EACJ,kBAAkB;AAAA,EAClB,WAAW;AAAA,EACX,MAAM;AACR,GAEM,iBAAgD;AAAA,EACpD,QAAQ;AAAA,EACR,QAAQ;AACV;AAEgB,SAAA,cAAc,QAA0B,QAAiB;AACvE,SAAI,OAAO,OACL,OAAO,OAAO,QAAS,WAClB,oBAAC,YAAW,EAAA,QAAgB,MAAM,OAAO,KAAA,CAAM,IAGjD,OAAO,OAGZ,OAAO,SAAS,eACX,gBAAgB,OAAO,GAAG,KAAK,cAGpC,OAAO,SAAS,cACX,eAAe,OAAO,GAAG,KAAK,cAGhC,YAAY,OAAO,GAAG,KAAK;AACpC;AC1MO,SAAS,gBAA+C;AAC7D,QAAM6G,UAAS,sBAAA,GACT,YAAY,+BAA+B;AAG1C,SAAA,QAAQ,MAAM,mBAAmB,WAAWA,OAAM,GAAG,CAACA,SAAQ,SAAS,CAAC;AACjF;AAUO,SAAS,gBAAgB;AAAA,EAC9B;AAAA,EACA;AAAA,EACA,qBAAA1B;AAAA,EACA;AACF,GAK4B;AACpB,QAAA0B,UAAS,yBACT,EAAC,GAAA3G,OAAK,eAAA,GAEN,yBAAyB;AAAA,IAC7B,OAAO,eAAiC;AAChC,YAAA,eAAe,MAAMiF,qBAAoB,UAAU,GACnD,QAAQ,mBAAmB,cAAc0B,SAAQ,YAAY,YAAY;AAC3E,eAAS,MAAM,eACjB,aAAa,MAAM,WAAW;AAAA,IAElC;AAAA,IACA,CAACA,SAAQ,cAAc1B,oBAAmB;AAAA,EAAA;AAGrC,SAAA;AAAA,IACL,MACE0B,UAAS,0BAA0BA,SAAQ,UAAU,wBAAwB,SAAS3G,EAAC,IAAI,CAAC;AAAA,IAC9F,CAAC,UAAU2G,SAAQ,wBAAwB,SAAS3G,EAAC;AAAA,EAAA;AAEzD;AAEO,SAAS,oBAAoB;AAAA,EAClC;AACF,GAEa;AACX,QAAM2G,UAAS,sBAAA,GACT,YAAY,+BAA+B;AAE1C,SAAA;AAAA,IACL;AAAA,MACE,MAAM;AACJ,cAAM,uBAAuB,mBAAmB,kBAAkBA,OAAM,EAAE;AAAA,UACxE,CAAC,MAAM,EAAE;AAAA,QAAA;AAGX,eAAO,QACJ,OAAO,CAAC,MACH,EAAE,SAAS,eACN,qBAAqB,SAAS,EAAE,GAAG,IAGxC,EAAE,SAAS,cACN,mBAAmB,aAAaA,SAAQ,EAAE,GAAG,IAG/C,mBAAmB,aAAaA,SAAQ,EAAE,GAAG,CACrD,EACA,IAAI,CAAC,MAAM,EAAE,GAAG;AAAA,MACrB;AAAA;AAAA,MAEA;AAAA,QACEA;AAAA;AAAA,QAEA;AAAA,MACF;AAAA,IACF;AAAA,EAAA;AAEJ;AAEgB,SAAA,mBAAmB,EAAC,SAA6C;AAC/E,QAAMA,UAAS,yBACT,aAAa,iBACb,YAAY;AAEX,SAAA;AAAA,IACL;AAAA,MACE,MACE,MAAM,OAAO,CAAC,MAAM,mBAAmB,cAAcA,SAAQ,EAAE,KAAK,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK;AAAA;AAAA,MAE3F;AAAA,QACE;AAAA;AAAA,QAEA;AAAA,MACF;AAAA,IACF;AAAA,EAAA;AAEJ;AC5GA,MAAM2G,qBAAmB,KAAK,YAAY,GAEpCzF,uBAAmC,EAAC,eAAe,IAAM,QAAQ,MAS1D,aAAa,KAAK,SAAoB1I,QAAwB;AACnE,QAAA,EAAC,UAAU,cAAc,QAAQ,cAAc,UAAS,IAAIA,QAC5D,aAAa,iBAEbwH,UAAS,yBACT,YAAY,kCACZ,EAAC,GAAA3G,GAAA,IAAKuN,iBAAA,GACN;AAAA;AAAA,IAEJ,aAAa,aAAa,UAAU,OAAO,KAAK,CAAC,CAAC,KAAK,aAAa,UAAU,MAAM,KAAK,CAAC,CAAC;AAAA;AAAA,MAEvF,UAAU,OAAO,KAAK,CAAC,EAAE,UAAS,aAAA,OAAA,SAAA,UAAW,MAAM,KAAK,CAAG,EAAA;AAAA;AAAA;AAAA,OAE3D,uCAAW,OAAO,KAAK,CAAO,QAAA,aAAA,OAAA,SAAA,UAAW,MAAM,KAAK,CAAA;AAAA;AAAA,KAEpD,eAAc,cAAY,OAAA,SAAA,WAAA,WAAU5G,QAAO,YAAY,MAAM,MAC7D,mBACJ,CAAC,eACD,MAAM,QAAQ,WAAW,QAAQ,KACjC,WAAW,SAAS,WAAW,MAC/B,cAAY,OAAA,SAAA,WAAA,SAAS,CAAG,EAAA,UAAS,IAE7B,WAAW,gBAAgB,aAE3B,UAA2D;AAAA,IAC/D,MACE,OAAO,OAAwD,CAAC,KAAKtC,WAC5D,IAAI;AAAA,MACTA,OAAM,QAAQ;AAAA;AAAA,QAEZ,CAAC,QAA0B,gBACrB,gBAAgB,IAAU,EAAC,GAAG,QAAQ,cAAc,GAAA,IACjD;AAAA,MAEX;AAAA,IACF,GACC,EAAE;AAAA,IACP,CAAC,MAAM;AAAA,EAAA,GAGH,aAAa,oBAAoB,EAAC,QAAQ,CAAA,GAE1C,kBAAkB,YAAY,MAAM;AACxC,uBAAmB,MAAMsC,OAAM;AAAA,EAAA,GAC9B,CAACA,OAAM,CAAC,GAEL,mBAAmB,eAAe,WAAW,OAE7C,WAAW;AAAA,IACf,MACE,QAAQ,IAAI,CAAC,WAAW;AAChB,YAAA,qBACJ,OAAO,SAAS,iBAAiB,oBAAoB,4BACjD,yBAAyB,mBAC3B3G,GAAE,kEAAkE;AAAA,QAClE,MAAM,OAAO,SAAS,OAAO;AAAA,MAAA,CAC9B,IACDA,GAAE,sEAAsE;AAAA,QACtE,MAAM,OAAO,SAAS,OAAO;AAAA,MAAA,CAC9B,GAEC,SAAS,WAAW,SAAS,OAAO,GAAG;AAE3C,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,cAAYA,GAAE,kDAAkD;AAAA,YAC9D,QAAQ,OAAO,SAAS,OAAO;AAAA,UAAA,CAChC;AAAA,UACD,eAAa,iBAAiB,OAAO,GAAG;AAAA,UACxC,UAAU,YAAY;AAAA,UACtB,MAAK;AAAA,UACL,eAAe,OAAO;AAAA,UACtB,MAAM,cAAc,QAAQ,MAAM;AAAA,UAGlC,SAAS,MAAM,OAAO,OAAO,MAAM;AAAA,UACnC,UAAU;AAAA,UACV,MAAM,OAAO,SAAS,OAAO;AAAA,UAC7B,aAAa,qBAAqB,yBAAyB,OAAO,SAAS,OAAO;AAAA,UAClF,cAAc;AAAA,YACZ;AAAA,YACA,WAAW;AAAA,YACX,QAAQ;AAAA,UACV;AAAA,QAAA;AAAA,QAVK,OAAO;AAAA,MAAA;AAAA,IAWd,CAEH;AAAA,IACH;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACAA;AAAA,MACA;AAAA,IACF;AAAA,KAGI,kBAAkB;AAAA,IACtB,OAAO;AAAA,MACL,QACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,eAAY;AAAA,UACZ;AAAA,UACA,cAAc,EAAC,WAAW,iBAAgB;AAAA,QAAA;AAAA,MAC5C;AAAA,MAEF,SAAS6H;AAAAA,IAAA;AAAA,IAEX,CAAC,UAAU,gBAAgB;AAAA,EAAA;AAI3B,SAAA;AAAA,IAACyF;AAAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ;AAAA,MACA,4BAA0B;AAAA,MAC1B,KAAK;AAAA,MACL;AAAA,MACA,aAAa;AAAA,MAEZ;AAAA,IAAA;AAAA,EAAA;AAGP,CAAC,GC5HK,iBAAiB,KAAK,UAAU,GAOhC,iBAAiB,OAAOE,UAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAUhC3F,uBAAiD;AAAA,EACrD,eAAe;AAAA,EACf,WAAW;AAAA,EACX,QAAQ;AACV,GAEM,qBAAsE;AAAA,EAC1E,IAAI,CAAC,UAAU,oBAAC,YAAU,UAAM,OAAA;AAAA,EAChC,IAAI,CAAC,UAAU,oBAAC,YAAU,UAAM,OAAA;AAAA,EAChC,IAAI,CAAC,UAAU,oBAAC,YAAU,UAAM,OAAA;AAAA,EAChC,IAAI,CAAC,UAAU,oBAAC,YAAU,UAAM,OAAA;AAAA,EAChC,IAAI,CAAC,UAAU,oBAAC,YAAU,UAAM,OAAA;AAAA,EAChC,IAAI,CAAC,UAAU,oBAAC,YAAU,UAAM,OAAA;AAAA,EAChC,QAAQ,CAAC,UAAU,oBAAC,UAAQ,UAAM,OAAA;AAAA,EAClC,YAAY,CAAC,8BAAW,YAAW,EAAA,eAAY,cAAc,UAAM,OAAA;AACrE,GAEM,kBAAkB,OAAO,KAAK,kBAAkB,GAEhD,iBAAiB,CAAC,UAAyC,MAAM,eAAe,GAEhF,aAA6B;AAAA,EACjC,KAAK;AAAA,EACL,OAAO;AAAA,EACP,OAAO;AAAA,EACP,cAAc;AAChB,GAEa,mBAAmB,KAAK,SACnC1I,QACa;AACb,QAAM,EAAC,UAAU,OAAO,UAAS,IAAIA,QAC/BwH,UAAS,sBACT,GAAA,aAAa,iBACb,EAAC,GAAA3G,GAAK,IAAA,eAAA,GAEN,YACJ,aAAa,aAAa2G,QAAO,YAAY,MAAM,SAAS,WAAW,QAAQ,KAG3E,aAAa,mBAAmB,EAAC,OAAO,WAAU,GAElD,EAAC,aAAa,MAAK,IAAI,QAAQ,MAAM;AACnC,UAAA,eAAe,UAAU,OAAO,CAAC,SAAS,WAAW,SAAS,KAAK,KAAK,CAAC;AAE/E,QAAI,SAAS;AAET,WAAA,aAAa,WAAW,KAAK,OAAO,SAAS,MAC/C,SAAS,OAAO,OAAO,CAAC,UAAU,CAAC,GACnC,aAAa,KAAK,UAAU,IAGvB,EAAC,aAAa,cAAc,OAAO;EAAM,GAC/C,CAAC,YAAY,SAAS,CAAC,GAEpB,iBAAiB,QAAQ,MACzB,YAAY,SAAS,IAChB3G,GAAE,qCAAqC,IAG5C,YAAY,WAAW,IAClB,WAAW,eAAeA,GAAE,WAAW,YAAY,IAAI,WAAW,QAGpE,YAAY,CAAC,EAAE,eAAeA,GAAE,YAAY,CAAC,EAAE,YAAY,IAAI,YAAY,CAAC,EAAE,OACpF,CAAC,aAAaA,EAAC,CAAC,GAEb,eAAe;AAAA,IACnB,CAAC,SAA+B;AAC1B,oBAAc,KAAK,UAAU,WAAW,UAC1C,mBAAmB,iBAAiB2G,SAAQ,KAAK,KAAK,GACtD,mBAAmB,MAAMA,OAAM;AAAA,IAEnC;AAAA,IACA,CAACA,SAAQ,UAAU;AAAA,EAGf,GAAA,eAAe,YAAY,CAAC,OAAe,UAAkB;AACjE,UAAM,eAAe,gBAAgB,SAAS,KAAK,GAC7C8G,eAAc,mBAAmB,KAAK;AAE5C,WAAI,eACKA,aAAY,KAAK,IAGnB,oBAAC3M,UAAM,UAAM,MAAA,CAAA;AAAA,EAAA,GACnB,CAAE,CAAA,GAEC,SAAS;AAAA,IACb,MACE;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,UAAU;AAAA,QACV,WAAW;AAAA,QACX,SAAQ;AAAA,QACR,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAM;AAAA,QACN,OAAM;AAAA,MAAA;AAAA,IACR;AAAA,IAEF,CAAC,WAAW,cAAc;AAAA,KAGtB,OAAO;AAAA,IACX,0BACG,MAAK,EAAA,UAAU,WACb,UAAM,MAAA,IAAI,CAAC,SAER;AAAA,MAAC;AAAA,MAAA;AAAA,QAEC,SAAS,YAAY,SAAS,IAAI;AAAA,QAElC,SAAS,YAAY,SAAY,MAAM,aAAa,IAAI;AAAA,QAEvD,UAAA;AAAA,UACC,KAAK;AAAA,UACL,KAAK,eAAed,GAAE,KAAK,YAAY,KAAI,QAAA,OAAA,SAAA,KAAM,UAAS,KAAK;AAAA,QACjE;AAAA,MAAA;AAAA,MARK,KAAK;AAAA,IAWf,CAAA,GACH;AAAA,IAEF,CAAC,WAAW,aAAa,cAAc,OAAO,cAAcA,EAAC;AAAA,EAAA;AAI7D,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS6H;AAAAA,MACT,IAAG;AAAA,MACH;AAAA,MACA;AAAA,IAAA;AAAA,EAAA;AAGN,CAAC,GCtKK,mBAAmB,KAAK,YAAY,GAEpCA,uBAAmC,EAAC,eAAe,IAAM,QAAQ,MAS1D,aAAa,KAAK,SAAoB1I,QAAwB;AACzE,QAAM,EAAC,UAAU,OAAO,cAAc,UAAS,IAAIA,QAC7C,EAAC,GAAAa,GAAC,IAAI,kBACN,aAAa,cACb,GAAA2G,UAAS,yBAET,cAAc,cAAc,WAAW,UAAUA,QAAO,YAAY,MAAM,MAE1E,kBAAkB,YAAY,MAAM;AACxC,uBAAmB,MAAMA,OAAM;AAAA,EAC9B,GAAA,CAACA,OAAM,CAAC,GAEL,mBAAmB,eAAe,WAAW,OAE7C,WAAW,QAAQ,MAChB,MAAM,IAAI,CAAC,SAAS;AACzB,UAAM,QAAQ,KAAK,KAAK,SAAS,WAAW,KAAK,KAAK,IAAI;AAGxD,WAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAY3G;AAAA,UACV,KAAK,SACD,gEACA;AAAA,UACJ,EAAC,UAAU,MAAK;AAAA,QAClB;AAAA,QACA,MAAK;AAAA,QACL,UAAU,YAAa,eAAe,KAAK,WAAW;AAAA,QACtD,MAAM,KAAK;AAAA,QAGX,SAAS,KAAK;AAAA,QACd,MAAM;AAAA,QACN,aAAaA;AAAA,UACX,KAAK,SACD,qDACA;AAAA,UACJ,EAAC,UAAU,MAAK;AAAA,QAClB;AAAA,QACA,cAAc;AAAA,UACZ;AAAA,UACA,WAAW;AAAA,UACX,QAAQ;AAAA,QACV;AAAA,MAAA;AAAA,MAdK,KAAK;AAAA,IAAA;AAAA,EAeZ,CAEH,GACA,CAAC,UAAU,aAAa,OAAOA,IAAG,gBAAgB,CAAC,GAEhD,kBAAkB;AAAA,IACtB,OAAO;AAAA,MACL,QACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,eAAY;AAAA,UACZ;AAAA,UACA,cAAc,EAAC,WAAW,iBAAgB;AAAA,QAAA;AAAA,MAC5C;AAAA,MAEF,SAAS6H;AAAAA,IAAA;AAAA,IAEX,CAAC,UAAU,gBAAgB;AAAA,EAAA;AAI3B,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ;AAAA,MACA,cAAc;AAAA,MACd,4BAA0B;AAAA,MAC1B,KAAK;AAAA,MACL;AAAA,MACA,aAAa;AAAA,MAEZ;AAAA,IAAA;AAAA,EAAA;AAGP,CAAC,GCjEKwD,aAAW,OAAO,IAAI;AAAA;AAAA,GAItB,iBAAiB,OAAO,GAAG;AAAA;AAAA,GAI3B,kBAAkB,OAAO,IAAI;AAAA;AAAA,GAI7B,gBAAgB,OAAO,GAAG;AAAA,IAC5B,CAAC,EAAC,sBACF,mBACA;AAAA;AAAA;AAAA,KAGC;AAAA,GAGC,sBAAsB,OAAO,GAAG;AAAA;AAAA,GAIhC,2BAA2B,KAE3BqC,WACJ,OAAO,SAAU,OAAe,uBAAuB,KAAK,OAAO,UAAU,QAAQ,GAEjF,eAAe,KAAK,SAAsB;AAAA,EAC9C;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAQG;AACD,QAAM,EAAC,GAAA1N,OAAK,kBAEN,iBADa,aAAa,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,QAAQ,QAAQ,CAAC,IACxC,GAC9B,iBAAiB,gBAAgB,SAAS,GAC1C,CAAC,aAAa,cAAc,IAAI,SAAgC,IAAI,GACpE,kBAAkB,eAAe,WAAW,GAE5C,YAAY,eAAe,mBAAkB,mBAAiB,OAAA,SAAA,gBAAA,SAAQ,MAAM,IAC5E,uBAAuB,YAAY,SAAS;AAEnC,iBAAA;AAAA,IACb;AAAA,EAAA,CACD;AAEK,QAAA,sCAAsC,YAAY,CAAC,MAAkB;AACzE,MAAE,eAAe;AAAA,EACnB,GAAG,CAAE,CAAA;AAEL,8BACGqL,YAAS,EAAA,OAAM,UAAS,KAAK,gBAAgB,aAAa,qCACxD,UAAA;AAAA,IAAA,4CACE,iBAAgB,EAAA,MAAM,YAAY,IAAI,QACrC,8BAAC,gBAAe,EAAA,SAAS,eAAe,IAAI,GAC1C,UAAC,oBAAA,kBAAA,EAAiB,UAAoB,OAAO,aAAa,GAC5D,EACF,CAAA;AAAA,IAGF,qBAAC,MAAK,EAAA,MAAM,GACT,UAAA;AAAA,MACC,kBAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM,YAAY,SAAY;AAAA,UAC9B,SAAS,eAAe,IAAI;AAAA,UAC5B,iBAAiB;AAAA,UAEjB,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA;AAAA,cACA,QAAQ;AAAA,cACR;AAAA,YAAA;AAAA,UACF;AAAA,QAAA;AAAA,MACF;AAAA,MAGD,kBACE,oBAAA,KAAA,EAAI,MAAM,YAAY,SAAY,GAAG,SAAS,eAAe,IAAI,GAChE,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA;AAAA,UACA,OAAO;AAAA,UACP;AAAA,QAAA;AAAA,MAAA,GAEJ;AAAA,IAAA,GAEJ;AAAA,IACC,oBAAA,qBAAA,EAAoB,SAAS,eAAe,IAAI,GAC/C,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAYrL,GAAE,2CAA2C;AAAA,QACzD,MAAM,eAAe,eAAe;AAAA,QACpC,MAAK;AAAA,QACL,SAAS;AAAA,QACT,cAAc;AAAA,UACZ,SAASA;AAAA,YACP,eACI,gDACA;AAAA,UACN;AAAA,UACA,SAAS,CAAC,GAAG0N,WAAS,QAAQ,MAAM,IAAI,OAAO;AAAA,UAC/C,WAAW,eAAe,WAAW;AAAA,UACrC,QAAQ;AAAA,QACV;AAAA,MAAA;AAAA,IAAA,GAEJ;AAAA,EACF,EAAA,CAAA;AAEJ,CAAC;AAEM,SAAS,QAAQvO,QAAqB;AACrC,QAAA,EAAC,aAAa,SAAS,cAAc,UAAU,cAAc,mBAAA,IAAsBA,QACnFwH,UAAS,sBACT,GAAA,YAAY,+BAA+B,GAC3CgH,8BAA6B,iCAC7B,WAAW,YAAY,CAAC,WAExB,EAAC,KAAI,IAAI,SAAS,GAElB1I,uBAAsB;AAAA,IAC1B,CAAC,SAA2B;AAC1B,UAAI,SAAS;AACP,YAAA,YAAY,WAAW,MAAM;AACjC,iBAAS,IACT,KAAK;AAAA,UACH,IAAI;AAAA,UACJ,QAAQ;AAAA,UACR,OAAO;AAAA,QAAA,CACR;AAAA,SACA,wBAAwB;AACpB,aAAA0I,4BAA2B,MAA+B,EAAE,EAChE,KAAK,CAAC,WACD,UAGF,KAAK;AAAA,QACH,IAAI;AAAA,QACJ,QAAQ;AAAA,QACR,UAAU;AAAA,QACV,OAAO;AAAA,MACR,CAAA,GAEI,MACR,EACA,MAAM,CAAC,UAAU;AACX,aAAA;AAAA,UACH,OAAO;AAAA,UACP,IAAI;AAAA,UACJ,aAAa,6CAA6C,KAAK,IAAI,KAAK,MAAM,OAAO;AAAA,UACrF,QAAQ;AAAA,QAAA,CACT;AAAA,MAGF,CAAA,EACA,QAAQ,MAAM,aAAa,SAAS,CAAC;AAAA,IAC1C;AAAA,IACA,CAAC,MAAMA,2BAA0B;AAAA,KAG7B,oBAAoB;AAAA,IACxB,OAAO,SAA2B;AAC1B,YAAA,eAAe,MAAM1I,qBAAoB,IAAI,GAC7C,OAAO,mBAAmB,YAAY0B,SAAQ,MAAM,YAAY;AAClE,cACF,aAAa,IAAI;AAAA,IAErB;AAAA,IACA,CAACA,SAAQ,cAAc1B,oBAAmB;AAAA,KAGtC,qBAAqB;AAAA,IACzB,OAAO,SAA2B;AAC1B,YAAA,eAAe,MAAMA,qBAAoB,IAAI,GAC7C,OAAO,mBAAmB,YAAY0B,SAAQ,MAAM,YAAY;AAClE,cACF,aAAa,IAAI;AAAA,IAErB;AAAA,IACA,CAACA,SAAQ,cAAc1B,oBAAmB;AAAA,EAAA,GAGtC,eAAe,gBAAgB;AAAA,IACnC;AAAA,IACA;AAAA,IACA,qBAAAA;AAAA,IACA,UAAU;AAAA,EACX,CAAA,GAEK,cAAc,QAAQ,MAAM,eAAe0B,QAAO,WAAW,GAAG,CAACA,OAAM,CAAC,GAExE,kBAAkB;AAAA,IACtB,MAAM,mBAAmBA,QAAO,aAAa,UAAU,mBAAmB,kBAAkB;AAAA,IAC5F,CAAC,UAAUA,SAAQ,mBAAmB,kBAAkB;AAAA,EAAA;AAIxD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAAA;AAGN;ACtNA,MAAM,iBAAiB,EAAC,SAAS,OAAM,GAIjC,0BAA0B,QAE1B,qBAAqB,OAAO,KAAK,CAACxH,WAAU;AAChD,QAAM,EAAC,MAAS,IAAA,YAAYA,OAAM,KAAK;AAChC,SAAA;AAAA,aACI,MAAM,MAAM,QAAQ,QAAQ,WAAW;AAAA;AAEpD,CAAC,GAuBK,kBAA2C,CAACA,+BACxC,WAAW,EAAA,GAAGA,OAAO,CAAA,GAGzB,cAAmC,CAACA,WAChC,oBAAA,OAAA,EAAO,GAAGA,QAAO,GAGrB,iBAAyC,CAACA,WACvC,oBAAC2J,YAAU,EAAA,GAAG3J,OAAO,CAAA;AAKvB,SAAS,OAAOA,QAAoB;AACnC,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QACE,EAAC,IAAAR,QAAM,eACP,GAAA,EAAC,GAAAqB,GAAC,IAAI,eAAe,GACrB,EAAC,WAAU,IAAI,SAAS,GACxB,cAAc,OAA8B,IAAI,GAEhD,EAAC,SAAS,oBAAmB;AAGnC;AAAA,IACE;AAAA,MACE,CAAC,UAAyB;AACpB,SAAC,cAAc,CAAC,gBAGhB,MAAM,QAAQ,YAChB;MAEJ;AAAA,MACA,CAAC,oBAAoB,cAAc,UAAU;AAAA,IAC/C;AAAA,EAAA;AAGF,QAAM,oBAAoB;AAAA,IACxB,MACG,oBAAA,oBAAA,EAAmB,eAAY,wBAC7B,UAAAA,GAAE,wCAAwC,GAC7C;AAAA,IAEF,CAACA,EAAC;AAAA,EAAA,GAEE,aAAa,iBAEb,0BAA0B,2BAA2B,aAAa,GAElE,WAAW;AAAA,IACf,MACE;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,oBAAkB;AAAA,QAClB;AAAA,QACA;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,WAAW;AAAA,QACX,YAAY;AAAA,QACZ,OAAO;AAAA,MAAA;AAAA,IACT;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,KAGI,4BAA4B;AAAA,IAChC,CAAC,iBAAuB;AACX,iBAAA,KAAK,OAAO,YAAY,CAAC;AAAA,IACtC;AAAA,IACA,CAAC,YAAY,IAAI;AAAA,EAAA;AAMnB,SACG,qBAAAmE,QAAA,EAAK,aAAa,cAAc,eAAY,aAC1C,UAAA;AAAA,IAAA,gCACE,2BACC,EAAA,UAAA,oBAAC,eAAY,eAAY,2BAA0B,QAAQ,GACzD,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,aARexF,QAAO;AAAA,QAStB;AAAA,QACA;AAAA,QACA,cAAc;AAAA,QACd;AAAA,QACA;AAAA,MAAA;AAAA,OAEJ,EACF,CAAA;AAAA,yBAGD,cAAa,EAAA,MAAM,GAAG,MAAM,WAAW,gBAAgB,WACtD,UAAA;AAAA,MAAA,oBAAC,UAAS,EAAA,KAAK,kBACb,UAAA,oBAAC,mBAAkB,EAAA,SAAS,eAAe,IAAI,GAAG,QAAO,UAAS,OAAO,GACvE,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,eAAe;AAAA,UACf,MAAM,WAAW,gBAAgB;AAAA,UAEjC,8BAAC,yBAAwB,EAAA,SAAS,eAAe,gBAAgB,iBAC9D,UACH,UAAA;AAAA,QAAA;AAAA,SAEJ,EACF,CAAA;AAAA,MAEC,oBAAA,OAAA,EAAI,eAAY,IAAG,KAAK,kBAAkB;AAAA,IAAA,GAC7C;AAAA,EACF,EAAA,CAAA;AAEJ;AC7NO,SAAS,WAAW,SAAuC;AAC1D,QAAAgI,UAAS,yBAIT,CAAC,cAAc,IAAI,SAAS,MAAM,OAAO;AAC3C,SAAA,mBAAmB,WACrB,QAAQ;AAAA,IACN;AAAA,EACF,GAEK,QAAQ,MAAM;AACnB,UAAM,iBAAkD,EAAC,OAAO,CAAA;AAChE,WAAAA,QAAO,YAAY,WAAW,QAAQ,CAACjE,SAAQ;AAC7C,cAAQA,KAAI,OAAO;AAAA,QACjB,KAAK;AACY,yBAAA,MAAM,OAAO,IAAIA,KAAI;AACpC;AAAA,QACF,KAAK;AACY,yBAAA,MAAM,OAAO,IAAIA,KAAI;AACpC;AAAA,QACF,KAAK;AACY,yBAAA,MAAM,OAAO,IAAIA,KAAI;AACpC;AAAA,QACF,KAAK;AACY,yBAAA,MAAM,OAAO,IAAIA,KAAI;AACpC;AAAA,MAEJ;AAAA,IAAA,CACD,GACM;AAAA,MACL,OAAO,EAAC,GAAG,eAAe,OAAO,IAAI,kBAAkB,CAAC,GAAG,MAAK;AAAA,MAChE,QAAQ,eAAe;AAAA,IAAA;AAAA,EACzB,GACC,CAACiE,SAAQ,cAAc,CAAC;AAC7B;ACpBO,SAAS,kBAAkBxH,QAAoB;AACpD,QAAM,EAAC,WAAW,iBAAiB,YAAA,IAAeA,QAC5C,0BAA0B,2BAAA,GAC1BwH,UAAS,sBAAsB,GAC/B,YAAY,+BAA+B;AAEjD,kBAAgB,MAAM;AAzBxB,QAAA7G,KAAA,IAAA,IAAA,IAAA;AA2BI,QAAI,UAAU,WAAW;AACvB;AAIF,UAAM,WAAW,wBAAwB,KAAK,CAAC,MAAM,EAAE,OAAO,IAAI;AAElE,QAAI,aAAYA,MAAA,SAAS,eAAT,QAAAA,IAAqB,SAAS;AACxC,UAAA,oBAEF,eAAe,iBAAiB;AAAA,QAC9B,YAAY;AAAA,QACZ,OAAO;AAAA,QACP,QAAQ;AAAA,MACT,CAAA,GAED,eAAe,SAAS,WAAW,SAAS;AAAA,QAC1C,YAAY;AAAA,QACZ,UAAU;AAAA,QACV,OAAO;AAAA,QACP,QAAQ;AAAA,MAAA,CACT,IAKD,aAAA,QAAA,UAAW,MAAM,QACjBf,UAAQ,UAAU,MAAM,MAAM,UAAU,MAAM,GAAG,UAAU,MAAM,KAAK,MAAM,CAAC;AAE7E;AAGF,YAAM,cAAc,SAAS,SAAS,aAChC,mBAAmB,UAAU,WAAW;AAI9C,UAAI,eAAe,kBAAkB;AAC7B,cAAA,oBACJ,eAAe,cAAc,UAAU,CAAC,CAAC,IAAI,UAAU,CAAC,EAAE,OAAO,QAC7D,QACJ,qBAAqB,MAAM,SAAQ,KAAA,SAAS,KAAK,UAAd,OAAqB,SAAA,GAAA,QAAQ,KAC3D,KAAA,SAAS,KAAK,UAAd,OAAqB,SAAA,GAAA,SAAS,KAAK,CAAC,MAAM,EAAE,SAAS,iBAAA,IAGtD,QAGA,sBACH,SACC,MAAM,UAAU,UAChB,UAAU,WAAW,KACrB,UAAU,CAAC,MAAM,cACjB,UAAU,CAAC,MAAM,UACnB,IAGI,uBACJ,gBACE,UAAU,WAAW,KAAK,UAAU,CAAC,MAAM,cAAe;AAE9D,YAAI,OAAa,CAAA;AAEb,+BACF,OAAO,UAAU,MAAM,GAAG,CAAC;AAAA;AAAA,UAG3B,eACA,oBACA,MAAM,SAAQ,KAAS,SAAA,KAAK,UAAd,OAAqB,SAAA,GAAA,QAAQ,IAE3C,OAAO,CAAC,UAAU,CAAC,GAAG,YAAY,EAAC,OAAM,KAAA,SAAS,KAAK,UAAd,OAAA,SAAA,GAAqB,SAAS,CAAG,EAAA,KAAK,CAAA,IAEtE,qBACT,OAAO,CAAC,EAAC,MAAM,SAAS,IAAG,CAAC;AAAA,WAI1B,KAAK,WACP,mBAAmB,OAAO4H,SAAQ;AAAA,UAChC,QAAQ,EAAC,MAAM,QAAQ,EAAC;AAAA,UACxB,OAAO,EAAC,MAAM,QAAQ,EAAC;AAAA,QACxB,CAAA,GAGG,eACF,mBAAmB,MAAMA,OAAM;AAAA,MAGrC;AAAA,IACF;AAAA,EAAA,GACC;AAAA,IACD;AAAA,IACAA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,uCAAW,MAAM;AAAA,EAAA,CAClB;AACH;AC1HO,MAAMxC,SAAO,OAAO,IAAI,EAAE,SAAS,GAE7B,cAAc,OAAO;AAAA;AAAA;AAAA;AAAA,GAMrBqC,eAAa,OAAO,GAAG;AAAA;AAAA;AAIpB,SAAA,UAAU,EAAC,SAAwB;AAhBnD,MAAA1G,KAAA,IAAA;AAiBE,QAAM,EAAC,OAAO,WAAU,MAAM;AAEvB,SAAA;AAAA;AAAA,qBAEY,OAAO,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAkBMA,MAAM,MAAA,eAAN,OAAkB,SAAAA,IAAA,QAAQ,SAAS,MAAM;AAAA,gBAC9D,KAAM,MAAA,eAAN,OAAkB,SAAA,GAAA,QAAQ,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,2BAIzB,KAAM,MAAA,eAAN,OAAkB,SAAA,GAAA,QAAQ,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAM7B,MAAM,MAAM,QAAQ,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAM1C,MAAM,OAAO,KAAK,OAAO,GAAG,EAAE,MAAM,KAAK,OAAO,EAAE,EAAE,GAAG;AAAA;AAAA;AAAA;AAAA,yBAIvD,MAAM,MAAM,QAAQ,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,iCAItB,MAAM,MAAM,QAAQ,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAM1C,MAAM,MAAM,QAAQ,QAAQ,EAAE;AAAA,6BAC1B,MAAM,MAAM,QAAQ,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA,iCAI9B,MAAM,MAAM,QAAQ,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA;AAKnE;ACzEA,MAAM,8BAAkE,CAAC,OAAO,QAAQ;AAajF,SAAS,2BAA2BX,QAAwC;AAC3E,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEA,QACE,EAAC,OAAM,IAAI,YACX,EAAC,GAAAa,OAAK,kBACN,gBAAgB,OAAiC,IAAI,GACrD,kBAAkB,OAAiC,IAAI,GACvD,gBAAgB,OAAO,MAAM,OAAO,UAAU;AAIpD;AAAA,IACE;AAAA,MACE,CAAC,UAAU;AACL,cAAM,QAAQ,aAChB,MAAM,kBACN,MAAM,gBAAgB,GACtB,eAAe;AAAA,MAEnB;AAAA,MACA,CAAC,cAAc;AAAA,IACjB;AAAA,EAAA;AAGF,QAAM,eAAe;AAAA,IACnB,CAAC,UAAyC;AArD9C,UAAAF;AAsDU,UAAA,GAAAA,MAAA,gBAAgB,YAAhB,QAAAA,IAAyB,WAG7B;AAAM,cAAA,eAAA,GACN,MAAM,gBAAgB;AAClB,YAAA;AACF,mBAAS,KAAK;AAAA,iBACP,KAAK;AACZ,kBAAQ,MAAM,GAAG;AAAA,QAAA,UACjB;AACI,0BAAgB,YAClB,gBAAgB,QAAQ,WAAW;AAAA,QAEvC;AAAA,MAAA;AAAA,IACF;AAAA,IACA,CAAC,QAAQ;AAAA,KAGL,iBAAiB;AAAA,IACrB,0BACG,KAAI,EAAA,SAAS,GACZ,UAAC,qBAAA,QAAA,EAAO,OAAO,GACb,UAAA;AAAA,MAAC,oBAAA,KAAA,EAAI,SAAS,GACZ,UAAC,oBAAAgB,QAAA,EAAK,QAAO,UAAS,MAAM,GACzB,UAAA,MACH,CAAA,GACF;AAAA,MACA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,cAAYd,GAAE,oDAAoD;AAAA,UAClE,MAAM;AAAA,UACN,MAAK;AAAA,UACL,SAAS;AAAA,UACT,KAAK;AAAA,UACL,cAAc,EAAC,SAASA,GAAE,yCAAyC,EAAC;AAAA,QAAA;AAAA,MACtE;AAAA,MACA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,cAAYA,GAAE,sDAAsD;AAAA,UACpE,KAAK;AAAA,UACL,MAAM;AAAA,UACN,MAAK;AAAA,UACL,SAAS;AAAA,UACT,MAAK;AAAA,UACL,cAAc,EAAC,SAASA,GAAE,2CAA2C,EAAC;AAAA,QAAA;AAAA,MACxE;AAAA,IAAA,EAAA,CACF,EACF,CAAA;AAAA,IAEF,CAAC,cAAc,QAAQ,OAAOA,EAAC;AAAA,EAAA;AAI/B,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAa;AAAA,MACb,SAAS;AAAA,MACT,oBAAoB;AAAA,MACpB;AAAA,MACA;AAAA,MACA,WAAU;AAAA,MACV,QAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA,QAAQ;AAAA,IAAA;AAAA,EAAA;AAGd;AC1Da,MAAA,eAAe,CAACb,WAA6B;AA5D1D,MAAAW;AA6DQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEX,QACE,EAAC,YAAW,iBAAiB,WAAW,YACxCwH,UAAS,sBAAA,GACT,UAAU,uBAAuB,IAAI,GACrC,aAAa,0BAA0B9E,eAAa,IAAI,CAAC,GACzD,EAAC,YAAAyC,aAAY,UAAU,SAAS,WAAU,IAAI,oBAAoB,cAAY,OAAA,SAAA,WAAA,IAAI,GAClF,mBAAmBqC,QAAO,YAAY,OACtC,aAAa,QAAQ,SAAS,GAC9B,gBAAgB;AAAA,IACpB,OAAwB;AAAA,MACtB,QAAQ,EAAC,MAAM,cAAc,QAAQ,EAAC;AAAA,MACtC,OAAO,EAAC,MAAM,cAAc,QAAQ,EAAC;AAAA,IAAA;AAAA,IAEvC,CAAC,YAAY;AAAA,EAAA,GAGT,WAAW,YAAY,MAAM;AACd,uBAAA,OAAOA,SAAQ,eAAe,EAAC,MAAM,YAAW,GACnE,mBAAmB,MAAMA,OAAM;AAAA,EAAA,GAC9B,CAAC,eAAeA,OAAM,CAAC,GAEpB,SAAS,YAAY,MAAM;AAC3B,mBAEF,mBAAmB,KAAKA,OAAM,GAC9B,WAAW,WAAW,KAAK,IAAI;AAAA,EAAA,GAEhC,CAACA,SAAQ,YAAY,UAAU,CAAC,GAE7B,UAAU,YAAY,MAAM;AACpB,gBAAA,GACZ,mBAAmB,OAAOA,SAAQ,aAAa,GAC/C,mBAAmB,MAAMA,OAAM;AAAA,EAC9B,GAAA,CAAC,aAAaA,SAAQ,aAAa,CAAC,GAEjC,SAAS,CAAQ,EAAA,cAAA,QAAA,WAAY,OAAO,OACpC,QAAQ,cAAY,OAAA,SAAA,WAAA,OACpB,YAAW,cAAA,OAAA,SAAA,WAAY,KAAK,SAAQlH,eACpC,oBAAmBK,MAAY,cAAA,OAAA,SAAA,WAAA,eAAZ,OAAwB,SAAAA,IAAA,SAE3C,WAAW,iBAAiB,MAAM,EAAI,GACtC,eAAe;AAAA,IACnB,MAAM,SAAS,OAAO,CAAC,MAAMf,UAAQ,EAAE,MAAM,IAAI,CAAC;AAAA,IAClD,CAAC,MAAM,QAAQ;AAAA,KAGX,iBAA6B;AAAA,IACjC,OAAO;AAAA,MACL,6BAA6B;AAAA,MAC7B,8BAA8B;AAAA,MAC9B,6BAA6B;AAAA,MAC7B,UAAU;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAM;AAAA,MACN;AAAA,MACA,QAAQ,cAAY,OAAA,SAAA,WAAA;AAAA,MACpB;AAAA,MACA,MAAM;AAAA,MACN,UAAU;AAAA,MACV,UAAU,CAAQ,CAAA;AAAA,MAClB;AAAA,MACA;AAAA,MACA,eAAe;AAAA,MACf;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,YAAAuF;AAAA,IAAA;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,cAAY,OAAA,SAAA,WAAA;AAAA,MACZ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACAA;AAAA,MACA;AAAA,IACF;AAAA,EAAA,GAII,iBAAiB,YAAY,cAAc,WAAW,YACtD,iBAAiB;AAAA,IACrB,MACG,kBACC,oBAACkC,cACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,YAAAlC;AAAA,QACA;AAAA,MAAA;AAAA,OAEJ,KAEF;AAAA,IACF,CAAC,SAAS,SAAS,qBAAqB,gBAAgBA,WAAU;AAAA,EAAA;AAG7D,SAAA;AAAA,IACL,MACG,oBAAA,QAAA,EAAK,KAAK,cAAY,OAAA,SAAA,WAAA,YAAY,iBAAiB,IAClD,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,WAAU;AAAA,QACV,QAAO;AAAA,QAEP,UAAU,SAAS,KAAO,CAAC;AAAA,QAC3B,SAAS;AAAA,QAGR,UAAA,qBACE,oBAAA,QAAA,EAAK,OAAO,EAAC,UAAU,WAAU,GAAI,UAAkB,kBAAA,cAAc,EAAE,CAAA;AAAA,MAAA;AAAA,IAAA,GAG9E;AAAA,IAEF;AAAA,MACE;AAAA,MACA,cAAY,OAAA,SAAA,WAAA;AAAA,MACZ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAEJ,GAEa,+BAA+B,CAACnF,WAAsB;AAC3D,QAAA;AAAA,IACJ,6BAA6B;AAAA,IAC7B,8BAA8B;AAAA,IAC9B,6BAA6B;AAAA,IAC7B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAAmF;AAAA,IACA;AAAA,EACF,IAAInF,QACE,EAAC,GAAAa,OAAK,eAAe,GACrB,aAAa,QAAQ,SAAS,GAC9B,CAAC,aAAa,cAAc,IAAI,SAAkB,EAAK,GACvD,gBAAe,cAAY,OAAA,SAAA,WAAA,UAAS,WAAW,MAC/C,WAAWsE,YAAW,OAAO,CAAC,MAAM,EAAE,UAAU,OAAO,EAAE,SAAS,GAClE,aAAaA,YAAW,OAAO,CAAC,MAAM,EAAE,UAAU,SAAS,EAAE,SAAS,GAEtE,WAAW,YAAY,MAAY;AACxB,mBAAA,EAAK,GACpB;EAAO,GACN,CAAC,MAAM,CAAC;AAEX,YAAU,MAAM;AAEZ,mBADE,OACa,KACN,CADW,CAAA,OAAA;AAAA,EAAA,GAMrB,CAAC,SAAS,IAAI,CAAC;AAEZ,QAAA,OAAO,QAAQ,MAAM;AACrB,QAAA;AACK,aAAA;AAGL,QAAA;AACK,aAAA;AAGT,QAAI,YAAY;AACP,aAAA;AAAA,EAAA,GAGR,CAAC,SAAS,UAAU,YAAY,QAAQ,CAAC,GAEtC,iBAAiB,YAAY,MAAM;AACvC,mBAAe,EAAK;AAAA,EACtB,GAAG,CAAE,CAAA;AAEL,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA;AAAA,MAACH;AAAAA,MAAA;AAAA,QACC,cAAYnE,GAAE,8CAA8C;AAAA,QAC5D,gBAAc,WAAW;AAAA,QACzB,gBAAc,YAAY;AAAA,QAC1B,gBAAc,cAAc;AAAA,QAC5B,kBAAgB,YAAY;AAAA,QAC5B,iBAAe,YAAY;AAAA,QAC3B,gBAAc,cAAc;AAAA,QAC5B,aAAY;AAAA,QACZ,SAAS,WAAW,WAAW;AAAA,QAC/B,eAAe;AAAA,QACf;AAAA,QAEA,UAAA,oBAAC,eACE,UAAc,cAAA;AAAA,UACb,QAAQ;AAAA,UACR;AAAA,UACA,qBAAqB;AAAA,UACrB;AAAA,UACA,eAAe;AAAA,QAChB,CAAA,GACH;AAAA,MAAA;AAAA,IACF;AAAA,IACC,oBACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA;AAAA,QACA,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,MAAM;AAAA,QACN;AAAA,QACA;AAAA,QACA,OAAO;AAAA,MAAA;AAAA,IACT;AAAA,IAED,QACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,aAAY;AAAA,QACZ;AAAA,QACA,WAAW;AAAA,QACX;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QAEC;AAAA,MAAA;AAAA,IACH;AAAA,EAEJ,EAAA,CAAA;AAEJ;AC3SO,SAAS,WAAWb,QAA0D;AAC7E,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA,YAAYM;AAAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEN,QAEEwH,UAAS,yBAET,kBAAkB,qBAAqB,SACvC,CAAC,gBAAgB,iBAAiB,IAAI,SAAgC,IAAI,GAC1E,CAAC,eAAe,gBAAgB,IAAI,SAA6B,IAAI,GAErE,yBAAyB,YAAY,MAAM;AAC5B;EAClB,GAAA,CAAC,kBAAkB,CAAC,GAEjB,8BAA8B;AAAA,IAClC,OAAO;AAAA,MACL,GAAG;AAAA,MACH,QAAQ;AAAA,QACN,aAAa;AAAA,QACb,IAAI,WAAS,OAAA,SAAA,QAAA,WAAU,CAAC;AAAA,MAC1B;AAAA,IAAA;AAAA,IAGF,CAAC,SAAS,kBAAkB;AAAA,EAAA,GAGxB,gBAAgB,WAAW,2BAA2B,GAEtD,sBAAwB,SAAS,qBAAqB,qBAAqB,QAC3E,uBAAyB,SAAS,sBAAsB,sBAAsB,QAE9E,CAAC,eAAe,gBAAgB,IAAI,SAAgC,IAAI,GAExE,kBAAkB;AAAA,IACtB,CAAC,eAAuC;AAChC,YAAA;AAAA,QACJ;AAAA,QACA,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAY;AAAA,QACZ,OAAO;AAAA,MACL,IAAA;AAEF,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,kBAAkB;AAAA,UAClB,SAAS;AAAA,UACT;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,MAAM,KAAK,OAAO,SAAS;AAAA,UAC3B;AAAA,UACA,mBAAmB;AAAA,UACnB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,oBAAoB;AAAA,UACpB,qBAAqB;AAAA,UACrB;AAAA,UACA;AAAA,UACA,YAAY;AAAA,UACZ;AAAA,UACA,OAAO;AAAA,UAEN;AAAA,QAAA;AAAA,MAAA;AAAA,IAGP;AAAA,IACA;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,KAGI,oBAAoB;AAAA,IACxB,CAAC,eAAuC;AAChC,YAAA;AAAA,QACJ,SAAS;AAAA,QACT,MAAM;AAAA,QACN,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,OAAO;AAAA,MACL,IAAA;AAEF,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,kBAAkB;AAAA,UAClB,SAAS;AAAA,UACT;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,MAAM,KAAK,OAAO,SAAS;AAAA,UAC3B;AAAA,UACA,mBAAmB;AAAA,UACnB,cAAc;AAAA,UACd;AAAA,UACA;AAAA,UACA,oBAAoB;AAAA,UACpB,qBAAqB;AAAA,UACrB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,YAAY;AAAA,UACZ,UAAU;AAAA,UACV,OAAO;AAAA,QAAA;AAAA,MAAA;AAAA,IAGb;AAAA,IACA;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,KAII,oBAAoB;AAAA,IACxB,CAAC,eAAuC;AAChC,YAAA,EAAC,OAAO,MAAS,IAAA;AACH,aAAA,MAAM,UAAUA,QAAO,YAAY,MAAM,OAEpD,gBAAgB,UAAU,IAE5B,kBAAkB,UAAU;AAAA,IACrC;AAAA,IACA,CAACA,QAAO,YAAY,MAAM,MAAM,mBAAmB,eAAe;AAAA,KAI9D,oBAAoB;AAAA,IACxB,CAAC,eAAuC;AAChC,YAAA;AAAA,QACJ;AAAA,QACA,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAY;AAAA,QACZ,OAAO;AAAA,MACL,IAAA;AAEJ,aADe,MAAM,UAAUA,QAAO,YAAY,KAAK,OAE9C,WAGP;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,kBAAkB;AAAA,UAClB,SAAS;AAAA,UACT;AAAA,UACA;AAAA,UACA;AAAA,UACA,MAAM,KAAK,OAAO,SAAS;AAAA,UAC3B;AAAA,UACA,mBAAmB;AAAA,UACnB,cAAc;AAAA,UACd;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,YAAY;AAAA,UACZ;AAAA,UACA,OAAO;AAAA,QAAA;AAAA,MAAA;AAAA,IAGb;AAAA,IACA;AAAA,MACEA,QAAO,YAAY,KAAK;AAAA,MACxB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,KAGI,yBAAyB;AAAA,IAC7B,CAAC,oBAAgD;AACzC,YAAA;AAAA,QACJ;AAAA,QACA,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAY;AAAA,QACZ,OAAO;AAAA,MACL,IAAA;AAEF,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA,kBAAkB;AAAA,UAClB,SAAS,CAAQ,CAAA;AAAA,UACjB;AAAA,UACA;AAAA,UACA;AAAA,UACA,MAAM,KAAK,OAAO,KAAK;AAAA,UACvB;AAAA,UACA,mBAAmB;AAAA,UACnB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,YAAY;AAAA,UACZ;AAAA,UACA,OAAO;AAAA,UAEN;AAAA,QAAA;AAAA,MAAA;AAAA,IAGP;AAAA,IACA;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA,GAEI,kBAAkBxH,OAAM,aAAa,kBAAkB,GASvD,mBAAgD,QAAQ,MAAM;AAG9D,QAAA;AACK,aAAA;AAAA,QACL,QAAQ;AAAA,UACN,MAAM;AAAA,UACN,QAAQ;AAAA,QACV;AAAA,QACA,OAAO;AAAA,UACL,MAAM;AAAA,UACN,QAAQ;AAAA,QACV;AAAA,MAAA;AAAA,EACF,GAID,CAAE,CAAA,GAEC,aAAa;AAAA,IACjB,MACE;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA;AAAA,QACA,SAAS;AAAA,QACT;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,oBAAoB;AAAA,QACpB;AAAA,QACA;AAAA,QACA;AAAA,QACA,kBAAkB;AAAA,QAClB,aAAa;AAAA,QACb,aAAa;AAAA,QACb;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA;AAAA,IAIF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAGI,GAAA,SAAS,aACT,iBAAiB;AAAA,IACrB,OAAO;AAAA,MACL,WAAW;AAAA,MACX,SAAS,OAAO;AAAA,MAChB,QAAQ;AAAA,MACR,UAAU,OAAO;AAAA,IAAA;AAAA,IAGnB,CAAC,OAAO,SAAS,eAAe,cAAc;AAAA,EAAA;AAI9B,oBAAA;AAAA,IAChB;AAAA,IACA,iBAAiB;AAAA,IACjB;AAAA,EAAA,CACD;AAKD,QAAM,gBAAgB,WAAW;AAEjC,SACG,oBAAA,gBAAA,EAAe,qBAAqB,gBAAgB,SAAS,OAAO,SACnE,UAAA,oBAAC,iBAAgB,EAAA,YAAwB,iBAAiB,CAAC,UACzD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,UAAU;AAAA,MACV,UAAU,CAAQ,CAAA;AAAA,MAClB,WAAW;AAAA,MACX;AAAA,MAEA,UAAA;AAAA,QAACgF;AAAAA,QAAA;AAAA,UACC,gBAAc,gBAAgB,KAAK;AAAA,UACnC,kBAAgB,WAAW,KAAK;AAAA,UAEhC,UAAA;AAAA,YAAA,oBAAC,OAAI,gBAAa,IAAG,KAAK,mBACxB,8BAAC,QAAO,EAAA,iBAAiB,eAAe,aAAa,aAClD,UAAe,eAAA,oBAAC,iBAAe,UAAW,WAAA,CAAA,IAAmB,YAChE,EACF,CAAA;AAAA,YACA,oBAAC,OAAI,EAAA,eAAY,GAAG,CAAA;AAAA,UAAA;AAAA,QAAA;AAAA,MACtB;AAAA,IAAA;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ;ACncO,SAAS,aAAahF,QAA0B;AACrD,QAAM,EAAC,UAAU,UAAU,YAAY,SAAA,IAAYA,QAC7C,YAAY,aAAa,GAEzB,EAAC,GAAAa,GAAC,IAAI,kBAEN,eAAe,YAAY,MAAM;AACjC,mBACF,SAAS,EAAC,MAAM,YAAY,SAAS,WAAW,SAAQ,GACxD,UAAU,IAAI,iCAAiC;AAAA,MAC7C,mBAAmB,WAAW,KAAK;AAAA,MACnC,4BAA4B,WAAW;AAAA,IACxC,CAAA;AAAA,EAAA,GAEF,CAAC,UAAU,YAAY,SAAS,CAAC,GAE9B,iBAAiB,YAAY,MAAM;AAC7B,cAAA,IAAI,8BAA8B,GAC5C,SAAS;AAAA,EAAA,GACR,CAAC,UAAU,SAAS,CAAC;AAExB,SAAK,aAGH;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAO,oBAAA,UAAA,EAAG,UAAEA,GAAA,0CAA0C,GAAE;AAAA,MACxD,QACE,qBAAC,OAAM,EAAA,SAAS,GACb,UAAA;AAAA,QAAW,WAAA,+BACT,MAAK,EAAA,SAAS,CAAC,GAAG,CAAC,GAAG,KAAK,GAC1B,UAAA;AAAA,UAAA;AAAA,YAAC4N;AAAAA,YAAA;AAAA,cACC,MAAK;AAAA,cACL,SAAS;AAAA,cACT,MAAM5N,GAAE,uDAAuD;AAAA,YAAA;AAAA,UACjE;AAAA,UAEC,CAAC,YACA;AAAA,YAAC4N;AAAAA,YAAA;AAAA,cACC,SAAS;AAAA,cACT,MACE;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,GAAA5N;AAAA,kBACA,SAAS,WAAW,KAAK;AAAA,kBACzB,QAAQ,WAAW,KAAK;AAAA,gBAAA;AAAA,cAC1B;AAAA,cAEF,MAAK;AAAA,YAAA;AAAA,UACP;AAAA,QAAA,GAEJ;AAAA,4BAGD,KAAI,EAAA,SAAS,GACX,UAAA,WAAW,UACT,oBAAAc,QAAA,EAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACtB,UAAEd,GAAA,sDAAsD,EAC3D,CAAA,GAEJ;AAAA,MAAA,GACF;AAAA,MAGF,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,oBAACc,UAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAC,oBAAA,WAAA,EAAU,GAAAd,IAAM,SAAS,WAAW,KAAK,aAAa,QAAQ,WAAW,KAAK,QAAQ,EACzF,CAAA;AAAA,QAEA,oBAAC,QAAK,QAAM,IAAC,UAAS,QAAO,SAAS,GAAG,MAAK,WAC5C,8BAAC,MAAK,EAAA,UAAS,QAAQ,UAAK,KAAA,UAAU,WAAW,MAAM,MAAM,CAAC,EAAA,CAAE,EAClE,CAAA;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAjDoB,IAAA;AAoD1B;AC3EO,SAAS,WAAWb,QAEzB;AACM,QAAA,EAAC,SAAQA,QACT,EAAC,iBAAgB,eAAiB,EAAA;AAwBxC,SAAO,EAAC,WAtBU;AAAA,IAChB,CAAC,eACQ,aAAa,UAAU,CAAC,EAAC,UAAU,cAAa;AACrD,YAAM,kBAAkB,QACrB,OAAO,CAAC0E,WAAU,YAAYA,OAAM,MAAM,IAAI,CAAC,EAC/C,IAAI,CAACA,YAAW;AAAA,QACf,GAAGA;AAAA,QACH,MAAMA,OAAM,KAAK,MAAM,KAAK,MAAM;AAAA,MAClC,EAAA;AAEA,sBAAgB,UAClB,WAAW;AAAA,QACT,aAAa,aAAa,MAAM,OAAO;AAAA,QACvC,UAAUnE,WAAS,QAAQ,IAAI,gBAAgB,UAAU,IAAI,IAAI,CAAC;AAAA,QAClE,SAAS;AAAA,MAAA,CACV;AAAA,IAAA,CAEJ;AAAA,IAEH,CAAC,MAAM,YAAY;AAAA,EAAA;AAIvB;AAEA,SAAS,gBAAgB,UAAuB,UAAuB;AACrE,QAAM,eAAe,OAAO;AACxB,SAAA,iBAAiB,OAAO,WACnB,KAEL,iBAAiB,WACZ,cAAc,UAAU,QAAQ,IAElC,aAAa;AACtB;AAEA,SAAS,YAAY,aAAmB,WAAiB;AACvD,MAAI,gBAAgB;AACX,WAAA;AAKT,MAHI,CAAC,MAAM,QAAQ,WAAW,KAAK,CAAC,MAAM,QAAQ,SAAS,KAGvD,YAAY,SAAS,UAAU;AAC1B,WAAA;AAET,WAAS,IAAI,GAAG,MAAM,UAAU,QAAQ,IAAI,KAAK;AAC/C,QAAI,CAAC,gBAAgB,UAAU,CAAC,GAAG,YAAY,CAAC,CAAC;AACxC,aAAA;AAGJ,SAAA;AACT;AAEA,SAAS,YAAY,OAAa,OAAa;AACtC,SAAA,MAAM,WAAW,KAAM,YAAY,OAAO,KAAK,KAAK,CAAC,YAAY,OAAO,KAAK;AACtF;AAEA,SAAS,aAAa,MAAY,SAAsB;AACtD,SAAO,QAAQ;AAAA,IACb,CAACmE,WAAU,YAAYA,OAAM,MAAM,IAAI,MAAMA,OAAM,SAAS,SAASA,OAAM,SAAS;AAAA,EAAA;AAExF;AAEA,SAAS,gBAAgB,OAAgC,MAAY;AACnE,SAAO,KAAK,OAAO,CAAC,QAAQ,YACtB,OAAO,WAAY,WACd,KAAK,QAAQ,OAAO,IAGtB,IAAI,QAAQ,OAAO,GACzB,KAAK;AACV;AC5CO,SAAS,kBAAkB1E,QAA+B;AACzD,QAAA;AAAA,IACJ,WAAW;AAAA,IACX;AAAA,IACA;AAAA,IACA,UAAUM;AAAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,IAAIN,QAEE,EAAC,OAAM,IAAI,cACX,mBAAmB,OAAkC,IAAI,GACzD,YAAY,iBAAiB;AAKf,sBAAA,aAAa,KAAK,OAAO;AAAA,IAC3C,QAAQ;AACF,gBAAU,WACZ,mBAAmB,MAAM,UAAU,OAAO;AAAA,IAE9C;AAAA,EACA,EAAA;AAEF,QAAM,EAAC,UAAS,IAAI,WAAW,EAAC,MAAK,GAC/B,CAAC,uBAAuB,wBAAwB,IAAI,SAAS,EAAK,GAClE,CAAC,cAAc,eAAe,IAAI,SAA8B,IAAI,GACpE,CAAC,cAAc,eAAe,IAAI,SAAS,EAAK,GAChD,CAAC,UAAU,WAAW,IAAI,SAAS,EAAK,GACxC,CAAC,WAAW,YAAY,IAAI,SAAS,EAAK,GAC1C,CAAC,gBAAgB,iBAAiB,IAAI,SAAS,EAAK,GACpD,YAAY,gBAEZ,QAAQ,SAAA,GAGR,eAGD,QAAQ,MAAM,IAAI,QAAA,GAAW,CAAA,CAAE,GAC9B,WAAW,QAAQ,MAAM,aAAa,gBAAgB,CAAC,YAAY,CAAC,GAEpE,kBAAkB,OAA8B,IAAI,GAEpD,yBAAyB,YAAY,MAAM;AAC/C,oBAAgB,CAAC,MAAM;AACrB,YAAM,OAAO,CAAC;AACV,aAAA,OACF,UAAU,IAAI,yBAAyB,IAEvC,UAAU,IAAI,0BAA0B,GAG1C,sBAAA,QAAA,mBAAqB,IACd,GAAA;AAAA,IAAA,CACR;AAAA,EAAA,GACA,CAAC,oBAAoB,SAAS,CAAC;AAGlC,YAAU,MAAM;AACV,oBAAgB,UAAU,aAAa,SACzC,gBAAgB,IAAI;AAAA,EAAA,GAErB,CAAC,cAAc,KAAK,CAAC,GAGxB,UAAU,MACD,UAAU,CAAC,EAAC,SAAS,eAAoB;AAC9C,iBAAa,KAAK,EAAC,SAAS,SAAS,CAAA;AAAA,EACtC,CAAA,GACA,CAAC,cAAc,SAAS,CAAC;AAEtB,QAAA,0BAA0B,oCAAoCA,MAAK;AAGzE,YAAU,MAAM;AACV,sBACF,YAAY,EAAI;AAAA,EAAA,GAEjB,CAAC,cAAc,CAAC;AAOnB,QAAM,kCAAkC;AAAA,IACtC,CAAC,cAAoB;AAEb,YAAA,aACJ,UAAU,WAAW;AAAA,MACrB,UAAU,CAAC,MAAM;AAAA,MACjB,aAAa,UAAU,CAAC,CAAC;AAAA,MACzB,CAAC,wBAAwB;AAAA,QACvB,CAAC,SAAS,aAAa,UAAU,CAAC,CAAC,KAAK,KAAK,OAAO,QAAQ,UAAU,CAAC,EAAE;AAAA,MAAA;AAI3E,kBAFE,aAEU,UAAU,OAAO,MAAM,IAGvB,SAHwB;AAAA,IAKxC;AAAA,IACA,CAAC,aAAa,uBAAuB;AAAA,KAIjC,qBAAqB;AAAA,IACzB,CAAC,WAA+B;AAC9B,cAAQ,OAAO,MAAM;AAAA,QACnB,KAAK;AACM,mBAAA,cAAc,OAAO,OAAO,CAAC;AACtC;AAAA,QACF,KAAK;AACC,iBAAO,UAAU,YACnB,aAAa,EAAI,IACR,OAAO,UAAU,YAC1B,aAAa,EAAK;AAEpB;AAAA,QACF,KAAK;AAGH,0BAAgB,MAAM;AAChB,mBAAO,aACT,gCAAgC,OAAO,UAAU,MAAM,IAAI;AAAA,UAAA,CAE9D;AACD;AAAA,QACF,KAAK;AACS,sBAAA,EAAI,GAChB,kBAAkB,EAAI;AACtB;AAAA,QACF,KAAK;AACH,iBAAO,OAAO,KAAK,GACnB,kBAAkB,EAAK;AACvB;AAAA,QACF,KAAK;AAAA,QACL,KAAK;AACM,mBAAA,cAAc,OAAO,OAAO,CAAC;AACtC;AAAA,QACF,KAAK;AACH,0BAAgB,MAAM;AACtB;AAAA,QACF,KAAK;AACH,gBAAM,KAAK;AAAA,YACT,QAAQ,OAAO;AAAA,YACf,aAAa,OAAO;AAAA,UAAA,CACrB;AACD;AAAA,MAEJ;AACI,gBAAU,WAAW,kBACvB,eAAe,QAAQ,UAAU,OAAO;AAAA,IAE5C;AAAA,IACA,CAAC,WAAW,QAAQ,UAAU,gBAAgB,iCAAiC,KAAK;AAAA,EAAA;AAGtF,YAAU,MAAM;AACd,6BAAyB,EAAK;AAAA,EAAA,GAC7B,CAAC,KAAK,CAAC;AAEJ,QAAA,2BAA2B,YAAY,MAAY;AACvD,6BAAyB,EAAI;AAAA,EAC5B,GAAA,CAAE,CAAA,GAEC,0BAA0B,QAAQ,MAClC,gBAAgB,aAAa,aAE5B,oBAAA,KAAA,EAAI,cAAc,GACjB,UAAA;AAAA,IAAC0O;AAAAA,IAAA;AAAA,MACC,UAAU;AAAA,MACV,UAAU;AAAA,MACV,YAAY,aAAa;AAAA,MACzB,UAAU,aAAa;AAAA,IAAA;AAAA,EAE3B,EAAA,CAAA,IAGG,MACN,CAAC,oBAAoB,0BAA0B,cAAc,WAAW,QAAQ,CAAC,GAE9E,iBAAiB,YAAY,MAAY;AACxC,iBACH,YAAY,EAAI,GACZ,UAAU,WACZ,mBAAmB,MAAM,UAAU,OAAO;AAAA,EAAA,GAG7C,CAAC,WAAW,QAAQ,CAAC;AAGtB,SAAA,qBAAC,KAAI,EAAA,KAAK,iBACP,UAAA;AAAA,IAAA,CAAC,yBAAyB;AAAA,KACzB,CAAC,gBAAgB,0BACjB,oBAAC,+BAA4B,SAC3B,UAAA,oBAAC,iCAAgC,EAAA,aAAa,yBAC5C,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,UAAU;AAAA,QACV,WAAW;AAAA,QACX,KAAK;AAAA,QACL,UAAU,aAAa;AAAA,QACvB;AAAA,QACA;AAAA,QAEA,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACE,GAAG1O;AAAA,YACJ;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA,YAAY;AAAA,YACZ;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA,oBAAoB;AAAA,YACpB;AAAA,YACA;AAAA,YACA;AAAA,UAAA;AAAA,QACF;AAAA,MAAA;AAAA,OAEJ,EACF,CAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;AAEA,SAAS,cAAc,SAAc;AAC5B,SAAA,QAAQ,IAAI,CAAC,OAAc,EAAC,GAAG,GAAG,WAAW,kBAAmB,EAAA;AACzE;ACpTO,SAAS,qBAAqB,QAAgD;AACnF,SAAO,eAAe,OAAO,KAAK,MAAM,OAAO,KAAK;AACtD;AAEO,SAAS,eAAe,MAIpB;AACT,QAAM,EAAC,MAAM,QAAQ,cAAa,MAC5B,uBAAuB,UAAU,SAAS,UAAU,OACpD,sBAAsB,IAAI,UAAU,QACpC,UAAU,OAAO,KAAK,KAAK;AAE1B,SAAA;AAAA,IACL,sBAAsB,KAAK,eAAe,mBAAmB;AAAA,IAC7D,UAAU,qBAAqB,MAAM;AAAA,IACrC,sBAAsB,KAAK,SAAS,IAAI,mBAAmB,MAAM,OAAO;AAAA,IACxE,uBAAuB,KAAK,SAAS,oBAAoB;AAAA,EAExD,EAAA,OAAO,OAAO,EACd,KAAK,GAAG;AACb;ACAA,MAAMgF,SAAO,OAAO,IAAI,EAAE,CAAChF,WAAqC;AACxD,QAAA,EAAC,UAASA,QACV,EAAC,WAAW,OAAO,OAAM,IAAI,MAAM,QACnC,QAAQ,MAAM,OAAO,MAAM,OAC3B,QAAQ,IAAI,MAAM,OAAO,MAAM,CAAC,CAAC;AAEhC,SAAA;AAAA,IACL,UAAU;AAAA,IACV,cAAc,GAAG,OAAO,CAAC,CAAC;AAAA,IAC1B,OAAO,MAAM,QAAQ,QAAQ;AAAA,IAC7B,WAAW,qBAAqB;AAAA,MAC9B,OAAO,MAAM,QAAQ,QAAQ;AAAA,MAC7B,OAAO,MAAM,OAAO;AAAA,IAAA,CACrB;AAAA,IAED,gBAAgB;AAAA,MACd,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,QAAQ,IAAI,KAAK,SAAS,KAAK;AAAA,IACjC;AAAA,IAEA,sBAAsB;AAAA,MACpB,SAAS;AAAA,MACT,eAAe;AAAA,MACf,SAAS,GAAG,KAAK,QAAQ,KAAK;AAAA,IAChC;AAAA;AAAA,IAGA,2BAA2B;AAAA,MACzB,QAAQ;AAAA,IACV;AAAA;AAAA,IAGA,wEAAwE;AAAA,MACtE,aAAa,MAAM,QAAQ,QAAQ;AAAA,IACrC;AAAA;AAAA,IAGA,8DAA8D;AAAA,MAC5D,WAAW,eAAe;AAAA,QACxB,QAAQ;AAAA,UACN,OAAO,MAAM,QAAQ,QAAQ;AAAA,UAC7B,OAAO,MAAM,OAAO;AAAA,QACtB;AAAA,QACA;AAAA,MAAA,CACD;AAAA,IACH;AAAA;AAAA,IAGA,kBAAkB;AAAA,MAChB,OAAO,MAAM,QAAQ,SAAS;AAAA,MAC9B,iBAAiB,MAAM,QAAQ,SAAS;AAAA,MACxC,WAAW,qBAAqB;AAAA,QAC9B,OAAO,MAAM,QAAQ,SAAS;AAAA,QAC9B,OAAO,MAAM,OAAO;AAAA,MAAA,CACrB;AAAA,IACH;AAAA,EAAA;AAEJ,CAAC,GAEK,QAAQ,OAAO,MAAM,CAACA,WAAqC;AACzD,QAAA,EAAC,MAAK,IAAIA,QACV,OAAO,MAAM,OAAO,MAAM,MAC1B,QAAQ,MAAM,OAAO,MAAM,OAC3B,IAAI,MAAM,OAAO,MAAM,CAAC,GACxB,OAAO,MAAM,OAAO,MAAM,KAAK,MAAM,CAAC;AAErC,SAAA;AAAA,IACL,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,SAAS;AAAA,IACT,UAAU,IAAI,KAAK,QAAQ;AAAA,IAC3B,YAAY,KAAK,aAAa,KAAK;AAAA,IACnC,YAAY,KAAK;AAAA,IACjB,YAAY,KAAK,QAAQ;AAAA,IACzB,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,UAAU;AAAA,IACV,UAAU;AAAA,IACV,WAAW;AAAA,IACX,YAAY,IAAI,IAAI,KAAK,cAAc;AAAA,IACvC,cAAc,IAAI,CAAC;AAAA,IACnB,eAAe,IAAI,IAAI,KAAK,eAAe;AAAA,IAC3C,aAAa,IAAI,CAAC;AAAA;AAAA,IAGlB,kCAAkC;AAAA,MAChC,OAAO,MAAM,QAAQ,QAAQ;AAAA,IAC/B;AAAA;AAAA,IAGA,4BAA4B;AAAA,MAC1B,OAAO,MAAM,QAAQ,SAAS;AAAA,IAChC;AAAA,EAAA;AAEJ,CAAC,GAEK,cAAc,OAAO,GAAG,EAAE,CAACA,WAA0B;AACzD,QAAM,EAAC,MAAK,IAAIA,QACV,QAAQ,MAAM,OAAO,MAAM;AAE1B,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAMc,MAAM,QAAQ,QAAQ,WAAW;AAAA;AAExD,CAAC,GAEK,SAAS,OAAO,GAAG;AAAA;AAAA;AAAA,GAKZ,WAAW;AAAA,EACtB,CACEA,QAOA,QACG;AACG,UAAA;AAAA,MACJ;AAAA,MACA;AAAA,MACA;AAAA,MACA,aAAa;AAAA,MACb;AAAA,MACA,QAAQ,CAAC;AAAA,MACT,GAAG;AAAA,IACD,IAAAA,QAEE,EAAC,GAAAa,OAAK,eAAe,qBAAqB,GAC1C,CAAC,YAAY,aAAa,IAAI,SAAS,EAAE,GACzC,UAAU,CAAC,YAAY,CAAC,UACxB,CAAC,SAAS,UAAU,IAAI,SAAS,EAAK,GACtC,eAAe,gBAAgB,GAAG,GAClC,UAAU,OAA8B,IAAI,GAE5C,wBAAwB;AAAA,MAC5B,CAAC,UAAwC;AAGvC,YAFqB,cAAc,MAAM,MAAM,KAAK,MAAM,OAAO,QAAQ,iBAAiB;AAExE;AAElB,cAAM,eAAe,aAAa;AAE9B,wBACF,WAAW,MAAM,aAAa,SAAS,CAAC;AAAA,MAE5C;AAAA,MACA,CAAC,YAAY;AAAA,IAAA,GAGT,kBAAkB,YAAY,MAAM;AACxC,iBAAW,EAAK;AAAA,OACf,CAAE,CAAA,GAEC,oBAAoB,YAAY,CAAC,UAAyC;AAChE,oBAAA,MAAM,cAAc,KAAK;AAAA,IAAA,GACtC,CAAE,CAAA,GAEC,mBAAmB;AAAA,MACvB,CAAC,UAAsB;AACrB,mBAAW,EAAI,GACX,WAAS,QAAQ,KAAK;AAAA,MAC5B;AAAA,MACA,CAAC,OAAO;AAAA,OAGJ,qBAAqB;AAAA,MACzB,CAAC,UAA2C;AACtC,YAAA,MAAM,QAAQ,YAChB,MAAM,kBACN,MAAM,gBAAA,GAEF,YAAY,aAAY;AACpB,gBAAA,WAAW,MAAM,OAAO,CAAC,EAAC,OAAO,WAAW,CAAA,CAAC;AAEnD,wBAAc,EAAE,GAEZ,YAAU,SAAS,QAAQ;AAAA,QACjC;AAAA,MAEJ;AAAA,MACA,CAAC,YAAY,UAAU,KAAK;AAAA,OAGxB,kBAAkB;AAAA,MACtB,CAAC,UAAkB;AACjB,YAAI,CAAC;AAAU;AAET,cAAA,WAAW,MAAM,MAAM,CAAC;AAE9B,iBAAS,OAAO,OAAO,CAAC,GAExB,SAAS,QAAQ;AAAA,MACnB;AAAA,MACA,CAAC,UAAU,KAAK;AAAA,IAAA;AAGlB,WAAA,UAAU,MAAM;AACd,YAAM,eAAe,aAAa;AAE9B,uBACF,aAAa,MAAM,QAAQ,KAC3B,aAAa,MAAM,QAAQ,GAAG,aAAa,WAAW;AAAA,IAEvD,GAAA,CAAC,cAAc,UAAU,CAAC,GAG3B;AAAA,MAACmE;AAAAA,MAAA;AAAA,QACC,iBAAe,WAAW,KAAK;AAAA,QAC/B,gBAAc,UAAU,KAAK;AAAA,QAC7B,kBAAgB,WAAW,KAAK;AAAA,QAChC,WAAQ;AAAA,QACR,eAAe;AAAA,QACf,UAAS;AAAA,QACT,SAAS;AAAA,QACT,KAAK;AAAA,QAEJ,UAAA;AAAA,UAAA,WACE,oBAAA,aAAA,EAAY,QAAQ,CAAA,EAAQ,cAAc,MAAM,SAAS,SAAS,GACjE,8BAACrD,QAAK,EAAA,cAAa,YAChB,UAAA,mBAEGd,GAAE,2BAA2B;AAAA,YAC3B,SACE,OAAO,SAAW,OAAe,kBAAkB,SAC/C,UACA;AAAA,UAAA,CACP,GACP,EACF,CAAA;AAAA,UAGF,qBAAC,OAAI,EAAA,WAAU,WACZ,UAAA;AAAA,YAAM,MAAA,IAAI,CAAC,KAAK;AAAA;AAAA,kCAEd,QACC,EAAA,UAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC;AAAA,kBACA,OAAO;AAAA,kBACP,OAAO,CAAC;AAAA,kBACR,UAAU;AAAA,kBACV;AAAA,gBAAA;AAAA,cACF,EAAA,GAPW,OAAO,QAAQ,EAQ5B;AAAA,aACD;AAAA,gCAEA,OACC,EAAA,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACE,GAAG;AAAA,gBACJ,UAAU,CAAC;AAAA,gBACX,QAAQ;AAAA,gBACR,UAAU;AAAA,gBACV,SAAS;AAAA,gBACT,WAAW;AAAA,gBACX,KAAK;AAAA,gBACL,MAAK;AAAA,gBACL,OAAO;AAAA,cAAA;AAAA,iBAVF,WAYT;AAAA,UAAA,GACF;AAAA,QAAA;AAAA,MAAA;AAAA,IAAA;AAAA,EAGN;AACF;AAEA,SAAS,cAAc;AAEvB,SAAS,IAAIb,QAMV;AACK,QAAA,EAAC,SAAS,OAAO,OAAO,UAAU,QAAOA,QAEzC,oBAAoB,YAAY,MAAM;AAC1C,aAAS,KAAK;AAAA,EAAA,GACb,CAAC,OAAO,QAAQ,CAAC;AAEpB,SACG,oBAAA,MAAA,EAAK,WAAQ,OAAM,QAAQ,GAAG,MAAK,eAClC,UAAC,qBAAA,MAAA,EAAK,OAAM,UAAS,KAAK,GACxB,UAAA;AAAA,IAAA,oBAAC,KAAI,EAAA,MAAM,GAAG,UAAU,GAAG,aAAa,GACtC,UAAC,oBAAA2B,QAAA,EAAK,OAAc,cAAa,YAC9B,UAAA,IAAI,MACP,CAAA,GACF;AAAA,IACC,WACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,cAAc,EAAC,SAAS,SAAQ;AAAA,MAAA;AAAA,IAClC;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ;ACzTO,SAAS,eAAe3B,QAA4B;AACnD,QAAA,EAAC,UAAU,UAAU,QAAQ,CAAI,GAAA,cAAc,MAAM,QAAW,IAAAA,QAChE,gBAAgB,QAAQ,MAAM,SAAO,OAAA,SAAA,MAAA,IAAI,CAAC,OAAO,EAAC,OAAO,EAAC,EAAA,GAAK,CAAC,KAAK,CAAC,GAEtE,eAAe;AAAA,IACnB,CAAC,cAAiC;AAChC,eAAS,UAAU,WAAW,IAAI,MAAU,IAAA,IAAI,UAAU,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;AAAA,IAChF;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA;AAGX,6BACG,iBAAgB,EAAA,MAAY,WAAW,SAAS,UAAU,IACzD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,UAAU;AAAA,MACV;AAAA,MACA,OAAO;AAAA,MACN,GAAG;AAAA,IAAA;AAAA,EAER,EAAA,CAAA;AAEJ;AC9BA,MAAM,aAAa,CAAC,UAAU,UAAU,SAAS;AAE1C,SAAS2O,sBAAoB,MAAgC;AAC3D,SAAA,KAAK,GAAG,MAAM,CAAC,WAAW,WAAW,SAAS,OAAO,QAAQ,CAAC;AACvE;AAEA,SAAS,cAAc,MAAwD;AACtE,SAAA,KAAK,GAAG,WAAW,KAAKhI,KAAQ,UAAU,KAAK,GAAG,CAAC,CAAC;AAC7D;AAEA,SAAS,YAAY,MAAwC;AApB7D,MAAAhG;AAqBS,WAAAA,MAAA,KAAK,YAAL,OAAA,SAAAA,IAAc,YAAW;AAClC;AAEA,SAAS,eAAe,MAAgC;AAE/C,SAAA,KAAK,GAAG,KAAK,CAAC,eAAegG,KAAQ,SAAS,UAAU,CAAC;AAClE;AAEA,SAAS,eAAe,MAAgC;AA7BxD,MAAAhG;AA8BS,SAAA,CAAA,GAAQA,MAAK,KAAA,YAAL,QAAcA,IAAA;AAC/B;AAEO,SAAS,kBAAkB,MAA2C;AAC3E,SAAI,cAAc,IAAI,KAAK,YAAY,IAAI,IAClC,iBAIL,eAAe,IAAI,IACd,sBAILgO,sBAAoB,IAAI,IACnB,yBAIL,eAAe,IAAI,IACd,oBAGF;AACT;ACrCA,SAASC,eACP,QACkC;AAClC,SAAO,kBAAkB,MAAM,IAAI,SAAS,EAAC,OAAO,WAAW,GAAG,MAAM,EAAE,GAAG,OAAO,OAAM;AAC5F;AAEA,MAAM,aAAa,EAAC,OAAO,IAAI,OAAO,OAAS;AAOxC,SAAS,YAAY5O,QAAyB;AA9BrD,MAAAW,KAAA;AA+BQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEX,QACE,QAAQ;AAAA,IACZ,MAAG;AA3CPW,UAAAA;AA2CWA,gBAAAA,OAAA,WAAW,YAAX,OAAA,SAAAA,KAAoB,SAAQ,CAAI,GAAA,IAAIiO,cAAY;AAAA,IAAA;AAAA,IACvD,EAACjO,MAAA,WAAW,YAAX,OAAA,SAAAA,IAAoB,IAAI;AAAA,EAAA,GAErB,cAAc,MAAM,KAAK,CAAC,SAAS,KAAK,UAAU,KAAK,GACvD,UAAU,WAAW,WAAW,WAAW,QAAQ,WAAW,SAE9D,sBAAsB;AAAA,IAC1B,CAAC,gBAAqB;AACd,YAAA,QAAQ,OAAO,WAAW;AAEhC,aAAO,MAAM,KAAK;AAAA,IACpB;AAAA,IACA,CAAC,KAAK;AAAA,KAGF,sBAAsB;AAAA,IAC1B,CAAC,SACQ,OAAO,MAAM,QAAQ,IAAI,CAAC;AAAA,IAEnC,CAAC,KAAK;AAAA,EAGF,GAAA,UAAU,SAEV,eAAe;AAAA,IACnB,CAAC,aAAsD;AACrD;AAAA,QACE,WAAW,KAAK,QAAO,YAAU,OAAA,SAAA,SAAA,SAAU,MAAc,MAAU,IAAA,IAAI,SAAS,KAAK,CAAC;AAAA,MAAA;AAAA,IAE1F;AAAA,IACA,CAAC,QAAQ;AAAA,KAGL,qBAAqB;AAAA,IACzB,CAAC,UAA0C;AACzC,YAAM,WAAW,oBAAoB,MAAM,cAAc,KAAK;AAE9D,UAAI,CAAC,UAAU;AACb,qBAAa,UAAU;AACvB;AAAA,MACF;AAEA,mBAAa,QAAQ;AAAA,IACvB;AAAA,IACA,CAAC,cAAc,mBAAmB;AAAA,EAAA,GAG9B,UAAU,UACd;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,OAAO;AAAA,MACP;AAAA,MACA;AAAA,MACA,aAAW,KAAA,WAAW,YAAX,OAAA,SAAA,GAAoB,cAAa;AAAA,MAC5C,gBAAgB;AAAA,MAChB,UAAU;AAAA,MACV;AAAA,IAAA;AAAA,EAAA,IAGF;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ,gBAAgB;AAAA,MAChB,OAAO,oBAAoB,WAAW;AAAA,MACtC;AAAA,MACA,UAAU;AAAA,MAET,UAAA,CAAC,YAAY,GAAG,KAAK,EAAE,IAAI,CAAC,MAAM,MACjC,oBAAC,YAAwB,OAAO,IAAI,GACjC,UAAK,KAAA,SADK,GAAG,IAAI,CAAC,EAErB,CACD;AAAA,IAAA;AAAA,EAAA;AAIH,SAAA,oBAAC,mBAAgB,MAAY,WAAW,SAAS,UAAU,CAAC,CAAC,SAC1D,UACH,QAAA,CAAA;AAEJ;AAEA,MAAM,cAAc,WAAW,SAC7BX,QAWA,KACA;AACM,QAAA,EAAC,OAAO,OAAO,UAAU,SAAS,UAAU,gBAAgB,WAAW,QAAW,IAAAA;AAItF,SAAA,oBAAC,QAAK,QAAM,IAAC,SAAS,GAAG,QAAQ,GAC/B,UAAA,oBAHW,cAAc,eAAe,SAAS,OAGhD,EAAO,OAAO,GAAG,MAAK,SACpB,UAAM,MAAA,IAAI,CAAC,MAAM,UAChB;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA;AAAA,MAEA;AAAA,MACA;AAAA,MACA;AAAA,MACA,KAAK,UAAU,IAAI,MAAM;AAAA,MACzB;AAAA,IAAA;AAAA,IALK;AAAA,EAAA,CAOR,GACH,EACF,CAAA;AAEJ,CAAC,GAEK,kBAAkB,WAAW,SACjCA,QAUA,KACA;AACA,QAAM,EAAC,gBAAgB,SAAS,MAAM,UAAU,SAAS,UAAU,MAAA,IAASA,QAEtE,eAAe,YAAY,MAAM;AACrC,aAAS,IAAI;AAAA,EAAA,GACZ,CAAC,MAAM,QAAQ,CAAC;AAEnB,SACG,qBAAA,MAAA,EAAK,IAAG,SAAQ,OAAM,UACrB,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,SAAS,UAAU;AAAA,QACnB,UAAU;AAAA,QACV;AAAA,QACA;AAAA,QACA;AAAA,QACA,MAAM;AAAA,MAAA;AAAA,IACR;AAAA,IAEC,oBAAA,KAAA,EAAI,YAAY,GACf,UAAC,oBAAA2B,QAAA,EAAK,MAAM,GAAG,QAAO,UACnB,UAAK,KAAA,MACR,CAAA,GACF;AAAA,EACF,EAAA,CAAA;AAEJ,CAAC;ACjMM,SAAS,mBAAmB,MAAwB;AACzD,SAAO,UAAU,MAAM,MAAM,IAAI,cAAc;AACjD;ACFO,SAAS,mBAAmB,MAAwB;AACzD,SAAO,UAAU,MAAM,MAAM,IAAI,cAAc;AACjD;ACaA,SAAS,iCAAiC,MAAoD;AACxF,MAAAgF,KAAQ,SAAS,IAAI;AACvB,WAAO,kBAAkB,IAAuB;AAG9C,MAAAA,KAAQ,aAAa,IAAI;AACpB,WAAA;AAIL,MAAAA,KAAQ,UAAU,IAAI;AACxB,WAAO,mBAAmB,IAAwB;AAGhD,MAAAA,KAAQ,UAAU,IAAI;AACxB,WAAO,mBAAmB,IAAwB;AAItD;AAEO,SAAS,6BACd,YACkD;AA5CpD,MAAAhG;AA6CM,OAAAA,MAAA,WAAW,eAAX,QAAuBA,IAAA;AAAO,WAAO,WAAW,WAAW;AAEzD,QAAA,4BAA4B,iCAAiC,UAAU;AACzE,MAAA;AACK,WAAA;AAIT,QAAM,UADYqH,eAAa,YAAgB,oBAAA,IAAA,CAAK,EAC1B;AAAA,IACxB,CAAC,KAAK,UACJ,IAAI,KAAK,IAAI,IAAI,MACV;AAAA,IAET,CAAC;AAAA,EAIG,GAAA,UAAU,OAAO,OAAO,OAAO,EAAE,KAAK,CAACnH,OAAM,cAAcA,GAAE,IAAI,CAAC;AAEpE,MAAA;AACK,WAAA,cAAc,QAAQ,IAAI;AAGnC,QAAM,IAAI,MAAM,oDAAoD,WAAW,IAAI,IAAI;AACzF;AAEO,SAAS,+BACd,YACoD;AAzEtD,MAAAF;AA0EE,UAAIA,iBAAW,eAAX,QAAAA,IAAuB,UAAgB,WAAW,WAAW,UAE1D;AACT;ACnDA,SAAS8H,UAAQ;AAAA,EACf;AAAA,EACA;AAAA,EACA;AACF,GAIa;AACX,SAAI,WACK,gBAEL,YACK,aAEF,cAAc,YAAY;AACnC;AACA,MAAMC,uBAAqB,EAAC,QAAQ,IAAM,MAAM,UAE1C,GAAA,oBAAoB,EAAC,UAAU;AAE9B,SAAS,YAAkD1I,QAA+B;AA/CjG,MAAAW,KAAA,IAAA,IAAA,IAAA,IAAA;AAgDQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAY,EAAC,cAAa;AAAA,EAC5B,IAAIX,QACE,EAAC,GAAAa,OAAK,eAAe,GAErB,WAAW,CAAC,cAAYF,uBAAiB,YAAjB,OAAA,SAAAA,IAA0B,cAAa,IAC/D,kBAAkB,iBAAiB,IAEnC,iBAAiB,OAA8B,IAAI;AAGzD,iCAA+B,gBAAgB,IAAI,GAEnD,aAAa,SAAS,CAAC,UAAU,aAAa;AA3EhDA,QAAAA;AA4EQ,KAAC,YAAY,YAAY,eAAe,aAE1CA,OAAA,eAAe,YAAf,QAAAA,KAAwB,MAAA;AAAA,EAAA,CAE3B;AAED,QAAM,wBAAyB,MAAc,wBAEvC,kBAAkB,YAAY,MAAM;AAC/B,aAAA;AAAA,MACP,OAAO,CAAC,EAAC,GAAG,OAAO,MAAM,aAAY;AAAA,MACrC,UAAU;AAAA,IAAA,CACX;AAAA,KACA,CAAC,UAAU,KAAK,CAAC,GAEd,eAAe;AAAA,IACnB,CAAC,KAAyB,eAA2B;AAC1C,eAAA;AAAA,QACP,OAAO,CAAC,sBAAsB,UAAU,CAAC;AAAA,QACzC,UAAU;AAAA,MAAA,CACX;AAAA,IACH;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA,GAGL,gBAAgB,iBAAiB,MAAM,EAAI,GAC3C,WAAW,QAAQ,MAChB,cAAc,WAAW,IAAI,OAClC,oBAAC,iBAAc,UAAU,eAAe,YAAY,EAAA,CAAG,GAExD,CAAC,aAAa,CAAC,GAEZ,kBAAkB,mBAAmB,MAAM,EAAI,GAC/CwE,cAAa,QAAQ,MAClB,gBAAgB,WAAW,IAAI,OACnC,oBAAA,KAAA,EAAI,UAAU,GAAG,UAAU,GAC1B,8BAAC,2BAA0B,EAAA,YAAY,iBAAiB,wBAAsB,IAAC,EACjF,CAAA,GAED,CAAC,eAAe,CAAC,GAEd,YAAY,gBAAgB,KAAK,CAAC,MAAM,EAAE,UAAU,OAAO,GAC3D,cAAc,gBAAgB,KAAK,CAAC,MAAM,EAAE,UAAU,SAAS,GAE/D,OAAO;AAAA,IACX,MACE,WAAW,OACT;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ,oBAAC,mBAAkB,EAAA,UAAU,EAAG,CAAA;AAAA,QACxC,IAAI,GAAGnF,OAAM,OAAO;AAAA,QACpB,2BACG,MACC,EAAA,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAMa,GAAE,4BAA4B;AAAA,cACpC,MAAK;AAAA,cACL,MAAM;AAAA,cACN,SAAS;AAAA,YAAA;AAAA,UACX;AAAA,UACA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAMA,GAAE,+BAA+B;AAAA,cACvC,MAAMiK;AAAAA,cACN,SAAS;AAAA,YAAA;AAAA,UACX;AAAA,UACC,oBAAAF,cAAA,EAAW,OAAO,iBAAiB,UAAU,cAAc;AAAA,QAAA,GAC9D;AAAA,QAEF,SAASlC;AAAAA,MAAA;AAAA,IACX;AAAA,IAEJ,CAAC,iBAAiB,cAAc,UAAU,iBAAiB1I,OAAM,SAAS,UAAUa,EAAC;AAAA,EAAA,GAGjF,OAAO4H,UAAQ,EAAC,UAAU,WAAW,YAAY,CAAA,GACjD,OACJ;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA,YAAAtD;AAAA,MACA;AAAA,MACA;AAAA,MACA,YAAY;AAAA,MACZ,UAAU;AAAA,MAEV,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAG;AAAA,UACH,MAAK;AAAA,UACL,MAAK;AAAA,UACL,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,SAAS;AAAA,UACT,KAAK;AAAA,UACL;AAAA,UACA,sBAAoB;AAAA,UACpB,OAAO;AAAA,UAEN,UAAA;AAAA,YAAc,cAAA;AAAA,cACb,YAAYnF,OAAM;AAAA,cAClB,OAAOA,OAAM;AAAA,cACb,QAAQ;AAAA;AAAA,cAER,qBAAqB;AAAA,YAAA,CACtB;AAAA,YAEA,yBAAyB,oBAAC,cAAa,EAAA,MAAI,GAAC,CAAA;AAAA,UAAA;AAAA,QAAA;AAAA,MAC/C;AAAA,IAAA;AAAA,EAAA,GAIE,gBAAgB,mBAAmB,UAAU;AACnD,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,oBAAC,iBAAgB,EAAA,MAAY,WAAW,SAAS,UAAU,CAAA,CAAQ,SACjE,UAAA,oBAAC,KAAI,EAAA,UAAU,GAAI,UAAA,KAAK,CAAA,GAC1B;AAAA,IACC,QACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QACE,WACIa,GAAE,4BAA4B,EAAC,eAAc,IAC7CA,GAAE,4BAA4B,EAAC,eAAc;AAAA,QAEnD,QAAM,MAAkB,KAAA,oBAAA,OAAA,SAAA,iBAAA,YAAlB,OAA2B,SAAA,GAAA,UAA3B,mBAAkC,SAAQ;AAAA,QAChD,QAAO,MAAkB,MAAA,KAAA,oBAAA,OAAA,SAAA,iBAAA,YAAlB,mBAA2B,UAA3B,OAAA,SAAA,GAAkC,UAAlC,OAA2C,KAAA;AAAA,QAClD,IAAI,MAAM;AAAA,QACV;AAAA,QACA,WAAW;AAAA,QACX,yBAAyB,eAAe;AAAA,QAEvC;AAAA,MAAA;AAAA,IACH;AAAA,EAEJ,EAAA,CAAA;AAEJ;AClMO,SAAS,yBAAyBb,QAAsC;AACvE,QAAA,EAAC,SAAS,aAAgB,IAAAA;AAG9B,SAAA,oBAAC,wBAAwB,UAAxB,EAAiC,OAAO,EAAC,SAAS,aAChD,GAAA,UAAAA,OAAM,SACT,CAAA;AAEJ;AC4BA,SAAS,QAAQ;AAAA,EACf;AAAA,EACA;AAAA,EACA;AACF,GAIa;AACX,SAAI,WACK,gBAEL,YACK,aAEF,cAAc,YAAY;AACnC;AACA,MAAM0I,uBAAqB,EAAC,QAAQ,IAAM,MAAM,UAAS;AAElD,SAAS,cACd1I,QACA;AAxEF,MAAAW,KAAA,IAAA,IAAA,IAAA,IAAA,IAAA;AAyEQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAAwE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAY,EAAC,UAAU,WAAW,aAAa,eAAe,aAAY;AAAA,EAAA,IACxEnF,QAEE,WAAW,CAAC,cAAYW,MAAA,iBAAiB,YAAjB,OAAA,SAAAA,IAA0B,cAAa,IAC/D,kBAAkB,iBAAiB,IAEnC,aAAa,OAA8B,IAAI,GAC/C,UAAU,OAA8B,IAAI,GAC5C,eAAe,OAA8B,IAAI,GAEjD,EAAC,mBAAmB,kBAAAoH,mBAAkB,eAAe,8BACzD,kBAAkB;AAAA,IAChB;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAGH,iCAA+B,YAAY,IAAI,GAE/C,aAAa,SAAS,CAAC,UAAU,aAAa;AA5GhDpH,QAAAA;AA6GQ,KAAC,YAAY,YAAY,WAAW,aAEtCA,OAAA,WAAW,YAAX,QAAAA,KAAoB,MAAA;AAAA,EAAA,CAEvB;AAEK,QAAA,YAAYX,OAAM,WAAW,KAAK,CAAC,MAAM,EAAE,UAAU,OAAO,GAC5D,cAAcA,OAAM,WAAW,KAAK,CAAC,MAAM,EAAE,UAAU,SAAS,GAChE,wBAAyB,MAAc,wBAEvC,kBAAkB,YAAY,MAAM;AAC/B,aAAA;AAAA,MACP,OAAO,CAAC,EAAC,GAAG,OAAO,MAAM,aAAY;AAAA,MACrC,UAAU;AAAA,IAAA,CACX;AAAA,KACA,CAAC,UAAU,KAAK,CAAC,GAEd,eAAe;AAAA,IACnB,CAAC,KAAyB,eAA2B;AAC1C,eAAA;AAAA,QACP,OAAO,CAAC,EAAC,GAAG,sBAAsB,UAAU,GAAG,MAAM,UAAU,GAAE;AAAA,QACjE,UAAU;AAAA,MAAA,CACX;AAAA,IACH;AAAA,IACA,CAAC,QAAQ;AAAA,EAEL,GAAA,wBAAwB8H,mBAAiB,SAAA,OAAA,SAAA,MAAO,MAAMC,iBAAgB,GAEtE,SAAS,MAAM,MACf,gBAAc,KAAA,sBAAsB,WAAtB,OAA8B,SAAA,GAAA,WAAQ,KAAO,SAAA,OAAA,SAAA,MAAA,yBAAP,OAA6B,SAAA,GAAA,OACjF,2BAA2B,YAAU,uCAAsB,WAAtB,OAAA,SAAA,GAA8B,YAA9B,OAAA,SAAA,GAAuC,cAAvC,OAAA,SAAA,GAAkD,MAEvF,kCAAkC,YAAY,MAAM;AAC/C,aAAA;AAAA,MACP,WAAW,SAAS,KAAO,IAAI,IAAM,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC;AAAA,MACjE,MAAM,CAAC,sBAAsB,CAAC;AAAA,IAAA,CAC/B;AAAA,EAAA,GACA,CAAC,UAAU,WAAW,IAAI,CAAC,GAExB,UAAU,cACZ,WAAW,GAAG,KAAK,CAAC,WAAW,OAAO,SAAS,WAAW,IAC1D,QACE,UAAU,kBAAkB,WAC5B,WAAW,kBAAkB,YAE7B,OAAO,QAAQ,EAAC,UAAU,WAAW,YAAY,CAAA,GACjD,YAAY,CAAC,UAAU,UAAU,CAAC,MAAM,QAExC,EAAC,GAAAlH,OAAK,kBAEN,WAAW;AAAA,IACf;AAAA;AAAA,MAEE,WAAW,SACT,WACA,MACA;AAEE,eAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACE,GAAG;AAAA,YACJ,QAAO;AAAA,YACP,QAAQ,EAAC,IAAI,+BAAO,MAAM,MAAM,mCAAS,KAAI;AAAA,YAC7C,QAAO;AAAA,YACP,KAAI;AAAA,YACJ,KAAK;AAAA,UAAA;AAAA,QAAA;AAAA,MACP,CAEH;AAAA;AAAA,IACH,CAAC,WAAA,OAAA,SAAA,QAAS,MAAM,SAAA,OAAA,SAAA,MAAO,IAAI;AAAA,EAAA,GAGvB,gBAAgB,YAAY,MAAM;AAEpC,gBADE,UAAU,YACA,CAEA,IAAA,CAAC,MAAM,CAFL;AAAA,EAAA,GAIf,CAAC,QAAQ,WAAW,WAAW,CAAC,GAE7B,OAAO;AAAA,IACX,MACE,WAAW,OACT;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ,oBAAC,mBAAkB,EAAA,UAAU,EAAG,CAAA;AAAA,QACxC,IAAI,GAAG,OAAO;AAAA,QACd,MACE,qBAAC,MAAK,EAAA,KAAK,SACR,UAAA;AAAA,UAAA,CAAC,YAEE,qBAAA,UAAA,EAAA,UAAA;AAAA,YAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAMA,GAAE,gCAAgC;AAAA,gBACxC,MAAK;AAAA,gBACL,MAAM;AAAA,gBACN,SAAS;AAAA,cAAA;AAAA,YACX;AAAA,YACA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAMA;AAAA,kBACJ,UAAU,YACN,2CACA;AAAA,gBACN;AAAA,gBACA,MAAM,UAAU,YAAY,YAAY8H;AAAAA,gBACxC,SAAS;AAAA,cAAA;AAAA,YACX;AAAA,YACA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAM9H,GAAE,mCAAmC;AAAA,gBAC3C,MAAMiK;AAAAA,gBACN,SAAS;AAAA,cAAA;AAAA,YACX;AAAA,YACC,oBAAAF,cAAA,EAAW,UAAU,cAAc,OAAO,iBAAiB;AAAA,UAAA,GAC9D;AAAA,UAGD,CAAC,YAAY,CAAC,aAAa,8BAAW,aAAY,EAAA;AAAA,UAClD,CAAC,aAAa,UACb;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,IAAI;AAAA,cACJ,WAAQ;AAAA,cACR,MAAM/J,GAAE,yCAAyC;AAAA,cACjD,MAAM+H;AAAAA,YAAA;AAAA,UACR;AAAA,QAAA,GAEJ;AAAA,QAEF,SAASF;AAAAA,MAAA;AAAA,IACX;AAAA,IAEJ;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA7H;AAAA,IACF;AAAA,EAAA,GAGI,4BAA4B,YAAY,MAAM;AAClD,aAAS,WAAW,SAAS,KAAO,IAAI,IAAM,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC;AAAA,KAC1E,CAAC,UAAU,UAAU,CAAC,GAEnB,iBAAiB,SAAA,QAAA,MAAO,QAAQ,SAAS,UACzC,eAAe,WAAW,SAAS,KAAO,SAAS,UAKnD,sBACJ,UAAU,CAAC,sBAAsB,cAAa,SAAO,OAAA,SAAA,MAAA,uBAEjD,sBACJ,CAAC,sBAAsB,eACvB,KAAsB,sBAAA,WAAtB,OAA8B,SAAA,GAAA,aAAa,cAC3C,UACA,mBAAmB,gBACnB,CAAC,qBAEG,SAED,qBAAA,UAAA,EAAA,UAAA;AAAA,IAA6B,6BAAA,4BAA4B,MAAM,wBAC9D;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,IAED,uBACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,IAED,sBAAsB,SACrB;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAc,sBAAsB,MAAM;AAAA,QAC1C,eAAe,sBAAsB;AAAA,MAAA;AAAA,IACvC;AAAA,EAAA,GAEJ,GAGI,OACH,oBAAA,0BAAA,EAAyB,SAAkB,cAC1C,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,YAAY;AAAA,MACZ,UACE,CAAC,aAAa,SAAS,SAAS,KAAM,oBAAA,eAAA,EAAc,UAAoB,YAAY,EAAG,CAAA;AAAA,MAEzF,YACE,CAAC,aACDsE,YAAW,SAAS,KAAK,oBAAC,6BAA0B,YAAAA,aAAwB;AAAA,MAE9E;AAAA,MACA,QAAQ,YAAY,SAAY;AAAA,MAChC,MAAM,YAAY,SAAY;AAAA,MAC9B;AAAA,MAEC,sBACE,oBAAA,KAAA,EAAI,SAAS,GAAG,KAAK,cACpB,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,OAAO,WAAW;AAAA,UAClB,aAAa,WAAW;AAAA,UACxB,qBAAqB;AAAA,UACrB,YAAAA;AAAA,UACA;AAAA,UACA,YAAY,WAAW;AAAA,UAEtB;AAAA,QAAA;AAAA,SAEL,IAEA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAI;AAAA,UACJ,MAAK;AAAA,UACL,QAAQ;AAAA,UACR,YAAY,SAAO,OAAA,SAAA,MAAA;AAAA,UACnB,cAAc,WAAS,OAAA,SAAA,QAAA;AAAA,UACvB,UAAU;AAAA,UACV,sBAAoB;AAAA,UACpB;AAAA,UACA;AAAA,UACA,iBAAe,WAAW,KAAO;AAAA,UACjC,gBAAc,UAAU,KAAO;AAAA,UAC9B,GAAG;AAAA,UAEJ,UAAA;AAAA,YAAA;AAAA,cAACsC;AAAAA,cAAA;AAAA,gBACC;AAAA,gBACA,eAAe;AAAA,gBACf;AAAA,gBACA,MAAM;AAAA,cAAA;AAAA,YACR;AAAA,YACC,yBAAyB,oBAAC,cAAa,EAAA,MAAI,GAAC,CAAA;AAAA,UAAA;AAAA,QAAA;AAAA,MAC/C;AAAA,IAAA;AAAA,EAGN,EAAA,CAAA;AAEF,SACG,oBAAA,iBAAA,EAAgB,MAAY,WAAW,SAAS,UAAU,CAAQ,CAAA,SACjE,UAAC,oBAAA,KAAA,EAAI,UAAU,GAAI,gBAAK,EAC1B,CAAA;AAEJ;AC3VO,SAAS,4BACd,YACiD;AAVnD,MAAA9G;AAWM,UAAAA,MAAA,WAAW,eAAX,QAAAA,IAAuB,OAAa,WAAW,WAAW,OAE1D,sBAAsB,UAAU,IAC3B,gBAGF;AACT;ACHA,MAAM2M,kBAAuB;AAAA,EAC3B,WAAW;AACb,GACM,gBAAuB;AAAA,EAC3B,WAAW;AACb;AAKA,SAAS,mBAAmBtN,QAKlB;AACR,QAAM,EAAC,UAAU,IAAM,UAAU,YAAY,OAAO,aAAgB,IAAAA,UAAS,CAAC,GACxE,EAAC,sBAAqB,wBAAwB;AAC7C,SAAA;AAAA,IACL,MACM,CAAC,WAAW,CAAC,gBAAgB,CAAC,aAAmB,GAAG,aAAa,IAE9D,kBAAkB,cAA6B,YAAY,EAAC,SAAA,CAAS,EAAE;AAAA,MAC5E,IAAI,CAAC,WAAW,EAAC,WAAW,IAAO,OAAO,MAAM,YAAY,OAAW,EAAA;AAAA,MACvE,WAAW,CAAC,UAAU,GAAG,EAAC,WAAW,IAAO,MAAK,CAAC,CAAC;AAAA,IACrD;AAAA,IAEF,CAAC,SAAS,mBAAmB,UAAU,YAAY,YAAY;AAAA,IAC/DsN;AAAAA,EAAA;AAEJ;AC1CO,MAAM,qBACX,OAAO,SAAW,MACdzH,UACA,UAAU,QAAQ,mBAAmB,EAAE,KAAK,YAAY,CAAC,CAAC,GCHnD,UACX,OAAO,SAAW,MAAcA,UAAQ,UAAU,QAAQ,QAAQ,EAAE,KAAK,YAAY,CAAC,CAAC,GCD5E,UACX,OAAO,SAAW,MACdA,UACA,UAAU,QAAQ,UAAU,EAAC,SAAS,IAAM,SAAS,GAAI,CAAC,EAAE,KAAK,YAAY,CAAC,CAAC,GCC/E,iBAAiB;AAKvB,SAAS,kCAAkC;AACzC,SACE,OAAO,SAAW,OAClB,0BAA0B,UAC1B,+BAA+B,UAC/B,uBAAuB,0BAA0B,aAI3C,oBAAoB,0BAA0B,aAClD,OAAO,eAAe,0BAA0B,WAAW,kBAAkB;AAAA,IAC3E,MAAM;AACJ,aAAO,KAAK,oBAAoB;AAAA,IAClC;AAAA,EAAA,CACD,GAEI,MAEF;AACT;AAIO,MAAM,4BAA4B,gCACrC,IAAA,oCACA,kBAAkB;AAItB,SAAS,kCAA6D;AACpE,QAAM,qCAAqC,IAAI,WAEzC,uBAAuB,IAAI;AAAA,IAC/B,CAAC,YAAY;AACH,cAAA,QAAQ,CAAC,UAAU;AACzB,2CAAmC,KAAK,KAAK;AAAA,MAAA,CAC9C;AAAA,IACH;AAAA,IACA;AAAA,MACE,WAAW;AAAA,MACX,YAAY,GAAG,cAAc;AAAA,IAC/B;AAAA,EAAA;AAIF,SAAO,SAAmC,SAAS;AACjD,WAAO,IAAI,WAAW,CAAC,cACrB,qBAAqB,QAAQ,OAAO,GACpC,SAAS,KAAA,GACF,MAAM,qBAAqB,UAAU,OAAO,EACpD,EAAE;AAAA,MACD,SAAS,MAAM,mCAAmC,cAAc;AAAA,MAChE,OAAO,CAAC,UAAqC,MAAM,WAAW,OAAO;AAAA,MACrE,IAAI,CAAC,QAAQ;AAAA,QACX,gBAAgB,GAAG;AAAA,MAAA,EACnB;AAAA,IAAA;AAAA,EACJ;AAEJ;AAGA,SAAS,oBAAoB;AAC3B,WAAS,cAAc;AACd,WAAA;AAAA,MACL,MAAM;AAAA,MACN,OAAO,OAAO;AAAA,MACd,KAAK;AAAA,MACL,QAAQ,OAAO;AAAA,IAAA;AAAA,EAEnB;AAES,WAAA,WACP,MACA,UACA,QACA;AACA,WACE,KAAK,QAAQ,SAAS,QAAQ,UAC9B,KAAK,SAAS,SAAS,OAAO,UAC9B,KAAK,OAAO,SAAS,SAAS,UAC9B,KAAK,UAAU,SAAS,MAAM;AAAA,EAElC;AAEA,WAAS,WAAW,SAAsB;AACxC,WAAO,MAAM,WAAW,QAAQ,sBAAyB,GAAA,YAAA,GAAe,cAAc;AAAA,EACxF;AAGA,SAAO,SAAmC,SAAqD;AACvF,UAAA,sBAAsB,WAAW,OAAO;AACvC,WAAA,MAAMW,GAAa,oBAAqB,CAAA,GAAG,SAAS,SAAS,kBAAkB,EAAE;AAAA;AAAA,MAEtF,IAAI,mBAAmB;AAAA,MACvB,IAAI,CAAC,oBAAoB,EAAC,eAAgB,EAAA;AAAA,IAAA;AAAA,EAC5C;AAEJ;AC1GO,MAAM,oBACX,OAAO,SAAW,MACdX,UACA,UAAU,UAAU,kBAAkB,EAAE,KAAK,YAAY,CAAC,CAAC;ACC1D,SAAS,cAAc7F,QAAmE;AACzF,QAAA,EAAC,SAAS,YAAY,EAAC,IAAIA,QAC3B,CAAC,SAAS,UAAU,IAAI,SAAS,EAAK;AAE5C,SAAA,UAAU,MAAM;AACd,QAAI,CAAC;AACH;AAGF,UAAM,qBAAqB;AAAA,MACzB,GAAG,CAAC,SAAS,MAAM;AAAA,MACnB,kBAAkB;AAAA,QAChB,IAAI,CAAC,UAAO;AAnBpB,cAAAW;AAmBwB,iBAAA,MAAM,kBAAkB,WAAW,GAACA,MAAO,SAAA,OAAA,SAAA,MAAA,WAAP,YAAe,UAAS;AAAA,QAAA,CAAM;AAAA,MACpF;AAAA,IAAA,EACA,KAAK,sBAAsB,GAEvB,cAAc,0BAA0B,OAAO,EAAE;AAAA,MACrD,IAAI,CAAC,UAAU,MAAM,cAAc;AAAA,IAAA,GAS/BkO,OANW,mBAAmB;AAAA,MAClC,UAAU,CAAC,sBAAuB,oBAAoB,cAAc,GAAG,EAAK,CAAE;AAAA,MAC9E,UAAU,CAAC,cAAe,YAAY,GAAG,EAAI,IAAI,GAAG,EAAK,EAAE,KAAK,MAAM,SAAS,CAAC,CAAE;AAAA,MAClF,qBAAqB;AAAA,IAAA,EAGF,UAAU,UAAU;AAElC,WAAA,MAAMA,KAAI;EAChB,GAAA,CAAC,SAAS,SAAS,CAAC,GAEhB;AACT;ACvCO,MAAM,cAAc;ACIpB,SAAS,oBAAoB,OAAqC;AAChE,SAAA,oBAAoB,+BAAO,OAAO;AAC3C;AAEA,SAAS,qBAAqB,OAAoC;AACzD,SAAA,SAAS,KAAK,IAAI,QAAQ;AACnC;AACA,SAAS,oBAAoB,OAAyC;AAXtE,MAAAlO,KAAA;AAYM,MAAA,CAACJ,WAAS,KAAK;AAAG;AAEtB,QAAM,WAAW,OAAO,MAAM,YAAa,WAAW,MAAM,WAAW,GACjE,YAAY,qBAAqB,MAAM,aAAa,MAAM,SAAS,GACnE,YAAY,qBAAqB,MAAM,WAAW,MAAM,SAAS,GACjE,WAAW,sBAAsBI,qCAAO,SAAP,OAAA,SAAAA,IAAqB,IAAI,GAC1D,WAAW,sBAAsB,KAAA,SAAA,OAAA,SAAA,MAAO,SAAP,OAAqB,SAAA,GAAA,IAAI,GAC1D,eAAe,qBAAqB,MAAM,YAAY;AAExD,MAAA,aAAa,aAAa,YAAY;AACjC,WAAA;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAM,EAAC,MAAM,UAAU,MAAM,SAAQ;AAAA,MACrC;AAAA,IAAA;AAKN;ACPO,SAAS,cACdX,QAGc;AACR,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EACD,IAAAA,QAEE,EAAC,GAAAa,OAAK,eAAe,GACrB,CAAC,SAAS,UAAU,IAAI,SAAgC,IAAI,GAG5D,YAAY,cAAc;AAAA,IAC9B,SAAS,sBAAsB,OAAO;AAAA,IACtC,WAAW;AAAA,EAAA,CACZ,GAGK,UAAUiO,mBAAgB;AAAA,IAC9B,SAAS,uBAAuB;AAAA,IAChC;AAAA,IACA;AAAA,EAAA,CACD,GAEK,QAAuB;AAAA,IAC3B,OAAO;AAAA,MACL,GAAG;AAAA,MACH,WAAU,uCAAW,aAAY;AAAA,MACjC,YAAW,uCAAW,cAAa;AAAA,IAAA;AAAA,IAErC,CAAC,SAAS;AAAA,EAGN,GAAA,cAAc,QAAQ,MAAM,oBAAoB,KAAK,GAAG,CAAC,KAAK,CAAC,GAE/D,QAA+B,QAAQ,MAAM;AAnErD,QAAAnO,KAAA;AAoEI,WAAI,mCAAa,eAEb;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,KAAKE,GAAE,+CAA+C;AAAA,QACtD,KAAK,YAAY;AAAA,MAAA;AAAA,IACnB,KAICF,yCAAS,UAAT,QAAAA,IAAgB,SAKd,KAAS,WAAA,OAAA,SAAA,QAAA,UAAT,OAAgB,SAAA,GAAA,QAJd,WAAW;AAAA,KAKnB,CAAC,SAAS,YAAY,aAAaE,EAAC,CAAC;AAExC,6BACG,OAAI,EAAA,KAAK,YAAY,OACnB,wBAAc,WAAW;AAAA,IACxB,GAAG;AAAA,IACH,IAAI,WAAS,OAAA,SAAA,QAAA,UAAS,CAAC;AAAA,IACvB;AAAA,IACA,OAAO,WAAS,OAAA,SAAA,QAAA;AAAA,IAChB,eAAe,WAAS,OAAA,SAAA,QAAA;AAAA,IACxB;AAAA,IACA;AAAA,EACD,CAAA,EACH,CAAA;AAEJ;AC9FO,MAAMmE,SAAO,OAAO,IAAI,EAAE,CAAChF,WAA0B;AACpD,QAAA,EAAC,OAAO,QAAQ,UAASA,OAAM,MAAM,QAErC,UAAU;AAAA;AAAA;AAAA;AAAA,YAIN,MAAM,CAAC,CAAC;AAAA,eACL,MAAM,CAAC,CAAC;AAAA,aACV,MAAM,CAAC,CAAC;AAAA,cACP,MAAM,CAAC,CAAC;AAAA,qBACD,OAAO,CAAC,CAAC;AAAA,sBACR,MAAM,OAAO,WAAW,UAAU;AAAA;AAG/C,SAAA;AAAA;AAAA,qBAEY,OAAO,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAWG,MAAM,MAAM,QAAQ,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAOzD,OAAO;AAAA,4BACW,MAAM,OAAO,KAAK,OAAO,GAAG,EAAE,MAAM,KAAK,OAAO,EAAE,EAAE,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAMzE,OAAO;AAAA,4BACW,MAAM,MAAM,QAAQ,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,iCAKzB,MAAM,MAAM,QAAQ,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAOzD,OAAO;AAAA,4BACW,MAAM,MAAM,QAAQ,QAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,iCAKzB,MAAM,MAAM,QAAQ,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA;AAKnE,CAAC,GAEY,mBAAmB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA,GAO7B,yBAAyB,OAAO;AAAA,EAC3C,CAAC,EAAC,OAAO,kBAAuD;AACxD,UAAA,EAAC,MAAK,IAAI,MAAM;AAEf,WAAA;AAAA;AAAA,eAEI,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,sBAID,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA,QAGtB,CAAC,eACH;AAAA;AAAA,OAEC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAML;AACF,GAEa,YAAY,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQvB,oBAAoB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAS9B,oBAAoB,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQ/B,aAAa,OAAO,GAAG;AAAA;AAAA,GCpG9BoF,kBAA4C;AAAA,EAChD,eAAe;AAAA,EACf,WAAW;AAAA,EACX,QAAQ;AAAA,EACR,MAAM;AACR;AAEO,SAAS,uBAAuBpF,QAAkD;AACjF,QAAA,EAAC,UAAU,SAAS,QAAQ,QAAQ,UAAU,UAAU,MAAK,IAAIA,QACjE,EAAC,GAAAa,GAAC,IAAI,kBACN,eAAe,MAAM,GACrB,aAAa,OAAiC,IAAI,GAClD,YAAY,OAAgB,EAAK,GAEjC,gBAAgB;AAAA,IACpB,MACEmJ,cAAY,KAAK,IACb,WAAW,SAAuB,WAAW,KAAyC;AACpF,aAAQ,oBAAA,YAAA,EAAY,GAAG,WAAW,QAAO,QAAO,QAAQ,EAAC,IAAI,MAAM,KAAI,GAAG,IAAU,CAAA;AAAA,IACrF,CAAA,IACD;AAAA,IACN,CAAC,KAAK;AAAA,EAAA;AAGR,YAAU,MAAM;AACV,eACF,UAAU,UAAU;AAAA,EAAA,GAErB,CAAC,MAAM,CAAC,GAGX;AAAA,IACE;AAAA,MACE,CAAC,UAAU;AACJ,mBAGD,MAAM,QAAQ,SACZ,WAAW,WAAW,CAAC,UAAU,WAAW,CAAC,WAC/C,MAAM,eAAe,GACrB,MAAM,mBACN,WAAW,QAAQ,MACnB,GAAA,UAAU,UAAU;AAAA,MAG1B;AAAA,MACA,CAAC,SAAS,MAAM;AAAA,IAClB;AAAA,EAAA;AAGF,QAAM,eAAe;AAAA,IACnB,CAAC,UAAsC;AACrC,YAAM,eAAe,GACrB,MAAM,mBACN,SAAS;AAAA,IACX;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA;AAGX,8BACG,MACC,EAAA,UAAA;AAAA,IAAC,oBAAA,KAAA,EAAI,MAAM,GAAI,SAAS,CAAA;AAAA,wBACvB,KACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QACE;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,cAAYnJ,GAAE,iDAAiD;AAAA,YAC/D,MAAM;AAAA,YACN,MAAK;AAAA,YACL,UAAU;AAAA,YACV,UAAU,UAAU,IAAI;AAAA,YACxB,cAAc,EAAC,SAAS,YAAW;AAAA,UAAA;AAAA,QACrC;AAAA,QAEF,KAAK;AAAA,QACL,IAAI;AAAA,QACJ,MACG,oBAAA,MAAA,EACC,UACG,qBAAA,UAAA,EAAA,UAAA;AAAA,UAAU,UAAA,SAAS,MAAM,QACxB;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,IAAI;AAAA,cACJ,WAAQ;AAAA,cACR,MAAM;AAAA,cACN,MAAMA,GAAE,2CAA2C;AAAA,YAAA;AAAA,UACrD;AAAA,UAGD,YACC;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAM;AAAA,cACN,SAAS;AAAA,cACT,MAAMA,GAAE,iCAAiC;AAAA,YAAA;AAAA,UAC3C;AAAA,UAED,CAAC,YACA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAM;AAAA,cACN,SAAS;AAAA,cACT,MAAMA,GAAE,iCAAiC;AAAA,YAAA;AAAA,UAC3C;AAAA,UAED,CAAC,YACA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAM;AAAA,cACN,SAAS;AAAA,cACT,MAAMA,GAAE,mCAAmC;AAAA,cAC3C,MAAK;AAAA,YAAA;AAAA,UACP;AAAA,QAAA,EAAA,CAEJ,EACF,CAAA;AAAA,QAEF,SAASuE;AAAAA,MAAA;AAAA,IAAA,GAEb;AAAA,EACF,EAAA,CAAA;AAEJ;AChEO,SAAS,YAAYpF,QAAyB;AAnFrD,MAAAW;AAoFQ,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACEX,QACE,EAAC,SAAQ,IAAI,iBACb,GAAA,EAAC,YAAW,eAAiB,EAAA,WAAW,YACxC,CAAC,sBAAsB,uBAAuB,IAAI,SAAkB,EAAK,GACzE,UAAU,uBAAuB,IAAI,GACrCwH,UAAS,yBACT,aAAa,0BAA0B9E,eAAa,IAAI,CAAC,GACzD,aAAa,OAAgB,EAAK,GAElC,gBAAgB;AAAA,IACpB,OAAwB;AAAA,MACtB,QAAQ,EAAC,MAAM,cAAc,QAAQ,EAAC;AAAA,MACtC,OAAO,EAAC,MAAM,cAAc,QAAQ,EAAC;AAAA,IAAA;AAAA,IAEvC,CAAC,YAAY;AAAA,EAAA,GAGT,kBAAkB,YAAY,MAAM,wBAAwB,EAAI,GAAG,CAAA,CAAE,GACrE,iBAAiB,YAAY,MAAM,wBAAwB,EAAK,GAAG,CAAA,CAAE,GAErE,SAAS,YAAY,MAAM;AAC3B,mBAEF,mBAAmB,KAAK8E,OAAM,GAC9B,WAAW,WAAW,KAAK,IAAI;AAAA,EAAA,GAEhC,CAACA,SAAQ,YAAY,UAAU,CAAC,GAE7B,UAAU,YAAY,MAAM;AACpB,gBAAA,GACZ,mBAAmB,OAAOA,SAAQ,aAAa,GAC/C,mBAAmB,MAAMA,OAAM;AAAA,EAAA,GAC9B,CAAC,aAAaA,SAAQ,aAAa,CAAC,GAEjC,WAAW,YAAY,MAAM;AAEjC,QAAI,CAAW,WAAA;AAGX,UAAA;AACF,2BAAmB,OAAOA,SAAQ,eAAe,EAAC,MAAM,UAAS;AAAA,eAC1D,KAAK;AACZ,gBAAQ,MAAM,GAAG;AAAA,MAAA,UACjB;AACA,mBAAW,UAAU;AAAA,MACvB;AAAA,EAAA,GACC,CAACA,SAAQ,aAAa,CAAC;AAK1B;AAAA,IACE,MAAM,MAAM;AACN,iBAAW,WACb,mBAAmB,MAAMA,OAAM;AAAA,IAEnC;AAAA,IACA,CAACA,OAAM;AAAA,EAAA;AAGT,QAAM,oBAA4C,QAAQ,MACpD,gBAAgB,CAAC,qBACZ,EAAC,UAAU,EAAA,IAGhB,gBAAgB,qBACX,EAAC,aAAa,GAAG,cAAc,MAGpC,qBACK;AAAA,IACL,aAAa;AAAA,IACb,cAAc;AAAA,EAAA,IAIX,EAAC,UAAU,EAAA,GACjB,CAAC,cAAc,kBAAkB,CAAC,GAE/B,EAAC,YAAArC,aAAY,UAAU,YAAY,QAAO,IAAI,oBAAoB,cAAA,OAAA,SAAA,WAAY,IAAI,GAClF,mBAAmBqC,QAAO,YAAY,cACtC,aAAqB,QAAQ,SAAS,GAEtC,WAAW,iBAAiB,MAAM,EAAI,GACtC,eAAe;AAAA,IACnB,MAAM,SAAS,OAAO,CAAC,MAAM5H,UAAQ,EAAE,MAAM,IAAI,CAAC;AAAA,IAClD,CAAC,MAAM,QAAQ;AAAA,EAAA,GAIX,iBAAiB,YAAY,cAAc,WAAW,YACtD,iBAAiB;AAAA,IACrB,MACG,kBACC,oBAAC,YACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QACA,YAAAuF;AAAA,QACA;AAAA,MAAA;AAAA,OAEJ,KAEF;AAAA,IACF,CAAC,SAAS,SAAS,qBAAqB,gBAAgBA,WAAU;AAAA,EAAA,GAG9D,SAAS,CAAA,EAAQ,iCAAY,OAAO,OACpC,QAAQ,cAAY,OAAA,SAAA,WAAA,OACpB,YAAW,cAAY,OAAA,SAAA,WAAA,KAAK,SAAQ7E,eACpC,oBAAmBK,+CAAY,eAAZ,OAAA,SAAAA,IAAwB,SAE3C,iBAA6B;AAAA,IACjC,OAAO;AAAA,MACL,6BAA6B;AAAA,MAC7B,8BAA8B;AAAA,MAC9B,6BAA8B,oBAAoB;AAAA,MAClD,UAAU;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAM;AAAA,MACN;AAAA,MACA,MAAM;AAAA,MACN,UAAU;AAAA,MACV,UAAU,CAAQ,CAAA;AAAA,MAClB;AAAA,MACA;AAAA,MACA,eAAe;AAAA,MACf;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,YAAAwE;AAAA,MACA;AAAA,IAAA;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACAA;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAGK,SAAA;AAAA,IACL,MACE;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,KAAK,cAAY,OAAA,SAAA,WAAA;AAAA,QACjB,iBAAiB;AAAA,QAEjB,UAAC,oBAAA,MAAA,EAAK,eAAe,GAAG,SAAS,GAAG,OAAO,QACzC,UAAA,qBAAC,WAAU,EAAA,MAAM,GACf,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,WAAU;AAAA,cACV,QAAO;AAAA,cAEP,UAAU,SAAS,KAAO,CAAC;AAAA,cAC3B,SAAS;AAAA,cAET,8BAAC,kBAAkB,EAAA,GAAG,mBACnB,UAAe,eAAA,YAAY,cAAc,GAC5C;AAAA,YAAA;AAAA,UACF;AAAA,UACA,oBAAC,mBAAkB,EAAA,aAAa,GAC9B,UAAA,oBAAC,qBACE,UAAsB,sBAAA,SAAS,WAAW,CAAC,YAC1C;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,OAAO;AAAA,cACP;AAAA,cACA;AAAA,YAAA;AAAA,aAGN,EACF,CAAA;AAAA,UAEC,gBAAgB,cACf;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,aAAa,WAAW,OAAO,KAAK;AAAA,cACpC,YAAY;AAAA,cACZ,aAAa;AAAA,cAEb,UAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,UAAU;AAAA,kBACV,WAAW,WAAW,OAAO,KAAK;AAAA,kBAClC,MAAM,WAAW,OAAO,KAAK;AAAA,kBAC7B,iBAAiB;AAAA,gBAAA;AAAA,cACnB;AAAA,YAAA;AAAA,UACF;AAAA,UAGD,4CAAyB,6BAA4B,EAAA;AAAA,QAAA,EAAA,CACxD,EACF,CAAA;AAAA,MAAA;AAAA,IACF;AAAA,IAEF;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAEJ;AAEa,MAAA,8BAA8B,CAACnF,WAAsB;AAC1D,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAAmF;AAAA,EAAA,IACEnF,QAEE,EAAC,GAAAa,OAAK,kBACN,iBAAiB,QAAQ,KAAK,GAC9B,WAAWsE,YAAW,OAAO,CAAC,MAAM,EAAE,UAAU,OAAO,EAAE,SAAS,GAClE,aAAaA,YAAW,OAAO,CAAC,MAAM,EAAE,UAAU,SAAS,EAAE,SAAS,GACtE,aAAqB,QAAQ,SAAS,GACtC,OAAO,YAAY,UAAU,YAAY,WAEzC,0BAA0B;AAAA,IAC9B,CAAC,MAAkD;AACjD,QAAE,eAAe,GACjB,EAAE,mBACF,OAAO;AAAA,IACT;AAAA,IACA,CAAC,MAAM;AAAA,EAAA;AAGT,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA;AAAA,MAACH;AAAAA,MAAA;AAAA,QACC,cAAYnE,GAAE,uCAAuC;AAAA,QACrD,gBAAc,UAAU,KAAK;AAAA,QAC7B,sBAAoB,iBAAiB,KAAK;AAAA,QAC1C,gBAAc,WAAW,KAAK;AAAA,QAC9B,gBAAc,aAAa,KAAK;AAAA,QAChC,kBAAgB,WAAW,KAAK;AAAA,QAChC,iBAAe,WAAW,KAAK;AAAA,QAC/B,eAAY;AAAA,QACZ,gBAAc,aAAa,KAAK;AAAA,QAChC,MAAM;AAAA,QACN,eAAe;AAAA,QACf,SAAS,iBAAiB,IAAI;AAAA,QAC9B;AAAA,QAEC,UAAc,cAAA;AAAA,UACb,SACE;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,QAAQ;AAAA,cACR;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,YAAA;AAAA,UACF;AAAA,UAEF,QAAQ,iBAAiB,eAAe;AAAA,UACxC;AAAA,UACA,qBAAqB;AAAA,UACrB;AAAA,QAAA,CACD;AAAA,MAAA;AAAA,IACH;AAAA,IACC,QACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,kBAAkB;AAAA,QAClB,aAAY;AAAA,QACZ;AAAA,QACA,WAAW;AAAA,QACX;AAAA,QACA,mBAAmB;AAAA,QACnB,kBAAkB;AAAA,QAEjB;AAAA,MAAA;AAAA,IACH;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACxaO,SAAS,6BACd,YACkD;AAbpD,MAAAF;AAcM,UAAAA,MAAA,WAAW,eAAX,QAAAA,IAAuB,QAAc,WAAW,WAAW,QAC3D,YAAY,UAAU,IACjBoO,qBAEF;AACT;AAEO,SAAS,mCACd,YACkD;AAvBpD,MAAApO;AAwBE,UAAIA,iBAAW,eAAX,QAAAA,IAAuB,cAAoB,WAAW,WAAW,cAC9D;AACT;AAEO,SAAS,kCACd,YAC4D;AA9B9D,MAAAA;AA+BE,UAAIA,iBAAW,eAAX,QAAAA,IAAuB,aAAmB,WAAW,WAAW,aAC7D;AACT;ACVA,SAAS,2BAAgEX,QAGrD;AACZ,QAAA,EAAC,mBAAmB,eAAkB,IAAAA;AAI5C,MAAI,CAAC,eAAe;AACZ,UAAA,IAAI,MAAM,2CAA2C;AAG7D,QAAM,2BAA2B,kBAAkB,eAAe,UAAU,GAEtE,gBAAgB;AAAA,IACpB,CAAC,oBAAuB;AAtC5B,UAAAW;AAuCU,UAAA,GAACA,MAAgB,gBAAA,eAAhB,QAA4BA,IAAA;AAEzB,cAAA,IAAI,MAAM,gEAAgE;AAM5E,YAAA,EAAC,YAAAqO,aAAY,GAAG,mBAAkB,gBAAgB,YAClD,8BAA8B,kBAAkB,cAAc;AAC7D,aAAA,cAAc,6BAA6B,eAAe;AAAA,IACnE;AAAA,IACA,CAAC,iBAAiB;AAAA,EAAA;AAGpB,SAAO,cAAc,0BAA0B;AAAA,IAC7C,GAAG;AAAA,IACH;AAAA,EAAA,CACD;AACH;AAKO,SAAS,aAAahP,QAAwD;AACnF,SAAO,2BAA8D;AAAA,IACnE,gBAAgBA;AAAA,IAChB,mBAAmB;AAAA,EAAA,CACpB;AACH;AAKO,SAAS,aAAaA,QAAwD;AACnF,SAAO,2BAA8D;AAAA,IACnE,gBAAgBA;AAAA,IAChB,mBAAmB;AAAA,EAAA,CACpB;AACH;AAKO,SAAS,YAAYA,QAAuD;AACjF,SAAO,2BAA6D;AAAA,IAClE,gBAAgBA;AAAA,IAChB,mBAAmB;AAAA,EAAA,CACpB;AACH;AAKO,SAASiP,iBAAejP,QAA0D;AACvF,SAAO,2BAAyC;AAAA,IAC9C,gBAAgBA;AAAA,IAChB,mBAAmB;AAAA,EAAA,CACpB;AACH;AAKO,SAAS,aAAaA,QAAwD;AACnF,SAAO,2BAA8D;AAAA,IACnE,gBAAgBA;AAAA,IAChB,mBAAmB;AAAA,EAAA,CACpB;AACH;AAKO,SAAS,mBAAmBA,QAAwD;AACzF,SAAO,2BAA8D;AAAA,IACnE,gBAAgBA;AAAA,IAChB,mBAAmB;AAAA,EAAA,CACpB;AACH;AAKO,SAAS,kBACdA,QACc;AACd,SAAO,2BAAwE;AAAA,IAC7E,gBAAgBA;AAAA,IAChB,mBAAmB;AAAA,EAAA,CACpB;AACH;ACtHO,SAAS,mBACd,QACkD;AAdpD,MAAAW,KAAA;AAeE,UAAO,MAAOA,MAAA,OAAA,SAAP,OAAa,SAAAA,IAAA,eAAb,OAAyB,SAAA,GAAA;AAClC;AAEO,SAAS,mBACd,QACkD;AApBpD,MAAAA,KAAA;AAqBE,UAAO,MAAOA,MAAA,OAAA,SAAP,OAAa,SAAAA,IAAA,eAAb,OAAyB,SAAA,GAAA;AAClC;AAEO,SAAS,qBACd,QACoD;AA1BtD,MAAAA,KAAA;AA2BE,UAAO,MAAOA,MAAA,OAAA,SAAP,OAAa,SAAAA,IAAA,eAAb,OAAyB,SAAA,GAAA;AAClC;AAEO,SAAS,kBACd,QACiD;AAhCnD,MAAAA,KAAA;AAiCE,UAAO,MAAOA,MAAA,OAAA,SAAP,OAAa,SAAAA,IAAA,eAAb,OAAyB,SAAA,GAAA;AAClC;AAEO,SAAS,mBACd,QACkD;AAtCpD,MAAAA,KAAA;AAuCE,UAAO,MAAOA,MAAA,OAAA,SAAP,OAAa,SAAAA,IAAA,eAAb,OAAyB,SAAA,GAAA;AAClC;AAEO,SAAS,yBACd,QACkD;AA5CpD,MAAAA,KAAA;AA6CE,UAAO,MAAOA,MAAA,OAAA,SAAP,OAAa,SAAAA,IAAA,eAAb,OAAyB,SAAA,GAAA;AAClC;AAEO,SAAS,wBACd,QAC4D;AAlD9D,MAAAA,KAAA;AAmDE,UAAO,MAAOA,MAAA,OAAA,SAAP,OAAa,SAAAA,IAAA,eAAb,OAAyB,SAAA,GAAA;AAGlC;ACrBO,SAAS,oBAAsE;AACpF,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AAKO,SAAS,oBAAsE;AACpF,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AAKO,SAAS,sBAA0E;AACxF,SAAO,wBAAwB;AAAA,IAC7B,kBAAkBsO;AAAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AAKO,SAAS,mBAAoE;AAClF,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AAKO,SAAS,oBAAsE;AACpF,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AAKO,SAAS,0BAA4E;AAC1F,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AAKO,SAAS,yBAEd;AACA,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AC7FO,SAAS,QAAQjP,QAAmC;AACzD,QAAM,mBAAmB;AACzB,SAAQ,oBAAA,eAAA,EAAe,GAAGA,QAAO,WAAW,iBAAkB,CAAA;AAChE;ACAO,MAAM,qBAAqB;AAAA,EAChC,OAAO;AAAA,EACP,YAAY;AAAA,EACZ,SAAS;AAAA,EACT,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,OAAO;AACT;ACMA,SAAS,eAAe;AACf,SAAA,oBAAC,cAAa,EAAA,WAAU,uCAAuC,CAAA;AACxE;AAaO,SAAS,qBAAqBA,QAAgD;AAC7E,QAAA,EAAC,MAAM,QAAQ,OAAO,WAAW,UAAU,OAAO,SAAS,GAAG,UAAS,IAAIA,QAE3E,SAAS,UAAU,6BAA6B,GAChD,eAAe,QAAQ,MAAM,gBAAgB,MAAM,GAAG,CAAC,MAAM,CAAC,GAI9DkP,eAAc;AAAA,IAClB,CAAC,YAEK;AACE,YAAA,EAAC,WAAc,IAAA;AAInB,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,KAAK,SAAS,KAAK,IAAI,QAAQ;AAAA,UAC/B,gBAAe;AAAA,UACf,KACE,aACG;AAAA,YACC;AAAA,UAAA,EAED,MAAM,WAAW,SAAS,GAAG,EAC7B,OAAO,WAAW,UAAU,GAAG,EAC/B,IAAI,WAAW,GAAG,EAClB,IAAI,WAAW,OAAO,CAAC,EACvB,IAAA,KAAS;AAAA,QAAA;AAAA,MAAA;AAAA,IAIpB;AAAA,IACA,CAAC,cAAc,WAAW,KAAK;AAAA,EAG3B,GAAA,aAAa,YAAY,MACtB,cAAc,QAAQ,YAAY,GACxC,CAAC,IAAI,CAAC,GAEH,QAAQ,QAAQ,MAChB,SAAS,KAEJ,KAGL,mBAAmB,SAAS,KAI5B,eAAe,SAAS,IACnB,YAGL,cAAc,SAAS,IAClBA,eAIL,SAAS,QAAQ,IAEjB;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,KAAK;AAAA,MACL,KAAK,SAAS,KAAK,IAAI,QAAQ;AAAA,MAC/B,gBAAe;AAAA,IAAA;AAAA,EACjB,IAKG,YACN,CAAC,MAAM,UAAU,WAAW,YAAYA,cAAa,KAAK,CAAC,GAExD,eAAoD;AAAA,IACxD,OAAO;AAAA,MACL,GAAG;AAAA;AAAA,MAEH;AAAA,MACA;AAAA,IAAA;AAAA,IAEF,CAAC,OAAO,WAAW,KAAK;AAAA,EAAA,GAGpB,kBAAkB,mBAAmB,UAAU,SAAS,GAExD,WAAW;AAAA,IACf;AAAA,IACA;AAAA,EAAA;AAGF,SAAI,UAEA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,UAAU,CAAC;AAAA,MACX,oBAAoB,CAAC,SAAS;AAAA,MAC9B,WAAU;AAAA,MAGV,UAAA,oBAAC,SAAK,SAAS,CAAA;AAAA,IAAA;AAAA,EAKd,IAAA;AACT;AC7IO,MAAM,uBAAuB,CAAC,OAAO,QAAQ,OAAO,GAC9C,iBAAiB,CAAC,GAAG,sBAAsB,MAAM,GAEjD,wBAAwB;AAAA,EACnC,WAAW;AAAA,EACX,QAAQ;AACV,GAEa,iCAAiC;AAAA,EAC5C,WAAW;AAAA,EACX,QAAQ;AACV,GAEa,yBAAyB;AAAA,EACpC,WAAW;AAAA,EACX,QAAQ;AACV,GAEa,2BAAyC;AAAA,EACpD,OAAO;AAAA,EACP,UAAU;AAAA,EACV,2BAAQ,oBAAmB,EAAA;AAC7B;ACNgB,SAAA,gBAAgB,IAAS,MAAc;AACrD,MAAIC,QACA,QAAwD,IACxD,MAAM;AACV,SAAO,YAAsB,MAAa;AACjC,WAAA,IAAI,WAAW,CAAC,QAAQ;AAC7B,mBAAaA,MAAK,GAClBA,SAAQ,WAAW,OAAO,IAAI;AAC9B,YAAM,YAAuB;AAAA,QAC3B;AAAA,QACA,UAAU;AAAA,QACV,WAAW;AAAA,MAAA,GAEP3P,MAAK;AACL,aAAA,MAAAA,GAAE,IAAI,WACL,MAAM;AAEX,kBAAU,YAAY;AAAA,MAAA;AAAA,IACxB,CACD;AAAA,EAAA;AAGH,WAAS,QAAQ;AACf,UAAM,yBAAyB;AAC/B,YAAQ,CAAA;AAER,UAAM,eAAe,OAAO,KAAK,sBAAsB,EAOpD,OAAO,CAACA,QAAO;AACR,YAAA,YAAY,uBAAuBA,GAAE;AAEpC,aAAA,aAAa,CAAC,UAAU;AAAA,IAAA,CAChC;AAEH,QAAI,aAAa,WAAW;AAE1B;AAEF,UAAM,gBAAgB,aACnB,IAAI,CAACA,QAAO;AACL,YAAA,YAAY,uBAAuBA,GAAE;AAE3C,aAAO,aAAa,UAAU;AAAA,IAAA,CAC/B,EACA,OAAOY,eAAa;AACpB,OAAA,aAAa,EAAE,UAAU;AAAA,MAC1B,KAAK,SAAgB;AACX,gBAAA,QAAQ,CAAC,QAAQ,MAAM;AAC7B,gBAAM,YAAY,uBAAuB,aAAa,CAAC,CAAC;AACpD,uBAAa,CAAC,UAAU,aAC1B,UAAU,SAAS,KAAK,QAAQ,CAAC,CAAC;AAAA,QAAA,CAErC;AAAA,MACH;AAAA,MACA,WAAW;AACI,qBAAA,QAAQ,CAACZ,QAAO;AACrB,gBAAA,QAAQ,uBAAuBA,GAAE;AACnC,mBAAS,CAAC,MAAM,aAClB,MAAM,SAAS;QAAS,CAE3B;AAAA,MACH;AAAA,MACA,MAAM,KAAY;AACH,qBAAA,QAAQ,CAACA,QAAO;AACrB,gBAAA,QAAQ,uBAAuBA,GAAE;AACnC,mBAAS,CAAC,MAAM,aAClB,MAAM,SAAS,MAAM,GAAG;AAAA,QAAA,CAE3B;AAAA,MACH;AAAA,IAAA,CACD;AAAA,EACH;AACF;AC1EA,MAAM,6BAA6B;AAYnC,SAAS,iBAAiB,aAAmC;AACvD,MAAA,QAAkB,CAAA,GAClB,YAAY;AAEhB,QAAM,SAAqB,CAAA;AAE3B,aAAW,cAAc;AAEnB,gBAAY,WAAW,SAAS,KAAK,+BACvC,OAAO,KAAK,KAAK,GACjB,QAAQ,CAAA,GACR,YAAY,IAGd,aAAa,WAAW,SAAS,GACjC,MAAM,KAAK,UAAU;AAGvB,SAAK,OAAO,SAAS,KAAK,KACxB,OAAO,KAAK,KAAK,GAGZ;AACT;AAOA,SAAS,UAAa,OAAY,QAAa;AACvC,SAAA,MAAA,KAAK,GAAG,MAAM,GACb;AACT;AAEgB,SAAA,4BACd,iBACA4P,eAGA;AAIA,WAAS,gCACP5P,KAC6C;AAC7C,UAAM,UAAU,WAAWA,GAAE,GACvB,cAAc,eAAeA,GAAE;AACrC,WAAO,cAAc;AAAA,MACnB,4BAA4B,OAAO;AAAA,MACnC,4BAA4B,WAAW;AAAA,IACxC,CAAA,EAAE;AAAA,MACD,qBAAqB,aAAa;AAAA,MAClC,IAAI,CAAC,CAAC,kBAAkB,oBAAoB,OACnC;AAAA,QACL,OAAO;AAAA,QACP,WAAW;AAAA,MAAA,EAEd;AAAA,IAAA;AAAA,EAEL;AAQA,WAAS,4BAA4BA,KAA8C;AAE1E,WAAA4P,cAAa,EAAC,MAAM5P,IAAE,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE;AAAA,MAC1C,IAAI,CAAC,QAAQe,WAAS,GAAG,KAAK,CAAQ,EAAA,UAAU,OAAO,OAAA,QAAA,IAAK,KAAK;AAAA,MACjE,qBAAqB;AAAA,MACrB,UAAU,CAAC,WACF;AAAA;AAAA,QAEH,GAAG,qBAAqB;AAAA;AAAA;AAAA,QAExB,yBAAyBf,GAAE;AAAA,OAChC;AAAA,IAAA;AAAA,EAEL;AAEM,QAAA,2BAA2B,gBAAgB,SAC/C,MACoC;AAC9B,UAAA,YAAY,CAAC,GAAG,IAAI,IAAIgE,UAAQ,IAAI,CAAC,CAAC;AAC5C,WAAO,KAAK,iBAAiB,SAAS,CAAC,EAAE;AAAA,MACvC,SAAS,iCAAiC,EAAE;AAAA,MAC5C,OAAuD,WAAW,EAAE;AAAA,MACpE,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC,CAAChE,GAAE,MAAM,IAAI,UAAU,QAAQA,GAAE,CAAC,CAAC,CAAC;AAAA,IAAA;AAAA,KAE5D,CAAC;AAEJ,WAAS,gCAAgC,KAAmD;AAC1F,WAAO,MAAM,MAAM;AACjB,YAAM,iBAAiB;AAAA,QACrB,KAAK,gBAAgB,WAAW,OAAO,IAAI,KAAK,GAAG,CAAC;AAAA,QACpD,MAAM;AAAA,QACN,OAAO,EAAC,gBAAgB,OAAM;AAAA,QAC9B,KAAK;AAAA,MAAA;AAEP,aAAO,gBAAgB,WAAW,QAA8B,cAAc,EAAE;AAAA,QAC9E,IAAI,CAAC,aAAa;AACV,gBAAA,UAAU,MAAM,SAAS,WAAW,CAAI,GAAA,CAAC,UAAU,MAAM,EAAE;AAC1D,iBAAA,IAAI,IAAI,CAACA,QAAO;AACf,kBAAA,eAAe,QAAQA,GAAE;AAC/B,gBAAI,CAAC;AAEI,qBAAA;AAET,gBAAI,aAAa,WAAW;AACnB,qBAAA;AAET,gBAAI,aAAa,WAAW;AAEnB,qBAAA;AAET,kBAAM,IAAI,MAAM,oCAAoC,aAAa,MAAM,GAAG;AAAA,UAAA,CAC3E;AAAA,QAAA,CACF;AAAA,MAAA;AAAA,IACH,CACD;AAAA,EACH;AAEA,SAAO,EAAC,gCAA+B;AACzC;ACjKO,SAAS,OAAyB,OAAU;AAC1C,SAAA,OAAO,KAAK,KAAK;AAC1B;ACSA,SAAS,OAAO,QAAiC,KAAU,OAAgB;AAClE,SAAA;AAAA,IACL,GAAG;AAAA,IACH,CAAC,GAAG,GAAG;AAAA,EAAA;AAEX;AAMgB,SAAA,MAA8B,UAA4B,IAAI;AACrE,SAAA,CAAC,WACC,IAAI,WAAwB,CAAC,aAAa,OAAO,UAAU,QAAQ,CAAC,EAAE;AAAA,IAC3E,UAAU,CAAC,WAAW;AACpB,YAAM,iBAAiB,OAAO,MAAM,EAAE,IAAI,CAAC,QAAQ;AAC3C,cAAA,QAAQ,OAAO,GAAG;AACjB,eAAA,aAAa,KAAK,IACrB+G,KAAe,KAAK,EAAE,KAAK,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,CAAC,CAAC,IACnDC,GAAa,CAAC,KAAK,KAAK,CAAC;AAAA,MAAA,CAC9B;AAED,aAAO,QAAQ,OACX,cAAc,cAAc,EAAE;AAAA,QAC5B,IAAI,CAAC,UAAU,MAAM,OAAO,CAAC,KAAK,CAAC,KAAK,KAAK,MAAM,OAAO,KAAK,KAAK,KAAK,GAAG,CAAA,CAAE,CAAC;AAAA,MAAA,IAEjFD,KAAe,cAAc,EAAE;AAAA,QAC7B,SAAS;AAAA,QACT,KAAK,CAAC,KAAK,CAAC,KAAK,KAAK,MAAM,OAAO,KAAK,KAAK,KAAK,GAAG,CAAA,CAAE;AAAA,MAAA;AAAA,IACzD,CACL;AAAA,EAAA;AAGP;ACnCA,SAAS,YAAY,QAAqB;AACjC,SAAA,OAAO,OAAO,CAAC,QAAmC,WACvD,OAAO,KAAK,IAAI,QACT,SACN,CAAE,CAAA;AACP;AAEA,SAAS,oBAAoB,OAAgC,OAAmB;AACvE,SAAA,MAAM,OAAO,CAAC,SAAS,EAAE,KAAK,CAAC,KAAK,MAAM;AACnD;AAEA,SAAS,cAAc,OAAoB;AACrC,SAAAyD,cAAY,KAAK,IACZ,MAAM,OAER,SAAS,QAAQ,MAAM,MAAM;AACtC;AAQA,SAAS,aACP,OACA,OACA,eACA,WAC4C;AACxC,MAAA,CAAC,SAAS,OAAO,SAAU;AAE7B,WAAOxD,GAAa,KAAa;AAGnC,QAAMhH,MAAK,cAAc,KAAK,GAExB,eAAwCA,MAAK,EAAC,GAAG,OAAO,KAAKA,IAAM,IAAA,EAAC,GAAG,MAAK;AAE9E,eAAa,UAAU,gBACzB,OAAO,aAAa,OACpB,OAAO,aAAa,MACpB,OAAO,aAAa,OACpB,OAAO,aAAa,UACpB,OAAO,aAAa,YACpB,OAAO,aAAa;AAGhB,QAAA,wBAAwB,oBAAoB,cAAc,KAAK;AAEjE,MAAAA,OAAM,sBAAsB,SAAS,GAAG;AAIpC,UAAA,YAAsB,KAAK,sBAAsB,IAAI,CAAC,SAAmB,KAAK,CAAC,CAAC,CAAC,GAEjF,eAAe,wBAAwB,KAAK,IAC9C,EAAC,WAAW,MAAM,YAAY,SAAS,MAAM,SAC7C,IAAA;AAEJ,WAAO,cAAcA,KAAI,WAAW,YAAY,EAAE;AAAA,MAChD,UAAU,CAAC,aACL,aAAa,OACRgH,GAAa,IAAI,IAGnB;AAAA,QACL;AAAA,UACE,GAAG,YAAY,SAAS;AAAA,UACxB,GAAIwD,cAAY,KAAK,IAAI,EAAC,GAAG,OAAO,GAAG,aAAA,IAAgB;AAAA,UACvD,GAAG;AAAA,QACL;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA,CAEH;AAAA,IAAA;AAAA,EAEL;AAGA,QAAM,QAAoC,CAAA;AACpC,QAAA,QAAQ,CAAC,SAAS;AACtB,UAAM,CAAC,MAAM,GAAG,IAAI,IAAI;AACnB,UAAM,IAAI,MACb,MAAM,IAAI,IAAI,CAAA,IAEhB,MAAM,IAAI,EAAE,KAAK,IAAI;AAAA,EAAA,CACtB;AAEK,QAAA,OAAO,OAAO,KAAK,KAAK,EAAE,OAAO,CAAC,KAA8B,SAAS;AACvE,UAAA,QAAQ,MAAM,IAAI,EAAE,OAAO,CAAC,SAAS,KAAK,SAAS,CAAC;AACtD,WAAA,MAAM,WAAW,IACnB,IAAI,IAAI,IAAIzJ,WAAS,KAAK,IAAK,MAAkC,IAAI,IAAI,SAEzE,IAAI,IAAI,IAAI,aAAc,MAAc,IAAI,GAAG,OAAO,eAAe,SAAS,GAEzE;AAAA,KACN,YAAY;AAER,SAAAiG,GAAa,IAAI,EAAE,KAAK,MAAM,EAAC,MAAM,GAAK,CAAA,CAAC;AACpD;AAKA,SAAS,eAAe,MAAkD;AACxE,SAAO,KAAK;AAAA,IAAI,CAAC,YACf,OAAO,WAAY,WAAW,QAAQ,MAAM,GAAG,IAAI;AAAA,EAAA;AAEvD;AAEO,SAAS,mBAAmB,SAA2C;AACtE,QAAA,EAAC,cAAiB,IAAA;AAEjB,SAAA;AAAA,IACL,aACE,OACA,OACA,WAC4C;AAC5C,aAAO,aAAa,OAAO,eAAe,KAAK,GAAG,eAAe,SAAS;AAAA,IAC5E;AAAA,EAAA;AAEJ;ACjIA,MAAM,wBAAuC,CAAC,CAAC,YAAY,GAAG,CAAC,YAAY,CAAC;AAGrE,SAAS,gBAAgB,SAA2D;AACzF,QAAM,YAAY,WAAS,OAAA,SAAA,QAAA;AAE3B,SAAK,aAIS,OAAO,OAAO,SAAS,EAAE,IAAI,CAAC,UAAU,OAAO,KAAK,EAAE,MAAM,GAAG,CAAC,KAAK,CAAA,GAGtE,OAAO,qBAAqB,IAPzB;AAQlB;AChBO,SAAS,2BAA2B,OAA8C;AAChF,SAAA,MAAM,QAAQ,KAAK,MAAM,MAAM,WAAW,KAAK,MAAM,KAAK,uBAAuB;AAC1F;AAEO,SAAS,sBAAsB,QAAyB;AAC7D,QAAM,aAAa,MAAM,QAAQ,MAAM,KAAK,OAAO,KAAK,uBAAuB;AAC/E,SAAI,CAAC,cAAc,CAAC,WAAW,WACtB,KAGF,WAAW,SACf,OAAO,kBAAkB,EACzB,IAAI,CAAC,SAAS,KAAK,IAAI,EACvB,KAAK,EAAE;AACZ;ACDA,MAAM,gBAAgB,CAAC,OAAO,SAAS,WAAW,cAAc,YAAY,GACtE,QAAiB,IAUjB,iBAAwB,uBAAA;AAC5B,MAAI,eAAyF,CAAA;AAEtF,SAAA;AAAA,IACL,KAAK,CAAC,MAAkB,OAAsB,UAAiB;AACxD,mBAAa,KAAK,IAAI,MACzB,aAAa,KAAK,IAAI,IAAI,KAE5B,aAAa,KAAK,IAAI,EAAE,KAAK,EAAC,OAAc,MAAY,OAAM;AAAA,IAChE;AAAA,IACA,SAAS;AACA,aAAA;AAAA,IACT;AAAA,IACA,QAAQ;AACN,qBAAe,CAAA;AAAA,IACjB;AAAA,EAAA;AAEJ,MAEM,eAAe,SAAS,MAAM;AAElC,QAAM,eAAe,eAAe,OAAO,GAOrC,aANehD;AAAAA,IACnB,OAAO,KAAK,YAAY,EAAE,IAAI,CAAC,aAAa;AACpC,YAAA,UAAU,aAAa,QAAQ;AACrC,aAAO,OAAO,SAAS,CAAC,UAAU,MAAM,MAAM,OAAO;AAAA,IAAA,CACtD;AAAA,EAE6B,EAAA;AAC5B,iBAAe,MAInB,QAAQ;AAAA,IACN,mBACE,eAAe,IAAI,UAAU,GAAG,UAAU,SAC5C;AAAA,IACA;AAAA,EAAA,GAGF,OAAO,KAAK,YAAY,EAAE,QAAQ,CAAC,aAAa;AAC9C,UAAM,UAAU,aAAa,QAAQ,GAC/B6L,SAAQ,QAAQ,CAAC;AACvB,YAAQ,MAAM,6CAA6C,QAAQ,SAASA,OAAM,KAAK,OAAO,GAC9E,OAAO,SAAS,CAAC,UAAU,MAAM,MAAM,OAAO,EACtD,QAAQ,CAAC,UAAU;AAvE/B,UAAA1O;AAwEW,UAAA,MAAM,MAAc,SAAS,oBAAoB;AAC9C,cAAA,aAAa,SAAOA,MAAA,MAAM,KAAK,YAAX,OAAoB,SAAAA,IAAA,YAAY,YACpD,EAAC,OAAO,MAAS,IAAA;AACf,gBAAA;AAAA,UACN,0BACE,aACI,0CACA,kCACN;AAAA,UACA;AAAA,QAAA,GAEF,QAAQ,MAAM,KAAK;AAAA,MACrB;AACK,UAAA,MAAM,MAAc,SAAS,gBAAgB;AAC1C,cAAA,EAAC,OAAO,MAAS,IAAA;AACvB,gBAAQ,IAAI,kDAAkD,KAAK,GACnE,QAAQ,MAAM,KAAK;AAAA,MACrB;AAAA,IAAA,CACD,GACD,QAAQ;EAAS,CAClB,GACD,QAAQ,SAAS,GACjB,eAAe,MAAM;AAEvB,GAAG,GAAI,GAED,eACJ,CAAC,cACD,CAAC,UAA4B;AAC3B,QAAM,OAAO,OAAO;AAElB,SAAA,UAAU,QACV,SAAS,eACT,SAAS,YACT,SAAS,YACT,SAAS,YAEF,QAEF;AAAA,IACL;AAAA,MACE;AAAA,MACA,IAAI;AAAA,QACF,QAAQ,SAAS,+EAA+E;AAAA,UAC9F;AAAA,QAAA,CACD;AAAA,MACH;AAAA,IACF;AAAA,EAAA;AAEJ,GACI,wBAAqE;AAAA,EACzE,OAAO,MAGE;AAAA,EAET,OAAO,aAAa,OAAO;AAAA,EAC3B,UAAU,aAAa,UAAU;AAAA,EACjC,aAAa,aAAa,aAAa;AAAA,EACvC,UAAU,aAAa,UAAU;AAAA,EACjC,MAAM,aAAa,MAAM;AAC3B;AAEA,SAAS,QAAQ,KAAc,aAAa,IAAc;AACpD,MAAAJ,WAAS,GAAG,GAAG;AACX,UAAA,OAAO,OAAO,KAAK,GAAG,GACtB,UAAU,KAAK,SAAS,IAAI,QAAQ;AAE1C,WAAO,GAAG,aADK,sBACiB,EAAE,IAAI,KAAK,MAAM,GAAG,CAAC,EAAE,KAAK,IAAI,CAAC,GAAG,OAAO;AAAA,EAC7E;AACI,MAAA,MAAM,QAAQ,GAAG,GAAG;AACtB,UAAM,UAAU,IAAI,SAAS,IAAI,QAAQ;AAEzC,WAAO,GAAG,aADK,gBACiB,EAAE,IAAI,IAAI,IAAI,CAAC,MAAM,QAAQ,GAAG,EAAK,CAAC,CAAC,GAAG,OAAO;AAAA,EACnF;AACA,SAAO,OAAO,OAAO,GAAG,IAAI,GAAG;AACjC;AAEA,SAAS,mBAAmB,WAAmB,YAAqB;AAClE,MAAI,OAAO,aAAe;AACjB,WAAA;AAEH,QAAA,YAAY,sBAAsB,SAAS;AACzC,SAAA,aAAa,UAAU,UAAU,KAAM;AACjD;AAEA,SAAS,WAAW,MAAc,OAAc;AAC9C,SAAO,OAAO,OAAO,OAAO,EAAC,KAAK,CAAA;AACpC;AAEA,SAAS,sBAAsB,eAAoC;AACjE,SAAI,CAAC,cAAc,aAAa,KAAK,kBAAkB,OAC9C;AAAA,IACL;AAAA,MACE;AAAA,MACA,IAAI;AAAA,QACF,4FAA4F;AAAA,UAC1F;AAAA,QAAA,CACD;AAAA,MACH;AAAA,IACF;AAAA,EAAA,IAIG,OAAO,QAAQ,aAAa,EAAE,OAAgB,CAAC,KAAK,CAAC,WAAW,UAAU,MACxE,CAAC,GAAG,KAAK,GAAG,mBAAmB,WAAW,UAAU,CAAC,GAC3D,KAAK;AACV;AAEA,SAAS,wBAAwB,QAAiC;AACzD,SAAA;AAAA,IACL,GAAG;AAAA,IACH,QAAQ,CAAC,GAAI,OAAO,UAAU,CAAC,GAAI,GAAG,sBAAsB,OAAO,WAAW,CAAC;AAAA,EAAA;AAEnF;AAEA,SAAS,eAAe,OAAsB;AAC5C,SAAO,OAAO,KAAK,EAAE,OAAO,CAAC,KAAoB,cAAmC;AAC5E,UAAA,MAAM,MAAM,SAAS;AACpB,WAAA;AAAA,MACL,GAAG;AAAA,MACH,CAAC,SAAS,GAAG,2BAA2B,GAAG,IAAI,sBAAsB,GAAG,IAAI;AAAA,IAAA;AAAA,EAEhF,GAAG,CAAE,CAAA;AACP;AAEO,SAAS,cACd,MACA,OACA,cAAkC,CAAA,GACT;AA1M3B,MAAAI;AA2MQ,QAAA2O,YAAU3O,MAAK,KAAA,YAAL,OAAc,SAAAA,IAAA;AAC1B,MAAA;AACK,WAAA;AAAA,MACL,aAAa2O,WACRA,SAAQ,OAAO,WAAW,IAC3B,eAAe,KAAK;AAAA,MACxB,QAAQ;AAAA,IAAA;AAAA,WAEH,OAAO;AACP,WAAA;AAAA,MACL,aAAa;AAAA,MACb,QAAQ,CAAC,WAAW,gBAAgB,KAAK,CAAC;AAAA,IAAA;AAAA,EAE9C;AACF;AAEA,SAAS,WACP,QACA,MACA,eACc;AACd,SAAA,OAAO,OAAO,QAAQ,CAAC,UAAU,eAAe,IAAI,MAAM,eAAe,KAAK,CAAC,GAC/E,aAAA,GAEO;AACT;AAMA,SAAS,mBACP,MACyE;AACnE,QAAA,UAAU,KAAK,WAAW,OAAO,KAAK,WAAY,WAAW,KAAK,UAAU;AAC9E,MAAA,CAAC,WAAW,EAAE,UAAU;AACnB,WAAA;AAGT,QAAM,cAAe,QAA4B;AAC1C,SAAA,MAAM,QAAQ,WAAW;AAClC;AAEA,SAAS,eAAe,MAAiD;AACvE,SAAK,mBAAmB,IAAI,IAIR,KAAK,QAAQ,KACd;AAAA,IAAI,CAAC,WACtB,kBAAkB,MAAM,IAAI,SAAU,EAAC,OAAO,QAAQ,OAAO,OAAM;AAAA,EALnE,IAAA;AAOJ;AAGO,SAAS,kBACd,UACA,MACA,cAAkC,CAAA,GACyB;AAtQ7D,MAAA3O,KAAA;AAuQQ,QAAA,mBAAmB,SAAOA,MAAK,KAAA,YAAL,oBAAc,YAAY,YACpD,cAAoC,KAAA,KAAK,YAAL,OAAA,SAAA,GAAc,WAAU,CAAA,GAG5D,gBAFa,OAAO,KAAK,SAAS,EAEP,OAAgC,CAAC,KAAK,QAAQ;AA3QjFA,QAAAA;AA6QU,UAAA,iBAAiB,YAAY,OAAO,OAAO,MAC3C,kBAAkB,UAAU,GAAG,GAC/B,cAAaA,OAAA,kBAAA,OAAA,SAAA,eAAgB,WAAhB,OAAAA,SAAAA,KAAwB,KAAK,CAAC,MAAM,EAAE,SAAS,eAAA,GAC5D,cAAc,cAAc,eAAe,WAAW,IAAI;AAO5D,QAAA,CAAC,oBAAoB,aAAa;AAEpC,YAAM,iBACJ,eAAe,YAAY,KAAK,CAAC,QAAQ,IAAI,UAAU,IAAI,UAAU,UAAU,GAAG,CAAC,CAAC;AAClF,UAAA,GAAG,IAAI,iBAAiB,eAAe,QAAQ,IAAI,UAAU,UAAU,GAAG,CAAC;AAAA,IACjF;AACE,UAAI,GAAG,IAAI,IAAI,UAAU,UAAU,GAAG,CAAC;AAGlC,WAAA;AAAA,EAAA,GACN,CAAA,CAAE,GAEC,gBAAgB,cAAc,MAAM,eAAe,WAAW;AAChE,MAAA,cAAc,OAAO,SAAS;AACzB,WAAA,WAAW,eAAe,MAAM,aAAa;AAGtD,QAAM,oBAAoB,wBAAwB,cAAc,MAAM,eAAe,WAAW,CAAC;AACjG,SAAO,kBAAkB,OAAO,SAAS,IACrC,WAAW,mBAAmB,MAAM,aAAa,IACjD,EAAC,GAAG,KAAK,UAAU,aAAa,GAAG,GAAG,cAAc;AAC1D;ACxRA,SAASJ,WAAS,OAAkD;AAClE,SAAO,cAAc,KAAK;AAC5B;AAEA,SAAS,YAAY,OAAyC;AAC5D,SAAO,cAAc,KAAK;AAC5B;AAGO,SAAS,sBAAsB,SAQJ;AAC1B,QAAA,EAAC,2BAA2B,cAAA6O,cAAgB,IAAA;AAElD,SAAO,SAAS,kBACd,OACA,MACA,aACA,WAC8B;AAC1B,QAAA,kCAAkC,IAAI,GAAG;AAGvC,UAAA,CAAC,wBAAwB,KAAK;AAChC,eAAO5I,GAAa,EAAC,UAAU,OAAU,CAAA;AAG3C,YAAM,eAAe,EAAC,WAAW,MAAM,YAAY,SAAS,MAAM;AAElE,aAAO,0BAA0B,MAAM,MAAM,YAAY,EAAE;AAAA,QACzD,UAAU,CAAC,aAAa;AACtB,cAAI,UAAU;AACN,kBAAA,UAAU,KAAK,GAAG,KAAK,CAAC,WAAW,OAAO,SAAS,QAAQ;AACjE,mBAAO,kBAAkB,OAAO,SAAgB,IAAI,YAAY;AAAA,UAClE;AACA,iBAAOA,GAAa,EAAC,UAAU,OAAU,CAAA;AAAA,QAAA,CAC1C;AAAA,MAAA;AAAA,IAEL;AACA,QAAI,sBAAsB,IAAI;AAG5B,aAAK,YAAY,KAAK,IAMf,0BAA0B,MAAM,IAAI,EAAE;AAAA,QAC3C,UAAU,CAAC,aAAa;AACtB,cAAI,UAAU;AACN,kBAAA,UAAU,KAAK,GAAG,KAAK,CAAC,WAAW,OAAO,SAAS,QAAQ;AAC1D,mBAAA,kBAAkB,OAAO,OAAc;AAAA,UAChD;AAKA,iBAAOA,GAAa,EAAC,UAAU,OAAU,CAAA;AAAA,QAAA,CAC1C;AAAA,MAhBM,IAAAA,GAAa,EAAC,UAAU,OAAU,CAAA;AAmBvC,UAAA,QAAQ,gBAAgB,KAAK,OAAO;AAC1C,WAAI,QACK4I,cAAa,OAAO,OAAO,SAAS,EAAE;AAAA,MAC3C,IAAI,CAAC,cAAc;AAAA,QACjB;AAAA,QACA,UAAU,YAAY,kBAAkB,UAAU,MAAa,WAAW;AAAA,MAAA,EAC1E;AAAA,QAQC5I,GAAa;AAAA,MAClB;AAAA,MACA,UACE,SAASjG,WAAS,KAAK,IAAI,cAAc,MAAM,OAAO,WAAW,EAAE,cAAc;AAAA,IAAA,CACpF;AAAA,EAAA;AAEL;ACnGgB,SAAA,4BACd,iBACA6O,eAMA;AACM,QAAA,EAAC,oCAAmC;AAAA,IACxC;AAAA,IACAA;AAAA,EAAA,GAGI,iCAAgD,CAAC,CAAC,YAAY,GAAG,CAAC,YAAY,GAAG,CAAC,OAAO,CAAC;AAEhG,SAAO,EAAC,yBAAwB;AAEvB,WAAA,yBACP5P,KACA,OACoC;AACpC,UAAM,EAAC,SAAS,YAAW,IAAI,UAAUA,GAAE;AAEpC,WAAA,gCAAgC,OAAO,EAAE;AAAA,MAC9C,UAAU,CAAC,iBAAiB;AAC1B,YAAI,CAAC,aAAa,MAAM,aAAa,CAAC,aAAa,UAAU;AAE3D,iBAAO,GAAG;AAAA,YACR,IAAI;AAAA,YACJ,MAAM;AAAA,YACN,OAAO;AAAA,cACL,cAAc,aAAa;AAAA,cAC3B,UAAU;AAAA,YACZ;AAAA,YACA,WAAW;AAAA,cACT,cAAc,aAAa;AAAA,cAC3B,UAAU;AAAA,YACZ;AAAA,UAAA,CACD;AAGH,cAAM,gBAAgB,CAAC,GAAG,OAAO,GAAG,8BAA8B;AAElE,eAAO,cAAc;AAAA,UACnB4P,cAAa,EAAC,OAAO,aAAa,MAAM,WAAU,aAAa;AAAA,UAC/DA,cAAa,EAAC,OAAO,aAAa,MAAM,eAAc,aAAa;AAAA,QACpE,CAAA,EAAE;AAAA,UACD,IAAI,CAAC,CAAC,eAAe,iBAAiB,MAAM;AAE1C,kBAAM,OACH7O,WAAS,aAAa,KAAK,WAAW,iBAAiB,cAAc,SACrEA,WAAS,iBAAiB,KACzB,WAAW,qBACX,kBAAkB,SACpB;AAEK,mBAAA;AAAA,cACL,IAAI;AAAA,cACJ,MAAM,OAAO,QAAS,WAAW,OAAO;AAAA,cACxC,OAAO;AAAA,gBACL,cAAc,aAAa;AAAA,gBAC3B,UAAU;AAAA,cACZ;AAAA,cACA,WAAW;AAAA,gBACT,cAAc,aAAa;AAAA,gBAC3B,UAAU;AAAA,cACZ;AAAA,YAAA;AAAA,UACF,CACD;AAAA,QAAA;AAAA,MACH,CACD;AAAA,IAAA;AAAA,EAEL;AACF;ACnFO,SAAS,eAAe,QAAkB;AACxC,SAAA,CAAC,QAAoC,gBACtC,WAAW,cACN,KAEL,CAAC,UAAU,CAAC,eAGZ,OAAO,UAAW,YAAY,OAAO,eAAgB,WAChD,KAEF,OAAO,MAAM,CAAC,UAAU,OAAO,KAAK,MAAM,YAAY,KAAK,CAAC;AAEvE;ACbA,MAAM,KAAK,CAAI,UAAgB;AAOf,SAAA,WAAc,OAAiB,eAAgC,IAAa;AAC1F,MAAI,UACA;AACJ,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACrC,QAAI,MAAM,GAAG;AACA,iBAAA,aAAa,MAAM,CAAC,CAAC;AAChC;AAAA,IACF;AAEA,QADA,WAAW,aAAa,MAAM,CAAC,CAAC,GAC5B,aAAa;AACR,aAAA;AAEE,eAAA;AAAA,EACb;AACO,SAAA;AACT;ACJO,SAAS,kBAAkB,YAA8C;AACvE,SAAA;AAAA,IACL,WAAW,OAAO,CAAC,QAA8B,CAACf,KAAI,MAAM,GAAG,UAAU;AACjE,YAAA,MAAM,OAAO,OAAO,KAAK,GAAG,GAAG,QAAQ,EAAE,KAAK,GAAG;AAClD,aAAO,GAAG,MACb,OAAO,GAAG,IAAI,EAAC,QAAgB,KAAK,CAAI,GAAA,KAAK,CAAA,EAAE;AAEjD,YAAM,MAAM,OAAO,GAAG,EAAE,IAAI;AAC5B,aAAA,OAAO,GAAG,EAAE,IAAI,GAAG,IAAIA,KACvB,OAAO,GAAG,EAAE,IAAI,GAAG,IAAI,OAChB;AAAA,IACT,GAAG,EAAE;AAAA,EAAA;AAET;AAEA,SAAS,YAAYA,KAAY;AACxB,SAAA,KAAK,UAAUA,GAAE;AAC1B;AAEA,MAAM,cAAc,CAAC,cACnB,iBAAiB,SAAS,IAAI,IAAI,SAAS,OAAO,YAAY,SAAS,CAAC,KAAK;AAE/E,SAAS,WAAW,EAAC,KAAK,UAA4C;AACpE,QAAM,YAAY,CAAC,GAAG,sBAAsB,GAAG,MAAM;AACrD,SAAO,aAAa,IAAI,IAAI,WAAW,EAAE,KAAK,GAAG,CAAC,UAAU,IAAI,MAAM,KAAK,UACxE,IAAI,WAAW,EACf,KAAK,GAAG,CAAC;AACd;AAEO,SAAS,QAAQ,oBAAiD;AAChE,SAAA,IAAI,mBAAmB,IAAI,UAAU,EAAE,KAAK,GAAG,CAAC,SAAS,mBAAmB,MAAM;AAC3F;AAEgB,SAAA,WACd,aACA,oBACgB;AAChB,SAAO,YAAY,OAAO,CAAC,aAA6B,WAAW,WACrD,mBAAmB,KAAK,EAAE,IAClC,QAAQ,CAAC,WAAW,MAAM;AAC5B,UAAMA,MAAK,mBAAmB,KAAK,EAAE,IAAI,CAAC,GACpC,QAAQ,UAAU,KAAK,CAAC,QAAQ,IAAI,QAAQA,GAAE;AACxC,gBAAA,SAAS,IAAI,SAAS;AAAA,EAAA,CACnC,GACM,cACN,CAAA,CAAE;AACP;ACdO,SAAS,6BAA6B,SAG1C;AACK,QAAA,EAAC,cAAA4P,eAAc,gBAAmB,IAAA;AAEpC,MAAA;AAEJ,QAAM,kBAAkB,MAAM;AAC5B,QAAI,CAAC,iBAAiB;AACpB,YAAM,aAAa;AAAA,QACjB,gBAAgB;AAAA,UACd;AAAA,UACA,CAAC;AAAA,UACD;AAAA,YACE,QAAQ,CAAC,WAAW,UAAU;AAAA,YAC9B,eAAe;AAAA,YACf,YAAY;AAAA,YACZ,KAAK;AAAA,UACP;AAAA,QACF;AAAA,QACA,KAAKG,QAAA,CAAO,GAKR,WAAW,WAAW;AAAA,QAC1B,OAAO,CAAC,UAAe,MAAM,SAAS,SAAS;AAAA,QAC/C,YAAY,EAAC,UAAU,IAAM,YAAY,GAAE;AAAA,MAAA;AAM7C,eAAS,UAAU;AAEb,YAAA,aAAa,WAAW,KAAK,OAAO,CAAC,UAAe,MAAM,SAAS,UAAU,CAAC;AAElE,wBAAA;AAAA,QAChB;AAAA,QACA;AAAA,MAAA;AAAA,IAEJ;AAEO,WAAA;AAAA,EAAA;AAGT,WAAS1M,QAAOrD,KAAQ;AACtB,UAAM,eAAe;AACd,WAAA;AAAA,MACL,aAAa;AAAA,MACb,aAAa,WAAW,KAAK,OAAO,CAAC,UAAe,MAAM,eAAeA,GAAE,CAAC;AAAA,IAAA;AAAA,EAEhF;AAEA,WAAS,0BAA0B,QAAsB;AACvD,WAAO,SAA8B,YAAyB;AACtD,YAAA,qBAAqB,kBAAkB,UAAU;AAChD,aAAA,OAAO,WACX,MAAM,QAAQ,kBAAkB,GAAG,CAAA,GAAI,EAAC,KAAK,yBAAgC,CAAA,EAC7E,KAAK,IAAI,CAAC,WAAgB,WAAW,QAAQ,kBAAkB,CAAC,CAAC;AAAA,IAAA;AAAA,EAExE;AAEA,QAAM,yBAAyB,gBAAgB,0BAA0B,eAAe,GAAG,GAAG,GACxF,yBAAyB,gBAAgB,0BAA0B,eAAe,GAAG,GAAI;AAEtF,WAAA,2BAA2BA,KAAQ,QAAuB;AAC1D,WAAAqD,QAAOrD,GAAE,EAAE;AAAA,MAChB,UAAU,CAAC,UACL,MAAM,SAAS,aAAa,MAAM,eAAe,UAC5C,uBAAuBA,KAAI,MAAa,EAAE;AAAA,QAC/C,SAAS,CAAC,WACD;AAAA,UACLgH,GAAa,MAAM;AAAA,UACnB,WAAW;AAAA;AAAA;AAAA,YAGP,uBAAuBhH,KAAI,MAAa;AAAA,cACxC,CAAC;AAAA,QAAA,CAER;AAAA,MAAA,IAGE,uBAAuBA,KAAI,MAAa,CAChD;AAAA,IAAA;AAAA,EAEL;AAQM,QAAAgQ,SAAe,IAEf,4BAA4B/M;AAAAA,IAChC,SAAmC,WAAsB;AACvD,YAAM,SAAS,gBAAgB,WAAW,SAAS,GAC7C,WAAW,0BAA0B,MAAM;AAC1C,aAAA,gBAAgB,UAAU,EAAE;AAAA,IACrC;AAAA,IACA,CAAC,cAAc,UAAU,UAAU,UAAU;AAAA,EAAA,GAGzC,sCAAsC,KAItC,eAAe,UAAU,UAAU,kBAAkB,EAAE;AAAA,IAC3D,UAAU,CAAC;AAAA,IACX,IAAI,MAAM,SAAS,oBAAoB,SAAS;AAAA,IAChD,UAAU,CAAC,YAAa,UAAU,MAAM,GAAG,mCAAmC,IAAIoD,OAAM;AAAA,IACxF0J,QAAM;AAAA,EAAA;AAGC,WAAA,yBAAyB/P,KAAQ,QAAuB,WAAsB;AACrF,WAAO,aAAa,KAAK,UAAU,CAAC,CAAC,EAAE;AAAA,MACrC,UAAU,MACa,0BAA0B,SAAS,EACpCA,KAAI,MAAa,CACtC;AAAA,IAAA;AAAA,EAEL;AAES,WAAA,0BACPA,KACA,QACA,WACqB;AACrB,QAAI,SAAmB;AACvB,UAAM,WAAW;AAAA,MACf,MAAM,MAAO,WAAW,OAAOqG,UAAQW,GAAa,MAAM,CAAE;AAAA,MAC3D,YACI,yBAAyBhH,KAAI,QAAQ,SAAS,IAC/C,2BAA2BA,KAAI,MAAM;AAAA,IAAA,EACzC;AAAA,MACA,IAAI,CAAC,MAAiB,SAAS,CAAE;AAAA,MACjC,YAAY,EAAC,UAAU,IAAM,YAAY,GAAE;AAAA,IAAA;AAGtC,WAAA,EAAC,IAAAA,KAAI,QAAQ;EACtB;AAES,WAAA,oBAAoBA,KAAQ,QAAqB,WAAuB;AAC/E,UAAM,WAAW,YACb,GAAG,UAAU,SAAS,IAAI,UAAU,OAAO,IAAIA,GAAE,KACjD,aAAaA,GAAE;AAEb,gBAAYgQ,WAChBA,OAAM,QAAQ,IAAI,CAAC;AAGf,UAAA,oBAAoBA,OAAM,QAAQ;AAClB;AAAA,MACpB;AAAA,MACAhM,UAAQ,kBAAkB,IAAI,CAAC,wBAAwB,oBAAoB,MAAM,CAAC;AAAA,IAAA,EAGlE,SAAS,KACzB,kBAAkB,KAAK,0BAA0BhE,KAAI,QAAQ,SAAgB,CAAC;AAG1E,UAAA,uBAAuB,kBAC1B,OAAO,CAAC,aAAa,SAAS,OAAO,KAAK,CAAC,cAAc,OAAO,SAAS,SAAS,CAAC,CAAC,EACpF,IAAI,CAAC,WAAW,OAAO,QAAQ;AAE3B,WAAA,cAAc,oBAAoB,EAAE;AAAA;AAAA;AAAA,MAGzC,IAAI,CAAC,cAAc,UAAU,OAAO,OAAO,CAAC;AAAA;AAAA,MAC5C,OAAO,CAAC,cAAc,WAAW,WAAW,CAAC,aAAa,SAAS,IAAI,CAAC;AAAA;AAAA,MACxE,IAAI,CAAC,cAAe,UAAU,WAAW,IAAI,OAAO,SAAS,WAAW,MAAM,CAAE;AAAA;AAAA,MAChF,qBAAqB,eAAe,MAAM,CAAC;AAAA,IAAA;AAAA,EAE/C;AAGO,SAAA,EAAC,eAAe;AAEd,WAAA,SAAS,SAAgC,QAAkB;AAC3D,WAAA,CAAC,GAAG,gBAAgB,GAAG,MAAM,EAAE,OAAO,CAAC,QAAQ,cAAc;AAC5D,YAAA,QAAQ,mBAAmB,SAAS,SAAS;AACnD,aAAI,UAAU,WACV,OAAe,SAAS,IAAI,QAEzB;AAAA,IACT,GAAG,CAAE,CAAA;AAAA,EACP;AAES,WAAA,mBAAmB,SAAgC,WAAmB;AACzE,QAAA;AACI,WAAA,QAAA,KAAK,CAAC,WACR,aAAa,UACf,QAAQ,OAAO,SAAS,GACjB,MAEF,EACR,GACM;AAAA,EACT;AACF;AC/LO,SAAS,2BAA2B;AAAA,EACzC;AACF,GAAsD;AAC9C,QAAA,kBAAkB,OAAO,WAAW,EAAC,YAAY,IAAI,CAAA,GAKrD,uBAAuC,CAAC,OAAO,OAAO,cACnD4P,cAAa,OAAO,OAAO,SAAS,GAGvC,EAAC,cAAa,IAAI,6BAA6B;AAAA,IACnD,cAAc;AAAA,IACd;AAAA,EAAA,CACD,GAEK,EAAC,cAAAA,kBAAgB,mBAAmB,EAAC,cAAc,CAAA;AAEhD,WAAA,0BACP5P,KACA,WACgC;AACzB,WAAA4P,cAAa,EAAC,OAAO,aAAa,MAAM5P,IAAE,GAAG,CAAC,OAAO,GAAG,SAAS,EAAE;AAAA,MACxE,IAAI,CAAC,QAASe,WAAS,GAAG,KAAK,OAAO,IAAI,SAAU,WAAW,IAAI,QAAQ,MAAU;AAAA,MACrF,qBAAqB;AAAA,IAAA;AAAA,EAEzB;AAGM,QAAA,oBAAoB,sBAAsB,EAAC,2BAA2B,cAAA6O,eAAa,GACnF,EAAC,gCAAA,IAAmC;AAAA,IACxC;AAAA,IACAA;AAAA,KAEI,EAAC,yBAA4B,IAAA,4BAA4B,iBAAiBA,aAAY;AAGrF,SAAA;AAAA,IACL,cAAAA;AAAA,IACA;AAAA,IACA;AAAA;AAAA,IAGA,0CAA0C;AAAA,IAC1C,mCAAmC;AAAA,EAAA;AAEvC;AC9FA,MAAMK,sBAAoB,CAAC,eAA2B,WAAW,aAAa;AAOvE,SAAS,0BACd,sBACA,YACA,YACA,OAC0B;AACpB,QAAA,SAASA,oBAAkB,UAAU,IACvC,GAAG,EAAC,UAAU,KAAA,CAAK,IACnB,qBAAqB;AAAA,IACnB,EAAC,OAAO,aAAa,MAAM,WAAW,UAAU,EAAC;AAAA,IACjD;AAAA,EAAA,GAGA,aAAa,qBAAqB;AAAA,IACtC,EAAC,OAAO,aAAa,MAAM,eAAe,UAAU,EAAC;AAAA,IACrD;AAAA,EAAA;AAGF,SAAO,cAAc,CAAC,QAAQ,UAAU,CAAC,EAAE;AAAA,IACzC,IAAI,CAAC,CAAC,OAAO,SAAS,OAAO;AAAA,MAC3B,OAAO,MAAM,WAAW,EAAC,OAAO,GAAI,MAAM,YAAY,CAAC,EAAA,IAAM;AAAA,MAC7D,WAAW;AAAA,MACX,WAAW,UAAU,WAAW,EAAC,OAAO,GAAI,UAAU,YAAY,CAAC,EAAA,IAAM;AAAA,IAAA,EACzE;AAAA,IACF,UAAU,EAAC,OAAO,MAAM,WAAW,IAAM,WAAW,MAAK;AAAA,EAAA;AAE7D;AC3CA,MAAM,6BAA6B,CAAC,UAA0B;AAAA,EAC5D,2BAAQ,MAAI,EAAA,UAAA,KAAK,QAAQ,OAAO,KAAK,KAAK,IAAI,mBAAmB,CAAA;AAAA,EACjE,UAAU,oBAAC,MAAI,EAAA,UAAA,KAAK,QAAQ,wBAAwB,KAAK,GAAG,KAAK,gBAAgB,KAAK,GAAG,IAAG;AAAA,EAC5F,OAAO,MAAM,oBAAC,oBAAmB,EAAA;AACnC,IAQa,8BAA8B,CAAC;AAAA,EAC1C;AAAA,EACA;AAAA,EACA;AACF,MAIM;AACJ,QAAM,WAAW,SAAS;AAE1B,SAAK,WAIE,WAAW,CAAA,GAAI,UAAU,OAAO,CAAC,UAAU,aACzC,OAAO,WAAa,MAAc,WAAW,QACrD,IALQ,2BAA2B,KAAK;AAM3C,GC1BM,sBAAsB;AAAA,EAC1B,CAAC,CAAC,WAAW,MAAM,MACV;AAAA,IACL,UAAU,QAAQ,MAAM,EAAE,MAAM,CAAC,SAC/B,QAAQ,MAAM,GAAG,GACV,KACR;AAAA,EACH;AAEJ;AAGO,SAAS,QAAQ,QAAuD;AAC7E,QAAM,YAAY;AACX,SAAA,oBAAoB,QAAQ,MAAM,CAAC,WAAW,MAAM,GAAG,CAAC,QAAQ,SAAS,CAAC,CAAC;AACpF;AAkBO,SAAS,iBAAqC;AAC7C,QAAA,EAAC,gBAAe;AACf,SAAA;AACT;ACcA,MAAM,qBAAqB,CAAC,qBAAuC;AACjE,QAAM,QAAQ,iBAAiB,OACzB,OAAO,iBAAiB,SAAS;AACvC,SAAK,SAIE;AAAA,IACL,GAAG;AAAA,IACH,QAAQ,QAAQ,OAAO;AAAA,IACvB,OAAO,QAAQ,OAAO;AAAA,IACtB,aAAY,oBAAI,KAAK,GAAE,YAAY;AAAA,EAAA;AAEvC,GAEM,kBAAkB,CAACpP,eAAkC,EAAC,MAAM,YAAY,UAAAA,UACxE,IAAA,cAAc,CAA4B,UAA4B,MAAM,UAKrE,mCAAmC,CAAC,mBAA8C;AAEvF,QAAA,WAAW,IAAI,QAGf,GAAA,eAAe,IAAI,gBAAyB,EAAI,GAKhD,aAAa,IAAI,QAA+B,GAGhD,UAAU,IAAI,QAA6B,GAG3C,kBAAkB,IAAI,QAAqC,GAE3D,iBAAiB,IAAI,QAAuB,GAE5C,gCAAgC,CAAC,oBAA2C;AAC1E,UAAA,mBAAmB,IAAI,iBAAiB,eAAe;AAC7D,WAAA,iBAAiB,aAAa,CAAC,EAAC,UAAU,aAAiB;AAIzD,iBAAW,KAAK;AAAA,QACd,MAAM;AAAA,QACN,UAAU,mBAAmB,gBAAgB;AAAA,QAC7C,WAAW,SAAS;AAAA,QACpB,QAAQ,SAAS,WAAW;AAAA,MAAA,CAC7B;AAAA,IAAA,GAEH,iBAAiB,mBAAmB,CAAC,aAAkB;AACrD,sBAAgB,KAAK;AAAA,QACnB,MAAM;AAAA,QACN,MAAM,iBAAiB,SAAS;AAAA,QAChC,eAAe,SAAS;AAAA,QACxB,WAAW,SAAS;AAAA,QACpB,QAAQ,SAAS;AAAA,QACjB,SAAS,SAAS;AAAA,MAAA,CACnB;AAAA,OAGH,iBAAiB,WAAW,CAAC,MAAW,qBAA0B,mBAAwB;AACxF,cAAQ,KAAK;AAAA,QACX,MAAM;AAAA,QACN,UAAU;AAAA,QACV,iBAAiB;AAAA,QACjB;AAAA,MAAA,CACD;AAAA,IAAA,GAGH,iBAAiB,uBAAuB,CAAC,iBAAiB;AACxD,mBAAa,KAAK,YAAY;AAAA,IAAA,GAGhC,iBAAiB,gBAAgB,CAAC,cAA6B,eAAe,KAAK,SAAS,GAErF;AAAA,EAAA,GAGH,2BAA2B,eAAe;AAAA,IAC9C,KAAK,CAAC,kBAA2C,kBAE3C,cAAc,SAAS,cACrB,oBAGF,iBAAiB,OAAO,GAEnB,8BAA8B,cAAc,YAAY,IAAI,KAEjE,qBAAqB,QAEvB,QAAQ;AAAA,MACN;AAAA,MACA,cAAc;AAAA,IAAA,GAET,QAEF,kBACN,IAAI;AAAA,IACP;AAAA,MACE,CAAI,qBAA4D,qBAAqB;AAAA,IACvF;AAAA,IACA,qBAAqB;AAAA,IACrB,cAAc,CAAC;AAAA,IACf,SAAS;AAAA,EAAA,GAML,qBAAqB,eAAe;AAAA,IACxC,OAAO,CAAC,OAA4B,GAAG,SAAS,UAAU;AAAA,IAC1D,eAAe,wBAAwB;AAAA,IACvC,IAAI,CAAC,CAAC,eAAe,gBAAgB,OACnC,iBAAkB,OAAO,IAAI,SAAS,aAAa,CAAC,GAC7C,mBAAmB,gBAAiB,EAC5C;AAAA,EAAA,GAIG,iBAAiB,SAAS;AAAA,IAC9B,eAAe,wBAAwB;AAAA,IACvC,IAAI,CAAC,CAAC,QAAQ,gBAAgB,MAAkC;AAC1D,aAAO,SAAS,cAClB,iBAAkB,IAAI,IAAI,SAAS,EAAC,WAAW,OAAO,UAAA,CAAU,CAAC,GAE/D,OAAO,SAAS,YAClB,iBAAkB;IAAO,CAE5B;AAAA;AAAA,IAED,WAAWwF,OAAK;AAAA,IAChB0J,QAAM;AAAA,EAAA,GAGF,aAAa,CAAC,WAAgB,SAAS,KAAK,MAAM,GAElD,eAAe,CAAC,cAAiC,WAAW,EAAC,MAAM,YAAY,UAAS,CAAC,GACzF,cAAc,CAAC,aAA8B,aAAa,CAAC,QAAQ,CAAC,GAEpEG,UAAS,MAAM;AAEhB,6BAAA;AAAA,MACC,KAAK,CAAC;AAAA,MACN,IAAI,CAAC,qBAAqB,iBAAkB,QAAQ;AAAA,MAErD,UAAU;AAAA,KAIT,YAAY;AAAA,IAChB,yBAAyB,KAAK,IAAI,CAAC,qBAAqB,iBAAkB,KAAK,CAAC;AAAA,IAChF,WAAW,KAAK,IAAI,WAAW,CAAC;AAAA,IAChC,QAAQ,KAAK,IAAI,WAAW,CAAC;AAAA,IAC7B;AAAA,EAAA,EACA,KAAK,IAAI,eAAe,GAAG,cAAc,CAAC,GAAG,SAAA,CAAU,GAEnD,kBAAmD;AAAA,IACvD,yBAAyB;AAAA,MACvB,IAAI,CAAC,qBAAqB,iBAAkB,SAAS,IAAW;AAAA,MAChE,IAAI,eAAe;AAAA,IACrB;AAAA,IACA;AAAA,IACA,KAAK,cAAc,CAAC,GAAG,SAAU,CAAA;AAE5B,SAAA;AAAA,IACL,UAAU,MAAM,WAAW,gBAAgB,YAAY,OAAO;AAAA,IAC9D,cAAc,aAAa,KAAK,qBAAA,GAAwB,cAAc,CAAC,GAAG,UAAU;AAAA,IACpF;AAAA,IACA,gBAAgB;AAAA,IAChB;AAAA,IACA;AAAA,IACA,QAAAA;AAAA,EAAA;AAEJ,GCnNM,UAAU,CAAClQ,QAAe,CAACa,cAAsC;AACrE,QAAM,EAAC,KAAK,MAAM,YAAY,GAAG,KAAQ,IAAAA;AACzC,SAAO,EAAC,KAAKb,KAAI,GAAG,KAAI;AAC1B,GAoBa,yBAAyB,CACpC,YAEA,mBAC4B;AAC5B,QAAM,mBAAmB,iCAAiC,cAAc,GAElE,aAAa,QAAQ,UAAU,GAE/B,SAAS,EAAC,QAAQ,EAAC,IAAI,WAAW,EAAA;AAEjC,SAAA;AAAA,IACL,QAAQ,iBAAiB;AAAA,IACzB,cAAc,iBAAiB;AAAA,IAC/B,iBAAiB,iBAAiB;AAAA,IAClC,gBAAgB,iBAAiB;AAAA,IAEjC,OAAO,CAAC,YAAY,QAAQ,IAAI,CAACkF,YAAW,EAAC,OAAO,EAAC,GAAGA,QAAO,IAAI,WAAA,EAAa,EAAA;AAAA,IAChF,QAAQ,CAACrE,eAAc,EAAC,QAAQ,WAAWA,SAAQ;IACnD,mBAAmB,CAACA,eAAc,EAAC,mBAAmB,WAAWA,SAAQ;IACzE,iBAAiB,CAACA,eAAc,EAAC,iBAAiB,WAAWA,SAAQ;IACrE,QAAQ,MAAM;AAAA,IAEd,QAAQ,CAAC,cAAiC,iBAAiB,aAAa,SAAS;AAAA,IACjF,QAAQ,MAAM,iBAAiB,OAAO;AAAA,EAAA;AAE1C,GCpCM,gBAAuC,EAAC,MAAM,WAAW,OAAO,QAAA,GAChE,cAAqC,EAAC,MAAM,WAAW,OAAO,MAAK;AAEzE,SAAS,gBAAgB,KAA0C;AACjE,SAAO,IAAI,SAAS;AACtB;AACA,SAAS,wBAAwB,KAAoB;AACnD,SAAO,IAAI,yBAAyB;AACtC;AAEA,SAAS,oCAAoC,gBAAiC;AAC5E,QAAM,mBAAmB;AAAA,IACvB,eAAe,OAAO,CAAC,OAA4B,GAAG,SAAS,UAAU;AAAA,IACzE,CAAC,MAAM,EAAE;AAAA,EAAA;AAGJ,SAAA,OAAO,OAAO,gBAAgB,EAAE;AAAA,IACrC,CAAC,cAAc,UAAU,WAAW,UAAU,CAAC,EAAE;AAAA,EAAA;AAErD;AAGO,SAAS,gBACd,QACA,QACA,UAA+B,CAAA,GACJ;AACrB,QAAA,EAAC,aAAa,QAAW,IAAA;AACxB,SAAA;AAAA,IACL,MACE,OAAO,WAAW;AAAA,MAChB;AAAA,MACA;AAAA,QACE;AAAA,QACA;AAAA,MACF;AAAA,MACA;AAAA,QACE,eAAe;AAAA,QACf,QAAQ,CAAC,WAAW,YAAY,WAAW;AAAA,QAC3C,cAAc;AAAA,QACd,KAAK,QAAQ,OAAO;AAAA,MACtB;AAAA,IACF;AAAA,EAAA,EACF;AAAA,IACA;AAAA,MAAU,CAAC,UACT,MAAM,SAAS,YACX,8BAAgC,EAAA;AAAA,QAC9B,UAAU,CAAC,cAAc;AAAA,UACvB,oBAAoB,SAAS,UAAU,KAAK;AAAA,UAC5C,oBAAoB,aAAa,UAAU,SAAS;AAAA,QAAA,CACrD;AAAA,MAAA,IAEHmG,GAAa,KAAK;AAAA,IACxB;AAAA,IACA;AAAA,MACE,CAAC,KAAuD,QAAQ;AAE1D,YAAA,CAAC,gBAAgB,GAAG;AACtB,iBAAO,EAAC,MAAM,CAAC,GAAG,GAAG,QAAQ,CAAE,EAAA;AAGjC,cAAM,cAAc,IAAI,OAAO,SAAS,GAClC,UAAU,wBAAwB,GAAG;AACvC,YAAA,CAAC,WAAW,CAAC;AAEf,iBAAO,EAAC,MAAM,CAAC,GAAG,GAAG,QAAQ,CAAE,EAAA;AAGjC,YAAI,CAAC;AAGI,iBAAA,EAAC,MAAM,CAAA,GAAI,QAAQ,IAAI,OAAO,OAAO,GAAG;AAGjD,cAAM,aAAa,IAAI,OAAO,OAAO,GAAG;AACpC,eAAA,oCAAoC,UAAU,IAEzC,EAAC,MAAM,WAAW,OAAO,WAAW,GAAG,QAAQ,CAAC,EAAA,IAIlD,EAAC,MAAM,WAAW,WAAW,IAAI,CAAC,aAAa,IAAI,CAAI,GAAA,QAAQ;MACxE;AAAA,MACA,EAAC,MAAM,CAAA,GAAI,QAAQ,GAAE;AAAA,IACvB;AAAA;AAAA,IAEA,SAAS,CAAC,MAAM,EAAE,IAAI;AAAA,EAAA;AAGxB,WAAS,gCAAuD;AACvD,WAAA,OAAO,WACX,aAA6B,CAAC,SAAS,WAAW,GAAG,EAAC,KAAK,qBAAqB,CAAA,EAChF;AAAA,MACC,IAAI,CAAC,CAAC,OAAO,SAAS,OAAO;AAAA,QAC3B;AAAA,QACA;AAAA,MAAA,EACA;AAAA,IAAA;AAAA,EAER;AACF;AAEA,SAAS,oBACP,YACAnG,WACsB;AACf,SAAA;AAAA,IACL,MAAM;AAAA,IACN;AAAA,IACA,UAAAA;AAAA,EAAA;AAEJ;ACrIA,MAAM,0BACJ,CAACb,QACD,CACE,UAEO,MAAM,SAAS,eAAe,MAAM,SAAS,aAAa,MAAM,eAAeA;AA+C1F,SAAS,WAAc,SAAgC;AACrD,SAAO,CAAC,QAAiD,EAAC,GAAG,IAAI,QAAO;AAC1E;AAEA,SAAS,gBAAgB,QAAsB,gBAAoC;AACjF,QAAM,EAAC,WAAW,GAAG,SAAA,IAAY;AAC1B,SAAA,OAAO,YAAY,UAAU,UAAU;AAAA,IAC5C,YAAY;AAAA,IACZ,iBAAiB;AAAA,IACjB,KAAK;AAAA;AAAA;AAAA,IAGL,qCAAqC;AAAA,EAAA,CACtC;AACH;AAEA,SAAS,oBAAoB,QAAsB,SAAwB;AACzE,SAAO,KAAK,gBAAgB,QAAQ,QAAQ,SAAS,MAAM,CAAC,EAAE;AAAA,IAC5D,IAAI;AAAA,MACF,OAAO,CAAC,UAAU;AAEd,wBAAgB,SAChB,OAAO,MAAM,cAAe,YAC5B,MAAM,cAAc,OACpB,MAAM,cAAc,MAEpB,QAAQ,OAAO,KAAK,IAEpB,QAAQ,QAAQ,KAAK;AAAA,MAEzB;AAAA,MACA,MAAM,MAAM,QAAQ,QAAQ;AAAA,IAAA,CAC7B;AAAA,EAAA;AAEL;AAGgB,SAAA,aAAa,QAAsB,QAAsB;AACvE,QAAM,EAAC,aAAa,YAAW,QAEzB,0BAA0B,IAAI,QAC9B,GAAA,kBAAkB,gBAAgB,QAAQ,MAAM,EAAE;AAAA,IACtD+P,QAAM,EAAC,WAAW,MAAM,yBAAwB;AAAA,EAAA,GAG5C,aAAa,gBAAgB;AAAA,IACjC,OAAO,CAAC,OAAO,GAAG,SAAS,WAAW;AAAA,KAGlC,QAAQ;AAAA,IACZ;AAAA,IACA,gBAAgB,KAAK,OAAO,wBAAwB,OAAO,CAAC,CAAC;AAAA,KAGzD,YAAY;AAAA,IAChB;AAAA,IACA,gBAAgB,KAAK,OAAO,wBAAwB,WAAW,CAAC,CAAC;AAAA,EAAA,GAI7D,6BAA6B,gBAAgB;AAAA,IACjD,OAAO,CAAC,OAAoC,GAAG,SAAS,SAAS;AAAA,EAAA,GAG7D,WAAW,MAAM,MAAM,gBAAgB,UAAU,cAAc,EAAE;AAAA,IACrE,SAAS,CAAC,kBAAkB,oBAAoB,QAAQ,aAAa,CAAC;AAAA,IACtE,WAAW1J,OAAK;AAAA,IAChB0J,QAAM;AAAA,EAAA;AAGD,SAAA;AAAA,IACL;AAAA,IACA,OAAO;AAAA,MACL,GAAG;AAAA,MACH,QAAQ,MAAM,UAAU,YAAY,MAAM,MAAM,EAAE,KAAK,IAAI,WAAW,OAAO,CAAC,CAAC;AAAA,MAC/E,cAAc,MAAM;AAAA,MACpB,iBAAiB,MAAM,gBAAgB,KAAK,IAAI,WAAW,OAAO,CAAC,CAAC;AAAA,IACtE;AAAA,IACA,WAAW;AAAA,MACT,GAAG;AAAA,MACH,QAAQ,MAAM,UAAU,YAAY,UAAU,MAAM,EAAE,KAAK,IAAI,WAAW,WAAW,CAAC,CAAC;AAAA,MACvF,cAAc,UAAU;AAAA,MACxB,iBAAiB,UAAU,gBAAgB,KAAK,IAAI,WAAW,WAAW,CAAC,CAAC;AAAA,IAC9E;AAAA,IACA,UAAU,MAAM,wBAAwB,SAAS;AAAA,EAAA;AAErD;ACrIgB,SAAA,QACd,IACA,QACA;AACM,QAAA,OAA8C,uBAAA,OAAO,IAAI;AAC/D,SAAO,IAAI,SAAgB;AACnB,UAAA,MAAM,OAAO,GAAG,IAAI;AACpB,WAAA,OAAO,SACX,KAAK,GAAG,IAAI,GAAG,GAAG,IAAI,IAEjB,KAAK,GAAG;AAAA,EAAA;AAEnB;AC7BgB,SAAA,cAAc,QAAsB,QAAgB,UAAkB;AAJtF,MAAA5O,KAAA;AAKQ,QAAA,SAAS,OAAO;AACtB,SAAO,IAAGA,MAAA,OAAO,YAAP,OAAAA,MAAkB,EAAE,KAAI,KAAA,OAAO,cAAP,OAAA,KAAoB,EAAE,IAAI,OAAO,WAAW,IAAI,QAAQ;AAC5F;ACEO,MAAM,eAIW;AAAA,EACtB,CAAC,QAAsB,QAAgB,cAC9B,IAAI,WAAiB,CAAC,eAAe;AACpC,UAAA,OAAO,aAAa,QAAQ,MAAM;AAC7B,WAAA,WAAA,KAAK,IAAI,GAEb,KAAK;AAAA,EACb,CAAA,EAAE,KAAK,cAAc,CAAC,GAAG,UAAU;AAAA,EAEtC;AACF;ACXA,SAAS,gBAAgB,OAEvB;AACA,SAAO,MAAM,SAAS;AACxB;AAEA,SAAS,cAAc,MAAiD;AAC/D,SAAA;AAAA,IACL,YAAY,KAAK,OAAO;AAAA,MACtB,OAAO,eAAe;AAAA,MACtB,IAAI,CAAC,UAAU,MAAM,QAAQ;AAAA,MAC7B,cAAc,CAAC;AAAA,MACf,SAAS;AAAA,IACX;AAAA,IAEA,OAAO,KAAK;AAAA,IACZ,QAAQ,KAAK;AAAA,IACb,mBAAmB,KAAK;AAAA,IACxB,iBAAiB,KAAK;AAAA,IACtB,QAAQ,KAAK;AAAA,IAEb,QAAQ,KAAK;AAAA,IACb,QAAQ,KAAK;AAAA,EAAA;AAEjB;AAyBO,MAAM,eAAe;AAAA,EAC1B,CAAC,QAAsB,QAAgB,aAC9B,aAAa,QAAQ,QAAQ,QAAQ,EAAE;AAAA,IAC5C,IAAI,CAAC,EAAC,WAAW,OAAO,kCACf;AAAA,MACL;AAAA,MACA,WAAW,cAAc,SAAS;AAAA,MAClC,OAAO,cAAc,KAAK;AAAA,IAAA,EAE7B;AAAA,IACD,cAAc,CAAC;AAAA,IACf,SAAS;AAAA,EACX;AAAA,EAEF,CAAC,QAAQ,QAAQ,aAAa;AA3EhC,QAAAA,KAAA;AA4EU,UAAA,SAAS,OAAO;AAEtB,WAAO,IAAGA,MAAA,OAAO,YAAP,OAAAA,MAAkB,EAAE,KAAI,KAAA,OAAO,cAAP,OAAA,KAAoB,EAAE,IAAI,OAAO,WAAW,IAAI,QAAQ;AAAA,EAC5F;AACF,GC9Ea,oBAAoB,CAAC,QAAgB,aAA2B;AAF7E,MAAAA;AAGE,WAAAA,MAAA,OAAO,IAAI,QAAQ,MAAnB,OAAA,SAAAA,IAAsB,cAAa;AAAA,GCwB/B,SAAmC,EAAC,SAAS,GAAA,GAC7C,aAAuC,EAAC,SAAS,MAG1C,YAAY;AAAA,EACvB,CACE,KAIA,QACA,aAC6B;AAC7B,UAAM,WAAW,kBAAkB,IAAI,QAAQ,QAAQ;AACvD,WAAO,aAAa,IAAI,QAAQ,QAAQ,QAAQ,EAAE;AAAA,MAChD;AAAA,QAAU,CAAC,aACT,cAAc;AAAA,UACZ,SAAS,MAAM;AAAA,UACf,SAAS,UAAU;AAAA,UACnB,SAAS,2BAA2B;AAAA,YAClC,IAAI,CAAC,OAA+B,GAAG,UAAU,UAAU,SAAS,UAAW;AAAA,YAC/E,UAAU,UAAU;AAAA,UACtB;AAAA,QAAA,CACD;AAAA,MACH;AAAA,MACA,IAAI,CAAC,CAAC,eAAe,mBAAmB,mBAAmB,OAAO;AAAA,QAChE,IAAI,OAAO;AAAA,QACX,MAAM;AAAA,QACN,OAAO;AAAA,QACP,WAAW;AAAA,QACX;AAAA,QACA,OAAO;AAAA,QACP;AAAA,MAAA,EACA;AAAA,MACF,UAAU;AAAA,QACR,IAAI,OAAO;AAAA,QACX,MAAM;AAAA,QACN,OAAO;AAAA,QACP,WAAW;AAAA,QACX;AAAA,QACA,OAAO;AAAA,QACP,qBAAqB;AAAA,MAAA,CACtB;AAAA,MACD,cAAc,CAAC;AAAA,MACf,SAAS;AAAA,IAAA;AAAA,EAEb;AAAA,EACA,CAAC,KAAK,QAAQ,aAAa,cAAc,IAAI,QAAQ,QAAQ,QAAQ;AACvE,GCjEa,oBAIc;AAAA,EACzB,CAAC,QAAsB,QAAgB,aAC9B,aAAa,QAAQ,QAAQ,QAAQ,EAAE;AAAA,IAC5C;AAAA,MAAU,CAAC,EAAC,OAAO,UAAS,MAC1B,cAAc,CAAC,MAAM,cAAc,UAAU,YAAY,CAAC;AAAA,IAC5D;AAAA,IACA;AAAA,MACE,CAAC,CAAC,mBAAmB,qBAAqB,MAAM,qBAAqB;AAAA,IACvE;AAAA,IACA,qBAAqB;AAAA,IACrB,cAAc,CAAC;AAAA,IACf,SAAS;AAAA,EACX;AAAA,EAEF,CAAC,QAAQ,QAAQ,aAAa;AA5BhC,QAAAA,KAAA;AA6BU,UAAA,SAAS,OAAO;AAEtB,WAAO,IAAGA,MAAA,OAAO,YAAP,OAAAA,MAAkB,EAAE,KAAI,KAAA,OAAO,cAAP,OAAA,KAAoB,EAAE,IAAI,OAAO,WAAW,IAAI,QAAQ;AAAA,EAC5F;AACF,GCpBa,gBAAgB;AAAA,EAC3B,CACE,KAKA,QACA,aAEO,aAAa,IAAI,QAAQ,QAAQ,QAAQ,EAAE;AAAA,IAChD;AAAA,MAAU,CAAC,aACT,cAAc,CAAC,SAAS,MAAM,YAAY,SAAS,UAAU,UAAU,CAAC,EAAE;AAAA,QACxE;AAAA,UACE,CAAC,CAAC,OAAO,SAAS,OAAsB;AAAA,YACtC,GAAG;AAAA,YACH;AAAA,YACA;AAAA,YACA,WAAW,EAAC,OAAO,UAAS;AAAA,YAC5B,OAAO,SAAS;AAAA,YAChB,WAAW,SAAS;AAAA,UAAA;AAAA,QAExB;AAAA,MACF;AAAA,IACF;AAAA,IACA,cAAc,CAAC;AAAA,IACf,SAAS;AAAA,EACX;AAAA,EAEF,CAAC,KAAK,QAAQ,aAAa;AA1C7B,QAAAA,KAAA;AA2CU,UAAA,SAAS,IAAI,OAAO,OAAO;AAEjC,WAAO,IAAGA,MAAA,OAAO,YAAP,OAAAA,MAAkB,EAAE,KAAI,KAAA,OAAO,cAAP,OAAA,KAAoB,EAAE,IAAI,OAAO,WAAW,IAAI,QAAQ;AAAA,EAC5F;AACF,GC3Ca,SAAwB;AAAA,EACnC,UAAU,MAAa;AAAA,EACvB,SAAS,CAAC,EAAC,OAAO,iBAChB,MAAM,OAAO,GACb,UAAU,OAEH,GAAAkF;AAEX,GCTa,MAA8C;AAAA,EACzD,UAAU,CAAC,EAAC,UAAA,MAAgB,UAAU,SAAS,UAAU,YAAY,KAAQ;AAAA,EAC7E,SAAS,CAAC,EAAC,QAAQ,QAAQ,QAAQ,eAAc;AAC/C,UAAM,KAAK,OAAO,WAAW,YAAc,EAAA,OAAO,OAAO,WAAW;AAEpE,WAAI,kBAAkB,QAAQ,QAAQ,IAC7B,GAAG,OAAO,EAAC,KAAK,kBAAkB,CAAA,IAGpC,GAAG,OAAO,OAAO,OAAO,EAAE,OAAO;AAAA,MACtC,KAAK;AAAA;AAAA;AAAA;AAAA,MAIL,qCAAqC;AAAA,IAAA,CACtC;AAAA,EACH;AACF,GChBa,iBAAoD;AAAA,EAC/D,UAAU,CAAC,EAAC,UAAS,MACd,UAAU,QAGV,UAAU,YAGR,KAFE,kBAHA;AAAA,EAOX,SAAS,CAAC,EAAC,QAAQ,OAAM,MAChB,OAAO,WACX,YAAA,EACA,OAAO,OAAO,OAAO,EACrB,OAAO,EAAC,KAAK,4BAA2B;AAE/C,GCdM,YAAY,CAAC,cAAc,YAAY,GAEhC,YAA6E;AAAA,EACxF,UAAU,CAAC,EAAC,UAAA,MACH,UAAU,aAAa,UAAU,QAAQ,KAAQ;AAAA,EAE1D,SAAS,CAAC,EAAC,QAAQ,QAAQ,WAAW,YAAW,WAAW;AACpD,UAAA,SAAS,UAAU,SAAS,UAAU;AAE5C,QAAI,CAAC;AACG,YAAA,IAAI,MAAM,kCAAkC;AAGpD,WAAO,OAAO,WAAW;AAAA,MACvB;AAAA,QACE,GAAG,KAAK,QAAQ,SAAS;AAAA,QACzB,KAAK,kBAAkB,QAAQ,QAAQ,IAAI,SAAS,WAAW,MAAM;AAAA,QACrE,OAAO,OAAO;AAAA,MAChB;AAAA,MACA;AAAA,QACE,KAAK;AAAA,MACP;AAAA,IAAA;AAAA,EAEJ;AACF,GC1Ba,QAAgF;AAAA,EAC3F,UAAU,MAAa;AAAA,EACvB,SAAS,CACP,EAAC,QAAQ,WAAW,QAAQ,OAAO,WAAW,SAAQ,GACtD,UAAU,CAAA,GACV,oBACS;AACL,sBAAkB,QAAQ,QAAQ,IAEpC,UAAU,OAAO;AAAA,MACf,UAAU,kBAAkB;AAAA,QAC1B,OAAO;AAAA,QACP,GAAG;AAAA,MAAA,CACJ;AAAA,MACD,GAAG,UAAU,MAAM,OAAO;AAAA,IAAA,CAC3B,IAED,MAAM,OAAO;AAAA,MACX,MAAM,kBAAkB;AAAA,QACtB,GAAG;AAAA,QACH,GAAG,UAAU;AAAA,QACb,KAAK,OAAO;AAAA,QACZ,OAAO;AAAA,MAAA,CACR;AAAA,MACD,GAAG,MAAM,MAAM,OAAO;AAAA,IAAA,CACvB;AAAA,EAEL;AACF;AC1BA,SAAS,oBAA6B,KAAW;AAC/C,SAAImE,cAAY,GAAG,IACb,IAAI,uBACC;AAAA,IACL;AAAA,IACA,CAAC,sBAAsB,EAAE,OAAO,IAAI,qBAAqB,OAAO,CAAA,IAAK,CAAC,OAAO,CAAC;AAAA,EAAA,IAG3E,MAEL,OAAO,OAAQ,YAAY,CAAC,MAAY,MACxC,MAAM,QAAQ,GAAG,IAAU,IAAI,IAAI,mBAAmB,IACnD,OAAO;AAAA,IACZ,OAAO,QAAQ,GAAG,EAAE,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,CAAC,KAAK,oBAAoB,KAAK,CAAC,CAAU;AAAA,EAAA;AAExF;AAIO,MAAM,UAA6C;AAAA,EACxD,UAAU,CAAC,EAAC,QAAQ,UAAU,UACxB,MAAA,kBAAkB,QAAQ,QAAQ,IAC7B,sBAEJ,UAAU,QAGR,KAFE,UAAU,YAAY,sBAAsB;AAAA,EAIvD,SAAS,CAAC,EAAC,QAAQ,QAAQ,gBAAe;AACxC,QAAI,CAAC,UAAU;AACP,YAAA,IAAI,MAAM,gDAAgD;AAE5D,UAAA,QAAQ,oBAAoB,KAAK,UAAU,OAAO,YAAY,CAAC,GAC/D,KAAK,OAAO,WAAW,YAAY;AACzC,QAAI,CAAC,UAAU;AACP,YAAA,IAAI,MAAM,gDAAgD;AAGlE,WAAI,UAAU,aAGZ,GAAG,MAAM,OAAO,aAAa;AAAA;AAAA,MAE3B,OAAO,CAAC,8BAA8B;AAAA,MACtC,cAAc,UAAU,UAAU;AAAA,IAAA,CACnC,GAED,GAAG,gBAAgB;AAAA,MACjB,GAAG;AAAA,MACH,KAAK,OAAO;AAAA,MACZ,OAAO,UAAU,MAAM;AAAA,IAAA,CACxB,KAID,GAAG,OAAO;AAAA,MACR,GAAG;AAAA,MACH,KAAK,OAAO;AAAA,MACZ,OAAO,UAAU,MAAM;AAAA,IACxB,CAAA,GAGH,GAAG,OAAO,OAAO,OAAO,GAEjB,GAAG,OAAO,EAAC,KAAK,oBAAoB,YAAY,QAAQ,CAAA;AAAA,EACjE;AACF,GCtEa2F,YAAiD;AAAA,EAC5D,UAAU,MAAa;AAAA,EACvB,SAAS,CAAC,EAAC,cAAc,QAAQ,QAAQ,YAAW,iBAAyB;AAC3E,UAAM,WAAW,kBAAkB,QAAQ,QAAQ,IAAI,OAAO,cAAc,OAAO;AACnF,WAAO,aAAa,QAAQ,OAAO,aAAa,UAAU,YAAY;AAAA,EACxE;AACF,GCFa,YAA+C;AAAA,EAC1D,UAAU,CAAC,EAAC,QAAQ,WAAW,SAAQ,MACjC,kBAAkB,QAAQ,QAAQ,IAC7B,sBAEF,UAAU,YAAY,KAAQ;AAAA,EAEvC,SAAS,CAAC,EAAC,QAAQ,QAAQ,gBAAe;AACxC,QAAI,KAAK,OAAO,WAAW,YAAc,EAAA,OAAO,OAAO,WAAW;AAElE,WAAI,UAAU,cACZ,KAAK,GAAG,kBAAkB;AAAA,MACxB,GAAG,KAAK,UAAU,WAAW,YAAY;AAAA,MACzC,KAAK,OAAO;AAAA,MACZ,OAAO,UAAU,UAAU;AAAA,IAAA,CAC5B,IAGI,GAAG,OAAO;AAAA,MACf,KAAK;AAAA,MACL,YAAY;AAAA;AAAA;AAAA;AAAA,MAIZ,qCAAqC;AAAA,IAAA,CACtC;AAAA,EACH;AACF;ACOA,SAAS,gBAAgB,GAA2B;AAClD,SAAO,OAAO,IAAM,MAAc,GAAG,IAAI,IAAI;AAC/C;AAEA,MAAM,iBAAiB;AAAA,EACrB;AAAA,EACA,QAAQ;AAAA,EACR;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAAA,SACAA;AACF,GAEM,UAAU,CACd,eACA,oBACA,cACoB;AACd,QAAA,YAAY,eAAe,aAAa;AACvC,SAAA;AAAA,IAAM,MACX,MAAM,GAAG,IAAI,GAAG,gBAAgB,UAAU,QAAQ,oBAAoB,GAAG,SAAS,CAAC,CAAC;AAAA,EAAA,EACpF,KAAK,KAAA,CAAM;AACf,GAEM,kBAAkB,IAAI;AAGrB,SAAS,cACd,eACA,QACA,UACA,WACM;AACN,kBAAgB,KAAK,EAAC,eAAe,QAAQ,UAAU,WAAU;AACnE;AAGA,MAAM,uBAAuB,CAAC,WAAW,aAAa,kBAAkB,QAAQ,GAmCnE,kBAAkB;AAAA,EAC7B,CAAC,QAA4E;AAC3E,UAAM,UAA+D,gBAAgB;AAAA,MACnFC,UAAQ,CAAC,OAAO,GAAG,OAAO,WAAW;AAAA,MACrC;AAAA,QAAS,CAAC,YACR,QAAQ;AAAA;AAAA;AAAA;AAAA,UAIN;AAAA,YAAU,CAAC,SACT,cAAc,KAAK,KAAK,QAAQ,KAAK,QAAQ,EAAE;AAAA,cAC7C,KAAK,CAAC;AAAA,cACN,UAAU,CAAC,uBAAuB;AAChC,sBAAM,sBAAsB,qBAAqB,SAAS,KAAK,aAAa;AACxE,wCACF,mBAAmB,UAAU,UAC7B,mBAAmB,MAAM,OAAO;AAElC,sBAAM,gBAAgB;AAAA,kBACpB,IAAI;AAAA,kBACJ,KAAK;AAAA,kBACL,KAAK;AAAA,gBACL,EAAA,KAAK,OAAO,OAAO,CAAC;AACP,wBAAA,sBAAsB,cAAc,KAAK,KAAK,CAAC,CAAC,IAAI,GAAG,EAAI,GAC5D;AAAA,kBACZ,UAAU,MAAM,QAAQ,KAAK,eAAe,oBAAoB,KAAK,SAAS,CAAC;AAAA,gBAAA;AAAA,cACjF,CACD;AAAA,cACD,IAAI,OAA4B,EAAC,MAAM,WAAW,KAAM,EAAA;AAAA,cACxD;AAAA,gBACE,CAAC,QAAuC,GAAG,EAAC,MAAM,SAAS,MAAM,OAAO,KAAI;AAAA,cAC9E;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAAA,MACAL,QAAM;AAAA,IAAA,GAKF,cAAc,QAAQ;AAAA,MAC1B,OAAO,CAAC,WAAW,OAAO,SAAS,aAAa,OAAO,KAAK,kBAAkB,OAAO;AAAA,MACrF,aAH0B,KAGQ,gBAAgB,EAAC,SAAS,IAAM,UAAU,IAAK;AAAA,MACjF,IAAI,CAAC,WAAW;AACA,sBAAA,UAAU,OAAO,KAAK,QAAQ,OAAO,KAAK,UAAU,CAAA,CAAE;AAAA,MAAA,CACrE;AAAA,IAAA;AAGH,WAAO,MAAM,SAAS,YAAY,KAAK,WAAW1J,OAAK,CAAC,CAAC;AAAA,EAC3D;AAAA,EACA,CAAC,QAAQ;AAvKX,QAAAlF,KAAA;AAwKU,UAAA,SAAS,IAAI,OAAO,OAAO;AAE1B,WAAA,IAAGA,aAAO,YAAP,OAAAA,MAAkB,EAAE,KAAI,KAAA,OAAO,cAAP,OAAA,KAAoB,EAAE;AAAA,EAC1D;AACF,GC7HM,4BAA8C;AAAA,EAClD,cAAc;AAAA,EACd,YAAY,CAAC;AACf;AAEA,SAAS,iBAAiB,KAAuB;AACxC,SAAAkP;AAAAA,IACL;AAAA,IACA,CAAC,KAAK,UACA7F,cAAY,IAAI,KAClB,IAAI,IAAI,KAAK,IAAI,GAEZ;AAAA,wBAEL,IAAY;AAAA,EAAA;AAEpB;AAEA,MAAM,mBAAuC,CAAA,GAMvC,uBAAuB,CAC3B,6BACAxK,QAEA,4BAA4BA,GAAE,EAAE,KAAK,IAAI,CAAC,EAAC,gBAAe,UAAU,SAAS,CAAC,GAG1E,mBAAmB,KAGnB,mBAAmB;AAEzB,SAAS,0BAA6B;AACpC,SAAO,YAAe,EAAC,YAAY,GAAG,UAAU,IAAK;AACvD;AAGO,MAAM,aAAa;AAAA,EACxB,CACE,KAOA,EAAC,SAAS,YAAA,GACV,aACiC;AAC3B,UAAA,YAAY,UAAU,KAAK,EAAC,SAAS,YAAW,GAAG,QAAQ,EAAE;AAAA,MACjE,IAAI,CAAC,EAAC,OAAO,UAAS,MAAM,SAAS,SAAS;AAAA,MAC9C,aAAa,kBAAkB,gBAAgB,EAAC,UAAU,IAAK;AAAA,MAC/D,qBAAqB,CAAC,MAAM,UACtB,6BAAM,WAAS,QAAA,OAAA,SAAA,KAAM,QAChB,KAIF,cAAc,KAAK,MAAM,QAAQ,YAAY,GAAG,KAAK,MAAM,QAAQ,YAAY,CAAC,CACxF;AAAA,MACD,wBAAwB;AAAA,IAAA,GASpB,sBANgB,UAAU;AAAA,MAC9B,IAAI,CAACa,cAAa,iBAAiBA,SAAQ,CAAC;AAAA,MAC5C,SAAS,CAAC,QAAQ,KAAK,GAAG,CAAC;AAAA,IAAA,EAIa;AAAA,MACxCuP,UAAQ,CAACpQ,QAAOA,KAAI,EAAC,UAAU,MAAM,MAAM,MAAO,KAAK,EAAE,GAAE;AAAA,MAC3D;AAAA,QAAS,CAAC,QACR,IAAI;AAAA,UACF,SAAS;AAAA,UACT;AAAA,YAAS,CAACA,QACR,qBAAqB,IAAI,iCAAiCA,GAAE,EAAE;AAAA,cAC5D;AAAA;AAAA,gBAEE,CAAC,WAAW,CAACA,KAAI,MAAM;AAAA,cACzB;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAAA,MACA,KAAK,CAAC,KAA8B,CAACA,KAAI,MAAM,MACzC,IAAIA,GAAE,MAAM,SACP,MAEF,EAAC,GAAG,KAAK,CAACA,GAAE,GAAG,OACrB,GAAA,EAAE;AAAA,MACL,qBAAqB,aAAa;AAAA,MAClC,wBAAwB;AAAA,IAKpB,GAAA,oBAAuC,CAAC,EAAC,IAAAA,UAC7C;AAAA,MACE,oBAAoB;AAAA;AAAA;AAAA,QAGlB,MAAM,CAAC,uBAAuBA,OAAM,kBAAkB;AAAA,QACtD,IAAI,CAAC,uBAAuB,mBAAmBA,GAAE,CAAC;AAAA,MACpD;AAAA,IAAA,GAGE,4BAA4B,oBAAoB;AAAA;AAAA;AAAA,MAGpD,KAAK,CAAC;AAAA,MACN,aAAa,kBAAkB,gBAAgB,EAAC,SAAS,IAAM,UAAU,IAAK;AAAA,IAAA;AAGzE,WAAA,cAAc,CAAC,WAAW,OAAO,GAAG,IAAI,GAAG,yBAAyB,CAAC,CAAC,EAAE;AAAA,MAC7E,IAAI,CAAC,CAACa,SAAQ,MAAMA,SAAQ;AAAA,MAC5B,uBAAuB,CAACA,cACf,MAAM,MACNA,+BAAU,QAGR;AAAA,QACL,GAAG,EAAC,cAAc,IAAM,UAAUA,UAAS,MAAK;AAAA,QAChD,2BAA2B;AAAA,UACzB,UAAAA;AAAA,UACA,WAAW,IAAI;AAAA,UACf;AAAA,UACA,MAAM,IAAI;AAAA,UACV,QAAQ,IAAI;AAAA,UACZ,aAAa;AAAA,QACd,CAAA,EAAE;AAAA,UACD,IAAI,CAAC,uBAAuB,EAAC,YAAY,mBAAmB,cAAc,KAAO;AAAA,QACnF;AAAA,MAAA,IAbO,GAAG,EAAC,YAAY,kBAAkB,cAAc,GAAM,CAAA,CAehE,CACF;AAAA,MACD,KAAK,CAAC,KAAK,UAAU,EAAC,GAAG,KAAK,GAAG,SAAQ,yBAAyB;AAAA,MAClE,wBAAwB;AAAA,IAAA;AAAA,EAE5B;AAAA,EACA,CAAC,KAAK,QAAQ,aAAa;AA9L7B,QAAAM,KAAA;AA+LU,UAAA,SAAS,IAAI,OAAO,OAAO;AAEjC,WAAO,IAAGA,MAAA,OAAO,YAAP,OAAAA,MAAkB,EAAE,KAAI,KAAA,OAAO,cAAP,OAAA,KAAoB,EAAE,IAAI,OAAO,WAAW,IAAI,QAAQ;AAAA,EAC5F;AACF,GCvLa,iBAAiB;AAAA,EAC5B,CAAC,QAAsB,QAAgB,aAC9B,aAAa,QAAQ,QAAQ,QAAQ,EAAE;AAAA,IAC5C,UAAU,CAAC,EAAC,OAAO,UAAe,MAAA,MAAM,MAAM,QAAQ,UAAU,MAAM,CAAC;AAAA,EACzE;AAAA,EAEF;AACF;ACPA,SAAS,qBAAqB,QAA+C;AACpE,SAAA;AAAA,IACL,UAAU;AAAA,IACV,SAAS,MAAM;AACb,YAAM,IAAI,MAAM,UAAU,MAAM,uBAAuB;AAAA,IACzD;AAAA,EAAA;AAEJ;AAKO,MAAM,UAAyB;AAAA,EACpC,QAAQ,qBAAqB,QAAQ;AAAA,EACrC,QAAQ,qBAAqB,QAAQ;AAAA,EACrC,KAAK,qBAAqB,KAAK;AAAA,EAC/B,SAAS,qBAAqB,SAAS;AAAA,EACvC,OAAO,qBAAqB,OAAO;AAAA,EACnC,gBAAgB,qBAAqB,gBAAgB;AAAA,EACrD,WAAW,qBAAqB,WAAW;AAAA,EAC3C,WAAW,qBAAqB,WAAW;AAAA,EAC3C,SAAS,qBAAqB,SAAS;AACzC,GACM,gBACJ,CAAC,eAAoC,QAAgB,aACrD,IAAI,gBACF,cAAc,eAAe,QAAQ,UAAU,WAAW;AAE9D,SAAS,KACP,QACA,IACAmP,gBACsC;AAE/B,SAAA;AAAA,IACL,UAFe,GAAG,SAASA,cAAa;AAAA,IAGxC,SAAS,cAAc,QAAQA,eAAc,QAAQA,eAAc,QAAQ;AAAA,EAAA;AAE/E;AAEO,SAAS,oBAAoB,MAAoC;AAC/D,SAAA;AAAA,IACL,QAAQ,KAAK,UAAU,QAAQ,IAAI;AAAA,IACnC,QAAQ,KAAK,UAAU,KAAK,IAAI;AAAA,IAChC,KAAK,KAAK,UAAU,KAAK,IAAI;AAAA,IAC7B,SAAS,KAAK,WAAW,SAAS,IAAI;AAAA,IACtC,OAAO,KAAK,SAAS,OAAO,IAAI;AAAA,IAChC,gBAAgB,KAAK,kBAAkB,gBAAgB,IAAI;AAAA,IAC3D,WAAW,KAAK,aAAa,WAAW,IAAI;AAAA,IAC5C,WAAW,KAAK,aAAa,WAAW,IAAI;AAAA,IAC5C,SAAS,KAAK,WAAWH,WAAS,IAAI;AAAA,EAAA;AAE1C;AClDO,MAAM,iBAAiB;AAAA,EAC5B,CACE,KAKA,QACA,aAC8B;AAC9B,UAAM,mBAAmB,gBAAgB,GAAG,GAGtC,cADiB,cAAc,KAAK,QAAQ,QAAQ,EACvB,KAAK,IAAI,mBAAmB,CAAC;AAGzD,WAAA;AAAA,MACL,GAAG,OAAO;AAAA,MACV,MAAM,iBAAiB,KAAK,SAAS,MAAM9J,OAAK,CAAC,GAAG,WAAW;AAAA,IAAA,EAC/D,KAAK,YAAY,EAAC,UAAU,IAAM,YAAY,EAAE,CAAA,CAAC;AAAA,EACrD;AAAA,EACA,CAAC,KAAK,QAAQ,aAAa,cAAc,IAAI,QAAQ,QAAQ,QAAQ;AACvE;AClCO,SAAS,SAAS,OAAkD;AACzE,SAAO,cAAc,KAAK;AAC5B;ACAwB,SAAA,WACtB,QACA,QACyB;AACzB,QAAM,SAAS,EAAC,GAAG,QAAQ,GAAG,OAAM;AAEpC,SAAA,OAAO,KAAK,MAAM,EAAE,QAAQ,CAAC,QAAQ;AACnC,UAAM,YAAY,OAAO,GAAG,GACtB,YAAY,OAAO,GAAG;AACxB,aAAS,SAAS,KAAK,SAAS,SAAS,MAC3C,OAAO,GAAG,IAAI,WAAW,WAAW,SAAS;AAAA,EAEhD,CAAA,GACM;AACT;ACXA,MAAM,oBAAoB;AAAA,EACxB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GACM,0BAA8C,CAAC,MAAM,SAAS,cAAc,OAAO;AAEzF,SAAS,WAAW,UAAoB,GAAW;AAC1C,SAAA,MAAM,SAAS,MAAM,SAAS,KAAK,KAAM,OAAO,KAAM,YAAY,YAAY,CAAC,MAAO;AAC/F;AAEA,SAAS,MAAM,KAAa;AAC1B,SAAO,OAAO,IAAI,SAAS,IAAI,IAAI,GAAG,MAAM;AAC9C;AAEgB,SAAA,kBAAkB,QAAgB,WAAmC;AAC7E,QAAA,4BAAY;AAER,SAAA,UAAA,QAAQ,CAAC,UAAU,MAAM;AAC3B,UAAArG,MAAK,WAAW,UAAU,CAAC;AAEjC,QAAI,OAAQ,SAAkC,SAAW,OAAe,CAAC,SAAS;AAChF,YAAM,IAAI,MAAM,YAAYA,GAAE,6DAA6D;AAGvF,UAAA,UAAU,wBAAwB,OAAO,CAAC,SAAS,CAAC,SAAS,IAAI,CAAC;AACxE,QAAI,QAAQ,SAAS;AACb,YAAA,IAAI,MAAM,YAAYA,GAAE,oCAAoC,QAAQ,KAAK,IAAI,CAAC,EAAE;AAGxF,QAAI,OAAO,SAAS,SAAU,cAAc,CAAC,SAAS,SAAS,KAAK;AAClE,YAAM,IAAI;AAAA,QACR,YAAYA,GAAE;AAAA,MAAA;AAId,QAAA,OAAO,SAAS,aAAe;AAC7B,UAAA,MAAM,QAAQ,SAAS,UAAU;AAC1B,iBAAA,WAAW,QAAQ,CAAC,OAAO,MAAM,kBAAkB,QAAQ,OAAO,UAAU,CAAC,CAAC;AAAA;AAEvF,cAAM,IAAI,MAAM,YAAYA,GAAE,yDAAyD;AAI3F,QAAI,MAAM,IAAI,SAAS,EAAE,GAAG;AAC1B,YAAM,YAAY,MAAM,IAAI,SAAS,EAAE,GACjC,OAAO,GAAG,MAAM,UAAU,SAAS,EAAE,KAAK,CAAC,aAAa,SAAS;AACvE,YAAM,IAAI;AAAA,QACR,aAAa,SAAS,KAAK,cAAc,CAAC,sBAAsB,SAAS,EAAE,kBAAkB,IAAI;AAAA,MAAA;AAAA,IAErG;AAEM,UAAA,IAAI,SAAS,IAAI,CAAC;AAAA,EACzB,CAAA,GAEM;AACT;AAEgB,SAAA,2BACd,OACA,UACG;AACH,QAAM,eAAe,CAAC,QAAgB,aAAa,SAAS,EAAE,oBAAoB,GAAG;AAEjF,MAAA,CAAC,SAAS,KAAK;AACjB,UAAM,IAAI,MAAM,aAAa,0BAA0B,CAAC;AAG1D,MAAI,MAAM,SAAS,SAAS,eAAe,MAAM;AAC/C,UAAM,IAAI;AAAA,MACR;AAAA,QACE,8BAA8B,MAAM,KAAK,mCAAmC,SAAS,UAAU;AAAA,MACjG;AAAA,IAAA;AAIA,MAAA;AACF,WAAO,cAAc,KAAK;AAAA,WACnB,KAAK;AACZ,UAAA,IAAI,UAAU,aAAa,IAAI,OAAO,GAChC;AAAA,EACR;AACF;AAEA,SAAS,cAAc,OAAgB,OAA4B,CAAC,GAAG,gBAAgB,IAAY;AAC7F,MAAA,MAAM,QAAQ,KAAK;AACrB,WAAO,MAAM,IAAI,CAAC,MAAM,MAAM;AACxB,UAAA,MAAM,QAAQ,IAAI;AACpB,cAAM,IAAI;AAAA,UACR,uDAAuDkD,SAAa,IAAI,CAAC;AAAA,QAAA;AAI7E,aAAO,cAAc,MAAM,KAAK,OAAO,CAAC,GAAG,EAAI;AAAA,IAAA,CAChD;AAGC,MAAA,CAAC,SAAS,KAAK;AACV,WAAA;AAIH,QAAA,UAAgC,iBAAiB,CAAC,MAAM,OAAO,EAAC,MAAMuD,cAAW,IAAI;AAG3F,SAAI,KAAK,SAAS,KAAK,CAAC,MAAM,SACxB,MAAM,SAER,QAAQ,QAAQ,cAOhB,MAAM,QACR,kBAAkB,OAAO,IAAI,GAIxB,OAAO,KAAK,KAAK,EAAE,OAAO,CAAC,KAAK,SACrC,IAAI,GAAG,IAAI,cAAc,MAAM,GAAG,GAAG,KAAK,OAAO,CAAC,GAAG,CAAC,CAAC,GAChD,MACN,OAAO;AACZ;AAEA,SAAS,kBACP,QACA,WACA,UACA,OACA;AAGA,MAAI,CAAC,UAAU;AACb,UAAM,IAAI;AAAA,MACR,YAAY,SAAS,EAAE,6BAA6B,KAAK;AAAA,IAAA;AAK7D,MAAI,UAAU,SAAS;AACrB,UAAM,IAAI;AAAA,MACR,kEAAkE,KAAK,iBAAiB,SAAS,EAAE;AAAA,IAAA;AAIvG,MAAI,CAAC,OAAO,IAAI,UAAU,IAAI;AAC5B,UAAM,IAAI;AAAA,MACR,uBAAuB,UAAU,IAAI,mCAAmC,UAAU,IAAI;AAAA,IAAA;AAG5F;AAEA,SAAS,kBACP,OACA,OAA4B,IAC5B;AACI,MAAA,CAAC,MAAM,SAAS,MAAM;AACxB,UAAM,IAAI;AAAA,MACR,oEAAoEvD,SAAa,IAAI,CAAC;AAAA,IAAA;AAI1F,QAAM,aAAa,OAAO,KAAK,KAAK,EAAE,OAAO,CAAC,QAAQ,CAAC,kBAAkB,SAAS,GAAG,CAAC;AAClF,MAAA,WAAW,SAAS,GAAG;AACzB,UAAM,SAAS,WAAW,SAAS,IAAI,eAAe;AACtD,UAAM,IAAI;AAAA,MACR,cAAc,MAAM,wBAAwB,WACzC,IAAI,KAAK,EACT,KAAK,IAAI,CAAC,aAAaA,SAAa,IAAI,CAAC;AAAA,IAAA;AAAA,EAEhD;AACF;AChKO,SAAS,UAAU,UAAwD;AAChF,SAAO,SAAS,QAAQ,KAAK,OAAO,SAAS,aAAc;AAC7D;AAKsB,eAAA,aACpB,iBACA,QACA,SACmC;AACnC,SAAO,OAAO,mBAAoB,aAC7B,gBAA+D,QAAQ,OAAO,IAC/E;AACN;AAGA,eAAsB,oBACpB,QACA,UACA,SAA+B,CAAA,GAC/B,SAC+B;AAE/B,MAAI,UAAU,QAAQ;AACpB,WAAO,oBAAoB,QAAQ,SAAS,UAAU,GAAG,QAAQ,OAAO;AAG1E,QAAM,EAAC,IAAAlD,KAAI,YAAY,gBAAgB,UAAS;AAChD,MAAI,CAAC;AACH,UAAM,IAAI,MAAM,aAAaA,GAAE,gCAAgC;AAGjE,MAAI,gBAAgB,MAAM,aAAa,OAAO,QAAQ,OAAO;AAEzD,MAAA,CAAC,SAAS,aAAa;AACzB,UAAM,IAAI;AAAA,MACR,aAAaA,GAAE;AAAA,IAAA;AAKf,WAAS,aAAa,KAAK,CAAC,OAAO,KAAK,aAAa,EAAE,WACzD,gBAAgB,EAAC,OAAO,eAAA,IAI1B,gBAAgB,2BAA2B,eAAe,QAAQ;AAG5D,QAAA,aAAa,OAAO,IAAI,cAAc;AAC5C,MAAI,CAAC;AACH,UAAM,IAAI,MAAM,yCAAyC,cAAc,IAAI;AAG7E,QAAM,WAAW;AAAA,IACd,MAAM,2BAA2B,YAAY,QAAQ,6BAA6B,OAAO,KACxF,CAAC;AAAA,IACH;AAAA,EAAA;AAKK,SAAA,2BAA2B,UAAU,QAAQ;AACtD;AAGgB,SAAA,YAAY,WAA4B,MAAuC;AACvF,QAAA,eAAeoG,kBAAgB,IAAI;AAEzC,SAAO,iBAAiB,YAAY,UAAU,GAAG,WAAW,IACxD,UAAU,GAAG,CAAC,IACd,UAAU,GAAG,KAAK,CAAC,eAAe,WAAW,SAAS,YAAY;AACxE;AAGO,MAAM,8BAA8B;AAOpC,SAAS,2BAId,MAIA,QAIA,WAAW,6BACX,SACc;AACd,SAAI,YAAY,IACP,QAAQ,QAAQ,MAAS,IAG9B,mBAAmB,IAAI,IAClB,0BAA0B,MAAM,QAAQ,UAAU,OAAO,IAG9D,kBAAkB,IAAI,IACjB,yBAAyB,MAAM,QAAQ,UAAU,OAAO,IAG1D,aAAa,KAAK,cAAc,QAAQ,OAAO;AACxD;AAEA,eAAe,yBACb,MACA,QACA,UACA,SACc;AACd,QAAM,eAAe,MAAM,aAAa,KAAK,cAAc,QAAW,OAAO;AAExE,MAAA,MAAM,QAAQ,YAAY;AAI/B,WAAO,QAAQ;AAAA,MACb,aAAa,IAAI,OAAO,gBAAgB;AAChC,cAAA,WAAW,YAAY,MAAyB,WAAW;AAC1D,eAAA,mBAAmB,QAAQ,IAC9B;AAAA,UACE,GAAG;AAAA,UACH,GAAI,MAAM,2BAA2B,UAAU,QAAQ,WAAW,GAAG,OAAO;AAAA,UAC5E,MAAMK,YAAU;AAAA,QAElB,IAAA;AAAA,MAAA,CACL;AAAA,IAAA;AAEL;AAGA,eAAsB,0BACpB,MACA,QACA,UACA,SACc;AACd,QAAM,gBAAyC;AAAA,IAC7C,GAAK,MAAM,aAAa,KAAK,cAAc,QAAQ,OAAO,KAAM,CAAC;AAAA,EAAA,GAG7D,cAAmC,CAAA;AACzC,QAAM,QAAQ;AAAA,IACZ,KAAK,OAAO,IAAI,OAAO,UAAU;AAC/B,YAAM,oBAAoB,MAAM;AAAA,QAC9B,MAAM;AAAA,QACN;AAAA,QACA,WAAW;AAAA,QACX;AAAA,MAAA;AAEqC,2BAAsB,SAC3D,YAAY,MAAM,IAAI,IAAI;AAAA,IAAA,CAE7B;AAAA,EAAA;AAGG,QAAA,SAAS,WAAW,aAAa,aAAa;AAEpD,MAAI,aAAY,MAAM;AAItB,WAAI,KAAK,SAAS,aAChB,OAAO,QAAQ,KAAK,OAGf;AACT;ACxKA,MAAM,cAAsC,EAAC,MAAM;AAK5C,SAAS,sBACd,QACA,uBACA,sBACA,MACA,SAC6B;AAC7B,QAAM,SAAS,qBAAqB;AAAA,IAClC,EAAC,OAAO,aAAa,MAAM,WAAW,KAAK,UAAU,EAAC;AAAA,IACtD,CAAC,OAAO;AAAA,EAAA,GAGJ,aAAa,qBAAqB;AAAA,IACtC,EAAC,OAAO,aAAa,MAAM,eAAe,KAAK,UAAU,EAAC;AAAA,IAC1D,CAAC,OAAO;AAAA,EAAA;AAGK,SAAA;AAAA,IACb,OAAO,KAAK,IAAI,CAAC,WAAW,EAAC,QAAO,CAAC;AAAA,IACrC,WAAW,KAAK,IAAI,CAAC,eAAe,EAAC,YAAW,CAAC;AAAA,EAAA,EACjD;AAAA,IACA,KAAK,CAAC,MAAM,SAAS,EAAC,GAAG,MAAM,GAAG,QAAO,EAAE;AAAA;AAAA,IAE3C,OAAO,CAAC,QAAQ,WAAW,OAAO,eAAe,GAAG;AAAA,IACpD,IAAI,CAAC,QAAa,IAAI,SAAS,IAAI,SAAS;AAAA;AAAA,IAE5C,qBAAqB,CAAC,MAAM,SAAS,CAAQ,CAAA,QAAU,EAAQ,IAAK;AAAA;AAAA,IAEpE,aAAa,EAAE;AAAA,EAAA,EAGH;AAAA,IACZ,UAAU,CAAC5F,cAAa;AAElB,UAAAA;AACF,eAAO,GAAG,EAAC,MAAM,WAAW,OAAO,MAAK;AAG1C,UAAI,CAAC,KAAK;AAER,eAAO,GAAG,EAAC,aAAa,IAAO,cAAc,QAAU;AAGnD,YAAA,WAAW,sBAAsB,KAAK,CAACQ,OAAMA,GAAE,OAAO,KAAK,YAAY;AAE7E,UAAI,CAAC;AAEK,eAAA,QAAA,KAAK,wDAAwD,KAAK,YAAY,GAC/E,GAAG,EAAC,aAAa,IAAO,cAAc,OAAU,CAAA;AAGzD,YAAM,0BAA0B;AAAA,QAC9B,oBAAoB,QAAQ,UAAU,KAAK,gBAAgB,OAAO;AAAA,MACpE,EACG,KAAK,IAAI,CAAC,kBAAkB,EAAC,aAAa,IAAO,aAAA,EAAc,CAAC,EAChE;AAAA,QACC,WAAW,CAAC,kBAEV,QAAQ,MAAM,iCAAiC,GAC/C,QAAQ,MAAM,YAAY,GAC1B,QAAQ,MAAM,mBAAmB,KAAK,YAAY,GAClD,QAAQ,MAAM,kBAAkB,KAAK,cAAc,GACnD,QAAQ,SAAA,GAKD,GAF2B,EAAC,MAAM,SAAS,OAAO,aAAA,CAE5C,EACd;AAAA,MAAA;AAGE,aAAA,MAAM,GAAG,EAAC,aAAa,IAAK,GAAG,uBAAuB,EAAE;AAAA,QAC7D,UAAU,CAAC,EAAC,aAAa,cAAc,aAAY,MAC7C,eACK,GAAG,EAAC,MAAM,SAAS,SAAS,kCAAkC,CAAA,IAGnE,cACK,GAAG,WAAW,IAKhB,GAF6B,EAAC,MAAM,WAAW,OAAO,aAEhD,CAAA,CACd;AAAA,MAAA;AAAA,IACH,CACD;AAAA,IAED,UAAU,WAAW;AAAA,IACrB,qBAAqB;AAAA,EAAA;AAEzB;AC5GA,MAAMkP,UAAQ,CACZ,QACA,OACA,QACA,YAEA;AAAA,EAAM,MACJ,OAAO,WAAW,MAAM,OAAO,QAAQ;AAAA,IACrC,KAAK,QAAQ;AAAA,IACb,gBAAgB;AAAA,IAChB,aAAa,QAAQ;AAAA,EAAA,CACtB;AACH,GAEI,SAAS,CACb,QACA,OACA,QACA,YAEA;AAAA,EAAM,MACJ,OAAO,OAAO,OAAO,QAAQ;AAAA,IAC3B,QAAQ,CAAC,WAAW,YAAY,WAAW;AAAA,IAC3C,eAAe;AAAA,IACf,YAAY;AAAA,IACZ,KAAK,QAAQ;AAAA,EAAA,CACd;AACH;AAEF,SAAS,eACP,OACuB;AACvB,SAAO,MAAM,SAAS;AACxB;AAGgB,SAAA,YACd,QACA,OACA,SAA4B,CAC5B,GAAA,UAA8B,IACb;AACX,QAAA,aAAa,OAAO,SAAU,WAAW,QAAQ,MAAM,OACvD,gBAAgB,OAAO,SAAU,WAAW,QAAQ,MAAM,QAE1D,UAAU,OAAO,QAAQ,eAAe,QAAQ,OAAO,EAAE;AAAA,IAC7D,SAAS,CAAC,IAAI,MACI,MAAM,KACP,CAAC,eAAe,EAAE,IAGxB;AAAA,MACL,MACE,IAAI;AAAA,QACF,GAAG,SAAS,cACR,+CACA,4CAA4C,GAAG,IAAI;AAAA,MACzD;AAAA,IAAA,IAGC,GAAG,EAAE,CACb;AAAA,IACDR,QAAM;AAAA,EAGF,GAAA,CAAC,UAAU,qBAAqB,IAAIS,YAAU,SAAS,cAAc,GACrE,kBAAkB,CAAC,UACnB,CAAC,QAAQ,eAAe,MAAM,SAAS,aAClC,KAGF,QAAQ,YAAY,SAAS,MAAM,UAAU,GAGhD,UAAU,MAAMD,QAAM,QAAQ,YAAY,QAAQ,OAAO;AAExD,SAAA;AAAA,IACL,SAAS,KAAK,KAAK,CAAC,CAAC;AAAA,IACrB,sBAAsB;AAAA,MACpB,OAAO,eAAe;AAAA,MACtB,aAAa,QAAQ,gBAAgB,KAAM,gBAAgB,EAAC,SAAS,IAAM,UAAU,GAAA,CAAK;AAAA,IAC5F;AAAA,EAAA,EACA;AAAA,IACA,uBAAuB,CAAC,UAClB,MAAM,SAAS,cAAc,MAAM,eAAe,UAI7C,MAAM,IAAI,EAAE,KAAK,SAAS,OAAO,CAAC,IAEpC,SACR;AAAA,EAAA;AAEL;AC5GO,SAAS,uBACd,QACAvQ,KACA,gBAAgB,KACI;AAEpB,MAAI,iBAAiB,kBAAkB;AACrC,WAAO,GAAG,aAAa;AAGnB,QAAA,QAAQ,2CACR,aAAa,eAAeA,GAAE,GAC9B,UAAU,WAAW,UAAU;AAErC,SAAO,OAAO,WAAW,MAAM,OAAO,EAAC,YAAY,QAAO,CAAC,EAAE,KAAK,IAAI,CAAC,UAAU,MAAM,CAAC,CAAC,CAAC;AAC5F;ACaA,SAAS,uBAAuB,aAA6B;AAC3D,MAAI,UAAU,WAAW;AACjB,UAAA,IAAI,MAAM,uCAAuC;AAGzD,SAAO,EAAC,aAAa,SAAS,WAAW,WAAW,EAAC;AACvD;AA6CO,SAAS,oBAAoB;AAAA,EAClC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAwC;AACtC,QAAM,kCACJ,qBAAqB,0CAKjB,SAAS,UAAU,6BAA6B,GAChD,MAAM,EAAC,QAAQ,WAAW,iCAAiC,cAAc,QAAQ;AAEhF,SAAA;AAAA;AAAA,IAEL,aAAa,QAAQ;AACZ,aAAA,aAAa,QAAQ,MAAM;AAAA,IACpC;AAAA,IACA,aAAa,MAAM,SAAS;AACnB,aAAA;AAAA,QACL;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,IAEJ;AAAA,IACA,YAAY,OAAO,QAAQ,SAAS;AAClC,aAAO,YAAY,QAAQ,OAAO,QAAQ,OAAO;AAAA,IACnD;AAAA,IACA,uBAAuBA,KAAI,eAAe;AACjC,aAAA,uBAAuB,QAAQA,KAAI,aAAa;AAAA,IACzD;AAAA,IACA,MAAM;AAAA,MACJ,kBAAkB,aAAa,MAAM;AACnC,eAAO,kBAAkB,IAAI,QAAQ,uBAAuB,WAAW,GAAG,IAAI;AAAA,MAChF;AAAA,MACA,eAAe,aAAa,MAAM;AAChC,eAAO,eAAe,IAAI,QAAQ,uBAAuB,WAAW,GAAG,IAAI;AAAA,MAC7E;AAAA,MACA,eAAe,aAAa,MAAM;AAChC,eAAO,eAAe,KAAK,uBAAuB,WAAW,GAAG,IAAI;AAAA,MACtE;AAAA,MACA,UAAU,aAAa,MAAM;AAC3B,eAAO,UAAU,KAAK,uBAAuB,WAAW,GAAG,IAAI;AAAA,MACjE;AAAA,MACA,gBAAgB,aAAa,MAAM;AACjC,eAAO,gBAAgB,EAAC,QAAQ,cAAc,OAAA,CAAO,EAAE;AAAA,UACrD;AAAA,YACE,CAAC,WACC,OAAO,KAAK,OAAO,gBAAgB,eAAe,OAAO,KAAK,aAAa;AAAA,UAC/E;AAAA,UACA,IAAI,CAAC,WAA8C;AACjD,kBAAM,EAAC,eAAe,QAAQ,YAAA,IAAe,OAAO;AAC7C,mBAAA,OAAO,SAAS,YACnB,EAAC,MAAM,WAAW,IAAI,eAAe,IAAI,YAAY,YAAA,IACrD,EAAC,MAAM,SAAS,IAAI,eAAe,IAAI,YAAY,aAAa,OAAO,OAAO;UAAK,CACxF;AAAA,QAAA;AAAA,MAEL;AAAA,MACA,WAAW,aAAa,MAAM;AAC5B,eAAO,WAAW,KAAK,uBAAuB,WAAW,GAAG,IAAI;AAAA,MAClE;AAAA,IACF;AAAA,EAAA;AAEJ;ACnJgB,SAAA,kBACd,YACA,OAC8B;AACxB,QAAA,uBAAuB,2BAEvB,kBAAkB;AAAA,IACtB,MACE,aACK,qBAAqB;AAAA,MACpB,EAAC,OAAO,aAAa,MAAM,WAAU;AAAA,MACrC;AAAA,IAAA,IAEF,GAAG,MAAS;AAAA,IAClB,CAAC,YAAY,sBAAsB,KAAK;AAAA,EAAA;AAG1C,SAAO,YAAY,eAAe;AACpC;ACZO,SAAS,gBAAgBQ,QAKV;AACpB,QAAM,EAAC,YAAY,cAAc,cAAc,gBAAgB,kBAAA,IAAqBA,QAC9E,iBAAiB,UAAU,iBAAiB,GAC5C,gBAAgB,iBAAA,GAChB,UAAU,+BAAA,GAEV4B,gBAAmC;AAAA,IACvC,OAAO,EAAC,KAAK,YAAY,OAAO,aAAY;AAAA,IAC5C,CAAC,YAAY,YAAY;AAAA,EAGrB,GAAA,CAAC,OAAO,QAAQ,IAAI,SAA4B;AAAA,IACpD,SAAS;AAAA,IACT,OAAO;AAAA,IACP,OAAOA;AAAA,EAAA,CACR;AAED,SAAA,UAAU,MAAM;AACd,UAAM,sBAAsB,EAAC,YAAY,cAAc,cAAc,eAAc;AAEnF,QAAI,CAAC,cAAc;AACjB,eAAS,EAAC,SAAS,IAAM,OAAO,MAAM,OAAOA,eAAa;AAC1D;AAAA,IACF;AAIM,UAAAiN,OAFmB,cAAc,aAAa,qBAAqB,OAAO,EAEnD,UAAU,CAAC,QAAQ;AAC1C,UAAI,SAAS,aACf,SAAS,EAAC,SAAS,IAAM,OAAO,MAAM,OAAOjN,eAAa,GAGxD,IAAI,SAAS,aACf,SAAS;AAAA,QACP,SAAS;AAAA,QACT,OAAO;AAAA,QACP,OAAO,IAAI,QAAQ,EAAC,GAAGA,eAAc,GAAG,IAAI,MAAA,IAASA;AAAA,MACtD,CAAA,GAGC,IAAI,SAAS,WACf,SAAS,EAAC,SAAS,IAAO,OAAO,IAAI,OAAO,OAAOA,cAAa,CAAA;AAAA,IAAA,CAEnE;AAEQ,WAAA,SAAA,EAAC,SAAS,IAAM,OAAO,MAAM,OAAOA,cAAA,CAAa,GAEnD,MAAMiN,KAAI,YAAY;AAAA,EAAA,GAC5B,CAACjN,eAAc,YAAY,eAAe,cAAc,cAAc,gBAAgB,OAAO,CAAC,GAE1F;AACT;AAKO,SAAS,iCAA8D;AAC5E,QAAM,SAAS,UAAU,GACnB,SAAS,UAAA,GACT,cAAc,eAAA,GACd,YAAY,aACZ,GAAA,UAAU,WAAW,GACrB,YAAY,OAAO;AAEzB,SAAO,QAAQ,OACN;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IAED,CAAC,WAAW,QAAQ,aAAa,WAAW,OAAO,CAAC;AACzD;ACpFO,SAAS,gCASE;AAChB,QAAM,sBAAsB;AAErB,SAAA;AAAA,IACL,CAAC,MAAkB,WACV;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,IAEF,CAAC,mBAAmB;AAAA,EAAA;AAExB;ACZA,SAAS,cAAc,QAAgB,UAA8B;AAC7D,QAAA,OAAO,OAAO,IAAI,QAAQ;AAEhC,MAAI,CAAC;AACH,UAAM,IAAI,MAAM,wBAAwB,QAAQ,EAAE;AAG7C,SAAA;AACT;AAUA,SAAS,mBAAmB;AAAA,EAC1B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAsF;AAQ9E,QAAA,mBAAmB,SAAS,WAC5B,uBAAuB,qBAAqB,QAAQ,UAAU,aAE9D,EAAC,wBAAA,IAA2B;AAElC,UAAQ,YAAY;AAAA,IAClB,KAAK;AACH,aAAI,WACK;AAAA,QACL,CAAC,yCAAyC,wBAAwB,UAAU,SAAS,CAAC;AAAA,MAAA,IAInF;AAAA,QACL,CAAC,yBAAyB,wBAAwB,UAAU,KAAK,CAAC;AAAA,QAClE,CAAC,6BAA6B,wBAAwB,UAAU,SAAS,CAAC;AAAA,MAAA;AAAA,IAI9E,KAAK;AACC,aAAA,WAAiB,CAAC,IAEf,CAAC,CAAC,yBAAyB,wBAAwB,UAAU,KAAK,CAAC,CAAC;AAAA,IAG7E,KAAK;AACC,aAAA,WAAiB,CAAA,IAEd;AAAA;AAAA,QAEL;AAAA,UACE;AAAA,UACA,wBAAwB,UAAU,SAAS;AAAA,QAC7C;AAAA;AAAA,QAGA,CAAC,yBAAyB,wBAAwB,UAAU,KAAK,CAAC;AAAA,QAClE;AAAA,UACE;AAAA,UACA,wBAAwB,UAAU,SAAS,EAAC,GAAG,OAAO,KAAK,eAAe,MAAM,GAAG,GAAE;AAAA,QACvF;AAAA,MAAA;AAAA,IAIJ,KAAK;AACC,aAAA,WAAiB,CAAA,IAEd;AAAA;AAAA,QAEL,CAAC,8CAA8C,wBAAwB,UAAU,KAAK,CAAC;AAAA;AAAA,QAGvF,CAAC,6BAA6B,wBAAwB,UAAU,SAAS,CAAC;AAAA,QAC1E;AAAA,UACE;AAAA,UACA;AAAA,YACE;AAAA,YACA,aAAa,EAAC,GAAG,WAAW,KAAK,WAAW,UAAU,GAAG,EAAC;AAAA,UAC5D;AAAA,QACF;AAAA,MAAA;AAAA,IAIJ,KAAK;AACH,aAAI,WACK;AAAA,QACL,CAAC,yCAAyC,wBAAwB,UAAU,SAAS,CAAC;AAAA,MAAA,IAInF;AAAA,QACL;AAAA,UACE,UAAU,oBAAoB;AAAA,UAC9B,wBAAwB,UAAU,gBAAgB;AAAA,QACpD;AAAA,MAAA;AAAA,IAIJ,KAAK;AACH,aAAI,WACK;AAAA,QACL;AAAA,UACE;AAAA,UACA,wBAAwB,UAAU,EAAC,GAAG,WAAW,KAAK,YAAW;AAAA,QACnE;AAAA,MAAA,IAIG;AAAA,QACL;AAAA,UACE,2CAA2C,oBAAoB;AAAA,UAC/D,wBAAwB,UAAU,EAAC,GAAG,kBAAkB,KAAK,WAAW,UAAU,GAAE;AAAA,QACtF;AAAA,MAAA;AAAA,IAIJ;AACE,YAAM,IAAI,MAAM,+BAA+B,UAAU,EAAE;AAAA,EAE/D;AACF;AA4BO,SAAS,2BAA2B;AAAA,EACzC;AAAA,EACA;AAAA,EACA;AAAA,EACA,IAAApC;AAAA,EACA;AAAA,EACA;AACF,GAAsE;AAMpE,MAAI,SAAS;AACX,WAAO,GAAG,EAAC,SAAS,IAAO,QAAQ,0BAAyB;AAG9D,QAAM,WAAW,CAAA,CAAQ,cAAc,QAAQ,IAAI,EAAE;AAE9C,SAAA;AAAA,IACL;AAAA,IACA,EAAC,SAAS,WAAWA,GAAE,GAAG,aAAa,eAAeA,GAAE,EAAC;AAAA,IACzD;AAAA,EAAA,EACA;AAAA,IACA;AAAA,MAAU,CAAC,SACT,cAAc,CAAC,KAAK,MAAM,YAAY,KAAK,UAAU,UAAU,CAAC,EAAE;AAAA,QAChE,IAAI,CAAC,CAAC,OAAO,SAAS,OAAO,EAAC,OAAO,UAAA,EAAW;AAAA,MAClD;AAAA,IACF;AAAA,IACA,UAAU,CAAC,EAAC,OAAO,gBAAe;AAChC,YAAM,kBAAkB,mBAAmB;AAAA,QACzC;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACD,CAAA,EAAE;AAAA,QAAI,CAAC,CAAC,OAAO,UAAU,MACxB,WAAW;AAAA,UACT,IAAI,CAAC,EAAC,SAAS,cAAkB;AAAA,YAC/B;AAAA,YACA,QAAQ,UAAU,KAAK,kBAAkB,KAAK,KAAK,MAAM;AAAA,YACzD;AAAA,YACA;AAAA,UAAA,EACA;AAAA,QACJ;AAAA,MAAA;AAGF,aAAK,gBAAgB,SAEd,cAAc,eAAe,EAAE;AAAA,QACpC,IAAI,CAAC,sBAA6B;AAChC,gBAAM,UAAU,kBAAkB,MAAM,CAAC,qBAAqB,iBAAiB,OAAO,GAChF,SAAS,UACX,KACA,aAAa,UAAU;AAAA,GAAQ,kBAC5B,OAAO,CAAC,qBAAqB,CAAC,iBAAiB,OAAO,EACtD,IAAI,CAAC,qBAAqB,iBAAiB,MAAM,EACjD,KAAK;AAAA,EAAM,CAAC;AAEZ,iBAAA,EAAC,SAAS;QAAM,CACxB;AAAA,MAAA,IAbiC,GAAG,EAAC,SAAS,IAAM,QAAQ,IAAG;AAAA,IAAA,CAenE;AAAA,EAAA;AAEL;AA0BO,MAAM,4CAA4C;AAAA,EACvD;AACF;AAGO,SAAS,2BAA2B;AAAA,EACzC,IAAAA;AAAA,EACA;AAAA,EACA;AAAA,EACA,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,aAAa;AACf,GAEE;AACA,QAAM,gBAAgB,UAAU,6BAA6B,GACvD,gBAAgB,UAAA,GAChB,qBAAqB,eAAe,GAEpC,SAAS,QAAQ,MAAM,kBAAkB,eAAe,CAAC,eAAe,cAAc,CAAC,GACvF,SAAS,QAAQ,MAAM,kBAAkB,eAAe,CAAC,eAAe,cAAc,CAAC,GACvF,cAAc;AAAA,IAClB,MAAM,uBAAuB;AAAA,IAC7B,CAAC,oBAAoB,mBAAmB;AAAA,EAAA;AAGnC,SAAA;AAAA,IACL;AAAA,MACE,OAAO,EAAC,QAAQ,QAAQ,aAAa,IAAAA,KAAI,YAAY;MACrD,CAAC,QAAQ,aAAaA,KAAI,YAAY,QAAQ,IAAI;AAAA,IACpD;AAAA,EAAA;AAEJ;ACxRO,SAAS,4BAA4B;AAAA,EAC1C;AAAA,EACA,UAAAa;AAAA,EACA;AACF,GAAuE;AAC/D,QAAA,EAAC,wBAA2B,IAAA;AAE3B,SAAA,wBAAwB,YAAYA,SAAQ;AACrD;AAuBO,MAAM,6CAA6C;AAAA,EACxD;AACF;AAGO,SAAS,4BAA4B;AAAA,EAC1C,UAAAA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAEE;AACA,QAAM,cAAc;AAEpB,SAAO,2CAA2C;AAAA,IAChD,aAAa,KAAK,eAAe;AAAA,IACjC,UAAAA;AAAA,IACA;AAAA,EAAA,CACD;AACH;ACnEA,MAAM,eAAe,WAEf,cAAc,OAAO,SAAW,MAAc,GAAG,CAAA,CAAE,IAAI,UAAU,QAAQ,YAAY,GAE9E,eAAe,OAAO,GAAG,CAAC,GAAG,WAAW,EAAE;AAAA,EACrD,IAAI,MAAO,OAAO,WAAa,MAAc,MAAM,SAAS,SAAS,IAAK;AAAA,EAC1E,qBAAqB;AAAA,EACrB;AAAA,IAAI,CAAC+B,UACHA,MACG,UAAU,CAAC,EACX,MAAM,GAAG,EACT,OAAO,CAAC,MAAM,EAAE,YAAc,EAAA,WAAW,YAAY,CAAC,EACtD,IAAI,CAAC,UAAU,MAAM,UAAU,aAAa,MAAM,CAAC;AAAA,EACxD;AACF,GAEa,mBAAmB,aAAa;AAAA,EAC3C,IAAI,CAAC,SAAS,KAAK,KAAK,CAAC,QAAQ,IAAI,WAAW,QAAQ,CAAC,CAAC;AAAA,EAC1D;AAAA,IACE,CAAC,SACC,OACI,OAAA,SAAA,IAAA,MAAM,UAAU,CACjB,EAAA,MAAM,GACN,EAAA,IAAI,CAAC,MAAM,EAAE,YAAW,CAAC;AAAA,EAChC;AACF,GCxBa,gBAAyB;AAAA,EACpC;AAAA,IACE,QAAQ;AAAA,IACR,aAAa,CAAC,QAAQ,UAAU,WAAW,QAAQ;AAAA,EACrD;AACF,GAEa,SAAkB;AAAA,EAC7B;AAAA,IACE,QAAQ;AAAA,IACR,aAAa,CAAC,QAAQ,UAAU,WAAW,QAAQ;AAAA,EACrD;AACF,GAEa,YAAqB;AAAA,EAChC;AAAA,IACE,QAAQ;AAAA,IACR,aAAa,CAAC,QAAQ,UAAU,WAAW,QAAQ;AAAA,EACrD;AACF,GAEa,cAAuB;AAAA,EAClC;AAAA,IACE,QAAQ;AAAA,IACR,aAAa,CAAC,MAAM;AAAA,EACtB;AAAA,EACA;AAAA,IACE,QAAQ;AAAA,IACR,aAAa,CAAC,UAAU,WAAW,QAAQ;AAAA,EAC7C;AACF,GAEa,SAAkB;AAAA,EAC7B;AAAA,IACE,QAAQ;AAAA,IACR,aAAa,CAAC,QAAQ,SAAS;AAAA,EACjC;AACF,GAEa,mBAA4B;AAAA,EACvC;AAAA,IACE,QAAQ;AAAA,IACR,aAAa,CAAC,QAAQ,UAAU,QAAQ;AAAA,EAC1C;AACF,GAEa,aAAsB;AAAA,EACjC;AAAA,IACE,QACE;AAAA,IACF,aAAa,CAAC,QAAQ,UAAU,WAAW,QAAQ;AAAA,EACrD;AAAA,EACA;AAAA,IACE,QAAQ;AAAA,IACR,aAAa,CAAC,MAAM;AAAA,EACtB;AACF,GCrDM,wBAA0D;AAAA;AAAA,EAE9D;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAAA,EAGA;AAAA,EACA;AAAA;AAAA,EAGA,MAAM6N;AAAAA,EACN,OAAOC;AACT,GAGa,eAAe,iBAAiB;AAAA,EAC3C,IAAI,CAAC,UACE,MAAM,SAEJ,MACJ,OAAO,CAAC,UAAU,CAAQ,CAAA,SAAU,SAAS,qBAAqB,EAClE,QAAQ,CAAC,aAA8B,sBAAsB,QAAQ,KAAK,EAAE,IAJrD,IAK3B;AACH;AChBA,eAAe,iBACb,QACA,WACA,SACkB;AAEM,SAAA,MAAM,OAAO,QAAQ;AAAA,IAC3C,KAAK,aAAa,SAAS,aAAa,OAAO;AAAA,IAC/C,KAAK;AAAA,IACL,iBAAiB;AAAA,EAAA,CAClB;AAGH;AAEA,SAAS,UAAU,QAAyC;AAC1D,QAAM,SAA2B,CAAA;AAEjC,SAAI,WAAW,SACb,OAAO,WAAW,SAGb;AACT;AAEA,MAAM,0CAA0B;AAChC,eAAe,cAAc,QAAuB7H,SAAgBhI,WAA0B;AACvF,sBAAoB,IAAIgI,OAAM,KAMjC,oBAAoB,IAAIA,SAAQ8H,QAAM,KAAK9H,OAAM,GAAG,CAAC;AAEvD,QAAM,SAAS,oBAAoB,IAAIA,OAAM,GAEvC,aAAa,UAAU,MAAM,GAC7B,EAAC,UAAA+H,UAAY,IAAA,YACb,SAAkC,EAAC,GAAG,WAAU,GAChD,OAAO,OAAO,MAAM,SAAS,QAAQ,EAAC,SAAS,CAAC/P,SAAQ,GAAG,UAAA+P,WAAU,OAAM,CAAC,GAAG,IAAI;AACzF,UAAO,6BAAM,YAAW;AAC1B;AAkBO,SAAS,kBAAkB,MAAuC;AA7EzE,MAAAzP;AA8EE,QAAM,EAAC,OAAA,IAAU,MACX,kBAAkB,OAAO,WAAW,EAAC,YAAY,aAAA,CAAa,GAC9D,SAAS,YAAY,OAAO,KAAK,WAASA,MAAM,QAAA,OAAA,SAAA,KAAA,gBAAN,OAAmB,SAAAA,IAAA,OAAM,MAEnE,iBAAiB,MAAM,MAAM,GAAG,gBAAgB,OAAO,CAAC,CAAC,EAAE;AAAA,IAC/D,UAAU,CAAC,EAAC,WAAW,cAAa;AAC9B,UAAA,CAAC,aAAa,CAAC;AACX,cAAA,IAAI,MAAM,8BAA8B;AAEzC,aAAA,iBAAiB,iBAAiB,WAAW,OAAO;AAAA,IAAA,CAC5D;AAAA,EAAA,GAGG,2BAA2B,aAAa;AAAA,IAC5C,UAAU,CAAC,gBAAiB,cAAc,GAAG,WAAW,IAAI,cAAe;AAAA,IAC3E,cAAc,CAAC;AAAA,IACf,cAAc,GAAI;AAAA,EAAA;AAGb,SAAA;AAAA,IACL,wBAAwB,YAAqCN,WAA0B;AACrF,aAAO,yBAAyB;AAAA,QAC9B,UAAU,CAAC,WAAW,mBAAmB,QAAQ,QAAQ,YAAYA,SAAQ,CAAC;AAAA,QAC9E,qBAAqB,aAAa;AAAA,MAAA;AAAA,IAEtC;AAAA,EAAA;AAEJ;AAOA,eAAsB,mBACpB,QACA,QACA,YACAA,WACgC;AAChC,MAAI,CAACA;AAEH,WAAO,EAAC,SAAS,IAAM,QAAQ,kCAAiC;AAGlE,MAAI,CAAC,OAAO;AACV,WAAO,EAAC,SAAS,IAAO,QAAQ,qBAAoB;AAGtD,QAAM,iBAA0B,CAAA;AAEhC,aAAW,SAAS;AACd,UAAM,cAAc,QAAQ,MAAM,QAAQA,SAAQ,KACpD,eAAe,KAAK,KAAK;AAI7B,QAAM,aAAa,eAAe,KAAK,CAAC,UAAU,MAAM,YAAY,KAAK,CAAC,MAAM,MAAM,UAAU,CAAC;AAE1F,SAAA;AAAA,IACL,SAAS;AAAA,IACT,QAAQ,aAAa,mBAAmB;AAAA,EAAA;AAE5C;AC/GA,SAAS,UAAa,MAA8B;AAC9C,SAAA,OAAO,QAAS,YAAY,SAAS,QAAQ,eAAe,OACvD,UAAU,KAAK,UAAW,CAAA,IAG5B;AACT;AAgBO,SAAS,uBAAuB;AAAA,EACrC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAEE;AACA,SAAK,uCAAe,SAEb;AAAA,IACL,cACG,IAAI,SAAS,EACb,IAAI,OAAO,SAAS;AACb,YAAA,WAAW,UAAU,KAAK,CAACQ,OAAMA,GAAE,OAAO,KAAK,UAAU;AAE/D,UAAI,CAAC;AACH,cAAM,IAAI,MAAM,wBAAwB,KAAK,UAAU,GAAG;AAG5D,YAAM,uBAAuB,MAAM;AAAA,QACjC;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL;AAAA,MAAA;AAGK,aAAA,EAAC,UAAU,MAAM;IACzB,CAAA,EACA;AAAA,MAAI,CAAC,YACJ,KAAK,OAAO,EAAE;AAAA,QACZ,UAAU,CAAC,EAAC,MAAM,sBAAsB,eAAc;AACpD,gBAAM,aAAa,OAAO,IAAI,SAAS,UAAU;AAEjD,cAAI,CAAC;AACH,kBAAM,IAAI,MAAM,2BAA2B,SAAS,UAAU,GAAG;AAGnE,gBAAM,WAAW,cAAY,OAAA,SAAA,WAAA,UACvB,EAAC,oBAAoB,eAAc;AAEzC,iBAAO,4BAA4B;AAAA,YACjC;AAAA,YACA,YAAY;AAAA,YACZ,UAAU;AAAA,cACR,KAAK,WAAW,eAAe,iBAAiB,IAAI,WAAW,iBAAiB;AAAA,cAChF,GAAG;AAAA,YACL;AAAA,UACD,CAAA,EAAE;AAAA,YACD,IAAI,CAAC,EAAC,SAAS,aAAY;AACnB,oBAAA,QAAQ,KAAK,SAAS,SAAS;AACK,qBAAA;AAAA,gBACxC,GAAG;AAAA,gBACH,MAAM,KAAK,QAAQ,SAAS;AAAA,gBAC5B;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA,UAAU,WAAW,UAAU,QAAQ,SAAY,WAAW;AAAA,gBAC9D,aAAa,KAAK,eAAe,SAAS;AAAA,gBAC1C,MAAM,KAAK,QAAQ,SAAS;AAAA,cAAA;AAAA,YAC9B,CAGD;AAAA,UAAA;AAAA,QACH,CACD;AAAA,MACH;AAAA,IACF;AAAA,EAAA,IA7D+B,GAAG,CAAA,CAAE;AA+D1C;AAmBa,MAAA,wCACX,gCAAgC,sBAAsB;AAGjD,SAAS,uBAAuB;AAAA,EACrC;AAAA,EACA,GAAG;AACL,GAEE;AACM,QAAA,SAAS,aACT,YAAY,aAAA,GACZ,cAAc,eACd,GAAA,sBAAsB;AAE5B,SAAO,sCAAsC;AAAA,IAC3C;AAAA,IACA,aAAa,KAAK,eAAe;AAAA,IACjC,QAAQ,KAAK,UAAU;AAAA,IACvB,WAAW,KAAK,aAAa;AAAA,IAC7B,SAAS;AAAA,EAAA,CACV;AACH;AC/JA,SAAS,aAAa,MAAiB;AAC9B,SAAA,SAAS,YAAY,SAAS;AACvC;AAEA,MAAM,eAAe,IAAI,KAAK;AAE9B,SAAS,oBAAoB,GAAW,GAAW;AACjD,SAAO,KAAK,MAAM,CAAC,IAAI,KAAK,MAAM,CAAC,IAAI;AACzC;AAEgB,SAAA,WAAW,MAAa,OAAsC;AACxE,MAAA,KAAK,QAAQ,MAAM;AAAa,UAAA,IAAI,MAAM,mCAAmC;AAIjF,QAAM,aAAa,aAAa,KAAK,YAAY,MAAM,UAAU,GAC3D,iBAAiB,aAAa,KAAK,gBAAgB,MAAM,cAAc;AAE7E,MAAI,KAAK,SAAS,YAAY,MAAM,SAAS;AACpC,WAAA,CAAC,MAAM,EAAC,GAAG,OAAO,MAAM,UAAU,YAAY,eAAA,CAAe;AAIlE,MAAA,MAAM,SAAS,UAAU;AACvB,QAAA,eAAe,aAAa,mBAAmB;AAC1C,aAAA,CAAC,MAAM,EAAC,GAAG,OAAO,MAAM,gBAAgB,YAAY,eAAA,CAAe;AAGxE,QAAA,eAAe,aAAa,mBAAmB;AAC1C,aAAA,CAAC,MAAM,EAAC,GAAG,OAAO,MAAM,aAAa,YAAY,eAAA,CAAe;AAAA,EAE3E;AAEA,MACE,aAAa,KAAK,IAAI,KACtB,MAAM,SAAS,eACf,oBAAoB,KAAK,cAAc,MAAM,cAAc,GAC3D;AACM,UAAA,8BAAc;AACpB,eAAW,UAAU,KAAK;AAAS,cAAQ,IAAI,MAAM;AACrD,eAAW,UAAU,MAAM;AAAS,cAAQ,IAAI,MAAM;AAE/C,WAAA;AAAA,MACL,OAAO;AAAA,MACP,IAAI,MAAM;AAAA,MACV,MAAM,KAAK;AAAA,MACX,OAAO,KAAK;AAAA,MACZ,KAAK,MAAM;AAAA,MACX,gBAAgB,KAAK;AAAA,MACrB,cAAc,MAAM;AAAA,MACpB;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,EAEJ;AAEA,SAAO,CAAC,MAAM,EAAC,GAAG,OAAO,YAAY,gBAAe;AACtD;AAGA,SAAS,cAAc,QAAwC;AAC7D,QAAM,WAAW,CAAQ,CAAA;AAGzB,SAFgB,UAAU,cAAc,UAAA,OAAA,SAAA,OAAQ,KAAK,IAG5C,YAGL,WACK,WAGF;AACT;AAYA,SAAS,aAAa,aAAqC;AACnD,QAAA,aAAa,cAAc,YAAY,WAAW,GAClD,iBAAiB,cAAc,YAAY,eAAe;AAEhE,MAAI,mBAAmB,YAAY;AACjC,QAAI,eAAe;AACV,aAAA;AAGT,QAAI,eAAe;AACV,aAAA;AAAA,EAEX;AAEA,MAAI,mBAAmB;AACd,WAAA;AAGT,MAAI,mBAAmB,UAAU;AAC/B,QAAI,eAAe;AACV,aAAA;AAGT,QAAI,eAAe;AACV,aAAA;AAGT,QAAI,eAAe;AACV,aAAA;AAAA,EAEX;AAEO,SAAA;AACT;AAEO,SAAS,qBAAqB,aAAiC;AAC9D,QAAA,gBAAgB,CAAQ,CAAA,YAAY,aACpC,oBAAoB,CAAQ,CAAA,YAAY,iBAExC,eAAe,YAAY,eAAe,cAAc,YAAY,YAAY,KAAK,GACrF,mBACJ,YAAY,mBAAmB,cAAc,YAAY,gBAAgB,KAAK,GAE1E,OAAO,aAAa,WAAW;AAE9B,SAAA;AAAA,IACL,OAAO;AAAA,IACP,IAAI,YAAY;AAAA,IAChB;AAAA,IACA,OAAO,YAAY;AAAA,IACnB,KAAK,YAAY,QAAQ;AAAA,IACzB,gBAAgB,YAAY;AAAA,IAC5B,cAAc,YAAY;AAAA,IAC1B,SAAa,oBAAA,IAAI,CAAC,YAAY,MAAM,CAAC;AAAA,IACrC,YAAY,gBAAiB,eAAe,YAAY,YAAa;AAAA,IACrE,gBAAgB,oBAAqB,mBAAmB,YAAY,YAAa;AAAA,EAAA;AAErF;AAEA,SAAS,aACP,MACA,OACA;AACO,SAAA,UAAU,YAAY,OAAO;AACtC;AAEO,SAAS,cAAc6D,QAA8B;AAC1D,SAAOA,OAAM,CAAC,MAAM,KAAKA,OAAM,CAAC,MAAM;AACxC;AC5JgB,SAAA,iBAAiB,GAAe,GAAwB;AACtE,SAAI,KAAK,IACA,EAAE,WAAW,EAAE,UAAU,EAAE,UAAU,EAAE,QAG5C,CAAC,KAAK,CAAC;AAKb;AAEO,SAAS2L,WAAS,KAAuD;AACvE,SAAA,IAAI,SAAS,IAAI;AAC1B;ACKA,MAAM,oBAAsD;AAAA,EAU1D,YACE,SACA,OACA,YACA,WACA;AAdK,SAAA,OAAA,SAOP,KAAQ,WAAgC,IAQtC,KAAK,UAAU,SACf,KAAK,QAAQ,OACb,KAAK,aAAa,YAClB,KAAK,YAAY,WACjB,KAAK,SAAS,QAAQ,SAAS;AAAA,EACjC;AAAA,EAEA,GAAG,KAAa;AACd,QAAI,OAAO,KAAK;AAAc,YAAA,IAAI,MAAM,eAAe;AAEvD,WADc,KAAK,SAAS,GAAG,MAIvB,KAAK,SAAS,GAAG,IAAI;AAAA,MAC3B,KAAK,QAAQ,SAAS,GAAG;AAAA,MACzB,KAAK,MAAM,GAAG;AAAA,MACd,KAAK;AAAA,IAAA;AAAA,EAET;AAAA,EAEA,aAAa,KAAyB;AACpC,UAAM,OAAO,KAAK,QAAQ,MAAM,GAAG;AAC5B,WAAA,KAAK,UAAU,SAAS,IAAI;AAAA,EACrC;AACF;AAEA,MAAM,qBAAwD;AAAA,EAU5D,YACE,SACA,OACA,YACA,WACA;AAdK,SAAA,OAAA,UAOP,KAAQ,SAA4C,IAQlD,KAAK,UAAU,SACf,KAAK,QAAQ,OACb,KAAK,aAAa,YAClB,KAAK,YAAY,WACjB,KAAK,OAAO,OAAO,KAAK,QAAQ,MAAM;AAAA,EACxC;AAAA,EAEA,IAAI,KAAa;AACT,UAAA,QAAQ,KAAK,OAAO,GAAG;AACzB,QAAA;AACK,aAAA;AAET,UAAM,QAAQ,KAAK,QAAQ,OAAO,GAAG;AAChC,QAAA;AACG,aAAA,KAAK,OAAO,GAAG,IAAI,UAAU,OAAO,KAAK,MAAM,GAAG,GAAG,KAAK,SAAS;AAAA,EAC7E;AACF;AAEA,MAAM,qBAAwD;AAAA,EAQ5D,YACE,SACA,OACA,YACA,WACA;AAZK,SAAA,OAAA,UAaA,KAAA,UAAU,SACf,KAAK,QAAQ,OACb,KAAK,aAAa,YAClB,KAAK,YAAY;AAAA,EACnB;AAAA,EAEA,gBAAgB,OAAe,KAAuD;AACpF,UAAM,SAAmD,CAAA;AACzD,QAAI,MAAM;AAED,aAAA,KAAK,MAAc,YAAwB;AAC9C,UAAA,OAAO,SAAS,GAAG;AACrB,cAAM,MAAM,OAAO,OAAO,SAAS,CAAC;AACpC,YAAI,iBAAiB,IAAI,YAAY,UAAU,GAAG;AAChD,cAAI,QAAQ;AACZ;AAAA,QACF;AAAA,MACF;AAEA,aAAO,KAAK,EAAC,MAAM,WAAW,CAAA;AAAA,IAChC;AAEW,eAAA,QAAQ,KAAK,QAAQ,OAAO;AAC/B,YAAA,SAAS,KAAK,MAAM,QAEpB,WAAW,KAAK,IAAI,GAAG,QAAQ,GAAG;AACxC,UAAI,WAAW,QAAQ;AAIrB,cAAM,SAAS,KAAK,IAAI,QAAQ,MAAM,GAAG;AAIzC,YAAI,UAAU;AAAG;AAEZ,aAAA,KAAK,MAAM,MAAM,UAAU,MAAM,GAAG,KAAK,UAAU,UAAU,IAAI,CAAC;AAAA,MACzE;AAEO,aAAA;AAAA,IACT;AAEO,WAAA;AAAA,EACT;AACF;AAEA,SAAS,UACP,OACA,KACA,WACmB;AACb,QAAA,aAAa,UAAU,UAAU,KAAK;AAE5C,MAAI,MAAM;AACA,YAAA,MAAM,QAAQ,MAAM;AAAA,MAC1B,KAAK;AACH,eAAO,IAAI,oBAAoB,MAAM,SAAS,KAAkB,YAAY,SAAS;AAAA,MACvF,KAAK;AACH,eAAO,IAAI;AAAA,UACT,MAAM;AAAA,UACN;AAAA,UACA;AAAA,UACA;AAAA,QAAA;AAAA,MAEJ,KAAK;AACH,eAAO,IAAI,qBAAqB,MAAM,SAAS,KAAe,YAAY,SAAS;AAAA,IAGvF;AAGK,SAAAC,OAAK,KAAK,UAAU;AAC7B;AAEA,SAAS,8BACP,UACA,YACA,MACY;AACZ,SAAI,OAEK,8BAA8B,UAAU,KAAK,mBAAmB,GAAG,KAAK,MAAM,KAAK,IACjF,aACF,8BAA8B,UAAU,WAAW,OAAO,WAAW,KAAK,IAG5E;AACT;AAEA,SAAS,4BAA4B,UAAoB,MAAwB;AAC3E,SAAA,OACK,8BAA8B,UAAU,KAAK,kBAAkB,KAAK,MAAM,KAAK,IAGjF;AACT;AAEA,SAAS,8BAA8B,UAAoB,KAAa,UAAmB;AACnF,QAAA,KAAK,SAAS,mBAAmB,GAAG;AAC1C,MAAI,CAAC;AAAW,WAAA;AAEhB,QAAM,QAAQ,SAAS,wBAAwB,KAAK,QAAQ;AAC5D,SAAK,QAEE;AAAA,IACL;AAAA,IACA,WAAW,GAAG;AAAA,IACd,QAAQ,GAAG;AAAA,EALM,IAAA;AAOrB;AAGO,SAAS,UACd,UACA,YACArP,OACA,SACA,IACA,OACkB;AACZ,QAAA,YAAY,UAAUA,OAAM,SAAS;AAAA,IACzC,UAAU,OAAO;AACf,aAAO,8BAA8B,UAAU,YAAY,MAAM,OAAO;AAAA,IAC1E;AAAA,IACA,SAAS,MAAM;AACN,aAAA,8BAA8B,UAAU,YAAY,IAAI;AAAA,IACjE;AAAA,EACD,CAAA,GAEK,UAAU,UAAU,IAAI,OAAO;AAAA,IACnC,UAAU,OAAO;AACR,aAAA,4BAA4B,UAAU,MAAM,SAAS;AAAA,IAC9D;AAAA,IACA,SAAS,MAAM;AACN,aAAA,4BAA4B,UAAU,IAAI;AAAA,IACnD;AAAA,EAAA,CACD;AACM,SAAA,UAAU,WAAW,OAAO;AACrC;ACpPO,MAAM,cAAyC;AAAA,EAA/C,cAAA;AACL,SAAQ,WAAgB,IACxB,KAAQ,YAAiB;EAAC;AAAA,EAE1B,SAAS,MAAe;AACtB,SAAK,QAAQ,KAAK,SAAS,QAC3B,KAAK,SAAS,KAAK,IAAI;AAAA,EACzB;AAAA,EAEA,eAAe,MAAe;AAExB,QAAA,KAAK,UAAU,GAAG;AACpB,WAAK,SAAS,IAAI;AAClB;AAAA,IACF;AAEK,SAAA,QAAQ,EAAE,KAAK,UAAU,SAAS,IACvC,KAAK,UAAU,KAAK,IAAI;AAAA,EAC1B;AAAA,EAEA,WAAW,OAAU,QAAyB;AACxC,QAAA,KAAK,WAAW,GAAG;AACrB,WAAK,SAAS,KAAK;AACnB;AAAA,IACF;AAEM,UAAA,MAAM,KAAK,SACX,SAAS,OAAO,KAAK,IAAI,GAAG,GAAG,KAAK;AACtC,UAAM,QAAQ,MAAM,KACtB,KAAK,IAAI,KAAK,OAAO,CAAC,CAAC,GACvB,KAAK,SAAS,OAAO,CAAC,CAAC,KAEvB,KAAK,IAAI,KAAK,MAAM;AAAA,EAExB;AAAA,EAEA,iBAAiB,OAAU,QAAyB;AAC9C,QAAA,KAAK,WAAW,GAAG;AACrB,WAAK,SAAS,KAAK;AACnB;AAAA,IACF;AAEM,UAAA,MAAM,KAAK,UACX,SAAS,OAAO,OAAO,KAAK,IAAI,GAAG,CAAC;AACtC,UAAM,QAAQ,MAAM,KACtB,KAAK,IAAI,KAAK,OAAO,CAAC,CAAC,GACvB,KAAK,eAAe,OAAO,CAAC,CAAC,KAE7B,KAAK,IAAI,KAAK,MAAM;AAAA,EAExB;AAAA,EAEA,gBAAsB;AAChB,SAAK,SAAS,WAAW,IAC3B,KAAK,UAAU,UAEf,KAAK,SAAS,IAAI;AAAA,EAEtB;AAAA,EAEA,IAAI,KAAsB;AACpB,WAAA,OAAO,IACF,MAAM,KAAK,SAAS,SAGtB,EAAE,MAAM,KAAK,KAAK,UAAU;AAAA,EACrC;AAAA,EAEA,IAAI,KAAgB;AACd,WAAA,OAAO,IACF,KAAK,SAAS,GAAG,IAGnB,KAAK,UAAU,EAAE,MAAM,EAAE;AAAA,EAClC;AAAA,EAEA,IAAI,KAAa,OAAgB;AAC3B,WAAO,KACT,MAAM,QAAQ,KACd,KAAK,SAAS,GAAG,IAAI,UAErB,MAAM,QAAQ,KACd,KAAK,UAAU,EAAE,MAAM,EAAE,IAAI;AAAA,EAEjC;AAAA,EAEA,IAAI,UAAkB;AAEb,WAAA,KAAK,SAAS,SAAS;AAAA,EAChC;AAAA,EAEA,IAAI,OAAU;AACL,WAAA,KAAK,IAAI,KAAK,OAAO;AAAA,EAC9B;AAAA,EAEA,IAAI,WAAmB;AAEd,WAAA,CAAC,KAAK,UAAU;AAAA,EACzB;AAAA,EAEA,IAAI,QAAW;AACN,WAAA,KAAK,IAAI,KAAK,QAAQ;AAAA,EAC/B;AAAA,EAEA,IAAI,SAAiB;AACnB,WAAO,KAAK,SAAS,SAAS,KAAK,UAAU;AAAA,EAC/C;AACF;ACxEO,MAAM,SAAS;AAAA,EAmBpB,YAAY,MAAuB;AAlBZ,SAAA,uBAAA,IAIf,KAAA,gBAAgB,IAAI,iBACpB,KAAA,UAAU,IAAI,iBAGd,KAAA,mDAAmC,OAWzC,KAAK,cAAc,KAAK,aACxB,KAAK,UAAU,UAAU,KAAK,WAAW,IAErC,KAAK,gBACP,KAAK,SAAS,CAAA,GACd,KAAK,OAAO,KAAK;AAAA,MACf,MAAM;AAAA,MACN,aAAa,KAAK;AAAA,IACnB,CAAA,GACC,OAAe,wBAAwB,KAAK;AAAA,EAElD;AAAA,EAEA,IAAI,aAAqB;AACvB,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA;AAAA,EAGA,UAAa,QAA+C;AACpD,UAAA,SAAc,CAAA,GAEd,WAAW,KAAK,QAAQ,UACxB,UAAU,KAAK,QAAQ;AAEpB,aAAA,MAAM,SAAS,OAAO,UAAU;AAChC,aAAA,KAAK,OAAO,KAAK,QAAQ,IAAI,GAAG,GAAG,GAAG,CAAC;AAGzC,WAAA;AAAA,EACT;AAAA,EAEA,QAAc;AACZ,SAAK,gBAAgB,IAAI,iBACzB,KAAK,UAAU,IAAI,cAAc,GACjC,KAAK,mDAAmC,IAAI,GAC5C,KAAK,4BAA4B,QACjC,KAAK,uBAAuB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,kBAAkB,OAAiD;AAC7D,SAAK,UAAQ,KAAK,OAAO,KAAK,EAAC,MAAM,qBAAqB,OAAO,MAAA,CAAM;AAErE,UAAA,UAAU,KAAK,6BAA6B,IAAI,MAAM,aAAa,GAEnE,cAA2B,UAC7B,QAAQ,cACR;AAAA,MACE,OAAO;AAAA,MACP,IAAI,MAAM;AAAA,MACV,WAAW,MAAM,UAAU,YAAY;AAAA,MACvC,QAAQ,MAAM;AAAA,IAAA;AAGhB,UAAM,YAAY,UACpB,YAAY,cAAc,MAAM,UAEhC,YAAY,kBAAkB,MAAM,SAGlC,WACF,KAAK,6BAA6B,OAAO,MAAM,aAAa,GAC5D,KAAK,2BAA2B,QAAQ,GAAG,MAE3C,KAAK,cAAc,SAAS,WAAW,GACvC,KAAK,6BAA6B,IAAI,MAAM,eAAe;AAAA,MACzD;AAAA,MACA,KAAK,KAAK,cAAc;AAAA,IACzB,CAAA;AAAA,EAEL;AAAA,EAEA,iBAAiB,OAA6C;AACxD,SAAK,UAAQ,KAAK,OAAO,KAAK,EAAC,MAAM,oBAAoB,MAAK,CAAC,GAEnE,KAAK,cAAc,eAAe;AAAA,MAChC,OAAO;AAAA,MACP,IAAI,MAAM;AAAA,MACV,QAAQ,MAAM;AAAA,MACd,WAAW,MAAM;AAAA,MACjB,aAAa,MAAM,QAAQ,KAAK,OAAO;AAAA,MACvC,iBAAiB,MAAM,QAAQ,KAAK,WAAW;AAAA,IAAA,CAChD;AAAA,EACH;AAAA;AAAA,EAGA,wBAA8B;AACxB,SAAK,UAAQ,KAAK,OAAO,KAAK,EAAC,MAAM,wBAAwB,CAAA,GAEjE,KAAK,uBAAuB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,eAAqB;AACf,SAAK,UAAQ,KAAK,OAAO,KAAK,EAAC,MAAM,eAAA,CAAe,GAExD,KAAK,yBAAyB,GAC9B,KAAK,2BAA2B,GAChC,KAAK;EACP;AAAA,EAEQ,2BAA2B;AACjC,QAAI,KAAK,2BAA2B;AAC3B,aAAA,KAAK,QAAQ,SAAS,KAAG;AACxB,cAAA,QAAQ,KAAK,QAAQ;AACvB,YAAA,KAAK,4BAA4B,MAAM;AACzC,eAAK,QAAQ;;AAEb;AAAA,MAEJ;AACA,WAAK,4BAA4B;AAAA,IACnC;AAAA,EACF;AAAA,EAEQ,6BAA6B;AACnC,UAAM,WAAW,KAAK,cAAc,UAC9B,UAAU,KAAK,cAAc,SAG7B,yBAAyB,KAAK,QAAQ,SAAS,IAAI,KAAK,QAAQ,KAAK,MAAM;AACjF,aAAS,MAAM,wBAAwB,OAAO,SAAS,OAAO;AAC5D,YAAM,cAAc,KAAK,cAAc,IAAI,GAAG;AAC9C,WAAK,QAAQ,WAAW,qBAAqB,WAAW,GAAG,UAAU;AAAA,IACvE;AAGI,QAAA,KAAK,QAAQ,UAAU;AAAG;AAExB,UAAA,0BAA0B,KAAK,QAAQ,MAAM;AAEnD,aAAS,MAAM,0BAA0B,GAAG,OAAO,UAAU,OAAO;AAClE,YAAM,cAAc,KAAK,cAAc,IAAI,GAAG;AAC9C,WAAK,QAAQ,iBAAiB,qBAAqB,WAAW,GAAG,UAAU;AAAA,IAC7E;AAAA,EACF;AAAA,EAEQ,2BAA2B,KAAa;AAC9C,KAAI,KAAK,8BAA8B,UAAa,MAAM,KAAK,+BAC7D,KAAK,4BAA4B;AAAA,EAErC;AAAA,EAEQ,sBAAsB;AAxNhC,QAAAN;AAyNI,QAAI,KAAK,sBAAsB;AAC7B,YAAIA,MAAK,KAAA,QAAQ,UAAb,OAAA,SAAAA,IAAoB,UAAS;AAAW;AAEtC,YAAA,UAAU,KAAK,cAAc;AACnC,UAAI,CAAC;AAAS;AACR,YAAA,eAAe,qBAAqB,OAAO;AACjD,mBAAa,OAAO,WACpB,aAAa,KAAK,YAClB,aAAa,MAAM,aAAa,OAChC,KAAK,QAAQ,eAAe,YAAY;AAAA,IAC1C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,YAAYnB,KAA2B;AACjC,QAAA,KAAK,QAAQ,WAAW;AACnB,aAAA,KAAK,uBAAuB,YAAY;AASjD,UAAM,aAAaA,IAAG,MAAM,KAAK,CAAC,GAC5B,eAAe,WAAW,MAAM,GAChC,UAAU,WAAW,MAAA,GACrB,YAAY,OAAO,YAAY;AAE5B,aAAA,MAAM,KAAK,QAAQ,SAAS,OAAO,KAAK,QAAQ,UAAU,OAAO;AACxE,YAAM,QAAQ,KAAK,QAAQ,IAAI,GAAG;AAClC,UAAI,MAAM,OAAO;AACR,eAAA;AAGT,UAAI,KAAK,MAAM,MAAM,YAAY,IAAI,KAAK,KAAK,MAAO;AAK7C,eAAA;AAAA,IAEX;AAEO,WAAA,KAAK,uBAAuB,YAAY;AAAA,EACjD;AAAA,EAEA,wBAAwB,OAAoC;AAC1D,aACM,WAAW,QAAQ,MAAM,QAAQ,IAAI,KAAK,QAAQ,SACtD,YAAY,KAAK,QAAQ,UACzB,YACA;AACA,YAAM,eAAe,KAAK,QAAQ,IAAI,QAAQ;AAC9C,UAAI,aAAa,SAAS,aAAa,aAAa,SAAS;AACpD,eAAA;AAAA,IAEX;AAEA,WAAK,KAAK,uBAEH,KAAK,QAAQ,QAFmB;AAAA,EAGzC;AAAA,EAEA,cAAc,OAAuB;AAC5B,WAAA,UAAU,KAAK,QAAQ;AAAA,EAChC;AAAA;AAAA,EAGA,aAAa,OAAsB;AACjC,WAAO,GAAG,MAAM,aAAa,QAAS,CAAA,IAAI,MAAM,EAAE;AAAA,EACpD;AAAA,EAEA,YAAmB;AACjB,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEA,mBAAmB,KAAiC;AAC7C,WAAA,KAAK,cAAc,IAAI,GAAG,IACxB,KAAK,cAAc,IAAI,GAAG,IADQ;AAAA,EAE3C;AAAA,EAEA,wBAAwB,KAAa,gBAAgB,GAAU;AAC7D,QAAI,WAAW;AACN,eAAA;AACP,YAAM,QAAQ,KAAK,QAAQ,IAAI,QAAQ;AACvC,UAAI,CAAC;AAAa,cAAA,IAAI,MAAM,0CAA0C;AAEtE,UAAI,OAAO,MAAM;AACf;AAAA,eACS,MAAM,MAAM;AACrB;AAAA;AAEO,eAAA;AAAA,IAEX;AAAA,EACF;AAAA,EAEA,uBACE,UACA,SACA,KACkB;AAClB,QAAI,QAAQ,IAAI,OACZ,YAAY,IAAI;AAEpB,aAAS,MAAM,SAAS,OAAO,UAAU,OAAO;AAC9C,YAAM,cAAc,KAAK,cAAc,IAAI,GAAG;AAE1C,kBAAY,gBACd,QAAQ+Q,aAAW,OAAO,YAAY,YAAY,MAAM,IAGtD,YAAY,oBACd,YAAYA,aAAW,WAAW,YAAY,gBAAgB,MAAM;AAAA,IAExE;AAEO,WAAA,EAAC,OAAO;EACjB;AAAA,EAEA,qBAAqB,UAAkB,KAAyC;AAC9E,WAAO,KAAK,uBAAuB,UAAU,KAAK,cAAc,SAAS,GAAG;AAAA,EAC9E;AAAA,EAEA,cACE,YACA,UACA,UACA,SACkB;AAClB,QAAI,aAAa,YAAY,KAAW,WAAW,OAAO,IAAI,GAC1D,iBAAiB,YAAY,KAAW,WAAW,WAAW,IAAI;AAEtE,UAAM,eAAe,SAAS,YAAY,cAAc,GAClD,oBAAoBF,WAAS,UAAU;AAC7C,QAAI,aAA2B;AAG/B,aAAS,WAAW,UAAU,YAAY,SAAS,YAAY;AAC7D,YAAM,QAAQ,KAAK,QAAQ,IAAI,QAAQ;AAClC,qBAAY,aAAa;AAE9B,eAAS,MAAM,MAAM,OAAO,MAAM,MAAM,KAAK,OAAO;AAClD,cAAM,cAAc,KAAK,cAAc,IAAI,GAAG,GAExC,OAAO;AAAA,UACX;AAAA,UACA,kBAAkB;AAAA,QACpB,GAEM,gBAAgB,YAChB,oBAAoB;AAEtB,oBAAY,gBACd,aAAa,YAAY,WAAW,YAAY,YAAY,YAAY,OAAO,IAAI,IAGjF,YAAY,oBACd,iBAAiB,YAAY;AAAA,UAC3B;AAAA,UACA,YAAY,gBAAgB;AAAA,UAC5B;AAAA,QAAA;AAIE,cAAA,gBAAgB,YAAY,QAAQ,aAAa,MAAM,QACvD,YAAY,YAAY,QAAQ,UAAU,MAAM;AAChC,oBAAY,QAAQ,cAAc,MAAM,UAEzC,CAAC,cACpB,iBAAiB,YAAY,YAAY,eAAe,cAAc,IAGpE,aAAa,CAAC,kBAChB,aAAa,YAAY,YAAY,mBAAmB,UAAU;AAAA,MAEtE;AAAA,IACF;AAEM,UAAA,aAAa,YAAY,QAAQ,UAAU,MAAM,SAAS,iBAAiB,YAC3E,kBAAkBA,WAAS,QAAQ;AAEzC,WAAO,UAAU,MAAM,YAAY,cAAc,mBAAmB,YAAY,eAAe;AAAA,EACjG;AACF;AAEA,SAAS,SAAS,YAAqC,gBAAyC;AAC9F,SAAO,YAAY,QAAQ,UAAU,MAAM,SAAS,iBAAiB;AACvE;AC5YA,SAAS,kBAAkB7Q,KAA0B;AAC5C,SAAA;AAAA,IACL,IAAAA;AAAA,IACA,UAAU;AAAA,IACV,OAAO;AAAA,IACP,KAAK;AAAA,IACL,QAAQ,CAAC;AAAA,IACT,SAAS;AAAA,EAAA;AAEb;AAEA,SAAS,MAAMgR,UAAyC,OAA6B;AAC7E,QAAA,MAAM,MAAM,OAAO,UAAU,CAAC,QAAQA,SAAQ,OAAO,IAAI,aAAa;AACxE,SAAA,OAAO,IAEF,MAAM,IAGX,MAAM,MACD,MAAM,QAAQA,SAAQ,KAAK,IAAI,KAQjC;AACT;AAEA,SAAS,kBAAkB,OAAqB,KAAqB;AACnE,MAAA,MAAM,WAAW,IAEb,KAAK;AACP,QAAA,MAAM,QAAQ,EAAC,GAAG,IACd,GAAA,OAAO,MAAM,MAAM,QAAQ;AAAgB,YAAA,IAAI,MAAM,sBAAsB;AAC/E,UAAM,MAAM,MAAM,MAAM,MACxB,OAAO,MAAM,MAAM;AAAA,EACrB;AACQ,UAAA,QAAQ,MACd,MAAM,MAAM;AAGd,QAAM,SAAS;AACjB;AAyBO,MAAM,QAAQ;AAAA,EAInB,YAAY,UAAoB;AAFO,SAAA,wBAAA,MAGhC,KAAA,WAAW,UAChB,KAAK,UAAU;AAAA,MACb,OAAO,kBAAkB,SAAS,OAAO;AAAA,MACzC,WAAW,kBAAkB,SAAS,WAAW;AAAA,IAAA;AAAA,EAErD;AAAA,EAOA,0BAA0B,KAAuC;AAC/D,UAAM,QAAQ,KAAK,QAAQ,IAAI,OAAO;AAElC,QAAA,IAAI,SAAS,YAAY;AAC3B,WAAK,wBAAwB,GAE7B,kBAAkB,OAAO,IAAI,QAAQ;AACrC;AAAA,IACF;AAEI,QAAI,SAAS,qBACX,MAAM,WACR,KAAK,OAAO,OAAO,GAAG,GACtB,KAAK,SAAS,kBAAkB,GAAG,KAC1B,MAAM,WACf,MAAM,OAAO,KAAK,GAAG,IAErB,kBAAkB,OAAO,IAAI,IAAI;AAAA,EAGvC;AAAA,EAEA,oBAAoB,KAA2C;AAC7D,QAAI,CAAC,KAAK;AAAsB,YAAA,IAAI,MAAM,sCAAsC;AAEhF,eAAW,SAAS,OAAO,OAAO,KAAK,OAAO;AACxC,UAAA,CAAC,MAAM,SAAS;AACZ,cAAA,MAAM,MAAM,KAAK,KAAK;AAExB,eAAO,KACT,KAAK,cAAc,OAAO,GAAG;AAAA,MAEjC;AAGF,SAAK,SAAS,iBAAiB,GAAG,GAClC,KAAK,wBAAwB,IAAI;AAAA,EACnC;AAAA,EAEA,wBAA8B;AAC5B,eAAW,SAAS,OAAO,OAAO,KAAK,OAAO;AACxC,UAAA,CAAC,MAAM,SAAS;AAClB,YAAI,MAAM,UAAU;AAAY,gBAAA,IAAI,MAAM,2CAA2C;AAChF,aAAA,cAAc,OAAO,CAAC;AAAA,MAC7B;AAEF,SAAK,SAAS;EAChB;AAAA,EAEA,IAAI,YAAqB;AAChB,WAAA,OAAO,OAAO,KAAK,OAAO,EAAE,MAAM,CAAC,UAAU,MAAM,OAAO;AAAA,EACnE;AAAA,EAEA,IAAI,iBAA0B;AAC5B,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,kBAAoC;AAC/B,WAAA,EAAC,OAAO,KAAK,QAAQ,MAAM,OAAO,WAAW,KAAK,QAAQ,UAAU,MAAK;AAAA,EAClF;AAAA,EAEQ,cAAc,OAAqB,KAAa;AAEtD,eAAW,UAAU,MAAM,OAAO,MAAM,GAAG,GAAG;AACvC,WAAA,OAAO,OAAO,MAAM;AAI3B,eAAW,UAAU,MAAM,OAAO,MAAM,GAAG;AACzC,WAAK,OAAO,OAAO,MAAM,GACzB,KAAK,SAAS,kBAAkB,MAAM;AAGxC,UAAM,SAAS,CACf,GAAA,MAAM,UAAU;AAAA,EAClB;AAAA,EAEA,IAAY,cAAuB;AAC1B,WAAA,OAAO,OAAO,KAAK,OAAO,EAAE,MAAM,CAAC,UAAU,MAAM,QAAQ;AAAA,EACpE;AAAA;AAAA,EAGQ,OAAO,OAAqB,KAAyC;AACrE,UAAA,QAAQD,aAAW,MAAM,OAAO,IAAI,QAAQ,KAAY,GAC9D,MAAM,MAAM,IAAI;AAAA,EAClB;AAAA,EAEQ,0BAA0B;AAChC,QAAI,KAAK,aAAa;AACpB,iBAAW,SAAS,OAAO,OAAO,KAAK,OAAO;AAC5C,cAAM,UAAU;AAElB,WAAK,wBAAwB,MAC7B,KAAK,SAAS,MAAM;AAAA,IACtB;AAAA,EACF;AACF;AC7LO,MAAM,eAAe;AAAA,EAM1B,YAAY,UAAoB,KAAuB,OAAqB,KAAY;AACjF,SAAA,WAAW,UAChB,KAAK,QAAQ,OACb,KAAK,MAAM,KACX,KAAK,MAAM;AAAA,EACb;AAAA,EAEA,KAAK,OAAqB,KAAqB;AAC7C,WAAO,KAAK,UAAU,SAAS,KAAK,QAAQ;AAAA,EAC9C;AAAA;AAAA,EAOA,gBAAgD;AACvC,WAAA,SAAS,KAAK,YAAA,CAAa;AAAA,EACpC;AAAA,EAEA,cAAgC;AAC9B,WAAK,KAAK,iBACR,KAAK,eAAe,KAAK,SAAS,qBAAqB,KAAK,IAAI,KAAK,KAAK,GAAG,IAGxE,KAAK;AAAA,EACd;AAAA;AAAA,EAGA,kBAAkD;AACzC,WAAA,SAAS,KAAK,cAAA,CAAe;AAAA,EACtC;AAAA,EAEA,gBAAkC;AAChC,QAAI,CAAC,KAAK;AAAa,YAAA,IAAI,MAAM,gBAAgB;AAEjD,WAAK,KAAK,mBACR,KAAK,iBAAiB,KAAK,SAAS;AAAA,MAClC,KAAK,MAAM;AAAA,MACX,KAAK,IAAI,MAAM;AAAA,MACf,KAAK,YAAY;AAAA,IAAA,IAId,KAAK;AAAA,EACd;AAAA,EAEA,OAAyB;AACnB,QAAA,CAAC,KAAK,OAAO;AACf,UAAI,CAAC,KAAK;AAAa,cAAA,IAAI,MAAM,gBAAgB;AAE5C,WAAA,QAAQ,KAAK,SAAS;AAAA,QACzB,KAAK,cAAc;AAAA,QACnB,KAAK,YAAY;AAAA,QACjB,KAAK,MAAM,QAAQ;AAAA,QACnB,KAAK,IAAI;AAAA,MAAA;AAAA,IAEb;AAEA,WAAO,KAAK;AAAA,EACd;AACF;AAEA,SAAS,SAAS,KAAuB;AAChC,SAAA,IAAI,SAAS,IAAI;AAC1B;ACtEA,MAAM,uBAAuB;AA0BtB,MAAM,mBAAmB;AAAA,EAiB9B,YAAY,SAAoC;AAZtC,SAAA,UAAA,GAUuB,KAAA,iBAAA,YAajC,KAAQ,aAAa,IACrB,KAAQ,gBAAgB,GACxB,KAAQ,aAAa,IACrB,KAAQ,eAAe,IACvB,KAAQ,UAAU,IAElB,KAAQ,SAAwB,MAChC,KAAQ,aAAmC,MAC3C,KAAQ,OAAsB,MAC9B,KAAQ,WAAiC,MAnBvC,KAAK,WAAW,QAAQ,UACxB,KAAK,SAAS,QAAQ,QACtB,KAAK,UAAU,QAAQ,SACvB,KAAK,WAAW,IAAI,QAAQ,KAAK,QAAQ,GAEzC,KAAK;EACP;AAAA,EAiBA,aAAmB;AACZ,SAAA,SAAS,MAAM,IAAI;AAAA,EAC1B;AAAA,EAEA,SAAS,OAAsB,KAA0B;AACnD,YAAQ,KAAK,QAAM,KAAK,WAAW,GAAG,GACtC,UAAU,KAAK,UAAQ,KAAK,aAAa,KAAK;AAElD,QAAI,gBAAgB;AAEhB,QAAA,KAAK,eAAe,aAAa,KAAK,aAAa,aAAa,CAAC,KAAK,SAAS;AACjF,WAAK,iBAAiB;AAAA,aACb,KAAK,eAAe,aAAa,KAAK,aAAa;AAC5D,WAAK,iBAAiB;AAAA,aACb,KAAK,YAAY;AAC1B,WAAK,iBAAiB;AAEtB,YAAM,YAAY,KAAK,YAAY,KAAK,SAAS;AAE7C,WAAK,WAAW,QAAQ,UAAU,SACpC,KAAK,WAAW,WAChB,KAAK,iBAAiB,aAEtB,KAAK,kBAAkB,KAAK,YAAY,SAAS;AAAA,IAErD;AAAW,WAAK,YACd,KAAK,iBAAiB,OACtB,KAAK,kBAAkB,MAAM,KAAK,QAAQ,MAE1C,KAAK,iBAAiB,YACtB,gBAAgB;AAGb,SAAA,gBAAgB,eAErB,KAAK,MAAM;AAAA,EACb;AAAA,EAEA,YAAY,MAAqB;AAC1B,SAAA,aAAa,MAClB,KAAK,MAAM;AAAA,EACb;AAAA,EAEA,IAAI,YAA0B;AAC5B,WAAO,KAAK,cAAc,OAAO,KAAK,cAAe,WAAW,KAAK,aAAa;AAAA,EACpF;AAAA,EAEA,IAAI,UAAwB;AAC1B,WAAO,KAAK,YAAY,OAAO,KAAK,YAAa,WAAW,KAAK,WAAW;AAAA,EAC9E;AAAA,EAEA,IAAI,eAAsB;AACxB,WAAO,KAAK,WAAW,KAAK,SAAS,UAAU;AAAA,EACjD;AAAA;AAAA,EAGA,kBAA2B;AACzB,WAAO,EAAQ,KAAK,SAAU,KAAK,mBAAmB,WAAW,KAAK,mBAAmB;AAAA,EAC3F;AAAA,EAEA,mBAAmB,KAA4C;AACvD,UAAA,YAAY,KAAK,SAAS,cAAc,GAAG,IAAI,OAAO,KAAK,SAAS,aAAa,GAAG;AAE1F,QAAI,CAAC,KAAK;AACD,aAAA,CAAC,MAAM,SAAS;AAGzB,UAAM,aAAa,KAAK;AACxB,WAAI,cAAc,WAAW,QAAQ,IAAI,QAChC,CAAC,KAAK,QAAQ,SAAS,IAGzB,CAAC,kBAAkB,SAAS;AAAA,EACrC;AAAA,EAEA,qBAAqB,OAAuC;AAC1D,UAAM,WAAW,KAAK;AAKlB,WAAA,YAAY,MAAM,QAAQ,SAAS,QAC9B,CAAC,KAAK,SAAS,aAAa,KAAK,GAAG,KAAK,IAAI,IAG/C,CAAC,KAAK,SAAS,aAAa,KAAK,GAAG,IAAI;AAAA,EACjD;AAAA,EAEA,WAAW,KAA0B;AACnC,SAAK,OAAO,KACZ,KAAK,WAAW,MAAM,KAAK,SAAS,YAAY,GAAG,IAAI,MAEnD,KAAK,WAAW,qBAElB,KAAK,SAAS,MACd,KAAK,aAAa;AAAA,EAEtB;AAAA,EAEA,aAAa,OAA4B;AACnC,cAAU,mBACR,OAAO,KAAK,YAAa,WAC3B,KAAK,aAAa,KAAK,WAEvB,KAAK,aAAa,KAAK,SAAS,wBAAwB,KAAK,QAAQ,IAGvE,KAAK,aAAa,QAAQ,KAAK,SAAS,YAAY,KAAK,IAAI,MAG/D,KAAK,SAAS;AAAA,EAChB;AAAA,EAEA,kBAAkD;AAChD,WAAO,KAAK,cAAc,KAAK,kBAAkB,KAAK,gBAAgB,gBAAoB,IAAA;AAAA,EAC5F;AAAA,EAEA,YAA4C;AAC1C,WAAO,KAAK,YAAY,KAAK,kBAAkB,KAAK,gBAAgB,cAAkB,IAAA;AAAA,EACxF;AAAA,EAEA,kBAAkB,OAAqB,KAAkB;AACnD,SAAK,mBAAmB,KAAK,gBAAgB,KAAK,OAAO,GAAG,MAChE,KAAK,kBAAkB,IAAI;AAAA,MACzB,KAAK;AAAA,MACL,KAAK,SAAS;AAAA,MACd;AAAA,MACA;AAAA,IAAA;AAAA,EAEJ;AAAA,EAEA,cAAuC;AACrC,WAAO,KAAK,kBAAkB,KAAK,gBAAgB,KAAS,IAAA;AAAA,EAC9D;AAAA,EAEA,oBAAmD;AAC3C,UAAA,OAAO,KAAK;AAClB,QAAI,MAAM;AACR,UAAI,KAAK,SAAS;AAAe,eAAA;AACjC,UAAI,KAAK,SAAS;AAAU,cAAM,IAAI,MAAM,4BAA4B,KAAK,IAAI,EAAE;AAAA,IACrF;AAEO,WAAA;AAAA,EACT;AAAA,EAEA,qBAAqB,IAAsC;AACpD,SAAA,SAAS,0BAA0B,EAAE,GAC1C,KAAK,cAGD,KAAK,SAAS,kBAAgB,KAAK,MAAM;AAAA,EAC/C;AAAA,EAEA,QAAc;AACR,SAAK,WAEJ,KAAK,eACR,KAAK,aAAa,IAElB,KAAK,KAAO,EAAA,KAAK,MAAM;AACrB,WAAK,aAAa;AAAA,IACnB,CAAA;AAAA,EAEL;AAAA,EAEA,SAAe;AACb,SAAK,eAAe;AAAA,EACtB;AAAA,EAEA,UAAgB;AACd,SAAK,eAAe;AAAA,EACtB;AAAA,EAEA,MAAc,OAAO;AA1PvB,QAAA5P;AAmQI,QAPE,KAAK,SAAS,kBACd,CAAC,KAAK,SAAS,yBACd,KAAK,mBAAmB,aACvB,KAAK,cACL,KAAK,SAAS,cAAc,KAAK,kBACnC,CAAC,KAAK,cAMR;AAAI,UAAA;AACF,cAAM,KAAK;eACJ,KAAK;AACZ,aAAK,UAAU,KACfA,MAAK,KAAA,YAAL,uBAAe,KAAK,IAAA;AACpB;AAAA,MACF;AAEA,YAAM,KAAK;IAAK;AAAA,EAClB;AAAA,EAEA,MAAc,wBAAwB;AACpC,UAAM,cAAc,KAAK,SAAS,aAC5B,UAAU,KAAK,SAAS,SACxB,eAAe,KAAK,OAAO,UAC3B,QAAQ;AAEd,QAAI,cAAc,6JAA6J,KAAK,IAChL,MAAM,KAAK,SAAS;AACpB,YACF,eAAe,kBAAkB,GAAG;AAGhC,UAAA,kBAAkB,KAAK,OAAO;AAAA,MAClC,iBAAiB,aAAa,OAAO,iBAAiB,WAAW,IAAI,OAAO,IAAI,WAAW;AAAA,IAAA,GAGvF,UADS,MAAM,cAAc,iBAAiB,aAAa,KAAK,GAChD;AACtB,QAAI,QAAQ;AAEH,eAAA;AAED,YAAA,SAAS,MAAM,OAAO;AAC5B,UAAI,OAAO;AAAM;AAEjB,UAAI,WAAW,OAAO;AACd,cAAA,IAAI,MAAM,OAAO,MAAM,MAAM,eAAe,OAAO,MAAM,MAAM,IAAI;AAK3E,UAFA,SAEI,OAAO,MAAM,OAAO,KAQxB;AAAA,YAAI,KAAK,SAAS,0BAA0B,OAAO,CAAC,KAAK,SAAS;AAChE;AAGF,aAAK,SAAS,oBAAoB,OAAO,KAAK,GAC9C,MAAM,KAAK,SAAS;AAAA,MAAA;AAAA,IACtB;AAGI,SAAK,SAAS,0BAA0B,OAAO,CAAC,KAAK,SAAS,mBAI9D,QAAQ,SACV,KAAK,SAAS,sBAAsB,GAGtC,KAAK,WAAW;AAAA,EAClB;AAAA,EAEQ,aAAa;AA5UvB,QAAAA;AA6UI,SAAK,SAAS,aAAa,GAE3B,KAAK,WAAW,KAAK,IAAI,GACzB,KAAK,aAAa,KAAK,IAAI,GAE3B,KAAK,YACLA,MAAK,KAAA,YAAL,uBAAe,MAAM,IAAA;AAAA,EACvB;AACF;AC5SA,MAAM,wBACG,uBAAA,OAAO,IAAI,GAEd,aAAa,CACjB,QACA,aACA,UAA8C,OACH;AAC3C,QAAM,MAAM,MAAM,QAAQ,WAAW,IAAI,cAAc,CAAC,WAAW,GAC7D,EAAC,MAAM,SAAA,IAAY;AAEzB,MAAI,QAAQ;AACJ,UAAA,IAAI,MAAM,2DAA2D;AAIzE,MAAA,MAAM,iBADM,OAAO,OAAO,EAAE,OACE,cAAc,IAAI,KAAK,GAAG,CAAC;AAEzD,MAAA;AACI,UAAA,GAAG,GAAG,aAAa,QAAQ;AAAA,OAC5B;AACL,UAAM,YAAY,SAAY,oBAAA,QAAO,YAAY;AAE3C,UAAA,GAAG,GAAG,SAAS,SAAS;AAAA,EAChC;AAEA,SAAO,OAAO,QAAQ,EAAC,IAAI,CAAA;AAC7B,GAEM,wBAAwB,CAC5B,QACA,YACA,aACwC;AACxC,QAAM,cAAc,eAAe,UAAU,GACvC,UAAU,WAAW,UAAU,GAC/B,WAAW,GAAG,WAAW,IAAI,QAAQ,IACrC,SAAS,sBAAsB,QAAQ;AACzC,MAAA;AACK,WAAA;AAIH,QAAA,MAAM,iBADI,OAAO,SAAS,OACI,cAAc,WAAW,IAAI,OAAO,aAAa,QAAQ,IAEvF,QAAQ,OAAO,QAAwC,EAAC,KAAI,EAAE,KAAK,CAAC,WAAW;AACnF,UAAM,YAAY,OAAO,aAAa,CAAA,GAChC,YAAY,UAAU,KAAK,CAAC,QAAQ,IAAI,QAAQ,WAAW;AAEjE,WADc,UAAU,KAAK,CAAC,QAAQ,IAAI,QAAQ,OAAO,KACzC;AAAA,EAAA,CACjB;AAEqB,SAAA,sBAAA,QAAQ,IAAI,OAC3B;AACT,GAEM,wBAAwB,CAAC;AAAA,EAC7B;AAAA,EACA;AAAA,EACA;AACF,MAI0B;AAClB,QAAA,WAAW,IAAI,SAAS;AAAA,IAC5B,aAAa;AAAA,IACb,aAAa;AAAA,EAAA,CACd;AACD,SAAO,IAAI,mBAAmB;AAAA,IAC5B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AACH,GAEM,kBAAkB,OACtB,QACA,gBACgD;AAChD,QAAM,MAAM,MAAM,QAAQ,WAAW,IAAI,cAAc,CAAC,WAAW,GAC7D,UAAU,OAAO,OAAS,EAAA,SAC1B,QAAQ,EAAC,gBAAgB,QAAQ,gCAAgC,OACjE,GAAA,MAAM,iBAAiB,OAAO,iBAAiB,IAAI,KAAK,GAAG,CAAC;AACnD,UAAA,MAAM,OAAO,QAAQ,EAAC,KAAK,MAAM,CAAA,GAE7C,SAAS,MAAM,EACf,MAAM;AAAA,CAAI,EACV,OAAO,OAAO,EACd,IAAI,CAAC,SAAiB,KAAK,MAAM,IAAI,CAAC;AAG3C,GAEM,eAAe,CAAC,QACpB8P;AAAAA,EACE;AAAA,EACA,CAAC,KAAU,SAAUzG,cAAY,IAAI,KAAK,CAAC,IAAI,SAAS,KAAK,IAAI,IAAI,CAAC,GAAG,KAAK,KAAK,IAAI,IAAI;AAAA,EAC3F,CAAC;AACH;AAEF,SAAS,QAAQ,OAAgB,OAAiB;AAC5C,SAAA,MAAM,QAAQ,KAAK,IACd;AAAA,IACL,MAAM,IAAI,CAAC,SAAS,QAAQ,MAAM,KAAK,CAAC,EAAE,OAAO,CAAC,SAAS,OAAO,OAAS,GAAW;AAAA,EAAA,IAItFzJ,WAAS,KAAK,IACT;AAAA,IACL,OAAO,KAAK,KAAK,EAAE,OAAgC,CAAC,KAAK,QAAQ;AAC/D,YAAM,cAAc,QAAQ,MAAM,GAAG,GAAG,KAAK;AAC7C,aAAI,OAAO,cAAgB,QACzB,IAAI,GAAG,IAAI,cAGN;AAAA,IACT,GAAG,EAAE;AAAA,EAAA,IAIF,MAAM,KAAK;AACpB;AAEA,MAAM,cAAc,CAAC,KAAqB,UACxC,QAAQ,KAAK,CAAC,SAAmByJ,cAAY,IAAI,IAAI,MAAM,IAAI,IAAI,IAAK,GAG7D,0BAA0B,CACrC,KACA,gBAEA,YAAY,KAAK,CAAC,YACO,YAAY,QAAQ,IAAI,IACvB,UAAU,MACnC;AAEH,SAAS,QAAQ,QAAsB,YAAoB,kBAA0B,KAAa;AAChG,SAAO,KAAK,sBAAsB,QAAQ,YAAY,GAAG,CAAC,EAAE;AAAA,IAC1D,SAAS,CAAC,uBAAuB;AAC/B,UAAI,CAAC;AACH,cAAM,IAAI,MAAM,mCAAmC,UAAU,gBAAgB,GAAG,EAAE;AAGpF,YAAM,mBAAmB,aAAa,kBAAkB,EACrD,IAAI,CAAC,UAAU,IAAI,KAAK,sBAAsB,KAAK,SAAS,EAC5D,KAAK,GAAG;AAEX,aAAO,OAAO,WACX,MAA2C,IAAI,gBAAgB,GAAG,EAClE,KAAK,IAAI,CAAC,gBAAgB,wBAAwB,oBAAoB,WAAW,CAAC,CAAC;AAAA,IAAA,CACvF;AAAA,IACD,IAAI,CAAC,uBAAuB;AAE1B,YAAM,EAAC,YAAY,GAAG3J,UAAA,IAAY;AAClC,aAAO,EAAC,GAAGA,WAAU,KAAK,iBAAgB;AAAA,IAAA,CAC3C;AAAA,IACD;AAAA,MAAS,CAAC,kBACR,OAAO,WAAW,gBAAgB,eAAe,EAAC,YAAY,SAAQ;AAAA,IACxE;AAAA,EAAA;AAEJ;AAQgB,SAAA,mBAAmB,EAAC,UAA4C;AACvE,SAAA;AAAA,IACL,uBAAuB,CAAC,YAAY,aAClC,sBAAsB,QAAQ,YAAY,QAAQ;AAAA,IAEpD,YAAY,CAAC,aAAa,YAAY,WAAW,QAAQ,aAAa,OAAO;AAAA,IAE7E,iBAAiB,CAAC,gBAAgB,gBAAgB,QAAQ,WAAW;AAAA,IAErE,SAAS,CAACb,KAAI,UAAU,QAAQ,QAAQ,QAAQA,KAAI,UAAU,GAAG;AAAA,IAEjE;AAAA,EAAA;AAEJ;AClMA,MAAM,wBAAwB,CAAC,UAA0D;AACvF,MAAI,MAAM,SAAS;AACV,WAAA;AAAA,MACL,MAAM;AAAA,MACN,QAAQ,MAAM;AAAA,MACd,WAAW,MAAM;AAAA,IAAA;AAGjB,MAAA,MAAM,SAAS,SAAS;AAC1B,UAAM,EAAC,WAAA6C,YAAW,cAAa,MAAM;AAC9B,WAAA;AAAA,MACL,MAAM;AAAA,MACN,QAAQ,MAAM;AAAA,MACd,WAAAA;AAAA,MACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MAClC;AAAA,IAAA;AAAA,EAEJ;AAEA,MAAI,MAAM,SAAS;AACV,WAAA;AAAA,MACL,MAAM;AAAA,MACN,QAAQ,MAAM;AAAA,MACd,WAAW,MAAM,EAAE;AAAA,MACnB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IAAA;AAItC,QAAM,IAAI,MAAM,+BAA+B,KAAK,UAAU,KAAK,CAAC,EAAE;AACxE,GAEa,uBAAuB,CAAC,OAAoBA,eAAiC;AACxF,QAAM,kBAA8C,MACjD,QAAwC,UAAU,EAClD,KAAK,IAAI,qBAAqB,CAAC,GAE5B,kBAAkB,CAAC,YACnB,QAAQ,SAAS,aACZ,MAAM,QAAQ,qBAAqB,EAAC,SAASA,WAAA,CAAU,IAG5D,QAAQ,SAAS,UACZ,MAAM,QAAQ,qBAAqB;AAAA,IACxC,MAAM,EAAC,WAAW,QAAQ,WAAW,WAAAA,WAAS;AAAA,EAC/C,CAAA,IAGC,QAAQ,SAAS,eACZ,MAAM,QAAQ,uBAAuB,EAAC,SAASA,WAAU,CAAA,IAG3DwD;AAGT,SAAO,CAAC,gBAAgB,KAAK0J,QAAM,CAAC,GAAG,eAAe;AACxD,GC/EM,UAAU;AAAA,EACd;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAAA;AAAA,EAIA;AACF,GAEM,QAAQ;AAAA,EACZ,CAAC,UAAU,OAAO;AAAA,EAClB,CAAC,UAAU,QAAQ;AAAA,EACnB;AAAA,IACE;AAAA,IACA,EAAC,MAAM,eAAc;AAAA,IACrB;AAAA,IACA,EAAC,MAAM,eAAc;AAAA,IACrB;AAAA,IACA,EAAC,MAAM,eAAc;AAAA,IACrB;AAAA,EACF;AAAA,EACA,CAAC,eAAe,EAAC,MAAM,eAAA,GAAiB,UAAU;AAAA,EAClD,CAAC,eAAe,EAAC,MAAM,eAAiB,GAAA,aAAa,EAAC,MAAM,eAAc,GAAG,UAAU;AAAA,EACvF,CAAC,eAAe,EAAC,MAAM,eAAiB,GAAA,aAAa,EAAC,MAAM,eAAc,GAAG,WAAW;AAAA,EACxF,CAAC,WAAW,SAAS;AAAA,EACrB,CAAC,WAAW,QAAQ;AAAA,EACpB,CAAC,kCAAkC,QAAQ,OAAO;AACpD,GAEa,QAAQ,MAAM,MAAM,MAAM,GAAG,GAAK,CAAC,EAAE;AAAA,EAChD,WAAW,OAAO;AAAA,EAClB;AAAA,IACE,CAAC/P,KAAI,OAAmB;AAAA,MACtB,MAAM;AAAA,MACN,QAAQA;AAAA,MACR,WAAWA,MAAK;AAAA,MAChB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MAClC,WAAW;AAAA,QACT;AAAA,UACE,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,eAAc,oBAAI,KAAK,GAAE,YAAY;AAAA,UACrC,MAAM,OAAO,KAAK;AAAA,QACpB;AAAA,MACF;AAAA,IAAA;AAAA,EAEJ;AAAA,EACA,YAAY;AACd,GCYM,MAAM,uBACN,WAAW,MAAM,OAAO,EAAE;AAUhC,SAAS,eAAe;AAClB,MAAA;AACK,WAAA,OAAO,eAAe,QAAQ,GAAG;AAAA,EAAA,QAC5B;AAAA,EAEd;AACO,SAAA;AACT;AAEA,SAAS,aAAaA,KAAY;AAC5B,MAAA;AACK,WAAA,eAAe,QAAQ,KAAKA,GAAE;AAAA,EAAA,QACzB;AAAA,EAEd;AACO,SAAAA;AACT;AAGO,MAAM,aAAa,aAAA,KAAkB,aAAa,UAAU;AAG5D,SAAS,yBAAyB,SAIvB;AAChB,QAAM,EAAC,OAAO,uBAAuB,cAAa,SAE5C,CAAC,iBAAiB,WAAW,IAAI,qBAAqB,OAAO,UAAU,GAEvE,mBAAmB,IAAI,gBAAoC,EAAE,GAC7D,kBAAkB,iBAAiB,KAAK,qBAAsB,CAAA,GAG9D,cAAc,CAAC,iBAAqC;AACxD,qBAAiB,KAAK,YAAY;AAAA,EAAA,GAI9B,kBAAkB,CAAC,cACvB,YAAY,EAAC,MAAM,SAAS,UAAqB,CAAA,GAE7C,kBAAkB,MAAM,YAAY,EAAC,MAAM,YAAW,GAEtD,oBAAoB,gBAAgB;AAAA,IACxC,OAAO,CAAC,UAAkD,MAAM,SAAS,UAAU;AAAA;AAAA,IAEnF,OAAO,CAAC,UAAyB,MAAM,cAAc,UAAU;AAAA,EAM3D,GAAA,0BAA0B,MAAM,GAHV,GAGgC,GAEtD,kBAAkB,MAAM,MAAM,MAAM,iBAAiB,iBAAiB,CAAC,EAAE;AAAA,IAC7E,UAAU,MAAM,uBAAuB;AAAA,IACvC,eAAe,gBAAgB;AAAA,IAC/B,IAAI,CAAC,CAAA,EAAG,SAAS,MAAM,SAAS;AAAA,IAChC,UAAU,GAAG;AAAA,IACb,UAAU,CAAC,cAAc,gBAAgB,SAAS,CAAC;AAAA,IACnD,WAAWqG,OAAK;AAAA,IAChB0J,QAAM;AAAA,EAKF,GAAA,cAAc,MAAM,MAAM,iBAAiB,EAAE,KAAK,WAAW1J,OAAK,CAAC,GAEnE,oBAAoB,sBAAsB,kBAAkB;AAAA,IAChE,IAAI,CAAC,WAAW,OAAO,IAAI;AAAA,IAC3B,OAAO,CAAC,eAAe,eAAe,eAAe,eAAe,OAAO;AAAA,IAC3E,qBAAqB;AAAA,EAAA,GAIjB,sBAAsB,aAAa;AAAA,IACvC,IAAI,CAAC,SAAS,KAAK,KAAK,CAAC,QAAQ,IAAI,WAAW,WAAW,CAAC,CAAC;AAAA,IAC7D;AAAA,MACE,CAAC,SACC,OACI,OAAA,SAAA,IAAA,MAAM,aAAa,CACpB,EAAA,MAAM,GACN,EAAA,IAAI,CAAC,MAAM,EAAE,YAAW,CAAC;AAAA,IAChC;AAAA,EAAA,GAGI,WAAW,oBAAoB;AAAA,IACnC,OAAO,CAAC,SAAS,KAAK,SAAS,aAAa,CAAC;AAAA,IAC7C,IAAI,MAAM;AAEA,cAAA;AAAA,QACN;AAAA,MAAA;AAAA,IACF,CACD;AAAA,IACD,YAAY,KAAK;AAAA,EAAA,GAGb,mBAAmB,oBAAoB,KAAK,IAAI,CAAC,SAAS,KAAK,SAAS,UAAU,CAAC,CAAC,GAEpF,aAAa,MAAM,aAAa,eAAe,EAAE;AAAA,IACrD;AAAA,MACE,CAAC,UACC,MAAM,SAAS,WAAW,MAAM,SAAS;AAAA,IAC7C;AAAA,EAAA,GAGI,sBAAsB,CAAC,gBACpB;AAAA,IACL,cAAc,WAAW;AAAA,IACzB,WAAW,WAAW;AAAA,IACtB,WAAW,WAAW;AAAA,IACtB,QAAQ,WAAW;AAAA,EAIjB,IAAA,UAAsD,MAAM,YAAY,QAAQ,EAAE;AAAA,IACtF;AAAA,MACE,CAAC,OAAO,UACN,MAAM,SAAS,eACX,KAAK,OAAO,MAAM,SAAS,IAC3B,EAAC,GAAG,OAAO,CAAC,MAAM,SAAS,GAAG,oBAAoB,KAAK,EAAC;AAAA,MAC9D,CAAC;AAAA,IACH;AAAA,EAAA,GAGI,eAA8C,kBAAkB;AAAA,IACpE,UAAU,CAAC,WAAY,WAAW,cAAc,MAAM,SAAS,eAAe,IAAI,KAAM;AAAA,IACxF,IAAI,CAAC,kBAAkB,OAAO,OAAO,aAAa,CAAC;AAAA,IACnD,UAAU,CAAC,aAAa;AAChB,YAAA,UAAU,KAAK,SAAS,IAAI,CAAC,SAAS,KAAK,MAAM,CAAC;AACxD,aAAO,KAAK,UAAU,SAAS,OAAO,CAAC,EAAE;AAAA,QACvC;AAAA,UAAI,CAAC,UACH,SACG,IAAI,CAAC,aAAa;AAAA;AAAA,YAEjB,MAAM,MAAM,KAAK,CAAC,QAAQ,IAAI,OAAO,QAAQ,MAAM;AAAA,YACnD;AAAA,UAAA,EACA,EAED,OAAO,sBAAsB;AAAA,QAClC;AAAA,MAAA;AAAA,IACF,CACD;AAAA,IACD;AAAA,MACE,UAAU,QAAQ,cAAc,EAAE,KAAK,UAAU,MAAM,YAAY,EAAC,MAAM,aAAY,CAAC,CAAC,CAAC;AAAA,IAC3F;AAAA,IACA,YAAY,EAAC,UAAU,IAAM,YAAY,GAAE;AAAA,EAAA;AAG7C,WAAS,uBAAuB,MAAyD;AAChF,WAAA,CAAA,EAAQ,KAAK,QAAQ,KAAK;AAAA,EACnC;AAGA,QAAM,kBAAgD,aAAa;AAAA,IACjE,IAAI,CAAC,aAAkD;AACrD,YAAM,UAAU;AAAA,QACd,SAAS,IAAI,CAAC,MAAM,EAAE,OAAO;AAAA,QAC7B,CAAC,MAAM,EAAE;AAAA,MAAA;AAGX,aAAO,OAAO,KAAK,OAAO,EAAE,IAAI,CAAC,WAA2C;AAlQlF,YAAAlF;AAkQsF,eAAA;AAAA,UAC9E,OAAMA,MAAS,SAAA,KAAK,CAAC,MAAM,EAAE,KAAK,OAAO,MAAM,MAAzC,OAA4C,SAAAA,IAAA;AAAA,UAClD,UAAU,QAAQ,MAAM;AAAA,QAAA;AAAA,MAC1B,CAAE;AAAA,IAAA,CACH;AAAA,IACD,eAAe,gBAAgB;AAAA,IAC/B;AAAA,MAAI,CAAC,CAAC,iBAAiB,eAAe,MACpC,gBAAgB,OAAO,CAAC,mBAClB,kBACK,KAKF,CAFW,eAAe,SAAS,KAAK,CAAC,SAAS,KAAK,cAAc,UAAU,CAGvF;AAAA,IACH;AAAA,IACA;AAAA,MAAI,CAAC,oBACH,gBAAgB,IAAI,CAAC,mBAAgB;AApR3C,YAAAA;AAoR+C,eAAA;AAAA,UACvC,MAAM,eAAe;AAAA,UACrB,QAAQ;AAAA,UACR,eAAcA,MAAe,eAAA,SAAS,OAAO,CAAC,MAAhC,OAAmC,SAAAA,IAAA;AAAA,UACjD,WAAW6C;AAAAA,aACR,eAAe,YAAY,IAAI,IAAI,CAAC,YAAY,QAAQ,aAAa,EAAE;AAAA,UAAA,EAEvE,IAAI,CAAC,cAAc;AAAA,YAClB,MAAM,SAAS;AAAA,YACf,YAAY,SAAS;AAAA,YACrB,MAAM,SAAS;AAAA,YACf,cAAc,SAAS;AAAA,UAAA,EACvB,EACD,OAAO,CAAC,MAAM,SAAS,KAAK,OAAO,IAAI,GAAG,EAAwB;AAAA,QAAA;AAAA,MACvE,CAAE;AAAA,IACJ;AAAA,EAAA;AA4BK,SAAA,EAAC,aAAa,iBAAiB,qBAAqB,iBAAiB,kBAxBnD,CAAC,eACjB,aAAa;AAAA,IAClB,eAAe,gBAAgB;AAAA,IAC/B;AAAA,MAAU,CAAC,CAAC,iBAAiB,eAAe,MAC1C,KAAK,eAAe,EAAE;AAAA,QACpB;AAAA,UACE,CAAC,mBAAmB,mBAAmB,eAAe,QAAQ,cAAc;AAAA,QAC9E;AAAA,QACA;AAAA,UAAQ,CAAC,oBACN,eAAe,QAAQ,aAAa,CAClC,GAAA,OAAO,CAAC,SAAS,KAAK,eAAe,UAAU,EAC/C,IAAI,CAAC,cAAc;AAAA,YAClB,MAAM,eAAe;AAAA,YACrB,cAAc,eAAe,QAAQ;AAAA,YACrC,MAAM,SAAS,QAAQ,CAAC;AAAA,YACxB,WAAW,eAAe,QAAQ;AAAA,UAAA,EAClC;AAAA,QACN;AAAA,QACAgH,UAAQ;AAAA,MACV;AAAA,IACF;AAAA,EAAA;AAKN;AC1TO,SAAS,mBAAmB,SAA+C;AAChF,QAAM,EAAC,OAAA,IAAU,SACX,YAAY,OAAO,OAAS,EAAA,WAC5B,kBAAkB,OAAO,WAAW,EAAC,YAAY,aAAa,CAAA;AAEpE,WAAS5H,OAA+B;AAC/B,WAAA,gBAAgB,WAAW,QAAQ;AAAA,MACxC,KAAK,aAAa,SAAS;AAAA,IAAA,CAC5B;AAAA,EACH;AAEA,WAAS,cAAc;AACd,WAAA,gBAAgB,WAAW,QAAQ;AAAA,MACxC,KAAK,aAAa,SAAS;AAAA,IAAA,CAC5B;AAAA,EACH;AAEO,SAAA,EAAC,KAAAA,MAAK;AACf;ACXO,SAAS,wBAAyC;AACvD,QAAM,UAAc,oBAAA,QAAA,GACd,8BAAc,QAAwB;AAE5C,WAAS,WAAW;AAClB,WAAO,MAAM,KAAK,EAAC,QAAQ,GAAA,CAAG,EAC3B;AAAA,MAAI,MACH,KAAK,MAAM,KAAK,OAAO,IAAI,GAAG,EAC3B,SAAS,EAAE,EACX,SAAS,GAAG,GAAG;AAAA,IAAA,EAEnB,KAAK,EAAE;AAAA,EACZ;AAEA,WAAS,SAAS,KAAa;AACvB,UAAA,WAAW,QAAQ,IAAI,GAAG;AAC5B,QAAA;AAAiB,aAAA;AACrB,UAAMpD,MAAK;AACH,WAAA,QAAA,IAAI,KAAKA,GAAE,GACZA;AAAA,EACT;AAEA,WAAS,YAAY,MAAgB;AACnC,WAAO,MAAM,KAAK,IAAI,IAAI,IAAI,CAAC,EAC5B,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,GAAG,GAAG,CAAU,EAC1C,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,cAAc,GAAG,IAAI,CAAC,EAC3C,IAAI,CAAC,CAAG,EAAA,GAAG,MAAM,GAAG;AAAA,EACzB;AAES,WAAA,QAAQ,MAAgBuC,MAAoD;AACnF,QAAI,CAAC,KAAK;AAAQ;AACZ,UAAA,CAAC,UAAU,GAAG,UAAU,IAAI,MAC5B,OAAOA,KAAI,IAAI,QAAQ;AAExB,QAAA;AACL,aAAK,WAAW,SACT,QAAQ,YAAY,KAAK,IAAI,IADL,KAAK;AAAA,EAEtC;AAES,WAAA,QACP,MACAA,MACA,OACM;AACN,QAAI,CAAC,KAAK;AAAQ;AAEZ,UAAA,CAAC,UAAU,GAAG,UAAU,IAAI,MAC5B,OAAOA,KAAI,IAAI,QAAQ,KAAK;AAAA,MAChC,MAAM;AAAA,MACN,OAAO;AAAA,MACP,0BAAU,QAAQ;AAAA,IAAA;AAIpB,QAFAA,KAAI,IAAI,UAAU,IAAI,GAElB,CAAC,WAAW,QAAQ;AACtB,WAAK,QAAQ;AACb;AAAA,IACF;AAEQ,YAAA,YAAY,KAAK,MAAM,KAAK;AAAA,EACtC;AAGA,WAASa,KAAI,MAAgB;AAC3B,WAAO,QAAQ,YAAY,IAAI,GAAG,OAAO;AAAA,EAC3C;AAES,WAAAM,KAAI,MAAgB,OAAgB;AAC3C,YAAQ,YAAY,IAAI,GAAG,SAAS,KAAK;AAAA,EAC3C;AAEO,SAAA,EAAC,KAAAN,MAAK,KAAAM;AACf;AC3EA,MAAM,uBAAuB,cAAoC,IAAI;AAQrD,SAAA,sBAAsB,EAAC,YAAuC;AACtE,QAAA,gBAAgB,QAAQ,MAAqB;AACjD,UAAM,aAAa,oBAAI,OAIjB,eAAe,CAAA;AAEd,WAAA;AAAA,MACL,KAAK,CAAC,EAAC,WAAW,mBAAkB;AAClC,cAAM,0BAA0B,aAAa;AAAA,UAAI,CAAC,QAChD,QAAQ,OAAO,eAAe;AAAA,QAE1B,GAAA,eAAe,WAAW,IAAI,SAAS;AAC7C,eAAO,6CAAc,IAAI,uBAAA;AAAA,MAC3B;AAAA,MAEA,KAAK,CAAC,EAAC,WAAW,cAAc,YAAW;AACnC,cAAA,eAAe,WAAW,IAAI,SAAS,KAAK,sBAAsB,GAClE,0BAA0B,aAAa;AAAA,UAAI,CAAC,QAChD,QAAQ,OAAO,eAAe;AAAA,QAAA;AAEhC,mBAAW,IAAI,WAAW,YAAY,GACtC,aAAa,IAAI,yBAAyB,KAAK;AAAA,MACjD;AAAA,IAAA;AAAA,EAEJ,GAAG,CAAE,CAAA;AAEL,6BACG,qBAAqB,UAArB,EAA8B,OAAO,eAAgB,SAAS,CAAA;AAEnE;AAGO,SAAS,mBAAkC;AAC1C,QAAA,QAAQ,WAAW,oBAAoB;AAC7C,MAAI,CAAC;AAAa,UAAA,IAAI,MAAM,gCAAgC;AACrD,SAAA;AACT;AC3CA,MAAM,oBAA4B;AAAA,EAChC;AAAA,IACE,IAAI;AAAA,IACJ,aAAa;AAAA,IACb,UAAU;AAAA,EACZ;AACF;AAgBO,SAAS,gBAAgB,EAAC,QAAQ,SAAS,eAA2C;AACrF,QAAA,SAAS,QAAQ,WAAW,EAAC,YAAY,aAAa,CAAA,GAEtD,aAAa,IAAI;AAAA,IACrB,OAAO,YAAY;AACX,YAAA,QAAQ,MAAM,OAAO,QAAyB;AAAA,QAClD,KAAK,UAAU,QAAQ,KAAK,GAAG,CAAC;AAAA,QAChC,iBAAiB;AAAA,QACjB,KAAK;AAAA,MAAA,CACN,GAEK,SADW,MAAM,QAAQ,KAAK,IAAI,QAAQ,CAAC,KAAK,GAC/B;AAAA,QACrB,CAAC,KAAK,UACA,QAAA,QAAA,KAAM,OACR,IAAI,KAAK,EAAE,IAAI,OAEV;AAAA,QAET,CAAC;AAAA,MAAA;AAEH,aAAO,QAAQ,IAAI,CAAC1D,QAAO,MAAMA,GAAE,KAAK,IAAI;AAAA,IAC9C;AAAA,IACA,EAAC,iBAAiB,CAAC,OAAO,IAAI,EAAE,EAAC;AAAA,EAAA,GAG7B,sBAAmC,eAAe;AAAA,IACtD,IAAI,YAAY;AAAA,IAChB,aAAa,YAAY;AAAA,IACzB,UAAU,YAAY;AAAA,EAAA;AAGb,SAAA,WAAA,MAAM,MAAM,mBAAmB,GAEtC,mDAAqB,MACvB,WAAW,MAAM,oBAAoB,IAAI,mBAAmB,GAG9D,kBAAkB,QAAQ,CAAC,SAAS,WAAW,MAAM,KAAK,IAAI,IAAI,CAAC,GAE5D;AAAA,IACL,SAAS,OAAO,WAAW;AACzB,UAAI,CAAC;AAAe,eAAA,QAAQ,QAAQ,IAAI;AAEpC,UAAA;AACK,eAAA,MAAM,WAAW,KAAK,MAAM;AAAA,eAC5B,KAAK;AAMZ,YAAI,IAAI,eAAe;AACd,iBAAA,QAAQ,QAAQ,IAAI;AAGvB,cAAA;AAAA,MACR;AAAA,IACF;AAAA,IACA,UAAU,OAAO,aACC,MAAM,WAAW,SAAS,OAAO,GAKlC;AAAA,MACb,CAAC,WAA2Be,WAAS,MAAM,KAAK,OAAO,OAAO,MAAO;AAAA,IACvE;AAAA,EAAA;AAGN;AC/EO,SAAS,eAA0B;AAClC,QAAA,EAAC,WAAW,YAAe,IAAA,UAC3B,GAAA,gBAAgB,oBAChB,SAAS,UAAU,6BAA6B;AAEtD,SAAO,QAAQ,MAAM;AACb,UAAA,YACJ,cAAc,IAAe;AAAA,MAC3B,WAAW;AAAA,MACX,cAAc,CAAC,QAAQ,WAAW;AAAA,IACnC,CAAA,KAAK,gBAAgB,EAAC,QAAQ,YAAY,CAAA;AAE7C,WAAA,cAAc,IAAI;AAAA,MAChB,WAAW;AAAA,MACX,cAAc,CAAC,QAAQ,WAAW;AAAA,MAClC,OAAO;AAAA,IACR,CAAA,GAEM;AAAA,EACN,GAAA,CAAC,QAAQ,aAAa,aAAa,CAAC;AACzC;AAKO,SAAS,iBAA8B;AAC5C,QAAM,EAAC,UAAa,IAAA,UACd,GAAA,SAAS,UAAU,6BAA6B,GAChD,cAAc,eAAe,GAC7B,gBAAgB,iBAAiB;AAEvC,SAAO,QAAQ,MAAM;AACb,UAAA,cACJ,cAAc,IAAiB;AAAA,MAC7B,WAAW;AAAA,MACX,cAAc,CAAC,QAAQ,WAAW;AAAA,IACnC,CAAA,KAAK,kBAAkB,EAAC,QAAQ,SAAQ,eAAA,OAAA,SAAA,YAAa,OAAM,KAAK,CAAA;AAEnE,WAAA,cAAc,IAAI;AAAA,MAChB,WAAW;AAAA,MACX,cAAc,CAAC,QAAQ,WAAW;AAAA,MAClC,OAAO;AAAA,IACR,CAAA,GAEM;AAAA,EACN,GAAA,CAAC,QAAQ,aAAa,aAAa,CAAC;AACzC;AAKO,SAAS,kBAAgC;AAC9C,QAAM,SAAS,UAAU,6BAA6B,GAChD,gBAAgB,iBAAiB;AAEvC,SAAO,QAAQ,MAAM;AACb,UAAA,eACJ,cAAc,IAAkB;AAAA,MAC9B,WAAW;AAAA,MACX,cAAc,CAAC,MAAM;AAAA,IACtB,CAAA,KAAK,mBAAmB,EAAC,QAAO;AAEnC,WAAA,cAAc,IAAI;AAAA,MAChB,WAAW;AAAA,MACX,cAAc,CAAC,MAAM;AAAA,MACrB,OAAO;AAAA,IACR,CAAA,GAEM;AAAA,EAAA,GACN,CAAC,QAAQ,aAAa,CAAC;AAC5B;AAKO,SAAS,0BAAgD;AAC9D,QAAM,SAAS,UAAU,6BAA6B,GAChD,gBAAgB,iBAAiB;AAEvC,SAAO,QAAQ,MAAM;AACb,UAAA,uBACJ,cAAc,IAA0B;AAAA,MACtC,WAAW;AAAA,MACX,cAAc,CAAC,MAAM;AAAA,IACtB,CAAA,KAAK,2BAA2B,EAAC,QAAO;AAE3C,WAAA,cAAc,IAAI;AAAA,MAChB,WAAW;AAAA,MACX,cAAc,CAAC,MAAM;AAAA,MACrB,OAAO;AAAA,IACR,CAAA,GAEM;AAAA,EAAA,GACN,CAAC,QAAQ,aAAa,CAAC;AAC5B;AAKO,SAAS,mBAAkC;AAChD,QAAM,EAAC,WAAW,SAAQ,UAAU,GAC9B,SAAS,UAAU,GACnB,YAAY,aAAa,GACzB,gBAAgB,oBAChB,eAAe,mBACf,uBAAuB;AAE7B,SAAO,QAAQ,MAAM;AACb,UAAA,gBACJ,cAAc,IAAmB;AAAA,MAC/B,WAAW;AAAA,MACX,cAAc,CAAC,WAAW,sBAAsB,cAAc,QAAQ,IAAI;AAAA,IAC3E,CAAA,KACD,oBAAoB;AAAA,MAClB;AAAA,MACA;AAAA,MACA;AAAA,MACA,uBAAuB;AAAA,MACvB;AAAA,MACA;AAAA,IAAA,CACD;AAEH,WAAA,cAAc,IAAI;AAAA,MAChB,WAAW;AAAA,MACX,cAAc,CAAC,WAAW,sBAAsB,cAAc,QAAQ,IAAI;AAAA,MAC1E,OAAO;AAAA,IACR,CAAA,GAEM;AAAA,EAAA,GACN,CAAC,WAAW,sBAAsB,cAAc,eAAe,QAAQ,WAAW,IAAI,CAAC;AAC5F;AAGO,SAAS,2BAAkD;AAChE,QAAM,EAAC,MAAK,IAAI,YAAY,YACtB,gBAAgB;AAEtB,SAAO,QAAQ,MAAM;AACb,UAAA,wBACJ,cAAc,IAA2B;AAAA,MACvC,WAAW;AAAA,MACX,cAAc,CAAC,KAAK;AAAA,IACrB,CAAA,KAAK,4BAA4B,EAAC,OAAM;AAE3C,WAAA,cAAc,IAAI;AAAA,MAChB,WAAW;AAAA,MACX,cAAc,CAAC,KAAK;AAAA,MACpB,OAAO;AAAA,IACR,CAAA,GAEM;AAAA,EAAA,GACN,CAAC,OAAO,aAAa,CAAC;AAC3B;AAKO,SAAS,mBAAkC;AAC1C,QAAA;AAAA,IACJ,YAAY,EAAC,MAAK;AAAA,EAAA,IAChB,UAAU,GACR,gBAAgB,oBAChB,YAAY,aACZ,GAAA,wBAAwB;AAE9B,SAAO,QAAQ,MAAM;AACb,UAAA,gBACJ,cAAc,IAAmB;AAAA,MAC/B,WAAW;AAAA,MACX,cAAc,CAAC,OAAO,uBAAuB,SAAS;AAAA,IAAA,CACvD,KAAK,yBAAyB,EAAC,OAAO,uBAAuB,UAAU,CAAA;AAE1E,WAAA,cAAc,IAAI;AAAA,MAChB,WAAW;AAAA,MACX,cAAc,CAAC,OAAO,uBAAuB,SAAS;AAAA,MACtD,OAAO;AAAA,IACR,CAAA,GAEM;AAAA,KACN,CAAC,OAAO,uBAAuB,eAAe,SAAS,CAAC;AAC7D;AAKO,SAAS,kBAAgC;AAC9C,QAAM,SAAS,UAAU,6BAA6B,GAChD,gBAAgB,iBAAiB;AAEvC,SAAO,QAAQ,MAAM;AACb,UAAA,eACJ,cAAc,IAAkB;AAAA,MAC9B,WAAW;AAAA,MACX,cAAc,CAAC,MAAM;AAAA,IACtB,CAAA,KAAK,mBAAmB,EAAC,QAAO;AAEnC,WAAA,cAAc,IAAI;AAAA,MAChB,WAAW;AAAA,MACX,cAAc,CAAC,MAAM;AAAA,MACrB,OAAO;AAAA,IACR,CAAA,GAEM;AAAA,EAAA,GACN,CAAC,QAAQ,aAAa,CAAC;AAC5B;AAGO,SAAS,mBAAkC;AAC1C,QAAA,gBAAgB,oBAChB,YAAY,gBACZ,SAAS,UAAU,6BAA6B;AAEtD,SAAO,QAAQ,MAAM;AACb,UAAA,gBACJ,cAAc,IAAmB;AAAA,MAC/B,cAAc,CAAC,SAAS;AAAA,MACxB,WAAW;AAAA,IACZ,CAAA,KAAK,oBAAoB,EAAC,QAAO;AAEpC,WAAA,cAAc,IAAI;AAAA,MAChB,cAAc,CAAC,SAAS;AAAA,MACxB,WAAW;AAAA,MACX,OAAO;AAAA,IACR,CAAA,GAEM;AAAA,EACN,GAAA,CAAC,QAAQ,eAAe,SAAS,CAAC;AACvC;ACtPO,SAAS,oBAAoB,YAAwC;AACpE,QAAA,gBAAgB,oBAChB,CAAC,UAAU,WAAW,IAAI,SAA6B,CAAA,CAAE;AAE/D,SAAA,UAAU,MAAM;AACd,UAAM,eAAe,cAAc,iBAAiB,UAAU,EAAE,UAAU,WAAW;AACrF,WAAO,MAAM;AACX,mBAAa,YAAY;AAAA,IAAA;AAAA,EAE1B,GAAA,CAAC,YAAY,aAAa,CAAC,GAEvB;AACT;ACZO,SAAS,oBAAsC;AAC9C,QAAA,CAAC,UAAU,WAAW,IAAI,SAA2B,CAAA,CAAE,GACvD,gBAAgB;AAEtB,SAAA,UAAU,MAAM;AACd,UAAM,eAAe,cAAc,gBAAgB,UAAU,WAAW;AAExE,WAAO,MAAM;AACX,mBAAa,YAAY;AAAA,IAAA;AAAA,EAC3B,GACC,CAAC,aAAa,CAAC,GAEX;AACT;ACRA,MAAM,gBAAyC,EAAC,oBAAoB,CAAA,GAAI,WAAW,GAAI;AAMhF,SAAS,sBAAsBf,KAAqC;AACzE,QAAM,gBAAgB;AACf,SAAA;AAAA,IACL,MACE,cACG;AAAA,MACC;AAAA,MACA,EAAC,OAAOA,IAAE;AAAA,MACV,EAAC,KAAK,0BAAyB;AAAA,IAAA,EAEhC;AAAA,MACC;AAAA,QACE,CAAC,UAAqD;AAAA,UACpD,oBAAoB;AAAA,UACpB,WAAW;AAAA,QAAA;AAAA,MAEf;AAAA,MACA,UAAU,aAAa;AAAA,IACzB;AAAA,IACJ,CAAC,eAAeA,GAAE;AAAA,IAClB;AAAA,EAAA;AAEJ;AC9BO,MAAM,iBAAiB,CAAC;AAAA,EAC7B;AAAA,EACA;AAAA,EACA;AACF,MAIM;AACJ,QAAM,EAAC,GAAAqB,GAAC,IAAI,eAAe,GACrB,QAAQ,mBAAmB;AACjC,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,oBAAC,QAAK,cAAc,QAAQ,GAAG,WAAW,GAAG,eAAe,GAAG,cAAc,GAC3E,8BAACc,QAAK,EAAA,MAAM,GAAG,IAAG,MAAK,QAAO,UAC5B,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAAd;AAAA,QACA,SAAS,2CAA2C,SAAS;AAAA,QAC7D,SAAS,MAAM,mBAAmB,UAAU;AAAA,QAC5C,QAAQ,EAAC,UAAU,MAAM,kBAAkB,MAAK;AAAA,MAAA;AAAA,OAEpD,EACF,CAAA;AAAA,IACC,mBAAmB,IAAI,CAACR,kCACtB,cAAgC,EAAA,UAAAA,UAAA,GAAdA,UAAS,GAAyB,CACtD;AAAA,EACH,EAAA,CAAA;AAEJ,GAEM,eAAe,CAAC,EAAC,UAAAA,gBAA0C;AACzD,QAAA,SAAS,aAET,gBAAgB;AAAA,IACpB,CAAC,cACC,oBAAC,YAAY,EAAA,GAAG,WAAW,QAAQ,EAAC,IAAIA,UAAS,KAAK,MAAMA,UAAS,MAAK,GAAG,QAAO,QAAO;AAAA,IAG7F,CAACA,SAAQ;AAAA,EAAA;AAGX,SACG,oBAAA,MAAA,EAAK,IAAI,eAAe,QAAQ,GAAsB,WAAQ,KAAI,UAAU,GAC3E,UAAC,oBAAA,MAAA,EAAK,OAAM,UAAS,KAAK,GACxB,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAO;AAAA,MACP,OAAO,EAAC,OAAO,aAAa,MAAMA,UAAS,IAAG;AAAA,MAC9C,YAAY,OAAO,IAAIA,UAAS,KAAK;AAAA,IAAA;AAAA,EACvC,EAAA,CACF,EAPuC,GAAAA,UAAS,GAQlD;AAEJ,GClDM,oBAAmC;AAAA,EACvC,UAAU;AAAA,EACV,QAAQ;AAAA,EACR,WAAW;AAAA,EACX,gBAAgB;AAClB,GACM,qBAAoC;AAAA,EACxC,YAAY;AAAA,EACZ,UAAU;AAAA,EACV,SAAS;AAAA,EACT,WAAW;AAAA,EACX,gBAAgB;AAClB,GACM,sBAAqC,EAAC,QAAQ,UAEvC,iBAAiB,CAAC,EAAC,OAAO,WAAW,aAAa,SAAgC;AAC7F,QAAM4L,WAAU,cAAc,SACxB,EAAC,GAAApL,GAAA,IAAK;AAER,SAAA,aAEC,oBAAA,MAAA,EAAK,MAAK,WAAU,SAAS,CAAC,GAAG,GAAG,CAAC,GAAG,QAAM,IAAC,QAAQ,GAAG,cAAc,GACvE,UAAA,qBAAC,MAAK,EAAA,SAAS,GAAG,KAAK,CAAC,GAAG,GAAG,CAAC,GAC7B,UAAA;AAAA,IAAA,qBAAC,MAAK,EAAA,KAAK,CAAC,GAAG,CAAC,GAAG,OAAM,UAAS,OAAO,EAAC,YAAYoL,WAAU,WAAW,SACzE,GAAA,UAAA;AAAA,MAAC,oBAAAtK,QAAA,EACC,UAAC,oBAAA,oBAAA,CAAmB,CAAA,GACtB;AAAA,0BACCA,QAAK,EAAA,MAAM,GACT,UAAEd,GAAA,iDAAiD,SAAS,cAAc;AAAA,QACzE,SAAS,MAAM,mBAAmB,UAAU;AAAA,QAC5C,UAAU,MAAM;AAAA,MACjB,CAAA,GACH;AAAA,IAAA,GACF;AAAA,IACCoL,YACE,oBAAA,MAAA,EAAK,sBAAoB,IAAC,QAAM,IAAC,QAAQ,GAAG,OAAO,oBAClD,8BAAC,MAAK,EAAA,OAAM,UAAS,SAAQ,UAAS,OAAO,qBAC3C,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,KAAK,GAAG,MAAM,GAAG;AAAA,QACjB,OAAO;AAAA,QACP,KAAKpL,GAAE,mCAAmC;AAAA,QAC1C,gBAAe;AAAA,MAAA;AAAA,OAEnB,EACF,CAAA;AAAA,EAEJ,EAAA,CAAA,EACF,CAAA,IAKD,oBAAA,MAAA,EAAK,UAAU,CAAC,GAAG,GAAG,CAAC,GAAG,UAAU,CAAC,GAAG,GAAG,GAAG,CAAC,GAC9C,+BAAC,MAAK,EAAA,SAAS,GAAG,KAAK,GACrB,UAAA;AAAA,IAAC,oBAAA,MAAA,EAAK,OAAO,EAAC,YAAYoL,WAAU,WAAW,SAAW,GAAA,OAAM,UAC9D,UAAA,oBAACtK,QACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAAd;AAAA,QACA,SAAS,wDAAwD,SAAS;AAAA,QAC1E,SAAS,MAAM,mBAAmB,UAAU;AAAA,QAC5C,QAAQ,EAAC,UAAU,MAAM,iBAAgB;AAAA,MAAA;AAAA,OAE7C,EACF,CAAA;AAAA,IACCoL,YACE,oBAAA,MAAA,EAAK,sBAAoB,IAAC,QAAM,IAAC,QAAQ,GAAG,OAAO,oBAClD,8BAAC,MAAK,EAAA,OAAM,UAAS,SAAQ,UAAS,OAAO,qBAC3C,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,KAAK,GAAG,MAAM,GAAG;AAAA,QACjB,OAAO;AAAA,QACP,KAAKpL,GAAE,2CAA2C;AAAA,QAClD,gBAAe;AAAA,MAAA;AAAA,OAEnB,EACF,CAAA;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ;ACtEO,SAAS,kBAAkB;AAAA,EAChC;AAAA,EACA;AAAA,EACA,aAAa;AAAA,EACb;AAAA,EACA;AACF,GAAqB;AACb,QAAA,EAAC,WAAW,mBAAA,IAAsB,sBAAsB,MAAM,GAAG,GAEjE,qBAAqB,QAAQ,MAAM;AACvC,UAAM,SAAS,mBAAmB;AAAA,MAChC,CAAC,KAAK,QAAS,IAAI,IAAI,WAAW,SAAS,IAAI,IAAI,OAAO,IAAI,IAAI,MAAM,CAAC,CAAC,IAAI;AAAA,MAC9E,CAAC;AAAA,IAAA;AAGI,WAAA,mBAAmB,OAAO,CAAC,QAAQ,CAAC,OAAO,SAAS,IAAI,GAAG,CAAC;AAAA,EAClE,GAAA,CAAC,kBAAkB,CAAC,GAEjB,aAAa,mBAAmB,SAAS,GAEzC,EAAC,GAAAA,OAAK;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,sBAAsB;AAAA,MACtB,QAAQ;AAAA,QACN,cAAc;AAAA,UACZ,SAAS;AAAA,UACT,MAAMA,GAAE,0CAA0C;AAAA,QACpD;AAAA,QACA,eAAe;AAAA,UACb,UAAU;AAAA,UACV,MAAM;AAAA,UACN,SAAS;AAAA,UACT,SAAS;AAAA,UACT,MAAMA,GAAE,0CAA0C;AAAA,QACpD;AAAA,MACF;AAAA,MACA,QAAQA,GAAE,qCAAqC,EAAC,SAAS,WAAU;AAAA,MACnE,IAAG;AAAA,MACH,gBAAgB;AAAA,MAChB;AAAA,MACA,OAAO;AAAA,MAEN,UAAA,YACE,oBAAA,KAAA,EAAI,SAAS,GACZ,8BAAC,cAAa,EAAA,UAAQ,GAAC,CAAA,EACzB,CAAA,IAEA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,UAAU,aAAa,CAAC,GAAG,GAAG,CAAC,IAAI;AAAA,UACnC,UAAU,aAAa,CAAC,GAAG,GAAG,GAAG,CAAC,IAAI;AAAA,UACtC,OAAO;AAAA,UAEP,UAAA;AAAA,YAAC,oBAAA,gBAAA,EAAe,OAAc,WAAsB,WAAwB,CAAA;AAAA,YAE3E,cACC;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC;AAAA,gBACA,oBAAoB;AAAA,gBACpB;AAAA,cAAA;AAAA,YACF;AAAA,UAAA;AAAA,QAAA;AAAA,MAEJ;AAAA,IAAA;AAAA,EAAA;AAIR;AC/EA,MAAM,qBAAqB,EAAC,QAAQ,IAAM,WAAW,QAAO;AAErD,SAAS,UAAU;AAAA,EACxB;AAAA,EACA,SAAS;AAAA,EACT;AACF,GAIG;AACK,QAAA,oBAAoB,aAAa,YAAY,SAC7C,oBAAoB,aAAa,YAAY,WAE7C,EAAC,GAAAA,GAAC,IAAI,eAAe;AAEzB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM,SAAS,UAAU;AAAA,UACzB,MAAM,SAAS,YAAY;AAAA,QAAA;AAAA,MAC7B;AAAA,MAEF,IAAG;AAAA,MACH,2BACG,MACC,EAAA,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAMA,GAAE,yCAAyC;AAAA,YACjD,MAAM;AAAA,YACN,SAAS,MAAM;AACJ,uBAAA,EAAC,MAAM,YAAA,CAAY;AAAA,YAC9B;AAAA,UAAA;AAAA,QACF;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAMA,GAAE,qCAAqC;AAAA,YAC7C,MAAM;AAAA,YACN,MAAK;AAAA,YACL,SAAS,MAAM;AACJ,uBAAA,EAAC,MAAM,SAAA,CAAS;AAAA,YAC3B;AAAA,UAAA;AAAA,QACF;AAAA,MAAA,GACF;AAAA,MAEF,SAAS;AAAA,IAAA;AAAA,EAAA;AAGf;ACvCO,SAAS,iBAAiB,EAAC,OAAO,WAAW,WAA4B;AACxE,QAAA,EAAC,WAAW,mBAAA,IAAsB,sBAAsB,MAAM,GAAG,GAEjE,qBAAqB,QAAQ,MAAM;AACvC,UAAM,SAAS,mBAAmB;AAAA,MAChC,CAAC,KAAK,QAAS,IAAI,IAAI,WAAW,SAAS,IAAI,IAAI,OAAO,IAAI,IAAI,MAAM,CAAC,CAAC,IAAI;AAAA,MAC9E,CAAC;AAAA,IAAA;AAGI,WAAA,mBAAmB,OAAO,CAAC,QAAQ,CAAC,OAAO,SAAS,IAAI,GAAG,CAAC;AAAA,EAAA,GAClE,CAAC,kBAAkB,CAAC,GAEjB,EAAC,GAAAA,OAAK,eAAe;AAGzB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,sBAAoB;AAAA,MACpB,QAAQA,GAAE,0CAA0C,EAAC,SAAS,WAAU;AAAA,MACxE,IAAG;AAAA,MACH,gBAAgB;AAAA,MAChB;AAAA,MACA,OAAO;AAAA,MAEN,UACC,YAAA,oBAAC,cAAa,EAAA,UAAQ,GAAC,CAAA,IAEvB;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA,oBAAoB;AAAA,UACpB;AAAA,QAAA;AAAA,MACF;AAAA,IAAA;AAAA,EAAA;AAIR;AC7CA,MAAM,aAA2C;AAAA;AAAA,EAE/C,aAAa;AAAA,IACX,OAAO;AAAA,EACT;AAAA,EACA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA,EACA,aAAa;AAAA,IACX,OAAO;AAAA,EACT;AAAA,EACA,4BAA4B;AAAA,IAC1B,OAAO;AAAA,EACT;AAAA,EACA,aAAa;AAAA,IACX,OAAO;AAAA,EACT;AAAA,EACA,iBAAiB;AAAA,IACf,OAAO;AAAA,EACT;AAAA,EACA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA,EACA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA,EACA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA;AAAA,EAEA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA,EACA,gBAAgB;AAAA,IACd,OAAO;AAAA,EACT;AAAA,EACA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA,EACA,aAAa;AAAA,IACX,OAAO;AAAA,EACT;AAAA,EACA,aAAa;AAAA,IACX,OAAO;AAAA,EACT;AAAA,EACA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA,EACA,aAAa;AAAA,IACX,OAAO;AAAA,EACT;AAAA;AAAA,EAEA,mBAAmB;AAAA,IACjB,OAAO;AAAA,EACT;AAAA,EACA,aAAa;AAAA,IACX,OAAO;AAAA,EACT;AAAA,EACA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA,EACA,aAAa;AAAA,IACX,OAAO;AAAA,EACT;AAAA,EACA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA,EACA,mBAAmB;AAAA,IACjB,OAAO;AAAA,EACT;AAAA;AAAA,EAEA,qEAAqE;AAAA,IACnE,OAAO;AAAA,EACT;AAAA,EACA,4BAA4B;AAAA,IAC1B,OAAO;AAAA,EACT;AAAA,EACA,cAAc;AAAA,IACZ,OAAO;AAAA,EACT;AAAA,EACA,mBAAmB;AAAA,IACjB,OAAO;AAAA,EACT;AAAA,EACA,iBAAiB;AAAA,IACf,OAAO;AAAA,EACT;AAAA,EACA,YAAY;AAAA,IACV,OAAO;AAAA,EACT;AAAA,EACA,YAAY;AAAA,IACV,OAAO;AAAA,EACT;AAAA,EACA,mBAAmB;AAAA,IACjB,OAAO;AAAA,EACT;AAAA,EACA,mBAAmB;AAAA,IACjB,OAAO;AAAA,EACT;AAAA,EACA,YAAY;AAAA,IACV,OAAO;AAAA,EACT;AAAA,EACA,mBAAmB;AAAA,IACjB,OAAO;AAAA,EACT;AAAA,EACA,uBAAuB;AAAA,IACrB,OAAO;AAAA,EACT;AAAA,EACA,+BAA+B;AAAA,IAC7B,OAAO;AAAA,EACT;AAAA,EACA,4BAA4B;AAAA,IAC1B,OAAO;AAAA,EACT;AACF;AAEA,SAAS,+BAA+B,UAA0B;AAC1D,QAAA,OAAO,SAAS,QAAQ,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,CAAC;AAE7C,SAAA,KAAK,OAAO,CAAC,EAAE,gBAAgB,KAAK,MAAM,CAAC;AACpD;AAEO,SAAS,eAAe,UAA0B;AACvD,SAAI,iCAAa,QACR,IAAA,WAAW,QAAQ,EAAE,QAGvB,+BAA+B,QAAQ;AAChD;AC9FA,MAAM,kBAAkB,OAAO;AAAA;AAAA;AAAA,GAMzB,aAAa,OAAO,IAAI,KAExB6P,eAAa,OAAO,IAAI;AAAA,IAC1B,CAAC1Q,WACDA,OAAM,cACN;AAAA;AAAA;AAAA,KAGC;AAAA,GAGC,YAAY,OAAOyO,QAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAuB3B,CAACzO,WACDA,OAAM,cACN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAQI,eAAe;AAAA;AAAA;AAAA;AAAA,QAIf,UAAU;AAAA;AAAA;AAAA;AAAA,KAIb;AAAA;AAAA,IAED,CAACA,WACD,CAACA,OAAM,cACP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAYC;AAAA,GAGC,WAAW,OAAO2B,MAAI;AAAA;AAAA,GAItB,kBAAkB;AAAA,EACtB,UAAU;AACZ,GAEM,mBAAmB,EAAC,YAAY,EAAC,GACjC,qBAAqB,EAAC,UAAU,EAAC,GACjC,2BAA2B;AAAA,EAC/B,QAAQ;AAAA,EACR,WAAW;AAAA,EACX,cAAc;AAChB,GAEa,WAAW,CAAC3B,WAAoB;AACrC,QAAA,kBAAkB,UAAU,6BAA6B,GACzD,QAAQ,SAAS,GACjB,aAAa,OAAqB,GAClC,CAAC,iBAAiB,kBAAkB,IAAI,SAAS,EAAK,GACtD,CAAC,kBAAkB,mBAAmB,IAAI,SAAS,EAAK,GACxD,CAAC,YAAY,aAAa,IAAI,SAAS,EAAK,GAC5C,CAAC,QAAQ,SAAS,IAAI,SAAS,EAAK,GACpC,EAAC,OAAO,SAAS,YAAY,kBAAkB,YAAY,aAAYA,QACvE,EAAC,kBAAkB,KAAK,UAAU,MAAM,eAAc,OACtD,gBAAgB,gBAAgB,YAAY,EAAC,mBAAmB,GAAK,CAAA,GACrE,oBAAoB,eAAe,QAAQ,GAE3C,aAAa,iBAAiB,EAAC,aAAa,SAAS,uBAAuB,GAAE,GAC9E,gBAAgB,sBAAsB,MAAM,UAAU,GAEtD,eAAe,oBAAoB,IAAI,SAAS,IAEhD,EAAC,GAAAa,OAAK,eAAe,GACrB,sBAAsB,YAAY,MAAM;AAC5C,wBAAoB,EAAI;AAAA,EAAA,GACvB,CAAE,CAAA,GAEC,oBAAoB;AAAA,IACxB,CAAC,UAAiB;AAChB,YAAM,KAAK;AAAA,QACT,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,OAAOA,GAAE,4CAA4C;AAAA,QACrD,aAAa,MAAM;AAAA,MAAA,CACpB;AAAA,IACH;AAAA,IACA,CAACA,IAAG,KAAK;AAAA,EAAA,GAGL,sBAAsB,YAAY,MAAM;AAC5C,UAAM,KAAK;AAAA,MACT,QAAQ;AAAA,MACR,OAAOA,GAAE,gDAAgD;AAAA,IAAA,CAC1D;AAAA,EAAA,GACA,CAACA,IAAG,KAAK,CAAC,GAEP,oBAAoB,YAAY,MAAM;AAC5B,kBAAA,EAAI,GAElB,WAAW,UAAU,gBAAgB,WAAW,OAAO,MAAM,GAAG,EAAE,UAAU;AAAA,MAC1E,MAAM,MAAM;AACI,sBAAA,EAAK,GACnB,oBAAmB,QAAA,iBAAA,MAAM,MACzB,oBAAoB,EAAK,GACzB,oBAAoB;AAAA,MACtB;AAAA,MACA,OAAO,CAAC,QAAe;AACP,sBAAA,EAAK,GACnB,kBAAkB,GAAG,GAErB,QAAQ,MAAM,0BAA0B,GAAG;AAAA,MAC7C;AAAA,IAAA,CACD;AAAA,EAAA,GACA;AAAA,IACD,MAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA,gBAAgB;AAAA,EAAA,CACjB,GAEK,oBAAoB,MAAM;AACX,uBAAA,EAAK,GACxB,oBAAoB,EAAK;AAAA,EAC3B,GAEM,0BAA0B,MAAM;AACpC,uBAAmB,EAAI;AAAA,EACzB,GAEM,mBAAmB,MAAM;AAC7B,cAAU,CAAC,MAAM;AAAA,EAAA,GAGb,mBAAmB,CAAC,WAA4B;AAChD,WAAO,SAAS,YAClB,oBAAA,GAGE,OAAO,SAAS,eAClB;EAAwB,GAItB,cAAc,QAAQ,MAExB,mBACG,oBAAA,kBAAA,EAAiB,WAAU,QAAO,OAAc,SAAS,kBAAmB,CAAA,GAGhF,CAAC,OAAO,eAAe,CAAC,GAErB,eAAe,QAAQ,MAEzB,oBACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,WAAU;AAAA,MACV;AAAA,MACA,SAAS;AAAA,MACT,UAAU;AAAA,MACV;AAAA,IAAA;AAAA,KAIL,CAAC,OAAO,mBAAmB,YAAY,gBAAgB,CAAC;AAE3D,SAAI,WAEC,qBAAA,MAAA,EAAK,eAAe,GAAG,OAAO,iBAC7B,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,KAAK;AAAA,QACL,OAAO;AAAA,UACL,UAAU;AAAA,UACV,qBAAqB;AAAA,UACrB,SAAS,aAAa,MAAM;AAAA,QAC9B;AAAA,QAEA,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA,MAAK;AAAA,cACL,SAAS;AAAA,cACT,WAAS;AAAA,cACT;AAAA,cACA,UAAU;AAAA,cACV,QAAQ;AAAA,cAER,+BAAC,MAAK,EAAA,KAAK,GAAG,MAAM,GAAG,OAAM,UAC3B,UAAA;AAAA,gBAAC,oBAAA,MAAA,EAAK,IAAI,iBAAiB,SAAS,GAAG,MAAK,eAAc,QAAQ,GAChE,UAAA,oBAACc,UAAK,OAAK,IAAC,MAAM,GAAG,OAAO,kBAC1B,UAAC,oBAAA,cAAA,EAAa,GAChB,EACF,CAAA;AAAA,gBACA,oBAACA,QAAK,EAAA,MAAM,GAAG,OAAM,QAAO,cAAa,YAAW,OAAO,oBACxD,UACH,iBAAA,CAAA;AAAA,cAAA,GACF;AAAA,YAAA;AAAA,UACF;AAAA,UACA,oBAAC,QAAK,SAAQ,YAAW,OAAM,UAAS,cAAc,GAAG,OAAO,0BAC9D,UAAA;AAAA,YAAC8M;AAAAA,YAAA;AAAA,cACC,MAAK;AAAA,cACL,UAAU;AAAA,cACV,SAAS;AAAA,cACT,SAAS;AAAA,cACT,MAAM,SAAS,gBAAgB;AAAA,YAAA;AAAA,UAAA,GAEnC;AAAA,QAAA;AAAA,MAAA;AAAA,IACF;AAAA,IACC,UAEG,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAA,qBAAC,QAAK,WAAW,GAAG,SAAS,GAAG,KAAK,GACnC,UAAA;AAAA,QAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,UAAC,oBAAA9M,QAAA,EAAK,MAAM,GAAG,OAAK,IAAC,QAAO,UACzB,UAAEd,GAAA,0CAA0C,EAC/C,CAAA;AAAA,8BACCc,QAAK,EAAA,MAAM,GAAG,OAAK,IACjB,UACH,eAAA;AAAA,QAAA,GACF;AAAA,QACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAC,oBAAAA,QAAA,EAAK,MAAM,GAAG,OAAK,IAAC,QAAO,UACzB,UAAEd,GAAA,0CAA0C,EAC/C,CAAA;AAAA,8BACCc,QAAK,EAAA,MAAM,GAAG,OAAK,IACjB,UACH,mBAAA;AAAA,QAAA,GACF;AAAA,QACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAC,oBAAAA,QAAA,EAAK,MAAM,GAAG,OAAK,IAAC,QAAO,UACzB,UAAEd,GAAA,gDAAgD,EACrD,CAAA;AAAA,8BACCc,QAAK,EAAA,MAAM,GAAG,OAAK,IACjB,UACH,eAAA;AAAA,QAAA,GACF;AAAA,MAAA,GACF;AAAA,MACC,qBAAA,OAAA,EAAM,OAAO,GAAG,WAAW,GAC1B,UAAA;AAAA,QAAA;AAAA,UAAC8M;AAAAA,UAAA;AAAA,YACC,UAAU;AAAA,YACV,MAAK;AAAA,YACL,MAAK;AAAA,YACL,MAAM5N,GAAE,sDAAsD;AAAA,YAC9D,SAAS;AAAA,YACT,MAAM;AAAA,UAAA;AAAA,QACR;AAAA,QAEA;AAAA,UAAC4N;AAAAA,UAAA;AAAA,YACC,UAAU;AAAA,YACV,MAAK;AAAA,YACL,MAAK;AAAA,YACL,MAAM5N,GAAE,kDAAkD;AAAA,YAC1D,MAAM;AAAA,YACN,UAAU;AAAA,YACV,OAAOA;AAAA,cACL,aACI,mFACA;AAAA,YACN;AAAA,YACA,SAAS;AAAA,UAAA;AAAA,QACX;AAAA,MAAA,GACF;AAAA,IAAA,GACF;AAAA,IAED,eAAe;AAAA,EAAA,EAAA,CAClB,IAKF;AAAA,IAAC6P;AAAAA,IAAA;AAAA,MACC;AAAA,MACA,eAAe;AAAA,MACf,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,UAAU;AAAA,MACV;AAAA,MACA,iBAAc;AAAA,MAEd,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,SAAS;AAAA,YACT,KAAK;AAAA,YACL,WAAS;AAAA,YACT,UAAU;AAAA,YACV,OAAO;AAAA,cACL,UAAU;AAAA,cACV,qBAAqB;AAAA,cACrB,SAAS,aAAa,MAAM;AAAA,YAC9B;AAAA,YAEA,UAAA;AAAA,cAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC;AAAA,kBACA,MAAK;AAAA,kBACL,WAAS;AAAA,kBACT;AAAA,kBACA,SAAS;AAAA,kBACT;AAAA,kBACA,OAAO7P,GAAE,yDAAyD;AAAA,oBAChE,UAAU;AAAA,kBAAA,CACX;AAAA,kBACD;AAAA,kBACA,QAAQ;AAAA,kBAER,UAAA;AAAA,oBAAC;AAAA,oBAAA;AAAA,sBACC,KAAK;AAAA,sBACL,MAAM;AAAA,sBACN,cAAc;AAAA,sBACd,OAAM;AAAA,sBACN;AAAA,sBACA;AAAA,sBACA,WAAS;AAAA,sBAET,UAAA;AAAA,wBAAA;AAAA,0BAAC;AAAA,0BAAA;AAAA,4BACC,IAAI;AAAA,4BACJ,SAAS;AAAA,4BACT,MAAK;AAAA,4BACL,QAAQ;AAAA,4BACR,OAAO;AAAA,4BAEP,UAAA,oBAACc,UAAK,OAAK,IAAC,MAAM,GAChB,UAAA,oBAAC,gBAAa,EAChB,CAAA;AAAA,0BAAA;AAAA,wBACF;AAAA,wBACC,eACE,oBAAA,SAAA,EAAQ,SAAS,kBAChB,8BAACA,QAAK,EAAA,MAAM,GAAG,OAAM,QAAO,cAAa,YAAW,OAAO,oBACxD,2BACH,CAAA,GACF;AAAA,wBAGD,CAAC,eACC,oBAAAA,QAAA,EAAK,MAAM,GAAG,OAAM,QAAO,cAAa,YAAW,OAAO,oBACxD,UACH,iBAAA,CAAA;AAAA,sBAAA;AAAA,oBAAA;AAAA,kBAEJ;AAAA,gBAAA;AAAA,cACF;AAAA,cACA,oBAAC,YAAW,EAAA,OAAM,UAChB,UAAA,oBAACA,QAAK,EAAA,MAAM,GAAG,OAAK,IACjB,UAAA,cACH,CAAA,GACF;AAAA,kCACC,YAAW,EAAA,OAAM,UAChB,UAAA,oBAAC,OACC,UAAC,oBAAA,UAAA,EAAS,MAAM,GAAG,OAAK,IAAC,cAAa,YACnC,UAAA,kBAAA,CACH,EACF,CAAA,GACF;AAAA,cACC,oBAAA,YAAA,EAAW,OAAM,UAChB,8BAACA,QAAK,EAAA,IAAG,QAAO,MAAM,GAAG,OAAK,IAAC,UAAU,YACtC,wBACH,CAAA,GACF;AAAA,cACA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,SAAQ;AAAA,kBACR,OAAM;AAAA,kBACN,UAAU;AAAA,kBACV,UAAU;AAAA,kBACV,OAAO;AAAA,kBAEP,8BAAC,WAAU,EAAA,QAAQ,IAAO,YAAY,IAAO,UAAU,iBAAkB,CAAA;AAAA,gBAAA;AAAA,cAC3E;AAAA,YAAA;AAAA,UAAA;AAAA,QACF;AAAA,QACC,eAAe;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGtB,GC3aM,kBAAkB,EAAC,aAAa,SAAA,GAChC,cAAc,EAAC,qBAAqB;AAEnC,SAAS,aAAa3B,QAAc;AAEzC,QAAM,WADa,cAAc,IACH,GACxB,EAAC,QAAQ,SAAS,YAAY,kBAAkB,gBAAgB,cAAaA,QAE7E,EAAC,GAAAa,GAAA,IAAK;AACZ,8BACG,KACC,EAAA,UAAA;AAAA,IAAA,oBAAC,QAAK,cAAY,IAAC,eAAe,GAAG,cAAc,GAChD,UAAA,WACE,oBAAA,MAAA,EAAK,OAAO,aACX,UAAA,oBAAC,KAAI,EAAA,MAAM,GAAG,aAAa,GACzB,UAAC,oBAAAc,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAEd,GAAA,8CAA8C,EACnD,CAAA,EACF,CAAA,GACF,IAEA,qBAAC,QAAK,KAAK,GAAG,OAAO,aACnB,UAAA;AAAA,MAAA,oBAAC,OAAI,MAAM,GAAG,OAAO,iBACnB,8BAACc,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAEd,GAAA,8CAA8C,EACnD,CAAA,GACF;AAAA,MACC,oBAAA,KAAA,EAAI,MAAM,GACT,8BAACc,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAEd,GAAA,0CAA0C,EAC/C,CAAA,GACF;AAAA,MACC,oBAAA,KAAA,EAAI,MAAM,GACT,8BAACc,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAEd,GAAA,0CAA0C,EAC/C,CAAA,GACF;AAAA,MACC,oBAAA,KAAA,EAAI,MAAM,GACT,8BAACc,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAEd,GAAA,gDAAgD,EACrD,CAAA,GACF;AAAA,IAAA,EAAA,CACF,EAEJ,CAAA;AAAA,yBACC,OACE,EAAA,UAAA;AAAA,MAAA,aAAa,OAAO,WAAW,yBAC7B,KAAI,EAAA,YAAY,GAAG,eAAe,GACjC,UAAC,oBAAA,MAAA,EAAK,SAAQ,UACZ,UAAA,oBAAC,WAAQ,OAAK,IAAC,GACjB,EACF,CAAA;AAAA,MAED,OAAO,IAAI,CAAC,UACX;AAAA,QAAC;AAAA,QAAA;AAAA,UAEC;AAAA,UACA;AAAA,UACA,YAAY,eAAe,KAAK,CAAC,aAAa,SAAS,QAAQ,MAAM,GAAG;AAAA,UACxE;AAAA,UACA;AAAA,UACA;AAAA,QAAA;AAAA,QANK,MAAM;AAAA,MAAA,CAQd;AAAA,IAAA,GACH;AAAA,EACF,EAAA,CAAA;AAEJ;ACtDA,MAAM,MACJ,OAAO,SAAW,OAAe,CAAC,OAAO,mBACrC,IACA,KAAK,MAAM,OAAO,gBAAgB,GAElC8C,UAAQ,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAWfoK,cAAY,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA,GAMvB/I,SAAO,OAAO;AAAA;AAAA;AAAA,GAId,gBAAgB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAkBvBA,MAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAMJA,MAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQG,aAAa,KAAK,SAAoBhF,QAAmB;AACpE,QAAM,kBAAkB,UAAU,6BAA6B,GACzD,QAAQ,SAAA,GACR,aAAa,OAAA,GACb,EAAC,OAAO,SAAS,YAAY,kBAAkB,eAAcA,QAC7D,CAAC,iBAAiB,kBAAkB,IAAI,SAAS,EAAK,GACtD,CAAC,kBAAkB,mBAAmB,IAAI,SAAS,EAAK,GACxD,CAAC,YAAY,aAAa,IAAI,SAAS,EAAK,GAC5C,EAAC,GAAAa,GAAA,IAAK;AAEZ,YAAU,MACD,MAAM;AACP,eAAW,WACb,WAAW,QAAQ,YAAY;AAAA,EAEnC,GACC,CAAE,CAAA;AAEC,QAAA,sBAAsB,YAAY,MAAM;AAC5C,wBAAoB,EAAI;AAAA,KACvB,CAAC,mBAAmB,CAAC,GAElB,oBAAoB,YAAY,MAAM;AACvB,uBAAA,EAAK,GACxB,oBAAoB,EAAK;AAAA,EAAA,GACxB,CAAC,oBAAoB,mBAAmB,CAAC,GAEtC,0BAA0B,YAAY,MAAM;AAChD,uBAAmB,EAAI;AAAA,EACtB,GAAA,CAAC,kBAAkB,CAAC,GAEjB,oBAAoB;AAAA,IACxB,CAAC,UAA6B;AAC5B,YAAM,KAAK;AAAA,QACT,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,OAAOA,GAAE,6CAA6C;AAAA,QACtD,aAAa,MAAM;AAAA,MAAA,CACpB;AAAA,IACH;AAAA,IACA,CAACA,IAAG,KAAK;AAAA,EAAA,GAGL,sBAAsB,YAAY,MAAM;AAC5C,UAAM,KAAK;AAAA,MACT,QAAQ;AAAA,MACR,OAAOA,GAAE,iDAAiD;AAAA,IAAA,CAC3D;AAAA,EAAA,GACA,CAACA,IAAG,KAAK,CAAC,GAEP,oBAAoB,YAAY,MAAM;AAC5B,kBAAA,EAAI,GAElB,WAAW,UAAU,gBAAgB,WAAW,OAAO,MAAM,GAAG,EAAE,UAAU;AAAA,MAC1E,MAAM,MAAM;AACI,sBAAA,EAAK,GACnB,iBAAiB,MAAM,GAAG,GAC1B,oBAAoB,EAAK,GACzB,oBAAoB;AAAA,MACtB;AAAA,MACA,OAAO,CAAC,QAAe;AACP,sBAAA,EAAK,GACnB,kBAAkB,GAAG,GAErB,QAAQ,MAAM,0BAA0B,GAAG;AAAA,MAC7C;AAAA,IAAA,CACD;AAAA,EAAA,GACA;AAAA,IACD,MAAM;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA,gBAAgB;AAAA,EAAA,CACjB,GAEK,mBAAmB;AAAA,IACvB,CAAC,WAA4B;AACvB,aAAO,SAAS,YAClB,oBAAA,GAGE,OAAO,SAAS,eAClB;IAEJ;AAAA,IACA,CAAC,qBAAqB,uBAAuB;AAAA,EAAA,GAGzC,cAAc,QAAQ,MAExB,mBACG,oBAAA,kBAAA,EAAiB,WAAU,QAAO,OAAc,SAAS,mBAAmB,GAGhF,CAAC,OAAO,mBAAmB,eAAe,CAAC,GAExC,eAAe,QAAQ,MAEzB,oBACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,WAAU;AAAA,MACV;AAAA,MACA,SAAS;AAAA,MACT,UAAU;AAAA,MACV;AAAA,IAAA;AAAA,EAAA,GAIL,CAAC,OAAO,mBAAmB,mBAAmB,YAAY,gBAAgB,CAAC,GAGxE,EAAC,kBAAkB,KAAK,IAAG,IAAI,OAC/B,OAAO,MAAM,KAAK,IAAI,GAAG,GAAG,GAI5B,WAAW,IAAI,SAAS,MAAM,IAChC,GAAG,GAAG,MAAM,IAAI,oBAChB,GAAG,GAAG,MAAM,IAAI;AAEpB,8BACGmE,QACC,EAAA,UAAA;AAAA,IAAA;AAAA,MAACyJ;AAAAA,MAAA;AAAA,QACC,UAAU;AAAA,QACV,UAAU;AAAA,QACV,WAAS;AAAA,QACT,MAAK;AAAA,QACL;AAAA,QACA,SAAS;AAAA,QACT,OAAO,EAAC,SAAS,EAAC;AAAA,QAElB,UAAA,qBAACV,aAAU,EAAA,sBAAoB,IAC7B,UAAA;AAAA,UAAA,oBAACpK,WAAM,KAAK,kBAAkB,KAAK,UAAU,SAAkB,WAAS,KAAK;AAAA,UAC5E,kCAAe,cAAa,EAAA;AAAA,QAAA,GAC/B;AAAA,MAAA;AAAA,IACF;AAAA,wBACC,eACC,EAAA,UAAA,oBAAC,aAAU,YAAwB,UAAU,iBAAkB,CAAA,GACjE;AAAA,IACC,eAAe;AAAA,EAClB,EAAA,CAAA;AAEJ,CAAC,GCrNK,YAAY,OAAO,IAAI;AAAA;AAAA;AAItB,SAAS,cAAc3D,QAA2B;AACvD,QAAM,EAAC,WAAW,QAAQ,gBAAgB,aAAa,gBAAgB,iBAAoB,IAAAA;AAEzF,SAAA,qBAAC,KAAI,EAAA,SAAS,GACZ,UAAA;AAAA,IAAA,oBAAC,aAAU,KAAK,GACb,UAAO,OAAA,IAAI,CAAC,UACX;AAAA,MAAC;AAAA,MAAA;AAAA,QAEC;AAAA,QACA,YAAY,eAAe,KAAK,CAAC,aAAa,SAAS,QAAQ,MAAM,GAAG;AAAA,QACxE,SAAS;AAAA,QACT,YAAY;AAAA,QACZ;AAAA,MAAA;AAAA,MALK,MAAM;AAAA,IAOd,CAAA,GACH;AAAA,IACC,aAAa,OAAO,WAAW,KAC7B,oBAAA,MAAA,EAAK,SAAQ,UACZ,UAAC,oBAAA,SAAA,EAAQ,OAAK,GAAC,CAAA,GACjB;AAAA,IAED,CAAC,aAAa,OAAO,WAAW,yBAAM2B,QAAK,EAAA,OAAM,UAAS,OAAK,GAAC,CAAA;AAAA,EACnE,EAAA,CAAA;AAEJ;AClBA,MAAM,WAAW,KACX,mBAAmB,qBACnB,kBAAkB,oBAElB,mBAAmB,CAAC,gBAAwB;AAChD,QAAM,kBAAkB,CAAC,WAAW,WAAW,SAAS,GAGlD,iBAFc,YAAY,MAAM,GAAG,EAAE,IAAI,CAAC,WAAW,OAAO,KAAM,CAAA,EAEZ;AAAA,IAC1D,CAAC,aAAsC,gBAEjC,gBAAgB,SAAS,WAAW,IAC/B;AAAA,MACL,GAAG;AAAA,MACH,WAAW,mBAAmB,WAAW,QAAQ,YAAY,SAAS;AAAA,IAKtE,IAAA,YAAY,QAAQ,GAAG,MAAM,IACxB;AAAA,MACL,GAAG;AAAA,MACH,YAAY,IAAI,YAAY,QAAQ,KAAK,EAAE,CAAC,MAAM,YAAY,UAAU;AAAA,IAAA,IAKrE,EAAC,GAAG,aAAa,OAAO,IAAI,WAAW,MAAM,YAAY,KAAK,GAAE;AAAA,IAEzE,EAAC,OAAO,IAAI,YAAY,IAAI,WAAW,GAAE;AAAA,EAAA;AAOpC,SAAA;AAAA;AAAA,MAEH,eAAe,SAAS;AAAA,oBACV,eAAe,UAAU;AAAA,mBAC1B,eAAe,KAAK;AAAA;AAEvC,GAEM,aAAa,CACjB,QAAQ,GACR,MAAM,UACN,YAAY,kBACZ,gBACG;AAEH,QAAM,kBADY,YAAY,SAAS,IACH,iBAAiB,WAAW,IAAI;AAE7D,SAAA;AAAA,gBACO,SAAS,KAAK,eAAe,+BAA+B,KAAK,MAAM,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAY1F,GAEM,eAAe,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,GAO1B,qBAAqB,SACzB3B,QACA,KACA;AACA,QAAM,SAAS,UAAU,6BAA6B,GAChD,kBAAkB,QAAQ,MAAM,OAAO,WAAW,EAAC,YAAY,aAAY,CAAC,GAAG,CAAC,MAAM,CAAC,GACvF,aAAa,OAAO,wBAAwB,UAAU,EAAE,GACxD,oBAAoB,OAAO,CAAC,GAC5B,EAAC,GAAAa,GAAC,IAAI,eACN,GAAA,SAAS,OACT,GAAA,CAAC,QAAQ,SAAS,IAAI,SAAkB,CAAA,CAAE,GAC1C,CAAC,YAAY,aAAa,IAAI,SAAS,EAAK,GAC5C,CAAC,mBAAmB,gBAAgB,IAAI,SAAS,EAAK,GACtD,CAAC,WAAW,YAAY,IAAI,SAAS,EAAI,GACzC,EAAC,gBAAgB,YAAY,SAAS,mBAAmB,SAAS,UAAU,OAAM,IAAIb,QAEtF,sBAAsB,UAAU,WAAW,aAAa,cAAc,SACtE,YAAY;AAAA,IAChB,CAAC,eAAuB;AACtB,YAAM,QAAQ,aAAa,UACrB,MAAM,QAAQ,UACd,mBAAmB,cAAc,SACjC,MAAM,mBAAmB,qBAAqB,mBAC9C,iBAAiB,mBAAmB,mBAAmB;AAEhD,mBAAA,EAAI,GAEb,OAAO,SAAW,QACpB,OAAO,UAAU,gBAAgB,WAC9B,MAAM,WAAW,OAAO,KAAK,gBAAgB,MAAM,GAAG,CAAA,GAAI,EAAC,KAAI,EAC/D,UAAU,CAAC,WAAW;AACrB,sBAAc,OAAO,SAAS,QAAQ,GACtC,UAAU,CAAC,cAAc,UAAU,OAAO,MAAM,CAAC,GACjD,aAAa,EAAK;AAAA,MACnB,CAAA;AAAA,IAEP;AAAA,IACA,CAAC,WAAW,QAAQ,eAAe;AAAA,KAG/B,uBAAuB;AAAA,IAC3B,CAACR,QAAe;AAEJ,gBAAA,CAAC,cAAc,UAAU,OAAO,CAAC,UAAU,MAAM,QAAQA,GAAE,CAAC;AAAA,IACxE;AAAA,IACA,CAAC,SAAS;AAAA,KAGN0I,UAAS;AAAA,IACb,CAAC1I,QAAe;AACG,aAAO,KAAK,CAAC,QAAQ,IAAI,QAAQA,GAAE,KAKlD,SAF0C,CAAC,EAAC,MAAM,mBAAmB,OAAOA,IAAA,CAAG,CAExD;AAAA,IAE3B;AAAA,IACA,CAAC,QAAQ,QAAQ;AAAA,KAGb,kBAAkB;AAAA,IACtB,CAAC,UAAsB;AACrB,YAAM,eAAe;AACrB,YAAMA,MAAK,MAAM,cAAc,aAAa,SAAS;AACrD,UAAI,CAACA;AACG,cAAA,IAAI,MAAM,mCAAmC;AAErD,MAAA0I,QAAO1I,GAAE;AAAA,IACX;AAAA,IACA,CAAC0I,OAAM;AAAA,KAGH,qBAAqB;AAAA,IACzB,CAAC,UAAyB;AACpB,UAAA,MAAM,QAAQ,SAAS;AACzB,cAAM,eAAe;AACrB,cAAM1I,MAAK,MAAM,cAAc,aAAa,SAAS;AACrD,YAAI,CAACA;AACG,gBAAA,IAAI,MAAM,mCAAmC;AAErD,QAAA0I,QAAO1I,GAAE;AAAA,MACX;AAAA,IACF;AAAA,IACA,CAAC0I,OAAM;AAAA,EAAA,GAGH,cAAc,YAAY,MAAM;AAChC,eACF,QAAQ;AAAA,EAET,GAAA,CAAC,OAAO,CAAC,GAEN,sBAAsB;AAAA,IAC1B,CAAC,UAAsB;AACrB,YAAM,eAAe,GACrB,UAAU,EAAE,kBAAkB,OAAO;AAAA,IACvC;AAAA,IACA,CAAC,SAAS;AAAA,EAAA;AAGZ,YAAU,OACR,UAAU,kBAAkB,OAAO,GAE5B,MAAM;AACP,WAAO,WACT,OAAO,QAAQ,YAAY;AAAA,MAG9B,CAAC,SAAS,CAAC,GAEd,UAAU,MAAM;AAGV,KAAC,cAAc,CAAC,kBAAkB,WAAW,kBAAkB,YAAY,MAC7E,iBAAiB,EAAI;AAAA,EAAA,GAEtB,CAAC,SAAS,CAAC;AAEd,QAAM,aAAa,cAAc,EAAC,OAAO,SAAS,CAAA;AAGhD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,sBAAsB;AAAA,MACtB,QACE,qBACArH,GAAE,qCAAqC;AAAA,QACrC,SAAS;AAAA,MAAA,CACV;AAAA,MAEH,IAAI,WAAW;AAAA,MACf,gBAAgB;AAAA,MAChB,SAAS;AAAA,MACT;AAAA,MACA,OAAO;AAAA,MAEP,UAAA,qBAAC,OAAM,EAAA,OAAO,GACX,UAAA;AAAA,QAAC,CAAA,uBAAuB,CAAC,cAAa,UAAA,OAAA,SAAA,OAAQ,UAAS,KACtD,oBAAC,QAAK,MAAK,WAAU,SAAS,GAAG,QAAM,IAAC,QAAQ,GAC9C,+BAAC,MAAK,EAAA,KAAK,GAAG,OAAM,UAClB,UAAA;AAAA,UAAA,oBAACc,QAAK,EAAA,MAAM,GACV,UAAA,oBAAC,kBAAgB,CAAA,GACnB;AAAA,UACA,oBAACA,QAAK,EAAA,MAAM,GACV,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,GAAAd;AAAA,cACA,SAAQ;AAAA,cACR,QAAQ;AAAA,gBACN,aAAa,WAAW,OAAO,OAAO,MAAM,GAAG,EAAE,IAAI,CAAC,SAAS,KAAK,KAAM,CAAA,CAAC;AAAA,cAC7E;AAAA,YAAA;AAAA,UAAA,GAEJ;AAAA,QAAA,EAAA,CACF,EACF,CAAA;AAAA,QAED,cAAc,UACb;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA,kBAAkB;AAAA,YAClB,SAAS;AAAA,YACT,YAAY;AAAA,YACZ;AAAA,YACA;AAAA,UAAA;AAAA,QACF;AAAA,QAED,cAAc,WACb;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA,kBAAkB;AAAA,YAClB,aAAa;AAAA,YACb,gBAAgB;AAAA,YAChB;AAAA,YACA;AAAA,UAAA;AAAA,QACF;AAAA,QAED,OAAO,SAAS,KAAK,CAAC,cACpB,oBAAA,cAAA,EAAa,MAAK,WAAU,SAAS,GACpC,UAAC,oBAAA,MAAA,EAAK,WAAU,UACd,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,MAAM;AAAA,YACN,SAAS;AAAA,YACT,SAAS;AAAA,YACT,MAAK;AAAA,YACL,MAAMA,GAAE,+BAA+B;AAAA,YACvC,MAAK;AAAA,UAAA;AAAA,WAET,EACF,CAAA;AAAA,MAAA,GAEJ;AAAA,IAAA;AAAA,EAAA;AAGN,GAEa,gBAAgB,KAAK,WAAW,kBAAkB,CAAC,GCnSnD,aAA0B;AAAA,EACrC,MAAM;AAAA,EACN,OAAO;AAAA,EACP,SAAS;AAAA,EACT,WAAW;AAAA,EACX,MAAM;AACR,GCNa,cAA2B;AAAA,EACtC,MAAM;AAAA,EACN,OAAO;AAAA,EACP,SAAS;AAAA,EACT,WAAW;AAAA,EACX,MAAM;AACR,GCiBa,wBAAkD,CAElD,GAAA,yBAAoD,CAAA,GAEpD,wBAA2D,CAAA,GAE3D,qBAGT,CAAC,MAAM,EAAC,OAAA,GAAS,YAAY;AAC/B,QAAM,cAAc,UAAQ,OAAA,SAAA,OAAA;AAE5B,MAAI,CAAC;AAAoB,WAAA;AACzB,MAAI,OAAO,eAAgB;AAAmB,WAAA,YAAY,MAAM,OAAO;AACnE,MAAA,MAAM,QAAQ,WAAW;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,WAAW;AAE/D,QAAM,IAAI;AAAA,IACR,wEAAwE;AAAA,MACtE;AAAA,IAAA,CACD;AAAA,EAAA;AAEL,GAEa,8BAGT,OAAO,MAAM,EAAC,UAAAR,UAAA,GAAW,YAAY;AACvC,QAAM,uBAAuBA,aAAU,OAAA,SAAAA,UAAA;AAIvC,SAAI,uBAA6B,MAAM,qBAAqB,MAAM,OAAO,IAClE;AACT,GAEa,eAA6D,CACxE,MACA,EAAC,MAAA,GACD,YACG;AACH,MAAI,CAAC;AAAc,WAAA;AACnB,MAAI,OAAO,SAAU;AAAmB,WAAA,MAAM,MAAM,OAAO;AACvD,MAAA,MAAM,QAAQ,KAAK;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,KAAK;AAEnD,QAAM,IAAI;AAAA,IACR,iEAAiE,iBAAiB,KAAK,CAAC;AAAA,EAAA;AAE5F,GA+Ba,yBAA2E,CACtF,MACA,EAAC,OAAA,GACD,YACG;AACH,QAAM,kBAAkB,UAAQ,OAAA,SAAA,OAAA;AAChC,MAAI,CAAC;AAAwB,WAAA;AAC7B,MAAI,OAAO,mBAAoB;AAAmB,WAAA,gBAAgB,MAAM,OAAO;AAC3E,MAAA,MAAM,QAAQ,eAAe;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,eAAe;AAEvE,QAAM,IAAI;AAAA,IACR,4EAA4E;AAAA,MAC1E;AAAA,IAAA,CACD;AAAA,EAAA;AAEL,GAEa,mBAAmF,CAC9F,MACA,EAAC,KAAA,GACD,YACG;AACH,QAAM,UAAU,QAAM,OAAA,SAAA,KAAA;AACtB,MAAI,CAAC;AAAgB,WAAA;AACrB,MAAI,OAAO,WAAY;AAAmB,WAAA,QAAQ,MAAM,OAAO;AAC3D,MAAA,MAAM,QAAQ,OAAO;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,OAAO;AAEvD,QAAM,IAAI;AAAA,IACR,wEAAwE;AAAA,MACtE;AAAA,IAAA,CACD;AAAA,EAAA;AAEL,GAEa,uBAGT,CAAC,MAAM,EAAC,KAAA,GAAO,YAAY;AAC7B,QAAM,UAAU,QAAM,OAAA,SAAA,KAAA;AACtB,MAAI,CAAC;AAAgB,WAAA;AACjB,MAAA,MAAM,QAAQ,OAAO;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,OAAO;AACvD,MAAI,OAAO,WAAY;AAAmB,WAAA,QAAQ,MAAM,OAAO;AAE/D,QAAM,IAAI;AAAA,IACR,wEAAwE,OAAO,OAAO;AAAA,EAAA;AAE1F,GAEa,wBAGT,CAAC,MAAM,EAAC,UAAAA,UAAA,GAAW,YAAY;AACjC,QAAM,iBAAiBA,aAAU,OAAA,SAAAA,UAAA;AACjC,MAAI,CAAC;AAAuB,WAAA;AAE5B,MAAI,OAAO,kBAAmB;AAAmB,WAAA,eAAe,MAAM,OAAO;AACzE,MAAA,MAAM,QAAQ,cAAc;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,cAAc;AAErE,QAAM,IAAI;AAAA,IACR,2EAA2E;AAAA,MACzE;AAAA,IAAA,CACD;AAAA,EAAA;AAEL,GAEa,yBAGT,CAAC,MAAM,EAAC,UAAAA,UAAA,GAAW,YAAY;AACjC,QAAM,kBAAkBA,aAAU,OAAA,SAAAA,UAAA;AAClC,MAAI,CAAC;AAAwB,WAAA;AAE7B,MAAI,OAAO,mBAAoB;AAAmB,WAAA,gBAAgB,MAAM,OAAO;AAC3E,MAAA,MAAM,QAAQ,eAAe;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,eAAe;AAEvE,QAAM,IAAI;AAAA,IACR,4EAA4E;AAAA,MAC1E;AAAA,IAAA,CACD;AAAA,EAAA;AAEL,GAEa,6BAGT,CAAC,MAAM,EAAC,UAAAA,UAAA,GAAW,YAAY;AACjC,QAAM,4BAA4BA,aAAU,OAAA,SAAAA,UAAA;AAC5C,MAAI,CAAC;AAAkC,WAAA;AAEvC,MAAI,OAAO,6BAA8B;AACvC,UAAM,IAAI;AAAA,MACR,kFAAkF;AAAA,QAChF;AAAA,MAAA,CACD;AAAA,IAAA;AAIE,SAAA,0BAA0B,MAAM,OAAO;AAChD,GAEa,0BAA+E,CAC1F,MACA,EAAC,KAAA,GACD,YACG;AAlNL,MAAAM;AAmNQ,QAAA,gBAAeA,MAAM,QAAA,OAAA,SAAA,KAAA,SAAN,OAAY,SAAAA,IAAA;AACjC,MAAI,CAAC;AAAqB,WAAA;AAE1B,MAAI,OAAO,gBAAiB;AAAmB,WAAA,aAAa,MAAM,OAAO;AACrE,MAAA,MAAM,QAAQ,YAAY;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,YAAY;AAEjE,QAAM,IAAI;AAAA,IACR,kFAAkF;AAAA,MAChF;AAAA,IAAA,CACD;AAAA,EAAA;AAEL,GAEa,2BAAgF,CAC3F,MACA,EAAC,KAAA,GACD,YACG;AApOL,MAAAA;AAqOQ,QAAA,gBAAeA,MAAM,QAAA,OAAA,SAAA,KAAA,UAAN,OAAa,SAAAA,IAAA;AAClC,MAAI,CAAC;AAAqB,WAAA;AAE1B,MAAI,OAAO,gBAAiB;AAAmB,WAAA,aAAa,MAAM,OAAO;AACrE,MAAA,MAAM,QAAQ,YAAY;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,YAAY;AAEjE,QAAM,IAAI;AAAA,IACR,mFAAmF;AAAA,MACjF;AAAA,IAAA,CACD;AAAA,EAAA;AAEL,GAKa,gCAGT,CAAC,MAAM,EAAC,UAAAN,UAAA,GAAW,YAAY;AACjC,QAAM,gCAAgCA,aAAU,OAAA,SAAAA,UAAA;AAChD,MAAI,CAAC;AAAsC,WAAA;AAE3C,MAAI,OAAO,iCAAkC;AACpC,WAAA,8BAA8B,MAAM,OAAO;AAEhD,MAAA,MAAM,QAAQ,6BAA6B;AAC7C,WAAO,CAAC,GAAG,MAAM,GAAG,6BAA6B;AAEnD,QAAM,IAAI;AAAA,IACR,4FAA4F;AAAA,MAC1F;AAAA,IAAA,CACD;AAAA,EAAA;AAEL,GAEa,4BAGT,CAAC,MAAM,EAAC,UAAAA,UAAA,GAAW,YAAY;AACjC,QAAM,0BAA0BA,aAAU,OAAA,SAAAA,UAAA;AAC1C,MAAI,CAAC;AAAgC,WAAA;AAErC,MAAI,OAAO,2BAA4B;AAAmB,WAAA,wBAAwB,MAAM,OAAO;AAE3F,MAAA,MAAM,QAAQ,uBAAuB;AAAG,WAAO,CAAC,GAAG,MAAM,GAAG,uBAAuB;AAEvF,QAAM,IAAI;AAAA,IACR,+EAA+E;AAAA,MAC7E;AAAA,IAAA,CACD;AAAA,EAAA;AAEL,GAEa,iCAAiC,CAAC,SAIhC;AACb,QAAM,EAAC,QAAQ,SAAS,aAAA,IAAgB;AAChB,SAAA,cAAc,QAAQ,CAAA,CAAE,EAKjB,OAAO,CAAC,KAAK,EAAC,QAAQ,kBAAiB;AAtSxE,QAAAM,KAAA;AAuSI,UAAM,YAAW,MAAAA,MAAA,YAAY,aAAZ,OAAA,SAAAA,IAAsB,sBAAtB,OAAyC,SAAA,GAAA;AAEtD,QAAA,CAAC,YAAY,OAAO,YAAa;AAAkB,aAAA;AACvD,QAAI,OAAO,YAAa;AAAY,aAAO,SAAS,OAAO;AAC3D,QAAI,OAAO,YAAa;AAAkB,aAAA;AAE1C,UAAM,IAAI;AAAA,MACR,+FAA+F;AAAA,QAC7F;AAAA,MAAA,CACD;AAAA,IAAA;AAAA,KAEF,YAAY;AAGjB,GAEa,uBAAuB,CAAC,SAEQ;AACrC,QAAA,EAAC,OAAU,IAAA;AAmBjB,SAlBwB,cAAc,QAAQ,CAAE,CAAA,EAEjB;AAAA,IAC7B,CAAC,KAA4C,EAAC,QAAQ,kBAAiB;AACrE,YAAM,WAAW,YAAY;AAE7B,UAAI,CAAC;AAAiB,eAAA;AAClB,UAAA,OAAO,YAAa,YAAY,SAAS;AAAqB,eAAA;AAElE,YAAM,IAAI;AAAA,QACR,kFAAkF;AAAA,UAChF;AAAA,QAAA,CACD;AAAA,MAAA;AAAA,IAEL;AAAA,IACA;AAAA,EAAA;AAIJ,GAEa,gCAAgC,CAAC,SAG/B;AACP,QAAA,EAAC,QAAQ,aAAgB,IAAA;AACP,SAAA,cAAc,QAAQ,CAAA,CAAE,EAEjB,OAAO,CAAC,KAAK,EAAC,QAAQ,kBAAiB;AAvVxE,QAAAA,KAAA;AAwVI,UAAM,YAAW,MAAAA,MAAA,YAAY,WAAZ,OAAA,SAAAA,IAAoB,6BAApB,OAA8C,SAAA,GAAA;AAE3D,QAAA,CAAC,YAAY,OAAO,YAAa;AAAkB,aAAA;AACvD,QAAI,OAAO,YAAa;AAAkB,aAAA;AAE1C,UAAM,IAAI;AAAA,MACR,sFAAsF;AAAA,QACpF;AAAA,MAAA,CACD;AAAA,IAAA;AAAA,KAEF,YAAY;AAGjB,GAEa,0BAAyE,CACpF,MACA,EAAC,QAAAgQ,QAEM,MAAA,SAAQA,mCAAQ,6BAA4B;AC9U9C,SAAS,sBAAwC;AAAA,EACtD,QAAQ;AAAA,EACR;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAEmF;AACjF,QAAM,UAAU,cAAc,aAAa,CAAE,CAAA;AAE7C,MAAI,aAAa;AACf,WAAO,QAAQ,OAAO,CAAC,KAAK,EAAC,QAAQ,WAAU;AACzC,UAAA;AACF,eAAO,SAAS,QAAQ,KAAK,QAAQ,OAAO;AAAA,eACrC,GAAG;AACV,cAAM,IAAI,oBAAoB;AAAA,UAC5B;AAAA,UACA;AAAA,UACA,OAAO;AAAA,QAAA,CACR;AAAA,MACH;AAAA,OACC,YAAY;AAGjB,QAAM,UAAU,SAAS;AACzB,UAAQ,YAAY;AAClB,QAAI,UAAU;AACH,eAAA,EAAC,QAAQ,KAAA,KAAS;AACvB,UAAA;AACF,kBAAU,MAAM,QAAQ,SAAS,QAAQ,OAAO;AAAA,eACzC,GAAG;AACV,cAAM,IAAI,oBAAoB;AAAA,UAC5B;AAAA,UACA;AAAA,UACA,OAAO;AAAA,QAAA,CACR;AAAA,MACH;AAEK,WAAA;AAAA,EAAA;AAEX;ACxCO,SAAS,wBAAwB,SAAkD;AAClF,QAAA,EAAC,QAAW,IAAA;AAClB,WAAS,OAAO;AAAA,EAEhB;AAES,WAAApR,MAAK,QAAgB,WAAmB,UAAwB;AACvE,UAAM,WAAW,QAAQ;AAAA,MACvB,CAAC,WAAW,OAAO,WAAW,UAAU,OAAO,cAAc;AAAA,IAAA;AAG3D,QAAA,SAAS,WAAW,GAAG;AAEzB;AAAA,QACE,wCAAwC,SAAS,gBAAgB,MAAM;AAAA,QACvE;AAAA;AAAA,MAAA;AAEF;AAAA,IACF;AAEA,gBAAY,QAAQ,EACjB,KAAK,CAAC,cAAc,SAAS,MAAM,SAAS,CAAC,EAG7C,MAAM,CAAC,QAAQ,SAAS,KAAK,EAAI,CAAC;AAAA,EACvC;AAEO,SAAA;AAAA,IACL,MAAM;AAAA,IACN;AAAA,IACA,MAAAA;AAAA,EAAA;AAEJ;AAeA,eAAe,YAAY,SAAgE;AA7E3F,MAAAoB,KAAA;AAgFQ,QAAA,WAAW,MAAM,QAAQ;AAAA,IAC7B,QAAQ,IAAI,OAAO,YAAY;AAAA,MAC7B,GAAG;AAAA,MACH,WAAW,MAAM,oBAAoB,MAAM;AAAA,IAAA,EAC3C;AAAA,EAAA,GAGE,OAA6B,CAAA;AACnC,aAAW,QAAQ,UAAU;AACrB,UAAA,QAAOA,WAAK,SAAL,OAAAA,MAAa,IACpB,aAAY,KAAA,KAAK,cAAL,OAAkB,KAAA;AAEhC,WACF,WAAW,MAAM,KAAK,WAAW,SAAS,IACjC,YACT,OAAO,OAAO,MAAM,KAAK,SAAS,IAElC,OAAO,OAAO,CAAA,GAAI,KAAK,WAAW,IAAI;AAAA,EAE1C;AAEO,SAAA;AACT;AAQA,eAAe,oBAAoB,QAA6D;AAC1F,MAAA,OAAO,OAAO,aAAc;AAC9B,WAAO,OAAO;AAGV,QAAA,YAAY,MAAM,OAAO;AAC/B,SAAO,kBAAkB,SAAS;AACpC;AAgBA,SAAS,WACP,QACA,QACA,YAAY,IACU;AACtB,aAAW,QAAQ,QAAQ;AACrB,QAAA,SAAS,eAAe,SAAS;AACnC;AAIE,QAAA,EAAE,QAAQ,SAAS;AACd,aAAA,IAAI,IAAI,OAAO,IAAI;AAC1B;AAAA,IACF;AAEA,UAAM,aAAa,OAAO,IAAI,GACxB,aAAa,OAAO,IAAI,GAExB,iBAAiB,aAAa,UAAU,GACxC,iBAAiB,aAAa,UAAU;AAGzC,SAAA,kBAAkB,mBAAmB,WAAW;AAC5C,aAAA,IAAI,IAAI,OAAO,IAAI;AAC1B;AAAA,IACF;AAEA,QAAI,kBAAkB;AAEpB;AAII,UAAA,gBAAgB,MAAM,QAAQ,UAAU,GACxC,gBAAgB,MAAM,QAAQ,UAAU;AAC9C,QAAI,iBAAiB,eAAe;AAE9B,oBACF,OAAO,IAAI,IAAI;AAEjB;AAAA,IACF;AAGW,eAAA,YAAY,YAAY,SAAS;AAAA,EAC9C;AAEO,SAAA;AACT;AASA,SAAS,aAAa,QAA6C;AAC1D,SAAA,OAAO,UAAW,YAAY,kBAAkB;AACzD;AASA,SAAS,kBACP,aACsB;AACtB,SAAO,gBAAgB,WAAW,IAAI,YAAY,UAAU;AAC9D;AASA,SAAS,gBACP,KACwC;AACjC,SAAA,aAAa,OAAO,OAAO,IAAI,WAAY,YAAY,cAAc,IAAI,OAAO;AACzF;ACrMO,SAAS,YAAY,QAA8D;AACxF,QAAM,EAAC,WAAW,SAAS,MAAM,WAAU,IAAI,QACzC,UAAU,EAAC,WAAsB,WAEjC,UAAU,sBAAsB;AAAA,IACpC,QAAQ;AAAA,IACR;AAAA,IACA,cAAc;AAAA,IACd,SAAS;AAAA,IACT,cAAc,CAAC,aAAa;AAAA,EAAA,CAC7B,GAEK,UAAU,sBAAsB;AAAA,IACpC,QAAQ;AAAA,IACR;AAAA,IACA,cAAc;AAAA,IACd,SAAS;AAAA,IACT,cAAc,yBAAyB,OAAO;AAAA,EAAA,CAC/C;AAED,SAAO,cAAc;AAAA,IACnB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AACH;AAEA,SAAS,cAAc;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAK0C;AACxC,QAAM,iBAAiB,IAAI,IAAI,QAAQ,IAAI,CAAC,WAAW,OAAO,SAAS,CAAC,GAClE,UAAU,kBAAkB,WAAW,YAAY,SAAS,cAAc,GAC1E,eAAeiQ,eAClB,EAAA,IAAI,wBAAwB,EAAC,QAAO,CAAC,CAAC,EACtC,IAAI,gBAAgB;AAEvB,eAAa,KAAK,OAAO,EAAE,MAAM,CAAC,QAAQ;AAChC,YAAA,MAAM,yCAAyC,GAAG;AAAA,EAAA,CAC3D;AAEK,QAAA,iBAAiB,QAAQ,IAAI,sBAAsB;AAElD,SAAA;AAAA;AAAA,IAEL,QAAQ;AAAA,MACN,IAAI,gBAAgB;AA5E1B,YAAAjQ;AA6Ee,gBAAAA,MAAA,eAAe,KAAK,CAAC,WAAW,OAAO,OAAO,aAAa,QAAQ,MAAnE,OAAwEA,MAAA;AAAA,MACjF;AAAA,MACA,eAAe,YAAqC;AAC5C,cAAA,UAAU,WAAW,OAAO,CAAC,OAAO,CAAC,aAAa,mBAAmB,EAAE,CAAC;AACvE,eAAA,QAAQ,WAAW,IAAI,QAAQ,YAAY,aAAa,eAAe,OAAO;AAAA,MACvF;AAAA,MACA,SAAS;AAAA,MACT,GAAG,WAAW,aAAa,CAAC;AAAA,IAC9B;AAAA;AAAA,IAGA,SAAS;AAAA,EAAA;AAEb;AASA,SAAS,yBAAyB,SAAqD;AACrF,QAAM,aAAqC,CAAA;AAE3C,aAAW,QAAQ,SAAS;AAC1B,QAAI,KAAK,WAAW,CAAC,MAAM,QAAQ,KAAK,OAAO;AAC7C,YAAM,IAAI,MAAM,8BAA8B,KAAK,EAAE,kBAAkB;AAGzE,QAAK,KAAK;AAIC,iBAAA,UAAU,KAAK,SAAS;AACjC,YAAI,YAAY,UAAU,OAAO,WAAW,KAAK;AAC/C,gBAAM,IAAI,MAAM,iCAAiC,KAAK,EAAE,4BAA4B;AAItF,YAAI,CADO,OAAO;AAEhB,gBAAM,IAAI,MAAM,8BAA8B,KAAK,EAAE,uBAAuB;AAGnE,mBAAA,KAAK,YAAY,SAAS,SAAS,EAAC,GAAG,QAAQ,QAAQ,KAAK,GAAG,CAAA;AAAA,MAC5E;AAAA,EACF;AAEO,SAAA;AACT;AAEA,MAAM,iBAA8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMlC,IAAI,CAAC,qBAAqB;AAAA,EAC1B,WAAW;AAAA,EACX,yBAAyB;AAAA;AAAA,EAGzB,aAAa,cAAc;AAAA;AAAA;AAAA,EAI3B,KAAK,cAAc;AAAA;AAAA;AAAA,EAInB,OAAO;AAAA;AAAA,EAGP,MAAM;AAAA;AAAA;AAAA;AAAA,EAKN,eAAe;AAAA;AAAA,EAGf,eAAe;AAAA,IACb,aAAa;AAAA,EACf;AAAA;AAAA;AAAA,EAIA,OAAO;AAAA,IACL,eAAe;AAAA,EACjB;AACF;AAEA,SAAS,kBACP,WACA,YACA,SACA,YAC6B;AA9K/B,MAAAA,KAAA;AA+KQ,QAAA,oBAAoB,mBAAmB,WAAW,UAAU,GAC5D,kBAAkB,QAAQ,KAAK,CAAC,MAAM,EAAE,OAAO,iBAAiB,GAChE,aAAa,QAAQ,QAAQ,SAAS,CAAC,GACvC,UAAS,MAAiBA,MAAA,mBAAA,OAAA,SAAA,gBAAA,OAAjB,OAAuBA,MAAA,WAAW,OAAlC,OAAA,KAAwC,eAAe;AAC/D,SAAA;AAAA,IACL,GAAG;AAAA,IACH,IAAI,MAAM,KAAK,UAAU;AAAA;AAAA,IACzB,KAAK;AAAA,IACL,eAAe,QAAQ,IAAI,CAAC,QAAQ,IAAI,EAAE;AAAA,EAAA;AAE9C;AASA,SAAS,uBAAuB,YAAsC;AAEpE,QAAM,EAAC,SAAS,GAAG,OAAA,IAAU;AACtB,SAAA;AACT;ACvJO,SAAS,iCACdkQ,oBACkC;AAClC,SAAOA,mBAAkB,OAAyC,CAAC,KAAK,SACtE,IAAI,IAAI,IAAI,IAAI,KACT,MACN,CAAE,CAAA;AACP;AAKO,SAAS,mBACd,WACkB;AACX,SAAA;AACT;AAKO,SAAS,4BACd,WACkB;AACX,SAAA;AACT;AAEgB,SAAA,oBACd,aACA,YACoC;AACpC,SAAO,YAAY,UAAU;AAC/B;AAIO,SAAS,uBAAuB,YAAgD;AACrF,SAAO,WAAW,OAAiB,CAAC,KAAK,SACnC,IAAI,SAAS,WACf,IAAI,KAAK,IAAI,SAAS,GAEjB,MACN,CAAA,CAAE;AACP;AC1EO,MAAM,oBAA8C;AAAA;AAAA,EAElB;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,oBAAoB,MAAM,OAAM;AAAA,IACzC;AAAA,IACA,OAAO;AAAA,IACP,MAAM;AAAA,IACN,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,oBAAoB,MAAM,OAAM;AAAA,IACzC;AAAA,IACA,OAAO;AAAA,IACP,MAAM;AAAA,IACN,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,sBAAsB,MAAM,OAAM;AAAA,MACzC,EAAC,MAAM,wBAAwB,MAAM,OAAM;AAAA,MAC3C,EAAC,MAAM,uBAAuB,MAAM,OAAM;AAAA,IAC5C;AAAA,IACA,OAAO;AAAA,IACP,MAAM;AAAA,IACN,MAAM;AAAA,EAAA;AAAA;AAAA,EAG+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,MACjC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,mBAAmB,MAAM,OAAM;AAAA,MACtC,EAAC,MAAM,sBAAsB,MAAM,OAAM;AAAA,MACzC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,mBAAmB,MAAM,OAAM;AAAA,IACxC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,qBAAqB,MAAM,OAAM;AAAA,MACxC,EAAC,MAAM,wBAAwB,MAAM,OAAM;AAAA,MAC3C,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,MACjC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,mBAAmB,MAAM,OAAM;AAAA,MACtC,EAAC,MAAM,sBAAsB,MAAM,OAAM;AAAA,MACzC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,mBAAmB,MAAM,OAAM;AAAA,IACxC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,0BAA0B,MAAM,OAAM;AAAA,MAC7C,EAAC,MAAM,6BAA6B,MAAM,OAAM;AAAA,MAChD,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,MACjC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,mBAAmB,MAAM,OAAM;AAAA,MACtC,EAAC,MAAM,sBAAsB,MAAM,OAAM;AAAA,MACzC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,mBAAmB,MAAM,OAAM;AAAA,IACxC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,YAAY,MAAM,OAAM;AAAA,MAC/B,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,aAAa,MAAM,OAAM;AAAA,MAChC,EAAC,MAAM,aAAa,MAAM,OAAM;AAAA,MAChC,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,MACjC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,aAAa,MAAM,OAAM;AAAA,MAChC,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,oBAAoB,MAAM,OAAM;AAAA,MACvC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,oBAAoB,MAAM,OAAM;AAAA,MACvC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,eAAe,MAAM,OAAM;AAAA,MAClC,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,qBAAqB,MAAM,OAAM;AAAA,MACxC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,mBAAmB,MAAM,OAAM;AAAA,MACtC,EAAC,MAAM,sBAAsB,MAAM,OAAM;AAAA,MACzC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,eAAe,MAAM,OAAM;AAAA,MAClC,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,YAAY,MAAM,OAAM;AAAA,MAC/B,EAAC,MAAM,aAAa,MAAM,OAAM;AAAA,MAChC,EAAC,MAAM,YAAY,MAAM,OAAM;AAAA,MAC/B,EAAC,MAAM,aAAa,MAAM,OAAM;AAAA,MAChC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,eAAe,MAAM,OAAM;AAAA,MAClC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,uBAAuB,MAAM,OAAM;AAAA,MAC1C,EAAC,MAAM,0BAA0B,MAAM,OAAM;AAAA,MAC7C,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,qBAAqB,MAAM,OAAM;AAAA,MACxC,EAAC,MAAM,wBAAwB,MAAM,OAAM;AAAA,MAC3C,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,qBAAqB,MAAM,OAAM;AAAA,MACxC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,eAAe,MAAM,OAAM;AAAA,MAClC,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,aAAa,MAAM,OAAM;AAAA,MAChC,EAAC,MAAM,gBAAgB,MAAM,OAAM;AAAA,MACnC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,oBAAoB,MAAM,OAAM;AAAA,MACvC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,eAAe,MAAM,OAAM;AAAA,MAClC,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,mBAAmB,MAAM,OAAM;AAAA,MACtC,EAAC,MAAM,sBAAsB,MAAM,OAAM;AAAA,MACzC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,oBAAoB,MAAM,OAAM;AAAA,MACvC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,oBAAoB,MAAM,OAAM;AAAA,MACvC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,eAAe,MAAM,OAAM;AAAA,MAClC,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAE+B;AAAA,IACrC,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW;AAAA,MACT,EAAC,MAAM,iBAAiB,MAAM,OAAM;AAAA,MACpC,EAAC,MAAM,oBAAoB,MAAM,OAAM;AAAA,MACvC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,eAAe,MAAM,OAAM;AAAA,MAClC,EAAC,MAAM,kBAAkB,MAAM,OAAM;AAAA,MACrC,EAAC,MAAM,UAAS;AAAA,MAChB,EAAC,MAAM,WAAW,MAAM,OAAM;AAAA,MAC9B,EAAC,MAAM,cAAc,MAAM,OAAM;AAAA,IACnC;AAAA,IACA,MAAM;AAAA,EAAA;AAEV;AC5UgB,SAAA,kBAAkB,UAAoC,IAAyB;AACvF,QAAA,gBAAgB,iBAAmB,EAAA;AAClC,SAAA,UAAU,eAAe,eAAe,OAAO;AACxD;AC4EgB,SAAA,iBAAiB,UAAmC,IAAmB;AACrF,QAAM,gBAAgB,mBAAmB,IACnCC,kBAA2C;AAAA,IAC/C,aAAa;AAAA,IACb,GAAG;AAAA,IACH,OAAO;AAAA,EAAA;AAGF,SAAA,SAAgB,OAAe,MAAkC;AACpD,WAAA,UAAU,aAAa,eAAe,EAAC,GAAGA,iBAAgB,MAAK,EAChE,OAAO,KAAK;AAAA,EAAA;AAEjC;ACrGO,SAAS,sBAAsB;AAAA,EACpC;AAAA,EACA;AACF,GAGG;AACD,QAAM,uBAAuB,2BAIvB,EAAC,OAAO,WAAW,cAAa;AAAA,IACpC,MAAM,0BAA0B,sBAAsB,YAAY,YAAY,EAAE;AAAA,IAChF,CAAC,YAAY,sBAAsB,UAAU;AAAA,EAAA,GAGzC,iBAAiB,QAAQ,OACtB;AAAA,IACL,KAAK;AAAA,IACL,OAAO,WAAW;AAAA,EAAA,IAEnB,CAAC,YAAY,WAAW,IAAI,CAAC,GAE1B,eAAe,4BAA4B;AAAA,IAC/C;AAAA,IACA;AAAA,IACA,OAAO;AAAA,EAAA,CACR;AAEG,SAAA,YACM,oBAAA,UAAA,EAAS,UAAQ,IAAC,YAAY,GAAG,QAAQ,GAAG,OAAO,EAAC,OAAO,QAAQ,QAAQ,MAAQ,EAAA,CAAA,IAGnF,oBAAA,UAAA,EAAA,UAAA,aAAa,SAAS,WAAW,MAAM,GAAG,CAAC,EAAE,CAAA;AACzD;ACpBO,SAAS,sBAAsB;AAAA,EACpC;AACF,GAA8D;AAC5D,QAAM,aAAa,kBAAkB;AAAA,IACnC,WAAW;AAAA,IACX,WAAW,MAAM,cAAc,UAAU;AAAA,EAC1C,CAAA,GACK,OAAO,SAAA,QAAA,MAAO,OAAO,IAAI,KAAK,MAAM,IAAI,IAAI;AAC9C,SAAA,CAAC,QAAQ,CAAC,QAAQ,IAAI,IACjB,OAEC,oBAAA,UAAA,EAAA,UAAA,WAAW,OAAO,IAAI,EAAE,CAAA;AACpC;AAEO,SAAS,0BAA0B;AAAA,EACxC;AACF,GAA6D;AAtC7D,MAAAnQ;AAuCE,QAAM,aAAa;AACZ,SAAA,oBAAA,UAAA,EAAG,UAAW,WAAA,KAAK,OAAMA,MAAA,SAAA,OAAA,SAAA,MAAO,cAAP,OAAAA,MAAoB,CAAC,GAAG,MAAM,IAAI,EAAE,CAAA;AACtE;AAEO,SAAS,2BAA2B;AAAA,EACzC;AACF,GAA8D;AAC5D,QAAM,aAAa,kBAAkB;AAAA,IACnC,WAAW;AAAA,IACX,WAAW,MAAM,cAAc,UAAU;AAAA,EAAA,CAC1C,GACK,YAAY,uBAAO,OAAO,IAAI,KAAK,MAAM,IAAI,IAAI,MACjD,UAAU,SAAO,QAAA,MAAA,KAAK,IAAI,KAAK,MAAM,EAAE,IAAI;AAC7C,MAAA,CAAC,WAAW,CAAC,aAAa,CAAC,QAAQ,OAAO,KAAK,CAAC,QAAQ,SAAS;AAC5D,WAAA;AAGH,QAAAM,QAAO,WAAW,OAAO,SAAS,GAClC,KAAK,WAAW,OAAO,OAAO;AACpC,SAAU,oBAAA,UAAA,EAAA,UAAA,GAAGA,KAAI,WAAM,EAAE,GAAG,CAAA;AAC9B;AAEgB,SAAA,2BAA2B,EAAC,SAAsD;AAC1F,QAAA,SAAS,aACT,aAAa,MAAM,MACnB,aAAa,OAAO,IAAI,MAAM,KAAK;AACzC,SAAK,aAGE,oBAAC,uBAAsB,EAAA,YAAwB,YAAwB,IAFrE;AAGX;ACjDa,MAAA,gBAAgB,cAA8C,MAAS;ACb7E,SAAS,iBAAqC;AAC7C,QAAA,UAAU,WAAW,aAAa;AAExC,MAAI,YAAY;AACR,UAAA,IAAI,MAAM,sDAAsD;AAEjE,SAAA;AACT;ACPO,SAAS,wBAAwB,EAAC,OAAO,YAAgD;AAC9F,QAAM,CAAC,mBAAmB,oBAAoB,IAAI,SAAS,SAAA,OAAA,QAAS,EAAE,GAEhE;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAAA,IAChB,eACE,GAAA,EAAC,GAAAJ,GAAK,IAAA,eAAA,GAEN,eAAe;AAAA,IACnB,CAAC,UAAyC;AACnB,2BAAA,MAAM,cAAc,KAAK;AAC9C,YAAM,WAAW,WAAW,MAAM,cAAc,KAAK;AACrD,eAAS,OAAO,SAAS,QAAQ,IAAI,WAAW,IAAI;AAAA,IACtD;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA;AAIT,SAAA;AAAA,IAAC0K;AAAAA,IAAA;AAAA,MACC,UAAU,aAAa,IAAI;AAAA,MAC3B,UAAU;AAAA,MACV,aAAa1K,GAAE,wCAAwC;AAAA,MACvD,QAAQ;AAAA,MACR,MAAK;AAAA,MACL,MAAK;AAAA,MACL,OAAO;AAAA,IAAA;AAAA,EAAA;AAGb;AC3BO,SAAS,6BAA6B;AAAA,EAC3C;AAAA,EACA;AACF,GAA0D;AAX1D,MAAAF,KAAA;AAYE,QAAM,CAAC,IAAI,KAAK,IAAI,UAASA,MAAA,SAAA,OAAA,SAAA,MAAO,OAAP,OAAaA,MAAA,EAAE,GACtC,CAACM,OAAM,OAAO,IAAI,UAAS,oCAAO,SAAP,OAAA,KAAe,EAAE,GAE5C;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAAA,IAChB,eACE,GAAA,EAAC,GAAAJ,GAAK,IAAA,eAAA,GAEN,iBAAiB;AAAA,IACrB,CAAC,UAAyC;AArB9CF,UAAAA;AAsBY,YAAA,MAAM,cAAc,KAAK;AAC/B,YAAM,WAAW,WAAW,MAAM,cAAc,KAAK;AAC5C,eAAA;AAAA,QACP,IAAI,OAAO,SAAS,QAAQ,IAAI,WAAW;AAAA,QAC3C,OAAMA,OAAA,SAAO,OAAA,SAAA,MAAA,SAAP,OAAAA,OAAe;AAAA,MAAA,CACtB;AAAA,IACH;AAAA,IACA,CAAC,SAAO,OAAA,SAAA,MAAA,MAAM,QAAQ;AAAA,KAElB,mBAAmB;AAAA,IACvB,CAAC,UAAyC;AAhC9CA,UAAAA;AAiCc,cAAA,MAAM,cAAc,KAAK;AACjC,YAAM,WAAW,WAAW,MAAM,cAAc,KAAK;AAC5C,eAAA;AAAA,QACP,KAAIA,OAAA,SAAO,OAAA,SAAA,MAAA,OAAP,OAAAA,OAAa;AAAA,QACjB,MAAM,OAAO,SAAS,QAAQ,IAAI,WAAW;AAAA,MAAA,CAC9C;AAAA,IACH;AAAA,IACA,CAAC,SAAO,OAAA,SAAA,MAAA,IAAI,QAAQ;AAAA,EAAA;AAIpB,SAAA,qBAAC,MAAK,EAAA,KAAK,GACT,UAAA;AAAA,IAAC,oBAAA,KAAA,EAAI,MAAM,GACT,UAAA;AAAA,MAAC4K;AAAAA,MAAA;AAAA,QACC,UAAU,aAAa,IAAI;AAAA,QAC3B,UAAU;AAAA,QACV,aAAa1K,GAAE,4CAA4C;AAAA,QAC3D,QAAQ;AAAA,QACR,MAAK;AAAA,QACL,MAAK;AAAA,QACL,OAAOI;AAAA,MAAA;AAAA,IAAA,GAEX;AAAA,IACA,oBAAC,KAAI,EAAA,MAAM,GACT,UAAA;AAAA,MAACsK;AAAAA,MAAA;AAAA,QACC,UAAU,aAAa,IAAI;AAAA,QAC3B,UAAU;AAAA,QACV,aAAa1K,GAAE,4CAA4C;AAAA,QAC3D,QAAQ;AAAA,QACR,MAAK;AAAA,QACL,MAAK;AAAA,QACL,OAAO;AAAA,MAAA;AAAA,IAAA,GAEX;AAAA,EACF,EAAA,CAAA;AAEJ;ACnEgB,SAAA,eACd,YACA,WACqC;AACrC,QAAM,QAAQ,UAAU,MAAM,GAAG,GAC3B,YAAY,MAAM,CAAC;AACrB,MAAA,aAAa,mBAAmB,UAAU,GAAG;AACzC,UAAA,QAAQ,WAAW,OAAO,KAAK,CAAC,MAAM,EAAE,SAAS,SAAS;AAChE,QAAI,OAAO;AACT,YAAM,WAAW,MAAM,MAAM,CAAC,EAAE,KAAK,GAAG;AACxC,aAAI,WACK,eAAe,MAAM,MAAM,QAAQ,IAErC;AAAA,IACT;AAAA,EACF;AAEF;ACWA,MAAM,6BAA6B,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWtC,SAAS,wBAAwB;AAAA,EACtC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,YAAY;AACd,GAAiC;AAC/B,QAAM,uBAAuB,2BAIvB,EAAC,OAAO,WAAW,cAAa;AAAA,IACpC,MAAM,0BAA0B,sBAAsB,YAAY,YAAY,EAAE;AAAA,IAChF,CAAC,YAAY,sBAAsB,UAAU;AAAA,EAAA,GAGzC,iBAAiB,QAAQ,OACtB;AAAA,IACL,KAAK;AAAA,IACL,OAAO,WAAW;AAAA,EAAA,IAEnB,CAAC,YAAY,WAAW,IAAI,CAAC,GAE1B,SAAS,QAAQ,MACjB,YAAkB,OAEpB,qBAAC,QAAK,OAAM,UAAS,KAAK,GACvB,UAAA;AAAA,IAAA,YAAY,SAAS,SAAS,KAAK,oBAAC,2BAAwB,UAAoB;AAAA,IAChF,aAAa,oBAAC,OAAO,EAAA,UAAA,WAAW,OAAM;AAAA,IACvC,oBAAC,yBAAwB,EAAA,OAAc,UAAsB,CAAA;AAAA,EAAA,EAC/D,CAAA,GAED,CAAC,OAAO,WAAW,UAAU,WAAW,WAAW,OAAO,SAAS,CAAC,GAEjE,UAAW,oBAAA,gBAAA,EAAe,OAAc,UAAsB,CAAA;AAEpE,6BACG,4BACC,EAAA,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG,4BAA4B;AAAA,QAC9B;AAAA,QACA;AAAA,QACA,OAAO;AAAA,MAAA,CACR;AAAA,MACD,eAAe,aAAa,OAAA,YAAA;AAAA,MAC5B,QAAQ,UAAU;AAAA,MAClB,MAAM,WAAW;AAAA,MACjB;AAAA,MACA;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACxEO,SAAS,iBAAiB;AAAA,EAC/B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAA0B;AAExB,QAAM,OADS,YACK,IAAI,YAAY,GAC9B,mBAAmB,oBAAoB,UAAU,GAEjD,SAAS,QAAQ,OAAO,EAAC,IAAI,YAAY,MAAM,QAAM,OAAA,SAAA,KAAA,SAAQ,CAAC,YAAY,QAAM,OAAA,SAAA,KAAA,IAAI,CAAC,GACrF,EAAC,SAAS,eAAe,SAAQ,cAAc;AAAA,IACnD,QAAQ;AAAA,IACR;AAAA,EAAA,CACD,GAEK,cAAc;AAAA,IAClB,CAAC,MAA+B;AACf,sBAAA,QAAA,aAAA,EAAC,KAAK,YAAY,OAAO,cACnC,GAAA,qBACH,cAAc,CAAC,GAEjB,WAAA,QAAA;IACF;AAAA,IACA,CAAC,cAAc,YAAY,cAAc,mBAAmB,SAAS,aAAa;AAAA,EAAA;AAGpF,SAAK,OAGH,oBAAC,KAAK,EAAA,GAAG,MACP,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,IAAG;AAAA,MACH,WAAQ;AAAA,MACR,MAAM;AAAA,MACN,MAAM,oBAAoB,SAAY;AAAA,MACtC,SAAS;AAAA,MACT,QAAQ;AAAA,MACR,UAAU;AAAA,MAEV,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA;AAAA,UACA,UAAU;AAAA,UACV,YAAY;AAAA,QAAA;AAAA,MACd;AAAA,IAAA;AAAA,EAAA,EAEJ,CAAA,IApBgB;AAsBpB;ACvEA,MAAM,SACJ,OAAO,SAAU,OAAe,uBAAuB,KAAK,OAAO,UAAU,QAAQ,GAI1E,iBAAiB,uBAGjB,aAAa,IAIb,eAAe,KAEf,oBAAoB,KACpB,6BAA6B,SAAS,QAAQ,QAE9C,wBAAwB,YAAY,MAAM,CAAC,GAC3C,qBAAqB,KACrB,oBAAoB,KAGpB,0BAA0B,GAE1B,iBAAiB;AClBvB,SAAS,mBAAmB;AAAA,EACjC;AAAA,EACA;AACF,GAGY;AACV,QAAM,WAAW,oBAAoB,KAAO,MAAM,MAAM,SAAS,GAC3D,YAAY,CAAC,CAAC,MAAM,QACpB,mBAAmB,MAAM,MAAM,SAAS;AAE9C,SAAO,YAAY,aAAa;AAClC;ACZgB,SAAA,6BAA6B,QAAgB,YAAkC;AAC7F,SAAO,6BAA6B,MAAM,EACvC,OAAO,CAAC,SAAS,aAAa,MAAM,UAAU,CAAC,EAC/C,KAAK,SAAS;AACnB;AAMO,SAAS,6BAA6B,QAAoC;AACxE,SAAA,mBAAmB,MAAM,EAAE;AAAA,IAChC,CAAC,SAAW,KAAK,yCAAyC;AAAA,EAAA;AAE9D;AAEgB,SAAA,UAAU,GAAe,GAAuB;AAxBhE,MAAAF,KAAA;AAyBU,WAAAA,MAAA,EAAE,UAAF,OAAAA,MAAW,EAAE,MAAM,eAAc,KAAE,EAAA,UAAF,OAAW,KAAA,EAAE,IAAI;AAC5D;AAEA,SAAS,aAAa,MAAkB,YAA6B;AA5BrE,MAAAA;AA6BS,SAAA,CAAC,gBAAeA,MAAA,KAAK,UAAL,OAAAA,MAAc,KAAK,MAAM,YAAY,EAAE,SAAS,cAAA,OAAA,SAAA,WAAY,YAAa,CAAA;AAClG;ACMA,MAAM,wBAAwB,KAExB,uBAAoC;AAAA,EACxC,OAAO;AAAA,EACP,MAAM,CAAC;AAAA,EACP,SAAS;AAAA,EACT,OAAO;AAAA,IACL,OAAO;AAAA,IACP,OAAO,CAAC;AAAA,EACV;AACF;AAEA,SAAS,YAAe,GAA2B;AACjD,SAAO,MAAM;AACf;AAEA,SAAS,gBAAgB,SAAwB;AApDjD,MAAAA;AAqDS,SAAA;AAAA,IACL,GAAG;AAAA,IACH,OAAO;AAAA,MACL,GAAG,QAAQ;AAAA,MACX,SAAQA,MAAA,QAAQ,MAAM,WAAd,OAAsB,SAAAA,IAAA,KAAA;AAAA,MAC9B,OAAO,QAAQ,MAAM,MAAM,KAAK;AAAA,IAClC;AAAA,EAAA;AAEJ;AAEO,SAAS,UAAU;AAAA,EACxB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAUE;AACM,QAAA,CAAC,aAAa,cAAc,IAAI,SAAS,YAAY,GACrD,SAAS,UAAU,6BAA6B,GAChD,gBAAgB,0BAChB,EAAC,2BAA2B,GAAS,IAAA,aAAe,EAAA,QAEpDgQ,UAAS;AAAA,IACb,MACE,aAAa,6BAA6B,MAAM,GAAG,QAAQ;AAAA,MACzD,KAAK;AAAA,MACL,QAAQ;AAAA,MACR;AAAA,MACA,UAAU;AAAA,IAAA,CACX;AAAA,IACH,CAAC,QAAQ,eAAe,QAAQ,wBAAwB;AAAA,KAGpD,oBAAoB;AAAA,IACxB,CAAC,gBACQ,YAAY;AAAA;AAAA,MAEjB,OAAO,WAAW;AAAA;AAAA,MAElB,IAAI,eAAe;AAAA;AAAA,MAEnB,qBAAqB/Q,SAAO;AAAA;AAAA,MAE5BmR,WAAS,CAAC,YAAY,OAAM,WAAS,OAAA,SAAA,QAAA,iBAAgB,qBAAqB,CAAC;AAAA;AAAA,MAE3E,IAAI,OAAO;AAAA,MACX,UAAU,CAAC,YACF;AAAA;AAAA,QAEL,GAAG;AAAA,UACD,GAAG;AAAA,UACH,SAAS;AAAA,UACT,SAAS,QAAQ;AAAA,UACjB,OAAO,QAAQ;AAAA,QAAA,CAChB;AAAA;AAAA;AAAA;AAAA;AAAA,QAKD;AAAA,UACE,MAAM,mBAAmB,EAAC,mBAAmB,OAAO,QAAQ,OAAM;AAAA;AAAA,UAElEJ,QAAO,QAAQ,OAAO,QAAQ,OAAO,EAAE;AAAA,YACrC,IAAI,CAAC,EAAC,MAAM,WAAA,MAAgB,cAAa,OAAA,SAAA,WAAA,EAAC,MAAM,WAAY,CAAA,CAAA;AAAA,YAC5D,WAAW,CAAC,WACV,WAAA,QAAA,QAAU,QACH,GAAG;AAAA,cACR,GAAG;AAAA,cACH;AAAA,cACA,SAAS;AAAA,cACT,SAAS,QAAQ;AAAA,cACjB,OAAO,QAAQ;AAAA,YAChB,CAAA,EACF;AAAA,UACH;AAAA;AAAA,UAEA,GAAG9K,OAAK,EAAE,KAAK,IAAI,MAAM,cAAA,OAAA,SAAA,WAAa,EAAC,MAAM,CAAC,GAAG,YAAY,SAAW,CAAC;AAAA,QAC3E;AAAA;AAAA,QAEA,GAAG,EAAC,SAAS,IAAM;AAAA,MAAA,CAEtB;AAAA,MACD,KAAK,CAAC,WAAW,eACR,EAAC,GAAG,WAAW,GAAG,cACxB,oBAAoB;AAAA;AAAA,MAEvB,IAAI,cAAc;AAAA,IACpB;AAAA;AAAA,IAGF,CAAC,mBAAmB8K,OAAM;AAAA,EAAA;AAQ5B,SAAO,EAAC,cALa;AAAA,IACnB,CAAC,kBAAiC,kBAAkB,aAAa;AAAA,IACjE,CAAC,iBAAiB;AAAA,KAGE,YAAW;AACnC;AC/JA,MAAM,0BAA0B;AAczB,SAAS,0BAA0B;AAAA,EACxC,sBAAsB;AAAA,EACtB;AACF,GAG8C;AAC5C,MAAI,MAAM,WAAW;AACnB,WAAO,EAAC,gBAAgB,GAAG,OAAO,CAAE,EAAA;AAOtC,QAAM,eAAe,MAAM;AAAA,IACZ,2BAAA;AACX,UAAI,YAAY;AACT,aAAA,SAAU,KAAK,KAAK,OAAO;AAC1B,cAAA,QAAQ,UAAU,GAAG;AAC3B,eAAA,aAAa,MAAM,SAGf,UAAU,KAEH,sBAAsB,MAAM,UAAU,YAAY,MAAM,WACjE,IAAI,KAAK,GAAG,GAEP;AAAA,MAAA;AAAA,IACT,EACC;AAAA,IACH,CAAC;AAAA,EAAA;AAGI,SAAA;AAAA,IACL,gBAAgB,MAAM,SAAS,aAAa;AAAA,IAC5C,OAAO,aAAa,IAAI,SAAS;AAAA,EAAA;AAErC;AAYO,SAAS,uBAAuB;AAAA,EACrC,GAAA9P;AAAA,EACA;AAAA,EACA;AACF,GAIW;AACT,MAAI,MAAM,WAAW;AACnB,WAAOA,GAAE,qCAAqC;AAGhD,QAAM,EAAC,gBAAgB,OAAO,aAAA,IAAgB,0BAA0B;AAAA,IACtE;AAAA,IACA;AAAA,EACD,CAAA,GAEK,MACJ,iBAAiB,IAAI,wCAAwC;AAG/D,SAAOA,GAAE,KAAK;AAAA,IACZ,OAAO;AAAA,IACP,OAAO;AAAA,IACP,cAAc,EAAC,OAAO,EAAC,OAAO,SAAS,MAAM,SAAO;AAAA,EAAA,CACrD;AACH;AAEA,SAAS,UAAU,YAAwB;AAjG3C,MAAAF;AAkGS,UAAAA,MAAA,WAAW,UAAX,OAAAA,MAAoB,WAAW;AACxC;AC3DA,MAAM,YAAY,MAAM,IAElBe,eAAa,OAAOC,MAAI;AAAA;AAAA,GAIjB,wBAAwB,WAAW,SAC9C,EAAC,UAAU,QAAQ,IAAI,MAAK,GAC5B,KACA;AACA,QAAM,yCAAyC,OAA8B,IAAI,GAE3E,SAAS,aAET;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAAA,IAChB,eACE,GAAA,EAAC,GAAAd,OAAK,kBAEN,iBAAiB,SAEjB,CAAC,MAAM,OAAO,IAAI,SAAkC,CAAE,CAAA,GACtD,EAAC,cAAc,YAAW,IAAI,UAAU;AAAA,IAC5C,mBAAmB;AAAA,IACnB,cAAc;AAAA,MACZ,MAAM,CAAC;AAAA,MACP,SAAS;AAAA,MACT,OAAO;AAAA,MACP,OAAO,EAAC,OAAO,IAAI,MAAK;AAAA,IAC1B;AAAA,IACA,YAAY,CAAC,WAAW;AACtB,cAAQ,OAAO,KAAK,IAAI,CAAC,EAAC,IAAA,OAAU,EAAC,OAAO,IAAI,KAAK,MAAK,CAAC;AAAA,IAC7D;AAAA,IACA;AAAA,EAAA,CACD,GAKK,oCAAoC,YAAY,MAAM;AAC7C,iBAAA;AAAA,MACX,cAAc;AAAA,MACd,SAAS,EAAC,OAAO,IAAG;AAAA,MACpB,OAAO,EAAC,OAAO,IAAI,MAAK;AAAA,IAAA,CACzB;AAAA,KACA,CAAC,cAAc,KAAK,CAAC,GAQlB,oBAAoB;AAAA,IACxB,CAAC,UAAyB;AAEtB,mBADE,QACW;AAAA,QACX,SAAS,EAAC,OAAO,IAAG;AAAA,QACpB,OAAO,EAAC,OAAO,SAAS,IAAI,MAAK;AAAA,MAAA,IAGtB;AAAA,QACX,cAAc;AAAA,QACd,SAAS,EAAC,OAAO,EAAC;AAAA,QAClB,OAAO,EAAC,OAAO,IAAI,MAAK;AAAA,MAAA,CALzB;AAAA,IAQL;AAAA,IACA,CAAC,cAAc,KAAK;AAAA,KAGhB,eAAe;AAAA,IACnB,CAAC,QAAgB;AAhHrB,UAAAF;AAiHY,YAAA,OAAMA,WAAK,KAAK,CAAC,MAAM,EAAE,UAAU,GAAG,MAAhC,OAAmC,SAAAA,IAAA;AAC3C,cACF,YAAW,QAAA,SAAA;AAAA,QACT,MAAM,eAAe,IAAI,GAAG;AAAA,QAC5B,OAAO,IAAI;AAAA,MACb,CAAA;AAAA,IAEJ;AAAA,IACA,CAAC,MAAM,QAAQ;AAAA,EAAA,GAEX,kBAAkB,QAAQ,MAAM;AACpC,QAAI,MAAM,WAAW;AAEnB,aAAOE,GAAE,gCAAgC;AAG3C,UAAM,EAAC,gBAAgB,OAAO,aAAA,IAAgB,0BAA0B,EAAC,MAAM,CAAA,GACzE,MACJ,iBAAiB,IACb,kDACA;AAGN,WAAOA,GAAE,KAAK;AAAA,MACZ,OAAO;AAAA,MACP,OAAO;AAAA,MACP,cAAc,EAAC,OAAO,EAAC,OAAO,SAAS,MAAM,SAAO;AAAA,IAAA,CACrD;AAAA,EAAA,GACA,CAAC,OAAOA,EAAC,CAAC,GAEP,eAAe,YAAY,CAAC,WAE9B;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,mBAAiB;AAAA,MACjB,YAAY,OAAO;AAAA,MACnB,cAAc,OAAO,IAAI;AAAA,MACzB,QAAO;AAAA,IAAA;AAAA,EAAA,GAGV,CAAE,CAAA,GAEC,gBAAgB;AAAA,IACpB,CAACb,QAA4B,eAA6C;AAClE,YAAA,EAAC,SAAS,QAAQ,cAAc,iBAAgBA,QAChD,aAAa,QAAQ,KAAK,SAAS;AAEvC,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,eAAa;AAAA,UACb,SACG,oBAAA,OAAA,EAAI,KAAK,YACP,UACG,aAAA,UACA,YAAY,MAAM,SAChB,oBAAC,KAAI,EAAA,SAAS,GACZ,UAAA,oBAAC,MAAK,EAAA,OAAM,UAAS,QAAO,QAAO,SAAQ,UACzC,UAAA,oBAAC0B,cAAW,EAAA,OAAM,UAAS,OAAK,IAC9B,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,GAAAb;AAAA,cACA,SAAQ;AAAA,cACR,QAAQ,EAAC,aAAa,YAAY,MAAM,MAAK;AAAA,YAAA;AAAA,UAAA,GAEjD,EACF,CAAA,EACF,CAAA,GAER;AAAA,UAEF,oBAAoB,CAAC,UAAU,YAAY;AAAA,UAC3C,qBAAmB;AAAA,UACnB;AAAA,UACA;AAAA,UACA,MAAM,CAAC,YAAY,WAAW,CAAC;AAAA,UAC/B,UAAS;AAAA,UACT,WAAU;AAAA,UACV,QAAQ;AAAA,UACR,kBAAkB,uCAAuC;AAAA,QAAA;AAAA,MAAA;AAAA,IAG/D;AAAA,IACA,CAAC,MAAM,YAAY,SAAS,YAAY,MAAM,OAAOA,EAAC;AAAA,EAAA;AAItD,SAAA,oBAAC,OAAI,EAAA,KAAK,wCACR,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,cAAY;AAAA,MACZ,cAAc;AAAA,MACd,UAAU,aAAa,IAAI;AAAA,MAC3B,IAAI;AAAA,MACJ,SAAS,YAAY;AAAA,MACrB,YAAY,EAAC,SAAS,kCAAiC;AAAA,MACvD,SAAS;AAAA,MACT,eAAe;AAAA,MACf,UAAU;AAAA,MACV,aAAa;AAAA,MACb,QAAQ;AAAA,MACR;AAAA,MACA;AAAA,MACA;AAAA,MACA,OAAO,SAAO,OAAA,SAAA,MAAA;AAAA,IAAA;AAAA,EAElB,EAAA,CAAA;AAEJ,CAAC;ACtMM,SAAS,2BAA2B;AAAA,EACzC;AAAA,EACA;AAAA,EACA;AACF,GAAgD;AACxC,QAAA;AAAA,IACJ;AAAA,IACA,OAAO,EAAC,sBAAqB;AAAA,EAAA,IAC3B,eAAe,GACb,SAAS,UACT,GAAA,EAAC,GAAAA,OAAK,kBAEN,eAAe;AAAA,IACnB,CAAC,mBAA0C,SAAS,cAAc;AAAA,IAClE,CAAC,QAAQ;AAAA,EAAA,GAIL,kBAAkB,QAAQ,MACzB,kBAIE,gBAAgB,cACpB,OAAO,CAAC,MAAM,sBAAsB,SAAS,CAAC,CAAC,EAC/C,QAAQ,CAAC,SAAS;AACX,UAAA,aAAa,OAAO,IAAI,IAAI;AAClC,QAAI,YAAY;AACd,YAAM,QAAQ,eAAe,YAAY,gBAAgB,SAAS;AAC9D,UAAA,kBAAkB,+BAAO,IAAI;AACxB,eAAA,SAAA,OAAA,SAAA,MAAO,KAAK,GAAG,OAAO,uBAAuB,QAAQ,CAAC,MAAM,EAAE,EAAA;AAEnE,UAAA,sBAAsB,+BAAO,IAAI;AACnC,eAAO,+BAAO,KAAK;AAAA,IAEvB;AACA,WAAO;EAAC,CACT,EACA,OAAqB,CAAC,KAAK,SACtB,IAAI,UAAU,CAAC,MAAM,EAAE,UAAS,OAAA,OAAA,SAAA,IAAK,KAAI,IAAI,KAC/C,IAAI,KAAK,GAAiB,GAErB,MACN,CAAA,CAAE,IAvBE,CAAA,GAwBR,CAAC,uBAAuB,iBAAiB,MAAM,CAAC,GAE7C,cAAc,YAAY,MAAM,aAAa,IAAI,GAAG,CAAC,YAAY,CAAC,GAElE,cAAc,YAAY,MAAM;AACpC,eAAA,QAAA;EAAA,GACC,CAAC,OAAO,CAAC;AAEZ,SACG,oBAAA,KAAA,EAAI,OAAO,EAAC,OAAO,oCACjB,UAAO,SAAA,QAAA,MAAA,QAAQ,SAAO,QAAA,MAAA,QACpB,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,IAAA,oBAAC,QAAK,SAAS,GAAG,QAAQ,GAAG,QAAQ,GACnC,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,YAAY,MAAM;AAAA,QAClB,cAAc,MAAM;AAAA,QACpB,QAAO;AAAA,QACP,SAAS;AAAA,MAAA;AAAA,IAAA,GAEb;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAMA,GAAE,+BAA+B;AAAA,QACvC,MAAK;AAAA,MAAA;AAAA,IACP;AAAA,EACF,EAAA,CAAA,wBAEC,uBAAsB,EAAA,UAAU,cAAc,OAAO,iBAAiB,MAAc,CAAA,EAEzF,CAAA;AAEJ;AC5EA,SAASmQ,iBAAe;AAAA,EACtB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAKG;AACK,QAAA,cAAc,YAAY,MAAM,QAAQ,KAAK,GAAG,CAAC,SAAS,KAAK,CAAC;AAElE,MAAA,eAAe,GAAG,KAAK;AAC3B,SAAI,OAAO,QAAU,OAAe,UAAU,UAC5C,gBAAgB,KAAK,KAAK,MAGpB,oBAAA,UAAA,EAAS,SAAS,aAAa,SAAS,UAAU,MAAK,WAAU,MAAM,aAAc,CAAA;AAC/F;AAEO,SAAS,4BAA4B;AAAA,EAC1C;AAAA,EACA;AAAA,EACA;AACF,GAAiD;AACzC,QAAA,eAAe,SAEf;AAAA,IACJ,OAAO,EAAC,sBAAqB;AAAA,EAC/B,IAAI,eAAe,GACb,EAAC,GAAAnQ,GAAA,IAAK,eAAA,GAEN,SAAS,UAAU,GAGnB,QAAQ,QAAQ,MACf,kBAIW,gBAAgB,cAC7B,OAAO,CAAC,MAAM,sBAAsB,SAAS,CAAC,CAAC,EAC/C,IAAI,CAAC,SAAS;AACP,UAAA,aAAa,OAAO,IAAI,IAAI;AAClC,QAAI,YAAY;AACd,YAAM,QAAQ,eAAe,YAAY,gBAAgB,SAAS;AAClE,aAAO,+BAAO,KAAK;AAAA,IACrB;AACO,WAAA;AAAA,EACR,CAAA,EACA,OAAOT,eAAa,EAGpB,IAAI,CAAC,MAAM,EAAE,IAAI,EACjB,QAAQ,CAAC,SAAS,QAAM,OAAA,SAAA,KAAA,IAAI,CAAC,MAAM,aAAa,CAAC,CAAE,CAAA,EACnD,OAAOA,eAAa,EAEF,OAA+B,CAAC,KAAK,QAAQ;AAC1D,UAAA,YAAY,IAAI,UAAU,CAAC,MAAM,EAAE,WAAU,2BAAK,MAAK;AAC7D,QAAI,YAAY,IAAI;AACZ,YAAA,YAAY,IAAI,SAAS;AAC/B,UAAI,SAAS,IAAI;AAAA,QACf,GAAG,IAAI,SAAS;AAAA,QAChB,OAAO,KAAK,CAAC,GAAG,UAAU,OAAO,IAAI,KAAK,CAAC,EAAE,KAAK;AAAA,MAAA;AAAA,IAEtD;AACE,UAAI,KAAK;AAAA,QACP,GAAG;AAAA,QACH,OAAO,CAAC,IAAI,KAAK;AAAA,MAAA,CAClB;AAEI,WAAA;AAAA,EAAA,GACN,CAAE,CAAA,IAnCI,CAAA,GAoCR,CAAC,uBAAuB,iBAAiB,MAAM,CAAC,GAE7C,cAAc;AAAA,IAClB,CAAC,MAAuB;AACtB,eAAS,CAAC;AAAA,IACZ;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA;AAIT,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAK;AAAA,UACL,WAAW;AAAA,UACX,MAAM,QAAQ,OAAO,KAAK,IAAIS,GAAE,oDAAoD;AAAA,QAAA;AAAA,MACtF;AAAA,MAEF,IAAI,gBAAgB;AAAA,MACpB,MACG,oBAAA,MAAA,EACE,gBAAM,IAAI,CAAC,MAAM,UAChB;AAAA,QAACmQ;AAAAA,QAAA;AAAA,UAGC,SAAS;AAAA,UACT,UAAU,KAAK,UAAU;AAAA,UACzB,OAAO,KAAK,MAAM,KAAK,IAAI;AAAA,UAC3B,OAAO,KAAK,SAAS;AAAA,QAAA;AAAA,QAJhB;AAAA,MAMR,CAAA,GACH;AAAA,MAEF,SAAS;AAAA,QACP,eAAe;AAAA,QACf,WAAW;AAAA,QACX,QAAQ;AAAA,QACR,QAAQ;AAAA,MACV;AAAA,IAAA;AAAA,EAAA;AAGN;AAEA,SAAS,aACP,QACkC;AAClC,SAAO,kBAAkB,MAAM,IAAI,SAAS,EAAC,OAAO,WAAW,GAAG,MAAM,EAAE,GAAG,OAAO,OAAM;AAC5F;AC3IO,MAAM,UAAU,MACpB,oBAAA,OAAA,EAAI,OAAM,OAAM,QAAO,OAAM,SAAQ,aAAY,MAAK,QAAO,OAAM,8BAClE,UAAA;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,GAAE;AAAA,IACF,MAAK;AAAA,EAAA;AACP,GACF,GCNW,SAAS,MACnB,oBAAA,OAAA,EAAI,OAAM,OAAM,QAAO,OAAM,SAAQ,aAAY,MAAK,QAAO,OAAM,8BAClE,UAAA;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,GAAE;AAAA,IACF,MAAK;AAAA,EAAA;AACP,GACF,GCNW,UAAU,MACpB,oBAAA,OAAA,EAAI,OAAM,OAAM,QAAO,OAAM,SAAQ,aAAY,MAAK,QAAO,OAAM,8BAClE,UAAA;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,GAAE;AAAA,IACF,MAAK;AAAA,EAAA;AACP,GACF,GCNW,SAAS,MACnB,oBAAA,OAAA,EAAI,OAAM,OAAM,QAAO,OAAM,SAAQ,aAAY,MAAK,QAAO,OAAM,8BAClE,UAAA;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,GAAE;AAAA,IACF,MAAK;AAAA,EAAA;AACP,GACF;ACgGK,SAAS,qBAOd,YAOmB;AACZ,SAAA;AACT;ACtHO,SAAS,OAAO,KAAsB;AACpC,SAAA,KAAK,UAAU,GAAG;AAC3B;ACmBO,MAAM,iBAAiB;AAAA,EAC5B,iBAAsC;AAAA,IACpC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,OAAO,SAAS,KAAK,KAAK,YAAY,SAAS,SAAS,QAAQ,OAAO,KAAK,CAAC,KAAK;AAAA,IACpF,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,cAAmC;AAAA,IACjC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,OAAO,SAAS,KAAK,KAAK,YAAY,SAAS,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IACnF,MAAM;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,eAAoC;AAAA,IAClC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,OAAO,SAAS,KAAK,KAAK,YAAY,SAAS,SAAS,QAAQ,OAAO,KAAK,CAAC,KAAK;AAAA,IACpF,MAAM;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,cAAmC;AAAA,IACjC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,OAAO,SAAS,KAAK,KAAK,YAAY,SAAS,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IACnF,MAAM;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,eAAoC;AAAA,IAClC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,OAAO,SAAS,KAAK,KAAK,YAAY,SAAS,SAAS,QAAQ,OAAO,KAAK,CAAC,KAAK;AAAA,IACpF,MAAM;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,oBAAyC;AAAA,IACvC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,OAAO,SAAS,KAAK,KAAK,YAAY,SAAS,SAAS,QAAQ,OAAO,KAAK,CAAC,KAAK;AAAA,IACpF,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,iBAAsC;AAAA,IACpC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,OAAO,SAAS,SAAA,OAAA,SAAA,MAAO,EAAE,KAAK,OAAO,SAAS,+BAAO,IAAI,KAAK,YAC1D,SAAS,SAAS,OAAO,OAAO,SAAA,OAAA,SAAA,MAAO,IAAI,CAAC,aAAa,SAAS,OAAO;AAAA,MACvE,SAAO,OAAA,SAAA,MAAA;AAAA,IACR,CAAA,KACD;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,mBAAwC;AAAA,IACtC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,GAAG,OAAO,KAAK,CAAC,OAAO,SAAS,KAAK;AAAA,IAC5D,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,sBAA2C;AAAA,IACzC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAS,YAAY,KAAK,OAAO,KAAK,CAAC,OAAO,SAAS,MAAM;AAAA,IAC/D,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,wBAA6C;AAAA,IAC3C,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,OAAO,MAAM,IAAI,CAAC,OAAO,SAAS,YAAY;AAAA,IAC9E,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,2BAAgD;AAAA,IAC9C,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,WAAW,MAAA,MACvB,SAAO,QAAA,MAAA,QAAQ,YAAY,KAAK,OAAO,MAAM,IAAI,CAAC,OAAO,SAAS,aAAa;AAAA,IACjF,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAEV,GCzHM,gBAAgB,cAA6B,IAAI;AAGhD,SAAS,eAAe,EAAC,UAAU,GAAGhR,UAA6B;AAClE,QAAA,eAAe,WAAW,aAAa,GACvC,EAAC,kBAAkB,QAAA,IAAW;AAEpC,MAAI,YAAYA,QAAO;AACf,UAAA,EAAC,OAAU,IAAAA;AACjB,+BAAQ,cAAc,UAAd,EAAuB,OAAO,QAAS,SAAS,CAAA;AAAA,EAC1D;AAEA,MAAI,UAAUA,QAAO;AACb,UAAA,EAAC,KAAI,IAAIA,QACT,SAAS,QAAQ,KAAK,CAAC,MAAM,EAAE,SAAS,IAAI;AAClD,QAAI,CAAC;AACH,YAAM,IAAI,MAAM,qCAAqC,IAAI,yBAAyB;AAEhF,WAAA,iBAAiB,SAAe,oBAAA,UAAA,EAAG,SAAS,CAAA,IAExC,oBAAA,cAAc,UAAd,EAAuB,OAAO,QAAS,SAAS,CAAA;AAAA,EAC1D;AAEA,QAAM,IAAI;AAAA,IACR;AAAA,EAAA;AAEJ;AAMO,SAAS,YAAoB;AAC5B,QAAA,SAAS,WAAW,aAAa;AACvC,MAAI,CAAC;AAAc,UAAA,IAAI,MAAM,iCAAiC;AACvD,SAAA;AACT;ACxCO,SAAS,iBAAiBA,QAA+B;AACxD,QAAA,EAAC,GAAAa,OAAK;AAGV,SAAA,oBAAC,OAAK,GAAGb,QACP,+BAAC,MAAK,EAAA,OAAM,cAAa,KAAK,GAC5B,UAAA;AAAA,IAAA,oBAAC,cAAa,EAAA,MAAK,WACjB,UAAA,oBAAC,qBAAmB,CAAA,GACtB;AAAA,IACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,MAAC,oBAAA,cAAA,EAAa,MAAM,GAAG,MAAK,WAAU,QAAO,UAC1C,UAAEa,GAAA,0CAA0C,EAC/C,CAAA;AAAA,MACA,oBAAC,gBAAa,MAAM,GAAG,MAAK,WACzB,UAAAA,GAAE,6DAA6D,GAClE;AAAA,MACA,oBAAC,gBAAa,MAAM,GAAG,MAAK,WACzB,UAAAA,GAAE,6DAA6D,GAClE;AAAA,IAAA,GACF;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACfgB,SAAA,qBAAqB,EAAC,aAAuC;AACrE,QAAA,uBAAuB,2BACvB,eAAe;AAAA,IACnB,CAACrB,QAAe,iBAAiB,sBAAsBA,GAAE;AAAA,IACzD,CAAC,oBAAoB;AAAA,EAAA;AAGrB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA,qCAAkB,cAAa,EAAA;AAAA,MAE9B,UAAC,CAAA,UAAW,oBAAA,aAAA,EAAY,MAAc,CAAA;AAAA,IAAA;AAAA,EAAA;AAG7C;AAEA,SAAS,YAAY,EAAC,SAA4B;AAEhD,SACG,oBAAA,MAAA,EAAK,SAAS,GAAG,QAAQ,GACxB,UAAC,qBAAA,MAAA,EAAK,OAAM,UAAS,SAAQ,iBAAgB,MAAK,UAChD,UAAA;AAAA,IAAA,oBAAC,MAAK,EAAA,SAAS,GAAG,QAAQ,GAAG,QAAQ,GAAG,MAAK,eAC3C,UAAC,oBAAAmC,QAAA,EACC,UAAC,oBAAA,oBAAA,CAAA,CAAmB,EACtB,CAAA,GACF;AAAA,yBACC,OAAM,EAAA,MAAM,GAAG,OAAO,GAAG,YAAY,GACpC,UAAA;AAAA,MAAA,oBAACA,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,cAAa,YAAW,QAAO,UACjD,WAAA,SAAA,OAAA,SAAA,MAAO,qBAAoB,MAAM,KACpC;AAAA,MACA,oBAACA,UAAK,MAAM,GAAG,OAAK,IACjB,UAAA,YAAY,MAAM,IAAI,EACzB,CAAA;AAAA,IAAA,GACF;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;AAEA,SAAS,eAAe;AAEpB,SAAA,oBAAC,MAAK,EAAA,SAAS,GAAG,QAAQ,GACxB,UAAA,qBAAC,MAAK,EAAA,OAAM,UAAS,SAAQ,cAC3B,UAAA;AAAA,IAAA,oBAAC,MAAK,EAAA,SAAS,GAAG,QAAQ,GAAG,QAAQ,GAAG,MAAK,eAC3C,UAAC,oBAAAA,QAAA,EACC,UAAC,oBAAA,oBAAA,CAAA,CAAmB,EACtB,CAAA,GACF;AAAA,yBACC,OAAM,EAAA,MAAM,GAAG,OAAO,GAAG,YAAY,GACpC,UAAA;AAAA,MAAC,oBAAA,cAAA,EAAa,UAAQ,IAAC,OAAO,EAAC,OAAO,OAAA,GAAS,QAAQ,EAAG,CAAA;AAAA,MAC1D,oBAAC,cAAa,EAAA,UAAQ,IAAC,OAAO,EAAC,OAAO,OAAA,GAAS,QAAQ,EAAG,CAAA;AAAA,IAAA,GAC5D;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACxDA,MAAM,YAAY,OAAO,IAAI;AAAA;AAAA;AAAA,GAKvBgC,UAAQ,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUL,SAAA,sBAAsB,EAAC,aAAwC;AACvE,QAAA,uBAAuB,2BACvB,eAAe;AAAA,IACnB,CAACnE,QAAe,kBAAkB,sBAAsBA,GAAE;AAAA,IAC1D,CAAC,oBAAoB;AAAA,EAAA;AAGrB,SAAA,oBAAC,uBAAoB,cAA4B,WAC9C,WAAC,UAAU,oBAAC,cAAa,EAAA,MAAc,CAAA,EAC1C,CAAA;AAEJ;AAEA,SAAS,aAAa,EAAC,SAA6B;AAClD,QAAM,CAAC,QAAQ,SAAS,IAAI,SAAS,EAAK,GACpC,WAAW,GAAG,MAAM,GAAG,kBACvB,aAAa,YAAY,MAAM,UAAU,EAAI,GAAG,CAAA,CAAE;AAExD,SACG,qBAAA,WAAA,EAAU,sBAAoB,IAAC,QAAM,IACnC,UAAA;AAAA,IAAA,CAAC,UAAW,oBAAA,cAAA,EAAa,MAAI,IAAC,UAAQ,IAAC;AAAA,IACvC,oBAAAmE,SAAA,EAAM,QAAQ,YAAY,KAAK,UAAU;AAAA,EAC5C,EAAA,CAAA;AAEJ;AC7CgB,SAAA,aAAa,EAAC,aAA+B;AAC3D,SAAK,YAGD,UAAU,MAAM,WAAW,kBAAkB,wBACvC,sBAAqB,EAAA,WAAsB,IAEjD,UAAU,MAAM,WAAW,mBAAmB,wBACxC,uBAAsB,EAAA,UAAsB,CAAA,IAE/C,OARE;AASX;ACEA,MAAM,aAAwC;AAAA,EAC5C,MAAM;AAAA,EACN,OAAO;AACT,GAEM,eAAe,OAAO,GAAG;AAAA;AAAA;AAIxB,SAAS,uBAAuB,MAAkB;AACvD,SAAO,SAAiC;AAAA,IACtC;AAAA,IACA;AAAA,EAAA,GAC8C;AACxC,UAAA,CAAC,qBAAqB,sBAAsB,IAAI,SAA6B,IAAI,GACjF,CAAC,yBAAyB,0BAA0B,IAAI;AAAA,MAC5D;AAAA,IAAA;AAKE,mBAAe;AAAA,UAEb,EAAC,MAAM,MAAS,IAAA,UAAY,EAAA,MAC5B,EAAC,GAAA9C,GAAC,IAAI,eAIN,GAAA,eAAe,QAAQ,MAAM;AACjC,cAAQ,MAAM;AAAA,QACZ,KAAK;AACI,iBAAA,KAAK,aAAa,OAAO,CAAC,MAAM,EAAE,SAAS,WAAW,IAAI;AAAA,QACnE,KAAK;AACI,iBAAA,MAAM,aAAa,OAAO,CAAC,MAAM,EAAE,SAAS,YAAY,IAAI;AAAA,QACrE;AACE,gBAAM,MAAM,4BAA4B;AAAA,MAC5C;AAAA,IAAA,GACC,CAAC,KAAK,cAAc,MAAM,YAAY,CAAC,GAEpC,eAAe,MAAA,GAEf,SAAS,UAAU,6BAA6B,GAEhD,cAAc,YAAY,MAAM;AACT,iCAAA,IAAI,GAC/B,SAAS,IAAI;AAAA,OACZ,CAAC,QAAQ,CAAC,GAEP,yBAAyB,YAAY,MAAM;AAC/C,6BAAuB,IAAI;AAAA,IAAA,GAC1B,CAAE,CAAA,GAECoQ,+BAA8B;AAAA,MAClC,CAAC,oBAAuC;AAChC,cAAA,aAAa,gBAAgB,CAAC;AACT,mCAAA,UAAU,GACrC;MACF;AAAA,MACA,CAAC,sBAAsB;AAAA,IAAA,GAGnB,0BAA0B;AAAA,MAC9B,CAAC,WAAwB,uBAAuB,MAAM;AAAA,MACtD,CAAC;AAAA,IACH;AAEA,cAAU,MAAM;AAGZ,OAAA,2BAAA,OAAA,SAAA,wBAAyB,UAAS,qBAClC,QAAO,mEAAyB,UAAU,YAEtC,QACF,SAAS;AAAA,QACP,MAAM,wBAAwB;AAAA,QAC9B,OAAO,WAAW,IAAI;AAAA,MAAA,CACvB;AAAA,IAGJ,GAAA,CAAC,QAAQ,UAAU,uBAAuB,CAAC;AAExC,UAAA,uBAAuB,uBAAqB,OAAA,SAAA,oBAAA,WAI5C,aAAapQ,GAAE,QAAQ,+BAA+B,8BAA8B;AAAA,MACxF,SAAS;AAAA,IAAA,CACV,GAEK,SAAS,IAAI,MAAM,kBAAkB,SAAS,UAAU,YAAY,EAAE;AAE5E,WACG,oBAAA,cAAA,EACC,UAAC,qBAAA,OAAA,EAAM,OAAO,GAEX,UAAA;AAAA,MAAuB,uBAAA,4CACrB,QACC,EAAA,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,WAAW;AAAA,UACX,mBAAmBA,GAAE,8BAA8B,EAAC,SAAS,MAAK;AAAA,UAClE,SAAS;AAAA,UACT,UAAUoQ;AAAA,UACV,gBAAgB,CAAC;AAAA,UACjB,eAAc;AAAA,UACd;AAAA,QAAA;AAAA,MAAA,GAEJ;AAAA,MAID,SAAS,oBAAC,cAAa,EAAA,WAAW,MAAO,CAAA;AAAA,MAE1C,qBAAC,MAAK,EAAA,KAAK,GAER,UAAA;AAAA,QAAA,aAAa,WAAW,KAAM,oBAAA,kBAAA,EAAiB,SAAS,GAAG;AAAA,QAG3D,aAAa,SAAS,KAElB,oBAAA,UAAA,EAAA,UAAA,aAAa,SAAS,IACrB;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,QACE;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAM,QAAQ,WAAW;AAAA,gBACzB,WAAW;AAAA,gBACX,MAAK;AAAA,gBACL,OAAO,QAAQ,SAAS;AAAA,gBACxB,MAAM;AAAA,cAAA;AAAA,YACR;AAAA,YAEF,IAAI;AAAA,YACJ,MACG,oBAAA,MAAA,EACE,UAAa,aAAA,IAAI,CAAC,WACjB;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAM,OAAO,QAAQ;AAAA,gBAGrB,SAAS,MAAM,wBAAwB,MAAM;AAAA,gBAC7C,OACG,OAAO,UAAUpQ,GAAE,OAAO,OAAO,IAAI,OAAO,UAC7C,UAAU,OAAO,IAAI;AAAA,cAAA;AAAA,cALlB,OAAO;AAAA,YAQf,CAAA,GACH;AAAA,YAEF,SAAS;AAAA,cACP,eAAe;AAAA,cACf,QAAQ;AAAA,cACR,QAAQ;AAAA,YACV;AAAA,UAAA;AAAA,QAAA,IAGF;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAM,QAAQ,WAAW;AAAA,YACzB,MAAK;AAAA,YAEL,SAAS,MAAM,wBAAwB,aAAa,CAAC,CAAC;AAAA,YACtD,OAAO,QAAQ,SAAS;AAAA,YACxB,MAAM;AAAA,UAAA;AAAA,QAAA,GAGZ;AAAA,QAID,SACC;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,SAAS;AAAA,YACT,OAAM;AAAA,YACN,MAAMA,GAAE,2BAA2B;AAAA,YACnC,MAAK;AAAA,UAAA;AAAA,QACP;AAAA,MAAA,GAEJ;AAAA,IAAA,EACF,CAAA,EACF,CAAA;AAAA,EAAA;AAGN;ACjMO,MAAM,iBAAiB;AAAA,EAC5B,gBAAqC;AAAA,IACnC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,kBAAkB,OAAO,MAAM,IAAI,CAAC,KAAK;AAAA,IAClF,cAAc;AAAA,IACd,gBAAgB,uBAAuB,MAAM;AAAA,IAC7C,OAAO;AAAA,IACP,MAAM;AAAA,EAAA;AAAA,EAER,mBAAwC;AAAA,IACtC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,kBAAkB,OAAO,MAAM,IAAI,CAAC,KAAK;AAAA,IAClF,cAAc;AAAA,IACd,gBAAgB,uBAAuB,MAAM;AAAA,IAC7C,OAAO;AAAA,IACP,MAAM;AAAA,EAAA;AAAA,EAER,iBAAsC;AAAA,IACpC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,kBAAkB,OAAO,MAAM,IAAI,CAAC,KAAK;AAAA,IAClF,cAAc;AAAA,IACd,gBAAgB,uBAAuB,OAAO;AAAA,IAC9C,OAAO;AAAA,IACP,MAAM;AAAA,EAAA;AAAA,EAER,oBAAyC;AAAA,IACvC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,kBAAkB,OAAO,MAAM,IAAI,CAAC,KAAK;AAAA,IAClF,cAAc;AAAA,IACd,gBAAgB,uBAAuB,OAAO;AAAA,IAC9C,OAAO;AAAA,IACP,MAAM;AAAA,EAAA;AAEV;AC/CO,SAAS,yBAAyB,EAAC,UAAU,SAA8C;AAC1F,QAAA;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAAA,IAChB,eACE,GAAA,EAAC,GAAAA,GAAK,IAAA,eAAA,GAEN,eAAe;AAAA,IACnB,CAAC,UAA0C;AAChC,eAAA,MAAM,cAAc,UAAU,MAAM;AAAA,IAC/C;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA;AAIT,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,UAAU,aAAa,IAAI;AAAA,MAC3B,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,OAAO,OAAO,SAAA,OAAA,QAAS,EAAI;AAAA,MAE3B,UAAA;AAAA,QAAA,oBAAC,UAAO,EAAA,OAAM,QAAQ,UAAAA,GAAE,4BAA4B,GAAE;AAAA,4BACrD,UAAO,EAAA,OAAM,SAAS,UAAAA,GAAE,6BAA6B,GAAE;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAG9D;ACrBO,MAAM,mBAAmB;AAAA,EAC9B,cAAmC;AAAA,IACjC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MAAA,MACvB,OAAO,QAAU,OAAe,YAAY,GAAG,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IACnF,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAEV,GCVM,gBAAgB,OAAOc,MAAI;AAAA;AAAA;AAI1B,SAAS,sBAAsB,EAAC,UAAU,SAAoC;AAC7E,QAAA,EAAC,GAAAd,OAAK;AAEV,SAAA,qBAAC,QAAK,OAAM,UAAS,KAAK,GAAG,SAAQ,YAAW,WAAW,GACzD,UAAA;AAAA,IAAA,oBAAC,OACC,EAAA,UAAA,oBAAC,eAAc,EAAA,OAAK,IAAC,SAAS,UAAU,MAAM,GAAG,QAAO,UACrD,UAAEA,GAAA,oCAAoC,EACzC,CAAA,GACF;AAAA,IACA,oBAACqK,YAAO,SAAS,OAAO,OAAOrK,GAAE,oCAAoC,GAAG,UAAoB;AAAA,EAC9F,EAAA,CAAA;AAEJ;ACVa,MAAA,kBAAkB,cAAgD,MAAS;ACZjF,SAAS,cAAoC;AAC5C,QAAA,UAAU,WAAW,eAAe;AAC1C,MAAI,YAAY;AACR,UAAA,IAAI,MAAM,6DAA6D;AAExE,SAAA;AACT;ACAO,SAAS,eAAeb,QAG5B;AACD,QAAM,EAAC,GAAAa,GAAC,IAAI,kBACN,iBAAiB,kBAAkB,EAAC,OAAO,QAAQ,MAAM,UAAU,CAAA,GACnE,EAAC,YAAe,IAAA,YAAA,GAEhB,EAAC,iBAAiB,WAAU,IAAIb,QAEhC,uBAAuB,YAAY,MAAM,gBAAgB,EAAE,GAAG,CAAC,eAAe,CAAC,GAE/E,uBAAuB,YAAY,MAAM,gBAAgB,CAAC,GAAG,CAAC,eAAe,CAAC;AAEpF,8BACG,MAAK,EAAA,OAAM,UAAS,MAAM,GAAG,SAAQ,iBACpC,UAAA;AAAA,IAAA,oBAAC,UAAO,aAAa,GAAG,OAAO,GAE7B,8BAAC2B,QAAK,EAAA,MAAM,GAAG,QAAO,UACnB,UAAW,WAAA,eAAe,OAAO,WAAW,CAAC,EAChD,CAAA,GACF;AAAA,IACA,qBAAC,MAAK,EAAA,OAAM,UACV,UAAA;AAAA,MAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,cAAYd,GAAE,wCAAwC;AAAA,UACtD,MAAK;AAAA,UACL,SAAS;AAAA,UACT,MAAMA,GAAE,6BAA6B;AAAA,QAAA;AAAA,MACvC;AAAA,MACA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM;AAAA,UACN,MAAK;AAAA,UACL,SAAS;AAAA,UACT,cAAc,EAAC,SAASA,GAAE,sCAAsC,EAAC;AAAA,QAAA;AAAA,MACnE;AAAA,MACA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM;AAAA,UACN,MAAK;AAAA,UACL,SAAS;AAAA,UACT,cAAc,EAAC,SAASA,GAAE,kCAAkC,EAAC;AAAA,QAAA;AAAA,MAC/D;AAAA,IAAA,GACF;AAAA,EACF,EAAA,CAAA;AAEJ;AC1CA,MAAM,YAAY,OAAO,IAAI,CAAC,EAAC,YACtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAQO,MAAM,OAAO,MAAM,KAAK,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA,GAKrD,GAEK,aAAa,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAsBvB,SAAS,YAAY,EAAC,MAAM,YAA6B;AACxD,QAAA,cAAc,YAAY,MAAM;AACpC,aAAS,IAAI;AAAA,EACZ,GAAA,CAAC,MAAM,QAAQ,CAAC,GAEb,EAAC,MAAM,cAAc,SAAS,iBAAiB,aAAa,YAAe,IAAA,YAAA,GAE3E,aAAa,gBAAgB,UAAU,MAAM,YAAY,GACzD,cAAc,eAAe,gBAAgB,UAAU,MAAM,YAAY,GACzE,YAAY,eAAe,mBAAmB,UAAU,MAAM,eAAe,GAE7E,iBAAiB,YAAY,MAAM,WAAW,GAC9C,YAAY,eAAe,UAAU,MAAM,WAAW,GACtD,UAAU,UAAU,MAAM,oBAAI,KAAM,CAAA,GAEpC,gBACJ,gBACA,mBACA,CAAC,eACD,CAAC,aACD,QAAQ,MAAM,YAAY,KAC1B,SAAS,MAAM,eAAe;AAG9B,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,sBAAoB;AAAA,MACpB,cAAY,KAAK,aAAa;AAAA,MAC9B,gBAAc;AAAA,MACd,iBAAe,YAAY,KAAO;AAAA,MAClC,gBAAc,YAAY,SAAS;AAAA,MACnC,WAAQ;AAAA,MACR,iBAAe;AAAA,MACf,mBAAiB,cAAc,KAAO;AAAA,MACtC,qBAAmB,gBAAgB,KAAO;AAAA,MAC1C,aAAY;AAAA,MACZ,SAAS;AAAA,MACT,UAAU;AAAA,MACV,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,MAAK;AAAA,MACL,UAAU,cAAc,eAAe;AAAA,MACvC,UAAU;AAAA,MACV,MAAM,gBAAgB,YAAY;AAAA,MAEjC,UAAA;AAAA,QACC,WAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,QAAO;AAAA,YACP,qBAAoB;AAAA,YACpB,cAAa;AAAA,YACb,SAAQ;AAAA,YACR,OAAM;AAAA,YAEN,8BAAC,UAAO,EAAA,IAAG,MAAK,IAAG,MAAK,GAAE,OAAM;AAAA,UAAA;AAAA,QAClC;AAAA,QAEF;AAAA,UAACc;AAAAA,UAAA;AAAA,YACC,OAAM;AAAA,YACN,OAAO,CAAC,cAAc,CAAC;AAAA,YACvB,MAAM;AAAA,YACN,QAAQ,iBAAiB,WAAW;AAAA,YAEnC,eAAK,QAAQ;AAAA,UAAA;AAAA,QAChB;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;AC/GO,MAeM,sBAAkD;AAAA,EAC7D;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAEwB,MAAM,GAAG,EAAE;AAEtB,MAAA,aAAa,CAAC,WAAW,aAAa,aAAa,YAAY,GAG/D,gBAAgB,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC,GC1BxC,uBAAuB,CAAC,MAAY,iBAAoD;AACtF,QAAA,WAAW,aAAa,IAAI;AAC3B,SAAA;AAAA,IACL;AAAA,MACE,OAAO;AAAA,MACP,KAAK,eAAe,QAAQ;AAAA,IAC9B;AAAA,IACA;AAAA,MACE,cAAc,iBAAiB,IAAI,IAAI;AAAA,IACzC;AAAA,EAAA;AAEJ,GAEM,4BAA4B,CAAC,eAC1B,WAAW,IAAI,CAAC,cAAc;AAAA,EACnC;AAAA,EACA,GAAG,cAAc,IAAI,CAAC,MAAM,QAAQ,WAAW,CAAC,CAAC;AACnD,CAAC,GAQU,kBAAkB,CAAC,SAAuB;AAC/C,QAAA,EAAC,aAAY;AACnB,SAAO,0BAA0B,qBAAqB,MAAM,SAAS,QAAQ,CAAC,EAAE;AAAA,IAC9E,CAAC,UAAgB;AAAA,MACf,QAAQ,QAAQ,KAAK,CAAC,CAAC;AAAA,MACvB;AAAA,IAAA;AAAA,EACF;AAEJ,GChCM,qBAAqB;AAAA;AAAA,EAEzB,GAAG;AAAA;AAAA,EAGH,GAAG,CAAC,oBAAoB,CAAC,GAAG,GAAG,oBAAoB,MAAM,GAAG,CAAC,CAAC;AAChE,GAOM,aAAa,OAAO,IAAI;AAAA;AAAA;AAIvB,SAAS,cAAc,EAAC,QAAQ,YAA+B;AAC9D,QAAA,EAAC,aAAa,iBAAgB,YAC9B,GAAA,EAAC,GAAAd,GAAC,IAAI;AAGV,SAAA,oBAAC,KAAI,EAAA,eAAa,UAAU,IAAO,WAAQ,iBACzC,UAAA,qBAAC,YAAW,EAAA,MAAM,GACf,UAAA;AAAA,IAAmB,mBAAA,YAAY,EAAE,IAAI,CAAC,mCACpC,KAAqB,EAAA,eAAe,GAAG,YAAY,GAClD,UAAA,oBAACc,UAAK,OAAM,UAAS,MAAM,GAAG,QAAO,UAClC,aAAE,UAAU,EACf,CAAA,EAHQ,GAAA,UAIV,CACD;AAAA,IAEA,gBAAgB,WAAW,EAAE;AAAA,MAAI,CAAC,MAAM,YACvC,KAAK,KAAK,IAAI,CAAC,aAAa,WAExB;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM;AAAA,UAGN;AAAA,QAAA;AAAA,QADK,GAAG,OAAO,IAAI,MAAM;AAAA,MAAA,CAI9B;AAAA,IACH;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACxBA,MAAM,yBACJ;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,uBAAmB;AAAA,IACnB,OAAO,EAAC,UAAU,UAAU,UAAU,YAAY,SAAS,OAAM;AAAA,IACjE,UAAU;AAAA,EAAA;AACZ;AAGK,SAAS,SAAS3B,QAAsB;AAC7C,QAAM,EAAC,MAAM,SAAS,UAAU,aAAa,eAAcA,QAErD,CAAC,iBAAiB,kBAAkB,IAAI,SAA6B,IAAI,GACzE,CAAC,gBAAgB,iBAAiB,IAAI,SAAS,EAAK,GACpD,CAAC,aAAa,cAAc,IAAI,SAAS,4BAAY,MAAM,GAE3D,eAAe,OAAoB,QAAQ,IAAI,GAC/C,kBAAkB,OAAoB,WAAW,IAAI,GAErD;AAAA,IACJ,UAAU,EAAC,UAAU,aAAY;AAAA,EAC/B,IAAA,iBAEE,GAAA,sBAAsB,YAAY,MAAM;AAtDhD,QAAAW;AAuDqB,KAAAA,MAAA,mBAAA,OAAA,SAAA,gBAAA,cAA2B,6BAA5C,QAAsEA,IAAA,MAAA;AAAA,EACrE,GAAA,CAAC,eAAe,CAAC,GAEd,mBAAmB;AAAA,IACvB,CAAC,MAAY;AACL,YAAA,eAAeuC,MAAI,GAAG;AAAA,QAC1B,OAAO,EAAE,SAAS;AAAA,QAClB,SAAS,EAAE,WAAW;AAAA,QACtB,SAAS;AAAA,QACT,cAAc;AAAA,MACf,CAAA,GAEK,wBAAwB,QAAQ,SAAS,cAAc,IAAI,GAC3D,qBAAqB,WAAW,QAAQ,cAAc,OAAO;AAEnE,UAAI,aAAa;AAEf,YAAI,yBAAyB,oBAAoB;AAC/C,mBAAS,EAAC,MAAM,cAAc,SAAS,KAAK,CAAA;AAC5C;AAAA,QACF;AAGE,iBAFE,iBAEO,EAAC,MAAM,QAAQ,MAAM,SAAS,aAG9B,IAAA,EAAC,MAAM,cAAc,SAAS,OAAO,OAAO,WAAW,MAHZ;AAAA,MAKxD;AACW,iBAAA,EAAC,MAAM,aAAA,CAAa;AAAA,IAEjC;AAAA,IACA,CAAC,MAAM,SAAS,UAAU,gBAAgB,WAAW;AAAA,EAAA,GAGjD,iBAAiB,YAAY,MAAM;AACjC,UAAA,0BAAU;AACZ,kBACF,eAAe,GAAG,IAElB,SAAS,EAAC,MAAM,KAAI;AAAA,EAAA,GAErB,CAAC,UAAU,aAAa,cAAc,CAAC,GAEpC,gBAAgB;AAAA,IACpB,CAAC,UAAyB;AApG9B,UAAAvC;AAqGM,UAAK,WAAW,SAAS,MAAM,GAAG,GAIlC;AAAA,YADA,MAAM,kBACD,MAAM,OAAuB,aAAa,oBAAoB,GAAG;AAChD;AACpB;AAAA,QACF;AACI,cAAM,QAAQ,aAChB,eAAe,QAAQ,aAAa,EAAE,CAAC,GAErC,MAAM,QAAQ,eAChB,eAAe,QAAQ,aAAa,CAAC,CAAC,GAEpC,MAAM,QAAQ,eAChB,eAAe,QAAQ,aAAa,EAAE,CAAC,GAErC,MAAM,QAAQ,gBAChB,eAAe,QAAQ,aAAa,CAAC,CAAC,IAGxCA,MAAiB,mBAAA,OAAA,SAAA,gBAAA,cAA2B,6BAA5C,QAAsEA,IAAA;MAAA;AAAA,IACxE;AAAA,IACA,CAAC,iBAAiB,qBAAqB,aAAa,cAAc;AAAA,KAG9D,kBAAkB;AAAA,IACtB,CAAC,OAAe,eAAe,UAAU,aAAa,EAAE,CAAC;AAAA,IACzD,CAAC,aAAa,cAAc;AAAA,EAAA;AAG9B,SAAA,UAAU,MAAM;AACM;KACnB,CAAC,mBAAmB,CAAC,GAExB,UAAU,MAAM;AAxIlB,QAAAA;AAyIuC,KAAAA,MAAA,SAAS,kBAAT,QAAwBA,IAAA;AAAA,MACzD;AAAA,IAAA,KAMA,oBAAoB;AAAA,KAErB,CAAC,qBAAqB,WAAW,CAAC,GAErC,UAAU,MAAM;AApJlB,QAAAA,KAAA;AAqJU,UAAA,eAAc,QAAM,OAAA,SAAA,KAAA,QAAA,SAAcA,MAAa,aAAA,YAAb,OAAsB,SAAAA,IAAA,YACxD,kBAAiB,WAAA,OAAA,SAAA,QAAS,QAAc,SAAA,KAAA,gBAAgB,YAAhB,OAAA,SAAA,GAAyB,YACjE,kBAAkB,eAAe,CAAC,gBAClC,qBAAqB,CAAC,eAAe,gBACrC,qBAAqB,QAAQ,WAAW,QAAQ,MAAM,OAAO;AAG/D,wBACE,uBACF,kBAAkB,EAAI,GACtB,SAAS,EAAC,MAAM,SAAS,KAAA,CAAK,IAEhC,kBAAkB,CAAC,CAAC,IAAI,GAEpB,QAAM,eAAe,IAAI,IAG3B,uBACE,uBACF,kBAAkB,EAAI,GACtB,SAAS,EAAC,MAAM,SAAS,SAAS,KAAK,CAAA,IAGzC,kBAAkB,CAAC,CAAC,QAAQ,CAAC,OAAO,GAEhC,WAAS,eAAe,OAAO,IAGjC,eAAe,mBACjB,kBAAkB,EAAI,GAElB,QAAM,eAAe,IAAI,IAG/B,aAAa,UAAU,QAAQ,MAC/B,gBAAgB,UAAU,WAAW;AAAA,KACpC,CAAC,MAAM,SAAS,QAAQ,CAAC,GAG1B;AAAA,IAAC,gBAAgB;AAAA,IAAhB;AAAA,MACC,OAAO;AAAA,QACL;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,MAEA,UAAC,qBAAA,KAAA,EAAI,WAAQ,YAAW,KAAK,oBAE3B,UAAA;AAAA,QAAC,oBAAA,MAAA,EACC,UAAC,oBAAA,KAAA,EAAI,MAAM,GACT,UAAC,oBAAA,gBAAA,EAAe,iBAAkC,YAAY,eAAgB,CAAA,EAChF,CAAA,GACF;AAAA,QAGA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,sBAAkB;AAAA,YAClB,WAAW;AAAA,YACX,WAAW;AAAA,YACX,UAAS;AAAA,YACT,UAAU;AAAA,YAEV,UAAA;AAAA,cAAC,oBAAA,eAAA,EAAc,UAAU,iBAAkB,CAAA;AAAA,cAC1C;AAAA,YAAA;AAAA,UAAA;AAAA,QACH;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAAA;AAGN;AChNO,SAAS,WAAW,EAAC,MAAM,SAAS,UAAU,aAAa,cAA8B;AAC9F,QAAM,eAAe;AAAA,IACnB,CAAC,UAAsD;AACrD,eAAS,KAAK;AAAA,IAChB;AAAA,IACA,CAAC,QAAQ;AAAA,EAAA;AAIT,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA,UAAU;AAAA,MACV;AAAA,MACA;AAAA,IAAA;AAAA,EAAA;AAGN;AC1Ba,MAAA,qBAAqB,OAAO,GAAG,EAGzC,CAAC,EAAC,aAAa,kBACT,MAAA;AAAA;AAAA;AAAA;AAAA,oBAIW,CAAC,EAAC,YACd,cAAc,MAAM,OAAO,MAAM,KAAK,SAAS,MAAM,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAOvD,oBAAoB,eAAe,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA,GAM/D,GCfY,kBAAkB;AAAA,EAC7B,SAAyBX,QAAO,KAAK;AACnC,UAAM,EAAC,aAAa,mBAAmB,GAAG,SAAQA;AAGhD,WAAA,oBAAC,sBAAmB,aAA0B,mBAC5C,8BAACuL,aAAW,EAAA,GAAG,MAAM,IAAU,CAAA,EACjC,CAAA;AAAA,EAEJ;AACF;ACVO,SAAS,iBAAiB;AAAA,EAC/B;AAAA,EACA;AAAA,EACA;AACF,GAIW;AACL,MAAA;AACJ,UAAQ,UAAU;AAAA,IAChB,KAAK;AACH,qBAAe,SAAS,IAAI;AAC5B;AAAA,IACF,KAAK;AACH,qBAAe,WAAW,IAAI;AAC9B;AAAA,IACF;AACiB,qBAAA;AACf;AAAA,EACJ;AAEO,SAAA,WAAW,aAAa,YAAA,EAAc,MAAM,GAAG,EAAE,CAAC,IAAI,aAAa;AAC5E;ACAA,MAAM,SAOF;AAAA,EACF,MAAM;AAAA,IACJ,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AAAA,EACA,UAAU;AAAA,IACR,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AACF;AAEO,SAAS,oBAAoB;AAAA,EAClC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAA6B;AACrB,QAAA,EAAC,GAAA1K,GAAC,IAAI,eAAe,GACrB,aAAa,mBAAmB,OAAO,SAAS,UAAU,OAAO,KAAK,SAEtE,CAAC,gBAAgB,iBAAiB,IAAI,SAA6B,MAAS,GAC5E,CAAC,YAAY,aAAa,IAAI,SAAiB,MAAM;AACzD,QAAI,CAAC;AACI,aAAA;AAEH,UAAA,iBAAiB,IAAI,KAAK,KAAK;AAC9B,WAAAiB,SAAO,gBAAgB,UAAU;AAAA,EACzC,CAAA,GAKK,uBAAuB,QAAQ,MAE5BA,SADM,mBAAmB,oBAAI,KAAK,GACrB,UAAU,GAC7B,CAAC,YAAY,eAAe,CAAC,GAS1B,qBAAqB;AAAA,IACzB,CAAC,EAAC,YAAY,sBAAsE;AAClF,UAAI,CAAC;AACH;AAEI,YAAA,aAAaqO,QAAM,YAAY,YAAY,oBAAI,KAAM,CAAA,GACrD,YAAY,QAAQ,UAAU;AAChC,oBACE,mBACF,SAAS,iBAAiB,EAAC,MAAM,YAAY,UAAU,CAAC,WAAU,CAAC,CAAC,GAEtE,cAAcrO,SAAO,YAAY,UAAU,CAAC,IAE9C,kBAAkB,YAAY,SAAY,WAAW,aAAa,aAAa,MAAM,EAAE;AAAA,IACzF;AAAA,IACA,CAAC,YAAY,YAAY,QAAQ;AAAA,EAAA,GAM7B,sBAAsB,YAAY,MAAM;AAC5C,uBAAmB,EAAC,YAAY,YAAY,iBAAiB,IAAK;AAAA,EAAA,GACjE,CAAC,YAAY,kBAAkB,CAAC,GAE7B,wBAAwB,YAAY,CAAC,UAAyC;AACpE,kBAAA,MAAM,cAAc,KAAK;AAAA,KACtC,EAAE,GAKC,uBAAuB,YAAY,MAAM;AAC7C,aAAS,IAAI,GACb,kBAAkB,MAAS,GAC3B,cAAc,EAAE;AAAA,EACf,GAAA,CAAC,QAAQ,CAAC,GAKP,yBAAyB;AAAA,IAC7B,CAAC,UAA2C;AACtC,YAAM,QAAQ,WAChB,mBAAmB,EAAC,YAAY,YAAY,iBAAiB,GAAA,CAAK;AAAA,IAEtE;AAAA,IACA,CAAC,YAAY,kBAAkB;AAAA,EAAA;AAMjC,SAAA,UAAU,MAAM;AACd,UAAM,cAAc,SAAS,IAAI,KAAK,KAAK;AACvC,mBACF,mBAAmB;AAAA,MACjB,YAAYA,SAAO,aAAa,UAAU;AAAA,MAC1C,iBAAiB;AAAA,IAAA,CAClB;AAAA,EAAA,GAEF,CAAC,YAAY,oBAAoB,kBAAkB,KAAK,CAAC,GAG1D;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAASjB,GAAE,oCAAoC;AAAA,QAC7C,aAAa,mBAAmB,OAAO,SAAS,cAAc,OAAO,KAAK;AAAA,MAAA,CAC3E;AAAA,MACD,UAAU,CAAC;AAAA,MACX,WAAU;AAAA,MACV,QAAM;AAAA,MAGN,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACE,GAAG;AAAA,UACJ,aAAa,CAAC,CAAC;AAAA,UACf;AAAA,UACA,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,SAAS;AAAA,UACT,WAAW;AAAA,UACX,aAAa;AAAA,UACb,OAAO;AAAA,QAAA;AAAA,MACT;AAAA,IAAA;AAAA,EAAA;AAGN;AChKO,SAAS,yBAAyB;AAAA,EACvC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAGG;AACK,QAAA;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAAA,IAChB,eAAe,GACb,EAAC,GAAAA,GAAA,IAAK,kBAEN,WAAW,QAAQ,MAAM;AAC7B,YAAQ,WAAW;AAAA,MACjB,KAAK;AACI,eAAA;AAAA,MACT,KAAK;AACI,eAAA;AAAA,MACT;AACE;AAAA,IACJ;AAAA,EACC,GAAA,CAAC,SAAS,CAAC,GAER,yBAAyB;AAAA,IAC7B,CAAC,EAAC,KAAA,MAAgC;AAChC,UAAI,gBAA+B;AAC/B,eACF,gBAAgB,iBAAiB;AAAA,QAC/B;AAAA,QACA,UAAU,CAAC;AAAA,QACX,UAAU,SAAO,QAAA,MAAA,cAAc,SAAY;AAAA,MAAA,CAC5C,IAEH,SAAS;AAAA,QACP,aAAa,SAAO,OAAA,SAAA,MAAA;AAAA,QACpB,MAAM;AAAA,MAAA,CACP;AAAA,IACH;AAAA,IACA,CAAC,YAAY,UAAU,UAAU,+BAAO,WAAW;AAAA,EAAA,GAG/C,0BAA0B,YAAY,MAAM;AAC1C,UAAA,cAAc,EAAC,SAAA,QAAA,MAAO,cACtB,OAAO,SAAO,QAAA,MAAA,OAAO,IAAI,KAAK,MAAM,IAAI,IAAI;AAElD,QAAI,gBAA+B;AAC/B,aACF,gBAAgB,iBAAiB;AAAA,MAC/B;AAAA,MACA,UAAU,CAAC;AAAA,MACX,UAAU,cAAc,UAAU;AAAA,IAAA,CACnC,IAEH,SAAS,EAAC,aAAa,MAAM,eAAc;AAAA,EAAA,GAC1C,CAAC,YAAY,UAAU,UAAU,KAAK,CAAC,GAEpC,uBAAuB;AAAA,IAC3B,CAAC,SAAwB;AACd,eAAA;AAAA,QACP,aAAa,SAAO,OAAA,SAAA,MAAA;AAAA,QACpB,MAAM,QAAQ;AAAA,MAAA,CACf;AAAA,IACH;AAAA,IACA,CAAC,UAAU,SAAA,OAAA,SAAA,MAAO,WAAW;AAAA,EAAA;AAI7B,SAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAYA,GAAE,+BAA+B;AAAA,QAC7C,UAAU,aAAa,IAAI;AAAA,QAC3B;AAAA,QACA,kBAAkB,eAAc,SAAO,OAAA,SAAA,MAAA;AAAA,QACvC,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,OAAO,SAAO,OAAA,SAAA,MAAA;AAAA,MAAA;AAAA,IAChB;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM,SAAO,QAAA,MAAA,OAAO,IAAI,KAAK,MAAM,IAAI,IAAI;AAAA,QAC3C,UAAU;AAAA,QACV,YAAY;AAAA,MAAA;AAAA,IACd;AAAA,IAEC,kCACE,uBAAsB,EAAA,UAAU,yBAAyB,OAAO,CAAC,EAAC,SAAA,QAAA,MAAO,aAAa,CAAA;AAAA,EAE3F,EAAA,CAAA;AAEJ;AClGO,SAAS,2BACdb,QACA;AACA,6BAAQ,0BAA0B,EAAA,GAAGA,QAAO,WAAU,SAAQ,YAAY,GAAO,CAAA;AACnF;ACJO,SAAS,4BACdA,QACA;AACA,6BAAQ,0BAA0B,EAAA,GAAGA,QAAO,WAAU,UAAS,YAAY,GAAO,CAAA;AACpF;ACIO,SAAS,qBAAqB;AAAA,EACnC;AAAA,EACA;AAAA,EACA;AACF,GAEG;AACK,QAAA;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAAA,IAChB,eACE,GAAA,EAAC,GAAAa,GAAK,IAAA,eAAA,GAEN,yBAAyB;AAAA,IAC7B,CAAC,EAAC,KAAA,MAAgC;AAChC,UAAI,MAAM;AACR,cAAM,gBAAgB,iBAAiB,EAAC,MAAM,UAAU,CAAC,YAAW;AAC3D,iBAAA;AAAA,UACP,aAAa,SAAO,OAAA,SAAA,MAAA;AAAA,UACpB,MAAM;AAAA,QAAA,CACP;AAAA,MACH;AACE,iBAAS,IAAI;AAAA,IAEjB;AAAA,IACA,CAAC,YAAY,UAAU,SAAA,OAAA,SAAA,MAAO,WAAW;AAAA,EAAA,GAGrC,0BAA0B,YAAY,MAAM;AAC1C,UAAA,cAAc,EAAC,SAAA,QAAA,MAAO,cACtB,OAAO,SAAO,QAAA,MAAA,OAAO,IAAI,KAAK,MAAM,IAAI,IAAI;AAElD,QAAI,gBAA+B;AAC/B,aACF,gBAAgB,iBAAiB;AAAA,MAC/B;AAAA,MACA,UAAU,CAAC;AAAA,IAAA,CACZ,IAEH,SAAS,EAAC,aAAa,MAAM,eAAc;AAAA,EAAA,GAC1C,CAAC,YAAY,UAAU,KAAK,CAAC,GAE1B,uBAAuB;AAAA,IAC3B,CAAC,SAAwB;AACd,eAAA;AAAA,QACP,aAAa,SAAO,OAAA,SAAA,MAAA;AAAA,QACpB,MAAM,QAAQ;AAAA,MAAA,CACf;AAAA,IACH;AAAA,IACA,CAAC,UAAU,SAAA,OAAA,SAAA,MAAO,WAAW;AAAA,EAAA;AAI7B,SAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAYA,GAAE,+BAA+B;AAAA,QAC7C,UAAU,aAAa,IAAI;AAAA,QAC3B;AAAA,QACA,kBAAkB,eAAc,SAAO,OAAA,SAAA,MAAA;AAAA,QACvC,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,OAAO,SAAO,OAAA,SAAA,MAAA;AAAA,MAAA;AAAA,IAChB;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM,SAAO,QAAA,MAAA,OAAO,IAAI,KAAK,MAAM,IAAI,IAAI;AAAA,QAC3C,UAAU;AAAA,QACV,YAAY;AAAA,MAAA;AAAA,IACd;AAAA,IAEC,kCACE,uBAAsB,EAAA,UAAU,yBAAyB,OAAO,CAAC,EAAC,SAAA,QAAA,MAAO,aAAa,CAAA;AAAA,EAE3F,EAAA,CAAA;AAEJ;ACjFO,SAAS,2BACdb,QACA;AACA,SAAQ,oBAAA,sBAAA,EAAsB,GAAGA,QAAO,YAAY,GAAO,CAAA;AAC7D;ACKA,MAAM,eAA6B;AAAA,EACjC,EAAC,MAAM,OAAO,KAAK,+BAA8B;AAAA,EACjD,EAAC,MAAM,SAAS,KAAK,iCAAgC;AAAA,EACrD,EAAC,MAAM,QAAQ,KAAK,gCAA+B;AACrD;AAEO,SAAS,0BAA0B;AAAA,EACxC;AAAA,EACA;AACF,GAAuD;AAC/C,QAAA,CAAC,mBAAmB,oBAAoB,IAAI,UAAS,SAAO,OAAA,SAAA,MAAA,cAAa,EAAE,GAC3E,WAAW,OAAsC,KAAK,GACtD,YAAY,QAA2C,SAAA,OAAA,SAAA,MAAO,cAAa,IAAI,GAC/E,EAAC,GAAAa,GAAK,IAAA,eAAA,GAEN;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAChB,IAAA,eAEE,GAAA,eAAe,YAAY,MAAM;AAC5B,aAAA;AAAA,MACP,MAAM,YAAU,OAAA,SAAA,SAAA;AAAA,MAChB,WAAW,aAAW,OAAA,SAAA,UAAA;AAAA,IAAA,CACvB;AAAA,EACA,GAAA,CAAC,QAAQ,CAAC,GAEP,mBAAmB;AAAA,IACvB,CAAC,UAA0C;AACzC,eAAS,UAAU,MAAM,cAAc,OACvC,aAAa;AAAA,IACf;AAAA,IACA,CAAC,YAAY;AAAA,KAET,oBAAoB;AAAA,IACxB,CAAC,UAAyC;AACnB,2BAAA,MAAM,cAAc,KAAK;AAC9C,YAAM,WAAW,WAAW,MAAM,cAAc,KAAK;AACrD,gBAAU,UAAU,OAAO,SAAS,QAAQ,IAAI,WAAW,MAC3D;IACF;AAAA,IACA,CAAC,YAAY;AAAA,EAAA;AAIb,SAAA,qBAAC,MAAK,EAAA,KAAK,GACT,UAAA;AAAA,IAAC,oBAAA,KAAA,EAAI,MAAM,GACT,UAAA;AAAA,MAAC0K;AAAAA,MAAA;AAAA,QACC,cAAY1K,GAAE,qCAAqC;AAAA,QACnD,UAAU,aAAa,IAAI;AAAA,QAC3B,UAAU;AAAA,QACV,SAAQ;AAAA,QACR,QAAQ;AAAA,QACR,MAAK;AAAA,QACL,MAAK;AAAA,QACL,OAAO;AAAA,MAAA;AAAA,IAAA,GAEX;AAAA,IACA,oBAAC,KAAI,EAAA,MAAM,GACT,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAYA,GAAE,oCAAoC;AAAA,QAClD,UAAU,aAAa,IAAI;AAAA,QAC3B,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,OAAO,SAAO,OAAA,SAAA,MAAA;AAAA,QAEb,UAAa,aAAA,IAAI,CAAC,+BAChB,UAAwB,EAAA,OAAO,OAAO,MACpC,aAAE,OAAO,GAAG,KADF,OAAO,GAEpB,CACD;AAAA,MAAA;AAAA,IAAA,GAEL;AAAA,EACF,EAAA,CAAA;AAEJ;AC1EA,MAAM,gCAAgC;AAE/B,SAAS,qBAAqB;AAAA,EACnC;AAAA,EACA;AAAA,EACA;AACF,GAEG;AACD,QAAM,EAAC,GAAAA,OAAK,kBACN;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAAA,IAChB,eAAe,GAMb,uBAAuB,QAAQ,MAAM,QAAQ,oBAAI,KAAK,GAAG,6BAA6B,GAAG,CAAA,CAAE,GAC3F,qBAAqB,QAAQ,MAAM,oBAAI,QAAQ,CAAE,CAAA,GAEjD,yBAAyB;AAAA,IAC7B,CAAC,EAAC,MAAM,cAA0D;AAChE;AAAA,QACE,mBAAmB;AAAA,UACjB;AAAA,UACA;AAAA,UACA,aAAa,SAAO,OAAA,SAAA,MAAA;AAAA,UACpB;AAAA,QAAA,CACD;AAAA,MAAA;AAAA,IAEL;AAAA,IACA,CAAC,YAAY,UAAU,SAAA,OAAA,SAAA,MAAO,WAAW;AAAA,EAAA,GAGrC,0BAA0B,YAAY,MAAM;AAC1C,UAAA,cAAc,EAAC,SAAO,QAAA,MAAA;AAC5B;AAAA,MACE,mBAAmB;AAAA,QACjB,MAAM,SAAO,QAAA,MAAA,OAAO,IAAI,KAAK,MAAM,IAAI,IAAI;AAAA,QAC3C,SAAS,SAAO,QAAA,MAAA,KAAK,IAAI,KAAK,MAAM,EAAE,IAAI;AAAA,QAC1C;AAAA,QACA;AAAA,MAAA,CACD;AAAA,IAAA;AAAA,EACH,GACC,CAAC,YAAY,UAAU,KAAK,CAAC,GAE1B,0BAA0B;AAAA,IAC9B,CAAC,SAAwB;AACd,eAAA;AAAA,QACP,aAAa,SAAO,OAAA,SAAA,MAAA;AAAA,QACpB,IAAI,QAAQ;AAAA,QACZ,OAAM,+BAAO,SAAQ;AAAA,MAAA,CACtB;AAAA,IACH;AAAA,IACA,CAAC,UAAU,KAAK;AAAA,KAGZ,4BAA4B;AAAA,IAChC,CAAC,SAAwB;AACd,eAAA;AAAA,QACP,aAAa,SAAO,OAAA,SAAA,MAAA;AAAA,QACpB,KAAI,+BAAO,OAAM;AAAA,QACjB,MAAM,QAAQ;AAAA,MAAA,CACf;AAAA,IACH;AAAA,IACA,CAAC,UAAU,KAAK;AAAA,EAAA;AAGlB,SACG,oBAAA,OAAA,EACC,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,IAAA,qBAAC,MAAK,EAAA,WAAU,UAAS,KAAK,GAE5B,UAAA;AAAA,MAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,cAAYA,GAAE,gDAAgD;AAAA,UAC9D,UAAU,aAAa,IAAI;AAAA,UAC3B;AAAA,UACA,kBAAkB,eAAc,SAAO,OAAA,SAAA,MAAA;AAAA,UACvC,UAAU;AAAA,UACV,iBAAiB;AAAA,UACjB,QAAQ;AAAA,UACR,OAAO,SAAO,OAAA,SAAA,MAAA;AAAA,QAAA;AAAA,MAChB;AAAA,MAEA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,cAAYA,GAAE,8CAA8C;AAAA,UAC5D,UAAU,aAAa,IAAI;AAAA,UAC3B;AAAA,UACA,kBAAkB,eAAc,SAAO,OAAA,SAAA,MAAA;AAAA,UACvC,UAAU;AAAA,UACV,iBAAiB;AAAA,UACjB,QAAQ;AAAA,UACR,OAAO,SAAO,OAAA,SAAA,MAAA;AAAA,QAAA;AAAA,MAChB;AAAA,IAAA,GACF;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM,SAAO,QAAA,MAAA,OAAO,IAAI,KAAK,MAAM,IAAI,IAAI;AAAA,QAC3C,SAAS,SAAO,QAAA,MAAA,KAAK,IAAI,KAAK,MAAM,EAAE,IAAI;AAAA,QAC1C,UAAU;AAAA,QACV,aAAW;AAAA,QACX,YAAY;AAAA,MAAA;AAAA,IACd;AAAA,IAEC,kCACE,uBAAsB,EAAA,UAAU,yBAAyB,OAAO,CAAC,EAAC,SAAA,QAAA,MAAO,aAAa,CAAA;AAAA,EAAA,EAE3F,CAAA,EACF,CAAA;AAEJ;AAEA,SAAS,mBAAmB;AAAA,EAC1B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GASE;AACA,SAAI,cACK;AAAA,IACL;AAAA,IACA,IAAI,UACA,iBAAiB,EAAC,MAAM,SAAS,UAAU,CAAC,YAAY,UAAU,QAAO,CAAC,IAC1E;AAAA,IACJ,MAAM,OAAO,iBAAiB,EAAC,MAAY,UAAU,CAAC,YAAY,UAAU,QAAQ,CAAA,IAAI;AAAA,EAAA,IAIrF;AAAA,IACL;AAAA,IACA,IAAI,UAAU,iBAAiB,EAAC,MAAM,SAAS,UAAU,CAAC,YAAY,UAAU,MAAK,CAAC,IAAI;AAAA,IAC1F,MAAM,OAAO,iBAAiB,EAAC,MAAM,UAAU,CAAC,YAAY,UAAU,QAAQ,CAAA,IAAI;AAAA,EAAA;AAEtF;ACvJO,SAAS,2BACdb,QACA;AACA,SAAQ,oBAAA,sBAAA,EAAsB,GAAGA,QAAO,YAAY,GAAO,CAAA;AAC7D;ACJO,SAAS,+BACdA,QACA;AACA,6BAAQ,0BAA0B,EAAA,GAAGA,QAAO,WAAU,SAAQ,YAAU,GAAC,CAAA;AAC3E;ACJO,SAAS,gCACdA,QACA;AACA,6BAAQ,0BAA0B,EAAA,GAAGA,QAAO,WAAU,UAAS,YAAU,GAAC,CAAA;AAC5E;ACJO,SAAS,+BACdA,QACA;AACA,SAAQ,oBAAA,sBAAA,EAAsB,GAAGA,QAAO,YAAU,GAAC,CAAA;AACrD;ACJO,SAAS,+BACdA,QACA;AACA,SAAQ,oBAAA,sBAAA,EAAsB,GAAGA,QAAO,YAAU,GAAC,CAAA;AACrD;ACkDA,MAAM,SAAS;AAAA,EACb,WAAW;AAAA,IACT,sBACE;AAAA,IACF,cAAc;AAAA,EAChB;AAAA,EACA,YAAY;AAAA,IACV,sBACE;AAAA,IACF,cAAc;AAAA,EAChB;AAAA,EACA,WAAW;AAAA,IACT,sBACE;AAAA,IACF,cAAc;AAAA,MACZ,MAAM;AAAA,MACN,aAAa;AAAA,IACf;AAAA,EACF;AAAA,EACA,UAAU;AAAA,IACR,sBACE;AAAA,EACJ;AAAA,EACA,cAAc;AAAA,IACZ,sBACE;AAAA,IACF,cAAc;AAAA,MACZ,MAAM;AAAA,MACN,aAAa;AAAA,IACf;AAAA,EACF;AAAA,EACA,WAAW;AAAA,IACT,cAAc;AAAA,EAChB;AACF,GAEa,gBAAgB;AAAA,EAC3B,WAAgC;AAAA,IAC9B,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,YAChB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,MAAM,OAAO,SAAO,OAAA,SAAA,MAAA,IAAI,CAAC,KAAK;AAAA,IAE9E,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,YAAiC;AAAA,IAC/B,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,YAChB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,MAAM,OAAO,SAAO,OAAA,SAAA,MAAA,IAAI,CAAC,KAAK;AAAA,IAE9E,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,WAAgC;AAAA,IAC9B,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,YAChB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,OAAO,OAAO,MAAM,IAAI,CAAC,KAAK;AAAA,IAE9E,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,UAA+B;AAAA,IAC7B,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,YAAwD;AAC/E,YAAM,eACJ,QAAO,SAAA,OAAA,SAAA,MAAO,cAAc,WAAW,KAAK,MAAM,MAAM,SAAS,IAAI,QACjE,eAAe,OAAO,SAAS,YAAY,IAC7C,IAAI,oBAAI,QAAQ;AAAA,QACd,OAAM,SAAA,OAAA,SAAA,MAAO,UAAS,QAAQ,eAAe;AAAA,QAC7C,SAAQ,SAAA,OAAA,SAAA,MAAO,UAAS,UAAU,eAAe;AAAA,QACjD,QAAO,SAAA,OAAA,SAAA,MAAO,UAAS,SAAS,eAAe;AAAA,MAAA,CAChD,EACE,YAAY,EACZ,MAAM,GAAG,EAAE,CAAC,IACf;AACG,aAAA,gBAAgB,YAAY,GAAG,SAAS,MAAM,OAAO,YAAY,CAAC,KAAK;AAAA,IAChF;AAAA,IACA,gBAAgB;AAAA,IAChB,cAAc;AAAA,MACZ,MAAM;AAAA,MACN,WAAW;AAAA,IACb;AAAA,IACA,MAAM;AAAA,EAAA;AAAA,EAER,cAAmC;AAAA,IACjC,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,YAChB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,OAAO,OAAO,MAAM,IAAI,CAAC,KAAK;AAAA,IAE9E,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,WAAgC;AAAA,IAC9B,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,sBACE;AAAA,IACF,YAAY,CAAC,EAAC,WAAW,YAChB,SAAO,QAAA,MAAA,MAAM,SAAO,QAAA,MAAA,QAAQ,YAC/B,GAAG,SAAS,OAAO,OAAO,MAAM,IAAI,CAAC,OAAO,SAAS,OAAO,OAAO,MAAM,EAAE,CAAC,KAC5E;AAAA,IAEN,cAAc;AAAA,MACZ,aAAa;AAAA,MACb,IAAI,aAAa,EAAE,YAAY;AAAA,MAC/B,MAAM;AAAA,IACR;AAAA,IACA,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,eAAoC;AAAA,IAClC,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,MAAA,MAChB,SAAO,QAAA,MAAA,QAAQ,YAClB,YAAY,SAAS,gBAAgB,OAAO,MAAM,IAAI,CAAC,MACvD;AAAA,IAEN,gBACE;AAAA,IACF,MAAM;AAAA,EAAA;AAAA,EAER,gBAAqC;AAAA,IACnC,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,MAAA,MAChB,SAAO,QAAA,MAAA,QAAQ,YAClB,YAAY,SAAS,gBAAgB,OAAO,MAAM,IAAI,CAAC,MACvD;AAAA,IAEN,gBACE;AAAA,IACF,MAAM;AAAA,EAAA;AAAA,EAER,eAAoC;AAAA,IAClC,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,YAAyD;AAChF,YAAM,QAAO,SAAO,OAAA,SAAA,MAAA,SAAQ,IAAI,KAAK,MAAM,IAAI;AAC/C,UAAI,CAAC,QAAQ,CAAC,QAAQ,IAAI,KAAK,CAAC;AACvB,eAAA;AAEH,YAAA,aAAa,uBAAO,cAAc,cAAc,IAAI,IAAI,WAAW,IAAI,GAAG,YAAA,GAC1E,WAAW,SAAA,QAAA,MAAO,cAAc,YAAY,IAAI,IAAI,SAAS,IAAI,GAAG,YAAY;AAC/E,aAAA,YAAY,SAAS,gBAAgB;AAAA,QAC1C;AAAA,MAAA,CACD,iBAAiB,SAAS,gBAAgB,OAAO,OAAO,CAAC;AAAA,IAC5D;AAAA,IACA,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,cAAmC;AAAA,IACjC,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,YAAwD;AAC/E,YAAM,eACJ,QAAO,SAAA,OAAA,SAAA,MAAO,cAAc,WAAW,KAAK,MAAM,MAAM,SAAS,IAAI,QACjE,eAAe,OAAO,SAAS,YAAY,IAC7C,IAAI,oBAAI,QAAQ;AAAA,QACd,OAAM,SAAA,OAAA,SAAA,MAAO,UAAS,QAAQ,eAAe;AAAA,QAC7C,SAAQ,SAAA,OAAA,SAAA,MAAO,UAAS,UAAU,eAAe;AAAA,QACjD,QAAO,SAAA,OAAA,SAAA,MAAO,UAAS,SAAS,eAAe;AAAA,MAAA,CAChD,EAAE,YACH,IAAA;AACG,aAAA,gBAAgB,YACnB,YAAY,SAAS,gBAAgB,OAAO,YAAY,CAAC,MACzD;AAAA,IACN;AAAA,IACA,cAAc;AAAA,MACZ,MAAM;AAAA,MACN,WAAW;AAAA,IACb;AAAA,IACA,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,kBAAuC;AAAA,IACrC,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,WAAW,YAAyD;AAChF,YAAM,QAAO,SAAO,OAAA,SAAA,MAAA,SAAQ,IAAI,KAAK,MAAM,IAAI;AAC/C,UAAI,CAAC,QAAQ,CAAC,QAAQ,IAAI,KAAK,CAAC;AACvB,eAAA;AAEH,YAAA,aAAa,uBAAO,cAAc,cAAc,IAAI,IAAI,WAAW,IAAI,GAAG,YAAA,GAC1E,WAAW,SAAA,QAAA,MAAO,cAAc,YAAY,IAAI,IAAI,SAAS,IAAI,GAAG,YAAY;AAC/E,aAAA,YAAY,SAAS,gBAAgB;AAAA,QAC1C;AAAA,MAAA,CACD,iBAAiB,SAAS,gBAAgB,OAAO,OAAO,CAAC;AAAA,IAC5D;AAAA,IACA,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAGR,eAAoC;AAAA,IAClC,GAAG,OAAO;AAAA,IAEV,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,sBACE;AAAA,IACF,YAAY,CAAC,EAAC,WAAW,MAAK,MACrB,SAAO,QAAA,MAAA,MAAM,SAAO,QAAA,MAAA,QAAQ,YAC/B,YAAY,SAAS,iBAAiB;AAAA,MACpC,MAAM;AAAA,IAAA,CACP,iBAAiB,SAAS,iBAAiB,OAAO,MAAM,EAAE,CAAC,MAC5D;AAAA,IAEN,cAAc;AAAA,MACZ,aAAa;AAAA,MACb,IAAI,aAAa,EAAE,YAAY;AAAA,MAC/B,MAAM;AAAA,IACR;AAAA,IACA,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAEV,GCtTa,mBAAmB;AAAA,EAC9B,SAA8B;AAAA,IAC5B,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,YAAY,CAAC,EAAC,gBAAgB,YAAY,WAAW,SAAS,MAAM;AAAA,IACpE,MAAM;AAAA,EAAA;AAAA,EAER,YAAiC;AAAA,IAC/B,SAAS;AAAA,IACT,gBAAgB;AAAA,IAEhB,SAAS;AAAA,IACT,YAAY,CAAC,EAAC,gBAAgB,YAAY,YAAY,SAAS,MAAM;AAAA,IACrE,MAAM;AAAA,EAAA;AAEV,GCNa,kBAAkB;AAAA,EAC7B,aAAkC;AAAA,IAChC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MAAA,MACvB,OAAO,SAAS,KAAK,KAAK,YAAY,GAAG,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IAC7E,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,UAA+B;AAAA,IAC7B,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MAAA,MACvB,OAAO,SAAS,KAAK,KAAK,YAAY,GAAG,SAAS,MAAM,OAAO,KAAK,CAAC,KAAK;AAAA,IAC5E,MAAM;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,WAAgC;AAAA,IAC9B,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MAAA,MACvB,OAAO,SAAS,KAAK,KAAK,YAAY,GAAG,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IAC7E,MAAM;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,UAA+B;AAAA,IAC7B,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MAAA,MACvB,OAAO,SAAS,KAAK,KAAK,YAAY,GAAG,SAAS,MAAM,OAAO,KAAK,CAAC,KAAK;AAAA,IAC5E,MAAM;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,WAAgC;AAAA,IAC9B,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MAAA,MACvB,OAAO,SAAS,KAAK,KAAK,YAAY,GAAG,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IAC7E,MAAM;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,gBAAqC;AAAA,IACnC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MAAA,MACvB,OAAO,SAAS,KAAK,KAAK,YAAY,GAAG,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IAC7E,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,aAAkC;AAAA,IAChC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MAAK,MAC5B,OAAO,SAAS,SAAO,OAAA,SAAA,MAAA,EAAE,KAAK,OAAO,SAAS,SAAO,OAAA,SAAA,MAAA,IAAI,KAAK,YAC1D,GAAG,SAAS,MAAM,OAAO,+BAAO,IAAI,CAAC,OAAO,SAAS,MAAM,OAAO,SAAO,OAAA,SAAA,MAAA,EAAE,CAAC,KAC5E;AAAA,IACN,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAEV;AC3EO,SAAS,wBAAwB;AAAA,EACtC;AAAA,EACA;AACF,GAAiD;AACzC,QAAA;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAAA,IAChB,eACE,GAAA,EAAC,GAAAa,GAAK,IAAA,eAAA,GAEN,eAAe;AAAA,IACnB,CAAC,UAAyC,SAAS,MAAM,cAAc,SAAS,IAAI;AAAA,IACpF,CAAC,QAAQ;AAAA,EAAA;AAIT,SAAA;AAAA,IAAC0K;AAAAA,IAAA;AAAA,MACC,UAAU,aAAa,IAAI;AAAA,MAC3B,UAAU;AAAA,MACV,aAAa1K,GAAE,wCAAwC;AAAA,MACvD,QAAQ;AAAA,MACR,OAAO,SAAS;AAAA,IAAA;AAAA,EAAA;AAGtB;ACxBO,MAAM,wBAAwB;AAAA,EACnC,mBAAwC;AAAA,IACtC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,YAAY,SAAS,QAAQ,OAAO,KAAK,CAAC,KAAK;AAAA,IACtE,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,qBAA0C;AAAA,IACxC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,YAAY,SAAS,WAAW,OAAO,KAAK,CAAC,KAAK;AAAA,IACzE,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,sBAA2C;AAAA,IACzC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,YAAY,SAAS,QAAQ,OAAO,KAAK,CAAC,KAAK;AAAA,IACtE,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,wBAA6C;AAAA,IAC3C,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAS,YAAY,cAAc,SAAS,WAAW,OAAO,KAAK,CAAC,MAAM;AAAA,IAC5E,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAEV,GC7Ba,qBAAqB;AAAA,EAChC,gBAAqC;AAAA,IACnC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,YAAY,OAAO,MAAM,IAAI,CAAC,KAAK;AAAA,IAC5E,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,mBAAwC;AAAA,IACtC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAO,QAAA,MAAA,QAAQ,YAAY,GAAG,SAAS,YAAY,OAAO,MAAM,IAAI,CAAC,KAAK;AAAA,IAC5E,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,qBAA0C;AAAA,IACxC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,MAAA,MAAY,SAAA,QAAA,MAAO,OAAO,cAAc,OAAO,MAAM,IAAI,CAAC,MAAM;AAAA,IAC9E,cAAc;AAAA,IACd,gBAAgB,uBAAuB,MAAM;AAAA,IAC7C,MAAM;AAAA,EAAA;AAAA,EAER,sBAA2C;AAAA,IACzC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,MAAA,MAAY,SAAA,QAAA,MAAO,OAAO,cAAc,OAAO,MAAM,IAAI,CAAC,MAAM;AAAA,IAC9E,cAAc;AAAA,IACd,gBAAgB,uBAAuB,OAAO;AAAA,IAC9C,MAAM;AAAA,EAAA;AAAA,EAER,oBAAyC;AAAA,IACvC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,sBAAsB;AAAA,IACtB,YAAY,CAAC,EAAC,MAAA,MAAY,SAAA,QAAA,MAAO,OAAO,cAAc,OAAO,MAAM,IAAI,CAAC,MAAM;AAAA,IAC9E,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAEV,GCxDa,gBAAgB;AAAA,EAC3B,WAAgC;AAAA,IAC9B,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,GAAG,SAAS,eAAe,OAAO,KAAK,CAAC,KAAK;AAAA,IACpE,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,aAAkC;AAAA,IAChC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,GAAG,SAAS,kBAAkB,OAAO,KAAK,CAAC,KAAK;AAAA,IACvE,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,OAAO;AAAA,IACP,MAAM;AAAA,EAAA;AAAA,EAER,cAAmC;AAAA,IACjC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,GAAG,SAAS,eAAe,OAAO,KAAK,CAAC,KAAK;AAAA,IACpE,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,gBAAqC;AAAA,IACnC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAS,YAAY,KAAK,SAAS,kBAAkB,OAAO,KAAK,CAAC,MAAM;AAAA,IAC1E,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAEV,GCrCa,kBAAkB;AAAA,EAC7B,aAAkC;AAAA,IAChC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,GAAG,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IAC5D,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,iBAAsC;AAAA,IACpC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,GAAG,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IAC5D,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,oBAAyC;AAAA,IACvC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,GAAG,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IAC5D,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,eAAoC;AAAA,IAClC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,GAAG,SAAS,UAAU,OAAO,KAAK,CAAC,KAAK;AAAA,IAC/D,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,gBAAqC;AAAA,IACnC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,MACvB,MAAA,SAAS,YAAY,GAAG,SAAS,OAAO,OAAO,KAAK,CAAC,KAAK;AAAA,IAC5D,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAAA,EAER,kBAAuC;AAAA,IACrC,SAAS;AAAA,IACT,gBAAgB;AAAA,IAChB,YAAY,CAAC,EAAC,WAAW,YACvB,SAAS,YAAY,KAAK,SAAS,UAAU,OAAO,KAAK,CAAC,MAAM;AAAA,IAClE,cAAc;AAAA,IACd,gBAAgB;AAAA,IAChB,MAAM;AAAA,EAAA;AAEV,GCnDM,kBAAkB;AAAA,EACtB,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AACL,GAYa,sBAAsB,OAAO,OAAO,eAAe;AC9BhE,SAAS,mBAAmB,MAAc;AACxC,QAAM,WAAW,KACd,MAAM,EAAE,EAER,OAAO,CAAC,UAAU,aAAc,YAAY,KAAK,WAAW,QAAQ,WAAW,CAAC,IAAK,GAAG,CAAC;AAC5F,SAAO,KAAK,IAAK,WAAW,QAAS,UAAU,IAAI;AACrD;AAEA,MAAM,UAAU,OAAO;AAAA,iBACN,CAAC,EAAC,YAAW,MAAM,OAAO,MAAM,KAAK,MAAM;AAAA,iBAC3C,CAAC,EAAC,MAAK,MAAM,MAAM,OAAO,MAAM,KAAK,QAAQ,MAAM;AAAA,eACrD,CAAC,EAAC,YAAW,MAAM,OAAO,MAAM,KAAK,MAAM,CAAC,EAAE,QAAQ;AAAA;AAAA;AAOrD,SAAA,kBAAkB,OAAe,UAAkB;AAC3D,QAAA,OAAO,mBAAmB,GAAG,KAAK,IAAI,QAAQ,EAAE,GAEhD,kBAAkB,WAAW,OAAO,CAAC,QAAQ,QAAQ,MAAM,GAC3D,WAAW,gBAAgB,KAAK,MAAM,OAAO,gBAAgB,MAAM,CAAC,GACpE,gBAAgB,CAAC,OAAO,OAAO,OAAO,OAAO,KAAK,GAClD,OAAO,mBAAmB,KAAK,SAAU,CAAA,GACzC,OAAO,cAAc,KAAK,MAAM,OAAO,cAAc,MAAM,CAAC,GAC5D,QAAQ,KAAK,QAAQ,EAAE,IAAI,EAAE,KAE7B,UAAU,MAEb,MAAM,KAAK,EAEX,IAAI,CAAC,SAAS,KAAK,QAAQ,QAAQ,EAAE,CAAC,EAEtC,OAAO,OAAO,EAEd,MAAM,GAAG,CAAC,EAEV,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC,EAAE,aAAa,GAEjC,WAAW,OAAO,OAAO,GAAG,GAC5B,YAAY,QAAQ,OAAO,GAAG,GAI9B,YAAa,eAAe,OAAO,YAAY,QAAQ,IAExD,eAAe,OAAO,YAAY,SAAS,IAE1C,cAAc,KAAK,IADnB,YAFF;AAMJ,SACG,qBAAA,OAAA,EAAI,OAAM,8BAA6B,SAAQ,aAC9C,UAAA;AAAA,IAAC,oBAAA,QAAA,EAAK,OAAO,IAAI,QAAQ,IAAI,IAAI,GAAG,MAAM,MAAO,CAAA;AAAA,IACjD;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAE;AAAA,QACF,GAAE;AAAA,QACF,YAAW;AAAA,QACX,mBAAkB;AAAA,QAClB,kBAAiB;AAAA,QACjB,MAAM;AAAA,QAEL,UAAA;AAAA,MAAA;AAAA,IACH;AAAA,EACF,EAAA,CAAA;AAEJ;ACrDO,SAAS,mBAAmB;AAAA,EACjC;AAAA,EACA;AACF,GAAsD;AACpD,SAAO,sBAAsB;AAAA,IAC3B,cAAc;AAAA,IACd;AAAA,IACA;AAAA,IACA,cAAc,CAAC;AAAA,IACf,SAAS;AAAA,EAAA,CACV;AACH;ACzBO,MAAM,oBAAoB,MAAM;AAAA,EACrC,YAAmB,QAAgB;AACjC,UAAM,aAAa,GADF,KAAA,SAAA;AAAA,EAEnB;AACF;ACoDA,MAAM,UAAU,CAAC,MAA+B,EAAE,aAAa;AAE/D,SAAS,cACP,MACA,OACA,WAAW,IACE;AACb,SAAI,mBAAmB,IAAI,IAAU,cAAc,IAAI,IACnD,eAAe,IAAI,IAAU,OAC1B,kBAAkB,OAAO,QAAQ;AAC1C;AAEA,MAAM,yCAAyB;AAYf,SAAA,cACd,QACA,SACgB;AAChB,MAAI,CAAC,MAAM,QAAQ,MAAM,KAAK,uBAAuB;AACnD,UAAM,IAAI,sBAAsB;AAAA,MAC9B,MAAM;AAAA,MACN,MAAM;AAAA,MACN,QAAQ,CAAC,oCAAoC,kCAAkC;AAAA,IAAA,CAChF;AAGH,QAAM,WAAW,YAAY,WAAS,OAAA,SAAA,QAAA,QAAQ,GACxC,mBAA2D,MAAM,QAAQ,MAAM,IACjF,SACA,CAAC,MAAM;AAEP,MAAA;AACiB,uBAAA,EAAC,YAAY,iBAAA,CAAiB;AAAA,WAC1C,GAAG;AACV,UAAM,IAAI,sBAAsB;AAAA,MAC9B,MAAM;AAAA,MACN,MAAM;AAAA,MACN,QAAQ,CAAC,EAAE,OAAO;AAAA,IAAA,CACnB;AAAA,EACH;AA+FA,SAAO,EAAC,MAAM,mBAAmB,YA7Fd,iBAAiB,IAAI,CAAC,iBAAmC;AA/G9E,QAAAF;AAgHQ,QAAA,mBAAmB,IAAI,YAAY;AAC9B,aAAA,mBAAmB,IAAI,YAAY;AAE5C,UAAM,EAAC,kBAAkB,gBAAgB,CAAA,GAAI,GAAG,WAAU,IAAI,cAGxD,kBAFU,CAAC,YAA6B,GAAG,aAAa,EAE9B,IAAI,CAAC,WAA2B;AACxD,YAAA,EAAC,WAAW,QAAW,IAAA;AAEzB,UAAA;AACA,UAAA;AACF,sBAAc,mBAAmB;AAAA,UAC/B,QAAQ;AAAA,UACR,SAAS,EAAC,WAAW,QAAO;AAAA,QAAA,CAC7B;AAAA,eACM,GAAG;AACV,cAAM,IAAI,sBAAsB;AAAA,UAC9B,MAAM,OAAO;AAAA,UACb,MAAM;AAAA,UACN,QAAQ,CAAC,CAAC;AAAA,QAAA,CACX;AAAA,MACH;AAEA,YAAM,SAAS,aAAa;AAAA,QAC1B,MAAM,OAAO;AAAA,QACb,OAAO;AAAA,MAAA,CACR,GAEK,gCAAgC,OAAO,aACvC,eAAe,iCAA+B,OAAA,SAAA,8BAAA;AAAA,QAAO,CAAC,QAC1D,IAAI,SAAS,KAAK,OAAO;AAAA,MAAA;AAG3B,UAAI,iCAAiC,gBAAc,QAAA,aAAA;AAE3C,cAAA,IAAI,YAAY,MAAM;AAGxB,YAAA,OAAO,aAAa,MAAM,GAC1B,OAAO,YAAY,MAAM,GACzB,UAAU,KAAK,MAAM;AAAA,QACzB,IAAI,CAAC,EAAC,QAAQ,eAAe,YAAA,MACpB,cAAc;AAAA,UACnB,QAAQ;AAAA,UACR;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QAAA,CACD,CACF;AAAA,QACD,YAAY,CAAC;AAAA,MAAA;AAGR,aAAA;AAAA,QACL,MAAM,OAAO;AAAA,QACb,WAAW,OAAO;AAAA,QAClB,SAAS,OAAO;AAAA,QAChB,OAAO,OAAO,SAAS,UAAU,OAAO,IAAI;AAAA,QAC5C;AAAA,QACA;AAAA,QACA,MAAM,KAAK;AAAA,QACX,QAAQ;AAAA,MAAA;AAAA,IACV,CACD,GAEK,QAAQ,WAAW,SAAS,UAAU,WAAW,IAAI,GAErD,mBAAqC;AAAA,MACzC,MAAM;AAAA,MACN,MAAM,gBAAgB,CAAC,EAAE;AAAA,MACzB,UAAU,aAAa,UAAU,WAAW,QAAQ;AAAA,MACpD,SAAS,WAAW;AAAA,MACpB,QAAQ,gBAAgB,CAAC,EAAE;AAAA,MAC3B,MAAM,gBAAgB,CAAC,EAAE;AAAA,MACzB,YAAY,CAAC,CAAC,WAAW;AAAA,MACzB,MAAM,cAAc,WAAW,MAAM,OAAO,GAAG,WAAW,SAAS,IAAI,WAAW,OAAO,EAAE;AAAA,MAC3F,MAAM,WAAW,QAAQ;AAAA,MACzB,WAAW,WAAW;AAAA,MACtB,OAAO,WAAW,SAAS;AAAA,MAC3B;AAAA,MACA,UAAU,WAAW;AAAA,MACrB,YAAY;AAAA,QACV,SAAS;AAAA,MACX;AAAA,MACA,QAAOA,MAAa,aAAA,mBAAb,OAA+BA,MAAA,EAAC,SAAS,GAAI;AAAA,IAAA;AAEnC,WAAA,mBAAA,IAAI,cAAc,gBAAgB,GAC9C;AAAA,EACR,CAAA;AAGH;AAEA,SAAS,aAAa,QAAkC;AAClD,MAAA,YAAY,OAAO,IAAI;AACzB,WAAO,OAAO;AAGV,QAAA,gBAAgB,OAAO,0BAA0B,cACjD,EAAC,WAAW,SAAS,QAAW,IAAA;AAC/B,SAAA,gBAAgB,EAAC,SAAS,GAAG,OAAO,MAAM,eAAe,SAAS,UAAA,CAAU;AACrF;AAYA,SAAS,eAAe,QAAsB,MAAiB;AACvD,QAAA,uBAAuB,OAAO,WAAW,EAAC,YAAY,aAAa,CAAA,GACnE,EAAC,SAAS,KAAK,SAAS,mBAAmB,gBAAmB,IAAA,qBAAqB,OAEnF,GAAA,aAAa,GADP,GAAG,QAAQ,QAAQ,QAAQ,EAAE,CAAC,WAAW,OAAO,GAAG,QAAQ,SAAS,IAAI,CAC3D,QAAQ,gBAAgB,IAE3C,UAAU,KAAK,QAAQ,EAAC,QAAQ,KAAK,UAAS;AAC7C,SAAA,QAAQ,YAAY,OAAO;AACpC;AAEA,SAAS,cAAc;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAiC;AArPjC,MAAAA,KAAA,IAAA,IAAA,IAAA,IAAA,IAAA;AAsPE,QAAM,EAAC,SAAS,UAAA,IAAa,QACvB,QAAQ,eAAe,QAAQ,IAAI,GACnC,SAAoB,CAAA,GACpB,UAAwC,CAAA,GACxC,YAAY,CAAC,YAA+C;AAC5D,QAAA,CAAC,WAAW,CAAC,QAAQ;AACjB,YAAA,IAAI,MAAM,sCAAsC;AAGxD,WAAK,QAAQ,QAAQ,UAAU,MAC7B,QAAQ,QAAQ,UAAU,IAAI,OAAO,WAAW,OAAO,IAGlD,QAAQ,QAAQ,UAAU;AAAA,KAG7B,UAAkD;AAAA,IACtD;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,MAAM,KAAK;AAAA,EAAA,GAKP,gBAAgB;AACtB,UAAQ,SAAS,CAAC,GAAG,OAAO,KAAK,MAAM,GAAG,GAAG,OAAO,KAAK,cAAc,SAAS,CAAC,EAAE;AAAA,IACjF,CAAC,KAAK,QAAQ;AACZ,YAAM,WAAW,OAAO,eAAe,KAAK,QAAQ,GAAG,IACnD,cAAc,GAAG,IACjB,cAAc,UAAU,GAAG;AAExB,aAAA,OAAO,eAAe,KAAK,KAAK;AAAA,QACrC,MAAM;AACI,iBAAA,QAAA;AAAA,YACN;AAAA,UAEK,GAAA;AAAA,QACT;AAAA,MAAA,CACD;AAAA,IACH;AAAA,IACA,CAAC;AAAA,EAAA;AAKC,MAAA;AACA,MAAA;AACF,gBAAY,sBAAsB;AAAA,MAChC;AAAA,MACA;AAAA,MACA,cAAc;AAAA,MACd,SAAS;AAAA,MACT,cAAc,OACX,aAAA,EACA,OAAO,CAAC,aAAa,CAAC,YAAY,KAAK,QAAQ,CAAC,EAChD,IAAI,CAAC,aAAa,OAAO,IAAI,QAAQ,CAAC,EACtC,OAAOP,eAAa,EACpB,OAAO,CAAC,eAAY;AAnT7BO,YAAAA;AAmTgC,iBAAAA,OAAA,WAAW,SAAX,OAAA,SAAAA,KAAiB,UAAS;AAAA,MAAA,CAAU,EAC3D,IAAI,CAAC,gBACuB;AAAA,QACzB,IAAI,WAAW;AAAA,QACf,YAAY,WAAW;AAAA,QACvB,OAAO,WAAW,SAAS,WAAW;AAAA,QACtC,MAAM,WAAW;AAAA,QACjB,OAAO,WAAW,gBAAgB,EAAC,OAAO,WAAW,KAAI;AAAA,MAAA,EAI5D;AAAA,IAAA,CACJ;AAAA,WAGM,GAAG;AACV,UAAM,IAAI,sBAAsB;AAAA,MAC9B,MAAM,OAAO;AAAA,MACb,MAAM;AAAA,MACN,QAAQ,CAAC,CAAC;AAAA,IAAA,CACX;AAAA,EACH;AAEI,MAAA;AACA,MAAA;AACF,YAAQ,sBAAsB;AAAA,MAC5B;AAAA,MACA;AAAA,MACA,cAAc,CAAC;AAAA,MACf,cAAc;AAAA,MACd,SAAS;AAAA,IAAA,CACV;AAAA,WACM,GAAG;AACV,UAAM,IAAI,sBAAsB;AAAA,MAC9B,MAAM,OAAO;AAAA,MACb,MAAM;AAAA,MACN,QAAQ,CAAC,CAAC;AAAA,IAAA,CACX;AAAA,EACH;AAIA,MAAI,MAAM,KAAK,CAAC,EAAC,KAAI,MAAM,SAAS,MAAM;AAClC,UAAA,IAAI,MAAM,oEAAoE;AAGtF,QAAM,4BAA4B,UAE/B,OAAO,CAAC,aAAU;AAnWvBA,QAAAA;AAmW0B,WAAA,GAACA,OAAA,SAAS,eAAT,QAAAA,KAAqB;AAAA,EAAM,CAAA,EACjD;AAAA,IACC,CAAC,cAA4B;AAAA,MAC3B,YAAY,SAAS;AAAA,MACrB,aAAa,SAAS;AAAA,MACtB,MAAM,SAAS;AAAA,MACf,OAAO,SAAS;AAAA,IAAA;AAAA,EAClB,GAGE,cAAc,UAAU,OAAO,CAAC,KAAK,cACzC,IAAI,IAAI,SAAS,IAAI,QAAQ,GACtB,MACF,oBAAA,IAAA,CAAuB,GAGxB,4BAA6E,CACjF,oBACG;AACH,UAAM,EAAC,YAAY,eAAA,IAAkB,iBAE/B,oBAAoB,sBAAsB;AAAA,MAC9C;AAAA,MACA,SAAS,EAAC,GAAG,SAAS,gBAAe;AAAA,MACrC,cAAc;AAAA,MACd,cAAc;AAAA,MACd,SAAS;AAAA,IAAA,CACV,GAEK,iBAA4B;AAIlC,QAAI,eAAe;AACjB,YAAM,IAAI,sBAAsB;AAAA,QAC9B,MAAM,OAAO;AAAA,QACb,MAAM;AAAA,QACN,QAAQ;AAAA,MAAA,CACT;AAGH,WACE,kBAGG,IAAI,CAAC,UAAU,UAAoC;AAClD,YAAM,WAAW,YAAY,IAAI,SAAS,UAAU;AACpD,UAAI,CAAC;AACH,cAAM,IAAI,MAAM,qCAAqC,SAAS,UAAU,IAAI;AAG9E,YAAM,aAAa,OAAO,IAAI,SAAS,UAAU;AAEjD,UAAI,CAAC;AACH,cAAM,IAAI;AAAA,UACR,yCAAyC,SAAS,UAAU,qBAAqB,SAAS,EAAE;AAAA,QAAA;AAI1F,YAAA,QAAQ,SAAS,SAAS,SAAS,OAEnC,mBAAkB,cAAA,OAAA,SAAA,WAAY,WAAU,SAAoB,cAAZ,OAAA,SAAY,WAAY;AAEvE,aAAA;AAAA,QACL,IAAI,GAAG,SAAS,UAAU,IAAI,KAAK;AAAA,QACnC,YAAY,SAAS;AAAA,QACrB,MAAM;AAAA,QACN;AAAA,QACA,MAAM,SAAS,QAAQ,SAAS;AAAA,QAChC,UAAU,SAAS,YAAY;AAAA,QAC/B,aAAa,SAAS,eAAe,SAAS;AAAA,QAC9C,MAAM,SAAS,QAAQ,SAAS,SAAQ,cAAY,OAAA,SAAA,WAAA;AAAA,QACpD,mBAAmB,SAAS;AAAA,QAC5B,YAAY,SAAS;AAAA,QACrB,YAAY,SAAS;AAAA,MAAA;AAAA,IACvB,CACD,EACA,OAAO,CAAC,SAAS;AAhb1BA,UAAAA;AAsbU,aAHI,CAAC,kBAGD,gBAAgB,SAAS,aAAmB,KAGzC,qBAAmBA,OAAA,YAAY,IAAI,KAAK,UAAU,MAA/B,gBAAAA,KAAkC;AAAA,IAAA,CAC7D;AAAA,EAAA;AAIH,MAAA;AACA,MAAA;AACF,sCAAkC,0BAA0B,EAAC,MAAM,SAAS,CAAA;AAAA,WACrE,GAAG;AACV,WAAO,KAAK,CAAC;AAAA,EACf;AAEA,MAAI,OAAO;AACT,UAAM,IAAI,sBAAsB;AAAA,MAC9B,MAAM,OAAO;AAAA,MACb,MAAM;AAAA,MACN,QAAQ;AAAA,IAAA,CACT;AAGoB,SAAA;AAAA,IACrB,MAAM;AAAA,IACN,MAAM,OAAO;AAAA,IACb,OAAO,OAAO,SAAS,UAAU,OAAO,IAAI;AAAA,IAC5C;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,MAAM,KAAK;AAAA;AAAA,IAEX,kBAAkB,qBAAqB;AAAA,MACrC;AAAA,IAAA,CACD;AAAA,IACD,UAAU;AAAA,MACR,SAAS,CAAC,mBACR,sBAAsB;AAAA,QACpB;AAAA,QACA,SAAS,EAAC,GAAG,SAAS,GAAG,eAAc;AAAA,QACvC,cAAc;AAAA,QACd,cAAc;AAAA,QACd,SAAS;AAAA,MAAA,CACV;AAAA,MACH,QAAQ,CAAC,mBACP,sBAAsB;AAAA,QACpB;AAAA,QACA,SAAS,EAAC,GAAG,SAAS,GAAG,eAAc;AAAA,QACvC,cAAc;AAAA,QACd,cAAc;AAAA,QACd,SAAS;AAAA,MAAA,CACV;AAAA,MACH,uBAAuB,CAAC,mBACtB,sBAAsB;AAAA,QACpB;AAAA,QACA,SAAS,EAAC,GAAG,SAAS,GAAG,eAAc;AAAA,QACvC,cAAc;AAAA,QACd,cAAc;AAAA,QACd,SAAS;AAAA,MAAA,CACV;AAAA,MACH,YAAY,CAAC,mBACX,sBAAsB;AAAA,QACpB;AAAA,QACA,SAAS,EAAC,GAAG,SAAS,GAAG,eAAc;AAAA,QACvC,cAAcL;AAAAA,QACd,cAAc;AAAA,QACd,SAAS;AAAA,MAAA,CACV;AAAA,MACH,sBAAsB,CAAC,mBACrB,sBAAsB;AAAA,QACpB;AAAA,QACA,SAAS,EAAC,GAAG,SAAS,GAAG,eAAc;AAAA,QACvC,cAAc;AAAA,QACd,cAAc;AAAA,QACd,cAAc;AAAA,MAAA,CACf;AAAA,MACH;AAAA,MACA,yBAAyB,CAAC,mBACxB,sBAAsB;AAAA,QACpB;AAAA,QACA,SAAS,EAAC,GAAG,SAAS,GAAG,eAAc;AAAA,QACvC,cAAc;AAAA,QACd,cAAc;AAAA,QACd,SAAS;AAAA,MAAA,CACV;AAAA,MAEH,mBAAmB;AAAA,QACjB,SAAS,CAAC,mBACD,+BAA+B;AAAA,UACpC,SAAS;AAAA,UACT;AAAA,UACA,cAAc;AAAA,QAAA,CACf;AAAA,MAEL;AAAA,IACF;AAAA,IAEA,MAAM;AAAA,MACJ,MAAM;AAAA,QACJ,cAAc,sBAAsB;AAAA,UAClC;AAAA,UACA;AAAA,UACA,cAAc,CAAC,UAAU;AAAA,UACzB,cAAc;AAAA,UACd,SAAS;AAAA,QAAA,CACV;AAAA,QACD;AAAA;AAAA;AAAA,YAGE,MAAAK,MAAA,OAAO,SAAP,OAAA,SAAAA,IAAa,SAAb,OAAA,SAAA,GAAmB,mBAAkB,SAAY,KAAO,OAAO,KAAK,KAAK;AAAA;AAAA,MAC7E;AAAA,MACA,OAAO;AAAA,QACL,cAAc,sBAAsB;AAAA,UAClC;AAAA,UACA;AAAA,UACA,cAAc,CAAC,WAAW;AAAA,UAC1B,cAAc;AAAA,UACd,SAAS;AAAA,QAAA,CACV;AAAA,QACD;AAAA;AAAA;AAAA,YAGE,MAAA,KAAA,OAAO,SAAP,OAAA,SAAA,GAAa,UAAb,OAAA,SAAA,GAAoB,mBAAkB,SAAY,KAAO,OAAO,KAAK,MAAM;AAAA;AAAA,MAC/E;AAAA,IACF;AAAA,IAEA,QAAQ;AAAA,MACN,SAAS;AAAA,MACT,WAAW;AAAA,MACX,0BAA0B;AAAA,QACxB,SAAS,8BAA8B;AAAA,UACrC;AAAA,UACA,eAAc,MAAO,MAAA,KAAA,OAAA,WAAP,mBAAe,6BAAf,OAAA,SAAA,GAAyC,YAAzC,OAAoD,KAAA;AAAA,QAAA,CACnE;AAAA,MACH;AAAA,MACA,0BAA0B,sBAAsB;AAAA,QAC9C;AAAA,QACA;AAAA,QACA,SAAS;AAAA,QACT,cAAc;AAAA,QACd,cAAc;AAAA,MAAA,CACf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAgBH;AAAA,IAEA,YAAY;AAAA,MACV;AAAA,MACA,SAAS,KAAK;AAAA,MACd;AAAA,MACA,SAAS;AAAA,IACX;AAAA,EAAA;AAIJ;AAYA,SAAS,YAAY,UAAmB;AACtC,QAAM,WAAW,YAAY;AACzB,MAAA,OAAO,YAAa,YAAa,SAAS,SAAS,KAAK,CAAC,SAAS,WAAW,GAAG;AAClF,UAAM,IAAI,sBAAsB;AAAA,MAC9B,MAAM;AAAA,MACN,MAAM;AAAA,MACN,QAAQ,CAAC,wDAAwD;AAAA,IAAA,CAClE;AAII,SAAA,aAAa,MAAM,KAAK;AACjC;AAUA,SAAS,aAAa,UAAkB,UAAmB;AASlD,SAAA,IARQ,CAAC,UAAU,YAAY,EAAE,EAErC,IAAI,CAAC,SAAS,KAAK,QAAQ,SAAS,EAAE,EAAE,QAAQ,SAAS,EAAE,CAAC,EAE5D,OAAO,OAAO,EAEd,KAAK,GAAG,CAEM;AACnB;ACnoBO,SAAS,mBAAmB,EAAC,QAAQ,UAAU,YAAoC;AACxF,QAAM,EAAC,WAAA,IAAc,QAAQ,MAAM,cAAc,QAAQ,EAAC,SAAS,CAAA,GAAG,CAAC,QAAQ,QAAQ,CAAC;AACxF,6BAAQ,kBAAkB,UAAlB,EAA2B,OAAO,YAAa,SAAS,CAAA;AAClE;ACRA,MAAM,uBAAuB,cAAoC,IAAI;AAG9D,SAAS,sBAAsB;AAAA,EACpC;AAAA,EACA,SAAA6P;AACF,GAGG;AACD,6BAAQ,qBAAqB,UAArB,EAA8B,OAAOA,UAAU,SAAS,CAAA;AAClE;AAGO,SAAS,mBAAkC;AAC1C,QAAA,QAAQ,WAAW,oBAAoB;AAC7C,MAAI,CAAC;AAAa,UAAA,IAAI,MAAM,gDAAgD;AACrE,SAAA;AACT;ACfa,MAAA,gCACX,cAAyD,IAAI,GCDlD,iCAAiC,KAAK,SAA+C;AAAA,EAChG;AAAA,EACA,SAAAA;AAAA,EACA;AAAA,EACA;AACF,GAKG;AACD,QAAM,QAAQ;AAAA,IACZ,OACG;AAAA,MACC;AAAA,MACA;AAAA,IAAA;AAAA,IAEJ,CAAC,iBAAiB,kBAAkB;AAAA,EAAA;AAIpC,SAAA,oBAAC,8BAA8B,UAA9B,EAAuC,OACtC,UAAC,oBAAA,uBAAA,EAAsB,SAAAA,UAAmB,SAAS,CAAA,EACrD,CAAA;AAEJ,CAAC;ACnBM,SAAS,0BAA0B,YAA2C;AAWnF,QAAM,iBAVoB,WAAW;AAAA,IAAI,CAAC;AAAA;AAAA,MAExC,UAAU,SAEP,UAAU,CAAC,EACX,MAAM,GAAG;AAAA;AAAA,EAAA,EAK2B,OAAO,CAAC,gBAAgB,aAAa;AAC5E,aAAS,IAAI,GAAG,IAAI,eAAe,QAAQ,KAAK;AACxC,YAAA,gBAAgB,eAAe,CAAC,GAChC,UAAU,SAAS,CAAC,EAAE;AAE5B,UAAI,kBAAkB;AACb,eAAA,eAAe,MAAM,GAAG,CAAC;AAAA,IAEpC;AAEO,WAAA;AAAA,EAAA,CACR;AAID,WAAS,qCAAqC,CAACnB,QAAO,GAAG,IAAI,GAAqB;AAC3E,WAAAA,SACE,OAAO6B,eAAa7B,MAAK,CAAC,GAAG,qCAAqC,IAAI,CAAC,cAD3D;AAAA,EAErB;AAEA,SAAO,IAAI,OAAO,IAAI,qCAAqC,cAAc,CAAC,KAAK,GAAG;AACpF;AC3BO,SAAS,eAAe;AAAA,EAC7B;AAAA,EACA;AAAA,EACA;AACF,GAAgD;AACxC,QAAA,CAAC,cAAc,IAAI;AAEzB,aAAW,EAAC,WAAW,UAAU,eAAA8B,eAAkB,KAAA;AAKjD,QAAIA,eAAc,KAAK,QAAQ,KAAK,aAAa;AACxC,aAAA,EAAC,MAAM,SAAS;AAKvB,SAAA,aAAa,MACR,EAAC,MAAM,YAAY,UAAU,eAAe,SAAQ,IAGzD,cAAc,KAAK,QAAQ,IAEtB,EAAC,MAAM,YAAY,UAAU,eAAe,aAM9C,EAAC,MAAM;AAChB;AC9CO,SAAS,wBAAwB,YAA2D;AAC1F,SAAA;AAAA,IACL,MAAM,qBAAqB,UAAU;AAAA,IACrC,CAAC,UAAU;AAAA,EAAA;AAEf;AAGO,SAAS,qBAAqB,YAA2D;AACvF,SAAA,WAAW,IAAI,CAAC,cAAc;AAC7B,UAAA,WAAW,UAAU,YAAY;AAChC,WAAA;AAAA,MACL;AAAA,MACA,MAAM,UAAU;AAAA,MAChB;AAAA;AAAA;AAAA;AAAA;AAAA,MAKA,eAAe,IAAI,OAAO,IAAID,eAAa,QAAQ,CAAC,WAAW,GAAG;AAAA,IAAA;AAAA,EACpE,CACD;AACH;AChBgB,SAAA,6BACdV,UACA,aACsB;AAGhB,QAAA,aAAa,wBAAwB,WAAW,GAEhD,gBAAgB,QAAQ,MAAM,0BAA0B,UAAU,GAAG,CAAC,UAAU,CAAC,GAEjF,CAAC,cAAc,IAAI,SAAS,MAAMA,SAAQ,SAAS,QAAQ,GAK3D,QAAQ,QAAQ,OACb;AAAA,IACL,WAAW,CAAC,kBAA8BA,SAAQ,OAAO,aAAa;AAAA,IACtE,aAAa,MAAMA,SAAQ,SAAS;AAAA,IACpC,mBAAmB,MAAM;AAAA,IACzB,UAAU,CAAC,aAAqB,eAAe,EAAC,eAAe,UAAU,YAAW;AAAA,IACpF,SAAS,CAAC,GAAyB,MAA4B;AACzD,UAAA,EAAE,SAAS,EAAE;AAAa,eAAA;AAC9B,cAAQ,EAAE,MAAM;AAAA,QACd,KAAK;AACI,iBAAA,EAAE,cAAe,EAAe;AAAA,QACzC,KAAK;AACI,iBAAA,EAAE,aAAc,EAAe;AAAA,QACxC,KAAK;AACI,iBAAA;AAAA,QACT;AAEE,gBAAM,IAAI,MAAM,iBAAkB,EAAU,IAAI,EAAE;AAAA,MACtD;AAAA,IACF;AAAA,EAAA,IAED,CAAC,eAAeA,UAAS,gBAAgB,UAAU,CAAC;AAEhD,SAAA;AAAA,IACL,MAAM;AAAA,IACN,MAAM;AAAA,IACN,MAAM;AAAA,IACN,MAAM;AAAA,IACN,MAAM;AAAA,EAAA;AAEV;AC1CA,MAAM,gBAAgB,MACpB,OAAO,WAAa,MAAc,oBAAA,IAAwB;AAGrD,SAAS,uBAAuB;AAAA,EACrC;AAAA,EACA;AAAA,EACA;AAAA,EACA,kBAAkB;AACpB,GAAgC;AAC9B,QAAM,aAAa,iBACbA,WAAU,QAAQ,MAAM,eAAe,cAAiB,GAAA,CAAC,WAAW,CAAC,GAErE,yBAAyB;AAAA,IAC7B,CAAC,kBAA0B;AACzB,YAAM,iBAAiB,WAAW,KAAK,CAAC,cAAc,UAAU,SAAS,aAAa;AAClF,wBACFA,SAAQ,KAAK,eAAe,QAAQ;AAAA,IAExC;AAAA,IACA,CAACA,UAAS,UAAU;AAAA,EAAA,GAEhB,mCAAmC,YAAY,MAAM;AAClC,2BAAA,WAAW,CAAC,EAAE,IAAI;AAAA,EAAA,GACxC,CAAC,wBAAwB,UAAU,CAAC,GAEjC,SAAS,6BAA6BA,UAAS,UAAU;AAQ/D,UANA,UAAU,MAAM;AACV,WAAO,SAAS,cAClBA,SAAQ,QAAQ,OAAO,QAAQ;AAAA,KAEhC,CAACA,UAAS,MAAM,CAAC,GAEZ,OAAO,MAAM;AAAA,IACnB,KAAK;AAED,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,iBAAiB,OAAO;AAAA,UACxB,SAAAA;AAAA,UACA,oBAAoB;AAAA,UAEnB;AAAA,QAAA;AAAA,MAAA;AAAA,IAGP,KAAK;AACH,iCAAQ,kBAAiB,CAAA,CAAA;AAAA,IAC3B,KAAK;AACI,aAAA,oBAAC,mBAAkB,EAAA,8BAA8B,iCAAkC,CAAA;AAAA,IAC5F;AAEE,YAAM,IAAI,MAAM,iBAAkB,OAAe,IAAI,EAAE;AAAA,EAC3D;AACF;AC7DO,SAAS,qBAAyD;AACjE,QAAA,QAAQ,WAAW,6BAA6B;AACtD,MAAI,CAAC;AAAa,UAAA,IAAI,MAAM,iDAAiD;AACtE,SAAA;AACT;ACJa,MAAA,sBAAsB,cAA+C,IAAI,GCWzE,0BAA0B,cAAgD,IAAI,GAO9E,6BAA6B,cAExC,IAAI;AAGN,SAAS,kBAAuC;AAC1B,SAAA,eAAA,IACC,SAAS;AAChC;AAEA,SAAS,mBAAmB;AAAA,EAC1B;AAAA,EACA,QAAQ;AACV,GAGG;AACD,QAAM,eAAe;AAInB,SAAA,oBAAC,iBAAc,QAHF,YAAY,WAAW,eAAe,SAGpB,OAAO,aAKnC,SACH,CAAA;AAEJ;AAEA,MAAM,oBAAoB;AAUnB,SAAS,oBAAoB;AAAA,EAClC;AAAA,EACA;AAAA,EACA,QAAQ;AACV,GAA6B;AACvB,SAAA,aAEC,oBAAA,2BAAA,EAA0B,QAAQ,YAAY,gBAC5C,SAAA,CACH,IAKF,oBAAC,iCAAgC,EAAA,gBAC9B,SACH,CAAA;AAEJ;AAMO,SAAS,gCAAgC;AAAA,EAC9C;AAAA,EACA;AACF,GAAkE;AAC1D,QAAA,QAAQ,QAAQ,MAAM;AACtB,QAAA;AACE,UAAA,kCAAkB;AAEjB,WAAA;AAAA,MACL,WAAW,CAAC,mBACL,aACH,WAAW,UAAU,aAAa,QAAQ,iBAAiB,CAAC,KAAK,WAEnE,YAAY,IAAI,aAAa,GACtB,MAAM;AACX,oBAAY,OAAO,aAAa;AAAA,MAAA;AAAA,MAGpC,aAAa,MAAM;AAAA,MACnB,aAAa,CAAC,eAA0C;AACtD,mBAAW,UAAU,UAAU;AAC/B,mBAAW,gBAAgB;AACZ;MAEjB;AAAA;AAAA;AAAA,MAGA,mBAAmB,MAAM;AAAA,IAAA;AAAA,EAE7B,GAAG,EAAE,GACC,SAAS,qBAAqB,MAAM,WAAW,MAAM,aAAa,MAAM,iBAAiB;AAE/F,SAAA,UAAU,MAAM;AACV,WAAO,kBAAmB,cAC5B,eAAe,MAAM,GAEvB,aAAa,QAAQ,mBAAmB,MAAM;AAAA,EAChD,GAAG,CAAC,gBAAgB,MAAM,CAAC,GAGxB,oBAAA,2BAA2B,UAA3B,EAAoC,OAAO,MAAM,aAChD,UAAC,oBAAA,wBAAwB,UAAxB,EAAiC,OAAO,QACvC,8BAAC,oBAAmB,EAAA,QAAiB,SAAS,CAAA,EAChD,CAAA,EACF,CAAA;AAEJ;AAEA,SAAS,UAAU,QAA4C;AAC7D,UAAQ,QAAQ;AAAA,IACd,KAAK;AAAA,IACL,KAAK;AACI,aAAA;AAAA,IACT;AACS,aAAA;AAAA,EACX;AACF;AAMO,SAAS,0BAA0B;AAAA,EACxC;AAAA,EACA;AAAA,EACA;AACF,GAEG;AAEC,SAAA;AAAA,IAAC,2BAA2B;AAAA,IAA3B;AAAA,MACC,OAAO,OAAO,kBAAmB,aAAa,iBAAiB;AAAA,MAE/D,UAAA,oBAAC,wBAAwB,UAAxB,EAAiC,OAAO,QACvC,UAAC,oBAAA,oBAAA,EAAmB,QAAiB,SAAA,CAAS,EAChD,CAAA;AAAA,IAAA;AAAA,EAAA;AAGN;AAGO,SAAS,yBAAyB;AACjC,QAAA,WAAW,WAAW,0BAA0B;AACtD,MAAI,aAAa;AAAY,UAAA,IAAI,MAAM,qDAAqD;AACrF,SAAA;AACT;AAGO,SAAS,+BAA0D;AAClE,QAAA,QAAQ,WAAW,uBAAuB;AAChD,MAAI,UAAU;AAAY,UAAA,IAAI,MAAM,kDAAkD;AAC/E,SAAA;AACT;AAGO,SAAS,sBAA2C;AACzD,QAAM,SAAS,6BAAA,GACT,eAAe,gBAAgB;AAC9B,SAAA,WAAW,WAAW,eAAe;AAC9C;AAMO,SAAS,iBAAiB;AAC/B,QAAM,SAAS,oBAAA,GACT,YAAY,uBAAuB;AAClC,SAAA,QAAQ,OAAO,EAAC,QAAQ,UAAa,IAAA,CAAC,QAAQ,SAAS,CAAC;AACjE;AAagB,SAAA,sBACd,WACA3P,IACA;AACA,QAAM,SAAS;AAEf,SAAO,QAAQ,MACN;AAAA,IACL;AAAA,MACE,OAAOA,GAAE,qCAAqC;AAAA,MAC9C,MAAM;AAAA,MACN,OAAOA,GAAE,2CAA2C;AAAA,MACpD,UAAU,WAAW;AAAA,MACrB,UAAU,MAAM,UAAU,QAAQ;AAAA,MAClC,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,OAAOA,GAAE,mCAAmC;AAAA,MAC5C,MAAM;AAAA,MACN,OAAOA,GAAE,yCAAyC;AAAA,MAClD,UAAU,WAAW;AAAA,MACrB,UAAU,MAAM,UAAU,MAAM;AAAA,MAChC,MAAM;AAAA,IACR;AAAA,IACA;AAAA,MACE,OAAOA,GAAE,oCAAoC;AAAA,MAC7C,MAAM;AAAA,MACN,OAAOA,GAAE,0CAA0C;AAAA,MACnD,UAAU,WAAW;AAAA,MACrB,UAAU,MAAM,UAAU,OAAO;AAAA,MACjC,MAAM;AAAA,IACR;AAAA,EAED,GAAA,CAAC,QAAQ,WAAWA,EAAC,CAAC;AAC3B;ACjPA,MAAM,iBAAiB,SAAS,OAAO,iBAAiB,EAAE,GACpDuQ,aAAW,SAAS,QAAQ;AAQ3B,SAAS,iBAAiB;AAAA,EAC/B;AAAA,EACA;AAAA,EACA;AACF,GAIS;AACP,QAAM,EAAC,WAAU,IAAI,SAEf,GAAA,cAAc,YAAY,MAAM;AACpC,eAAA,QAAA;EACC,GAAA,CAAC,OAAO,CAAC,GAEN,sBAAsB;AAAA,IAC1B,CAAC,UAAyB;AACpB,qBAAe,KAAK,MACtB,MAAM,kBACF,OACF,YAAY,IAEZ,6BAGAA,WAAS,KAAK,KAAK,QAAQ,cAC7B;IAEJ;AAAA,IACA,CAAC,aAAa,YAAY,MAAM,MAAM;AAAA,EAAA;AAGxC,mBAAiB,mBAAmB;AACtC;ACnCO,SAAS,cAAc;AAAA,EAC5B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAuB;AACf,QAAA,eAAe,OAAO,EAAK,GAE3B;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,OAAO,EAAC,OAAM;AAAA,EACZ,IAAA,eAKE,GAAA,cAAc,YAAY,MAAM;AAhCxC,QAAAzQ;AAiCa,aAAA,EAAC,QAAOA,MAAA,qBAAA,OAAA,SAAA,kBAAmB,YAAnB,MAAA,OAAAA,MAAoC,IAAI,MAAM,wBAAwB,CAAA,GACvF;EACC,GAAA,CAAC,UAAU,SAAS,iBAAiB,CAAC;AAKxB,SAAA,iBAAA,EAAC,SAAS,aAAa,QAAQ,KAAK,CAAA,GAKrD,UAAU,MAAM;AACd,eAAW,WAAW;AAAA,KACrB,CAAC,aAAa,UAAU,CAAC,GAM5B,UAAU,MAAM;AACd,KAAK,CAAC,iBAAiB,OAAO,WAAW,aAAa,WACpD,SAAS,EAAC,OAAO,GAAG,MAAM,wBAAwB,CAAA;AAAA,EAAA,GAEnD,CAAC,UAAU,eAAe,OAAO,MAAM,CAAC,GAK3C,UAAU,MAAM;AACV,KAAC,iBAAiB,aAAa,WAAW,CAAC,QAC7C,SAAS,EAAC,MAAM,iBAAA,CAAiB;AAAA,EAAA,GAElC,CAAC,UAAU,eAAe,IAAI,CAAC,GAKlC,UAAU,MAAM;AACT,oBAAA,QAAA,aAAc,YACjB,aAAa,UAAU;AAAA,EAAA,GAExB,CAAA,CAAE,GAEE;AACT;AC9DO,SAAS,mCACd0Q,sBACoC;AACpC,SAAOA,qBAAoB,OAA2C,CAAC,KAAK,SAC1E,IAAI,IAAI,IAAI,IAAI,KACT,MACN,CAAE,CAAA;AACP;AAEgB,SAAA,sBACd,WACA,cACsC;AAC/B,SAAA,eAAe,UAAU,YAAY,IAAI;AAClD;AAEgB,SAAA,wBACd,WACA,cACsD;AAnCxD,MAAA1Q;AAoCE,UAAOA,MAAsB,sBAAA,WAAW,YAAY,MAA7C,OAAgD,SAAAA,IAAA;AACzD;AChBgB,SAAA,kBACd,kBACA,SACc;AAxBhB,MAAAA;AAyBS,SAAA;AAAA,IACL;AAAA,IACA,YAAY,iBAAiB;AAAA,IAC7B,gBACEA,MAAkB,oBAAA,OAAA,SAAA,iBAAA,UAAU,KAAK,CAAC,aACzB,SAAS,SAAS,MAD3B,MAAA,OAAA,SAAAA,IAEI,SAAQ;AAAA,EAAA;AAElB;AAEO,SAAS,oBAAoB;AAAA,EAClC;AAAA,EACA,mBAAAkQ;AAAA,EACA;AAAA,EACA,qBAAAQ;AACF,GAKW;AACT,SAAO,QACJ;AAAA,IAAO,CAAChJ,YACP,eAAe;AAAA,MACb,QAAAA;AAAA,MACA,mBAAAwI;AAAA,MACA;AAAA,MACA,qBAAAQ;AAAA,IAAA,CACD;AAAA,EAAA,EAEF,IAAI,CAAChJ,YAAW;AAvDrB,QAAA1H;AAwDM,YAAOA,4BAAsB0Q,sBAAqBhJ,QAAO,YAAY,MAA9D,oBAAiE,WAAW;AAAA,MACjF,WAAW,iBAAiB,EAAC,QAAAA,SAAQ,kBAAkB,mBAAAwI,oBAAkB;AAAA,MACzE,OAAOxI,WAAQ,OAAA,SAAAA,QAAA;AAAA,IAAA,CACjB;AAAA,EACD,CAAA,EACA,OAAO,CAACA,YAAW,CAACkE,UAAQlE,OAAM,CAAC,EACnC,OAAOjI,eAAa,EACpB,KAAK,MAAM;AAChB;AAEgB,SAAA,mBACd,QACAiI,SACmC;AACnC,SAAOA,WAAQ,QAAAA,QAAA,UAAU,OAAOA,QAAO,OAAO,IAAI;AACpD;AAEO,SAAS,aAAaA,SAA8B;AACzD,SAAO,CAACA,QAAO,YAAY,GAAIA,QAAO,UAAU,CAACA,QAAO,OAAO,IAAI,CAAG,CAAA,EAAE,KAAK,GAAG;AAClF;AAEO,SAAS,oBAAoB;AAAA,EAClC;AAAA,EACA;AAAA,EACA;AACF,GAIa;AAEL,QAAA,wBAAwB,MAAM,IAAI,CAAC,SAAS,KAAK,IAAI,GAErD,wBAAwB,OAAO,OAAO,gBAAgB,EACzD,OAAO,CAAC,UAAU,QAAQ,IAAI,CAACA,YAAWA,WAAQ,OAAA,SAAAA,QAAA,OAAO,EAAE,SAAS,MAAM,EAAE,CAAC,EAC7E,OAAO,CAAC,UAAU,MAAM,cAAc,SAAS,CAAC,EAChD,IAAI,CAAC,UAAU,MAAM,aAAa,GAI/B,4BAA4B7C,eAAa,GAAG,qBAAqB,GAEjE,gBAA4B;AAClC,SAAI,sBAAsB,SAAS,KACjC,cAAc,KAAK,qBAAqB,GAEtC,0BAA0B,SAAS,KACrC,cAAc,KAAK,yBAAyB,GAGvCA,eAAa,GAAG,aAAa,EAAE;AACxC;AAEA,SAAS,iBAAiB;AAAA,EACxB,QAAA6C;AAAA,EACA;AAAA,EACA,mBAAAwI;AACF,GAIuB;AACf,QAAA,kBAAkB,mBAAmB,kBAAkBxI,OAAM,GAC7D,mBAAmB,oBAAoBwI,oBAAmBxI,QAAO,UAAU;AAE5E,MAAA;AAIL,YAAQ,iBAAiB,MAAM;AAAA,MAC7B,KAAK;AACH,eAAO,mBAAiB,OAAA,SAAA,gBAAA;AAAA,MAC1B,KAAK;AACH,eAAO,oBAAkB,OAAA,SAAA,iBAAA;AAAA,MAC3B;AACE;AAAA,IACJ;AACF;AAQO,SAAS,eAAe;AAAA,EAC7B,QAAAA;AAAA,EACA,mBAAAwI;AAAA,EACA;AAAA,EACA,qBAAAQ;AACF,GAKY;AACV,QAAM,YAAY,oBAAoBR,oBAAmBxI,QAAO,UAAU,GACpE,cAAc,sBAAsBgJ,sBAAqBhJ,QAAO,YAAY,GAC5E,WAAW,mBAAmB,kBAAkBA,OAAM;AAwC5D,SArCI,GAAC,aAKD,CAAC,eAKDA,QAAO,WACL,CAAC,YAMH,UAAU,SAAS,YAEjB,EAAC,6BAAU,cAIX,CAACA,QAAO,WAQR,CAJmB,YAAY,WAAW;AAAA,IAC5C,WAAW,SAAS;AAAA,IACpB,OAAOA,QAAO;AAAA,EAAA,CACf,MAOC,UAAU,SAAS,YAMjB,CAJmB,YAAY,WAAW;AAAA,IAC5C,WAAW,UAAU;AAAA,IACrB,OAAOA,QAAO;AAAA,EACf,CAAA;AAOL;AChMA,MAAM,WAAW,SAAS,QAAQ,GAE5B,aAAa,KAEb,gBAAgB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUtB,SAAS,qBAAqB;AAAA,EACnC;AAAA,EACA;AAAA,EACA;AACF,GAA8B;AAC5B,QAAM,EAAC,WAAc,IAAA,YAEf,sBAAsB;AAAA,IAC1B,CAAC,UAAyB;AACpB,eAAS,KAAK,KAAK,cACrB,QAAQ;AAAA,IAEZ;AAAA,IACA,CAAC,YAAY,OAAO;AAAA,EAAA;AAGtB,mBAAiB,mBAAmB;AAE9B,QAAA,gBAAgB,iBAAiB,iBAAiB,IAAI;AAE5D,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAC,oBAAA,eAAA,EAAc,SAAS,QAAS,CAAA;AAAA,IAChC,oBAAA,WAAA,EAAU,WAAW,IAAO,aAAW,IACtC,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAQ;AAAA,QACR,UAAS;AAAA,QACT,QAAQ;AAAA,QACR,OAAO;AAAA,UACL,WAAW,oBAAoB,aAAa,QAAQ,uBAAuB,QAAQ,qBAAqB,QAAQ,UAAU;AAAA,UAC1H,QAAQ;AAAA,QACV;AAAA,QAEA,UAAA,oBAAC,QAAM,SAAS,CAAA;AAAA,MAAA;AAAA,IAAA,GAEpB;AAAA,EACF,EAAA,CAAA;AAEJ;AAEA,SAAS,kBAAkB,SAAsB;AACzC,QAAA,OAAO,QAAQ;AACN,SAAA,KAAK,IAAI,KAAK,SAAS;AAExC;AAEA,SAAS,iBAAiB,SAA6B;AACrD,QAAM,CAAC,QAAQ,SAAS,IAAI,SAAwB,WAAW,kBAAkB,OAAO,CAAC,GAEnF,qBAAqB,YAAY,MAAM;AACvC,eACF,UAAU,kBAAkB,OAAO,CAAC;AAAA,EAAA,GAErC,CAAC,OAAO,CAAC;AAEZ,SAAA,UAAU,MAAM;AACV,eACF,UAAU,kBAAkB,OAAO,CAAC;AAAA,EAAA,GAErC,CAAC,OAAO,CAAC,GAEZ,UAAU,OACR,OAAO,iBAAiB,UAAU,kBAAkB,GAC7C,MAAM,OAAO,oBAAoB,UAAU,kBAAkB,IACnE,CAAC,kBAAkB,CAAC,GAEhB;AACT;AC/EA,MAAM,kBAAkB,OAAO,GAAG;AAAA,6BACL,CAAC,EAAC,YAAW,MAAM,OAAO,MAAM,KAAK,MAAM;AAAA;AAAA,GAIlE,0BAA0B,OAAO,IAAI;AAAA;AAAA,GAI9B,6BAA6B,WAGxC,SAAoC,EAAC,gBAAgB,UAAU,SAAS,WAAU,GAAG,KAAK;AACpF,QAAA;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,MAChB,eAAe,GACb,EAAC,GAAAxH,OAAK,eAAe;AAGzB,SAAA,oBAAC,mBACC,UAAC,oBAAA,yBAAA,EAAwB,OAAM,UAAS,MAAM,GAAG,SAAS,GACxD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,6BAA2B;AAAA,MAC3B,mBAAiB;AAAA,MACjB,cAAY;AAAA,MACZ,cAAa;AAAA,MACb,QAAQ;AAAA,MACR,aAAa,CAAC,CAAC;AAAA,MACf,UAAU,aAAa,IAAI;AAAA,MAC3B,MAAM;AAAA,MACN,OAAK;AAAA,MACL;AAAA,MACA;AAAA,MACA,aAAaA,GAAE,2BAA2B;AAAA,MAC1C;AAAA,MACA,YAAY;AAAA,MACZ,QAAQ;AAAA,MACR,OAAO;AAAA,IAAA;AAAA,EAAA,EAEX,CAAA,EACF,CAAA;AAEJ,CAAC;AC/BM,SAAS,sBAAsB;AAAA,EACpC;AAAA,EACA;AAAA,EACA,mBAAAgQ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAAhQ;AACF,GAQqB;AAEnB,QAAM,eAAe,OAAO,OAAO,gBAAgB,EAChD,OAAO,CAAC,aAAa,+BAA+B,UAAU,WAAW,CAAC,EAC1E,IAAI,CAAC,aAAa;AACjB,UAAM,YAAY,oBAAoBgQ,oBAAmB,SAAS,UAAU;AAC5E,WAAI,YACK,kBAAkB,WAAW,SAAS,EAAE,IAE1C;AAAA,EACR,CAAA,EACA,OAAOzQ,eAAa,GAEjB,cAAc,qBAAqB;AAAA,IACvC;AAAA,IACA,mBAAAyQ;AAAA,IACA;AAAA,EAAA,CACD;AAEG,SAAA,sBAAsB,WAAW,IAC5B;AAAA,IACL,GAAG;AAAA;AAAA,IAEH,GAAG,YAAY;AAAA,MACb;AAAA,MACA,mBAAAA;AAAA,MACA,SAAS;AAAA,MACT,aAAahQ,GAAE,iCAAiC;AAAA,MAChD,IAAI;AAAA,IAAA,CACL;AAAA,EAAA,IAIE;AAAA,IACL,GAAG;AAAA;AAAA,IAEH,GAAG,4BAA4B;AAAA,MAC7B;AAAA,MACA;AAAA,MACA,mBAAAgQ;AAAA,MACA,SAAS;AAAA,MACT;AAAA,MACA;AAAA,MACA,GAAAhQ;AAAA,IAAA,CACD;AAAA,EAAA;AAEL;AAEA,SAAS,YAAY;AAAA,EACnB;AAAA,EACA,mBAAAgQ;AAAA,EACA;AAAA,EACA,IAAArR;AAAA,EACA;AAAA,EACA;AACF,GAOqB;AACnB,QAAM,SAA+B;AAAA,IACnC,OAAO,eAAe;AAAA,IACtB,MAAM,QAAQ;AAAA,IACd,MAAM;AAAA,EAAA,GAEF,cAAc,QAAQ;AAAA,IAC1B,CAAC6I,aACE;AAAA,MACC,iBAAiB,mBAAmB,kBAAkBA,OAAM;AAAA,MAC5D,kBAAkB,oBAAoBwI,oBAAmBxI,QAAO,UAAU;AAAA,MAC1E,QAAAA;AAAA,MACA,OAAO7I;AAAA,MACP,MAAM,QAAQ;AAAA,MACd,MAAM;AAAA,IAAA;AAAA,EACR;AAGG,SAAA,YAAY,SAAS,IACxB;AAAA,IACE,GAAI,cAAc,CAAC,MAAM,IAAI,CAAC;AAAA;AAAA,IAC9B,GAAG;AAAA,MAEL;AACN;AAMA,SAAS,4BAA4B;AAAA,EACnC;AAAA,EACA;AAAA,EACA,mBAAAqR;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAAhQ;AACF,GAQG;AACD,QAAM,gBAAgB,QAAQ,OAAO,CAACwH,YAAW;AACzC,UAAA,kBAAkB,mBAAmB,kBAAkBA,OAAM;AAC5D,WAAA,oBAAoB,uBAAuB,eAAe;AAAA,EAAA,CAClE,GAEK,cACJ,sBAAsB,SAAS,KAAK,MAAM,SAAS,IAC/C,YAAY;AAAA,IACV;AAAA,IACA,mBAAAwI;AAAA,IACA,SAAS;AAAA,IACT,aAAahQ,GAAE,oCAAoC;AAAA,IACnD,IAAI;AAAA,IACJ,MAAM;AAAA,EAAA,CACP,IACD,CAAC,GAED,eAAe,sBAClB,IAAI,CAAC,iBAAiB;AACf,UAAA,UAAU,OAAO,IAAI,YAAY;AAChC,WAAA;AAAA;AAAA;AAAA;AAAA,MAIL,QAAO,WAAS,OAAA,SAAA,QAAA,UAAS,UAAU,WAAA,OAAA,SAAA,QAAS,IAAI,KAAK;AAAA,MACrD;AAAA,IAAA;AAAA,EACF,CACD,EAEA,KAAK,CAAC,GAAG,MAAM,EAAE,MAAM,cAAc,EAAE,KAAK,CAAC,EAC7C,IAAI,CAAC,EAAC,cAAc,YAAW;AAC9B,UAAM,eAAe,QAAQ,OAAO,CAACwH,YAAW;AACxC,YAAA,kBAAkB,mBAAmB,kBAAkBA,OAAM;AACnE,aAAO,sBAAsB,CAAC,YAAY,GAAG,eAAe;AAAA,IAAA,CAC7D;AACD,WAAO,YAAY;AAAA,MACjB;AAAA,MACA,mBAAAwI;AAAA,MACA,SAAS;AAAA,MACT,IAAI;AAAA,MACJ,aAAa;AAAA,IAAA,CACd;AAAA,EAAA,CACF,EACA,KAAK;AAER,SAAO,CAAC,GAAG,aAAa,GAAG,YAAY;AACzC;AAMA,SAAS,qBAAqB;AAAA,EAC5B;AAAA,EACA,mBAAAA;AAAA,EACA;AACF,GAIG;AAED,QAAM,yBAAyB,OAAO,OAAOA,kBAAiB,EAC3D,OAAO,6BAA6B,EACpC,OAAO,CAAC,cAAc,sCAAsC,WAAW,WAAW,CAAC,EACnF,IAAI,CAAC,cAAc,kBAAkB,SAAS,CAAC,GAG5C,uBAAuB,OAAO,OAAOA,kBAAiB,EACzD,OAAO,0BAA0B,EACjC,OAAO,CAAC,cAAc,sCAAsC,WAAW,WAAW,CAAC,EACnF,OAAuC,CAAC,KAAK,SAC5C,IAAI,IAAI,KAAK,IAAI,IAAI,IAAI,KAAK,KAAK,CAAC,GACpC,IAAI,IAAI,KAAK,EAAE,KAAK,kBAAkB,GAAG,CAAC,GACnC,MACN,CAAE,CAAA;AAEA,SAAA;AAAA;AAAA,IAEL,GAAG,YAAY;AAAA,MACb;AAAA,MACA,mBAAAA;AAAA,MACA,SAAS;AAAA,MACT,IAAI;AAAA,MACJ,MAAM;AAAA,IAAA,CACP;AAAA;AAAA,IAED,GAAG,OAAO,QAAQ,oBAAoB,EAAE;AAAA,MAAQ,CAAC,CAAC,YAAY,OAAO,MACnE,YAAY;AAAA,QACV;AAAA,QACA,mBAAAA;AAAA,QACA;AAAA,QACA,aAAa;AAAA,QACb,IAAI;AAAA,QACJ,MAAM;AAAA,MAAA,CACP;AAAA,IACH;AAAA,EAAA;AAEJ;AAEA,SAAS,sBAAsB,eAAyB,iBAAyC;AAC/F,SAAO,mDAAiB,cAAc,KAAK,CAAC,SAAS,cAAc,SAAS,IAAI,CAAA;AAClF;AAEA,SAAS,+BAA+B,OAA8B,cAAsB;AACvE,SAAA,MAAM,UAAU,KAAK,GAAG,EACzB,YAAc,EAAA,SAAS,aAAa,YAAA,CAAa;AACrE;AAEA,SAAS,sCACPxI,SACA,cACA;AACA,SAAOA,QAAO,MAAM,YAAA,EAAc,SAAS,aAAa,aAAa;AACvE;AAEA,SAAS,2BACP,WAC6D;AAC7D,SAAO,UAAU,SAAS,YAAY,QAAO,uCAAW,SAAU;AACpE;AAEA,SAAS,8BACP,WAC2C;AAC3C,SAAO,UAAU,SAAS,YAAY,QAAO,uCAAW,SAAU;AACpE;AAEA,SAAS,oBAAoB,eAAyB,iBAAyC;AAC7F,SAAO,WAAW,gBAAe,mBAAA,OAAA,SAAA,gBAAiB,kBAAiB,CAAA,CAAE,EAAE,WAAW;AACpF;AC9QO,SAAS,YAAY,EAAC,QAAAA,SAAQ,aAA8B;AAC3D,QAAA;AAAA,IACJ,OAAO,EAAC,YAAW;AAAA,EACjB,IAAA,eAEE,GAAA,QAAQ,QAAQ,MAAM;AAC1B,UAAM,YAAY,oBAAoB,YAAY,SAASA,QAAO,UAAU;AAC5E,YAAQ,uCAAW,MAAM;AAAA,MACvB,KAAK,SAAS;AACZ,cAAM,kBAAkB,mBAAmB,YAAY,QAAQA,OAAM;AACjE,eAAA,mBAAA,QAAA,gBAAiB,YACZ,gBAAgB,UAAU,gBAAgB,UAAU,SAAS,CAAC,IAEhE;AAAA,MACT;AAAA,MACA,KAAK;AACH,eAAO,UAAU;AAAA,MACnB;AACS,eAAA;AAAA,IACX;AAAA,EAAA,GACC,CAAC,aAAaA,OAAM,CAAC;AAExB,SAAK,QAIE,aAAa,MAAM,SAAS,iCAChC,QAAM,EAAA,UAAA;AAAA,IAAM,MAAA,MAAM,GAAG,SAAS;AAAA,IAAE;AAAA,EAAA,EAAC,CAAA,IAElC,oBAAC,QAAM,EAAA,UAAA,MAAA,CAAM,IANN;AAQX;AChCgB,SAAA,WAAW,EAAC,QAAAA,WAA0B;AAXtD,MAAA1H;AAYQ,QAAA;AAAA,IACJ,OAAO,EAAC,YAAW;AAAA,EAAA,IACjB,eAAe,GAEb,QAAOA,MAAA,oBAAoB,YAAY,SAAS0H,QAAO,UAAU,MAA1D,OAA6D,SAAA1H,IAAA;AAC1E,SAAI,OACK,cAAc,IAAI,wBAEnB,aAAY,CAAA,CAAA;AACtB;ACPgB,SAAA,cAAc,EAAC,QAAA0H,WAA6B;AAd5D,MAAA1H;AAeQ,QAAA;AAAA,IACJ,OAAO,EAAC,YAAW;AAAA,EAAA,IACjB,eAAe,GACb,kBAAkB,mBAAmB,YAAY,QAAQ0H,OAAM;AAGnE,SAAA,qBAAC,OAAM,EAAA,OAAO,GAEX,UAAA;AAAA,KAAiB,mBAAA,OAAA,SAAA,gBAAA,gBAAa1H,MAAgB,gBAAA,cAAhB,OAA2B,SAAAA,IAAA,UAAS,KAChE,oBAAA,KAAA,EAAI,YAAY,GACf,UAAC,oBAAAgB,QAAA,EAAK,OAAK,IAAC,MAAM,GACf,UAAA,gBAAgB,UAAU,MAAM,GAAG,EAAE,EAAE,IAAI,CAAC,WAAW,UAEpD;AAAA,MAACJ;AAAAA,MAAA;AAAA,QAIC,UAAA;AAAA,UAAA,oBAAC,UAAM,UAAU,UAAA,CAAA;AAAA,UAChB,UAAU,gBAAgB,UAAU,SAAS,KAC5C;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,OAAO;AAAA,gBACL,SAAS;AAAA,gBACT,aAAa;AAAA,gBACb,cAAc;AAAA,cAChB;AAAA,cAEA,8BAAC,kBAAiB,EAAA;AAAA,YAAA;AAAA,UACpB;AAAA,QAAA;AAAA,MAAA;AAAA,MAZG;AAAA,IAAA,CAgBV,GACH,EACF,CAAA;AAAA,IAGD,qBAAA,MAAA,EAAK,OAAM,cAAa,KAAK,GAC5B,UAAA;AAAA,MAAA,oBAAC,KAAI,EAAA,OAAO,EAAC,YAAY,EACvB,GAAA,UAAA,oBAACI,QAAK,EAAA,MAAM,GACV,UAAA,oBAAC,YAAW,EAAA,QAAA0G,QAAA,CAAgB,EAC9B,CAAA,GACF;AAAA,MACA,oBAAC1G,UAAK,MAAM,GAAG,QAAO,UACpB,UAAA,oBAAC,aAAY,EAAA,QAAA0G,QAAA,CAAgB,EAC/B,CAAA;AAAA,IAAA,GACF;AAAA,EACF,EAAA,CAAA;AAEJ;ACxDO,SAAS,mBAAmB,MAAqC;AAClE,SAAA,eAAe,IAAI,IACd,cAAc,eAAe,IAAI,CAAC,IAGpC,OAAO,QAAS,WAAW,OAAO;AAC3C;AAEA,SAAS,cAAc,KAAa;AAfpC,MAAA1H;AAgBS,WAAAA,MAAA,IAAI,YAAY,gBAAgB,KAAK,WAAW,MAAhD,OAAmD,SAAAA,IAAA,KAAK,gBAAe;AAChF;ACKA,MAAM,oBAAoB;AAEnB,SAAS,cAAc;AAAA,EAC5B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAuB;AACf,QAAA;AAAA,IACJ,OAAO,EAAC,sBAAqB;AAAA,EAAA,IAC3B,kBACE,EAAC,GAAAE,GAAK,IAAA,eAAA,GAEN,SAAS,UAAA,GAET,oCAAoC,QAAQ,MAC5C,mBAAiB,QAAA,gBAAA,gBACZ,gBAAgB,cACpB,IAAI,CAAC,MAAM;AACJ,UAAA,UAAU,OAAO,IAAI,CAAC;AAC5B,YAAO,WAAS,OAAA,SAAA,QAAA,UAAS,UAAU,WAAA,OAAA,SAAA,QAAS,IAAI;AAAA,EAAA,CACjD,EACA,OAAOT,eAAa,EACpB,SAEE,CAAA,GACN,CAAC,mDAAiB,eAAe,MAAM,CAAC,GAOrC,6BAA6B,QAAQ,MAAM;AAC/C,QAAI,2CAAiB,eAAe;AAClC,YAAM,eAAe,gBAAgB,cAClC,IAAI,CAAC,MAAM;AACJ,cAAA,UAAU,OAAO,IAAI,CAAC;AAC5B,YAAI,SAAS;AACX,gBAAM,QAAQ,eAAe,SAAS,gBAAgB,SAAS;AAE/D,kBAAO,+BAAO,KAAK,gBAAe,mBAAmB,SAAA,OAAA,SAAA,MAAO,KAAK,WAAW;AAAA,QAC9E;AACO,eAAA;AAAA,MAAA,CACR,EACA,OAAOA,eAAa,EACpB,KAAK,GAEF,qBAAqB,KAAK,YAAY;AAC5C,UAAI,mBAAmB,WAAW;AAChC,eAAO,mBAAmB,CAAC;AAAA,IAE/B;AAAA,KAEC,CAAC,mBAAA,OAAA,SAAA,gBAAiB,eAAe,mBAAiB,OAAA,SAAA,gBAAA,WAAW,MAAM,CAAC;AAGrE,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SACE,oBAAC,MAAK,EAAA,MAAK,WAAU,QAAQ,GAAG,OAAO,EAAC,UAAU,QAAO,GACvD,UAAC,qBAAA,OAAA,EAAM,OAAO,GAEX,UAAA;AAAA,QACC,mBAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAC,oBAAAuB,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAEd,GAAA,kCAAkC,EACvC,CAAA;AAAA,UACA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAM;AAAA,cACN,OAAO,EAAC,YAAY,YAAW;AAAA,cAC/B,MAAK;AAAA,cACL,cAAa;AAAA,cAEZ,UAAiB,mBAAA,OAAA,SAAA,gBAAA;AAAA,YAAA;AAAA,UACpB;AAAA,QAAA,GACF;AAAA,QAID,8BACC,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAC,oBAAAc,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAEd,GAAA,yCAAyC,EAC9C,CAAA;AAAA,UACA,oBAACc,UAAK,OAAK,IAAC,MAAM,GACf,UAAA,eAAe,4BAA4B,GAAG,EACjD,CAAA;AAAA,QAAA,GACF;AAAA,SAID,oBAAkB,OAAA,SAAA,iBAAA,gBAChB,oBAAAA,QAAA,EAAK,OAAK,IAAC,MAAM,GACf,UAAe,eAAA,iBAAiB,aAAa,GAAG,GACnD;AAAA,QAID,CAAC,sBAAsB,UAAU,kCAAkC,SAAS,KAC3E,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAA,qBAAC,MAAK,EAAA,OAAM,UAAS,KAAK,GACxB,UAAA;AAAA,YAAC,oBAAAA,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAEd,GAAA,oDAAoD,EACzD,CAAA;AAAA,gCACC,MAAK,EAAA,SAAS,GAAG,QAAQ,GAAG,MAAK,eAChC,UAAC,oBAAAc,QAAA,EAAK,MAAM,GAAG,OAAK,IACjB,UAAA,kCAAkC,OACrC,CAAA,GACF;AAAA,UAAA,GACF;AAAA,+BACCA,QAAK,EAAA,MAAM,GAAG,QAAO,WAAU,OAAK,IAClC,UAAA;AAAA,YAAA,kCAAkC,MAAM,GAAG,iBAAiB,EAAE,KAAK,IAAI;AAAA,aACvE,uFAAmC,UAAS,oBACzC,KAAK,kCAAkC,SAAS,iBAAiB,UACjE;AAAA,UAAA,GACN;AAAA,QAAA,GACF;AAAA,MAAA,EAAA,CAEJ,EACF,CAAA;AAAA,MAEF,UAAU,CAAC;AAAA,MACX,oBAAoB,CAAC,MAAM;AAAA,MAC3B,WAAU;AAAA,MACV,QAAM;AAAA,MAEL;AAAA,IAAA;AAAA,EAAA;AAGP;ACnIa,MAAA,iBAAiB,KAAK,SAAwB;AAAA,EACzD;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAAwB;AAChB,QAAA;AAAA,IACJ;AAAA,IACA,OAAO,EAAC,QAAO;AAAA,EACb,IAAA,eAEE,GAAA,cAAc,YAAY,MAAM;AACpC,aAAS,EAAC,QAAQ,KAAK,QAAQ,MAAM,oBAAA,CAAoB,GACzD,WAAA,QAAA,QAAA;AAAA,EACC,GAAA,CAAC,UAAU,KAAK,QAAQ,OAAO,CAAC,GAE7B,kBAAkB,CAAC,CAAC,QAAQ,KAAK,CAAC,MAAM,aAAa,CAAC,MAAM,aAAa,KAAK,MAAM,CAAC,GAGrF,iBAAiB,CAAC,EAAE,KAAK,mBAAmB,KAAK,iBAAiB;AAGtE,SAAA,oBAAC,KAAK,EAAA,GAAG,MACP,UAAA;AAAA,IAAC8M;AAAAA,IAAA;AAAA,MACC,UAAU;AAAA,MACV,UAAU;AAAA,MACV,SAAQ;AAAA,MACR,MAAK;AAAA,MACL,SAAS,kBAAkB,SAAY;AAAA,MACvC,SAAS;AAAA,MACT,OAAO,EAAC,UAAU,YAAY,YAAY,UAAU,OAAO,OAAM;AAAA,MACjE,UAAU;AAAA,MACV,MAAM,QAAM,OAAA,SAAA,KAAA;AAAA,MAEZ,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,iBAAiB,KAAK;AAAA,UACtB,kBAAkB,KAAK;AAAA,UACvB,SAAS;AAAA,UAET,UAAA,oBAAC,OAAI,SAAS,GACZ,8BAAC,eAAc,EAAA,QAAQ,KAAK,OAAA,CAAQ,EACtC,CAAA;AAAA,QAAA;AAAA,MACF;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ,CAAC,GCxDY,iBAAiB,KAAK,SAAwB,EAAC,QAA6B;AACvF,SACG,oBAAA,KAAA,EAAI,YAAY,GACf,UAAC,oBAAA,MAAA,EAAK,cAAY,IAAC,UAAU,GAAG,UAAU,GAAG,MAAM,QAAA,OAAA,SAAA,KAAM,MACvD,UAAA,oBAAC9M,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,cAAa,YAAW,QAAO,UACjD,UAAA,KAAK,MACR,CAAA,GACF,EACF,CAAA;AAEJ,CAAC,GCGK2P,mBAAiB,EAAC,OAAO;AAEf,SAAA,wBAAwB,EAAC,WAAwC;AAC/E,QAAM,CAAC,cAAc,eAAe,IAAI,SAAkC,IAAI,GACxE,CAAC,aAAa,cAAc,IAAI,SAAS,EAAE,GAC3C,EAAC,GAAAzQ,GAAK,IAAA,eAAA,GAEN,qBAAqB;AAAA,IACzB,CAAC,MAAuC,eAAe,EAAE,cAAc,KAAK;AAAA,IAC5E,CAAC,cAAc;AAAA,EAAA,GAEX,oBAAoB,YAAY,MAAM,eAAe,EAAE,GAAG,EAAE,GAE5D,SAAS,aAET;AAAA,IACJ,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA,OAAO,EAAC,MAAK;AAAA,IACf;AAAA,EAAA,IACE,eAAe,GAEb,oBAAoB;AAAA,IACxB,MACE,sBAAsB;AAAA,MACpB;AAAA,MACA,kBAAkB,YAAY;AAAA,MAC9B,mBAAmB,YAAY;AAAA,MAC/B;AAAA,MACA;AAAA,MACA;AAAA,MACA,GAAAA;AAAA,IAAA,CACD;AAAA,IACH,CAAC,uBAAuB,YAAY,QAAQ,YAAY,SAAS,QAAQ,aAAa,OAAOA,EAAC;AAAA,KAG1F,aAAa;AAAA,IACjB,CAAC,SACK,KAAK,SAAS,WACT,oBAAC,kBAAe,MAAY,SAAkB,eAAe,GAAG,IAErE,KAAK,SAAS,WACR,oBAAA,gBAAA,EAAe,KAAY,CAAA,IAE9B;AAAA,IAET,CAAC,OAAO;AAAA,KAGJ,kBAAkB;AAAA,IACtB,CAAC,UAAU;AACH,YAAA,aAAa,kBAAkB,KAAK;AAC1C,aACE,WAAW,SAAS,YACpB,CAAC,CAAC,QAAQ,KAAK,CAAC,MAAM,aAAa,CAAC,MAAM,aAAa,WAAW,MAAM,CAAC;AAAA,IAE7E;AAAA,IACA,CAAC,mBAAmB,OAAO;AAAA,KAGvBQ,cAAa;AAAA,IACjB,CAAC,UAAkB;AACX,YAAA,WAAW,kBAAkB,KAAK;AACxC,cAAQ,SAAS,MAAM;AAAA,QACrB,KAAK;AACI,iBAAA;AAAA,YACL,GAAI,SAAS,QAAQ,CAAC,SAAS,KAAK,IAAI,CAAC;AAAA;AAAA,YACzC,aAAa,SAAS,MAAM;AAAA,UAAA,EAC5B,KAAK,GAAG;AAAA,QACZ,KAAK;AACH,iBAAO,GAAG,SAAS,IAAI,IAAI,SAAS,KAAK;AAAA,QAC3C;AACS,iBAAA;AAAA,MACX;AAAA,IACF;AAAA,IACA,CAAC,iBAAiB;AAAA,EAAA;AAGpB,SACG,qBAAA,MAAA,EAAK,WAAU,UAAS,OAAOiQ,kBAE9B,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,gBAAgBzQ,GAAE,mCAAmC;AAAA,QACrD,UAAU;AAAA,QACV,SAAS;AAAA,QACT,KAAK;AAAA,QACL,YAAY;AAAA,MAAA;AAAA,IACd;AAAA,yBAEC,MACE,EAAA,UAAA;AAAA,MAAA,kBAAkB,SAAS,KAC1B;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,oBAAmB;AAAA,UACnB,WAAWA,GAAE,6BAA6B,EAAC,OAAO,kBAAkB,QAAO;AAAA,UAC3E,WAAU;AAAA,UACV;AAAA,UACA,YAAAQ;AAAA,UACA;AAAA,UACA,YAAY;AAAA,UACZ,OAAO;AAAA,UACP,UAAU;AAAA,UACV,SAAS;AAAA,UACT,eAAe;AAAA,UACf;AAAA,QAAA;AAAA,MACF;AAAA,MAID,kBAAkB,UAAU,KAC3B,oBAAC,OAAI,SAAS,GACZ,UAAC,oBAAAM,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,cAAa,YAC/B,UAAEd,GAAA,kCAAkC,EAAC,QAAQ,aAAY,EAAA,CAC5D,EACF,CAAA;AAAA,IAAA,GAEJ;AAAA,EACF,EAAA,CAAA;AAEJ;ACnIO,SAAS,kBAAkB;AAC1B,QAAA,CAAC,MAAM,OAAO,IAAI,SAAS,EAAK,GAChC,CAAC,eAAe,gBAAgB,IAAI,SAA6B,IAAI,GACrE,CAAC,gBAAgB,iBAAiB,IAAI,SAA6B,IAAI,GACvE,EAAC,GAAAA,OAAK,kBAEN;AAAA,IACJ,OAAO,EAAC,WAAU;AAAA,EAAA,IAChB,eAAe,GAEb,cAAc,YAAY,MAAM,QAAQ,EAAK,GAAG,CAAE,CAAA,GAClD,aAAa,YAAY,MAAM,QAAQ,EAAI,GAAG,CAAA,CAAE;AAEtD,SAAA,gBAAgB,aAAa,CAAC,eAAe,cAAc,CAAC,GAG1D;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,oBAAoB,CAAC,yBAAyB,GAAG,GAAG,CAAC;AAAA,MACrD,SACG,oBAAA,sBAAA,EAAqB,eAAe,eAAe,SAAS,aAC3D,UAAC,oBAAA,yBAAA,EAAwB,SAAS,YAAA,CAAa,EACjD,CAAA;AAAA,MAEF;AAAA,MACA,WAAU;AAAA,MACV,QAAQ;AAAA,MACR,KAAK;AAAA,MACL,QAAM;AAAA,MAEN,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAM;AAAA,UACN,MAAK;AAAA,UACL,SAAS;AAAA,UACT,MAAM,aAAa,UAAU;AAAA,UAC7B,KAAK;AAAA,UACL,UAAU;AAAA,UACV,MAAMA,GAAE,0BAA0B;AAAA,QAAA;AAAA,MACpC;AAAA,IAAA;AAAA,EAAA;AAGN;ACtCa,MAAA,yBAAyB,KAAK,SAAwB;AAAA,EACjE;AAAA,EACA;AAAA,EACA,GAAG;AACL,GAAgC;AAjBhC,MAAAF,KAAA;AAkBE,QAAM,EAAC,SAAQ,IAAI,eAEb,GAAA,gBAAgB,YAAY,MAAM;AACtC,aAAS,EAAC,MAAM,kBAAkB,YAAY,KAAK,CAAA;AAAA,EAAA,GAClD,CAAC,UAAU,IAAI,CAAC,GAEb,mBAAmB,YAAY,MAAM;AACzC,aAAS,EAAC,MAAM,qBAAqB,YAAY,KAAK,CAAA;AAAA,EAAA,GACrD,CAAC,UAAU,IAAI,CAAC,GAEb,cAAc,YAAY,MAAM;AAChC,eACF,qBAEA;EAED,GAAA,CAAC,eAAe,kBAAkB,QAAQ,CAAC;AAG5C,SAAA,oBAAC,KAAK,EAAA,GAAG,MACP,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,WAAW,YAAY;AAAA,MACvB,SAAQ;AAAA,MAER,MAAK;AAAA,MACL,SAAS;AAAA,MACT,OAAM;AAAA,MACN,MAAK;AAAA,MACL,UAAU;AAAA,MACV,OAAM,KAAA,KAAK,UAAL,OAAA,KAAc,KAAK;AAAA,MACzB,MAAM,WAAW,YAAY;AAAA,IAAA;AAAA,KAPxBA,MAAA,KAAK,UAAL,OAAAA,MAAc,KAAK;AAAA,EAS5B,EAAA,CAAA;AAEJ,CAAC,GC/BK,iBAAiB,OAAO,GAAG;AAAA,0BACP,CAAC,EAAC,YAAW,MAAM,OAAO,MAAM,KAAK,MAAM;AAAA;AAAA,GAI/D,iBAAiB,EAAC,OAAO;AAExB,SAAS,8BAA8B;AACtC,QAAA,CAAC,cAAc,eAAe,IAAI,SAAkC,IAAI,GACxE,CAAC,YAAY,aAAa,IAAI,SAAS,EAAE,GACzC,iBAAiB,OAAiC,IAAI,GACtD,EAAC,GAAAE,GAAC,IAAI,eAAe,GAErB,SAAS,aAET;AAAA,IACJ;AAAA,IACA,OAAO;AAAA,MACL,OAAO,EAAC,OAAO,cAAa;AAAA,IAC9B;AAAA,EAAA,IACE,eAAe,GAGb,CAAC,uBAAuB,wBAAwB,IAAI,SAAS,aAAa,GAE1E,oBAAoB;AAAA,IACxB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,KAGI,qBAAqB;AAAA,IACzB,CAAC,MAAuC,cAAc,EAAE,cAAc,KAAK;AAAA,IAC3E,CAAC,aAAa;AAAA,EAAA,GAEV,oBAAoB,YAAY,MAAM,cAAc,EAAE,GAAG,EAAE,GAE3D,mBAAmB,YAAY,MAAM;AA3D7C,QAAAF,KAAA;AA4DI,6BAAyB,CAAA,CAAE,GAC3B,SAAS,EAAC,MAAM,oBAAoB,CAAA,IAGpCA,MAAA,kBAAA,OAAA,SAAA,eAAgB,YAAhB,QAAyBA,IAAA,kBAAA,IACzB,KAAgB,kBAAA,OAAA,SAAA,eAAA,YAAhB,WAAyB,cAAc,CAAA;AAAA,EACtC,GAAA,CAAC,QAAQ,CAAC,GAEPU,cAAa;AAAA,IACjB,CAAC,UAAkB;AACX,YAAA,cAAc,kBAAkB,KAAK;AAC3C,cAAQ,YAAY,MAAM;AAAA,QACxB,KAAK;AACH,iBAAO,GAAG,YAAY,IAAI,IAAI,KAAK;AAAA,QACrC,KAAK;AACH,iBAAO,GAAG,YAAY,IAAI,IAAI,YAAY,KAAK;AAAA,QACjD,KAAK;AACH,iBAAO,GAAG,YAAY,IAAI,IAAI,YAAY,KAAK,IAAI;AAAA,QACrD;AACS,iBAAA;AAAA,MACX;AAAA,IACF;AAAA,IACA,CAAC,iBAAiB;AAAA,EACpB,GAEM,aAAa,YAAiE,CAAC,SAC/E,KAAK,SAAS,YAEb,oBAAA,KAAA,EAAI,UAAU,GACb,8BAAC,aAAY,CAAA,CAAA,EACf,CAAA,IAGA,KAAK,SAAS,WAEb,oBAAA,KAAA,EAAI,QAAQ,GAAG,SAAS,GACvB,UAAC,oBAAAM,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAA,KAAK,MACR,CAAA,EACF,CAAA,IAGA,KAAK,SAAS,SACR,oBAAA,wBAAA,EAAuB,eAAe,GAAG,UAAU,KAAK,UAAU,MAAM,KAAK,KAAM,CAAA,IAEtF,MACN,CAAA,CAAE,GAEC,kBAAkB;AAAA,IACtB,CAAC,UACc,kBAAkB,KAAK,EACxB,SAAS;AAAA,IAEvB,CAAC,iBAAiB;AAAA,KAGd,kBAAkB;AAAA,IACtB,CAAC,UAAU;AACH,YAAA,OAAO,kBAAkB,KAAK;AAC7B,aAAA,KAAK,SAAS,UAAU,KAAK;AAAA,IACtC;AAAA,IACA,CAAC,iBAAiB;AAAA,EAAA;AAGpB,SACG,qBAAA,MAAA,EAAK,WAAU,UAAS,OAAO,gBAE9B,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,gBAAgBd,GAAE,kDAAkD;AAAA,QACpE,UAAU;AAAA,QACV,SAAS;AAAA,QACT,KAAK;AAAA,QACL;AAAA,MAAA;AAAA,IACF;AAAA,yBAEC,MACE,EAAA,UAAA;AAAA,MAAA,kBAAkB,SAAS,KAC1B;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,oBAAmB;AAAA,UACnB,WAAWA,GAAE,kCAAkC;AAAA,UAC/C,qBAAmB;AAAA,UACnB,WAAU;AAAA,UACV;AAAA,UACA;AAAA,UACA,YAAAQ;AAAA,UACA;AAAA,UACA,YAAY;AAAA,UACZ,OAAO;AAAA,UACP,UAAU;AAAA,UACV,SAAS;AAAA,UACT,eAAe;AAAA,UACf,KAAK;AAAA,UACL;AAAA,QAAA;AAAA,MACF;AAAA,MAID,CAAC,kBAAkB,UAClB,oBAAC,OAAI,SAAS,GACZ,UAAC,oBAAAM,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,cAAa,YAC/B,UAAEd,GAAA,0CAA0C,EAAC,QAAQ,YAAW,EAAA,CACnE,EACF,CAAA;AAAA,IAAA,GAEJ;AAAA,IAGC,CAAC,cAAc,cAAc,SAAS,KACpC,oBAAA,aAAA,EAAY,SAAS,kBAAkB,eAA8B;AAAA,EAE1E,EAAA,CAAA;AAEJ;AAEA,SAAS,YAAY,EAAC,SAAS,iBAAoE;AAC3F,QAAA,EAAC,GAAAA,OAAK;AAEZ,SACG,oBAAA,gBAAA,EAAe,SAAS,GACvB,8BAAC,OACC,EAAA,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,cAAYA,GAAE,6CAA6C;AAAA,MAC3D,aAAU;AAAA,MACV,UAAU,cAAc,WAAW;AAAA,MACnC,MAAK;AAAA,MACL;AAAA,MACA,MAAMA,GAAE,wCAAwC;AAAA,MAChD,MAAK;AAAA,IAAA;AAAA,EAAA,EAET,CAAA,EACF,CAAA;AAEJ;AAEA,SAAS,wBACP,QACA,eACA,uBACA,YACA;AACA,SAAO,QAAQ,MAAM;AACb,UAAA,CAAC,eAAe,eAAe,IAAI;AAAA,MACvC,6BAA6B,QAAQ,UAAU;AAAA,MAC/C,CAAC,SAAS,sBAAsB,SAAS,IAAI;AAAA,IAC/C,GAEM,mBAAmB,cAAc,SAAS,GAC1C,qBAAqB,cAAc,SAAS,GAE5C,QAAgC;AAClC,WAAA,oBACF,MAAM,KAAK,EAAC,OAAO,YAAY,MAAM,SAAA,CAAS,GAEhD,cAAc;AAAA,MAAQ,CAAC,SACrB,MAAM,KAAK,EAAC,MAAM,UAAU,cAAc,SAAS,IAAI,GAAG,MAAM,QAAO;AAAA,IAAA,GAErE,oBAAoB,sBACtB,MAAM,KAAK,EAAC,MAAM,UAAA,CAAU,GAE9B,gBAAgB;AAAA,MAAQ,CAAC,SACvB,MAAM,KAAK,EAAC,MAAM,UAAU,cAAc,SAAS,IAAI,GAAG,MAAM,QAAO;AAAA,IAGlE,GAAA;AAAA,KACN,CAAC,QAAQ,eAAe,uBAAuB,UAAU,CAAC;AAC/D;ACrNA,MAAM,sBAAmC,CAAC,aAAa,cAAc;AAE9D,SAAS,sBAAsB;AAC9B,QAAA,CAAC,MAAM,OAAO,IAAI,SAAS,EAAK,GAChC,CAAC,eAAe,gBAAgB,IAAI,SAA6B,IAAI,GACrE,CAAC,gBAAgB,iBAAiB,IAAI,SAA6B,IAAI,GAEvE;AAAA,IACJ,OAAO;AAAA,MACL;AAAA,MACA,OAAO,EAAC,MAAK;AAAA,IACf;AAAA,EAAA,IACE,eAAe,GACb,EAAC,GAAAA,OAAK,eAAe,GAErB,cAAc,YAAY,MAAM,QAAQ,EAAK,GAAG,CAAE,CAAA,GAClD,aAAa,YAAY,MAAM,QAAQ,EAAI,GAAG,CAAA,CAAE;AAEtD,kBAAgB,aAAa,CAAC,eAAe,cAAc,CAAC;AAE5D,QAAM,QAAQ,QAAQ,MAAM,uBAAuB,EAAC,OAAO,GAAAA,GAAC,CAAC,GAAG,CAAC,OAAOA,EAAC,CAAC;AAGxE,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,oBAAoB,CAAC,yBAAyB,GAAG,GAAG,CAAC;AAAA,MACrD,6BACG,sBAAqB,EAAA,eAAe,eAAe,SAAS,aAC3D,UAAC,oBAAA,6BAAA,CAAA,CAA4B,EAC/B,CAAA;AAAA,MAEF;AAAA,MACA,WAAU;AAAA,MACV,oBAAoB;AAAA,MACpB,QAAM;AAAA,MACN,QAAQ;AAAA,MACR,KAAK;AAAA,MAEL,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,WAAW;AAAA,UACX,MAAK;AAAA,UACL,SAAS;AAAA,UACT,MAAM,aAAa,UAAU;AAAA,UAC7B,KAAK;AAAA,UACL,UAAU;AAAA,UACV,MAAM;AAAA,UACN,MAAK;AAAA,QAAA;AAAA,MACP;AAAA,IAAA;AAAA,EAAA;AAGN;AC1CA,MAAM,YAAY,OAAO,GAAG;AAAA,iBACX,CAAC,EAAC,cAAc,EAAA,MAAO,WAAW;AAAA;AAG5C,SAAS,YAAY,EAAC,QAAAwH,SAAQ,WAAW,GAAG,cAAc,MAAyB;AACxF,QAAM,EAAC,GAAAxH,OAAK,kBACN;AAAA,IACJ,OAAO,EAAC,aAAa,WAAU;AAAA,EAAA,IAC7B,eAAe,GAEb,WAAW,sBAAsB,YAAY,WAAWwH,QAAO,YAAY,GAE3E,cAAc,YAAU,OAAA,SAAA,SAAA,sBACxB,cAAcA,QAAO,OAErB2G,cAAoC;AAAA,IACxC,OAAO;AAAA,MACL,OAAO,MACL,oBAAC,WAAU,EAAA,aAAa,aAAa,IAAI,GACvC,UAAA,oBAAC,cAAa,EAAA,MAAK,WAAU,MAAM,UAAU,cAAa,YAAW,QAAO,UAC1E,UAAC,oBAAA,aAAA,EAAY,QAAA3G,SAAgB,WAAW,aAAa,KAAK,GAAI,CAAA,EAAA,CAChE,EACF,CAAA;AAAA,MAEF,UAAU,CAAC,EAAC,eACV,cACE,oBAAC,WAAU,EAAA,aAAa,GACtB,UAAA,oBAAC,gBAAa,MAAK,WAAU,MAAM,UAAU,cAAa,YAAW,QAAO,WACzE,UACH,EAAA,CACF,IACE;AAAA,MACN,OAAO,CAAC,EAAC,SAAA,MACP,cACG,oBAAA,WAAA,EAAU,aAAa,GACtB,UAAC,oBAAA,cAAA,EAAa,MAAK,WAAU,MAAM,UAAU,cAAa,YAAW,QAAO,UACzE,UAAc,cAAA,oBAAC,aAAY,EAAA,OAAO,YAAa,CAAA,IAAK,SACvD,CAAA,EACF,CAAA,IACE;AAAA,IAAA;AAAA,IAER,CAACA,SAAQ,UAAU,YAAY,aAAa,aAAa,WAAW;AAAA,EAAA;AAOtE,MAJK,YAAU,QAAA,SAAA,kBACb,QAAQ,KAAK,8CAA8CA,QAAO,YAAY,GAG5E,CAAC,eAAe,EAAC,YAAA,QAAA,SAAU,iBAAgB;AAC7C,UAAM,QAAQ2G,YAAW;AAEvB,WAAA,oBAAC,QAAK,OAAM,UAAS,KAAK,GACxB,UAAA,oBAAC,QAAM,CAAA,EACT,CAAA;AAAA,EAEJ;AAEA,SACG,oBAAA,MAAA,EAAK,OAAM,UAAS,KAAK,GACxB,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,GAAAnO;AAAA,MACA,SAAS,YAAU,OAAA,SAAA,SAAA;AAAA,MACnB,YAAAmO;AAAA,MACA,QAAQ,gBAAgB3G,OAAM;AAAA,IAAA;AAAA,EAElC,EAAA,CAAA;AAEJ;AAEA,SAAS,gBAAgBA,SAA0C;AACjE,QAAMvI,UAA6B,CAAA;AAC/B,SAAA,OAAOuI,QAAO,SAAU,aAC1BvI,QAAO,QAAQuI,QAAO,QAEpB,iBAAiBA,QAAO,KAAK,MAC/BvI,QAAO,QAAQuI,QAAO,QAEpB9H,WAAS8H,QAAO,KAAK,KAAK,UAAUA,QAAO,SAAS,iBAAiBA,QAAO,MAAM,IAAI,MACxFvI,QAAO,OAAOuI,QAAO,MAAM,OAEzB9H,WAAS8H,QAAO,KAAK,KAAK,QAAQA,QAAO,SAAS,iBAAiBA,QAAO,MAAM,EAAE,MACpFvI,QAAO,KAAKuI,QAAO,MAAM,KAEpBvI;AACT;AAEA,SAAS,iBAAiB,OAA0C;AAClE,SAAO,OAAO,SAAU,YAAY,OAAO,SAAU;AACvD;ACrGO,SAAS,YAAYE,QAA+B;AACnD,QAAA,EAAC,GAAAa,OAAK;AAGV,SAAA,oBAAC,OAAK,GAAGb,QACP,+BAAC,MAAK,EAAA,OAAM,cAAa,KAAK,GAC5B,UAAA;AAAA,IAAA,oBAAC,cAAa,EAAA,MAAK,YACjB,UAAA,oBAAC,mBAAiB,CAAA,GACpB;AAAA,IACA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,MAAC,oBAAA,cAAA,EAAa,MAAM,GAAG,MAAK,YAAW,QAAO,UAC3C,UAAEa,GAAA,mCAAmC,EACxC,CAAA;AAAA,MACA,oBAAC,gBAAa,MAAM,GAAG,MAAK,YACzB,UAAAA,GAAE,yCAAyC,GAC9C;AAAA,IAAA,GACF;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACTA,SAASmQ,iBAAe;AAAA,EACtB;AAAA,EACA;AAAA,EACA;AACF,GAIG;AACD,QAAM,cAAc,YAAY,MAAM,QAAQ,SAAS,IAAI,GAAG,CAAC,SAAS,SAAS,IAAI,CAAC,GAChF,EAAC,GAAAnQ,OAAK,eAAe;AAGzB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,SAAS;AAAA,MACT,MAAK;AAAA,MACL,MAAMA,GAAE,SAAS,OAAO;AAAA,MACxB,WAAW,YAAU,OAAA,SAAA,SAAA;AAAA,IAAA;AAAA,EAAA;AAG3B;AAEO,SAAS,oBAAoB,EAAC,QAAAwH,SAAQ,YAAqC;AAxClF,MAAA1H;AAyCQ,QAAA,eAAe,SAEf,EAAC,GAAAE,GAAA,IAAK,kBACN,EAAC,UAAU,MAAK,IAAI,kBACpB,iBAAgBF,MAAoB,oBAAA,MAAM,YAAY,SAAS0H,QAAO,UAAU,MAAhE,OAAmE,SAAA1H,IAAA,WAEnF,cAAc;AAAA,IAClB,CAAC,iBAAyB;AACf,eAAA;AAAA,QACP,WAAW,aAAa0H,OAAM;AAAA,QAC9B;AAAA,QACA,MAAM;AAAA,MAAA,CACP;AAAA,IACH;AAAA,IACA,CAAC,UAAUA,OAAM;AAAA,EAAA;AAGf,SAAA,CAAC,YAAY,CAAC,iBAAiB,cAAc,UAAU,IAClD,OAIP,oBAAC,QACC,EAAA,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAS,oBAAA,QAAA,EAAO,MAAK,SAAQ,WAAW,iBAAiB,MAAMxH,GAAE,SAAS,OAAO,EAAG,CAAA;AAAA,MACpF,IAAI,gBAAgB;AAAA,MACpB,MACG,oBAAA,MAAA,EACE,wBAAc,IAAI,CAAC,MAAM,UAAU;AAC9B,YAAA,KAAK,SAAS,QAAQ;AACxB,gBAAM,eAAe,sBAAsB,MAAM,YAAY,WAAW,KAAK,IAAI;AACjF,iBAAK,eAIH;AAAA,YAACmQ;AAAAA,YAAA;AAAA,cAGC,SAAS;AAAA,cACT,UAAU;AAAA,cACV,UAAU,SAAS,SAAS,KAAK;AAAA,YAAA;AAAA,YAH5B;AAAA,UALA,IAAA;AAAA,QAWX;AACA,eAAI,KAAK,SAAS,YAER,oBAAA,aAAA,CAAA,GAAiB,KAAO,IAE3B;AAAA,MACR,CAAA,GACH;AAAA,MAEF,WAAU;AAAA,MACV,SAAS;AAAA,QACP,eAAe;AAAA,QACf,QAAQ;AAAA,QACR,QAAQ;AAAA,MACV;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;AC7EgB,SAAA,WAAW,EAAC,QAAA3I,WAA0B;AACpD,QAAM,CAAC,aAAa,cAAc,IAAI,SAA6B,IAAI,GACjE;AAAA,IACJ;AAAA,IACA,OAAO,EAAC,aAAa,WAAU;AAAA,EAC7B,IAAA,eAAA,GAEE,mBAAmB,oBAAoB,YAAY,SAASA,QAAO,UAAU,GAC7E,WAAW,sBAAsB,YAAY,WAAWA,QAAO,YAAY,GAC3E,kBAAkB,mBAAmB,YAAY,QAAQA,OAAM,GAC/D,YAAY,aAAaA,OAAM,GAE/B,cAAc,YAAY,MAAM;AAC3B,aAAA;AAAA,MACP,WAAW,aAAaA,OAAM;AAAA,MAC9B,MAAM;AAAA,IAAA,CACP;AAAA,KACA,CAAC,UAAUA,OAAM,CAAC,GAEf,oBAAoB;AAAA,IACxB,CAAC,UAAe;AACL,eAAA;AAAA,QACP;AAAA,QACA,MAAM;AAAA,QACN;AAAA,MAAA,CACD;AAAA,IACH;AAAA,IACA,CAAC,UAAU,SAAS;AAAA,EAAA,GAGhB,mBAAmB,YAAY,CAAC,WAAwB;AAC5D,mBAAe,MAAM;AAAA,EAAA,GACpB,CAAE,CAAA,GAECxG,aAAY,YAAU,OAAA,SAAA,SAAA;AAExB,SAAA,kCACM,aAAY,EAAA,SAAS,GAAG,IAKhC,oBAAC,iBAAc,SAAS,kBACtB,8BAAC,WAAU,EAAA,WAAW,CAAC,eAAe,aAAW,IAC/C,UAAC,qBAAA,MAAA,EAAK,WAAU,kBAEb,UAAA;AAAA,IAAAA,cACE,oBAAA,MAAA,EAAK,WAAS,IAAC,SAAS,GACvB,UAAA;AAAA,MAACA;AAAA,MAAA;AAAA,QACC;AAAA,QAGA,UAAU;AAAA,QACV,OAAOwG,QAAO;AAAA,MAAA;AAAA,MAFTA,QAAO;AAAA,IAAA,GAIhB;AAAA,wBAID,MAAK,EAAA,SAAS,GACb,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,MAAA,qBAAC,QAAK,OAAM,cAAa,KAAK,GAAG,SAAQ,iBACvC,UAAA;AAAA,QAAC,oBAAA,KAAA,EAAI,aAAa,GAAG,cAAc,GAAG,UAAU,GAC9C,UAAA,oBAAC,eAAc,EAAA,QAAAA,QAAA,CAAgB,EACjC,CAAA;AAAA,QAEC,cACC;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAM;AAAA,YACN,MAAK;AAAA,YACL,SAAS;AAAA,YACT,MAAK;AAAA,YACL,cAAc,EAAC,SAAS,gBAAe;AAAA,UAAA;AAAA,QACzC;AAAA,MAAA,GAEJ;AAAA,OACC,oBAAA,OAAA,SAAA,iBAAkB,gBAChB,oBAAA,MAAA,EAAK,QAAM,IAAC,SAAS,GAAG,QAAQ,GAAG,MAAK,eACvC,UAAA,oBAAC1G,UAAK,OAAK,IAAC,MAAM,GACf,UAAA,iBAAiB,aACpB,EACF,CAAA;AAAA,MAEF,oBAAC,qBAAoB,EAAA,QAAA0G,SAAgB,SAAoB,CAAA;AAAA,IAAA,EAAA,CAC3D,EACF,CAAA;AAAA,EAAA,GACF,GACF,EACF,CAAA;AAEJ;ACtGA,MAAM,gBAAgB,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQjB,SAAA,qBAAqB,EAAC,QAAAA,WAAoC;AAEtE,SAAA,qBAAC,eAAc,EAAA,WAAU,UACvB,UAAA;AAAA,IAAA,oBAAC,cAAW,QAAAA,SAAgB;AAAA,IAG3B;AAAA,EAMH,EAAA,CAAA;AAEJ;ACTA,MAAM,cAAc,OAAOoG,QAAM;AAAA,mBACd,CAAC,EAAC,MAAK,MACtB,KAAK,IAAI,MAAM,OAAO,OAAO,CAAC,CAAC,CAAC,IAAI,IAAI,MAAM,OAAO,OAAO,CAAC,CAAC,CAAC,IAAI;AAAA,GAGjE,YAAY,OAAO,IAAI;AAAA;AAAA;AAAA,GAKvB,eAAe,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,GAOtB,cAAc,OAAOA,QAAM;AAAA;AAAA;AAAA;AAK1B,SAAS,aAAa,EAAC,QAAApG,SAAQ,eAAiC;AAC/D,QAAA,CAAC,MAAM,OAAO,IAAI,SAAS,WAAW,GACtC,CAAC,eAAe,gBAAgB,IAAI,SAA6B,IAAI,GACrE,CAAC,gBAAgB,iBAAiB,IAAI,SAA6B,IAAI,GAEvE;AAAA,IACJ;AAAA,IACA,OAAO,EAAC,aAAa,WAAU;AAAA,EAAA,IAC7B,eAAe,GAEb,EAAC,GAAAxH,OAAK,eAEN,GAAA,cAAc,YAAY,MAAM,QAAQ,EAAK,GAAG,EAAE,GAClD,aAAa,YAAY,MAAM,QAAQ,EAAI,GAAG,CAAA,CAAE,GAChD,eAAe;AAAA,IACnB,MACE,SAAS;AAAA,MACP,WAAW,aAAawH,OAAM;AAAA,MAC9B,MAAM;AAAA,IAAA,CACP;AAAA,IACH,CAAC,UAAUA,OAAM;AAAA,KAEb,gBAAgB;AAAA,IACpB,CAAC,UAA4C;AACvC,OAAC,aAAa,QAAQ,EAAE,SAAS,MAAM,GAAG,KAC5C;IAEJ;AAAA,IACA,CAAC,YAAY;AAAA,EAAA;AAGf,kBAAgB,aAAa,CAAC,eAAe,cAAc,CAAC;AAE5D,QAAMkJ,WAAU,eAAe;AAAA,IAC7B,kBAAkB,YAAY;AAAA,IAC9B,QAAAlJ;AAAA,IACA,mBAAmB,YAAY;AAAA,IAC/B,qBAAqB,YAAY;AAAA,EAAA,CAClC;AAGC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,oBAAoB,CAAC,yBAAyB,GAAG,GAAG,CAAC;AAAA,MACrD,SACG,oBAAA,sBAAA,EAAqB,eAAe,eAAe,SAAS,aAC3D,UAAA,oBAAC,sBAAqB,EAAA,QAAAA,QAAA,CAAgB,EACxC,CAAA;AAAA,MAEF,eAAa;AAAA,MACb;AAAA,MACA,UAAS;AAAA,MACT,WAAU;AAAA,MACV,QAAM;AAAA,MACN,QAAQ;AAAA,MACR,KAAK;AAAA,MAEL,+BAAC,cACC,EAAA,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,sBAAoB;AAAA,YACpB,SAAQ;AAAA,YACR,QAAQ;AAAA,YACR,MAAMkJ,WAAU,YAAY;AAAA,YAE5B,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAK;AAAA,gBACL,SAAS;AAAA,gBACT,WAAW;AAAA,gBACX,aAAa,aAAa,IAAI;AAAA,gBAC9B,cAAc,aAAa,IAAI;AAAA,gBAC/B,UAAU,aAAa,IAAI;AAAA,gBAC3B,KAAK;AAAA,gBAEL,UAAC,oBAAA,aAAA,EAAY,QAAAlJ,SAAgB,aAAakJ,UAAS;AAAA,cAAA;AAAA,YACrD;AAAA,UAAA;AAAA,QACF;AAAA,QAEC,CAAC,cACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,sBAAoB;AAAA,YACpB,SAAQ;AAAA,YACR,QAAQ;AAAA,YACR,MAAMA,WAAU,YAAY;AAAA,YAE5B,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,cAAY1Q,GAAE,wCAAwC;AAAA,gBACtD,UAAU;AAAA,gBACV,MAAM;AAAA,gBACN,MAAK;AAAA,gBACL,SAAS;AAAA,gBACT,WAAW;AAAA,gBACX,SAAS;AAAA,gBACT,QAAQ;AAAA,cAAA;AAAA,YACV;AAAA,UAAA;AAAA,QACF;AAAA,MAAA,GAEJ;AAAA,IAAA;AAAA,EAAA;AAGN;ACpIO,SAAS,UAAU;AAClB,QAAA;AAAA,IACJ;AAAA,IACA,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA,OAAO,EAAC,MAAK;AAAA,IACf;AAAA,EACE,IAAA,eACE,GAAA,EAAC,GAAAA,OAAK,eAEN,GAAA,YAAY,OAAO,EAAK,GAExB,cAAc,YAAY,MAAM;AAC3B,aAAA,EAAC,MAAM,sBAAsB,CAAA,GACtC,SAAS,EAAC,MAAM,oBAAA,CAAoB;AAAA,EAAA,GACnC,CAAC,QAAQ,CAAC,GAEP,4BAA4B,QAAQ,SAAS,KAAK,MAAM,SAAS;AAEvE,YAAU,MAAM;AACd,cAAU,UAAU;AAAA,EACtB,GAAG,CAAE,CAAA;AAEL,QAAM,qBAAqB,mBAAmB,aAAa,eAAe,GAEpE,qBAAqB,MACzB;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAK;AAAA,MACL,SAAS;AAAA,MACT,MAAM,aAAa,UAAU;AAAA,MAC7B,MAAMA,GAAE,6BAA6B;AAAA,MACrC,MAAK;AAAA,IAAA;AAAA,EAAA;AAIT,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAC,qBAAA,MAAA,EAAK,OAAM,cAAa,KAAK,GAAG,SAAQ,iBAAgB,SAAS,GAChE,UAAA;AAAA,MAAA,qBAAC,QAAK,MAAM,GAAG,KAAK,GAAG,MAAK,QAC1B,UAAA;AAAA,QAAA,oBAAC,qBAAoB,EAAA;AAAA,QACpB,WAAA,OAAA,SAAA,QAAS,IAAI,CAACwH,YAAW;AAClB,gBAAA,MAAM,aAAaA,OAAM;AAE7B,iBAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,QAAAA;AAAA,cACA,aAAa,UAAU,WAAW,uBAAuB;AAAA,YAAA;AAAA,YACpD;AAAA,UAAA;AAAA,QACP,CAEJ;AAAA,QACC,CAAC,cAAc,oBAAC,iBAAgB,EAAA;AAAA,MAAA,GACnC;AAAA,MACC,6BAA6B,CAAC,cAAc,oBAAC,oBAAmB,CAAA,CAAA;AAAA,IAAA,GACnE;AAAA,IAEC,mCACE,MAAK,EAAA,SAAQ,iBAAgB,eAAe,GAAG,UAAU,GACxD,UAAA;AAAA,MAAA,oBAAC,iBAAgB,EAAA;AAAA,MAChB,iDAA8B,oBAAmB,EAAA;AAAA,IAAA,GACpD;AAAA,IAID;AAAA,EAMH,EAAA,CAAA;AAEJ;AC1EO,MAAM,6BAA6B;AAwB1B,SAAA,uBACd,QACAwI,oBACyB;AAxC3B,MAAAlQ;AA0CE,QAAM,8BAA8B,6BAA6B,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,GAGpF,EAAC,eAAe,mBAAgBA,MAAA,OAAO,cAAP,OAAkB,SAAAA,IAAA,UAAS,CAAA,GAE9D;AAAA,IAAO,CAACE,OACP,2BAA2BA,EAAC,IAAI,4BAA4B,SAASA,GAAE,IAAI,IAAI;AAAA,EAAA,EAGhF,OAAO,CAAC,eAAe,WAAW,SAAS,MAAM,EAEjD,OAAO,CAAC,eAAe,CAAC,WAAW,KAAK,WAAW,SAAS,CAAC,EAE7D;AAAA,IAIC,CAAC,KAAK,gBACA,2BAA2B,UAAU,MACvC,IAAI,cAAc,WAAW,IAAI,IAAI,aAEnC,mBAAmB,UAAU,MAC/B,IAAI,YAAY,WAAW,IAAI,IAAI,aAE9B;AAAA,IAET,EAAC,eAAe,CAAA,GAAI,aAAa,GAAE;AAAA,EAAA,KAChC,EAAC,eAAe,CAAA,GAAI,aAAa,CAAE,EAAA,GAGpC,sBAAsB,uBAAuBgQ,kBAAiB;AAE7D,SAAA,4BAA4B,qBAAqB,eAAe,WAAW;AACpF;AAEO,SAAS,gCACd,kBACiC;AACjC,SAAO,iBAAiB,OAAwC,CAAC,KAAK,SACpE,IAAI,IAAI,EAAE,IAAI,KACP,MACN,CAAE,CAAA;AACP;AAEO,SAAS,gBAAgB,OAAsC;AACpE,SAAO,CAAC,MAAM,MAAM,MAAM,WAAW,MAAM,YAAY,MAAM,cAAc,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG;AAChG;AAEA,SAAS,4BACP,qBACA,eACA,aACA;AAEA,WAAS,4BAA4B;AAAA,IACnC;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,EAAA,GAQC;AA9GL,QAAAlQ;AA+GI,UAAM,oBAAoB,SAAS,4BAC7B,kBAAkB,QAAQ,KAAK,WAAW,GAAG,GAE7C,QAAQ,2BAAS,QAAQ,mBAAmB,QAAQ,KAAK,IAAI6Q,YAAU,QAAQ,IAAI,GACnF,YAAY,gBAAgB,GAAG,aAAa,IAAI,QAAQ,IAAI,KAAK,QAAQ,MACzE,YAAY,gBAAgB,CAAC,GAAG,eAAe,KAAK,IAAI,CAAC,KAAK;AAEpE,QAAI,CAAC;AAAmB;AAGxB,UAAM,iBAAiB,YAAY,QAAQ,IAAI,GACzC,mBAAmB,cAAc,QAAQ,IAAI,GAC7C,eAAe,mBAAmB,OAAO,IAAI,UAAU,MACvD,eAAe,oBAAoB,kBAAkB;AAE3D,QAAI,cAAc;AAChB,OAAA7Q,MAAA,gBAAA,OAAA,SAAA,aAAc,WAAd,QAAsBA,IAAA;AAAA,QAAQ,CAAC,UAC7B,4BAA4B;AAAA,UAC1B;AAAA,UACA,SAAS;AAAA,UACT,OAAO,QAAQ;AAAA,UACf;AAAA,UACA,eAAe;AAAA,UACf,eAAe;AAAA,QAAA,CAChB;AAAA,MAAA;AAEH;AAAA,IACF;AAGK,wBAAoB,SAAS,QAAQ,IAAI,KAE9C,IAAI,KAAK;AAAA,MACP,eAAe,gBAAgB,CAAC,kBAAkB,CAAC,YAAY,IAAI,CAAC;AAAA,MACpE;AAAA,MACA,YAAY,kBAAkB,OAAO;AAAA,MACrC,IAAI;AAAA,MACJ,MAAM,QAAQ;AAAA,MACd;AAAA,MACA;AAAA,MACA,MAAM,QAAQ;AAAA,IAAA,CACf;AAAA,EACH;AA8BA,SA5ByB,OAAO,OAAO,aAAa,EACjD,OAAgC,CAAC,KAAK,iBAAiB;AAChD,UAAA,iBAAkB,aAAa,OAA8B,OAEjE,CAAC,GAAG,WACJ,4BAA4B,EAAC,KAAK,GAAG,SAAS,OAAO,cAAc,aAAa,KAAA,CAAK,GAC9E,IACN,CAAA,CAAE;AACD,WAAA,IAAA,KAAK,GAAG,cAAc,GACnB;AAAA,KACN,CAAE,CAAA,EACJ,OAAgC,CAAC,KAAK,QAAQ;AAC7C,UAAM,YAAY,IAAI;AAAA,MACpB,CAAC,MAAM,EAAE,cAAc,IAAI,aAAa,EAAE,UAAU,IAAI,SAAS,EAAE,SAAS,IAAI;AAAA,IAAA;AAElF,WAAI,YAAY,KACd,IAAI,SAAS,IAAI;AAAA,MACf,GAAG,IAAI,SAAS;AAAA,MAChB,eAAe,CAAC,GAAG,IAAI,SAAS,EAAE,eAAe,GAAG,IAAI,aAAa;AAAA,IAGvE,IAAA,IAAI,KAAK,GAAG,GAEP;AAAA,EAAA,GACN,CAAA,CAAE,EACJ,IAAI,oBAAoB,EACxB,KAAK,oBAAoB;AAG9B;AAKA,SAAS,qBAAqB,OAA8B;AACnD,SAAA;AAAA,IACL,GAAG;AAAA,IACH,IAAI,gBAAgB,KAAK;AAAA,EAAA;AAE7B;AAEA,SAAS,oBAAoB,YAAiE;AApM9F,MAAAA;AAqMM,SAAA,kBAAkB,UAAU,IAE5B,WAAW,GAAG,MAAM,CAAC,SAAS,CAAC,WAAW,UAAU,QAAQ,EAAE,SAAS,KAAK,IAAI,CAAC,OAChFA,MAAA,WAAW,YAAX,QAAAA,IAAoB,OAAO,WAAW,QAAQ,KAAK,SAAS,IAAI,MAG9D;AACT;AAEA,SAAS,kBAAkB,YAAiE;AAC1F,SAAO,WAAW,SAAS;AAC7B;AAEA,SAAS,2BACP,YACgC;AAChC,SAAO,WAAW,SAAS;AAC7B;AAEA,SAAS,mBAAmB,YAAkE;AAC5F,SAAO,WAAW,SAAS;AAC7B;AAEA,SAAS,mBAAmB,YAAkE;AAC5F,SAAO,WAAW,SAAS;AAC7B;AAEA,SAAS,uBAAuB,YAAkE;AAhOlG,MAAAA;AAiOM,SAAA,mBAAmB,UAAU,MACxBA,MAAW,WAAA,YAAX,QAAoBA,IAAA,OAAO,WAAW,QAAQ,KAAK,SAAS,IAE9D;AACT;AAEA,SAAS,kBAAkB,YAAkC;AAC3D,MAAI,uBAAuB,UAAU;AAC5B,WAAA;AAEL,MAAA,kBAAkB,UAAU,GAAG;AACjC,QAAI,WAAW,GAAG,KAAK,CAAC,SAAS,KAAK,SAAS,WAAW;AACjD,aAAA;AAET,QAAI,WAAW,GAAG,KAAK,CAAC,SAAS,KAAK,SAAS,OAAO;AAC7C,aAAA;AAET,QAAI,oBAAoB,UAAU;AACzB,aAAA;AAAA,EAEX;AACA,SAAO,WAAW;AACpB;AAKA,SAAS,qBAAqB,GAA0B,GAAkC;AACxF,QAAM,aAAa,EAAE,UAAU,MAAM,GAAG,EAAE,EAAE,KAAK,GAAG,GAC9C,aAAa,EAAE,UAAU,MAAM,GAAG,EAAE,EAAE,KAAK,GAAG;AACpD,SACE,EAAE,MAAM,cAAc,EAAE,KAAK,KAC7B,WAAW,cAAc,UAAU,KACnC,EAAE,UAAU,cAAc,EAAE,SAAS;AAEzC;AC7PO,MAAM8Q,0BAAwB,GAC/B,4BAA4B,wBAO5B,eAA6B;AAAA,EACjC,SAASA;AAAAA,EACT,gBAAgB,CAAC;AACnB;AAEO,SAAS,kBAAkE;AAChF,QAAM,gBAAgB,oBAChB,SAAS,UAAU,6BAA6B,GAChD,EAAC,QAAA,IAAW,OAAO,UAEnB,mBAAmB,QAAQ,MAAM,GAAG,yBAAyB,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC,GAErF,CAAC,OAAO,QAAQ,IAAI,SAAuB,YAAY,GAEvD,WAAW,QAAQ,MAChB,cAAc,OAAO,gBAAgB,GAC3C,CAAC,eAAe,gBAAgB,CAAC;AAEpC,YAAU,MAAM;AACd,UAAM5C,OAAM,SACT;AAAA,MACC,UAAU,YAAmB;AAAA,MAC7B,IAAI,CAAC,UAEC,QAAA,OAAA,SAAA,KAAM,aAAY4C,2BAEpB,cAAc,OAAO,kBAAkB,YAAmB,GACnD,gBAGF,IACR;AAAA,MAEF,UAAU;AAAA,MACT,MAAM;AAAA,IAAA,CACP;AAEH,WAAO,MAAM5C,QAAK,OAAA,SAAAA,KAAA;EACjB,GAAA,CAAC,UAAU,eAAe,gBAAgB,CAAC;AAE9C,QAAM3L,OAAM;AAAA,IACV,CAAC,aAA2B;AAC1B,eAAS,QAAQ,GACjB,cAAc,OAAO,kBAAkB,QAAe;AAAA,IACxD;AAAA,IACA,CAAC,eAAe,gBAAgB;AAAA,EAAA;AAG3B,SAAA,QAAQ,MAAM,CAAC,OAAOA,IAAG,GAAG,CAACA,MAAK,KAAK,CAAC;AACjD;ACvCa,MAAA,sBAAsB,GAWtB,wBAAwB;AA4B9B,SAAS,yBAA8C;AACtD,QAAA,CAAC,cAAc,eAAe,IAAI,mBAClC,SAAS,aACT;AAAA,IACJ,QAAQ,EAAC,WAAW,QAAO;AAAA,EAAA,IACzB,UAGE,GAAA,EAAC,kBAAkB,mBAAA2N,oBAAmB,qBAAAQ,qBAAA,IAAuB,QAAQ,OAClE;AAAA,IACL,kBAAkB,gCAAgC,uBAAuB,QAAQ,OAAO,CAAC;AAAA,IACzF,mBAAmB,iCAAiC,OAAO;AAAA,IAC3D,qBAAqB,mCAAmC,SAAS;AAAA,EAElE,IAAA,CAAC,SAAS,WAAW,MAAM,CAAC;AAExB,SAAA;AAAA;AAAA;AAAA;AAAA,IAIL,WAAW,CAAC,YAAyB,kBAAmD;AAWhF,YAAA,sBAViB,iBAAiB,CAAA,GAAI;AAAA,QAC1C,CAAChJ,aAA0B;AAAA,UACzB,SAASA,QAAO;AAAA,UAChB,YAAYA,QAAO;AAAA,UACnB,cAAcA,QAAO;AAAA,UACrB,OAAOA,QAAO;AAAA,QAAA;AAAA,MAChB,EAIuC;AAAA,QAAO,CAACA,YAC/C,eAAe;AAAA,UACb;AAAA,UACA,QAAAA;AAAA,UACA,mBAAAwI;AAAA,UACA,qBAAAQ;AAAA,QAAA,CACD;AAAA,SAGG,gBAAkC;AAAA,QACtC,UAAS,oBAAI,KAAK,GAAE,YAAY;AAAA,QAChC,SAAS;AAAA,QACT,OAAO;AAAA,UACL,OAAO,WAAW,MAAM,KAAK;AAAA,UAC7B,WAAW,WAAW,MAAM,IAAI,CAAC,MAAM,EAAE,IAAI;AAAA,QAC/C;AAAA,SAII,YAA0B;AAAA,QAC9B,SAAS;AAAA,QACT,gBAAgB;AAAA,UACd;AAAA,UACA,GAAG,aAAa,eAAe,OAAO,CAAC,MAC9B,CAACzR,UAAQ,KAAK,GAAG,SAAS,GAAG,KAAK,eAAe,SAAS,CAAC,CACnE;AAAA,QAAA,EACD,MAAM,GAAG,mBAAmB;AAAA,MAAA;AAEhB,aAAA,gBAAA,SAAS,GAElB,qBAAqB;AAAA,QAC1B;AAAA,QACA,mBAAAiR;AAAA,QACA,qBAAAQ;AAAA,QACA;AAAA,QACA,cAAc;AAAA,QACd;AAAA,MAAA,CACD;AAAA,IACH;AAAA;AAAA;AAAA;AAAA;AAAA,IAKA,mBAAmB,MACjB,qBAAqB;AAAA,MACnB;AAAA,MACA,mBAAAR;AAAA,MACA,qBAAAQ;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA,CACD;AAAA;AAAA;AAAA;AAAA,IAIH,cAAc,MAAM;AAClB,YAAM,YAA0B;AAAA,QAC9B,GAAG;AAAA,QACH,gBAAgB,CAAC;AAAA,MAAA;AAGH,aAAA,gBAAA,SAAS,GAElB,qBAAqB;AAAA,QAC1B;AAAA,QACA,mBAAAR;AAAA,QACA,qBAAAQ;AAAA,QACA;AAAA,QACA,cAAc;AAAA,QACd;AAAA,MAAA,CACD;AAAA,IACH;AAAA;AAAA;AAAA;AAAA,IAIA,qBAAqB,CAAC,UAAkB;AACtC,UAAI,QAAQ,KAAK,QAAQ,aAAa,eAAe;AACnD,eAAO,qBAAqB;AAAA,UAC1B;AAAA,UACA,mBAAAR;AAAA,UACA,qBAAAQ;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QAAA,CACD;AAGH,YAAM,YAA0B;AAAA,QAC9B,GAAG;AAAA,QACH,gBAAgB;AAAA,UACd,GAAG,aAAa,eAAe,MAAM,GAAG,KAAK;AAAA,UAC7C,GAAG,aAAa,eAAe,MAAM,QAAQ,CAAC;AAAA,QAChD;AAAA,MAAA;AAGc,aAAA,gBAAA,SAAS,GAElB,qBAAqB;AAAA,QAC1B;AAAA,QACA,mBAAAR;AAAA,QACA,qBAAAQ;AAAA,QACA;AAAA,QACA,cAAc;AAAA,QACd;AAAA,MAAA,CACD;AAAA,IACH;AAAA,EAAA;AAEJ;AAMA,SAAS,qBAAqB;AAAA,EAC5B;AAAA,EACA;AAAA,EACA,mBAAAR;AAAA,EACA,qBAAAQ;AAAA,EACA;AAAA,EACA;AACF,GAOmB;AACjB,SAAO,qBAAqB;AAAA,IAC1B,cAAc;AAAA,IACd,mBAAAR;AAAA,IACA;AAAA,IACA,qBAAAQ;AAAA,IACA;AAAA,IACA;AAAA,EACD,CAAA,EACE,eAAe,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,KAAK,EACtC,IAAI,CAAC,GAAG,WAAW;AAAA,IAClB,UAAU;AAAA,MACR;AAAA,MACA,WAAW,IAAI,KAAK,EAAE,OAAO,EAAE,QAAQ;AAAA,IACzC;AAAA,IACA,SAAS,EAAE;AAAA,IACX,OAAO,EAAE,MAAM;AAAA,IACf,OAAO,EAAE,MAAM,UACZ,IAAI,CAAC,aAAa,OAAO,IAAI,QAAQ,CAAC,EACtC,OAAO,CAAC,MAA6B,CAAC,EAAE,KAAK,EAAE,aAAa,SAAS;AAAA,EACxE,EAAA;AACN;AAYA,SAAS,qBAAqB;AAAA,EAC5B;AAAA,EACA,mBAAAR;AAAA,EACA,qBAAAQ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAOiB;AAGT,QAAA,sBAAsB,6BAA6B,YAAY,EAAE;AAAA,IACrE,CAAC,WAAW,OAAO;AAAA,EAGf,GAAA,iBAAiB,aAAa,eAAe,OAAO,CAAC;AAAA;AAAA,IAGvD,aAAa,MAAM,UAAU,MAAM,CAAC,aAAa,oBAAoB,SAAS,QAAQ,CAAC,KACvF,aAAa,QAAQ;AAAA,MAAM,CAAChJ,YAC1B,eAAe,EAAC,kBAAkB,QAAAA,SAAQ,mBAAAwI,oBAAmB,qBAAAQ,sBAAoB;AAAA,IACnF;AAAA,GAEH,GAEK,kBAAgC;AAAA,IACpC,SAAS;AAAA,IACT,gBAAgB;AAAA,EAAA;AAGd,SAAA,gBAAgB,eAAe,SAAS,aAAa,eAAe,UACtE,gBAAgB,eAAe,GAG1B;AACT;ACnSO,SAAS,eAAe;AACvB,QAAA,EAAC,GAAAxQ,OAAK;AAEZ,6BACG,MAAK,EAAA,OAAM,UAAS,WAAU,UAAS,KAAK,GAAG,UAAU,GAAG,UAAU,GACrE,8BAAC,QAAO,EAAA,OAAO,GACb,UAAC,oBAAAc,QAAA,EAAK,OAAK,IACT,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,GAAAd;AAAA,MACA,SAAQ;AAAA,MACR,YAAY;AAAA,QACV,cAAc,MAAO,oBAAA,cAAA,EAAqB,OAAO,EAAC,SAAS,cAAW,GAA/B,CAAkC;AAAA,MAC3E;AAAA,IAAA;AAAA,EAAA,GAEJ,GACF,EACF,CAAA;AAEJ;ACXO,SAAS,kBAAkB,EAAC,qBAAqB,SAAwB;AAC9E,QAAM,EAAC,GAAAA,GAAK,IAAA,kBACN,QAAQ;AAAA,IACZ,MAAM,uBAAuB,EAAC,qBAAqB,OAAO,GAAAA,IAAE;AAAA,IAC5D,CAAC,qBAAqB,OAAOA,EAAC;AAAA,EAAA;AAGhC,SACG,oBAAA,MAAA,EAAK,QAAM,IAAC,SAAS,GAAG,QAAQ,GAC/B,UAAA,oBAACc,UAAK,OAAK,IAAC,MAAM,GACf,iBACH,EACF,CAAA;AAEJ;AChBA,MAAM,iBAAiB,OAAO,IAAI;AAAA;AAAA;AAIlB,SAAA,WAAW,EAAC,QAAA0G,WAA0B;AACpD,SACG,oBAAA,gBAAA,EAAe,QAAM,IAAC,SAAS,GAAG,QAAQ,GAAG,MAAK,WACjD,UAAC,oBAAA,aAAA,EAAY,QAAAA,SAAgB,EAC/B,CAAA;AAEJ;ACMA,MAAM,8BAA8B,IAE9B,yBAAyB,OAAOoG,QAAM;AAAA,mBACzB,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,OAAO,CAAC,CAAC,CAAC;AAAA;AAAA;AAAA,GAKrD,qBAAqB,OAAO,GAAG;AAAA;AAAA,GAI/B,sBAAsB,OAAO,IAAI;AAAA;AAAA,GAIjC,iBAAiB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,MAKxB,sBAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASrB,SAAS,iBAAiB;AAAA,EAC/B;AAAA,EACA,0BAA0B;AAAA,EAC1B;AAAA,EACA,GAAG;AACL,GAAwB;AA7DxB,MAAA9N;AA8DE,QAAM,EAAC,SAAY,IAAA,eAAA,GACb,sBAAsB,uBAGtB,GAAA,sBAAsB,0BAA0B,MAAM,MAAM,QAE5D,cAAc,YAAY,MAAM;AACpC,aAAS,EAAC,MAAM,aAAa,SAAS,+BAAO,SAAS,OAAO,MAAM,CAAA,GAG/D,wBACF,uBAAqB,QAAA,oBAAA,UAAU,OAAO,SAAO,OAAA,SAAA,MAAA,OAAA;AAAA,EAAA,GAE9C,CAAC,UAAU,qBAAqB,KAAK,CAAC,GAEnC,eAAe;AAAA,IACnB,CAAC,UAAsB;AACrB,YAAM,mBAEF,wBACF,uBAAA,QAAA,oBAAqB,oBAAoB,KAAA;AAAA,IAE7C;AAAA,IACA,CAAC,OAAO,mBAAmB;AAAA,EAAA;AAI3B,SAAA,oBAAC,KAAK,EAAA,GAAG,MACP,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAK;AAAA,MACL,SAAS;AAAA,MACT,aAAa;AAAA,MACb,cAAc;AAAA,MACd,UAAU;AAAA,MACV,UAAU;AAAA,MAEV,UAAA,qBAAC,MAAK,EAAA,OAAM,WAEV,UAAA;AAAA,QAAC,qBAAA,QAAA,EAAO,UAAU,GAChB,UAAA;AAAA,UAAA,oBAACgB,UAAK,OAAK,IAAC,MAAM,GAChB,UAAA,oBAAC,aAAU,EACb,CAAA;AAAA,UAEA,oBAACA,UAAK,UAAO,SAAA,CAAA;AAAA,QAAA,GACf;AAAA,QACC,qBAAA,MAAA,EAAK,OAAM,WAAU,MAAM,GAAG,KAAK,GAAG,SAAQ,cAAa,YAAY,GAAG,MAAK,QAE7E,UAAA;AAAA,UAAA,MAAM,SACJ,oBAAA,qBAAA,EAAoB,OAAM,UAAS,UAAU,GAC5C,UAAC,oBAAAA,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,cAAa,YAAW,QAAO,UACjD,UAAA,MAAM,OACT,EACF,CAAA;AAAA,UAGD,MAAM,MAAM,SAAS,KACnB,oBAAA,oBAAA,EACC,UAAC,oBAAA,mBAAA,EAAkB,qBAA0C,OAAO,MAAM,MAAO,CAAA,GACnF;AAAA,WAGDhB,MAAA,SAAA,OAAA,SAAA,MAAO,YAAP,OAAA,SAAAA,IAAgB,IAAI,CAAC0H,SAAQ,MAErB,oBAAC,YAAW,EAAA,QAAAA,WAAqB,CAAG,CAAA;AAAA,QAAA,GAE/C;AAAA,QAGA,oBAAC,QAAK,OAAM,UACV,8BAAC,gBAAe,EAAA,SAAS,cACvB,UAAC,oBAAA,MAAA,EAAK,SAAS,GACb,UAAA,oBAAC1G,UAAK,MAAM,GACV,8BAAC,WAAU,CAAA,CAAA,EAAA,CACb,EACF,CAAA,EAAA,CACF,EACF,CAAA;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;AC/HA,MAAM,yCAAyC,IAGzC,gCAAgC,IAChC,gCAAgC,IAEhC,oBAAoB,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAUrB,SAAA,eAAe,EAAC,gBAAoC;AAC5D,QAAA;AAAA,IACJ;AAAA,IACA,OAAO,EAAC,gBAAgB,WAAU;AAAA,MAChC,eAAe,GACb,sBAAsB,0BACtB,iBAAiB;AAAA,IACrB,MAAM,uBAAqB,OAAA,SAAA,oBAAA,kBAAA;AAAA,IAC3B,CAAC,mBAAmB;AAAA,EAAA,GAGhB,iBAAiB,OAAiC,IAAI,GAEtD,EAAC,GAAAd,GAAC,IAAI,eAAe,GAMrB,iCAAiC,YAAY,MAAM;AAnD3D,QAAAF;AAoDQ,2BACF,oBAAoB,aAEtB,IAAAA,MAAA,kBAAA,OAAA,SAAA,eAAgB,YAAhB,QAAyBA,IAAA,kBAAA;AAAA,EAAA,GACxB,CAAC,mBAAmB,CAAC,GAElB,aAAa,iBAEb,0BAA0B,QAAQ,MAC/B,aAAa,IAAI,gCAAgC,+BACvD,CAAC,UAAU,CAAC,GAET,aAAa;AAAA,IACjB,CAAC,MAAM,EAAC,aAAA,MAEJ;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAO;AAAA,QACP;AAAA,QACA,eAAe;AAAA,QACf,OAAO;AAAA,MAAA;AAAA,IACT;AAAA,IAGJ,CAAC,uBAAuB;AAAA,EAGpB,GAAA,oBAAoB,CAAC,CAAC,eAAe;AAGzC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,WAAW,qBAAsB,CAAC,qBAAqB,CAAC,kBAAkB;AAAA,MAC1E,MAAM;AAAA,MAEL,UAAA,eAAe,SAAS,IAErB,qBAAA,UAAA,EAAA,UAAA;AAAA,QAAA,oBAAC,OAAI,eAAe,GAAG,YAAY,GAAG,UAAU,GAC9C,UAAC,oBAAAgB,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,QAAO,UACzB,UAAEd,GAAA,8BAA8B,GACnC,EACF,CAAA;AAAA,4BACC,KACC,EAAA,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,oBAAmB;AAAA,YACnB,WAAWA,GAAE,mCAAmC;AAAA,YAChD;AAAA,YACA,cAAc;AAAA,YACd,YAAY;AAAA,YACZ,OAAO;AAAA,YACP,UAAU;AAAA,YACV,UAAU;AAAA,YACV;AAAA,UAAA;AAAA,QAAA,GAEJ;AAAA,4BACC,KAAI,EAAA,eAAe,GAAG,YAAY,GAAG,UAAU,GAC9C,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,SAAS;AAAA,YACT,MAAK;AAAA,YACL,MAAMA,GAAE,qCAAqC;AAAA,YAC7C,OAAK;AAAA,UAAA;AAAA,QAAA,GAET;AAAA,MAAA,EACF,CAAA,IAEA,CAAC,kBAAkB,kCAAe,cAAa,EAAA;AAAA,IAAA;AAAA,EAAA;AAIvD;AC7GA,MAAM,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAST,sBAAsB,OAAO,WAAW;AAAA,eAC/B,MAAM;AAAA,GAGf,YAAY,OAAO;AAAA;AAAA;AAAA,GAUZ,eAAe,WAAgD,SAC1E,EAAC,gBAAgB,QAAA,GACjB,KACA;AACM,QAAA,eAAe,OAAO,EAAK,GAE3B;AAAA,IACJ;AAAA,IACA,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA,QAAQ,EAAC,QAAO;AAAA,MAChB,OAAO,EAAC,OAAO,MAAK;AAAA,IACtB;AAAA,EAAA,IACE,eACE,GAAA,EAAC,GAAAA,GAAK,IAAA,eAAA,GAEN,sBAAsB;AAAA,IAC1B,MAAM,SAAS,EAAC,MAAM,uBAAuB,SAAS,CAAC,gBAAe;AAAA,IACtE,CAAC,UAAU,cAAc;AAAA,KAErB,oBAAoB;AAAA,IACxB,CAAC,MACC,SAAS,EAAC,MAAM,mBAAmB,OAAO,EAAE,cAAc,OAAM;AAAA,IAClE,CAAC,QAAQ;AAAA,EAAA,GAEL,mBAAmB,YAAY,MAAM;AACzC,aAAS,EAAC,MAAM,mBAAmB,OAAO,GAAG,CAAA;AAAA,EAAA,GAC5C,CAAC,QAAQ,CAAC;AAKb,YAAU,MAAM;AACT,kBACH,SAAS,EAAC,MAAM,uBAAuB,SAAS,IAAK;AAAA,KAEtD,CAAC,UAAU,UAAU,CAAC,GAEzB,UAAU,MAAM;AACd,iBAAa,UAAU;AAAA,EACzB,GAAG,CAAE,CAAA;AAEL,QAAM,2BAA2B,QAAQ,SAAS,KAAK,MAAM,SAAS;AAEtE,6BACG,MAAK,EAAA,MAAK,QACT,UAAA,qBAAC,QAAK,OAAM,UAAS,MAAM,GAAG,KAAK,aAAa,IAAI,GAAG,SAAS,aAAa,IAAI,GAE9E,UAAA;AAAA,IACC,cAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAYA,GAAE,uCAAuC;AAAA,QACrD,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAK;AAAA,QACL,cAAc,EAAC,SAASA,GAAE,uCAAuC,EAAC;AAAA,MAAA;AAAA,IACpE;AAAA,IAIF,oBAAC,KAAI,EAAA,MAAM,GACT,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,6BAA2B;AAAA,QAC3B,aAAa;AAAA,QACb,mBAAmB;AAAA,QACnB,cAAY;AAAA,QACZ,cAAa;AAAA,QACb,QAAQ;AAAA,QACR,aAAa,CAAC,CAAC;AAAA,QACf,UAAU,CAAC,GAAG,GAAG,CAAC;AAAA,QAClB,MAAM,UAAU,sBAAsB;AAAA,QACtC,UAAU;AAAA,QACV,SAAS;AAAA,QACT,aAAaA,GAAE,oBAAoB;AAAA,QACnC,QAAQ;AAAA,QACR;AAAA,QACA,YAAY;AAAA,QACZ,OAAO;AAAA,MAAA;AAAA,IAAA,GAEX;AAAA,IAGC,kCACE,WACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,iBAAe;AAAA,QACf,cAAYA,GAAE,2CAA2C;AAAA,UACvD,SAAS,iBAAiB,SAAS;AAAA,QAAA,CACpC;AAAA,QACD,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,UAAU;AAAA,QACV,MAAK;AAAA,QACL,MAAM,2BAA2B,YAAY;AAAA,QAC7C,cAAc;AAAA,UACZ,SAASA,GAAE,sCAAsC;AAAA,YAC/C,SAAS,iBAAiB,SAAS;AAAA,UAAA,CACpC;AAAA,QACH;AAAA,MAAA;AAAA,IAAA,GAEJ;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ,CAAC;AC1IM,SAAS,YAAY;AACpB,QAAA,EAAC,GAAAA,OAAK;AAEZ,SACG,oBAAAkN,aAAA,EAAU,OAAO,GAChB,UAAC,qBAAA,OAAA,EAAM,aAAU,aAAY,OAAO,GAAG,UAAU,GAAG,UAAU,GAC5D,UAAA;AAAA,IAAC,oBAAApM,QAAA,EAAK,OAAM,UAAS,OAAK,IAAC,MAAM,GAAG,QAAO,UACxC,UAAEd,GAAA,yBAAyB,GAC9B;AAAA,IACA,oBAACc,QAAK,EAAA,OAAM,UAAS,OAAK,IAAC,MAAM,GAC9B,UAAEd,GAAA,oCAAoC,EACzC,CAAA;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACRA,MAAM,oBAAoB,OAAOc,MAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAyBxB,eAAe,WAAW,SACrC3B,QACA,KACA;AACA,QAAM,EAAC,MAAM,QAAQ,OAAO,GAAG,KAAQ,IAAAA;AAGrC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,WAAQ;AAAA,MACR,eAAa,SAAS,KAAK;AAAA,MAC3B,cAAY,QAAQ,KAAK;AAAA,MACzB,aAAW;AAAA,MACX;AAAA,MACA;AAAA,MACC,GAAG;AAAA,IAAA;AAAA,EAAA;AAGV,CAAC;AC/CM,SAAS,cAAc;AACtB,QAAA,EAAC,GAAAa,OAAK;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,aAAU;AAAA,MACV,WAAU;AAAA,MACV,MAAM;AAAA,MACN,KAAK;AAAA,MACL,SAAS;AAAA,MACT,SAAS;AAAA,MAET,UAAA;AAAA,QAAC,oBAAA,KAAA,EAAI,cAAc,GACjB,UAAC,oBAAA,cAAA,EAAa,MAAK,YACjB,UAAA,oBAAC,oBAAmB,CAAA,CAAA,EACtB,CAAA,GACF;AAAA,QACA,oBAAC,cAAa,EAAA,MAAM,GAAG,MAAK,YAAW,QAAO,UAC3C,UAAEA,GAAA,sCAAsC,EAC3C,CAAA;AAAA,QACA,oBAAC,gBAAa,MAAM,GAAG,MAAK,YACzB,UAAAA,GAAE,iDAAiD,GACtD;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;AC9BO,MAAM,YAA4C;AAAA,EACvD,YAAY;AAAA,IACV,aAAa;AAAA,IACb,MAAM,EAAC,WAAW,OAAO,OAAO,aAAY;AAAA,IAC5C,UAAU;AAAA,EACZ;AAAA,EACA,aAAa;AAAA,IACX,aAAa;AAAA,IACb,MAAM,EAAC,WAAW,QAAQ,OAAO,aAAY;AAAA,IAC7C,UAAU;AAAA,EACZ;AAAA,EACA,WAAW;AAAA,IACT,wBAAwB;AAAA,IACxB,MAAM,EAAC,WAAW,QAAQ,OAAO,aAAY;AAAA,IAC7C,UAAU;AAAA,EACZ;AAAA,EACA,YAAY;AAAA,IACV,aAAa;AAAA,IACb,MAAM,EAAC,WAAW,OAAO,OAAO,aAAY;AAAA,IAC5C,UAAU;AAAA,EACZ;AAAA,EACA,aAAa;AAAA,IACX,aAAa;AAAA,IACb,MAAM,EAAC,WAAW,QAAQ,OAAO,aAAY;AAAA,IAC7C,UAAU;AAAA,EACZ;AACF,GCZM,iBAAqD;AAAA,EACzD,UAAU;AAAA,EACV,EAAC,MAAM,UAAS;AAAA,EAChB,UAAU;AAAA,EACV,UAAU;AAAA,EACV,EAAC,MAAM,UAAS;AAAA,EAChB,UAAU;AAAA,EACV,UAAU;AACZ,GAEM,sBAAsB,OAAO,IAAI;AAAA;AAAA;AAIvC,SAAS,gBAAgB,MAA6D;AACpF,SAAQ,KAAuB,SAAS;AAC1C;AAEA,SAAS,eAAe,EAAC,YAAuC;AAC9D,QAAM,EAAC,GAAAA,OAAK,kBACN;AAAA,IACJ;AAAA,IACA,OAAO,EAAC,UAAU,gBAAe;AAAA,EAC/B,IAAA,eAEE,GAAA,cAAc,YAAY,MAAM;AACpC,aAAS,EAAC,UAAU,MAAM,eAAe,CAAA;AAAA,KACxC,CAAC,UAAU,QAAQ,CAAC,GAEjB,aAAa,QAAQ,MAAMjB,UAAQ,iBAAiB,QAAQ,GAAG,CAAC,iBAAiB,QAAQ,CAAC;AAG9F,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS;AAAA,MACT,SAAS;AAAA,MACT,MAAK;AAAA,MACL,MAAMiB,GAAE,SAAS,QAAQ;AAAA,IAAA;AAAA,EAAA;AAG/B;AAEO,SAAS,WAAW;AACzB,QAAM,EAAC,GAAAA,OAAK,kBACN;AAAA,IACJ,OAAO,EAAC,SAAQ;AAAA,EAAA,IACd,eAAe,GAEb,eAAe,MAAM,GAErB,kBAAkB,eAAe;AAAA,IACrC,CAAC,SAAiCjB,UAAQ,UAAU,IAAI,KAAK,CAAC,gBAAgB,IAAI;AAAA,EAAA;AAGpF,SAAK,kBAKH,oBAAC,MAAK,EAAA,cAAY,IAChB,UAAA,oBAAC,qBAAoB,EAAA,OAAM,UAAS,MAAM,GAAG,SAAS,GACpD,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAS,oBAAA,QAAA,EAAO,MAAK,SAAQ,MAAM,UAAU,MAAMiB,GAAE,gBAAgB,QAAQ,EAAG,CAAA;AAAA,MAChF,IAAI,gBAAgB;AAAA,MACpB,MACE,oBAAC,MACE,EAAA,UAAA,eAAe,IAAI,CAAC,MAAM,UACrB,gBAAgB,IAAI,IAEd,oBAAA,aAAA,CAAA,GAAiB,KAAO,IAGhC;AAAA,QAAC;AAAA,QAAA;AAAA,UAGC,UAAU;AAAA,QAAA;AAAA,QADL;AAAA,MAIV,CAAA,GACH;AAAA,MAEF,WAAU;AAAA,MACV,SAAS,EAAC,QAAQ,IAAM,QAAQ,EAAC;AAAA,IAAA;AAAA,EAAA,GAErC,GACF,IA9BO;AAgCX;AC3FA,MAAM,iBAAiB,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAOlB,SAAA,aAAa,EAAC,QAAwB;AAC9C,QAAA,EAAC,MAAS,IAAA;AAEhB,MAAI,OAAiB;AACjB,WAAS,MACX,OAAO,aACE,SAAS,QAClB,OAAO;AAGH,QAAA,kBAAkB,KAAK,QAAQ,OAAO,CAAC,UAAU,MAAM,QAAQ,CAAC;AAEtE,SAEI,oBAAA,UAAA,EAAA,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SACE,oBAAC,OAAM,EAAA,OAAO,GACX,UAAgB,gBAAA,SAEZ,oBAAA,UAAA,EAAA,UAAA,gBAAgB,IAAI,CAAC,UACnB,qBAAA,QAAA,EAAwB,OAAO,GAC9B,UAAA;AAAA,QAAA,oBAAC,QAAK,MAAM,GAAG,QAAO,UACnB,gBAAM,MACT;AAAA,QACC,oBAAA,MAAA,EAAK,MAAM,GAAI,gBAAM,KAAI;AAAA,MAJf,EAAA,GAAA,MAAM,IAKnB,CACD,EACH,CAAA,wBAEC,MAAK,EAAA,MAAM,GAAG,UAAA,aAAA,CAAU,EAE7B,CAAA;AAAA,MAEF,WAAU;AAAA,MACV,QAAM;AAAA,MAEN,UAAA,oBAAC,gBAAe,EAAA,SAAS,GAAG,QAAQ,GAAG,MACrC,UAAA,qBAAC,MAAK,EAAA,MAAM,GAAG,UAAA;AAAA,QAAA;AAAA,QAAQ;AAAA,MAAA,EAAA,CAAM,EAC/B,CAAA;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;AC5CA,MAAM,yCAAyC,IACzC,wBAAwB,GAExB,yBAAyB,OAAO,IAAI;AAAA,aAC7B,CAAC,EAAC,SAAA,MAAe,WAAW,MAAM,CAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAc1C,SAAS,cAAc,EAAC,mBAAmB,cAAc,gBAAmC;AAC3F,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,OAAO,EAAC,OAAA6L,QAAO,SAAS,YAAY,iBAAiB,QAAQ,MAAK;AAAA,EAChE,IAAA,eACE,GAAA,EAAC,GAAA7L,GAAC,IAAI,eAAe,GACrB,sBAAsB,0BAEtB,mBAAmB,CAAC,CAAC,OAAO,KAAK,QACjC,qBAAqB,CAAC,OAAO,KAAK,UAAU,OAAO,QACnD,WAAW,OAAO,OAKlB,0BAA0B,YAAY,MAAM;AAC5C,2BACF,oBAAoB,UAAU,OAAO,OAAO,GAE9C,WAAA,QAAA;EAAA,GACC,CAAC,SAAS,SAAS,qBAAqB,KAAK,CAAC,GAE3C,mBAAmB,YAAY,MAAM;AAChC,aAAA,EAAC,MAAM,iBAAA,CAAiB;AAAA,EAChC,GAAA,CAAC,QAAQ,CAAC,GAEP,aAAa;AAAA,IACjB,CAAC,SAGK,qBAAA,UAAA,EAAA,UAAA;AAAA,MAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA,YAAY,eAAe,KAAK,IAAI,GAAG,KAAK;AAAA,UAC5C,cAAc,KAAK,IAAI;AAAA,UACvB,SAAS;AAAA,UACT;AAAA,UACA,UAAU;AAAA,QAAA;AAAA,MACZ;AAAA,MACC6L,UAAS,oBAAC,cAAa,EAAA,MAAM,KAAM,CAAA;AAAA,IAAA,GACtC;AAAA,IAGJ,CAACA,QAAO,mBAAmB,yBAAyB,YAAY;AAAA,EAAA;AAGlE,6BACG,MACC,EAAA,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,WAAW,cAAc,CAAC,EAAE,YAAY,oBAAoB;AAAA,MAC5D,MAAM;AAAA,MAEN,UAAC,qBAAA,MAAA,EAAK,WAAU,UAAS,QAAO,QAE7B,UAAA;AAAA,QAAA,wCAAqB,UAAS,EAAA;AAAA,QAG9B,oBAAA,wBAAA,EAAuB,UAAU,OAAO,SAAS,aAAW,OAAO,SAAS,MAAM,GAChF,UAAA,WACE,oBAAA,aAAA,CAAY,CAAA,IAGV,qBAAA,UAAA,EAAA,UAAA;AAAA,UACC,oBAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,oBAAmB;AAAA,cACnB,WAAW7L,GAAE,6BAA6B;AAAA,cAC1C,eAAY;AAAA,cACZ,aAAW;AAAA,cACX,cAAc;AAAA,cACd;AAAA,cACA,YAAY;AAAA,cACZ,OAAO,OAAO;AAAA,cACd,UAAU;AAAA,cACV,cAAc;AAAA,cACd,UAAU;AAAA,cACV,UAAU;AAAA,cACV,KAAK;AAAA,cACL;AAAA,YAAA;AAAA,UACF;AAAA,UAED,0CAAuB,WAAU,EAAA;AAAA,QAAA,EAAA,CACpC,EAEJ,CAAA;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACrFA,MAAM6Q,yBAAmC;AAAA,EACvC,UAAU;AAAA,EACV,MAAM;AACR,GAEM,gBAA0B;AAAA,EAC9B,MAAM,EAAC,SAAS,GAAG,OAAO,GAAG,GAAG,OAAM;AAAA,EACtC,QAAQ,EAAC,SAAS,GAAG,OAAO,MAAM,GAAG,OAAM;AAC7C,GAEM,mBAA6B;AAAA,EACjC,MAAM,EAAC,SAAS,EAAC;AAAA,EACjB,QAAQ,EAAC,SAAS,EAAC;AACrB,GAEM,aAAa,IAEb,gBAAgB,OAAO,OAAO,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GASnC,mBAAmB,OAAO,OAAO,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,mBAKzB,UAAU,QAAQ,qBAAqB;AAAA,MACpD,kBAAkB;AAAA;AAAA;AAAA,SAGf,UAAU;AAAA,4BACS,wBAAwB,CAAC,QAAQ,iBAAiB;AAAA;AAMvE,SAAS,cAAc;AAAA,EAC5B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAuB;AACf,QAAA,CAAC,cAAc,eAAe,IAAI,SAAkC,IAAI,GAExE,iBAAiB,OAA2B,IAAI,GAEhD,EAAC,YAAY,WAAU,YACvB,EAAC,GAAA7Q,GAAA,IAAK,kBAEN;AAAA,IACJ,SAAS;AAAA,IACT,OAAO,EAAC,gBAAgB,MAAK;AAAA,EAAA,IAC3B,eAAe,GAEb,gBAAgB,mBAAmB,EAAC,OAAM,GAK1C,qBAAqB,YAAY,MAAM;AACvC,kBAAc,iBAAiB,QACjC;EAED,GAAA,CAAC,YAAY,eAAe,IAAI,CAAC;AAEpB,SAAA,gBAAA,oBAAoB,CAAC,eAAe,OAAO,CAAC,GAGzD,oBAAA,eAAA,EAAc,eAA8B,SAAkB,QAAgB,MAC7E,8BAAC,iBACE,EAAA,UAAA,QACE,oBAAA,QAAA,EACC,UAAC,qBAAA,WAAA,EAAU,WAAW,CAAC,eAAe,UAAU,kBAAkB,aAAW,IAC3E,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAQ;AAAA,QACR,MAAK;AAAA,QACL,SAAQ;AAAA,QACR,OAAO,EAAC,OAAM;AAAA,QACd,YAAY6Q;AAAAA,QACZ,UAAU;AAAA,MAAA;AAAA,IACZ;AAAA,IAEA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAQ;AAAA,QACR,MAAK;AAAA,QACL,SAAQ;AAAA,QACR,UAAS;AAAA,QACT,QAAQ;AAAA,QACR,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,OAAO,EAAC,OAAM;AAAA,QACd,YAAYA;AAAAA,QACZ,UAAU;AAAA,QAEV,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,gBAEM7Q,GADJ,gBACM,qCACA,mCADkC;AAAA,cAG1C;AAAA,cACA,KAAK;AAAA,YAAA;AAAA,UACP;AAAA,UACC,sCACE,MAAK,EAAA,WAAS,IAAC,MAAK,QACnB,UAAC,oBAAA,SAAA,CAAA,CAAQ,EACX,CAAA;AAAA,UAED,gBACC;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA;AAAA,cACA;AAAA,YAAA;AAAA,UACF,IAEC,oBAAA,gBAAA,EAAe,cAA4B;AAAA,QAAA;AAAA,MAAA;AAAA,IAEhD;AAAA,EACF,EAAA,CAAA,EACF,CAAA,GAEJ,EACF,CAAA;AAEJ;ACvKO,SAAS,oBAAoB,OAA0D;AACrF,SAAA,OAAQ,MAAuB,WAAa;AACrD;ACDA,MAAM,WAAW;AAEF6L,QAAM,QAAQ;AACtB,SAAS,cAAc,MAA8B;AAC1D,QAAM,YAAY,GAAG,QAAQ,GAAG,IAAI;AAChC,SAAAA,WAASA,QAAM,QAAQ,SAAS,IAC3BA,QAAM,SAAS,IAEjBA,QAAM,QAAQ;AACvB;AAEO,SAAS,cAAuB;AACrC,SAAO,OAAO,SAAW,MACrB,KACA,OAAO,SAAS,KAAK,MAAM,CAAC,EAAE,MAAM,GAAG,EAAE,SAAS,cAAc;AACtE;AC8CO,SAAS,mBAAmB;AAAA,EACjC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAA2C;AAClC,SAAA;AAAA,IACL;AAAA,IACA,OAAO,YAAY;AAAA,IACnB,uBAAuB,CAAC;AAAA,IACxB,SAAS,CAAC;AAAA,IACV,gBAAgB;AAAA,IAChB;AAAA,IACA,iBAAiB;AAAA,IACjB,UAAU,UAAU;AAAA,IACpB,GAAG;AAAA,IACH,QAAQ;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,MAAM,CAAC;AAAA,MACP,QAAQ;AAAA,MACR,SAAS;AAAA,IACX;AAAA,IACA,OAAO;AAAA,MACL,OAAO;AAAA,MACP,OAAO,CAAC;AAAA,IACV;AAAA,IACA;AAAA,EAAA;AAEJ;AAuDA,MAAM,QAAQ,cAAc,SAAS;AAErB,SAAA,cAAc,OAA2B,QAA0C;AAvJnG,MAAA/L,KAAA;AAwJE,MAAI,SAAS;AASb,UARI,OAAO,KAAK,WAAW,gBAAgB,MACzC,SAAS,cAEP,OAAO,KAAK,WAAW,iBAAiB,MAC1C,SAAS,cAEX,MAAM,QAAQ,MAAM,GAEZ,OAAO,MAAM;AAAA,IACnB,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,gBAAgB,OAAO;AAAA,MAAA;AAAA,IAE3B,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,iBAAiB,OAAO;AAAA,MAAA;AAAA,IAE5B,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,UAAU,UAAU;AAAA,QACpB,OAAO,YAAY,MAAM,KAAK;AAAA,MAAA;AAAA,IAElC,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,UAAU,OAAO;AAAA,QACjB,OAAO,YAAY,MAAM,KAAK;AAAA,QAC9B,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,UAAU;AAAA,QACZ;AAAA,MAAA;AAAA,IAEJ,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,SAAQA,MAAA,MAAM,eAAN,OAAAA,MAAoB,MAAM;AAAA,QAClC,YAAY;AAAA,QACZ,OAAO,YAAY,MAAM,KAAK;AAAA,MAAA;AAAA,IAElC,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,UAAU;AAAA,UACV,MAAM,CAAC;AAAA,QACT;AAAA,MAAA;AAAA,IAEJ,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,aAAY,KAAO,OAAA,eAAP,OAAqB,KAAA;AAAA,QACjC,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,OAAO;AAAA,UACP,UAAU;AAAA,UACV,MAAM,MAAM,OAAO,WACf,YAAY,CAAC,GAAG,MAAM,OAAO,MAAM,GAAG,OAAO,IAAI,CAAC,IAClD,OAAO;AAAA,UACX,QAAQ;AAAA,UACR,SAAS;AAAA,QACX;AAAA,MAAA;AAAA,IAEJ,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,OAAO,OAAO;AAAA,UACd,QAAQ;AAAA,UACR,SAAS;AAAA,QACX;AAAA,MAAA;AAAA,IAEJ,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,QAAQ;AAAA,UACR,SAAS;AAAA,QACX;AAAA,MAAA;AAAA,IAEJ,KAAK,qBAAqB;AACxB,YAAM,YAA0B;AAAA,QAC9B,GAAG,OAAO;AAAA,QACV,OAAO,wBAAwB,MAAM,YAAY,WAAW,OAAO,OAAO,YAAY;AAAA,SAElF,UAAU,CAAC,GAAG,MAAM,SAAS,SAAS;AAErC,aAAA;AAAA,QACL,GAAG;AAAA,QACH,uBAAuB,oBAAoB;AAAA,UACzC,kBAAkB,MAAM,YAAY;AAAA,UACpC;AAAA,UACA,OAAO,MAAM,MAAM;AAAA,QAAA,CACpB;AAAA,QACD;AAAA,QACA,iBAAiB;AAAA,QACjB,OAAO;AAAA,UACL,GAAG,MAAM;AAAA,UACT,QAAQ,oBAAoB;AAAA,YAC1B,kBAAkB,MAAM,YAAY;AAAA,YACpC,mBAAmB,MAAM,YAAY;AAAA,YACrC;AAAA,YACA,qBAAqB,MAAM,YAAY;AAAA,UAAA,CACxC;AAAA,QACH;AAAA,MAAA;AAAA,IAEJ;AAAA,IACA,KAAK,uBAAuB;AAC1B,YAAM,UAA0B,CAAA;AAEzB,aAAA;AAAA,QACL,GAAG;AAAA,QACH,uBAAuB,oBAAoB;AAAA,UACzC,kBAAkB,MAAM,YAAY;AAAA,UACpC;AAAA,UACA,OAAO,MAAM,MAAM;AAAA,QAAA,CACpB;AAAA,QACD;AAAA,QACA,OAAO;AAAA,UACL,GAAG,MAAM;AAAA,UACT,QAAQ,oBAAoB;AAAA,YAC1B,kBAAkB,MAAM,YAAY;AAAA,YACpC,mBAAmB,MAAM,YAAY;AAAA,YACrC;AAAA,YACA,qBAAqB,MAAM,YAAY;AAAA,UAAA,CACxC;AAAA,QACH;AAAA,MAAA;AAAA,IAEJ;AAAA,IACA,KAAK,wBAAwB;AAC3B,YAAM,QAAQ,MAAM,QAAQ,UAAU,CAAC0H,YAAW,aAAaA,OAAM,MAAM,OAAO,SAAS,GAErF,UAAU;AAAA,QACd,GAAG,MAAM,QAAQ,MAAM,GAAG,KAAK;AAAA;AAAA,QAC/B,GAAG,MAAM,QAAQ,MAAM,QAAQ,CAAC;AAAA,MAAA;AAG3B,aAAA;AAAA,QACL,GAAG;AAAA,QACH,uBAAuB,oBAAoB;AAAA,UACzC,kBAAkB,MAAM,YAAY;AAAA,UACpC;AAAA,UACA,OAAO,MAAM,MAAM;AAAA,QAAA,CACpB;AAAA,QACD;AAAA,QACA,OAAO;AAAA,UACL,GAAG,MAAM;AAAA,UACT,QAAQ,oBAAoB;AAAA,YAC1B,kBAAkB,MAAM,YAAY;AAAA,YACpC,mBAAmB,MAAM,YAAY;AAAA,YACrC;AAAA,YACA,qBAAqB,MAAM,YAAY;AAAA,UAAA,CACxC;AAAA,QACH;AAAA,MAAA;AAAA,IAEJ;AAAA,IACA,KAAK,8BAA8B;AAG3B,YAAA,gBAAgB,MAAM,QAAQ;AAAA,QAClC,CAACA,YAAW,aAAaA,OAAM,MAAM,OAAO;AAAA,SAExC,kBAAkB;AAAA,QACtB,MAAM,YAAY;AAAA,QAClB,iBAAe,OAAA,SAAA,cAAA;AAAA,MAAA,GAEX,eAAe,sBAAsB,MAAM,YAAY,WAAW,OAAO,YAAY,GACrF,mBAAmB,gBAAA,OAAA,SAAA,aAAc,cACjC,yBAAwB,mBAAiB,OAAA,SAAA,gBAAA,oBAAkB,gBAAc,OAAA,SAAA,aAAA,iBAEzE,UAAU,MAAM,QAAQ,IAAI,CAACA,YAC7B,aAAaA,OAAM,MAAM,OAAO,YAC3B;AAAA,QACL,GAAGA;AAAA,QACH,cAAc,OAAO;AAAA,QACrB,GAAI,wBAAwB,EAAC,OAAO,qBAAoB,CAAC;AAAA,UAGtDA,OACR;AAEM,aAAA;AAAA,QACL,GAAG;AAAA,QACH;AAAA,QACA,OAAO;AAAA,UACL,GAAG,MAAM;AAAA,UACT,QAAQ,oBAAoB;AAAA,YAC1B,kBAAkB,MAAM,YAAY;AAAA,YACpC,mBAAmB,MAAM,YAAY;AAAA,YACrC;AAAA,YACA,qBAAqB,MAAM,YAAY;AAAA,UAAA,CACxC;AAAA,QACH;AAAA,MAAA;AAAA,IAEJ;AAAA,IACA,KAAK,2BAA2B;AACxB,YAAA,UAAU,MAAM,QAAQ,IAAI,CAACA,YAC7B,aAAaA,OAAM,MAAM,OAAO,YAC3B;AAAA,QACL,GAAGA;AAAA,QACH,OAAO,OAAO;AAAA,UAGXA,OACR;AAEM,aAAA;AAAA,QACL,GAAG;AAAA,QACH;AAAA,QACA,OAAO;AAAA,UACL,GAAG,MAAM;AAAA,UACT,QAAQ,oBAAoB;AAAA,YAC1B,kBAAkB,MAAM,YAAY;AAAA,YACpC,mBAAmB,MAAM,YAAY;AAAA,YACrC;AAAA,YACA,qBAAqB,MAAM,YAAY;AAAA,UAAA,CACxC;AAAA,QACH;AAAA,MAAA;AAAA,IAEJ;AAAA,IACA,KAAK;AACI,aAAA;AAAA,QACL,GAAG;AAAA,QACH,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,QAAQ;AAAA,UACR,UAAU;AAAA,QACZ;AAAA,QACA,OAAO,YAAY;AAAA,UACjB,GAAG,MAAM;AAAA,UACT,OAAO,OAAO;AAAA,QAAA,CACf;AAAA,MAAA;AAAA,IAEL,KAAK,aAAa;AAChB,YAAM,UAAU,OAAO,WAAW,CAAA,GAC5B,QAAQ;AAAA,QACZ,GAAI,MAAM,MAAM,SAAS,CAAC;AAAA;AAAA,QAC1B,GAAG,OAAO,MAAM;AAAA,MAAA,EAChB,KAAK,SAAS;AAET,aAAA;AAAA,QACL,GAAG;AAAA,QACH,uBAAuB,oBAAoB;AAAA,UACzC,kBAAkB,MAAM,YAAY;AAAA,UACpC;AAAA,UACA;AAAA,QAAA,CACD;AAAA,QACD;AAAA,QACA,iBAAiB;AAAA,QACjB,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,QAAQ;AAAA,UACR,UAAU;AAAA,QACZ;AAAA,QACA,OAAO;AAAA,UACL,GAAG,OAAO;AAAA,UACV,QAAQ,oBAAoB;AAAA,YAC1B,kBAAkB,MAAM,YAAY;AAAA,YACpC,mBAAmB,MAAM,YAAY;AAAA,YACrC;AAAA,YACA,qBAAqB,MAAM,YAAY;AAAA,UAAA,CACxC;AAAA,QACH;AAAA,MAAA;AAAA,IAEJ;AAAA,IACA,KAAK,kBAAkB;AACrB,YAAM,QAAQ;AAAA,QACZ,GAAI,MAAM,MAAM,SAAS,CAAC;AAAA;AAAA,QAC1B,OAAO;AAAA,MACP,EAAA,KAAK,SAAS,GAGV,wBAAwB,oBAAoB;AAAA,QAChD,kBAAkB,MAAM,YAAY;AAAA,QACpC,SAAS,CAAC;AAAA,QACV;AAAA,MAAA,CACD,GAIK,UAAU,MAAM,QAAQ,OAAO,CAAC,MAAM;AAC1C,cAAM,kBAAkB,mBAAmB,MAAM,YAAY,QAAQ,CAAC;AACtE,eAAI,kBAEE,gBAAgB,cAAc,WAAW,IACpC,KAEF,sBAAsB;AAAA,UAC3B,CAAC,SAAS,gBAAgB,cAAc,UAAU,CAACxH,OAAMA,OAAM,IAAI,IAAI;AAAA,QAGpE,IAAA;AAAA,MAAA,CACR;AAEM,aAAA;AAAA,QACL,GAAG;AAAA,QACH;AAAA,QACA;AAAA,QACA,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,QAAQ;AAAA,UACR,UAAU;AAAA,QACZ;AAAA,QACA,OAAO,YAAY;AAAA,UACjB,GAAG,MAAM;AAAA,UACT,QAAQ,oBAAoB;AAAA,YAC1B,kBAAkB,MAAM,YAAY;AAAA,YACpC,mBAAmB,MAAM,YAAY;AAAA,YACrC,qBAAqB,MAAM,YAAY;AAAA,YACvC;AAAA,UAAA,CACD;AAAA,UACD;AAAA,QAAA,CACD;AAAA,MAAA;AAAA,IAEL;AAAA,IACA,KAAK,qBAAqB;AAClB,YAAA,SAAS,MAAM,MAAM,SAAS,CAAA,GAAI,OAAO,CAAC,MAAM,MAAM,OAAO,UAAU;AAEtE,aAAA;AAAA,QACL,GAAG;AAAA,QACH,uBAAuB,oBAAoB;AAAA,UACzC,kBAAkB,MAAM,YAAY;AAAA,UACpC,SAAS,MAAM;AAAA,UACf;AAAA,QAAA,CACD;AAAA,QACD,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,QAAQ;AAAA,UACR,UAAU;AAAA,QACZ;AAAA,QACA,OAAO,YAAY;AAAA,UACjB,GAAG,MAAM;AAAA,UACT;AAAA,QAAA,CACD;AAAA,MAAA;AAAA,IAEL;AAAA,IACA,KAAK,qBAAqB;AACxB,YAAM,QAAsB,CAAA;AAErB,aAAA;AAAA,QACL,GAAG;AAAA,QACH,uBAAuB,oBAAoB;AAAA,UACzC,kBAAkB,MAAM,YAAY;AAAA,UACpC,SAAS,MAAM;AAAA,UACf;AAAA,QAAA,CACD;AAAA,QACD,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,QAAQ;AAAA,UACN,GAAG,MAAM;AAAA,UACT,QAAQ;AAAA,UACR,UAAU;AAAA,QACZ;AAAA,QACA,OAAO,YAAY;AAAA,UACjB,GAAG,MAAM;AAAA,UACT,OAAO,CAAC;AAAA,QAAA,CACT;AAAA,MAAA;AAAA,IAEL;AAAA,IACA;AACS,aAAA;AAAA,EACX;AACF;AAYA,SAAS,YAAY,OAAmC;AAClD,MAAA,oBAAoB,KAAK,GAAG;AAE9B,UAAM,EAAC,UAAU,GAAG,KAAA,IAAQ;AACrB,WAAA;AAAA,EACT;AACO,SAAA;AACT;AAQA,SAAS,YAAY,MAAgC;AACnD,QAAM,WAAW,KAAK,OAAO,CAACkB,MAAK,QAAQ;AACzC,UAAMvC,MAAK,eAAe,IAAI,IAAI,GAAG;AAE9B,WAAA;AAAA,MACL,GAAGuC;AAAA,MACH,CAACvC,GAAE,GAAG;AAAA,IAAA;AAAA,EAEV,GAAG,CAAE,CAAA;AAEE,SAAA,OAAO,OAAO,QAAQ;AAC/B;AC3hBO,SAAS,eAAe,EAAC,UAAU,cAAkC;AAC1E,QAAM,aAAa,OAA4B,IAAI,GAC7C,CAAC,mBAAmB,oBAAoB,IAAI,SAAmC,IAAI,GAEnF,SAAS,UACT,GAAA,cAAc,kBACd;AAAA,IACJ,QAAQ,EAAC,WAAW,QAAO;AAAA,EAAA,IACzB,UAGE,GAAA,EAAC,kBAAkB,mBAAAqR,oBAAmB,qBAAAQ,qBAAA,IAAuB,QAAQ,OAClE;AAAA,IACL,kBAAkB,gCAAgC,uBAAuB,QAAQ,OAAO,CAAC;AAAA,IACzF,mBAAmB,iCAAiC,OAAO;AAAA,IAC3D,qBAAqB,mCAAmC,SAAS;AAAA,EAAA,IAElE,CAAC,SAAS,WAAW,MAAM,CAAC,GAEzB,eAAe;AAAA,IACnB,MACE,mBAAmB;AAAA,MACjB;AAAA,MACA;AAAA,MACA,aAAa;AAAA,QACX,QAAQ;AAAA,QACR,WAAWA;AAAA,QACX,SAASR;AAAA,MACX;AAAA,MACA,YAAY;AAAA,QACV,QAAQ;AAAA,QACR,YAAY;AAAA,MACd;AAAA,IAAA,CACD;AAAA,IACH,CAAC,aAAa,kBAAkBA,oBAAmB,YAAYQ,oBAAmB;AAAA,EAAA,GAE9E,CAAC,OAAO,QAAQ,IAAI,WAAW,eAAe,YAAY,GAE1D,EAAC,uBAAuB,SAAS,gBAAgB,UAAU,QAAQ,QAAQ,MAAK,IAAI,OAEpF,eAAe,OAAO,EAAK,GAC3B,sBAAsB,OAAuB,aAAa,QAAQ,GAClE,oBAAoB,OAAsB,aAAa,MAAM,GAC7D,mBAAmB,OAAmC,aAAa,KAAK,GAExE,EAAC,cAAc,gBAAe,UAAU;AAAA,IAC5C,cAAc,EAAC,GAAG,QAAQ,MAAK;AAAA,IAC/B,YAAY,CAAC,iBAAiB,SAAS,EAAC,GAAG,cAAc,MAAM,2BAA0B;AAAA,IACzF,SAAS,CAAC,UAAU,SAAS,EAAC,OAAO,MAAM,wBAAuB;AAAA,IAClE,SAAS,MAAM,SAAS,EAAC,MAAM,wBAAuB;AAAA,IACtD;AAAA,EAAA,CACD,GAEK,gBAAgB,mBAAmB,EAAC,MAAA,CAAM,GAG1C,gBAAgB,sBAAsB,IAAI,CAAC,iBAAiB,OAAO,IAAI,YAAY,CAAE,GAGrF,kBAAkB,eAAe;AAAA,IAAO,CAAChJ,YAC7C,eAAe;AAAA,MACb;AAAA,MACA,QAAAA;AAAA,MACA,mBAAAwI;AAAA,MACA,qBAAAQ;AAAA,IAAA,CACD;AAAA,EAAA,GAGG,mBAAmB,YAAY,CAAC,YAAwB;AAC5D,eAAW,UAAU;AAAA,EACvB,GAAG,CAAE,CAAA;AASL,SAAA,UAAU,MAAM;AACd,UAAM,kBAAkB,CAACzR,UAAQ,UAAU,oBAAoB,OAAO,GAChE,gBAAgB,WAAW,kBAAkB,SAC7C,eAAe,CAACA,UAAQ,OAAO,iBAAiB,OAAO;AAEzD,QAAA,mBAAmB,iBAAiB,cAAc;AAE9C,YAAA,aACJ,YAAU,OAAA,SAAA,SAAA,2BAA0B,GAAG,SAAS,KAAK,KAAK,IAAI,SAAS,KAAK,SAAS;AAE1E,mBAAA;AAAA,QACX,SAAS;AAAA;AAAA,UAEP,UAAU;AAAA,YACR,GAAI,oBAAoB,KAAK,IACzB,CAAC,6BAA6B,MAAM,SAAS,KAAK,EAAE,IACpD,CAAC;AAAA,YACL,8BAA8B,MAAM,MAAM,MAAM;AAAA,YAChD,oBAAoB,SAAS;AAAA,YAC7B;AAAA,YACA,4BAA4B,gBAAgB,MAAM;AAAA,UACpD;AAAA,UACA,OAAO;AAAA,UACP,iBAAiB,SAAS;AAAA,UAC1B,MAAM,CAAC,SAAS,IAAI;AAAA,UACpB,QAAQ,UAAU;AAAA,QACpB;AAAA,QACA,OAAO;AAAA,UACL,GAAG;AAAA;AAAA,UAEH,GAAI,gBAAgB,EAAC,OAAO,kBAAiB,CAAC;AAAA,QAChD;AAAA,MAAA,CACD,GAGD,kBAAkB,UAAU;AAAA,IAC9B;AAGoB,wBAAA,UAAU,UAC9B,iBAAiB,UAAU;AAAA,EAAA,GAC1B;AAAA,IACD,gBAAgB;AAAA,IAChB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAY;AAAA,IACZ;AAAA,IACA;AAAA,EAAA,CACD,GAOD,UAAU,MAAM;AACV,KAAC,iBAAiB,gBAAc,QAAA,aAAA,WAAW,OAAO,KAAK,SAAS,KAClE,SAAS,EAAC,MAAM,eAAA,CAAe,GAGjC,aAAa,UAAU;AAAA,EACzB,GAAG,CAAC,UAAU,eAAe,OAAO,MAAM,MAAM,OAAO,MAAM,KAAK,CAAC,GAGjE;AAAA,IAAC,cAAc;AAAA,IAAd;AAAA,MACC,OAAO;AAAA,QACL;AAAA,QACA,SAAS,cAAY,OAAA,SAAA,WAAA;AAAA,QACrB;AAAA,QACA;AAAA,QACA,YAAY;AAAA,QACZ,OAAO;AAAA,UACL,GAAG;AAAA,UACH;AAAA,QACF;AAAA,MACF;AAAA,MAEC;AAAA,IAAA;AAAA,EAAA;AAGP;ACjLO,MAAM,eAAe,WAAW,SACrC,EAAC,QAAA,GACD,KACA;AACM,QAAA,EAAC,GAAAiB,OAAKuN;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,cAAYvN,GAAE,+BAA+B;AAAA,MAC7C,eAAY;AAAA,MACZ,MAAM;AAAA,MACN,cAAc;AAAA,QACZ,SAASA,GAAE,uBAAuB;AAAA,QAClC,SAAS,CAAC,4BAA4B,kBAAkB,aAAa;AAAA,QACrE,QAAQ;AAAA,MACV;AAAA,MACA;AAAA,MACA,MAAK;AAAA,MACL;AAAA,IAAA;AAAA,EAAA;AAGN,CAAC,GCbK,YAAY,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQvB,kBAAkB,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAe3B,SAAS,aAAa,EAAC,SAAS,QAAQ,QAA0B;AACvE,QAAM,CAAC,cAAc,eAAe,IAAI,SAAkC,IAAI,GACxE,EAAC,OAAM,IAAI,eACX,GAAA,EAAC,GAAAA,GAAC,IAAI,kBAEN;AAAA,IACJ,OAAO,EAAC,gBAAgB,MAAK;AAAA,EAAA,IAC3B,eAAe,GAEb,gBAAgB,mBAAmB,EAAC,MAAM,CAAA;AAG9C,SAAA,oBAAC,eAAc,EAAA,eAA8B,SAAkB,QAAgB,MAC5E,UAAA,QACE,oBAAA,QAAA,EACC,UAAC,oBAAA,WAAA,EAAU,WAAW,CAAC,eAAe,aAAW,IAC/C,UAAC,oBAAA,iBAAA,EACC,UAAC,qBAAA,WAAA,EAAU,SAAQ,QAAO,QAAO,QAAO,QAAgB,MAAK,WAC3D,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,gBAEMA,GADJ,gBACM,qCACA,mCADkC;AAAA,QAG1C;AAAA,QACA,KAAK;AAAA,MAAA;AAAA,IACP;AAAA,IACC,sCACE,MAAK,EAAA,WAAS,IAAC,MAAK,QACnB,UAAC,oBAAA,SAAA,CAAA,CAAQ,EACX,CAAA;AAAA,IAED,gBACE,oBAAA,eAAA,EAAc,cAA4B,IAE3C,oBAAC,kBAAe,cAA4B;AAAA,EAEhD,EAAA,CAAA,EAAA,CACF,EACF,CAAA,EACF,CAAA,EAEJ,CAAA;AAEJ;ACjFO,SAAS,uBAAuBb,QAAoC;AACnE,QAAA,EAAC,WAAc,IAAAA;AACrB,SAAO,cAAc,WAAW,WAAW,EAAC,MAAM,YAAW;AAC/D;ACPO,SAAS,gBAAgB;AAC9B,SACG,oBAAA,MAAA,EAAK,QAAO,QACX,UAAC,oBAAA,MAAA,EAAK,OAAM,UAAS,QAAO,QAAO,SAAQ,UAAS,SAAS,GAAG,QAAO,UACrE,UAAA,oBAAC+N,aAAU,EAAA,OAAO,GAChB,UAAA,oBAAC,QAAK,SAAS,GAAG,QAAQ,GAAG,QAAQ,GAAG,MAAK,WAC3C,+BAAC,MACC,EAAA,UAAA;AAAA,IAAC,oBAAA,KAAA,EACC,8BAACpM,QAAK,EAAA,MAAM,GACV,UAAC,oBAAA,oBAAA,CAAA,CAAmB,GACtB,EACF,CAAA;AAAA,yBACC,OAAM,EAAA,MAAM,GAAG,YAAY,GAAG,OAAO,GACpC,UAAA;AAAA,MAAA,oBAACA,UAAK,IAAG,MAAK,MAAM,GAAG,QAAO,UAAS,UAEvC,sBAAA,CAAA;AAAA,MACA,oBAACA,UAAK,IAAG,KAAI,OAAK,IAAC,MAAM,GAAG,UAE5B,wDAAA,CAAA;AAAA,0BACCA,QAAK,EAAA,IAAG,KAAI,OAAK,IAAC,MAAM,GACvB,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAK;AAAA,UACL,KAAI;AAAA,UACJ,QAAO;AAAA,UACR,UAAA;AAAA,QAAA;AAAA,MAAA,GAGH;AAAA,IAAA,GACF;AAAA,EACF,EAAA,CAAA,EAAA,CACF,EACF,CAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACpCO,SAAS,kBAAkB3B,QAA0B;AACpD,QAAA,EAAC,SAAS,oBAAkB,IAAAA;AAElC,SACG,oBAAA,MAAA,EAAK,QAAO,QACX,UAAC,oBAAA,MAAA,EAAK,OAAM,UAAS,QAAO,QAAO,SAAQ,UAAS,SAAS,GAAG,QAAO,UACrE,UAAA,oBAAC+N,aAAU,EAAA,OAAO,GAChB,UAAA,oBAAC,QAAK,SAAS,GAAG,QAAQ,GAAG,QAAQ,GAAG,MAAK,WAC3C,+BAAC,MACC,EAAA,UAAA;AAAA,IAAC,oBAAA,KAAA,EACC,8BAACpM,QAAK,EAAA,MAAM,GACV,UAAC,oBAAA,wBAAA,CAAA,CAAuB,GAC1B,EACF,CAAA;AAAA,wBACC,OAAM,EAAA,MAAM,GAAG,YAAY,GAAG,OAAO,GACpC,UAAC,oBAAAA,QAAA,EAAK,IAAG,MAAK,MAAM,GAAG,QAAO,QAC3B,iBACH,CAAA,GACF;AAAA,EACF,EAAA,CAAA,EAAA,CACF,EACF,CAAA,EACF,CAAA,EACF,CAAA;AAEJ;ACxBO,SAAS,mBAAmB3B,QAA2B;AACtD,QAAA,EAAC,SAAY,IAAAA;AAEnB,SACG,oBAAA,MAAA,EAAK,QAAO,QACX,UAAC,oBAAA,MAAA,EAAK,OAAM,UAAS,QAAO,QAAO,SAAQ,UAAS,SAAS,GAAG,QAAO,UACrE,UAAA,oBAAC+N,aAAU,EAAA,OAAO,GAChB,UAAA,oBAAC,QAAK,SAAS,GAAG,QAAQ,GAAG,QAAQ,GAAG,MAAK,WAC3C,+BAAC,MACC,EAAA,UAAA;AAAA,IAAC,oBAAA,KAAA,EACC,8BAACpM,QAAK,EAAA,MAAM,GACV,UAAC,oBAAA,oBAAA,CAAA,CAAmB,GACtB,EACF,CAAA;AAAA,IACC,oBAAA,OAAA,EAAM,MAAM,GAAG,YAAY,GAAG,OAAO,GACpC,UAAA,qBAACA,UAAK,IAAG,MAAK,MAAM,GAAG,QAAO,UAAS,UAAA;AAAA,MAAA;AAAA,MACrB,oBAAC,UAAM,UAAS,SAAA,CAAA;AAAA,IAAA,EAAA,CAClC,EACF,CAAA;AAAA,EACF,EAAA,CAAA,EAAA,CACF,EACF,CAAA,EACF,CAAA,EACF,CAAA;AAEJ;AC7BO,MAAM,sBAAsB,yCCMtB,yBAAyB;AAAA,EACpC,CAAC,eACC;AAAA,IACE,WAAW;AAAA,MAAI,CAAC;AAAA;AAAA,QAEd,UAAU,KAAK,MAAM,KAAK,IAAI,CAAC,UAAU,CAAC,UAAU,MAAM,KAAK,CAAU,CAAC;AAAA;AAAA,IAC5E;AAAA,EAAA,EACA,KAAK,IAAI,CAAC,YAAY,OAAO,YAAY,OAAO,CAAC,CAAC;AACxD,GCRa,eAAe;AAAA,EAC1B,aAAa;AAAA,EACb,cAAc;AAAA,EACd,aAAa;AACf,GAOagQ,UAAQ,OAAO;AAAA,WACjB,CAAC3R,WAAWA,OAAM,UAAU,UAAU,SAAS,MAAO;AAAA,YACrD,CAACA,WAAWA,OAAM,UAAU,UAAU,SAAS,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQrD,uBAAuB,CAAC;AAAA,EACnC;AAAA,EACA,OAAO;AACT,MAGM;AACE,QAAA,gBAAgB,QAAQ,MAAM,WAAW,IAAI,GAAG,CAAC,IAAI,CAAC;AAE5D,SAAQ,oBAAA2R,SAAA,EAAM,OAAO,MAAO,UAAc,cAAA,CAAA;AAC5C,GAEM,aAAa,CAAC,SAAoC;AACtD,MAAI,mBAAmB,IAAI;AAAG,WAAO,cAAc,IAAI;AACvD,MAAI,eAAe,IAAI;AAAU,WAAA;AAEnC;AAWO,SAAS,iBAAiB3R,QAA8B;AAC7D,QAAM,EAAC,OAAO,UAAU,UAAU,OAAO,MAAM,UAAS,IAAIA,QAEtD,qBAAqB,QAAQ,MAAM,WAAW,SAAS,GAAG,CAAC,SAAS,CAAC;AAE3E,8BACG,MAAK,EAAA,OAAM,UAAS,MAAK,QAAO,KAAK,GACpC,UAAA;AAAA,IAAC,oBAAA,sBAAA,EAAqB,MAAY,MAAK,QAAQ,CAAA;AAAA,IAE9C,qBAAA,OAAA,EAAM,MAAM,GAAG,OAAO,GACrB,UAAA;AAAA,MAAA,oBAAC2B,UAAK,MAAM,GAAG,cAAa,YAAW,QAAO,UAC3C,UACH,MAAA,CAAA;AAAA,MAEC,gCACEA,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,cAAa,YAC/B,UACH,SAAA,CAAA;AAAA,IAAA,GAEJ;AAAA,IAEC,SAAS,aAAa,KAAK,KACzB,oBAAA,KAAA,EAAI,aAAa,GAChB,UAAA,oBAACA,UAAK,MAAM,GAAG,OAAK,IAAC,cAAa,YAC/B,UAAa,aAAA,KAAK,GACrB,EACF,CAAA;AAAA,KAGA,YAAY,uBACZ,qBAAC,MAAK,EAAA,OAAM,UAAS,KAAK,GAAG,aAAa,GAAG,cAAc,GACxD,UAAA;AAAA,MAAA,YACE,oBAAAA,QAAA,EACC,UAAC,oBAAA,eAAA,CAAc,CAAA,GACjB;AAAA,MAGD,sBAAsB,oBAACA,QAAK,EAAA,OAAK,IAAE,UAAmB,oBAAA;AAAA,IAAA,GACzD;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACzFA,MAAM,QAAQ;AAAA,EACZ;AAAA,IACE,KAAK;AAAA,IACL,SAAS;AAAA,IACT,OAAO;AAAA,EACT;AAAA,EACA;AAAA,IACE,KAAK;AAAA,IACL,SAAS;AAAA,IACT,OAAO;AAAA,EACT;AAAA,EACA;AAAA,IACE,KAAK;AAAA,IACL,SAAS;AAAA,IACT,OAAO;AAAA,EACT;AAAA,EACA;AAAA,IACE,KAAK;AAAA,IACL,SAAS;AAAA,IACT,OAAO;AAAA,EACT;AACF,GAEMD,eAAa,OAAOC,MAAI;AAAA;AAAA;AAAA;AAAA;AAYvB,SAAS,OAAO3B,QAAoB;AACnC,QAAA,EAAC,UAAU,QAAQ,OAAA,IAAUA;AACvB,wBAAe,GAGzB,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,IAAC,oBAAA,MAAA,EAAK,QAAM,IAAC,QAAQ,GAAG,UAAS,QAC/B,+BAAC,OACE,EAAA,UAAA;AAAA,MAAA,OAAO,UAAW,YAAa,oBAAA,KAAA,EAAK,UAAO,QAAA;AAAA,MAC3C,OAAO,UAAW,YACjB,oBAAC,OAAI,UAAU,GACb,UAAC,oBAAA,SAAA,EAAQ,OAAM,UAAS,MAAM,GAC3B,iBACH,CAAA,GACF;AAAA,MAGD,oBAAA,KAAA,EAAI,UAAU,GACb,UAAC,oBAAA,MAAA,EAAK,WAAW,CAAA,CAAQ,QAAS,cAAc,CAAQ,CAAA,QACrD,SACH,CAAA,GACF;AAAA,MAEC,UAAW,oBAAA,KAAA,EAAK,UAAO,OAAA,CAAA;AAAA,IAAA,EAAA,CAC1B,EACF,CAAA;AAAA,IAEA,qBAAC,MAAK,EAAA,WAAU,UAAS,KAAK,GAAG,SAAQ,UAAS,OAAM,UAAS,eAAe,GAC9E,UAAA;AAAA,MAAA,oBAAC2B,QAAK,EAAA,MAAM,GACV,UAAA,oBAACiQ,eAAW,CAAA,GACd;AAAA,MAEC,oBAAA,MAAA,EAAK,OAAM,UAAS,KAAK,GACvB,UAAM,MAAA,IAAI,CAAC,MAAM,UAChB,qBAACrQ,YACC,EAAA,UAAA;AAAA,QAAA,oBAACG,gBAAW,OAAK,IAAC,MAAM,GACtB,8BAAC,KAAE,EAAA,MAAM,KAAK,KAAK,QAAO,UAAS,KAAI,uBACpC,UAAA,KAAK,MACR,CAAA,GACF;AAAA,QAEC,QAAQ,MAAM,SAAS,KACtB,oBAACC,UAAK,MAAM,GAAG,OAAK,IAAC,UAErB,SAAA,CAAA;AAAA,MAVW,EAAA,GAAA,KAAK,KAYpB,CACD,GACH;AAAA,IAAA,GACF;AAAA,EACF,EAAA,CAAA;AAEJ;AChFO,SAAS,gBAAgB;AAdhC,MAAAhB;AAeE,QAAM,aAAa,cAAc,GAC3B,EAAC,iBAAiB,uBAAsB,mBAAmB,GAC3D,CAAC,UAAU,IAAI,uBAAuB,UAAU,GAChD,CAAC,uBAAuB,wBAAwB,IAAI;AAAA,KACxD,mDAAiB,SAAQ;AAAA,EAAA,GAErB,oBACJ,WAAW,WAAW,IAClB,WAAW,CAAC,IACZ,WAAW,KAAK,CAAC,cAAc,UAAU,SAAS,qBAAqB,GACvE,kBAAiBA,MAAA,qBAAA,OAAA,SAAA,kBAAmB,SAAnB,OAAA,SAAAA,IAAyB,gBAE1C,aAAa,YAAY,MAAM,yBAAyB,IAAI,GAAG,CAAA,CAAE,GACjE,EAAC,GAAAE,GAAA,IAAK;AAEZ,SAAK,aAED,kBAAkB,oBAEjB,qBAAA,OAAA,EAAM,OAAO,GACX,UAAA;AAAA,IAAW,WAAA,SAAS,KACnB,oBAAC,MACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,MAAMA,GAAE,4CAA4C;AAAA,MAAA;AAAA,IAAA,GAExD;AAAA,IAGF;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QACE,oBAAC,KAAI,EAAA,SAAS,GACZ,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAM,kBAAkB;AAAA,YACxB,OAAO,kBAAkB;AAAA,YACzB,UAAU,qBAAmB,OAAA,SAAA,kBAAA;AAAA,UAAA;AAAA,QAAA,GAEjC;AAAA,QAGF,8BAAC,OAAM,EAAA,SAAS,GAAG,eAAe,GAAG,YAAY,GAC/C,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,WAAW,kBAAkB;AAAA,YAC7B,cACE,OAAO,SAAS,SAAS,WAAW,kBAAkB,QAAQ;AAAA;AAAA;AAAA,cAG1D,GAAG,OAAO,SAAS,QAAQ,GAAG,OAAO,SAAS,MAAM;AAAA,gBACpD,kBAAkB;AAAA,UAAA;AAAA,UAEnB;AAAA,QAAA,GAET;AAAA,MAAA;AAAA,IACF;AAAA,EAAA,EAAA,CACF,IAKF;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAQA,GAAE,wCAAwC;AAAA,MAClD,QACE,oBAAC,OAAM,EAAA,SAAS,GACd,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAG;AAAA,UACH,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAK;AAAA,UACL,KAAI;AAAA,UACJ,MAAK;AAAA,UACL,QAAO;AAAA,UACP,MAAMA,GAAE,iCAAiC;AAAA,QAAA;AAAA,MAAA,GAE7C;AAAA,MAGF,UAAA,oBAAC,OAAM,EAAA,OAAO,GAAG,UAAU,GAAG,UAAU,GACrC,UAAA,WAAW,IAAI,CAAC,cAAc;AAGvB,cAAA,QAFY,WAAW,UAAU,IAAI,EAEnB,gBACpB,cACA,UAAU,KAAK,iBACb,eACA;AAaJ,eAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,IAAG;AAAA,YACH,QAAQ;AAAA,YAER,SAAS;AAAA,YAET,SAjB0B,MAAM;AAC9B,wBAAU,eAAe,UAAU,SAAS,gBAAgB,QAC9D,mBAAmB,UAAU,IAAI,GAG/B,UAAU,gBACZ,yBAAyB,UAAU,IAAI;AAAA,YAE3C;AAAA,YAWI,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,MAAM,aAAW,OAAA,SAAA,UAAA;AAAA,gBACjB,WAAW;AAAA,gBACX;AAAA,gBACA,UAAU,aAAW,OAAA,SAAA,UAAA;AAAA,gBACrB,QAAO,aAAW,OAAA,SAAA,UAAA,UAAS,UAAU;AAAA,cAAA;AAAA,YACvC;AAAA,UAAA;AAAA,UAXK,UAAU;AAAA,QAAA;AAAA,MAcpB,CAAA,GACH;AAAA,IAAA;AAAA,EAAA,IAtGoB,oBAAC,cAAa,EAAA,UAAQ,GAAC,CAAA;AAyGjD;ACpHA,MAAMgR,eAAa,OAAO,IAAI;AAAA;AAAA;AAAA,GAKxB,gBAA4C;AAAA,EAChD,eAAe;AAAA,EACf,oBAAoB,CAAC,cAAc,QAAQ;AAAA,EAC3C,WAAW;AACb;AAEO,SAAS,sBAAsB;AAC9B,QAAA,aAAa,iBACb,EAAC,iBAAiB,uBAAsB,mBAAmB,GAC3D,CAAC,UAAU,IAAI,uBAAuB,UAAU,GAChD,EAAC,YAAW,IAAI,aAChB,EAAC,GAAAhR,OAAK;AAIR,MAAA,EAFuB,WAAW,SAAS;AAGtC,WAAA;AAGT,QAAM,WAAW,CAAC;AAGhB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QACG,oBAAA,MAAA,EACC,UAAC,oBAAA,SAAA,EAAQ,SAASA,GAAE,qCAAqC,GAAG,UAAoB,QAAM,IACpF,UAAA,oBAACiR,YAAS,UAAoB,MAAK,SAAQ,SAAS,GAAG,OAAM,QAC3D,UAAA,qBAAC,MAAK,EAAA,OAAM,UAAS,KAAK,GACxB,UAAA;AAAA,QAAC,oBAAA,KAAA,EACC,UAAC,oBAAAnQ,QAAA,EAAK,MAAM,GAAG,cAAa,YAAW,QAAO,UAC3C,UAAgB,gBAAA,MACnB,CAAA,GACF;AAAA,4BACCA,QAAK,EAAA,MAAM,GACV,UAAA,oBAAC,kBAAgB,CAAA,GACnB;AAAA,MAAA,GACF,EAAA,CACF,EACF,CAAA,GACF;AAAA,MAEF,IAAG;AAAA,MACH,MACE,CAAC,YAAY,iCACVkQ,cACE,EAAA,UAAA,WAAW,IAAI,CAAC,cAAc;AAI7B,cAAM,QAHY,WAAW,UAAU,IAAI,EAGnB,gBACpB,cACA,UAAU,KAAK,iBACb,eACA,aAEA,wBAAwB,MAAM;AAC9B,oBAAU,eAAe,UAAU,SAAS,gBAAgB,QAC9D,mBAAmB,UAAU,IAAI,GAI/B,UAAU,gBACZ,YAAY,EAAC,MAAM,UAAU,UAAS;AAAA,QAGpC,GAAA,aAAa,UAAU,SAAS,gBAAgB;AAEpD,eAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,WAAW,aAAa,KAAK;AAAA,YAC7B,WAAW,aAAa,gBAAgB;AAAA,YAGxC,SAAS;AAAA,YACT,SAAS;AAAA,YACT,SAAU,oBAAA,sBAAA,EAAqB,MAAM,UAAU,MAAM,MAAK,SAAQ;AAAA,YAClE,UAAU;AAAA,YACV,qBAAqB,UAAU;AAAA,YAC/B,kBAAkB;AAAA,YAClB,OAAM,aAAW,OAAA,SAAA,UAAA,UAAS,UAAU;AAAA,UAAA;AAAA,UAR/B,UAAU;AAAA,QAAA;AAAA,MASjB,CAEH,GACH,IACE;AAAA,MAEN,SAAS;AAAA,IAAA;AAAA,EAAA;AAGf;AC5GO,SAAS,qBAAqB;AACnC,SACG,oBAAA,MAAA,EAAK,QAAO,QAAO,UAAS,QAAO,UAAU,GAC5C,UAAC,oBAAA,MAAA,EAAK,QAAO,QAAO,WAAU,UAAS,OAAM,UAAS,SAAQ,UAAS,YAAY,GACjF,UAAC,oBAAA9D,aAAA,EAAU,OAAO,GAChB,UAAC,oBAAA,eAAA,CAAc,CAAA,GACjB,EAAA,CACF,EACF,CAAA;AAEJ;ACdO,SAAS,qBAAqB;AAGnC,yCAAS,UAAoC,uCAAA,CAAA;AAiC/C;ACxBO,MAAM,oBAAoB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWjC,SAAS,sBAAsB/N,QAAmC;AACjE,QAAA,EAAC,cAAaA,QAEd,SAAS,OAAO,SAAS,QACzB,UAAU,QAAQ,MAAM;AAC5B,UAAM,MAAM,IAAI,IAAI,oCAAoC,SAAS,MAAM;AACvE,WAAA,IAAI,aAAa,IAAI,QAAQ,KAAK,GAClC,IAAI,aAAa,IAAI,UAAU,MAAM,GACrC,IAAI,aAAa,IAAI,eAAe,EAAE,GAE/B,IAAI;EAAS,GACnB,CAAC,QAAQ,SAAS,CAAC;AAEtB,SAAA,UAAU,MAAM;AACd,UAAM,cAAc,MAAM;AACxB,aAAO,SAAS;IAAO;AAEzB,WAAA,OAAO,iBAAiB,SAAS,WAAW,GACrC,MAAM;AACJ,aAAA,oBAAoB,SAAS,WAAW;AAAA,IAAA;AAAA,EACjD,GACC,CAAA,CAAE,GAGF,oBAAA,MAAA,EAAK,QAAO,QACX,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,IAAG;AAAA,MACH,QAAO;AAAA,MACP,OAAO;AAAA,MACP,QAAQ;AAAA,QACN,eAAe;AAAA,UACb,MAAM;AAAA,UACN,WAAW;AAAA,UACX,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,QAAQ;AAAA,UACR,KAAK;AAAA,UACL,MAAM;AAAA,QACR;AAAA,MACF;AAAA,MAEA,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,qBAAC2B,QAAK,EAAA,UAAA;AAAA,UAAA;AAAA,UACgC,oBAAC,OAAE,UAAsC,yCAAA,CAAA;AAAA,UAAI;AAAA,QAAA,GAEnF;AAAA,QAGC,oBAAA,mBAAA,EAAkB,eAAY,QAAO,UAAoB,wBAAA;AAAA,QACzD,oBAAA4J,aAAA,EAAU,OAAO,QAAQ,UAAQ,IAAC;AAAA,MAAA,GACrC;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACpEO,SAAS,yBAAyB;AACvC,QAAM,CAAC,aAAa,cAAc,IAAI,SAA6B,IAAI,GACjE,CAAC,OAAO,WAAW,IAAI,SAAkB,IAAI;AAE/C,MAAA;AAAa,UAAA;AAEjB,QAAM,EAAC,gBAAe,IAAI,mBAEpB,GAAA,eAAe,YAAY,MAAM;AAjBzC,QAAA5K,KAAA;AAkBI,KAAA,MAAAA,MAAA,gBAAgB,MAAK,WAArB,QAAA,GAAA,KAAAA,GAAA;AAAA,EAAA,GACC,CAAC,eAAe,CAAC;AAEpB,YAAU,MAAM;AACd,UAAM,eAAe,gBAAgB,KAAK,MAAM,UAAU;AAAA,MACxD,MAAM,CAAC,EAAC,aAAa,WAAU;AAC7B,uBAAe,IAAI;AAAA,MACrB;AAAA,MACA,OAAO;AAAA,IAAA,CACR;AAED,WAAO,MAAM;AACX,mBAAa,YAAY;AAAA,IAAA;AAAA,EAC3B,GACC,CAAC,eAAe,CAAC;AAEd,QAAA,gBAAgB,iBAAiB,eAAa,OAAA,SAAA,YAAA,QAAQ,GACtD,eAAe,gBAAgB,YAAY,aAAa,KAAK;AAGjE,SAAA,oBAAC,MAAK,EAAA,QAAO,QACX,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,IAAG;AAAA,MACH,QAAO;AAAA,MACP,OAAO;AAAA,MACP,QAAQ;AAAA,QACN,eAAe;AAAA,UACb,MAAM;AAAA,UACN,SAAS;AAAA,UACT,MAAM;AAAA,QACR;AAAA,MACF;AAAA,MAEA,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,QAAA,oBAACgB,UAAK,UAGN,0HAAA,CAAA;AAAA,6BAECA,QAAK,EAAA,UAAA;AAAA,UAAA;AAAA,UAE2B;AAAA,+BAC9B,UACE,EAAA,UAAA;AAAA,YAAa,eAAA,OAAA,SAAA,YAAA;AAAA,YAAK;AAAA,YAAG,eAAa,OAAA,SAAA,YAAA;AAAA,YAAM;AAAA,UAAA,GAC3C;AAAA,UACC;AAAA,UAAa;AAAA,QAAA,GAChB;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAEJ,EAAA,CAAA;AAEJ;AChEO,SAAS,eAAe3B,QAAmD;AAE9E,SAAA,oBAAC,QAAK,QAAO,QAAO,QAAO,UAAS,MAAK,WAAU,SAAQ,QACzD,UAAA,oBAAC,QAAK,WAAU,OAAM,SAAQ,UAAS,MAAM,GAAG,OAAM,UACpD,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,IAAC,oBAAA,SAAA,EAAQ,IAAG,MAAK,UAAmB,uBAAA;AAAA,wBACnC,QACC,EAAA,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAK;AAAA,QACL,SAASA,OAAM;AAAA,QACf,MAAK;AAAA,MAAA;AAAA,IAAA,GAET;AAAA,EAAA,GACF,GACF,EACF,CAAA;AAEJ;ACpBO,SAAS,WAAW,MAAmC;AACrD,SAAA,KACJ,IAAI,CAAC,YACA,QAAQ,SAAS,SACZ,GAAG,QAAQ,QAAQ,WAAW,IAAI,QAAQ,IAAI,MAGnD,QAAQ,SAAS,aACZ,QAAQ,OAGV,IACR,EACA,OAAO,OAAO,EACd,KAAK,KAAK;AACf;ACbO,SAAS,eAAe,QAAgB;AAE7C,QAAM,gBAAgB,OAAO,aAEvB,qBAAqB,iBAAe,OAAA,SAAA,cAAA;AAAA,IAAO,CAACkF,WAChDA,OAAM,SAAS,KAAK,CAAC,YAAY,QAAQ,aAAa,SAAS;AAAA,EAAA;AAEjE,GAAI,sBAAoB,OAAA,SAAA,mBAAA,YAAW,MAGnC,QAAQ,eAAe,2BAAiB,sBAAoB,OAAA,SAAA,mBAAA,MAAM,WAAW,GAC7E,sBAAoB,QAAA,mBAAA,QAAQ,CAACA,WAAU;AAC/B,UAAA,OAAO,WAAWA,OAAM,IAAI;AAE1B,YAAA,MAAM,QAAQ,IAAI,IAAI,gBAAgB,GAE9CA,OAAM,SAAS,QAAQ,CAAC,YAAY;AAC1B,cAAA,IAAI,QAAQ,OAAO;AAAA,IAAA,CAC5B,GAED,QAAQ;EAAS,CACnB,GACA,QAAQ,SAAS;AAEnB;ACjBA,MAAM,QAAwD;AAAA,EAC5D,OAAO;AAAA,EACP,SAAS;AACX,GAEM,cAAc,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,GAOrB,mBAAmB,OAAOvD,MAAI;AAAA;AAAA;AAI7B,SAAS,oBAAoB3B,QAAwD;AACpF,QAAA,EAAC,cAAa,IAAIA;AACZ,iBAAe;AAErB,QAAA,QAAQ,QAAQ,MAAM;AAC1B,UAAM,MAAM,CAAA;AAEZ,eAAW,gBAAgB;AACzB,iBAAW,WAAW,aAAa;AACjC,YAAI,KAAK,EAAC,OAAO,cAAc,QAAQ,CAAA;AAIpC,WAAA;AAAA,EAAA,GACN,CAAC,aAAa,CAAC;AAElB,SACG,oBAAA,OAAA,EAAM,IAAG,MAAK,OAAO,GACnB,UAAM,MAAA,IAAI,CAAC,EAAC,OAAAkF,QAAO,QAAA,GAAU,MAAM;AAC5B,UAAAuF,WAAU,QAAQ,aAAa,SAC/B,YAAY,QAAQ,aAAa,WACjC,aAAa,YAAYvF,MAAK;AACpC,WACG,qBAAA,MAAA,EAAK,QAAM,IAAS,SAAS,GAAG,QAAQ,GAAG,MAAM,MAAM,QAAQ,QAAQ,GACtE,UAAA;AAAA,MAAA,qBAAC,MACC,EAAA,UAAA;AAAA,QAAC,oBAAA,KAAA,EAAI,aAAa,GAChB,UAAA,qBAACvD,UAAK,OAAK,IAAC,MAAM,GACf,UAAA;AAAA,UAAA8I,gCAAY,kBAAiB,EAAA;AAAA,UAC7B,iCAAc,oBAAmB,EAAA;AAAA,QAAA,EAAA,CACpC,EACF,CAAA;AAAA,QAEA,oBAAC,KAAI,EAAA,MAAM,GACT,UAAA,oBAAC9I,QAAK,EAAA,MAAM,GAAG,QAAO,UACnB,UAAA,aAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,UAAA,WAAW,WAAW,IAAI;AAAA,UAAE;AAAA,UAAQ,WAAW;AAAA,UAAK;AAAA,QAAA,GACvD,IACE,KACN,CAAA,GACF;AAAA,MAAA,GACF;AAAA,MACC,oBAAA,KAAA,EAAI,WAAW,GACd,UAAC,oBAAA,MAAA,EAAK,QAAM,IAAC,UAAS,QAAO,SAAS,GAAG,MAAK,WAC5C,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,WACG,oBAAAA,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,UAErB,UAAA;AAAA,UAGD,UAAMuD,OAAA,KAAK,IAAI,CAAC,SAAS,MAAM;AAC1B,gBAAA,QAAQ,SAAS,QAAQ;AAC3B,oBAAM,OAAO,GAAG;AAAA,gBACd,QAAQ,QAAQ,cAAc,QAAQ,IAAI;AAAA,cAC3C,CAAA,IAAI,QAAQ,IAAI;AACjB,qBACG,oBAAAvD,QAAA,EAAK,OAAO,MAAc,MAAM,GAAG,cAAa,YAC/C,UAAC,oBAAA,aAAA,EAAa,UAAK,MAAA,EAAA,GADG,CAExB;AAAA,YAEJ;AAEA,mBAAI,QAAQ,SAAS,iCAEhBA,QAAK,EAAA,OAAO,QAAQ,MAAc,MAAM,GAAG,cAAa,YACvD,UAAC,oBAAA,aAAA,EAAa,kBAAQ,MAAK,EAAA,GADG,CAEhC,IAIG;AAAA,UAAA,CACR;AAAA,QAAA;AAAA,SAEL,EACF,CAAA;AAAA,MAEC,oBAAA,KAAA,EAAI,IAAG,MAAK,WAAW,GACtB,UAAC,oBAAA,KAAA,EAAI,IAAG,MACN,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,QAAA,oBAAC,oBAAiB,OAAK,IAAC,MAAM,GAC3B,kBAAQ,SACX;AAAA,QAEC,QAAQ,UACP,oBAACA,UAAK,OAAK,IAAC,MAAM,GAChB,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAM,gBAAgB,QAAQ,MAAM;AAAA,YACpC,QAAO;AAAA,YACP,KAAI;AAAA,YACL,UAAA;AAAA,UAAA;AAAA,QAAA,GAGH;AAAA,MAAA,EAEJ,CAAA,EACF,CAAA,GACF;AAAA,IAAA,EAAA,GA1EgB,CA2ElB;AAAA,EAEH,CAAA,EACH,CAAA;AAEJ;AAEA,SAAS,YAAY,SAA4E;AAGzF,QAAA0N,SAAQ,QAAQ,KAAK,CAAC;AAC5B,SAAIA,OAAM,SAAS,SACV,EAAC,MAAMA,OAAM,QAAQ,cAAcA,OAAM,IAAI,KAAK,MAAMA,OAAM,KAEhE,IAAA;AACT;AAEA,SAAS,mBAAmB,KAAa;AACvC,SAAI,OAAK,QAAA,IAAA,WAAW,uBAGX,IAAA,IAFO,IAAI,MAAM,GAAG,EAAE,EAAE,MAAM,GAAG,EAEvB,CAAC,CAAC,MAGd;AACT;AC1IgB,SAAA,mBAAmB,EAAC,UAAkC;AAZtE,MAAA1O;AAaQ,QAAA,qBACJA,MAAO,OAAA,gBAAP,OAAoB,SAAAA,IAAA;AAAA,IAAO,CAACuE,WAC1BA,OAAM,SAAS,KAAK,CAAC,YAAY,QAAQ,aAAa,OAAO;AAAA,EAAA,MAC1D;AAEP,SAAA,UAAU,MAAM,eAAe,MAAM,GAAG,CAAC,MAAM,CAAC,GAG9C,oBAAC,MAAK,EAAA,QAAO,QAAO,UAAS,QAAO,UAAU,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,UAAU,GAAG,QAAO,UAC9E,UAAC,oBAAA6I,aAAA,EAAU,OAAO,GAChB,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,IAAC,oBAAA,SAAA,EAAQ,IAAG,MAAK,UAAa,iBAAA;AAAA,IAC9B,oBAAC,qBAAoB,EAAA,eAAe,iBAAkB,CAAA;AAAA,EAAA,GACxD,GACF,EACF,CAAA;AAEJ;ACbO,SAAS,oBAAoB;AAAA,EAClC;AAAA,EACA,UAAU;AACZ,GAA6B;AAC3B,QAAM,CAAC,EAAC,SAAQ,QAAQ,IAAI,SAA2B,EAAC,OAAO,KAAK,CAAA,GAE9D,UAAUxN,WAAS,KAAK,KAAK,OAAO,MAAM,WAAY,YAAY,MAAM,SACxE,QAAQA,WAAS,KAAK,KAAK,OAAO,MAAM,SAAU,YAAY,MAAM,OAEpE,mBAAmB,YAAY,MAAM,SAAS,EAAC,OAAO,KAAA,CAAK,GAAG,CAAC,QAAQ,CAAC;AAI9E,SAFA,mBAAmB,gBAAgB,GAE/B,iBAAiB,kBACZ,oBAAC,yBAAsB,WAAW,SAAA,OAAA,SAAA,MAAO,WAAW,IAGzD,iBAAiB,cACX,oBAAA,oBAAA,EAAmB,QAAQ,MAAM,QAAQ,IAG9C,QAKH;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAO;AAAA,MACP,UAAS;AAAA,MACT,UAAU,CAAC,GAAG,GAAG,GAAG,CAAC;AAAA,MACrB,UAAU;AAAA,MACV,QAAO;AAAA,MACP,MAAK;AAAA,MAEL,8BAACwN,aAAU,EAAA,OAAO,GAChB,UAAC,qBAAA,OAAA,EAAM,OAAO,GAGZ,UAAA;AAAA,QAAA,oBAAC,WAAS,UAAQ,QAAA,CAAA;AAAA,QAElB,oBAAC,OACC,EAAA,UAAA,oBAAC,QAAO,EAAA,SAAS,kBAAkB,MAAK,SAAQ,MAAK,UAAA,CAAU,EACjE,CAAA;AAAA,QAEC,oBAAA,MAAA,EAAK,QAAM,IAAC,QAAQ,GAAG,UAAS,QAAO,SAAS,GAAG,MAAK,WACvD,UAAC,qBAAA,OAAA,EAAM,OAAO,GACX,UAAA;AAAA,UAAA,WACE,oBAAA,MAAA,EAAK,MAAM,GACV,+BAAC,UAAO,EAAA,UAAA;AAAA,YAAA;AAAA,YAAQ;AAAA,UAAA,EAAA,CAAQ,EAC1B,CAAA;AAAA,UAED,SAAS,oBAAC,MAAK,EAAA,MAAM,GAAI,UAAM,OAAA;AAAA,QAAA,EAAA,CAClC,EACF,CAAA;AAAA,MAAA,EAAA,CACF,EACF,CAAA;AAAA,IAAA;AAAA,EAAA,IAjCK,oBAAC,eAAc,EAAA,SAAS,UAAW,SAAS,CAAA;AAoCvD;ACxDA,MAAM,6BAA6B,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAqBjC,gBAAgB,cAAkC;AAAA,EAC7D,8BAA8B,MAAM;AAAA,EACpC,oBAAoB,MAAM;AAAA,EAC1B,sBAAsB;AAAA,EACtB,0BAA0B;AAAA,EAC1B,YAAY;AACd,CAAC;AAuBM,SAAS,eAAe;AAG7B,QAAMhJ,UAAS;AAEf,6BAAQA,SAAO,CAAA,CAAA;AACjB;AAMO,SAAS,wBAAwB;AAjFxC,MAAApE;AAkFQ,QAAA,EAAC,MAAM,OAAO,MAAK,IAAI,aACvB,GAAA,SAAS,aACT,iBAAiB;AAAA,IACrB;AAAA,MACE,CAAC,gBAAiB,OAAO,YAAY,QAAS,WAAW,YAAY,OAAO;AAAA,MAC5E,CAAC;AAAA,IACH;AAAA,KAEI,aAAa;AAAA,IACjB,MAAM,MAAM,KAAK,CAAC,SAAS,KAAK,SAAS,cAAc;AAAA,IACvD,CAAC,gBAAgB,KAAK;AAAA,EAAA,GAElB,CAAC,sBAAsB,uBAAuB,IAAI,SAAkB,EAAK,GACzE,CAAC,0BAA0B,2BAA2B,IAAI;AAAA,IAC9D;AAAA,EAAA,GAEI,CAAC,YAAY,aAAa,IAAI,SAAkB,EAAK,GAErD,gBAAgB,QAAQ,MAAM;AAC5B,UAAA,YAAY,SAAS,UAAU,IAAI;AAEzC,WAAI,iBACK,GAAG,UAAU,cAAc,CAAC,MAAM,SAAS,KAG7C;AAAA,EACT,GAAG,CAAC,gBAAgB,MAAM,KAAK,CAAC,GAC1B,4BAA4B,CAAC,EAAC,cAAY,QAAA,WAAA;AAEhD,YAAU,MAAM;AACV,kCAGJ,SAAS,QAAQ;AAAA,EAAA,GAChB,CAAC,eAAe,yBAAyB,CAAC;AAEvC,QAAA,mCAAmC,YAAY,CAAC,SAAkB;AACtE,4BAAwB,IAAI;AAAA,KAC3B,CAAE,CAAA,GAEC,yBAAyB,YAAY,CAAC,SAAkB;AAC5D,kBAAc,IAAI;AAAA,EAAA,GACjB,CAAE,CAAA,GAEC,qBAAqB;AAAA,IACzB,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA,8BAA8B;AAAA,MAC9B,oBAAoB;AAAA,IAAA;AAAA,IAEtB;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EAGI,GAAA,SAAS,mBAAmB,GAC5B,mBAAmB,6BAAA,GAKnB,uBACJ,CAAC,eACA,mBAAmB,UAAU,CAAC,mBAC/B,OAAO,SAAW,OAClB,eAAe,KAAK,OAAO,SAAS,QAAQ,KAC5C,MAAM,KAAK,CAAC,SAAS,KAAK,SAAS,WAAW;AAEhD,SAAA,UAAU,MAAM;AACT,4BAIL,OAAO,YAAY;AAAA,MACjB,MAAM,OAAO,SAAS,SAAS,QAAQ,UAAU,YAAY;AAAA,MAC7D,SAAS;AAAA,IAAA,CACV;AAAA,EAAA,GACA,CAAC,sBAAsB,MAAM,CAAC,GAG/B,qBAAC,MAAK,EAAA,WAAQ,cAAa,WAAU,UAAS,QAAO,QAAO,eAAY,iBACtE,UAAA;AAAA,IAAA,oBAAC,cAAc,UAAd,EAAuB,OAAO,oBAC7B,UAAA,oBAAC,SAAO,CAAA,GACV;AAAA,IACC,4CAAyB,mBAAkB,EAAA;AAAA,IAC3C,MAAM,WAAW,KAAK,oBAAC,eAAc,CAAA,CAAA;AAAA,IACrC,MAAM,SAAS,KAAK,CAAC,cAAc,kBAAkB,CAAC,wBACrD,oBAAC,oBAAmB,EAAA,UAAU,eAAgB,CAAA;AAAA,IAE/C,wBACE,oBAAA,4BAAA,EAA2B,KAAK,6BAA6B,UAAS,QAAO;AAAA,IAI/E,oBAAA,qBAAA,EAA2C,SAAS,OAAO,yCAAY,IAAI,iBAC1E,UAAC,oBAAA,MAAA,EAAK,MAAM,GAAG,QAAQ,sBACpB,wBAAc,kBACb;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAO;AAAA,QACP,qCACEA,MAAW,WAAA,WAAX,OAAmB,SAAAA,IAAA;AAAA,QAGrB,UAAA,oBAAC,UAAS,EAAA,UAAW,oBAAA,cAAA,EAAa,UAAQ,GAAC,CAAA,GACzC,UAAA,oBAAC,kBAAiB,EAAA,WAAwB,CAAA,GAC5C;AAAA,MAAA;AAAA,IAAA,EAGN,CAAA,EAdwB,GAAA,cAAA,OAAA,SAAA,WAAY,IAetC;AAAA,EACF,EAAA,CAAA;AAEJ;AC7LO,SAAS,sBACd,QACqD;AAbvD,MAAAA,KAAA;AAcE,UAAO,MAAOA,MAAA,OAAA,WAAP,OAAe,SAAAA,IAAA,eAAf,OAA2B,SAAA,GAAA;AACpC;AAEO,SAAS,oBACd,QACmD;AAnBrD,MAAAA,KAAA;AAoBE,UAAO,MAAOA,MAAA,OAAA,WAAP,OAAe,SAAAA,IAAA,eAAf,OAA2B,SAAA,GAAA;AACpC;AAEO,SAAS,oBACd,QACmD;AAzBrD,MAAAA,KAAA;AA0BE,UAAO,MAAOA,MAAA,OAAA,WAAP,OAAe,SAAAA,IAAA,eAAf,OAA2B,SAAA,GAAA;AACpC;AAQO,SAAS,8BACd,QAC6D;AArC/D,MAAAA,KAAA;AAsCE,UAAO,MAAOA,MAAA,OAAA,WAAP,OAAe,SAAAA,IAAA,eAAf,OAA2B,SAAA,GAAA;AAGpC;ACjBO,SAAS,uBAA4E;AAC1F,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AAKO,SAAS,qBAAwE;AACtF,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AAgBO,SAAS,qBAAwE;AACtF,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AACH;AAKO,SAAS,+BAEd;AACA,SAAO,wBAAwB;AAAA,IAC7B,kBAAkB;AAAA,IAGlB,MAAM;AAAA,EAAA,CACP;AACH;AC9DO,SAAS,qBAAqB;AAZrC,MAAAA;AAcE,QAAM,uBACJA,MAFa,UAAU,EAEhB,gBAAP,OAAoB,SAAAA,IAAA;AAAA,IAAO,CAACuE,WAC1BA,OAAM,SAAS,KAAK,CAAC,YAAY,QAAQ,aAAa,SAAS;AAAA,EAAA,MAC5D,CAAA,GAGD,EAAC,WAAU,kBACX,EAAC,GAAArE,GAAK,IAAA,eAAA,GAEN,WAAW,SAEX,CAAC,cAAc,aAAa,IAAI,SAAS,EAAK,GAC9C,CAAC,eAAe,gBAAgB,IAAI,SAAmC,IAAI,GAC3E,aAAa,YAAY,MAAM,cAAc,EAAI,GAAG,CAAE,CAAA,GAEtD,cAAc,YAAY,MAAM;AACpC,kBAAc,EAAK,GAEf,iBACF,cAAc,MAAM;AAAA,EAAA,GAErB,CAAC,aAAa,CAAC;AAElB,SAAI,mBAAmB,WAAW,IACzB,OAKL,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM;AAAA,QACN,MAAK;AAAA,QACL,SAAS;AAAA,QACT,KAAK;AAAA,QACL,UAAU;AAAA,QACV,MAAK;AAAA,QACL,cAAc,EAAC,QAAQ,SAASA,GAAE,qCAAqC,EAAC;AAAA,MAAA;AAAA,IAC1E;AAAA,IAEC,gBACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAO;AAAA,QACP,OAAO;AAAA,QACP,gBAAgB;AAAA,QAChB,SAAS;AAAA,QAET;AAAA,QACA,IAAI;AAAA,QAEJ,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAC,qBAAA,OAAA,EAAM,OAAO,GACZ,UAAA;AAAA,YAAA,qBAACc,UAAK,IAAG,MAAK,MAAM,GAAG,QAAO,UAAS,UAAA;AAAA,cAAA;AAAA,cAC9B,mBAAmB;AAAA,cAAO;AAAA,YAAA,GACnC;AAAA,YAAQ;AAAA,gCACPA,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,UAGrB,2GAAA;AAAA,UAAA,GACF;AAAA,UACA,oBAAC,qBAAoB,EAAA,eAAe,mBAAoB,CAAA;AAAA,QAAA,GAC1D;AAAA,MAAA;AAAA,IACF;AAAA,EAEJ,EAAA,CAAA;AAEJ;AC9DO,MAAM,oBAAoB,YAAmC;AAAA,EAClE,MAAM;AAAA,EACN,SAAS;AAAA,EACT,aAAa;AACf,CAAC,GAMY,uBAAuB,YAAsC;AAAA,EACxE,MAAM;AAAA,EACN,SAAS;AAAA,EACT,aAAa;AACf,CAAC,GAMY,wBAAwB,YAAuC;AAAA,EAC1E,MAAM;AAAA,EACN,SAAS;AAAA,EACT,aAAa;AACf,CAAC;AAEM,SAAS,cAAc;AAAA,EAC5B;AAAA,EACA;AACF,GAGe;AAGT,SAAA,cAAc,SAAS,YAAA,MAAkB,yBAA+B,iBACxE,cAAc,SAAS,YAAY,MAAM,yBAA+B,oBACxE,cAAc,SAAS,YAAA,MAAkB,+BAAqC,eAC9E,CAAC,cAAc,SAAS,YAAkB,MAAA,wBAA8B,cACrE;AACT;AC1CO,MAAM,qBAAqB,YAAoC;AAAA,EACpE,MAAM;AAAA,EACN,SAAS;AAAA,EACT,aAAa;AACf,CAAC,GAKY,wBAAwB,YAAqC;AAAA,EACxE,MAAM;AAAA,EACN,SAAS;AAAA,EACT,aAAa;AACf,CAAC,GAKY,gCAAgC,YAAqC;AAAA,EAChF,MAAM;AAAA,EACN,SAAS;AAAA,EACT,aAAa;AACf,CAAC,GAKY,kCAAkC,YAAqC;AAAA,EAClF,MAAM;AAAA,EACN,SAAS;AAAA,EACT,aAAa;AACf,CAAC,GCvCK,kBAMF;AAAA,EACF,YAAY,CAAC,OAAO,KAAK,UAAU;AAdrC,QAAAhB,KAAA,IAAA,IAAA;AAeQ,QAAA,CAAC,wBAAwB,KAAK;AAAU,aAAA;AAC5C,UAAM,cAAc,CAAA,IAClBA,MAAM,MAAA,SAAS,MAAM,CAAC,MAAtB,OAAyB,SAAAA,IAAA,WAAU,WAAU,KAAA,MAAM,SAAS,MAAM,CAAC,MAAtB,QAAA,GAAyB,OAElE,eAAe,CACnB,IAAA,KAAA,MAAM,SAAS,MAAM,CAAC,MAAtB,OAAA,SAAA,GAAyB,WAAU,WAAU,KAAM,MAAA,SAAS,MAAM,CAAC,MAAtB,QAAyB,GAAA;AAEjE,WAAA;AAAA,MACL,GAAG;AAAA,MACH;AAAA,MACA;AAAA,IAAA;AAAA,EAEJ;AACF,GAEa,kBAAkB,CAAC,WACvB,OAAO,IAAI,CAAC,UAAU;AAC3B,MAAI,wBAAwB,KAAK,KAAK,MAAM,UAAU,SAAS;AAC7D,UAAM,WAAW,MAAM,SAAS,IAAI,CAAC,OAAO,QACtC,gBAAgB,MAAM,KAAK,IACtB,gBAAgB,MAAM,KAAK,EAAE,OAAO,KAAK,KAAK,IAEhD,KACR;AAEM,WAAA;AAAA,MACL,GAAG;AAAA,MACH;AAAA,IAAA;AAAA,EAEJ;AACO,SAAA;AACT,CAAC,GCjCG,UAAU,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA,GAMpB,sBAAsB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAW7B,oBAAoB,OAAOgB,MAAI,EAAE,CAAC3B,WAClCA,OAAM,SACD;AAAA;AAAA,QAIF,EACR,GAEK,aAAa,OAAO;AAAA;AAAA;AAAA,GAKpB,eAAe,OAAO,KAAK,CAAC,EAAC,YAAW;AAC5C,QAAM,EAAC,QAAA,IAAW,MAAM,OAAO,MAAM;AAE9B,SAAA;AAAA,mBACU,QAAQ,QAAQ;AAAA;AAEnC,CAAC,GAMK,aAAa,OAAO,IAAI;AAAA;AAAA;AAAA,mBAGX,CAACA,WAAWA,OAAM,eAAe,MAAM,EAAG;AAAA,oBACzC,CAACA,WAAWA,OAAM,gBAAgB,MAAM,EAAG;AAAA;AAAA,GAIzD,OAAO,OAAO;AAAA;AAAA,WAET,CAACA,WAAWA,OAAM,eAAe,0CAA0C,EAAG;AAAA,GAGnF,uBAAuB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAW9B,oBAAoB,CAAC,aAAwB,oBAAC,cAAY,UAAS,GAEnE,cAAc,CAACA,WAAiC;AACpD,QAAM,CAAC,KAAK,MAAM,IAAI,SAAiC,IAAI;AAC3D,SAAA,UAAU,MAAM;AACd,QAAI,CAAC;AAAK;AAEV,UAAM,aAAa,IAAI,gBAAgB,GACjC,SAAS,WAAW;AAEpB,WAAA,MAAAA,OAAM,KAAK,KAAK,EAAC,QAAO,EAC3B,KAAK,CAAC,aAAa;AAClB,UAAI,CAAC,SAAS;AACZ,cAAM,IAAI,MAAM,uBAAuB,SAAS,MAAM,EAAE;AAE1D,aAAO,SAAS;IAAK,CACtB,EACA,KAAK,CAAC,SAAS;AACT,cACL,IAAI,YAAY;AAAA,IAAA,CACjB,EACA,MAAM,CAAC,UAAU;AACZ,YAAM,SAAS,gBACjB,QAAQ,MAAM,KAAK;AAAA,IAEtB,CAAA,GAGI,MAAM;AACX,iBAAW,MAAM;AAAA,IAAA;AAAA,EAErB,GAAG,CAAC,KAAKA,OAAM,KAAK,GAAG,CAAC,GAEjB,oBAAC,sBAAqB,EAAA,KAAK,OAAQ,CAAA;AAC5C;AAEA,SAAS,YAAYA,QAA8B;AAC3C,QAAA,EAAC,SAAY,IAAAA;AAEnB,SACG,oBAAA,KAAA,EAAI,UAAU,GAAG,cAAc,GAC9B,UAAC,oBAAA2B,QAAA,EAAK,MAAM,GAAG,OAAK,IACjB,UACH,EACF,CAAA;AAEJ;AAEA,SAAS,aAAa3B,QAA8B;AAC5C,QAAA,EAAC,SAAY,IAAAA;AACnB,SACG,oBAAA,KAAA,EAAI,UAAU,GAAG,SAAS,GACzB,UAAC,oBAAA,SAAA,EAAQ,MAAM,GAAG,IAAG,MAClB,UACH,EACF,CAAA;AAEJ;AAEA,MAAM,aAAqC;AAAA,EACzC,OAAO;AAAA,IACL,QAAQ,CAAC,EAAC,SAAc,MAAA,oBAAC,eAAa,UAAS;AAAA,IAC/C,IAAI,CAAC,EAAC,SAAc,MAAA,oBAAC,gBAAc,UAAS;AAAA,EAC9C;AAAA,EACA,MAAM;AAAA,IACJ,QAAQ,CAAC,EAAC,SAAA,MAAc;AAAA,IACxB,QAAQ,CAAC,EAAC,SAAQ,sCAAS,UAAS;AAAA,IACpC,YAAY,CAAC,EAAC,SAAQ,sCAAS,UAAS;AAAA,EAC1C;AAAA,EACA,UAAU;AAAA,IACR,QAAQ,CAAC,EAAC,SAAc,MAAA,oBAAC,eAAa,UAAS;AAAA,IAC/C,QAAQ,CAAC,EAAC,SAAc,MAAA,oBAAC,eAAa,UAAS;AAAA,IAC/C,YAAY,CAAC,EAAC,SAAc,MAAA,oBAAC,eAAa,UAAS;AAAA,EACrD;AAAA,EAEA,OAAO;AAAA,IACL,QAAQ,CAAC,EAAC,SAAc,MAAA,oBAAC,YAAQ,UAAS;AAAA,IAC1C,UAAU,CAAC,EAAC,SAAc,MAAA,oBAAC,gBAAc,UAAS;AAAA,IAClD,MAAM,CAACA,WACL;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAMA,OAAM,MAAM;AAAA,QAClB,KAAI;AAAA,QACJ,QAAO;AAAA,QACP,cAAcA,OAAM,MAAM;AAAA,QAEzB,UAAA;AAAA,UAAMA,OAAA;AAAA,UACNA,OAAM,MAAM,YAAY,oBAAC,YAAS,OAAO,EAAC,YAAY,MAAA,GAAQ;AAAA,QAAA;AAAA,MAAA;AAAA,IACjE;AAAA,IAEF,QAAQ,CAACA,WAAW,oBAAA,YAAA,EAAY,iBAAM,UAAS;AAAA,EACjD;AAAA,EACA,OAAO;AAAA,IACL,YAAY,CAACA,WAET,oBAAC,oBAAmB,EAAA,WAAWA,OAAM,MAAM,QAAQ,SAAS,mBACzD,UAAAA,OAAM,MAAM,aACX;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQA,OAAM,MAAM;AAAA,QACpB,cAAcA,OAAM,MAAM;AAAA,QAC1B,eAAeA,OAAM,MAAM;AAAA,MAAA;AAAA,IAAA,IAG5B,oBAAA,aAAA,EAAY,MAAMA,OAAM,MAAM,KAAM,CAAA,GAEzC;AAAA,IAGJ,SAAS,MACN,oBAAA,KAAA,EAAI,SAAS,GACZ,UAAC,oBAAA,KAAA,EAAI,UAAU,GACb,UAAC,oBAAA,SAAA,CAAQ,CAAA,EACX,CAAA,GACF;AAAA,IAEF,aAAa,CAACA,WACX,qBAAA,MAAA,EAAK,OAAM,cAAa,UAAU,GAAG,YAAY,GAAG,eAAe,GAAG,WAAW,GAAG,KAAK,GACxF,UAAA;AAAA,MAAA,qBAAC,QAAK,KAAK,GAAG,OAAO,EAAC,YAAY,EAChC,GAAA,UAAA;AAAA,QAAC,oBAAA,mBAAA,EAAkB,MAAM,GAAG,QAAQA,OAAM,MAAM,QAC7C,UAAMA,OAAA,MAAM,aACX,oBAAC,QAAK,QAAQA,OAAM,MAAM,WAAA,CAAY,IAEtC,oBAAC,eAAY,MAAMA,OAAM,MAAM,KAAA,CAAM,EAEzC,CAAA;AAAA,QACC,oBAAA2B,QAAA,EAAK,MAAM,GAAG,QAAO,YAAW,QAAQ3B,OAAM,MAAM,QAClD,UAAMA,OAAA,MAAM,OACf;AAAA,MAAA,GACF;AAAA,MAEC,oBAAA2B,QAAA,EAAK,MAAM,GAAG,OAAK,IAAC,QAAQ3B,OAAM,MAAM,QACtC,UAAMA,OAAA,MAAM,MACf;AAAA,IAAA,GACF;AAAA,EAEJ;AACF;AAWO,SAAS,4BAA4BA,QAAmC;AACvE,QAAA,QAAQ,QAAQ,MAAM,gBAAgBA,OAAM,MAAM,GAAG,CAACA,OAAM,MAAM,CAAC;AACzE,SACG,oBAAA,MAAA,EAAK,MAAK,WACT,8BAAC,qBACC,EAAA,UAAA;AAAA,IAAC+R;AAAAA,IAAA;AAAA,MACC;AAAA,MACA;AAAA,MAEA,oBAAoB;AAAA,IAAA;AAAA,EAAA,EAExB,CAAA,EACF,CAAA;AAEJ;ACnOA,MAAMC,iBAAe,OAAO,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAe5BrO,UAAQ,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,GAOfsO,iBAAe,OAAO,MAAM;AAAA;AAAA;AAAA;AAAA;AAa3B,SAAS,cAAc;AAAA,EAC5B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAsB;AAtDtB,MAAAtR,KAAA,IAAA,IAAA,IAAA;AAuDE,WAAS,cAAc;AACrB,YAAQ,QAAQ;AAAA,EAClB;AACA,WAAS,qBAAqB;AAC5B,YAAQ,cAAc;AAAA,EACxB;AACA,WAAS,iBAAiB;AACxB,YAAQ,YAAY;AAAA,EACtB;AACA,QAAM,cAAc;AACpB,SAAK,OAEH;AAAA,IAACsR;AAAAA,IAAA;AAAA,MACC,IAAG;AAAA,MACH;AAAA,MACA,gBAAgB;AAAA,MAChB,SAAS;AAAA,MACT,4BAA0B;AAAA,MAC1B,QAAQ;AAAA,MACR,QAAQ;AAAA,QACN,eAActR,MAAA,QAAQ,oBAAR,QAAAA,IAAyB,OACnC;AAAA,UACE,MAAM,QAAQ,gBAAgB;AAAA,UAC9B,MAAM;AAAA,UACN,MAAM;AAAA,UACN,SAAS;AAAA,QAEX,IAAA;AAAA,QACJ,eAAe;AAAA,UACb,OAAM,KAAQ,QAAA,cAAR,OAAmB,SAAA,GAAA;AAAA,UACzB,MAAM;AAAA,UACN,MAAM;AAAA,UACN,KAAI,KAAA,QAAQ,cAAR,OAAA,SAAA,GAAmB,YAAW,YAC9B;AAAA,YACE,MAAM,QAAQ,UAAU;AAAA,YACxB,QAAQ;AAAA,YACR,KAAK;AAAA,YACL,IAAI;AAAA,YACJ,SAAS;AAAA,UAAA,IAEX;AAAA,YACE,WAAS,KAAQ,QAAA,cAAR,OAAmB,SAAA,GAAA,YAAW,aAAa,aAAa;AAAA,UACnE;AAAA,QACN;AAAA,MACF;AAAA,MAEA,UAAA;AAAA,QAAA;AAAA,UAACqR;AAAAA,UAAA;AAAA,YACC,MAAM;AAAA,YACN,MAAK;AAAA,YACL,MAAK;AAAA,YACL,SAAS;AAAA,YACT,UAAU;AAAA,YACV,cAAc;AAAA,UAAA;AAAA,QAChB;AAAA,QACC,QAAQ,SACN,oBAAArO,SAAA,EAAM,KAAK,QAAQ,MAAM,MAAM,KAAK,MAAK,KAAQ,QAAA,MAAM,MAAM,YAApB,YAA+B,IAAI;AAAA,QAE9E,qBAAA,MAAA,EAAK,SAAS,GAAG,WAAW,UAC3B,UAAA;AAAA,UAAC,oBAAA,KAAA,EAAI,UAAU,GAAG,WAAW,GAC3B,UAAC,oBAAA,SAAA,EAAQ,MAAM,GAAI,UAAQ,QAAA,YAAY,CAAA,GACzC;AAAA,UACA,oBAAC,KAAI,EAAA,WAAW,GAAG,eAAe,GAChC,UAAA,oBAAC,6BAA4B,EAAA,QAAQ,QAAQ,gBAAA,CAAiB,EAChE,CAAA;AAAA,QAAA,GACF;AAAA,MAAA;AAAA,IAAA;AAAA,EAtDc,IAAA;AAyDpB;ACjHA,MAAM,iBAAiB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,GAYxB,mBAAmB,CAAC,EAAC,UAAU,gBAA6B;AAC1D,QAAA,WAAW,YAAY,UAEvB,aAAa,KAAK,MAAO,WAAW,YAAa,GAAG,GACpD,SAAS,IACT,kBAAkB,IAAI,KAAK,KAAK,QAChC,mBAAmB,oBAAoB,MAAM,cAAc,MAC3D,cAAc,KACd,OAAO,SAAS,IAAI;AAGxB,SAAA,oBAAC,MACC,EAAA,UAAA,oBAAC,gBACC,EAAA,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,SAAS,OAAO,IAAI,IAAI,IAAI;AAAA,MAC5B,OAAO,EAAC,WAAW,iBAAgB;AAAA,MAEnC,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAG;AAAA,YACH,IAAI,OAAO;AAAA,YACX,IAAI,OAAO;AAAA,YACX,MAAK;AAAA,YACL;AAAA,YACA,QAAQ,aAAa,KAAK,OAAO,GAAK,EAAE,MAAM,OAAO,GAAK,EAAE;AAAA,UAAA;AAAA,QAC9D;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAG;AAAA,YACH,IAAI,OAAO;AAAA,YACX,IAAI,OAAO;AAAA,YACX,MAAK;AAAA,YACL;AAAA,YACA,QAAO;AAAA,YACP;AAAA,YACA,kBAAkB;AAAA,UAAA;AAAA,QACpB;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ,GAMa,wBAAwB,WAAW,SAC9C,EAAC,mBAAmB,UAAU,aAC9B,KACA;AACM,QAAA,EAAC,GAAA9C,OAAKuN;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAK;AAAA,MACL,SAAS;AAAA,MACT;AAAA,MACA,cAAc;AAAA,QACZ,SAAS,WACLvN,GAAE,iCAAiC,EAAC,OAAO,SAAS,CAAA,IACpDA,GAAE,mCAAmC;AAAA,MAC3C;AAAA,MAEA,UAAA;AAAA,QAAA,oBAACc,QAAK,EAAA,MAAM,GACV,UAAA,oBAAC,WAAS,CAAA,GACZ;AAAA,QACC,WAAW,KAAM,oBAAA,kBAAA,EAAiB,UAAoB,WAAsB;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGnF,CAAC,GAEY,yBAAyB,WAAW,SAC/C,EAAC,mBAAmB,YACpB,KACA;AACM,QAAA,EAAC,GAAAd,OAAKuN;AAGV,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,MAAM;AAAA,MACN,SAAQ;AAAA,MACR,MAAK;AAAA,MACL,MAAK;AAAA,MACL,SAAS;AAAA,MACT,MACE,WACIvN,GAAE,+BAA+B,EAAC,OAAO,SAAS,CAAA,IAClDA,GAAE,sCAAsC;AAAA,IAAA;AAAA,EAAA;AAIpD,CAAC,GC/FY,mBAAmB,cAAiD,MAAS,GAK7E,sBAAsB,MAA6B;AACxD,QAAA,UAAU,WAAW,gBAAgB;AAC3C,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,sDAAsD;AAEjE,SAAA;AACT,GCvBM8C,UAAQ,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAad,SAAS,eAAe,EAAC,SAAS,aAAa,kBAAsC;AArB5F,MAAAhD,KAAA,IAAA,IAAA,IAAA;AAuBI,SAAA,oBAAC,MAAK,EAAA,QAAQ,GAAG,UAAU,UAAU,OAAO,GAC1C,UAAA,qBAACoN,aAAU,EAAA,OAAO,GACf,UAAA;AAAA,IAAA,QAAQ,SACP,oBAACpK,SAAM,EAAA,KAAK,QAAQ,MAAM,MAAM,KAAK,MAAKhD,MAAQ,QAAA,MAAM,MAAM,YAApB,aAA+B,IAAI;AAAA,IAE9E,qBAAA,MAAA,EAAK,SAAS,GAAG,WAAW,UAC3B,UAAA;AAAA,MAAC,oBAAA,KAAA,EAAI,UAAU,GAAG,WAAW,GAC3B,UAAC,oBAAA,SAAA,EAAQ,MAAM,GAAI,UAAQ,QAAA,YAAY,CAAA,GACzC;AAAA,MACA,oBAAC,OAAI,WAAW,GACd,8BAAC,6BAA4B,EAAA,QAAQ,QAAQ,gBAAA,CAAiB,EAChE,CAAA;AAAA,IAAA,GACF;AAAA,IACA,qBAAC,QAAK,OAAM,QAAO,KAAK,GAAG,SAAQ,YAAW,SAAS,GACpD,UAAA;AAAA,QAAQ,KAAA,QAAA,oBAAR,mBAAyB,SACxB;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAK;AAAA,UACL,MAAM,QAAQ,gBAAgB;AAAA,UAC9B,MAAK;AAAA,UACL,SAAS,MAAM,YAAY,QAAQ;AAAA,QAAA;AAAA,MACrC;AAAA,MAEF;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,MAAK;AAAA,UACL,cAAc;AAAA,UACd,OAAM,KAAQ,QAAA,cAAR,OAAmB,SAAA,GAAA;AAAA,UACzB,WAAS;AAAA,UACT,MAAK;AAAA,UACJ,KAAI,KAAA,QAAQ,cAAR,OAAA,SAAA,GAAmB,YAAW,YAC/B;AAAA,YACE,MAAM,QAAQ,UAAU;AAAA,YACxB,QAAQ;AAAA,YACR,KAAK;AAAA,YACL,IAAI;AAAA,UAAA,IAEN;AAAA,YACE,WACE,aAAQ,cAAR,OAAA,SAAA,GAAmB,YAAW,aAC1B,iBACA,MAAM,YAAY,YAAY;AAAA,UACtC;AAAA,QAAA;AAAA,MACN;AAAA,IAAA,GACF;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;AChDgB,SAAA,UAAU,EAAC,QAAuB;AAC1C,QAAA,EAAC,MAAM,YAAY,YAAY,kBAAA,IAAqB,oBAAA,GACpD,SAAS,oBAAoB,GAC7B,YAAY,aAAA,GAGZ,CAAC,KAAK,MAAM,IAAI,SAAmC,IAAI,GAEvD,CAAC,aAAa,cAAc,IAAI,SAAS,EAAK;AAEpD,YAAU,MAAM;AACV,WAEF,eAAe,EAAI;AAAA,EAAA,GAEpB,CAAC,GAAG,CAAC;AACR,QAAM,iBAAiB,YAAY,MAAM,kBAAkB,EAAI,GAAG,CAAC,iBAAiB,CAAC,GAC/E,eAAe,YAAY,MAAM;AAChC,WAAA,QAAA,IAAA,MAAA,GACL,kBAAkB,EAAK;AAAA,KACtB,CAAC,mBAAmB,GAAG,CAAC,GAErB,cAAc;AAAA,IAClB,CAAC,eACQ,CAAC,WAA6D;AAC7D,YAAA,UAAS,QAAM,OAAA,SAAA,KAAA,gBAAc,QAAM,OAAA,SAAA,KAAA;AAErC,gBACF,UAAU,IAAI,sBAAsB;AAAA,QAClC,UAAU,OAAO;AAAA,QACjB,gBAAgB,OAAO;AAAA,QACvB;AAAA,QACA,QAAQ;AAAA,QACR,eAAe,KAAK;AAAA,QACpB,kBAAkB,cAAc,EAAC,YAAY,UAAU,OAAO,IAAG;AAAA,QACjE,qBAAqB;AAAA,MAAA,CACtB,GAEH,aAAa;AAAA,IACf;AAAA,IAEF,CAAC,MAAM,cAAc,YAAY,SAAS;AAAA,KAGtC,uBAAuB;AAAA,IAC3B,CAAC,WACQ,MAAM;AACL,YAAA,UAAS,QAAM,OAAA,SAAA,KAAA,gBAAc,QAAM,OAAA,SAAA,KAAA;AACrC,gBACF,UAAU,IAAI,uBAAuB;AAAA,QACnC,UAAU,OAAO;AAAA,QACjB,gBAAgB,OAAO;AAAA,QACvB,YAAY;AAAA,QACZ,QAAQ;AAAA,QACR,eAAe,KAAK;AAAA,QACpB,kBAAkB,cAAc,EAAC,YAAY,UAAU,OAAO,IAAG;AAAA,QACjE,eAAe,WAAW,YAAY,YAAY;AAAA,MAAA,CACnD,GACH,eAAe;AAAA,IACjB;AAAA,IAEF,CAAC,MAAM,gBAAgB,WAAW,UAAU;AAAA,EAAA,GAGxC,wBAAwB,YAAY,MAAM;AAC1C,YAAM,QAAA,KAAA,cACR,UAAU,IAAI,uBAAuB;AAAA,MACnC,UAAU,KAAK,WAAW;AAAA,MAC1B,gBAAgB,KAAK,WAAW;AAAA,MAChC,YAAY;AAAA,MACZ,QAAQ;AAAA,MACR,eAAe,KAAK;AAAA,MACpB,kBAAkB,cAAc,EAAC,YAAY,IAAM,UAAU,KAAK,WAAW,IAAG;AAAA,MAChF,eAAe;AAAA,IAAA,CAChB,GACH,eAAe;AAAA,EAAA,GACd,CAAC,QAAM,OAAA,SAAA,KAAA,YAAY,QAAM,OAAA,SAAA,KAAA,UAAU,gBAAgB,SAAS,CAAC,GAE1D,2BAA2B,YAAY,MAAM;AAC7C,YAAM,QAAA,KAAA,eACR,UAAU,IAAI,mBAAmB;AAAA,MAC/B,UAAU,KAAK,YAAY;AAAA,MAC3B,gBAAgB,KAAK,YAAY;AAAA,MACjC,eAAe;AAAA,MACf,YAAY;AAAA,MACZ,QAAQ;AAAA,MACR,eAAe,KAAK;AAAA,MACpB,kBAAkB,cAAc,EAAC,YAAY,IAAM,UAAU,KAAK,YAAY,IAAG;AAAA,IAAA,CAClF,GACH,eAAe;AAAA,EAAA,GACd,CAAC,QAAM,OAAA,SAAA,KAAA,aAAa,6BAAM,UAAU,WAAW,cAAc,CAAC;AAEjE,MAAI,EAAC,QAAM,QAAA,KAAA;AAAW,WAAA;AACtB,QAAM,iBAAiB,aAAa,KAAK,aAAa,KAAK;AAC3D,MAAI,CAAC;AAAuB,WAAA;AAEtB,QAAA,SACJ,SAAS,YACP;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,mBAAmB;AAAA,MACnB,UAAU,KAAK;AAAA,MACf,KAAK;AAAA,IAAA;AAAA,EAAA,IAGP;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,mBAAmB;AAAA,MACnB,UAAU,KAAK;AAAA,MACf,WAAW,KAAK;AAAA,MAChB,KAAK;AAAA,IAAA;AAAA,EAAA;AAIP,UAAA,kBAAA,OAAA,SAAA,eAAgB,gBAAe,YAE/B;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAM,cAAc;AAAA,MACpB,MAAM;AAAA,MACN;AAAA,MACA,QAAQ;AAAA,MACR,QAAM;AAAA,MACN,WAAW,SAAS,YAAY,QAAQ;AAAA,MACxC,SACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,SAAS;AAAA,UACT,aAAa,YAAY,SAAS;AAAA,UAClC,gBAAgB;AAAA,QAAA;AAAA,MAClB;AAAA,MAGD,UAAA;AAAA,IAAA;AAAA,EAAA,IAOF,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA;AAAA,IACD;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,SAAS,YAAY,OAAO;AAAA,QAC5B,YAAY,qBAAqB,UAAU;AAAA,QAC3C,mBAAmB,qBAAqB,SAAS;AAAA,QACjD,MAAM;AAAA,MAAA;AAAA,IACR;AAAA,EACF,EAAA,CAAA;AAEJ;AClKO,MAAM,iBAAiB,UCcjB,oBAAoB,CAAC,EAAC,eAAsC;AAnBzE,MAAAA;AAoBE,QAAM,SAAS,UAAA,GACT,CAAC,MAAM,OAAO,IAAI,SAAmC,IAAI,GACzD,CAAC,YAAY,aAAa,IAAI,SAAS,EAAK,GAC5C,CAAC,YAAY,aAAa,IAAI,SAAS,EAAK,GAC5C,SAAS,UAAU,EAAC,YAAY,aAAA,CAAa,GAC7C,YAAY,aAAa;AAI/B,YAAU,MAAM;AACd,UAAM,SAAS,QAAM,OAAA,SAAA,KAAA;AACjB,kBAAc,cAAc,UAC9B,UAAU,IAAI,mBAAmB;AAAA,MAC/B,UAAU,OAAO;AAAA,MACjB,gBAAgB,OAAO;AAAA,MACvB,kBAAkB,cAAc,EAAC,YAAY,UAAU,OAAO,IAAG;AAAA,MACjE,eAAe,aAAa,SAAS;AAAA,MACrC,YAAY,OAAO;AAAA,MACnB,QAAQ;AAAA,MACR,eAAe,KAAK;AAAA,IAAA,CACrB;AAAA,KAEF,CAAC,YAAY,MAAM,YAAY,SAAS,CAAC;AAG5C,QAAM,uBAAuB,IAAI,gBAAgB,OAAO,MAAM,aAAa,EAAE;AAE7E,YAAU,MAAM;AAGd,UAAM,eAAe,IAAI,gBAAgB,oBAAoB,GAEvD,cAAc,IAAI;AACZ,gBAAA,OAAO,iBAAiB,cAAc;AAI5C,UAAA,aAAa,aAAa,IAAI,YAAY;AAC5C,kBAAY,YAAY,OAAO,cAAc,UAAU;AAGrD,UAAA,aAAa,aAAa,IAAI,YAAY;AAC5C,kBAAY,YAAY,OAAO,cAAc,UAAU;AAGrD,UAAA,WAAW,YAAY,IAAI,YAAY,IAAI,4BAA4B,kBACvE,UAAU,OAAO,WACpB,QAAkC;AAAA,MACjC,KAAK,GAAG,QAAQ,IAAI,YAAY,UAAU;AAAA,IAC3C,CAAA,EACA;AAAA,MACC,CAAC,aAAa;AACJ,gBAAA,QAAQ,GACZ,YAAU,QAAA,SAAA,eACZ,cAAc,EAAI,GAClB,cAAc,EAAI;AAAA,MAEtB;AAAA,MACA,MAAM;AAAA,MAEN;AAAA,IAAA;AAGJ,WAAO,MAAM;AACX,cAAQ,YAAY;AAAA,IAAA;AAAA,EACtB,GACC,CAAC,QAAQ,oBAAoB,CAAC;AAEjC,QAAM,oBAAoB;AAAA,IACxB,CAAC,iBAAiB,OAAU;AAzFhCA,UAAAA;AA0FU,oBACF,cAAc,EAAK,GAEnB,cAAc,cAAc,IACxBA,OAAA,QAAM,OAAA,SAAA,KAAA,eAAN,QAAAA,KAAkB,MACpB,OAAO,QAAQ,EAAC,KAAK,kBAAkB,QAAA,OAAA,SAAA,KAAM,WAAW,EAAE,IAAI,QAAQ,QAAO,KAG/E,cAAc,CAAC,MAAM,CAAC,CAAC;AAAA,IAE3B;AAAA,IACA,CAAC,QAAQ,aAAYA,MAAM,QAAA,OAAA,SAAA,KAAA,eAAN,oBAAkB,EAAE;AAAA,EAAA;AAIzC,SAAA,oBAAC,iBAAiB,UAAjB,EAA0B,OAAO,EAAC,MAAM,YAAY,mBAAmB,cACrE,SACH,CAAA;AAEJ;AC7GO,SAAS,aAAa;AAEzB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,QAAO;AAAA,MACP,SAAQ;AAAA,MACR,MAAK;AAAA,MACL,OAAM;AAAA,MAEN,UAAA;AAAA,QAAA,oBAAC,UAAK,OAAM,QAAO,QAAO,QAAO,MAAK,WAAU;AAAA,QAChD;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAE;AAAA,YACF,MAAK;AAAA,UAAA;AAAA,QACP;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAE;AAAA,YACF,MAAK;AAAA,UAAA;AAAA,QACP;AAAA,QACA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,GAAE;AAAA,YACF,MAAK;AAAA,UAAA;AAAA,QACP;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;ACdA,MAAM,iBAAiB,IACjB,SAAS,GAET,oBAAoB,OAAO,IAAI,EAAE,MAAM;AAAA,EAC3C,UAAU;AAAA,EACV,QAAQ;AACV,CAAC;AAAA,YACW,cAAc;AAAA,WACf,cAAc;AAAA,GAGnBc,eAAa,OAAO,IAAI;AAAA,mBACX,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,OAAO,MAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,kBAK9C,CAAC,EAAC,MAAK,MACnBL,iBAAe;AAAA,EACb,MAAM,MAAM,OAAO,MAAM;AAAA,EACzB,WAAW,EAAC,GAAG,MAAM,OAAO,WAAW,QAAQ,EAAC;AAClD,CAAC,CAAC;AAAA;AAAA;AAcD,SAAS,aAAa;AACrB,QAAA,aAAa,iBACb,EAAC,gBAAmB,IAAA,mBACpB,GAAA,EAAC,MAAM,UAAU,SAAS,oBAAmB,aAAa,EAAC,OAAO,IAAG,GAErE,qBAAqB,WAAW,SAAS;AAG7C,SAAA,oBAACK,cAAW,EAAA,IAAG,KAAI,MAAM,UAAU,SAAS,iBAC1C,UAAA,qBAAC,MAAK,EAAA,OAAM,UACV,UAAA;AAAA,IAAC,oBAAA,mBAAA,EACC,8BAAC,MAAK,EAAA,OAAM,UAAS,QAAO,QAAO,SAAQ,UACxC,UAAsB,sBAAA,gBAAgB,aACpC,oBAAA,sBAAA,EAAqB,MAAM,gBAAgB,MAAM,MAAK,QAAQ,CAAA,IAE/D,oBAAC,YAAW,CAAA,CAAA,EAAA,CAEhB,EACF,CAAA;AAAA,IACC,CAAC,sBACC,oBAAA,KAAA,EAAI,UAAU,GACb,UAAA,oBAACE,QAAK,EAAA,MAAM,GAAG,QAAO,UACnB,UAAA,gBAAgB,MACnB,CAAA,GACF;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ;AClEO,SAASuQ,iBAAe;AAAA,EAC7B;AACF,GAEG;AACK,QAAA,EAAC,GAAArR,GAAK,IAAA,kBAEN,UAAU,sBAAsB,WAAWA,EAAC;AAElD,SACG,oBAAA,MAAA,EAAK,WAAS,IAAC,MAAK,QAAO,SAAS,GAAG,UAAS,QAC/C,UAAC,oBAAA,OAAA,EAAM,IAAG,MAAK,OAAO,GACnB,UAAA,QAAQ,IAAI,CAAC,EAAC,MAAM,OAAO,MAAM,UAAU,UAAU,MAAK,MACxD,oBAAA,OAAA,EAAM,IAAG,MACR,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,cAAY;AAAA,MACZ;AAAA,MACA,WAAW,YAAY,oBAAC,eAAc,CAAA,CAAA;AAAA,MACtC,SAAQ;AAAA,MACR,MAAK;AAAA,MACL,SAAS;AAAA,MACT;AAAA,MACA,MAAK;AAAA,MACL,MAAM;AAAA,IAAA;AAAA,EAVU,EAAA,GAAA,IAYpB,CACD,EACH,CAAA,EACF,CAAA;AAEJ;AC5BO,SAASsR,eAAa;AACoB,mBAAU,GAOhD;AAiBX;AC1BO,SAASC,eAAa;AAC3B,QAAM,EAAC,aAAa,UAAA,IAAa,gBAC3B,UAAU,CAAA,EAAQ,eAAe,YAAY,aAAa,eAAe,IAEzE,EAAC,GAAAvR,GAAA,IAAK;AAEZ,SACG,oBAAA,MAAA,EAAK,WAAS,IAAC,MAAK,QAAO,SAAS,GACnC,UAAC,qBAAA,OAAA,EAAM,IAAG,MAAK,OAAO,GACpB,UAAA;AAAA,IAAA,oBAAC,SAAM,IAAG,MACR,8BAAC,WAAU,EAAA,MAAK,WAAU,EAC5B,CAAA;AAAA,IAEA,oBAAC,OAAM,EAAA,IAAG,MACR,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAYA,GAAE,4CAA4C;AAAA,QAC1D,IAAG;AAAA,QACH,MAAM,oCAAoC,SAAS;AAAA,QACnD,MAAM;AAAA,QACN,SAAQ;AAAA,QACR,MAAK;AAAA,QACL,MAAK;AAAA,QACL,QAAO;AAAA,QACP,MAAMA,GAAE,iCAAiC;AAAA,MAAA;AAAA,IAAA,GAE7C;AAAA,IAEC,WACC,oBAAC,OAAM,EAAA,IAAG,MACR,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAYA,GAAE,4CAA4C;AAAA,QAC1D,IAAG;AAAA,QACH,MAAM,oCAAoC,SAAS;AAAA,QACnD,MAAM;AAAA,QACN,SAAQ;AAAA,QACR,MAAK;AAAA,QACL,MAAK;AAAA,QACL,QAAO;AAAA,QACP,MAAMA,GAAE,iCAAiC;AAAA,MAAA;AAAA,IAAA,GAE7C;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ;ACjCA,MAAM,uBAAmC;AAAA,EACvC,QAAQ;AAAA,EACR,SAAS;AAAA,EACT,MAAM;AAAA,EACN,WAAW;AAAA,EACX,MAAM;AACR,GAEM,oBAA8B;AAAA,EAClC,MAAM;AAAA,IACJ,SAAS;AAAA,EACX;AAAA,EACA,QAAQ;AAAA,IACN,SAAS;AAAA,EACX;AACF,GAEM,sBAAgC;AAAA,EACpC,MAAM;AAAA,IACJ,GAAG;AAAA,EACL;AAAA,EACA,QAAQ;AAAA,IACN,GAAG;AAAA,EACL;AACF,GAEMmE,SAAO,OAAO,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQnB,iBAAiB,OAAO,OAAO,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GASpC,kBAAkB,OAAO,OAAO,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAkB9B,YAAY,KAAK,SAAmBhF,QAAuB;AACtE,QAAM,EAAC,oBAAoB,SAAS,gBAAgB,QAAQ,SAAS,MAAK,IAAIA,QAExE,YAAY,uBAAuB,GACnC,EAAC,MAAM,YAAW,IAAI,aAAa,GACnC,aAAa,cACb,GAAA,WAAW,qBAAqB,GAEhC,EAAC,GAAAa,GAAK,IAAA,kBAEN,gBAAgB;AAAA,IACpB,CAAC,UAAyC;AACpC,YAAM,QAAQ,YAChB;IAEJ;AAAA,IACA,CAAC,OAAO;AAAA,KAGJ,oBAAoB;AAAA,IACxB,CAAC,WAAuB;AACtB,gBAAA,QAAA,OAAA,GACA,QAAQ;AAAA,IACV;AAAA,IACA,CAAC,OAAO;AAAA,EAAA,GAGJ,cAAc,QAAQ,MAAM;AA7GpC,QAAAF;AA8GW,YAAAA,MAAA,WAAA,OAAA,SAAA,QACH,OAAO,CAAC,MAAM,EAAE,aAAa,SAD1B,MAAA,OAAA,SAAAA,IAEH,IAAI,CAAC,WAEH;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,MAAM,UAAQ,OAAA,SAAA,OAAA;AAAA,QACd,SAAQ;AAAA,QAER,MAAK;AAAA,QAEL,SAAS,MAAM,kBAAkB,OAAO,QAAQ;AAAA,QAChD,UAAU,OAAO;AAAA,QACjB,MAAK;AAAA,QACL,MAAM,OAAO;AAAA,QACb,OAAM;AAAA,MAAA;AAAA,MAPD,OAAO;AAAA,IAAA,CAQd;AAAA,EAAA,GAGL,CAAC,SAAS,iBAAiB,CAAC;AAG7B,SAAA,oBAAC,iBACE,EAAA,UAAA,UACE,oBAAA0R,WAAA,EAAU,aAAW,IACpB,UAAA,qBAACrN,QAAK,EAAA,WAAW,eACf,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAQ;AAAA,QACR,aAAW;AAAA,QACX,MAAK;AAAA,QACL,SAAQ;AAAA,QACR,SAAS;AAAA,QACT,YAAY;AAAA,QACZ,UAAU;AAAA,MAAA;AAAA,IACZ;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAQ;AAAA,QACR,aAAW;AAAA,QACX,SAAQ;AAAA,QACR,MAAK;AAAA,QACL,QAAO;AAAA,QACP,SAAQ;AAAA,QACR,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,UAAU;AAAA,QAEV,UAAA;AAAA,UAAC,oBAAA,MAAA,EAAK,cAAY,IAChB,UAAA,qBAAC,SAAM,OAAO,GAAG,SAAS,GACxB,UAAA;AAAA,YAAC,qBAAA,MAAA,EAAK,OAAM,UAEV,UAAA;AAAA,cAAA,oBAAC,MAAK,EAAA,MAAM,GAAG,OAAM,UAAS,cAAc,GAC1C,UAAA,qBAAC,MAAK,EAAA,MAAM,GAAG,OAAM,UACnB,UAAA;AAAA,gBAAA,oBAAC,YAAW,EAAA,MAAM,GAAG,MAAK,MAAK;AAAA,gBAC/B;AAAA,kBAAC;AAAA,kBAAA;AAAA,oBACC,MAAM;AAAA,oBACN,YAAY;AAAA,oBACZ,QAAO,eAAa,OAAA,SAAA,YAAA,UAAQ,eAAa,OAAA,SAAA,YAAA;AAAA,oBAEzC,UAAA,oBAACrD,QAAK,EAAA,MAAM,GAAG,cAAa,YAAW,QAAO,UAC3C,WAAA,eAAA,OAAA,SAAA,YAAa,UAAQ,eAAA,OAAA,SAAA,YAAa,OACrC,CAAA;AAAA,kBAAA;AAAA,gBACF;AAAA,cAAA,EAAA,CACF,EACF,CAAA;AAAA,cAEA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,MAAM;AAAA,kBACN,MAAK;AAAA,kBACL,SAAS;AAAA,kBACT,cAAc,EAAC,SAASd,GAAE,sBAAsB,EAAC;AAAA,gBAAA;AAAA,cACnD;AAAA,YAAA,GACF;AAAA,YAEC,WAAW,SAAS,KACnB,qBAAC,QAAK,MAAM,GAAG,KAAK,GAClB,UAAA;AAAA,cAAA,oBAAC,YAAW,EAAA;AAAA,kCACX,qBAAoB,EAAA;AAAA,YAAA,GACvB;AAAA,UAAA,EAAA,CAEJ,EACF,CAAA;AAAA,UAEA,qBAAC,QAAK,WAAU,UAAS,MAAM,GAAG,SAAQ,iBAAgB,UAAS,QAEjE,UAAA;AAAA,YAAA,oBAAC,MAAK,EAAA,MAAK,QAAO,SAAS,GACzB,UAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC;AAAA,gBACA,cAAc;AAAA,gBACd,SAAQ;AAAA,gBACR,eAAe;AAAA,gBACf;AAAA,cAAA;AAAA,YAAA,GAEJ;AAAA,YAEA,qBAAC,MAAK,EAAA,WAAU,UACb,UAAA;AAAA,cACC,eAAA,oBAAC,MAAK,EAAA,MAAK,QAAO,SAAS,GACzB,UAAA,oBAAC,OAAM,EAAA,OAAO,GAAI,UAAA,YAAY,CAAA,GAChC;AAAA,cAGD,aAAc,oBAAAqR,kBAAA,EAAe,UAAsB,CAAA;AAAA,kCACnDC,cAAW,EAAA;AAAA,kCACXC,cAAW,EAAA;AAAA,YAAA,GACd;AAAA,UAAA,GACF;AAAA,UAEC,KAAK,UACJ,oBAAC,MAAK,EAAA,MAAK,QAAO,SAAS,GAAG,WAAS,IACrC,UAAA,oBAAC,OACC,EAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,WAAW;AAAA,cACX,SAAQ;AAAA,cACR,MAAK;AAAA,cAEL,SAAS,KAAK;AAAA,cACd,MAAK;AAAA,cACL,MAAMvR,GAAE,2BAA2B;AAAA,YAAA;AAAA,aAEvC,EACF,CAAA;AAAA,QAAA;AAAA,MAAA;AAAA,IAEJ;AAAA,EAAA,GACF,GACF,EAEJ,CAAA;AAEJ,CAAC;AC3OD,SAAS,aAAa,OAAe,QAAoC;AACjE,QAAA,iBAAiB,OAAO,MAAM,YAAY;AAMhD,SALuB,MAAM,KAAA,EAAO,cAGP,MAAM,UAAU,EAEhC,MAAM,CAAC,SAAS,eAAe,SAAS,IAAI,CAAC;AAC5D;AAKA,SAAS,oBAAoB,OAAe,GAAsB,GAA8B;AAC9F,QAAM,SAAS,EAAE,MAAM,eACjB,SAAS,EAAE,MAAM,YAAA,GACjB,iBAAiB,MAAM,OAAO,YAAY;AAEhD,SAAI,OAAO,WAAW,cAAc,KAAK,CAAC,OAAO,WAAW,cAAc,IACjE,KAGL,OAAO,WAAW,cAAc,KAAK,CAAC,OAAO,WAAW,cAAc,IACjE,IAGL,OAAO,SAAS,cAAc,KAAK,CAAC,OAAO,SAAS,cAAc,IAC7D,KAGL,OAAO,SAAS,cAAc,KAAK,CAAC,OAAO,SAAS,cAAc,IAC7D,IAGF;AACT;AAEgB,SAAA,cACd,SACA,OACA,aACqB;AACI,SAAA,QAAQ,IAAI,CAAC,YAAY;AAAA,IAChD,GAAG;AAAA,IACH,OAAO,YAAY,EAAC,GAAG,QAAQ,QAAO,UAAA,OAAA,SAAA,OAAQ,UAAS,OAAO,GAAE,CAAC,EAAE;AAAA,EACnE,EAAA,EAEoC,KAAK,CAAC,GAAG,MAAM,EAAE,MAAM,cAAc,EAAE,KAAK,CAAC,EAGhF,OAAO,CAAC,WAAW,aAAa,OAAO,MAAM,CAAC,EAC9C,KAAK,CAAC,GAAG,MAAM,oBAAoB,OAAO,GAAG,CAAC,CAAC;AACpD;ACjDO,MAAMkI,kBAAgB,OAAO,OAAO,EAAE,MACpC;AAAA;AAAA;AAAA;AAAA;AAAA,uBAKc,CAAC,EAAC,YAAW,MAAM,OAAO,OAAO,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,GAMzD,GAKY,eAAe,OAAO,MAAM,EAAE,MAClC;AAAA;AAAA;AAAA;AAAA,GAKR,GAEYmD,aAAW,OAAO,IAAI,KAEtB,oBAAoB,OAAO,IAAI;AAAA;AAAA,GAI/B,mBAAmB,OAAO,IAAI;AAAA;AAAA,GAI9B,kBAAkB,OAAO,IAAI,EAGvC,CAAClM,WAAU;AACN,QAAA,EAAC,oBAAoB,YAAe,IAAAA;AAInC,SAAA;AAAA,qBACY,WAAW;AAAA,mBACb,kBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOrC,CAAC,GC3CY,wBAAwB;AAS9B,SAAS,sBAAsBA,QAAmC;AACvE,QAAM,EAAC,QAAQ,aAAa,SAAS,YAAWA,QAC1C,SAAS;AAAA,IACb,OAAO,EAAC,UAAU,OAAO,YAAY,MAAM,OAAO;IAClD,CAAC,OAAO,YAAY,OAAO,UAAU;AAAA,KAEjC,EAAC,SAAS,eAAe,KAAA,IAAQ,cAAc;AAAA,IACnD,QAAQ;AAAA,IACR;AAAA,EAAA,CACD,GAEK,sBAAsB;AAAA,IAC1B,CAAC,UAAmC;AACpB,oBAAA,KAAK,GACnB,QAAQ,MAAM;AAAA,IAChB;AAAA,IACA,CAAC,eAAe,SAAS,MAAM;AAAA,EAG3B,GAAA,EAAC,MAAK,IAAI,YAAY,MAAM;AAGhC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,UAAU,OAAO;AAAA,MAEjB,QAAM;AAAA,MACN,SACE,oBAAC,gCAA+B,EAAA,aAA0B,SAAQ,mBAAkB;AAAA,MAGtF,8BAAC,OACC,EAAA,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAI,OAAO,gBAAgB,MAAM;AAAA,UACjC,eAAa,cAAc,OAAO,UAAU;AAAA,UAC5C,UAAU,CAAC,OAAO;AAAA,UAClB;AAAA,UACA,cAAc;AAAA,UACd,SAAS;AAAA,UACT,SAAS,YAAY,WAAW,IAAI;AAAA,UACpC,QAAQ;AAAA,UAER,8BAAC2B,QAAK,EAAA,MAAM,YAAY,WAAW,IAAI,QAAY,UAAM,MAAA,CAAA;AAAA,QAAA;AAAA,MAAA,GAE7D;AAAA,IAAA;AAAA,IAnBK,OAAO;AAAA,EAAA;AAsBlB;ACzDA,MAAM,cAAc,OAAO,IAAI;AAAA;AAAA;AAcxB,SAAS,gBAAgB3B,QAA6B;AACrD,QAAA,EAAC,aAAa,SAAS,iBAAiB,SAAS,SAAS,aAAa,iBAAgB,IAC3FA,QACI,EAAC,GAAAa,OAAK,eAAA,GACN,aAAa,QAAQ,SAAS,KAAK,CAAC,SAEpC,sBAAsB,YAAY,MAAM;AAC5B;EACf,GAAA,CAAC,eAAe,CAAC,GAEd,kBAAkB;AAAA,IACtB,CAAC,UAAe;AArCpB,UAAAF;AAqC+B,eAAAA,MAAA,QAAA,KAAK,MAAb,OAAA,SAAAA,IAAgB,mBAAkB;AAAA,IAAA;AAAA,IACrD,CAAC,OAAO;AAAA,KAGJ,aAAa;AAAA,IACjB,CAAC,SAEG;AAAA,MAAC;AAAA,MAAA;AAAA,QACC;AAAA,QAEA,SAAS;AAAA,QACT,QAAQ;AAAA,QACR;AAAA,MAAA;AAAA,MAHK,KAAK;AAAA,IAIZ;AAAA,IAGJ,CAAC,aAAa,qBAAqB,OAAO;AAAA,EAAA;AAIxC,SAAA,8BACM,cAAa,EAAA,UAAQ,IAAC,IAI5B,CAAC,cAAc,cAEf;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,MAAM;AAAA,MACN,QAAO;AAAA,MACP,SAAQ;AAAA,MACR,SAAS;AAAA,MACT,QAAO;AAAA,MAEP,8BAACgB,QAAK,EAAA,OAAM,UAAS,OAAK,IAAC,MAAM,GAC/B,UAAC,oBAAA,WAAA,EAAU,GAAAd,IAAM,SAAQ,2BAA0B,QAAQ,EAAC,cAAc,CAAA,GAC5E;AAAA,IAAA;AAAA,MAMD,aAkBH;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,oBAAmB;AAAA,MACnB,WAAWA,GAAE,2BAA2B;AAAA,MACxC,WAAW,gBAAgB,SAAY;AAAA,MACvC;AAAA,MACA,cAAc;AAAA,MACd,YAAY;AAAA,MACZ,OAAO;AAAA,MACP,UAAU;AAAA,MACV,SAAS,YAAY,WAAW,IAAI;AAAA,MACpC,eAAe;AAAA,MACf;AAAA,IAAA;AAAA,EAAA,IA3BA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,MAAM;AAAA,MACN,QAAO;AAAA,MACP,SAAQ;AAAA,MACR,SAAS;AAAA,MACT,QAAO;AAAA,MAEP,UAAA,oBAACc,QAAK,EAAA,OAAM,UAAS,OAAK,IAAC,MAAM,GAC9B,UAAEd,GAAA,sCAAsC,EAC3C,CAAA;AAAA,IAAA;AAAA,EAAA;AAoBR;ACvFA,MAAM,sBAAsB;AAYrB,SAAS,kBAAkBb,QAA+B;AAC/D,QAAM,EAAC,mBAAmB,QAAQ,WAAW,SAAS,QAAA,IAAWA,QAE3D,CAAC,MAAM,OAAO,IAAI,SAAkB,EAAK,GACzC,CAAC,aAAa,cAAc,IAAI,SAAiB,EAAE,GACnD,CAAC,gBAAgB,iBAAiB,IAAI,SAAgC,IAAI,GAC1E,CAAC,eAAe,gBAAgB,IAAI,SAAgC,IAAI,GACxE,CAAC,eAAe,gBAAgB,IAAI,SAAmC,IAAI,GAC3E,CAAC,oBAAoB,qBAAqB,IAAI,SAAkC,IAAI,GACpF,EAAC,GAAAa,OAAK,kBACN,cAAc,eAAe,OAAO,GAEpC,EAAC,OAAU,IAAA,eAAA,GACX,cAAc,eAAA,GACd,SAAS,UAAA,GAET,wBAAwB,QAAQ,SAAS,GACzC,WAAW,CAAC,qBAAqB,CAAC,uBAClC,cAAcA,GAAE,iCAAiC,GACjD,QAAQA,GAAE,oBAAoB,GAC9B,sBAAsBA,GAAE,qCAAqC,GAE7D,eAAe;AAAA,IACnB,MACE,QAAQ,OAAO,CAAC,WAAW;AACzB,YAAM,eAAe,OAAO,IAAI,OAAO,UAAU;AAC1C,aAAA,gBAAgB,CAAC,uBAAuB,YAAY;AAAA,IAAA,CAC5D;AAAA,IACH,CAAC,SAAS,MAAM;AAAA,KAIZ,kBAAkB;AAAA,IACtB,MAAM,cAAc,cAAc,aAAa,WAAW;AAAA,IAC1D,CAAC,cAAc,aAAa,WAAW;AAAA,EAAA,GAGnC,qBAAqB,YAAY,CAAC,UAAyC;AAChE,mBAAA,MAAM,cAAc,KAAK;AAAA,KACvC,CAAE,CAAA,GAEC,mBAAmB,YAAY,MAAM,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,CAAA,CAAE,GAE3D,cAAc,YAAY,MAAM;AACpC,YAAQ,EAAK,GACb,eAAe,EAAE,GACjB,iBAAe,QAAA,cAAA;EACd,GAAA,CAAC,aAAa,CAAC,GAGZ,0BAA0B;AAAA,IAC9B,CAAC,MAAwC;AACnC,QAAE,QAAQ,eAAe,CAAC,QAC5B,QAAQ,EAAI;AAAA,IAEhB;AAAA,IACA,CAAC,IAAI;AAAA,KAID,uBAAuB;AAAA,IAC3B,CAAC,MAAqC;AACpC,OAAK,EAAE,QAAQ,YAAY,EAAE,QAAQ,UAAU,QAC7C;IAEJ;AAAA,IACA,CAAC,aAAa,IAAI;AAAA,EAAA;AAIpB,kBAAgB,MAAM;AAChB,YACF,YAAY;AAAA,EAEb,GAAA,CAAC,eAAe,eAAe,cAAc,CAAC;AAEjD,QAAM,kBAAwC;AAAA,IAC5C,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA,iBAAiB;AAAA,MACjB,SAAS;AAAA,MACT;AAAA,MACA,SAAS,UAAU,YAAY,WAAW;AAAA,MAC1C,kBAAkB;AAAA,IAAA;AAAA,IAEpB;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,KAII,uBAAuC;AAAA,IAC3C,OAAO;AAAA,MACL,6BAA6B;AAAA,MAC7B,QAAQ;AAAA,MACR,eAAe;AAAA,MACf,cAAc;AAAA,MACd,UAAU;AAAA,MACV,MAAM;AAAA,MACN,UAAU;AAAA,MACV;AAAA,MACA,KAAK;AAAA,IAAA;AAAA,IAEP,CAAC,oBAAoB,SAAS,aAAa,WAAW;AAAA,KAIlD,wBAAqC;AAAA,IACzC,OAAO;AAAA,MACL,cAAc;AAAA,MACd,eAAe;AAAA,MACf,UAAU,YAAY;AAAA,MACtB,MAAM;AAAA,MACN,MAAMA,GAAE,qBAAqB;AAAA,MAC7B,MAAM;AAAA,MACN,SAAS;AAAA,MACT,KAAK;AAAA,MACL,UAAU;AAAA,IAAA;AAAA,IAEZ,CAAC,UAAU,kBAAkB,SAAS,MAAM,qBAAqBA,EAAC;AAAA,EAAA,GAI9D,iBAA0C,QAAQ,MACjD,wBAID,oBACK,oBAACc,QAAK,EAAA,MAAM,GAAI,UAAEd,GAAA,wCAAwC,EAAE,CAAA,wBAIlE,gCAA+B,EAAA,aAA0B,SAAQ,sBAAsB,CAAA,IARhF,oBAAAc,QAAA,EAAK,MAAM,GAAI,aAAE,sCAAsC,EAAA,CAAE,GAUlE,CAAC,mBAAmB,aAAa,uBAAuBd,EAAC,CAAC,GAGvD,qBAAmC;AAAA,IACvC,OAAO;AAAA,MACL,SAAS;AAAA,MACT,UAAU,WAAW;AAAA,MACrB;AAAA,IAAA;AAAA,IAEF,CAAC,SAAS,MAAM,QAAQ,cAAc;AAAA,EAAA;AAIpC,SAAA,UAAU,WAGR,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAC,oBAAA,SAAA,EAAS,GAAG,oBACX,UAAC,oBAAA,OAAA,EACC,8BAAC,QAAQ,EAAA,GAAG,sBAAuB,CAAA,EACrC,CAAA,GACF;AAAA,IAEC,QACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,QAAQ;AAAA,QACR,IAAG;AAAA,QACH,gBAAgB;AAAA,QAChB,SAAS;AAAA,QACT,KAAK;AAAA,QACL;AAAA,QACA,OAAO;AAAA,QAEP,+BAACqL,YAAS,EAAA,WAAU,UAAS,MAAM,GAAG,QAAO,QAC3C,UAAA;AAAA,UAAA,oBAAC,kBAAiB,EAAA,SAAS,GAAG,cAAY,IACxC,UAAA;AAAA,YAACX;AAAAA,YAAA;AAAA,cACC,eAAY;AAAA,cACX,GAAG;AAAA,YAAA;AAAA,UAAA,GAER;AAAA,UAEA,oBAAC,MAAK,EAAA,WAAU,UAAS,UAAS,UAChC,UAAC,oBAAA,iBAAA,EAAiB,GAAG,gBAAA,CAAiB,EACxC,CAAA;AAAA,QAAA,GACF;AAAA,MAAA;AAAA,IACF;AAAA,EAAA,EAAA,CAEJ,IAMF;AAAA,IAACxC;AAAAA,IAAA;AAAA,MACC,eAAa;AAAA,MACb,WAAW;AAAA,MACX;AAAA,MACA,QAAM;AAAA,MACN,QAAQ;AAAA,MACR,KAAK;AAAA,MACL;AAAA,MACA,SACE;AAAA,QAACmD;AAAAA,QAAA;AAAA,UACC,WAAU;AAAA,UACV,MAAM;AAAA,UACN,aAAaoG;AAAAA,UACb,QAAO;AAAA,UACP,aAAW;AAAA,UAEX,UAAA;AAAA,YAAC,oBAAA,mBAAA,EAAkB,QAAO,UACxB,UAAA,oBAAC,SACC,UAAC,oBAAA,MAAA,EAAK,cAAY,IAAC,SAAS,GAC1B,UAAC,oBAAA/G,aAAA,EAAW,GAAG,sBAAsB,UAAU,GAAG,QAAQ,EAAA,CAAG,EAC/D,CAAA,EAAA,CACF,EACF,CAAA;AAAA,YAEA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,aAAa;AAAA,gBACb,oBAAoB;AAAA,gBACpB,WAAU;AAAA,gBACV,UAAS;AAAA,gBAET,UAAA,oBAAC,iBAAiB,EAAA,GAAG,gBAAiB,CAAA;AAAA,cAAA;AAAA,YACxC;AAAA,UAAA;AAAA,QAAA;AAAA,MACF;AAAA,MAGF,8BAAC,OACC,EAAA,UAAA,oBAAC,WAAS,GAAG,oBACX,8BAAC,OACC,EAAA,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACE,GAAG;AAAA,UACJ,iBAAe;AAAA,UACf,iBAAc;AAAA,UACd,WAAW;AAAA,QAAA;AAAA,MAAA,EAEf,CAAA,EACF,CAAA,GACF;AAAA,IAAA;AAAA,EAAA;AAGN;ACzQO,SAAS,wBAAiD;AACzD,QAAA;AAAA,IACJ,YAAY,EAAC,gCAA+B;AAAA,MAC1C,UAAU,GAER,CAAC,aAAa,OAAO,IAAI,uBAAuB;AAAA,IACpD,eAAe;AAAA,EAChB,CAAA,GAEK,qBACJ,eAAA,OAAA,SAAA,YAAa,KAAK,CAAC,MAAM,gCAAgC,KAAK,CAAC1K,OAAMA,GAAE,OAAO,EAAE,EAAE,CAAA,MAAM,IAEpF,yBAAyB,QAAQ,MAC9B,gCAAgC,IAAI,CAAC,SAAS;AA5BzD,QAAAF;AA6Ba,WAAA;AAAA,MACL,GAAG;AAAA,MACH,QAAO,QAAM,OAAA,SAAA,KAAA,UAAS,KAAK;AAAA,MAC3B,iBAAeA,MAAa,eAAA,OAAA,SAAA,YAAA,KAAK,CAAC,MAAM,EAAE,OAAO,KAAK,EAAvC,MAAA,OAAA,SAAAA,IAA4C,YAAW;AAAA,IAAA;AAAA,EAEzE,CAAA,GACA,CAAC,aAAa,+BAA+B,CAAC;AAE1C,SAAA;AAAA,IACL;AAAA,IACA;AAAA,IACA,SAAS;AAAA,EAAA;AAEb;AC1Ba,MAAA,mBAAmB,KAAK,SAA0BX,QAA6B;AAC1F,QAAM,EAAC,UAAU,SAAS,QAAW,IAAAA,QAC/B,CAAC,iBAAiB,kBAAkB,IAAI,SAA6B,IAAI,GACzE,EAAC,GAAAa,OAAK,kBAEN,qBAAqB,QAAQ,SAAS,aAAa,IAAI,CAAC,cAAc,GAAG,CAAC,MAAM,CAAC,EAAE;AAAA,IACvF,CAAC,aAAa,SAAS;AAAA,EAAA,GAEnB,UAAU,CAAA,EAAQ,sBAAoB,QAAA,mBAAA;AAM5C,YAAU,MAAM;AACV,eAAW,oBACb,gBAAgB,MAAA,GAChB,gBAAgB,aAAa,iBAAiB,EAAE,IAG7C,WACH,mBAAA,QAAA,gBAAiB,gBAAgB,eAAA;AAAA,EAAA,GAElC,CAAC,iBAAiB,OAAO,CAAC;AAEvB,QAAA,cAAc,YAAY,MAAM;AAC5B,YAAA,SAAS,KAAK,EAAE;AAAA,EAAA,GACvB,CAAC,SAAS,SAAS,KAAK,EAAE,CAAC,GAExB,gBAAgB;AAAA,IACpB;AAAA;AAAA,MAEE,WAAW,SAAuB,WAAW,KAAsC;AACjF,eAAK,iDAAoB,OAGvB;AAAA,UAAC;AAAA,UAAA;AAAA,YACE,GAAG;AAAA,YACJ,QAAO;AAAA,YACP,QAAQ;AAAA,cACN,IAAI,sBAAoB,OAAA,SAAA,mBAAA;AAAA,cACxB,MAAM,UAAU,SAAS,sBAAA,OAAA,SAAA,mBAAoB,IAAI;AAAA,YACnD;AAAA,YACA;AAAA,UAAA;AAAA,QAVkC,IAAA;AAAA,MAAA,CAavC;AAAA;AAAA,IACH,CAAC,kBAAkB;AAAA,EAAA;AAInB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,IAAI,qBAAqB,gBAAgB;AAAA,MACzC,WAAQ;AAAA,MACR,UAAU,CAAC;AAAA,MACX,SAAS;AAAA,MACT,SAAU,oBAAA,YAAA,EAAkC,MAAM,GAAG,MAAM,SAAS,KAAA,GAA1C,SAAS,KAAK,EAAkC;AAAA,MAC1E,KAAK;AAAA,MACL,MAAM,SAAS,KAAK;AAAA,MACpB,cACE,UAAU,SAAY,EAAC,SAASA,GAAE,4BAA4B,GAAG,WAAW,OAAM;AAAA,IAAA;AAAA,EAAA;AAI1F,CAAC,GCnEKgR,eAAa,OAAO,IAAI;AAAA;AAAA,GAIxB,cAAc,OAAO,KAAK;AAAA;AAAA;AAAA;AAAA;AAMzB,SAAS,eAAe;AAC7B,QAAM,WAAW,qBACX,EAAC,UAAS,IAAI,gBACd,EAAC,OAAA,IAAU,kBACX,EAAC,GAAAhR,GAAA,IAAK,kBACN,cAAc,SAAS,SAAS,GAMhC,CAAC,WAAW,YAAY,IAAI,SAAiB,GAE7C,kBAAkB,YAAY,CAACrB,QAAe;AAClD,iBAAaA,GAAE;AAAA,KACd,EAAE,GAEC,yBAAyB,YAAY,MAAM;AAC/C,iBAAa,EAAE;AAAA,KACd,EAAE,GAEC,cAAc,YAAY,MAAM;AACpC,iBAAa,EAAE;AAAA,KACd,EAAE,GAEC,SAAS,QAAQ,MAEnB;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,MAAM;AAAA,MACN,MAAK;AAAA,MACL,MAAM,cAAc,aAAa;AAAA,MACjC,cAAc;AAAA,QACZ,SAASqB,GAAE,0BAA0B;AAAA,MACvC;AAAA,IAAA;AAAA,KAGH,CAAC,aAAaA,EAAC,CAAC,GAEb,eAAe;AAAA,IACnB,OAAmC;AAAA,MACjC,eAAe;AAAA,MACf,oBAAoB,CAAC,QAAQ;AAAA,MAC7B,WAAW;AAAA,MACX,QAAQ;AAAA,MACR;AAAA,IAAA;AAAA,IAEF,CAAC,MAAM;AAAA,EAAA;AAIP,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,cAAYA,GAAE,qBAAqB;AAAA,MACnC,IAAG;AAAA,MACH,2BACGgR,cACE,EAAA,UAAA;AAAA,QACC,eAAA,SAAS,IAAI,CAAC,SACZ;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,SAAS,cAAc,KAAK,KAAK;AAAA,YAEjC,SAAS;AAAA,YACT,UAAU;AAAA,UAAA;AAAA,UAFL,KAAK,KAAK;AAAA,QAAA,CAIlB;AAAA,QAEF,CAAC,eACC,oBAAA,KAAA,EAAI,SAAS,GACZ,UAAA,qBAAC,OAAM,EAAA,OAAO,GACZ,UAAA;AAAA,UAAA,oBAAClQ,UAAK,QAAO,UAAS,MAAM,GACzB,UAAAd,GAAE,4BAA4B,GACjC;AAAA,UAEA,oBAACc,UAAK,MAAM,GAAG,OAAK,IACjB,UAAAd,GAAE,kCAAkC,EACvC,CAAA;AAAA,QAAA,EAAA,CACF,EACF,CAAA;AAAA,QAGF,qBAAC,aAAY,EAAA,OAAO,GAClB,UAAA;AAAA,UAAA,oBAAC,aAAY,EAAA;AAAA,UAEb;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,IAAG;AAAA,cACH,MAAM,oCAAoC,SAAS;AAAA,cACnD,WAAW;AAAA,cACX,SAAS;AAAA,cACT,KAAI;AAAA,cACJ,QAAO;AAAA,cACP,MAAMA,GAAE,gCAAgC;AAAA,YAAA;AAAA,UAC1C;AAAA,QAAA,GACF;AAAA,MAAA,GACF;AAAA,MAEF,SAAS;AAAA,MACT,SAAS;AAAA,IAAA;AAAA,EAAA;AAGf;AChHgB,SAAA,iBACd,QACA,QAC+B;AACxB,SAAA,OAAO,WAAW,EAAC,YAAY,KAAI,EAAE,WAAW,QAA2B;AAAA,IAChF,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAML,OAAO,EAAC,GAAG,CAAC,UAAU,cAAc,EAAE,GAAG,OAAM;AAAA,IAC/C,KAAK;AAAA,IACL,MAAM;AAAA,EAAA,CACP;AACH;ACXO,SAAS,sBAAoE;AAC5E,QAAA,SAAS,UAAU,EAAC,YAAY,KAAI,GACpC,SAAS,mBAAmB,IAE5B,gBAAgB,QAAQ,MAAM,iBAAiB,QAAQ,MAAM,GAAG,CAAC,QAAQ,MAAM,CAAC;AAEtF,SAAO,YAAY,aAAa;AAClC;ACPO,SAAS,mBAAmB,EAAC,OAAO,WAAW,SAAgC;AAdtF,MAAAF;AAeQ,QAAA,YAAWA,MAAO,SAAA,OAAA,SAAA,MAAA,cAAP,OAAkB,SAAAA,IAAA,cAC7B,sBAAsB,SAAA,OAAA,SAAA,MAAO,eAC7B,EAAC,GAAAE,GAAC,IAAI,eAAe;AAEvB,MAAA;AACK,WAAA,oBAAC,cAAa,EAAA,UAAQ,GAAC,CAAA;AAGhC,QAAM,gBAEF,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAG;AAAA,QACH,MAAMA,GAAE,0CAA0C;AAAA,QAClD,MAAK;AAAA,QACL,QAAO;AAAA,MAAA;AAAA,IACT;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAG;AAAA,QACH,MAAMA,GAAE,wCAAwC;AAAA,QAChD,MAAK;AAAA,QACL,QAAO;AAAA,MAAA;AAAA,IACT;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAG;AAAA,QACH,MAAMA,GAAE,qCAAqC;AAAA,QAC7C,MAAK;AAAA,QACL,QAAO;AAAA,MAAA;AAAA,IACT;AAAA,wBACC,aAAY,EAAA;AAAA,EACf,EAAA,CAAA;AAGF,SAGM,qBAAA,UAAA,EAAA,UAAA;AAAA,KAAA,UAAU,UAAa,UAAW,oBAAA,OAAA,EAAK,UAAc,eAAA;AAAA,IAEtD,CAAC,UACA,YAAU,OAAA,SAAA,SAAA,IAAI,CAAC,eACR,aACE,oBAAC,YAAiC,EAAA,WAAA,GAAjB,WAAW,IAA8B,IADzC,IAAA;AAAA,IAK5B,qBAAC,KAAI,EAAA,SAAS,GACZ,UAAA;AAAA,MAAA,oBAACc,QAAK,EAAA,MAAM,GAAG,OAAK,IAAC,QAAO,UAAS,cAAa,YAC/C,aAAE,iCAAiC,EAAC,eAAe,eAAe,CAAA,GACrE;AAAA,MACC,CAAC,SAAS,uBACR,oBAAA,KAAA,EAAI,YAAY,GACf,UAAA,oBAACA,QAAK,EAAA,MAAM,GAAG,OAAK,IAAC,cAAa,YAC/B,aAAE,wCAAwC;AAAA,QACzC,eAAe;AAAA,MAAA,CAChB,GACH,EACF,CAAA;AAAA,IAAA,GAEJ;AAAA,EACF,EAAA,CAAA;AAEJ;AAEA,SAAS,WAAW,EAAC,cAAoC;AA7EzD,MAAAhB;AA8EE,SAEK,qBAAA,UAAA,EAAA,UAAA;AAAA,KAAAA,MAAA,cAAA,OAAA,SAAA,WAAY,UAAZ,OAAA,SAAAA,IAAmB,IAAI,CAAC,SAAS;AAC5B,UAAA,CAAC,QAAQ,CAAC,KAAK;AAAc,eAAA;AACjC,cAAQ,KAAK,OAAO;AAAA,QAClB,KAAK;AACH,iBAAK,KAAK,MAER;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,IAAG;AAAA,cACH,MAAK;AAAA,cAEL,MAAM,KAAK;AAAA,cACX,MAAM,KAAK;AAAA,cACX,QAAO;AAAA,YAAA;AAAA,YAHF,KAAK;AAAA,UALQ,IAAA;AAAA,QAWxB,KAAK;AACH,iBAAK,KAAK,OAER,KAAK,SAAS,wBAAwB,oBAAC,UAAyB,EAAA,MAAM,KAAK,MAAA,GAAtB,KAAK,IAAwB,IAF7D;AAAA,QAKzB;AACS,iBAAA;AAAA,MACX;AAAA,IAAA,CACF;AAAA,wBACC,aAAY,EAAA;AAAA,EACf,EAAA,CAAA;AAEJ;ACnGA,MAAMkR,eAAa,OAAO,IAAI;AAAA;AAAA;AAAA;AAKvB,SAAS,kBAAkB;AAC1B,QAAA,EAAC,GAAAhR,OAAK,kBAEN,EAAC,OAAO,OAAO,cAAa;AAGhC,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,cAAYA,GAAE,sBAAsB;AAAA,UACpC,MAAM;AAAA,UACN,MAAK;AAAA,UACL,cAAc,EAAC,SAASA,GAAE,sBAAsB,EAAC;AAAA,QAAA;AAAA,MACnD;AAAA,MAEF,IAAG;AAAA,MACH,0BACGgR,cACC,EAAA,UAAA,oBAAC,sBAAmB,OAAc,WAAsB,OAAc,EACxE,CAAA;AAAA,MAEF,SAAS,EAAC,eAAe,GAAI;AAAA,IAAA;AAAA,EAAA;AAGnC;AC5BO,SAAS,aAAa;AACoB,mBAAU,GAOhD;AAiBX;AC3BO,SAAS,eAAe;AAAA,EAC7B;AACF,GAEG;AACK,QAAA,EAAC,GAAAhR,GAAK,IAAA,kBAEN,UAAU,sBAAsB,WAAWA,EAAC;AAElD,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,oBAAC,aAAY,EAAA;AAAA,IAEZ,QAAQ,IAAI,CAAC,EAAC,MAAM,OAAO,MAAM,UAAU,UAAU,MAAA,MACpD;AAAA,MAAC;AAAA,MAAA;AAAA,QAEC,cAAY;AAAA,QACZ;AAAA,QACA,SAAS;AAAA,QACT,SAAS;AAAA,QACT,MAAM;AAAA,QACN,WAAW,YAAY,oBAAC,eAAc,CAAA,CAAA;AAAA,MAAA;AAAA,MANjC;AAAA,IAAA,CAQR;AAAA,EACH,EAAA,CAAA;AAEJ;AC/BA,MAAMmE,SAAO,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAwCd,SACJ,qBAAC,OAAI,EAAA,OAAM,MAAK,QAAO,MAAK,SAAQ,aAAY,MAAK,QAAO,OAAM,8BAChE,UAAA;AAAA,EAAC,qBAAA,KAAA,EAAE,UAAS,eACV,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAE;AAAA,QACF,MAAK;AAAA,MAAA;AAAA,IACP;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAE;AAAA,QACF,MAAK;AAAA,MAAA;AAAA,IACP;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAE;AAAA,QACF,MAAK;AAAA,MAAA;AAAA,IACP;AAAA,IACA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,GAAE;AAAA,QACF,MAAK;AAAA,MAAA;AAAA,IACP;AAAA,EAAA,GACF;AAAA,EACC,oBAAA,QAAA,EACC,UAAC,oBAAA,YAAA,EAAS,IAAG,SACX,UAAA,oBAAC,QAAK,EAAA,OAAM,MAAK,QAAO,MAAK,MAAK,QAAA,CAAQ,EAC5C,CAAA,GACF;AAAA,EACF,CAAA,GAGI,SACH,qBAAA,OAAA,EAAI,OAAM,MAAK,QAAO,MAAK,SAAQ,aAAY,MAAK,QAAO,OAAM,8BAChE,UAAA;AAAA,EAAC,oBAAA,KAAA,EAAE,UAAS,eACV,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,GAAE;AAAA,MACF,MAAK;AAAA,IAAA;AAAA,EAAA,GAET;AAAA,EACC,oBAAA,QAAA,EACC,UAAC,oBAAA,YAAA,EAAS,IAAG,SACX,UAAA,oBAAC,QAAK,EAAA,OAAM,MAAK,QAAO,MAAK,MAAK,QAAA,CAAQ,EAC5C,CAAA,GACF;AAAA,EACF,CAAA,GAGI,OACH,qBAAA,OAAA,EAAI,OAAM,MAAK,QAAO,KAAI,SAAQ,YAAW,MAAK,QAAO,OAAM,8BAC9D,UAAA;AAAA,EAAC,oBAAA,QAAA,EAAK,GAAE,2oBAA2oB,CAAA;AAAA,EACnpB,oBAAC,QAAK,EAAA,GAAE,qoBAAqoB,CAAA;AAAA,EAC7oB,oBAAC,QAAK,EAAA,GAAE,qcAAqc,CAAA;AAAA,EAC/c,CAAA,GAOW,oBAAoB,CAAC,EAAC,eAAqB;AAChD,QAAA,SAAS,qCAAU,WAAW,OAAA;AAGpC,SACG,qBAAAA,QAAA,EAAK,aAHS,SAAS,SAAS,UAI9B,UAAA;AAAA,IAAA,aAAa,YAAY;AAAA,IACzB,aAAa,YAAY;AAAA,IACzB,aAAa,YAAY,oBAAC,gBAAe,CAAA,CAAA;AAAA,IACzC,UAAU;AAAA,EACb,EAAA,CAAA;AAEJ;ACvGO,SAAS,aAAa;AAC3B,QAAM,EAAC,aAAa,UAAA,IAAa,gBAC3B,UAAU,CAAA,EAAQ,eAAe,YAAY,aAAa,eAAe,IAEzE,EAAC,GAAAnE,GAAA,IAAK;AAEZ,SAEI,qBAAA,UAAA,EAAA,UAAA;AAAA,IAAA,oBAAC,aAAY,EAAA;AAAA,IACb;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAG;AAAA,QACH,cAAYA,GAAE,4CAA4C;AAAA,QAC1D,MAAM,oCAAoC,SAAS;AAAA,QACnD,QAAO;AAAA,QACP,MAAMA,GAAE,iCAAiC;AAAA,QACzC,MAAM;AAAA,MAAA;AAAA,IACR;AAAA,IACC,WACC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAG;AAAA,QACH,cAAYA,GAAE,4CAA4C;AAAA,QAC1D,MAAM,oCAAoC,SAAS;AAAA,QACnD,QAAO;AAAA,QACP,MAAMA,GAAE,iCAAiC;AAAA,QACzC,MAAM;AAAA,MAAA;AAAA,IACR;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACXA,MAAM,aAAa,OAAO,IAAI;AAAA;AAAA;AAAA,GAKxB,YAAY,OAAO,GAAG;AAAA;AAAA,eAEb,CAAC,EAAC,MAAW,MAAA,MAAM,OAAO,OAAO,MAAM,CAAC,EAAE,IAAI;AAAA,gBAC7C,CAAC,EAAC,MAAW,MAAA,MAAM,OAAO,OAAO,MAAM,CAAC,EAAE,IAAI;AAAA;AAGvD,SAAS,WAAW;AACnB,QAAA,EAAC,aAAa,KAAI,IAAI,aACtB,GAAA,SAAS,uBACT,YAAY,uBAAA,GAEZ,gBAAgB,iBAAiB,2CAAa,QAAQ,GAEtD,EAAC,GAAAA,GAAC,IAAI,eAAe,GAErB,eAA2C;AAAA,IAC/C,OAAO;AAAA,MACL,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,iBAAiB;AAAA,MACjB;AAAA,MACA,eAAe;AAAA,IAAA;AAAA,IAEjB,CAAC,MAAM;AAAA,EAAA;AAIP,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QACE,oBAAC4N,UAAO,EAAA,MAAK,SAAQ,SAAS,GAAG,QAAO,QACtC,8BAAC,YAAW,EAAA,MAAM,GAAG,MAAK,KAAK,CAAA,GACjC;AAAA,MAEF,IAAG;AAAA,MACH,2BACG,YACC,EAAA,UAAA;AAAA,QAAA,oBAAC,QAAK,SAAS,GACb,UAAC,qBAAA,MAAA,EAAK,OAAM,UACV,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,UAAU,CAAC;AAAA,cACX,QAAM;AAAA,cACN,SAAS5N,GAAE,4BAA4B,EAAC,eAAc;AAAA,cAEtD,UAAA,qBAAC,WAAU,EAAA,aAAa,GACtB,UAAA;AAAA,gBAAA,oBAAC,YAAW,EAAA,MAAM,GAAG,MAAK,MAAK;AAAA,iBAC9B,2CAAa,aAAY,oBAAC,mBAAkB,EAAA,UAAU,YAAY,SAAU,CAAA;AAAA,cAAA,GAC/E;AAAA,YAAA;AAAA,UACF;AAAA,UAEC,qBAAA,OAAA,EAAM,OAAO,GAAG,MAAM,GACrB,UAAA;AAAA,YAAC,oBAAAc,QAAA,EAAK,MAAM,GAAG,QAAO,UAAS,cAAa,YACzC,qDAAa,MAChB;AAAA,YAEA,oBAACA,UAAK,MAAM,GAAG,OAAK,IAAC,cAAa,YAC/B,UAAA,eAAA,OAAA,SAAA,YAAa,OAChB;AAAA,UAAA,GACF;AAAA,QAAA,EAAA,CACF,EACF,CAAA;AAAA,QAEC,aAAc,oBAAA,gBAAA,EAAe,UAAsB,CAAA;AAAA,4BACnD,YAAW,EAAA;AAAA,4BACX,YAAW,EAAA;AAAA,QAEX,KAAK,UAEF,qBAAA,UAAA,EAAA,UAAA;AAAA,UAAA,oBAAC,aAAY,EAAA;AAAA,UACb;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,WAAW;AAAA,cACX,MAAMd,GAAE,2BAA2B;AAAA,cACnC,UAAU,CAAC,KAAK;AAAA,cACf,GAAI,KAAK,UAAU,EAAC,SAAS,KAAK,OAAM;AAAA,YAAA;AAAA,UAC3C;AAAA,QAAA,GACF;AAAA,MAAA,GAEJ;AAAA,MAEF,SAAS;AAAA,IAAA;AAAA,EAAA;AAGf;AC3EA,MAAMP,gBAAkB,CAAA,GAElB,YAAY,OAAO,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAUxB,WAAW,OAAO,IAAI;AAAA;AAAA,GAItB,UAAU,OAAO,IAAI;AAAA;AAAA,kCAEO,CAAC,EAAC,MAAW,MAAA,GAAG,MAAM,OAAO,MAAM,CAAC,CAAC,IAAI;AAAA;AAAA;AAAA;AAQpE,SAAS,aAAaN,QAA2C;AAChE,QAAA;AAAA;AAAA,IAEJ,oBAAoB,UAAUM;AAAAA,EAC5B,IAAAN,QAEE,EAAC,MAAM,MAAK,IAAI,aAAa,GAC7B,cAAc,eACd,GAAA,aAAa,cAAc,GAC3B,iBAAiB,OAAO,YAAY,QAAS,WAAW,YAAY,OAAO,QAE3E,qBAAqB,sBAAA,GACrB,EAAC,GAAAa,GAAC,IAAI,kBAEN;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACE,WAAW,aAAa,GAEtB,WAAW,qBAAqB,GAEhC,CAAC,YAAY,aAAa,IAAI,SAAkB,EAAK,GAErD,iBAAiB,OAAoB,WAAW,GAChD,mBAAmB,OAAe,IAAI;AAG5C,YAAU,MAAM;AACd,KAAI,eAAe,QAAQ,SAAS,YAAY,QAAQ,SAAS,iBAAiB,YAChF,cAAc,EAAK,GAGrB,eAAe,UAAU,aACzB,iBAAiB,UAAU;AAAA,EAAA,GAC1B,CAAC,MAAM,WAAW,CAAC;AAEtB,QAAM,CAAC,gBAAgB,iBAAiB,IAAI,SAAmC,IAAI,GAC7E,CAAC,oBAAoB,qBAAqB,IAAI,SAAmC,IAAI,GAErF,eAAe;AAAA,IACnB,OAAO;AAAA,MACL,WAAW,aAAa;AAAA,MACxB,uBAAuB,cAAc;AAAA,MACrC,aAAa,aAAa;AAAA,MAC1B,kBAAkB,cAAc;AAAA,MAChC,cAAc,aAAa,KAAK;AAAA,MAChC,uBAAuB,cAAc;AAAA,MACrC,OAAO,cAAc;AAAA,IAAA;AAAA,IAEvB,CAAC,UAAU;AAAA,EAAA;AAGb,YAAU,MAAM;AACd,iCAA6B,oBAAoB;AAAA,KAChD,CAAC,sBAAsB,4BAA4B,CAAC,GAMvD,UAAU,MAAM;AACV,iBAAa,mBACf,mBAAmB,EAAK,IAExB,6BAA6B,EAAK;AAAA,KAEnC,CAAC,8BAA8B,oBAAoB,aAAa,gBAAgB,CAAC;AAE9E,QAAA,mBAAmB,YAAY,MAAM;AACzC,uBAAmB,EAAI;AAAA,KACtB,CAAC,kBAAkB,CAAC,GAEjB,6BAA6B,YAAY,MAAM;AACnD,iCAA6B,EAAI;AAAA,KAChC,CAAC,4BAA4B,CAAC,GAE3B,oBAAoB,YAAY,MAAM;AAC1C,uBAAmB,EAAK;AAAA,KACvB,CAAC,kBAAkB,CAAC,GAEjB,8BAA8B,YAAY,MAAM;AACvB,iCAAA,EAAK,GAClC,sBAAoB,QAAA,mBAAA;EAAA,GACnB,CAAC,8BAA8B,kBAAkB,CAAC,GAE/C,oBAAoB,YAAY,MAAM;AAC5B,kBAAA,EAAK,GACnB,kBAAgB,QAAA,eAAA;KACf,CAAC,cAAc,CAAC,GAEb,mBAAmB,YAAY,MAAM;AACzC,kBAAc,EAAI;AAAA,KACjB,EAAE,GAEC,cAAc,QAAQ,MAAM;AAhKpC,QAAAF;AAiKI,WAAK,aAAa,SAEXA,MACH,WAAA,OAAA,SAAA,QAAA,OAAO,CAAC,MAAM,EAAE,aAAa,QAD1B,MAAA,OAAA,SAAAA,IAEH,IAAI,CAAC,WAEH;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,WAAW,UAAQ,OAAA,SAAA,OAAA;AAAA,QAEnB,MAAK;AAAA,QACL,SAAS,UAAQ,OAAA,SAAA,OAAA;AAAA,QACjB,UAAU,OAAO;AAAA,QACjB,MAAM,OAAO;AAAA,MAAA;AAAA,MAJR,OAAO;AAAA,IARY,CAAA,IAAA;AAAA,EAgB/B,GAAA,CAAC,SAAS,aAAa,KAAK,CAAC;AAEhC,6BACG,mBACC,EAAA,UAAA,qBAAC,aAAU,SAAS,KAAK,oBAAkB,sBACzC,UAAA;AAAA,IAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,cAAY;AAAA,QACZ,eAAY;AAAA,QACZ,WAAQ;AAAA,QACR,SAAS;AAAA,QACT,QAAO;AAAA,QAEP,UAAA,qBAAC,SAAQ,EAAA,KAAK,GAEZ,UAAA;AAAA,UAAC,oBAAA,2BAAA,EACC,+BAAC,MAAK,EAAA,OAAM,UAAS,KAAK,GAAG,SAAQ,cACnC,UAAA;AAAA,YAAA,qBAAC,MAAK,EAAA,OAAM,UAAS,KAAK,GAEvB,UAAA;AAAA,cAAA,CAAC,aAAa,SACb;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,MAAK;AAAA,kBACL,MAAM;AAAA,kBACN,SAAS;AAAA,kBACT,KAAK;AAAA,kBACL,cAAc,EAAC,SAASE,GAAE,qBAAqB,GAAG,WAAW,SAAQ;AAAA,gBAAA;AAAA,cACvE;AAAA,cAIF,qBAAC,MAAK,EAAA,KAAK,GACT,UAAA;AAAA,gBAAA,oBAAC,YAAW,EAAA;AAAA,oCACX,qBAAoB,EAAA;AAAA,cAAA,GACvB;AAAA,YAAA,GACF;AAAA,YAEA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACE,GAAG;AAAA,gBACJ,OAAO,aAAa,wBAAwB,WAAW;AAAA,cAAA;AAAA,YACzD;AAAA,YAEC,CAAC,aAAa,oBACb,oBAAC,gBAAa,SAAS,kBAAkB,KAAK,uBAAuB;AAAA,UAAA,EAAA,CAEzE,EACF,CAAA;AAAA,8BAGC,MAAK,EAAA,OAAM,UAAS,SAAQ,UAC1B,uBAAa,SACZ;AAAA,YAAC;AAAA,YAAA;AAAA,cACC;AAAA,cACA,cAAc;AAAA,cACd,SAAQ;AAAA,cACR,eAAe;AAAA,cACf;AAAA,YAAA;AAAA,UAAA,GAGN;AAAA,UAGA,oBAAC,6BACC,UAAC,qBAAA,MAAA,EAAK,OAAM,UAAS,KAAK,GAAG,SAAQ,YACnC,UAAA;AAAA,YAAC,qBAAA,MAAA,EAAK,KAAK,GAET,UAAA;AAAA,cAAA,oBAAC,iBACC,UAAC,oBAAA,gBAAA,EAAe,YAAY,aAAa,kBACvC,UAAC,oBAAA,yBAAA,EAAwB,SAAS,SAAS,MACxC,UAAa,aAAA,mBACX,oBAAA,gBAAA,EAAe,SAAS,0BACvB,UAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,SAAS;AAAA,kBACT,QAAQ;AAAA,kBACR,MAAM;AAAA,gBAAA;AAAA,iBAEV,IAEA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,SAAS;AAAA,kBACT,QAAQ;AAAA,kBACR,MAAM;AAAA,gBAAA;AAAA,cAAA,EAGZ,CAAA,EACF,CAAA,GACF;AAAA,cAEC,aAAa,SAAU,oBAAA,WAAA,EAAU,MAAK,UAAS;AAAA,cAC/C,aAAa,gBAAgB,oBAAC,oBAAmB,CAAA,CAAA;AAAA,cACjD,aAAa,aAAa,oBAAC,iBAAgB,CAAA,CAAA;AAAA,kCAE3C,cAAa,EAAA;AAAA,cAGb,aAAa,oBACZ;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,SAAS;AAAA,kBACT,KAAK;AAAA,gBAAA;AAAA,cACP;AAAA,cAGD;AAAA,YAAA,GACH;AAAA,YAEC,aAAa,SACZ,oBAAC,KAAI,EAAA,MAAK,QAAO,YAAY,GAC3B,UAAC,oBAAA,UAAA,CAAA,CAAS,EACZ,CAAA;AAAA,UAAA,EAAA,CAEJ,EACF,CAAA;AAAA,QAAA,GACF;AAAA,MAAA;AAAA,IACF;AAAA,IAEC,CAAC,aAAa,SACb;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,oBAAoB;AAAA,QACpB;AAAA,QACA,QAAQ;AAAA,QACR,SAAS;AAAA,QACT;AAAA,MAAA;AAAA,IACF;AAAA,EAAA,EAEJ,CAAA,EACF,CAAA;AAEJ;AC3RA,SAAS,gBAAgB,MAAqC;AAC5D,SAAO,CAAQ,CAAA;AACjB;AAEA,MAAM,uBAAuB,OAAO,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQ5C,YAAY,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA,GAsBhB,kBAAkB,WAAW,SACxCb,QACA,KACA;AACM,QAAA;AAAA,IACJ,UAAU;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EAAA,IACDA,QACE,CAAC,QAAQ,SAAS,IAAI,SAAgC,IAAI,GAC1D,CAAC,gBAAgB,iBAAiB,IAAI,SAAyB,CAAE,CAAA,GACjE,CAAC,cAAc,eAAe,IAAI,SAAS,EAAK,GAEhD,WAAW;AAAA,IACf,MAAM,SAAS,QAAQ,YAAY,EAAE,OAAO,eAAe;AAAA,IAC3D,CAAC,YAAY;AAAA,EAMT,GAAA,kBAAkB,QAAQ,MAC1B,aACA,CAAC,eAAqB,OAEnB,SAAS,OAAO,CAAC,MAAM,CAAC,eAAe,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,GAAG,CAAC,GACzE,CAAC,UAAU,WAAW,gBAAgB,YAAY,CAAC,GAEhD,sBAAsB;AAAA,IAC1B,OAAO;AAAA,MACL,MAAM;AAAA,MACN,WAAW;AAAA,MACX,YAAY;AAAA,IAAA;AAAA,IAEd,CAAC,MAAM;AAAA,KAGH,aAAa;AAAA,IACjB,OAAM,mBAAA,OAAA,SAAA,gBAAiB,WAAU,oBAAC,mBAAkB,EAAA;AAAA,IACpD,CAAC,eAAe;AAAA,KAGZ,mBAAmB;AAAA,IACvB,MACE,YACI;AAAA;AAAA,MAEA,SAAS,OAAO,CAAC,EAAC,IAAG,MAAM,eAAe,KAAK,CAAC,MAAoB,EAAE,QAAQ,GAAG,CAAC;AAAA;AAAA,IACxF,CAAC,UAAU,gBAAgB,SAAS;AAAA,KAGhC,qBAAqB;AAAA,IACzB,CAAC,GAA8B,UAAwB;AAC/C,YAAA,WAAW,eAAe,KAAK,CAAC,OAAO,GAAG,QAAQ,MAAM,GAAG;AAE5D,sBAAc,gBAAgB,EAAI;AACvC,YAAM,iBAAiB,EAAE;AACrB,OAAC,YAAY,CAAC,kBAAgB,kBAAkB,CAAC,SAAS,CAAC,GAAG,MAAM,KAAK,CAAC,GAC1E,YAAY,kBAEd,kBAAkB,CAAC,SAAS,KAAK,OAAO,CAAC,OAAO,GAAG,QAAQ,MAAM,GAAG,CAAC;AAAA,IACzE;AAAA,IACA,CAAC,gBAAgB,cAAc,iBAAiB,iBAAiB;AAAA,EAAA;AAGnE,SACG,qBAAA,MAAA,EAAK,WAAU,UAAS,KAAU,QAAO,UAAS,OAAO,EAAC,UAAU,WAAU,GAAI,GAAG,MACpF,UAAA;AAAA,IAAA,qBAAC,MAAK,EAAA,SAAQ,UAAS,KAAU,MAAM,GACpC,UAAA;AAAA,MAAA;AAAA,OACC,eAAe,SAAS,KAAK,cAC7B;AAAA,QAAC;AAAA,QAAA;AAAA,UACC;AAAA,UACA;AAAA,UACA;AAAA,UACA,aAAa;AAAA,UACb;AAAA,QAAA;AAAA,MACF;AAAA,IAAA,GAEJ;AAAA,IAGA,qBAAC,WAAU,EAAA,SAAQ,cAAa,KAAU,KAAK,WAAW,eAAW,IAAC,eAAY,QAC/E,UAAA;AAAA,MAAA,aAAa,YAAY;AAAA,QACxB,UAAU;AAAA,QACV,eAAe;AAAA,MAAA,CAChB;AAAA,MACA,YAAA,OAAA,SAAA,SAAU,IAAI,CAAC,UACd;AAAA,QAAC;AAAA,QAAA;AAAA,UAEC,SAAS;AAAA,UAET,sBAAsB,CAAC,MAAM,mBAAmB,EAAE,CAAC,GAAG,KAAK;AAAA,UAE1D,uBAAa,OAAO;AAAA,YACnB,UAAU;AAAA,YACV,eAAe;AAAA,YACf,UAAU;AAAA,UAAA,CACX;AAAA,QAAA;AAAA,QATI,GAAG,MAAM,GAAG;AAAA,MAAA,CAUnB;AAAA,IAAA,GAEJ;AAAA,EACF,EAAA,CAAA;AAEJ,CAAC,GClJY,WAAW,WAAW,SACjCA,QACA,KACA;AACA,QAAM,EAAC,MAAM,GAAG,KAAI,IAAIA,QAClB,QAAQ;AAAA,IACZ;AAAA,MACE,OAAO;AAAA,QACL,MAAM;AAAA;AAAA,QAEN,CAAC,IAAI,GAAG;AAAA,MAAA;AAAA,MAEV,CAAC,IAAI;AAAA,IACP;AAAA,EAAA;AAGF,SAAQ,oBAAA,WAAA,EAAU,OAAe,GAAG,MAAM,IAAU,CAAA;AACtD,CAAC;ACfM,SAAS,iBAAiBA,QAA8B;AAC7D,QAAM,EAAC,gBAAgB,MAAK,IAAIA,QAC1B,EAAC,OAAU,IAAA,kBACX,CAAC,gBAAgB,iBAAiB,IAAI,SAAgC,IAAI;AAEjE,iBAAA;AAAA,IACb,aAAa;AAAA,IACb,YAAY,CAAC,QAAQ;AAAA,EAAA,CACtB;AAED,QAAM,kBAAkB;AAAA,IACtB,OAAO;AAAA,MACL,SAAS;AAAA,QACP,eAAe;AAAA,QACf,QAAQ;AAAA,QACR;AAAA,MACF;AAAA,IAAA;AAAA,IAEF,CAAC,MAAM;AAAA,KAEH,WAAW;AAAA,IACf,MACE,MAAM,IAAI,CAAC,MAAM,UAAU;AACnB,YAAA,SAAQ,QAAM,OAAA,SAAA,KAAA,UAAS,UAAU,KAAK,IAAI,GAE1CuS,QAAO,WAAW,SACtB,WACA,KACA;AAEE,eAAA,oBAAC,YAAU,GAAG,WAAW,KAAU,MAAM,KAAK,MAC3C,UAAA,UAAU,SACb,CAAA;AAAA,MAAA,CAEH;AAGC,aAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAIA;AAAA,UACJ,WAAQ;AAAA,UAGR,MAAK;AAAA,UACL,UAAU,mBAAmB,KAAK;AAAA,UAClC,MAAM;AAAA,QAAA;AAAA,QAHD,GAAG,KAAK,IAAI,IAAI,KAAK;AAAA,MAAA;AAAA,IAI5B,CAEH;AAAA,IACH,CAAC,gBAAgB,KAAK;AAAA,EAAA;AAGxB,SACG,oBAAA,MAAA,EAAK,SAAQ,UAAS,SAAS,GAC9B,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ,KAAK;AAAA,MACL;AAAA,MACA,KAAK;AAAA,MAEJ;AAAA,IAAA;AAAA,EAEL,EAAA,CAAA;AAEJ;ACjEO,SAAS,iBAAiBvS,QAA8B;AAC7D,QAAM,EAAC,gBAAgB,WAAW,MAAA,IAASA;AAEpC,SAAA;AAAA,IACL,MACG,oBAAA,OAAA,EAAM,IAAG,MAAK,OAAO,GACnB,UAAA,MAAM,IAAI,CAAC,SAAS;AACb,YAAA,SAAQ,QAAM,OAAA,SAAA,KAAA,UAAS,UAAU,KAAK,IAAI,GAE1CuS,QAAO,WAAW,SACtB,WACA,KACA;AAEE,eAAA,oBAAC,YAAU,GAAG,WAAW,KAAU,MAAM,KAAK,MAC3C,UAAA,UAAU,SACb,CAAA;AAAA,MAAA,CAEH;AAGC,aAAA,oBAAC,OAAM,EAAA,IAAG,MACR,UAAA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,IAAIA;AAAA,UACJ,SAAQ;AAAA,UACR,MAAK;AAAA,UACL,UAAU,mBAAmB,KAAK;AAAA,UAClC,MAAK;AAAA,UACL,UAAU,YAAY,IAAI;AAAA,UAC1B,MAAM;AAAA,QAAA;AAAA,MAAA,KARU,KAAK,IAUzB;AAAA,IAEH,CAAA,GACH;AAAA,IAEF,CAAC,gBAAgB,WAAW,KAAK;AAAA,EAAA;AAErC;AC7CO,SAAS,eAAevS,QAAsB;AACnD,QAAM,EAAC,SAAS,eAAe,OAAO,GAAG,UAAa,IAAAA;AAEtD,SAAI,MAAM,UAAU,IACX,OAGL,YAAY,gCACN,kBAAiB,EAAA,WAAW,eAAe,OAAe,GAAG,UAAW,CAAA,wBAG1E,kBAAiB,EAAA,OAAe,GAAG,UAAW,CAAA;AACxD;ACdA,MAAM,iBAAiB,IACjB,wBAAwB;AAG9B,SAAS,yBAAyB,UAAkB;AAC5C,QAAA,qBAAqB,mBAAmB,QAAQ;AAEtD,SAAO,2BADY,+HAA+H,kBAAkB,4DAA4D,kBAAkB,2CACtM;AAC9C;AAEa,MAAA,cAAc,kBAAkB,CAACA,WAAU;AACtD,QAAM,EAAC,OAAO,KAAA,IAAQ,YAAYA,OAAM,KAAK;AAEtC,SAAA;AAAA;AAAA,0BAEiB,yBAAyB,MAAM,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAM/C,cAAc;AAAA,gBACb,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDASqB,MAAM,MAAM;AAAA,gBAC/C,qBAAqB;AAAA;AAAA;AAAA;AAAA,qDAIgB,MAAM,MAAM,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAQzC2N,OAAK,MAAM,WAAW,GAAG,CAAC;AAAA;AAAA;AAAA;AAAA,0BAI1B,MAAM,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAQb,KAAK,KAAK,MAAM;AAAA;AAAA;AAAA;AAAA,qBAIhB,KAAK,KAAK,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA,qBAIxB,KAAK,KAAK,QAAQ,MAAM;AAAA;AAAA;AAG7C,CAAC,GCjEK,eAAe,YAAY;AAQ1B,SAAS,cAAoB;AAClC,QAAM,EAAC,MAAM,UAAS,IAAI,SAAS;AAEnC,SAAA,UAAU,MAAM;AACT,QAAA;AAIE,aAAA,aAAa,UAAU,CAAC,QAAQ;AAGhC,YAAI,UAKL,aAAa,IAAI,KAAK,MAI1B,QAAQ,MAAM,IAAI,KAAK,GAEvB,UAAU;AAAA;AAAA;AAAA,UAGR,IAAI,IAAI,MAAM;AAAA,UACd,UAAU;AAAA,UACV,aAAa,IAAI,MAAM;AAAA,UACvB,UAAU;AAAA,UACV,OAAO;AAAA,UACP,QAAQ;AAAA,QACT,CAAA;AAAA,MAAA,CACF;AAAA,EAAA,GACA,CAAC,SAAS,CAAC,GAEP;AACT;AAEA,SAAS,aAAa,KAAqB;AASzC,SARI,eAAe,eAIf,eAAe,mBAIf,eAAe;AAKrB;ACtDO,SAAS,aAAa;AAAA,EAC3B;AAAA,EACA,wBAAwB;AAAA,EACxB,mBAAmB;AAAA,EACnB,4BAA4B;AAC9B,GAAsB;AACpB,QAAM,CAAC,OAAO,WAAW,IAAI,SAAkB,IAAI;AAC/C,MAAA;AAAa,UAAA;AAEX,QAAA,CAAC,UAAU,WAAW,IAAI;AAAA,IAC9B;AAAA,EAAA,GAEI,EAAC,oBAAmB;AAyB1B,SAvBA,UAAU,MAAM;AA3BlB,QAAAhN,KAAA;AA4BoB,KAAA,MAAAA,MAAA,gBAAA,MAAK,sBAArB,QAAA,GAAA,KAAAA,GAAA,EAA2C,MAAM,WAAA;AAAA,KAChD,CAAC,gBAAgB,IAAI,CAAC,GAEzB,UAAU,MAAM;AACd,UAAM,eAAe,gBAAgB,KAAK,MAAM,UAAU;AAAA,MACxD,MAAM,CAAC,EAAC,eAAe,kBAAiB;AAjC9C,YAAAA;AAkCQ,cAAIA,MAAa,eAAA,OAAA,SAAA,YAAA,UAAb,OAAoB,SAAAA,IAAA,YAAW,GAAG;AACpC,sBAAY,cAAc;AAE1B;AAAA,QACF;AAEY,oBAAA,gBAAgB,cAAc,YAAY;AAAA,MACxD;AAAA,MACA,OAAO;AAAA,IAAA,CACR;AAED,WAAO,MAAM;AACX,mBAAa,YAAY;AAAA,IAAA;AAAA,EAE7B,GAAG,CAAC,eAAe,CAAC,GAEhB,aAAa,gCAAmB,kBAAiB,CAAA,CAAA,IAEjD,aAAa,iBAAuB,oBAAC,6BAA0B,IAK/D,aAAa,eAAsB,oBAAA,uBAAA,EAAsB,IAEtD,oBAAA,UAAA,EAAG,SAAS,CAAA;AACrB;AC5DO,MAAM,WAAW;AAAA,EACtB,OAAO,CAAC,KAAK,IAAK;AACpB,GCOM,YAAY,gBAAgB;AAI3B,SAAS,wBAAwBX,QAA8C;AACpF,QAAM,SAAS,UAAU,EAAC,YAAY,cAAA,CAAc,GAE9C,YAAY,OAAO,OAAA,EAAS,WAC5B,QAAQ,QAAQ,MACb,mBAAmB,WAAW;AAAA;AAAA,IAEnC,eAAe;AAAA;AAAA,IAGf,gBAAgB,MAAM,OAAO,QAAQ,EAAC,KAAK,4BAA2B;AAAA;AAAA,IAGtE,YAAY,CAAC,UACX,OAAO,QAAQ;AAAA,MACb,KAAK;AAAA,MACL,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,MAAM,EAAC,WAAW,MAAK;AAAA,IAAA,CACxB;AAAA;AAAA,IAEH,YAAY,CAAC,UACX,UAAU,WAAW,OAAO,OAAO,eAAe,GAAG,KAAK,UAAU,EAAC,WAAW,MAAM,CAAA,CAAC;AAAA,EAC1F,CAAA,GACA,CAAC,QAAQ,SAAS,CAAC;AAEtB,SAAA,UAAU,MAAM;AACd,UAAM,OAAO,qBAAqB;AAAA,MAChC,WAAW,UAAU;AAAA,MACrB,QAAQ;AAAA,QACN,SAAS,OAAO;AAAA,QAChB,QAAQ,OAAO,OAAO;AAAA,QACtB,OAAO,OAAO,OAAO;AAAA,QACrB,aAAa,OAAO;AAAA,QACpB,YAAY,OAAO;AAAA,MACrB;AAAA,MACA,eAAe;AAAA,MACf,SAAS,OAAOA,OAAM,MAAM,EAAE;AAAA,QAC5B,CAAC,WAAQ;AAnDjB,cAAAW;AAoDU,mBAAAA,MAAA,OAAO,YAAP,OAAA,SAAAA,IAAgB,QAAQ,CAAC,YAAY;AAAA,YACnC,MAAM,OAAO,QAAQ;AAAA,UAAA,QAChB,CAAA;AAAA,QAAC;AAAA,MACZ;AAAA,IAAA,CACD;AAAA,EACA,GAAA,CAACX,OAAM,QAAQ,MAAM,MAAM,CAAC,GAEvB,oBAAA,mBAAA,EAAkB,OAAe,UAAAA,OAAM,SAAS,CAAA;AAC1D;ACtDO,MAAM,eAA0B,WAAW,GCY5C,gBAAgB,CAAC,UAAgC,MAAM,aAAa;AAE1E,SAAS,eAAe,OAA+B;AApBvD,MAAAW,KAAA;AAqBS,SAAA;AAAA,IACL,GAAG;AAAA,IACH,IAAI,MAAM;AAAA,IACV,OAAO,cAAc,KAAK,IAAI,aAAa,SAAQA,MAAA,MAAM,UAAN,OAAAA,MAAe,aAAa;AAAA,IAC/E,QAAO,KAAA,MAAM,UAAN,OAAA,KAAe,aAAa;AAAA,EAAA;AAEvC;AAGgB,SAAA,oBAAoB,EAAC,YAAqC;AAClE,QAAA,QAAQ,qBAAqB,gBAAgB;AAEnD,MAAI,MAAM,UAAU;AACZ,UAAA,SAAS,MAAM,SAAS,SAAS;AAErC,WAAA,oBAAC,2BAA2B,UAA3B,EAAoC,OAAO,IAC1C,UAAC,oBAAA,wBAAwB,UAAxB,EAAiC,OAAO,QACvC,8BAAC,eAAc,EAAA,QAAgB,OAAO,eAAe,KAAK,GACxD,8BAAC,eAAe,EAAA,SAAS,CAAA,EAC3B,CAAA,EACF,CAAA,EACF,CAAA;AAAA,EAEJ;AAGE,SAAA,oBAAC,iBAAc,OAAO,eAAe,KAAK,GACxC,UAAA,oBAAC,eAAe,EAAA,SAAS,CAAA,EAC3B,CAAA;AAEJ;AC7CA,MAAM,WAAW,OAAO,IAAI,KAEtB,mBAAmB,OAAO,GAAG,EAAE,MAAM,EAAC,SAAS,EAAE,CAAA;AAehD,SAAS,aAAa,EAAC,OAAO,SAAS,MAAM,SAA2B;AAC7E,YAAU,MAAM;AACd,YAAQ,MAAM,KAAK;AAAA,EAAA,GAClB,CAAC,KAAK,CAAC;AAEV,QAAM6R,QAAO,KAAK,KAAK,SAAS,CAAC;AAEjC,8BACG,kBAAiB,EAAA,aAAa,MAAM,WAAU,UAAS,KAAK,GAC3D,UAAA;AAAA,IAAC,oBAAA,MAAA,EAAK,WAAU,UAAS,KAAK,GAC5B,+BAAC7Q,QAAK,EAAA,QAAO,UAAS,MAAM,GACzB,UAAA;AAAA,MAAA,UAAU6Q,MAAK,IAAI;AAAA,MAAE;AAAA,IAAA,EAAA,CACxB,EACF,CAAA;AAAA,IAEA,oBAAC,MAAK,EAAA,MAAK,YAAW,UAAS,QAAO,SAAS,GAC7C,UAAA,oBAAC,MAAM,EAAA,UAAA,QAAQ,CAAA,GACjB;AAAA,IAEA,oBAAC,QAAK,IAAG,MAAK,WAAU,UAAS,KAAK,GACnC,UAAA,KAAK,IAAI,CAAC,EAAC,MAAM,QAAO,UACtB,qBAAA,UAAA,EAAS,aAAY,MAAK,KAAK,GAAG,OAAM,UACvC,UAAA;AAAA,MAAA,oBAAC,KACC,EAAA,UAAA,oBAAC,MAAM,EAAA,UAAA,KAAK,CAAA,GACd;AAAA,MACA,oBAAC,OACC,UAAC,oBAAA7Q,QAAA,EAAK,OAAK,IAAC,MAAM,GACf,UAAA,KAAA,CACH,EACF,CAAA;AAAA,IAAA,KARqD,KASvD,CACD,GACH;AAAA,IAEC,8BACE,WACC,EAAA,UAAA;AAAA,MAAC,oBAAAA,QAAA,EAAK,IAAG,WAAU,UAAW,eAAA;AAAA,MAE9B,oBAAC,OAAI,UAAS,QAAO,WAAW,GAC9B,UAAA,oBAAC,MAAM,EAAA,UAAA,MAAA,CAAM,EACf,CAAA;AAAA,IAAA,GACF;AAAA,EAEJ,EAAA,CAAA;AAEJ;AChEO,SAAS,aAAa,MAAkD;AACvE,QAAA,EAAC,WAAW,KAAK,UAAS,MAE1B,YAAY,MAAM,OAAO,UAAU,CAAC,eAAe;AACnD,QAAA,OAAO,MAAM,KAAK,CAAC,YAAY,QAAQ,SAAS,WAAW,IAAI;AAO/D,WAAA,CAAC,QAAQ,WAAW,SAAS,WAC/B,OAAO,MAAM,KAAK,CAAC,YAAY,QAAQ,SAAS,WAAW,IAGtD,OAAO,MAAM,MAAM,KAAK,MAAM,KAAK,KAAK,MAAM,IAAI,MAAM,OAAO,GAAG;AAAA,EAAA,CAC1E;AAEM,SAAA,MAAM,OAAO,UAAU,CAAC,MAAM,QAAQ,SAAS,GAAG,SAAS,CAAC;AACrE;ACrBO,SAAS,gBAAgB,OAAuB;AAErD,QAAM,SADuE,CACjD,EAAA,gBAAgB,CAAA,GACtC,QAAQ,OAAO,SAAS,CAAC,GACzB,SAAS,OAAO,UAAU,CAAA;AAEhC,MAAI,CAAC,MAAM,UAAU,CAAC,OAAO;AACpB,WAAA;AAGT,QAAM,QAAQ,MAAM,OAAoD,CAAC,QAAQ,SAAS;AAClF,UAAA,QAAQ,KAAK,SAAS;AAE5B,QAAI,CAAC,KAAK;AACR,aAAA,QAAQ,KAAK,SAAS,KAAK,8CAA8C,GAClE;AAGL,QAAA,OAAO,KAAK,IAAI,GAAG;AACrB,YAAM,WAAW,OAAO,KAAK,IAAI,EAAE,KAAK;AAChC,aAAA,QAAA,KAAK,8BAA8B,KAAK,IAAI,aAAa,KAAK,UAAU,QAAQ,IAAI,GACrF;AAAA,IACT;AAEA,UAAM,YAAY,MAAM,QAAQ,KAAK,IAAI;AAElC,WAAA,OAAA,KAAK,IAAI,IAAI;AAAA,MAClB;AAAA,MACA,OAAO,cAAc,KAAK,QAAY;AAAA,IAGjC,GAAA;AAAA,EAAA,GACN,CAAA,CAAE,GAEC,YAAY,CAAC,SAAe,OAAO,QAAQ,KAAK,IAAI,MAAM,IAE1D,MAAM,MAAM,OAAO,SAAS;AAE9B,SAAA,IAAA,KAAK,CAAC,OAAO,UAAU;AACzB,UAAM,QAAQ,MAAM,MAAM,IAAI,GACxB,QAAQ,MAAM,MAAM,IAAI,GAExB,SAAS,QAAQ,MAAM,QAAQ,OAC/B,SAAS,QAAQ,MAAM,QAAQ;AAEjC,WAAA,WAAW,SACN,IAGF,SAAS;AAAA,EACjB,CAAA,GAEM;AACT;AChDA,MAAM,gCAAgC,CAAC,UAAU,GAC3C,8BAA8B,CAAC,MAAM;AAE3C,SAAS,+BAA+B,OAAe,OAAuC;AAE5F,QAAM,cADe,gBAAgB,KAAK,EACT,CAAC;AAE9B,SAAA,CAAC,SAAS,MAAM,QAAQ,CAAC,cACpB,QAGF,OAAO,OAAO,CAAC,GAAG,OAAO;AAAA,IAC9B,MAAM,YAAY;AAAA,EAAA,CACnB;AACH;AAEA,SAAS,wBACP,OACA,OACgC;AAC3B,SAAA,UAID,gBAAgB,KAAK,EAAE,KAAK,CAAC,SAAS,KAAK,SAAS,MAAM,KAAK,IAC1D,EAAC,GAAG,OAAO,MAAM,MAAM,OAAO,OAAO,WAGvC;AACT;AAEgB,SAAA,oBACd,OACA,OACoB;AACY,SAAA;AAAA,IAC9B;AAAA,IACA,wBAAwB,OAAO,KAAK;AAAA,EAAA;AAIxC;AAEgB,SAAA,mBACd,OACA,WACA,WACa;AAtDf,MAAAhB;AAuDE,QAAM,EAAC,QAAQ,QAAQ,QAAA,IAAW;AAElC,MAAI,OAAO,UAAW;AACd,UAAA,IAAI,MAAM,yBAAyB;AAGvC,MAAA,CAACJ,WAAS,MAAM;AACZ,UAAA,IAAI,MAAM,gCAAgC;AAG5C,QAAA,eAAe,gBAAgB,KAAK,GAEpC,cAAc,+BAAW,OAC3B,aAAa,KAAK,CAAC,SAAS,KAAK,SAAS,UAAU,IAAI,IACxD,MAEE,aAAa,cACf,aAAa,OAAO,CAAC,SAAS,SAAS,WAAW,IAClD;AAEJ,MAAI,iBAA2B,CAAA;AAC3B,aAAW,WACb,iBAAiB,gCACR,WAAW,WACpB,iBAAiB;AAMnB,QAAM,eAAwD,EAAC,OAAO,IAAI,MAAM,QAC1E,EAAC,MAAM,kBAAiB,cAAc,CAAC,aAAa,GAAG,UAAU,IAAI,cAAc;AAAA,IACvF,CAAC,MAAM,SAAS;AACd,UAAI,CAAC,QAAQ,OAAO,KAAK,mBAAoB;AACpC,eAAA;AAGH,YAAA,YAAY,KAAK,gBAAgB,QAAQ,QAAQ,aAAa,UAAU,KAAK,IAAI,CAAC;AACxF,UAAI,OAAO,aAAc;AAEhB,eAAA,aAAa,KAAK,QAAQ,IAAI,EAAC,OAAO,GAAG,KAAQ,IAAA;AAItD,UAAA,CAACA,WAAS,SAAS;AACd,eAAA;AAIT,YAAM,QAAQ,eAAe,OAAO,CAAC,WAAW,kBACvC,iBAAiB,UAAU,UAAU,aAAa,MAAM,KAC3D,YAAY,IACZ,WACH,CAAC;AAEJ,aAAO,QAAQ,KAAK,QAAQ,EAAC,OAAO,KAAQ,IAAA;AAAA,IAC9C;AAAA,IACA;AAAA,EAAA;AAGF,MAAI,qCAAc,gBAAgB;AAChC,UAAM,aAAa,aAAa;AAAA,MAC9B;AAAA,MACA;AAAA,MACA,aAAc,UAAU,aAAa,IAAI;AAAA,MACzC;AAAA,OAGI,EAAC,eAAe,GAAG,UAAS,IAAI,YAEhC,eAAwC;AAAA,MAC5C,GAAG;AAAA,MACH,MAAM,aAAa;AAAA,MACnB,CAAC,aAAa,IAAI,GAAG;AAAA,IAAA;AAEnB,YAAAI,MAAA,aAAa,WAAb,QAAqBA,IAAA,qCACvB,aAAa,gBAAgB,gBAE7B,UAAU,gBAAgB,eAErB;AAAA,MACL,MAAM;AAAA,MACN,YAAY;AAAA,MACZ,OAAO;AAAA,IAAA;AAAA,EAEX;AAEO,SAAA;AAAA,IACL,MAAM;AAAA,IACN,YAAY;AAAA,IACZ,QAAQ,EAAC,MAAM,QAAQ,OAAM;AAAA,EAAA;AAEjC;AAEgB,SAAA,eAAe,YAAoB,UAAoC;AAC9E,SAAA;AAAA,IACL,MAAM;AAAA,IACN,OAAO,WAAW,OAAO,QAAQ,KAAK,CAAC;AAAA,IACvC,YAAY,WAAW,WAAW,QAAQ;AAAA,EAAA;AAE9C;ACpIO,SAAS,wBAAwB;AAAA,EACtC;AAAA,EACA;AAAA,EACA;AACF,GAAiC;AAC/B,QAAM,EAAC,UAAU,MAAK,IAAI,WACpB6P,WAAU,iBAAiB,GAC3B,SAAS,QAAQ,MAAM,aAAa,EAAC,UAAU,MAAM,CAAA,GAAG,CAAC,UAAU,KAAK,CAAC,GACzE,CAAC,OAAO,UAAU,IAAI,8BAA8BA,UAAS,QAAQ,KAAK;AAI3E,SAAA,4BAGF,gBAAe,EAAA,YAAwB,QAAgB,OACrD,SACH,CAAA,IALiB,oBAAC,kBAAiB,CAAA,CAAA;AAOvC;AAOA,SAAS,8BACPA,UACA,QACA,OACsC;AArDxC,MAAA7P;AAyDQ,QAAA,QAAQ,QAAQ,MAAM;AAC1B,UAAM,iBAAiB,OAAO,YAAY,GAGpC,sBAAsB,IAAI,OAAO,IAAIuQ,eAAa,cAAc,CAAC,WAAW,GAAG,GAC/E,eAAe,CAAC;AAAA;AAAA,MAEpB,mBAAmB,MAAM,KAAO,oBAAoB,KAAK,QAAQ;AAAA;AAC5D,WAAA;AAAA,MACL,WAAW,CAAC,kBAA8BV,SAAQ,OAAO,aAAa;AAAA,MACtE,aAAa,MAAM,GAAGA,SAAQ,SAAS,QAAQ,GAAGA,SAAQ,SAAS,UAAU,EAAE;AAAA;AAAA,MAE/E,mBAAmB,MAAM;AAAA,MACzB,UAAU,CAAC,aACT,OAAO,YAAa,YAAY,aAAa,QAAQ,IACjD,eAAe,QAAQ,QAAQ,IAC/B;AAAA,IAAA;AAAA,KAEP,CAACA,UAAS,MAAM,CAAC,GAEd,QAAQ;AAAA,IACZ,MAAM;AAAA,IACN,MAAM;AAAA,IACN,MAAM;AAAA,IACN,MAAM;AAAA,IACN5Q;AAAAA,EAAA,GASI,YAAY,OAAO,KAAK;AAG9B,YAAU,MAAM;AA9FlBe,QAAAA;AA+FQ,SAAA,SAAA,OAAA,SAAA,MAAO,UAAS,WAAW,GAACA,OAAA,MAAM,UAAN,QAAAA,KAAa,SAAQ;AACnD,YAAM,eAAe,oBAAoB,OAAO,MAAM,KAAK;AACvD,sBAAgB,iBAAiB,MAAM,SACzC6P,SAAQ,QAAQ,OAAO,OAAO,YAAY,CAAC;AAAA,IAE/C;AAAA,EAAA,GACC,CAAC,SAAO,OAAA,SAAA,MAAA,OAAO,SAAO,OAAA,SAAA,MAAA,MAAMA,UAAS,QAAQ,KAAK,CAAC,GAItD,UAAU,MAAM;AACd,UAAM,iBAAiB,mBAAmB,OAAO,QAAQ,OAAO,SAAS;AAErE,qBAEFA,SAAQ,QAAQ,cAAc,IAQ9B,UAAU,UAAU;AAAA,KAErB,CAAC,OAAOA,UAAS,QAAQ,KAAK,CAAC;AAElC,QAAM,iBAAiB,QAAwB,MAItC,CAAC,EAAC,MAAM,cAAa;AAE1B,UAAM,iBAAiB,MAAM,SAAS,IAAI,GACpC,iBAAiB,mBAAmB,gBAAgB,QAAQ,OAAO,SAAS,GAC5E,eAAe,OAAO,kBAAmB,WAAW,iBAAiB;AAEvE,cACFA,SAAQ,QAAQ,YAAY,IAE5BA,SAAQ,KAAK,YAAY;AAAA,KAG5B,CAACA,UAAS,QAAQ,OAAO,KAAK,CAAC;AAElC,SAAO,EAAC7P,MAAA,SAAA,OAAA,SAAA,MAAO,UAAP,OAAAA,MAAgB,MAAM,cAAc;AAC9C;AAGA,SAAS,mBACP,OACA,QACA,OACA,WACe;AArJjB,MAAAA,KAAA;AAsJE,OAAI,+BAAO,UAAS,YAAWA,MAAM,MAAA,UAAN,YAAa,QAAQ;AAClD,UAAM,gBAAgB;AAAA,MACpB;AAAA,QACA,KAAA,UAAU,YAAV,OAAmB,SAAA,GAAA,UAAS,UAAU,UAAU,QAAQ,QAAQ,CAAC;AAAA,MACjE,MAAM;AAAA,IAAA;AAGR,SAAI,+CAAe,UAAS;AACnB,aAAA,OAAO,OAAO,cAAc,KAAK;AAAA,EAE5C;AAEO,SAAA;AACT;ACvIO,SAAS,mBAAmB,iBAAmC;AACpE,QAAM,CAAC,OAAO,WAAW,IAAI,SAAkB,IAAI;AAC/C,MAAA;AAAa,UAAA;AAEjB,QAAM,CAAC,WAAW,YAAY,IAAI,SAA2B,IAAI;AAEjE,SAAA,UAAU,MAAM;AACd,UAAM,eAAe;AAAA,MACnB,gBAAgB,WAAW,QAAQ;AAAA,QAAI,CAAC,EAAC,aACvC,OAAO;AAAA,UACL,WAAW,CAAC,QAAQ;AAClB,gBAAI,eAAe;AAAuB,qBAAO,GAAG,GAAG;AACjD,kBAAA;AAAA,UAAA,CACP;AAAA,QACH;AAAA,MACF;AAAA,IAAA,EAEC;AAAA,MACC,IAAI,CAAC,YAAsB;AACzB,cAAM,SAAS,QAAQ,OAAO,CAAC,WAAW,kBAAkB,qBAAqB;AACjF,YAAI,OAAO;AACT,gBAAM,IAAI,sBAAsB;AAAA,YAC9B,MAAM,gBAAgB;AAAA,YACtB,QAAQ;AAAA,YACR,MAAM;AAAA,UAAA,CACP;AAGI,eAAA;AAAA,MAAA,CACR;AAAA,MACD;AAAA,QACE,CAAC,CAAC,YAAe,gBAAa,OAAkB;AAAA,UAC9C,GAAG;AAAA,UACH,GAAG;AAAA,UACH,kBAAkB,CAAC,YAAY,GAAG,aAAa;AAAA,UAC/C,MAAM;AAAA,QAAA;AAAA,MAEV;AAAA,MAED,UAAU;AAAA,MACT,MAAM;AAAA,MACN,OAAO;AAAA,IAAA,CACR;AAEI,WAAA,MAAM,aAAa;EAAY,GACrC,CAAC,eAAe,CAAC,GAEb;AACT;AAEA,SAAS,gBAAgB;AAAA,EACvB;AAAA,EACA;AACF,GAAwD;AACtD,QAAM,EAAC,gBAAe,IAAI,sBACpB,YAAY,mBAAmB,eAAe;AAC/C,SAAA,YAQF,oBAAA,mBAAA,EAAkB,WACjB,UAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MAEC,QAAQ,UAAU,iBAAiB,CAAC;AAAA,MAEpC,UAAC,oBAAA,yBAAA,EAAwB,kBAAoC,WAC1D,UACH;AAAA,IAAA;AAAA,EACF,EAAA,CACF,IAjBqB,oBAAC,kBAAiB,CAAA,CAAA;AAmB3C;AAKA,SAAS,wBAAwB,EAAC,uBAAuB,GAAGX,UAA8B;AAClF,QAAA,CAAC,EAAC,MAAA,GAAQ,QAAQ,IAAI,SAA2B,EAAC,OAAO,KAAA,CAAK;AAShE,MAAA;AAAa,UAAA;AAGf,SAAA,oBAAC,iBAAc,SAAS,UACtB,8BAAC,iBAAiB,EAAA,GAAGA,OAAO,CAAA,EAC9B,CAAA;AAEJ;AC9FA,UAAU,iBAAiB,IAAI;AAC/B,UAAU,iBAAiB,UAAU;AACrC,UAAU,iBAAiB,IAAI;AAC/B,UAAU,iBAAiByS,IAAG;AAC9B,UAAU,iBAAiB,UAAU;AAY9B,SAAS,eAAe;AAAA,EAC7B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,kBAAkBjC;AAAA,EAClB,yBAAyB;AAC3B,GAAwB;AACtB,QAAM,YACH,oBAAAkC,yBAAA,EAAgB,kBAAkB,cAAc,uBAAuB,oBACtE,UAAA,oBAAC,yBAAwB,EAAA,QACvB,8BAAC,gBACC,EAAA,UAAA,oBAAC,yBAAuB,UAAS,EAAA,CACnC,EACF,CAAA,EACF,CAAA;AAIA,SAAA,oBAAC,qBAAoB,EAAA,gBAAgC,QACnD,UAAA,qBAAC,iBAAc,UAAU,GAAG,SAAS,SAAS,OAC5C,UAAA;AAAA,IAAA,oBAAC,aAAY,EAAA;AAAA,IACZ,oBAAA,qBAAA,EACC,UAAC,oBAAA,oBAAA,EAAmB,QAAgB,UAClC,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,kBAAkBlC;AAAA,QAClB,mBAAmB;AAAA,QACnB,kBAAkB;AAAA,QAElB,UAAC,oBAAA,qBAAA,EACC,UAAC,oBAAA,0BAAA,EACE,2BACC,YAEA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,kBAAkB;AAAA,YAClB,uBAAuB;AAAA,YACvB,2BAA2B;AAAA,YAE1B,UAAA;AAAA,UAAA;AAAA,WAGP,EACF,CAAA;AAAA,MAAA;AAAA,OAEJ,EACF,CAAA;AAAA,EAAA,EACF,CAAA,EACF,CAAA;AAEJ;AC1EO,SAAS,UAAU,eAAmD;AAC3E,QAAM,SAAS;AACf,SAAK,gBAOE,OAAO,UAAU,aAAa,KANnC,QAAQ;AAAA,IACN;AAAA,EAAA,GAEK,OAAO,UAAU,EAAC,YAAY,cAAa;AAItD;ACnBO,SAAS,aAAqB;AACnC,SAAO,UAAY,EAAA;AACrB;ACZgB,SAAA,qBAAqB,gBAAwB,aAAoC;AAC/F,QAAM,gBAAgB;AACf,SAAA;AAAA,IACL,MAAM,cAAc,KAAK,eAAe,gBAAgB,WAAW;AAAA,IACnE,CAAC,aAAa,cAAc,MAAM,cAAc;AAAA,EAAA;AAEpD;ACFA,MAAMlQ,gBAAkB,CAAC,GASnB,wBAAkC;AAAA,EACtC,SAAS;AAAA,EACT,OAAO;AAAA,EACP,UAAUA;AAAAA,EACV,WAAW;AACb;AAKA,SAAS,cAAc,EAAC,mBAAyE;AACxF,SAAA,gBAAgB,WAAW,QAAkB;AAAA,IAClD,KAAK;AAAA,IACL,KAAK;AAAA,EAAA,CACN;AACH;AAEA,MAAM,2CAA2B;AAG1B,SAAS,kBAAkB,YAA8B;AAC9D,QAAM,kBAAkB,UAAU,6BAA6B,GACzD,EAAC,UAAA,IAAa;AAEpB,MAAI,CAAC,qBAAqB,IAAI,SAAS,GAAG;AAClC,UAAA,WAAW,cAAc,EAAC,gBAAgB,CAAA,EAAE,KAAK,aAAa;AAC/C,yBAAA,IAAI,WAAW,QAAQ;AAAA,EAC9C;AAEoB,SAAA;AAAA,IAClB,OACG,qBAAqB,IAAI,SAAS,KAAK,GAAGA,aAAW,GAAG;AAAA,MACvD,IAAI,CAAC,WAAW,QAAQ;AAAA,QACtB,WAAW;AAAA,QACX,SAAS,CAAQ,EAAA,YAAA,QAAA,SAAU,SAAS,UAAA;AAAA,QACpC;AAAA,QACA,OAAO;AAAA,MAAA,EACP;AAAA,MACF,UAAU,qBAAqB;AAAA,MAC/B,WAAW,CAAC,UACH,GAAG,EAAC,WAAW,IAAO,SAAS,IAAO,UAAUA,eAAa,MAAM,CAAA,CAC3E;AAAA,IACH;AAAA,IACF,CAAC,YAAY,SAAS;AAAA,IACtB;AAAA,EAAA;AAIJ;ACnDO,SAAS,eAAuB;AACrC,SAAO,UAAY,EAAA;AACrB;ACEA,MAAM,eAAe,MAAO,GACtB,iBAAiB,MAAO,IACxB,aAAa,MAAO,IACpB,WAAW,aAAa,IAExB,2BAAuD;AAAA,EAC3D,OAAO;AAAA,EACP,KAAK;AACP,GAEM,mBAA+C;AAAA,EACnD,GAAG;AAAA,EACH,MAAM;AACR,GAEM,mBAA+C;AAAA,EACnD,GAAG;AAAA,EACH,MAAM;AAAA,EACN,QAAQ;AACV;AAWO,SAAS,gBAAgB,MAAqB,UAA+B,IAAY;AAC9F,QAAM,WAAW,sBAAsB,MAAM,OAAO,GAE9C,CAAG,EAAA,WAAW,IAAI,WAAW,CAAC,MAAM,IAAI,GAAG,CAAC;AAElD,SAAA,UAAU,MAAM;AACV,QAAA;AAEJ,aAAS,KAAK,UAAkB;AACpB,gBAAA,OAAO,WAAW,MAAM;AACpB,oBAAA,GAGZ,UAAU,OAAO,WAAW,MAAM,KAAK,QAAQ,GAAG,QAAQ;AAAA,SACzD,QAAQ;AAAA,IACb;AAEA,WAAI,SAAS,oBAAoB,QAC/B,KAAK,SAAS,eAAe,GAGxB,MAAM;AACP,kBAAY,QACd,aAAa,OAAO;AAAA,IAAA;AAAA,EAExB,GACC,CAAC,aAAa,SAAS,eAAe,CAAC,GAEnC,SAAS;AAClB;AAEA,SAAS,sBAAsB,MAAqB,OAA4B,IAAc;AACtF,QAAA,EAAC,GAAAO,GAAC,IAAI,eAAe,GACrB,gBAAgB,iBAAmB,EAAA,IAEnC,EAAC,UAAU,QAAO,IAAI,MACtB,aAAa,gBAAgB,OAAO,OAAO,IAAI,KAAK,IAAI,GACxD,oBAAoB,CAAA,CAAQ,KAAK,mBACjCiB,UAAS;AAAA,IACb,SAAwB,OAAe,MAA2C;AAChF,YAAM,kBAAkB,SAAS,SAAS,KAAK,IAAI,KAAK,MAAM,GACxD,mBAAmB,SAAS,UAAU,KAAK,IAAI,KAAK,MAAM;AAEhE,aAAI,qBAAqB,kBAChB,UACJ,mBAAmB,eAAe;AAAA;AAAA;AAAA;AAAA,QAIjC,OAAO,WAAW,CAAC,mBAAmB,UAAU;AAAA,QAChD,SAAS;AAAA,MAAA,CACV,EACA,OAAO,OAAO,IAAI,IAGhB,UACJ,aAAa,eAAe,EAAC,OAAO,QAAQ,MAAM,aAAa,UAAU,UAAU,OAAO,CAAA,EAC1F,OAAO,KAAK,IAAI,KAAK,CAAC;AAAA,IAC3B;AAAA,IACA,CAAC,eAAe,mBAAmB,OAAO;AAAA,EAAA;AAMxC,MAAA,CAAC,WAAW,QAAQ;AACf,WAAA;AAAA,MACL,WAAW;AAAA,MACX,iBAAiB;AAAA,IAAA;AAIrB,QAAM,MAAM,KAAK,cAAc,KAAK,IAC9B,GAAA,aAAa,mBAAmB,KAAK,UAAU,GAC/C,YAAY,kBAAkB,KAAK,UAAU;AAEnD,MAAI,cAAc;AACZ,WAAA,KAAK,WAAW,cAAc,IAEzB;AAAA,MACL,WAAW,UACR,eAAe,eAAe,EAAC,GAAG,0BAA0B,SAAS,CAAA,EACrE,OAAO,UAAU;AAAA,MACpB,iBAAiB;AAAA,IAAA,IAIjB,KAAK,UACA;AAAA,MACL,WAAW,UACR,eAAe,eAAe,EAAC,GAAG,kBAAkB,SAAS,CAAA,EAC7D,OAAO,UAAU;AAAA,MACpB,iBAAiB;AAAA,IAAA,IAId;AAAA,MACL,WAAW,UACR,eAAe,eAAe,EAAC,GAAG,kBAAkB,SAAS,CAAA,EAC7D,OAAO,UAAU;AAAA,MACpB,iBAAiB;AAAA,IAAA;AAIf,QAAA,YAAY,kBAAkB,YAAY,GAAG;AAC/C,MAAA;AACK,WAAA;AAAA,MACL,WAAWA,QAAO,WAAW,MAAM;AAAA,MACnC,iBAAiB;AAAA,IAAA;AAIf,QAAA,WAAW,iBAAiB,YAAY,GAAG;AAC7C,MAAA;AACK,WAAA;AAAA,MACL,WAAWA,QAAO,UAAU,KAAK;AAAA,MACjC,iBAAiB;AAAA,IAAA;AAIf,QAAA,YAAY,kBAAkB,YAAY,GAAG;AAC/C,MAAA;AACK,WAAA;AAAA,MACL,WAAWA,QAAO,WAAW,MAAM;AAAA,MACnC,iBAAiB;AAAA,IAAA;AAIf,QAAA,WAAW,oBAAoB,YAAY,GAAG;AAChD,MAAA;AACK,WAAA;AAAA,MACL,WAAWA,QAAO,UAAU,QAAQ;AAAA,MACpC,iBAAiB;AAAA,IAAA;AAIf,QAAA,cAAc,oBAAoB,YAAY,GAAG;AACvD,SAAI,KAAK,IAAI,WAAW,IAAI,KACnB;AAAA,IACL,WAAWA,QAAO,aAAa,QAAQ;AAAA,IACvC,iBAAiB;AAAA,EAAA,IAId,EAAC,WAAWjB,GAAE,wBAAwB,GAAG,iBAAiB;AACnE;ACjLO,SAAS,YAAoB;AAClC,SAAO,UAAY,EAAA;AACrB;ACXO,SAAS,eAA2B;AACzC,SAAO,UAAY,EAAA;AACrB;ACIA,MAAM,aAAa,OAAOc,MAAI;AAAA;AAAA;AAcvB,SAAS,eAAe,EAAC,cAAc,OAAO,WAAW,cAAkC;AAC1F,QAAA,EAAC,GAAAd,GAAK,IAAA,kBACN,iBAAiB,SAAS,gBAAgB,QAAQ,MAAM,aAAa,IACrE,qBAAqB,aAAa,gBAAgB,YAAY,UAAU,aAAa,IAErF,iBAAiB,kBAAkB;AAAA,IACvC,WAAW;AAAA,IACX,WAAW;AAAA,EAAA,CACZ,GAEK,oBAAoB,kBAAkB,eAAe,OAAO,IAAI,KAAK,cAAc,CAAC,GACpF,wBACJ,sBAAsB,eAAe,OAAO,IAAI,KAAK,kBAAkB,CAAC,GAEpE,sBAAsB,gBAAgB,kBAAkB,IAAI;AAAA,IAChE,SAAS;AAAA,IACT,mBAAmB;AAAA,EACpB,CAAA,GACK,0BAA0B,gBAAgB,sBAAsB,IAAI;AAAA,IACxE,SAAS;AAAA,IACT,mBAAmB;AAAA,EAAA,CACpB,GAEK,gBAAgB,eAAe,wBAAwB,yBACvD,cAAc,eAAe,oBAAoB;AAGrD,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAO,aAAa,WAAW;AAAA,MAC/B,WAAW,aAAa,QAAQ;AAAA,MAChC,KAAK;AAAA,MACL,MAAK;AAAA,MAEJ,UAAA;AAAA,QAAC,CAAA,qCACC,YAAW,EAAA,MAAM,GAAG,QAAO,UACzB,UAAEA,GAAA,+BAA+B,EACpC,CAAA;AAAA,QAED,iBACC,oBAAC,YAAW,EAAA,MAAM,GAAG,QAAO,UACzB,UAAAA,GAAE,6BAA6B,EAAC,MAAM,cAAA,CAAc,EACvD,CAAA;AAAA,QAED,eACC,oBAAC,YAAW,EAAA,OAAK,IAAC,MAAM,GAAG,MAAK,UAC7B,aAAE,0BAA0B,EAAC,MAAM,YAAY,CAAA,GAClD;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAIR;AC3EA,SAAS,yBAA4B,OAAgC;AAC7D,QAAA,MAAM,OAAsB,MAAS;AAEtC,SAAA,cAAc,OAAO,IAAI,OAAO,MACnC,IAAI,UAAU,QAGT,CAAC,IAAI,OAAO;AACrB;AAEA,SAAS,wBAAwB,UAA0B,cAAmB;AAElE,YAAA,UAAU,yBAAyB,YAAY,CAAC;AAC5D;AAGO,MAAM,qBAAqB;AAAA,EAChC,SAA4Bb,QAAY;AAChC,UAAA,EAAC,MAAM,MAAM,IAAAR,KAAI,QAAQ,SAAS,oBAAmBQ,QAErD,YAAY,KAAK;AAAA,MACrB,GAAG;AAAA,MACH,YAAY,MAAM;AAChB,gBAAQR,GAAE;AAAA,MACZ;AAAA,IAAA,CACD;AAED,WAAA,wBAAwB,OACtB,OAAOA,KAAI,SAAS,GACpB,gBAAA,GACO,MAAM;AACJ,aAAAA,KAAI,IAAI,GACf,gBAAgB;AAAA,IAAA,IAEjB,SAAS,GAEL;AAAA,EACT;AAAA,EACA,CAAC,MAAM,SAAS,KAAK,SAAS,KAAK;AACrC,GCfM,cAAc,CAAA;AAGb,SAAS,+BAA+B;AAAA,EAC7C;AAAA,EACA;AACF,GAAwC;AACtC,QAAM,EAAC,GAAAqB,OAAK,kBAEN,OAAO,cAAc,EAAC,OAAO,SAAS,MAAM,OAAO,CAAA,GACnD,SAAQ,eAAa,OAAA,SAAA,YAAA,UAAS,aAE9B,QAAQ;AAAA,IACZ,MACE,oBAAA,UAAA,EACG,UACE,KAAA,cAAc,MAAM,IAAI,CAAC,SAAS,KAAK,SAAS,UAAU,KAAK,IAAI,CAAC,CAAC,EACrE;AAAA,MAAI,CAAC,GAAG,UACP,EAAE,SAAS;AAAA;AAAA,QAET,oBAAC,UAAkC,UAAE,EAAA,MAAA,GAA1B,GAAG,EAAE,KAAK,IAAI,KAAK,EAAa;AAAA;AAAA;AAAA,QAG3C,oBAACU,YAAA,EAAsC,UAAE,EAAA,MAAA,GAA1B,GAAG,EAAE,KAAK,IAAI,KAAK,EAAa;AAAA;AAAA,IAAA,GAGvD;AAAA,IAEF,CAAC,OAAO,IAAI;AAAA,EAAA;AAGd,8BACG,KACC,EAAA,UAAA;AAAA,IAAC,qBAAA,QAAA,EAAO,OAAO,GACb,UAAA;AAAA,MAAA,oBAACI,QAAK,EAAA,MAAM,GACV,UAAA,oBAAC,mBAAiB,CAAA,GACpB;AAAA,MACA,oBAACA,UAAK,MAAM,GAAG,QAAO,UACnB,UAAAd,GAAE,wCAAwC,GAC7C;AAAA,IAAA,GACF;AAAA,wBACC,QAAO,EAAA,WAAW,GACjB,UAAC,oBAAAc,QAAA,EAAK,MAAM,GACV,UAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAQ;AAAA,QACR,GAAAd;AAAA,QACA;AAAA,MAAA;AAAA,OAEJ,EACF,CAAA;AAAA,IACA,oBAAC,UAAO,WAAW,GAAG,cAAc,GAClC,UAAA,oBAACc,UAAK,MAAM,GACV,8BAAC,WAAU,EAAA,SAAQ,0CAAyC,GAAAd,IAAM,YAAY,EAAC,MAAK,GAAG,GACzF,EACF,CAAA;AAAA,EACF,EAAA,CAAA;AAEJ;ACtEA,MAAM,kBAAkB,OAAOkN,WAAS,EAA6B,CAAC/N,WAAU;AACxE,QAAA,EAAC,MAAS,IAAAA,QACV,EAAC,WAAW,UAAS,MAAM;AAEjC,SAAO,YAAY,OAAOA,OAAM,QAAQ,CAAC,SAAS;AAAA;AAAA,IAEhD,OAAO,QAAQ,SAAS,SAAS,IAAI,UAAU,GAAG,CAAC;AAAA;AAAA,IAEnD,UAAU;AAAA,EACV,EAAA;AACJ,CAAC,GAMY,mBAAmB,WAAW,SACzCA,QACA,KACA;AACM,QAAA,EAAC,OAAO,GAAG,cAAaA,QACxB,WAAW,aAAa,KAAK;AAE5B,SAAA,oBAAC,mBAAiB,GAAG,WAAW,WAAQ,oBAAmB,QAAQ,UAAU,IAAU,CAAA;AAChG,CAAC,GC7BK,gBAAgB,OAAO,OAAO,EAAE,MAC7B;AAAA;AAAA;AAAA;AAAA;AAAA,GAMR,GAGK,cAAc,OAAO,KAAK,EAAE,CAACA,WAA0B;AAC3D,QAAM,QAAQA,OAAM,MAAM,OAAO,OAAO,CAAC;AAElC,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAMqB,KAAK;AAAA,+BACJ,KAAK;AAAA;AAEpC,CAAC;AAYM,SAAS,cAAcA,QAA2B;AACjD,QAAA,EAAC,UAAU,QAAQ,SAAS,kBAAkB,cAAc,UAASA,QAErE,cAAc,YAAY,MAAM;AACpC,eAGA,oBAAkB,QAAA,iBAAA,MAAA;AAAA,EAAA,GACjB,CAAC,SAAS,gBAAgB,CAAC;AAoC5B,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,QAAM;AAAA,MACN,eAAa;AAAA,MACb,SAnCD,oBAAA,kBAAA,EAAiB,OAChB,UAAA,oBAACqS,WAAU,EAAA,WAAS,IAClB,UAAA,qBAAC,OAAM,EAAA,KAAK,cACV,UAAA;AAAA,QAAA,oBAAC,aACC,EAAA,UAAA,oBAAC,KAAI,EAAA,SAAS,GAAG,aAAa,GAC5B,UAAA,qBAAC,MAAK,EAAA,OAAM,UAAS,KAAK,GACxB,UAAA;AAAA,UAAA,oBAAC,KAAI,EAAA,MAAM,GACT,UAAA,oBAAC1Q,QAAK,EAAA,MAAM,GAAG,cAAa,YAAW,QAAO,UAC3C,UAAA,OACH,CAAA,GACF;AAAA,UACA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,MAAM;AAAA,cACN,MAAK;AAAA,cACL,SAAS;AAAA,cACT,cAAc,EAAC,SAAS,QAAO;AAAA,YAAA;AAAA,UACjC;AAAA,QAAA,EACF,CAAA,EACF,CAAA,GACF;AAAA,QACC,oBAAA,KAAA,EAAI,SAAS,GAAI,SAAS,CAAA;AAAA,MAAA,EAC7B,CAAA,EACF,CAAA,GACF;AAAA,MAaE,MAAI;AAAA,MACJ;AAAA,IAAA;AAAA,EAAA;AAGN;AC1FA,MAAM,aAAa,OAAO,IAAI,EAAE,MACvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAWR,GAOK,qBAAqB,cAAuC,EAAC,UAAU,IAAM;AAG5E,SAAS,iBAA0C;AAClD,QAAA,UAAU,WAAW,kBAAkB;AAE7C,MAAI,CAAC;AACG,UAAA,IAAI,MAAM,oCAAoC;AAG/C,SAAA;AACT;AAGO,MAAM,cAAc,WAAW,SACpC3B,QACA,KACA;AACA,QAAM,EAAC,UAAU,UAAU,IAAI,GAAG,UAAa,IAAAA;AAE/C,6BACG,YAAW,EAAA,WAAQ,eAAe,GAAG,WAAW,aAAa,IAAI,KAAU,UAC1E,UAAC,oBAAA,mBAAmB,UAAnB,EAA4B,OAAO,EAAC,YAAY,UAAS,EAC5D,CAAA;AAEJ,CAAC,GC/CY,gBAMT;AAAA,EACF,OAAO;AAAA,IACL,MAAM;AAAA,IACN,OAAO,EAAC,OAAO,IAAI,QAAQ,GAAE;AAAA,EAC/B;AAAA,EACA,YAAY;AAAA,IACV,MAAM;AAAA,IACN,OAAO,EAAC,OAAO,KAAK,QAAQ,IAAG;AAAA,EACjC;AAAA,EACA,SAAS;AAAA,IACP,MAAM;AAAA,IACN,OAAO,EAAC,OAAO,IAAI,QAAQ,GAAE;AAAA,EAC/B;AAAA,EACA,SAAS;AAAA,IACP,MAAM;AAAA,IACN,OAAO,EAAC,OAAO,IAAI,QAAQ,GAAE;AAAA,EAC/B;AAAA,EACA,QAAQ;AAAA,IACN,MAAM;AAAA,IACN,OAAO,EAAC,OAAO,IAAI,QAAQ,GAAE;AAAA,EAC/B;AAAA,EACA,QAAQ;AAAA,IACN,MAAM;AAAA,IACN,OAAO,EAAC,OAAO,IAAI,QAAQ,GAAE;AAAA,EAC/B;AAAA,EACA,OAAO;AAAA,IACL,MAAM;AAAA,IACN,OAAO,EAAC,OAAO,KAAK,QAAQ,IAAG;AAAA,EACjC;AACF,GC/Ba,eAAe,OAAO,KAKhC,CAACA,WAAU;AACZ,QAAM,EAAC,aAAa,SAAS,SAAS,YAAW,IAAIA,QAC/C,QAAQ,YAAY,SAAS,GAC7B,SAAS,YAAY,SAAS,GAC9B,WAAW,cAAc,OAAO,EAAE;AAEjC,SAAA;AAAA;AAAA,aAEI,cAAc,SAAS,IAAI,KAAK,CAAC;AAAA,cAChC,cAAc,SAAS,IAAI,MAAM,CAAC;AAAA,iBAC/B,cAAc,SAAY,IAAI,KAAK,CAAC;AAAA,qBAChC,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,OAAO,OAAO,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAkCzC,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiBlC,CAAC;AAED,aAAa,cAAc;ACvDpB,SAAS,MAAMA,QAAmB;AACjC,QAAA,EAAC,SAAS,IAAM,YAAY,QAAQ,OAAO,SAAS,GAAG,aAAa,IAAO,OAAA,IAAUA;AAGzF,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,aAAa;AAAA,MACb,SAAS;AAAA,MACT,SAAS;AAAA,MACT,aAAa;AAAA,MACb,WAAW,UAAQ,OAAA,SAAA,OAAA;AAAA,MACnB,eAAY;AAAA,MAEX,UAAA;AAAA,QAAA,YAAY,EAAC,YAAY,QAAQ,MAAA,CAAM;AAAA,QACvC,UAAU,oBAAC,QAAK,EAAA,eAAW,GAAC,CAAA;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGnC;AAEA,SAAS,YAAYA,QAQP;AACZ,QAAM,EAAC,YAAY,QAAQ,OAAO,WAAUA;AAExC,SAAA,mBAAmB,KAAK,IACnB,cAAc,OAAO,EAAC,YAAY,OAAO,CAAA,IAG9C,OAAO,SAAU,WAEhB,oBAAA2B,QAAA,EAAK,IAAG,QAAO,WAAW,UAAA,OAAA,SAAA,OAAQ,aAAa,MAAM,GACnD,UAAA,MACH,CAAA,IAIA,eAAe,KAAK,IACf,QAGF;AACT;AC7DgB,SAAA,mBACd,OACA,QACA,YACW;AACX,SAAI,mBAAmB,KAAK,IACnB,cAAc,OAAO,EAAC,QAAQ,YAAW,IAG9C,OAAO,SAAU,WACX,oBAAA,OAAA,EAAK,iBAAM,IAId;AACT;AAEgB,SAAA,kBACd,OACA,QACA,cACW;AACX,SAAI,OAAO,SAAU,WACZ,QAGL,mBAAmB,KAAK,IACnB,cAAc,OAAO,EAAC,OAAO,CAAA,IAI9B,SAAiB;AAC3B;ACtBA,MAAMgR,6BAAmD;AAAA,EACvD,GAAG,cAAc,QAAQ;AAAA,EACzB,QAAQ;AAAA,EACR,KAAK;AAAA,EACL,KAAK5F,sBAAoB;AAC3B,GAEM/H,SAAO,OAAO,IAAI;AAAA,YACZ,IAAI,cAAc,QAAQ,MAAM,MAAM,CAAC;AAAA;AAAA,GAI7C4N,kBAAgB,OAAO,YAAY,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,GAAG,MAAM,EAAE,CAAA;AAAA,eACtE,IAAI,GAAG,CAAC;AAAA;AAAA;AAOhB,SAAS,eAAe5S,QAA4B;AACnD,QAAA,EAAC,UAAU,eAAe,OAAO,QAAQ,MAAK,IAAIA,QAElD,EAAC,GAAAa,GAAC,IAAI,eAAe,GAErB,aAAa,UACjB,oBAAC,KAAI,EAAA,eAAY,2BAA0B,aAAa,GAAG,cAAc,GACtE,UAAA,kBAAkB,QAAQ,SAAS,EACtC,CAAA;AAGF,SAAI,gBAEA;AAAA,IAACmE;AAAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,eAAY;AAAA,MACZ,aAAa,QAAQ,IAAI;AAAA,MACzB,cAAc;AAAA,MACd,UAAU;AAAA,MAEV,+BAAC,MAAK,EAAA,OAAM,UAAS,MAAM,GAAG,KAAK,GAChC,UAAA;AAAA,QAAS,SAAA,oBAAC,YAAS,UAAQ,IAAC,QAAQ,GAAG,OAAO,cAAc,QAAQ,MAAO,CAAA;AAAA,QAE5E,oBAAC,OAAM,EAAA,eAAY,4BAA2B,MAAM,GAAG,OAAO,GAC5D,UAAC,oBAAA4N,iBAAA,CAAA,CAAc,EACjB,CAAA;AAAA,QAEC;AAAA,MAAA,GACH;AAAA,IAAA;AAAA,EAAA,IAMJ;AAAA,IAAC5N;AAAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,eAAY;AAAA,MACZ,aAAa,QAAQ,IAAI;AAAA,MACzB,cAAc;AAAA,MACd,UAAU;AAAA,MAEV,UAAA;AAAA,QAAA,qBAAC,QAAK,OAAM,UAAS,MAAM,GAAG,KAAK,GAChC,UAAA;AAAA,UACC,SAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,QAAQ;AAAA,cACR,YAAY2N;AAAAA,cACZ,QAAO;AAAA,cACP;AAAA,YAAA;AAAA,UACF;AAAA,UAEF,oBAAC,SAAM,eAAY,2BAA0B,MAAM,GAAG,OAAO,GAC3D,UAAC,qBAAAhR,QAAA,EAAK,MAAM,GAAG,OAAO,EAAC,OAAO,aAAY,cAAa,YAAW,QAAO,UACtE,UAAA;AAAA,YAAS,SAAA,kBAAkB,OAAO,SAAS;AAAA,YAC3C,CAAC,SACA,oBAAC,QAAK,EAAA,OAAO,EAAC,OAAO,6BAA4B,GAC9C,UAAEd,GAAA,gCAAgC,EACrC,CAAA;AAAA,UAAA,EAAA,CAEJ,EACF,CAAA;AAAA,UAEC;AAAA,QAAA,GACH;AAAA,QAEC,YAAY,oBAAC,KAAI,EAAA,YAAY,GAAI,UAAS;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGjD;ACzEA,MAAM8R,6BAAmD;AAAA,EACvD,GAAG,cAAc,QAAQ;AAAA,EACzB,QAAQ;AAAA,EACR,KAAK;AAAA,EACL,KAAK5F,sBAAoB;AAC3B,GAEM/H,SAAO,OAAO,IAAI;AAAA,YACZ,IAAI,cAAc,QAAQ,MAAM,MAAM,CAAC;AAAA;AAAA,GAI7C4N,kBAAgB,OAAO,YAAY,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,GAAG,MAAM,EAAE,CAAA;AAAA,eACtE,IAAI,GAAG,CAAC;AAAA;AAAA,GAIjBC,qBAAmB,OAAO,YAAY,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,GAAG,MAAM,EAAE,CAAA;AAAA,eACzE,IAAI,GAAG,CAAC;AAAA;AAAA;AAOhB,SAAS,eAAe7S,QAA4B;AACzD,QAAM,EAAC,OAAO,UAAU,OAAO,QAAQ,eAAe,UAAU,OAAA,IAAUA,QACpE,EAAC,GAAAa,GAAC,IAAI,eAAe,GACrB,gBAAgB,WAAW,UAAA,OAAA,SAAA,OAAQ,MAAM,CAAA,CAAQ,aAAa,UAAQ,OAAA,SAAA,OAAA,YAAW,GAEjF,aAAa,UAChB,oBAAA,KAAA,EAAI,WAAW,UAAA,OAAA,SAAA,OAAQ,QAAQ,eAAY,2BACzC,UAAkB,kBAAA,QAAQ,SAAS,EACtC,CAAA;AAGF,SAAI,gBAEA;AAAA,IAACmE;AAAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,WAAW,UAAQ,OAAA,SAAA,OAAA;AAAA,MACnB,eAAY;AAAA,MACZ,SAAS;AAAA,MACT,aAAa,QAAQ,IAAI;AAAA,MAEzB,+BAAC,MAAK,EAAA,OAAM,UAAS,MAAM,GAAG,KAAK,GAChC,UAAA;AAAA,QAAA,SACE,oBAAA,KAAA,EAAI,MAAK,QACR,8BAAC,UAAS,EAAA,UAAQ,IAAC,QAAQ,GAAG,OAAO,cAAc,QAAQ,MAAO,CAAA,GACpE;AAAA,6BAGD,OAAM,EAAA,eAAY,4BAA2B,MAAM,GAAG,OAAO,GAC5D,UAAA;AAAA,UAAA,oBAAC4N,iBAAc,EAAA;AAAA,8BACdC,oBAAiB,EAAA;AAAA,QAAA,GACpB;AAAA,4BAEC,KAAI,EAAA,MAAK,QAAO,SAAS,GACvB,UACH,YAAA;AAAA,MAAA,GACF;AAAA,IAAA;AAAA,EAAA,IAMJ;AAAA,IAAC7N;AAAAA,IAAA;AAAA,MACC,OAAM;AAAA,MACN,WAAW;AAAA,MACX,eAAY;AAAA,MACZ,SAAS;AAAA,MACT,aAAa,QAAQ,IAAI;AAAA,MAEzB,+BAAC,MAAK,EAAA,OAAM,UAAS,MAAM,GAAG,KAAK,GAChC,UAAA;AAAA,QACC,SAAA,oBAAC,KAAI,EAAA,MAAK,QACR,UAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,YAAY2N;AAAAA,YACZ,QAAO;AAAA,YACP;AAAA,YACA;AAAA,UAAA;AAAA,QAAA,GAEJ;AAAA,QAGF,qBAAC,OAAM,EAAA,WAAW,UAAQ,OAAA,SAAA,OAAA,SAAS,eAAY,2BAA0B,MAAM,GAAG,OAAO,GACvF,UAAA;AAAA,UAAA;AAAA,YAAChR;AAAAA,YAAA;AAAA,cACC,WAAW,UAAQ,OAAA,SAAA,OAAA;AAAA,cACnB,MAAM;AAAA,cACN,OAAO,EAAC,OAAO,UAAS;AAAA,cACxB,cAAa;AAAA,cACb,QAAO;AAAA,cAEN,UAAA;AAAA,gBAAS,SAAA,kBAAkB,OAAO,SAAS;AAAA,gBAC3C,CAAC,SACA,oBAAC,QAAK,EAAA,OAAO,EAAC,OAAO,6BAA4B,GAC9C,UAAEd,GAAA,gCAAgC,EACrC,CAAA;AAAA,cAAA;AAAA,YAAA;AAAA,UAEJ;AAAA,UAEC,YACC,oBAACc,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,cAAa,YAAW,WAAW,UAAQ,OAAA,SAAA,OAAA,UAC7D,UAAkB,kBAAA,UAAU,SAAS,GACxC;AAAA,QAAA,GAEJ;AAAA,4BAEC,KAAI,EAAA,MAAK,QAAO,SAAS,GACvB,UACH,YAAA;AAAA,QAEC,YAAa,oBAAA,OAAA,EAAI,WAAW,UAAA,OAAA,SAAA,OAAQ,UAAW,SAAS,CAAA;AAAA,MAAA,GAC3D;AAAA,IAAA;AAAA,EAAA;AAGN;AC5Ia,MAAA,WAAW,OAAO,IAAI,EAAE,MAAM,EAAC,OAAO,UAAS;AAAA,YAChD,IAAI,cAAc,OAAO,MAAM,MAAM,CAAC;AAAA,GAGrC,YAAY,OAAO,GAAG;AAAA;AAAA,GAItBmR,kBAAgB,OAAO,QAAQ,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,EAAE,CAAA;AAAA,WACpE,IAAI,cAAc,OAAO,MAAM,KAAK,CAAC;AAAA,YACpC,IAAI,cAAc,OAAO,MAAM,MAAM,CAAC;AAAA,GAGrCF,kBAAgB,OAAO,YAAY,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,GAAG,MAAM,EAAE,CAAA;AAAA,eAC7E,IAAI,GAAG,CAAC;AAAA;AAAA,GAIVC,qBAAmB,OAAO,YAAY,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,GAAG,MAAM,EAAE,CAAA;AAAA,eAChF,IAAI,GAAG,CAAC;AAAA;AAAA,GAIV,sBAAsB,OAAO,YAAY,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,GAAG,MAAM,EAAE,CAAA;AAAA,eACnF,IAAI,GAAG,CAAC;AAAA;AAAA,GAIV,kBAAkB,OAAOlR,MAAI,EAAE,CAAC,EAAC,YAAW;AACvD,QAAM,EAAC,MAAA,IAAS,MAAM,QAChB,YAAY,MAAM,KAAK,MAAM,CAAC,GAC9B,WAAW,GACX,YAAY,UAAU,aAAa;AAElC,SAAA;AAAA;AAAA,oBAEW,IAAI,SAAS,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAON,QAAQ;AAAA;AAAA;AAAA;AAIpC,CAAC,GC7BKgR,6BAAmD;AAAA,EACvD,GAAG,cAAc,OAAO;AAAA,EACxB,KAAK;AAAA,EACL,QAAQ;AAAA,EACR,KAAK5F,sBAAoB;AAC3B;AAKO,SAAS,cAAc/M,QAA2B;AACjD,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,kBAAkB2S;AAAAA,IAClB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,IACE3S,QACE,EAAC,GAAAa,OAAK,kBAEN,aAAa,UAChB,oBAAA,WAAA,EAAU,YAAY,GAAG,cAAc,GACrC,UAAkB,kBAAA,QAAQ,QAAQ,EACrC,CAAA;AAGF,SAAI,gBAEA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ,aAAa,QAAQ,IAAI;AAAA,MACzB,cAAc;AAAA,MACd,UAAU;AAAA,MAEV,+BAAC,MAAK,EAAA,OAAM,UAAS,MAAM,GAAG,KAAK,GAChC,UAAA;AAAA,QAAS,SAAA,oBAACiS,iBAAc,EAAA,eAAY,wBAAwB,CAAA;AAAA,QAE5D,oBAAA,MAAA,EAAK,OAAM,UAAS,eAAY,0BAAyB,MAAM,GAC9D,UAAC,qBAAA,OAAA,EAAM,MAAM,GAAG,OAAO,GACrB,UAAA;AAAA,UAAA,oBAACF,iBAAc,EAAA;AAAA,8BACdC,oBAAiB,EAAA;AAAA,UACjB,eACE,oBAAA,KAAA,EAAI,WAAW,GACd,UAAA,oBAAC,sBAAoB,CAAA,GACvB;AAAA,QAAA,EAAA,CAEJ,EACF,CAAA;AAAA,QAEC;AAAA,MAAA,GACH;AAAA,IAAA;AAAA,EAAA,IAMJ;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,eAAY;AAAA,MACZ,aAAa,QAAQ,IAAI;AAAA,MACzB,cAAc;AAAA,MACd,UAAU;AAAA,MAEV,+BAAC,MAAK,EAAA,OAAM,UAAS,MAAM,GAAG,KAAK,GAChC,UAAA;AAAA,QAAA,6BAAU,OAAM,EAAA,YAAY,iBAAiB,QAAO,UAAS,OAAqB;AAAA,6BAElF,MAAK,EAAA,OAAM,UAAS,eAAY,0BAAyB,MAAM,GAC9D,UAAA;AAAA,UAAA,qBAAC,OAAM,EAAA,MAAM,GAAG,OAAO,GACrB,UAAA;AAAA,YAAC,qBAAAlR,QAAA,EAAK,cAAa,YAAW,MAAM,GAAG,OAAO,EAAC,OAAO,UAAA,GAAY,QAAO,UACtE,UAAA;AAAA,cAAS,SAAA,kBAAkB,OAAO,QAAQ;AAAA,cAC1C,CAAC,SAAY,oBAAA,UAAA,EAAA,UAAAd,GAAE,gCAAgC,GAAE;AAAA,YAAA,GACpD;AAAA,YAEC,YACC,oBAACc,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,cAAa,YAC/B,UAAA,kBAAkB,UAAU,QAAQ,GACvC;AAAA,YAGD,eACC,oBAAC,KAAI,EAAA,WAAW,GACd,UAAC,oBAAA,iBAAA,EAAgB,OAAK,IAAC,MAAM,GAC1B,UAAA,kBAAkB,aAAa,QAAQ,EAC1C,CAAA,GACF;AAAA,UAAA,GAEJ;AAAA,UAEC;AAAA,QAAA,GACH;AAAA,QAEC;AAAA,MAAA,GACH;AAAA,IAAA;AAAA,EAAA;AAGN;ACpHA,MAAM,OAAO,IACPzB,iBAAe,GAEf8E,SAAO,OAAO;AAAA,WACT,IAAI;AAAA,YACH,IAAI;AAAA;AAAA,GAIV,WAAW,OAAO,OAAO,CAAC,EAAC,YAA2B;AACpD,QAAA,EAAC,MAAK,IAAI,MAAM;AAEf,SAAA;AAAA;AAAA,cAEK,KAAK,KAAK,MAAM,OAAO,MAAM,GAAG,EAAE,GAAG;AAAA,oBAC/B9E,cAAY;AAAA;AAEhC,CAAC,GAEK,iBAAiB,OAAO,OAAO,CAAC,EAAC,YAA2B;AAC1D,QAAA,EAAC,MAAK,IAAI,MAAM;AAEf,SAAA;AAAA;AAAA,cAEK,KAAK,KAAK,MAAM,OAAO,MAAM,GAAG,EAAE,GAAG;AAAA,oBAC/BA,cAAY;AAAA;AAAA;AAGhC,CAAC;AAKM,SAAS,iBAAiBF,QAG9B;AACD,QAAM,EAAC,OAAO,cAAaA,QACrB,QAAQ,KAAK,IAAI,KAAK,IAAI,WAAW,CAAC,GAAG,GAAG,GAC5C,SAAS,OAAO,IAAIE,iBAAe,GACnC,OAAO,IAAI,KAAK,KAAK,QACrB,UAAW,MAAM,SAAS,MAAO,MACjC,UAAU,GAAG,OAAO,CAAC,IAAI,OAAO,CAAC,IAAI,IAAI,IAAI,IAAI;AAGrD,SAAA,qBAAC8E,UAAK,SACJ,UAAA;AAAA,IAAA,oBAAC,YAAS,IAAI,MAAM,IAAI,MAAM,GAAG,QAAQ;AAAA,IACzC;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,GAAG;AAAA,QACH,OAAO;AAAA,UACL,iBAAiB;AAAA,UACjB,kBAAkB,GAAG,MAAM;AAAA,QAC7B;AAAA,MAAA;AAAA,IACF;AAAA,EACF,EAAA,CAAA;AAEJ;AC1DA,MAAM,eAAe,KAEfA,SAAO,OAAO,IAAI;AAAA;AAAA;AAAA,GAKlB,MAAM,OAAO,IAAI,EAAE,CAAC,EAAC,YAA2B;AAC9C,QAAA,EAAC,MAAK,IAAI,MAAM;AAEf,SAAA;AAAA,cACK,YAAY;AAAA,kBACR,KAAK,KAAK,MAAM,OAAO,MAAM,GAAG,EAAE,GAAG;AAAA;AAAA;AAGvD,CAAC;AAKM,SAAS,eAAehF,QAG5B;AACK,QAAA,EAAC,MAAS,IAAAA;AAEhB,6BACGgF,QAAK,EAAA,QAAQ,GACZ,UAAA,oBAAC,OAAI,QAAQ,GAAG,OAAO,EAAC,WAAW,eAAe,QAAQ,GAAG,WAAA,GAAa,EAC5E,CAAA;AAEJ;AChCa,MAAA+N,YAAU,OAAO,GAAG;AAAA;AAAA,GAIpB,YAAY,OAAO,IAAI,EAAE,MAAM,EAAC,OAAO,UAAU,SAAS,SAAA,CAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQnE,gBAAgB,OAAO,QAAQ,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,EAAE,CAAA;AAAA;AAAA;AAAA,GAKlE,eAAe,OAAO,IAAI,EAAE,MAAM,EAAC,OAAO,UAAU,SAAS,SAAA,CAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAyBtE,sBAAsB,OAAO,KAAK,EAAE,MAAM,EAAC,OAAO,GAAE;AAAA,eAClD,IAAI,GAAG,CAAC;AAAA,GCvBjBJ,6BAAmD;AAAA,EACvD,GAAG,cAAc,MAAM;AAAA,EACvB,QAAQ;AAAA,EACR,KAAK;AAAA,EACL,KAAK5F,sBAAoB;AAC3B;AAKO,SAAS,aAAa/M,QAA0B;AAC/C,QAAA;AAAA,IACJ;AAAA,IACA,kBAAkB2S;AAAAA,IAClB;AAAA,IACA;AAAA,IACA,WAAW;AAAA,IACX;AAAA,IACA;AAAA,IACA,aAAa;AAAA,IACb,aAAa;AAAA,EACX,IAAA3S,QAEE,SAAS,gBAAgB,UAAU,GAEnC,gBAAgB,QAAQ,OAAO,EAAC,eAAe,GAAG,MAAM,MAAM,QAAO,CAAC,MAAM,CAAC,GAE7E,iBAAiB,QAAQ,MACzB,CAAC,SAAS,CAAC,WACN,4BAIN,qBACE,EAAA,UAAA;AAAA,IACC,SAAA,oBAAC2B,QAAK,EAAA,OAAM,UAAS,MAAM,GAAG,QAAO,UAClC,UAAA,kBAAkB,OAAO,OAAO,EACnC,CAAA;AAAA,IAGD,YACC,oBAACA,QAAK,EAAA,OAAM,UAAS,OAAK,IAAC,MAAM,GAC9B,UAAA,kBAAkB,UAAU,OAAO,GACtC;AAAA,EAAA,EAAA,CAEJ,GAED,CAAC,UAAU,KAAK,CAAC;AAGlB,SAAA,oBAAC,KAAI,EAAA,SAAS,GACZ,UAAA,qBAACoR,WAAQ,EAAA,eAAY,iBAAgB,MAAM,GAAG,UAAS,UACrD,UAAA;AAAA,IAAC,oBAAA,OAAA,EAAI,OAAO,cAAe,CAAA;AAAA,IAE1B,oBAAA,SAAA,EAAQ,SAAS,gBAAgB,UAAU,CAAC,gBAAgB,WAAU,OAAM,QAAM,IACjF,UAAA,qBAAC,WACE,EAAA,UAAA;AAAA,MACC,gBAAA,oBAAC,iBAAc,IAEf;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAQ;AAAA,UACR,YAAY;AAAA,UACZ,QAAO;AAAA,UACP;AAAA,UACA,QAAQ,aAAa,IAAI;AAAA,UACzB,YAAU;AAAA,QAAA;AAAA,MACZ;AAAA,MAGD,OAAO,YAAa,YAAY,WAAW,MACzC,oBAAA,cAAA,EACC,UAAC,oBAAA,kBAAA,EAAiB,OAAO,SAAA,CAAU,EACrC,CAAA;AAAA,IAAA,EAAA,CAEJ,EACF,CAAA;AAAA,IAEC;AAAA,EAAA,EACH,CAAA,EACF,CAAA;AAEJ;ACnGa,MAAAC,eAAa,OAAO,IAAI,EAAE,MAAM,EAAC,OAAO,UAAS;AAAA,YAClD,IAAI,cAAc,MAAM,MAAM,MAAM,CAAC;AAAA;AAAA;AAAA;AAAA,GAMpC,YAAY,OAAO,IAAI;AAAA;AAAA;AAAA,oBAGhB,CAAC,EAAC,OAAM,MAAM,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAW3B,UAAU,OAAO,GAAG,EAAE,MAAM,EAAC,UAAU,UAAS;AAAA,mBAC1C,CAAC,EAAC,YAAW,MAAM,OAAO,OAAO,CAAC,CAAC;AAAA,GCbhDL,6BAAmD;AAAA,EACvD,GAAG,cAAc,WAAW;AAAA,EAC5B,KAAK;AAAA,EACL,KAAK5F,sBAAoB;AAC3B,GAEM,WAAW,CAAC,eAAuC;AACjD,QAAA,EAAC,QAAQ,MAAS,IAAA;AAExB,SAAI,CAAC,UAAU,CAAC,QACP,IAGD,SAAS,QAAS;AAC5B;AAKO,SAAS,kBAAkB/M,QAA+B;AACzD,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,gBAAgB;AAAA,IAChB,kBAAkB2S;AAAAA,IAClB;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAA3S;AAEJ,8BACG,SACC,EAAA,UAAA;AAAA,IAAA,qBAAC,OACC,EAAA,UAAA;AAAA,MAAC,qBAAAgT,cAAA,EAAW,eAAe,GAAG,aAAa,GAAG,cAAc,GAAG,YAAY,GACzE,UAAA;AAAA,QAAA,qBAAC,OAAM,EAAA,MAAM,GAAG,OAAO,GACnB,UAAA;AAAA,WAAA,SAAS,kBACT,oBAACrR,QAAK,EAAA,MAAM,GAAG,cAAa,YAAW,QAAO,UAC3C,UAAQ,QAAA,kBAAkB,OAAc,OAAO,IAAI,eACtD;AAAA,UAGD,YACC,oBAACA,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,cAAa,YAC/B,UAAA,kBAAkB,UAAiB,OAAO,GAC7C;AAAA,QAAA,GAEJ;AAAA,QAEC,qBAAA,MAAA,EAAK,KAAK,GAAG,aAAa,GACxB,UAAA;AAAA,UACC,UAAA,oBAAC,OAAI,UAAU,GAAG,UAAU,GACzB,UAAA,kBAAkB,QAAe,OAAO,EAC3C,CAAA;AAAA,UAGD;AAAA,QAAA,GACH;AAAA,MAAA,GACF;AAAA,MAEA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,QAAQ,SAAS,eAAe;AAAA,UAChC,sBAAoB;AAAA,UACpB,SAAQ;AAAA,UACR,QAAO;AAAA,UACP,QAAQ;AAAA,UACR,MAAK;AAAA,UAEL,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,QAAQ;AAAA,cACR,YAAY;AAAA,cACZ,QAAO;AAAA,cACP;AAAA,cACA,QAAQ;AAAA,cACR,YAAU;AAAA,YAAA;AAAA,UACZ;AAAA,QAAA;AAAA,MACF;AAAA,IAAA,GACF;AAAA,IAEC,eACE,oBAAA,KAAA,EAAI,UAAU,GAAG,UAAU,GAC1B,UAAA,oBAACA,QAAK,EAAA,OAAK,IAAC,MAAM,GACf,4BAAkB,aAAoB,OAAO,EAChD,CAAA,GACF;AAAA,IAGD,YAAa,oBAAA,OAAA,EAAK,SAAS,CAAA;AAAA,EAC9B,EAAA,CAAA;AAEJ;AChGA,MAAMgR,6BAAmD;AAAA,EACvD,GAAG,cAAc,MAAM;AAAA,EACvB,QAAQ;AAAA,EACR,KAAK;AAAA,EACL,KAAK5F,sBAAoB;AAC3B,GAEMiG,eAAa,OAAO,IAAI,EAAE,MAAM,EAAC,OAAO,UAAS;AAAA,gBACvC,IAAI,cAAc,MAAM,MAAM,MAAM,CAAC;AAAA;AAM9C,SAAS,aAAahT,QAAqD;AAC1E,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,kBAAkB2S;AAAAA,IAClB;AAAA,IACA;AAAA,IACA;AAAA,EACE,IAAA3S;AAEJ,SACG,qBAAA,OAAA,EAAM,eAAY,iBAAgB,OAAO,GACxC,UAAA;AAAA,IAAC,qBAAAgT,cAAA,EAAW,eAAY,yBACrB,UAAA;AAAA,MAAA,6BAAU,OAAM,EAAA,YAAY,iBAAiB,QAAO,SAAQ,OAAqB;AAAA,2BAEjF,KAAI,EAAA,MAAM,GAAG,aAAa,QAAQ,IAAI,GACrC,UAAA;AAAA,QAAA,oBAACrR,QAAK,EAAA,MAAM,GAAG,cAAa,YAAW,QAAO,UAC3C,UAAA,QAAQ,kBAAkB,OAAO,OAAO,IAAI,YAC/C;AAAA,QAEC,YACE,oBAAA,KAAA,EAAI,WAAW,GACd,8BAACA,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,cAAa,YAC/B,4BAAkB,UAAU,OAAO,EACtC,CAAA,GACF;AAAA,QAGD,eACE,oBAAA,KAAA,EAAI,WAAW,GACd,8BAACA,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,cAAa,YAC/B,4BAAkB,aAAa,OAAO,EACzC,CAAA,GACF;AAAA,MAAA,GAEJ;AAAA,MAEC,qBAAA,MAAA,EAAK,KAAK,GAAG,aAAa,GACxB,UAAA;AAAA,QACC,UAAA,oBAAC,OAAI,UAAU,GAAG,UAAU,GACzB,UAAA,kBAAkB,QAAQ,OAAO,EACpC,CAAA;AAAA,QAGD;AAAA,MAAA,GACH;AAAA,IAAA,GACF;AAAA,IAEC,YAAY,oBAAC,OAAI,EAAA,eAAY,2BAA2B,UAAS;AAAA,EACpE,EAAA,CAAA;AAEJ;ACzEO,MAAM,WAAW,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAQlB,YAAY,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAcX,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,OAAO,CAAC,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAWxC,CAAC,EAAC,MAAA,MAAW,IAAI,MAAM,OAAO,OAAO,CAAC,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAehD,WAAW,OAAOA,MAAI,EAAE,MAAM,EAAC,aAAa,OAAO,CAAA,EAAE,CAAC,EAAC,YAA2B;AACvF,QAAA,WAAW,MAAM,OAAO,MAAM,MAC9B,WAAW,SAAS,MAAM,CAAC;AAE1B,SAAA;AAAA,sBACa,SAAS,QAAQ;AAAA,mBACpB,SAAS,QAAQ,MAAM;AAAA;AAAA;AAAA;AAAA,mBAIvB,SAAS,aAAa,SAAS,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAa1D,CAAC,GC9DK,2BAAmD;AAAA,EACvD,GAAG,cAAc,OAAO;AAAA,EACxB,KAAK;AAAA,EACL,QAAQ;AAAA,EACR,KAAKoL,sBAAoB;AAC3B;AAKO,SAAS,cAAc/M,QAA2B;AACjD,QAAA;AAAA,IACJ;AAAA,IACA,gBAAgB;AAAA,IAChB;AAAA,IACA,kBAAkB;AAAA,EAChB,IAAAA;AAGF,SAAA,qBAAC,UAAS,EAAA,eAAY,kBACnB,UAAA;AAAA,IACC,SAAA,qBAAC,WAAU,EAAA,eAAY,wBACpB,UAAA;AAAA,MAAmB,mBAAA,OAAO,UAAU,eAAe;AAAA,0BACnD,QAAK,EAAA;AAAA,IAAA,GACR;AAAA,IAGF,oBAAC,UAAS,EAAA,eAAY,wBAAuB,MAAM,GAChD,UAAkB,kBAAA,OAAO,UAAU,aAAa,EACnD,CAAA;AAAA,EACF,EAAA,CAAA;AAEJ;ACtBA,MAAM,0BAAkD;AAAA,EACtD,GAAG,cAAc,QAAQ;AAAA,EACzB,QAAQ;AAAA,EACR,KAAK;AAAA,EACL,KAAK+M,sBAAoB;AAC3B,GAEM,OAAO,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAajB,aAAa,OAAO,IAAI,EAAE,MAAM,EAAC,OAAO,UAAS;AAAA,YAC3C,IAAI,cAAc,QAAQ,MAAM,MAAM,CAAC;AAAA,GAG7C,gBAAgB,OAAO,YAAY,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,EAAE,CAAA;AAAA,eAC7D,IAAI,GAAG,CAAC;AAAA;AAAA,GAIjB,mBAAmB,OAAO,YAAY,EAAE,MAAM,EAAC,UAAU,IAAM,QAAQ,GAAG,MAAM,EAAE,CAAA;AAAA,eACzE,IAAI,GAAG,CAAC;AAAA;AAAA;AAOhB,SAAS,gBAAgB/M,QAA6B;AACrD,QAAA;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA,kBAAkB;AAAA,IAClB;AAAA,IACA,QAAQ;AAAA,EACN,IAAAA;AAEA,SAAA,gBAEC,oBAAA,MAAA,EACC,UAAC,oBAAA,YAAA,EACC,+BAAC,OAAM,EAAA,MAAM,GAAG,OAAO,GACrB,UAAA;AAAA,IAAA,oBAAC,eAAc,EAAA;AAAA,wBACd,kBAAiB,EAAA;AAAA,EAAA,EACpB,CAAA,EACF,CAAA,EACF,CAAA,IAKF,qBAAC,MACC,EAAA,UAAA;AAAA,IAAA,qBAAC,YACC,EAAA,UAAA;AAAA,MAAA,qBAAC,OAAM,EAAA,MAAM,GAAG,OAAO,GACpB,UAAA;AAAA,QAAA,mBAAmB,KAAK,KACtB,oBAAA2B,QAAA,EAAK,cAAa,YAAY,UAAc,cAAA,OAAO,EAAC,QAAQ,UAAS,CAAC,EAAE,CAAA;AAAA,QAE1E,eAAe,KAAK,yBAAMA,QAAK,EAAA,cAAa,YAAY,UAAM,OAAA;AAAA,QAE9D,mBAAmB,QAAQ,KACzB,oBAAAA,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,cAAa,YAC/B,UAAc,cAAA,UAAU,EAAC,QAAQ,UAAU,CAAA,GAC9C;AAAA,QAED,eAAe,QAAQ,KACrB,oBAAAA,QAAA,EAAK,OAAK,IAAC,MAAM,GAAG,cAAa,YAC/B,UACH,SAAA,CAAA;AAAA,MAAA,GAEJ;AAAA,MAEC,SACC,oBAAC,MAAK,EAAA,OAAM,cAAa,aAAa,GACpC,UAAC,oBAAA,OAAA,EAAM,YAAY,iBAAiB,QAAO,WAAU,MAAc,CAAA,GACrE;AAAA,IAAA,GAEJ;AAAA,IAEC,eACE,oBAAA,KAAA,EAAI,WAAW,GACd,8BAACA,QAAK,EAAA,OAAK,IAAC,MAAM,GAAG,OAAO,EAAC,YAAY,eAAc,GACpD,sBACH,CAAA,GACF;AAAA,EAEJ,EAAA,CAAA;AAEJ;ACnHA,MAAM,4BAA4B,CAAC,eAAe,YAAY,MAAM,GAE9D,YACJ;AAEF,SAAS,qBAAqB,SAAsB;AAClD,SAAO,CAAC,GAAI,QAAQ,iBAAiB,SAAS,CAAS,EAAE;AAAA,IACvD,CAAC,OAAO,CAAC,GAAG,aAAa,UAAU,KAAK,GAAG,aAAa,aAAa,MAAM;AAAA,EAAA;AAE/E;AA8BO,SAAS,eAAe3B,QAAoC;AAC3D,QAAA;AAAA,IACJ,YAAY;AAAA,IACZ;AAAA,IACA,OAAO;AAAA,IACP,aAAa,CAAC,QAAQ;AAAA,IACtB,QAAQ;AAAA,IACR;AAAA,EAAA,IACEA,QACE,CAAC,cAAc,eAAe,IAAI,SAAiB,EAAE,GACrD,CAAC,mBAAmB,oBAAoB,IAAI,SAAwB,CAAA,CAAE,GAEtE,eAAe,kBAAkB,QACjC,qBAAqB,eAAe,GAKpC,UAAU,cAAc,eAAe,eAAe,aACtD,UAAU,cAAc,eAAe,cAAc,WAKrD,oBAAoB,YAAY,MAAM;AAC1C,QAAI,aAAa;AACT,YAAA,MAAM,qBAAqB,WAAW;AAE5C,2BAAqB,GAAG;AAAA,IAC1B;AAAA,EAAA,GACC,CAAC,WAAW,CAAC,GAKV,cAAc,YAAY,CAAC,UAAkB;AACjD,oBAAgB,KAAK;AAAA,EAAA,GACpB,CAAE,CAAA,GAKC,gBAAgB;AAAA,IACpB,CAAC,UAAe;AACV,UAAA;AACF;AAGF,YAAM,YAAY,MAAM;AACtB,cAAM,eAAe,GACrB,gBAAgB,CAAC,cAAc;AACvB,gBAAA,QAAQ,YAAY,sBAAsB;AAEhD,iBAAI,CAAC,QAAQ,SAAS,qBACb,YAGF;AAAA,QAAA,CACR;AAAA,MACH,GAEM,YAAY,MAAM;AACtB,cAAM,eAAe,GACrB,gBAAgB,CAAC,cAAc;AACvB,gBAAA,QAAQ,YAAY,KAAK;AAE/B,iBAAI,CAAC,QAAQ,SAAS,IACb,YAGF;AAAA,QAAA,CACR;AAAA,MAAA;AAGC,YAAM,QAAQ,SAAS,WAAW,SAAS,KAAK,MAC9C,MAAM,WACR,UAEA,IAAA,UAAA,IAIA,WAAW,SAAS,QAAQ,MAC1B,MAAM,QAAQ,WAChB,UAGE,GAAA,MAAM,QAAQ,WAChB,UAAU;AAAA,IAGhB;AAAA,IACA,CAAC,OAAO,SAAS,YAAY,SAAS,oBAAoB,cAAc,IAAI;AAAA,EAAA;AAM9E,YAAU,MAAM;AACI;EAAA,GACjB,CAAC,mBAAmB,cAAc,SAAS,CAAC,GAK/C,UAAU,MAAM;AACR,UAAA,KAAK,IAAI,iBAAiB,iBAAiB;AAE7C,WAAA,eACF,GAAG,QAAQ,aAAa;AAAA,MACtB,WAAW;AAAA,MACX,SAAS;AAAA,MACT,iBAAiB;AAAA,IAClB,CAAA,GAGI,MAAM;AACX,SAAG,WAAW;AAAA,IAAA;AAAA,EAChB,GACC,CAAC,mBAAmB,mBAAmB,WAAW,CAAC,GAKtD,UAAU,MAAM;AAvKlB,QAAAW;AAwKsB,sBAAA,QAAQ,CAAC,IAAI,UAAU;AACnC,gBAAU,gBACZ,GAAG,aAAa,YAAY,GAAG,GAC/B,GAAG,aAAa,iBAAiB,MAAM,GACvC,GAAG,SACH,GAAG,UAAU,MAAM,YAAY,KAAK,GACpC,GAAG,SAAS,MAAM,YAAY,EAAE,MAEhC,GAAG,aAAa,YAAY,IAAI,GAChC,GAAG,aAAa,iBAAiB,OAAO,GACxC,GAAG,UAAU,MAAM,YAAY,KAAK;AAAA,IAAA,CAEvC,GAEG,iBAAiB,MAAM,uBAEzBA,MAAA,kBADqB,iBAAiB,SAAS,qBAAqB,CACtC,MAA9B,QAAAA,IAAiC,aAAa,YAAY,GAAA;AAAA,EAAA,GAE3D,CAAC,mBAAmB,cAAc,aAAa,cAAc,kBAAkB,CAAC,GAKnF,UAAU,OACR,eAAA,QAAA,YAAa,iBAAiB,WAAW,gBAElC,MAAM;AACX,mBAAA,QAAA,YAAa,oBAAoB,WAAW,aAAA;AAAA,EAE7C,IAAA,CAAC,eAAe,WAAW,CAAC;AAGjC;ACzLA,MAAM,eAAe,OAAO,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAW5B,MAAM,OAAO,IAAI;AAAA,EACrB,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,cAAc;AAAA,EACd,WAAW;AACb,CAAC,GAGY,eAAe,WAAW,SACrCX,QAEA,KACA;AACA,QAAM,EAAC,UAAU,cAAc,MAAM,OAAO,OAAO,SAAS,MAAM,MAAM,GAAG,UAAS,IAAIA,QAClF,QAAQ,SAAA,GACR,EAAC,GAAAa,OAAKuN,iBAAe,GACrB,YAAY,QAAQ,MAAM,OAAO,MAAM,MAAM,IAAI,GACjD,WAAW,QAAQ,OAAO,EAAC,iBAAiB,aAAW,OAAA,SAAA,UAAA,QAAQ,OAAM,CAAC,SAAS,CAAC,GAChF,WAAW,CAAQ,CAAA;AAGvB,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,WAAQ;AAAA,MACP,GAAG;AAAA,MACJ,cAAY,SAASvN,GAAE,0BAA0B;AAAA,MACjD;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MAEC,UAAQ,QAAA,oBAAC,KAAI,EAAA,OAAO,UAAU;AAAA,IAAA;AAAA,EAAA;AAGrC,CAAC,GCvDY,oBAAoB,WAAyC,SACxE,EAAC,UAAU,SAAS,UAAU,GAAG,UAAS,GAC1C,KACA;AACA,SACG,oBAAA,SAAA,EAAS,GAAG,WAAW,SAAkB,UAAU,YAAY,CAAC,SAAS,KACxE,UAAC,oBAAA,OAAA,EAAK,UAAS,EACjB,CAAA;AAEJ,CAAC,GCAY,kBAAkB,WAAW,CAAC,GAAG,QAAQ;AAC9C,QAAA,EAAC,SAAQ;AAEf,SAAA,oBAAoB,KAAK,OAAO,EAAC,OAAM,GAEhC;AACT,CAAC;AAED,gBAAgB,cAAc;ACjBvB,MAAM,WAA+B;AAAA,EAC1C,QAAQ;AAAA,EACR,eAAe;AAAA,EACf,cAAc;AAAA;AAAA,EAGd,MAAM;AAAA,EACN,YAAY,CAAC,KAAK,IAAK;AAAA,EACvB,YAAY,CAAC,KAAK,GAAK;AAAA,EACvB,aAAa,CAAC,KAAK,IAAK;AAAA,EACxB,YAAY,CAAC,KAAK,GAAI;AAAA;AAAA,EAGtB,SAAS;AAAA,EACT,OAAO;AAAA,EACP,YAAY;AAAA,EACZ,aAAa;AAAA,EACb,QAAQ;AAAA,EACR,YAAY;AAAA,EACZ,OAAO,CAAC,KAAK,IAAK;AAAA;AAAA,EAGlB,QAAQ;AAAA,EACR,UAAU;AAAA,EACV,aAAa;AAAA,EACb,gBAAgB;AAAA,EAChB,mBAAmB;AAAA,EACnB,SAAS;AAAA,EACT,iBAAiB;AAAA,EACjB,SAAS;AACX,GCzBa,gBAAgB,cAAkC,QAAQ;ACAhE,SAAS,YAAgC;AAC9C,SAAO,WAAW,aAAa;AACjC;ACCO,SAAS,oBAAoB;AAAA,EAClC;AAAA,EACA,SAAS;AACX,GAGG;AAEK,QAAA,UADS,YACQ,UAAU;AAE1B,SAAA,oBAAC,eAAc,EAAA,SAAmB,SAAS,CAAA;AACpD;ACda,MAAA,mBAAmB,KAAK,SACnCb,QACA;AACA,QAAM,EAAC,UAAS,IAAIA,QACd,YAAY,iBAAA,GAEZ,eAAe;AAAA,IACnB,CAAC,eAA2B;AAC1B,YAAM,UAAU,WAAW,SACrB,qBAAqB,UAAU,OAAO;AAC5C,gBAAU,SAAS,WAAW,KAAK,kBAAkB,CAAC;AAAA,IACxD;AAAA,IACA,CAAC,WAAW,SAAS;AAAA,KAGjB,eAAe;AAAA,IACnB,OAAO,EAAC,GAAG,WAAW,UAAU,aAAY;AAAA,IAC5C,CAAC,WAAW,YAAY;AAAA,EAAA;AAE1B,6BACG,qBAAqB,UAArB,EAA8B,OAAO,cACnC,iBAAM,SACT,CAAA;AAEJ,CAAC;"}